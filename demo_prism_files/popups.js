function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}define("text!templates/popups/hostreboot/HostRebootView.html",[],function(){return'<section class="n-modal-rolling-reboot-content">\n  <section data-ntnx-section class="host-reboot-view">\n    <table class="table hypervisor-info">\n      <tbody>\n      <tr>\n          <td class="n-hypervisor">\n            <%=  i18n("CommonEntities.hypervisor") %>\n          </td>\n          <td class="n-hypervisor-type hypervisorType">\n          </td>\n      </tr>\n      </tbody>\n    </table>\n    <div class="loading">\n      <span class="loadingSpinner"></span> <%= i18n("loading") %>\n    </div>\n    <section data-ntnx-section>\n      <section class="hide" id="taskProgress" class="task-progress"></section>\n      <section class="node-selection-container nodeSelectionContainer">\n        <section class="n-selection-prompt">\n          <%= i18n("selectNodesPrompt") %>\n        </section>\n        <section data-ntnx-section>\n          <h5 data-ntnx-title class="nodeCount">\n            \x3c!-- Number of nodes is inserted here --\x3e\n          </h5>\n        </section>\n        <section data-ntnx-section>\n          <table id="hostsOnCluster" class="table table-hover">\n            <thead>\n              <tr>\n                <th class="cell-node">\n                  <%= Components.checkbox({\n                    jsClasses: \'checkboxSelectAll\',\n                    checked: false\n                  }) %>\n                  <%= i18n("node") %>\n                </th>\n                <th class="cell-ip"><%= i18n("ipAddress") %></th>\n                <th class="cell-serial"><%= i18n("serialNumber") %></th>\n              </tr>\n            </thead>\n            <tbody class="nodeSelectionTable">\n            \x3c!-- Rows of individual nodes will be appended here from template--\x3e\n            </tbody>\n          </table>\n        </section>\n      </section>\n    </section>\n  </section>\n</section>'}),define("text!templates/popups/hostreboot/HostRebootProgressView.html",[],function(){return'<div class="task">\n    <div class="status">\n      <span class="pull-left"><%= title %></span>\n      <span class="percent-complete pull-right">\n        <%= (task ? task.get(propPercentComplete):0) + \' %\' %>\n      </span>\n    </div>\n    <div class="task-progress taskProgress">\n      <%= VisualizationUtil.renderProgressBar({\n        barClass: \'n-progress-bar \' + (task ? task.get(propStatus) : \'\'),\n        percentUsed: (task ? task.get(propPercentComplete) : 0)\n      }) %>\n    </div>\n</div>'}),define("text!templates/popups/hostreboot/HostRebootNodeRowView.html",[],function(){return"<tr class='n-table-row'>\n  <td class='cell-checkbox'>\n    <%= Components.checkbox({\n      jsClasses: 'nodeSelectCheckbox',\n      attributes: 'uuid=\"' + nodeInfo.uuid + '\"',\n      checked: false\n    }) %>\n    <%= nodeInfo.blockModelName %>\n  </td>\n  <td class='cell-node-ip'>\n    <%= nodeInfo.ipAddress %>\n  </td>\n  <td class='cell-serial-number'>\n    <%= nodeInfo.serial %>\n  </td>\n</tr>"}),define("views/popups/hostreboot/HostRebootView",["data/DataProperties","managers/TaskManager","components/Components","views/basecomponents/popups/BasePopupSubView","utils/AppConstants","utils/AppUtil","utils/SubViewHelper","utils/VisualizationUtil","models/hardware/HostCollection","models/cluster/ClusterCollection","text!templates/popups/hostreboot/HostRebootView.html","text!templates/popups/hostreboot/HostRebootProgressView.html","text!templates/popups/hostreboot/HostRebootNodeRowView.html"],function(e,t,n,i,s,a,o,r,l,c,d,p,u){"use strict";return i.extend({viewOption:null,subViewHelper:null,name:"HostRebootView",events:{"click  .checkboxSelectAll":"onSelectAll","click  .nodeSelectCheckbox":"onNodeSelect"},updateProgressCallback:null,rebootTaskModel:null,currentRebootTaskUUID:null,selectedNodes:{},rebootInitiated:null,initialize:function(e){i.prototype.initialize.apply(this,arguments),a.debug("HostRebootView : initialize: "," | viewid     : ",this.cid),this.subViewHelper=new o,this.hostCollection=new l,this.clusterCollection=new c,this.rebootInitiated=!1,this.updateProgressCallback=this.renderTaskProgress.bind(this),t.registerHandlerForChangedTasks(this.updateProgressCallback)},render:function(){a.debug("HostRebootView : render: "," | viewid     : ",this.cid),this.$el.html(_.template(d,this.vtOptions())),a.addInLineDonutLoader(this.$(".loadingSpinner")),this.$(".nodeSelectionContainer").hide();var e=[];e.push(this.clusterCollection.fetch({error:function(e,t){this.showHeaderError(t)}.bind(this)})),e.push(this.hostCollection.fetch({error:function(e,t){this.showHeaderError(t)}.bind(this)})),$.when.apply($,e).done(function(){this.renderTaskProgress(),this.renderNodeTable()}.bind(this)),t.fetchOnDemand({force:!0})},destroy:function(){this.clearBaseHeader(),this.off(),t.unregisterHandlerForChangedTasks(this.updateProgressCallback),i.prototype.destroy.apply(this,arguments)},renderNodeTable:function(){var t=this,i={},a=$(".nodeSelectionTable"),o="",r=this.clusterCollection.getNodeCount();_.each(this.hostCollection.models,function(t){i.uuid=t.get(e.UUID),i.blockModelName=t.get(e.BLOCK_MODEL_NAME),i.ipAddress=t.get(e.SERVICE_VM_IP),i.serial=t.get(e.SERIAL),o+=_.template(u,{nodeInfo:i,Components:n})});var l=this.clusterCollection.getHypervisorCount();if(_.keys(l).length>1){var c="";_.each(l,function(e,n){c+='<span class="mixed-hypervisor-types">'+s.HYPERVISOR_LABEL[n]+" ",c+=1===e?t.i18ns("hypervisorTypeOnHost",e):t.i18ns("hypervisorTypeOnHosts",e),c+="</span>"}),this.$(".hypervisorType").html(c)}else{var d=s.HYPERVISOR_LABEL[_.keys(l)[0]];this.$(".hypervisorType").html(d)}a.html(o),this.$(".nodeCount").html(r+this.i18n("totalNodes")),this.$(".nodeSelectionContainer").show(),this.$(".loading").hide(),this.parentView.disableButton("btnReboot"),this.triggerAction(s.MODAL.ACT.AS_REBUILD)},onSelectAll:function(){var e=this.$(".checkboxSelectAll").prop("checked"),t=this.$(".nodeSelectCheckbox");_.each(t,function(t){var n=this.$(t),i=n.prop("checked");e&&!i&&(n.prop("checked",!0),this.isHostRebootInProgress()||this.parentView.enableButton("btnReboot")),!e&&i&&(n.prop("checked",!1),this.parentView.disableButton("btnReboot"))}.bind(this))},onNodeSelect:function(){var e=this.$(".nodeSelectCheckbox"),t=_.every(e,function(e){return $(e).prop("checked")}),n=_.some(e,function(e){return $(e).prop("checked")});t?this.$(".checkboxSelectAll").prop("checked",!0):this.$(".checkboxSelectAll").prop("checked",!1),n&&!this.isHostRebootInProgress()?this.parentView.enableButton("btnReboot"):this.parentView.disableButton("btnReboot")},getSelectedNodeUUIDs:function(){var e=[],t=this.$(".nodeSelectCheckbox");return _.each(t,function(t){var n=$(t);n.prop("checked")&&e.push(n.attr("uuid"))}),e},getSelectedNodeIPs:function(){var e=this.getSelectedNodeUUIDs(),t=_.filter(this.hostCollection.models,function(t){return e.indexOf(t.get("uuid"))>-1});return _.map(t,function(e){return e.get("serviceVMExternalIP")})},updateRebootTask:function(){this.rebootTaskModel=this.currentRebootTaskUUID?t.getGlobalTasks().getTask(this.currentRebootTaskUUID):t.getGlobalTasks().getHostRebootTask()},isHostRebootInProgress:function(){return this.updateRebootTask(),!!this.rebootTaskModel&&(this.rebootTaskModel.isStatusActive()||this.rebootTaskModel.isStatusQueued())},renderTaskProgress:function(){var t=this.parentView;if(this.rebootTaskModel&&(this.rebootInitiated=!0,t.disableButton("btnReboot"),this.$(".nodeSelectionContainer").hide(),this.$("#taskProgress").removeClass("hide")),this.rebootInitiated&&!this.isHostRebootInProgress()&&(t.enableButton("btnReboot"),this.$(".nodeSelectionContainer").show()),this.currentRebootTaskUUID||this.isHostRebootInProgress()){var n=_.template(p),i=this.i18n("progress");this.$("#taskProgress").html(n({title:i,task:this.rebootTaskModel,VisualizationUtil:r,propStatus:e.TASK_STATUS,propPercentComplete:e.TASK_PERCENT_COMPLETE}))}this.triggerAction(s.MODAL.ACT.AS_REBUILD)}})}),define("models/hostreboot/HostRebootPopupModel",["models/BaseModel","utils/SubModelHelper"],function(e,t){"use strict";return e.extend({name:"HostRebootPopupModel",subModelHelper:null,initialize:function(){e.prototype.initialize.apply(this,arguments),this.subModelHelper=new t},destroyAll:function(){this.subModelHelper.iterate("off"),this.subModelHelper.destroy()}})}),define("models/genesis/HostRebootModel",["models/genesis/GenesisBaseModel","utils/AppConstants"],function(e,t){"use strict";return e.extend({name:"HostRebootModel",methodName:t.CLUSTER_MANAGER_METHODS.ROLLING_REBOOT,managerName:t.GENESIS.CLUSTER_MANAGER,getErrorResponse:function(){return this.getParsedErrorResponse("Failed to initiate rolling reboot.")},getReturnResponse:function(){return this.get(e.DP.GENESIS_RETURN)||[]},setRPCParams:function(e){_.extend(this.kwargs,{svm_ips:e})}})}),define("text!templates/popups/hostreboot/HostRebootContentView.html",[],function(){return'\x3c!-- The parent div is #popupHostReboot --\x3e\n<div data-ntnx-content-inner class="n-modal-rolling-reboot-content">\n  \x3c!-- @subviews go in here --\x3e\n</div>'}),define("views/popups/hostreboot/HostRebootPopupView",["views/basecomponents/popups/BasePopupView","views/popups/hostreboot/HostRebootView","models/hostreboot/HostRebootPopupModel","models/genesis/HostRebootModel","utils/AppConstants","utils/AppUtil","utils/SubViewHelper","text!templates/popups/hostreboot/HostRebootContentView.html"],function(e,t,n,i,s,a,o,r){"use strict";r=_.template(r);var l=_.template('<div id="<%= id %>"></div>');return e.extend({DEFAULT_POPUP_PROP:{title:"Request Reboot",subViewContainerEl:".n-modal-rolling-reboot-content"},ROLLING_REBOOT_VIEW:"rolling-reboot-view",name:"HostRebootPopupView",subViewHelper:null,el:"#popupHostReboot",currentSubViewId:null,events:{"click  .modal-header .close":"hide","click  .btnReboot":"onClickLinkAction","click  .tab":"onClickLinkAction"},initialize:function(){e.prototype.initialize.apply(this,arguments),this.subViewHelper=new o,this.model=new n},render:function(){var e=[{isPrimary:!0,text:this.i18n("reboot"),leftAligned:!0,extraClasses:"btnReboot"}];this.$el.html(this.defaultTemplate({nestedAlert:!0,title:this.i18n("requestReboot"),antiscroll:!1,bodyContent:r(),footerButtons:this.defaultFooter(e)})),this.selectSubView({subViewId:this.ROLLING_REBOOT_VIEW})},createSubView:function(e){var n,i={el:"#"+e,model:this.model};return e===this.ROLLING_REBOOT_VIEW&&(n=new t(i)),n},selectSubView:function(e){var t=void 0,n=void 0;t=this.subViewHelper.get(this.currentSubViewId),t&&this.subViewHelper.iterate("hideView"),n=e.subViewId,t=this.subViewHelper.get(n),this.currentSubViewId=n;var i=e.options||{};if(t)t.setViewOption(i);else{$(l({id:n})).appendTo(this.DEFAULT_POPUP_PROP.subViewContainerEl),t=this.createSubView(n),this.subViewHelper.register(this.currentSubViewId,t),t.setParentView(this),t.setViewOption(i),t.render()}this._showSubView(t)},_showSubView:function(e){e&&(e.refreshView(),e.showView()),this.setButtonStates(),this.triggerAction(s.MODAL.ACT.AS_REBUILD)},setButtonStates:function(){this.currentSubViewId===this.ROLLING_REBOOT_VIEW&&this.subViewHelper.get(this.ROLLING_REBOOT_VIEW).isHostRebootInProgress()&&this.disableButton("btnReboot")},disableButton:function(e){this.$("."+e).attr("disabled","disabled")},enableButton:function(e){this.$("."+e).removeAttr("disabled")},confirmDialog:function(e){var t=this;$.nutanixConfirm({msg:e.msg,yes:function(){t.startHostReboot(e)},yesText:this.i18n("yes"),noText:this.i18n("no"),context:this})},getSelectedNodeIPs:function(){return this.subViewHelper.get(this.ROLLING_REBOOT_VIEW).getSelectedNodeIPs()},startHostReboot:function(){var e=this,t=new i,n=this.getSelectedNodeIPs();_.isEmpty(n)||(this.disableButton("btnReboot"),t.setRPCParams(n),t.fetch({success:function(t){var n=e.subViewHelper.get(e.ROLLING_REBOOT_VIEW);n.currentRebootTaskUUID=t.getReturnResponse(),n.renderTaskProgress()},error:function(t,n){a.log("HostRebootPopupView: Error on host reboot operation: ","error:",n),e.showHeaderError(n),e.enableButton("btnReboot")}}))},onClickLinkAction:function(e){$(e.currentTarget).hasClass("btnReboot")&&!_.isEmpty(this.getSelectedNodeIPs())&&this.confirmDialog({msg:this.i18n("confirm_reboot")})}})}),define("models/genesis/VCenterCredentialModel",["models/genesis/GenesisBaseModel","utils/AppConstants"],function(e,t){"use strict";return e.extend({name:"VCenterCredentialModel",methodName:t.CLUSTER_MANAGER_METHODS.SET_VCENTER_CREDENTIAL,managerName:t.GENESIS.CLUSTER_MANAGER,initialize:function(t){e.prototype.initialize.apply(this,arguments),t&&t.method&&(this.methodName=t.method)},getReturnResponse:function(){return this.get(e.DP.GENESIS_RETURN)[1]||[]},getErrorResponse:function(){var t=this.get(e.DP.GENESIS_ERROR);if(_.isUndefined(t)){var n=this.get(e.DP.GENESIS_RETURN);!1===n[0]&&(t=n[1])}return t},setRPCParams:function(e){this.methodName===t.CLUSTER_MANAGER_METHODS.GET_VCENTER_CREDENTIAL?_.extend(this.kwargs,{mgmt_server:e.mgmtServer}):_.extend(this.kwargs,{mgmt_info:{host_type:e.hostType,server_ip:e.serverIp,server_username:e.username,server_passwd:e.password}})}})}),define("text!templates/popups/vcenter/VCenterView.html",[],function(){return'<div id="vCenterCredential" class="n-version-row vcenter-credential">\n  <h5 data-ntnx-title>\n    <%= i18ns(\'vcenter_authentication\') %>\n  </h5>\n  <section data-ntnx-section>\n    <div class="btnAddVCenter" style="display: none;">\n      <button class="add-vcenter btn">\n        <i data-icon="H" aria-hidden="true" class="-smalll"></i>\n          <span class="btn-content"><%= i18ns(\'add_vcenter\') %></span>\n      </button>\n      <a class="delete-all-entries"><%= i18ns(\'delete_all_entries\') %></a>\n    </div>\n    <table id="vCenterCredentialList" class="table">\n      <tbody>\n      </tbody>\n    </table>\n  </section>\n</div>\n'}),define("text!templates/popups/vcenter/VCenterListView.html",[],function(){return'<thead>\n  <tr>\n    <th><%= i18ns(\'vcenter_ip_address\') %></th>\n    <th class="host-ips-header"><%= i18ns(\'host_ip_address\') %></th>\n  </tr>\n</thead>\n<tbody>\n  <% _.each(credentials, function(hostIps, serverIp) { %>\n  <tr class="n-table-row">\n    <td  class="name-cell" title="<%= serverIp %>">\n      <%= serverIp %>\n    </td>\n    <td  class="name-cell host-ips-cell" title="<%= hostIps.join(\', \') %>">\n      <%= hostIps.join(\', \') %>\n    </td>\n  </tr>\n  <% }); %>\n</tbody>'}),define("text!templates/popups/vcenter/VCenterFormView.html",[],function(){return'<div id="formVCenterCredential" class="form-vcenter-credential">\n  <div class="n-modal-content-wrapper">\n    <div class="n-modal-content add-vcenter-form">\n      \x3c!-- Content goes here --\x3e\n      <form class="form-horizontal">\n        <div class="control-group">\n          <label for="vCenterIpAddress" class="control-label"><%= i18ns(\'vcenter_ip_address\') %></label>\n          <div>\n            <input type="text" class="form-control host-ip" id="vCenterIpAddress">\n          </div>\n        </div>\n        <div class="control-group -half">\n          <div class="control-group">\n            <label for="username" class="control-label"><%= i18ns(\'username\') %></label>\n            <div>\n              <input type="text" class="form-control username" id="username">\n            </div>\n          </div>\n        </div>\n        <div class="control-group -half">\n          <div class="control-group">\n            <label for="password" class="control-label"><%= i18ns(\'password\') %></label>\n            <div>\n              <input type="password" class="form-control password" id="password">\n            </div>\n          </div>\n        </div>\n      </form>\n    </div>\n  </div>\n</div>'}),define("text!templates/popups/vcenter/VCenterEmptyView.html",[],function(){return"<tr>\n  <td class=\"n-message\">\n    <p class=\"message\">\n      <span>\n        <%= i18ns('havent_authenticated') %>\n      </span>\n    </p>\n    <p class=\"actions\">\n      <%= Components.button({\n        isPrimary: true,\n        extraClasses: 'add-vcenter',\n        text: i18n('add_vcenter'),\n        iconLeft: 'plus',\n      }) %>\n    </p>\n  </td>\n</tr>\n"}),define("views/popups/vcenter/VCenterCredentialView",["views/basecomponents/popups/BasePopupSubView","managers/ClusterManager","utils/AppUtil","utils/AppConstants","utils/HypervisorUtil","models/genesis/VCenterCredentialModel","text!templates/popups/vcenter/VCenterView.html","text!templates/popups/vcenter/VCenterListView.html","text!templates/popups/vcenter/VCenterFormView.html","text!templates/popups/vcenter/VCenterEmptyView.html"],function(e,t,n,i,s,a,o,r,l,c){"use strict";var d=_.template('<section data-ntnx-section><div class="n-vcenter-content n-bottom-line"></div></section>'),p=_.template(o),u=_.template(l),h=_.template(r),m=_.template(c),f=_.template('<tr><td class="n-message loadingSpinner"></td></tr>'),v={CREDENTIALS:"creds",ESX:"esx"};return e.extend({name:"VCenterCredentialView",events:{"click  .add-vcenter":"showVCenterCredentialsForm","click  .delete-all-entries":"onDelete"},showVCenter:!0,initialize:function(t){this.parentView=t.parentView,e.prototype.initialize.apply(this,arguments),n.debug("VCenterCredentialView : initialize: "," | viewid     : ",this.cid),this.vCenterCredentialAddModel=new a({method:i.CLUSTER_MANAGER_METHODS.SET_VCENTER_CREDENTIAL}),this.vCenterCredentialDeleteModel=new a({method:i.CLUSTER_MANAGER_METHODS.DELETE_VCENTER_CREDENTIAL}),this.vCenterCredentialListModel=new a({method:i.CLUSTER_MANAGER_METHODS.GET_VCENTER_CREDENTIAL})},render:function(){n.debug("VCenterCredentialView : render: "," | viewid     : ",this.cid),this.$(".vcenter-credential-view").html(d(this.vtOptions())),this.showVCenter&&(this.displayVCenter(),this.getVCenterCredentials()),this.triggerAction(i.MODAL.ACT.AS_REBUILD)},canShowVCenter:function(){return!!this.showVCenter&&s.hasESX(t.getCurrentClusterId())},onBack:function(){this.$(".vcenter-credential").show(),this.$(".form-vcenter-credential").hide()},onAdd:function(){var e=this,t=this.$(".username").val().trim(),n=this.$(".password").val(),i=this.$(".host-ip").val().trim();this.vCenterCredentialAddModel.setRPCParams({hostType:v.ESX,serverIp:i,username:t,password:n}),this.vCenterCredentialAddModel.fetch({success:function(){e.getVCenterCredentials(),e.parentView.onBack()},error:_.bind(this.showVCenterError,this)})},showVCenterError:function(e,t){t&&this.triggerAction(i.MODAL.ACT.ALERT_SHOW,{type:i.MODAL.ALERT.TYPE_ERROR,message:t})},onDelete:function(e){$.nutanixConfirm({msg:this.i18ns("clear_vcenter_credentials"),yes:_.bind(this.onDeleteNow,this),yesText:this.i18n("clear_entries"),noText:this.i18n("cancel"),context:this})},onDeleteNow:function(){var e=this;this.vCenterLoading(),this.vCenterCredentialDeleteModel.setRPCParams({hostType:v.ESX}),this.vCenterCredentialDeleteModel.fetch({success:function(t){e.getVCenterCredentials()},error:_.bind(this.showVCenterError,this)})},getVCenterCredentials:function(){var e=this;this.vCenterLoading(),this.vCenterCredentialListModel.on("change",function(t){e.displayVCenterList(t)}),this.vCenterCredentialListModel.setRPCParams({mgmtServer:v.ESX}),this.vCenterCredentialListModel.fetch({error:_.bind(this.showVCenterError,this)})},vCenterLoading:function(){this.resetVCenterTable(),this.$("#vCenterCredentialList tbody").html(f(this.vtOptions({}))),n.addInLineDonutLoader("#vCenterCredentialList tbody .loadingSpinner")},resetVCenterTable:function(){this.$("#vCenterCredentialList tbody").empty(),this.$("#vCenterCredentialList thead").empty()},showVCenterCredentialsForm:function(){this.$(".vcenter-credential").hide(),this.triggerAction(i.MODAL.ACT.SUBVIEW_SHOW,".form-vcenter-credential","left"),this.$(".form-vcenter-credential").val(""),this.triggerAction(i.MODAL.ACT.AS_REBUILD)},displayVCenterList:function(e){var t={},n=e.getReturnResponse();_.each(n,function(e,n){t[e]?t[e].push(n):t[e]=[n]}),_.isEmpty(n)?this.displayEmptyVCenter():(this.$("#vCenterCredentialList").html(h(this.vtOptions({credentials:t}))),this.$("#vCenterCredentialList table").addClass("table-hover"),this.toggleAddVCenter(!0))},displayVCenter:function(){this.$(".n-vcenter-content").html(p(this.vtOptions({}))),this.$(".n-vcenter-content").append(u(this.vtOptions({}))),this.$(".form-vcenter-credential").hide()},displayEmptyVCenter:function(){this.resetVCenterTable(),this.toggleAddVCenter(!1),this.$("#vCenterCredentialList tbody").html(m(this.vtOptions({})))},toggleAddVCenter:function(e){this.$(".btnAddVCenter").toggle(e)}})}),define("models/genesis/ConfigureCVMModel",["models/genesis/GenesisBaseModel","utils/AppConstants"],function(e,t){"use strict";return e.extend({name:"ConfigureCVMModel",methodName:t.CLUSTER_MANAGER_METHODS.RECONFIG_CVM,managerName:t.GENESIS.CLUSTER_MANAGER,initialize:function(t){e.prototype.initialize.apply(this,arguments),t&&t.method&&(this.methodName=t.method)},getErrorResponse:function(){return this.getParsedErrorResponse(this.i18n("modelError"))},getReturnResponse:function(){return this.get(e.DP.GENESIS_RETURN)||[]},setRPCParams:function(e){_.extend(this.kwargs,{cvm_reconfig_json:e})}})}),define("text!templates/popups/cvmconfig/ConfigureCVMView.html",[],function(){return'<section class="n-cvm-config">\n  <div class="vcenter-credential-view">\n    \x3c!-- vCenter Credentials --\x3e\n  </div>\n  <div class="n-cvm-config-view">\n    <section data-ntnx-section>\n      <h5 data-ntnx-title class="n-cvm-config-title">\n        <%= i18n("memorySize") %>\n      </h5>\n    </section>\n    <section data-ntnx-section>\n      <label data-ntnx-label class="n-selection">\n        <%= i18n("targetCVMmemoryAllocation") %>\n        <span class="memory-upgrade-info n-info-icon" ntnxTooltip="cvm-info">\n            <%= Components.icon("question-tooltip", "-inline") %>\n        </span>\n      </label>\n      <div class="target-memory-container"></div>\n    </section>\n    <section id="hostsOnCluster" class="hosts-table" data-ntnx-section>\n      <p data-ntnx-title>\n        <%= i18n("details") %>\n      </p>\n      <table class="table table-hover">\n        <thead>\n          <tr>\n            <th class="cell-node"><%= i18n("node") %></th>\n            <th class="cell-ip"><%= i18n("ipAddress") %></th>\n            <th class="cell-type"><%= i18n("type") %></th>\n            <th class="cell-memory"><%= i18n("CVMMemory") %></th>\n          </tr>\n        </thead>\n        <tbody class="node-info-table">\n        \x3c!-- Rows of individual nodes will be appended here from template--\x3e\n        </tbody>\n      </table>\n    </section>\n  </div>\n</section>\n<section data-ntnx-section class="not-allowed"></section>'}),define("text!templates/popups/cvmconfig/ConfigureCVMTableRowTemplate.html",[],function(){return"<tr class='n-table-row'>\n  <td class='cell-node-name'>\n    <%= nodeInfo.name %>\n  </td>\n  <td class='cell-node-ip'>\n    <%= nodeInfo.ipAddress %>\n  </td>\n  <td class='cell-node-type'>\n    <%= nodeInfo.blockModelName %>\n  </td>\n  <td class='cell-node-memory<%= nodeInfo.changed?\" changed\":\"\" %>'>\n    <%= nodeInfo.cvmMemory %>\n    <% if(nodeInfo.tooltip) { %>\n    <span class=\"cvm-memory-info n-info-icon\" ntnxTooltip=\"<%= nodeInfo.name %>\"\n      memory=\"<%= nodeInfo.cvmMemory %>\">\n      <%= Components.icon('question-tooltip', '-inline -gray') %>\n    </span>\n    <% } %>\n  </td>\n</tr>"}),define("views/popups/cvmconfig/ConfigureCVMView",["managers/TaskManager","components/Components","views/basecomponents/popups/BasePopupSubView","views/popups/vcenter/VCenterCredentialView","utils/AppConstants","utils/AppUtil","utils/SubViewHelper","utils/HypervisorUtil","utils/VMUtil","utils/ManagerMixin","data/DataProperties","models/genesis/ConfigureCVMModel","text!templates/popups/cvmconfig/ConfigureCVMView.html","text!templates/popups/cvmconfig/ConfigureCVMTableRowTemplate.html"],function(e,t,n,i,s,a,o,r,l,c,d,p,u,h){"use strict";var m=_.template(u);return n.extend({viewOption:null,subViewHelper:null,name:"ConfigureCVMView",events:{"change .target-memory-value":"onChangeMemorySelection","click  .add-vcenter":"onShowVCenterForm"},viewEvents:{LEAVE_VIEW:"leaveView"},selectedMemoryValue:null,cvmMap:{},viewEnabled:null,initialize:function(t){n.prototype.initialize.apply(this,arguments),a.debug("ConfigureCVMView : initialize: "," | viewid     : ",this.cid),e.registerHandlerForChangedTasks(this.checkSoftwareUpgradeStatus.bind(this)),this.el=t.el,this.subViewHelper=new o,this.viewEnabled=!0,this.configureCVMMap=new p({method:s.CLUSTER_MANAGER_METHODS.RECONFIG_CVM_MAP}),this.selectionTargets=new p({method:s.CLUSTER_MANAGER_METHODS.RECONFIG_CVM_TARGET}),this.configureCVMStatusModel=new p({method:s.CLUSTER_MANAGER_METHODS.RECONFIG_CVM_STATUS})},render:function(){var t=this;a.debug("ConfigureCVMView : render: "," | viewid     : ",this.cid),this.checkSoftwareUpgradeStatus(),this.$(".n-node-selection-container").hide();var n=[];n.push(this.configureCVMStatusModel.fetch({success:function(e,n){e.getReturnResponse()[0]?t.triggerAction(s.MODAL.ACT.AS_REBUILD):(t.triggerAction(s.MODAL.ACT.ALERT_SHOW,{type:s.MODAL.ALERT.TYPE_INFO,message:t.i18n("memoryUpgradeAlert")}),setTimeout(function(){t.triggerAction(s.MODAL.ACT.AS_REBUILD)},300))},error:function(e,n){var i=n;a.log("ConfigureCVMPopupView: Error on cvm config status: ","error:",i),t.triggerAction(s.MODAL.ACT.ALERT_SHOW,{type:s.MODAL.ALERT.TYPE_ERROR,message:i}),t.viewEnabled=!1,setTimeout(function(){t.triggerAction(s.MODAL.ACT.AS_REBUILD)},300)}})),n.push(this.configureCVMMap.fetch({success:function(e,n){t.configureCVMMap=e.getReturnResponse()},error:function(e,n){var i=n;a.log("ConfigureCVMPopupView: Error on cvm config map: ","error:",i),t.viewEnabled=!1,t.triggerAction(s.MODAL.ACT.ALERT_SHOW,{type:s.MODAL.ALERT.TYPE_ERROR,message:i}),setTimeout(function(){t.triggerAction(s.MODAL.ACT.AS_REBUILD)},300)}})),n.push(this.selectionTargets.fetch({success:function(e,n){t.selectionTargets=e.getReturnResponse()},error:function(e,n){var i=n;a.log("ConfigureCVMPopupView: Error on cvm config: ","error:",i),t.triggerAction(s.MODAL.ACT.ALERT_SHOW,{type:s.MODAL.ALERT.TYPE_ERROR,message:i}),t.viewEnabled=!1,setTimeout(function(){t.triggerAction(s.MODAL.ACT.AS_REBUILD)},300)}})),$.when.apply($,n).done(function(){t.viewEnabled&&(t.$el.html(m(t.vtOptions())),t.renderViewData(),r.hasESX()&&t.renderAuthentication(),t.renderMemoryTargetSelection())}),e.fetchOnDemand({force:!0})},renderAuthentication:function(){var e={el:this.el,parentView:this};this.vCenterCredentialView=new i(e),this.vCenterCredentialView.render(),this.triggerAction(s.MODAL.ACT.AS_REBUILD)},onShowVCenterForm:function(){this.$(".n-cvm-config-view").hide(),this.parentView.showButton("btnApply",!1),this.parentView.showButton("btnCancel",!1),this.parentView.showButton("btnAdd",!0),this.parentView.showButton("btnBack",!0)},onHideVCenterForm:function(){this.$(".n-cvm-config-view").show(),this.parentView.showButton("btnApply",!0),this.parentView.showButton("btnCancel",!0),this.parentView.showButton("btnAdd",!1),this.parentView.showButton("btnBack",!1)},onBack:function(){this.renderViewData(),this.onHideVCenterForm(),r.hasESX()&&this.vCenterCredentialView.onBack(),this.triggerAction(s.MODAL.ACT.AS_REBUILD)},onAdd:function(){this.vCenterCredentialView.onAdd()},checkSoftwareUpgradeStatus:function(){var t=this.parentView,n=e.getGlobalTasks().getActiveUpgradeTaskModel(),i=!1;if(t.checkTaskStatus(),n){var a=n.get(d.TASK_TYPE),o=s.TASK_OPERATION_TYPES[s.UPGRADE_SOFTWARE_TYPE.NOS],r=s.TASK_OPERATION_TYPES[s.UPGRADE_SOFTWARE_TYPE.HYPERVISOR];a!==o&&a!==r||(a===o?this.$(".not-allowed").html(this.i18n("nosUpgradingMsg")):this.$(".not-allowed").html(this.i18n("hypervisorUpgradingMsg")),i=!0)}i||t.checkTaskStatus()?(i&&(this.$(".n-cvm-config").hide(),this.$(".not-allowed").show()),this.parentView.disableButton("btnApply")):(this.$(".n-cvm-config").show(),this.$(".not-allowed").hide(),this.parentView.enableButton("btnApply")),this.triggerAction(s.MODAL.ACT.AS_REBUILD)},destroy:function(){this.clearBaseHeader(),this.off(),$("span[ntnxTooltip]").tooltip("destroy"),e.unregisterHandlerForChangedTasks(this.updateProgressCallback),n.prototype.destroy.apply(this,arguments)},getToolTipMessage:function(e){if(e.hasClass("cvm-memory-info"))return this.i18ns("memoryWillRemain",e.attr("memory"));if(e.hasClass("memory-upgrade-info")){var t=e.attr("cvmsOmitted");return t>1?this.i18ns("cvmsMemoryHigh",t):this.i18ns("cvmMemoryHigh",t)}},renderViewData:function(){var e=this,n={},i=this.$(".node-info-table"),a="",o=0;_.each(this.configureCVMMap,function(i,s){i&&i.node_model&&(n.name=i.name,n.blockModelName=i.node_model,n.ipAddress=s,n.cvmMemory=i.memory,n.changed=!1,n.tooltip=!1,
e.selectedMemoryValue&&(e.selectedMemoryValue>n.cvmMemory?(n.cvmMemory=e.selectedMemoryValue,n.changed=!0):(n.tooltip=!0,o++)),a+=_.template(h,{nodeInfo:n,Components:t}))}),this.selectedMemoryValue&&o>0?(this.$(".memory-upgrade-info").attr("cvmsOmitted",o),this.$(".memory-upgrade-info").show()):this.$(".memory-upgrade-info").hide(),i.html(a),this.$(".n-node-selection-container").show();var r=$("span[ntnxTooltip]");_.each(r,function(t){var n=$(t),i=e.getToolTipMessage(n);n.tooltip("destroy"),n.tooltip({title:i,placement:"right",trigger:"hover",html:!0,container:$("#globalModalContainer")})}),this.triggerAction(s.MODAL.ACT.AS_REBUILD)},renderMemoryTargetSelection:function(){var e=[],n=this.$(".target-memory-container");_.each(this.selectionTargets,function(t){e.push({name:t+" GB",value:t})});var i=t.select({jsClasses:"target-memory-value full-width",options:e});n.html(i),this.triggerAction(s.MODAL.ACT.AS_REBUILD)},getTargetMemoryAllocation:function(){return $(".target-memory-value").val()},saveViewData:function(e,t){this.onSubmit(e)},onSubmit:function(e){var t=this;this.confirmMemoryUpgrade(function(){t.parentView.disableButton("btnApply"),t.triggerAction(s.MODAL.ACT.ALERT_SHOW,{type:s.MODAL.ALERT.TYPE_SAVING}),t._submit(e)})},confirmMemoryUpgrade:function(e){var t=this,n=this.i18n("upgrade_confirm_msg"),i=function(){c.getClusterManager().isOneNodeCluster()?t._checkVMPowerState(e):e()};$.nutanixConfirm({msg:n,yes:i,yesText:"Yes",noText:"No",context:this})},_checkVMPowerState:function(e){var t=this;l.getRunningUVMs(function(n){var i=n.length;if(!i)return void e();t._promptPowerOffUvms(i)})},_promptPowerOffUvms:function(e){var t=this,n=l.getLinkedVMPoweroffMsgTemplate({linkClass:"vmsLink",count:e}),i=$(n);i.find(".vmsLink").on("click",function(e){e.preventDefault();var n=s.PAGE_VMS,i=s.SUBPAGE_TABLE;c.getNavigationManager().navigateToPage(n,i),$("#nutanixConfirmModal .btnYes").trigger("click"),t.trigger(t.viewEvents.LEAVE_VIEW)}),$.nutanixConfirm({msg:i,hideNo:!0,class:"-left-align"})},_submit:function(e){var t=this,n=new p,i=this.getTargetMemoryAllocation(),o={target_memory_in_gb:i};n.setRPCParams(o),n.fetch({success:function(){e&&e()},error:function(e,n){var i=a.unescapeHTMLString(n);a.log("ConfigureCVMPopupView: Error on ","cvmConfiguration: ","error:",i),t.triggerAction(s.MODAL.ACT.ALERT_SHOW,{type:s.MODAL.ALERT.TYPE_ERROR,message:i}),t.parentView.enableButton("btnApply")}})},onChangeMemorySelection:function(e){this.selectedMemoryValue=parseInt(this.$(e.currentTarget).attr("value")),this.renderViewData()}})}),define("text!templates/popups/cvmconfig/ConfigureCVMProgressView.html",[],function(){return'<section data-ntnx-section class="task">\n  <% if (showMasterProgressBar) { %>\n    <section data-ntnx-section class="status">\n      <span class="pull-left title"><%= title %></span>\n      <span class="pull-right percent-complete">\n        <%= task.get(propPercentComplete) ?\n              task.get(propPercentComplete) + \' %\' : \'\' %>\n      </span>\n    </section>\n    <section data-ntnx-section class="task-progress">\n      <%= VisualizationUtil.renderProgressBar({\n        barClass: \'n-progress-bar \' + task.get(propStatus),\n        percentUsed: task.get(propPercentComplete)\n      }) %>\n    </section>\n  <% } else { %>\n    <section data-ntnx-section class="status percent-complete">\n      <h2><%= task && task.get(propPercentComplete) ?\n                task.get(propPercentComplete) + \' %\' : \'\'%></h2>\n    </section>\n  <% } %>\n  <% if (collapsible) { %>\n  <section data-ntnx-section class="expand-btn pull-right">\n    <a class="expand-trigger"><%= collapsed ? i18n(\'open\') : i18n(\'close\') %></a>\n  </section>\n  <% } %>\n  <section data-ntnx-section class="subtasks-ctr">\n    <section data-ntnx-section class="subtasks <%= collapsible && collapsed ? \'hidden\' : \'\'%>">\n      <section data-ntnx-section class="n-container-caret">\n        <section data-ntnx-section class="n-container-caret-border"></section>\n        <section data-ntnx-section class="n-container-caret-content"></section>\n      </section>\n      \x3c!-- Subtasks go in here --\x3e\n      <% _.each(subTasks, function (subTask) { %>\n        <section data-ntnx-section class="subtask">\n          <section data-ntnx-section class="subtask-msg">\n            <%= subTask[propTaskMessage] %>\n          </section>\n          <%= VisualizationUtil.renderProgressBar({\n            barClass: \'n-progress-bar \' + subTask[propStatus],\n            percentUsed: subTask[propPercentComplete],\n            rightTextLabel: subTask[propPercentComplete] ?\n              subTask[propPercentComplete] + \' %\' : \'\'\n          }) %>\n        </section>\n      <% }); %>\n    </section>\n  </section>\n</section>'}),define("views/popups/cvmconfig/ConfigureCVMProgressView",["data/DataProperties","managers/TaskManager","views/basecomponents/popups/BasePopupSubView","utils/AppConstants","utils/VisualizationUtil","utils/AppUtil","text!templates/popups/cvmconfig/ConfigureCVMProgressView.html"],function(e,t,n,i,s,a,o){"use strict";var r=_.template('<div><div id="task-progress" class="n-task-progress-view"></div></div>');return n.extend({viewOption:null,subtasksOpen:!1,name:"ConfigureCVMProgressView",events:{"click  .expand-trigger":"toggleSubTasks"},updateProgressCallback:null,initialize:function(e){var i=this;n.prototype.initialize.apply(this,arguments),this.updateProgressCallback=function(){i.renderTaskProgress()},t.registerHandlerForChangedTasks(this.updateProgressCallback)},render:function(){this.clearBaseHeader(),this.$el.html(r()),this.viewOption.refreshView&&this.$("#task-progress").html(""),t.fetchOnDemand({success:function(){this.renderTaskProgress()}.bind(this),error:function(e,t){this.showHeaderError(t),a.log("ConfigureCVMProgressView: "+t)}.bind(this)})},destroy:function(){this.clearBaseHeader(),t.unregisterHandlerForChangedTasks(this.updateProgressCallback),n.prototype.destroy.apply(this,arguments)},refreshView:function(){this.render()},setViewOption:function(e){this.viewOption=e},renderTaskProgress:function(){var n=t.getGlobalTasks().getCVMConfigTask(),a=n.get(e.SUB_TASK_MESSAGE)||this.i18n("ConfiguringCVM"),r=n?n.get(e.TASK_SUB_TASKS):[];n&&this.$("#task-progress").html(_.template(o,this.vtOptions({title:a,task:n,subTasks:r,VisualizationUtil:s,propStatus:e.TASK_STATUS,propPercentComplete:e.TASK_PERCENT_COMPLETE,propTaskMessage:e.SUB_TASK_MESSAGE,collapsible:!1,showMasterProgressBar:!0,collapsed:!this.subtasksOpen}))),this.triggerAction(i.MODAL.ACT.AS_REBUILD)},toggleSubTasks:function(e){var t=$(e.currentTarget),n=this.$(".subtasks");n.is(":visible")?(n.slideUp("fast"),t.html("open"),this.subtasksOpen=!1):(n.slideDown("fast"),t.html("close"),this.subtasksOpen=!0),this.triggerAction(i.MODAL.ACT.AS_REBUILD)}})}),define("text!templates/popups/cvmconfig/ConfigureCVMContentView.html",[],function(){return'\x3c!-- The parent div is #popupConfigureCVM --\x3e\n<div id="configure-cvm-main" data-ntnx-content-inner class="n-modal-configure-cvm-content">\n  \x3c!-- @subviews go in here --\x3e\n</div>'}),define("views/popups/cvmconfig/ConfigureCVMPopupView",["views/basecomponents/popups/BasePopupView","managers/TaskManager","views/popups/cvmconfig/ConfigureCVMView","views/popups/cvmconfig/ConfigureCVMProgressView","utils/AppConstants","utils/SubViewHelper","text!templates/popups/cvmconfig/ConfigureCVMContentView.html"],function(e,t,n,i,s,a,o){"use strict";o=_.template(o);var r=_.template('<div id="<%= id %>"></div>');return e.extend({DEFAULT_POPUP_PROP:{subViewContainerEl:".n-modal-configure-cvm-content"},CONFIGURE_CVM_VIEW:"configure-cvm-view",CONFIGURE_CVM_PROGRESS_VIEW:"configure-cvm-progress-view",name:"ConfigureCVMPopupView",subViewHelper:null,el:"#popupConfigureCVM",currentSubViewId:null,events:{"click  .btnApply":"onClickLinkAction","click  .btnAdd":"onClickLinkAction","click  .btnBack":"onClickLinkAction","click  .btnBackToProgress":"onClickLinkAction"},initialize:function(){e.prototype.initialize.apply(this,arguments),this.subViewHelper=new a,this.checkTaskStatus()},render:function(){var e=[{text:this.i18n("back"),extraClasses:"btnBack n-btn-form"},{text:this.i18n("backToProgress"),extraClasses:"btnBackToProgress n-btn-form"},{isPrimary:!0,text:this.i18n("add"),extraClasses:"btnAdd n-btn-form"},{isPrimary:!0,text:this.i18n("apply"),extraClasses:"btnApply n-btn-form",extraAttr:[{key:"data-loading-text",value:this.i18n("saving")},{key:"action",value:"showSubView"}]}];this.$el.html(this.defaultTemplate({nestedAlert:!0,title:this.i18n("configureCVM"),bodyContent:o(),antiscroll:!1,footerButtons:this.defaultFooter(e)})),this.checkTaskStatus()?this.selectSubView({subViewId:this.CONFIGURE_CVM_PROGRESS_VIEW,options:{refreshView:!0}}):this.selectSubView({subViewId:this.CONFIGURE_CVM_VIEW})},createSubView:function(e){var t=this,s=void 0,a={el:"#"+e};switch(e){case this.CONFIGURE_CVM_VIEW:s=new n(a),s.on(s.viewEvents.LEAVE_VIEW,function(){return t.hide(!0)});break;case this.CONFIGURE_CVM_PROGRESS_VIEW:s=new i(a)}return s},selectSubView:function(e){var t=void 0,n=void 0;t=this.subViewHelper.get(this.currentSubViewId),t&&this.subViewHelper.iterate("hideView"),n=e.subViewId,t=this.subViewHelper.get(n),this.currentSubViewId=n;var i=e.options||{};if(t)t.setViewOption(i);else{$(r({id:n})).appendTo(this.DEFAULT_POPUP_PROP.subViewContainerEl),t=this.createSubView(n),this.subViewHelper.register(this.currentSubViewId,t),t.setParentView(this),t.setViewOption(i),t.render()}this._showSubView(t)},_showSubView:function(e){e&&(e.refreshView(),e.showView()),this.setButtonStates(),this.triggerAction(s.MODAL.ACT.AS_REBUILD)},resetButtonStates:function(){var e=["btnCancel","btnBack","btnBackToProgress","btnApply","btnAdd"];_.each(e,function(e){this.$("."+e).removeClass(".pull-left"),this.showButton(e,!1)}.bind(this))},setButtonStates:function(){switch(this.resetButtonStates(),this.currentSubViewId){case this.CONFIGURE_CVM_PROGRESS_VIEW:this.showButton("btnBack",!0),this.showButton("btnCancel",!0),this.$(".btnCancel").addClass("pull-left");break;case this.CONFIGURE_CVM_VIEW:this.checkTaskStatus()&&this.showButton("btnBackToProgress",!0),this.showButton("btnApply",!0),this.showButton("btnCancel",!0),this.$(".btnCancel").addClass("pull-left")}},disableButton:function(e){this.$("."+e).attr("disabled","disabled")},enableButton:function(e){this.$("."+e).removeAttr("disabled")},showButton:function(e,t){this.$("."+e)[t?"show":"hide"]()},checkTaskStatus:function(){var e=t.getGlobalTasks().getCVMConfigTask();return!(!e||!e.isStatusActive()&&!e.isStatusQueued())},onClickLinkAction:function(e){var n=this,i=$(e.currentTarget);i.hasClass("btnApply")&&this.subViewHelper.get(this.CONFIGURE_CVM_VIEW).saveViewData(function(){n.triggerAction(s.MODAL.ACT.ALERT_HIDE),t.fetchOnDemand(),n.disableButton("btnApply"),n.selectSubView({subViewId:n.CONFIGURE_CVM_PROGRESS_VIEW,options:{refreshView:!0}})}),i.hasClass("btnBack")&&(this.selectSubView({subViewId:this.CONFIGURE_CVM_VIEW}),this.subViewHelper.get(this.CONFIGURE_CVM_VIEW).onBack()),i.hasClass("btnAdd")&&this.subViewHelper.get(this.CONFIGURE_CVM_VIEW).onAdd(),i.hasClass("btnBackToProgress")&&this.selectSubView({subViewId:this.CONFIGURE_CVM_PROGRESS_VIEW,options:{refreshView:!0}}),this.triggerAction(s.MODAL.ACT.AS_REBUILD)}})}),define("models/genesis/ConvertClusterValidateModel",["models/genesis/GenesisBaseModel","utils/AppConstants"],function(e,t){"use strict";return e.extend({name:"ConvertClusterValidateModel",methodName:t.CLUSTER_CONVERSION_METHODS.VALIDATE_CLUSTER_CONVERSION,managerName:t.GENESIS.CLUSTER_CONVERSION,getErrorResponse:function(){return this.getParsedErrorResponse("Error validating cluster conversion.")},getReturnResponse:function(){return this.get(e.DP.GENESIS_RETURN)||[]},setRPCParams:function(e,t){_.extend(this.kwargs,{target_hypervisor:e}),_.isEmpty(t)||_.extend(this.kwargs,{vcenter_details:t})}})}),define("models/genesis/ConvertClusterModel",["models/genesis/GenesisBaseModel","utils/AppConstants"],function(e,t){"use strict";return e.extend({name:"ConvertClusterModel",methodName:t.CLUSTER_CONVERSION_METHODS.CONVERT_CLUSTER,managerName:t.GENESIS.CLUSTER_CONVERSION,getErrorResponse:function(){return this.getParsedErrorResponse("Failed to convert cluster.")},getReturnResponse:function(){return this.get(e.DP.GENESIS_RETURN)||[]},setRPCParams:function(e,t){_.extend(this.kwargs,{target_hypervisor:e,ignore_vm_warnings:!0,power_on_vms:t})}})}),define("models/genesis/ConvertClusterIsoRequiredModel",["models/genesis/GenesisBaseModel","utils/AppConstants"],function(e,t){"use strict";return e.extend({name:"ConvertClusterIsoRequiredModel",methodName:t.CLUSTER_CONVERSION_METHODS.IS_ISO_UPLOAD_REQUIRED,managerName:t.GENESIS.CLUSTER_CONVERSION,setRPCParams:function(e){_.extend(this.kwargs,{target_hypervisor:e})},isIsoUploadRequired:function(){return!0===this.getReturnResponse()[0]},getRequiredIsos:function(){var e=this.getReturnResponse();return!0===e[0]?e[1]:[]},getError:function(){var e=this.getReturnResponse();if(!1===e[0]&&e[1]&&e[1].length){var t=e[1][0];if("string"==typeof t)return t}}})}),define("models/genesis/GetTargetHypervisorsModel",["models/genesis/GenesisBaseModel","utils/AppConstants"],function(e,t){"use strict";return e.extend({name:"GetTargetHypervisorsModel",methodName:t.CLUSTER_CONVERSION_METHODS.TARGET_HYPERVISORS,managerName:t.GENESIS.CLUSTER_CONVERSION,getErrorResponse:function(){return this.getParsedErrorResponse("Error fetching valid hypervisor(s) for cluster conversion.")},getReturnResponse:function(){return this.get(e.DP.GENESIS_RETURN)||[]}})}),define("text!templates/popups/nodeconversion/HypervisorSelectView.html",[],function(){return'<div>\n  <div class="n-popup-description">\n    <%= i18n(\'hypSelectMsg\') %>\n  </div>\n  <div class="hypervisors-list">\n    <label class="select-label">Available Hypervisors</label>\n    <div class="hyper-list">\n      <%= Components.select({\n        options: hypervisors,\n        jsClasses: \'hypervisor-select\'\n      }) %>\n      <button class="btn -blue btn-validate" action="validate">\n        <%= i18n(\'validate\') %>\n      </button>\n    </div>\n  </div>\n  <div>\n    <label class="select-label">VM Boot Options</label>\n    <%= Components.select({\n      options: vmBootOptions,\n      jsClasses: \'vm-boot-option\',\n      variants: \'bottom-anchor\'\n    }) %>\n  </div>\n</div>\n'}),define("text!templates/popups/nodeconversion/PreRequisitesTemplate.html",[],function(){return"<ul class=\"convert-pre-reqs\">\n  <% if (hypervisorType === HYPERVISOR_TYPE.KVM) { %>\n    <li>\n      <%= i18n('ngt') %>\n    </li>\n    <li>\n      <%= i18n('vSwitch') %>\n    </li>\n    <li>\n      <%= i18n('loadBal') %>\n    </li>\n    <li>\n      <%= i18n('nicTeam') %>\n    </li>\n  <% } %>\n  <li>\n    <%= i18n('dr') %>\n  </li>\n  <li>\n    <%= i18n('ha') %>\n  </li>\n  <% if (hypervisorType === HYPERVISOR_TYPE.ESXI) { %>\n    <li>\n      <%= i18n('iso') %>\n    </li>\n  <% } %>\n</ul>"}),define("views/popups/nodeconversion/HypervisorSelectView",["views/basecomponents/BaseSubView","components/Components","utils/HypervisorUtil","utils/AppConstants","models/genesis/GetTargetHypervisorsModel","text!templates/popups/nodeconversion/HypervisorSelectView.html","text!templates/popups/nodeconversion/PreRequisitesTemplate.html"],function(e,t,n,i,s,a,o){"use strict";var r=_.template(a),l=_.template(o),c=_.template('<div class="n-loading"><div class="n-inline-loading-container"><div class="donut-loader-blue -large"></div><div><br><strong>Analyzing Configuration</strong></div></div></div>'),d=[{value:"power_on",name:"Preserve power state of user VMs"},{value:"power_off",name:"Power off user VMs"}];return e.extend({name:"HypervisorSelectView",viewOption:null,dataLoaded:!1,targetHypervisorsModel:null,events:{"change .vm-boot-option":"onChangeVmBootOption","change .hypervisor-select":"initPreReqsTooltip"},render:function(){if(this.parentView.disableButton("btn-main"),this.dataLoaded){var e="",s=this.targetHypervisorsModel.getReturnResponse(),a=[];_.each(s,function(e){a.push({value:e,name:n.getFormattedHypervisorType(e)})}),0===a.length&&(this.parentView.hide(),$.nutanixConfirm({msg:"This operation is currently not supported.",hideNo:!0,yesText:i.LABEL_CLOSE})),1===a.length&&(e=a[0].type),this.$el.html(r(this.vtOptions({Components:t,vmBootOptions:d,hypervisors:a,targetHypervisorType:e}))),this.viewOption.allowBackNav&&this.parentView.showButton("back",!0),this.applyNutanixInput(),this.initPreReqsTooltip(),this.onChangeVmBootOption()}else this.$el.html(c),this.loadData()},destroy:function(){this.clearBaseHeader(),this.$(".prereq-tooltip").tooltip("destroy"),e.prototype.destroy.apply(this,arguments)},initPreReqsTooltip:function(){var e=this.$(".hypervisor-select").val();this.$(".prereq-tooltip").tooltip("destroy").tooltip({container:"body",html:!0,placement:"right",trigger:"hover",title:l(this.vtOptions({HYPERVISOR_TYPE:i.SOFTWARE_RELEASES_HYP_TYPE,hypervisorType:e}))})},setViewOption:function(e){this.viewOption=e},loadData:function(){var e=this;this.targetHypervisorsModel=new s,this.targetHypervisorsModel.fetch({success:function(t,n){e.dataLoaded=!0,e.render()},error:function(t,n){e.dataLoaded=!0,e.showHeaderError(t.getErrorResponse()),e.render()}})},onChangeVmBootOption:function(e){this.parentView.powerOnVms=this.$(".vm-boot-option").val()===d[0].value}})}),define("models/genesis/ConvertClusterResultsModel",["models/genesis/GenesisBaseModel","utils/AppConstants"],function(e,t){"use strict";var n={VALIDATE:"validate_cluster_conversion",CONVERT:"start_cluster_conversion"};return e.extend({DP:{RESULT:"result",ERRORS:"errors",WARNINGS:"warnings"},OPERATION_RESULT:{RUNNING:2,SUCCESS:3,FAILED:6},name:"ConvertClusterResultsModel",methodName:t.CLUSTER_CONVERSION_METHODS.CONVERT_CLUSTER_RESULTS,managerName:t.GENESIS.CLUSTER_CONVERSION,getErrorResponse:function(){return this.getParsedErrorResponse("Error fetching cluster conversion results.")},getReturnResponse:function(){return this.get(e.DP.GENESIS_RETURN)||{}},setRPCParams:function(e){e=e||n.VALIDATE,_.extend(this.kwargs,{operation_type:e})},isOperationComplete:function(){var e=this.getReturnResponse();return e[this.DP.RESULT]===this.OPERATION_RESULT.SUCCESS||e[this.DP.RESULT]===this.OPERATION_RESULT.FAILED},getErrors:function(){return this.getReturnResponse()[this.DP.ERRORS]},getWarnings:function(){return this.getReturnResponse()[this.DP.WARNINGS]},getOperationStatus:function(){return this.getReturnResponse()[this.DP.RESULT]||""}},{OPERATION_TYPE:n})}),define("text!templates/popups/nodeconversion/ValidationResultsView.html",[],function(){return'<div>\n  <%= errorsAndWarnings %>\n</div>\n<% if (status) { %>\n  <div class="validation-success">\n    <%= checkIcon %>\n  </div>\n<% } %>'}),define("text!templates/popups/nodeconversion/ErrorsAndWarningsTemplate.html",[],function(){return'<div class="validation-status-msg">\n  <% if (showStatusError) { %>\n    <div class="n-warning-msg">\n  <% } %>\n  <%= statusMessage %>\n  <% if (showStatusError) { %>\n    </div>\n  <% } %>\n</div>\n\n<% if (errors.length) { %>\n  <div class="validation-errors msg-section">\n    <h5 class="n-title">Error(s)</h5>\n    <ul class="messages">\n      <% _.each(errors, function (message) { %>\n        <li class="error-msg">\n          <div class="msg-icon"><%= errorIcon %></div>\n          <div class="msg-text"><%= message %></div>\n        </li>\n      <% }) %>\n    </ul>\n  </div>\n<% } %>\n<% if (warnings.length) { %>\n  <div class="validation-warnings msg-section">\n    <h5 class="n-title">Warning(s)</h5>\n    <ul class="messages">\n      <% _.each(warnings, function (message) { %>\n        <li>\n          <div class="msg-icon"><%= warningIcon %></div>\n          <div class="msg-text"><%= message %></div>\n        </li>\n      <% }) %>\n    </ul>\n  </div>\n<% } %>'}),define("views/popups/nodeconversion/ValidationResultsView",["utils/SVG","utils/AppConstants","views/basecomponents/BaseSubView","models/genesis/ConvertClusterResultsModel","managers/TaskManager","text!templates/popups/nodeconversion/ValidationResultsView.html","text!templates/popups/nodeconversion/ErrorsAndWarningsTemplate.html"],function(e,t,n,i,s,a,o){"use strict";var r=_.template(a),l=_.template(o);return n.extend({VALIDATING_MSG:"Validating...",viewOption:null,resultsModel:null,updateProgressCallback:null,initialize:function(){this.resultsModel=new i,n.prototype.initialize.apply(this,arguments)},render:function(){this.clearBaseHeader(),this.showProgressView(),this.updateProgressCallback=this.showProgressView.bind(this),this.showProgressView(),s.registerHandlerForChangedTasks(this.updateProgressCallback),s.fetchOnDemand({force:!0})},fetchAndRenderResults:function(){var e=this;this.resultsModel.setRPCParams(),this.resultsModel.fetch({success:function(){e.renderResults()},error:function(){e.parentView.showHeaderError(e.resultsModel.getErrorResponse())}})},renderResults:function(){if(this.resultsModel.isOperationComplete()){var t=this.resultsModel.getErrors(),n=this.resultsModel.getWarnings();t&&t.length?this.parentView.disableButton("btn-main"):(this.parentView.enableButton("btn-main"),this.parentView.showButton("main",!0));var i="";t&&t.length||n&&n.length?i+="Validation completed. The following error(s)/warning(s) were encountered. Please resolve them before proceeding.":i="Validation was successful. Please click on Convert to proceed.",this.$el.html(r({errorsAndWarnings:l({showStatusError:!1,statusMessage:i,errors:t,warnings:n,errorIcon:e.SVGIcon("x-square","error-icon",""),warningIcon:e.SVGIcon("Exclamation_Mark","warning-icon","")}),status:!(t&&t.length||n&&n.length),checkIcon:e.SVGIcon("G","check-icon success-icon","")}))}},showProgressView:function(){var e=s.getGlobalTasks(),n=e.getTaskForOperation(t.TASK_OPERATION_CLUSTER_CONVERT_VALIDATE),i=0;n&&(n.isStatusActive()||n.isStatusQueued()?i=n.getPercentage():(s.unregisterHandlerForChangedTasks(this.updateProgressCallback),this.fetchAndRenderResults())),this.$el.html(this.parentView.progressTemplate({message:this.VALIDATING_MSG,percentProgress:i}))},destroy:function(){this.clearBaseHeader(),this.updateProgressCallback&&s.unregisterHandlerForChangedTasks(this.updateProgressCallback),n.prototype.destroy.apply(this,arguments)},refreshView:function(){this.render()},setViewOption:function(e){this.viewOption=e}})}),define("models/genesis/HypervisorUpgradeModel",["models/genesis/GenesisBaseModel","utils/AppConstants"],function(e,t){"use strict";return e.extend({name:"HypervisorUpgradeModel",methodName:t.CLUSTER_MANAGER_METHODS.CLUSTER_HYPERVISOR_UPGRADE,managerName:t.GENESIS.CLUSTER_MANAGER,setRPCParams:function(e){void 0===e.isManualUpgrade&&(e.isManualUpgrade=!1),void 0===e.isIgnorePreupgradeTests&&(e.isIgnorePreupgradeTests=!1),void 0===e.isIgnoreUpgrade&&(e.isIgnoreUpgrade=!1),_.extend(this.kwargs,{version:e.versionId,manual_upgrade:e.isManualUpgrade,ignore_preupgrade_tests:e.isIgnorePreupgradeTests,skip_upgrade:e.isIgnoreUpgrade}),void 0!==e.username&&_.extend(this.kwargs,{username:e.username}),void 0!==e.password&&_.extend(this.kwargs,{password:e.password}),void 0!==e.hostDetails&&_.extend(this.kwargs,{host_ip:e.hostDetails}),void 0!==e.domainUsername&&_.extend(this.kwargs,{domain_username:e.domainUsername}),void 0!==e.domainPassword&&_.extend(this.kwargs,{domain_password:e.domainPassword}),void 0!==e.hypervSku&&_.extend(this.kwargs,{hyperv_sku:e.hypervSku}),void 0!==e.md5sum&&_.extend(this.kwargs,{md5sum:e.md5sum})},getErrorResponse:function(){var t=e.prototype.getErrorResponse.apply(this,arguments);return t||(!1===this.getReturnResponse()?"Unable to find hypervisor upgrade info":void 0)}})}),define("models/softwareupgrade/HypervisorSoftwareUpgradeModel",["models/softwareupgrade/SoftwareUpgradeModel","models/hardware/HostCollection","models/genesis/HypervisorUpgradeModel","data/DataProperties","utils/AppConstants","utils/AppUtil"],function(e,t,n,i,s,a){"use strict";return e.extend({name:"HypervisorSoftwareUpgradeModel",uploadWithMD5:!1,softwareTypeState:s.UPGRADE_SOFTWARE_TYPE_STATE.HYPERVISOR,isValidateMetadataBeforeUpload:!0,createVersionModelInstance:function(){return new t},getSoftwareType:function(e){return s.UPGRADE_SOFTWARE_TYPE.HYPERVISOR},getSoftwareCurrentVersion:function(){var e=this.get(i.UPGRADE_VERSION_MODEL);if(e){var t;return t=e.getHypervisorVersions(!0),t&&t.length?t:null}},_onResetSubModel:function(t){e.prototype._onResetSubModel.apply(this,arguments),"HostCollection"===t.name&&this.setProperty(i.UPGRADE_VERSION_MODEL,t)},uploadSoftwareReleaseWithMD5:function(e){var t=this.validateUploadFormWithMD5(e,!0);if($.trim(t).length)return this.trigger("error",t),void this.setProperty(i.UPGRADE_STATE_UPLOAD,this.STATE_UPLOAD_READY);a.log("SoftwareUpgradeModel : Start uploading the files...\n MD5 SUM: "+e.find(".inputMD5").val()+"\n "+this.softwareTypeState+" File: "+e.find(".inputFile").val()),this.setProperty(i.UPGRADE_STATE_UPLOAD,this.STATE_UPLOAD_INPROGRESS),this.uploadNutanixBinaryFileWithMD5(e)},validateUploadFormWithMD5:function(e){var t="",n=$.trim(e.find(".inputMD5").val());return 0===n.length?t+="Please input the MD5 sum of the binary file. ":n.match(/^[a-f0-9]{32}$/)||(t+="Please input valid MD5 sum of the binary file. "),0===$.trim(e.find(".inputFile").val()).length&&(t+="Please select the "+this.softwareTypeState+" binary file. "),t},_getUploadParams:function(e,t,n,i){var a;return this.uploadWithMD5?(this.uploadWithMD5=!1,a={fileSize:e,md5Sum:t,overwrite:n,fileName:i,hypervisorType:s.SOFTWARE_RELEASES_HYP_TYPE.ESXI}):a={fileSize:e,md5Sum:t,overwrite:n,fileName:i},a},uploadNutanixBinaryFileWithMD5:function(e){if("undefined"==typeof File)return a.log("SoftwareUpgradeModel : Upload NOS binary file via legacy browser."),this.trigger("error","Upload is currently supported only on IE0+, Chrome and Firefox."),void this.setProperty(i.UPGRADE_STATE_UPLOAD,this.STATE_UPLOAD_FAILED);a.log("SoftwareUpgradeModel : Upload NOS binary file via HTML5 browser.");var t,n,s,o=e.find(".inputFile")[0],r=o.files[0];t=r.size,n=r.name,s=e.find(".inputMD5").val(),this.uploadWithMD5=!0,this._startUploadFile(t,s,void 0,n,void 0,void 0,r)},startUpgrade:function(e){var t=this;a.log("HypervisorSoftwareUpgradeModel: Start upgrade  | Version ID: "+e.versionId+" | isManualUpgrade: "+e.isManualUpgrade+" | isIgnorePreupgradeTests: "+e.isIgnorePreupgradeTests),this.set({versionIdToUpgrade:e.versionId,isManualUpgrade:e.isManualUpgrade,isIgnorePreupgrade:e.isIgnorePreupgradeTests,isIgnoreUpgrade:e.isIgnoreUpgrade},{silent:!0});var s=new n;s.setRPCParams(e),s.save({success:function(n,s){a.log("HypervisorSoftwareUpgradeModel : Successfully started upgrade"),e.successCallback&&e.successCallback(),t.stopStateChange=!0,t.setProperty(i.UPGRADE_SOFTWARE_UPGRADING,t.getSoftwareType()),t.setProperty(i.UPGRADE_STATE,t.STATE_UPGRADING),t.fetchUpgradeState()},error:function(n,i){a.log("HypervisorSoftwareUpgradeModel : Error : "+i),e.errorCallback&&e.errorCallback(),t.trigger("error",i)}})},retryUpgrade:function(e,t,n){var s=this.getPreupgradeTaskModel();if(s&&s.isStatusFailed()){var o=this.get(i.UPGRADE_VERSION_ID);if(o){var r=this.get(i.UPGRADE_IGNORE_PREUPGRADE),l=this.get(i.UPGRADE_IGNORE_UPGRADE),c=this.get(i.UPGRADE_MANUAL_UPGRADE);this.startUpgrade({versionId:o,isManualUpgrade:c,ignorePreupgrade:r,ignoreUpgrade:l,username:e,password:t,hostDetails:n})}else a.log("HypervisorSoftwareUpgradeModel: Version ID is not found.")}else a.log("HypervisorSoftwareUpgradeModel : You can only retry upgrade if it is in preupgrade check mode that is in failed state.")},isActiveProgressMyType:function(){var e=this.localTaskManager.getGlobalTasks().getUpgradeTasks(),t=_.find(e,function(e){return e.isStatusActive()||e.isStatusQueued()});return t&&t.get(i.TASK_TYPE)===s.TASK_OPERATION_TYPES.hypervisor}})}),define("models/genesis/SoftwareValidationModel",["models/genesis/GenesisBaseModel","utils/AppConstants"],function(e,t){"use strict";return e.extend({DEFAULT_ERROR_MSG:"Failed to validate software.",name:"ConvertClusterIsoRequiredModel",methodName:t.CLUSTER_CONVERSION_METHODS.ISO_VALID_FOR_CONVERSION,managerName:t.GENESIS.CLUSTER_CONVERSION,getErrorResponse:function(){return this.getParsedErrorResponse(this.DEFAULT_ERROR_MSG)},setRPCParams:function(e,t){_.extend(this.kwargs,{md5sum:e,hypervisor_type:t})},isValidSoftware:function(){return this.getReturnResponse()[0]}})}),define("text!templates/popups/nodeconversion/ISOUploadView.html",[],function(){return'<div>\n  <h4 class="n-desc-title">Software Upload</h4>\n  <div class="n-description">\n    <%= hypervisorNames.length %> hypervisor image(s) are required for\n    conversion. Please upload the correct software to proceed.\n  </div>\n  <% _.each(hypervisorNames, function (friendlyName) { %>\n    <div class="n-upload-form-container">\n      <form class="form-horizontal form-iso-upload"\n            data-name="<%- friendlyName %>">\n        <div class="n-upload-success" style="display:none">\n          <span><%= checkIcon %></span>\n          <span class="n-upload-msg"></span>\n        </div>\n        <div class="n-upload-progress" style="display:none">\n          <div class="upload-progress-bar">\n            \x3c!-- Upload progress is shown here --\x3e\n          </div>\n          <div class="cancel-btn" title="Cancel Upload">\n            <%= cancelIcon %>\n          </div>\n        </div>\n        <div class="control-group">\n          <label class="control-label">\n            <%- friendlyName %> Binary File\n          </label>\n          <div class="controls">\n            <input type="file" name="file" class="input-iso"\n                   data-name="<%- friendlyName %>">\n          </div>\n        </div>\n      </form>\n    </div>\n  <% }) %>\n</div>'}),define("views/popups/nodeconversion/ISOUploadView",["data/DataProperties","data/DataManager","managers/IdleManager","views/basecomponents/BaseSubView","utils/AppConstants","utils/AppUtil","utils/SVG","utils/VisualizationUtil","data/DataURLConstants","models/softwareupgrade/HypervisorSoftwareUpgradeModel","models/genesis/SoftwareValidationModel","text!templates/popups/nodeconversion/ISOUploadView.html"],function(e,t,n,i,s,a,o,r,l,c,d,p){"use strict";var u=_.template(p),h=_.template("Successfully uploaded file <%- fileName %>"),m=c.extend({getSoftwareType:function(){return s.UPGRADE_SOFTWARE_TYPE_CONVERT_CLUSTER.HYPERVISOR_INSTALLER},getSoftwareRelease:function(t){var n=this.get(e.UPGRADE_SOFTWARE_RELEASES);return n?n.find(function(n){return n.get(e.UPGRADE_MD5SUM)===t}):null}});return i.extend({viewOption:null,jqXhrMap:null,softwareReleaseIdMap:null,softwareValidationModel:null,dataLoaded:!1,softwareUploadMap:null,events:{"change .input-iso":"uploadISO","click  .input-iso":"resetInputFile","click  .cancel-btn":"cancelUpload"},modelEvents:{"change.softwareReleases    model":"renderUploadProgress"},initialize:function(){i.prototype.initialize.apply(this,arguments),this.model=new m,this.softwareValidationModel=new d,this.softwareReleaseIdMap={},this.jqXhrMap={},this.delegateModelEvents()},render:function(){var e=this;if(this.dataLoaded){this.clearBaseHeader(),this.viewOption.incompatibleUpload&&this.showHeaderError("The software you uploaded is either not valid or is incompatible for this operation to proceed. Please try again.");var t=this.parentView.getRequiredIsos();this.$el.html(u({hypervisorNames:t,checkIcon:o.SVGIcon("G","check-icon",""),cancelIcon:o.SVGIcon("K","cancel-icon","")})),this.softwareUploadMap={},_.each(t,function(e){this.softwareUploadMap[e]=!1},this),this.parentView.disableButton("btn-main")}else this.showHeaderLoading(),this.model.fetchSoftwareReleases({success:function(){e.dataLoaded=!0,e.render()},error:function(){a.log("ISOUploadView : Failed to fetch software release collection."),e.dataLoaded=!0,e.render()}})},destroy:function(){this.jqXhrMap&&_.each(this.jqXhrMap,function(e,t){e.abort(),delete this.jqXhrMap[t]}),this.clearBaseHeader(),
this.model.stopPollingSoftwareReleases({force:!0}),i.prototype.destroy.apply(this,arguments)},refreshView:function(){this.render()},setViewOption:function(e){this.viewOption=e},renderUploadSuccess:function(e,t){var n=this.$('.form-iso-upload[data-name="'+t+'"]');n.find(".n-upload-success").show(),n.find(".n-upload-progress").hide(),n.find(".n-upload-msg").html(h({fileName:e})),this.softwareUploadMap[t]=!0;_.find(this.softwareUploadMap,function(e,t){if(!e)return!0}),this.parentView.enableButton("btn-main")},renderUploadStart:function(e){this.$('.form-iso-upload[data-name="'+e+'"] .n-upload-progress ').show()},renderUploadProgress:function(t,i){if(this.dataLoaded){var a=this.$('.form-iso-upload[data-name="'+i+'"]'),o=0,l=null,c=!1,d="";if(!0===t)d="Computing MD5";else{var p=this.model.getSoftwareRelease(this.softwareReleaseIdMap[i]);p?(o=Math.round(p.get(e.UPGRADE_CURRENT_SIZE_IN_BYTES)/p.get(e.UPGRADE_CURRENT_TOTAL_IN_BYTES)*100),l=p.get(e.UPGRADE_STATUS),c=c||l===s.TASK_STATUS_FAILED||l===s.TASK_STATUS_CANCELED||l===s.TASK_STATUS_ABORTED):c=!0,d="Uploading: "+o+" %"}a.find(".upload-progress-bar").html(r.renderProgressBar({barClass:"n-progress-bar "+(c?"error":""),percentUsed:o,rightTextLabel:d})),n.reset()}},renderUploadError:function(e,t){this.$('.form-iso-upload[data-name="'+t+'"] .n-upload-progress').hide(),this.parentView.showHeaderError("Error uploading file: "+e)},resetInputFile:function(e){$(e.currentTarget).val(null)},_startUpload:function(n,i,o,r,c){if("undefined"==typeof File)return a.log("NodeConversionPopupView : Upload software via legacy browser."),void("function"==typeof r&&r(a.uploadCheck()));var d=n.name,p=0,u=this.model.getSoftwareRelease(this.softwareReleaseIdMap[c]);p=u?u.get(e.UPGRADE_CURRENT_SIZE_IN_BYTES):0;var h={name:d,fileSize:n.size,offset:p,md5Sum:i,hypervisorType:this.parentView.getTargetHypervisorType(),overwrite:!0};h=a.formatObjectToQuery(h);var m=t.getFormattedURL(_.template(l.UPGRADE_UPLOAD,{id:encodeURI(d),params:h,type:s.UPGRADE_SOFTWARE_TYPE_CONVERT_CLUSTER.HYPERVISOR_INSTALLER}));return a.uploadBinaryFile({type:"POST",url:m,data:n,offset:p},function(e){a.log("ISOUploadView : Successfully Uploaded the file!"),"function"==typeof o&&o(d,c)},function(e,t,n){if("abort"===n)return void a.log("ISOUploadView : Upload was aborted.");var i=e.status+" "+n+" "+a.processAjaxError(e.responseText);a.log("ISOUploadView : Error in uploading file: "+n+" | "+a.processAjaxError(e.responseText)+" | "+e.status),"function"==typeof r&&r(i,c)})},setSoftwareReleaseId:function(e,t){this.softwareReleaseIdMap[e]=t},uploadISO:function(e){var t=$(e.currentTarget).attr("data-name"),n=this.$('.form-iso-upload[data-name="'+t+'"]'),i=n[0].file.files[0],s=(i&&i.name,this);i?(this.parentView.disableButton("btn-main"),this.renderUploadStart(t),this.renderUploadProgress(!0,t),this.jqXhrMap&&this.jqXhrMap[t]&&this.jqXhrMap[t].abort(),a.calculateFileMD5Async(i,{},function(e){s._validateAndUploadFile(i,e,t)})):this.showHeaderError("Please select a file to upload.")},_validateAndUploadFile:function(e,t,n){var i=this;this.$('.form-iso-upload[data-name="'+n+'"] .n-visual-bar-label').text("Validating"),this.softwareValidationModel.setRPCParams(t,this.parentView.getTargetHypervisorType()),this.softwareValidationModel.fetch({success:function(){i.softwareValidationModel.isValidSoftware()?i._doFileUpload(e,t,n):(i.renderUploadError(i.softwareValidationModel.getErrorResponse(),n),i.jqXhrMap[n]=null)},error:function(){i.renderUploadError(i.softwareValidationModel.getParsedErrorResponse(),n),i.jqXhrMap[n]=null}})},_doFileUpload:function(e,t,n){var i=this;e.name;i.setSoftwareReleaseId(t,n),i.jqXhrMap[n]=i._startUpload(e,t,function(e){i.renderUploadSuccess(e,n),i.parentView.setISOUploaded(),i.jqXhrMap[n]=null,i.stopPollingSoftwareReleases()},function(e){i.renderUploadError(e,n),i.stopPollingSoftwareReleases(),i.jqXhrMap[n]=null},n),i.model.startPollingSoftwareReleases({force:!0}),i.renderUploadProgress(n)},cancelUpload:function(e){this.jqXhrMap&&(this.jqXhrMap[e].abort(),this.$('.form-iso-upload[data-name="'+e+'"] .n-upload-progress').hide(),this.$('.form-iso-upload[data-name="'+e+'"] input[type="file"]').val(""),this.stopPollingSoftwareReleases())},stopPollingSoftwareReleases:function(){this.isUploadInProgress()||this.model.stopPollingSoftwareReleases({force:!0})},isUploadInProgress:function(){var e=!1;return _.each(this.jqXhrMap,function(t,n){t&&(e=!0)}),e}})}),define("text!templates/popups/nodeconversion/ResultsView.html",[],function(){return'<div>\n  <div class="results">\n    <%= subTemplate %>\n  </div>\n  <div id="convert-progress"\n       class="n-task-progress-view"\n       style="display:none">\n    \x3c!-- Cluster conversion progress goes here --\x3e\n  </div>\n</div>'}),define("text!templates/popups/nodeconversion/ProgressView.html",[],function(){return'<div class="task">\n  <% if (showMasterProgressBar) { %>\n    <div class="status clearfix">\n      <span class="pull-left"><%= title %></span>\n      <span class="pull-right">\n        <%= task.get(propPercentComplete) ?\n              task.get(propPercentComplete) + \' %\' : \'\' %>\n      </span>\n    </div>\n    <div class="task-progress">\n      <%= VisualizationUtil.renderProgressBar({\n        barClass: \'n-progress-bar \' + task.get(propStatus),\n        percentUsed: task.get(propPercentComplete)\n      }) %>\n    </div>\n  <% } else { %>\n    <div class="status">\n      <h2><%= task && task.get(propPercentComplete) ?\n                task.get(propPercentComplete) + \' %\' : \'\'%></h2>\n    </div>\n  <% } %>\n  <% if (collapsible) { %>\n  <div class="expand-btn pull-right">\n    <a class="expand-trigger"><%= collapsed ? \'open\' : \'close\' %></a>\n  </div>\n  <% } %>\n  <%\n    var subTasks = task ? task.get(propSubTasks) : [];\n\n    if (typeof tasks !== \'undefined\') {\n      subTasks = tasks;\n    }\n\n    if (subTasks && subTasks.length) {\n  %>\n    <div class="subtasks-ctr">\n      <div class="subtasks"\n           style="<%= collapsible && collapsed ? \'display:none\' : \'\'%>">\n        <div class="n-container-caret">\n        <div class="n-container-caret-border"></div>\n        <div class="n-container-caret-content"></div>\n        </div>\n        \x3c!-- Subtasks go in here --\x3e\n        <% _.each(subTasks, function (subTask) { %>\n          <div class="subtask">\n            <div class="subtask-msg">\n              <%= subTask[propTaskMessage] %>\n            </div>\n            <%= VisualizationUtil.renderProgressBar({\n              barClass: \'n-progress-bar \' + subTask[propStatus],\n              percentUsed: subTask[propPercentComplete],\n              rightTextLabel: subTask[propPercentComplete] ?\n                subTask[propPercentComplete] + \' %\' : \'\'\n            }) %>\n          </div>\n        <% }); %>\n      </div>\n    </div>\n  <% } %>\n</div>'}),define("views/popups/nodeconversion/ResultsView",["data/DataProperties","managers/TaskManager","views/basecomponents/BaseSubView","utils/AppConstants","utils/VisualizationUtil","utils/SVG","models/genesis/ConvertClusterResultsModel","models/genesis/ConvertClusterFailedModel","text!templates/popups/nodeconversion/ResultsView.html","text!templates/popups/nodeconversion/ProgressView.html","text!templates/popups/nodeconversion/ErrorsAndWarningsTemplate.html"],function(e,t,n,i,s,a,o,r,l,c,d){"use strict";var p=_.template(l),u=_.template(c),h=_.template(d);return n.extend({name:"NodeConversionResultsView",viewOption:null,subtasksOpen:!1,resultsModel:null,abortInProgressModel:null,updateProgressCallback:null,statusRendered:!1,initialize:function(e){this.resultsModel=new o,this.abortInProgressModel=new r,this.statusRendered=!1,n.prototype.initialize.apply(this,arguments),this.updateProgressCallback=_.bind(this.renderTaskProgress,this),t.registerHandlerForChangedTasks(this.updateProgressCallback)},render:function(){this.clearBaseHeader();var e="";this.viewOption.skipStatus||(e=this.parentView.progressTemplate({message:this.i18n("submitMsg"),percentProgress:0})),this.$el.html(p({subTemplate:e})),this.viewOption.skipStatus&&this.renderTaskProgress(),this.parentView.showButton("main",!1),this.parentView.showButton("cancel",!1),this.parentView.showButton("close",!0),t.fetchOnDemand({force:!0})},destroy:function(){this.clearBaseHeader(),t.unregisterHandlerForChangedTasks(this.updateProgressCallback),n.prototype.destroy.apply(this,arguments)},refreshView:function(){this.render()},setViewOption:function(e){this.viewOption=e},fetchAndRenderStatus:function(){var e=this;this.resultsModel.setRPCParams(o.OPERATION_TYPE.CONVERT),this.resultsModel.fetch({success:function(){e.renderStatus.call(e)},error:function(){e.showHeaderError("Failed to fetch conversion results.")}})},renderStatus:function(){if(this.statusRendered=!0,this.$(".results").html(""),this.resultsModel.isOperationComplete()){var e=this.resultsModel.getErrors(),t=this.resultsModel.getWarnings();this.parentView.showButton("main",!1);var n="";(e&&e.length||t&&t.length)&&(n+="Failed to start cluster conversion. The following error(s)/warning(s) were encountered. Please resolve them and try again."),this.$(".results").html(h({showStatusError:!1,statusMessage:n,errors:e,warnings:t,errorIcon:a.SVGIcon("x-square","error-icon",""),warningIcon:a.SVGIcon("Exclamation_Mark","warning-icon","")}))}else this.$(".results").html("")},renderTaskProgress:function(){var n=t.getGlobalTasks(),a=n.getTaskForOperation(i.TASK_OPERATION_CLUSTER_CONVERT_START);if(a&&!this.viewOption.skipStatus){if(a.isStatusActive()||a.isStatusQueued())return;if(!this.statusRendered&&(this.fetchAndRenderStatus(),a.isStatusFailed()))return}var o=n.filter(function(t){return t.get(e.TASK_TYPE)===i.TASK_OPERATION_CONVERT_NODE}),r=_.uniq(o,!1,function(t){var n=t.get(e.TASK_ENTITY_ID);return _.isArray(n)?n[0]:n},this),l=_.map(r,function(t){var n={};return n[e.TASK_STATUS]=t.get(e.TASK_STATUS),n[e.SUB_TASK_MESSAGE]=t.get(e.SUB_TASK_MESSAGE)||t.get(e.TASK_MESSAGE),n[e.TASK_PERCENT_COMPLETE]=t.get(e.TASK_PERCENT_COMPLETE),n},this);l.length&&(this.parentView.showButton("main",!1),this.parentView.showButton("cancel",!1),this.parentView.showButton("close",!0),this.$("#convert-progress").html(u({title:this.i18n("convertMsg"),task:null,VisualizationUtil:s,propStatus:e.TASK_STATUS,propPercentComplete:e.TASK_PERCENT_COMPLETE,propTaskMessage:e.SUB_TASK_MESSAGE,propSubTasks:e.TASK_SUB_TASKS,tasks:l,collapsible:!1,showMasterProgressBar:!1,collapsed:!1})).show())}})}),define("text!templates/popups/nodeconversion/NodeConversionPopupView.html",[],function(){return'\x3c!-- The parent div is #popupNodeConvert --\x3e\n<div class="modal-header">\n  <button type="button" class="close" data-dismiss="modal"\n          id="node-convert-popup-close">\n    <i data-icon="K" aria-hidden="true"></i>\n  </button>\n  <h4 class="n-title"><%= title %></h4>\n</div>\n<div class="n-modal-wrapper">\n  <div class="n-modal-body">\n    <div class="n-modal-content-wrapper">\n      <div class="n-modal-alert-header">\n        \x3c!-- @view: alert goes here... --\x3e\n      </div>\n      <div class="n-modal-content n-modal-node-convert-content"\n           id="node-convert-main">\n        \x3c!-- @subviews go in here --\x3e\n      </div>\n    </div>\n    </div>\n    <div class="n-modal-footer">\n      \x3c!-- Form buttons --\x3e\n      <button class="btn-back btn n-btn-form" style="display:none;"\n              action="previous">\n        <%= backBtnText %>\n      </button>\n      <button class="btn-cancel btn n-btn-form">\n        <%= cancelBtnText %>\n      </button>\n      <button class="btn-close btn n-btn-form -blue" style="display:none">\n        <%= closeBtnText %>\n      </button>\n      <button class="btn-save btn btn-primary n-btn-form"\n              style="display:none;"\n              data-loading-text="Saving..." action="showSubView">\n        <%= saveBtnText %>\n      </button>\n      <button class="btn-main btn -blue n-primary-btn n-btn-form"\n              action="convert">\n        <%= i18n(\'convertCluster\') %>\n      </button>\n    </div>\n</div>\n'}),define("views/popups/nodeconversion/NodeConversionPopupView",["views/basecomponents/popups/BasePopupView","utils/AppConstants","utils/SubViewHelper","managers/TaskManager","managers/I18nManager","models/genesis/ConvertClusterValidateModel","models/genesis/ConvertClusterModel","models/genesis/ConvertClusterIsoRequiredModel","models/genesis/AbortClusterConversionModel","views/popups/nodeconversion/HypervisorSelectView","views/popups/nodeconversion/ValidationResultsView","views/popups/nodeconversion/ISOUploadView","views/popups/nodeconversion/ResultsView","text!templates/popups/nodeconversion/NodeConversionPopupView.html","text!templates/popups/softwareupgrade/HypervisorAuthenticationTemplate.html"],function(e,t,n,i,s,a,o,r,l,c,d,p,u,h,m){"use strict";var f=_.template(h),v=_.template(m),g=_.template('<div class="loader"><div class="n-loading"><div class="n-inline-loading-container"><div class="donut-loader-blue -large"></div><div class="n-loading-msg"><strong><%= message %> <%= percentProgress > 0 ? percentProgress + "%" : "" %></strong></div></div></div></div>');return e.extend({DEFAULT_POPUP_PROP:{title:"Title",subViewContainerEl:".n-modal-node-convert-content"},POPUP_TITLE_CLUSTER:"Convert Cluster",HYPERVISOR_SELECT_VIEW:"hypervisor-select",VALIDATION_RESULT_VIEW:"validation-result",ISO_UPLOAD_VIEW:"iso-upload",RESULTS_VIEW:"results-view",DP:{VALIDATION_STATUS:"result",VALIDATION_WARNINGS:"warnings",VALIDATION_ERRORS:"errors"},subViewHelper:null,el:"#popupNodeConvert",name:"NodeConversionPopupView",currentSubViewId:null,clusterConvertValidationModel:null,uploadIsoRequiredModel:null,clusterConvertModel:null,abortConversionModel:null,targetHypervisorType:null,isoUploadRequired:!1,powerOnVms:!1,uploadInProgress:!1,progressTemplate:g,events:{"click  .modal-header .close":"hide","click  .btn-cancel":"hide","click  .btn-close":"hide","click  .btn-save":"onClickLinkAction","click  .btn-next":"onClickLinkAction","click  .btn-back":"onClickLinkAction","click  .btn-main":"onClickLinkAction","click  .btn-validate":"onClickLinkAction","click  .action-icon":"onClickLinkAction"},initialize:function(){e.prototype.initialize.apply(this,arguments),this.subViewHelper=new n,this.clusterConvertValidationModel=new a,this.clusterConvertModel=new o,this.uploadIsoRequiredModel=new r,this.abortConversionModel=new l},render:function(){return this.$el.html(f(this.vtOptions({title:this.POPUP_TITLE_CLUSTER,backBtnText:s.t("Common","back"),cancelBtnText:s.t("Common","cancel"),closeBtnText:s.t("Common","close"),saveBtnText:s.t("Common","save")}))),i.getGlobalTasks().hasActiveClusterConvertTask()?this.selectSubView({subViewId:this.RESULTS_VIEW,options:{skipStatus:!0}}):this.selectSubView({subViewId:this.HYPERVISOR_SELECT_VIEW}),this},hide:function(){this.currentSubViewId===this.ISO_UPLOAD_VIEW&&this.subViewHelper.get(this.currentSubViewId).isUploadInProgress()?$.nutanixConfirm({msg:"You're currently uploading a software binary. Are you sure you want to exit?",yes:function(){this.dispose()},yesText:"Yes",noText:"No",context:this}):this.dispose()},dispose:function(){e.prototype.hide.apply(this,arguments),this.subViewHelper.destroy(),this.model&&this.model.destroyAll()},selectSubView:function(e){var t,n;t=this.subViewHelper.get(this.currentSubViewId),t&&t.hideView(),n=e.subViewId,t=this.subViewHelper.get(n),this.currentSubViewId=n;var i=e.options||{};if(t)t.setViewOption(i);else{$('<div id="'+n+'"></div>').appendTo(this.DEFAULT_POPUP_PROP.subViewContainerEl),t=this.createSubView(n),this.subViewHelper.register(this.currentSubViewId,t),t.setParentView(this),t.setViewOption(i),t.render()}this._showSubView(t)},_showSubView:function(e){e&&(e.refreshView(),e.showView())},onViewTransition:function(e){var t=this.subViewHelper.get(this.currentSubViewId);if(t){var n=_.bind(function(){this.selectSubView(e)},this);t.saveViewData(n,e)}},onClickLinkAction:function(e){var n=$(e.currentTarget);this.targetHypervisorType=this.$(".hypervisor-select").val();var i=n.attr(t.NAV_ACTION);i===t.ACTION_CONVERT?this.onConvertClusterClicked():i===t.ACTION_VALIDATE&&this.onValidateClicked()},createSubView:function(e){var t,n={el:"#"+e,model:this.model};switch(e){case this.HYPERVISOR_SELECT_VIEW:t=new c(n);break;case this.VALIDATION_RESULT_VIEW:t=new d(n);break;case this.ISO_UPLOAD_VIEW:t=new p(n);break;case this.RESULTS_VIEW:t=new u(n)}return t},showButton:function(e,t){var n=".btn-"+e;t?this.$(n).show():this.$(n).hide()},disableButton:function(e){this.$("."+e).attr("disabled","disabled")},enableButton:function(e){this.$("."+e).removeAttr("disabled")},validateCredentials:function(){var e=$("#nutanixConfirmModal .username-auth").val().trim(),t=$("#nutanixConfirmModal .password-auth").val().trim(),n=$("#nutanixConfirmModal .host-details").val().trim();return!(_.isEmpty(e)||_.isEmpty(t)||_.isEmpty(n))||($("#nutanixConfirmModal .n-popup-captcha-error").html(this.i18n("validateCredsMsg")).show(),!1)},onValidateClicked:function(){var e=v({serverDetails:"vCenter IP Address:"});$.nutanixConfirm({msg:"",yes:function(){var e=$("#nutanixConfirmModal .username-auth").val().trim(),t=$("#nutanixConfirmModal .password-auth").val().trim(),n=$("#nutanixConfirmModal .host-details").val().trim();this.validateConversion(e,t,n)},captcha:_.bind(this.validateCredentials,this),yesText:t.LABEL_YES,noText:t.LABEL_NO,extHTML:e,context:this})},onConvertClusterClicked:function(){var e=this;this.showHeaderLoading(),this.disableButton("btn-main"),this.uploadIsoRequiredModel.setRPCParams(this.getTargetHypervisorType()),this.uploadIsoRequiredModel.fetch({success:function(){e.clearHeader(),e.isoUploadRequired=e.uploadIsoRequiredModel.isIsoUploadRequired(),e.isISOUploadRequired()?e.onViewTransition({subViewId:e.ISO_UPLOAD_VIEW,options:{incompatibleUpload:e.currentSubViewId===e.ISO_UPLOAD_VIEW}}):e.uploadIsoRequiredModel.getError()?(e.showHeaderError(e.uploadIsoRequiredModel.getError()),e.enableButton("btn-main")):$.nutanixConfirm({msg:"Some cluster operations will be unavailable while the conversion is in progress. If vCenter is hosted on the same Nutanix cluster, please contact Nutanix support. Are you sure you wish to proceed?",yes:function(){this.startClusterConversion()},yesText:"Yes",noText:"No",context:e})},error:function(t,n){e.showHeaderError(n),e.enableButton("btn-main")}})},validateConversion:function(e,t,n){var i=this,s=null;e&&t&&n&&(s={username:e,password:t,host:n}),this.clusterConvertValidationModel.setRPCParams(this.targetHypervisorType,s),this.clusterConvertValidationModel.fetch({success:function(){if(i.currentSubViewId===i.VALIDATION_RESULT_VIEW){var e=i.subViewHelper.get(i.currentSubViewId);e&&e.refreshView()}else i.onViewTransition({subViewId:i.VALIDATION_RESULT_VIEW,options:{allowBackNav:!0}})},error:function(e,t){i.showHeaderError(e.getErrorResponse())}})},startClusterConversion:function(){var e=this;this.targetHypervisorType?(this.clusterConvertModel.setRPCParams(this.targetHypervisorType,this.powerOnVms),this.clusterConvertModel.fetch({success:function(){e.clearHeader(),e.onViewTransition({subViewId:e.RESULTS_VIEW,options:{}})},error:function(t,n){e.showHeaderError(n),e.enableButton("btn-main")}})):this.showHeaderError("Unknown target hypervisor type.")},abortClusterConversion:function(){var e=this;this.abortConversionModel.fetch({success:function(){var t=e.abortConversionModel.getReturnResponse();t[0]?(e.showHeaderInfo("Abort cluster conversion initiated."),i.fetchOnDemand({force:!0})):e.showHeaderError(t[1])},error:function(t,n){e.showHeaderError(n)}})},isISOUploadRequired:function(){return this.isoUploadRequired},getRequiredIsos:function(){return this.uploadIsoRequiredModel.getRequiredIsos()},setISOUploaded:function(){this.isoUploadRequired=!1},getTargetHypervisorType:function(){return this.targetHypervisorType}})}),define("text!templates/popups/capacityplanning/RecommendationPopupView.html",[],function(){return'<div class="modal-header">\n  <button type="button" class="close" data-dismiss="modal">\n    <i data-icon="K" aria-hidden="true"></i>\n  </button>\n  <h4 class="n-title"><%= i18n(\'optimize_resource\') %></h4>\n</div>\n\n<div class="n-modal-wrapper">\n  <div class="n-modal-body">\n      <div class="n-modal-content-wrapper">\n          <div class="n-modal-alert-header">\n            \x3c!-- @view: alert goes here... --\x3e\n          </div>\n          <div class="sub-title">\n            <%= i18n(\'recommendation\') %>\n          </div>\n          <div class="report-link">\n            <a><%= i18n(\'get_report\') %></a>\n          </div>\n          <p>\n            <%= i18ns(\'optimization_msg\') %>\n          </p>\n          <div class="recommendations-wrapper">\n          </div>\n      </div>\n  </div>\n\n  <div class="n-modal-footer">\n    <button class="btnCancel btn ">\n      <%= i18n(\'cancel\') %>\n    </button>\n  </div>\n</div>\n'}),define("views/popups/capacityplanning/RecommendationPopupView",["views/basecomponents/popups/BasePopupView","views/basecomponents/vantagepoints/elements/VMEfficiencyVantagePointView","models/BaseModel","models/capacityplanning/CPQueryModel","managers/NavigationManager","utils/AppConstants","utils/LogUtil","utils/AppUtil","utils/FilterUtil","data/DataProperties","text!templates/popups/capacityplanning/RecommendationPopupView.html"],function(e,t,n,i,s,a,o,r,l,c,d){"use strict";return e.extend({name:"RecommendationPopupView",el:"#popupCPRecommendationView",subViewTemplate:_.template(d),events:{"click  .modal-header .close":"hide","click  .n-modal-footer .btnCancel":"hide","click .report-link":"onReportLinkClick"},render:function(){var e=this,t=this.actionRoute[a.NAV_ACTION_TARGET_ID];this.clusterManager.getClusterModelById(t);this.$el.html(this.subViewTemplate(this.vtOptions({}))),this.showHeaderLoading();var n=[],s=new i({entity_type:a.ENTITY_CLUSTER,group_member_attributes:[c.CLUSTER_INEFFICIENT_GAIN],entity_ids:[t]});n.push(s.save());var r=$.whenAll.apply($,n),l=void 0;r.done(function(){var t=s.getQueryResultAttributes();if(t&&t.length)try{l=JSON.parse(t[0][c.CLUSTER_INEFFICIENT_GAIN])}catch(t){o.log(e.name+" invalid json.")}e.clearHeader(),e.renderRecommendations(l)})},onReportLinkClick:function(e){var t={};t=l.addFilterCondition(t,c.NAME,l.createFilterCondition(a.ENTITY_REPORT_CONFIG,c.NAME,a.FILTER_OPERATORS.CONTAINS,"Cluster Efficiency Summary"));var n=new i({entity_type:a.ENTITY_REPORT_CONFIG,group_member_attributes:[c.NAME]});n.set(n.DP.FILTER_EXPR,t),n.save(null,{success:function(){var e,i=n.getQueryResultAttributes();i&&i.length&&s.navigateToEBPage(a.ENTITY_REPORT_CONFIG,a.DEFAULT_PERSPECTIVE,null,null,t,(e={},_defineProperty(e,a.NAV_ACTION,"run"),_defineProperty(e,a.NAV_ACTION_TARGET_ID,i[0].id),e))},error:function(){r.log("Fetching efficiency report failed")}})},renderRecommendations:function(e){var i=this.actionRoute[a.NAV_ACTION_TARGET_ID];this.recommendationView=new t({model:new n,clusterId:i,efficiencyGain:e,isDashboardView:!1}),this.$(".recommendations-wrapper").html(this.recommendationView.render().$el)}})}),define("text!templates/popups/alertservices/ConnectionStatusView.html",[],function(){return'<tr class="n-connection-mode">\n  <td class="connectionModellbl">Mode</td>\n  <td class="connectionMode">\n      <%=model.mode ? model.mode : \'\'%>\n      <%=model.smtpLink ? \' (\' + model.smtpLink + \') \':\'\' %>\n  </td>\n</tr>\n<tr class="n-http-proxy n-tunnel">\n  <td>Http Proxy</td>\n  <td class="httpProxy">\n    <%= model.httpProxy ? model.httpProxy : \'\'%>\n  </td>\n</tr>\n<tr class="n-connection-status n-tunnel">\n  <td>Status</td>\n  <td>\n    <span class="connectionStatus">\n      <label class="connection-icon" />\n      <span class="n-connection-msg">\n        <label class="connectionMsg" title="<%=model.connectionStatusMsg ?\n        model.connectionStatusMsg : \'\'%>">\n          <%=model.connectionStatus ? model.connectionStatus : \'\'%>\n        </label>\n      </span>\n    </span>\n  </td>\n</tr>\n<tr class="n-service-center n-tunnel">\n  <td>Service Center</td>\n  <td class="serviceCenter">\n    <%=model.serviceCenter ? model.serviceCenter : \'\' %>\n  </td>\n</tr>\n<tr class="n-connection-failure-time n-tunnel">\n  <td class="n-connection-failure-status">Last Attempted</td>\n  <td class="lastChecked">\n    <%=model.lastChecked ? model.lastChecked : \'\'%>\n  </td>\n</tr>\n<tr class="n-connection-success-time n-tunnel">\n  <td class="n-connection-success-status">Established Since</td>\n  <td class="establishedSince">\n    <%=model.establishedSince ? model.establishedSince : \'\'%>\n  </td>\n</tr>'}),define("views/utils/ConfigurationServicesView",["views/basecomponents/BaseView","data/DataProperties","utils/AppConstants","utils/AppUtil","utils/TimeUtil","text!templates/popups/alertservices/ConnectionStatusView.html"],function(e,t,n,i,s,a){"use strict";return e.extend({TEMPLATES:{CONNECTION:_.template(a),MSG_LINK:_.template('<a class="linkAuth" <%= actionAttributes %> ><%= title %></a>')},fillConnectionStatusInfo:function(e,a){var o,r,l,c={};if(a.get(t.CONN_SMTP_SERVER)){o=n.CONN_SMTP_SERVER,c.mode=o;var d=this.TEMPLATES.MSG_LINK({title:"Details",actionAttributes:i.createActionAttr(n.ENTITY_SMTP_SERVER,n.ACTION_SHOW)});c.smtpLink=d}else if((r=a.get(t.CONN_TUNNEL_DETAILS))&&(o=n.CONN_REMOTE_TUNNEL,r[t.REMOTE_SUPPORT_HTTP_PROXY]&&(c.httpProxy=r[t.REMOTE_SUPPORT_HTTP_PROXY][t.REMOTE_SUPPORT_PROXY_ADDRESS]),r.serviceCenter&&(c.serviceCenter=r.serviceCenter.ipAddress),l=r.connectionStatus,e!==n.CONN_TYPE.REMOTE_SUPPORT&&(c.mode=o),l)){c.connectionStatus=l.status;var p=l.message;p&&(c.connectionStatusMsg=p.message);var u=l.lastCheckedTimeStampUsecs;c.lastChecked=s.formatDateTime(u>0?u/1e3:0);var h=l.lastSuccessfulTransmissionTimeStampUsecs;c.establishedSince=s.formatDateTime(h>0?h/1e3:0)}if(o){var m=this.TEMPLATES.CONNECTION({model:c});this.$(".n-connection").html(m),o===n.CONN_REMOTE_TUNNEL?(this.$(".n-tunnel").show(),this.$(".n-smtp").hide(),r.httpProxy||this.$(".n-http-proxy").hide(),r.serviceCenter||this.$(".n-service-center").hide(),c.mode||this.$(".n-connection-mode").hide()):(this.$(".n-tunnel").hide(),this.$(".n-smtp").show());var f=(c.connectionStatus||"").toLowerCase();f&&(f===n.CONN_STATUS_FAILED?(this.$(".connection-icon").addClass("n-connection-failure-icon"),this.$(".n-connection-success-time").hide(),this.$(".n-connection-failure-time").show()):f===n.CONN_STATUS_SUCCESS?(this.$(".connection-icon").addClass("n-connection-success-icon"),this.$(".n-connection-success-time").show(),this.$(".n-connection-failure-time").hide()):(this.$(".connection-icon").addClass("n-connection-unknown-icon"),this.$(".n-connection-success-time").hide(),this.$(".n-connection-failure-time").hide()),this.$(".connectionMsg").tooltip({placement:"top",trigger:"hover",html:"true"})),this.$el.show()}else this.$(".n-connection").html(""),this.$el.hide()},destroy:function(){this.$(".connectionMsg").tooltip("destroy"),e.prototype.destroy.apply(this,arguments)}})}),define("models/alert/AlertServicesModel",["models/BaseModel","data/DataURLConstants","data/DataManager","utils/AppConstants","utils/AppUtil"],function(e,t,n,i,s){"use strict";var a={ENABLE:"enable",DEFAULT_EMAIL:"enableDefaultNutanixEmail",EMAIL_CONTACT_LIST:"emailContactList",VERBOSITY_TYPE:"verbosityType",ENABLE_EMAIL_DIGEST:"enableEmailDigest",SKIP_EMPTY_DIGEST:"skipEmptyAlertEmailDigest"};return e.extend({DP:a,idAttribute:a.ENABLE,urlRoot:t.ALERT_SERVICES,entityType:i.ENTITY_ALERT_EMAIL_CONFIGURATION,defaults:{emailContactList:[],enable:!1,enableDefaultNutanixEmail:!1,enableEmailDigest:!1,skipEmptyAlertEmailDigest:!1,defaultNutanixEmail:""},parseOptions:function(i,a,o){return o=e.prototype.parseOptions.apply(this,arguments),o.url=n.getFormattedURL(t.ALERT_SERVICES),s.log("Alert Services Model : \n\t method: "+i+"\n\t data  : "+o.url),o},showLatencyNotification:function(e,t){},showSuccessNotification:function(e,t,n){}},{DP:a})}),define("text!templates/wizards/alert/AlertServicesPage.html",[],function(){return"<div class=\"n-modal-content alert-services\">\n  <div data-ntnx-content-inner>\n    <section data-ntnx-section=\"type-text\">\n      <h5 data-ntnx-title><%= i18n('email_delivery') %></h5>\n      <section data-ntnx-section=\"type-subtitle\"><%= i18n('email_delivery_descr') %></section>\n    </section>\n    <% var sDisabled = canModify ? '' : 'disabled' ; %>\n    <form id=\"alertServicesForm\">\n      <section data-ntnx-section>\n        <div data-ntnx-form-inline>\n          <%= Components.checkbox({\n              jsClasses: 'enable',\n              id: 'alert-services-enable',\n              disabled: sDisabled,\n              labelText: i18n('lblEmailEveryAlert')\n          }) %>\n        </div>\n        <div data-ntnx-hint><%= i18n('email_every_alert_descr') %></div>\n      </section>\n      <section data-ntnx-section>\n        <div data-ntnx-form-inline>\n          <%= Components.checkbox({\n              jsClasses: 'emailDigest',\n              id: 'alert-digest-enable',\n              disabled: sDisabled,\n              labelText: i18n('lblEmailDailyDigest')\n          }) %>\n        </div>\n        <div data-ntnx-hint><%= i18n('daily_digest_descr') %></div>\n        <section data-ntnx-section class=\"skip-empty-digest\">\n          <div data-ntnx-form-inline>\n            <%= Components.checkbox({\n                jsClasses: 'skipEmptyDigest',\n                id: 'skip-empty-digest-enable',\n                disabled: sDisabled,\n                labelText: i18n('skip_empty_digest')\n            }) %>\n          </div>\n          <div data-ntnx-hint><%= i18n('skip_empty_digest_descr') %></div>\n        </section>\n      </section>\n      <section data-ntnx-section=\"type-separator\">\n        <h5 data-ntnx-title><%= i18n('lblEmailRecipients') %></h5>\n      </section>\n      <section data-ntnx-section>\n        <div data-ntnx-form-inline>\n          <%= Components.checkbox({\n              jsClasses: 'defaultEmail',\n              id: 'alert-services-default-email',\n              disabled: sDisabled,\n              labelText: i18ns('lblNutanixSupport', model.defaultNutanixEmail)\n          }) %>\n        </div>\n        <section data-ntnx-section>\n          <div class=\"emailContacts\"></div>\n        </section>\n      </section>\n      <section data-ntnx-section=\"type-separator\">\n      \x3c!-- Holder for displaying connection status --\x3e\n      <table class=\"n-connection-group table readonly-table\">\n        <thead>\n        <tr>\n          <th colspan=\"2\"><%= i18n('lblTunnelConnection') %></th>\n        </tr>\n        </thead>\n        \x3c!-- Container of view rendered from ConfigurationServicesView --\x3e\n        <tbody class=\"n-connection\">\n        </tbody>\n      </table>\n    </form>\n  </div>\n</div>\n"}),define("views/wizards/alert/AlertServicesPage",["views/basecomponents/wizards/BaseWizardPage","views/utils/ConfigurationServicesView","views/utils/MultipleItemPickerView","models/alert/AlertServicesModel","managers/ActionManager","managers/NavigationManager","utils/AppUtil","utils/AppConstants","utils/SubViewHelper","text!templates/wizards/alert/AlertServicesPage.html"],function(e,t,n,i,s,a,o,r,l,c){"use strict";var d=_.template(c);return e.extend({model:null,configuration:null,events:{"click  .linkAuth":"onClickShowSMTP"},canModify:!1,name:"AlertServicesPage",initialize:function(){e.prototype.initialize.apply(this,arguments),this.subViews=new l,this.model=new i,this.configuration=null,this.canModify=this.canModifyByEntityType(r.ENTITY_ALERT_CONFIGURATION)},render:function(){var e=this;this.isViewRendered||this.model.fetch({silent:!0,success:function(){e.renderModel()},error:function(t,n){e.showError(n.responseText)}})},destroy:function(){this.model&&(this.model.off(),this.model=null),this.configuration&&(this.configuration.destroy(),this.configuration=null),this.subViews&&(this.subViews.destroy(),this.subViews=null),
e.prototype.destroy.apply(this,arguments)},renderModel:function(){if(this.$el.html(d(this.vtOptions({model:this.model.toJSON(),canModify:this.canModify}))),this.model.get(this.model.DP.VERBOSITY_TYPE)&&this.$(".verbosity").val(this.model.get(this.model.DP.VERBOSITY_TYPE).toUpperCase()).attr("selected",!0),this.model.get(this.model.DP.EMAIL_CONTACT_LIST)){var e=new n({el:".emailContacts",readOnly:!this.canModify,placeholder:this.i18n("lblAdditionalEmailRecipients"),inputType:n.INPUT_TYPES.INPUT,selectedItems:this.model.get(this.model.DP.EMAIL_CONTACT_LIST).slice()});e.render(),this.subViews.register(this.model.DP.EMAIL_CONTACT_LIST,e)}this.model.get(this.model.DP.ENABLE)&&this.$(".enable").prop("checked",!0),this.model.get(this.model.DP.DEFAULT_EMAIL)&&this.$(".defaultEmail").prop("checked",!0),this.model.get(this.model.DP.ENABLE_EMAIL_DIGEST)&&this.$(".emailDigest").prop("checked",!0),this.model.get(this.model.DP.SKIP_EMPTY_DIGEST)&&this.$(".skipEmptyDigest").prop("checked",!0),this.applyNutanixInput(),this.clearHeader(),this.configuration||(this.configuration=new t({el:this.$(".n-connection-group")})),this.configuration.fillConnectionStatusInfo(r.CONN_TYPE.ALERTS,this.model),this.isViewRendered=!0},onClickShowSMTP:function(e){this.clearHeader(),s.executeActionElement(e.currentTarget)},onSave:function(e){var t=this,n=a.getCurrentPageRoute();if(n&&n.pageId===r.PAGE_SETTINGS&&(e=function(){}),!this.model)return void o.debug("AlertServicesPage: onSave: Unable to save Alert Services configuration");this.model.on("error",function(e,n){t.showError(n)});var i=this.subViews.get(this.model.DP.EMAIL_CONTACT_LIST),s=i.getSelectedItems(),l={enable:this.$(".enable").is(":checked"),enableDefaultNutanixEmail:this.$(".defaultEmail").is(":checked"),emailContactList:s,verbosityType:this.$("#verbosity").val(),enableEmailDigest:this.$(".emailDigest").is(":checked"),skipEmptyAlertEmailDigest:this.$(".skipEmptyDigest").is(":checked")};if((l.enable||l.enableEmailDigest)&&!l.enableDefaultNutanixEmail){if(_.isEmpty(s))return this.showError(this.i18n("error_alert_email_configs")),void this.$(".btnNext").button("reset");if(_.some(s,function(e){return!o.validEmail(e)}))return void this.showError(this.i18n("valid_email_please"))}_.some(l,function(e,t){return _.isArray(e)?!o.isSameArray(e,this.model.get(t)):this.model.get(t)!==e||void 0},this)?(this.model.set(l),this.saveAlertServices(e)):e&&(this.showInfo(this.i18n("no_new_changes")),e())},saveAlertServices:function(e){var t=this;this.model&&(this.$(".btnNext").button("saving"),this.showInfo(this.i18n("saving")),this.model.save(null,{success:function(n,i){t.model.clear(),t.model.set(i),t.refreshConnectionStatusInfo(t.model),t.$(".btnNext").button("Save"),t.showSuccess(t.i18n("alert_config_saved_success")),e&&e()},error:function(e,n){t.showError(t.i18n("error_alert_email_configs")+" "+o.processAjaxError(n.responseText)),t.$(".btnNext").button("reset")}}))},canEnablePageLink:function(){return!0},canTransitionPage:function(e){return!0},onPageCancel:function(){return!0},getButtonLabel:function(e){return e<1?"< "+this.i18n("back"):this.i18n("apply")},getSaveButtonLabel:function(){return this.canModify?this.i18n("save"):this.i18n("close")},onPageTransition:function(e){this.canModify?this.onSave(e):(this.showWarning(this.i18n("can_not_modify")),e())},showCancelButton:function(){return this.canModify},hidePreviousButton:function(){return!0},canApplyPageChanges:function(){return this.canModify},refreshConnectionStatusInfo:function(){this.configuration.fillConnectionStatusInfo(r.CONN_TYPE.ALERTS,this.model)}})}),define("text!templates/wizards/alert/AlertRulesListView.html",[],function(){return'<div class="n-modal-content alert-rules">\n  <div data-ntnx-content-inner>\n    <section data-ntnx-section="type-text">\n      <%= i18n(\'configure_rules_message\') %>\n    </section>\n\n    <% if (canModify) {%>\n    <section data-ntnx-section>\n      <%= Components.button({\n        extraClasses: \'addRule\',\n        text        : i18n(\'new_rule_btn\'),\n        iconLeft    : \'plus\',\n        extraAttr   : [{\n                          key: \'action\',\n                          value: \'create\'\n                        }]\n      }) %>\n    </section>\n    <% } %>\n\n    <% if (configs && configs.length) {%>\n    <section data-ntnx-section class="rules-list-container">\n      <table id="rulesTable" class="table readonly-table">\n        <tbody>\n        <% _.each(configs, function(config, index) { %>\n          <tr class="n-table-row" data-index="<%= index %>">\n            <th><%= i18n(\'when_label\') %></th>\n            <td>\n              <% if (config.severities) { %>\n                <%= config.severities %> <%= i18n(\'severity\') %>\n              <% } else { %>\n                <span class="severity-highlight"><%= i18n(\'any_severity\') %></span>\n              <% } %>\n              <%= i18n(\'alerts_of\') %>\n              <% if (config.categories) {%>\n                <%= i18n(\'impact_type\') %> <%= config.categories %>\n              <% } else { %>\n                <span class="category-highlight"><%= i18n(\'any_impact_type\') %></span>\n              <% } %>\n              <% if (config.matchPhrases) {%>\n                <%= i18n(\'containing_phrase\') %> <%= config.matchPhrases %>\n              <% } %>\n              <%= i18n(\'detected_on\') %>\n              <% if (config.clusters) {%>\n                <%= i18n(\'cluster\') %> <%= config.clusters %>\n              <% } else { %>\n                <span class="cluster-highlight"><%= i18n(\'any_cluster\') %></span>\n              <% } %>.\n            </td>\n            <% if (canModify) {%>\n            <td class="delete-cell cell-actions" rowspan="2">\n              <i class="editRule btnEdit" data-icon="F" aria-hidden="true"\n                 action="update" actionTargetId="<%= index %>">\n              </i>\n              <i class="deleteRule btnDelete" data-icon="v" aria-hidden="true"\n                 action="delete" actionTargetId="<%= index %>">\n              </i>\n            </td>\n            <% } %>\n          </tr>\n          <tr class="n-table-row" data-index="<%= index %>">\n            <th><%= i18n(\'send_to_label\') %></th>\n            <td><%= config.recipients %></td>\n          </tr>\n        <% }) %>\n        </tbody>\n      </table>\n    </section>\n    <% } %>\n  </div>\n</div>'}),define("views/wizards/alert/AlertRulesListView",["views/basecomponents/BaseSubView","utils/AppConstants","text!templates/wizards/alert/AlertRulesListView.html"],function(e,t,n){"use strict";var i=_.template(n),s=_.template('<span class="<%= itemType %>-highlight"><%= item %></span>');return e.extend({events:{"click .addRule":"onClickLinkAction","click .deleteRule":"onClickLinkAction","click .editRule":"onClickLinkAction"},configRules:null,canModify:!1,name:"AlertRulesListView",initialize:function(n){e.prototype.initialize.apply(this,arguments),this.model=n.model,this.configRules=n.configRules,this.canModify=this.canModifyByEntityType(t.ENTITY_ALERT_CONFIGURATION)},render:function(){this.$el.html(i(this.vtOptions({configs:this._getFormattedConfigs(),canModify:this.canModify})))},refreshView:function(){this.render()},onClickLinkAction:function(n){var i=$(n.currentTarget),s=i.attr(t.NAV_ACTION),a=i.attr(t.NAV_ACTION_TARGET_ID);if(s===t.ACTION_DELETE){delete this.configRules[a],this.$(".n-table-row[data-index="+a+"]").remove();var o=this.$("#rulesTable");0===o.find("tbody tr").length&&o.hide()}else e.prototype.onClickLinkAction.apply(this,arguments)},_getFormattedConfigs:function(){return _.map(this.configRules,function(e){var n={};n[this.model.DP.SEVERITIES]=this._formatItems("severity",e[this.model.DP.SEVERITIES]);var i=_.map(e[this.model.DP.CATEGORIES],function(e){return t.ALERT_IMPACT_TYPES[e][0]},this);n[this.model.DP.CATEGORIES]=this._formatItems("category",i);var s=_.map(e[this.model.DP.CLUSTER_UUIDS],function(e){return this.clusterManager.getNameById(e)||t.UNKNOWN_VALUE},this);return n.clusters=this._formatItems("cluster",s),n[this.model.DP.MATCH_PHRASES]=this._formatItems("match-phrase",e[this.model.DP.MATCH_PHRASES]),n[this.model.DP.RECIPIENTS]=e[this.model.DP.RECIPIENTS].join(", "),e[this.model.DP.INCLUDE_GLOBAL_EMAIL_CONTACT_LIST]&&(n[this.model.DP.RECIPIENTS]+=" & global recipient list"),n},this)},_formatItems:function(e,t){if(t&&t.length){var n=_.map(t,function(t){return s({itemType:e,item:t})});if(n.length<=2)return n.join(" or ");var i=n.pop();return n.join(", ")+" or "+i}return null}})}),define("text!templates/wizards/alert/AlertRulesPage.html",[],function(){return'<div class="n-modal-content alert-rules">\n  <div data-ntnx-content-inner>\n    <section data-ntnx-section>\n      <h5 data-ntnx-title>\n        <%= i18n(\'when_label\') %>\n      </h5>\n    </section>\n\n    <div class="clearfix">\n\n      <section data-ntnx-section="type-half">\n        <label data-ntnx-label><%= i18n(\'severity_label\') %></label>\n        <div class="severitySelector"></div>\n      </section>\n\n      <section data-ntnx-section="type-half">\n        <label data-ntnx-label><%= i18n(\'impact_type_label\') %></label>\n        <div class="categorySelector"></div>\n      </section>\n\n      <% if (showClusterSelector) { %>\n        <section data-ntnx-section="type-half">\n          <label data-ntnx-label>\n            <%= i18n(\'cluster_label\') %>\n          </label>\n          <div class="clusterSelector"></div>\n        </section>\n      <% } %>\n\n      <section data-ntnx-section="<%= showClusterSelector ? \'type-half\' : \'\' %>">\n        <label data-ntnx-label>\n          <%= i18n(\'match_phrase_label\') %>\n        </label>\n        <div class="matchPhraseInput"></div>\n      </section>\n\n    </div>\n\n    <section data-ntnx-section>\n      <h5 data-ntnx-title><%= i18n(\'send_to_label\') %></h5>\n      <section data-ntnx-section>\n        <label data-ntnx-label><%= i18n(\'email_addresses_label\') %></label>\n        <div class="recipientInput"></div>\n      </section>\n      <section data-ntnx-section>\n        <%= Components.checkbox({\n            id: \'includeGlobalEmailContactList\',\n            checked: sChecked,\n            labelText: i18n(\'global_recipient_list\')\n          }) %>\n        <span class="nutanixMoreInfo"\n          data-tooltip-title="<%= i18n(\'tooltip_message\') %>">\n        </span>\n      </section>\n    </section>\n  </div>\n</div>'}),define("views/wizards/alert/AlertRulesPage",["views/basecomponents/BaseSubView","views/utils/MultipleItemPickerView","utils/AppConstants","utils/SubViewHelper","utils/AppUtil","text!templates/wizards/alert/AlertRulesPage.html"],function(e,t,n,i,s,a){"use strict";var o=_.template(a),r={CLUSTER:"clusterSelector",CATEGORY:"categorySelector",SEVERITY:"severitySelector"};return e.extend({subViews:null,configRules:null,name:"AlertRulesPage",initialize:function(t){e.prototype.initialize.apply(this,arguments),this.subViews=new i,_.bindAll(this,"itemSelectionChangeEvent"),this.model=t.model,this.index=t.index||0,this.configRules=t.configRules},render:function(){this.isViewRendered&&(this.subViews.removeAll(),this.$(".nutanixMoreInfo").nutanixMoreInfo("destroy"),this.$el.empty());var e;if(this.configRules[this.index]&&(e=this.configRules[this.index]),this.$el.html(o(this.vtOptions({showClusterSelector:this.clusterManager.isMulticlusterNavMode(),sChecked:e&&e[this.model.DP.INCLUDE_GLOBAL_EMAIL_CONTACT_LIST]?"checked":""}))),e){var t=this.getSelectableClusters(),n=this.getSelectableCategories(),i=this.getSelectableSeverities();this.renderConfigSelectors(e,t,n,i)}else this.addNewRuleConfig();this.applyNutanixInput({types:["checkbox"]}),this.$(".nutanixMoreInfo").nutanixMoreInfo({parseDataAttrs:!0}),this.isViewRendered=!0},refreshView:function(e){this.index=e.index||0,this.render()},destroy:function(){this.$(".nutanixMoreInfo").nutanixMoreInfo("destroy"),this.subViews.destroy(),this.subViews=null,e.prototype.destroy.apply(this,arguments)},onSave:function(e){var t=[],n={};if(_.each(this.subViews.getIds(),function(e){var i=this.subViews.get(e),s=i.getSelectedItems();if(e===this.model.DP.RECIPIENTS&&(!s||s.length<=0))t.push(this.i18n(this.model.DP.RULE_ATTRIBUTE_I18N_KEYS[e]));else{var a=e!==this.model.DP.MATCH_PHRASES&&e!==this.model.DP.RECIPIENTS&&_.find(s,function(e){return"_ALL_"===e});n[e]=a?[]:s||[]}},this),_.size(n)>0&&!this.clusterManager.isMulticlusterNavMode()&&(n[this.model.DP.CLUSTER_UUIDS]=[this.clusterManager.getCurrentClusterUuid()]),0!==t.length)this.showError(this.i18ns("missing_attributes_error",t.join(", ")));else{var i=n[this.model.DP.RECIPIENTS];_.some(i,function(e){return!s.validEmail(e)})?this.showError(this.i18n("email_validation_error")):(n[this.model.DP.INCLUDE_GLOBAL_EMAIL_CONTACT_LIST]=this.$("#"+this.model.DP.INCLUDE_GLOBAL_EMAIL_CONTACT_LIST).is(":checked"),this.configRules[this.index]=n,e())}},itemSelectionChangeEvent:function(e,t,n){var i,s=$(e.currentTarget);if(s.hasClass(r.CLUSTER)?i=this.getSelectableClusters():s.hasClass(r.CATEGORY)?i=this.getSelectableCategories():s.hasClass(r.SEVERITY)&&(i=this.getSelectableSeverities()),i){var a=n.getSelectedItems();n.setSelectableItems(this.getSelectableItems(a,i))}},addNewRuleConfig:function(){var e=this.getSelectableClusters(),t=this.getSelectableCategories(),n=this.getSelectableSeverities(),i={};this.renderConfigSelectors(i,e,t,n)},renderConfigSelectors:function(e,n,i,s){var a=new t({el:".recipientInput",placeholder:this.i18n("recipient_email_placeholder"),inputType:t.INPUT_TYPES.INPUT,selectedItems:this.cloneSelectedItems(e[this.model.DP.RECIPIENTS])});if(a.render(),this.subViews.register(this.model.DP.RECIPIENTS,a),this.clusterManager.isMulticlusterNavMode()){var o=this.cloneSelectedItems(e[this.model.DP.CLUSTER_UUIDS]);a=new t({el:"."+r.CLUSTER,initalSelectPrompt:this.i18n("cluster_label"),inputType:t.INPUT_TYPES.SELECT,selectedItems:o,selectableItems:this.getSelectableItems(o,n)}),a.render(),a.onSelectionChangeEvent(this.itemSelectionChangeEvent),this.subViews.register(this.model.DP.CLUSTER_UUIDS,a)}var l=this.cloneSelectedItems(e[this.model.DP.CATEGORIES]);a=new t({el:"."+r.CATEGORY,initalSelectPrompt:this.i18n("impact_type_label"),inputType:t.INPUT_TYPES.SELECT,selectedItems:l,selectableItems:this.getSelectableItems(l,i)}),a.render(),a.onSelectionChangeEvent(this.itemSelectionChangeEvent),this.subViews.register(this.model.DP.CATEGORIES,a);var c=this.cloneSelectedItems(e[this.model.DP.SEVERITIES]);a=new t({el:"."+r.SEVERITY,initalSelectPrompt:this.i18n("severity_label"),inputType:t.INPUT_TYPES.SELECT,selectedItems:c,selectableItems:this.getSelectableItems(c,s)}),a.render(),a.onSelectionChangeEvent(this.itemSelectionChangeEvent),this.subViews.register(this.model.DP.SEVERITIES,a),a=new t({el:".matchPhraseInput",placeholder:this.i18n("match_phrase_placeholder"),inputType:t.INPUT_TYPES.INPUT,selectedItems:this.cloneSelectedItems(e[this.model.DP.MATCH_PHRASES],!0)}),a.render(),this.subViews.register(this.model.DP.MATCH_PHRASES,a)},getSelectableClusters:function(){var e,t=this.clusterManager.getClusterCollection();return e=_.map(t.models,function(e){return{id:e.getClusterUuid(),name:e.getName()}}),this.clusterManager.isMulticlusterNavMode()&&e.unshift({id:this.clusterManager.getPrismCentralClusterUuid(),name:n.MULTICLUSTER_NAME}),e},getSelectableCategories:function(){return _.map(n.ALERT_IMPACT_TYPES,function(e,t){return{id:t,name:e[0]}})},getSelectableSeverities:function(){return _.map(n.ALERT_SEVERITY_NAMES,function(e,t){return{id:e,name:t.replace(/^\k/,"")}})},getSelectableItems:function(e,t){return _.find(e,function(e){return"_ALL_"===e})?[{id:"_ALL_",name:this.i18n("all_label")}]:e.length>0?t:[{id:"_ALL_",name:this.i18n("all_label")}].concat(t)},cloneSelectedItems:function(e,t){return!e||0===e.length&&t?[]:e&&0===e.length?["_ALL_"]:e.slice(0)}})}),define("views/wizards/alert/AlertRulesListPage",["views/basecomponents/wizards/BaseWizardPage","views/wizards/alert/AlertRulesListView","views/wizards/alert/AlertRulesPage","models/alert/AlertConfigModel","utils/AppUtil","utils/AppConstants","utils/SubViewHelper"],function(e,t,n,i,s,a,o){"use strict";return e.extend({initialized:!1,mode:a.ACTION_LIST,configRules:null,subViewHelper:null,canModify:!1,name:"AlertRulesListPage",initialize:function(t){e.prototype.initialize.apply(this,arguments),this.subViewHelper=new o,this.model=new i,this.mode=a.ACTION_LIST,this.canModify=this.canModifyByEntityType(a.ENTITY_ALERT_CONFIGURATION)},render:function(){if(this.initialized)if(this.isViewRendered)this.refreshView();else{var e=this.model.get(this.model.DP.EMAIL_CONFIG_RULE);this.configRules=e?JSON.parse(JSON.stringify(e)):[],this.mode=a.ACTION_LIST,this.$el.html(_.template('<div id="rulesListContainer"></div>\n        <div id="ruleEditorContainer" class="rule-container">\n      </div>',this.vtOptions())),this._switchView({action:this.mode}),this.isViewRendered=!0}else this.$el.html(_.template('<div class="no-data page-loading-message">\n        <div class="donut-loader-blue"></div>\n        <span><%= i18n("loading") %></span>\n      </div>',this.vtOptions())),this._fetchData()},destroy:function(){this.subViewHelper.destroy(),this.subViewHelper=null,e.prototype.destroy.apply(this,arguments)},canEnablePageLink:function(e){return this.mode===a.ACTION_LIST},canTransitionPage:function(e){return!0},onPageCancel:function(){return!0},onPageBack:function(){return this._switchView({action:a.ACTION_LIST}),!1},getButtonLabel:function(e){return e<1?"< "+this.i18n("back"):null},getSaveButtonLabel:function(){return this.mode===a.ACTION_LIST?this.canModify?this.i18n("save"):this.i18n("close"):this.i18n("apply")},onPageTransition:function(e){if(this.canModify)if(this.mode===a.ACTION_UPDATE||this.mode===a.ACTION_CREATE){var t=this._getCurrentSubView(),n=this;t.onSave(function(){n._switchView({action:a.ACTION_LIST})})}else this._saveEmailConfigRule(e);else this.showWarning(this.i18n("can_not_modify")),e()},showCancelButton:function(){return this.canModify},hideSaveButton:function(){return this.mode===a.ACTION_UPDATE||this.mode===a.ACTION_CREATE},hidePreviousButton:function(){return this.mode!==a.ACTION_UPDATE&&this.mode!==a.ACTION_CREATE},canApplyPageChanges:function(){return this.canModify},onClickLinkAction:function(e){var t=$(e.currentTarget),n={action:t.attr(a.NAV_ACTION),actionTargetId:t.attr(a.NAV_ACTION_TARGET_ID)};n.action!==a.ACTION_CREATE&&n.action!==a.ACTION_UPDATE||this._switchView(n)},_saveEmailConfigRule:function(e){if(!this.initialized)return this.showWarning(this.i18n("not_initialized")),void e();var t=this.configRules.filter(Boolean);if(this.model.hasEmailConfigChanged(t)){var n=this.model.get(this.model.DP.EMAIL_CONFIG_RULE);this.model.set(this.model.DP.EMAIL_CONFIG_RULE,t),this.showInfo(this.i18n("saving"));var i=this;this.model.isNew(!1),this.model.save(null,{success:function(){i.getWizard().showHeaderSuccess(i.i18n("rules_update_success")),e()},error:function(e,t){i.model.set(i.model.DP.EMAIL_CONFIG_RULE,n),i.showError(i.i18n("rules_update_error")+" "+t.responseText)}})}else this.showInfo(this.i18n("no_new_changes")),e()},_getSubViewId:function(){return this.mode===a.ACTION_LIST?a.ACTION_LIST:a.ACTION_CREATE},_getCurrentSubView:function(){return this.subViewHelper.get(this._getSubViewId())},_switchView:function(e){var i=this._getCurrentSubView();i&&(i.hideView(),this.getWizard().clearHeader()),this.mode=e.action;var s=this._getCurrentSubView();if($(".btnPrevious").removeClass("btnBack"),this.mode===a.ACTION_LIST)s?s.refreshView():(s=new t({el:"#rulesListContainer",model:this.model,configRules:this.configRules}),s.setParentView(this),this.subViewHelper.register(a.ACTION_LIST,s),s.render()),s.showView();else{var o;e.action===a.ACTION_CREATE?(o=this.configRules?this.configRules.length:0,$(".btnPrevious").addClass("btnBack")):o=e.actionTargetId,s?(s.showView(),s.refreshView({index:o})):(s=new n({el:"#ruleEditorContainer",model:this.model,configRules:this.configRules,index:o}),s.setParentView(this),this.subViewHelper.register(a.ACTION_CREATE,s),s.render(),s.showView())}this.getWizard().setButtonStates()},_fetchData:function(){var e=this;this.model.fetch().done(function(){e.initialized=!0,e.render()}).fail(function(t){e.$(".page-loading-message").hide(),e.showError(e.i18n("alert_config_load_error")+" "+s.processThrownError(t))})}})}),define("text!templates/wizards/alert/AlertEmailTemplatePage.html",[],function(){return'<div class="n-modal-content alert-template">\n  <div data-ntnx-content-inner>\n    <section data-ntnx-section>\n      <h5 data-ntnx-title class="preview"><%= i18n(\'preview\') %></h5>\n    </section>\n    <section data-ntnx-section>\n      <table class="table readonly-table">\n        <tr>\n          <th><%= i18n(\'subject\') %></th>\n          <td>\n            <span class="sampleSubjectPrefix highlighted">\n              <%= subjectPrefix %>\n            </span>\n            <%= i18n(\'data_disk_space_usage_high\') %>\n          </td>\n        </tr>\n        <tr>\n          <th>Body</th>\n          <td>\n            <div><%= i18n("example_email_body_template") %></div>\n            <span class="sampleBodySuffix highlighted">\n              <%= bodySuffix %>\n            </span>\n          </td>\n        </tr>\n      </table>\n    </section>\n    <section data-ntnx-section>\n      <label data-ntnx-label>\n        <%= i18n(\'prepend_content_to_email_subject\') %>\n      </label>\n        <input type="text" class="n-input subjectPrefix"\n               <%= canModify? \'\' : \'disabled\'%>\n               value="<%= subjectPrefix%>">\n    </section>\n    <section data-ntnx-section>\n      <label data-ntnx-label>\n        <%= i18n(\'append_content_to_email_body\') %>\n      </label>\n      <input type="text" class="n-input bodySuffix"\n             <%= canModify? \'\' : \'disabled\'%>\n             value="<%= bodySuffix%>">\n    </section>\n  </div>\n</div>'}),define("views/wizards/alert/AlertEmailTemplatePage",["views/basecomponents/wizards/BaseWizardPage","models/alert/AlertConfigModel","utils/SubViewHelper","utils/AppUtil","utils/AppConstants","text!templates/wizards/alert/AlertEmailTemplatePage.html"],function(e,t,n,i,s,a){"use strict";var o=_.template('<div class="no-data page-loading-message"> <div class="donut-loader-blue"></div><span><%= i18n("loading") %></span></div>'),r="Input content contains unsupported HTML tag(s) or attribute(s).";return e.extend({initialized:!1,name:"AlertEmailTemplatePage",events:{"keydown input.subjectPrefix":"onSubjectPrefix","keydown input.bodySuffix":"onBodySuffix"},canModify:!1,initialize:function(i){e.prototype.initialize.apply(this,arguments),this.subViewHelper=new n,this.model=new t,this.canModify=this.canModifyByEntityType(s.ENTITY_ALERT_CONFIGURATION)},render:function(){this.initialized?this.isViewRendered?this.refreshView():(this.$el.html(_.template(a,this.vtOptions({subjectPrefix:i.stripInvalidTagsAndAttributes(this.model.getTemplateSubjectPrefix()),bodySuffix:i.stripInvalidTagsAndAttributes(this.model.getTemplateBodyPrefix()),canModify:this.canModify}))),this.isViewRendered=!0,this.applyNutanixInput()):(this.$el.html(o(this.vtOptions())),this.fetchData())},canEnablePageLink:function(){return!0},canTransitionPage:function(e){return!0},onPageCancel:function(){return!0},getSaveButtonLabel:function(){return this.canModify?this.i18n("save"):this.i18n("close")},getButtonLabel:function(e){return e<1?"< "+this.i18n("back"):this.i18n("apply")},showCancelButton:function(){return this.canModify},hidePreviousButton:function(){return!0},canApplyPageChanges:function(){return this.canModify},onPageTransition:function(e){if(!this.initialized||!this.canModify){var t=this.initialized?"can_not_modify":"not_initialized";return this.showWarning(this.i18n(t)),void e()}var n=$.trim(this.$(".subjectPrefix").val()),s=$.trim(this.$(".bodySuffix").val());if(s=s.replace(/(\r\n|\n|\r)/gm,""),""===n&&(n=null),""===s&&(s=null),i.hasInvalidTagAndAttributes(n)||i.hasInvalidTagAndAttributes(s))return void this.showError(r);if(this.model.hasEmailTemplateChanged(n,s)){var a=this.model.get(this.model.DP.EMAIL_TEMPLATE),o={};o[this.model.DP.SUBJECT_PREFIX]=n,o[this.model.DP.BODY_PREFIX]=s,this.model.set(this.model.DP.EMAIL_TEMPLATE,o),this.showInfo(this.i18n("saving"));var l=this;this.model.isNew(!1),this.model.save(null,{success:function(){l.showSuccess(l.i18n("template_update_success")),e()},error:function(e,t){l.model.set(l.model.DP.EMAIL_TEMPLATE,a),l.showError(l.i18n("template_update_success")+" "+t.responseText)}})}else this.showInfo(this.i18n("no_new_changes")),e()},onSubjectPrefix:_.debounce(function(e){var t=this.$(e.currentTarget).val();i.hasInvalidTagAndAttributes(t)?(this.showError(r),this.$(".sampleSubjectPrefix").html("")):this.$(".sampleSubjectPrefix").html(t)},100),onBodySuffix:_.debounce(function(e){var t=this.$(e.currentTarget).val();i.hasInvalidTagAndAttributes(t)?(this.showError(r),this.$(".sampleBodySuffix").html("")):this.$(".sampleBodySuffix").html(t)},100),fetchData:function(){var e=this;this.model.fetch().done(function(){e.initialized=!0,e.render()}).fail(function(t){e.$(".page-loading-message").hide(),e.showError("Error loading alert policy: "+i.processThrownError(t))})}})}),define("views/wizards/alert/AlertConfigWizard",["views/basecomponents/wizards/WizardView","views/wizards/alert/AlertServicesPage","views/wizards/alert/AlertRulesListPage","views/wizards/alert/AlertEmailTemplatePage","utils/AppConstants"],function(e,t,n,i,s){"use strict";var a=_.template("Alert emails sent by <%= pc %> are in addition to any emails sent from <%= pe %>.");return e.extend({show:function(s){var a=[{id:"alert-services",title:"Settings",klass:t},{id:"alert-rules",title:"Rules",klass:n},{id:"alert-template",title:"Template",klass:i}];this.initializeWizard({title:"Alert Email Configuration",wizardType:e.WIZARD_TYPES.ADHOC,pages:a}),this.$el.addClass("alertConfigPopup"),e.prototype.show.apply(this,arguments)},checkPrerequisites:function(){this.clusterManager.isMulticlusterNavMode()&&this.showHeaderInfo(a({pc:s.MULTICLUSTER_NAME,pe:s.SINGLE_CLUSTER_NAME}))},clearHeader:function(){this.$(".alert-info").is(":visible")||e.prototype.clearHeader.apply(this,arguments)}})}),define("text!templates/popups/capacityplanning/WhatIfPopupView.html",[],function(){return'<div class="modal-header">\n  <button type="button" class="close"\n      data-dismiss="modal">\n    <i data-icon="K" aria-hidden="true"></i>\n  </button>\n  <h4 class="n-title">Add New Nodes</h4>\n</div>\n\n<div class="n-modal-wrapper">\n  <div class="n-modal-body disabled">\n    <div class="n-modal-content-wrapper">\n      <div class="customWorkloadSelector">\n        \x3c!-- For now hard corded workloads --\x3e\n        <div class="workload-type">\n          Use existing workload for size estimation\n        </div>\n      </div>\n      <div class="whatifTable what-if-table"></div>\n    </div>\n  </div>\n\n  <div class="n-modal-footer">\n    <button class="btnCancel btn">\n      Cancel\n    </button>\n  </div>\n</div>\n'}),define("views/popups/capacityplanning/WhatIfPopupView",["views/basecomponents/popups/BasePopupView","utils/AppConstants","data/DataProperties","text!templates/popups/capacityplanning/WhatIfPopupView.html"],function(e,t,n,i){"use strict";var s=_.template('<tr class="n-table-row"><td><%= model %></td><td><span data-quantity-row-id = "<%= model %>"><%= quantity %></span></td><td><%= desc %></td></tr>'),a=_.template("<th> <%= columnName %> </th>"),o={TABLE:"TABLE"};return e.extend({el:"#popupWhatIfView",subViewTemplate:_.template(i),events:{"click  .modal-header .close":"hide","click .n-modal-footer .btnCancel":"hide"},whatIfModel:null,render:function(){this.$el.html(this.subViewTemplate()),this.renderWhatIfView(),this.applyNutanixInput()},renderWhatIfView:function(){var e=!1;this.unitInTime="",this.whatIfModel=this.actionRoute[t.NAV_ACTION_TARGET_ID],this.$(".whatifTable").append('<table id= whatifTable class="table table-hover"><thead><tr class ="n-table-row table-header-row"></tr></thead><tbody></tbody></table>');var i=this.$(".whatifTable .table-header-row");_.each(this.whatIfModel.get(n.CP.WHATIF.ENTITIES),function(t){_.each(t.perspectives,function(t){t.result.headers.length&&(e=!0),t.format===o.TABLE&&(_.each(t.result.headers,function(e){i.append(a({columnName:e.columnName}))}),_.each(t.result.rows,function(e){this.$("#whatifTable tbody").append(s({model:e.rowData[0],quantity:e.rowData[1]||"",desc:e.rowData[2]||""}))},this))},this)},this),e||this.$(".n-modal-content-wrapper").html('<div class="not-avail"> What If Analysis results are not available at this time </div>')}})}),define("text!templates/popups/clusterhealth/RunChecksPopupView.html",[],function(){
return'\x3c!-- The parent div is #popupRunChecks --\x3e\n<div class="modal-header">\n  <button type="button" class="close" data-dismiss="modal"\n          id="node-convert-popup-close">\n    <i data-icon="K" aria-hidden="true"></i>\n  </button>\n  <h4 class="n-title">\n    Run Checks\n  </h4>\n</div>\n<div class="n-modal-wrapper">\n  <div class="n-modal-body">\n    <div class="n-modal-content-wrapper">\n      <div class="n-modal-alert-header">\n        \x3c!-- @view: alert goes here... --\x3e\n      </div>\n      <% if (!initialized) { %>\n        <section class="loading">\n          <span class="n-loading-icon"></span>\n          Loading...\n        </section>\n      <% } else { %>\n        <section class="checks">\n          <div class="n-desc-title">Select checks you want to run:</div>\n          <div class="check-options">\n            <% _.each(checkOptions, function (checkOption, index) {\n                 if (checkOption.count !== 0) {\n            %>\n              <div>\n                <%= Components.radio({\n                  name    : \'check-option\',\n                  value   : checkOption.value,\n                  checked : index === 0\n                }) %>\n                <label>\n                  <%= checkOption.title %>\n                  <%= checkOption.count ? \'(\' + checkOption.count +\')\' : \'\' %>\n                </label>\n              </div>\n            <%  }\n              }) %>\n          </div>\n          <div class="specific-checks" style="display:none">\n            <div class="search-input">\n              \x3c!-- Do not break placeholder line to prevent unwanted\n              whitespace --\x3e\n              <input type="text" class="search-check"\n                     placeholder="Search for checks and add it to the checks to be executed"/>\n            </div>\n            <div class="check-config">\n              <div class="section-content">\n                \x3c!-- Checks section goes here --\x3e\n              </div>\n            </div>\n          </div>\n        </section>\n        <section class="mail">\n          <div class="title">\n            <div>\n              <span class="send-mail-checkbox"\n                    <% if (!mailTos.length) {%>\n                      data-toggle="tooltip"\n                      title="<%= noAlertConfigMsg%>"\n                    <% } %>>\n                <%= Components.checkbox({\n                  jsClasses: \'send-mail\',\n                  checked: mailTos.length ,\n                  disabled: !(mailTos.length) }) %>\n              </span>\n              <label>Send the cluster check report in the email\n                <% if (mailTos.length) { %>\n                <span data-toggle="tooltip" class="n-tooltip-circle"\n                      title="<%= i18n(\'runCheckTooltip\') %>">?</span>\n                <% } %>\n              </label>\n            </div>\n          </div>\n          <div class="subtitle">\n            Recipients: <% if(mailTos.length) {%>\n            <%= mailTos.join(\', \') %>\n            <% } else { %>\n            none\n            <% } %>\n          </div>\n        </section>\n      <% } %>\n    </div>\n  </div>\n  <div class="n-modal-footer">\n    \x3c!-- Form buttons --\x3e\n    <button class="btn-cancel btn n-btn-form">\n      Cancel\n    </button>\n    <button class="btn-save btn-main btn btn-primary n-btn-form"\n            action="repair">\n      Run\n    </button>\n  </div>\n</div>\n'}),define("text!templates/basecomponents/pagepopups/PopupListView.html",[],function(){return'<%\n  if (typeof isCleanPopup !== \'undefined\') {\n    // TodoAfterPopupCleanup : remove this if/else statement\n    // and only keep what is in the if block\n%>\n\n  <% if (tableRows.length === 0) { %>\n\n    <% if (title) { %>\n      <h5 data-ntnx-title class="<%= titleClass %>"><%= title %></h5>\n    <% } %>\n\n    <section data-ntnx-section class="<%= typeof className === \'string\' ? className : \'\' %>">\n      <div data-ntnx-empty-list>\n        <section data-ntnx-section="type-text">\n          <%= emptyText %>\n        </section>\n        <section data-ntnx-section>\n          <%= Components.button({\n            isPrimary: true,\n            iconLeft: \'plus\',\n            text: btnText,\n            extraClasses: btnClass,\n            extraAttr: [,{\n              key: \'stream-action\',\n              value: streamAction\n            },{\n              key: \'stream-target\',\n              value: streamTarget\n            }],\n            dataTestAttribute: dataTest\n          }) %>\n        </section>\n      </div>\n    </section>\n\n  <% } else { %>\n\n    <% if (title) { %>\n      <h5 data-ntnx-title class="<%= titleClass %>">\n        <%= title %>\n        <a data-ntnx-title-link\n          class="<%= btnClass %>"\n          data-test="<%= dataTest %>"\n          stream-action="<%= streamAction %>"\n          stream-target="<%= streamTarget %>"\n        >\n          <%= Components.icon(\'plus\', \'-small\') %>\n          <%= btnText %>\n        </a>\n      </h5>\n    <% } %>\n\n    <% if (typeof tableDesc !== \'undefined\') { %>\n      <section data-ntnx-section="type-subtitle">\n        <%= tableDesc %>\n      </section>\n    <% } %>\n\n    <section data-ntnx-section class="<%= typeof className === \'string\' ? className : \'\' %>">\n      <table id="<%= tableId %>"\n        class="table table-hover"\n        data-test="<%= dataTableTest %>"\n      >\n        <thead>\n          <tr>\n            <% _.each(tableHeaders, function (header) { %>\n              <th class="<%= header.className %>">\n                <%= header.title %>\n              </th>\n            <% }) %>\n          </tr>\n        </thead>\n        <tbody>\n          <% _.each(tableRows, function (row) { %>\n            <%= row %>\n          <% }) %>\n        </tbody>\n      </table>\n    </section>\n\n  <% } %>\n\n<% } else { %>\n  <div>\n    <% if (tableRows.length === 0) { %>\n      <div class="control-group <%= typeof className === \'string\' ? className : \'\' %>">\n        <div class="controls">\n          <div class="control-add">\n            <span class="<%= titleClass %>">\n              <%= title %>\n            </span>\n          </div>\n        </div>\n      </div>\n      <div class="empty-list">\n        <div class="title">\n          <%= emptyText %>\n        </div>\n        <button type="button" class="btn -blue <%= btnClass %>"\n                data-test="<%= dataTest %>"\n                stream-action="<%= streamAction %>"\n                stream-target="<%= streamTarget %>">\n          <%= btnText %>\n        </button>\n      </div>\n    <% } else { %>\n      <div class="control-group <%= typeof className === \'string\' ? className : \'\' %>">\n        <div class="controls">\n          <div class="control-add">\n            <span class="<%= titleClass %>">\n              <%= title %>\n            </span>\n            <a class="add-btn <%= btnClass %>"\n               data-test="<%= dataTest %>"\n               stream-action="<%= streamAction %>"\n               stream-target="<%= streamTarget %>">\n              <i data-icon="H" aria-hidden="true"></i>\n              <%= btnText %>\n            </a>\n          </div>\n          <table id="<%= tableId %>" class="table table-hover"\n                 data-test="<%= dataTableTest %>">\n            <thead>\n            <tr>\n              <% _.each(tableHeaders, function (header) { %>\n                <th class="<%= header.className %>">\n                  <%= header.title %>\n                </th>\n              <% }) %>\n            </tr>\n            </thead>\n            <tbody>\n              <% _.each(tableRows, function (row) { %>\n                <%= row %>\n              <% }) %>\n            </tbody>\n          </table>\n        </div>\n      </div>\n    <% } %>\n  </div>\n<% } %>\n'}),define("views/popups/clusterhealth/RunChecksPopupView",["backbone","views/basecomponents/popups/BasePopupView","components/Components","models/cluster/TestsCollection","models/cluster/ClusterHealthStatsModel","models/alert/AlertConfigModel","models/ncc/RunCheckModel","data/DataProperties","utils/AppConstants","utils/AppUtil","text!templates/popups/clusterhealth/RunChecksPopupView.html","text!templates/basecomponents/pagepopups/PopupListView.html"],function(e,t,n,i,s,a,o,r,l,c,d,p){"use strict";d=_.template(d),p=_.template(p);var u=_.template('<a class="check-item"><div class="title"><%= title %></div><div class="subtitle"><%= subtitle %></div></a>'),h=_.template('<tr class="n-table-row"><td  class="name-cell"><%= name %></td><td  class="category-cell"><%= category %></td><td class="cell-actions"><i class="btn-delete" data-icon="v" aria-hidden="true" actionTargetId="<%= id %>"></i></td></tr>');return t.extend({CHECK_TYPE:{ALL:"all",FAILED:"failed",SPECIFIC:"specific"},el:"#popupRunChecks",name:"RunChecksPopupView",testCollection:null,testResultsModel:null,alertConfigModel:null,testsToRun:null,failedAndWarningTestIds:null,runChecksModel:null,dataLoaded:!1,events:{"click  .modal-header .close":"hide","click  .btn-main":"runChecks","click  .btn-cancel":"hide",'click  input[name="check-option"]':"onCheckOptionClick","click  #check-list .btn-delete":"removeCheck"},initialize:function(){t.prototype.initialize.apply(this,arguments),this.testCollection=new i,this.testResultsModel=new s,this.testResultsModel.setRequestDetailedStats(!0),this.alertConfigModel=new a,this.testsToRun=[],this.runChecksModel=new o},render:function(){if(this.dataLoaded){var e=this.testCollection.map(function(e){return c.getEntityIdWithoutClusterId(e.get(r.ID))});this.failedAndWarningTestIds=_.intersect(_.union(this.testResultsModel.getFailedTestIds(),this.testResultsModel.getWarningTestIds()),e);var t=[{value:this.CHECK_TYPE.ALL,title:this.i18n("allChecksLabel"),count:this.testCollection.length},{value:this.CHECK_TYPE.FAILED,title:this.i18n("failedChecksLabel"),count:this.failedAndWarningTestIds.length},{value:this.CHECK_TYPE.SPECIFIC,title:this.i18n("specificChecksLabel"),count:null}],i=this.getRecipientList();this.$el.html(d(this.vtOptions({initialized:!0,Components:n,checkOptions:t,mailTos:i,noAlertConfigMsg:this.i18n("noEmailConfig")}))),this.$(".n-tooltip-circle").tooltip({placement:"right",trigger:"hover",html:!1}),this.$(".send-mail-checkbox").tooltip({placement:"right",trigger:"hover",html:!1}),this.renderSpecificChecks(),this.initChecksAutoComplete()}else this.$el.html(d({initialized:!1})),c.addInLineDonutLoader(this.$el.find(".n-loading-icon")),this.loadDataAndRender()},destroy:function(){this.$("input.search-check").autocomplete("destroy"),this.$(".n-tooltip-circle").tooltip("destroy"),this.$(".send-mail-checkbox").tooltip("destroy"),t.prototype.destroy.apply(this,arguments)},loadDataAndRender:function(){var e=this,t=[this.testCollection.fetch(),this.testResultsModel.fetch(),this.alertConfigModel.fetch()];$.when.apply($,t).then(function(){e.dataLoaded=!0,e.testCollection=new i(e.testCollection.filter(function(e){return e.get(r.ENABLED)&&e.get(r.TEST_CHECK_TYPE)!==r.HEALTH_CHECK_TYPE_VALUES.EVENT_DRIVEN},e)),e.render(),e.isClusterFFEnabled(l.FFLAGS.HELP_DOC)&&e.createHelpIcon(e.actionRoute)}).fail(function(t){e.showHeaderError(_.isObject(t)?c.processAjaxError(t.responseText):t),e.$("section.loading").hide()})},initChecksAutoComplete:function(){var e=this,t=this.$("input.search-check");t.autocomplete({source:e.getChecksForAutoComplete(),delay:0,autoFocus:!0,select:function(n,i){return e.addCheck(i.item.testId),t.val(""),t.autocomplete("option","source",e.getChecksForAutoComplete()),!1}});var n=t.data("autocomplete");n.menu.element.addClass("modal-autocomplete"),n._renderItem=this.renderAutoCompleteItem.bind(this)},getChecksForAutoComplete:function(){var e=[];return this.testCollection.each(function(t){_.contains(this.testsToRun,t.get(t.idAttribute))||e.push({label:t.getDisplayName(),value:t.getDisplayName(),testId:t.get(t.idAttribute),category:t.getTestCategory()})},this),e},getRecipientList:function(){var e=[];if(this.alertConfigModel){var t=this.alertConfigModel.get(r.ALERT_CONFIG_DEFAULT_EMAIL_ID),n=this.alertConfigModel.get(r.ALERT_CONFIG_EMAIL_CONTACT_LIST);this.alertConfigModel.get(r.ALERT_CONFIG_DEFAULT_EMAIL)&&t&&e.push(t),_.each(n,function(t){e.push(t)},this)}return e},onCheckOptionClick:function(){var e=this.$('input[name="check-option"]:checked').val(),t=this.$(".specific-checks");e===this.CHECK_TYPE.SPECIFIC?(t.slideDown(100),this.setMainButtonState()):(t.slideUp(100),this.$(".btn-main").prop("disabled",!1))},findCheck:function(e,t){return t.find(function(t){return e===t.get(r.ID)})},addCheck:function(e){this.findCheck(e,this.testCollection);_.indexOf(this.testsToRun,e)<0&&(this.testsToRun.push(e),this.renderSpecificChecks()),this.setMainButtonState()},removeCheck:function(e){var t=this,n=$(e.currentTarget).attr(l.NAV_ACTION_TARGET_ID);this.testCollection.find(function(e){return n===e.get(r.ID)},this)&&(this.testsToRun=_.without(this.testsToRun,n),this.renderSpecificChecks()),this.setMainButtonState(),this.$("input.search-check").autocomplete("option","source",t.getChecksForAutoComplete())},setMainButtonState:function(){this.$(".btn-main").prop("disabled",0===this.testsToRun.length)},renderAutoCompleteItem:function(e,t){return $("<li></li>").data("item.autocomplete",t).append(u({title:t.label,subtitle:t.category})).appendTo(e)},renderSpecificChecks:function(){var e=this.$(".check-config .section-content"),t=[{className:"name-cell",title:"Check"},{className:"category-cell",title:"Category"},{className:"cell-actions",title:"&nbsp;"}],n=[];_.each(this.testsToRun,function(e){var t=this.findCheck(e,this.testCollection);n.push(h({name:t.getDisplayName(),category:t.getTestCategory(),id:t.get(t.idAttribute)}))},this);var i=p({className:"check-controls",btnClass:"btn-add-check",dataTest:"addCheckBtn",streamAction:"add",streamTarget:"check",tableId:"check-list",dataTableTest:"checkTable",emptyText:"You haven't added any checks yet.",btnText:"",title:"Added Checks ("+n.length+")",titleClass:"n-title",tableHeaders:t,tableRows:n});e.html(i)},getSelectedCheckList:function(){var e=[];return _.each(this.testsToRun,function(t){e.push(c.getEntityIdWithoutClusterId(t))},this),e},runChecks:function(){var e=this,t=this.$('input[name="check-option"]:checked').val(),n=[];switch(t){case this.CHECK_TYPE.ALL:n=null;break;case this.CHECK_TYPE.FAILED:n=this.failedAndWarningTestIds;break;case this.CHECK_TYPE.SPECIFIC:n=this.getSelectedCheckList()}this.$(".btn-main").prop("disabled",!0),n?this.runChecksModel.set(o.DP.NCC_CHECKS,n):this.runChecksModel.set(o.DP.NCC_CHECKS),this.runChecksModel.set(o.DP.SEND_MAIL,this.$(".send-mail").is(":checked")),this.runChecksModel.save(null,{success:function(){e.hide()},error:function(t,n){e.runChecksModel.hideLatencyNotification(),e.showHeaderError(_.isObject(n)?c.processAjaxError(n.responseText):n),e.$(".btn-main").prop("disabled",!1)}})}})}),define("models/ncc/NccScheduleModel",["models/BaseModel","data/DataURLConstants","data/DataProperties"],function(e,t,n){"use strict";return e.extend({DP:n,urlRoot:t.NCC_SCHEDULE,idAttribute:n.ID,nameAttribute:n.NAME,name:"NccScheduleModel",defaults:{daysOfTheWeek:[],periodicity:null,multiple:0,startTimeInUsecs:0},getURL:function(){return this.urlRoot},getValue:function(t){return t===this.nameAttribute?"NccSchedule":e.prototype.getValue.apply(this,arguments)}},{DP:n})}),define("text!templates/popups/clusterhealth/NccFrequencyPopupContent.html",[],function(){return'\x3c!-- The parent div is #NccFrequencyPopupView --\x3e\n\n<% if (!initialized) { %>\n<div data-ntnx-content-inner>\n  <section class="loading" data-ntnx-section="type-text">\n    <span class="n-loading-icon"></span>\n    <%= i18n(\'loading\') %>\n  </section>\n</div>\n<% } else { %>\n<div data-ntnx-content-inner>\n  <section data-ntnx-section id="scheduleWrapper">\n    <label data-ntnx-label>\n      <%= i18n(\'labelFrequency\') %>\n    </label>\n    <select id="scheduleType" class="schedule-type"\n            data-test="frequency">\n      <option value="<%=SCHEDULE_TYPE.HOURLY %>"\n              <%= (periodicity === SCHEDULE_TYPE.HOURLY)? \'selected\' : \'\'%>\n              data-test="frequency-hourly">\n        <%= i18ns(SCHEDULE_TYPE.HOURLY)%>\n      </option>\n      <option value="<%=SCHEDULE_TYPE.DAILY %>"\n              <%= periodicity === SCHEDULE_TYPE.DAILY? \'selected\' : \'\'%>\n              data-test="frequency-daily">\n        <%= i18n(SCHEDULE_TYPE.DAILY)%>\n      </option>\n      <option value="<%=SCHEDULE_TYPE.WEEKLY %>"\n              <%= periodicity === SCHEDULE_TYPE.WEEKLY? \'selected\' : \'\'%>\n              data-test="frequency-weekly">\n        <%= i18n(SCHEDULE_TYPE.WEEKLY)%>\n      </option>\n    </select>\n  </section>\n  <section data-ntnx-section\n           class="<%= periodicity !== SCHEDULE_TYPE.WEEKLY? \'hide\' : \'\'%>"\n           id="weekDayWrapper">\n    <label data-ntnx-label>\n      <%= i18n(\'labelDaysOfWeek\') %>\n    </label>\n    <div class="btn-group btn-group-justified" role="group"\n         aria-label="week days">\n      <% _.each(weekDays, function(day, index) { %>\n      <div class="btn-group" role="group">\n        <button class="btn btn-default <%= (day.selected)? \'n-primary-btn\': \'\' %>"\n                type="button" value="<%=day.value%>"\n                data-test="day<%=index%>">\n          <%= day.value %></button>\n      </div>\n      <% }); %>\n    </div>\n  </section>\n  <section data-ntnx-section\n           class="<%= periodicity === SCHEDULE_TYPE.HOURLY? \'hide\': \'\'%>"\n           id="startTimeWrapper">\n    <label data-ntnx-label>\n      <%= i18n(\'labelStartTime\') %>\n    </label>\n    <div class="start-time input-group input-append bootstrap-timepicker">\n      <input id="startTime" type="text"\n             class="input-small date-time form-control"\n             data-test="start-time-input">\n      <span class="input-group-addon add-on" data-test="start-time-addon">\n        <i class="glyphicon glyphicon-time"></i></span>\n    </div>\n  </section>\n\n  <section data-ntnx-section="type-separator">\n    <label data-ntnx-title><%= i18n(\'emailReport\')%></label>\n    <div class="subtitle">\n      <span class="email-desc">\n        <%= function() {\n          if (emailConfigured) {\n            return i18n(\'emailConfiguredDesc\')\n          }  else {\n            return i18n(\'emailNotConfiguredDesc\')\n          }\n        }() %>\n      </span>\n    </div>\n    <% if(mailTo.length) {%>\n      <table id="email-list" class="table table-hover"\n             data-test="emailTable">\n        <thead>\n          <tr><th class="email-cell"><%=i18n(\'labelEmail\')%></th></tr>\n        </thead>\n        <tbody>\n          <% _.each(mailTo, function(email) { %>\n            <tr class="n-table-row">\n              <td class="email-cell"><%= email %></td>\n            </tr>\n          <% }) %>\n        </tbody>\n      </table>\n    <% } %>\n  </section>\n</div>\n<% } %>\n'});var _slicedToArray=function(){function e(e,t){var n=[],i=!0,s=!1,a=void 0;try{for(var o,r=e[Symbol.iterator]();!(i=(o=r.next()).done)&&(n.push(o.value),!t||n.length!==t);i=!0);}catch(e){s=!0,a=e}finally{try{!i&&r.return&&r.return()}finally{if(s)throw a}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();define("views/popups/clusterhealth/NccFrequencyPopupView",["views/basecomponents/popups/BasePopupView","components/Components","managers/I18nManager","models/ncc/NccScheduleModel","models/alert/AlertConfigModel","data/DataProperties","utils/AppConstants","utils/AppUtil","utils/TimeUtil","text!templates/popups/clusterhealth/NccFrequencyPopupContent.html"],function(e,t,n,i,s,a,o,r,l,c){"use strict";c=_.template(c);return e.extend({SCHEDULE_TYPE:{HOURLY:"HOURLY",DAILY:"DAILY",WEEKLY:"WEEKLY"},el:"#popupNccFrequency",name:"NccFrequencyPopupView",scheduleModel:null,alertConfigModel:null,dataLoaded:!1,selectedDays:{},hasSchedule:!1,events:{"click .modal-header .close":"hide","click .btn-cancel":"hide","click .btn-save":"createOrUpdate","click .btnUnregister":"removeSchedule","click #weekDayWrapper .btn-group .btn":"toggleDaySelection","change #scheduleType":"onScheduleTypeChange"},initialize:function(){e.prototype.initialize.apply(this,arguments),this.scheduleModel=new i,this.alertConfigModel=new s},render:function(){var e={leftAligned:!0,extraClasses:"btnUnregister",text:this.i18n("remove_schedule"),extraAttr:[{key:"data-test",value:"schedule-delete"}]};if(this.dataLoaded){var i=this.scheduleModel.DP,s=this.scheduleModel.get(i.NCC_CHECKS_PERIODICITY),a=new Date;if(this.hasSchedule){var d=this.scheduleModel.get(i.NCC_CHECKS_START_TIME);a.setTime(d/o.MICROS_PER_MILLI);var p=this.scheduleModel.get(i.NCC_CHECKS_DAYS_OF_THE_WEEK),u=n.t("TimeUtil","dates.daysMin"),h=_.map(l.getDaysOfAWeek(),function(e){return e.toUpperCase()});_.each(p,function(e){var t=h.indexOf(e.toUpperCase());this.selectedDays[u[t]]=!0},this)}else e.extraClasses+=" hide";var m=this.defaultFooter([e,{extraClasses:"btn-cancel",text:this.i18n("cancel"),extraAttr:[{key:"data-test",value:"schedule-cancel"}]},{isPrimary:!0,extraClasses:"btn-save",text:this.i18n("save"),extraAttr:[{key:"action",value:"save"},{key:"data-test",value:"schedule-save"}]}]),f=this.getRecipientList(),v=this.defaultTemplate({bodyContent:c(this.vtOptions({initialized:!0,SCHEDULE_TYPE:this.SCHEDULE_TYPE,Components:t,enableFrequency:this.hasSchedule,periodicity:s||this.SCHEDULE_TYPE.HOURLY,emailConfigured:Boolean(f.length),mailTo:f,weekDays:this.getWeekDaysData(this.selectedDays)})),title:this.i18n("setNccSchedule"),footerButtons:m});this.$el.html(v),this.$("#startTime").timepicker({template:"dropdown",showSeconds:!1,defaultTime:a}),0===a.getHours()&&$("#startTime").timepicker("setTime","12:"+a.getMinutes()+" AM"),this.applyNutanixInput(),this.triggerAction(o.MODAL.ACT.AS_REFRESH)}else{var g=this.defaultTemplate({bodyContent:c(this.vtOptions({initialized:!1})),title:this.i18n("setNccSchedule")});this.$el.html(g),r.addInLineDonutLoader(this.$el.find(".n-loading-icon")),this.loadDataAndRender()}},destroy:function(){this.$("input.search-check").autocomplete("destroy"),this.$(".n-tooltip-circle").tooltip("destroy"),e.prototype.destroy.apply(this,arguments)},loadDataAndRender:function(){var e=this,t=[this.scheduleModel.fetch(),this.alertConfigModel.fetch()];$.when.apply($,t).then(function(){e.selectedDays={},e.dataLoaded=!0;var t=e.scheduleModel.DP,n=e.scheduleModel.get(t.NCC_CHECKS_PERIODICITY);e.hasSchedule=Boolean(n),e.scheduleModel.isNew(!e.hasSchedule),e.render()}).fail(function(t){e.showHeaderError(_.isObject(t)?r.processAjaxError(t.responseText):t),e.$("section.loading").hide()})},getRecipientList:function(){var e=[];if(this.alertConfigModel){var t=this.alertConfigModel.get(a.ALERT_CONFIG_DEFAULT_EMAIL_ID),n=this.alertConfigModel.get(a.ALERT_CONFIG_EMAIL_CONTACT_LIST);this.alertConfigModel.get(a.ALERT_CONFIG_DEFAULT_EMAIL)&&t&&e.push(t),_.each(n,function(t){e.push(t)},this)}return e},onScheduleTypeChange:function(){var e=this.$("#scheduleType").val();e===this.SCHEDULE_TYPE.HOURLY?(this.$("#startTimeWrapper").hide(),this.$("#weekDayWrapper").hide()):e===this.SCHEDULE_TYPE.DAILY?(this.$("#startTimeWrapper").show(),this.$("#weekDayWrapper").hide()):(this.$("#weekDayWrapper").show(),this.$("#startTimeWrapper").show()),this.triggerAction(o.MODAL.ACT.TABS_SHOW)},toggleDaySelection:function(e){var t=$(e.currentTarget);this.selectedDays[t.val()]=!this.selectedDays[t.val()],t.toggleClass("n-primary-btn")},createOrUpdate:function(){var e=this.$("#scheduleType").val(),t=null;e===this.SCHEDULE_TYPE.HOURLY&&(t=4);var i=_.values(n.t("TimeUtil","dates.daysMin")),s=l.getDaysOfAWeek(),a=[],r=null,c=new Date,d=c.getDay(),p=c.getHours()*o.MINUTES_PER_HOUR+c.getMinutes(),u=this.$("#startTime").val().split(" "),h=_slicedToArray(u,2),m=h[0],f=h[1];f=f.toUpperCase();var v=m.split(":"),g=_slicedToArray(v,2),E=g[0],T=g[1];E=parseInt(E,10),"PM"===f&&12!==E?E+=12:E<10?E="0"+E:"AM"===f&&12===E&&(E-=12);var C=E*o.MINUTES_PER_HOUR+parseInt(T,10),S=null;this.$("#weekDayWrapper .btn-default.n-primary-btn:visible").each(function(e,t){var n=i.indexOf($(t).val()),o=s[n];S||(S=n),!r&&(d<n||d===n&&p<C)&&(r=n),a.push(o.toUpperCase())}),r||(r=S);var A=E+":"+T,b=l.calculateStartTime(e,A,{dayOfWeek:r}),y=this.scheduleModel.DP;this.scheduleModel.set(y.NCC_CHECKS_PERIODICITY,e),this.scheduleModel.set(y.NCC_CHECKS_MULTIPLE,t),e===this.SCHEDULE_TYPE.HOURLY?this.scheduleModel.set(y.NCC_CHECKS_START_TIME,null,{unset:!0}):this.scheduleModel.set(y.NCC_CHECKS_START_TIME,1e3*b.getTime()),this.scheduleModel.set(y.NCC_CHECKS_DAYS_OF_THE_WEEK,a.length?a:null);var I=this;this.scheduleModel.save(null,{success:function(){I.hasSchedule=!0,I.scheduleModel.isNew(!1),I.render()},error:function(e,t){I.showHeaderErrorWithDetails(I.i18n("createError"),t.responseText),I.triggerAction(o.MODAL.ACT.AS_REFRESH)}})},removeSchedule:function(){$.nutanixConfirm({msg:this.i18n("removeConfirmation"),yes:function(){this.scheduleModel.destroy({success:function(){this.hasSchedule=!1,this.hide()}.bind(this),error:function(e,t){this.showHeaderErrorWithDetails(this.i18n("deleteError"),t.responseText),this.triggerAction(o.MODAL.ACT.AS_REFRESH)}.bind(this)})}.bind(this),yesText:this.i18n("remove"),noText:this.i18n("cancel")})},getWeekDaysData:function(e){var t=[],i=n.t("TimeUtil","dates.days"),s=n.t("TimeUtil","dates.daysMin");return _.each(i,function(n,i){t.push({id:i+1,value:s[i],selected:Boolean(e[s[i]]),name:n})}),t}})}),define("models/ncc/LogCollectorModel",["models/BaseModel","data/DataURLConstants","data/DataProperties","managers/NotificationManager"],function(e,t,n,i){"use strict";var s={START_TIME:"startTimeInUsecs",END_TIME:"endTimeInUsecs",HOURS_NUMBER:"lastNumberOfHours",DAYS_NUMBER:"lastNumberOfDays",ANONYMIZE_OUTPUT:"anonymizeOutput"};return e.extend({DP:s,idAttribute:n.ID,nameAttribute:n.NAME,urlRoot:t.NCC_LOG_COLLECTOR,name:"LogCollectorModel",defaults:{anonymizeOutput:!1},showLatencyNotification:function(){this.latencyId=i.showLatencyMessage("Submitting log collector...")},showSuccessNotification:function(){i.hideLatencyMessage(this.latencyId)},hideLatencyNotification:function(){i.hideLatencyMessage(this.latencyId)}},{DP:s})}),define("text!templates/popups/clusterhealth/LogCollectorPopupView.html",[],function(){return'<div class="modal-header">\n  <button type="button" class="close" data-dismiss="modal">\n    <i data-icon="K" aria-hidden="true"></i>\n  </button>\n  <h4 class="n-title">Run Log Collector</h4>\n</div>\n<div class="n-modal-wrapper">\n  <div class="n-modal-body">\n    <div class="n-modal-content-wrapper">\n      <div class="n-modal-alert-header">\n        \x3c!-- alert goes here --\x3e\n      </div>\n      <div class="n-popup-description">\n        Logs will be collected for all the nodes and components.\n        Once the task completes the bundle will be available for download.\n      </div>\n      \x3c!-- Content goes here --\x3e\n      <form role="form">\n        <div class="form-top-section">\n          <div class="control-group radio-control">\n            <div class="controls">\n              <input type="radio" class="log-option" id="time-radio"\n                     data-id="timeLogOption" name="logType"\n                     value="<%=LOG_TYPE.TIME_RANGE %>" checked>\n              <label class="radio-label" for="time-radio">\n              Collect Logs starting now\n              </label>\n            </div>\n          </div>\n          <div class="control-group clearfix log-input" id="timeLogOption">\n            <div class="controls clearfix">\n              <label class="control-label">For the Past</label>\n              <div class="control-element">\n                <select id="timeSelect">\n                  <option value="<%=LOG_TYPE.HOURS %>"\n                          selected aria-selected="true">Hours</option>\n                  <option value="<%=LOG_TYPE.DAYS %>">Days</option>\n                </select>\n              </div>\n              <div class="control-element right-element">\n                <input type="text" class="form-control" id="timeValue"\n                       value="<%=LOG_TYPE.HOUR_LOW %>">\n              </div>\n              <div class="range-text"><%= rangeText %></div>\n            </div>\n          </div>\n\n          <div class="control-group radio-control">\n            <div class="controls">\n              <input type="radio" class="log-option" id="date-radio"\n                     data-id="dateLogOption" name="logType"\n                     value="<%=LOG_TYPE.DATE_RANGE %>">\n              <label class="radio-label" for="date-radio">\n              Custom Date Range\n              </label>\n            </div>\n          </div>\n          <div class="control-group hide" id="dateLogOption">\n            <div class="controls range-control">\n              <p class="help-block"><%= disclaimerText %></p>\n              <label class="control-label">Start From</label>\n              <div class="range-start"></div>\n              <label class="control-label">End By</label>\n              <div class="range-end"></div>\n            </div>\n          </div>\n        </div>\n      </form>\n    </div>\n  </div>\n  <div class="n-modal-footer">\n    <a class="btnCancel btn">Cancel</a>\n    <a class="btnRun btn -blue" title="Run"\n       data-loading-text="Running...">Run Now</a>\n  </div>\n</div>'}),define("views/popups/clusterhealth/LogCollectorPopupView",["backbone","views/basecomponents/popups/BasePopupView","views/basecomponents/datetimepicker/DateTimePickerView","models/ncc/LogCollectorModel","utils/AppUtil","utils/AppConstants","utils/SubViewHelper","text!templates/popups/clusterhealth/LogCollectorPopupView.html"],function(e,t,n,i,s,a,o,r){"use strict";var l=_.template("Please enter a value between <%= low %> and <%= high %>."),c=_.template("Logs can be collected for a minimum of <%=low_hour %> hours to a maximum of <%=high_day %> days.");return t.extend({LOG_TYPE:{TIME_RANGE:"timeRange",DATE_RANGE:"dateRange",HOURS:"hours",DAYS:"days",HOUR_LOW:4,HOUR_HIGH:23,DAY_LOW:1,DAY_HIGH:1},START_DATE_TIME_VIEW:"startDateTime",END_DATE_TIME_VIEW:"endDateTime",validationDateMsg:"Please select a valid date range.",el:"#popupLogCollector",template:_.template(r),model:null,events:{"click  .btnRun":"runLogCollector","click  .btnCancel":"hide","click  .modal-header .close":"hide","keyup input":"updateRunBtnClass","change #dateLogOption input":"updateRunBtnClass","click  .log-option":"toggleDetailOptions","change #timeSelect":"changeTimeRangeText"},initialize:function(){this.subViewHelper=new o,this.model=new i,t.prototype.initialize.apply(this,arguments)},render:function(){this.$el.html(this.template({LOG_TYPE:this.LOG_TYPE,rangeText:this.getFormattedRangeText(),disclaimerText:this.getDisclaimerText()})),this.getRangeFilter(),this.applyNutanixInput(),this.initializeTooltip()},initializeTooltip:function(){this.$(".n-tooltip-circle").tooltip({placement:"right",trigger:"hover",title:"Log bundle will not contain any node specific identity information.",html:!1,container:this.$el})},destroyTooltip:function(){this.$(".n-tooltip-circle").tooltip("destroy")},toggleDetailOptions:function(e){var t=$(e.currentTarget),n=t.data("id"),i=$("#timeLogOption"),s=$("#dateLogOption");this.resetForm(),"timeLogOption"===n?(i.show(),s.hide()):(i.hide(),s.show())},changeTimeRangeText:function(e){var t=$(e.currentTarget),n=t.val(),i=this.getFormattedRangeText(n);this.$("#timeValue").val(this.getDefaultValueForRange(n)),this.$el.find(".range-text").html(i)},getDefaultValueForRange:function(e){return e===this.LOG_TYPE.DAYS?this.LOG_TYPE.DAY_LOW:this.LOG_TYPE.HOUR_LOW},getFormattedRangeText:function(e){
return e===this.LOG_TYPE.DAYS?this.LOG_TYPE.DAY_HIGH>this.LOG_TYPE.DAY_LOW?"("+this.LOG_TYPE.DAY_LOW+"-"+this.LOG_TYPE.DAY_HIGH+")":"("+this.LOG_TYPE.DAY_LOW+")":"("+this.LOG_TYPE.HOUR_LOW+"-"+this.LOG_TYPE.HOUR_HIGH+")"},getDisclaimerText:function(){return c({low_hour:this.LOG_TYPE.HOUR_LOW,high_day:this.LOG_TYPE.DAY_HIGH})},getDateRangeErrorMsg:function(){return this.validationDateMsg+" "+this.getDisclaimerText()},destroy:function(){this.subViewHelper.get(this.START_DATE_TIME_VIEW).off(),this.subViewHelper.get(this.END_DATE_TIME_VIEW).off(),this.subViewHelper.removeAll(),this.subViewHelper=null,this.destroyTooltip(),t.prototype.destroy.apply(this,arguments)},reset:function(){this.clearHeader(),this.undelegateEvents()},getRangeFilter:function(){var e=new n,t=new n;this.$el.find(".range-start").html(e.render().el).end().find(".range-end").html(t.render().el),e.on("changeDateTime",function(e){this.restrictDateTime(e,!1)},this),t.on("changeDateTime",function(e){this.restrictDateTime(e,!0)},this),this.resetMinMaxDate(e),this.resetMinMaxDate(t),this.subViewHelper.register(this.START_DATE_TIME_VIEW,e),this.subViewHelper.register(this.END_DATE_TIME_VIEW,t)},restrictDateTime:function(e,t){var n,i=this.subViewHelper.get(this.START_DATE_TIME_VIEW),s=this.subViewHelper.get(this.END_DATE_TIME_VIEW);t?(i.setMaxDateTime(e),i.setMinDateTime({date:"-30d"})):(s.setMinDateTime(e),s.setMaxDateTime({date:"0d"})),n=this.getHourDifference(s,i),s.getDateTimeValueInUsecs()&&i.getDateTimeValueInUsecs()&&(this.checkHourDiff(n)?this.showErrorForDateRange(this.getDateRangeErrorMsg()):this.hideErrorForDateRange())},resetForm:function(){var e=this.subViewHelper.get(this.START_DATE_TIME_VIEW),t=this.subViewHelper.get(this.END_DATE_TIME_VIEW);this.clearHeader(),this.$("#timeValue").val("").removeClass("error"),e.refreshView(),t.refreshView(),this.resetMinMaxDate(e),this.resetMinMaxDate(t),this.$(".btnRun").addClass("disabled")},resetMinMaxDate:function(e){e.setMinDateTime({date:"-30d"}),e.setMaxDateTime({date:"0d"})},showErrorForDateRange:function(e){this.showHeaderError(e),this.$("#dateLogOption").find("input").each(function(){$(this).addClass("error")})},hideErrorForDateRange:function(){this.clearHeader(),this.$("#dateLogOption").find("input").each(function(){$(this).removeClass("error")})},checkHourDiff:function(e){return e<4||e>24},getHourDifference:function(e,t){var n=e.getDateTimeValueInUsecs(),i=t.getDateTimeValueInUsecs();return!(!n||!i)&&Math.floor((e.getDateTimeValueInUsecs()-t.getDateTimeValueInUsecs())/a.MICROS_PER_HOUR)},updateRunBtnClass:function(){var e=this.$('input[name="logType"]:checked').val(),t=this.$(".btnRun");if(e===this.LOG_TYPE.TIME_RANGE){this.$("#timeValue").val().trim()?t.removeClass("disabled"):t.addClass("disabled")}else{var n=this.subViewHelper.get(this.START_DATE_TIME_VIEW),i=this.subViewHelper.get(this.END_DATE_TIME_VIEW),s=n.getDateTimeValueInUsecs(),a=i.getDateTimeValueInUsecs();s&&a?t.removeClass("disabled"):t.addClass("disabled")}},runLogCollector:function(){var e=this.$('input[name="logType"]:checked').val(),t=$("#timeSelect").val();e===this.LOG_TYPE.TIME_RANGE?t===this.LOG_TYPE.HOURS?this.addTimeRange(this.LOG_TYPE.HOUR_LOW,this.LOG_TYPE.HOUR_HIGH,i.DP.HOURS_NUMBER):this.addTimeRange(this.LOG_TYPE.DAY_LOW,this.LOG_TYPE.DAY_HIGH,i.DP.DAYS_NUMBER):this.addDateRange()},addTimeRange:function(e,t,n){var i=this.$("#timeValue"),s=i.val(),a=/^[0-9]+$/;s<e||s>t||!a.test(s)?(this.showHeaderError(l({low:e,high:t})),i.addClass("error")):(i.removeClass("error"),this.model.set(n,s),this.setAnonymizeOutput(),this.saveModel())},addDateRange:function(){var e=this.subViewHelper.get(this.START_DATE_TIME_VIEW),t=this.subViewHelper.get(this.END_DATE_TIME_VIEW),n=e.getDateTimeValueInUsecs(),s=t.getDateTimeValueInUsecs(),a=this.getHourDifference(t,e);n&&s?this.checkHourDiff(a)?this.showErrorForDateRange(this.getDateRangeErrorMsg()):(this.model.set(i.DP.START_TIME,n),this.model.set(i.DP.END_TIME,s),this.setAnonymizeOutput(),this.saveModel()):this.showErrorForDateRange(this.validationDateMsg)},setAnonymizeOutput:function(){this.model.set(i.DP.ANONYMIZE_OUTPUT,!1)},saveModel:function(){var e=this;this.model.save(null,{success:function(){e.hide(),e.model.clear()},error:function(t){e.model.hideLatencyNotification(),e.showHeaderError(_.isObject(t)?s.processAjaxError(t.responseText):t),e.model.clear()}})}})}),define("models/hyperv/HypervDomainCredentialModel",["backbone"],function(e){"use strict";var t={USER_NAME:"logonName",PASSWORD:"password"};return e.Model.extend({DP:t,defaults:{logonName:null,password:null},validateModel:function(){var e=this.get(t.USER_NAME),n=this.get(t.PASSWORD);return e&&""!==e.trim()?n&&""!==n.trim()?2!==e.split("\\").length?"Invalid logon name specified. It must be of the form: DOMAIN\\username.":void 0:"Invalid password specified.":"Invalid logon name specified."}})}),define("text!templates/popups/cluster/ClusterContentView.html",[],function(){return'\x3c!-- The parent div modal is #popupClusterDetails --\x3e\n<div data-ntnx-content-inner>\n  <% if (isDataFetched) { %>\n    \x3c!-- Form to update the cluster parameters --\x3e\n    <form class="cluterDetailsForm form-horizontal n-form-rows"\n        onsubmit="return false;">\n\n      <section data-ntnx-section>\n        <label data-ntnx-label>\n          <%= i18n(\'cluster_uuid\') %>\n        </label>\n        <span class="lblClusterId">\n          <%= model.clusterUuid || \'\' %>\n        </span>\n      </section>\n\n      <section data-ntnx-section>\n        <label data-ntnx-label>\n          <%= i18n(\'cluster_id\') %>\n        </label>\n          <span class="lblClusterId">\n            <%= model.id || \'\' %>\n          </span>\n      </section>\n\n      <section data-ntnx-section>\n        <label data-ntnx-label>\n          <%= i18n(\'cluster_incarnation_id\') %>\n        </label>\n        <span class="lblClusterId">\n          <%= model.clusterIncarnationId || \'\' %>\n        </span>\n      </section>\n\n      <section data-ntnx-section>\n        <label data-ntnx-label>\n          <%= i18n("cluster_name") %>\n        </label>\n        <% if (canModify) { %>\n          <input type="text" class="inputClusterName"\n            value="<%= model.name || \'\' %>">\n          <div class="n-input-validation-msg"></div>\n        <% } else { %>\n          <span class="lblClusterName">\n            <%= (model.name || \'\') %>\n          </span>\n        <% } %>\n      </section>\n\n      <section data-ntnx-section>\n        <label data-ntnx-label>\n          <%= i18n(\'cluster_virtual_ip_address\') %>\n          <% if (isFQDNEnabled) { %>\n            <span data-ntnx-label-flag><%= i18n(\'required_for_fqdn\') %></span>\n          <% } %>\n        </label>\n        <% if (canModify) { %>\n          <input type="text"\n            class="inputClusterExternalIPAddress"\n            value="<%= model.clusterExternalIPAddress || \'\' %>">\n        <% } else { %>\n          <span class="lblClusterExternalIPAddress">\n            <%= (model.clusterExternalIPAddress || i18n(\'no_data\')) %>\n          </span>\n        <% } %>\n      </section>\n\n      <% if (isFQDNEnabled) { %>\n        <section data-ntnx-section>\n          <label data-ntnx-label>\n            <%= i18n(\'cluster_fqdn\') %>\n          </label>\n          <% if (canModify) { %>\n            <input type="text" class="inputClusterFQDN"\n                   value="<%= model.clusterFullyQualifiedDomainName || \'\' %>">\n          <% } else { %>\n            <span class="lblClusterFQDN">\n              <%= (model.clusterFullyQualifiedDomainName || i18n(\'no_data\')) %>\n            </span>\n          <% } %>\n        </section>\n      <% } %>\n\n      <section data-ntnx-section>\n        <label data-ntnx-label>\n          <%= i18n("iscsi_data_services_ip") %>\n        </label>\n        <% if (!isNSEnabled && canModify) { %>\n        <input type="text" class="inputClusterExternalDsIPAddress"\n               value="<%= model.clusterExternalDataServicesIPAddress\n               || \'\' %>">\n        <% } else { %>\n          <span class="lblClusterExternalDsIPAddress">\n            <%= ( model.clusterExternalDataServicesIPAddress ||\n                  i18n("no_data")) %>\n          </span>\n        <% } %>\n      </section>\n\n      <% if (isEncryptionCapable) { %>\n        <section data-ntnx-section>\n          <label data-ntnx-label>\n            <%= i18n("cluster_encryption_state") %>\n          </label>\n          <% if (encryptionError) { %>\n            <span class="lblClusterErrorEncryptionState">\n              <%= i18n("no_encryption_state") %>\n            </span>\n          <% } else { %>\n            <span class="lblClusterEncryptionState">\n              <%= encryptionMsg %>\n            </span>\n          <% } %>\n        </section>\n      <% } %>\n\n      <% if (isDomainJoined) { %>\n        <div class="group group-credentials groupCredentials">\n          \x3c!-- Credentails form will go here --\x3e\n        </div>\n      <% } %>\n    </form>\n  <% } %>\n</div>'}),define("text!templates/popups/cluster/HypervCredentialsView.html",[],function(){return'<div class="credentials">\n  <div class="control-group credentials-header">\n    <label class="group-label control-label">Credentials\n      <a class="n-button-help">i</a>\n    </label>\n    <div class="controls">\n      <div class="n-form-row-description">\n        <span class="n-inline-description">\n          Credentials will not be stored.\n        </span>\n      </div>\n    </div>\n  </div>\n  <div class="group-controls" >\n    <div class="control-group">\n      <label class="control-label logon-name">\n        Logon Name (DOMAIN\\username)\n      </label>\n      <div class="controls">\n        <input type="text" class="inputRequired username"/>\n      </div>\n    </div>\n    <div class="control-group">\n      <label class="control-label">Password</label>\n      <div class="controls">\n        <input type="password" class="inputRequired password"/>\n      </div>\n    </div>\n  </div>\n</div>'}),define("views/popups/cluster/ClusterPopupView",["backbone","views/basecomponents/popups/BasePopupView","models/encryption/EncryptionModel","models/cluster/ClusterModel","models/cluster/ClusterUpdateModel","models/hyperv/HypervDomainCredentialModel","managers/ActionManager","managers/NavigationManager","data/DataProperties","events/AppEvents","utils/AppConstants","utils/AppUtil","utils/TooltipContent","utils/ValidationUtil","text!templates/popups/cluster/ClusterContentView.html","text!templates/popups/cluster/HypervCredentialsView.html"],function(e,t,n,i,s,a,o,r,l,c,d,p,u,h,m,f){"use strict";var v=_.template("<span class=\"encryptionStateTip\"><%= Components.icon(\n      'question-tooltip', '-inline -baseline') %></span>"),g=_.template(f);return t.extend({el:"#popupClusterDetails",name:"ClusterPopupView",_popupModelName:null,template:_.template(m),isDataFetched:!1,isEncryptionCapable:!1,isClusterDomainJoined:!1,isNSEnabled:!1,errorInEncryptionRetrieval:!1,encryptionModel:null,model:null,events:{"click  .btnUpdate":"updateCluster","keyup  .inputClusterName":"onInputNameKeyUp","keypress input":"onKeyPress","click input":"clearHeader","click .modal-header .close":"hide","keyup .inputRequired":"onInputRequiredKeyup","input .inputClusterExternalDsIPAddress":"onExternalDsIPChanged"},modelEvents:{"change model":"onClusterChange","error  model":"onClusterError"},initialize:function(){t.prototype.initialize.apply(this,arguments),this.encryptionModel=new n,this.model=new i},render:function(){this.$el.html(this.defaultTemplate({title:this.i18n("cluster_details"),bodyContent:this.template(this.vtOptions({isDataFetched:!1})),footerButtons:this.defaultFooter([])}))},onDataChangeRender:function(){this.model.get(l.DOMAIN)&&(this.isClusterDomainJoined=!0),this.model.get(l.CLUSTER_NS_ENABLED)&&(this.isNSEnabled=!0);var e=this.canModifyByEntityType(d.ENTITY_CLUSTER),t=[];e&&t.push({text:this.i18n("save"),isPrimary:!0,extraClasses:"btnUpdate"}),this.$el.html(this.defaultTemplate({title:this.i18n("cluster_details"),antiscroll:!1,bodyContent:this.template(this.vtOptions({model:this.model.toJSON(),canModify:e,isNSEnabled:this.isNSEnabled,isDataFetched:this.isDataFetched,isEncryptionCapable:this.isEncryptionCapable,encryptionMsg:this.getEncryptionStatusMsg(),encryptionError:this.errorInEncryptionRetrieval,isDomainJoined:this.isClusterDomainJoined,isFQDNEnabled:this.isFQDNEnabled()})),footerButtons:this.defaultFooter(t)})),this.isClusterDomainJoined&&(this.$(".inputClusterName").prop("disabled",!0),this.$(".groupCredentials").html(g),this.$(".n-button-help").tooltip({title:u[d.ENTITY_KERBEROS_CONFIG].CREDENTIALS_HELP,placement:"right",trigger:"hover",html:!1})),this.$(".encryptionStateTip").tooltip({placement:"top",trigger:"hover",container:"body",html:!0,title:this.i18n("cluster_partial_encrypted_desc")}),this.$(".inputRequired").length&&this.$(".btnUpdate").addClass("disabled").attr("disabled",!0)},isFQDNEnabled:function(){return this.isFFEnabled(d.FFLAGS.FQDN_REGISTRATION)},getEncryptionStatusMsg:function(){var e=this.encryptionModel.getCurrentEncryptionStatusModel();return e.getSoftwareEncryptionScope()===d.ENCRYPTION_PROP.SE_SCOPE_STORAGE_CONTAINER?this.i18n("cluster_partial_encrypted")+"\n            "+v(this.vtOptions()):e.isEncryptionOn()?this.i18n("cluster_encrypted"):this.i18n("cluster_not_encrypted")},show:function(e){t.prototype.show.apply(this,arguments),this.showHeaderLoading();var n=null;if(this.clusterManager.isMulticlusterNavMode()){if(!(n=e[d.NAV_ACTION_TARGET_ID]))throw new Error("Using ClusterPopView in PC requires passing in the actionTargetId=<clusterId> parameter")}else n=this.clusterManager.getCurrentClusterId();this.model.setId(n),this.model.fetch()},hide:function(){t.prototype.hide.apply(this,arguments),this.actionRoute.fsPrecheckFlow&&o.executeAction({action:d.ACTION_CREATE,actionTarget:d.ENTITY_FILE_SERVER})},destroy:function(){p.debug("ClusterPopupView : destroy:  | viewid     : "+this.cid),this.$(".n-button-help").tooltip("destroy"),this.$(".encryptionStateTip").tooltip("destroy"),t.prototype.destroy.apply(this,arguments)},onClusterChange:function(e){this.clearHeader(),this.isDataFetched=!0,this.isEncryptionCapable=!0;var t=this.encryptionModel.getCurrentEncryptionStatusModel();this.clusterManager.isMulticlusterNavMode()&&t.setProxyClusterUuid(this.model.getClusterUuid());var n=this;this.encryptionModel.fetchCurrentEncryptionStatus({success:function(){n.errorInEncryptionRetrieval=!1,n.onDataChangeRender()},error:function(e,t){n.showHeaderError(t.responseText),n.errorInEncryptionRetrieval=!0,n.onDataChangeRender()}})},onClusterError:function(e,t){this.showHeaderError(t.responseText)},reset:function(){this.clearHeader(),this.undelegateEvents()},validateForm:function(){if(0===$.trim(this.$el.find(".inputClusterName").val()).length)return this.i18n("required_cluster_name_msg");var e=$.trim(this.$el.find(".inputClusterExternalIPAddress").val());if(e&&!h.isValidIP(e))return this.i18n("invalid_virtual_ip_msg");if(this.isFQDNEnabled()){var t=$.trim(this.$el.find(".inputClusterFQDN").val());if(t&&!h.isValidDomainName(t))return this.i18n("invalid_fqdn_msg");if(t&&!e)return this.i18n("virtual_ip_required_fqdn_msg")}var n=$.trim(this.$el.find(".inputClusterExternalDsIPAddress").val());return n&&!h.isValidIP(n)?this.i18n("invalid_data_service_ip_msg"):void 0},validateAndReturnDomainCredentials:function(e,t){var n=new a;n.set(n.DP.USER_NAME,e),n.set(n.DP.PASSWORD,t);var i=n.validateModel();return i?void this.showHeaderError(i):n},onInputRequiredKeyup:_.debounce(function(){var e=this.$(".inputRequired");_.some(e,function(e){return""===$(e).val().trim()})?this.$(".btnUpdate").addClass("disabled").attr("disabled",!0):this.$(".btnUpdate").removeClass("disabled").attr("disabled",!1)},100),onInputNameKeyUp:function(e){p.validNameCharactersEventHandler(e,this.$(".n-input-validation-msg"))},onEnterKeyPress:function(){this.updateCluster()},onKeyPress:function(e){if("inputClusterExternalDsIPAddress"===$(e.currentTarget)[0].className&&this.$(".n-modal-alert-header").find(".alert-warning").length>0||this.clearHeader(),13===e.keyCode)this.onEnterKeyPress(),e.preventDefault();else{var t=$(e.currentTarget);h.removeError(t)}},onExternalDsIPChanged:function(e){this.showHeaderWarning(this.i18n("external_ip_changed"))},updateCluster:function(){var e=this.validateForm();if($.trim(e).length>0)return void this.showHeaderError(e);var t=this,n=$.trim(this.$(".inputClusterName").val()),i=$.trim(this.$el.find(".inputClusterExternalIPAddress").val()),a=$.trim(this.$el.find(".inputClusterExternalDsIPAddress").val()),o=i||null,p=a||null,u=void 0;if(this.isClusterDomainJoined){var h=$.trim(this.$(".username").val()),m=$.trim(this.$(".password").val());if(!(u=this.validateAndReturnDomainCredentials(h,m)))return}var f=new s;if(f.set(this.model.attributes),this.clusterManager.isMulticlusterNavMode()&&f.setProxyClusterUuid(this.model.getClusterUuid()),f.set(l.CLUSTER_NAME,n),f.set(l.CLUSTER_EXTERNAL_IP_ADRESS,o),this.isFQDNEnabled()){var v=$.trim(this.$el.find(".inputClusterFQDN").val())||null;f.set(l.CLUSTER_FQDN,v)}f.set(l.CLUSTER_EXTERNAL_DATA_SERVICES,p),u&&f.set(l.CLUSTER_CREDENTIAL,u.toJSON()),f.save(null,{success:function(e,n){e.get(l.CLUSTER_EXTERNAL_DATA_SERVICES)?c.triggerAppEvent(c.ENTITIES_UPDATED,{entityType:d.ENTITY_CLUSTER,clusterExternalDataServices:e.get(l.CLUSTER_EXTERNAL_DATA_SERVICES),entity:e}):c.triggerAppEvent(c.ENTITIES_UPDATED,{entityType:d.ENTITY_CLUSTER,entity:e}),t.$(".btnUpdate").button("reset"),r.isCurrentPage(d.PAGE_SETTINGS)?t.model.fetch():t.hide()},error:function(e,n){t.$(".btnUpdate").button("reset"),t.showHeaderError(n.responseText)}})}})}),define("text!templates/popups/vm/VmBasePopupView.html",[],function(){return'<div class="modal-header">\n  <button type="button" class="close">\n    <i data-icon="K" aria-hidden="true"></i>\n  </button>\n  <h4 class="n-title -capitialize">\n  </h4>\n</div>\n\n<div class="n-modal-wrapper">\n  <div class="n-modal-body">\n    <div class="n-modal-loader">\n      <span class="n-loading-text">Loading data...&nbsp;</span>\n      <div class="donut-loader-blue"></div>\n    </div>\n    <div class="n-modal-content-wrapper">\n      \x3c!-- Header --\x3e\n      <div class="n-modal-alert-header">\n        \x3c!-- @view: alert goes here... --\x3e\n      </div>\n      <div class="n-modal-content">\n        \x3c!-- @view: content goes here --\x3e\n      </div>\n    </div>\n  </div>\n  <div class="n-modal-footer">\n  </div>\n</div>'}),define("views/popups/vm/VmBasePopupView",["views/basecomponents/popups/BasePopupView","text!templates/popups/vm/VmBasePopupView.html"],function(e,t){"use strict";var n=_.template(t),i=_.template('<div class="n-list-box"><label class="n-list-box-label"></label><label class="n-list-box-label-info hide"></label><select class="n-list-box-select"></select></div>'),s=_.template('<option value="<%= id %>"><%= label %></option>'),a=_.template("<option disabled><%= label %></option>");return e.extend({el:"#popupVmBase",events:{"click    .modal-header .close":"hide"},render:function(){return this.$el.html(n()),this.renderTitle(this.$(".n-title")),this.renderBodyContent(this.$(".n-modal-content")),this.renderFooterContent(this.$(".n-modal-footer")),this.applyNutanixInput(),this},renderTitle:function(e){},renderBodyContent:function(e){},renderFooterContent:function(e){this.addFooterButton("Cancel"),this.addFooterButton("OK")},addFooterButton:function(e,t){t=t||"btn"+e;var n=_.template('<button class="btn <%= className %>"><%= label %></button>');this.$(".n-modal-footer").append(n({label:e,className:t}))},resetBodyContent:function(){this.$(".n-modal-content").empty()},resetFooter:function(){this.$(".n-modal-footer").empty()},setTitle:function(e,t){this.$(".n-title").html(e).addClass(t)},hideLoadingIcon:function(){this.$(".n-modal-loader").hide()},createListBox:function(e,t,n){var o=$(i());return o.addRow=function(e){var t=this.find(".n-list-box-select"),n=$(s({label:e.label,id:e.id}));t.append(n),t.trigger("update")},o.disableEmptySelect=function(e){this.empty();var t=this.find(".n-list-box-select");t.append(a({label:e})),t.trigger("disable"),t.trigger("update")},o.enable=function(){this.find(".n-list-box-select").trigger("enable").trigger("update")},o.empty=function(){this.find(".n-list-box-select").empty()},o.setLabel=function(e){this.find(".n-list-box-label").html(e)},o.setInfo=function(e){this.find(".n-list-box-label-info").html(e).removeClass("hide")},o.setLabel(e),t&&o.setInfo(t),o.addClass(n)}})}),define("views/popups/cluster/ClusterSelectionPopupView",["views/popups/vm/VmBasePopupView","models/ebrowser/EBQueryModel","data/DataProperties","utils/AppConstants","managers/ActionManager","managers/ClusterManager"],function(e,t,n,i,s,a){"use strict";return e.extend({el:"#popupVmCreateWrapper",events:{"click .modal-header .close":"hide","click .btnCancel":"onCancelClick","click .btnOK":"onOKClick"},modelEvents:{"change ebQueryModel":"onDataChange","error  ebQueryModel":"onDataError"},ebQueryModel:null,DP:n.EB.CLUSTER,initialize:function(n){e.prototype.initialize.apply(this,arguments),this.ebQueryModel=new t,this.ebQueryModel.set(this.ebQueryModel.DP.ENTITY_TYPE,i.ENTITY_CLUSTER),this.ebQueryModel.setGroupMemberAttributesList([this.DP.CLUSTER_NAME,this.DP.VERSION,this.DP.HYPERVISOR_TYPES])},show:function(t){if(t[i.NAV_ACTION_TARGET_ID])return this.hide(),void this._executeAction(t[i.NAV_ACTION_TARGET_ID]);e.prototype.show.apply(this,arguments),this.ebQueryModel.performQuery(),this.render()},renderTitle:function(e){var t=s.getActionById(this.actionRoute[i.NAV_ACTION_TARGET],this.actionRoute[i.NAV_ACTION_ID]);this.setTitle("Cluster Selection - "+t.get(t.DP.TITLE))},renderBodyContent:function(e){switch(this.actionRoute[i.NAV_ACTION]){case i.ACTION_FANOUT.VM_CREATE:this.$listBox=this.createListBox("Select a cluster to create the VM on.");break;case i.ACTION_FANOUT.NETWORK_CREATE:this.$listBox=this.createListBox("Select a cluster to create the network on.");break;default:this.$listBox=this.createListBox("Select a cluster to operate on.")}e.html(this.$listBox)},onDataChange:function(e){this.hideLoadingIcon();var t=(this.$(".clusterList"),e.getQueryResults().models);switch(t=this._filterForFanout(t),this.actionRoute[i.NAV_ACTION]){case i.ACTION_FANOUT.VM_CREATE:t=this._filterForUhuraClusters(t);break;default:t=this._filterForKVMOnlyCluster(t)}if(1===t.length)return this.hide(),void this._executeAction(t[0].getId());0===t.length?(this.$listBox.disableEmptySelect("No Applicable Cluster"),this.$(".btnOK").addClass("disabled"),this.$(".btnCancel").text("Close")):(this.$listBox.empty(),_.each(t,function(e){this.$listBox.addRow({label:e.get(this.DP.CLUSTER_NAME),id:e.getId()})},this),this.$listBox.enable()),t.length<e.getQueryResults().models.length&&this._setNoteInfo()},_filterForFanout:function(e){return _.filter(e,function(e){var t=a.getClusterModelByClusterUuid(e.getId());return!!t&&t.isEntityActionSupportFanout(this.actionRoute)},this)},_filterForKVMOnlyCluster:function(e){return _.filter(e,function(e){return!(!e.get(this.DP.HYPERVISOR_TYPES)||1!==e.get(this.DP.HYPERVISOR_TYPES).length||e.get(this.DP.HYPERVISOR_TYPES)[0]!==i.HYPERVISOR_TYPE.KVM)},this)},_filterForUhuraClusters:function(e){return _.filter(e,function(e){var t=e.get(n.EB.ENTITY_ID),s=a.getClusterModelByClusterUuid(t),o=e.get(this.DP.HYPERVISOR_TYPES);return _.indexOf(o,i.HYPERVISOR_TYPE.KVM)>=0||_.indexOf(o,i.HYPERVISOR_TYPE.ESXI)>=0&&s.isManagementServerRegistered()},this)},_setNoteInfo:function(){this.$listBox.setInfo("<strong>Note: </strong>Only clusters that support this action are listed.")},onDataError:function(e,t,n){this.hideLoadingIcon(),this.showHeaderError(e,t,n)},destroy:function(){var t=this;this.targetEntityId&&setTimeout(function(){t._executeAction(t.targetEntityId)},100),e.prototype.destroy.call(this)},onOKClick:function(e){this.targetEntityId=this.$(".n-list-box-select").val(),this.hide()},_executeAction:function(e){var t=this.actionRoute[i.NAV_ACTION];switch(t){case i.ACTION_FANOUT.VM_CREATE:this.actionRoute[i.NAV_ACTION_TARGET]=i.ENTITY_VM;break;case i.ACTION_FANOUT.NETWORK_CREATE:this.actionRoute[i.NAV_ACTION_TARGET]=i.ENTITY_ACROPOLIS_NETWORK;break;case i.ACTION_FANOUT.CONTAINER_CREATE:this.actionRoute[i.NAV_ACTION_TARGET]=i.ENTITY_CONTAINER;break;case i.ACTION_FANOUT.EXPAND_CLUSTER:this.actionRoute[i.NAV_ACTION_TARGET]=i.ENTITY_HOST;break;default:throw new Error("Error: action "+t+" is not available.")}this.actionRoute[i.NAV_ACTION]=i.ACTION_CREATE,this.actionRoute[i.NAV_ACTION_PARENT_ID]=e,s.executeAction(this.actionRoute)},onCancelClick:function(e){this.hide()}})}),define("text!templates/popups/cluster/ClusterUpgradeDetailsView.html",[],function(){return'<section data-ntnx-section>\n  <h5 data-ntnx-title>\n    <%= i18n(\'availableVersions\') %>\n  </h5>\n</section>\n\n<section data-ntnx-section>\n  <%= Components.select({\n  id      : \'version-select\',\n  options : versions\n  }) %>\n</section>\n\n<% if (clusters.length) { %>\n<section data-ntnx-section="type-separator">\n  <h5 data-ntnx-title>\n    <%= i18n(\'upgradeSequence\') %>\n  </h5>\n</section>\n\n<section data-ntnx-section="type-text">\n  <%= i18n("upgradeSequenceLabel") %>\n</section>\n\n<form role="form" lpformnum="1" class="update-type-section">\n\n  <section data-ntnx-section>\n    <div data-ntnx-form-inline>\n      <%= Components.radio({\n        id      :\'sameTime\',\n        name    :\'updateType\',\n        classes :\'action update-type same-Time\',\n        checked : true\n      })\n      %>\n      <label for=\'sameTime\' data-ntnx-inline-label>\n        <%= i18n( "parallelOrder") %>\n      </label>\n    </div>\n\n    <div data-ntnx-form-inline>\n      <%= Components.radio({\n      id      :\'customOrder\',\n      name    :\'updateType\',\n      classes :\'action update-type custom-order\'\n      })\n      %>\n      <label for=\'customOrder\' data-ntnx-inline-label>\n        <%= i18n( "customOrder") %>\n      </label>\n    </div>\n  </section>\n\n</form>\n\n<div class="cluster-list-section">\n\n  <section data-ntnx-section>\n    <table id="clusterList"\n           class="table table-hover cluster-table">\n      <thead>\n      <tr class="n-table-row">\n        <th><%= i18n( "clusterName") %></th>\n        <th class="cell-actions"><% i18n("order") %></th>\n      </tr>\n      </thead>\n      <tbody>\n      <% var len = clusters.length - 1;\n      _.each(clusters, function(cluster, index) { %>\n      <tr class="n-table-row" data-index="<%= index %>">\n        <td data-index="<%= index %>">\n          <%= cluster.get(cluster.DP.STATUS)[cluster.DP.NAME]  || i18n(\'unnamed\') %>\n        </td>\n        <td class="cell-actions">\n                <span class="-compact">\n                  <i class="cluster-order order-down <%= index === len ? \'disabled\' : \'\'%>"\n                     data-index="<%= index %>">\n                    <%= Components.icon(\'caret-down\', \'-inline -down-arrow\') %>\n                  </i>\n                  <i class="cluster-order order-up <%= index === 0 ? \'disabled\' : \'\'%>"\n                     data-index="<%= index %>">\n                    <%= Components.icon(\'caret-up\', \'-inline -down-arrow\') %>\n                  </i>\n                  <span><%= index +1 %></span>\n                </span>\n        </td>\n      </tr>\n      <% }) %>\n      </tbody>\n    </table>\n  </section>\n\n</div>\n<% } %>'}),define("views/popups/cluster/ClusterUpgradeDetailsView",["views/basecomponents/popups/BasePopupSubView","models/intent/IntentDynamicModel","models/cluster/MulticlusterConfigModel","data/DataURLConstants","data/DataProperties","utils/AppUtil","utils/AppConstants","utils/CommonTemplates","text!templates/popups/cluster/ClusterUpgradeDetailsView.html"],function(e,t,n,i,s,a,o,r,l){"use strict";var c=_.template(l),d=_.template("entity_uuids=in=[<%= uuids %>]");return e.extend({name:"ClusterUpdatePopupView",events:{"click .update-type":"toggleUpdateType","click .cluster-order":"onClusterOrder"},upgradeDetails:null,initialize:function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.prototype.initialize.apply(this,arguments),this.uuids=n.uuids,this.model=new t(null,{enableNotifications:!1}),this.model.setRootUrl(_.template(i.PORTAL_SERVICES)({softwareType:"NOS"})),this.clusterModels=[],this.upgradeDetails=n&&n.upgradeDetails},render:function(){if(this.initialized){var e=this.getCompatibleVersions(this.model);e=_.sortBy(e,function(e){return e});var t=this.upgradeDetails;this.clusterModels=this.getLoadedClusters(this.clusterModels);var i=t[s.UPGRADE_VERSION_ID],a=this.generateVersionOptions(e,i),l=this.vtOptions({clusters:this.clusterModels,versions:a,initialized:this.initialized});this.$el.html(c(l)),t[n.DP.EXECUTION_PLAN]===n.DP.SEQUENTIAL?this.$(".n-radio[id=customOrder]").attr("checked",!0):this.showOrderColumn(!1),this.applyNutanixInput(),_.size(this.clusterModels)<=1&&(this.$(".n-radio[id=customOrder]").attr("disabled",!0),this.$(".custom-order").attr("disabled",!0)),this.validateInitialData(e,i),(i||_.size(e))&&this.getParentView().setDataLoaded(e),this.isNameServerConfigured()}else this.$el.html(r.LOADING_MSG({msg:this.i18n("loading")})),this.loadData(this.uuids);return this.triggerAction(o.MODAL.ACT.AS_REBUILD),this},loadData:function(e){var n=this,s=[],a={};a[this.model.DP.PROPS.KIND]="software",a[this.model.DP.PROPS.FILTER]=this.getFilter(e),s.push(this.model.save(a,{type:"POST"})),this.clusterModels=_.map(e,function(e){var n=new t(null,{enableNotifications:!1});return n.setRootUrl(i.CLUSTERS+"/"+e),n.setId(e),s.push(n.fetch()),n}),$.whenAll.apply($,s).always(function(){n.initialized=!0,n.render()}).fail(function(e){n.showHeaderErrorWithDetails(n.i18n("dataLoadingError"),e.responseText)})},getVersionsModel:function(){return this.model},onClusterOrder:function(e){var t=$(e.currentTarget);if(!t.hasClass("disabled")){var n=parseInt(t.data("index"),10);t.hasClass("order-up")&&(n-=1),this.clusterModels[n]=this.clusterModels.splice(n+1,1,this.clusterModels[n])[0],this.$('td[data-index="'+n+'"').html(this.getClusterName(this.clusterModels[n])),this.$('td[data-index="'+(n+1)+'"').html(this.getClusterName(this.clusterModels[n+1]))}},toggleUpdateType:function(e){var t=$(e.currentTarget);if(!t.attr("disabled")){var n=t.hasClass("custom-order");this.showOrderColumn(n)}},saveViewData:function(e){var t=this.$("#version-select").val();return t?(e.setPlan(this.getSelectedExecutionPlan()),e.setClusters(this.clusterModels),e.setVersion(t),!0):(this.triggerAction(o.MODAL.ACT.ALERT_SHOW,{type:o.MODAL.ALERT.TYPE_ERROR,message:this.i18n("noVersionSelected")}),!1)},getSelectedExecutionPlan:function(){return this.$("#customOrder").is(":checked")?n.DP.SEQUENTIAL:n.DP.PARALLEL},getFailedClusterNames:function(e){var t=this;return _.map(_.filter(e,function(e){return e.getState()!==o.STATE_SUCCESS}),function(e){return t.clusterManager.getNameById(e.getId())})},getLoadedClusters:function(e){return _.filter(e,function(e){return e.getState()===o.STATE_SUCCESS})},getFilter:function(e){var t=[];return t.push("compatible_only==true"),t.push(d({uuids:e.join("|")})),t.join(";")},getCompatibleVersions:function(e){var t=e.get(s.RESULT_ENTITIES);return t?_.map(t,function(e){return e.version}):[]},getClusterName:function(e){return e.get(e.DP.STATUS)[e.DP.NAME]||this.i18n("unnamed")},validateInitialData:function(e,t){var n=[],i=this.getFailedClusterNames(this.clusterModels);if(i.length&&n.push(this.i18ns("failedToLoadClusterError",i.join(", "))),0===e.length&&n.push(this.i18n("noCompatibleVersion")),t&&(0===e.length||e.indexOf(t)<0)){var s=e.length?this.i18n("selectOrCreateNew"):"";n.push(this.i18ns("unAvailableVersion",t,s))}n.length&&this.triggerAction(o.MODAL.ACT.ALERT_SHOW,{type:o.MODAL.ALERT.TYPE_WARNING,message:n.join("<br>"),closeTiming:o.MODAL.ALERT.CLOSE_TYPE_PERMANENT})},showOrderColumn:function(e){
e?(this.$("table td:nth-child(2)").show(),this.$("table th:nth-child(2)").show()):(this.$("table td:nth-child(2)").hide(),this.$("table th:nth-child(2)").hide())},generateVersionOptions:function(e,t){var n=_.map(e,function(e){return{name:e,value:e,class:"nos-version",selected:e===t}}).sort(function(e,t){return-a.compareVersions(e.value,t.value)});return e&&n.splice(0,0,{name:this.i18n("noVersionSelected"),value:"",class:"nos-version"}),n},isNameServerConfigured:function(){var e=this,t=[];_.each(this.clusterModels,function(i){var s=i.get(i.DP.STATUS)[i.DP.RESOURCES],a=s&&s[n.DP.NETWORK],o=a&&a.name_server_ip_list;_.size(o||[])<=0&&t.push(e.getClusterName(i))}),_.size(t)&&this.showHeaderWarning(this.i18ns("nameServerNotConfigured",t.join(", ")))}})}),define("text!templates/popups/cluster/SchedulerView.html",[],function(){return'<section data-ntnx-section>\n  <h5 data-ntnx-title>\n    <%= i18n(\'schedulerTitle\') %>\n  </h5>\n</section>\n\n<section data-ntnx-section="type-text">\n  <%= i18n(\'applyScheduleTitle\')%>\n</section>\n\n<section data-ntnx-section="type-text">\n  <div data-ntnx-form-inline>\n    <%= Components.radio({\n      id      :\'immediatelyUpgrade\',\n      name    :\'upgrade\',\n      classes :\'action schedule-type upgrade-immediately\',\n      attributes: \'data-id=upgrade-immediately\',\n      checked : true\n    })\n    %>\n    <label data-ntnx-inline-label>\n      <%= i18n( "immediatelyUpgrade") %>\n    </label>\n  </div>\n\n  <div data-ntnx-form-inline>\n    <%= Components.radio({\n      id      :\'scheduleUpgrade\',\n      name    :\'upgrade\',\n      classes :\'action schedule-type schedule-upgrade\',\n      attributes: \'data-id=schedule-upgrade\',\n      checked : false\n    })\n    %>\n    <label data-ntnx-inline-label>\n      <%= i18n("scheduleUpgrade") %>\n    </label>\n  </div>\n</section>\n\n<div class="schedule-content" style="display:none">\n\n  <section data-ntnx-section="type-separator">\n    <h5 data-ntnx-title>\n    <%= i18n("scheduleUpgradeTitle") %>\n    </h5>\n  </section>\n\n  <section data-ntnx-section="type-text">\n    <%= i18n(\'installTitle\')%>\n  </section>\n  <section data-ntnx-section>\n    <div data-ntnx-form-inline class="schedule-form-inline">\n      <div class="start-time-control">\n        \x3c!-- Hour control here--\x3e\n      </div>\n      <div class="timezone-control combobox-wrapper">\n        \x3c!-- Time zone control here--\x3e\n      </div>\n      <input id="scheduledDatePicker" class="input-small datepicker"\n             data-date="<%= scheduledDate %>" type="text">\n    </div>\n  </section>\n  <section data-ntnx-section class="maintenance-section">\n    <div data-ntnx-form-inline class="maintenance-form-inline">\n      <%= Components.checkbox({\n      id     : \'enable-maintenance\',\n      checked: false,\n      }) %>\n      <label for="enable-maintenance" data-ntnx-inline-label\n             class="maintenance-label">\n        <%= i18n("maintenance") %>\n      </label>\n      <div class="end-time-control">\n        \x3c!-- Hour control here--\x3e\n      </div>\n      <input id="maintenanceDatePicker" class="input-small datepicker"\n             type="text"  data-date="<%= scheduledDate %>">\n      <span class="maintenance-tooltip" data-toggle="tooltip"\n            data-original-title="<%= i18n(\'timeoutTooltip\') %>">\n        <%= Components.icon("question-tooltip","-regular -inline") %>\n      </span>\n    </div>\n  </section>\n\n  <section data-ntnx-section="type-separator">\n    <h5 data-ntnx-title>\n      Summary\n    </h5>\n  </section>\n\n  <section data-ntnx-section="type-text">\n    <div class="start-time-summary time-summary-inline">\n      \x3c!-- Schedule summary here--\x3e\n    </div>\n    <div class="end-time-summary time-summary-inline">\n      \x3c!-- Maintenance summary here--\x3e\n    </div>\n  </section>\n</div>'}),define("views/popups/cluster/SchedulerView",["views/basecomponents/popups/BasePopupSubView","components/Components","utils/AppConstants","utils/TimeUtil","utils/ComboBox","text!templates/popups/cluster/SchedulerView.html"],function(e,t,n,i,s,a){"use strict";var o=_.template(a),r={START_TIME:"start_time",SCHEDULED_TIME:"scheduled_time",TIMEOUT_SECS:"timeout_secs",TIME_ZONE:"time_zone"},l=_.template('<%= i18n (key) %><span class="time-summary"><%= localTime %> (<%= timeWithTimeZone %>)</span>');return e.extend({name:"SchedulerView",events:{"select .input-timezone":"onTimeZoneChanged","change #startTime":"onScheduleTimeChanged","change #endTime":"onMaintenanceTimeChanged","change .n-radio[name=upgrade]":"onScheduleTypeChanged","click #enable-maintenance":"onMaintenanceChecked"},scheduleDetails:null,initialize:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.prototype.initialize.apply(this,arguments),this.scheduleDetails=t.scheduleDetails},render:function(){var e=this;this.$el.html(o(this.vtOptions({scheduledDate:new Date})));var t=this.getInitialScheduleDetails(),s=t[r.START_TIME]||new Date,a=void 0;t[r.SCHEDULED_TIME]?a=t[r.SCHEDULED_TIME].getHours():(a=s.getHours(),a+=1),this.$("#scheduledDatePicker").datepicker(_.extend({startDate:new Date},i.getDatePickerOptions())).on("changeDate",function(t){e.onScheduleTimeChanged()}),this.$("#scheduledDatePicker").datepicker("setDate",s);var l=null;t[r.START_TIME]&&t[r.TIMEOUT_SECS]&&(l=new Date(t[r.START_TIME].getTime()+t[r.TIMEOUT_SECS]*n.MILLIS_PER_SECOND)),l=l||s;var c=l.getHours();return t[r.TIMEOUT_SECS]||(c+=1),this.$("#maintenanceDatePicker").datepicker(_.extend({startDate:new Date},i.getDatePickerOptions())).on("changeDate",function(t){e.onMaintenanceTimeChanged(t)}),this.$("#maintenanceDatePicker").datepicker("setDate",l),this.$(".maintenance-tooltip").tooltip({trigger:"hover",container:$("body")}),this._renderTimeZoneSelector(t[r.TIME_ZONE]),this._renderHourSelector(a,c),t[r.START_TIME]?(this.$(".n-radio[data-id=schedule-upgrade]").attr("checked",!0),this.$(".schedule-content").show(),this.triggerAction(n.MODAL.ACT.AS_REBUILD,{triggerResize:!0})):this.triggerAction(n.MODAL.ACT.AS_REFRESH),this.applyNutanixInput(),this.isViewRendered=!0,this.onScheduleTimeChanged(),this},refreshView:function(e){e&&e.showMaintenanceWindow?this.$(".maintenance-section").show():this.$(".maintenance-section").hide()},destroy:function(){this.$("#scheduledDatePicker").datepicker("destroy"),this.$("#maintenanceDatePicker").datepicker("destroy"),this.$(".maintenance-tooltip").tooltip("destroy"),e.prototype.destroy.apply(this,arguments)},saveViewData:function(e){if(this.$("#immediatelyUpgrade").is(":checked"))e.setSchedule(null);else{if(!this._getSchedule())return!1;e.setSchedule(this._getSchedule())}return!0},_getSchedule:function(){var e=this._getScheduleDateTime();if(!e)return!1;var t=this.$(".input-timezone").val(),i=new Date,s=new Date(e),a=i.getTime()+10*n.MILLIS_PER_MINUTE,o=i.getTime()+30*n.MILLIS_PER_DAY;if(s.getTime()<=a)return this.triggerAction(n.MODAL.ACT.ALERT_SHOW,{type:n.MODAL.ALERT.TYPE_ERROR,message:this.i18ns("invalidTimeError",this._dateTimeByTimeZone(new Date,t))}),null;if(s.getTime()>o)return this.triggerAction(n.MODAL.ACT.ALERT_SHOW,{type:n.MODAL.ALERT.TYPE_ERROR,message:this.i18n("invalidTimeBeyond30Days")}),null;var l=this._getMaintenanceDateTime(),c=l&&new Date(l);if(c&&c.getTime()<=s.getTime())return this.triggerAction(n.MODAL.ACT.ALERT_SHOW,{type:n.MODAL.ALERT.TYPE_ERROR,message:this.i18n("invalidMaintenanceTime")}),!1;var d={};return d[r.START_TIME]=e,d[r.TIME_ZONE]=t,c&&(d[r.TIMEOUT_SECS]=(c.getTime()-s.getTime())/n.MILLIS_PER_SECOND),d},_renderTimeZoneSelector:function(e){var t=e||i.getDefaultTimezone();i.createTimezoneComboBox(this.$(".timezone-control"),t),this.$(".input-timezone").combobox({initalSelectPrompt:this.i18n("selectTimeZone"),initialSelectValue:t}),$(".ui-autocomplete").appendTo(".timezone-results")},_renderHourSelector:function(e,n){var s=e;s>=24&&(s=0),this.$(".start-time-control").html(t.select({id:"startTime",jsClasses:"start-time",options:i.getHourOptions(s)})),s=n,s>=24&&(s=0),this.$(".end-time-control").html(t.select({id:"endTime",jsClasses:"end-time",options:i.getHourOptions(s)}))},_getScheduleDateTime:function(){var e=this.$("#scheduledDatePicker").datepicker("getDate"),t=this.$("#startTime").val();return this._dateTimeToISOString(e,t)},_dateTimeToISOString:function(e,t){var s=this.$(".input-timezone").val();return""===s?(this.triggerAction(n.MODAL.ACT.ALERT_SHOW,{type:n.MODAL.ALERT.TYPE_ERROR,message:this.i18n("selectTimeZone")}),null):(e.setHours(t,0,0),i.toISODateTimeString(e,s))},_getMaintenanceDateTime:function(){if(this.$("#enable-maintenance").is(":checked")){var e=this.$("#maintenanceDatePicker").datepicker("getDate"),t=this.$("#endTime").val();return this._dateTimeToISOString(e,t)}},_dateTimeByTimeZone:function(e,t){return i.formatDateTimeWithTimeZone(e,t)},onScheduleTypeChanged:function(e){var t=$(e.currentTarget),i="upgrade-immediately"===t.attr("data-id");i?this.$(".schedule-content").hide():this.$(".schedule-content").show(),this.triggerAction(n.MODAL.ACT.AS_REBUILD,{triggerResize:!i})},onScheduleTimeChanged:function(){if(this.isViewRendered){var e=this._getScheduleDateTime();if(e){var t=this.$(".input-timezone").val();this.$(".start-time-summary").html(l(this.vtOptions({key:"startAt",localTime:i.formatFullDateTime(new Date(e)),timeWithTimeZone:this._dateTimeByTimeZone(e,t)}))),this.adjustMaintenanceTime(e)}}},onMaintenanceTimeChanged:function(e){if(this.isViewRendered){if(e)if(e.date)this.$("#enable-maintenance").prop("checked",!0);else{var t=$(e.currentTarget);t.hasClass("end-time")&&this.$("#enable-maintenance").prop("checked",!0)}var n=this._getMaintenanceDateTime();if(n){var s=this.$(".input-timezone").val();this.$(".end-time-summary").html(l(this.vtOptions({key:"timeout",localTime:i.formatFullDateTime(new Date(n)),timeWithTimeZone:this._dateTimeByTimeZone(n,s)})))}else this.$(".end-time-summary").html("")}},onMaintenanceChecked:function(){this.adjustMaintenanceTime(),this.onMaintenanceTimeChanged()},onTimeZoneChanged:function(){this.onScheduleTimeChanged(),this.onMaintenanceTimeChanged()},adjustMaintenanceTime:function(e){if(this.$("#enable-maintenance").is(":checked")){var t=new Date(e||this._getScheduleDateTime()),n=this._getMaintenanceDateTime();if(!n||new Date(n).getTime()<=t.getTime()){var i=t.getHours()+1;24===i&&(i=0,t.setDate(t.getDate()+1)),this.$("#maintenanceDatePicker").datepicker("setDate",t),this.$("#endTime").val(i),this.$("#endTime").trigger("update")}}},getInitialScheduleDetails:function(){var e={};return this.scheduleDetails&&(e[r.TIME_ZONE]=this.scheduleDetails[r.TIME_ZONE],e[r.START_TIME]=new Date(this.scheduleDetails[r.START_TIME]),e[r.SCHEDULED_TIME]=i.getDateWithTimeZone(this.scheduleDetails[r.START_TIME],e[r.TIME_ZONE]),e[r.TIMEOUT_SECS]=this.scheduleDetails[r.TIMEOUT_SECS]),e}})}),define("text!templates/popups/cluster/PreUpgradeMessageView.html",[],function(){return'<section data-ntnx-section>\n  <h5 data-ntnx-title>\n    <%= title || i18n(\'notificationTitle\') %>\n  </h5>\n</section>\n<div class="notification-wrapper">\n  <% _.each(notifications, function(list, key) { %>\n    <section data-ntnx-section="type-separator"\n             class="notification-item-title">\n      <%= list.itemLabel %>\n    </section>\n    <div class="notification-group">\n    <% _.each(list.notifications, function(notification) { %>\n      <div class="notification-item">\n        <span class="<%= notification.severity_level %>-icon">\n          <%= Components.icon(\'Circular_Exclamation\',\n          \' -large -\' + notification.severity_level) %>\n        </span>\n        <div>\n          <%= notification.message %>\n        </div>\n      </div>\n    <% }) %>\n    </div>\n  <% }) %>\n</div>\n<section data-ntnx-section="type-text">\n  <%= i18ns(\'upgradeConfirmVersion\', version) %>\n</section>\n<section data-ntnx-section="type-text">\n  <%= i18n(\'upgradeConfirmNote\') %>\n</section>'}),define("views/popups/cluster/PreUpgradeMessageView",["views/basecomponents/BaseSubView","data/DataProperties","utils/AppConstants","utils/AppUtil","text!templates/popups/cluster/PreUpgradeMessageView.html"],function(e,t,n,i,s){"use strict";var a={UPGRADE_NOTIFICATION_KEY:"upgrade_notification",DESCRIPTION_LIST:"description_item_list",AFFECTED_RELEASE_LIST:"affected_release_list",PROCEED_MESSAGE:"proceed_message"},o=_.template('<a class="item-tooltip" data-id="<%= index %>"><%= more %></a>'),r=_.template(s);return e.extend({name:"PreUpgradeMessageView",initialize:function(t){e.prototype.initialize.apply(this,arguments),this.setViewOptions(t)},render:function(){var e=this.findNotificationByVersion(this.version),t=r(this.vtOptions({title:e&&e.title,version:this.version,notifications:this.notifications}));this.$el.html(t);var n=this;return this.$(".item-tooltip").tooltip({title:function(){var e=parseInt($(this).attr("data-id"),10);return n._getItemTooltip(e)},placement:"bottom",trigger:"hover",html:!0}),this},setViewOptions:function(e){this.model=e.model,this.version=e.version,this.clusterUUids=e.clusterUUids,this.notifications=this._getNotificationMessageByVersion(this.version);var t=0;this.notifications=_.map(this.notifications,function(e){return{itemLabel:this._getNotificationItemLabel(e,t++),notifications:e}},this)},destroy:function(){this.$(".item-tooltip").tooltip("destroy"),e.prototype.destroy.apply(this,arguments)},hasNotificationMessage:function(){return _.size(this.notifications)},getNotificationProceedMsg:function(){return this.findNotificationByVersion(this.version)[a.PROCEED_MESSAGE]},findNotificationByVersion:function(e){var n=this.model.get(t.RESULT_ENTITIES),i=_.find(n,function(t){return t.version===e});return i&&i[a.UPGRADE_NOTIFICATION_KEY]},_getNotificationMessageByVersion:function(e){var t=this,n=this.findNotificationByVersion(e),i=[];if(n){var s=n[a.DESCRIPTION_LIST];_.each(s,function(e){var n=t._getAffectedClusters(e[a.AFFECTED_RELEASE_LIST]);_.size(n)&&i.push(_.extend({clusters:n},e))})}return _.groupBy(i,function(e){return _.map(e.clusters,function(e){return e}).join(", ")})},_getAffectedClusters:function(e){var t=this,n=[];return _.each(this.clusterUUids,function(i,s){var a=t.clusterManager.getClusterModelByClusterUuid(i);a&&_.contains(e,a.getNosVersion())&&n.push(a.getName())}),n},_getNotificationItemLabel:function(e,t){var s="";_.size(e)>1&&(s="Plural");var a=_.first(e),r=a.clusters,l=_.size(a.clusters);if(l>2){r=a.clusters.slice(0,2);var c=l-2,d=this.i18ns("moreLabel",c,i.getEntityNameFromCount(n.ENTITY_CLUSTER,c));return this.i18ns("notificationMoreItemTitle"+s,r.join(", "),o({more:d,index:t}))}var p=i.getEntityNameFromCount(n.ENTITY_CLUSTER,l).toLowerCase();return this.i18ns("notificationItemTitle"+s,p,r.join(", "))},_getItemTooltip:function(e){var t=this.notifications[e];return _.first(t.notifications).clusters.slice(2).join("<br>")}})}),define("text!templates/popups/cluster/ClusterUpdateContentView.html",[],function(){return'\x3c!-- The parent div modal is #popup  --\x3e\n<div data-ntnx-content-inner class="upgrade-content-wrapper">\n  <div class="upgrade-content-view">\n    \x3c!--Upgrade content Viewer here--\x3e\n  </div>\n  <div class="upgrade-scheduler-view">\n    \x3c!--Scheduler Viewer here--\x3e\n  </div>\n  <div class="preupgrade-content-view">\n    \x3c!--Preupgrade Viewer here--\x3e\n  </div>\n</div>'}),define("views/popups/cluster/ClusterUpdatePopupView",["views/basecomponents/popups/BasePopupView","views/popups/cluster/ClusterUpgradeDetailsView","views/popups/cluster/SchedulerView","views/popups/cluster/PreUpgradeMessageView","models/cluster/MulticlusterConfigModel","models/query/QueryResultCollection","data/DataProperties","managers/LicenseManager","managers/NavigationManager","utils/ManagerMixin","utils/AppConstants","utils/AppUtil","utils/FilterUtil","utils/SubViewHelper","text!templates/popups/cluster/ClusterUpdateContentView.html"],function(e,t,n,i,s,a,o,r,l,c,d,p,u,h,m){"use strict";var f={UPGRADE_NOW:"upgradeNow",SCHEDULE_UPGRADE:"scheduleUpgrade"},v=_.template('.tab-upgrade[actiontarget="<%= actionTarget %>"]');return e.extend({el:"#popupClusterUpdate",name:"ClusterUpdatePopupView",events:{"click .btnCancel":"onCancel","click .modal-header .close":"hide","click .btnUpgrade":"onUpgrade"},subViewHelper:null,overlayPopup:!0,upgradeInProgress:!1,scheduleTask:null,hasAvailableVersion:!1,showScheduler:!1,initialize:function(t){e.prototype.initialize.apply(this,arguments),this.subViewHelper=new h,_.bindAll(this,"_onResize"),$(window).on("resize.app",this._onResize),this.showScheduler&&this.addExtraEvents({"click .btnNext":"onShowSchedulerView","click .btnBack":"onShowSchedulerView","click .tab-upgrade":"onShowSchedulerView"})},render:function(){var e=[{text:this.i18n("cancel"),extraClasses:"btnCancel n-btn-list"},{isPrimary:!0,text:this.i18n("upgrade"),extraClasses:"btnUpgrade btn-edit -btn-list hide"}];this.showScheduler&&(e.push({isPrimary:!0,text:this.i18n("next"),extraClasses:"btnNext btn-edit -btn-list",extraAttr:[{key:d.NAV_ACTION,value:d.ACTION_SHOW_SUBVIEW},{key:d.NAV_ACTION_TARGET,value:f.SCHEDULE_UPGRADE}]}),e.push({leftAligned:!0,text:this.i18n("back"),extraClasses:"btnBack hide",extraAttr:[{key:d.NAV_ACTION,value:d.ACTION_SHOW_SUBVIEW},{key:d.NAV_ACTION_TARGET,value:f.UPGRADE_NOW}]}));var t={title:this.i18n("upgradeSoftwareTitle"),bodyContent:m,footerButtons:this.defaultFooter(e)};this.showScheduler&&(t.tabs=!0,t.tabsList=this.defaultTabs([{isActive:!0,text:this.i18n("upgradeDetails"),extraClasses:"tab-upgrade ",extraAttr:[{key:d.NAV_ACTION,value:d.ACTION_SHOW_SUBVIEW},{key:d.NAV_ACTION_TARGET,value:f.UPGRADE_NOW}]},{isActive:!1,text:this.i18n("createSchedule"),extraClasses:"tab-upgrade",extraAttr:[{key:d.NAV_ACTION,value:d.ACTION_SHOW_SUBVIEW},{key:d.NAV_ACTION_TARGET,value:f.SCHEDULE_UPGRADE}]}])),this.$el.html(this.defaultTemplate(t)),this.defaultMaxContentHeight=parseInt(this.$(".n-modal-content").css("max-height"),10),this.$(".tab-upgrade").attr("disabled","disabled"),this.showView(f.UPGRADE_NOW);var n=r.FEATURE_MAP.LICENSE_PC_MULTICLUSTER_UPGRADE;return r.violatedFeatureLicense(n)&&this.showHeaderWarning(r.getPopupMessageTemplate(n)),this.triggerAction(d.MODAL.ACT.AS_REBUILD),this},show:function(t){var n=t[d.NAV_ACTION_TARGET_ID],i=t[d.NAV_ACTION_TARGET],s=[];if(i===d.ENTITY_MULTICLUSTER_CONFIG_SPEC){var a=n;n&&!_.isArray(n)&&(a=n.split(","));var r=c.getTaskManager().getTaskById(_.first(a));s=r.get(o.TASK_ENTITY_ID),this.scheduleTask=r}else s=n?n.split(","):[];var l=s.length;l>50&&(s=_.first(s,50)),this.$(".n-title").html(this.i18ns("updateTitle",l)),this.uuids=s,e.prototype.show.apply(this,arguments)},clearHeader:function(){this.$(".alert-warning").is(":visible")||e.prototype.clearHeader.apply(this,arguments)},destroy:function(){this.subViewHelper.destroy(),$(window).off("resize.app",this._onResize),e.prototype.destroy.apply(this,arguments)},onUpgrade:function(e){if(!this.upgradeInProgress){if($(e.currentTarget).hasClass("btnUpgradeConfirm"))this.performUpgrade(this.updateModel);else{var t=new s,n=this.subViewHelper.get(f.UPGRADE_NOW);if(!n.saveViewData(t))return;if(this.showScheduler){if(!this.subViewHelper.get(f.SCHEDULE_UPGRADE).saveViewData(t))return}var i=this.getPreUpgradeView(t.getVersion(),n.getVersionsModel(),t.getClusters());if(i&&i.hasNotificationMessage()){i.render(),this.updateModel=t;var a=i.getNotificationProceedMsg();a&&(a=this.i18n(a)||a),this.$(".btnUpgrade").addClass("btnUpgradeConfirm"),this.$(".btnUpgrade").html(a||this.i18n("continue")),this.$(".preupgrade-content-view").show(),this.$(".upgrade-content-view").hide(),this.triggerAction(d.MODAL.ACT.AS_REBUILD)}else this.performUpgrade(t)}}},onCancel:function(e){this.$(".btnUpgrade").hasClass("btnUpgradeConfirm")?(this.$(".btnUpgrade").removeClass("btnUpgradeConfirm"),this.$(".btnUpgrade").html(this.i18n("upgrade")),this.$(".preupgrade-content-view").hide(),this.$(".upgrade-content-view").show(),this.triggerAction(d.MODAL.ACT.AS_REBUILD),this.updateModel=null):this.hide()},performUpgrade:function(e){var t=this;this.upgradeInProgress=!0,this.$(".btnUpgrade").button("loading"),this.clusterStateChecks(e.getClusters(),function(){t.onUpgradeStateVerified(e)})},saveUpgradeModel:function(e){var t=this,n="POST";this.scheduleTask&&(n="PUT",e.setId(this.scheduleTask.getId()),e.setSpecVersion(this.scheduleTask.get(o.INTENT_SPEC_ATTR.VERSION)));var i=!1;$.nutanixConfirm({msg:this.i18n("processing"),yes:function(){i||t.hide()},hideNo:!0,hideYes:!0,context:this}),e.setActionMode(null),e.save(null,{type:n,success:function(){c.getTaskManager().fetchOnDemand(),$("#nutanixConfirmModal .btnYes").click()},error:function(e,n){i=!0,$("#nutanixConfirmModal .btnYes").click(),t._resetUpgradeState(),t.showHeaderErrorWithDetails(t.i18n("updatingError"),n)}})},onUpgradeStateVerified:function(e){this.saveUpgradeModel(e)},clusterStateChecks:function(e,t){this.clusterRequiresVMsPoweredOff(e,t)},clusterRequiresVMsPoweredOff:function(e,t){var n=this,i=this.get1and2NodeClusterModels(e);if(!i.length)return void t();var s={};u.addFilterCondition(s,o.EB.VM.POWER_STATE,u.createFilterCondition(d.ENTITY_VM,o.EB.VM.POWER_STATE,d.FILTER_OPERATORS.EQUALS,d.VM_POWER_STATE.ON)),u.addFilterCondition(s,o.EB.VM.IS_CVM,u.createFilterCondition(d.ENTITY_VM,o.EB.VM.IS_CVM,d.FILTER_OPERATORS.EQUALS,0));var r=_.map(i,function(e){return e.getId()});u.addFilterConditions(s,d.ENTITY_VM,o.EB.CLUSTER_UUID,r);var l=new a(null,{entity_type:d.ENTITY_VM,group_member_attributes:[o.EB.VM.VM_NAME,o.EB.CLUSTER_UUID],filter_expression:s});l.fetch().done(function(){if(l.length){var e=_.groupBy(l.models,function(e){return e.get(o.EB.CLUSTER_UUID)});n.warnVMsNeedPowerOff(l.length,e),n._resetUpgradeState()}else t()}).fail(function(e,t){n._resetUpgradeState(),p.log("ClusterUpdatePopupView: failed to fetch VMs"),n.showHeaderErrorWithDetails(n.i18n("vmLoadingError"),t.responseText)})},get1and2NodeClusterModels:function(e){var t=this;return _.filter(e,function(e){var n=e.get(o.ID);return t.clusterManager.getClusterModelByClusterUuid(n).get(o.CLUSTER_NUM_NODES)<=2})},warnVMsNeedPowerOff:function(e,t){var n=this,i="",s={},a=u.createFilterCondition(d.ENTITY_VM,o.EB.VM.POWER_STATE,d.FILTER_OPERATORS.CONTAINS,d.VM_POWER_STATE.ON);u.addFilterCondition(s,o.EB.VM.POWER_STATE,a),_.each(t,function(e,t){var r=n.clusterManager.getClusterModelByClusterUuid(t),l=r.get(o.NAME),c=_.size(e),h={};u.addFilterCondition(h,o.EB.VM.POWER_STATE,a);var m=u.createFilterCondition(d.ENTITY_VM,o.EB.VM.CLUSTER_NAME,d.FILTER_OPERATORS.CONTAINS,l);h=u.addFilterCondition(h,o.EB.VM.CLUSTER_NAME,m),u.addFilterCondition(s,o.EB.VM.CLUSTER_NAME,m),i+="<div class='cluster-vms-poweroff'>\n                <span class='cluster-name'>"+l+"</span>\n                <a href=\"#\"\n                  class='cluster-vm-poweroff-count vmsLink'\n                  data-eb-filter='"+JSON.stringify(h)+"'>\n                  "+c+"\n                  "+p.getPluralEntityName(d.ENTITY_VM)+"\n                </a>\n            </div>"});var r=_.size(t)>1;if(r){var c=[e,p.getPluralEntityName(d.ENTITY_VM)].join(" "),h='<div class="show-all-link">\n            <a href="#"\n              class=\'vmsLink\'\n              data-eb-filter=\''+JSON.stringify(s)+"'>\n              "+this.i18nsStatic("SoftwareUpgradeView","show_all_vms",c)+"\n            </a>\n          </div>";i+=h}var m='<div class="confirmMsg">\n          <p>\n            '+this.i18nStatic("SoftwareUpgradeView","vm_power_state_warning_pc")+'\n          </p>\n          <div class="cluster-vms-poweroff-list\n            '+(r?"multiple":"")+'">\n            '+i+"\n          </div>\n          <p>\n            "+this.i18nStatic("SoftwareUpgradeView","uvm_power_state_warning")+"\n          </p>\n        </div>",f=$(m);f.find(".vmsLink").on("click",function(e){e.preventDefault();var t=$(e.currentTarget),i=JSON.parse(t.attr("data-eb-filter"));$("#nutanixConfirmModal .btnYes").trigger("click"),n.hide(!0),l.navigateToEBPage(d.ENTITY_VM,null,null,null,i)}),$.nutanixConfirm({msg:f,hideNo:!0,class:"cluster-power-off-warning -left-align"})},onShowSchedulerView:function(e){if(this.showScheduler){var t=$(e.currentTarget),n=t.attr(d.NAV_ACTION_TARGET);(t.hasClass("btnBack")||t.hasClass("btnNext"))&&this.$(v({actionTarget:n})).tab("show"),this.showView(n),this.triggerAction(d.MODAL.ACT.AS_REBUILD)}},showView:function(e){var i=void 0;if(e===f.UPGRADE_NOW)this.$(".upgrade-content-view").show(),this.showScheduler&&(this.$(".upgrade-scheduler-view").hide(),this.$(".btnBack").hide()),i=this.subViewHelper.get(f.UPGRADE_NOW),i?this.showScheduler&&this.$(".btnNext").show():(this.showScheduler&&this.$(".btnNext").hide(),i=new t({el:this.$(".upgrade-content-view"),uuids:this.uuids,upgradeDetails:this.getInitialUpgradeDetails()}),i.setParentView(this),this.subViewHelper.register(f.UPGRADE_NOW,i),i.render());else if(this.showScheduler){var a=this.subViewHelper.get(f.UPGRADE_NOW);this.$(".upgrade-content-view").hide(),this.$(".upgrade-scheduler-view").show(),this.$(".btnBack").show(),this.$(".btnNext").hide(),this.hasAvailableVersion&&this.$(".btnUpgrade").show(),i=this.subViewHelper.get(f.SCHEDULE_UPGRADE),i||(i=new n({el:this.$(".upgrade-scheduler-view"),scheduleDetails:this.getScheduleDetailsFromTask()}),i.setParentView(this),this.subViewHelper.register(f.SCHEDULE_UPGRADE,i),i.render()),i.refreshView({showMaintenanceWindow:a.getSelectedExecutionPlan()===s.DP.SEQUENTIAL})}},setDataLoaded:function(e){this.initialized=!0,this.hasAvailableVersion=_.size(e),this.showScheduler?(this.$(".btnNext").show(),this.$(".tab-upgrade").removeAttr("disabled")):this.hasAvailableVersion&&this.$(".btnUpgrade").show()},_onResize:_.throttle(function(){this._resizeModalContentContainer(!0)},100),_resizeModalContentContainer:function(e){var t=this.$(".n-modal-body").height(),n=this.$(".n-modal-alert-header").height(),i=this.$(".n-modal-tabs").height(),s=t-n-i;s=Math.max(s,this.defaultMaxContentHeight),parseInt(this.$(".n-modal-content").css("max-height"),10)!==s&&(this.$(".n-modal-content").css("max-height",s+"px"),e&&this.triggerAction(d.MODAL.ACT.AS_REBUILD))},_rebuildAntiscroll:function(t){t&&t.triggerResize&&this._resizeModalContentContainer(!1),e.prototype._rebuildAntiscroll.apply(this,arguments)},_resetUpgradeState:function(){this.upgradeInProgress=!1,this.$(".btnUpgrade").button("reset")},getInitialUpgradeDetails:function(){var e=s.DP.PARALLEL,t=null;if(this.scheduleTask){t=this.scheduleTask.get(o.UPGRADE_VERSION_ID);var n=this.scheduleTask.get(s.DP.SPEC_JSON),i=n[o.INTENT_RESOURCES];e=i&&i[s.DP.EXECUTION_PLAN]}var a={};return a[s.DP.EXECUTION_PLAN]=e,a[o.UPGRADE_VERSION_ID]=t,a},getScheduleDetailsFromTask:function(){if(this.scheduleTask){var e=this.scheduleTask.get(s.DP.SPEC_JSON),t=e&&e[o.INTENT_RESOURCES];if(t)return t[s.DP.UPGRADE_SCHEDULE]}return null},getPreUpgradeView:function(e,t,n){var s=this.subViewHelper.register("preUpgradeView"),a={version:e,clusterUUids:_.map(n,function(e){return e.getId()}),model:t};return s?s.setViewOptions(a):(s=new i(_.extend({el:this.$(".preupgrade-content-view")},a)),this.subViewHelper.register("preUpgradeView",s)),s}})}),define("models/cluster/ClusterV3Model",["models/intent/IntentDynamicModel","data/DataProperties","managers/IntentManager","utils/AppConstants","utils/AppUtil"],function(e,t,n,i,s){"use strict";return e.extend({entityType:i.ENTITY_CLUSTER,name:"ClusterV3Model",enableNotifications:!1,getURL:function(e,t){if("create"===e)throw new Error("Cluster entity cannot be created, it can only be updated.");var i=n.getURLObject(this.entityType,n.SWAGGER_REST.GET,{includeUuid:!0}),s=i.url.replace(/\{(.*?)\}/g,this.getId());return s=s.replace(/^\//,"")},fetch:function(){this.setRootUrl(this.getDataSourceURL());var t={parse:this.parse.bind(this),set:function(){}};return e.prototype.fetch.apply(this,t)},saveDefaultVswitchConfig:function(e,i){this.isNew(!1);var a=this.toJSON(),o=s.getObjectPathValue(a,"status.resources.network");o[t.CLUSTER_DEFAULT_VSWITCH]=e;var r={spec:{resources:{network:o}}},l=n.mergeEntityWithViewModel(a,r),c=this.getId();return this.clear({silent:!0}),this.setId(c,!0),this.set(l,{silent:!0}),this.save(null,i)},getDefaultVSwitchConfig:function(){var e=this.toJSON(),n=s.getObjectPathValue(e,"status.resources.network");return n&&n[t.CLUSTER_DEFAULT_VSWITCH]}})}),define("text!templates/popups/cluster/ClusterUplinkContentView.html",[],function(){
return"\x3c!-- The parent div modal is #popupClusterUplinkDetails --\x3e\n<div data-ntnx-content-inner>\n  <section data-ntnx-section=\"type-text\">\n    <%= i18n('uplink_config_popup_description') %>\n  </section>\n  <% if (isDataFetched) { %>\n    <form>\n      \x3c!-- Uplink Configuration without LAG --\x3e\n      <section data-ntnx-section>\n        <label data-ntnx-label><%= i18n('uplink_config_without_lag') %></label>\n        <section data-ntnx-section class=\"uplink-grouping\">\n          <div class=\"uplinkSection uplink-section\">\n            <div data-ntnx-form-inline=\"form-full-width\" class=\"uplinkType\">\n              <%= Components.radio({\n              id        :'activeBackup',\n              name      :'uplink',\n              jsClasses :'action uplink-type activeBackup',\n              checked   : mode === 'ACTIVE_BACKUP',\n              value     : 'ACTIVE_BACKUP',\n              labelText : i18n( 'active_backup')\n              })%>\n\n              <div data-ntnx-action-input>\n                <a class=\"toggle-details pull-right\">\n                  <%= i18n(\"show_details\") %>\n                </a>\n              </div>\n            </div>\n            <div data-ntnx-input-container class=\"details hide\">\n              <div data-ntnx-hint>\n                <%= i18n('load_balancing_text_active_backup') %>\n              </div>\n            </div>\n          </div>\n\n          <div class=\"uplinkSection uplink-section\">\n            <div data-ntnx-form-inline=\"form-full-width\" class=\"uplinkType\">\n              <%= Components.radio({\n              id        :'activeActiveMac',\n              name      :'uplink',\n              jsClasses :'action uplink-type activeActiveMacPinning',\n              checked   : mode === 'ACTIVE_ACTIVE_MAC_PINNING',\n              value     : 'ACTIVE_ACTIVE_MAC_PINNING',\n              labelText : i18n( 'active_active_mac_pinning')\n              })%>\n\n              <div data-ntnx-action-input>\n                <a class=\"toggle-details pull-right\">\n                  <%= i18n(\"show_details\") %>\n                </a>\n              </div>\n            </div>\n            <div data-ntnx-form-inline=\"form-full-width\">\n              <div data-ntnx-input-container class=\"details hide\">\n                <div data-ntnx-hint>\n                  <%= i18n('load_balancing_text_active_active_mac_pinning') %>\n                </div>\n              </div>\n            </div>\n          </div>\n        </section>\n      </section>\n      \x3c!-- Uplink Configuration with LAG --\x3e\n      <section data-ntnx-section>\n        <label data-ntnx-label><%= i18n('uplink_config_with_lag') %></label>\n        <section data-ntnx-section class=\"uplink-grouping\">\n          <div class=\"uplinkSection uplink-section\">\n            <div data-ntnx-form-inline=\"form-full-width\" class=\"uplinkType\">\n              <%= Components.radio({\n              id        :'activeActive',\n              name      :'uplink',\n              jsClasses :'action uplink-type activeActive',\n              checked   : mode === 'ACTIVE_ACTIVE',\n              value     : 'ACTIVE_ACTIVE',\n              labelText : i18n( 'active_active')\n              })%>\n\n              <div data-ntnx-action-input>\n                <a class=\"toggle-details pull-right\">\n                  <%= i18n(\"show_details\") %>\n                </a>\n              </div>\n            </div>\n            <div data-ntnx-form-inline=\"form-full-width\">\n              <div data-ntnx-input-container class=\"details hide\">\n                <div data-ntnx-hint>\n                  <%= i18n('load_balancing_text_active_active') %>\n                </div>\n              </div>\n            </div>\n          </div>\n        </section>\n      </section>\n\n      \x3c!-- Nic Configuration --\x3e\n      <section data-ntnx-section>\n        <label data-ntnx-label><%= i18n('nic_config') %></label>\n        <%= Components.select({\n          id        : 'nic-config',\n          jsClasses :'nicVersion',\n          options   : nicVersions,\n          useBrowserSelect: true\n        })%>\n      </section>\n    </form>\n  <% } %>\n</div>"}),define("views/popups/cluster/ClusterUplinkPopupView",["views/basecomponents/popups/BasePopupView","models/cluster/ClusterV3Model","models/query/BaseQueryModel","data/DataProperties","managers/NotificationManager","managers/TaskManager","utils/AppConstants","utils/AppUtil","text!templates/popups/cluster/ClusterUplinkContentView.html"],function(e,t,n,i,s,a,o,r,l){"use strict";l=_.template(l);var c=_.template('\n      <div data-ntnx-content-inner>\n        <section data-ntnx-section="type-text">\n          <%= msg %>\n        </section>\n      </div>'),d={ACTIVE_ACTIVE:"ACTIVE_ACTIVE",ACTIVE_BACKUP:"ACTIVE_BACKUP",ACTIVE_ACTIVE_MAC_PINNING:"ACTIVE_ACTIVE_MAC_PINNING"},p={NO_UPLINKS:"NO_UPLINKS",ALL:"ALL",ALL_1G:"ALL_1G",ALL_10G:"ALL_10G",ALL_25G:"ALL_25G",ALL_40G:"ALL_40G",ALL_100G:"ALL_100G"},u={1e4:p.ALL_10G,1e3:p.ALL_1G,25e3:p.ALL_25G,4e4:p.ALL_40G,1e5:p.ALL_100G},h={ALL_1G:"1G",ALL_10G:"10G",ALL_25G:"25G",ALL_40G:"40G",ALL_100G:"100G",ALL:""},m=i.CLUSTER_VSWITCH,f=n.extend({name:"get_host_nics",initialize:function(e){n.prototype.initialize.apply(this,arguments),this.set(i.EB.ENTITY_TYPE,o.ENTITY_HOST_NIC),this.setGroupMemberAttributesList(["link_capacity"])}});return e.extend({el:"#popupClusterUplinkDetails",name:"ClusterUplinkPopupView",model:null,mode:d.ACTIVE_BACKUP,upLinkGrouping:null,hostNicQueryModel:null,events:{"click .modal-header .close":"hide","click .btnCancel":"hide","change .uplink-type":"onChangeUplinkType","click .btnUpdate":"updateCluster","click  a.toggle-details":"onClickToggleDetails"},modelEvents:{"change model":"onClusterChange","error  model":"onClusterError"},initialize:function(){e.prototype.initialize.apply(this,arguments),this.model=new t,this.hostNicQueryModel=new f},render:function(){if(this._isTaskInProgress())return void this.$el.html(this.defaultTemplate({title:this.i18n("uplink_config"),antiscroll:!1,bodyContent:c(this.vtOptions({msg:this.i18n("task_in_progress")}))}));this.triggerAction(o.MODAL.ACT.ALERT_HIDE);var e=this.canModifyByEntityType(o.ENTITY_CLUSTER);this.footerButtons=[{text:this.i18n("cancel"),extraClasses:"btnCancel",leftAligned:!0}];var t={canModify:e,isDataFetched:this.isDataFetched};this.isDataFetched&&(e&&this.footerButtons.push({isPrimary:!0,text:this.i18n("save"),extraClasses:"btnUpdate",extraAttr:[{key:"data-loading-text",value:this.i18n("saving")}]}),_.extend(t,{nicVersions:this.getNicVersions(),mode:this.mode})),this.$el.html(this.defaultTemplate({title:this.i18n("uplink_config"),antiscroll:!1,bodyContent:l(this.vtOptions(t)),footerButtons:this.defaultFooter(this.footerButtons)})),this.isDataFetched?this.applyNutanixInput():this.triggerAction(o.MODAL.ACT.ALERT_SHOW,{type:o.MODAL.ALERT.TYPE_LOADING})},_isTaskInProgress:function(){var e=a.getGlobalTasks().getLatestIntentUpdateClusterTask();return e&&!e.isTaskCompleted()},loadData:function(){var e=this;this.hostNicQueryModel.save(null).done(function(){var t=e.clusterManager.getCurrentClusterId(),n=r.getClusterUuid(t);e.model.setId(n),e.model.fetch()}).fail(function(t,n){e.triggerAction(o.MODAL.ACT.ALERT_SHOW,{type:o.MODAL.ALERT.TYPE_ERROR,message:n.responseText})})},_filterHostNicsToDisplay:function(){var e=[],t=_.map(this.hostNicQueryModel.getQueryResultAttributes(),function(e){return e.link_capacity});return t=_.uniq(t),t.length?(_.each(t,function(t){e.push(u[t])}),t.length>1&&e.unshift(p.ALL)):e.push(p.NO_UPLINKS),e},show:function(t){e.prototype.show.apply(this,arguments),this.loadData()},destroy:function(){r.debug("ClusterUplinkPopupView:destroy:|viewid : "+this.cid),this.$(".n-button-help").tooltip("destroy"),this.$(".encryptionStateTip").tooltip("destroy"),e.prototype.destroy.apply(this,arguments)},onClusterChange:function(){this.isDataFetched=!0,this.populateClusterDefaultNetworkVswitchConfig(),this.render()},onClusterError:function(e,t){this.triggerAction(o.MODAL.ACT.ALERT_SHOW,{type:o.MODAL.ALERT.TYPE_ERROR,message:t.responseText})},onChangeUplinkType:function(){this.mode=this.$(".uplink-type:checked").val(),this.render()},onClickToggleDetails:function(e){var t=$(e.currentTarget),n=t.closest(".uplinkSection").find(".details"),i=n.is(":visible")?this.i18n("show_details"):this.i18n("hide_details");t.html(i),n.toggle()},updateCluster:function(){var e=this;this.triggerAction(o.MODAL.ACT.ALERT_SHOW,{type:o.MODAL.ALERT.TYPE_SAVING});var t=this.getDefaultVswitchConfig(),n=this;this.model.saveDefaultVswitchConfig(t,{success:function(){e.hide(),s.showClientNotification(o.NOTIFY_SUCCESS,n.i18n("uplink_config_success"))},error:function(t,n){e.triggerAction(o.MODAL.ACT.ALERT_SHOW,{type:o.MODAL.ALERT.TYPE_ERROR,message:n.responseText})}})},getNicVersions:function(){var e=this,t=this._filterHostNicsToDisplay(),n=this.$(".uplink-type:checked").val();return _.map(t,function(t){return{name:t===p.NO_UPLINKS?e.i18n("no_uplinks"):e.i18ns("select_nics",h[t]),value:t,selected:t===e.upLinkGrouping,disabled:t===p.NO_UPLINKS||t===p.ALL&&(n===d.ACTIVE_ACTIVE||n===d.ACTIVE_ACTIVE_MAC_PINNING)}})},getDefaultVswitchConfig:function(){var e={},t=this.$(".uplink-type:checked").val();return t===d.ACTIVE_BACKUP?e[m.NIC_POLICY]=m.ACTIVE_BACKUP:t===d.ACTIVE_ACTIVE_MAC_PINNING?e[m.NIC_POLICY]=m.BALANCE_SLB:t===d.ACTIVE_ACTIVE&&(e[m.NIC_POLICY]=m.BALANCE_TCP),e[m.UPLINK_GROUPING]=this.$("#nic-config").val(),e},populateClusterDefaultNetworkVswitchConfig:function(){var e=this.model.getDefaultVSwitchConfig();if(e){var t=e[m.NIC_POLICY];t===m.ACTIVE_BACKUP?this.mode=d.ACTIVE_BACKUP:t===m.BALANCE_SLB?this.mode=d.ACTIVE_ACTIVE_MAC_PINNING:t===m.BALANCE_TCP&&(this.mode=d.ACTIVE_ACTIVE),e[m.UPLINK_GROUPING]&&(this.upLinkGrouping=e[m.UPLINK_GROUPING])}}})}),define("views/basecomponents/popups/BaseMultiplePopupView",["views/basecomponents/popups/BasePopupView","utils/AppConstants"],function(e,t){"use strict";return e.extend({actionRoute:null,elCurrentForm:null,elForm1:".holderForm1",elForm2:".holderForm2",formViewsHolder:null,actionRouteHolder:null,initialize:function(){this.formViewsHolder={},this.actionRouteHolder={}},show:function(e){e[t.NAV_ACTION]!==t.ACTION_DELETE?(this.$el.nutanixPopup({show:!0}),this.renderCreateUpdate(e)):this.renderDelete(e)},slideForm:function(e,n){this.elCurrentForm=e;var i=this.actionRouteHolder[e],s=i[t.NAV_ACTION],a=t.ACTION_NAMES[s],o=i[t.NAV_ACTION_TARGET],r=t.ENTITY_NAMES[o];e===this.elForm1?this.getDOM(".lblTextForm1").text(a+" "+r):e===this.elForm2&&this.getDOM(".lblTextForm2").text(a+" "+r);var l=e===this.elForm1?"0":-1*this.$(".n-modal-content-wrapper").width()/2;if(n||void 0===n?this.getDOM(".n-modal-content-wrapper").animate({left:l+"px"},500):this.getDOM(".n-modal-content-wrapper").css("left",l+"px"),this.elForm1===e)this.getDOM(".form1Element").show(),this.getDOM(".form2Element").hide();else{this.getDOM(".form1Element").hide(),this.getDOM(".form2Element").show();var c=this;this.getDOM(".backForm").off("click").click(function(){c.slideForm(c.elForm1),c.updateButtonState(!0)})}this.postSlideForm(i)},postSlideForm:function(e){},reset:function(){this.slideForm(this.elForm1),this.formViewsHolder={},this.actionRouteHolder={},this.clearHeader(),this.undelegateEvents()},updateButtonState:function(e,t){void 0===t||t?this.getDOM(".btnSave").button(e?"reset":"loading"):this.getDOM(".btnSave").attr("disabled",!e),this.getDOM(".btnReset").attr("disabled",!e),this.getDOM(".btnCancel").attr("disabled",!e)},resetCurrentForm:function(){this.formViewsHolder[this.elCurrentForm].reset()},renderCreateUpdate:function(e){this.actionRoute=e,this.formViewsHolder[this.elForm1]||this.$el.html(this.template),this.delegateEvents(),this.formViewsHolder[this.elForm1]?(this.createEntityForm(this.elForm2,e),this.slideForm(this.elForm2)):this.createEntityForm(this.elForm1,e),this.isClusterFFEnabled(t.FFLAGS.HELP_DOC)&&this.createHelpIcon(e)},createEntityForm:function(e,n,i){n[t.NAV_ACTION];this.actionRouteHolder[e]=n,this.slideForm(e,i);var s=this.createEntityFormPopupView(n);s&&(this.setDOM(e,s.render().el),this.formViewsHolder[e]=s,s.parent=this)},renderDelete:function(e){this.confirmDelete(e)},deleteEntity:function(e,t){},saveCurrentForm:function(){this.updateButtonState(!1);var e=this,n=this.formViewsHolder[this.elCurrentForm];n&&n.save({parent:this,success:function(n,i){if(e.elCurrentForm===e.elForm1)e.hide();else{e.slideForm(e.elForm1);var s=e.actionRoute[t.NAV_ACTION_TARGET];e.formViewsHolder[e.elForm1].resetFormElement(s)}e.updateButtonState(!0)},error:function(t,n){e.updateButtonState(!0)}})},createEntityFormPopupView:function(e){},toggleAdvancedSettings:function(){this.formViewsHolder[this.elCurrentForm].toggleAdvancedSettings()}})}),define("text!templates/popups/storage/StoragePopupView.html",[],function(){return'<div class="modal-header">\n  <button type="button" class="close" data-dismiss="modal">\n    <i data-icon="K" aria-hidden="true"></i>\n  </button>\n  \x3c!-- NOTE: This will become a breadcrumb --\x3e\n  <h4 class="n-title">\n    \x3c!-- Form 1 Header --\x3e\n    <span class="lblTextForm1  form1Element">\n      \x3c!-- @label form1 goes here... --\x3e\n    </span>\n\n    \x3c!-- Form 2 Header --\x3e\n    <a class="lblTextForm1  form2Element  backForm">\n      \x3c!-- @label form2 goes here... --\x3e\n    </a>\n    <i data-icon="y" class="form2Element n-form-breadcrumb-separator" aria-hidden="true"></i>\n    <span class="form2Element  lblTextForm2">\n      \x3c!-- @label form2 goes here... --\x3e\n    </span>\n  </h4>\n</div>\n\n<div class="n-modal-wrapper">\n  <div class="n-modal-body">\n    \x3c!-- TODO: Change this to table --\x3e\n    <div class="n-modal-content-wrapper">\n      <div class="n-modal-content">\n        <div class="holderForm1">\n          \x3c!-- @view: form 1 goes here... --\x3e\n        </div>\n      </div>\n      <div class="n-modal-content">\n        <div class="holderForm2">\n          \x3c!-- @view: form 2 goes here... --\x3e\n        </div>\n      </div>\n    </div>\n  </div>\n\n\n  <div class="n-modal-footer">\n    \x3c!-- Back button --\x3e\n    <div class="pull-left">\n      <button class="backForm  form2Element  btn n-secondary-btn">\n        <i data-icon="x" aria-hidden="true"></i>\n        Back\n      </button>\n\n      <button class="btnAdvancedSettings btn" stream-action="show"\n              stream-target="advanced settings">\n        <i data-icon="C" aria-hidden="true"></i>\n        Advanced Settings\n      </button>\n    </div>\n\n    \x3c!-- Form buttons --\x3e\n\n    <button class="btnCancel btn">\n      Cancel\n    </button>\n    <button class="btnSave btn btn-primary" data-loading-text="Saving...">\n      Save\n    </button>\n\n  </div>\n</div>'}),define("views/basecomponents/popups/BasePopupFormView",["views/basecomponents/BaseView","utils/CommonTemplates","utils/AppConstants","utils/AppUtil"],function(e,t,n,i){"use strict";return e.extend({parent:null,actionRoute:null,isValid:function(){},save:function(e){},reset:function(){},resetFormElement:function(e){},getAction:function(){return this.actionRoute[n.NAV_ACTION]},getEntityId:function(){return this.actionRoute[n.NAV_ACTION_TARGET_ID]},scrollToBottom:function(){var e=this.$el.closest(".n-modal-body");$(e).animate({scrollTop:$(e).prop("scrollHeight")-$(e).height()},"fast")},scrollToTop:function(){var e=this.$el.closest(".n-modal-body");$(e).animate({scrollTop:"0px"},"fast")},clearHeader:function(){var e=this;this.$el.find(".n-modal-alert-header").slideUp(300,function(){e.$el.find(".n-modal-alert-header").empty()}),this.$el.find(".n-modal-alert-header").removeClass("not-empty")},showHeaderSuccess:function(e){e=e||"Success";var n=t.SUCCESS({msg:e});this._showInHeader(n)},showHeaderError:function(e,n,s){var a;_.isString(e)?a=i.processAjaxError(e):_.isString(n)?a=n:n&&n.responseText&&(a=i.processAjaxError(n.responseText)),a=i.removeServerException(a)||"Server Error";var o=t.ERROR({error:a});this._showInHeader(o)},showHeaderLoading:function(){this._showInHeader(t.LOADING)},showHeaderNoData:function(){this._showInHeader(t.NO_DATA)},_showInHeader:function(e){this.$el.find(".n-modal-alert-header").first().html(e).slideDown(300).addClass("not-empty")},updateButtonState:function(e,t){this.parent&&this.parent.updateButtonState(e,t)}})}),define("text!templates/popups/storage/storagepool/StoragePoolPopupFormView.html",[],function(){return'\x3c!-- Alert Header --\x3e\n<div class="popupFormAlertHeader  n-modal-alert-header"\n  style="margin-bottom: 8px">\n  \x3c!-- @view: alert goes here... --\x3e\n</div>\n\n\x3c!-- Storage Pool Create/Update Form --\x3e\n<form id="storagePoolPopupForm" class="form-horizontal  n-form-rows">\n  <div class="n-popup-description">\n    A storage pool is a group of physical disks from one or more tiers.\n    Nutanix recommends creating a single storage pool to manage all\n    physical disks within the cluster.\n  </div>\n\n  \x3c!-- Storage Pool Name --\x3e\n  <div class="control-group  n-row-alternate">\n    <label class="control-label">Name</label>\n    <div class="controls">\n      <input type="text" class="inputName"\n        value="<%= model.name %>">\n      <div class="n-input-validation-msg"></div>\n    </div>\n  </div>\n  \x3c!-- Capacity --\x3e\n  <div class="control-group">\n    <label class="control-label">Capacity</label>\n    \x3c!-- Option A: When there\'s available disk --\x3e\n    <div class="ctrlHasCapacity  controls">\n      <span class="lblCapacity" style="font-size: 16px; padding-top: 5px;\n        float: left; font-weight: bold;">\n        \x3c!-- @label: capacity goes here... --\x3e\n      </span>\n      <div class="n-sp-max" style="display:none">\n        Use unallocated capacity\n        \x3c!-- Unallocated  --\x3e\n        <span class="lblUnallocated">\n          \x3c!-- @label: unallocated capacity goes here --\x3e\n        </span>\n        <input class="checkboxAllMaxCapacity" type="checkbox">\n      </div>\n      <div class="n-clearfix"></div>\n    </div>\n    \x3c!-- Option B: When no available disk --\x3e\n    <div class="ctrlNoCapacity  controls" style="display: none">\n      <div style="padding: 0 4px;">\n        No available disks to create a Storage Pool.\n      </div>\n    </div>\n  </div>\n\n  \x3c!-- Advanced Settings (Border not needed for a single element) --\x3e\n  <div id="advancedSettingsContainer"\n       class="n-form-advanced-settings  n-inactive"\n       style="padding-left:20px;">\n    <h5 class="n-form-advanced-settings-title">Advanced Settings</h5>\n    <div class="n-form-advanced-settings-inner">\n      \x3c!-- NOTE: Add advanced settings items here... --\x3e\n    </div>\n  </div>\n</form>\n'}),define("text!templates/popups/storage/storagepool/SPNoDisksView.html",[],function(){return'\x3c!-- Alert Header --\x3e\n<div class="popupFormAlertHeader n-modal-alert-header">\n  \x3c!-- @view: alert goes here... --\x3e\n</div>\n\n\x3c!-- Storage Pool Form --\x3e\n<form id="storagePoolPopupForm" class="no-disks">\n  <div class="n-popup-description">\n    <%= i18n("no_disk_desc") %>\n  </div>\n  <div class="n-popup-content">\n    <div class="alert-well alert-info">\n      <div class="title"><%= i18n("no_disk_info_title") %></div>\n      <div class="content"><%= i18n("no_disk_info_msg") %></div>\n    </div>\n  </div>\n</form>'}),define("views/popups/storage/storagepool/StoragePoolPopupFormView",["views/basecomponents/popups/BasePopupFormView","text!templates/popups/storage/storagepool/StoragePoolPopupFormView.html","text!templates/popups/storage/storagepool/SPNoDisksView.html","jqueryui/slider","data/DataProperties","models/storage/StoragePoolModel","models/hardware/DiskCollection","utils/AppConstants","utils/AppUtil","utils/StatsUtil"],function(e,t,n,i,s,a,o,r,l,c){"use strict";var d=_.template(t),p=_.template(n);return e.extend({name:"StoragePoolPopupFormView",className:"n-popup-form-holder",diskCollection:null,events:{"click  .checkboxAllMaxCapacity":"onUpdateCapacity","keyup  .inputName":"onInputNameKeyUp"},initialize:function(e){this.parent=e.parent,this.actionRoute=e.actionRoute},render:function(){var e=this;return this.$el.html('<div class="n-popup-loading">Loading...</div>'),this.model=new a,this.model.setProjection([r.PROJECTION.USAGE_STATS]),this.getAction()===r.ACTION_UPDATE?(this.model.set({id:this.getEntityId()},{silent:!0}),this.model.fetch({silent:!0,success:function(){e.updateForm()}})):this.updateForm(),this},updateForm:function(){var e=this;this.$el.html(d({model:this.model.toJSON()})),this.updateButtonState(!1,!1),this.diskCollection=new o,this.diskCollection.setProjection([r.PROJECTION.USAGE_STATS]),this.diskCollection.fetch({success:function(){e.updateButtonState(!0,!1),e.updateDiskCapacity()},error:function(t,n){e.updateButtonState(!0,!1),e.showHeaderError(n.responseText)}})},updateDiskCapacity:function(){this.diskCollection&&(this.diskCollection.getUnAllocatedDisks().length?(this.$(".n-sp-max").show(),this.getAction()===r.ACTION_CREATE&&(this.$(".ctrlHasCapacity").show(),this.$(".ctrlNoCapacity").hide(),this.$(".inputName").removeAttr("disabled"),$("#popupStorage .btnSave").removeAttr("disabled"))):(this.$(".n-sp-max").hide(),this.getAction()===r.ACTION_CREATE&&($("#popupStorage .btnSave").attr("disabled","disabled"),this.$el.html(p(this.vtOptions())))),this.$(".checkboxAllMaxCapacity").attr("checked",!0),this.onUpdateCapacity())},onInputNameKeyUp:function(e){l.validNameCharactersEventHandler(e,this.$(".n-input-validation-msg"))},onUpdateCapacity:function(){var e=this.$(".checkboxAllMaxCapacity").is(":checked"),t=this.model.getTotalCapacity(),n=this.diskCollection.getTotalCapacityOfUnAllocatedDisks();if(n>0?this.$(".lblUnallocated").html("("+c.storageFormat(n)+")"):this.$(".lblUnallocated").empty(),e){var i=t+n;this.$(".lblCapacity").html(c.storageFormat(i)),this.$(".lblUnallocated").hide()}else this.$(".lblCapacity").html(c.storageFormat(t)),this.$(".lblUnallocated").show()},getDisksToBeAdded:function(){return this.$(".checkboxAllMaxCapacity").is(":checked")?_.union(this.diskCollection.getUnAllocatedDiskIds(),this.model.get(s.DISKS)):this.model.get(s.DISKS)},toggleAdvancedSettings:function(){var e=this,t=this.$("#advancedSettingsContainer"),n=$(t).is(":visible");return $(t).slideToggle("fast",function(){$(t).is(":visible")&&e.scrollToElement(t,".n-modal-body")}),!n},save:function(e){var t=this,n=e;this.model.on("error",function(e,n){t.showHeaderError(n)}),this.model.set({name:this.$(".inputName").val(),disks:this.getDisksToBeAdded()})?this.model.save(null,{success:function(e,t){!0!==(t=l.processAjaxPrimitive(t))&&"true"!==t||n.success(e,t)},error:function(e,i){t.showHeaderError(i.responseText),n.error(e,i)}}):e.error&&e.error(this.model)},reset:function(){this.$(".inputName").val(""),this.updateForm()},showErrorDiskRemovalNotAllowed:function(){this.showHeaderError("Removing disks from an existing storage pool can only be done through nCLI.")},destroy:function(){this.model&&this.model.off(),e.prototype.destroy.apply(this,arguments)}})}),define("text!templates/popups/storage/container/ContainerPopupFormView.html",[],function(){
return'\x3c!-- Alert Header --\x3e\n<div class="popupFormAlertHeader n-modal-alert-header">\n  \x3c!-- @view: alert goes here... --\x3e\n</div>\n\n\x3c!-- Container Create/Update Form --\x3e\n<form id="containerPopupForm" class="form-horizontal  n-form-rows">\n  \x3c!-- Container Name --\x3e\n  <div class="control-group  n-row-alternate">\n    <label class="control-label">Name</label>\n    <div class="controls">\n      <input type="text" class="inputName" value="<%= model.name %>"\n      <% if ( !_.isEmpty(model.name) ) { %>\n        title="The storage container name cannot be changed once it is assigned\n        because it may be mounted on hosts."\n        \' disabled \'\n      <% } %>\n      >\n      <div class="n-input-validation-msg"></div>\n    </div>\n  </div>\n  \x3c!-- Storage Pool --\x3e\n  <div class="control-group">\n    <label class="control-label">\n      Storage Pool\n    </label>\n    <div class="controls">\n      \x3c!-- Update Mode\n      ========================= --\x3e\n      \x3c!-- Storage Pool Name --\x3e\n      <span class="lblStoragePoolName n-label formActionUpdate">\n        \x3c!-- @label goes here... --\x3e\n      </span>\n\n      \x3c!-- Create Mode\n      ========================= --\x3e\n      \x3c!-- Combobox Storage Pool --\x3e\n      <select class="comboStoragePool formActionCreate">\n        \x3c!-- @option goes here... --\x3e\n      </select>\n\n      \x3c!-- Create Storage Pool --\x3e\n      <a class="btnPopupAction btn formActionCreate"\n        <%= createPoolAttr %>\n        title="Create a new storage pool">\n        <%= SVG.SVGIcon(\'H\',\'-large\') %>\n      </a>\n    </div>\n  </div>\n  \x3c!-- Max Capacity --\x3e\n  <div class="control-group  n-row-alternate">\n    <label class="control-label">\n      Max Capacity\n    </label>\n    <div class="controls">\n      <span class="lblMaxCapacity  n-label-form">\n        \x3c!-- @label goes here... --\x3e\n      </span>\n      \x3c!-- Explain where max capacity is taken --\x3e\n      <div class="n-form-row-description">\n        <span id="lblStoragePoolFreeUnreservedCapacity"\n              class="n-inline-description"\n              style="display:none;">\n          (Physical) Based on storage pool free unreserved\n          capacity\n        </span>\n      </div>\n    </div>\n  </div>\n\n  \x3c!-- Smb share default--\x3e\n  <div class="control-group control-group-hyperv"\n    style="display:none">\n    <label class="control-label">\n      Make this storage container the default store for VMs on Hyper V hosts\n    </label>\n    \x3c!-- (A) Controls that are smb-share enabled --\x3e\n    <div class="controls  smb-share-enabled-controls">\n      <div class="smbShareHolder">\n        <ul class="n-row-list n-row-list-popup">\n          <li class="n-li-item-checkbox">\n            <input type="radio"\n                   name="createSmbShare"\n                   class="btnCreateSmbShare"\n                   value="none" data="none"\n                   disabled>\n            None\n          </li>\n          <li class="n-li-item-checkbox">\n            <input type="radio"\n                   name="createSmbShare"\n                   class="btnCreateSmbShare"\n                   value="defaultall" data="defaultall"\n                   disabled>\n            Make default on all Hyper V hosts\n          </li>\n          <li class="n-li-item-checkbox">\n            <input type="radio"\n                   name="createSmbShare"\n                   class="btnCreateSmbShare"\n                   value="defaulthost" data="defaulthost"\n                   disabled>\n            Make default on particular Hyper V hosts\n          </li>\n        </ul>\n      </div>\n      \x3c!-- Hosts for smb share --\x3e\n      <div class="smbShareHostHolder n-inactive">\n        <div class="n-host-smb-share-holder">\n          <ul class="hostSmbShareList  n-row-list\n          n-row-list-popup">\n            \x3c!-- @view: name server list go here... --\x3e\n          </ul>\n        </div>\n      </div>\n    </div>\n  </div>\n  \x3c!-- Datastore Creation/Update --\x3e\n  <div class="control-group controls-esxi">\n    <label class="control-label">\n      NFS Datastore\n      <div class="n-inline-loading-container">\n        <div class="n-inline-loading  n-inline-loading-datastore"\n          style="display:block"></div>\n      </div>\n    </label>\n    \x3c!-- (A) Controls that are datastore enabled --\x3e\n    <div class="controls  datastore-enabled-controls"\n      style="display:none">\n      <div class="datastoreHolder">\n        <div class="mixedHypervisor n-inline-description"\n            style="display:none;">\n          There are <span class="mixedHypervisorCount">0</span> host(s) that\n          cannot be mounted with an NFS datastore.\n        </div>\n        <ul class="n-row-list n-row-list-popup">\n          <li class="n-li-item-checkbox">\n            <input type="radio"\n                   name="createDataStore"\n                   class="btnCreateDatastore"\n                   value="mountall" data="mountall"\n                   disabled>\n            Mount on all <%= hypervisorWithDatastore %> hosts\n          </li>\n          <li class="n-li-item-checkbox  formActionUpdate">\n            <input type="radio"\n                   name="createDataStore"\n                   class="btnCreateDatastore"\n                   value="unmountall" data="unmountall"\n                   disabled>\n            Unmount on all <%= hypervisorWithDatastore %> hosts\n          </li>\n          <li class="n-li-item-checkbox">\n            <input type="radio"\n                   name="createDataStore"\n                   class="btnCreateDatastore"\n                   value="mounthost" data="mounthost"\n                   disabled>\n            <% if (model.id) { %>\n              Mount/Unmount on the following <%= hypervisorWithDatastore %>\n              hosts\n            <% } else { %>\n              Mount on the following <%= hypervisorWithDatastore %> hosts\n            <% } %>\n          </li>\n        </ul>\n      </div>\n      \x3c!-- Hosts for datastore --\x3e\n      <div class="datastoreHostHolder n-inactive">\n        <div style="display:none">\n          <input disabled\n            class="chkSelectAllHosts n-datatable-checkbox"\n              type="checkbox" style="display:none">\n        </div>\n        <div class="n-host-datastore-holder">\n          <ul class="hostDatastoreList n-row-list\n            n-row-list-popup">\n            \x3c!-- @view: name server list go here... --\x3e\n          </ul>\n        </div>\n      </div>\n    </div>\n    \x3c!-- (B) Controls that are datastore disabled --\x3e\n    <div class="controls datastore-disabled-controls"\n      style="display:none">\n      <div class="n-inline-description">\n        <p>No hosts can be mounted with an NFS datastore.</p>\n        <p>The cluster\'s hypervisor(s) are\n          <span class="hypervisorType"></span>.\n        </p>\n      </div>\n    </div>\n  </div>\n\n  \x3c!-- Advanced Settings --\x3e\n  <div id="advancedSettingsContainer"\n    class="n-form-advanced-settings n-inactive">\n    <div class="n-form-advanced-settings-title">\n      Advanced Settings\n    </div>\n    <div class="encryptionSettings n-form-advanced-settings-sep hide">\n      \x3c!-- Encryption --\x3e\n      <label class="control-label">\n        <%= i18n("encryption") %>\n      </label>\n      <div class="control-group">\n        <%=\n          Components.checkbox({\n            checked: encrypted,\n            disabled: encryptionSettingDisabled,\n            jsClasses: \'encryptionCheckbox\'\n          })\n        %>\n        <label class="control-label checkbox-label">\n          <%= i18n("enable") %>\n        </label>\n      </div>\n    </div>\n    <div class="n-form-advanced-settings-sep">\n      \x3c!-- Replication Factor --\x3e\n      <div class="control-group">\n        <label class="control-label">\n          <%= i18n("redundancy_factor") %>\n          <% if (!isNew) { %>\n            \x3c!-- In update mode, replication factor is read-only. --\x3e\n            is <%= model.replicationFactor %>.\n          <% } %>\n          <span class="nutanixMoreInfo"\n                data-tooltip-classes="-nudge-down"\n                data-tooltip-title="\n                <%- tooltipContent[AppConstants.PAGE_STORAGE].\n                      REPLICATION_FAC %>"></span>\n        </label>\n        <div class="n-clearfix"></div>\n        <div class="controls">\n          <div class="n-modal-alert-header alertReplicationFactor"></div>\n          \x3c!-- Combobox Replication Factor --\x3e\n          <% if (isNew) { %>\n            <% if (clusterRedundancyFactor < AppConstants.MAX_REDUNDANCY_FACTOR) { %>\n              <%= clusterRedundancyFactor %>\n            <% } else { %>\n               \x3c!-- This is for RF 2 or 3 --\x3e\n              <% for (var ii = AppConstants.MINIMUM_RF_SUPPORTED; ii <= AppConstants.MAX_REDUNDANCY_FACTOR; ii++) { %>\n                <div>\n                  <%=\n                    Components.radio({\n                      name:\'clusterRedundancyFactor\',\n                      checked: ii === AppConstants.MINIMUM_RF_SUPPORTED ? true : false,\n                      value: ii,\n                      jsClasses: \'clusterRedundancyFactor\'\n                    })\n                  %>\n                  <%= ii %>\n                </div>\n              <% } %>\n            <% } %>\n          <% } %>\n        </div>\n      </div>\n    </div>\n    <div class="n-form-advanced-settings-sep">\n      \x3c!-- Reserved Capacity --\x3e\n      <div class="control-group">\n        <label class="control-label">\n          Reserved Capacity\n        </label>\n        <div class="controls" data-addon-text="GiB">\n          \x3c!-- input reservation capacity --\x3e\n          <input class="inputResCapacity  input-mini"\n            type="text" maxlength="10" placeholder="Total GiB"\n            value="<%= reservedCapacity || \'0\' %>">\n        </div>\n      </div>\n    </div>\n    <div class="n-form-advanced-settings-sep">\n      \x3c!-- Advertised Capacity --\x3e\n      <div class="control-group">\n        <label class="control-label">\n          Advertised Capacity\n        </label>\n        <div class="controls" data-addon-text="GiB">\n          \x3c!-- input reservation capacity --\x3e\n          <input class="inputAdvertisedCapacity  input-mini"\n          type="text" maxlength="10" placeholder="Total GiB"\n            value="<%= advertisedCapacity %>">\n        </div>\n      </div>\n    </div>\n    <% if (isCompressionEnabled) { %>\n    <div class="n-form-advanced-settings-sep">\n      \x3c!-- Compression --\x3e\n      <div class="control-group">\n        <input type="checkbox"\n               class="chkboxCompression n-datatable-checkbox"\n        <%= (model.compressionEnabled && model.compressionEnabled !=\'off\')\n        ? "checked" : ""\n        %> >\n        <label class="control-label checkbox-label">\n          Compression\n        </label>\n        <div class="controls">\n          <div class="n-modal-alert-header alertCompressionDelay">\n          </div>\n          <div class="n-modal-alert-header alertCompressionOn">\n          </div>\n          \x3c!-- Compression Inputs --\x3e\n          <div class="compressionHolder\n            <%= (!model.compressionEnabled || model.compressionEnabled == \'off\')\n                    ? \'n-inactive\' : \'\' %>"\n               style="margin-top: 5px;">\n\n            \x3c!-- Explain the type of compression --\x3e\n            <div class="n-inline-description">\n              Perform post-process compression of all persistent data. For inline\n              <br/>\n              compression, set the delay to 0.\n            </div>\n\n            \x3c!-- Compression Delay --\x3e\n            <label class="control-label inline-control-label delay-text">\n            Delay (in minutes)</label>\n            <input class="inputCompressionDelay input-mini"\n            type="text" value="<%= parseInt(model.compressionDelayInSecs/60)||\'0\'%>"\n                   maxlength="10">\n          </div>\n        </div>\n      </div>\n    </div>\n    <% } %>\n    <% if (isFingerPrintOnWriteEnabled) {\n        var fingerprintOnWrite = (model.fingerPrintOnWrite || \'\').toUpperCase();\n    %>\n    <div class="n-form-advanced-settings-sep">\n      \x3c!-- Fingerprint on write --\x3e\n      <label class="control-label">\n          Deduplication\n          <% if (dedupeDisabled) { %>\n            <span class="nutanixMoreInfo"\n              data-tooltip-classes="-nudge-down"\n              data-tooltip-container="body"\n              data-tooltip-title="\n              <%- tooltipContent[AppConstants.PAGE_STORAGE].\n                    DEDUP_UNSUPPORTED_NODE_COUNT %>"></span>\n          <% } %>\n      </label>\n      <div class="control-group <%= (dedupeDisabled ? \'disabled\' : \'\') %>">\n        <input type="checkbox"\n               class="chkboxFOW n-datatable-checkbox"\n               <%= (fingerprintOnWrite === FINGER_PRINT_ON_WRITE.ON) ? "checked" : "" %>\n               <%= (dedupeDisabled ? \'disabled\' : \'\') %>\n        >\n        <label class="control-label checkbox-label">\n          Cache\n          <span class="nutanixMoreInfo"\n                data-tooltip-classes="-nudge-down"\n                data-tooltip-container="body"\n                data-tooltip-title="\n                <%- tooltipContent[AppConstants.PAGE_STORAGE].\n                      PERF_DEDUP %>"></span>\n        </label>\n        <div class="controls">\n          <div class="n-modal-alert-header alertDedup"></div>\n          <div class="fowMessage n-inline-description checkbox-desc">\n            Perform inline deduplication of read caches to optimize performance.\n          </div>\n        </div>\n      </div>\n      <div class="sub-option control-group diskDedupOptions <%=\n        (fingerprintOnWrite === FINGER_PRINT_ON_WRITE.ON) ? \'\' : \'disabled\' %>">\n        <input type="checkbox"\n               class="chkboxDiskDedup n-datatable-checkbox"\n               <%= (model.onDiskDedup === FINGER_PRINT_ON_WRITE.POST_PROCESS)\n                 ? "checked" : "" %>\n               <%= (fingerprintOnWrite === FINGER_PRINT_ON_WRITE.ON)\n                 ? "disabled" : "" %>\n        >\n        <label class="control-label checkbox-label">\n          Capacity\n          <span class="nutanixMoreInfo"\n                data-tooltip-classes="-nudge-down"\n                data-tooltip-container="body"\n                data-tooltip-title="\n                <%- tooltipContent[AppConstants.PAGE_STORAGE].\n                      CAPACITY_DEDUP %>"></span>\n        </label>\n        <div class="controls checkbox-desc">\n          <div class="n-modal-alert-header alertOfflineDedup">\n          </div>\n          <div class="fowMessage n-inline-description">\n            Perform post-process deduplication of persistent data.\n          </div>\n        </div>\n      </div>\n    </div>\n    <% } %>\n    <% if (isErasureCodingEnabled) { %>\n    <div class="n-form-advanced-settings-sep">\n      \x3c!-- Erasure Coding --\x3e\n      <label class="control-label">\n        Erasure Coding\n        <span class="nutanixMoreInfo"\n              data-tooltip-classes="-nudge-down"\n              data-tooltip-title="\n              <%- tooltipContent[AppConstants.PAGE_STORAGE].\n                    ERASURE_CODING %>"></span>\n      </label>\n      <div class="control-group <%= (ecDisabled ? \'disabled\' : \'\') %>">\n        <input type="checkbox"\n               class="chkboxErasureCoding n-datatable-checkbox"\n               <%= (model.erasureCode && model.erasureCode !== \'off\')\n               ? "checked" : "" %>\n               <%= (ecDisabled ? \'disabled\' : \'\') %> >\n        <label class="control-label checkbox-label">\n          Enable\n        </label>\n        <div class="controls checkbox-desc">\n          <div class="n-modal-alert-header alertErasureCoding">\n          </div>\n          <div class="n-modal-alert-header messageErasureCoding">\n          </div>\n          <div class="ecMessage n-inline-description">\n            Erasure coding enables capacity savings across solid-state drives\n            and hard disk drives.\n          </div>\n        </div>\n      </div>\n    </div>\n    <% } %>\n    <div class="n-form-advanced-settings-sep">\n      \x3c!-- Filesystem Whitelists --\x3e\n      <div class="control-group">\n        <label class="control-label">\n            Filesystem Whitelists\n        </label>\n\n        <br/>\n\n        <div class="controls">\n          <% if (whitelistIsInherited === true) {  %>\n            <div class="n-inline-description">\n              This value is currently inherited from the global filesystem\n              whitelist.\n            </div>\n          <% } %>\n\n          \x3c!-- Container Whitelist Entries --\x3e\n          <input class="filesystemWhitelists input-mini"\n          type="text" maxlength="500" placeholder="Enter commma separated entries"\n                 value="<%= formattedWhitelists %>">\n          <div class="n-inline-description">\n              Use <strong>IP address/netmask</strong> format for entries, e.g.,\n              192.168.0.12/255.255.255.252.\n              Also, note that setting a storage container whitelist will\n              override any global whitelists for this storage container.\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n</form>\n'}),define("views/popups/common/PopupTemplates",[],function(){"use strict";return{OPTION:_.template('<option value="<%= model.id %>"><%= model.name %></option>'),LIST_ITEM_HOST_CHECKBOX:_.template('<li class="n-li-item-checkbox"> <input class="checkboxHostForDatastore" type="checkbox" value="<%= model.serviceVMId %>"> <%= model.hypervisorAddress %> </input> <div class="n-li-description n-host-datastore" actionTargetId="<%= model.serviceVMId %>" isMounted="false" style="display:none">\x3c!-- message goes here... --\x3e</div></li>'),LIST_ITEM_SMB_HOST_CHECKBOX:_.template('<li class="n-li-item-checkbox"> <input class="checkboxHostForSmbShare" type="checkbox" value="<%= model.serviceVMId %>"> <%= model.hypervisorAddress %> </input> <div class="n-li-description n-host-smbshare" actionTargetId="<%= model.serviceVMId %>" isDefaultShare="false" style="display:none">\x3c!-- message goes here... --\x3e</div></li>')}}),define("models/storage/DatastoreActionModel",["backbone","models/BaseModel","data/DataURLConstants","data/DataManager","utils/AppConstants","utils/AppUtil"],function(e,t,n,i,s,a){"use strict";return t.extend({urlRoot:n.DATASTORE,entityType:s.ENTITY_DATASTORE,actionMode:null,name:"DatastoreActionModel",defaults:{containerName:"",datastoreName:"",nodeIds:[],readOnly:!1},sync:function(t,o,r){r=this.parseOptions(t,o,r),t="create",o.actionMode===s.ACTION_ADD?r.url=i.getFormattedURL(n.ADD_DATASTORE):o.actionMode===s.ACTION_REMOVE&&(r.url=i.getFormattedURL(n.REMOVE_DATASTORE),o.unset("containerName"),o.unset("readOnly")),a.log("DatastoreActionModel : \n\t method: "+t+"\n\t data  : "+r.url),e.sync(t,o,r)}})}),define("models/storage/SmbShareActionModel",["backbone","models/BaseModel","data/DataURLConstants","utils/AppConstants"],function(e,t,n,i){"use strict";return t.extend({urlRoot:n.SMB_SHARE,entityType:i.ENTITY_SMB_SHARE,name:"SmbShareActionModel",defaults:{nodeIds:[],containerForVhdFiles:"",containerForVmConfigFiles:""},getLatencyMessage:function(e){return"Updating host(s) with default smb share."}})}),define("views/popups/storage/container/ContainerPopupFormView",["views/basecomponents/popups/BasePopupFormView","fancyselect","text!templates/popups/storage/container/ContainerPopupFormView.html","views/popups/common/PopupTemplates","managers/ActionManager","managers/NotificationManager","managers/ClusterManager","managers/LicenseManager","data/DataProperties","models/storage/ContainerModel","models/storage/DatastoreActionModel","models/encryption/EncryptionStateModel","models/storage/SmbShareActionModel","models/storage/StoragePoolCollection","models/storage/DatastoreCollection","models/hardware/HostCollection","models/resiliency/ResiliencyCollection","models/hardware/DiskCollection","utils/AppConstants","utils/AppUtil","utils/StatsUtil","utils/HypervisorUtil","utils/TooltipContent"],function(e,t,n,i,s,a,o,r,l,c,d,p,u,h,m,f,v,g,E,T,C,S,A){"use strict";var b={};b[l.COMPRESSION_ENABLED]=6,b[l.FINGER_PRINT_ON_WRITE]=7;var y=f.extend({comparator:function(e){return e.get("hypervisorAddress")}}),I=_.template(n),w=_.template('<div class="alert <%= type %>"><p><div><%= alertText %></div></p></div>');return e.extend({MOUNT_ALL:"mountall",MOUNT_HOST:"mounthost",UNMOUNT_ALL:"unmountall",NONE:"none",DEFAULT_ALL:"defaultall",DEFAULT_HOST:"defaulthost",NAME_CHECKING_REGEXP:new RegExp("^(_|#|-|\\.|[A-Za-z0-9]|[^\0-])+$"),name:"ContainerPopupFormView",className:"n-popup-form-holder",spCollection:null,diskCollection:null,datastoreCollection:null,hostCollection:null,resiliencyCollection:null,areBAConditionsMet:null,isErasureCodeUpdated:null,encryptionStateModel:null,enableRA:!1,events:{"click    .btnPopupAction":"onClickBtnPopupAction","change   .comboStoragePool":"onChangeStoragePoolCombo","click    .chkboxFOW":"onClickFingerPrintOnWrite","click    .clusterRedundancyFactor":"onChangeRF","click    .chkboxDiskDedup":"onClickDiskDedup","click    .btnCreateDatastore":"onClickBtnCreateDatastore","click    .btnCreateSmbShare":"onClickBtnCreateSmbShare","click    .chkSelectAllHosts":"onClickSelectAllHosts","click    .chkboxCompression":"onClickCompression","click    .checkboxHostForDatastore":"onClickCheckboxForDatastore","click    .checkboxHostForSmbShare":"onClickCheckboxForSmbShare","keyup    .inputName":"onInputNameKeyUp","click    .chkboxErasureCoding":"onClickErasureCoding"},initialize:function(e){this.parent=e.parent,this.actionRoute=e.actionRoute,this.isErasureCodeUpdated=!1},isEncryptionFetchEnabled:function(){return!S.hasKVMOnly()},render:function(){var e=this;this.$el.html('<div class="n-popup-loading">Loading...</div>');var t=[],n=null;return this.model=new c,this.model.setProjection([E.PROJECTION.USAGE_STATS]),this.isEncryptionFetchEnabled()&&(this.encryptionStateModel=new p,t.push(this.encryptionStateModel.fetch({force:!0,error:function(t,n){e.showHeaderError(n.responseText)}}))),this.getAction()===E.ACTION_UPDATE?(this.model.set({id:this.getEntityId()},{silent:!0}),t.push(this.model.fetch({silent:!0,error:function(t,n){e.showHeaderError(n.responseText)}})),n=this.updateForm.bind(this)):n=this.enableCompression.bind(this),_.isEmpty(t)?n():$.whenAll.apply($,t).done(function(){return n()}),this},enableCompression:function(){this.model.set({compressionEnabled:!0,compressionDelayInSecs:3600},{ignoreValidation:!0}),this.updateForm()},updateForm:function(){var e=o.getCurrentClusterModel();if(null===e)return void this.showHeaderError("Unable to retrieve current cluster information.");var t=(e.get(l.CLUSTER_REDUNDANCY_STATE)||{})[l.CURRENT_REDUNDANCY_FACTOR];_.isNumber(t)||(T.log("ContainerPopupFormView : Invalid clusterRedundancyFactor from gateway. Setting it to minimum"),t=E.DEFAULT_REDUNDANCY_FACTOR);var n=t,i=this.model.get(l.ADVERTISED_CAPACITY);null!==i?i/=Math.pow(1024,3):i="",this.$el.html(I(this.vtOptions({isNew:this.isNewContainer(),model:this.model.toJSON(),encrypted:this.isContainerEncrypted(),encryptionSettingDisabled:this.isSoftwareEncryptionOptionDisabled(),reservedCapacity:this.model.get(l.RES_CAPACITY_EXPL)/Math.pow(1024,3),advertisedCapacity:i,createPoolAttr:T.createActionAttr(E.ENTITY_STORAGE_POOL,E.ACTION_CREATE),maxRedundancyFactor:E.MAX_REDUNDANCY_FACTOR,clusterRedundancyFactor:t,defaultRF:n,minRF:E.MINIMUM_RF_SUPPORTED,isCompressionEnabled:this.isFFEnabled(b[l.COMPRESSION_ENABLED]),isFingerPrintOnWriteEnabled:this.isFFEnabled(b[l.FINGER_PRINT_ON_WRITE]),FINGER_PRINT_ON_WRITE:E.FINGER_PRINT_ON_WRITE,hypervisorWithDatastore:E.HYPERVISOR_LABEL[E.HYPERVISOR_TYPE.ESXI],isErasureCodingEnabled:this.isECAvailable(),formattedWhitelists:this.model.getFileSystemWhitelistsAsCSV(l.FILESYSTEM_WHITELISTS),whitelistIsInherited:this.model.get(l.FILESYSTEM_WHITELISTS_INHERITED),tooltipContent:A,dedupeDisabled:o.isOneNodeCluster()||o.isTwoNodeCluster(),ecDisabled:o.isOneNodeCluster()||o.isTwoNodeCluster()}))),this.encryptionStateModel&&this.encryptionStateModel.isSoftwareEncryptionOn()&&this.$(".encryptionSettings").removeClass("hide"),this.getAction()===E.ACTION_CREATE&&(this.$(".formActionCreate").show(),this.$(".formActionUpdate").hide()),this.getAction()===E.ACTION_UPDATE&&(this.$(".formActionCreate").hide(),this.$(".formActionUpdate").show()),this.updateButtonState(!1,!1),this.checkLicenseViolations(),this.refreshStoragePoolCollection(),this.refreshHostCollection(),this.enableRA=e.isFFEnabled(E.FFLAGS.RA_DOMAIN_AWARENESS),this.enableRA||this.refreshResiliencyCollection(),this.applyNutanixInput({types:["radio","checkbox"],select:'select:not(".comboStoragePool")'}),this.$(".nutanixMoreInfo").nutanixMoreInfo({parseDataAttrs:!0})},isNewContainer:function(){return _.isNull(this.model.get(this.model.idAttribute))},isContainerEncrypted:function(){return!(!this.encryptionStateModel||this.encryptionStateModel.getSoftwareEncryptionScope()!==E.ENCRYPTION_PROP.SE_SCOPE_CLUSTER)||this.model.get(l.ENCRYPTED)},isSoftwareEncryptionOptionDisabled:function(){return this.isContainerEncrypted()},isECAvailable:function(){return!r.hasXPressLicense()},refreshResiliencyCollection:function(){var e=this;this.resiliencyCollection=new v,this.resiliencyCollection.fetch({success:function(){e.updateErasureCodingView()},error:function(t,n){e.showHeaderError(n.responseText)}})},refreshStoragePoolCollection:function(){var e=this;this.diskCollection=new g,this.spCollection=new h,$.when.apply($,[this.spCollection.fetch(),this.diskCollection.fetch()]).done(function(){e.updateStoragePoolView()}).fail(function(t){var n=t;_.isObject(t)&&(n=T.processAjaxError(t.responseText)),e.showHeaderError(n)})},refreshHostCollection:function(){var e=this;this.hostCollection=new y,this.hostCollection.fetch({success:function(){e.updateHostView()},error:function(t,n){e.showHeaderError(n.responseText),e.updateHostView()}})},checkLicenseViolations:function(){this.onClickFingerPrintOnWrite({currentTarget:this.$(".chkboxFOW")}),this.onClickDiskDedup({currentTarget:this.$(".chkboxDiskDedup")}),this.onChangeRF({currentTarget:this.$(".clusterRedundancyFactor")})},updateErasureCodingView:function(){this.areBAConditionsMet=_.some(this.resiliencyCollection.models,function(e){if(e.get(l.RESILIENCY_DOMAIN_TYPE)===E.RESILIENCY_DOMAIN_TYPE.BLOCK){var t=e.get(l.RESILIENCY_COMPONENTS),n=t?t.STATIC_CONFIGURATION:null;return n&&n[l.RESILIENCY_MAX_FT]>0}});var e=this.$(".chkboxErasureCoding").is(":checked"),t=this.$(".messageErasureCoding");e&&t.is(":visible")&&this._showErasureCodingMessages(t)},updateStoragePoolView:function(){if(0===this.spCollection.models.length)return this.$(".comboStoragePool").hide(),this.$(".lblStoragePoolName").show(),void this.$(".lblStoragePoolName").text("No Storage Pool");this.$(".comboStoragePool").show(),this.$(".lblStoragePoolName").empty().hide(),this.$(".comboStoragePool").empty();for(var e=0;e<this.spCollection.models.length;e++)this.$(".comboStoragePool").append(i.OPTION({model:this.spCollection.models[e].toJSON()}));this.getAction()===E.ACTION_UPDATE&&this.$(".comboStoragePool").val(this.model.get(l.SP_ID));var t=this.spCollection.find(function(e){return this.diskCollection.length===(e.get(l.DISKS)||[]).length},this);if(this.spCollection.length&&t&&this.$(".btnPopupAction.formActionCreate").attr("disabled",!0),this.applyNutanixInput({select:"select.comboStoragePool"}),this.model.get(l.SP_ID)){var n=this.spCollection.get(this.model.get(l.SP_ID));this.$(".lblStoragePoolName").text(n.get(l.NAME))}this.updateMaxCapacityView()},updateHostView:function(){this.$(".hostDatastoreList").empty();var e=this.hostCollection.getDatastoreMountableHosts(),t=this.hostCollection.getHostsWithHypervisor(E.HYPERVISOR_TYPE.HYPERV);if(e&&e.length>0){this.$(".datastore-enabled-controls").show(),this.$(".datastore-disabled-controls").hide();var n="";_.each(e,function(e){n+=i.LIST_ITEM_HOST_CHECKBOX({model:e.toJSON()})},this),this.$(".hostDatastoreList").append(n),e.length!==this.hostCollection.length?(this.$(".mixedHypervisor").show(),this.$(".mixedHypervisorCount").html(this.hostCollection.length-e.length)):this.$(".mixedHypervisor").hide()}else this.$(".datastore-disabled-controls").parent().hide();if(t&&t.length>0){this.$(".control-group-hyperv").show(),this.$(".datastore-disabled-controls").parent().hide();var s="";_.each(t,function(e){s+=i.LIST_ITEM_SMB_HOST_CHECKBOX({model:e.toJSON()})},this),this.$(".hostSmbShareList").append(s)}else this.$(".control-group-hyperv").hide();if(S.hasESX()){var a=this;this.datastoreCollection=new m,this.datastoreCollection.fetch({success:function(){a.$(".n-inline-loading-datastore").hide(),a.updateButtonState(!0,!1),a.updateDatastoreView()},error:function(e,t){a.$(".n-inline-loading-datastore").hide(),a.updateButtonState(!0,!1),a.updateDatastoreView(),a.showHeaderError(t.responseText)}})}else this.$(".n-inline-loading-datastore").hide(),this.updateButtonState(!0,!1);S.hasHyperV()&&(this.$(".n-inline-loading-datastore").hide(),this.updateButtonState(!0,!1),this.updateSmbShareView()),this.applyNutanixInput({types:["radio","checkbox"]})},updateDatastoreView:function(){var e=this.hostCollection.getHostsWithHypervisor(E.HYPERVISOR_TYPE.ESXI).length;this.$('.datastoreHolder input[type="radio"]').removeAttr("disabled");var t=this.model.get(l.ID),n=this.datastoreCollection.getHostsWithDatastore(t);n.length===e||this.getAction()===E.ACTION_CREATE?(this.$("input:radio[name=createDataStore]").filter("[value="+this.MOUNT_ALL+"]").prop("checked",!0),this.updateHostSelectionForDatastore(!0)):0===n.length?(this.$("input:radio[name=createDataStore]").filter("[value="+this.UNMOUNT_ALL+"]").prop("checked",!0),this.updateHostSelectionForDatastore(!1)):(this.$("input:radio[name=createDataStore]").filter("[value="+this.MOUNT_HOST+"]").prop("checked",!0),this.$(".datastoreHostHolder").slideDown("fast"),this.updateHostDatastoreCheckbox())},updateHostDatastoreCheckbox:function(){var e=this.model.get(l.ID),t=this.datastoreCollection.getHostsWithDatastore(e);this.$(".checkboxHostForDatastore").each(function(){$(this).prop("checked",!1),_.indexOf(t,$(this).val().trim())>-1&&($(this).prop("checked",!0),$(this).closest("li").find(".n-host-datastore").hide(),$(this).closest("li").find(".n-host-datastore").attr("isMounted",!0))})},updateSmbShareView:function(){this.$('.smbShareHolder input[type="radio"]').removeAttr("disabled");var e=this.model.get(l.ID),t=this.hostCollection.getHostsWithDefaultShare(e);0===t.length||this.getAction()===E.ACTION_CREATE?this.$("input:radio[name=createSmbShare]").filter("[value="+this.NONE+"]").prop("checked",!0):t.length===this.hostCollection.getHostsWithHypervisor(E.HYPERVISOR_TYPE.HYPERV).length?(this.$("input:radio[name=createSmbShare]").filter("[value="+this.DEFAULT_ALL+"]").prop("checked",!0),this.updateHostSelectionForSmbShare(!0)):(this.$("input:radio[name=createSmbShare]").filter("[value="+this.DEFAULT_HOST+"]").prop("checked",!0),this.$(".smbShareHostHolder").slideDown("fast"),this.updateHostSmbShareCheckbox())},updateHostSmbShareCheckbox:function(){var e=this.model.get(l.ID),t=this.hostCollection.getHostsWithDefaultShare(e);this.$(".checkboxHostForSmbShare").each(function(){$(this).prop("checked",!1),_.indexOf(t,$(this).val().trim())>-1&&($(this).prop("checked",!0),$(this).closest("li").find(".n-host-smbshare").hide(),$(this).closest("li").find(".n-host-smbshare").attr("isDefaultShare",!0))})},updateHostSelectionForSmbShare:function(e){this.$(".checkboxHostForSmbShare").each(function(){$(this).prop("checked",e)})},updateMaxCapacityView:function(){var e=0
;if(this.getAction()===E.ACTION_CREATE){var t=this.$(".comboStoragePool").val();e=this.spCollection.get(t).getFreeUnreservedCapacity(),this.$("#lblStoragePoolFreeUnreservedCapacity").show()}this.getAction()===E.ACTION_UPDATE&&(e=this.model.getMaxCapacityLogical(),this.$("#lblStoragePoolFreeUnreservedCapacity").hide()),this.$(".lblMaxCapacity").text(C.storageFormat(e))},updateHostSelectionForDatastore:function(e){this.$(".checkboxHostForDatastore").each(function(){$(this).prop("checked",e)})},getHostsToMountDatastore:function(){var e=this.datastoreCollection.getHostsWithDatastore(this.model.id),t=[];return this.$(".checkboxHostForDatastore").each(function(n){var i=$(this).val();void 0===_.find(e,function(e){return e==i})&&$(this).is(":checked")&&t.push($(this).val())}),t},getHostsToSetDefaultSmbShare:function(){var e=this.model.get(l.ID),t=this.hostCollection.getHostsWithDefaultShare(e),n=[];return this.$(".checkboxHostForSmbShare").each(function(e){var i=$(this).val();void 0===_.find(t,function(e){return e==i})&&$(this).is(":checked")&&n.push($(this).val())}),n},getHostsToUnmountDatastore:function(){var e=this.datastoreCollection.getHostsWithDatastore(this.model.id),t=[];return this.$(".checkboxHostForDatastore").each(function(n){var i=$(this).val();void 0===_.find(e,function(e){return e==i})||$(this).is(":checked")||t.push($(this).val())}),t},getHostsToResetDefaultSmbShare:function(){var e=this.model.get(l.ID),t=this.hostCollection.getHostsWithDefaultShare(e),n=[];return this.$(".checkboxHostForSmbShare").each(function(e){var i=$(this).val();void 0===_.find(t,function(e){return e==i})||$(this).is(":checked")||n.push($(this).val())}),n},onClickBtnPopupAction:function(e){s.executeActionElement(e.currentTarget)},onChangeStoragePoolCombo:function(e){this.updateMaxCapacityView()},onChangeRF:function(e){var t=$(e.currentTarget).closest(".control-group").find(".alertReplicationFactor"),n=Number(this.$(".clusterRedundancyFactor:checked").val());isNaN(n)&&(n=this.model.get(l.RF)),this.$(".lblDesiredRF").html(n);var i=r.FEATURE_MAP.LICENSE_MAX_REPLICATION_FACTOR;if(r.violatedFeatureLicense(i,n)){var s=r.getLimitPopupMessageTemplate(i);this._displayContainerAlerts(t,s,"alert-warning"),this.scrollToBottom()}else t.slideUp()},onClickFingerPrintOnWrite:function(e){var t=$(e.currentTarget).closest(".control-group").find(".alertDedup"),n=$(e.currentTarget).is(":checked");if(n){var i=r.FEATURE_MAP.LICENSE_PERF_TIER_INLINE_DEDUP;if(r.violatedFeatureLicense(i)){var s=r.getPopupMessageTemplate(i);this._displayContainerAlerts(t,s,"alert-warning")}this.$(".chkboxDiskDedup").prop("disabled",!1),this.$(".diskDedupOptions").removeClass("disabled")}else t.slideUp(),this.$(".chkboxDiskDedup").prop("disabled",!0),this.$(".diskDedupOptions").addClass("disabled")},onClickDiskDedup:function(e){var t=$(e.currentTarget).closest(".control-group").find(".alertOfflineDedup");if($(e.currentTarget).is(":checked")){var n=r.FEATURE_MAP.LICENSE_OFFLINE_DISK_DEDUP;if(r.violatedFeatureLicense(n)){var i=r.getPopupMessageTemplate(n);this._displayContainerAlerts(t,i,"alert-warning")}}else t.slideUp()},onClickErasureCoding:function(e){var t=$(e.currentTarget).closest(".control-group").find(".messageErasureCoding"),n=$(e.currentTarget).is(":checked"),i=$(e.currentTarget).closest(".control-group").find(".alertErasureCoding");if(this.isErasureCodeUpdated=!0,n){this.enableRA?this._showErasureCodingMessages(t):null===this.areBAConditionsMet?t.html('<div class="n-popup-loading">Loading...</div>').slideDown():this._showErasureCodingMessages(t);var s=r.FEATURE_MAP.LICENSE_ERASURE_CODE;if(r.violatedFeatureLicense(s)){var a=r.getPopupMessageTemplate(s);this._displayContainerAlerts(i,a,"alert-warning")}}else t.slideUp(),i.slideUp()},_showErasureCodingMessages:function(e){var t=null;this.areBAConditionsMet&&(t="Turning on erasure coding will break the current Block fault tolerance and only have Node fault tolerance unless there are at least N blocks in the cluster. If Block fault tolerance is chosen for the cluster, erasure coding will not work unless there are at least N blocks in the cluster. N is 4 if container replication factor is 2, or 6 if container replication factor is 3."),t&&this._displayContainerAlerts(e,t,"alert")},_displayContainerAlerts:function(e,t,n){e.html(w({type:n,alertText:t})).slideDown()},onClickBtnCreateDatastore:function(e){var t=e.currentTarget,n=$(t).attr("data");if(n===this.MOUNT_ALL)this.$(".datastoreHostHolder").slideUp("fast"),this.$(".chkSelectAllHosts").prop("checked",!0),this.updateHostSelectionForDatastore(!0);else if(n===this.MOUNT_HOST){var i=this;this.$(".datastoreHostHolder").slideDown("fast",function(){i.$("#advancedSettingsContainer").is(":visible")||i.scrollToBottom()}),this.updateHostDatastoreCheckbox()}else n===this.UNMOUNT_ALL&&(this.$(".datastoreHostHolder").slideUp("fast"),this.$(".chkSelectAllHosts").prop("checked",!1),this.updateHostSelectionForDatastore(!1));this.applyNutanixInput({types:["checkbox"]})},onClickBtnCreateSmbShare:function(e){var t=e.currentTarget,n=$(t).attr("data");if(n===this.DEFAULT_HOST){var i=this;this.$(".smbShareHostHolder").slideDown("fast",function(){i.$("#advancedSettingsContainer").is(":visible")||i.scrollToBottom()}),this.updateHostSmbShareCheckbox()}else n===this.DEFAULT_ALL?(this.$(".smbShareHostHolder").slideUp("fast"),this.updateHostSelectionForSmbShare(!0)):n===this.NONE&&(this.$(".smbShareHostHolder").slideUp("fast"),this.updateHostSelectionForSmbShare(!1));this.applyNutanixInput({types:["checkbox"]})},onClickSelectAllHosts:function(e){var t=this.$(".chkSelectAllHosts").is(":checked");this.updateHostSelectionForDatastore(t)},onClickCompression:function(e){var t=$(e.currentTarget).is(":checked");$(e.currentTarget).closest(".control-group").find(".alertCompressionOn");t?this.$(".compressionHolder").slideDown("fast",function(){$(this).css({overflow:"visible"})}):this.$(".compressionHolder").slideUp("fast")},onClickCheckboxForDatastore:function(e){var t=e.currentTarget,n=$(t).closest("li").find(".n-host-datastore");$(n).hide(),$(n).removeClass("n-mount"),$(n).removeClass("n-unmount"),"true"===$(n).attr("isMounted")?$(t).is(":checked")||($(n).addClass("n-unmount"),$(n).text("To be unmounted"),$(n).show()):$(t).is(":checked")&&($(n).addClass("n-mount"),$(n).text("To be mounted"),$(n).show())},onClickCheckboxForSmbShare:function(e){var t=e.currentTarget,n=$(t).closest("li").find(".n-host-smbshare");$(n).hide(),$(n).removeClass("n-mount"),$(n).removeClass("n-unmount"),"true"===$(n).attr("isDefaultShare")?$(t).is(":checked")||($(n).addClass("n-unmount"),$(n).text("To be removed as default share"),$(n).show()):$(t).is(":checked")&&($(n).addClass("n-mount"),$(n).text("To be default share"),$(n).show())},onInputNameKeyUp:function(e){T.validNameCharactersEventHandler(e,this.$(".n-input-validation-msg"),null,this.i18n("nameValidationError"),this.NAME_CHECKING_REGEXP)},toggleAdvancedSettings:function(){var e=this,t=this.$("#advancedSettingsContainer"),n=$(t).is(":visible");return $(t).slideToggle("fast",function(){$(t).is(":visible")&&e.scrollToElement(t,".n-modal-body")}),!n},save:function(e){var t=this,n=[],i=[];if(S.hasESX()&&(n=this.getHostsToUnmountDatastore()),S.hasHyperV()&&(i=this.getHostsToResetDefaultSmbShare()),this.getAction()===E.ACTION_UPDATE&&(n.length||i.length)){var s=this._getDisplayMessage(n,i),a=_.bind(this._proceedSave,this);$.nutanixConfirm({msg:s,yes:function(){a(e)},no:function(){t.updateButtonState(!0)},yesText:"Yes",noText:"No"})}else this._proceedSave(e)},_getDisplayMessage:function(e,t){var n,i,s="",a=this.model.get(l.NAME);return e.length&&(1===e.length?(n=_.find(this.hostCollection.models,function(t){return t.get(t.idAttribute)==e[0]}),s="NFS datastore will be unmounted from host: "+n.get(n.nameAttribute)+".<br/>"):s="NFS datastores will be unmounted from: "+e.length+" hosts.<br/>"),t.length&&(1===t.length?(i=_.find(this.hostCollection.models,function(e){return e.get(e.idAttribute)==t[0]}),s=s+"Storage container "+a+" will not be default location for VM files on: "+i.get(i.nameAttribute)+".<br/>"):s=s+"Storage container "+a+" will not be default location for VM files on: "+t.length+" hosts.<br/>"),s+="Do you want to continue ?"},_proceedSave:function(e){var t=this,n=_.clone(e);this.model.on("error",function(e,n){t.showHeaderError(_.isObject(n)?n.responseText:n)});var i=this._checkInputValues();if(i)return t.showHeaderError(i),e.error(this.model),void this.scrollToTop();this.model.set(this.getDirtyContainerModel())?this.model.save(null,{success:function(e,i){!0!==(i=T.processAjaxPrimitive(i))&&"true"!==i||(S.hasESX()&&t.saveDatastore(e,n),S.hasHyperV()&&t.saveSmbShare(e,n),e.unset(l.PRIMITIVE_KEY),n.success(e,i))},error:function(e,i){var s=i.responseText;-1!==s.toLowerCase().indexOf("out of range")?t.showHeaderError("Please enter a valid numeric value."):t.showHeaderError(s),n.error(e,i)}}):e.error&&e.error(this.model),this.scrollToTop()},saveDatastore:function(e,t){var n,i,s,o=[],r=[];this.getAction()===E.ACTION_CREATE?(this.$(".checkboxHostForDatastore").each(function(e){$(this).is(":checked")&&o.push($(this).val())}),this.$(".checkboxHostForSmbShare").each(function(e){$(this).is(":checked")&&o.push($(this).val())}),s=e.get(l.NAME)):this.getAction()===E.ACTION_UPDATE&&(o=this.getHostsToMountDatastore(),r=this.getHostsToUnmountDatastore(),s=this.datastoreCollection.getDatastoreNameByContainer(e.get(l.ID))),o.length>0&&(n=new d,n.actionMode=E.ACTION_ADD,n.set({containerName:e.get(l.NAME),datastoreName:s,nodeIds:o}),n.save(null,{error:function(e,t){a.showClientNotification(E.NOTIFY_ERROR,T.processAjaxError(t.responseText))}})),r.length>0&&(i=new d,i.actionMode=E.ACTION_REMOVE,i.set({containerName:e.get(l.NAME),datastoreName:s,nodeIds:r}),i.save(null,{error:function(e,t){a.showClientNotification(E.NOTIFY_ERROR,T.processAjaxError(t.responseText))}}))},saveSmbShare:function(e,t){var n,i,s=[],o=[];this.getAction()===E.ACTION_CREATE?this.$(".checkboxHostForSmbShare").each(function(e){$(this).is(":checked")&&s.push($(this).val())}):this.getAction()===E.ACTION_UPDATE&&(s=this.getHostsToSetDefaultSmbShare(),o=this.getHostsToResetDefaultSmbShare()),s.length>0&&(n=new u,n.set({containerForVhdFiles:e.get(l.NAME),containerForVmConfigFiles:e.get(l.NAME),nodeIds:s}),n.save(null,{error:function(e,t){a.showClientNotification(E.NOTIFY_ERROR,T.processAjaxError(t.responseText))}})),o.length>0&&(i=new u,i.actionMode=E.ACTION_REMOVE,i.set({nodeIds:o}),i.save(null,{error:function(e,t){a.showClientNotification(E.NOTIFY_ERROR,T.processAjaxError(t.responseText))}}))},reset:function(){this.$(".inputName").val(""),this.updateForm()},resetFormElement:function(e){e===E.ENTITY_STORAGE_POOL&&this.refreshStoragePoolCollection()},getDirtyContainerModel:function(){var e=isNaN(this.$(".inputResCapacity").val())?this.$(".inputResCapacity").val():C.convertToBytes(this.$(".inputResCapacity").val()),t=null;this.$(".inputAdvertisedCapacity").val().trim().length&&(t=isNaN(this.$(".inputAdvertisedCapacity").val())?this.$(".inputAdvertisedCapacity").val():C.convertToBytes(this.$(".inputAdvertisedCapacity").val()));var n=isNaN(this.$(".inputCompressionDelay").val())?this.$(".inputCompressionDelay").val():60*this.$(".inputCompressionDelay").val(),i=this._getErasureCode(),s={name:this.$(".inputName").val(),storagePoolId:this.$(".comboStoragePool").val(),replicationFactor:this.$(".clusterRedundancyFactor:checked").val()||this.model.get(l.RF),totalExplicitReservedCapacity:e,advertisedCapacity:t,compressionEnabled:this.$(".chkboxCompression").is(":checked"),compressionDelayInSecs:n,erasureCode:i,fingerPrintOnWrite:this.$(".chkboxFOW").is(":checked")?E.FINGER_PRINT_ON_WRITE.ON:E.FINGER_PRINT_ON_WRITE.OFF,onDiskDedup:function(){return this.$(".chkboxFOW").is(":checked")&&this.$(".chkboxDiskDedup").is(":checked")?E.FINGER_PRINT_ON_WRITE.POST_PROCESS:E.FINGER_PRINT_ON_WRITE.OFF}.call(this),nfsWhitelist:this._getWhiteListsArrayFromView()};return(this.isNewContainer()||this.isErasureCodeUpdated)&&(s.preferHigherECFaultDomain=!0),this.isEncryptionFetchEnabled()&&!this.isContainerEncrypted()&&(s.enableSoftwareEncryption=this.$(".encryptionCheckbox").is(":checked")),s},_checkInputValues:function(){var e=null,t=Number(this.$(".inputResCapacity").val().trim()),n=Number(this.$(".inputAdvertisedCapacity").val().trim());return isNaN(t)||!T.isInt(t)||t<0?e="Reserved capacity should be an integer greater than zero.":(isNaN(n)||!T.isInt(n)||n<0)&&(e="Advertised capacity should be an integer greater than zero."),e},_getWhiteListsArrayFromView:function(){var e=this.$(".filesystemWhitelists").val();return this._parseFileSystemWhiteListValue(e)},_parseFileSystemWhiteListValue:function(e){if(e){var t=_.map(e.split(","),function(e){return e.trim()});if(t&&t.length)return t}},_getErasureCode:function(){return this.isErasureCodeUpdated?this.$(".chkboxErasureCoding").is(":checked")?E.ERASURE_CODING.ON:E.ERASURE_CODING.OFF:this.model.get(l.ERASURE_CODE)},destroy:function(){this.model&&this.model.off(),this.$(".nutanixMoreInfo").nutanixMoreInfo("destroy"),e.prototype.destroy.apply(this,arguments)}})}),define("views/popups/storage/StoragePopupView",["backbone","views/basecomponents/popups/BaseMultiplePopupView","text!templates/popups/storage/StoragePopupView.html","utils/AppConstants","views/popups/storage/storagepool/StoragePoolPopupFormView","views/popups/storage/container/ContainerPopupFormView","managers/NavigationManager","managers/LicenseManager","models/storage/StoragePoolModel","models/storage/ContainerModel"],function(e,t,n,i,s,a,o,r,l,c){"use strict";return t.extend({el:"#popupStorage",events:{"click  .modal-header .close":"hide","click  .btnSave":"onSave","click  .btnReset":"onReset","click  .btnCancel":"onCancel","keypress input":"onKeyPress","click  .btnAdvancedSettings":"onClickAdvancedSettings"},initialize:function(){this.template=_.template(n),t.prototype.initialize.apply(this,arguments)},show:function(){t.prototype.show.apply(this,arguments);var e=r.FEATURE_MAP.LICENSE_INLINE_COMPRESSION;if(this.$(".chkboxCompression").is(":checked")&&r.violatedFeatureLicense(e)){var n=r.getPopupMessageTemplate(e);this.$(".n-inline-alert").html(n)}},onCancel:function(){this.hide()},onReset:function(){this.resetCurrentForm()},onSave:function(){this.saveCurrentForm()},onClickAdvancedSettings:function(){this.toggleAdvancedSettings()},onEnterKeyPress:function(){this.onSave()},deleteEntity:function(e,t){var n;switch(e){case i.ENTITY_STORAGE_POOL:n=new l({id:t});break;case i.ENTITY_CONTAINER:n=new c({id:t})}if(n){n.destroy({success:function(e,t){var n=e&&e.entityType?{actionTarget:e.entityType}:{};o.showDetailsSummary(n)}})}},createEntityFormPopupView:function(e){var t,n={actionRoute:e,parent:this};switch(e[i.NAV_ACTION_TARGET]){case i.ENTITY_STORAGE_POOL:t=new s(n);break;case i.ENTITY_CONTAINER:t=new a(n)}return t},postSlideForm:function(e){var t=e[i.NAV_ACTION_TARGET];t===i.ENTITY_CONTAINER?this.$(".btnAdvancedSettings").show():t===i.ENTITY_STORAGE_POOL&&this.$(".btnAdvancedSettings").hide()}})}),define("text!templates/popups/vm/ManageNGTView.html",[],function(){return'\n<div class="modal-header">\n  <button type="button" class="close" data-dismiss="modal">\n    <i data-icon="K" aria-hidden="true"></i>\n  </button>\n  <h4 class="n-title">Manage VM Guest Tools</h4>\n</div>\n<div class="n-modal-wrapper">\n  <div class="n-modal-body">\n    <div class="n-modal-content-wrapper">\n      <div class="n-modal-alert-header">\n        \x3c!-- @view: update message goes here --\x3e\n      </div>\n      <% if (!initialized) { %>\n        <div class="n-modal-loader">\n            <div class="donut-loader-blue"></div>\n            <span class="n-loading-text">Loading...&nbsp;</span>\n        </div>\n      <% } else { %>\n        <div class="n-popup-description">\n          \x3c!-- //TODO: @amit.sarangi add i18n --\x3e\n          Please select the guest tool\n        </div>\n        <div class="popup-content">\n          <form id="vmManageNGTForm" class="form-horizontal"\n                data-test="manageNGTForm">\n            <div class="control-group change-type-wrapper" >\n\n              \x3c!-- VM ManageNGT Form --\x3e\n              <%= Components.checkbox({\n                  id: \'enableNgt\',\n                  jsClasses: \'change-type\',\n                  name: \'change-type\',\n                  value: \'enable_ngt\'\n              }) %>\n              <label class="cb-label">\n                Enable Nutanix Guest Tools\n              </label>\n              <div id="parameters-input" style="display:none">\n                <div>\n                  <%= Components.checkbox({\n                    id: \'mount-ngt\',\n                    jsClasses: \'\',\n                  }) %>\n                  <label class="cb-label">Mount Nutanix Guest Tools</label>\n                </div>\n                <div class="config-options">\n                  <div class="params-header">Enable Applications</div>\n                  <div class="controls">\n                    <%= Components.checkbox({\n                      id: \'flr\',\n                      jsClasses: \'change-type\',\n                      name: \'change-type-group\',\n                      value: \'SSR\'\n                    }) %>\n                    <label for="flr" class="vm-ngt-params">\n                           Self Service Restore (SSR)  </label>\n                    <span class="n-tooltip flr-info">\n                      <span class="n-tooltip-circle">?</span>\n                    </span><br>\n                    <%= Components.checkbox({\n                      id: \'vss\',\n                      jsClasses: \'change-type\',\n                      name: \'change-type-group\',\n                      value: \'VSS\'\n                    }) %>\n                    <label for="vss" class="vm-ngt-params">\n                      Volume Snapshot Service /\n                      Application Consistent Snapshots (VSS)\n                    </label>\n                    <span class="n-tooltip vss-info">\n                      <span class="n-tooltip-circle">?</span>\n                    </span>\n                  </div>\n                </div>\n              </div>\n            </div>\n            <% if (isEsx) { %>\n              <div class="control-group change-type-wrapper">\n                <span class="power-off-vmgt-tooltip" data-toggle="tooltip"\n                  data-original-title="<%= i18n(\'vmgt_power_off_tooltip\') %>">\n                  \x3c!-- VMware Guest tools --\x3e\n                  <%= Components.checkbox({\n                    id: \'mount-vmgt\',\n                    jsClasses: \'\',\n                    checked: isVgtInstalled,\n                    value: \'mount-vmgt\',\n                    disabled: isDisabled\n                  }) %>\n                  <label class="cb-label <%= isDisabled?\'gray-out\':\'\' %>">\n                    Mount VMware Guest Tools\n                  </label>\n                <span>\n              </div>\n            <% } %>\n          </form>\n        </div>\n      <% } %>\n    </div>\n  </div>\n\n  <div class="n-modal-footer">\n    \x3c!-- Back button --\x3e\n    <button class="btnCancel btn n-btn-list">\n      Cancel\n    </button>\n    <button class="btnUpdate btn btn-primary n-btn-list"\n            data-loading-text="Saving...">\n      Save\n    </button>\n  </div>\n</div>\n'}),define("views/popups/vm/VmManageNgtPopupView",["views/basecomponents/popups/BasePopupView","models/BaseModel","models/vm/VMModel","models/vm/AcropolisVMModel","models/storage/AcropolisDiskModel","data/DataProperties","data/DataURLConstants","managers/NotificationManager","managers/ClusterManager","data/DataManager","utils/AppConstants","utils/AppUtil","components/Components","text!templates/popups/vm/ManageNGTView.html"],function(e,t,n,i,s,a,o,r,l,c,d,p,u,h){"use strict";var m={ENABLED:"enabled",VM_VSS:"vss_snapshot",VM_FLR:"file_level_restore",OPERATION:"operation",OLDAPPSTATE:"oldAppState"};h=_.template(h);var f=t.extend({defaults:{vmId:null,enabled:!0,applications:{file_level_restore:!1,vss_snapshot:!1},oldAppState:{file_level_restore:!1,vss_snapshot:!1,ngt_enabled:!1}},name:"NgtModel",parseOptions:function(e,n,i){return i=t.prototype.parseOptions.apply(this,arguments),i.type="POST",i.contentType="application/json",i},getURL:function(e,t){return _.template(o.MGMT_VM_MANAGE_NGT,{vmId:this.get(a.VM_ID)})},showLatencyNotification:function(e,t){},showSuccessNotification:function(e,t,n){var i;!0===this.get(m.ENABLED)?this.get(m.OLDAPPSTATE).ngt_enabled?this.get(m.OLDAPPSTATE)[m.VM_FLR]&&this.get(m.OLDAPPSTATE)[m.VM_VSS]?this.get(a.APPLICATIONS)[m.VM_FLR]||this.get(a.APPLICATIONS)[m.VM_VSS]?this.get(a.APPLICATIONS)[m.VM_FLR]?this.get(a.APPLICATIONS)[m.VM_VSS]||(i=this.i18nf("ngt_success_message",{status:"disable",feat:"VSS",type:"service"})):i=this.i18nf("ngt_success_message",{status:"disable",feat:"SSR",type:"service"}):i=this.i18nf("ngt_success_message",{status:"disable",feat:"all NGT"}):this.get(m.OLDAPPSTATE)[m.VM_FLR]||this.get(m.OLDAPPSTATE)[m.VM_VSS]?this.get(m.OLDAPPSTATE)[m.VM_FLR]?this.get(m.OLDAPPSTATE)[m.VM_VSS]?i=this.i18nf("ngt_success_message",{status:"enable",feat:"NGT",type:"feature"}):this.get(a.APPLICATIONS)[m.VM_VSS]&&(i=this.i18nf("ngt_success_message",{status:"enable",feat:"VSS",type:"service"})):this.get(a.APPLICATIONS)[m.VM_FLR]&&(i=this.i18nf("ngt_success_message",{status:"enable",feat:"SSR",type:"service"})):this.get(a.APPLICATIONS)[m.VM_FLR]&&this.get(a.APPLICATIONS)[m.VM_VSS]?i=this.i18nf("ngt_success_message",{status:"enable",feat:"all NGT"}):this.get(a.APPLICATIONS)[m.VM_FLR]?i=this.i18nf("ngt_success_message",{status:"enable",feat:"SSR",type:"service"}):this.get(a.APPLICATIONS)[m.VM_VSS]&&(i=this.i18nf("ngt_success_message",{status:"enable",feat:"VSS",type:"service"})):i=this.i18nf("ngt_success_message",{status:"enable",feat:"NGT",type:"feature"}):i=this.i18nf("ngt_success_message",{status:"disable",feat:"NGT",type:"feature"}),r.showClientNotification(d.NOTIFY_SUCCESS,i)},showErrorNotification:function(e,t,n){var i=p.processAjaxError(n.responseText);r.showClientNotification(d.NOTIFY_ERROR,i)}}),v=t.extend({name:"MountNGTModel",vmId:null,getURL:function(e,t){return _.template(o.MGMT_VM_MOUNT,{vmId:this.vmId})},setVmId:function(e){this.vmId=e},showLatencyNotification:function(e,t){},showSuccessNotification:function(e,t,n){var i=this.i18n("mount_ngt_success_message","Initiated mounting of NGT ISO on VM");r.showClientNotification(d.NOTIFY_SUCCESS,i)},showErrorNotification:function(e,t,n){var i=p.processAjaxError(n.responseText);r.showClientNotification(d.NOTIFY_ERROR,i)}}),g=t.extend({name:"UnmountNGTModel",vmId:null,getURL:function(e,t){return _.template(o.MGMT_VM_UNMOUNT,{vmId:this.vmId})},setVmId:function(e){this.vmId=e},showLatencyNotification:function(e,t){},showSuccessNotification:function(e,t,n){var i=this.i18n("unmount_ngt_success_message","Initiated unmounting of NGT ISO on VM");r.showClientNotification(d.NOTIFY_SUCCESS,i)},showErrorNotification:function(e,t,n){var i=p.processAjaxError(n.responseText);r.showClientNotification(d.NOTIFY_ERROR,i)}}),E=t.extend({name:"VmGuestToolsModel",DP:{OPERATION:"operation"},defaults:{uuid:null,operation:d.ACTION_MOUNT,override_guest:!1},getURL:function(){return _.template(o.MGMT_VM_MANAGE_GUEST_TOOLS,{uuid:this.get(a.UUID)})},getDataSourceURL:function(){return c.getV2DataSourceURL()},showLatencyNotification:function(e,t){},showSuccessNotification:function(e,t,n){var i="";i=e.get(this.DP.OPERATION)===d.ACTION_MOUNT?this.i18n("mount_vmgt_success_message"):this.i18n("unmount_vmgt_success_message"),r.showClientNotification(d.NOTIFY_SUCCESS,i)}});return e.extend({model:null,name:"VmManageNgtPopupView",acropolisModel:null,el:"#popupVmNGT",events:{"click  .btnUpdate":"onSaveClick","click  .btnCancel":"onCancelClick","click  .modal-header .close":"hide","click  .btnBack":"onBackClick","click  #enableNgt":"onCheckOptionClick","click  #mount-ngt":"onCheckMountOperation","click  #unmount-ngt":"onUnmountClick","click  #mount-vmgt":"onCheckMountOperationVmgt"},vmId:null,isMounted:!1,initialized:!1,initialize:function(){this.model=new n,this.acropolisModel=new i,e.prototype.initialize.apply(this,arguments)},render:function(){this.initialized?this.isMounted=this.model.get(a.VM_NGT)[a.VM_NGT_MOUNTED]:this.loadDataAndRender(),this.$el.html(h(this.vtOptions({Components:u,isMounted:this.isMounted,initialized:this.initialized,isEsx:this.isEsx(),isVgtInstalled:this.isVMGTMounted(),isDisabled:!this.isManagementServerRegistered()||this.isVMPoweredOff()}))),this.isVMPoweredOff()&&this.$(".power-off-vmgt-tooltip").tooltip({placement:"bottom",container:"body"}),this.initialized&&(this.showManageNGTForm(),this.showInfoIfMounted())},isVMPoweredOff:function(){return this.acropolisModel.get(i.DP.VM_STATE)===d.VM_POWER_STATE.OFF},getErrorMountMsg:function(){return this.i18n("mount_msg","Guest Tools cannot be mounted as there not enough empty CD-ROM(s)")},isEsx:function(){return this.model.isESX()},isVMGTMounted:function(){return this.acropolisModel.isToolsInstallerMounted()},isManagementServerRegistered:function(){var e=l.getCurrentClusterModel();return e&&e.isManagementServerRegistered()&&this.isEsx()},loadDataAndRender:function(){this.model.set(a.VM_ID,this.vmId),this.model.fetch().done(function(){this.acropolisModel.set(this.acropolisModel.idAttribute,this.model.get(a.UUID),{silent:!0}),this.acropolisModel.includeVMDiskSizes=!0,this.acropolisModel.includeAddressAssignments=!0,this.acropolisModel.fetch().done(function(){this.initialized=!0,this.render(),this.isClusterFFEnabled(d.FFLAGS.HELP_DOC)&&this.createHelpIcon(this.actionRoute)}.bind(this)).fail(function(e,t,n){this.showHeaderError(p.processAjaxError(t.responseText))}.bind(this))}.bind(this)).fail(function(e,t,n){this.showHeaderError(p.processAjaxError(t.responseText))}.bind(this))},show:function(t){this.vmId=t.actionTargetId,e.prototype.show.apply(this,arguments)},getEmptyCdromList:function(){var e=this.acropolisModel.get(i.DP.VM_DISK_INFO);return _.filter(e,function(e){return e[s.V2_DP.IS_CDROM]&&e[s.V2_DP.IS_EMPTY]},this)||[]},getAcropolisDiskModel:function(){var e=this.acropolisModel.get(i.DP.VM_DISK_INFO),t=s.V2_DP,n=_.find(e,function(e){return e[t.IS_CDROM]&&!e[t.IS_EMPTY]},this),o={};o[a.ID]=(n[t.DISK_ADDRESS]||{})[t.VMDISK_UUID],o[s.DP.IS_CDROM]=n[t.IS_CDROM];var r=n[t.DISK_ADDRESS],l=null;r&&(l={},l[s.DP.BUS_TYPE]=r[t.BUS_TYPE],l[s.DP.DEVICE_INDEX]=r[t.DEVICE_INDEX]),o[s.DP.DISK_ADDRESS]=l;var c=new s;return c.set(o),c},hasEmptyCdrom:function(){return(this.getEmptyCdromList()||[]).length>0},isNgtMounted:function(){return this.model.get(a.VM_NGT)[a.VM_NGT_MOUNTED]},isNgtEnabled:function(){return this.model.get(a.VM_NGT)[a.VM_NGT_ENABLED]},showInfoIfMounted:function(){this.isNgtMounted()&&this.showHeaderInfo(this.i18n("ngt_mounted","Nutanix guest tool is mounted."))},promptUnmount:function(){var e=this.acropolisModel.get(i.DP.VM_DISK_INFO),t=s.V2_DP;_.find(e,function(e){return e[t.IS_CDROM]&&!e[t.IS_EMPTY]},this)?this.showHeaderErrorWithAction(this.getErrorMountMsg(),{actionTargetId:"unmount-ngt",actionTargetName:this.i18n("unmount_link_text"),options:{trigger:"click"}}):this.showHeaderError(this.getErrorMountMsg())},showManageNGTForm:function(e,t){this.mode=e,this.clearHeader(),this.initialized&&this.markOptions(),this.$(".n-title").text(d.ACTION_NAMES[e]),this.$(".n-btn-form").hide(),this.$(".btnUpdate").show().text("Submit"),this.$("#management-mount .btn").append(u.icon("z","-down-arrow")),this.$(".flr-info .n-tooltip-circle").tooltip({title:"File level recovery for VMs",placement:"right",trigger:"hover"}),this.$(".vss-info .n-tooltip-circle").tooltip({title:"Application consistent snapshots for VMs",placement:"left",trigger:"hover"})},markOptions:function(e){var t=this.getNgtCurrentStatus();t.ngtEnabled&&(this.$("#enableNgt").prop("checked",!0),t.vssEnabled&&this.$("#vss").prop("checked",!0),t.flrEnabled&&this.$("#flr").prop("checked",!0),this.isNgtMounted()&&this.$("#mount-ngt").prop("checked",!0)),this.isVMGTMounted()&&this.$("#mount-vmgt").prop("checked",!0),this.$("#enableNgt").is(":checked")?this.$("#parameters-input").slideDown(100):this.$("#parameters-input").slideUp(100)},onSaveClick:function(){this.clearHeader();var e=this.getNgtCurrentStatus(),t=this.$("#enableNgt");t.is(":checked")?(this.$("#mount-ngt").is(":checked")&&!this.isNgtMounted()?this.mountNgt(this.vmId):!this.$("#mount-ngt").is(":checked")&&this.isNgtMounted()&&this.unmountNgt(this.vmId),e.ngtEnabled&&$("#flr").is(":checked")===e.flrEnabled&&$("#vss").is(":checked")===e.vssEnabled||this.enableNgt(this.vmId,$("#flr").is(":checked"),$("#vss").is(":checked"),e.flrEnabled,e.vssEnabled,e.ngtEnabled)):!t.is(":checked")&&e.ngtEnabled&&this.disableNgt(this.vmId),this.isEsx()&&this.hasEmptyCdrom()&&$("#mount-vmgt").is(":checked")&&!this.isVMGTMounted()&&this.mountVmgt(),this.isEsx()&&!$("#mount-vmgt").is(":checked")&&this.isVMGTMounted()&&this.unmountVmgt(),this.hide()},getNgtCurrentStatus:function(){var e=this.model.get(a.VM_NGT)||{};return{ngtEnabled:e[a.ENABLED]||!1,vssEnabled:e[a.APPLICATIONS][m.VM_VSS]||!1,flrEnabled:e[a.APPLICATIONS][m.VM_FLR]||!1}},onCancelClick:function(){this.hide()},onBackClick:function(){this.clearHeader()},onCheckOptionClick:function(e){this.$("#enableNgt").is(":checked")?(this.$("#parameters-input").slideDown(100),this.$("#vss").prop("checked",!0)):(this.$("#mount-ngt").prop("checked",!1),this.onCheckMountOperation(e),this.$("#parameters-input").slideUp(100))},onCheckMountOperation:function(e){this.isMountRestricted()?(this.isEsx()?this.showHeaderError(this.getErrorMountMsg()):this.promptUnmount(),this.$(".btnUpdate").prop("disabled",!0)):(this.$(".btnUpdate").prop("disabled",!1),this.clearHeader())},onCheckMountOperationVmgt:function(e){this.isMountRestricted()?(this.showHeaderError(this.getErrorMountMsg()),this.$(".btnUpdate").prop("disabled",!0)):(this.$(".btnUpdate").prop("disabled",!1),this.clearHeader())},isMountRestricted:function(){var e=this.getEmptyCdromList();if(this.isVMGTMounted()||this.isNgtMounted()){if(this.isVMGTMounted()&&!this.isNgtMounted()){if(this.$("#mount-ngt").is(":checked")&&!this.hasEmptyCdrom())return!0}else if(!this.isVMGTMounted()&&this.isNgtMounted()&&this.$("#mount-vmgt").is(":checked")&&!this.hasEmptyCdrom())return!0}else{if((this.$("#mount-ngt").is(":checked")&&!this.$("#mount-vmgt").is(":checked")||!this.$("#mount-ngt").is(":checked")&&this.$("#mount-vmgt").is(":checked"))&&!this.hasEmptyCdrom())return!0;if(this.$("#mount-ngt").is(":checked")&&this.$("#mount-vmgt").is(":checked")&&e.length<2)return!0}return!1},onUnmountClick:function(e){e.preventDefault();var t=this,n=this.getAcropolisDiskModel();n.set(n.DP.IS_EMPTY,!0),n.vmName=this.model.getName(),n.vmId=this.vmId,n.actionMode=d.ACTION_UPDATE,this._showModalLoader(n),n.save(null,{success:function(){t._hideModalLoader(),t.clearHeader(),t.$(".btnUpdate").prop("disabled",!1)},error:function(e,n){t._hideModalLoader(),t.showHeaderError(p.processAjaxError(n.responseText))}})},_showModalLoader:function(e){var t=e.actionMode;$.nutanixConfirm({msg:e.getLatencyMessage(t),yes:function(){},yesText:"Yes",hideNo:!0,hideYes:!0,context:this})},_hideModalLoader:function(){$("#nutanixConfirmModal").modal("hide"),$(".modal-backdrop").removeClass("popupfadeAll"),$("body").removeClass("n-confirm-show"),$("#globalModalContainer  #nutanixConfirmModal").remove()},mountNgt:function(e){var t=new v;return t.setVmId(e),t.save()},unmountNgt:function(e){var t=new g;return t.setVmId(e),t.save()},destroy:function(){this.$(".flr-info").tooltip("destroy"),this.$(".vss-info").tooltip("destroy"),this.$(".power-off-vmgt-tooltip").tooltip("destroy"),e.prototype.destroy.apply(this,arguments)},enableNgt:function(e,t,n,i,s,a){new f({vmId:e,enabled:!0,applications:{file_level_restore:t,vss_snapshot:n},oldAppState:{file_level_restore:i,vss_snapshot:s,ngt_enabled:a}}).save()},disableNgt:function(e){new f({
vmId:e,enabled:!1}).save()},mountVmgt:function(){new E({uuid:this.model.get(a.UUID)}).save()},unmountVmgt:function(){new E({uuid:this.model.get(a.UUID),operation:d.ACTION_UNMOUNT}).save()}},{DP:m})}),define("models/imageservice/AcropolisImageModel",["models/AcropolisModel","data/DataURLConstants","data/DataProperties","data/DataManager","managers/IdleManager","models/task/AcropolisTaskModel","utils/AppConstants","utils/AppUtil"],function(e,t,n,i,s,a,o,r){"use strict";var l={ANNOTATION:"annotation",IMAGE_TYPE:"imageType",CONTAINER_ID:"containerId",VMDISK_ID:"vmDiskId",CREATE_TIME:"createTimeUsecs",UPDATE_TIME:"updateTimeUsecs",IMAGE_STATE:"imageState",IMAGE_IMPORT_SPEC:"imageImportSpec",VM_DISK_CLONE_SPEC:"vmDiskCloneSpec",LOGICAL_TIMESTAMP:"logicalTimestamp",vmDiskSpecClone:{MINIMUM_SIZE:"minimumSize",IMAGE_PATH:"imagePath"},VM_DISK_SIZE:"vmDiskSize",imageImportSpec:{CHECKSUM:"checksum",URL:"url",CONTAINER_ID:"containerId",CHECKSUM_TYPE:"checksumType",CONTAINER_UUID:"containerUuid"}},c={DISK_IMAGE:"DISK_IMAGE",ISO_IMAGE:"ISO_IMAGE"};return e.extend({DP:l,IMAGE_TYPES:c,idAttribute:n.UUID,nameAttribute:n.NAME,containerId:null,imageBinary:null,urlRoot:t.MGMT_IMAGE,name:"AcropolisImageModel",entityType:o.ENTITY_ACROPOLIS_IMAGE,isActive:function(){return this.get(l.IMAGE_STATE)===o.IMAGE_STATE.ACTIVE},setMessage:function(e){e=e||this.actionMode,this.msg.action=o.ACTION_NAMES[e].toLowerCase(),this.msg.entityMsg=this.entityMsg,this.msg.entityType=o.ENTITY_NAMES[o.ENTITY_ACROPOLIS_IMAGE],this.msg.entityName=this.get(this.nameAttribute),this.msg.suppressLink=!0},getVmDiskCloneSpecAttr:function(e){var t=this.get(l.VM_DISK_CLONE_SPEC);if(t)return t[e]},getImportImageSpecAttr:function(e){var t=this.get(l.IMAGE_IMPORT_SPEC);if(t)return t[e]},getURL:function(){return this.url()},toJSON:function(t){var n,i,s=(l[l.IMAGE_IMPORT_SPEC],this);n=_.some(l[l.VM_DISK_CLONE_SPEC],function(e){return!_.isEmpty(s.getVmDiskCloneSpecAttr(e))}),i=_.some(l[l.IMAGE_IMPORT_SPEC],function(e){return!_.isEmpty(s.getImportImageSpecAttr(e))});var a=e.prototype.toJSON.apply(this,arguments);return n||delete a[l.VM_DISK_CLONE_SPEC],i||delete a[l.IMAGE_IMPORT_SPEC],this.get(l.CHECKSUM)&&(a[l.CHECKSUM]=this.get(l.CHECKSUM)),this.get(l.CHECKSUM_TYPE)&&(a[l.CHECKSUM_TYPE]=this.get(l.CHECKSUM_TYPE)),a},abort:function(){r.abortXHRRequest(this.uploadXHR)},save:function(c,d){function p(){(new(e.extend({onTaskFailed:function(e){d.error(e.getMetaResponseAttr(a.DP.ERROR_DETAIL)),d.always()},onTaskSucceeded:function(e){m=e.get(e.DP.ENTITY_LIST)[0][n.UUID],f.imageUuid=m,u()},onPollingTimedOut:function(){this.onPollingError()},onPollingError:function(e){v<o.TASK_POLLING_MAX_FAIL_RETRY&&_.delay(p,o.TASK_PROGRESS_ACTIVE_INTERVAL),v++},onTaskInProgress:function(e){if(s.reset(),e.get(a.DP.PROGRESS_STATUS)===a.TASK_STATUS.RUNNING){var t=e.get(a.DP.PERCENTAGE_COMPLETE);d.progress("Uploading file "+(t?t+"%":""),t)}v=0,_.delay(p,o.TASK_PROGRESS_ACTIVE_INTERVAL)}}))).pollTask(h,!0)}function u(){var e,n=(l[l.IMAGE_IMPORT_SPEC],f.get(l.IMAGE_IMPORT_SPEC),f.containerId),s=f.imageBinary;if(!f.imageBinary)return d.success(),void d.always();d.progress("Uploading file..."),e=i.getNutanixApiDataSourceURL()+_.template(t.MGMT_IMAGE_UPLOAD,{id:m}),f.uploadXHR=$.ajax({type:"PUT",url:e,data:s,cache:!1,contentType:"application/octet-stream",processData:!1,headers:{"X-Nutanix-Destination-Container":n},xhr:function(){var e=$.ajaxSettings.xhr();return e.upload&&e.upload.addEventListener("progress",function(e){if(e.lengthComputable){var t=100*e.loaded/e.total;d.progress("Uploading file "+t.toFixed(1)+"%",t)}},!1),e}}).done(function(e){d.success(),d.always()}).fail(function(e,t,n){var i=r.processAjaxError(e.responseText);d.error(i),d.always()})}var h,m,f=this,v=0;return function(){return f.actionMode===o.ACTION_UPDATE?d.progress("Updating image..."):d.progress("Creating image..."),e.prototype.save.call(f,c,{success:function(e,t){if(h=t.taskUuid,!f.imageBinary)return d.success(),void d.always();p()},error:function(e,t){d.error(t.responseText||t),d.always()}})}()}},{DP:l,IMAGE_TYPES:c})}),define("models/imageservice/AcropolisImageCollection",["models/PollingCollection","models/imageservice/AcropolisImageModel","data/DataManager","data/DataURLConstants","data/DataProperties"],function(e,t,n,i,s){"use strict";return e.extend({model:t,url:i.MGMT_IMAGE+"?includeVmDiskSizes=true",name:"AcropolisImageCollection",getDataSourceURL:function(){return n.getNutanixApiDataSourceURL()},comparator:function(e){return(e.get(s.NAME)||"").toLowerCase()}})}),define("models/storage/AcropolisDiskCollection",["models/PollingCollection","models/storage/AcropolisDiskModel"],function(e,t){"use strict";return e.extend({model:t,name:"AcropolisDiskCollection",toJSON:function(e){var n={};return n[t.DP.DISKS]=[],this.each(function(e){e.actionMode=this.actionMode;var i=e.toJSON();n[t.DP.DISKS]=n[t.DP.DISKS].concat(i[t.DP.DISKS])},this),n},sortByDiskAddress:function(){var e=this.models;return e.sort(function(e,n){var i=e.get(t.DP.DISK_ADDRESS),s=n.get(t.DP.DISK_ADDRESS);return i[t.DP.BUS_TYPE]===s[t.DP.BUS_TYPE]?i[t.DP.DEVICE_INDEX]-s[t.DP.DEVICE_INDEX]:i[t.DP.BUS_TYPE].localeCompare(s[t.DP.BUS_TYPE])}),e}})}),define("models/storage/AcropolisVdiskModel",["models/AcropolisModel","data/DataURLConstants","utils/AppConstants"],function(e,t,n){"use strict";var i={NAME:"name"};return e.extend({DP:i,urlRoot:t.MGMT_VDISKS,entityType:n.ENTITY_VDISK,name:"AcropolisVdiskModel"},{DP:i})}),define("models/storage/AcropolisVdiskCollection",["data/DataURLConstants","data/DataManager","models/PollingCollection","models/storage/AcropolisVdiskModel"],function(e,t,n,i){"use strict";return n.extend({model:i,url:e.MGMT_VDISKS,name:"AcropolisVdiskCollection",getFiles:function(){var e=this.map(function(e){return e.get("filePath")});return _.filter(e,function(e){return e})},getDataSourceURL:function(){return t.getNutanixApiDataSourceURL()}})}),define("models/volumegroup/AcropolisVolumeGroupCollection",["models/PollingCollection","models/volumegroup/AcropolisVolumeGroupModel","data/DataManager","data/DataURLConstants"],function(e,t,n,i){"use strict";return e.extend({model:t,url:i.MGMT_VG,name:"AcropolisVolumeGroupCollection",useV2DataSource:!0,getDataSourceURL:function(){return this.useV2DataSource?n.getV2DataSourceURL():n.getNutanixApiDataSourceURL()+"/"}})}),define("text!templates/popups/vm/VmHostAffinityView.html",[],function(){return'<section data-ntnx-section class="vm-affinity-form">\n  <h5 data-ntnx-title>\n    Select Hosts\n  </h5>\n  <section data-ntnx-section="type-text">\n    Select more than one host to ensure that the VM can be run even if there\n    is a node failure.\n  </section>\n  <section data-ntnx-section class="hostList host-list">\n    \x3c!-- @view: Hosts list and info appear here --\x3e\n  </section>\n</section>'}),define("views/popups/vm/VmHostAffinityView",["views/basecomponents/BaseSubView","data/DataProperties","text!templates/popups/vm/VmHostAffinityView.html"],function(e,t,n){"use strict";var i=_.template(n),s=_.template('<section data-ntnx-section="type-third" class="host-ctr"><div class="host <%= current ? \'selected\' : \'\' %> <%= pinned ? \'selected\' : \'\' %>" data-id="<%= id %>" title="<%= name %>" data-icon="G"><%= name %></div></section>');return e.extend({el:"#vmAffinityWrapper",events:{"click .host":"onHostClick"},render:function(){this.clearBaseHeader(),this.$el.html(i()),this.renderHosts()},renderHosts:function(){var e=this.parentView.vmAffineHostCollection.map(function(e){return e.get(t.UUID)}),n=this.parentView.model.getPoweredOnHostUuid(),i="";this.parentView.hostCollection.each(function(a){var o=a.get(t.UUID);i+=s({pinned:_.indexOf(e,o)>=0,name:a.get(t.NAME),id:o,current:o===n,hasPinned:!1})}),this.$(".hostList").html(i)},getSelectedHosts:function(){var e=this,t=[];return this.$(".host.selected").each(function(n){var i=$(this).attr("data-id"),s=e.parentView.hostCollection.findModelByUuid(i);t.push(s)}),t},onHostClick:function(e){var t=this.$(e.currentTarget);t.hasClass("disabled")||t.toggleClass("selected")}})}),define("text!templates/popups/vm/GpuListView.html",[],function(){return"<section class=\"vm-gpu-form\">\n  <section data-ntnx-section>\n    <label data-ntnx-label>\n      <%= i18n('gpu_type_title') %>\n    </label>\n    <div data-ntnx-form-inline>\n      <%= Components.radio({\n        name   : 'gpuType',\n        classes: 'gpu-type-radio',\n        value  : GPU_SECTION.VGPU\n      }) %>\n      <label data-ntnx-inline-label>\n        <%= i18n('vgpu') %>\n      </label>\n      <%= Components.radio({\n        name   : 'gpuType',\n        classes: 'gpu-type-radio',\n        value  : GPU_SECTION.PASSTHRU\n      }) %>\n      <label data-ntnx-inline-label>\n        <%= i18n('passthrough') %>\n      </label>\n    </div>\n  </section>\n\n  <section class=\"gpu-group vgpu-section\">\n    <section data-ntnx-section>\n      <label data-ntnx-label>\n        <%= i18n('license_type_title') %>\n        <span class=\"license-type-tooltip\">\n        </span>\n      </label>\n      <%= Components.select({\n        jsClasses: 'vGpuLicenseType'\n      }) %>\n    </section>\n    <section data-ntnx-section>\n      <label data-ntnx-label>\n        <%= i18n('vgpu_profile_title') %>\n      </label>\n      <section data-ntnx-section=\"type-subtitle\">\n        <%= i18n('vgpu_profile_description') %>\n      </section>\n      <section data-ntnx-section class=\"gpu-list\">\n        \x3c!--vGPU list goes here --\x3e\n      </section>\n    </section>\n  </section>\n\n  <section class=\"gpu-group pgpu-section\">\n    <section data-ntnx-section>\n      <label data-ntnx-label>\n        <%= i18n('pgpu_title') %>\n      </label>\n      <section data-ntnx-section=\"type-subtitle\">\n        <%= i18n('pgpu_description') %>\n      </section>\n      <section data-ntnx-section>\n        <table class=\"table table-hover\"\n               data-test=\"gpulistview_table_gpus\">\n          <thead>\n            <tr>\n              <th><%= i18n('type') %></th>\n              <th><%= i18n('count') %></th>\n              <th><%= i18n('status') %></th>\n              <th>&nbsp;</th>\n            </tr>\n          </thead>\n          <tbody>\n            <% if (pGpus && pGpus.length) { %>\n              <% _.each(pGpus, function (gpu) { %>\n                <tr>\n                  <td>\n                    <span>\n                      <%= Components.radio({\n                        name   : 'gpu',\n                        classes: 'gpu-radio',\n                        value  : gpu.id\n                      }) %>\n                    </span>\n                    <span><%= gpu.name %></span>\n                  </td>\n                  <td>\n                    <%= gpu.count %>\n                  </td>\n                  <td>\n                    <%= gpu.status %>\n                  </td>\n                  <td>\n                    <% if (gpu.showInfoIcon) { %>\n                      <div class=\"warning-icon\">\n                        <%= Components.icon('Exclamation_Mark', '-inline -micro') %>\n                      </div>\n                    <% } %>\n                  </td>\n                </tr>\n              <% }) %>\n            <% } else { %>\n              <tr>\n                <td><%= i18n('noGpu') %></td>\n              </tr>\n            <% } %>\n          </tbody>\n        </table>\n      </section>\n    </section>\n  </section>\n</section>"}),define("text!templates/popups/vm/VGpuListView.html",[],function(){return"<table class=\"table table-hover\" data-test=\"vgpulistview_table_gpus\">\n  <thead>\n    <tr>\n      <th><%= i18n('name') %></th>\n      <th>&nbsp;</th>\n      <th>\n        <%= i18n('virtual_slice') %>\n        <span class=\"fraction-tooltip\">\n        </span>\n      </th>\n      <th><%= i18n('framebuffer') %></th>\n      <th><%= i18n('vms_assigned') %></th>\n      <th><%= i18n('details') %></th>\n    </tr>\n  </thead>\n  <tbody>\n    <% if (vGpus && vGpus.length) { %>\n      <% _.each(vGpus, function (gpu) { %>\n        <tr>\n          <td>\n            <span>\n              <%= Components.radio({\n                name   : 'gpu',\n                classes: 'gpu-radio',\n                value  : gpu.id\n              }) %>\n            </span>\n            <span><%= gpu.name %></span>\n          </td>\n          <td>\n            <% if (gpu.showInfoIcon) { %>\n              <span class=\"warning-icon\">\n                <%= Components.icon('Exclamation_Mark', '-inline -micro') %>\n              </span>\n            <% } %>\n          </td>\n          <td>\n            <%= gpu.fraction %>\n          </td>\n          <td>\n            <%= gpu.framebuffer %>\n          </td>\n          <td>\n            <%= gpu.vm_assigned %>\n          </td>\n          <td>\n            <span class=\"vgpu-tooltip\" display-head=\"<%= gpu.display_head %>\"\n              resolution=\"<%= gpu.resolution %>\">\n            </span>\n          </td>\n        </tr>\n      <% }) %>\n    <% } else { %>\n      <tr>\n        <td><%= i18n('noGpu') %></td>\n      </tr>\n    <% } %>\n  </tbody>\n</table>"}),define("views/popups/vm/GpuSelectView",["views/basecomponents/BaseSubView","models/gpu/GpuModel","utils/GpuUtil","utils/StatsUtil","data/DataProperties","text!templates/popups/vm/GpuListView.html","text!templates/popups/vm/VGpuListView.html"],function(e,t,n,i,s,a,o){"use strict";var r=_.template(a),l=_.template(o),c=_.template('<% _.each(licenseTypes, function (licenseType) { %>\n        <option value="<%= licenseType %>"><%= licenseType %></option>\n      <% }) %>');return e.extend({GPU_SECTION:{VGPU:"vGPU",PASSTHRU:"Passthrough"},el:"#vmGpuWrapper",name:"GpuSelectView",vGpuProfileCollection:null,pGpuCollection:null,events:{'click input[name="gpuType"]:radio':"onGpuTypeSelect","change select.vGpuLicenseType":"onLicenseTypeSelect",'click input[name="gpu"]':"onGpuSelect"},initialize:function(t){e.prototype.initialize.apply(this,arguments),this.vGpuProfileCollection=t&&t.vGpuProfileCollection,this.pGpuCollection=t&&t.pGpuCollection},render:function(){this.clearBaseHeader(),this.parentView.enableSaveButton(!1),this.getPassthroughGpus(),this.$el.html(r(this.vtOptions({pGpus:this.pGpus,GPU_SECTION:this.GPU_SECTION}))),this.parentView.vmGpuCollection.hasPgpu()||!this.parentView.isVirtualGpuSupported()?(this.$('input[name="gpuType"][value="Passthrough"]').click(),this.$('input[name="gpuType"][value="vGPU"]').attr("disabled",!0)):(this.$('input[name="gpuType"][value="vGPU"]').click(),this.getVirtualGpus(),this._renderLicenseTypes(),this.$("select.vGpuLicenseType").change())},getPassthroughGpus:function(){this.pGpus=[],this.pGpuCollection.each(function(e){var i=e.get(t.DP.GPU_CONFIG);this.pGpus.push({id:n.getGpuIdentifier(i,t.DP),name:e.getGpuName(),count:e.get(t.DP.DEVICE_COUNT),status:this.i18ns("inUse",e.get(t.DP.IN_USE_COUNT),e.get(t.DP.DEVICE_COUNT)),showInfoIcon:e.isAllInUse()})},this)},getVirtualGpus:function(){this.vGpus={},this.licenseTypes=[],this.vGpuProfileCollection.populateVmsAllocated(this.pGpuCollection),_.each(this.vGpuProfileCollection.models,function(e){var t=e.getLicenseTypes();_.each(t,function(t){this.vGpus[t]||(this.vGpus[t]=[]),this.vGpus[t].push(e),this.licenseTypes.push(t)},this)},this),this.licenseTypes=_.uniq(this.licenseTypes)},_renderLicenseTypes:function(){this.$("select.vGpuLicenseType").html(c({licenseTypes:this.licenseTypes})),this.$(".license-type-tooltip").nutanixMoreInfo({title:this.i18n("licenseTypeTooltip"),placement:"top",html:!0,container:"body"})},getSelectedId:function(){return this.$('.gpu-group.active input[name="gpu"]:checked').val()},getActiveSection:function(){return this.$("input[name=gpuType]:checked").val()},showGpuWarning:function(e){var t=this.getActiveSection();t===this.GPU_SECTION.VGPU&&(this.vGpuProfileCollection.hasAssignable()?e.isAssignable()?this.clearBaseHeader():this.showHeaderWarning(this.i18n("profileNotSupported")):this.showHeaderWarning(this.i18n("allVGpusInUse"))),t===this.GPU_SECTION.PASSTHRU&&(e.isAllInUse()?this.showHeaderWarning(this.i18n("allGpusInUse")):this.clearBaseHeader())},onGpuTypeSelect:function(e,t){this.parentView.enableSaveButton(!1),this.$(".gpu-group").hide(),this.$(".gpu-group").removeClass("active");var n=e?$(e.currentTarget).val():t;n===this.GPU_SECTION.VGPU?(this.$(".vgpu-section").show(),this.$(".vgpu-section").addClass("active")):n===this.GPU_SECTION.PASSTHRU&&(this.$(".pgpu-section").show(),this.$(".pgpu-section").addClass("active"));var i=this.$('.gpu-group.active input[name="gpu"]:checked');i.length&&i.attr("checked",!1)},onLicenseTypeSelect:function(e){var a=this;this.parentView.enableSaveButton(!1);var o=$(e.currentTarget).val(),r=_.map(this.vGpus[o],function(e){var a=e.get(t.DP.GPU_CONFIG),o=e.get(t.DP.VMS_ALLOCATED),r=o?o.length:0;return{id:n.getGpuIdentifier(a,t.DP),name:a[t.DP.DEVICE_NAME],fraction:n.getFractionDisplayStr(a[t.DP.FRACTION]),framebuffer:i.statsFormat(s.STATS_GPU_FRAMEBUFFER_BYTES,a[t.DP.FRAMEBUFFER],!0),vm_assigned:r,display_head:a[t.DP.DISPLAY_HEAD],resolution:a[t.DP.RESOLUTION],showInfoIcon:!a[t.DP.ASSIGNABLE]}});this.$(".vgpu-section .gpu-list").html(l(this.vtOptions({vGpus:r}))),this.$(".fraction-tooltip").nutanixMoreInfo({title:this.i18n("fractionTooltip"),placement:"top",html:!0,container:"body"}),this.$(".vgpu-tooltip").each(function(){var e=$(this).attr("display-head"),t=$(this).attr("resolution"),n=a.i18ns("vGpuTooltip",e,t);$(this).nutanixMoreInfo({title:n,placement:"top",html:!0,container:"body"})})},onGpuSelect:function(e){var t=this.$('.gpu-group.active input[name="gpu"]:checked').val(),n=this.pGpuCollection.findModelByIdentifier(t)||this.vGpuProfileCollection.findModelByIdentifier(t);n&&(this.parentView.enableSaveButton(!0),this.showGpuWarning(n))},destroy:function(){this.$(".license-type-tooltip").nutanixMoreInfo("destroy"),this.$(".fraction-tooltip").nutanixMoreInfo("destroy"),this.$(".vgpu-tooltip").nutanixMoreInfo("destroy"),e.prototype.destroy.apply(this,arguments)}})}),define("text!templates/popups/vm/StorageFormView.html",[],function(){return'\x3c!-- VM Storage Form --\x3e\n<section id="vmStorageForm">\n\n  \x3c!-- Type --\x3e\n  <section data-ntnx-section class="sectionWrapper typeWrapper">\n    <label data-ntnx-label><%= i18n(\'label_type\') %></label>\n    <%= Components.select({\n      useBrowserSelect: true,\n      jsClasses: \'inputDiskType\',\n      attributes: \'data-class="fancy-select-top-anchor"\',\n      options: [\n        { name: \'DISK\', value: \'DISK\' },\n        { name: \'CD-ROM\', value: \'CD-ROM\' }\n      ],\n      dataTestAttribute: \'vmDiskTypeSelect\'\n    }) %>\n  </section>\n\n  \x3c!-- Operation --\x3e\n  <section data-ntnx-section class="sectionWrapper operationWrapper">\n    <label data-ntnx-label><%= i18n(\'label_operation\') %></label>\n    <section class="alternativeField hardDisk">\n      <%= Components.select({\n        useBrowserSelect: true,\n        jsClasses: \'inputDiskOperation\',\n        dataTestAttribute: \'storageformview_select_harddisk_operation\'\n      }) %>\n    </section>\n    <section class="alternativeField cdrom" style="display:none;">\n      <%= Components.select({\n        useBrowserSelect: true,\n        jsClasses: \'inputDiskOperation\',\n        dataTestAttribute: \'storageformview_select_cdrom_operation\'\n      }) %>\n    </section>\n  </section>\n\n  \x3c!-- Bus --\x3e\n  <section data-ntnx-section class="sectionWrapper busWrapper">\n    <label data-ntnx-label><%= i18n(\'label_bus_type\') %></label>\n    <%= Components.select({\n      useBrowserSelect: true,\n      jsClasses: \'busType\',\n      dataTestAttribute: \'vmBusTypeSelect\'\n    }) %>\n  </section>\n\n  <% if (!isHyperv) { %>\n  \x3c!-- Storage container --\x3e\n  <section data-ntnx-section class="sectionWrapper containerWrapper">\n    <label data-ntnx-label><%= i18n(\'label_storage_container\')%></label>\n    <%= Components.select({\n      useBrowserSelect: true,\n      jsClasses: \'container\',\n      attributes: \'data-class="fancy-select-top-anchor"\',\n      dataTestAttribute: \'vmContainerSelect\'\n    }) %>\n  </section>\n  <% } %>\n\n  \x3c!-- Name --\x3e\n  <section data-ntnx-section class="sectionWrapper nameWrapper">\n    <label data-ntnx-label><%= i18n(\'label_name\') %></label>\n    <input\n      type="text"\n      class="diskName"\n      data-test="vmDiskNameInput"\n      placeholder="Name"\n    >\n  </section>\n\n  \x3c!-- ADSF Path --\x3e\n  <section data-ntnx-section class="sectionWrapper pathWrapper" style="display:none;">\n    <label data-ntnx-label>\n      <%= isHyperv ? i18n(\'path\') : i18n(\'adsfPath\') %>\n    </label>\n    <input\n      type="text"\n      class="diskPath adsfPath"\n      data-test="vmDiskPathInput"\n    >\n  </section>\n\n  \x3c!-- Disk image --\x3e\n  <section data-ntnx-section class="sectionWrapper imageWrapper" style="display:none;">\n    <label data-ntnx-label>\n      <%= i18n(\'label_image\') %>\n      <span class="imageHelp">\n      </span>\n    </label>\n    <section class="noImageWrapper">\n      <%= isPC ? i18n(\'no_image_message_pc\') : i18n(\'no_image_message\') %>\n    </section>\n    <section class="imageSelectWrapper">\n      <%= Components.select({\n        useBrowserSelect: true,\n        jsClasses: \'image-select\',\n        attributes: \'data-class="fancy-select-bottom-anchor"\',\n        dataTestAttribute: \'vmImageSelect\'\n      }) %>\n    </section>\n  </section>\n\n  \x3c!-- Size --\x3e\n  <section data-ntnx-section class="sectionWrapper sizeWrapper">\n    <div class="disk-size-label-container">\n      <label data-ntnx-label class="disk-size-label">\n        <%= i18n(\'label_size\') %>&nbsp;(GiB)\n      </label>\n      <span class="disk-size-tooltip"></span>\n    </div>\n    <input\n      model-validate="range"\n      model-validate-args="0,<%= AppConstants.MAX_DISK_SIZE %>,3,<%= i18n(\'gb\') %>"\n      model-attribute="size"\n      model-attribute-name="<%= i18n(\'size\') %>"\n      type="text"\n      class="diskSize"\n      data-test="vmDiskSizeInput"\n    >\n    <div data-ntnx-hint class="sizeMessage" style="display: none;">\n      <% i18n("sizeMessageDefault") %>\n    </div>\n  </section>\n\n  \x3c!-- Index --\x3e\n  <section data-ntnx-section class="sectionWrapper indexWrapper">\n    <label data-ntnx-label><%= i18n(\'index\') %></label>\n     <section class="indexSelectWrapper">\n      <%= Components.select({\n        useBrowserSelect: true,\n        jsClasses: \'index-select\',\n        variants: \'bottom-anchor\',\n        dataTestAttribute: \'busIndexSelect\'\n      }) %>\n    </section>\n  </section>\n\n  \x3c!-- Enable flash mode --\x3e\n  <section data-ntnx-section class="sectionWrapper flashModeWrapper" style="display:none">\n    <div data-ntnx-form-inline>\n      <%= Components.checkbox({\n        jsClasses: \'vdiskFlashMode\',\n        id: \'vdiskFlashMode\'\n      }) %>\n      <label data-ntnx-inline-label for="vdiskFlashMode">\n        <%= i18n(\'label_flash_mode\') %>\n        <span class="vdiskFlashHelp">\n        </span>\n      </label>\n    </div>\n  </section>\n</section>\n'}),define("views/popups/vm/VmStorageFormView",["views/basecomponents/BaseSubView","data/DataProperties","models/storage/AcropolisDiskModel","utils/AppConstants","utils/AppUtil","utils/StatsUtil","utils/ValidationUtil","text!templates/popups/vm/StorageFormView.html"],function(e,t,n,i,s,a,o,r){"use strict";var l=_.template(r),c=_.template('\n    <option <%= selected ? "selected" : ""%>\n      <%= disabled ? "disabled" : "" %>\n      value="<%= value %>"><%= label %>\n    </option>\n  '),d=n.BUS_TYPES;return e.extend({name:"VmStorageFormView",IMAGE_TYPE_MAPPING:{DISK:"DISK_IMAGE","CD-ROM":"ISO_IMAGE"},events:{"change .inputDiskOperation":"onDiskOperationChange","change .inputDiskType":"onDiskTypeChange","change .image-select":"onImageSelectChange","change .busType":"onBusTypeChange","keyup  .diskSize":"onDiskSizeChange","click  .addImageLink":"onAddImageLinkClick"},setViewOption:function(e){this.$el=e.el,this.model=e.model,this.viewOptions=e},render:function(){this.$el.html(l(this.vtOptions($.extend({},this.viewOptions,{model:this.model||{}}))));var e=this.model&&this.model.getBusType()||n.BUS_TYPES.SCSI;this.populateDiskOperations(),this.populateCdRomOperations(),this.populateBusTypes(),this.populateContainers(),this.populateImages(),this.populateIndex(e),this.initData(),this.delegateEvents(),this.applyNutanixInput({types:["checkbox","select"]}),this.$(".disk-size-tooltip").nutanixMoreInfo({classes:["-nudge-up"],title:this.i18n("disk_size_info"),placement:"top",container:"body"})},populateDiskOperations:function(){var e=this.viewOptions,t=e.isHyperv,i=e.isEsx,s=this.$(".hardDisk select.inputDiskOperation"),a=[{value:n.OPERATION_TYPES.ALLOCATE,label:t?this.i18n("newDisk"):this.i18n("allocate")},{value:n.OPERATION_TYPES.CLONE,label:t?this.i18n("cloneDisk"):this.i18n("cloneAdsf")}];i||t||a.push({value:n.OPERATION_TYPES.CLONE_IMAGE,label:this.i18n("cloneImg")}),s.empty(),_.each(a,function(e){s.append(c({value:e.value,label:e.label,disabled:e.disabled,selected:e.selected}))})},populateCdRomOperations:function(){var e=this.viewOptions,t=e.isHyperv,s=e.isEsx,a=e.mode,o=this.$(".cdrom select.inputDiskOperation"),r=[],l=!0,d=!0,p=!s&&!t;if(this.model){(this.model.get(this.model.DP.IS_CDROM)?this.model.DISK_TYPES.CDROM:this.model.DISK_TYPES.DISK)===n.DISK_TYPES.CDROM&&a===i.ACTION_UPDATE&&(this.model.isEmpty()?l=!1:(d=!1,p=!1))}if(l&&r.push({value:n.OPERATION_TYPES.EMPTY,label:this.i18n("emptyCdrom")}),d){var u=this.i18n("cloneAdsf");t?u=this.i18n("cloneDisk"):s&&(u=this.i18n("mountAdsf")),r.push({value:n.OPERATION_TYPES.CLONE,label:u})}p&&r.push({value:n.OPERATION_TYPES.CLONE_IMAGE,label:this.i18n("cloneImg")}),o.empty(),_.each(r,function(e){o.append(c({value:e.value,label:e.label,disabled:e.disabled,selected:e.selected}))})},isContainerMounted:function(e){return!this.parentView.isEsx()||this.parentView.datastoreCollection.find(function(n){return n.get(t.CONTAINER_UUID)===e})},createContainerOption:function(e){var n=e.get(t.CONTAINER_UUID),i=e.get(t.NAME),s=a.storageFormat(e.getTotalAvailableLogical());return{value:n,label:i+" ("+this.i18ns("ctr_free_space",s)+")",disabled:!1,selected:!1}},populateContainers:function(){var e=this;if(!this.isHyperv){this.$("#vmStorageForm .container").empty(),this.parentView.containerCollection.each(function(n){var i=n.get(t.CONTAINER_UUID);!n.isSystemContainer()&&e.isContainerMounted(i)&&e.$("#vmStorageForm .container").append(c(e.createContainerOption(n)))})}},populateImages:function(){if(!this.viewOptions.isHyperv&&!this.viewOptions.isEsx){var e=this.$("#vmStorageForm .inputDiskType").val(),n=this.IMAGE_TYPE_MAPPING[e],s=this.parentView.imageCollection;s&&s.length&&s.find(function(e){if(e.get(e.DP.IMAGE_STATE)){var t=e.get(e.DP.IMAGE_STATE).toLowerCase(),s=e.get(e.DP.IMAGE_TYPE);return t===i.IMAGE_STATE.ACTIVE.toLowerCase()&&s===n}return!1})?(this.$("#vmStorageForm .noImageWrapper").hide(),this.$("#vmStorageForm .imageSelectWrapper").show(),this.$("#vmStorageForm .image-select").empty(),s.each(function(e){if(e.get(e.DP.IMAGE_STATE)){e.get(e.DP.IMAGE_STATE).toLowerCase()===i.IMAGE_STATE.ACTIVE.toLowerCase()&&n===e.get(e.DP.IMAGE_TYPE)&&this.$("#vmStorageForm .image-select").append(c({value:e.get(e.DP.VMDISK_ID),label:e.get(t.NAME),disabled:!1,selected:!0}))}},this),this.showDefaults()):(this.$("#vmStorageForm .noImageWrapper").show(),this.$("#vmStorageForm .imageSelectWrapper").hide()),this.parentView.enableSaveButton(!0)}},getSupportedBusTypes:function(){var e=this.viewOptions,t=e.isHyperv,i=e.isEsx;return _.filter(n.BUS_TYPES,function(e){return i?e!==n.BUS_TYPES.PCI:!t||(e===n.BUS_TYPES.IDE||e===n.BUS_TYPES.SCSI)})},populateBusTypes:function(){var e=this.viewOptions,t=e.mode,s=e.isPowerPc,a=e.isHyperv,o=this.$(".busType");if(o.empty(),_.each(this.getSupportedBusTypes(),function(e){o.append(c({value:e,label:e.toUpperCase(),disabled:!1,selected:!0}))}),a)return void(this.parentView.isSecondGenerationVm()?o.val(n.BUS_TYPES.SCSI).find('[value="'+n.BUS_TYPES.IDE+'"]').remove():this.$(".inputDiskType").val()===n.DISK_TYPES.CDROM&&o.val(n.BUS_TYPES.IDE).find('[value="'+n.BUS_TYPES.SCSI+'"]').remove());this.$(".inputDiskType").val()===n.DISK_TYPES.DISK?(t===i.ACTION_ADD&&o.val(n.BUS_TYPES.SCSI),o.find('[value="'+n.BUS_TYPES.SPAPR+'"]').remove(),s&&o.find('\n            [value="'+n.BUS_TYPES.PCI+'"],\n            [value="'+n.BUS_TYPES.IDE+'"],\n            [value="'+n.BUS_TYPES.SATA+'"]\n          ').remove()):(o.find('\n          [value="'+n.BUS_TYPES.PCI+'"],\n          [value="'+n.BUS_TYPES.SCSI+'"]\n        ').remove(),s?o.find('\n            [value="'+n.BUS_TYPES.IDE+'"],\n            [value="'+n.BUS_TYPES.SATA+'"]\n          ').remove():o.find('[value="'+n.BUS_TYPES.SPAPR+'"]').remove(),t===i.ACTION_ADD&&o.val(this.parentView.getDefaultCdromBusType()))},populateIndex:function(e){var t=this.$(".index-select");t.empty();var n=this.parentView.busDeviceTypeMap[e],i=[];this.parentView.isEsx()&&e===d.SCSI&&(i=[7]);var s=this.createIndexOptions(n,this.model,i);_.each(s,function(e){t.append(c({value:e.value,label:e.label,disabled:e.disabled,selected:e.selected}))})},createIndexOptions:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];if(!e||!e.length)return[{value:0,label:this.i18n("next_available"),disabled:!1,selected:!0}];e=_.sortBy(e,n.V2_DP.DEVICE_INDEX);for(var s=[],a=e[e.length-1][n.V2_DP.DEVICE_INDEX],o=0,r=0,l=!1,c=void 0;o<e.length&&r<=a;){var d=e[o]||{},p=d[n.V2_DP.DEVICE_INDEX];if(r===p){var u=!1;!l&&t&&t.getDiskIndex()===p&&(l=!0,u=!0),s.push({value:r,label:this.i18ns("in_use_label",r),disabled:!0,selected:u}),o++}else _.contains(i,r)||s.push({value:r,label:r});r++}for(c=a+1;_.contains(i,c);)c++;return s.push({value:c,label:this.i18n("next_available"),selected:!l}),s},onDiskTypeChange:function(e){this.populateBusTypes(),this.$(".operationWrapper .alternativeField").hide(),this.$(".inputDiskType").val()===n.DISK_TYPES.DISK?this.$(".operationWrapper .hardDisk").show():this.$(".operationWrapper .cdrom").show(),this.onDiskOperationChange(),this.populateImages(),this.populateIndex(this.getCurrentBusType())},onDiskOperationChange:function(e){var t=this.viewOptions,s=t.isEsx,a=t.isHyperv;this.$("#vmStorageForm .sectionWrapper").each(function(){$(this).hide()}),this.$(".diskSize").prop("disabled",!1),this.setDiskSizeValidationFields(0,i.MAX_DISK_SIZE),this.$(".operationWrapper").show(),this.$(".typeWrapper").show(),this.$(".busWrapper").show(),this.$(".indexWrapper").show();var o=this.$(".cdrom .inputDiskOperation");this.$(".inputDiskType").val()===n.DISK_TYPES.DISK&&(o=this.$(".hardDisk .inputDiskOperation")),o.val()===n.OPERATION_TYPES.CLONE?(this.$(".pathWrapper").show(),s||a?this.$(".sizeWrapper").hide():this.$(".inputDiskType").val()===n.DISK_TYPES.DISK&&(this.setDiskSizeValidationFields(0,i.MAX_DISK_SIZE,!1),this.$(".sizeWrapper").show())):o.val()===n.OPERATION_TYPES.CLONE_IMAGE?(this.$(".imageWrapper").show(),this.$(".diskSize").prop("disabled",!0),this.$(".sizeWrapper").show()):this.$(".inputDiskType").val()===n.DISK_TYPES.DISK&&(this.$(".containerWrapper").show(),this.$(".sizeWrapper").show(),a&&(this.$(".pathWrapper").show(),this.$(".nameWrapper").show()));var r=!0;o.val()===n.OPERATION_TYPES.CLONE_IMAGE&&0===this.parentView.imageCollection.length&&(r=!1),this.parentView.enableSaveButton(r),this.showDefaults()},onImageSelectChange:function(){var e=this.$(".cdrom .inputDiskOperation");this.$(".inputDiskType").val()===n.DISK_TYPES.DISK&&(e=this.$(".hardDisk .inputDiskOperation")),this.showDefaultDiskSize(e.val())},getCurrentBusType:function(){return $.trim(this.$(".busType").val())},onBusTypeChange:function(){this.populateIndex(this.getCurrentBusType())},showDefaults:function(){var e=this.$(".cdrom .inputDiskOperation");if(this.$(".inputDiskType").val()===n.DISK_TYPES.DISK&&(e=this.$(".hardDisk .inputDiskOperation")),
this.$(".sizeMessage").text(this.i18n("sizeMessageDefault")),e.val()!==n.OPERATION_TYPES.CLONE_IMAGE)return void this.$(".diskSize").val("");this.showDefaultDiskSize(e.val())},showDefaultDiskSize:function(e){var t=this,i=$("#vmStorageForm .image-select option").filter(":selected").val();this.parentView.imageCollection.find(function(s){return i===s.get(s.DP.VMDISK_ID)&&(e===n.OPERATION_TYPES.CLONE_IMAGE&&t.$(".sizeMessage").text(t.i18n("sizeMessageCloneImage")),t.$(".sizeMessage").show(),t.setDiskSizeInputVal(s.get(s.DP.VM_DISK_SIZE)),!0)})},disableEl:function(e){this._setElementDisabledState(e,!0)},enableEl:function(e){this._setElementDisabledState(e,!1)},initData:function(){var e=this.viewOptions,t=e.mode,a=e.isEsx;if(this.model){var o=this.model.get(this.model.DP.IS_CDROM)?this.model.DISK_TYPES.CDROM:this.model.DISK_TYPES.DISK;this.$(".inputDiskType").val(o),this.onDiskTypeChange(),o===n.DISK_TYPES.CDROM&&t===i.ACTION_UPDATE&&(this.model.isEmpty()?this.parentView.showHeaderInfo(this.i18n("emptyCDROM")):this.parentView.showHeaderInfo(this.i18n("containVirtualDisk"))),this.onDiskOperationChange(),o===n.DISK_TYPES.DISK&&t===i.ACTION_UPDATE&&this.$(".operationWrapper").hide();var r=this.model.get(this.model.DP.DISK_ADDRESS);r?this.$(".busType").val(r[this.model.DP.BUS_TYPE]):s.log("VmStorageFormView: showStorageForm: Issue obtaining  diskAddress."),this.$(".container").val(this.model.get(this.model.DP.CONTAINER_ID)),_.isUndefined(this.model.get(this.model.DP.DISK_SIZE))||this.setDiskSizeInputVal(this.model.get(this.model.DP.DISK_SIZE),t===i.ACTION_UPDATE),this.$(".diskPath").val(this.model.get(this.model.DP.SOURCE_IMAGE)),this.$(".image-select").val(this.model.get(this.model.DP.SOURCE_VMDISK_UUID)),t===i.ACTION_UPDATE&&(this.disableEl(this.$(".inputDiskType, .container, .index-select")),this.$(".sizeMessage").show(),this.model.get(n.DP.IS_CDROM)||this.disableEl(this.$(".inputDiskOperation")),this.parentView.isActionCreate()||this.disableEl(this.$(".busType")),this.parentView.model.isFlashModeEnabled()&&o===this.model.DISK_TYPES.DISK&&this.model.get(this.model.idAttribute)&&(this.$(".flashModeWrapper").show(),this.$(".vdiskFlashMode").prop("checked",this.model.get(n.DP.ENABLE_FLASH_MODE)),this.$(".vdiskFlashHelp").nutanixMoreInfo({container:"body",title:this.i18n("flashModeMsg")}))),!this.parentView.isActionCreate()&&a&&this.disableEl(this.$(".inputDiskType, .busType, .container, .diskSize"))}else this.onDiskTypeChange(),this.onDiskOperationChange()},onDiskSizeChange:function(e){if(this.$(".inputDiskOperation").val()===n.OPERATION_TYPES.ALLOCATE){var t=a.convertToBytes(parseFloat($(".diskSize").val()||0)),i=this.parentView.containerCollection.findModelByUuid(this.$(".container").val());if(i){t-(this.model&&this.model.get(this.model.DP.DISK_SIZE)||0)>parseInt(i.getTotalAvailableLogical(),10)?this.parentView.showHeaderInfo(this.i18n("vDiskSizeWarning")):this.parentView.clearHeader()}}},onAddImageLinkClick:function(e){this.parentView.onAddImageLinkClick(e)},validateForm:function(){var e=this.$el;if(e.find(".sizeWrapper").is(":visible")){var t=o.validateFormValues(e);if(t.length){return o.defaultErrorHandler(e,t)}}return!1},getData:function(){var e={};e[n.DP.DISK_ADDRESS]={},e[n.DP.DISK_ADDRESS][n.DP.BUS_TYPE]=this.$(".busType").val(),e[n.DP.IS_CDROM]=this.$(".inputDiskType").val()===n.DISK_TYPES.CDROM,e[n.DP.DISK_ADDRESS][n.DP.DEVICE_INDEX]=parseInt($.trim(this.$(".index-select").val()),10);var t=null;this.$(".diskPath").is(":visible")?t=this.$(".diskPath").val().trim():e[n.DP.DISK_PATH]=null,this.$(".container").is(":visible")&&(e[n.DP.CONTAINER_ID]=this.$(".container").val()),this.$(".image-select").is(":visible")?e[n.DP.IMAGE_ID]=this.$(".image-select").val():e[n.DP.IMAGE_ID]=null,this.$(".diskSize").is(":visible")&&(e[n.DP.DISK_SIZE]=isNaN(this.$(".diskSize").val().trim())?this.$(".diskSize").val().trim():Math.ceil(a.convertToBytes(this.$(".diskSize").val().trim(),a.UOM_GIB,!1))),this.$(".operationWrapper .cdrom").is(":visible")&&(e[n.DP.IS_EMPTY]=this.$(".cdrom .inputDiskOperation").val()===n.OPERATION_TYPES.EMPTY),this.$(".flashModeWrapper").is(":visible")&&(e[n.DP.ENABLE_FLASH_MODE]=this.$(".vdiskFlashMode").is(":checked"));var s=this.$(".diskName");if(s.is(":visible")){var o=(s.val()||"").trim(),r="";"/"!==t.charAt(t.length-1)&&"/"!==o.charAt(0)&&(r="/");var l=""+t+r+o;this.viewOptions.mode===i.ACTION_ADD?e[n.DP.NEW_DISK_PATH]=l:e[n.DP.DISK_PATH]=l}else t&&(e[n.DP.DISK_PATH]=t);return e},setDiskSizeInputVal:function(e,t){var n=a.convertBytesToGiB(e,4);this.$(".diskSize").val(n),t&&this.setDiskSizeValidationFields(n,i.MAX_DISK_SIZE)},setDiskSizeValidationFields:function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];e>0?this.$(".diskSize").attr(i.FORM_SELECTORS.VALIDATE_MODEL_ARGS,[e,t,1,this.i18n("gb"),n]):this.$(".diskSize").attr(i.FORM_SELECTORS.VALIDATE_MODEL_ARGS,[e,t,3,this.i18n("gb"),n])},_setElementDisabledState:function(e,t){e&&e.each(function(e,n){var i=$(n);t?(i.attr("disabled",!0),i.closest(".select-wrapper").addClass("disabled")):(i.removeAttr("disabled"),i.closest(".select-wrapper").removeClass("disabled"))})}})}),define("text!templates/popups/vm/NicFormView.html",[],function(){return"\x3c!-- VM Network Form --\x3e\n<section id=\"vmNetworkForm\">\n  <section data-ntnx-section>\n    <label data-ntnx-label>\n      <%= isHyperv ? i18n('vswitch') : 'VLAN Name' %>\n    </label>\n    <% if (isHyperv) { %>\n      <%= Components.select({\n        jsClasses: 'vswitch-select',\n        useBrowserSelect: true,\n        options: vSwitchOptions,\n        disabled: editMode,\n        dataTestAttribute: 'vmNicSwitchSelect'\n      }) %>\n    <% } else { %>\n      <%= Components.select({\n        jsClasses: 'vlans',\n        useBrowserSelect: true,\n        disabled: mode === AppConstants.ACTION_UPDATE,\n        dataTestAttribute: 'vmVlanSelect'\n      }) %>\n    <% } %>\n  </section>\n\n  <% if (isEsx) { %>\n    <section data-ntnx-section>\n      <label data-ntnx-label>\n        Network Adapter Type\n      </label>\n      <%= Components.select({\n        jsClasses: 'adapterType',\n        useBrowserSelect: true,\n        disabled: editMode,\n        options: [\n          { name: 'E1000e', value: 'E1000e' },\n          { name: 'E1000', value: 'E1000' },\n          { name: 'PCnet32', value: 'PCNet32' },\n          { name: 'VMXNET', value: 'Vmxnet' },\n          { name: 'VMXNET 2', value: 'Vmxnet2' },\n          { name: 'VMXNET 3', value: 'Vmxnet3' }\n        ],\n        dataTestAttribute: 'vmNetworkAdapterType'\n      }) %>\n    </section>\n  <% } else { %>\n    <section data-ntnx-section>\n      <label data-ntnx-label>\n        VLAN ID\n      </label>\n      <% if (isHyperv && !editMode) { %>\n        <input type=\"text\" class=\"vlan-id\" data-test=\"vmVlanId\">\n      <% } else { %>\n        <p class=\"vlan-id-val\" data-test=\"vmVlanID\">\n        </p>\n      <% } %>\n    </section>\n  <% } %>\n\n  <% if (editMode && !isHyperv) { %>\n    <section data-ntnx-section>\n      <label data-ntnx-label>\n        MAC Address\n      </label>\n      <input type=\"text\" class=\"mac-input\" <%= editMode ? \"disabled\" : \"\" %>\n        data-test=\"vmMacInput\"/>\n    </section>\n  <% } %>\n\n  <% if (isNicDisconnectSupported) { %>\n    <section data-ntnx-section>\n      <label data-ntnx-label>\n        <%= i18n('networkConnection') %>\n      </label>\n      <div>\n        <%= Components.radio({\n          id        : 'network-connection-connected',\n          name      : 'change-nic-state-group',\n          jsClasses : 'change-connection',\n          value     : 'connected',\n          labelText : i18n('connected')\n          })\n        %>\n      </div>\n      <div>\n        <%= Components.radio({\n          id        : 'network-connection-dis-connected',\n          name      : 'change-nic-state-group',\n          jsClasses : 'change-connection',\n          value     : 'dis_connected',\n          labelText : i18n('dis_connected')\n          })\n        %>\n      </div>\n    </section>\n  <% } %>\n\n  <% if (!isHyperv) { %>\n\n    <section data-ntnx-section>\n      <label data-ntnx-label>\n        Network address / prefix\n      </label>\n      <p class=\"networkAddyVal\" data-test=\"vmNetworkAddy\">\n        NONE\n      </p>\n    </section>\n\n    <section data-ntnx-section class=\"ip-add-control\">\n      <label data-ntnx-label>\n        IP address\n        <span class=\"ip-help\">\n        </span>\n      </label>\n      <input type=\"text\" class=\"control-iptext\"\n        <%= editMode ? \"disabled\" : \"\" %> data-test=\"vmIpInput\"/>\n    </section>\n\n    <% } %>\n</section>"}),define("views/popups/vm/VmNicFormView",["views/basecomponents/popups/BasePopupSubView","models/network/AcropolisNicModel","utils/AppConstants","utils/AppUtil","data/DataProperties","text!templates/popups/vm/NicFormView.html"],function(e,t,n,i,s,a){"use strict";var o=_.template(a),r=_.template('<option vlanid="<%= vlanid %>" value="<%= value %>"><%= label %></option>'),l={CONNECTED:"connected",DIS_CONNECTED:"dis_connected"};return e.extend({name:"VmNicFormView",events:{"change .vlans":"onVlansChange"},setViewOption:function(e){this.$el=e.el,this.model=e.model,this.networkLinkTemplate=e.networkLinkTemplate,this.viewOptions=e,this.mode=e.mode},render:function(){var e=[];this.viewOptions.isHyperv&&(e=this.parentView.networkCollection.map(function(e){return{value:e.get(s.UUID),name:e.get(s.NAME)}})),this.$el.html(o(this.vtOptions($.extend({},this.viewOptions,{model:this.model||{},vSwitchOptions:e,editMode:this.mode===n.ACTION_UPDATE})))),this.initData(),this.delegateEvents(),this.applyNutanixInput({types:["checkbox","select"]})},populateNetworks:function(){var e=this.parentView.networkCollection.setSortStrategy("displayName").filter(function(e){return!e.isInternal()}).map(function(e){return r({vlanid:e.getVlanId()||"",value:e.get(e.idAttribute),label:e.getDisplayName()||e.getDisplayVlanId()})}).join();this.$("#vmNetworkForm .vlans").html(e),this.parentView.networkCollection.setSortStrategy("default")},renderCreateNetworkLink:function(){var e=this.networkLinkTemplate({title:this.i18n("addNetwork"),actionAttributes:i.createActionAttr(n.ENTITY_ACROPOLIS_NETWORK,n.ACTION_SHOW)}),t=this.hypervisorType!==n.HYPERVISOR_TYPE.ESXI;this.parentView.showHeaderInfo(this.i18n("addNetworkHeaderMsg")+(t?"<br/>"+e:""))},showDetailsForNetwork:function(e){var t=this.parentView.getNetworkModel(e);if(t){this.$("#vmNetworkForm .vlan-id-val").html(t.getDisplayVlanId()||"");var i=t.getNetworkAddressWithPrefix()||"NONE";if(this.$("#vmNetworkForm .networkAddyVal").html(i),t.isManagedNetwork()){var s=t.getIpPool();this.$("#vmNetworkForm .ip-add-control .control-iptext").attr("data-required",!s||0===s.length),this.$("#vmNetworkForm .ip-add-control").show()}else this.$("#vmNetworkForm .ip-add-control").hide();this.triggerAction(n.MODAL.ACT.AS_REBUILD)}},onVlansChange:function(e){var t=$(e.currentTarget).attr("value");this.showDetailsForNetwork(t)},initData:function(){if(this.viewOptions.isHyperv)return void this.parentView.enableSaveButton(!0);this.parentView.networkCollection&&this.parentView.networkCollection.length>0?(this.populateNetworks(),this.parentView.enableSaveButton(!0)):(this.renderCreateNetworkLink(),this.parentView.enableSaveButton(!1));var e=this.$("#vmNetworkForm");if(e.find(".ip-add-control").hide(),this.model){e.find(".mac-input").val(this.model.getMacAddress());this.model.getNicConnectionState()?e.find('.change-connection[value=\n            "'+l.CONNECTED+'"]').prop("checked",!0):e.find('.change-connection[value=\n            "'+l.DIS_CONNECTED+'"]').prop("checked",!0);var t=this.parentView.getNetworkModel(this.model.get(this.model.DP.NETWORK_UUID));if(!t)return void this.showHeaderError(this.i18n("errorNicForm"));e.find(".vlans").val(t.getUuid()),e.find(".control-iptext").val(this.model.get(this.model.DP.REQ_IP_ADDRESS))}else e.find('.change-connection[value=\n          "'+l.CONNECTED+'"]').prop("checked",!0);var n=e.find(".vlans").attr("value");n&&this.showDetailsForNetwork(n),e.find(".ip-help").nutanixMoreInfo({title:this.i18n("ipHelpMsg"),placement:"right",html:!1})},validateForm:function(){var e=this.$("#vmNetworkForm .vlans").val();if(!this.viewOptions.isHyperv&&!e)return this.i18n("vlanIdReqd");var t=this.$("#vmNetworkForm .control-iptext"),n=(t.val()||"").trim();return t.is(":visible")&&"true"===t.attr("data-required")&&!n?this.i18n("ipReqd"):!(!n||(n=i.strToLongIP(n),!isNaN(n)))&&this.i18n("invalidIp")},getData:function(){var e={};e[t.DP.NETWORK_UUID]=this.$(".vlans").val(),e[t.DP.VLAN_ID]=this.$(".vlans option:selected").attr("vlanid"),e[t.DP.MAC_ADDRESS]=this.$(".mac-input").val(),e[t.DP.REQ_IP_ADDRESS]=this.$("#vmNetworkForm .control-iptext").val();var n=this.$("select.adapterType");n.length&&(e[t.DP.ADAPTER_TYPE]=n.val());var i=this.$(".vswitch-select");i.is(":visible")&&(e[t.DP.NETWORK_UUID]=i.val(),e[t.DP.VLAN_ID]=this.$(".vlan-id").val());var s=this.$(".change-connection:checked").val();return e[t.DP.IS_CONNECTED]=s===l.CONNECTED,e}})}),define("text!templates/popups/vm/VmContentView.html",[],function(){return'<div data-ntnx-content-inner id="vmMainPage" style="display: none">\n\n  <% var sDisabled = canModify ? \'\' : \'disabled\' ; %>\n\n  \x3c!-- General configuration --\x3e\n  <section data-ntnx-section class="generalConfig general-config">\n    <h5 data-ntnx-title>\n      General Configuration\n    </h5>\n    <section class="nameGroup name-group">\n      <section data-ntnx-section class="clone-count-group">\n        <label data-ntnx-label>\n          Number of Clones\n        </label>\n        <input\n          type="number"\n          class="inputCloneCount"\n          value="1"\n          min="1"\n        >\n      </section>\n      <section data-ntnx-section>\n        <label data-ntnx-label class="name-label">\n          Name\n        </label>\n        <label data-ntnx-label class="prefix-name-label">\n          Prefix Name\n        </label>\n        <span id="labelAlertVmName" class="label-alert"></span>\n        <input\n          type="text"\n          data-test="vmcontentview_input_name"\n          class="inputName"\n          placeholder="Name"\n          <%= sDisabled %>\n        >\n      </section>\n      <section data-ntnx-section class="suffix-group">\n        <label data-ntnx-label>\n          Starting Index Number\n        </label>\n        <input\n          type="number"\n          class="inputSuffix"\n          value="1"\n        >\n        <div data-ntnx-hint class="cloneExample">\n          Example\n        </div>\n      </section>\n    </section>\n    <section data-ntnx-section class="descControls">\n      <label data-ntnx-label>\n        Description\n      </label>\n      <input\n        type="text"\n        data-test="vmDescInput"\n        class="inputDesc"\n        placeholder="Optional"\n        <%= sDisabled %>\n      >\n    </section>\n    <section data-ntnx-section class="timezoneControls">\n      \x3c!-- Timezone select dropdown populated from view --\x3e\n    </section>\n    <section data-ntnx-section class="osControls">\n      <label data-ntnx-label>\n        Guest OS\n      </label>\n      <input\n        type="text"\n        id="guestOs"\n        placeholder="Start typing for suggestions"\n      >\n    </section>\n    <section data-ntnx-section class="agentControls">\n      <%= Components.checkbox({\n        jsClasses: \'agentVm\',\n        labelText: i18n(\'agentVm\')\n      }) %>\n    </section>\n    <section data-ntnx-section class="genControls hide">\n      <label data-ntnx-label>\n        <%= i18n(\'generation\') %>\n      </label>\n      <%= Components.select({\n        jsClasses: \'generation\',\n        options: generationOptions,\n        dataTestAttribute: \'gen-select\'\n      }) %>\n    </section>\n    <section data-ntnx-section class="hostControls hide">\n      <label data-ntnx-label>\n        <%= i18n(\'host\') %>\n      </label>\n      <%= Components.select({\n        jsClasses: \'host\',\n        dataTestAttribute: \'host-select\'\n      }) %>\n    </section>\n    <section data-ntnx-section class="locControls hide">\n      <label data-ntnx-label>\n        Location\n      </label>\n      <input\n        type="text"\n        id="location"\n        data-test="vmLocationInput"\n        placeholder="Start typing for suggestions"\n      >\n    </section>\n  </section>\n\n  \x3c!-- Compute details --\x3e\n  <section data-ntnx-section="type-separator">\n    <h5 data-ntnx-title>\n      Compute Details\n    </h5>\n    <section data-ntnx-section class="controlGroup" style="display:none;">\n      <label data-ntnx-label>\n        Create Time\n      </label>\n      <input\n        type="text"\n        data-test="vmSnapshotTimeInput"\n        class="inputSnapshotTime"\n      >\n    </section>\n    <section data-ntnx-section>\n      <label data-ntnx-label class="non-cap-label">\n        <%= isHyperv ? i18n(\'numProc\') : i18n(\'vcpus\') %>\n      </label>\n      <input\n        type="text"\n        data-test="vmcontentview_input_vcpus"\n        class="inputVcpus isInteger"\n        placeholder="Value"\n        <%= sDisabled %>\n      >\n      <div data-ntnx-hint class="efficiencyDetails vcpu hide">\n      </div>\n    </section>\n    <section data-ntnx-section class="coreControls">\n      <label data-ntnx-label class="non-cap-label">\n        <%= i18n(\'numCores\') %>\n      </label>\n      <input\n        type="text"\n        class="inputCores isInteger"\n        value="1"\n        <%= sDisabled %>\n      >\n    </section>\n    <section data-ntnx-section class="memory-controls">\n      <%= Components.groupInput({\n        label: i18n(\'memory\'),\n        labelToolTip: true,\n        labelToolTipClasses: \'inputMemoryTooltip\',\n        placeholder: \'Value\',\n        classes: \'inputMemory isIntegerOrFloat\',\n        disabled: !canModify,\n        unit: \'GiB\',\n        dataTestAttribute: \'vmcontentview_input_memory\'\n      }) %>\n      <div data-ntnx-hint class="efficiencyDetails memory hide">\n      </div>\n    </section>\n    <div class="dyn-mem-controls hide">\n      <%= Components.checkbox({\n        jsClasses: \'dyn-mem\',\n        labelText: \'Enable Dynamic Memory\'\n      }) %>\n    </div>\n  </section>\n\n  \x3c!-- Advanced configuration --\x3e\n  <section data-ntnx-section="type-separator" class="advConfig hide">\n    <h5 data-ntnx-title>\n      <%= Components.checkbox({\n        id: \'toggleAdv\',\n        labelText: i18n(\'advSettings\')\n      }) %>\n    </h5>\n    <section class="advConfigContents hide">\n      <section data-ntnx-section>\n        <label data-ntnx-label>\n          <%= i18n(\'autoStart\') %>\n        </label>\n        <%= Components.select({\n          jsClasses: \'autoStartAction\',\n          options: autoStartOptions,\n          dataTestAttribute: \'auto-start-select\'\n        }) %>\n      </section>\n      <section data-ntnx-section>\n        <label data-ntnx-label>\n          <%= i18n(\'autoStop\') %>\n        </label>\n        <%= Components.select({\n          jsClasses: \'autoStopAction\',\n          options: autoStopOptions,\n          dataTestAttribute: \'auto-stop-select\'\n        }) %>\n      </section>\n    </section>\n  </section>\n\n  \x3c!-- GPU Configuration --\x3e\n  <section data-ntnx-section="type-separator" class="table-config gpuConfig">\n    \x3c!-- GPU section goes here --\x3e\n  </section>\n\n  \x3c!-- Disks configuration --\x3e\n  <section data-ntnx-section="type-separator" class="table-config diskConfig">\n    \x3c!-- Disk section goes here --\x3e\n  </section>\n\n\x3c!-- Boot configuration --\x3e\n  <section data-ntnx-section="type-separator" class="form-section bootConfig">\n    <h5 data-ntnx-title>\n      <%= i18n(\'boot_config\') %>\n    </h5>\n    <div id="warning_msg"/>\n    <section data-ntnx-section class="boot">\n      <div data-ntnx-form-inline>\n        <%= Components.radio({\n          id         : \'legacy\',\n          name       : \'bootConfig\',\n          value      : \'legacy\',\n          labelText  : \'Legacy BIOS\',\n          dataTestAttribute: \'vmcontentview__radio_legacy\'\n        }) %>\n      </div>\n    </section>\n    <section data-ntnx-section class="boot-select-section">\n      <div class="boot-select">\n        <label data-ntnx-label id=\'boot-select-label\'>\n          <%= i18n(\'boot_select_priority\') %>\n        </label>\n        <div class=\'boot-select-wrapper\'></div>\n        <div data-ntnx-hint id=\'boot-select-hint\'>\n          <%= i18n(\'boot_select_hint\') %>\n        </div>\n      </div>\n    </section>\n    <section data-ntnx-section class="boot">\n      <%= Components.radio({\n        id         : \'uefi\',\n        name       : \'bootConfig\',\n        value      : \'uefi\',\n        labelText  : \'UEFI\',\n        dataTestAttribute: \'vmcontentview__radio_uefi\'\n      }) %>\n      <span id="uefiTooltip">\n        <%= Components.icon(\'information-tooltip\', \'uefi-tooltip\') %>\n      </span>\n    </section>\n  </section>\n\n  \x3c!-- Volume group configuration --\x3e\n  <section data-ntnx-section="type-separator" class="table-config volumeGroupConfig">\n    \x3c!-- Volume group section goes here --\x3e\n  </section>\n\n  \x3c!-- NIC configuration --\x3e\n  <section data-ntnx-section="type-separator" class="table-config nicConfig">\n    \x3c!-- NIC section goes here --\x3e\n  </section>\n\n  \x3c!-- Host affinity configuration --\x3e\n  <section data-ntnx-section="type-separator" class="table-config affinityConfig">\n    \x3c!-- VM-host affinity section goes here --\x3e\n  </section>\n\n  \x3c!-- Flash mode --\x3e\n  <section\n    data-ntnx-section="type-separator"\n    class="flashModeConfig"\n    style="display:none"\n  >\n    <h5 data-ntnx-title>\n      <%= Components.checkbox({\n        jsClasses: \'flashMode\',\n        labelText: \'Enable Flash Mode\'\n      }) %>\n      <span class="vmFlashHelp">\n      </span>\n    </h5>\n  </section>\n\n  \x3c!-- Custom script --\x3e\n  <section data-ntnx-section="type-separator" class="cloudInitConfig">\n    <h5 data-ntnx-title>\n      <%= Components.checkbox({\n        id: \'toggleVmCustom\',\n        labelText: \'Custom Script\'\n      }) %>\n    </h5>\n    <section id="vmCustomSection" style="display:none">\n      <section data-ntnx-section="type-subtitle">\n        Provide a Cloudinit or Sysprep script to customize this VM.\n      </section>\n      <section data-ntnx-section>\n        <label data-ntnx-label>\n          <%= Components.radio({\n            name: \'scriptSource\',\n            value: \'path\',\n            id: \'customScriptPath\',\n            labelText: \'ADSF path\',\n            checked: true,\n            dataTestAttribute: \'radioScriptPath\'\n          }) %>\n        </label>\n        <input\n          type="text"\n          class="scriptPath adsfPath"\n          data-test="scriptPath"\n          placeholder="Start typing for suggestions"\n          autocomplete="off"\n          role="textbox"\n          aria-autocomplete="list"\n          aria-haspopup="true"\n        >\n      </section>\n      <section data-ntnx-section>\n        <label data-ntnx-label>\n          <%= Components.radio({\n            name: \'scriptSource\',\n            value: \'upload\',\n            id: \'customScriptUpload\',\n            labelText: \'Upload a file\',\n            dataTestAttribute: \'radioScriptUpload\'\n          }) %>\n        </label>\n        <%= Components.fileInput({\n          classes: \'imageBinary\',\n          name: \'source\',\n          dataTestAttribute: \'vmcontentview_fileinput_customscript\'\n        }) %>\n      </section>\n      <section data-ntnx-section>\n        <label data-ntnx-label>\n          <%= Components.radio({\n            name: \'scriptSource\',\n            value: \'paste\',\n            id: \'customScriptPaste\',\n            labelText: \'Type or paste script\',\n            dataTestAttribute: \'radioScriptPaste\'\n          }) %>\n        </label>\n        <textarea\n          class="scriptPaste"\n          cols="70"\n          data-test="imageScriptPaste"\n        ></textarea>\n      </section>\n      <section data-ntnx-section>\n        <label data-ntnx-label>\n          files to copy\n        </label>\n        <p>\n          Specify external files to copy inside of the guest VM.\n        </p>\n        <section>\n          <div data-ntnx-form-inline class="pathMap pathMapNew path-map">\n            <input\n              type="text"\n              class="srcPath adsfPath"\n              placeholder="Source File ADSF Path"\n              autocomplete="off"\n              role="textbox"\n              aria-autocomplete="list"\n              aria-haspopup="true"\n            >\n            <input\n              type="text"\n              class="destPath"\n              placeholder="Destination Path in VM"\n            >\n            <%= Components.button({\n              extraClasses: \'btnAdd\',\n              iconLeft: \'plus\'\n            }) %>\n          </div>\n        </section>\n      </section>\n    </section>\n  </section>\n</div>\n\n<div data-ntnx-content-inner class="n-modal-loading">\n  <span class="n-loading-text"><%= i18n(\'loading\') %>&nbsp;</span>\n  <div class="donut-loader-blue"></div>\n</div>\n\n<div data-ntnx-content-inner id="vmNetworkFormPage"\n    style="display: none;">\n  <div id="vmNetworkFormWrapper">\n    \x3c!-- @view: network form goes here... --\x3e\n  </div>\n</div>\n\n<div data-ntnx-content-inner id="vmStorageFormPage"\n    style="display: none;">\n  <div id="vmStorageFormWrapper">\n    \x3c!-- @view: storage form goes here... --\x3e\n  </div>\n</div>\n\n<div data-ntnx-content-inner id="vmVolumeGroupFormPage"\n    style="display: none;">\n  <div id="vmVolumeGroupFormWrapper">\n    \x3c!-- @view: volume group form goes here... --\x3e\n  </div>\n</div>\n\n<div data-ntnx-content-inner id="vmMigrateFormPage"\n    style="display: none;">\n  <div id="vmMigrateFormWrapper">\n    \x3c!-- @view: migrate form goes here... --\x3e\n  </div>\n</div>\n\n<div data-ntnx-content-inner id="vmSnapshotFormPage"\n    style="display: none;">\n  <div id="vmSnapshotFormWrapper">\n    \x3c!-- @view: snapshot form goes here... --\x3e\n  </div>\n</div>\n\n<div data-ntnx-content-inner id="vmPowerStateChangeFormPage"\n    style="display: none;">\n  <div id="vmPowerStateChangeFormWrapper">\n    \x3c!-- @view: power state change form goes here... --\x3e\n  </div>\n</div>\n\n<div data-ntnx-content-inner id="vmAffinityPage" style="display:none">\n  <div id="vmAffinityWrapper">\n    \x3c!-- @view: Host-Affinity view goes here... --\x3e\n  </div>\n</div>\n\n<div data-ntnx-content-inner id="vmGpuPage" style="display:none">\n  <div id="vmGpuWrapper">\n    \x3c!-- @view: GPU list view goes here... --\x3e\n  </div>\n</div>\n'}),define("text!templates/popups/vm/MigrateFormView.html",[],function(){return"\x3c!-- VM Migrate Form --\x3e\n<section data-ntnx-section class=\"hostWrapper\">\n  <label data-ntnx-label>\n    Host\n  </label>\n  <%= Components.select({\n    jsClasses: 'migrateHost',\n    useBrowserSelect: true,\n    options: [{\n      name: 'System will automatically select a host.',\n      value: 'auto'\n    }],\n    dataTestAttribute: 'vmMigrateHostSelect'\n  }) %>\n</section>"}),define("text!templates/popups/vm/SnapshotFormView.html",[],function(){return'\x3c!-- VM Snapshot Form --\x3e\n<section data-ntnx-section>\n  <label data-ntnx-label>\n    <%= i18n(\'name\') %>\n  </label>\n  <input\n    type="text"\n    class="snapshotName"\n    data-test="vmSnapshotNameInput"\n  >\n  <div data-ntnx-hint>\n    <%= i18n(\'nameHint\') %>\n  </div>\n</section>\n'}),define("text!templates/popups/vm/PowerStateChangeFormView.html",[],function(){return"\x3c!-- VM Power State Change Form --\x3e\n<section\n  data-ntnx-section\n  id=\"vmPowerStateChangeForm\"\n  data-test=\"vmPowerStateChangeForm\"\n>\n  <h5 data-ntnx-title>\n    Select the type of power off action:\n  </h5>\n\n  <section data-ntnx-section>\n    <section>\n      <%= Components.radio({\n        id        : 'power-off',\n        name      : 'change-type-group',\n        jsClasses : 'change-type',\n        checked   : true,\n        value     : 'power_off',\n        labelText : i18n('powerOff')\n      }) %>\n    </section>\n\n    \x3c!-- TODO: Uncomment out the following lines when the back end supports\n         forced power off operations (ENG-26792). --\x3e\n    \x3c!-- <input class=\"change-type\" name=\"change-type\" type=\"radio\"\n      value=\"force\">Force<br> --\x3e\n\n    <section class=\"ahv\">\n      <%= Components.radio({\n        id        : 'power-cycle',\n        name      : 'change-type-group',\n        jsClasses : 'change-type',\n        value     : 'power_cycle',\n        labelText : i18n('powerCycle')\n      }) %>\n    </section>\n\n    <section>\n      <%= Components.radio({\n        id        : 'power-reset',\n        name      : 'change-type-group',\n        jsClasses : 'change-type',\n        value     : 'power_reset',\n        labelText : i18n('powerReset')\n      }) %>\n    </section>\n\n    <section class=\"guest\">\n      <%= Components.radio({\n        id        : 'acpi-shutdown',\n        name      : 'change-type-group',\n        jsClasses : 'change-type',\n        value     : 'acpi_shutdown',\n        labelText : isHyperv ? i18n('shutdown') : i18n('guestShutdown')\n      }) %>\n    </section>\n\n    <section class=\"guest\">\n      <%= Components.radio({\n        id        : 'acpi-reboot',\n        name      : 'change-type-group',\n        jsClasses : 'change-type',\n        value     : 'acpi_reboot',\n        labelText : i18n('guestReboot')\n      }) %>\n    </section>\n  </section>\n</section>"}),define("text!templates/popups/vm/StorageItemView.html",[],function(){return'<tr class="n-table-row">\n  <% if (!isESX && !shouldShowUEFI) { %>\n  <% if (isCdrom && isEmpty) { %>\n    <td class="boot-cell-disable" >\n      <%= Components.radio({\n        name      : \'select-boot-device\',\n        disabled  : true,\n        classes   : \'boot-device-radio\',\n        dataTestAttribute: \'storageitemview_radio_disabled_boot\'\n      }) %>\n    </td>\n  <% } else { %>\n    <td class="boot-cell" >\n      <%= Components.radio({\n        name    : \'select-boot-device\',\n        id      : diskUuid,\n        disabled: disableBoot,\n        classes : \'boot-device-radio\',\n        dataTestAttribute: \'storageitemview_radio_boot\'\n      }) %>\n    </td>\n  <% } %>\n<% } %>\n  <td  class="name-cell">\n    <%= type.replace(/_/g, " ") %>\n  </td>\n  <td  class="address-cell">\n    <%= address %>\n  </td>\n  <td class="parameters"\n      title="<%= diskPath ? diskPath + \'; \' : \'\' %><%= parameters %>">\n    <%= parameters ? parameters : "&nbsp;" %>\n  </td>\n  <% if (canModify) { %>\n    <td diskuuid="<%= diskUuid %>"\n        data-devicebus="<%= deviceBus %>"\n        data-deviceindex="<%= deviceIndex %>"\n        class="cell-actions">\n      <% if (type === "CD-ROM" && action === "update") { %>\n        <i class="btnEject <%= disableEject ? \'disabled\' : \'\' %>"\n           aria-hidden="true"\n           <%= disableEject && isEmpty ? \'title="The CD-ROM is empty."\' : \'\' %>>\n          <%= icon %>\n        </i>\n        <span class="action-separator">&middot;</span>\n      <% } %>\n      <i class="btnEdit <%= disableEdit ? \'btnDisabled\' : \'\' %>"\n         title="<%= _.isString(disableEdit) ? disableEdit : \'\' %>"\n         data-icon="F" aria-hidden="true"></i>\n      <span class="action-separator">&middot;</span>\n      <i class="btnDelete <%= disableDelete ? \'btnDisabled\' : \'\' %>"\n         title="<%= _.isString(disableDelete) ? disableDelete : \'\' %>"\n         data-icon="v" aria-hidden="true" ></i>\n    </td>\n  <% } %>\n</tr>\n'}),define("text!templates/popups/vm/VolumeGroupFormView.html",[],function(){
return'\x3c!-- Volume Group Storage Form --\x3e\n<section id="vmVolumeGroupForm">\n  <section data-ntnx-section>\n    <label data-ntnx-label>\n      Available Volume Groups\n    </label>\n    <p class="noVolumeGroupWrapper">\n      No volume groups to select from.\n    </p>\n    <div class="volumeGroupSelectWrapper">\n      <%= Components.select({\n        jsClasses: \'volumeGroupSelect\',\n        attributes: \'data-class="fancy-select-top-anchor"\'\n      }) %>\n    </div>\n  </section>\n  <section data-ntnx-section>\n    <a\n      action="create"\n      actiontarget="acropolis_volume_group"\n      <% if (model.clusterUuid) { %>\n        actionparententitytype="cluster"\n        actionparentid="<%= model.clusterUuid %>"\n      <% } %>\n      class="addVolumeGroupLink"\n      data-test="settings_menu_create_volume_group"\n      tabindex="-1"\n    >\n      Create new volume group\n    </a>\n  </section>\n</section>'}),define("text!templates/popups/vm/VolumeGroupItemView.html",[],function(){return'<tr class="n-table-row">\n  <td  class="name-cell">\n    <%= name %>\n  </td>\n  <td  class="address-cell">\n    <%= address %>\n  </td>\n  <% if (canModify) { %>\n    <td vgUuid="<%= vgUuid %>" class="cell-actions">\n      <i class="btnDelete" data-icon="v" aria-hidden="true" ></i>\n    </td>\n  <% } %>\n</tr>'}),define("text!templates/popups/vm/NicItemView.html",[],function(){return'<tr class="n-table-row">\n  <td class="vlanid-cell">\n    <%= vlanId %>\n  </td>\n  <td class="network-cell">\n    <%= networkName %>\n  </td>\n  <td class="macaddress-cell"\n      <%= isNewNic ? \'\' : \'title="\' + macAddress + \'"\' %>>\n    <%= isNewNic ? \'&nbsp;\' : macAddress %>\n  </td>\n  <td class="req-ip-cell"\n      <%= requestedIp ? \'\' : \'title="\' + requestedIp + \'"\' %>>\n    <%= requestedIp ? requestedIp : \'&nbsp;\' %>\n  </td>\n  <% if (canModify) { %>\n    <td macaddress="<%= macAddress %>" class="cell-actions">\n    <% if (!disableEdit) { %>\n      <i class="btnEdit <%= disableEdit ? \'btnDisabled\' : \'\' %>"\n         data-icon="F" aria-hidden="true"></i>\n      <span class="action-separator">&middot;</span>\n    <% } %>\n      <i class="btnDelete <%= disableDelete ? \'btnDisabled\' : \'\' %>"\n         data-icon="v" aria-hidden="true" ></i>\n    </td>\n  <% } %>\n</tr>'}),define("text!templates/popups/vm/AffineHostItemView.html",[],function(){return'<tr class="n-table-row" actionTargetId="<%= id %>">\n  <td  class="host-name-cell">\n    <%= name %>\n    <% if (canModify) { %>\n      <div class="cell-actions pull-right">\n        <i actionTargetId="<%= id %>"\n           class="btnDelete <%= disabled ? \'btnDisabled\' : \'\' %>"\n           data-icon="v"\n           aria-hidden="true">\n        </i>\n      </div>\n    <% } %>\n  </td>\n</tr>'}),define("text!templates/popups/vm/GpuItemView.html",[],function(){return'<tr class="n-table-row">\n  <td class="name-cell">\n    <%= name %>\n    <% if (isUnknown) { %>\n      <span class="unknownGpuMoreInfo"></span>\n    <% } %>\n  </td>\n  <td class="type-cell">\n    <%= type %>\n  </td>\n  <% if (canModify) { %>\n  <td class="cell-actions">\n    <i class="btnDelete <%= disableEdit ? \'btnDisabled\' : \'\' %>"\n       data-icon="v"\n       aria-hidden="true"\n       actionTargetId="<%= id %>"\n       title="<%= disableEdit ? disabledTooltip : \'\' %>"></i>\n  </td>\n  <% } %>\n</tr>\n'}),define("views/popups/vm/VmPopupView",["views/basecomponents/popups/BasePopupView","data/DataProperties","events/AppEvents","models/vm/AcropolisVMModel","models/task/AcropolisTaskModel","models/vm/VMCollection","models/vm/AcropolisSnapshotModel","models/storage/ContainerCollection","models/storage/DatastoreCollection","models/hardware/HostCollection","models/imageservice/AcropolisImageCollection","models/storage/AcropolisDiskCollection","models/storage/AcropolisDiskModel","models/storage/AcropolisVdiskCollection","models/volumegroup/AcropolisVolumeGroupModel","models/volumegroup/AcropolisVolumeGroupCollection","models/network/AcropolisNicModel","models/network/AcropolisNicCollection","models/network/AcropolisNetworkModel","models/capacityplanning/CPQueryModel","models/gpu/GpuModel","models/gpu/GpuCollection","models/cluster/ClusterExternalStateModel","models/fileserver/FileInsightsModel","managers/ActionManager","managers/NavigationManager","managers/ClusterManager","managers/AppManager","managers/acropolis/AcropolisNetworkManager","managers/LicenseManager","utils/AppConstants","data/DataURLConstants","utils/AppUtil","utils/StatsUtil","utils/SVG","utils/SubViewHelper","utils/EntityUtil","utils/TimeUtil","utils/FilterUtil","utils/HypervisorUtil","utils/TooltipContent","utils/GpuUtil","utils/VMUtil","utils/ValidationUtil","utils/CommonTemplates","views/popups/vm/VmHostAffinityView","views/popups/vm/GpuSelectView","views/popups/vm/VmStorageFormView","views/popups/vm/VmNicFormView","text!templates/popups/vm/VmContentView.html","text!templates/popups/vm/MigrateFormView.html","text!templates/popups/vm/SnapshotFormView.html","text!templates/popups/vm/PowerStateChangeFormView.html","text!templates/popups/vm/StorageItemView.html","text!templates/popups/vm/VolumeGroupFormView.html","text!templates/popups/vm/VolumeGroupItemView.html","text!templates/popups/vm/NicItemView.html","text!templates/popups/vm/AffineHostItemView.html","text!templates/popups/vm/GpuItemView.html","text!templates/basecomponents/pagepopups/PopupListView.html"],function(e,t,n,i,s,a,o,r,l,c,d,p,u,h,m,f,v,g,E,T,C,S,A,b,y,I,w,P,N,R,D,M,O,L,x,k,V,U,F,H,B,G,Y,W,K,z,j,q,X,Q,J,Z,ee,te,ne,ie,se,ae,oe,re){"use strict";Q=_.template(Q),te=_.template(te),ie=_.template(ie),se=_.template(se),J=_.template(J),Z=_.template(Z),ee=_.template(ee),ae=_.template(ae),oe=_.template(oe),re=_.template(re);var le=_.template('<a class="addNetwork" <%= actionAttributes %> ><%= title %></a>'),ce=_.template('<div data-ntnx-form-inline id="<%= id %>" class="pathMap path-map"><input type="text" class="srcPath" value="<%= source %>"><input type="text" class="destPath" value="<%= destination %>"><%= Components.button({extraClasses: "btnDelete",iconLeft: "minus",extraAttr: [{ key: "actionTargetId", value: id }]}) %></div>'),de=_.template("This VM has host affinity with <%= count %> out of the <%= total %> available hosts. It can only be migrated to those hosts."),pe=_.template("This VM has host affinity set to host <%= name %>. It can not be migrated to any other host without setting the host affinity to that host."),ue=_.template('\n        <label data-ntnx-label>\n          <%= label %>\n        </label>\n        <%= Components.select({\n            type: "select_searchable",\n            jsClasses: "timezone",\n            options: timezoneOptions\n          })\n        %>\n      '),he=_.template("\n        <%= Components.select({\n              id: id,\n              options: options,\n              disabled: disableSelect,\n              useBrowserSelect: useBrowserSelect,\n              dataTestAttribute: 'vmpopupview_select_boot'\n        }) %>\n      "),me={VLAN_ID:"vlandId"};return e.extend({DESCRIPTION_UPDATE:"Update the configuration of a VM.",DESCRIPTION_SNAPSHOT_DETAILS:"You are viewing the details of a snapshot.",POWER_OFF_TITLE:"Power off VM",VM_NAME_IN_USE_WARNING:"VM name is already in use",CLOUDINIT_RADIO_OPTIONS:{PATH:"path",UPLOAD:"upload",PASTE:"paste"},TIMEOUT_MSG:"There was a timeout while trying to check the operation status. The operation may or may not have succeeded. Please check the task details for more information.",ENTITY_NOT_FOUND_MSG:"The entity was not found. It may have been deleted or is currently unavailable.",REMOVE_HOST_PROMPT:"The VM will no longer be affined to this host. Are you sure you want to proceed?",HOST_AFFINITY_TITLE:"Set VM Host Affinity",VM_FLASH_MODE_MSG:"Ensures no down migration of data from the flash tier. Can be selectively controlled for Virtual Disks.",DISK_FLASH_MODE_MSG:"Ensures no down migration of data from the flash tier.",SUBVIEWS:{VM_HOST_AFFINITY_VIEW:"vmHostAffinityView",GPU_SELECT_VIEW:"gpuSelectView",VM_STORAGE_FORM:"vmStorageForm",VM_NIC_FORM:"vmNicForm"},el:"#popupVm",model:null,subViewHelper:null,containerCollection:null,datastoreCollection:null,initialized:!1,vmDiskCollection:null,vmCollection:null,volumeGroupCollection:null,vmVolumeGroupCollection:null,vmNicCollection:null,vdiskCollection:null,vmAffineHostCollection:null,pGpuCollection:null,vGpuProfileCollection:null,vmGpuCollection:null,externalStateModel:null,snapshotModel:null,currentDiskModel:null,currentNicModel:null,efficiencyModel:null,isFanout:!1,currentVmNames:null,proxyClusterUuid:null,cloneCount:1,hypervisorType:null,isDiskSizeDirty:!1,name:"VmPopupView",clusterModel:null,busDeviceTypeMap:null,scrollTopPosition:0,vmGenOptions:null,vmAutoStartOptions:null,vmAutoStopOptions:null,diskList:[],warningHasShown:!1,uefiBoot:null,events:{"click  .btnUpdate":"onSaveClick","click  .btnCancel":"onCancelClick","click  .btnBack":"onBackClick","click  .modal-header .close":"hide","click  .btnCreateNetwork":"onAddNic","click  .btnAddStorage":"onAddStorage","click  .btnAddVolumeGroup":"onAddVolumeGroup","click  .btnEject":"onEjectCdrom","click  #storageList .btnDelete":"onRemoveStorage","click  #storageList .btnEdit":"onUpdateStorage","click  #volumeGroupList .btnDelete":"onRemoveVolumeGroup","click  #nicList .btnDelete":"onRemoveNic","click  #nicList .btnEdit":"onUpdateNic","click  #vmCustomSection .btnAdd":"onAddInjectFile","click  #vmCustomSection .btnDelete":"onDeleteInjectFile","change #toggleVmCustom":"toggleCustomizationControls","change #toggleAdv":"toggleAdvancedSettings","click  .addVolumeGroupLink":"onAddVolumeGroupLinkClick","click  .addNetwork":"onAddNetworkClick","keypress input":"onKeyPress","keyup  .adsfPath":"onDiskPathKeyUp","keyup #location":"onDiskPathKeyUp","blur   .inputName":"onVmNameInputBlur",'click  input[name!="gpu"]':"clearHeader","input  .inputCloneCount, .inputSuffix":"onCloneCountChange","click  .imageBinary":"onCustomScriptFileSelect","keypress .scriptPath":"onCustomScriptPathKey","keypress .scriptPaste":"onCustomScriptPasteKey","paste  .scriptPaste":"onCustomScriptPasteKey","click  .btnSetAffinity":"showHostAffinityForm","click  #affinityList .btnDelete":"onRemoveAffineHost","keyup  input.diskSize":"onChangeDiskSize","click .btnAddGpu":"showGpuForm","click #gpuList .btnDelete":"onRemoveGpu","keypress .isInteger":"isIntegerOnly","keypress .isIntegerOrFloat":"isIntegerOrFloat","change [name=bootConfig]":"onBootConfigRadioChange","change [id=boot_config_select]":"onSelectChange"},initialize:function(){var t=this;this.subViewHelper=new k,this.containerCollection=new r,this.datastoreCollection=new l,this.model=new i,this.vmCollection=new a,this.vmDiskCollection=new p,this.volumeGroupCollection=new f,this.vmVolumeGroupCollection=new f,this.vmNicCollection=new g,this.vmAffineHostCollection=new c,this.vdiskCollection=new h,this.hostCollection=new c,this.networkCollection=N.getNetworkCollection(),this.imageCollection=new d,this.pGpuCollection=new S,this.vGpuProfileCollection=new S,this.vmGpuCollection=new S,this.externalStateModel=new A,this.vmCollection.setProjection([D.PROJECTION.BASIC_INFO]),this.networkCollection.useUhura(!0),_.bindAll(this,"onDiskModelError","onNetworkPopupClosed","onImagePopupClosed","onVolumeGroupPopupClosed"),this.hypervisorType=this.getHypervisorType(),this.vmGenOptions=_.map(i.VM_GENERATION,function(e,n){return{value:e,name:t.i18n(("gen_"+n).toLowerCase())}}),this.vmAutoStartOptions=_.map(i.VM_AUTO_START_ACTION,function(e,n){return{value:e,name:t.i18n(n.toLowerCase())}}),this.vmAutoStopOptions=_.map(i.VM_AUTO_STOP_ACTION,function(e,n){return{value:e,name:t.i18n(n.toLowerCase())}}),this.getTimezoneOptions=function(e){var t=O.getDefaultTimezone(),n=w.getCurrentClusterTimezone(),i=[];return e?(i.push({name:e,value:e,selected:!0}),e===t?i[0].info=this.i18n("local"):t&&i.push({name:t,value:t,info:this.i18n("local")}),e===n?i[0].info=this.i18n("cluster"):n&&i.push({name:n,value:n,info:this.i18n("cluster")})):(t&&i.push({name:t,value:t,info:this.i18n("local")}),n&&i.push({name:n,value:n,info:this.i18n("cluster")})),_.each(O.getTimezonesWithUTCOffset()||[],function(e){var t="("+e.offset+") "+e.zone;e.zone===i[0].name?i[0].name=t:i[1]&&e.zone===i[1].name?i[1].name=t:i[2]&&e.zone===i[2].name?i[2].name=t:i.push({name:t,value:e.zone})}),i},e.prototype.initialize.apply(this,arguments)},initializeEfficiencyModel:function(e){var n={};w.isMulticlusterNavMode()&&(n=F.addFilterCondition(n,t.EB.VM.VM_HYPERVISOR_ID,F.createFilterCondition(D.ENTITY_VM,t.EB.VM.VM_HYPERVISOR_ID,D.FILTER_OPERATORS.EQUALS,e)),this.efficiencyModel=new T({entity_type:D.ENTITY_VM,group_member_attributes:[t.VM_EFFICIENCY.EFFICIENCY_DETAIL],filter_expression:n}))},render:function(){var e=this.canModifyByEntityType(D.ENTITY_VM);this.$el.html(this.defaultTemplate({title:"&nbsp;",bodyContent:Q(this.vtOptions({canModify:e,techPreviewWarning:D.MSG_TECH_PREVIEW,isHyperv:this.isHyperV(),generationOptions:this.vmGenOptions,autoStartOptions:this.vmAutoStartOptions,autoStopOptions:this.vmAutoStopOptions})),footerButtons:this.defaultFooter(this.getFooterButtons(e))})),this.isActionUpdate()||this.renderTimezoneField("UTC");var t=[],n=this,i=this.actionRoute[D.NAV_ACTION],s=!1;switch(i){case D.ACTION_MIGRATE:t.push(this.hostCollection.fetch());case D.ACTION_CLONE:case D.ACTION_SHOW:case D.ACTION_UPDATE:this.isVmHostAffinitySupported()&&t.push(this.hostCollection.fetch()),this.initializeEfficiencyModel(this.actionRoute[D.NAV_ACTION_TARGET_ID]),this.efficiencyModel&&(this.efficiencyModel.disableHybridQuery=!0,t.push(this.efficiencyModel.save())),this.actionRoute[D.NAV_ACTION_TARGET]===D.ENTITY_ACROPOLIS_SNAPSHOT?(this.snapshotModel=new o,this.snapshotModel.setProxyClusterUuid(this.proxyClusterUuid),this.snapshotModel.set(this.snapshotModel.idAttribute,this.actionRoute[D.NAV_ACTION_TARGET_ID],{silent:!0}),this.snapshotModel.includeVMDiskSizes=!0,this.snapshotModel.includeAddressAssignments=!0,t.push(this.snapshotModel.fetch())):(this.model.set(this.model.idAttribute,this.actionRoute[D.NAV_ACTION_TARGET_ID],{silent:!0}),this.model.includeVMDiskSizes=!0,this.model.includeAddressAssignments=!0,t.push(this.model.fetch()));break;case D.ACTION_CREATE:var a=!1;if(this.isVmHostAffinitySupported()&&(a=!0),this.isHyperV()&&(a=!0),a&&t.push(this.hostCollection.fetch()),!this.isHyperV()){var r,l={};l[u.DP.IS_CDROM]=!0,l[u.DP.IS_EMPTY]=!0,l[u.DP.DISK_ADDRESS]=(r={},_defineProperty(r,u.DP.BUS_TYPE,this.getDefaultCdromBusType()),_defineProperty(r,u.DP.DEVICE_INDEX,0),r),l.isNewDisk=!0,this.addStorageModel(l)}break;case D.ACTION_AFFINITY:this.model.set(this.model.idAttribute,this.actionRoute[D.NAV_ACTION_TARGET_ID],{silent:!0}),t.push(this.model.fetch()),t.push(this.hostCollection.fetch());break;case D.ACTION_POWER_OFF:case D.ACTION_POWER_CYCLE:case D.ACTION_POWER_RESET:case D.ACTION_ACPI_SHUTDOWN:case D.ACTION_ACPI_REBOOT:s=!0,this.hypervisorType===D.HYPERVISOR_TYPE.ESXI&&this.clusterModel&&this.clusterModel.isManagementServerRegistered()&&(this.model.set(this.model.idAttribute,this.actionRoute[D.NAV_ACTION_TARGET_ID],{silent:!0}),t.push(this.model.fetch()))}if(this.clusterModel&&!this.clusterModel.isAmfOverEsxBasicSupported()&&(this.volumeGroupCollection.useV2DataSource=!1,this.networkCollection.useUhura(!1)),s||i===D.ACTION_MIGRATE||(t.push(this.containerCollection.fetch()),this.isEsx()&&t.push(this.datastoreCollection.fetch()),t.push(this.networkCollection.fetch())),this.hypervisorType===D.HYPERVISOR_TYPE.KVM&&!this.isActionAffinity()&&!s&&i!==D.ACTION_MIGRATE&&(t.push(this.imageCollection.fetch()),t.push(this.volumeGroupCollection.fetch()),H.hasKVMOnly(null,[this.hypervisorType])&&this.clusterModel&&this.clusterModel.isGpuPassthroughSupported())){if(this.clusterModel.isVirtualGpuSupported()){this.vGpuProfileCollection.setvGpuProfileUrl(),t.push(this.vGpuProfileCollection.fetch());var c=F.filterConditionToFIQL(C.DP.GPU_TYPE,{op:D.FILTER_OPERATORS.NOT_EQUALS,value1:C.GPU_TYPE_KSTRING.VIRTUAL});this.pGpuCollection.setFilterCriteria(c)}t.push(this.pGpuCollection.fetch())}$.when.apply($,t).done(function(){switch(i){case D.ACTION_MIGRATE:n.renderMigrate(i);break;case D.ACTION_SNAPSHOT:n.renderTakeSnapshot(i);break;case D.ACTION_SHOW:n.renderSnapshotDetails(i);break;case D.ACTION_POWER_OFF:case D.ACTION_POWER_CYCLE:case D.ACTION_POWER_RESET:case D.ACTION_ACPI_SHUTDOWN:case D.ACTION_ACPI_REBOOT:n.renderPowerStateChange(i);break;case D.ACTION_CLONE:if(n.snapshotModel){n.renderSnapshotClone(i);break}default:n.initAffineHosts(),n.initAssignedGpus(),n.showVmForm(i,!1,!0)}}).fail(function(e){var t;_.isObject(e)?(t=O.processAjaxError(e.responseText),t.indexOf(D.ENTITY_NOT_FOUND)>=0&&(t=n.ENTITY_NOT_FOUND_MSG)):t=e,n.showHeaderError(t),n.$(".btnUpdate").hide()}).always(function(){n.$(".n-modal-loading").hide()})},createVmModel:function(){return new i},show:function(t){this.actionRoute=t,t[D.NAV_ACTION_PARENT_ID]&&(this.proxyClusterUuid=t[D.NAV_ACTION_PARENT_ID],this.containerCollection.setProxyClusterUuid(this.proxyClusterUuid),this.datastoreCollection.setProxyClusterUuid(this.proxyClusterUuid),this.model.setProxyClusterUuid(this.proxyClusterUuid),this.vmCollection.setProxyClusterUuid(this.proxyClusterUuid),this.vmDiskCollection.setProxyClusterUuid(this.proxyClusterUuid),this.vmNicCollection.setProxyClusterUuid(this.proxyClusterUuid),this.vdiskCollection.setProxyClusterUuid(this.proxyClusterUuid),this.hostCollection.setProxyClusterUuid(this.proxyClusterUuid),this.imageCollection.setProxyClusterUuid(this.proxyClusterUuid),this.networkCollection.setProxyClusterUuid(this.proxyClusterUuid),this.volumeGroupCollection.setProxyClusterUuid(this.proxyClusterUuid),this.pGpuCollection.setProxyClusterUuid(this.proxyClusterUuid),this.vGpuProfileCollection.setProxyClusterUuid(this.proxyClusterUuid),this.isFanout=!0);var n=t[D.NAV_ACTION];if(this.hypervisorType=this.getHypervisorType(),this.proxyClusterUuid&&(this.clusterModel=w.getClusterModelByClusterUuid(this.proxyClusterUuid)),this.clusterModel||(this.clusterModel=w.getCurrentClusterModel()),this.clusterModel&&!this.clusterModel.isAmfOverEsxBasicSupported()&&(this.model.useV2DataSource=!1),this.isActionCreate()&&this.hypervisorType===D.HYPERVISOR_TYPE.ESXI&&this.clusterModel&&!this.clusterModel.isManagementServerRegistered())return void $.nutanixConfirm({msg:this.i18ns("noMgmtServer",D.MANAGEMENT_SERVER_NAME.VCENTER),hideNo:!0,yesText:D.LABEL_CLOSE,context:this});var i=[D.ACTION_POWER_OFF,D.ACTION_POWER_ON,D.ACTION_POWER_CYCLE,D.ACTION_POWER_RESET,D.ACTION_ACPI_SHUTDOWN,D.ACTION_ACPI_REBOOT,D.ACTION_PAUSE,D.ACTION_RESUME,D.ACTION_DELETE,D.ACTION_ENABLE_NGT,D.ACTION_DISABLE_NGT];if(this.proxyClusterUuid&&-1!==i.indexOf(n))return y.executeAction({actionTargetId:t.actionTargetId,actionTarget:D.ENTITY_VM_FANOUT,actionParentId:t[D.NAV_ACTION_PARENT_ID],actionParentEntityType:D.ENTITY_CLUSTER,action:n}),void this.hide(!0);n===D.ACTION_DELETE||n===D.ACTION_DELETE_FILE_INSIGHTS?this.renderDelete(t):n===D.ACTION_POWER_ON||n===D.ACTION_PAUSE||n===D.ACTION_RESUME||n===D.ACTION_SUSPEND||n===D.ACTION_SAVE||n===D.ACTION_DISCARD?n===D.ACTION_PAUSE||n===D.ACTION_SUSPEND?$.nutanixConfirm({msg:this.i18nStatic("ActionManager","generic_confirmation"),yes:function(){this.setPowerState(t)},yesText:this.i18nStatic("Common","yes"),noText:this.i18nStatic("Common","no"),context:this}):this.setPowerState(t):e.prototype.show.apply(this,arguments)},reset:function(){this.clearForm(),this.clearHeader(),this.undelegateEvents()},clearForm:function(){this.$(".inputAddress").val(""),this.$(".inputPort").val(""),this.$(".inputUsername").val(""),this.$(".inputPassword").val(""),this.$(".fromEmailAddress").val(""),this.$(".inputSecureMode").val("none").attr("selected",!0)},destroy:function(){this.$(".n-error-details, .n-tooltip-cir").tooltip("destroy"),this.$(".nutanixMoreInfo").nutanixMoreInfo("destroy"),this.$(".unknownGpuMoreInfo").nutanixMoreInfo("destroy"),this.$("#guestOs").autocomplete("destroy"),this.$("#location").autocomplete("destroy"),this.subViewHelper.destroy(),e.prototype.destroy.apply(this,arguments)},getFooterButtons:function(e){var t=[{text:this.i18n("back"),extraClasses:"btnBack n-btn-form hide",leftAligned:!0,iconLeft:"caret-left"},{text:this.i18n(e?"cancel":"close"),extraClasses:"btnCancel n-btn-list",dataTestAttribute:"vmpopupview_button_cancelvm"}];return e&&t.push({isPrimary:!0,text:this.i18n("save"),extraClasses:"btnUpdate n-btn-list",extraAttr:[{key:"data-loading-text",value:this.i18n("saving")}],dataTestAttribute:"vmpopupview_button_updatevm"}),t},disableButton:function(e){this.$(e).is("svg")?(this.$(e+"+ .action-seperator").remove(),this.$(e).remove()):this.$(e).addClass("btnDisabled")},getHypervisorType:function(){var e=null,t=this.proxyClusterUuid||w.getCurrentClusterUuid();return t&&(H.hasESX(t)?e=D.HYPERVISOR_TYPE.ESXI:H.hasKVMOnly(t)?e=D.HYPERVISOR_TYPE.KVM:H.hasNull(t)?e=D.HYPERVISOR_TYPE.NULL:H.hasHyperV(t)&&(e=D.HYPERVISOR_TYPE.HYPERV)),e},getDefaultCdromBusType:function(){return this.isPowerPcCluster()?u.BUS_TYPES.SPAPR:u.BUS_TYPES.IDE},isPowerPcCluster:function(){return w.isPowerPcCluster(this.proxyClusterUuid)},isActionUpdate:function(){return this.actionRoute[D.NAV_ACTION]===D.ACTION_UPDATE},isActionClone:function(){return this.actionRoute[D.NAV_ACTION]===D.ACTION_CLONE},isActionCreate:function(){return this.actionRoute[D.NAV_ACTION]===D.ACTION_CREATE},isActionShow:function(){return this.actionRoute[D.NAV_ACTION]===D.ACTION_SHOW},isActionShowSnapshot:function(){var e=this.actionRoute[D.NAV_ACTION_TARGET];return this.isActionShow()&&e===D.ENTITY_ACROPOLIS_SNAPSHOT},isSnapshotClone:function(){return this.actionRoute[D.NAV_ACTION]===D.ACTION_CLONE&&this.actionRoute[D.NAV_ACTION_TARGET]===D.ENTITY_ACROPOLIS_SNAPSHOT},isActionAffinity:function(){return this.actionRoute[D.NAV_ACTION]===D.ACTION_AFFINITY},getNetworkModel:function(e){var t=null;return t=this.isHyperV()?this.networkCollection.findModelByUuid(e):this.networkCollection.findModelById(e),t||O.log("VmPopupView: getNetworkModel: Unable to retrieve network model with UUID: "+e),t},confirmDelete:function(e,t){var n=w.getCurrentClusterUuid(),i=!0;n&&(H.hasESX(n)||H.hasHyperV(n))&&(i=!1);var s=t.getId(),a=t.getName();$.nutanixConfirm({msg:t.isPoweredOn()?this.i18ns("confirm_powered_vm_delete",a):this.i18ns("confirm_vm_delete",a),context:this,extHTML:i?'<div><input type="checkbox" class="delete-snapshot"><span class="cb-desc">&nbsp;Delete all snapshots of this VM?</span></div>':"",class:"-red-confirm",yesText:this.i18n("delete"),yes:function(){var t=$("#nutanixConfirmModal .delete-snapshot").is(":checked");this.deleteEntity(e[D.NAV_ACTION_TARGET],s,a,t)}})},deleteEntity:function(e,t,n,s){if(this.actionRoute.action===D.ACTION_DELETE_FILE_INSIGHTS)this.deleteFileInsightsVm(t);else{var a=new i;a.actionMode=D.ACTION_DELETE,a.set(a.idAttribute,t),a.vmName=n,a.set(i.DP.VM_DELETE_SNAPSHOTS,s),a.destroy({success:function(e,t){I.showDetailsSummary()}})}},deleteFileInsightsVm:function(e){var t=new b,n=e,i=this.actionRoute[D.NAV_ACTION_ID],s={vmUuid:n};t.set(t.DP.IP,i),t.setActionMode(D.ACTION_DELETE),t.destroy(s,{success:function(e,t){I.showDetailsSummary()}})},migrateVm:function(){var e=new i;if("auto"!==this.$(".migrateHost").val()&&e.set(e.DP.HOST_UUID,this.$(".migrateHost").val()),e.actionMode=D.ACTION_MIGRATE,this.isFanout){var n=this;e.vmName=this.model.getName(),e.idAttribute=t.FANOUT.VM_ID,e.setId(O.getEntityIdWithoutClusterId(this.model.getId())),this._showModalLoader(e),this.performFanout({action:D.ACTION_MIGRATE,model:e,success:function(e,t){n._hideModalLoader(),n.hide()},error:function(e,t){n.showHeaderErrorWithDetails("Error migrating VM: ",t.responseText||t),n._hideModalLoader()}})}else e.migrate(this.model.get(this.model.idAttribute),this.model.getName())},snapshotVm:function(){var e=this,t=new o,n=this.$(".snapshotName").val(),i=this;if(!O.isValidSnapshotName(n))return void i.showHeaderErrorWithDetails(i.i18n("snapshotError"),i.i18n("invalidNameMessage"));if(this.isFanout){var s=O.getEntityIdWithoutClusterId(this.actionRoute[D.NAV_ACTION_TARGET_ID]);t.setupToTakeSnapShot(s,n),t.setProxyClusterUuid(this.proxyClusterUuid),this._showModalLoader(t),this.performFanout({action:D.ACTION_SNAPSHOT,model:t,success:function(e,t){i._hideModalLoader(),i.hide()},error:function(e,t){i.showHeaderErrorWithDetails("Error creating snapshot ",t.responseText||t),i._hideModalLoader()}})}else t.takeSnapshot(this.actionRoute[D.NAV_ACTION_TARGET_ID],this.actionRoute[D.NAV_ACTION_TARGET_NAME],n).done(function(){e.hide()}).fail(function(t,n,i){e.showHeaderError(O.processThrownError(t))})},createVm:function(e){var t=this,n=new i,s=$.Deferred();n.setProxyClusterUuid(this.proxyClusterUuid),n.actionMode=D.ACTION_CREATE,this.hypervisorType&&(e[i.DP.VM_HYPERVISOR_TYPE]=this.hypervisorType),n.on("error",function(e,i){t.showHeaderErrorWithDetails("Error creating VM: ",i.responseText||i),n.off("error"),s.reject()});var a=n.set(e);return this.vmDiskCollection.length&&n.setDisks(this.vmDiskCollection),this.vmNicCollection.length&&n.setNics(this.vmNicCollection),a&&(this.isFanout?(this._showModalLoader(n),this.performFanout({action:D.ACTION_FANOUT.CREATE,model:n,success:function(e,n){t._hideModalLoader(),t.hide(),s.resolve()},error:function(e,n){t.showHeaderErrorWithDetails("Error creating VM: ",n.responseText||n),t._hideModalLoader(),s.reject()}})):n.save(null,{success:function(e,n){t.hide(),s.resolve()},error:function(e,n){t.showHeaderError(O.processAjaxError(n.responseText)),s.reject()}})),s},updateVm:function(e){var t=this,n=$.Deferred();this.model.actionMode=D.ACTION_UPDATE,this.model.on("error",function(e,i){t.showHeaderErrorWithDetails("Error updating VM: ",i.responseText||i),t.model.off("error"),n.reject()});var s={};s[this.model.DP.VM_BOOT]=e[this.model.DP.VM_BOOT],s[this.model.nameAttribute]=e[this.model.nameAttribute],s[i.DP.VM_DESCRIPTION]=e[i.DP.VM_DESCRIPTION],s[i.DP.VM_TIMEZONE]=e[i.DP.VM_TIMEZONE],s[i.DP.VM_MEMORY_MB]=e[i.DP.VM_MEMORY_MB],s[i.DP.VM_NUM_VCPUS]=e[i.DP.VM_NUM_VCPUS],s[i.DP.VM_NUM_CPU_CORES]=e[i.DP.VM_NUM_CPU_CORES],s[i.DP.VM_HA_PRIORITY]=e[i.DP.VM_HA_PRIORITY],s[i.DP.VM_AFFINE_HOST_LIST]=e[i.DP.VM_AFFINE_HOST_LIST],s[i.DP.VM_FEATURES]=e[i.DP.VM_FEATURES];var a=e[i.DP.VM_GPUS];return a?s[i.DP.VM_GPUS]=a:!a&&this.model.has(i.DP.VM_GPUS)&&(s[i.DP.VM_GPUS]=[]),this.model.set(s)&&(this.isFanout?(this._showModalLoader(this.model),this.model.setId(O.getEntityIdWithoutClusterId(this.model.getId())),this.performFanout({action:D.ACTION_UPDATE,model:this.model,type:"PUT",success:function(e,i){t._hideModalLoader(),t.hide(),n.resolve()},error:function(e,i){t.showHeaderErrorWithDetails("Error updating VM: ",i.responseText||i),t._hideModalLoader(),n.reject()}})):this.model.save(null,{success:function(e,i){t.hide(),n.resolve()},error:function(e,i){t.showHeaderError(O.processAjaxError(i.responseText||i)),n.reject()}})),n},cloneVm:function(e){var t=this,n=this.createVmModel(),s=$.Deferred();n.actionMode=D.ACTION_CLONE,n.on("error",function(e,n){t.showHeaderErrorWithDetails("Error cloning VM: ",n.responseText||n),e.off("error"),s.reject()}),n.vmId=this.model.get(this.model.idAttribute);var a={};return a[this.model.nameAttribute]=e[this.model.nameAttribute],a[i.DP.VM_MEMORY_MB]=e[i.DP.VM_MEMORY_MB],a[i.DP.VM_NUM_VCPUS]=e[i.DP.VM_NUM_VCPUS],a[i.DP.VM_NUM_CPU_CORES]=e[this.model.DP.VM_NUM_CPU_CORES],a[i.DP.VM_CUSTOMIZATION_CONFIG]=e[i.DP.VM_CUSTOMIZATION_CONFIG],a[i.DP.VM_FILES_TO_INJECT_LIST]=e[i.DP.VM_FILES_TO_INJECT_LIST],a[i.DP.VM_AFFINE_HOST_LIST]=e[i.DP.VM_AFFINE_HOST_LIST],a[i.DP.VM_CLONE_AFFINITY]=e[i.DP.VM_CLONE_AFFINITY],a[i.DP.VM_BOOT_CONFIG]=e[i.DP.VM_BOOT],this.hypervisorType!==D.HYPERVISOR_TYPE.ESXI&&(a[i.DP.VM_OVERRIDE_NETWORK_CONFIG]=!0),this.vmNicCollection.actionMode=D.ACTION_CLONE,n.setNics(this.vmNicCollection),n.set(a)&&(this.isFanout?(n.setId(O.getEntityIdWithoutClusterId(this.model.getId())),this._showModalLoader(n),this.performFanout({action:D.ACTION_CLONE,model:n,success:function(e,n){t._hideModalLoader(),t.hide(),s.resolve()},error:function(e,n){t.showHeaderErrorWithDetails("Error cloning VM: ",n.responseText||n),t._hideModalLoader(),s.reject()}})):n.save(null,{success:function(e,n){t.hide(),s.resolve()},error:function(e,n){s.reject(),t.showHeaderError(O.processAjaxError(n.responseText||n))}})),s},cloneSnapshot:function(e){var n=this,s=this,a=new o,r=$.Deferred(),l=function(e,t){n.showHeaderError(t),r.reject(t)};a.actionMode=D.ACTION_CLONE;var c=this.model.get(i.DP.VM_CONFIG)||{};a.vmName=c.name,a.snapshotId=this.actionRoute[D.NAV_ACTION_TARGET_ID];var d={};return d[a.nameAttribute]=e[a.nameAttribute],d[i.DP.SNAPSHOT_MEMORY_MB]=e[i.DP.VM_MEMORY_MB],d[i.DP.SNAPSHOT_NUM_VCPUS]=e[i.DP.VM_NUM_VCPUS],d[i.DP.SNAPSHOT_NUM_CPU_CORES]=e[i.DP.VM_NUM_CPU_CORES],this.vmNicCollection.actionMode=D.ACTION_CLONE,a.setNics(this.vmNicCollection),a.set(d,{error:l})&&(this.isFanout?(a.idAttribute=t.UUID,a.setId(O.getEntityIdWithoutClusterId(this.actionRoute[D.NAV_ACTION_TARGET_ID])),this._showModalLoader(a),this.performFanout({action:a.actionMode,model:a,entityType:a.entityType,success:function(e,t){s._hideModalLoader(),s.hide(),r.resolve()},error:function(e,t){s.showHeaderErrorWithDetails("Error cloning snapshot: ",t.responseText||t),s._hideModalLoader(),r.reject()}})):a.save(null,{success:function(e,t){s.hide(),r.resolve()},error:function(e,t){s.showHeaderErrorWithDetails("Error cloning snapshot: ",t.responseText||t),r.reject()}})),r},addVolumeGroup:function(e){var t=this.model.getId();e.actionMode=D.ACTION_ATTACH,this.clusterModel&&!this.clusterModel.isAmfOverEsxBasicSupported()&&(e.useV2DataSource=!1),this.inlineSync(e,function(){e.attachToVM(t)})},removeVolumeGroup:function(e){var t=this.model.getId();e.actionMode=D.ACTION_DETACH,this.clusterModel&&!this.clusterModel.isAmfOverEsxBasicSupported()&&(e.useV2DataSource=!1),this.inlineSync(e,function(){e.detachFromVM(t)})},deleteDisk:function(e){e.isNewDisk?(this.vmDiskCollection.remove(e),this.renderDisksTable(),this.renderVolumeGroupTable()):(e.actionMode=D.ACTION_DELETE,e.useUhura=!0,this.isFanout?this.inlineFanout(e,D.ACTION_DELETE,D.ENTITY_VDISK):this.inlineSync(e,function(){e.save(null,{type:"POST"})})),this.renderBootConfigSection()},addDisk:function(e){var n=new u;n.actionMode=D.ACTION_CREATE,n.useUhura=!0,n.vmId=this.model.get(t.UUID),n.on("error",this.onDiskModelError),n.set(e)&&(this.isFanout?this.inlineFanout(n,D.ACTION_CREATE,D.ENTITY_VDISK):this.inlineSync(n))},ejectCdrom:function(e){e.set(e.DP.IS_EMPTY,!0),this.updateDisk(e)},updateDisk:function(e,n){var i=this;e.actionMode=D.ACTION_UPDATE,e.useUhura=!0,e.vmId=this.model.get(t.UUID),e.isHyperv=this.isHyperV(),e.get(e.idAttribute)||e.set(e.idAttribute,O.generateClientUUID()),this.isFanout?this.inlineFanout(e,D.ACTION_UPDATE,D.ENTITY_VDISK,"PUT"):this.inlineSync(e,null,{onFailure:function(){n&&i.currentDiskModel.set(n,{silent:!0})}})},inlineSync:function(e,n,i){var a=this,o=i||{},r=_.isFunction(o.onSuccess)?o.onSuccess:function(){},l=_.isFunction(o.onFailure)?o.onFailure:function(){},c=_.isFunction(o.onError)?o.onError:function(){},d=_.isFunction(o.onTimeout)?o.onTimeout:function(){};n=n||function(){e.save(null)};var p=e.actionMode;e.vmId=this.model.get(this.model.idAttribute),e.useUhura&&(e.vmId=O.getEntityIdWithoutClusterId(e.vmId)),e.vmName=this.model.getName(),this._showModalLoader(e),e.onTaskFailed=function(e){a._hideModalLoader(),a.scrollToTop();var n="";e&&(n=e.get(s.DP.V2_ERROR_DETAIL)||e.get(s.DP.ERROR_DETAIL)||e.get(t.SUB_TASK_MESSAGE)||e.getMetaResponseAttr(s.DP.ERROR_DETAIL)||""),a.triggerAction(D.MODAL.ACT.ALERT_SHOW,{type:D.MODAL.ALERT.TYPE_ERROR,message:a.i18n("op_fail")+": "+n}),l(e)},e.onPollingTimedOut=function(e){a.model.fetch({success:function(e,t){a.refreshView(),a.showHeaderErrorWithDetails(a.TIMEOUT_MSG)},error:function(e,t){a._hideModalLoader(),a.scrollToTop(),a.showHeaderErrorWithDetails(a.TIMEOUT_MSG)}}),d(e)},e.onTaskSucceeded=function(t){
a.model.fetch({success:function(t,n){a.refreshView(),a.showHeaderSuccess(e.getPopupNotificationMessage(p))},error:function(e,t){a._hideModalLoader(),a.scrollToTop(),a.showHeaderErrorWithDetails("Issue fetching vm model: ",t.responseText)}}),r(t)},e.on("error",function(e,t){a._hideModalLoader(),a.scrollToTop(),a.showHeaderErrorWithDetails("Error submitting operation: ",t.responseText),c(t)}),e.setProxyClusterUuid(this.proxyClusterUuid),this.clearHeader(),n()},inlineFanout:function(e,n,i,s){var a=this;e.isFanout=!0,a.inlineSync(e,function(){}),this.performFanout({action:n,entityType:i,model:e,type:s,success:function(n,i){e.pollErgonTask(i[t.TASK_UUID])},error:function(e,t){a.showHeaderError(O.processAjaxError(t.responseText||t)),a._hideModalLoader()}})},refreshView:function(){this.initialized=!1,this.showVmForm(this.actionRoute[D.NAV_ACTION],!1),this.scrollToTop(),this._hideModalLoader()},_showModalLoader:function(e){var t=e.actionMode;$.nutanixConfirm({msg:e.getLatencyMessage(t),yes:function(){},yesText:"Yes",hideNo:!0,hideYes:!0,context:this})},_hideModalLoader:function(){$("#nutanixConfirmModal").modal("hide"),$(".modal-backdrop").removeClass("popupfadeAll"),$("body").removeClass("n-confirm-show"),$("#globalModalContainer  #nutanixConfirmModal").remove()},addStorageModel:function(e,n){if(e=e||{},!n){n=new u,n.isNewDisk=e.isNewDisk;n.on("error",this.onDiskModelError),e.isNewDisk&&(e[t.ID]=O.generateClientUUID()),delete e.isNewDisk;if(!n.set(e))return!1}return this.vmDiskCollection.add(n),!0},addAffineHost:function(e){this.vmAffineHostCollection.add(e)},removeAffineHost:function(e){this.vmAffineHostCollection.remove(e)},addNic:function(e){var t=new v(e);t.actionMode=D.ACTION_CREATE,t.useUhura=!0,t.isNicDisconnectSupported=this.isNicDisconnectSupported(),t.set(e),this.isFanout?this.inlineFanout(t,D.ACTION_CREATE,D.ENTITY_NIC):this.inlineSync(t)},updateNic:function(e){e.actionMode=D.ACTION_UPDATE,e.useUhura=!0,e.isNicDisconnectSupported=this.isNicDisconnectSupported(),this.isFanout?this.inlineFanout(e,D.ACTION_UPDATE,D.ENTITY_NIC):this.inlineSync(e)},deleteNic:function(e){e.isNewNic||this.isActionClone()?(this.vmNicCollection.remove(e),this.renderNicsTable(this.vmNicCollection)):(e.actionMode=D.ACTION_DELETE,e.useUhura=!0,this.isFanout?this.inlineFanout(e,D.ACTION_DELETE,D.ENTITY_NIC):this.inlineSync(e,function(){e.destroy()}))},addNicModel:function(e){e=e||{};var t=new v;t.vlanId=e.vlanId,t.isNewNic=e.isNewNic,t.isNicDisconnectSupported=this.isNicDisconnectSupported(),this.isHyperV()||delete e.vlanId,delete e.isNewNic,t.set(e),this.vmNicCollection.add(t)},storageFormSaveClick:function(){var e=this.subViewHelper.get(this.SUBVIEWS.VM_STORAGE_FORM),t=e.validateForm();if(t)return void this.showHeaderError(t);var n=e.getData();if(this.currentDiskModel){this.currentDiskModel.actionMode=D.ACTION_UPDATE;var i=$.extend(!0,{},this.currentDiskModel.attributes);if(this.isDiskSizeDirty||n[u.DP.IS_CDROM])n=$.extend(!0,{},i,n),this.currentDiskModel.updateFlashModeOnly=!1;else{var s=n[u.DP.ENABLE_FLASH_MODE];n={},n[u.DP.ENABLE_FLASH_MODE]=s,this.currentDiskModel.updateFlashModeOnly=!0}if(!this.currentDiskModel.set(n))return;this.currentDiskModel.isNewDisk?this.showVmForm(this.actionRoute[D.NAV_ACTION],!0):(this.currentDiskModel.vmId=this.model.get(this.model.idAttribute),this.updateDisk(this.currentDiskModel,i))}else this.isActionUpdate()?this.addDisk(n):(n.isNewDisk=!0,this.addStorageModel(n)&&this.showVmForm(this.actionRoute[D.NAV_ACTION],!0))},volumeGroupFormSaveClick:function(){var e=this.$(".volumeGroupSelect").val();this.isActionUpdate()?this.addVolumeGroup(this.volumeGroupCollection.findModelById(e)):(this.vmVolumeGroupCollection.add(this.volumeGroupCollection.findModelById(e)),this.showVmForm(this.actionRoute[D.NAV_ACTION],!0),this.scrollToBottom())},nicFormSaveClick:function(){var e=this.subViewHelper.get(this.SUBVIEWS.VM_NIC_FORM),t=e.validateForm();if(t)return void this.showHeaderError(t);var n=e.getData();this.currentNicModel?(this.currentNicModel.set(n),this.currentNicModel.isNewNic?(this.showVmForm(this.actionRoute[D.NAV_ACTION],!0),this.scrollToBottom()):(this.currentNicModel.vmId=this.model.get(this.model.idAttribute),this.currentNicModel.actionMode=D.ACTION_UPDATE,this.updateNic(this.currentNicModel))):this.isActionUpdate()?this.addNic(n):(n[v.DP.MAC_ADDRESS]=O.generateClientUUID(),n.isNewNic=!0,this.addNicModel(n),this.showVmForm(this.actionRoute[D.NAV_ACTION],!0),this.scrollToBottom()),this.currentNicModel=null},migrateFormSaveClick:function(){this.migrateVm(),this.hide()},snapshotFormSaveClick:function(){this.snapshotVm()},powerStateChangeFormSaveClick:function(){var e=_.clone(this.actionRoute),t=this.$("input[name=change-type-group]:checked");t.length>0&&(e[D.NAV_ACTION]=t.val()),this.setPowerState(e),this.hide()},gpuFormSaveClick:function(){var e=this.subViewHelper.get(this.SUBVIEWS.GPU_SELECT_VIEW);if(e){var n=e.getSelectedId(),i=e.getActiveSection();if(i===e.GPU_SECTION.VGPU){var s=M.NVIDIA_PORTAL,a=this.clusterModel.get(t.CLUSTER_GRID_DRIVER_VERSION)||this.i18n("n_a");$.nutanixConfirm({class:"-left-align",msg:this.i18ns("addVGpuConfirmMsg",s,a),yesText:this.i18n("ok"),noText:this.i18n("cancel"),yes:function(){this.addSelectedGpu(n)},context:this})}else i===e.GPU_SECTION.PASSTHRU&&this.addSelectedGpu(n)}},addSelectedGpu:function(e){var t=this.pGpuCollection.findModelByIdentifier(e)||this.vGpuProfileCollection.findModelByIdentifier(e);t&&(this.vmGpuCollection.add(t.toJSON()),this.showVmForm(this.actionRoute[D.NAV_ACTION],!0))},setPowerState:function(e){var t,n,s;e?(t=e[D.NAV_ACTION],n=e[D.NAV_ACTION_TARGET_ID],s=e[D.NAV_ACTION_TARGET_NAME]):(t=this.$(".change-type:checked").val(),n=this.actionRoute[D.NAV_ACTION_TARGET_ID],s=this.actionRoute[D.NAV_ACTION_TARGET_NAME]);var a=new i;a.setProxyClusterUuid(this.proxyClusterUuid),a.savePowerState(t,n,s)},initAffineHosts:function(){var e=this.model.getAffineHostList();_.each(e,function(e){var t=this.hostCollection.findModelByUuid(e);t&&this.addAffineHost(t)},this)},initAssignedGpus:function(){_.each(this.model.getAssignedGpus(),function(e){var t=G.getGpuIdentifier(e,C.DP),n=this.pGpuCollection.findModelByIdentifier(t)||this.vGpuProfileCollection.findModelByIdentifier(t);if(n)this.vmGpuCollection.add(n.toJSON());else{var i;this.vmGpuCollection.add(_defineProperty({},C.DP.GPU_CONFIG,_.extend(_.pick(e,C.DP.DEVICE_ID,C.DP.GPU_VENDOR,C.DP.GPU_TYPE),(i={},_defineProperty(i,C.DP.DEVICE_NAME,this.i18ns("unknownGpuName",e[C.DP.GPU_VENDOR],e[C.DP.DEVICE_ID])),_defineProperty(i,C.DP.IS_UNKNOWN,!0),i))))}},this)},renderTimezoneField:function(e){this.$el.find(".timezoneControls").html(ue(this.vtOptions({timezoneOptions:this.getTimezoneOptions(e),label:this.i18n("timezone")})))},renderDelete:function(e){var t=this;$.nutanixConfirm({msg:this.i18n("vm_fetch_pending"),hideYes:!0,hideNo:!0}),this.model.setId(e[D.NAV_ACTION_TARGET_ID]),this.model.fetch({success:function(n){return t.confirmDelete(e,n)},error:function(){$.nutanixConfirm({hideNo:!0,yesText:t.i18n("close"),msg:t.i18n("confirm_unknown_state_vm_delete")})}})},renderUpdate:function(e){var n=this;if(this.vmDiskCollection.clearCollection(),this.vmVolumeGroupCollection.clearCollection(),this.vmNicCollection.clearCollection(),this.mode===D.ACTION_UPDATE&&this.$(".n-popup-description").html(this.DESCRIPTION_UPDATE),e){this.$(".inputName").val(this.model.get(t.NAME)),this.$(".inputDesc").val(this.model.get(i.DP.VM_DESCRIPTION)),this.renderTimezoneField(this.model.get(i.DP.VM_TIMEZONE)),this.$(".inputVcpus").val(this.model.get(i.DP.VM_NUM_VCPUS)||1),this.$(".inputCores").val(this.model.get(i.DP.VM_NUM_CPU_CORES)||1),this.$(".flashMode").prop("checked",this.model.isFlashModeEnabled()),this.$(".agentVm").prop("checked",this.model.isAgentVm()),this.$(".host").val(this.model.get(i.DP.HOST_UUID)),this.$(".generation").val(this.model.get(i.DP.VM_GENERATION)),this.$("#location").val(this.model.get(i.DP.VM_PATH)),this.$(".dyn-mem").prop("checked",!!this.model.get(i.DP.VM_DYNAMIC_MEMORY));var s=this.model.get(i.DP.VM_AUTO_START_ACTION),a=this.model.get(i.DP.VM_AUTO_STOP_ACTION);s&&this.$(".autoStartAction").val(s),a&&this.$(".autoStopAction").val(a),this.updateEfficiencyDetails();var o=L.convertBytesToGiB(L.convertToBytes(this.model.get(i.DP.VM_MEMORY_MB),L.UOM_MIB,!1),4);this.$(".inputMemory").val(o)}this.$(".osControls").hide();var r=this.model.get(this.model.DP.VM_DISK_INFO);_.each(r,function(e){var i={},s=(e[u.V2_DP.DISK_ADDRESS]||{})[u.V2_DP.VOLUME_GROUP_UUID];if(!!s){var a=m.DP,o=n.volumeGroupCollection.find(function(e){return e.getId()===s});return void(o&&(i[a.UUID]=o.getId(),i[a.NAME]=o.get(a.NAME),i[u.DP.DISK_ADDRESS]=e.addr||e.diskAddress,this.vmVolumeGroupCollection.add(new m(i))))}i[u.DP.CONTAINER_ID]=e[u.V2_DP.STORAGE_CONTAINER_UUID],i[u.DP.DISK_SIZE]=e[u.V2_DP.DISK_SIZE],i[t.ID]=(e[u.V2_DP.DISK_ADDRESS]||{})[u.V2_DP.DEVICE_UUID]||(e[u.V2_DP.DISK_ADDRESS]||{})[u.V2_DP.VMDISK_UUID],i[u.DP.IS_CDROM]=e[u.V2_DP.IS_CDROM],i[u.DP.IS_EMPTY]=e[u.V2_DP.IS_EMPTY],i[u.DP.IS_HOT_REMOVE]=e[u.V2_DP.IS_HOT_REMOVE],i[u.DP.VG_UUID]=e[u.DP.VG_UUID],i[u.DP.ENABLE_FLASH_MODE]=e[u.V2_DP.FLASH_MODE_ENABLED];var r=e[u.V2_DP.DISK_ADDRESS],l=null;r&&(l={},l[u.DP.BUS_TYPE]=r[u.V2_DP.BUS_TYPE],l[u.DP.DEVICE_INDEX]=r[u.V2_DP.DEVICE_INDEX],l[u.DP.DISK_LABEL]=r[u.V2_DP.DISK_LABEL]),i[u.DP.DISK_ADDRESS]=l||e.addr,e[u.V2_DP.IS_CDROM]?i[u.DP.DISK_TYPE]=u.DISK_TYPES.CDROM:i[u.DP.DISK_TYPE]=u.DISK_TYPES.DISK,i[u.V2_DP.SRC_ADDRESS]=e[u.V2_DP.SRC_ADDRESS],this.addStorageModel(i)},this),_.each(this.model.get(this.model.DP.VM_NICS),function(e){var t={};if(t[v.DP.NETWORK_UUID]=e[v.V2_DP.NETWORK_UUID],this.mode!==D.ACTION_CLONE){var n=e[v.V2_DP.VLAN_ID];void 0!==n&&(t[v.DP.VLAN_ID]=n),t[v.DP.REQ_IP_ADDRESS]=e[v.V2_DP.REQ_IP_ADDRESS],t[v.DP.MAC_ADDRESS]=e[v.V2_DP.MAC_ADDRESS],t[v.DP.IS_CONNECTED]=e[v.V2_DP.IS_CONNECTED]}else t[v.DP.MAC_ADDRESS]=O.generateClientUUID(),t[v.DP.MODEL]=e[v.V2_DP.MODEL],t.isNewNic=!0;this.addNicModel(t)},this),this.model.get(this.model.DP.VM_STATE)===this.model.VM_POWER_STATE.ON&&this.isActionUpdate()&&this.hypervisorType===D.HYPERVISOR_TYPE.ESXI&&this.$(".inputVcpus, .inputMemory").prop("disabled",!1),this.isHyperV()&&(this.$(".generation").trigger("update").trigger("disable"),this.$("#location").prop("disabled",!0))},updateEfficiencyDetails:function(){if(this.efficiencyModel){var e=this.efficiencyModel.getQueryResultAttributes(),n=void 0,i="",s="";if(e&&e.length&&e[0][t.VM_EFFICIENCY.EFFICIENCY_DETAIL]){try{n=JSON.parse(e[0][t.VM_EFFICIENCY.EFFICIENCY_DETAIL])}catch(e){return void O.log("Error parsing vm efficiency details")}_.each(n,function(e,n){var a=void 0;if(n===t.VM_EFFICIENCY.OVERPROVISIONED_VM)a="Over provisioned";else{if(n!==t.VM_EFFICIENCY.CONSTRAINED_VM)return;a="Constrained"}e.cpu&&e.cpu.hypervisor_cpu_usage_ppm&&(i=a+", "+e.cpu.hypervisor_cpu_usage_ppm),e.memory&&e.memory.memory_usage_ppm&&(s=a+", "+e.memory.memory_usage_ppm)}),i&&this.$(".efficiencyDetails.vcpu").html(i).show(),s&&this.$(".efficiencyDetails.memory").html(s).show()}}},renderSnapshot:function(){var e=u.DP;this.vmDiskCollection.clearCollection(),this.vmVolumeGroupCollection.clearCollection(),this.vmNicCollection.clearCollection();var n=this.model.get(i.DP.VM_CONFIG),s=n&&n[i.DP.SNAPSHOT_BOOT_CONFIG];this.$(".inputName").val(n[t.NAME]),this.$(".inputVcpus").val(n[i.DP.SNAPSHOT_NUM_VCPUS]),this.$(".inputCores").val(n[i.DP.SNAPSHOT_NUM_CPU_CORES]||1);var a=L.convertBytesToGiB(L.convertToBytes(n[i.DP.SNAPSHOT_MEMORY_MB],L.UOM_MIB,!1),4);this.$(".inputMemory").val(a),this.$(".osControls").hide(),this.$("section.affinityConfig").hide(),this.$("section.volumeGroupConfig").hide();var o=n[i.DP.SNAPSHOT_DISK_INFO],r=!1;_.each(o,function(a){var o={};if(!a[u.DP.VG_UUID]){o=a||{};var r=a[u.DP.DISK_ADDRESS],l=null;if(r&&(l={},l[u.DP.BUS_TYPE]=r[u.DP.BUS_TYPE],l[u.DP.DEVICE_INDEX]=r[u.DP.DEVICE_INDEX],l[u.DP.DISK_LABEL]=r[u.DP.DISK_LABEL]),o[u.DP.DISK_ADDRESS]=l||a.addr,o[t.ID]=a[e.DISK_CLONE]&&a[e.DISK_CLONE][e.DISK_UUID],a[u.DP.IS_CDROM]?o[u.DP.DISK_TYPE]=u.DISK_TYPES.CDROM:o[u.DP.DISK_TYPE]=u.DISK_TYPES.DISK,s&&s[e.DISK_ADDRESS]){var c=s[e.DISK_ADDRESS],d=c[e.BUS_TYPE],p=c[e.DEVICE_INDEX];if(d===r[e.BUS_TYPE]&&p===r[e.DEVICE_INDEX]){var h=o[e.DISK_TYPE].toLowerCase();s[i.DP.VM_BOOT_DEVICE_TYPE]=h,n[i.DP.SNAPSHOT_BOOT_CONFIG]=s,this.model.set(i.DP.VM_CONFIG,n)}}this.addStorageModel(o)}},this),_.each(n[i.DP.SNAPSHOT_NICS],function(e){var t=e||{},n=this.getNetworkModel(e[v.DP.NETWORK_UUID]);n?(t.vlanId=n.get("vlanId"),t[v.DP.MAC_ADDRESS]=O.generateClientUUID(),t.isNewNic=!0,this.addNicModel(t)):r=!0},this),this.isSnapshotClone()&&(this.renderClone(),r&&this.showHeaderWarning(this.i18n("deleted_network_clone_warning")))},renderClone:function(){this.isSnapshotClone()||this.renderUpdate(!0),this.$(".btnAddStorage").attr("disabled",!0),this.$(".btnAddGpu").addClass("disabled"),this.setDefaultCloneName(),this.renderCloneGroup()},setDefaultCloneName:function(){var e=this.model.get(t.NAME);e||(e=(this.model.get(i.DP.VM_CONFIG)||{})[t.NAME]);var n=e+"1",s=this.$(".inputName").val().trim();this.cloneCount=Number(this.$(".inputCloneCount").val().trim()),this.defaultCloneName=s&&s!==n&&s!==e?s:this.cloneCount>1?e:n,this.$(".inputName").val(this.defaultCloneName)},renderCloneGroup:function(){this.cloneCount=Number(this.$(".inputCloneCount").val().trim()),this.cloneCount>1?(this.$(".nameGroup").addClass("-show-single-clone-group"),this.$(".nameGroup").addClass("-show-multi-clone-group"),this.renderCloneExampleString()):(this.$(".nameGroup").addClass("-show-single-clone-group"),this.$(".nameGroup").removeClass("-show-multi-clone-group"),this.$(".inputName").trigger("input"))},renderCloneExampleString:function(){var e=this.$(".inputName").val(),t=Number(this.$(".inputSuffix").val().trim()),n=this.i18ns("cloneExample",Y.getCloneNames(this.cloneCount,e,t,3).join(", "));this.$(".cloneExample").html(n)},renderSnapshotDetails:function(e){this.renderSnapshotClone(e),this.$(".n-popup-description").html(this.DESCRIPTION_SNAPSHOT_DETAILS),this.$(".inputSnapshotTime").val(U.formatDateTime(this.snapshotModel.get(this.snapshotModel.DP.CREATED_TIME)/1e3)),this.$(".inputSnapshotTime").closest(".controlGroup").show(),this.$(".n-title").text("Snapshot Details"),this.$("input").attr("disabled",!0),this.$(".btn").hide(),this.$(".cell-actions *").remove(),this.$(".cell-actions").append("&nbsp;")},renderMigrate:function(e){this.showMigrateForm(e,!0)},renderTakeSnapshot:function(e){this.showSnapshotForm(e,!0)},renderSnapshotClone:function(e){var t={};t[i.DP.VM_CONFIG]=this.snapshotModel.get(this.snapshotModel.DP.CREATE_SPEC);var n=t[i.DP.VM_CONFIG]?t[i.DP.VM_CONFIG][v.DP.NICS]:[];_.each(n,function(e){delete e[v.DP.MAC_ADDRESS],delete e[v.DP.REQ_IP_ADDRESS]});var s=(t[i.DP.VM_CONFIG]||{})[this.snapshotModel.DP.VM_GPUS];_.each(s,function(e){var t={};t[C.DP.DEVICE_ID]=e.deviceId,t[C.DP.GPU_TYPE]=e.gpuType,t[C.DP.GPU_VENDOR]=e.gpuVendor;var n=G.getGpuIdentifier(t,C.DP),i=this.pGpuCollection.findModelByIdentifier(n)||this.vGpuProfileCollection.findModelByIdentifier(n);i&&this.vmGpuCollection.add(i.toJSON())},this),delete t[i.DP.VM_CONFIG][this.snapshotModel.DP.VM_GPUS],this.model=new i(t),this.model.setProxyClusterUuid(this.proxyClusterUuid),this.showVmForm(e,!1),this.$(".btnAddGpu").addClass("disabled")},renderPowerStateChange:function(e){this.showPowerStateChangeForm(e,!1)},showNicForm:function(e,t,n){this.mode=e,this.clearHeader(),this.$(".n-title").text(D.ACTION_NAMES[e]+" NIC"),this.$(".btnCancel").html("Cancel"),n&&(this.currentNicModel=this.vmNicCollection.findModelById(n));var i=this.subViewHelper.get(this.SUBVIEWS.VM_NIC_FORM);i||(i=new X,i.setParentView(this),this.subViewHelper.register(this.SUBVIEWS.VM_NIC_FORM,i));var s=this.$("#vmNetworkFormWrapper");i.setViewOption({el:s,model:this.currentNicModel,mode:e,networkLinkTemplate:le,isEsx:this.isEsx(),isHyperv:this.isHyperV(),isPowerPc:this.isPowerPcCluster(),isPC:w.isMulticlusterNavMode(),editMode:e!==D.ACTION_CREATE,isNicDisconnectSupported:this.isNicDisconnectSupported(),macAddress:n}),i.render();var a=n?this.i18nStatic("Common","save"):this.i18nStatic("Common","add");this.$(".n-btn-form").hide(),this.$(".btnUpdate").show().text(a),this.hideSubview("#vmMainPage"),this.showSubview("#vmNetworkFormPage","left")},showMigrateForm:function(e,n){this.mode=e,this.clearHeader(),this.$("#vmMigrateFormWrapper").html(J(this.vtOptions()));var i=this.model.getAffineHostList(),s=this.hostCollection.models;if(!_.isEmpty(i))if(1===i.length){s=[];var a=this.hostCollection.find(function(e){return e.get(t.UUID)===i[0]},this);a&&this.showHeaderInfo(pe({name:a.get(t.NAME)}))}else this.showHeaderInfo(de({count:i.length,total:this.hostCollection.length})),s=this.hostCollection.filter(function(e){return _.indexOf(i,e.get(t.UUID))>=0},this);s=_.filter(s,function(e){return!e.isHAReserved()},this);var o=_.sortBy(s,function(e){return e.get(e.nameAttribute)});_.each(o,function(e){this.$(".migrateHost").append('<option value="'+e.get(t.UUID)+'">'+e.get(e.nameAttribute)+"&nbsp;&nbsp;&nbsp;("+e.get(t.HYPERVISOR_IP)+")</option>")},this),_.isEmpty(o)&&this.$(".hostWrapper").hide(),this.$(".n-title").text(D.ACTION_NAMES[e]+" VM"),this.hideSubview("#vmMainPage"),this.showSubview("#vmMigrateFormPage","left",!0),this.applyNutanixInput({types:["select"]}),this.$(".migrateHost").focus(),this.$(".n-btn-form").hide(),this.$(".btnUpdate").show().text("Migrate")},showSnapshotForm:function(e,t){this.mode=e,this.clearHeader(),this.showHeaderInfo(this.i18n("snapshotNoVg")),this.$("#vmSnapshotFormWrapper").html(Z(this.vtOptions())),this.$(".n-title").text(D.ACTION_NAMES[e]+" Snapshot"),this.hideSubview("#vmMainPage"),this.showSubview("#vmSnapshotFormPage","left",!0),this.$(".snapshotName").focus(),this.$(".n-btn-form").hide(),this.$(".btnUpdate").show().text("Submit")},showStorageForm:function(e,t,n){this.mode=e;var i=this.subViewHelper.get(this.SUBVIEWS.VM_STORAGE_FORM);i||(i=new q,i.setParentView(this),this.subViewHelper.register(this.SUBVIEWS.VM_STORAGE_FORM,i)),this.clearHeader(),this.isDiskSizeDirty=!1,this.currentDiskModel=n;var s=this.$("#vmStorageFormWrapper");i.setViewOption({el:s,model:this.currentDiskModel,mode:this.mode,isEsx:this.isEsx(),isHyperv:this.isHyperV(),isPowerPc:this.isPowerPcCluster(),isPC:w.isMulticlusterNavMode()}),i.render();var a=D.ACTION_NAMES[this.mode];this.$(".n-title").text(a+" Disk"),this.$(".btnCancel").html("Cancel"),this.hideSubview("#vmMainPage"),this.showSubview("#vmStorageFormPage","left"),this.$(".n-btn-form").hide(),this.$(".btnUpdate").show().text("Add"),this.hypervisorType===D.HYPERVISOR_TYPE.ESXI&&this.$(".inputDiskOperation").find('option[value="'+u.OPERATION_TYPES.CLONE_IMAGE+'"]').remove(),this.$(".imageHelp").nutanixMoreInfo({title:this.i18n("imageListHelpMessage"),placement:D.TOOLTIP_POSITION.RIGHT,container:"body",classes:["-nudge-down"]}),this.currentDiskModel&&this.$(".btnUpdate").text("Update")},renderVolumeGroupSelect:function(){if(this.volumeGroupCollection.length){var e=[];this.vmVolumeGroupCollection.each(function(t){e.push(t.getId())},this),this.$("#vmVolumeGroupForm .noVolumeGroupWrapper").hide(),this.$("#vmVolumeGroupForm .volumeGroupSelectWrapper").show(),this.$("#vmVolumeGroupForm .volumeGroupSelect").empty(),this.volumeGroupCollection.each(function(n){_.indexOf(e,n.get(t.UUID))<0&&this.$("#vmVolumeGroupForm .volumeGroupSelect").append('<option value="'+n.get(t.UUID)+'">'+n.get(t.NAME)+"</option>")},this),this.$("#vmVolumeGroupForm .volumeGroupSelect").trigger("update").trigger("enable")}else this.$("#vmVolumeGroupForm .noVolumeGroupWrapper").show(),this.$("#vmVolumeGroupForm .volumeGroupSelectWrapper").hide()},showVolumeGroupForm:function(e,t,n){this.mode=e,this.clearHeader(),this.$(".n-title").text(D.ACTION_NAMES[e]+" Volume Group"),this.$(".btnCancel").html("Cancel"),this.renderVolumeGroupSelect(),this.hideSubview("#vmMainPage"),this.showSubview("#vmVolumeGroupFormPage","left"),this.$(".n-btn-form").hide(),this.$(".btnUpdate").show().text("Add"),this.currentDiskModel=this.vmDiskCollection.findModelById(n),this.applyNutanixInput({types:["select"]})},showVmForm:function(e,t,n){this.mode=e,this.clearHeader(),this.currentDiskModel=null;var i=D.ENTITY_NAMES[this.actionRoute[D.NAV_ACTION_TARGET]];this.$(".n-title").text(D.ACTION_NAMES[e]+" "+i),this.initialized||(this.initialized=!0,this.isActionShow()||this.isSnapshotClone()?this.renderSnapshot():this.isActionClone()?this.renderClone():this.isActionUpdate()&&this.renderUpdate(n)),this.isActionUpdate()&&this.$(".btnCancel").html("Close"),this.isVmCustomizationSupported()||this.$(".cloudInitConfig").hide(),this.isAgentVmSupported()||this.$(".agentControls").hide(),this.isVmHostAffinitySupported()||this.$("section.affinityConfig").hide(),this.isActionCreate()||this.isActionUpdate()||(this.$(".descControls").hide(),this.$(".timezoneControls").hide()),this.initGuestOsAutoComplete(),this.populateHosts(),this.renderGpuTable(),this.renderDisksTable(),this.renderBootConfigSection(),this.renderVolumeGroupTable(),this.renderNicsTable(this.vmNicCollection),this.renderAffinedHosts(),this.$("#vmMainPage").show(),this.$(".inputName").focus(),$(".n-modal-body").scrollTop(this.scrollTopPosition),this.scrollTopPosition=0,this.hideSubview("#vmNetworkFormPage"),this.hideSubview("#vmStorageFormPage"),this.hideSubview("#vmVolumeGroupFormPage"),this.hideSubview("#vmAffinityPage"),this.hideSubview("#vmGpuPage"),this.showSubview("#vmMainPage","left"),this.$(".n-btn-form").show(),this.$(".btnBack").hide(),this.$(".btnUpdate").show().text("Save"),this.applyHypervisorViewFilter(),this.applyNutanixInput(),this.isActionAffinity()&&this.showHostAffinityForm(),this.isActionUpdate()&&(this.isVmFlashModeSupported()&&this.$(".flashModeConfig").show(),this.$(".vmFlashHelp").nutanixMoreInfo({container:"body",title:this.VM_FLASH_MODE_MSG})),this.$(".inputMemoryTooltip").nutanixMoreInfo({classes:["-nudge-up"],title:this.i18n("memory_info"),placement:"top",container:"body"}),this.model.isPCVM()&&this.isActionUpdate()&&this.updateFormforPCVM()},updateFormforPCVM:function(){this.showHeaderInfo(this.i18n("pcvm_edit_info")),this.$(".descControls,.cloudInitConfig,.flashModeConfig,.diskConfig .btnEject,.diskConfig .btnDelete,.diskConfig .action-separator,.nicConfig .btnEdit,.nicConfig .btnDelete,.nicConfig .action-separator,.affinityConfig .btn-add,.affinityConfig .btnDelete").hide(),this._addGreaterThanEqualsCondition(this.$(".inputVcpus"),this.model.get(i.DP.VM_NUM_VCPUS),i.DP.VM_NUM_VCPUS,this.i18n("vcpus")),this._addGreaterThanEqualsCondition(this.$(".inputMemory"),Number(this.$(".inputMemory").val().trim()),i.DP.VM_MEMORY_MB,this.i18n("memory"))},_addGreaterThanEqualsCondition:function(e,t,n,i){e.attr(D.FORM_SELECTORS.VALIDATE_MODEL_ATTR,W.RULE.IS_GREATER_THAN_EQUALS).attr(D.FORM_SELECTORS.VALIDATE_MODEL_ARGS,"min="+t+",isInclusive="+D.BOOLEAN_TRUE).attr(D.FORM_SELECTORS.DATA_MODEL_ATTR,n).attr(D.FORM_SELECTORS.DATA_MODEL_ATTR_NAME,i)},validateForm:function(e){var t=W.validateFormValues(e);if(t.length){var n=W.defaultErrorHandler(e,t);if(n)return n}return!1},showHostAffinityForm:function(){this.$(".n-title").text(this.HOST_AFFINITY_TITLE);var e=this.subViewHelper.get(this.SUBVIEWS.VM_HOST_AFFINITY_VIEW);e||(e=new z,e.setParentView(this),this.subViewHelper.register(this.SUBVIEWS.VM_HOST_AFFINITY_VIEW,e)),this.subViewHelper.render(this.SUBVIEWS.VM_HOST_AFFINITY_VIEW),this.clearHeader(),this.hideSubview("#vmMainPage"),this.showSubview("#vmAffinityPage","left")},applyHypervisorViewFilter:function(){var e=!1;this.hypervisorType===D.HYPERVISOR_TYPE.ESXI?(this.mode===D.ACTION_POWER_OFF?(this.$("#vmPowerStateChangeForm .ahv").hide(),this.model.isToolsRunning()||this.$("#vmPowerStateChangeForm .guest").hide()):(this.$("section.volumeGroupConfig").hide(),this.isActionCreate()||(e=!0)),this.$(".cloudInitConfig").hide()):this.hypervisorType!==D.HYPERVISOR_TYPE.KVM&&this.hypervisorType!==D.HYPERVISOR_TYPE.NULL||(this.mode===D.ACTION_POWER_OFF?(this.$("#vmPowerStateChangeForm .esx:not(.ahv)").hide(),this.$("#acpi-shutdown").prop("checked",!0)):e=!0),this.isHyperV()&&(this.$(".genControls").removeClass("hide"),this.$(".hostControls").removeClass("hide"),this.$(".locControls").removeClass("hide"),this.$(".dyn-mem-controls").removeClass("hide"),this.$(".coreControls").addClass("hide"),this.$(".osControls").hide(),this.$("section.volumeGroupConfig").hide(),this.isActionUpdate()&&this.$("section.advConfig").removeClass("hide"),this.mode===D.ACTION_POWER_OFF&&this.$("#vmPowerStateChangeForm .ahv,\n              #vmPowerStateChangeForm .esx").hide()),e&&this.$(".osControls").hide()},initGuestOsAutoComplete:function(){var e=this.$("#guestOs"),t=[];_.each(i.GUEST_OS_LIST,function(e,n){t.push({label:e,value:n})},this),e.autocomplete({source:t,delay:0,autoFocus:!0,select:function(t,n){return e.val(n.item.label),e.attr("data-os",n.item.value),!1}}).data("autocomplete").menu.element.addClass("modal-autocomplete")},showPowerStateChangeForm:function(e,t){this.mode=e,this.clearHeader(),this.$("#vmPowerStateChangeFormWrapper").html(ee(this.vtOptions({isHyperv:this.isHyperV()}))),this.$(".n-title").text(this.POWER_OFF_TITLE),this.hideSubview("#vmMainPage"),this.showSubview("#vmPowerStateChangeFormPage","left",!0),this.applyHypervisorViewFilter(),this.$(".n-btn-form").hide(),this.$(".btnUpdate").show().text("Submit")},createBusDeviceTypeMap:function(e){var t=u.V2_DP,n=t.BUS_TYPE,i=t.DEVICE_INDEX,s=t.DISK_ADDRESS,a=t.VMDISK_UUID,o=t.DEVICE_UUID,r=t.VOLUME_GROUP_UUID,l={};_.each(u.BUS_TYPES,function(e){l[e]=[]});var c=_.filter(e,function(e){return void 0!==e[s][i]}),d=_.filter(e,function(e){return void 0===e[s][i]});return _.each(c,function(e){var t=e[s];l[t[n]].push({diskUuid:t[r]||t[o]||t[a],device_index:t[i]})}),_.each(d,function(e){var t=e[s];l[t[n]].push({diskUuid:t[r]||t[o]||t[a],device_index:l[t[n]].length})}),l},renderDisksTable:function(){var e=this,n=!1;this.hypervisorType===D.HYPERVISOR_TYPE.ESXI&&(n=!0);var i=this.vtOptions(),s=x.SVGIcon("Eject","eject-icon"),a=x.SVGIcon("Eject","eject-icon disabled"),o=this.isActionUpdate()||this.isActionClone()?this.vmDiskCollection.sortByDiskAddress():this.vmDiskCollection.models,r=[];this.diskList=[];var l=this.isActionCreate()?_.map(o,function(e){return e.toUhuraDiskConfigJson()}):this.model.get(this.model.DP.VM_DISK_INFO);this.busDeviceTypeMap=this.createBusDeviceTypeMap(l),o.length&&_.each(o,function(o){var l="";if(O.isDisplayableNumber(o.get(o.DP.DISK_SIZE))&&(l+=l.length?"; ":"",l+="SIZE="+L.convertBytesToGiB(o.get(o.DP.DISK_SIZE),4)+"GiB"),o.get(o.DP.CONTAINER_ID)){var c=o.get(o.DP.CONTAINER_ID),d=e.containerCollection.findModelByUuid(c);l+=l.length?"; ":"",l+="CONTAINER="+d.get(t.NAME)}o.getDiskImagePath()&&(l+=l.length?"; ":"",l+="PATH="+o.getDiskImagePath());var p=o.DISK_TYPES.DISK;o.get(o.DP.IS_CDROM)&&(p=o.DISK_TYPES.CDROM,l+=l.length?"; ":"",l+="EMPTY="+!!o.get(o.DP.IS_EMPTY));var h=o.get(o.DP.IS_CDROM),m=o.get(o.DP.DISK_ADDRESS);m&&m[o.DP.BUS_TYPE]&&(l+=l.length?"; ":"",l+="BUS="+m[o.DP.BUS_TYPE]);var f="",v=m[o.DP.DEVICE_INDEX];if(m){var g=m[u.V2_DP.DISK_LABEL];g?f=g:_.isUndefined(v)||(f=m[o.DP.BUS_TYPE]+"."+v)}var E="",T=!1;o.isEmpty()||e.isActionClone()||e.isEsx()&&e.clusterModel&&!e.clusterModel.isEsxCdRomUpdateSupported()?(E=a,T=!0):E=s;var C=!1,S=!1;if(e.isActionUpdate()&&e.hypervisorType===D.HYPERVISOR_TYPE.ESXI&&!e.model.isFlashModeEnabled()&&(C=e.i18n("disable_disk_edit_esx_flash_mode")),h&&e.clusterModel&&e.clusterModel.isEsxCdRomUpdateSupported()&&(C=!1),e.isActionClone()&&(C=e.i18n("disable_storage_edit_clone"),S=e.i18n("disable_storage_delete_clone")),e.model.isPoweredOn()&&!o.isHotRemovable()&&(S=e.i18ns("disable_storage_delete_vm_on",m[u.DP.BUS_TYPE])),e.isHyperV()&&p===o.DISK_TYPES.DISK&&(C=!0),r.push(te({isESX:n,shouldShowUEFI:e.shouldShowUEFI(),type:p,isCdrom:h,action:e.mode,diskUuid:o.get(o.idAttribute),deviceBus:m[u.DP.BUS_TYPE],deviceIndex:m[u.DP.DEVICE_INDEX],address:f,parameters:l,isEmpty:o.get(o.DP.IS_EMPTY),canModify:e.canModifyByEntityType(D.ENTITY_ACROPOLIS_DISK),icon:E,disableBoot:e.isSnapshotClone(),disableEdit:C,disableDelete:S,disableEject:T,Components:i.Components,diskPath:o.getSourceDiskName()||""})),!h||!o.get(o.DP.IS_EMPTY)){var A=f,b=p,y=b+" ("+A+")",I=o.get(o.idAttribute);e.diskList.push({value:I,name:y})}},this);var c=[{className:"name-cell",title:"Type"},{className:"address-cell",title:"Address"},{className:"parameters",title:"Parameters"},{className:"cell-actions",title:"&nbsp;"}];n||this.shouldShowUEFI()||c.unshift({className:"boot-cell",title:"Boot Device"});var d=re(this.vtOptions({isCleanPopup:!0,className:"table-controls",btnClass:"btn-add btnAddStorage",dataTest:"vmAddStorageBtn",streamAction:"create",streamTarget:"disk",tableId:"storageList",dataTableTest:"vmStorageTable",emptyText:"You haven't added any disks yet.",btnText:"Add New Disk",title:"Disks",titleClass:"",tableHeaders:c,tableRows:r})),p=this.$("section.diskConfig"),h=p.find('#storageList [name="select-boot-device"]:checked').attr("id");p.html(d),this.isActionClone()&&p.find(".btnAddStorage").prop("disabled",!0).addClass("disabled"),this.isActionShow()&&p.find(".btnAddStorage").hide(),n||this.shouldShowUEFI()||this.showBootInDisksTable(h)},showBootInDisksTable:function(e){var n;this.model.get(i.DP.VM_CONFIG)&&(this.isSnapshotClone()||this.isActionShowSnapshot())?n=this.model.get(i.DP.VM_CONFIG)[i.DP.SNAPSHOT_BOOT_CONFIG]:this.model.get(i.DP.VM_BOOT)&&(n=this.model.get(i.DP.VM_BOOT));var s=void 0;if(!_.isUndefined(n)&&!_.isEmpty(n)){if(!_.contains(_.values(u.DISK_TYPES),(n[i.DP.VM_BOOT_DEVICE_TYPE]||"").toUpperCase()))return void this.$("#storageList radio").prop("checked",!1);var a,o;this.isSnapshotClone()||this.isActionShowSnapshot()?(a=n[u.DP.DISK_ADDRESS][u.DP.DEVICE_INDEX],o=n[u.DP.DISK_ADDRESS][u.DP.BUS_TYPE]):(a=n[u.V2_DP.DISK_ADDRESS][u.V2_DP.DEVICE_INDEX],o=n[u.V2_DP.DISK_ADDRESS][u.V2_DP.BUS_TYPE]);var r=this.vmDiskCollection.find(function(e){var t=e.get(u.DP.DISK_ADDRESS)||{};return t[u.DP.BUS_TYPE]===o&&parseInt(t[u.DP.DEVICE_INDEX],10)===parseInt(a,10)},this);r&&(this.isSnapshotClone()&&r.get(u.DP.DISK_CLONE)?s=r.get(u.DP.DISK_CLONE)[u.DP.DISK_UUID]:r.get(t.ID)&&(s=r.get(t.ID)))}var l=e||s;l&&this.$('input:radio[id="'+l+'"]').prop("checked",!0);var c=B[D.ENTITY_BOOT_DEVICE];if(c){var d=c.BOOT_DEVICE_MSG;if(d){this.$("td.boot-cell-disable").tooltip({title:d,placement:"right",trigger:"hover",html:!0,container:$("body")})}}},renderVolumeGroupTable:function(){if(!R.canUseFeat("abs_internal"))return void this.$("section.volumeGroupConfig").addClass("hide");var e=this.vmVolumeGroupCollection,t=[];e.length&&this.isActionUpdate()&&e.each(function(e){var n="",i=e.get(u.DP.DISK_ADDRESS);i&&i[u.DP.BUS_TYPE]&&(n+=n.length?"; ":"",n+="BUS="+i[u.DP.BUS_TYPE]);var s="";i&&void 0!==i[u.DP.DEVICE_INDEX]&&(s=i[u.DP.BUS_TYPE]+"."+i[u.DP.DEVICE_INDEX]),t.push(ie({action:this.mode,name:e.get("name"),address:s,vgUuid:e.getId(),canModify:this.canModifyByEntityType(D.ENTITY_ACROPOLIS_DISK)}))},this);var n=[{className:"name-cell",title:"Name"},{className:"address-cell",title:"Address"},{className:"cell-actions",title:"&nbsp;"}],i="You haven't added any volume groups yet.";this.isActionCreate()&&(i="Please create a VM before you can add a volume group.");var s=re(this.vtOptions({isCleanPopup:!0,className:"table-controls",btnClass:"btn-add btnAddVolumeGroup",dataTest:"vmAddVolumeGroupBtn",streamAction:"create",streamTarget:"volumegroup",tableId:"volumeGroupList",dataTableTest:"vmVolumeGroupTable",emptyText:i,btnText:"Add Volume Group",title:"Volume Groups",titleClass:"",tableHeaders:n,tableRows:t})),a=this.$("section.volumeGroupConfig");a.html(s);var o=a.find(".btnAddVolumeGroup");this.isActionUpdate()?o.prop("disabled",!1):o.prop("disabled",!0),this.isActionUpdate()||this.disableButton("#volumeGroupList tr:last-child .btnDelete")},renderNicsTable:function(e){var t=[],n=[{className:"vlanid-cell",title:this.i18n("networkId")},{className:"network-cell",
title:this.isHyperV()?this.i18n("vswitch"):this.i18n("networkName")},{className:"macaddress-cell",title:this.i18n("macAddress")},{className:"req-ip-cell",title:this.i18n("reqIp")},{className:"cell-actions",title:"&nbsp;"}],i=this.isActionClone()&&this.hypervisorType===D.HYPERVISOR_TYPE.ESXI;if(e.length){var s=[];e.each(function(e){var t=e.get(e.DP.MAC_ADDRESS)||"",n=this.getNicVlanId(e),a=this.getNetworkModel(e.get(v.DP.NETWORK_UUID)),o="";a&&(o=a.get(E.DP.NAME)),s.push({vlanId:n,networkName:o,macAddress:t,isNewNic:e.isNewNic,requestedIp:e.get(e.DP.REQ_IP_ADDRESS),canModify:this.canModifyByEntityType(D.ENTITY_ACROPOLIS_NIC),disableDelete:i,disableEdit:i||!this.isNicUpdateSupported()})},this),_.each(_.sortBy(s,me.VLAN_ID),function(e){t.push(se(e))})}var a=re(this.vtOptions({isCleanPopup:!0,className:"table-controls",btnClass:"btn-add btnCreateNetwork",dataTest:"vmCreateNetworkBtn",streamAction:"create",streamTarget:"nic",tableId:"nicList",dataTableTest:"vmNicTable",emptyText:"You haven't added any NICs yet.",btnText:"Add New NIC",title:"Network Adapters (NIC)",titleClass:"",tableHeaders:n,tableRows:t})),o=this.$("section.nicConfig");o.html(a),i&&o.find(".btnCreateNetwork").prop("disabled",!0).addClass("disabled"),this.isActionShow()&&o.find(".btnCreateNetwork").hide()},getNicVlanId:function(e){var t=this.getNetworkModel(e.get(v.DP.NETWORK_UUID)),n="";return t&&(n=_.isUndefined(t.get(v.V2_DP.VLAN_ID))?_.isUndefined(t.get(E.DP.VLAN_ID))?t.get(E.DP.NAME):E.VLAN_PREFIX+t.get(E.DP.VLAN_ID):E.VLAN_PREFIX+t.get(v.V2_DP.VLAN_ID)),this.isHyperV()&&(n=e.get(v.DP.VLAN_ID)||""),n},renderAffinedHosts:function(){var e=[],n=[{className:"host-cell",title:"Host"}];if(this.isVmHostAffinitySupported()){var i=this.canModifyByEntityType(D.ENTITY_VM);this.model.getPoweredOnHostUuid();this.vmAffineHostCollection&&this.vmAffineHostCollection.length&&this.vmAffineHostCollection.each(function(n){e.push(ae({id:n.get(t.UUID),name:n.get(t.NAME),disabled:this.isActionClone(),canModify:i}))},this);var s=re(this.vtOptions({isCleanPopup:!0,className:"table-controls",btnClass:"btn-add btnSetAffinity",dataTest:"vmSetAffinityBtn",streamAction:"set",streamTarget:"affinity",tableId:"affinityList",dataTableTest:"vmAffinityTable",btnText:this.i18n("affinityActionAdd"),title:this.i18n("affinitySectionTitle"),titleClass:"sectionHeader",emptyText:this.i18n("emptyText"),tableHeaders:n,tableRows:e,tableDesc:""})),a=this.$("section.affinityConfig");a.html(s),i&&!this.isActionClone()||a.find(".btnSetAffinity").prop("disabled",!0).addClass("disabled"),this.isActionClone()&&a.find(".sectionHeader").prepend('<input type="checkbox" id="clone-affinity"><span>Clone</span>')}},renderGpuTable:function(){var e=this;if(!this.isGpuPassthruSupported()&&this.vmGpuCollection.isEmpty())return void this.$("section.gpuConfig").addClass("hide");var t=[],n=this.model.isPoweredOn()||this.isActionClone(),i=this.vmGpuCollection.hasVgpu(),s=this.i18n("noHotPlug");this.vmGpuCollection.each(function(i,a){var o=i.getGpuName(),r=i.getGpuType()===C.GPU_TYPE.VIRTUAL?e.i18n("vgpu"):e.i18n("passthrough"),l=i.isUnknown();t.push(oe({id:a,name:o,type:r,isUnknown:l,disableEdit:n,disabledTooltip:s,canModify:e.canModifyByEntityType(D.ENTITY_VM)}))});var a=[{className:"name-cell",title:this.i18n("gpuName")},{className:"type-cell",title:this.i18n("gpuType")},{className:"cell-actions",title:"&nbsp;"}],o=re(this.vtOptions({isCleanPopup:!0,className:"table-controls",btnClass:"btn-add btnAddGpu",dataTest:"gpuAddBtn",streamAction:"add",streamTarget:"gpu",tableId:"gpuList",dataTableTest:"gpuTable",emptyText:this.i18n("gpuEmptyText"),btnText:this.i18n("gpuBtnText"),title:this.i18n("gpuTitle"),titleClass:"",tableHeaders:a,tableRows:t})),r=this.$("section.gpuConfig");r.html(o),$(".unknownGpuMoreInfo").nutanixMoreInfo({container:"body",icon:"Circular_Exclamation",title:this.i18n("unknownGpuExplanation")}),(n||i)&&r.find(".btnAddGpu").prop("disabled",!0).addClass("disabled").attr("title",s)},populateHosts:function(){if(this.isHyperV()){var e=this.$("select.host");e.empty(),this.hostCollection.each(function(n){var i=n.get(t.UUID),s=n.get(t.NAME);e.append("<option value="+i+">"+s+"</option>")}),e.trigger("enable").trigger("update")}},showPathDropDown:function(e){var t=this,n=e||this.$(".adsfPath"),i=this.vdiskCollection.getFiles(),s=i.sort();n.autocomplete("destroy"),n.autocomplete({source:s,delay:0,autoFocus:!0,open:function(e,n){t.$("#inputUsername").addClass("noBottomBorder")},close:function(e,n){t.$("#inputUsername").removeClass("noBottomBorder")}}).data("autocomplete").menu.element.addClass("modal-autocomplete"),n.autocomplete("search",n.val()).focus()},onSaveClick:function(){var e,n=this,s={};if(this.clearHeader(),this._isNetworkFormVisible())this.nicFormSaveClick();else if(this._isStorageFormVisible())this.storageFormSaveClick();else if(this._isVolumeGroupFormVisible())this.volumeGroupFormSaveClick();else if(this.$("#vmMigrateFormPage").is(":visible"))this.migrateFormSaveClick();else if(this.$("#vmPowerStateChangeFormPage").is(":visible"))this.powerStateChangeFormSaveClick();else if(this.$("#vmSnapshotFormPage").is(":visible"))this.snapshotFormSaveClick();else if(this._isGpuFormVisible())this.gpuFormSaveClick();else if(this._isHostAffinityFormVisible()){var a=this.subViewHelper.get(this.SUBVIEWS.VM_HOST_AFFINITY_VIEW);a&&(this.vmAffineHostCollection=null,this.vmAffineHostCollection=new c,e=a.getSelectedHosts(),_.each(e,function(e){this.vmAffineHostCollection.add(e)},this),this.isActionAffinity()?this.updateVmHostAffinity():(this.showVmForm(this.actionRoute[D.NAV_ACTION],!0),this.scrollToBottom()))}else{var o=this.validateForm(this.$el.find("#vmMainPage"));if(o)return void this.showHeaderError(o);var r=function(e){n.$(".btnUpdate").prop("disabled",e)};r(!0),s[t.NAME]=this.$(".inputName").val(),s[i.DP.VM_DESCRIPTION]=this.$(".inputDesc").val(),s[this.model.DP.VM_TIMEZONE]=this.$(".timezone").val(),s[this.model.DP.VM_NUM_VCPUS]=Number(this.$(".inputVcpus").val().trim()),s[this.model.DP.VM_NUM_CPU_CORES]=Number(this.$(".inputCores").val().trim()),s[this.model.DP.VM_MEMORY_MB]=Math.ceil(Number(this.$(".inputMemory").val().trim())*L.STORAGE_BINARY_UOM.GiB/L.STORAGE_BINARY_UOM.MiB),this.isEsx()||(this.shouldShowUEFI()?s[this.model.DP.VM_BOOT]=this.createBootConfigFromBootConfigSection():_.isEmpty(this.createBootConfigFromDisksTable())||(s[this.model.DP.VM_BOOT]=this.createBootConfigFromDisksTable()));var l=[],d=this.$("#guestOs");if(d.is(":visible")&&(s[i.DP.VM_GUEST_OS]=d.attr("data-os")),this.$(".flashModeConfig").is(":visible")){var p=this.$(".flashMode").is(":checked");s[i.DP.VM_FEATURES]={},s[i.DP.VM_FEATURES][t.VM_FLASH_MODE]=p}this.$(".agentControls").is(":visible")&&(s[i.DP.VM_FEATURES]=s[i.DP.VM_FEATURES]||{},s[i.DP.VM_FEATURES][i.DP.VM_AGENT]=this.$(".agentVm").is(":checked"));var u=this.$(".generation");u.is(":visible")&&(s[i.DP.VM_GENERATION]=u.val());var h=this.$(".host");h.is(":visible")&&(s[i.DP.VM_HOST_UUID]=h.val());var m=this.$("#location");m.is(":visible")&&(s[i.DP.VM_PATH]=m.val());var f=this.$(".dyn-mem");if(f.is(":visible")&&(s[i.DP.VM_DYNAMIC_MEMORY]=f.is(":checked")),this.$("#toggleAdv").is(":visible")&&(s[i.DP.VM_AUTO_START_ACTION]=this.$(".autoStartAction").val(),s[i.DP.AUTO_STOP_ACTION]=this.$(".autoStopAction").val()),this.isVmCustomizationSupported()&&this.$("#toggleVmCustom").is(":checked")){s[i.DP.VM_CUSTOMIZATION_CONFIG]={},s[i.DP.VM_FILES_TO_INJECT_LIST]=[];var v=this.$('input[name="scriptSource"]:checked').val();if("upload"===v){var g=this.$('#vmCustomSection input[type="file"]')[0];g.files.length&&g.files[0]&&l.push(O.readFileSync(g.files[0],function(e){s[i.DP.VM_CUSTOMIZATION_CONFIG][i.DP.VM_USERDATA]=e},function(e){n.showHeaderError("Error reading file: "+e.toString())}))}else if(v===this.CLOUDINIT_RADIO_OPTIONS.PATH&&this.$("#vmCustomSection .scriptPath").val().trim()){var E=this.$("#vmCustomSection .scriptPath").val().trim();s[i.DP.VM_CUSTOMIZATION_CONFIG][i.DP.VM_USERDATA_PATH]=D.ADSF_PATH_PREFIX+E}else v===this.CLOUDINIT_RADIO_OPTIONS.PASTE&&this.$("#vmCustomSection .scriptPaste").val().trim()&&(s[i.DP.VM_CUSTOMIZATION_CONFIG][i.DP.VM_USERDATA]=this.$("#vmCustomSection .scriptPaste").val().trim());this.$("#vmCustomSection .pathMap").each(function(e,t){var n=$(t),a=n.find(".srcPath").val().trim(),o=n.find(".destPath").val().trim();if(a&&o){var r={};r[i.DP.SOURCE_PATH]=D.ADSF_PATH_PREFIX+a,r[i.DP.DESTINATION_PATH]=o,s[i.DP.VM_FILES_TO_INJECT_LIST].push(r)}})}e=[],this.vmAffineHostCollection.each(function(n){e.push(n.get(t.UUID))},this),e&&e.length&&(s[i.DP.VM_AFFINE_HOST_LIST]=e);var T=this.$("#clone-affinity");if(T.length&&(s[i.DP.VM_CLONE_AFFINITY]=T.is(":checked")),this.isGpuPassthruSupported()||!this.vmGpuCollection.isEmpty()){var S=[];this.vmGpuCollection.each(function(e){var t={},n=e.get(C.DP.GPU_CONFIG);t[C.DP.DEVICE_ID]=e.getDeviceId(),t[C.DP.GPU_VENDOR]=n[C.DP.GPU_VENDOR],t[C.DP.GPU_TYPE]=n[C.DP.GPU_TYPE],S.push(t)},this),s[i.DP.VM_GPUS]=S}var A=function(){r(!1)},b=function(){r(!1)};$.when.apply($,l).then(function(){if(n.isActionCreate())n.createVm(s).then(A,b);else if(n.isActionUpdate())n.updateVm(s).then(A,b);else if(n.isActionClone())if(n.isValidCloneCount()){if(n.cloneCount>1){var e=n.$(".inputName").val(),i=Number(n.$(".inputSuffix").val().trim());s[t.NAME]=Y.getCloneNames(n.cloneCount,e,i)}n.actionRoute[D.NAV_ACTION_TARGET]===D.ENTITY_ACROPOLIS_SNAPSHOT?n.cloneSnapshot(s).then(A,b):n.cloneVm(s).then(A,b)}else r(!1);else r(!1)},function(){r(!1)})}},updateVmHostAffinity:function(){var e={};e[i.DP.VM_DESCRIPTION]=this.model.get(i.DP.VM_DESCRIPTION),e[i.DP.VM_MEMORY_MB]=this.model.get(i.DP.VM_MEMORY_MB),e[this.model.nameAttribute]=this.model.get(this.model.nameAttribute),e[i.DP.VM_NUM_CPU_CORES]=this.model.get(i.DP.VM_NUM_CPU_CORES),e[i.DP.VM_NUM_VCPUS]=this.model.get(i.DP.VM_NUM_VCPUS),e[i.DP.VM_FEATURES]=this.model.get(i.DP.VM_FEATURES);var n=this.model.get(i.DP.VM_GPUS);_.isEmpty(n)||(e[i.DP.VM_GPUS]=n);var s=[];this.vmAffineHostCollection.each(function(e){s.push(e.get(t.UUID))},this),s&&s.length&&(e[i.DP.VM_AFFINE_HOST_LIST]=s),this.updateVm(e)},toggleCustomizationControls:function(){var e=this;this.$("#vmCustomSection").toggle("fast",function(){e.scrollToBottom()})},toggleAdvancedSettings:function(){this.$(".advConfigContents").toggle("fast")},onBackClick:function(){this.clearHeader()},onChangeDiskSize:function(){this.isDiskSizeDirty=!0},onEnterKeyPress:function(){this.onSaveClick()},onAddNetworkClick:function(e){this.$el.hide(),this.isFanout?y.executeAction({actionTarget:D.ENTITY_ACROPOLIS_NETWORK,actionParentId:this.proxyClusterUuid,actionParentEntityType:D.ENTITY_CLUSTER,action:D.ACTION_CREATE}):y.executeActionElement(e.currentTarget),$("body").one(n.POPUP_CLOSE,this.onNetworkPopupClosed)},onNetworkPopupClosed:function(e,t){if(t&&t.actionTarget===D.ENTITY_ACROPOLIS_NETWORK){var n=this;this.$el.show();var i=this.networkCollection.fetch();i&&i.done(function(){n.showNicForm(n.mode,!0),n.$("select.vlans").trigger("update")}).fail(function(e,t,i){n.showHeaderError(O.processAjaxError(e.responseText)||"Failed to refresh networks.")})}},onAddImageLinkClick:function(e){this.$el.hide(),y.executeActionElement(e.currentTarget),$("body").one(n.POPUP_CLOSE,this.onImagePopupClosed)},onImagePopupClosed:function(e,t){if(t&&t.actionTarget===D.ENTITY_ACROPOLIS_IMAGE){var n=this;this.$el.show();var i=this.imageCollection.fetch();i&&i.done(function(){n.storageFormView.populateImages()}).fail(function(e,t,i){n.showHeaderError(O.processAjaxError(e.responseText)||"Failed to refresh images.")})}},onAddVolumeGroupLinkClick:function(e){this.$el.hide(),y.executeActionElement(e.currentTarget),n.onAppEventOnce(n.POPUP_CLOSE,this.onVolumeGroupPopupClosed)},onVolumeGroupPopupClosed:function(e,t){if(t&&t.actionTarget===D.ENTITY_ACROPOLIS_VOLUME_GROUP){var n=this;this.$el.show();var i=this.volumeGroupCollection.fetch();i&&i.done(function(){n.renderVolumeGroupSelect()}).fail(function(e,t,i){n.showHeaderError(O.processAjaxError(e.responseText)||"Failed to refresh volume groups.")})}},onAddNic:function(){this.showNicForm(D.ACTION_CREATE,!0)},onAddStorage:function(e){$(e.currentTarget).is(":disabled")||(this.scrollTopPosition=$(".n-modal-body").scrollTop(),this.showStorageForm(D.ACTION_ADD,!0))},_findDiskModelFromTableRow:function(e){var t=e.attr("diskuuid");return this.vmDiskCollection.findModelById(t)},onRemoveStorage:function(e){$(e.currentTarget).hasClass("btnDisabled")||$.nutanixConfirm({msg:"Are you sure you want to delete the disk?<br>Any data associated with the disk will be lost.",yes:function(){var t=$(e.currentTarget).closest("td"),n=this._findDiskModelFromTableRow(t);this.deleteDisk(n)},yesText:"Yes",noText:"Cancel",context:this})},onUpdateStorage:function(e){if(!$(e.currentTarget).hasClass("btnDisabled")){var t=this._findDiskModelFromTableRow($(e.currentTarget).closest("td"));this.showStorageForm(D.ACTION_UPDATE,!0,t)}},onAddVolumeGroup:function(e){$(e.currentTarget).is(":disabled")||(this.$("#vmVolumeGroupFormWrapper").html(_.template(ne,this.vtOptions({model:{clusterUuid:this.actionRoute[D.NAV_ACTION_PARENT_ID]}}))),this.showVolumeGroupForm(D.ACTION_ADD,!0))},onRemoveVolumeGroup:function(e){$(e.currentTarget).hasClass("btnDisabled")||$.nutanixConfirm({msg:"Are you sure you want to delete the volume group?",yes:function(){var t=$(e.currentTarget).closest("td").attr("vgUuid"),n=this.vmVolumeGroupCollection.findModelById(t);this.removeVolumeGroup(n)},yesText:"Yes",noText:"Cancel",context:this})},onEjectCdrom:function(e){if(!$(e.currentTarget).hasClass("disabled")){var t=this._findDiskModelFromTableRow($(e.currentTarget).closest("td"));this.ejectCdrom(t)}},onRemoveNic:function(e){$.nutanixConfirm({msg:"Are you sure you want to delete the NIC?",yes:function(){var t=$(e.currentTarget).closest("td").attr("macaddress"),n=this.vmNicCollection.findModelById(t);this.deleteNic(n)},yesText:"Yes",noText:"Cancel",context:this})},onUpdateNic:function(e){if(!$(e.currentTarget).hasClass("btnDisabled")){var t=$(e.currentTarget).closest("td").attr("macaddress");this.showNicForm(D.ACTION_UPDATE,!0,t)}},showGpuForm:function(){this.$(".n-title").text(this.i18n("gpuBtnText"));var e=this.subViewHelper.get(this.SUBVIEWS.GPU_SELECT_VIEW);e||(e=new j({vGpuProfileCollection:this.vGpuProfileCollection,pGpuCollection:this.pGpuCollection}),e.setParentView(this),this.subViewHelper.register(this.SUBVIEWS.GPU_SELECT_VIEW,e)),this.subViewHelper.render(this.SUBVIEWS.GPU_SELECT_VIEW),this.clearHeader(),this.hideSubview("#vmMainPage"),this.showSubview("#vmGpuPage","left"),this.$(".btnUpdate").show().text(this.i18n("add")),this.applyNutanixInput({types:["select"]})},onRemoveGpu:function(e){var t=this;$(e.currentTarget).hasClass("btnDisabled")||$.nutanixConfirm({msg:this.i18n("confirmDeleteGpu"),yes:function(){var n=parseInt($(e.currentTarget).attr(D.NAV_ACTION_TARGET_ID),10),i=_.filter(t.vmGpuCollection.models,function(e,t){return t!==n},t);t.vmGpuCollection.reset(i),t.renderGpuTable()},yesText:D.LABEL_YES,noText:D.LABEL_NO,hideYes:!1,hideNo:!1,context:this})},_isNetworkFormVisible:function(){return this.$("#vmNetworkFormPage").is(":visible")},_isStorageFormVisible:function(){return this.$("#vmStorageFormPage").is(":visible")},_isVolumeGroupFormVisible:function(){return this.$("#vmVolumeGroupFormPage").is(":visible")},_isHostAffinityFormVisible:function(){return this.$("#vmAffinityPage").is(":visible")},_isGpuFormVisible:function(){return this.$("#vmGpuPage").is(":visible")},enableSaveButton:function(e){"boolean"==typeof e&&this.$(".btnUpdate").prop("disabled",!e)},onCancelClick:function(){this._isNetworkFormVisible()||this._isStorageFormVisible()||this._isVolumeGroupFormVisible()||this._isGpuFormVisible()||this._isHostAffinityFormVisible()&&!this.isActionAffinity()?(this.showVmForm(this.actionRoute[D.NAV_ACTION],!0),this.enableSaveButton(!0)):this.hide()},onDiskPathKeyUp:function(e){var t=this.$(e.currentTarget);if(191===e.keyCode){var n=this,i={};i.data={path:t.val()},i.force=!0,i.success=function(e){n.showPathDropDown(t)},this.vdiskCollection.fetch(i)}},onVmNameInputBlur:function(e){var n=this;if(this.cloneCount>1)return void this.renderCloneExampleString();var i=this.$(".inputName").val(),s=this.$("#labelAlertVmName"),a=O.getDisplayableId(n.actionRoute[D.NAV_ACTION_TARGET_ID]);this.vmCollection.fetch({data:{searchString:i,searchAttributeList:t.EB.VM.VM_NAME},success:function(e,o,r){var l=n.vmCollection.find(function(e){return e.get(t.UUID)!==a&&e.get(t.VM_NAME)===i});s.html(l?n.VM_NAME_IN_USE_WARNING:"")},error:function(e,t,n){O.log('VmPopupView: failed to load search results for VM name string "'+i+'"')}})},onCloneCountChange:function(e){var t=this.$(".inputSuffix").val().trim();t.length>10&&this.$(".inputSuffix").val(t.substring(0,10)),this.setDefaultCloneName(),this.renderCloneGroup()},onDiskModelError:function(e,t){var n="Error performing virtual disk operation:";D.ACTION_NAMES[e.actionMode]&&(n="Error performing "+D.ACTION_NAMES[e.actionMode].toLowerCase()+" of virtual disk:"),this.showHeaderErrorWithDetails(n,t.responseText||t)},performFanout:function(e){var t=V.createFanoutCollection(e.entityType||D.ENTITY_VM,e.action,e.model);return e.model.setProxyClusterUuid(this.proxyClusterUuid),t.performFanout({success:e.success,error:e.error,type:e.type})},onAddInjectFile:function(e){var t=this.$("#vmCustomSection .pathMapNew .srcPath"),n=this.$("#vmCustomSection .pathMapNew .destPath"),i=t.val().trim(),s=n.val().trim();i&&s&&(this.$("#vmCustomSection .pathMapNew").before(ce(this.vtOptions({id:"inject-"+Date.now(),source:i,destination:s}))),t.val(""),n.val(""))},onDeleteInjectFile:function(e){$.nutanixConfirm({msg:"Are you sure you want to delete this file path mapping?",yes:function(){var t=$(e.currentTarget).attr(D.NAV_ACTION_TARGET_ID);this.$("#"+t).remove()},yesText:"Yes",noText:"No",hideYes:!1,hideNo:!1,context:this})},onCustomScriptFileSelect:function(e){this.$("#customScriptUpload").prop("checked",!0)},onCustomScriptPathKey:function(e){this.$("#customScriptPath").prop("checked",!0)},onCustomScriptPasteKey:function(e){this.$("#customScriptPaste").prop("checked",!0)},onRemoveAffineHost:function(e){$(e.currentTarget).hasClass("btnDisabled")||$.nutanixConfirm({msg:this.REMOVE_HOST_PROMPT,yes:function(){var t=$(e.currentTarget).attr(D.NAV_ACTION_TARGET_ID),n=this.hostCollection.findModelByUuid(t);this.removeAffineHost(n),this.renderAffinedHosts()},yesText:D.LABEL_YES,noText:D.LABEL_NO,hideYes:!1,hideNo:!1,context:this})},isEsx:function(){return this.hypervisorType===D.HYPERVISOR_TYPE.ESXI},isHyperV:function(){return this.hypervisorType===D.HYPERVISOR_TYPE.HYPERV},isVmCustomizationSupported:function(){return!this.isHyperV()&&(this.isActionCreate()||this.isActionClone()&&this.actionRoute[D.NAV_ACTION_TARGET]!==D.ENTITY_ACROPOLIS_SNAPSHOT)},isVmHostAffinitySupported:function(){var e=w.getCurrentClusterUuid()||this.proxyClusterUuid;return e&&H.hasKVMOnly(e)&&this.clusterModel.isFFEnabled(D.FFLAGS.VM_HOST_AFFINITY)&&!w.isOneNodeCluster()},isNicDisconnectSupported:function(){return this.clusterModel.isNicDisconnectSupported()},isVmFlashModeSupported:function(){return this.clusterModel.isAmfOverEsxBasicSupported()&&!this.isHyperV()},isGpuPassthruSupported:function(){return H.hasKVMOnly(null,[this.hypervisorType])&&this.clusterModel.isGpuPassthroughSupported()&&this.pGpuCollection.models.length>0},isVirtualGpuSupported:function(){return H.hasKVMOnly(null,[this.hypervisorType])&&this.clusterModel.isVirtualGpuSupported()&&this.vGpuProfileCollection.models.length>0},isAgentVmSupported:function(){return this.hypervisorType===D.HYPERVISOR_TYPE.KVM&&this.clusterModel.isAgentVmSupported()&&(this.isActionCreate()||this.isActionUpdate())},isNicUpdateSupported:function(){return this.hypervisorType===D.HYPERVISOR_TYPE.KVM&&this.clusterModel.isNicUpdateSupported()&&(this.isActionCreate()||this.isActionUpdate())},isIntegerOnly:function(e){var t=e.key;return W.isNumber(t).valid},isIntegerOrFloat:function(e){var t=e.key;return!e.target.value.includes(".")&&"."===t||W.isNumber(t).valid},isValidCloneCount:function(){return this.cloneCount=Number(this.$(".inputCloneCount").val().trim()),!(!this.cloneCount||this.cloneCount<=0)||(this.showHeaderError("Enter a positive number for number of clones."),!1)},isSecondGenerationVm:function(){return!!this.isHyperV()&&(this.model.isSecondGeneration()||this.$(".generation").val()===i.VM_GENERATION.TWO)},shouldShowUEFI:function(){return(P.isPC()?w.getClusterModelByClusterUuid(this.proxyClusterUuid):w.getCurrentClusterModel()).isUefiBootSupported()},renderBootConfigSection:function(){if(this.isEsx()||!this.shouldShowUEFI())return void this.$(".bootConfig").hide();var e=this.getPrevBootConfig();this.setBootConfigForm(e),this.renderBootConfigSelect()},setBootConfigForm:function(e){var t=e.prevDevice,n=e.prevUefiBoot,s=this.getBootConfig();this.uefiBoot=s[i.DP.VM_BOOT_BY_UEFI];var a=_.isUndefined(n)?s[i.DP.VM_BOOT_BY_UEFI]:n,o=t||s[i.DP.VM_BOOT_DISK_UUID];a?this.$("#uefi").prop("checked",!0):(this.$("#legacy").prop("checked",!0),_.each(this.diskList,function(e){e.value===o&&(e.selected=!0)},this)),(this.isActionUpdate()||this.isActionClone()||this.isActionShowSnapshot())&&(this.model.isPoweredOn()||this.isSnapshotClone()||this.isActionShowSnapshot())&&(this.$("#legacy").prop("disabled",!0),this.$("#uefi").prop("disabled",!0),this.model.isPoweredOn()&&this.addToolTip('.n-radio[for="legacy"],.n-radio[for="uefi"]',this.i18n("boot_config_cannot_update_warning"))),this.addToolTip("#uefiTooltip",this.i18n("boot_config_uefi_info")),this.addDefaultOption()},renderBootConfigSelect:function(){var e=!0;!this.model.isPoweredOn()&&this.isBootByLegacy()&&this.diskList.length>1&&(e=!1),(this.isSnapshotClone()||this.isActionShowSnapshot())&&(e=!0),this.$(".boot-select-wrapper").html(he(this.vtOptions({id:"boot_config_select",options:this.diskList,disableSelect:e,useBrowserSelect:!0}))),e&&this.$(".select-wrapper").addClass("disabled"),this.$("#boot_config_select option:selected").prop("value")===D.BOOT_CONFIG.DEFAULT_BOOT_ORDER?this.$("#boot-select-hint").hide():this.$("#boot-select-hint").show(),this.isBootByUefi()?this.$(".boot-select-section").hide():this.$(".boot-select-section").show()},onBootConfigRadioChange:function(e){"uefi"===e.target.value?this.removeWarning():this.showWarning();var t=this.$("#boot_config_select").val();_.each(this.diskList,function(e){e.selected=e.value===t},this),this.renderBootConfigSelect()},onSelectChange:function(e){e.target.value!==D.BOOT_CONFIG.DEFAULT_BOOT_ORDER?this.$("#boot-select-hint").show():this.$("#boot-select-hint").hide()},addToolTip:function(e,t){this.$(e).tooltip({title:t,placement:"top",container:"body",trigger:"hover"})},getPrevBootConfig:function(){var e=this.$("#boot_config_select").val(),t=void 0;return this.isBootByUefi()?t=!0:this.isBootByLegacy()&&(t=!1),{prevDevice:e,prevUefiBoot:t}},addDefaultOption:function(){var e={value:D.BOOT_CONFIG.DEFAULT_BOOT_ORDER,name:this.i18n("boot_by_default_order")};this.diskList.unshift(e)},showWarning:function(){if(!this.isActionCreate()&&!this.warningHasShown&&this.uefiBoot){var e=K.WARNING({msg:this.i18n("boot_config_switch_warning")});this.$("#warning_msg").html(e),this.warningHasShown=!0}},removeWarning:function(){this.warningHasShown&&this.$("#warning_msg").remove()},isBootByUefi:function(){return this.$("#uefi").is(":checked")},isBootByLegacy:function(){return this.$("#legacy").is(":checked")},getBootDeviceUuid:function(){return this.$("#boot_config_select").val()},getBootDeviceDiskModel:function(e){return this.vmDiskCollection.findModelById(e)},createBootConfigFromBootConfigSection:function(){var e={};if(this.isBootByUefi())e[i.DP.VM_BOOT_BY_UEFI]=this.isBootByUefi();else{e[i.DP.VM_BOOT_BY_UEFI]=this.isBootByUefi();var t=this.getBootDeviceUuid();if(t===D.BOOT_CONFIG.DEFAULT_BOOT_ORDER)e[i.DP.VM_BOOT_DEVICE_ORDER]=D.DEFAULT_BOOT_ORDER;else{var n=this.getBootDeviceDiskModel(t);e[i.DP.VM_BOOT_DEVICE_TYPE]=n.DISK_TYPES.DISK,e[u.V2_DP.DISK_ADDRESS]=this.createBootDiskAddress(n,t)}}return e},createBootConfigFromDisksTable:function(){var e={},t=$("input:radio[name=select-boot-device]:checked");if(0!==t.length){var n=t[0].id,s=this.vmDiskCollection.findModelById(n);e[i.DP.VM_BOOT_DEVICE_TYPE]=s.DISK_TYPES.DISK,e[u.V2_DP.DISK_ADDRESS]=this.createBootDiskAddress(s,n)}return e},createBootDiskAddress:function(e,n){var i={};return i[u.V2_DP.BUS_TYPE]=e.get(e.DP.DISK_ADDRESS)[e.DP.BUS_TYPE],i[u.V2_DP.DEVICE_INDEX]=e.get(e.DP.DISK_ADDRESS)[e.DP.DEVICE_INDEX],_.isUndefined(i[u.V2_DP.DEVICE_INDEX])&&_.each(this.busDeviceTypeMap[i[u.V2_DP.BUS_TYPE]],function(e){e[t.DISK_UUID]===n&&(i[u.V2_DP.DEVICE_INDEX]=e[u.V2_DP.DEVICE_INDEX])}),i[u.V2_DP.DISK_LABEL]=e.get(e.DP.DISK_ADDRESS)[e.DP.DISK_LABEL],i[u.V2_DP.IS_CDROM]=e.get(e.DP.IS_CDROM),i[u.V2_DP.NDFS_FILEPATH]=e.get(e.DP.DISK_PATH),i[u.V2_DP.VMDISK_UUID]=e.get(t.ID),i[u.V2_DP.VOLUME_GROUP_UUID]=e.get(e.DP.VG_UUID),i},hasBootDevice:function(e){return!_.isUndefined(e[u.DP.DISK_ADDRESS])||!_.isUndefined(e[u.V2_DP.DISK_ADDRESS])},getBootConfig:function(){var e=void 0;this.model.get(i.DP.VM_CONFIG)&&(this.isSnapshotClone()||this.isActionShowSnapshot())?e=this.model.get(i.DP.VM_CONFIG)[i.DP.SNAPSHOT_BOOT_CONFIG]:this.model.get(i.DP.VM_BOOT)&&(e=this.model.get(i.DP.VM_BOOT));var n={},s=void 0,a=void 0;if(!_.isUndefined(e)&&!_.isEmpty(e)&&!(s=this.isSnapshotClone()||this.isActionShowSnapshot()?e[i.DP.SNAPSHOT_BOOT_BY_UEFI]:e[i.DP.VM_BOOT_BY_UEFI])&&this.hasBootDevice(e)){var o=void 0,r=void 0;this.isSnapshotClone()||this.isActionShowSnapshot()?(o=e[u.DP.DISK_ADDRESS][u.DP.DEVICE_INDEX],r=e[u.DP.DISK_ADDRESS][u.DP.BUS_TYPE]):(o=e[u.V2_DP.DISK_ADDRESS][u.V2_DP.DEVICE_INDEX],r=e[u.V2_DP.DISK_ADDRESS][u.V2_DP.BUS_TYPE]);var l=this.vmDiskCollection.find(function(e){var t=e.get(u.DP.DISK_ADDRESS)||{};return t[u.DP.BUS_TYPE]===r&&parseInt(t[u.DP.DEVICE_INDEX],10)===parseInt(o,10)},this);l&&(this.isSnapshotClone()&&l.get(u.DP.DISK_CLONE)?a=l.get(u.DP.DISK_CLONE)[u.DP.DISK_UUID]:l.get(t.ID)&&(a=l.get(t.ID)))}return n[i.DP.VM_BOOT_BY_UEFI]=s,n[i.DP.VM_BOOT_DISK_UUID]=a,n}})}),define("views/popups/vm/VmFanoutActionView",["views/popups/vm/VmBasePopupView","models/BaseModel","models/ebrowser/EBQueryModel","models/vm/AcropolisVMModel","data/DataProperties","utils/AppConstants","utils/EntityUtil","utils/AppUtil","managers/TaskManager"],function(e,t,n,i,s,a,o,r,l){"use strict";var c=t.extend({defaults:{vmUuid:null},name:"NGTModel",setAction:function(e,t){this.actionMode=e,e===a.ACTION_ENABLE_NGT?this.set({mount:!0}):this.set({enabled:!1,vmId:r.getEntityIdWithoutClusterId(t)})}}),d={power_on:"Power on",power_off:"Power off",power_cycle:"Power cycle",power_reset:"Power reset",acpi_shutdown:"Shutdown",acpi_reboot:"Reboot",pause:"Pause/suspend",resume:"Resume",delete:"Delete",enable_ngt:"Enable NGT",disable_ngt:"Disable NGT"};return e.extend({el:"#popupVmFanoutAction",modelEvents:{"change ebQueryModel":"onDataChange","error  ebQueryModel":"onDataError"},ebQueryModel:null,models:null,action:null,selectedEntityIds:null,DP:s.EB.VM,initialize:function(t){e.prototype.initialize.apply(this,arguments),this.models=[],this.ebQueryModel=new n,this.ebQueryModel.set(this.ebQueryModel.DP.ENTITY_TYPE,a.ENTITY_VM),this.ebQueryModel.setGroupMemberAttributesList([s.EB.CLUSTER_UUID,this.DP.CLUSTER_NAME,this.DP.VM_NAME,this.DP.HYPERVISOR_TYPE,this.DP.POWER_STATE]),this.ebQueryModel.set(this.ebQueryModel.DP.INTERVAL_START,0,{silent:!0}),this.ebQueryModel.set(this.ebQueryModel.DP.INTERVAL_END,0,{silent:!0})},show:function(e){this.delegateEvents(),this.delegateModelEvents(),this.action=e[a.NAV_ACTION],this.selectedEntityIds=e[a.NAV_ACTION_TARGET_ID],this.selectedEntityIds=this.selectedEntityIds.split(","),this.ebQueryModel.set(this.ebQueryModel.DP.ENTITY_IDS,this.selectedEntityIds,{silent:!0}),this.ebQueryModel.performQuery(),this.render()},hide:function(){this.undelegateEvents(),this.undelegateModelEvents(),this.confirmModelEl.modal("hide"),$(".modal-backdrop").removeClass("popupfadeAll"),$("body").removeClass("n-confirm-show"),this.confirmModelEl.remove(),e.prototype.hide.apply(this,arguments)},render:function(){$.nutanixConfirm({msg:"Processing",context:this,captcha:this.onOKClick,no:this.onCancelClick}),this.confirmModelEl=$("#nutanixConfirmModal"),this.showLoadingIcon()},hideLoadingIcon:function(){this.confirmModelEl.find(".modal-spinner").hide(),this.confirmModelEl.find(".modal-buttons").show()},showLoadingIcon:function(){this.confirmModelEl.find(".modal-spinner").show(),this.confirmModelEl.find(".modal-buttons").hide()},showSavingIcon:function(){this.showLoadingIcon(),this.confirmModelEl.find(".n-popup-description").html("Processing")},onDataChange:function(e){var t,n=$(".n-popup-description");this.models=[],_.each(e.getQueryResults().models,function(e){var t;switch(this.action){case a.ACTION_ENABLE_NGT:case a.ACTION_DISABLE_NGT:t=new c({vmUuid:e.getId()}),t.setAction(this.action,e.get(s.EB.CLUSTER_UUID)+"::"+e.getId());break;default:t=new i,t.idAttribute=s.UUID,t.setId(e.getId());var n=this.action;e.get(this.DP.HYPERVISOR_TYPE)===a.HYPERVISOR_TYPE.ESXI&&this.action===a.ACTION_PAUSE&&(n=a.ACTION_SUSPEND),t.setPowerState(n)}t.setProxyClusterUuid(e.get(s.EB.CLUSTER_UUID)),this.models.push(t)},this);var o=[a.ACTION_POWER_OFF,a.ACTION_POWER_CYCLE,a.ACTION_POWER_RESET,a.ACTION_ACPI_REBOOT,a.ACTION_ACPI_SHUTDOWN,a.ACTION_PAUSE,a.ACTION_RESUME,a.ACTION_ENABLE_NGT,a.ACTION_DISABLE_NGT];if(!_.contains(o,this.action)&&(1===this.selectedEntityIds.length||this.action===a.ACTION_DELETE))return void this.onOKClick();var r=e.getQueryResults().models;t=1===this.selectedEntityIds.length?d[this.action]+" selected VM?":d[this.action]+" "+r.length+" selected VMs?",n.html(t);this.hideLoadingIcon()},onDataError:function(e,t,n){this.confirmModelEl.find(".n-popup-description").html(t.responseText),this.hideLoadingIcon()},onCancelClick:function(e){this.hide()},onOKClick:function(e){var t=o.createFanoutCollection(a.ENTITY_VM,this.action,this.models),n=this;this.showSavingIcon(),l.triggerTaskAppEvent(l.TASK_TRIGGER_TYPE.INITIATED,l.TASK_TYPES.VM.POWER_ACTION,{}),t.performFanout({type:this.action===a.ACTION_DISABLE_NGT?"PUT":null,success:function(e,t){n.hide()},error:function(e,t){n.hide()}})}})}),define("text!templates/popups/vm/LaunchConsolePopupView.html",[],function(){
return'<div class="modal-header">\n  <button type="button" class="close" data-dismiss="modal">\n    <i data-icon="K" aria-hidden="true"></i>\n  </button>\n  <h4 class="n-title"><%= i18n(\'title\') %></h4>\n  <div class="help-icon"><i aria-hidden="true" data-icon="O"></i></div>\n</div>\n\n<div class="n-modal-wrapper">\n  <div class="n-modal-body">\n    <div class="n-modal-content-wrapper">\n      <div class="n-modal-alert-header not-empty">\n        \x3c!-- alert goes here --\x3e\n      </div>\n      <div class="n-modal-content">\n        \x3c!-- Content goes here --\x3e\n        <form role="form" class="">\n          <div class="form-group " draggable-container="true">\n            <% var uniqueId = _.uniqueId(\'comPort_\'); %>\n            <div class="n-checkbox-container">\n              <%=Components.radio({\n                name: \'comPort\',\n                id: uniqueId,\n                attributes : \'data-port="vnc"\'\n              })%>\n            </div>\n            <label for="<%= uniqueId %>" >\n              <%= i18n(\'vnc\') %>\n            </label>\n          </div>\n          <% _.each(serialPorts, function(serialPort) { %>\n          <% uniqueId = _.uniqueId(\'comPort_\'); %>\n          <div class="form-group " draggable-container="true">\n            <div class="n-checkbox-container">\n              <%=Components.radio({\n                name: \'comPort\',\n                id: uniqueId,\n                attributes : \'data-port="\' + serialPort.index + \'"\'\n              })%>\n            </div>\n            <label for="<%= uniqueId %>">\n              <%= "COM" + (serialPort.index + 1) %>\n            </label>\n          </div>\n          <% }); %>\n        </form>\n      </div>\n    </div>\n  </div>\n  <div class="n-modal-footer">\n      <a class="btnCancel btn">\n        <%= i18n(\'cancel\') %>\n      </a>\n      <a class="btnLaunch btn -blue" title="<%= i18n(\'click_to_launch\')%>" data-loading-text="<%= i18n(\'saving\') %>">\n        <%= i18n(\'launch\') %>\n      </a>\n  </div>\n</div>\n'}),define("views/popups/vm/LaunchConsolePopupView",["views/basecomponents/popups/BasePopupView","models/vm/VMModel","models/vm/AcropolisVMModel","data/DataProperties","data/DataURLConstants","managers/ClusterManager","managers/ActionManager","managers/AccessManager","managers/AppManager","managers/NavigationManager","utils/AppConstants","utils/AppUtil","text!templates/popups/vm/LaunchConsolePopupView.html"],function(e,t,n,i,s,a,o,r,l,c,d,p,u){"use strict";u=_.template(u);var h={VNC:"vnc"};return e.extend({model:null,name:"LaunchConsolePopupView",acropolisModel:null,el:"#popupLaunchConsole",events:{"click  .btnLaunch":"onLaunchClick","click  .btnCancel":"onCancelClick","click  .modal-header .close":"hide"},vmId:null,initialized:!1,initialize:function(){this.model=new t,this.acropolisModel=new n,e.prototype.initialize.apply(this,arguments)},openVnc:function(){if(p.useReactVnc())return void c.navigateToURL(s.RVNC_URL({vmId:this.vmId,env:l.getVncEnvironment(),mode:d.VNC_MODE.DETACHED}),!0,d.VM_CONSOLE_WINDOW_OPTIONS);var e;e=this.clusterId?a.getClusterModelByClusterUuid(this.clusterId):a.getCurrentClusterModel();var t=!!e&&e.isAmfOverEsxBasicSupported(),n=s.VNC_URL;p.isIFrameModeActivated()&&(n=s.VNC_URL_SSP);var i=n({uuid:this.vmId,vmName:this.vmName||this.vmId,attached:!1,useUhura:t,useV3:!0,noV1Access:!r.hasAccessV1(),isXi:l.isXi()});this.clusterId&&(i+="&clusterId="+this.clusterId);var u={action:d.ACTION_NAVIGATE_URL,actionTarget:i,isNewWindow:!0,windowOptions:d.VM_CONSOLE_WINDOW_OPTIONS};o.executeAction(u)},openSerialConsole:function(e){var t=s.SERIAL_CONSOLE_URL({vmId:this.vmId,vmName:this.vmName||this.vmId,portIndex:e}),n={action:d.ACTION_NAVIGATE_URL,actionTarget:t,isNewWindow:!0,windowOptions:d.SERIAL_CONSOLE_WINDOW_OPTIONS};o.executeAction(n)},render:function(){if(!this.initialized)return void this.loadDataAndRender();if(this.serialPorts&&this.serialPorts.length>0){var e=u(this.vtOptions({serialPorts:this.serialPorts}));this.$el.html(e)}else this.hide(),this.openVnc()},show:function(t){this.vmId=t[d.NAV_ACTION_TARGET_ID],this.clusterId=t[d.NAV_ACTION_PARENT_ID],this.vmName=t[d.NAV_ACTION_TARGET_NAME],e.prototype.show.apply(this,arguments)},loadDataAndRender:function(){this.model.set(i.VM_ID,this.vmId),this.model.fetch().done(function(){if(this.model.isCVM())return this.initialized=!0,this.render();this.acropolisModel.set(this.acropolisModel.idAttribute,this.model.get(i.UUID),{silent:!0}),this.acropolisModel.includeVMDiskSizes=!0,this.acropolisModel.includeAddressAssignments=!0,this.acropolisModel.fetch().done(function(){this.initialized=!0,this.serialPorts=this.acropolisModel.get("serial_ports"),this.render()}.bind(this)).fail(function(e,t,n){this.showHeaderError(p.processAjaxError(t.responseText))}.bind(this))}.bind(this)).fail(function(e,t,n){this.showHeaderError(p.processAjaxError(t.responseText))}.bind(this))},onLaunchClick:function(e){var t=this.$('input[type="radio"]:checked'),n=t.data("port");n===h.VNC?this.openVnc():this.openSerialConsole(n),this.hide()},onCancelClick:function(){this.hide()}})}),define("text!templates/popups/encryption/ConfigEncryptionTypeView.html",[],function(){return'<%= notificationBanner %>\n<h4 class="n-title"><%= i18n(\'encryption_type\') %></h4>\n<span><%= encryptionMsg %></span>\n<%= hardwareOption %>\n<%= softwareOption %>\n\n<% if (isSoftwareEnforcementAllowed) { %>\n  <div class="control-group software-based <% if (!isSoftwareActive && hardwareOption) { %> hide <% } %>">\n    <%= softwareEntireOption %>\n    <%= softwarePartialOption %>\n  </div>\n<% } %>\n\n<div class="control-group">\n  <div class="controls">\n    <button class="btnSaveEncryptionType btn btn-primary -full" disabled><%= i18n(\'save_encryption_type\') %></button>\n  </div>\n</div>\n\n<div class="separator"></div>'}),define("views/popups/encryption/ConfigEncryptionTypeView",["views/basecomponents/BaseSubView","data/DataProperties","views/alerts/AlertMessageView","components/Components","utils/AppConstants","text!templates/popups/encryption/ConfigEncryptionTypeView.html"],function(e,t,n,i,s,a){"use strict";var o=_.template('<div class="control-group"><div class="option"><%= radio %> <%= title %></div><div class="description"><%= description %></div></div> '),r=_.template("<span class=\"<%= tooltipClassName %>\"><%= Components.icon(\n        'question-tooltip',\n        '-inline -baseline'\n      ) %></span>");return e.extend({templateView:_.template(a),name:"ConfigEncryptionTypeView",className:"config-encryption-type",alertMessageView:null,msgTooltip:null,tempSaveData:null,tempSaveModel:null,nydusObj:null,saveTempData:null,encryptionStateObj:null,parentView:null,events:{"click  .btnSaveEncryptionType":"onClickSave","change  .n-checkbox":"onChangeInput","change  .n-radio":"onChangeInput"},initialize:function(t){return _.isObject(t)&&(t.parentView&&(this.parentView=t.parentView),t.props&&(this.props=t.props),_.isObject(t.nydusObj)&&(this.nydusObj=t.nydusObj||null,_.isFunction(t.nydusObj.saveTempData)&&(this.saveTempData=t.nydusObj.saveTempData||null),_.isObject(t.nydusObj.encryptionStateObj)&&(this.encryptionStateObj=t.nydusObj.encryptionStateObj||null),t.nydusObj.tempSaveData&&(this.tempSaveData=t.nydusObj.tempSaveData||null),_.isObject(t.nydusObj.tempSaveModel)&&(this.tempSaveModel=t.nydusObj.tempSaveModel||null))),this.initAlertMsgView(),e.prototype.initialize.apply(this,arguments),this},initAlertMsgView:function(){this.alertMessageView||(this.alertMessageView=new n({dismissible:!1,additionalClasses:"-left-align -rounded"}))},render:function(){var e="";if(!_.isEmpty(this.encryptionStateObj.availableEncryptionOptions)&&this.encryptionStateObj.availableEncryptionOptions.length>1){this.encryptionStateObj.isSoftwareEncryptionLicenseValid||(e=this.i18n("software_encryption_license_na"),this.alertMessageView&&this.alertMessageView.setType(s.MODAL.ALERT.TYPE_WARNING).setContent(e));var t="";this.encryptionStateObj.isSEDAvailable&&this.encryptionStateObj.isSoftwareEncryptionAllowed&&(t=this.i18n("encrypt_cluster_using"));var n=this._getRadioOptions();this.$el.html(this.templateView(this.vtOptions({notificationBanner:this.alertMessageView&&this.alertMessageView.content&&!this.encryptionStateObj.isSEDAvailable?'<div class="alertBanner"></div>':"",encryptionMsg:t,isSoftwareActive:this.encryptionStateObj.encryptionEnforcement,isSoftwareEnforcementAllowed:this.encryptionStateObj.isSoftwareEnforcementAllowed,hardwareOption:n.hardwareOption,softwareOption:n.softwareOption,softwareEntireOption:n.softwareEntireOption,softwarePartialOption:n.softwarePartialOption}))),e&&this.alertMessageView&&this.alertMessageView.setContent(e).setElement(this.$(".alertBanner")).render()}else this.renderOnlyNotificationBanner();return this.msgTooltip&&this.$(".encryptionTypeTooltip").tooltip(this.msgTooltip),this},_getRadioOptions:function(){var e={},n=this.i18n("storage_container_encrypt_desc"),i=null,a="",o=this.alertMessageView&&this.alertMessageView.content?'<div class="alertBanner"></div>':"";this.encryptionStateObj.hasDataBeenWritten&&this.encryptionStateObj.isStorageContainerEncryptionAllowed&&(a=this.i18n("storage_container_encrypt_desc")+"\n            "+this._renderTooltipIcon(),this.msgTooltip=this._createTooltipObj({title:this.i18n("encrypt_cluster_level_msg")}));var r={name:"software-type",value:t.ENCRYPTION_PROP.SOFTWARE,checked:this.isSWEncryptionSet(),disabled:this._isSoftwareRadioDisabled(),dataTestAttribute:"configencryptiontypeview_radio_software_type"};return this.encryptionStateObj.isSoftwareEnforcementAllowed?(i=r,e.softwareEntire={radio:{name:"encryption-enforce",value:s.ENCRYPTION_PROP.SE_SCOPE_CLUSTER,checked:this.isEncryptionEnforcement(s.ENCRYPTION_PROP.SE_SCOPE_CLUSTER),disabled:this._isSoftwareRadioDisabled(),dataTestAttribute:"configencryptiontypeview_radio_encrypt_entire_cluster"},title:this.i18n("encrypt_entire_cluster"),description:this.i18n("encrypt_entire_cluster_desc")},e.softwarePartial={radio:{name:"encryption-enforce",value:s.ENCRYPTION_PROP.SE_SCOPE_STORAGE_CONTAINER,checked:this.isEncryptionEnforcement(s.ENCRYPTION_PROP.SE_SCOPE_STORAGE_CONTAINER),disabled:this._isSoftwareRadioDisabled(),dataTestAttribute:"configencryptiontypeview_radio_storage_container_encrypt"},title:this.i18n("storage_container_encrypt"),description:n}):i=r,this.encryptionStateObj.isSEDAvailable&&this.encryptionStateObj.isSoftwareEncryptionAllowed&&(e.hardware={radio:{name:"hardware-type",value:s.ENCRYPTION_PROP.HARDWARE,checked:this.isHWEncryptionSet(),disabled:this.isHardwareRadioDisabled(),dataTestAttribute:"configencryptiontypeview_radio_sed_encryption"},title:this.i18n("sed_encryption"),description:this.i18n("sed_encryption_desc")},e.software={radio:i,title:this.i18n("software_encryption"),disabled:this._isSoftwareRadioDisabled(),dataTestAttribute:"configencryptiontypeview_radio_software_encryption",description:o+"\n              "+this.i18n("software_encryption_desc")+" "+a}),{hardwareOption:e.hardware?this.renderCheckboxOption(e.hardware):"",softwareOption:e.software?this.renderCheckboxOption(e.software):"",softwareEntireOption:e.softwareEntire?this.renderRadioOption(e.softwareEntire):"",softwarePartialOption:e.softwarePartial?this.renderRadioOption(e.softwarePartial):""}},isHWEncryptionSet:function(){return this.encryptionStateObj.hwEnforcement===s.ENCRYPTION_PROP.HARDWARE},isSWEncryptionSet:function(){return this.encryptionStateObj.encryptionEnforcement===s.ENCRYPTION_PROP.SE_SCOPE_CLUSTER||this.encryptionStateObj.encryptionEnforcement===s.ENCRYPTION_PROP.SE_SCOPE_STORAGE_CONTAINER},isHardwareRadioDisabled:function(){var e=this.props,t=e.kms,n=e.isProtectionOn;return t===s.ENCRYPTION_PROP.LKM||n},_isSoftwareRadioDisabled:function(){return this.encryptionStateObj.isSoftwareEncryptionOn||!this.encryptionStateObj.isSoftwareEncryptionLicenseValid},renderOnlyNotificationBanner:function(){var e="";this.encryptionStateObj.availableEncryptionOptions&&1===this.encryptionStateObj.availableEncryptionOptions.length?e=this._renderNoOptionBannerMessage():this.encryptionStateObj.isSoftwareEncryptionLicenseValid?e=this.i18n("cluster_encryption_na"):(e=this.i18n("software_encryption_license_na"),this.alertMessageView&&this.alertMessageView.setType(s.MODAL.ALERT.TYPE_WARNING)),e&&this.alertMessageView&&this.alertMessageView.setContent(e).setElement(this.$el).render()},_renderNoOptionBannerMessage:function(){var e="";return this.encryptionStateObj.isSEDAvailable?(e=this.i18n("sed_encryption_desc_2")+"\n            "+this._renderTooltipIcon(),this.msgTooltip=this._createTooltipObj({title:this.i18n("encrypt_cluster_level_msg")})):this.encryptionStateObj.isSoftwareEncryptionLicenseValid?this.encryptionStateObj.isStorageContainerEncryptionAllowed?(e=this.i18n("storage_container_encrypt_desc")+"\n            "+this._renderTooltipIcon(),this.msgTooltip=this._createTooltipObj({title:this.i18n("encrypt_cluster_level_msg")})):e=this.i18n("software_encryption_desc_2"):(e=this.i18n("software_encryption_license_na"),this.alertMessageView&&this.alertMessageView.setType(s.MODAL.ALERT.TYPE_WARNING)),e},_renderTooltipIcon:function(){return r(this.vtOptions({tooltipClassName:"encryptionTypeTooltip"}))},_createTooltipObj:function(e){return _.defaults({},e,{placement:"top",trigger:"hover",container:"body",html:!0,title:""})},isEncryptionSet:function(){return this.encryptionStateObj.encryptionType||this.encryptionStateObj.encryptionEnforcement},isEncryptionType:function(e){return this.isEncryptionSet()&&this.encryptionStateObj.encryptionType===e},isEncryptionEnforcement:function(e){return this.isEncryptionSet()&&this.encryptionStateObj.encryptionEnforcement===e},renderRadioOption:function(e){var t=i.radio({name:e.radio.name||"",value:e.radio.value||"",checked:e.radio.checked||"",disabled:e.radio.disabled||""});return o(this.vtOptions({radio:t||"",title:e.title||"",description:e.description||""}))},renderCheckboxOption:function(e){var t=i.checkbox({name:e.radio.name,value:e.radio.value,checked:e.radio.checked,disabled:e.radio.disabled,dataTestAttribute:e.radio.dataTestAttribute?e.radio.dataTestAttribute:""});return o(this.vtOptions({radio:t||"",title:e.title||"",description:e.description||""}))},destroy:function(){this.options&&_.isObject(this.options)&&_.isFunction(this.options.onDestroy)&&this.options.onDestroy(),this.alertMessageView&&this.alertMessageView.destroy(),this.msgTooltip&&this.$(".encryptionTypeTooltip").tooltip("destroy"),e.prototype.destroy.apply(this,arguments)},onClickSave:function(){var e=this.validatedData();e&&this._saveData(e)},getInputVals:function(){if(this.encryptionStateObj.isSoftwareEncryptionAllowed&&!this.encryptionStateObj.isSEDAvailable)return{isHardwareInputChecked:!1,isSoftwareInputChecked:!0,encryptionEnforceVal:this.$("input[type=radio][name=encryption-enforce]:checked").val()||""};if(!this.encryptionStateObj.isSoftwareEncryptionAllowed&&this.encryptionStateObj.isSEDAvailable)return{isHardwareInputChecked:!0,isSoftwareInputChecked:!1,encryptionEnforceVal:""};var e=this.$("input[type=checkbox][name=hardware-type]:checked").val()||"",t=e.length,n=this.$("input[type=checkbox][name=software-type]:checked").val()||"",i=n.length,s=this.$("input[type=radio][name=encryption-enforce]:checked").val()||"";return{isHardwareInputChecked:t,isSoftwareInputChecked:i,encryptionEnforceVal:i?s:""}},validatedData:function(){var e=this.getInputVals(),t=e.isHardwareInputChecked,n=e.isSoftwareInputChecked,i=e.encryptionEnforceVal,s=!0,a="";return n&&this.encryptionStateObj.isSoftwareEnforcementAllowed&&!this.isSWScopeValid(i)?(this.showHeaderError(this.i18n("error_select_enforcement")),s=!1):t||n||(this.showHeaderError(this.i18n("error_select_encryption_type")),s=!1),a=this.getEncryptionScope(t,i,n),!!s&&a},getEncryptionScope:function(e,t,n){var i=void 0,a=e?s.ENCRYPTION_PROP.HARDWARE:"";return i=this.getSWScopeSelection(t,n),a+i},getSWScopeSelection:function(e,t){var n="";return t&&(e===s.ENCRYPTION_PROP.SE_SCOPE_CLUSTER?n=s.ENCRYPTION_PROP.SE_SCOPE_CLUSTER:e===s.ENCRYPTION_PROP.SE_SCOPE_STORAGE_CONTAINER?n=s.ENCRYPTION_PROP.SE_SCOPE_STORAGE_CONTAINER:this.encryptionStateObj.isClusterLevelEncryptionAllowed?n=s.ENCRYPTION_PROP.SE_SCOPE_CLUSTER:this.encryptionStateObj.isStorageContainerEncryptionAllowed&&(n=s.ENCRYPTION_PROP.SE_SCOPE_STORAGE_CONTAINER)),n},isSWScopeValid:function(e){return e&&e.length&&this.encryptionStateObj.isSoftwareEncryptionAllowed},setKMS:function(e){return this.props.kms=e,this},setProtectionState:function(e){return this.props.isProtectionOn=e,this},_saveData:function(e){var t=this,n=[];this.showLoading();var i=function(){t.clearBaseHeader(),t.options.nydusObj.setLoadingState(!0)},s=function(){t.options.didEncryptionGetConfigured(),t.options.nydusObj.setLoadingState(!1)},a=function(){t.nydusObj.fetchAndGo(t.tempSaveModel,s)},o=function(){t.resetLoading(),t.options.nydusObj.setLoadingState(!1)},r={success:a,error:o};n.push(this.saveTempData(e,i,r))},showLoading:function(){this.$(".btn").button("loading")},resetLoading:function(){this.$(".btn").button("reset")},onChangeInput:function(e){var t=this.encryptionStateObj,n=t.isProtectionOn,i=t.isSoftwareEncryptionOn;if(!$(e.target).is(":disabled")){var s=this.$(".btnSaveEncryptionType"),a=this.getInputVals(),o=a.isSoftwareInputChecked;!s.is(":disabled")||n&&i||s.prop("disabled",!1),o?this.$(".software-based").removeClass("hide"):this.$(".software-based").addClass("hide")}}})}),define("text!templates/popups/encryption/ConfigKMSTypeView.html",[],function(){return'<div class="control-group">\n  <h4 class="n-title">\n    <%= i18n(\'main_title\') %>\n  </h4>\n  <span>\n    <%= i18n(\'main_description\') %>\n  </span>\n</div>\n\n<div class="radio-group control-group">\n  <%= radioBtns %>\n</div>\n\n<button class="btnSaveKMS btn btn-primary -full" <%= disableBtnSaveKMS %>><%= i18n(\'save_btn\') %></button>'}),define("views/popups/encryption/ConfigKMSTypeView",["views/basecomponents/BaseSubView","components/Components","utils/AppConstants","text!templates/popups/encryption/ConfigKMSTypeView.html"],function(e,t,n,i){"use strict";var s=_.template('<div class="control-group"><div class="option"><%= radio %> <%= title %></div><div class="description"><%= description %></div></div> ');return e.extend({templateView:_.template(i),name:"ConfigKMSTypeView",className:"",nydusObj:null,encryptionStateObj:null,parentView:null,props:null,events:{"click  .btnSaveEncryptionType":"handleRadioClick","change .n-radio":"handleRadioClick","click  .btnSaveKMS":"confirmSaveKMS"},initialize:function(t){return this.props=t.props,e.prototype.initialize.apply(this,arguments),this},renderInputOption:function(e){var t=e.radio,n=e.title,i=e.description;return s(this.vtOptions({radio:t||"",title:n||"",description:i||""}))},renderRadio:function(e){var n=e.classes,i=e.name,s=e.value,a=e.checked,o=e.disabled,r=e.dataTestAttribute,l=void 0===r?null:r;return t.radio({classes:n||"",name:i||"",value:s||"",checked:a||"",disabled:o||"",dataTestAttribute:l||""})},handleRadioClick:function(e){var t=$(e.target),i=this.props.setKMS;if(!t.is(":disabled")){t.val()===n.ENCRYPTION_PROP.LKM?this.onClickLKM():t.val()===n.ENCRYPTION_PROP.EKM&&this.onClickEKM(),i(t.val());var s=this.$(".btnSaveKMS");s.is(":disabled")&&s.prop("disabled",!1)}},onClickLKM:function(){_.isFunction(this.props.onClickLKM)&&this.props.onClickLKM()},onClickEKM:function(){_.isFunction(this.props.onClickEKM)&&this.props.onClickEKM()},confirmSaveKMS:function(){this.props.isEncryptionOn?$.nutanixConfirm({msg:this.i18n("confirm_kms"),yes:this.saveKMS,yesText:this.i18n("yes"),noText:this.i18n("no"),context:this}):this.saveKMS()},saveKMS:function(){var e=this.$("input[type=radio][name=kms-type]:checked").val();_.isFunction(this.props.saveKMS)&&this.props.saveKMS(e)},setEncryptionState:function(e){return this.props.isEncryptionOn=e,this},setKMS:function(e){return this.props.kms=e,this},setHWEnforcement:function(e){return this.props.hwEnforcement=e,this},setSaveBtnDisabled:function(e){return this.props.disableBtnSaveKMS=e,this},isLKMDisabled:function(){var e=this.props,t=e.hwEnforcement,n=e.isOneOrTwoNodeCluster;return!!t||n},render:function(){var e=this.props,t=e.kms,i=e.disableBtnSaveKMS,s=this.renderInputOption({radio:this.renderRadio({classes:n.ENCRYPTION_PROP.LKM,name:"kms-type",value:n.ENCRYPTION_PROP.LKM,checked:t===n.ENCRYPTION_PROP.LKM,disabled:this.isLKMDisabled(),dataTestAttribute:"configkmstypeview_radio_kms_type_lkm"}),title:this.i18n("lkm_title"),description:this.i18n("lkm_description")}),a=this.renderInputOption({radio:this.renderRadio({classes:n.ENCRYPTION_PROP.EKM,name:"kms-type",value:n.ENCRYPTION_PROP.EKM,checked:t===n.ENCRYPTION_PROP.EKM,dataTestAttribute:"configkmstypeview_radio_kms_type_ekm"}),title:this.i18n("ekm_title"),description:this.i18n("ekm_description")});return this.$el.html(this.templateView(this.vtOptions({radioBtns:s+a,disableBtnSaveKMS:i?n.FORM_ATTR.DISABLED:""}))),this}})}),define("text!templates/popups/encryption/CSRTableInputView.html",[],function(){return'<h4 class="n-title"><%= i18n(\'csr_title\') %></h4>\n<span><%= i18n(\'csr_description\') %></span>\n<div class="csr-input-form-wrapper clearfix">\n  <div class="control-group first-level-elem csr-input">\n    <label class="control-label">\n      <%= i18n(\'csr_email\') %>\n    </label>\n    <div class="controls">\n      <input type="text" class="csr-email"\n          data-input-info="emailAddress" value="<%= email %>">\n    </div>\n  </div>\n\n  <div class="control-group first-level-elem csr-input">\n    <label class="control-label">\n      <%= i18n(\'csr_organization\') %>\n    </label>\n    <div class="controls">\n      <input type="text" class="csr-org" data-input-info="organizationName" value="<%= orgName %>">\n    </div>\n  </div>\n\n  <div class="control-group first-level-elem csr-input">\n    <label class="control-label">\n      <%= i18n(\'csr_organization_unit\') %>\n    </label>\n    <div class="controls">\n      <input type="text" class="csr-orgunit" data-input-info=\n        "organizationalUnitList" value="<%= orgUnit %>">\n    </div>\n  </div>\n\n  \x3c!-- TODO : Need to make a selectbox --\x3e\n  <div class="control-group second-level-elem csr-input">\n    <label class="control-label">\n      <%= i18n(\'csr_country_code\') %>\n    </label>\n    <div class="controls">\n      <input type="text" class="csr-country" data-input-info="countryCode" value="<%= countryCode %>">\n    </div>\n  </div>\n\n  <div class="control-group second-level-elem csr-input">\n    <label class="control-label">\n      <%= i18n(\'csr_city\') %>\n    </label>\n    <div class="controls">\n      <input type="text" class="csr-city" data-input-info="city" value="<%= city %>">\n    </div>\n  </div>\n\n  <div class="control-group second-level-elem csr-input">\n    <label class="control-label">\n      <%= i18n(\'csr_state\') %>\n    </label>\n    <div class="controls">\n      <input type="text" class="csr-state" data-input-info="state" value="<%= state %>">\n    </div>\n  </div>\n\n  <div class="control-group btn-csr-wrapper">\n    <div class="controls">\n      <button disabled class="saveCsr btn btn-primary">\n        <%= i18n(\'csr_save_csr_info\') %>\n      </button>\n      <button class="btn btnDownload btn -default noSave"\n        actionTargetId="download-csr" action="showSubView">\n        <%= i18n(\'csr_download_csrs\') %>\n      </button>\n    </div>\n  </div>\n</div>'}),define("text!templates/popups/encryption/ConfigExternalKMSSubView.html",[],function(){return'<div class="separator"></div>\n\n\x3c!-- CSR Table --\x3e\n<%= csrTable %>\n\n<div class="separator"></div>\n\n\x3c!-- KMIP Related --\x3e\n<h4 class="n-title"><%= i18n(\'kms_title\') %></h4>\n<span class= "desc">\n  <%= i18n(\'kms_description\') %>\n</span>\n\n<div id="kmip-entry-container">\n  \x3c!--KMIPServerTable view --\x3e\n</div>\n\n<div class="control-group ">\n  <div class="controls">\n    <button class="addNode btn btn-primary" actionTargetId="add-node"\n        action="showSubView"><%= i18n(\'add_new_kms\') %></button>\n  </div>\n</div>\n\n<div class="separator"></div>\n\n\x3c!-- CA Related --\x3e\n<h4 class="n-title"><%= i18n(\'ca_certificates\') %></h4>\n<span class="desc">\n  <%= i18n(\'ca_certificates_description\') %>\n</span>\n\n<div class="ca-list-wrapper">\n  \x3c!-- view --\x3e\n</div>\n\n<div class="control-group">\n  <div class="controls">\n    <button class="addNode btn btn-primary" actionTargetId="add-ca"\n      action="showSubView"><%= i18n(\'add_new_ca\') %></button>\n  </div>\n</div>'}),define("text!templates/popups/encryption/KMIPServerTableView.html",[],function(){return'<table id="encryptionKMS" class="table table-hover">\n  <tbody>\n    <tr class="n-table-row first-row">\n      <td class="kmip-name" colspan="2"> <%= name %></td>\n      <td class="row-actions">\n        <i dataid="admin" data-icon="F" aria-hidden="true" class="btnEdit"\n        actionTargetId="add-node"\n        action="showSubView" dataEditId = \'<%= name %>\'\n        dataEntryId = \'<%= name %>\'>\n        </i>\n        <span class="action-separator"></span>\n        <i dataid="admin" class="btnDelete" data-icon="v" aria-hidden="true"\n        dataEntryId = \'<%= name %>\' >\n        </i>\n      </td>\n    </tr>\n    <tr class="n-table-row">\n      <td class="kmipStatus" data-status-kmip-name = "<%= name %>">\n        <span class="col-heading"> Status </span>\n      </td>\n      <td class="kmip-ip-address">\n        <span class="col-heading"> Address </span>\n        \x3c!-- @ span view --\x3e\n      </td>\n      <td>\n        <span class="col-heading"> Actions </span>\n        <button class="btn btn-link -inline btnUpload grayButtonFlat noSave"\n          actionTargetId="upload-csr" action="showSubView"\n          dataEntryId = \'<%= name %>\'> Manage Certificates</button>\n      </td>\n    </tr>\n  </tbody>\n</table>'}),define("views/popups/encryption/ConfigExternalKMSView",["views/basecomponents/BaseSubView","data/DataProperties","utils/SubViewHelper","components/Components","text!templates/popups/encryption/CSRTableInputView.html","text!templates/popups/encryption/ConfigExternalKMSSubView.html","text!templates/popups/encryption/KMIPServerTableView.html"],function(e,t,n,i,s,a,o){"use strict";var r=_.template("<span><%= key %> : <%= value %></span>"),l=_.template("<span><%=status %></span>"),c=_.template('<div class="ca-item"><%= name %><span><a dataid="admin" class="linkCaDelete" actionTargetId="add-ca" action="showSubView" dataCAInfo = "<%= name %>">Delete</a></span></div>'),d=_.template(s),p=_.template(o);return e.extend({name:"ConfigExternalKMSView",subViewTemplate:_.template(a),isViewRendered:null,nydusObj:null,encryptionModel:null,encryptionStateObj:null,footerTempl:null,oneFileUpload:!1,events:{"click  .btnBack":"onClickLinkAction","click  .addNode":"onClickLinkAction","click  .btnDownload":"onClickLinkAction","click  .btnUpload":"onClickLinkAction","click  .btnEdit":"onClickLinkAction","click  .linkCaDelete":"onClickDeleteCA","click  .btnDelete":"onClickDeleteKMIPServer","click  .saveCsr":"saveCertificateInfo","click  input":"clearBaseHeader","input  input":"onChangeFieldValue","click  .btnEnableEncryption":"onClickEnableEncryption"},modelEvents:{"reset   kmipCollection":"renderKMIP","remove  kmipCollection":"renderKMIP","reset   nodeEntries":"renderKMIP","remove  nodeEntries":"renderKMIP","reset   caEntries":"renderCACertificates","remove  caEntries":"renderCACertificates","error   kmipCollection":"showModelError","error   caEntries":"showModelError","error   nodeEntries":"showModelError"},initialize:function(t){e.prototype.initialize.apply(this,arguments),_.isObject(t)?(t.parentView&&(this.parentView=t.parentView),t.encryptionModel&&(this.encryptionModel=t.encryptionModel,this.kmipCollection=this.encryptionModel.getKMIPCollection(),this.caEntries=this.encryptionModel.getCAEntries(),this.nodeEntries=this.encryptionModel.getNodeDetails(),this.certiInfo=this.encryptionModel.getCertiInfo()),_.isObject(t.nydusObj)&&(this.nydusObj=t.nydusObj,this.encryptionStateObj=t.nydusObj.encryptionStateObj,this.footerTempl=this.options.nydusObj.renderViewFooter)):(this.encryptionStateObj=this._initStateObj(),this.nydusObj={encryptionStateObj:this.encryptionStateObj}),_.bindAll(this,"showModelError","render"),this.delegateModelEvents(),this.subViewHelper=new n},destroy:function(){this.subViewHelper&&this.subViewHelper.destroy(),e.prototype.destroy.apply(this,arguments)},_initStateObj:function(){return{isEncryptionConfigured:null,isEncryptionOn:null,encryptionType:null,hasDataBeenWritten:null}},render:function(){this.$el.html(this.subViewTemplate(this.vtOptions({isEncryptionConfigured:this.encryptionStateObj.isEncryptionConfigured,isEncryptionOn:this.encryptionStateObj.isEncryptionOn,csrTable:this._renderCSRTable(),footer:this._renderFooter()}))),this.isViewRendered=!0,this.renderKMIP(),this.renderCACertificates()},_renderCSRTable:function(){var e=this.encryptionModel.getCertiInfo();return d(this.vtOptions({email:e.get(t.ENCRYPTION_PROP.EMAIL)||"",orgName:e.get(t.ENCRYPTION_PROP.ORG_NAME)||"",orgUnit:e.get(t.ENCRYPTION_PROP.ORG_UNIT)?e.get(t.ENCRYPTION_PROP.ORG_UNIT).join(","):"",countryCode:e.get(t.ENCRYPTION_PROP.COUNTRY_CODE)||"",city:e.get(t.ENCRYPTION_PROP.CITY)||"",state:e.get(t.ENCRYPTION_PROP.STATE)||""}))},_renderFooter:function(){if(!this.footerTempl)return"";var e=i.button({extraClasses:"btnBack",extraAttr:[{key:t.ENCRYPTION_ACTIONS.TARGET_ID,value:t.ENCRYPTION_ACTIONS.HOME},{key:t.ENCRYPTION_ACTIONS.ACTION,value:t.ENCRYPTION_ACTIONS.SHOW_SUBVIEW}],text:this.i18n("back"),iconLeft:"caret-left"}),n="";return this.encryptionStateObj.encryptionType!==t.ENCRYPTION_PROP.SOFTWARE||this.encryptionStateObj.isEncryptionOn||(n=i.button({isPrimary:!0,disabled:!this.encryptionStateObj.isEncryptionConfigured||this.encryptionStateObj.isEncryptionOn,extraClasses:"btnEnableEncryption",text:this.i18n("enableEncryption")})),this.footerTempl(e,n)},showView:function(){e.prototype.showView.apply(this,arguments),this.startServices()},refreshView:function(){this.render()},hideView:function(){e.prototype.hideView.apply(this,arguments),this.stopServices()},setData:function(e){var t="",n=this.$('input.*[class^="csr-"]');_.each(n,function(n){var i=$(n).attr("data-input-info");"organizationalUnitList"===i&&e.get(i)?(t+=e.get(i).join(","),$(n).val(t)):$(n).val(e.get(i))})},disableCSRInput:function(e){var t=this.$('input.*[class^="csr-"]');_.each(t,function(t){var n=$(t).parent().parent();e?($(t).prop("disabled",!0),n.addClass("disable-csr")):($(t).prop("disabled")&&$(t).prop("disabled",!1),n.hasClass("disable-csr")&&n.removeClass("disable-csr"))})},saveViewData:function(e){this.isCSRDirty()&&this.hasDataChanged()?this.saveConfirm(e):e()},isCSRDirty:function(){return _.some(this.getDirtyCertificateInfoModel(),function(e,t){return!!e||null!==this.certiInfo.get(t)},this)},saveCertificateInfo:function(e,t){var n=this,i=this.$('input.*[class^="csr-"]').not("input.csr-orgunit"),s=this.validateForm(i);if($.trim(s).length>0)return this.showError(s),!1;if(this.$(".csr-email").val().trim().length>256)return s="Email address cannot exceed 256 characters.",this.showError(s),!1;var a={success:function(e,i){n.showSuccess("Successfully saved Certificate Signing  Request Information"),n.$(".saveCsr").prop("disabled",!0),t&&t()},error:this.showModelError};this.clearBaseHeader(),this.encryptionModel.saveCertiInfo(this.getDirtyCertificateInfoModel(),a)},saveConfirm:function(e){$.nutanixConfirm({msg:"The CSR info is not saved. Do you still want to exit?",yes:function(){e()},yesText:"Yes",noText:"No",context:this})},getDirtyCertificateInfoModel:function(){var e=null,t=$.trim(this.$(".csr-orgunit").val());return t&&(e="-1"!==t.indexOf(",")?t.split(","):[t]),{organizationName:$.trim(this.$(".csr-org").val()),countryCode:$.trim(this.$(".csr-country").val()),city:$.trim(this.$(".csr-city").val()),state:$.trim(this.$(".csr-state").val()),
emailAddress:$.trim(this.$(".csr-email").val()),organizationalUnitList:e}},onClickDeleteCA:function(e){var t=$(e.currentTarget).attr("dataCAInfo");this.deleteCAConfirmById(t)},deleteCAConfirmById:function(e){var t=1===this.caEntries.models.length?"This is the last CA. Are you sure you want to delete "+e+" ?":"Are you sure you want to delete "+e+" ?";$.nutanixConfirm({msg:t,yes:function(){this.deleteCAEntry(e)},yesText:"Yes",noText:"No",context:this})},deleteCAEntry:function(e){if(this.encryptionModel){var t=this.caEntries.findModelById(e);t.on("destroy",function(){this.showSuccess("Successfully deleted the Certificate Authority")},this),this.clearBaseHeader(),t.destroy()}},onClickDeleteKMIPServer:function(e){var t=$(e.currentTarget).attr("dataEntryId");this.deleteKMIPConfirmById(t)},deleteKMIPConfirmById:function(e){var t="Are you sure you want to delete this KMS ? ",n=this.kmipStatus(e),i=this.encryptionModel.getCurrentEncryptionStatusModel();if(i.state&&i.state.isEncryptionOn){var s=this.kmipCollection.checkActiveKMIPs(e);if(s.present){if(1===s.activeKMIPSize)return void this.showError("Cannot delete the last active KMS while encryption is on.");2===s.activeKMIPSize&&(t+=" It will reduce fault tolerance")}}if(n&&n.oneFileUpload)return void this.showError("Cannot delete KMS named "+e+" since all certificates for the KMS have not been deleted");$.nutanixConfirm({msg:t,yes:function(){this.deleteKMIPServer(e)},yesText:"Yes",noText:"No",context:this})},deleteKMIPServer:function(e){var t=this.kmipCollection.findModelById(e);t.on("destroy",function(){this.showSuccess("Successfully deleted the KMS entry")},this),this.clearBaseHeader(),t.destroy()},renderCACertificates:function(){var e=this.caEntries.models,n=this.$(".ca-list-wrapper");n.empty(),_.each(e,function(e){var i=c({name:e.get(t.ENCRYPTION_PROP.NAME)});n.append(i)})},renderKMIPEntries:function(e){var n=this,i=this.$("#kmip-entry-container");i.empty(),_.each(e,function(e,s){var a=e.get(t.ENCRYPTION_PROP.NAME),o=p({name:a,uuid:e.get(t.UUID)});i.append(o);var l=n.$(".kmip-ip-address")[s];_.each(e.get(t.ENCRYPTION_PROP.IP_ADDRESS_PORT_MAP),function(e,t){var n=r({key:t,value:e});$(l).append(n)})})},renderStatus:function(){var e=this,n=!1;_.each(this.kmipCollection.models,function(i){var s=i.get(t.ENCRYPTION_PROP.NAME);e.encryptionModel.getCurrentEncryptionStatusModel().state.isEncryptionOn||(e.kmipCollection.activeKMIP=[]);var a=e.kmipStatus(s);a.oneFileUpload&&(n=!0),n&&e.disableCSRInput(n);var o='[data-status-kmip-name = "'+s+'"]',r=l({status:a.status});e.$(o).append(r)}),n||this.disableCSRInput(n)},kmipStatus:function(e){var n=!0,i=!0,s=!1,a=void 0;return-1===this.kmipCollection.activeKMIP.indexOf(e)?(_.each(this.nodeEntries.models,function(a){var o=a.get(t.ENCRYPTION_PROP.KMIP_MAP),r=o[e];null===r||void 0===r?(n=!1,i=!1):!1===r?(i=!1,s=!0):s=!0}),a=n&&!i?"Ready to test":n&&i?"Verified":"Upload"):(a="Active",s=!0),{oneFileUpload:s,status:a}},renderKMIP:function(e){this.isViewRendered&&(this.renderKMIPEntries(this.kmipCollection.models),this.renderStatus(),this.disableEditActiveKMIP())},disableEditActiveKMIP:function(){var e=this,t=this.kmipCollection.activeKMIP,n=this.encryptionModel.getCurrentEncryptionStatusModel().currentEncryptionState;_.each(t,function(t){var i=e.$('[dataEditId = "'+t+'"]');i&&n?(i.removeClass("btnEdit"),i.addClass("btnNotEdit")):i.hasClass("btnEdit")||(i.addClass("btnEdit"),i.removeClass("btnNotEdit"))})},onChangeFieldValue:function(e){this.hasDataChanged()?this.$(".saveCsr").prop("disabled",!1):this.$(".saveCsr").prop("disabled",!0)},hasDataChanged:function(){var e=this.getDirtyCertificateInfoModel(),n=this.certiInfo,i=void 0,s=void 0;return _.some(e,function(e,a){var o=n.get(a),r=void 0;return a===t.ENCRYPTION_PROP.ORG_UNIT&&_.isArray(o)&&_.isArray(e)?(i=o.join(","),s=e.join(","),r=i!==s):r=o!==e,r})},onClickEnableEncryption:function(){this.nydusObj.runActionEvent(t.ENCRYPTION_ACTIONS.ENABLE_ENCRYPTION)}})}),define("text!templates/popups/encryption/ConfigFormSubView.html",[],function(){return'<div class="config-encryption-type">\n  \x3c!-- Encryption Type View goes here --\x3e\n</div>\n\n \x3c!-- Separator dynamically managed by Encryption Type View --\x3e\n\n<div class="config-kms-type">\n  \x3c!-- KMS Type View goes here --\x3e\n</div>\n\n\n<div class="config-external-kms">\n  \x3c!-- External KMS View goes here --\x3e\n</div>\n\n<%= footer %>'}),define("views/popups/encryption/ConfigFormSubView",["views/basecomponents/popups/BasePopupSubView","views/popups/encryption/ConfigEncryptionTypeView","views/popups/encryption/ConfigKMSTypeView","views/popups/encryption/ConfigExternalKMSView","data/DataProperties","utils/AppConstants","utils/SubViewHelper","components/Components","text!templates/popups/encryption/ConfigFormSubView.html"],function(e,t,n,i,s,a,o,r,l){"use strict";var c={SUBVIEW_CONFIG_ENCRYPTION_TYPE:"configEncryptionTypeSubview",SUBVIEW_CONFIG_KMS_TYPE:"configKMSTypeSubview",SUBVIEW_CONFIG_EXTERNAL_KMS:"configExternalKMSSubview"};_.template("<span><%= key %> : <%= value %></span>"),_.template("<span><%=status %></span>"),_.template('<div class="ca-item"><%= name %><span><a dataid="admin" class="linkCaDelete" actionTargetId="add-ca" action="showSubView" dataCAInfo = "<%= name %>">Delete</a></span></div>');return e.extend({name:"ConfigFormSubView",subViewTemplate:_.template(l),isViewRendered:null,nydusObj:null,encryptionModel:null,encryptionStateObj:null,uiStateObj:null,configEncryptionTypeSubview:null,configKMSTypeSubview:null,configExternalKMSSubview:null,footerTempl:null,oneFileUpload:!1,events:{"click  .btnBack":"onClickLinkAction","click  .btnEnableEncryption":"onClickEnableEncryption"},initialize:function(s){var a=this;e.prototype.initialize.apply(this,arguments),s?(s.encryptionModel&&(this.encryptionModel=s.encryptionModel,this.kmipCollection=this.encryptionModel.getKMIPCollection(),this.caEntries=this.encryptionModel.getCAEntries(),this.nodeEntries=this.encryptionModel.getNodeDetails(),this.certiInfo=this.encryptionModel.getCertiInfo()),_.isObject(s.nydusObj)?(this.nydusObj=s.nydusObj,this.encryptionStateObj=s.nydusObj.encryptionStateObj,_.isObject(s.nydusObj.uiStateObj)?this.uiStateObj=s.nydusObj.uiStateObj:this.uiStateObj=this._initUIStateObj(),this.canSoftwareEncryptionBeEnabled=this.options.nydusObj.canSoftwareEncryptionBeEnabled,this.footerTempl=this.options.nydusObj.renderViewFooter):(this.encryptionStateObj=this._initStateObj(),this.uiStateObj=this._initUIStateObj(),this.nydusObj={encryptionStateObj:this.encryptionStateObj,uiStateObj:this.uiStateObj})):(this.encryptionStateObj=this._initStateObj(),this.uiStateObj=this._initUIStateObj()),this.props={kms:this.uiStateObj.kms,isEncryptionOn:this.encryptionStateObj.isEncryptionOn,hwEnforcement:this.encryptionStateObj.hwEnforcement},_.bindAll(this,"showModelError","render"),this.delegateModelEvents(),this.subViewHelper=new o;var r=new t({parentView:this,nydusObj:this.nydusObj,didEncryptionGetConfigured:this.didEncryptionGetConfigured.bind(this),props:{kms:this.uiStateObj.kms,isProtectionOn:this.encryptionStateObj.isProtectionOn}});this.subViewHelper.register(c.SUBVIEW_CONFIG_ENCRYPTION_TYPE,r);var l=new n({parentView:this,nydusObj:this.nydusObj,props:{onClickLKM:function(){a.hideEKMS()},onClickEKM:function(){a.showEKMS()},kms:this.props.kms,saveKMS:function(e){a.saveKMS(e)},setKMS:function(e){a.nydusObj.setUIKMSType(e)},isOneOrTwoNodeCluster:this.encryptionStateObj.isOneOrTwoNodeCluster,isEncryptionOn:null,hwEnforcement:this.props.hwEnforcement}});this.subViewHelper.register(c.SUBVIEW_CONFIG_KMS_TYPE,l);var d=s||{},p=_.extend(d,{parentView:this,nydusObj:this.nydusObj}),u=new i(p);this.subViewHelper.register(c.SUBVIEW_CONFIG_EXTERNAL_KMS,u)},saveKMS:function(e){var t=this;if(this.nydusObj&&_.isFunction(this.nydusObj.saveKMS)){this.options.nydusObj.setLoadingState(!0);var n=function(){t.clearHeader(),t.render(),t.options.nydusObj.setLoadingState(!1)},i=function(e,n){t.clearHeader(),t.options.nydusObj.setLoadingState(!1),t.showHeaderError(e,n)};this.nydusObj.saveKMS(e,{success:n,error:i})}},_initStateObj:function(){return{isEncryptionConfigured:null,isEncryptionOn:null,encryptionType:null,hasDataBeenWritten:null,kms:null,saveKMS:null}},_initUIStateObj:function(){return{kms:null}},showEKMS:function(){this.$(".config-external-kms").removeClass("hide")},hideEKMS:function(){this.$(".config-external-kms").addClass("hide")},clearHeader:function(){this.parentView.clearHeader()},showHeaderError:function(e,t){this.parentView.showHeaderError(e,t)},render:function(){var e=this.encryptionStateObj,t=e.isEncryptionConfigured,n=e.isEncryptionOn,i=e.isProtectionOn,s=e.hwEnforcement,o=this.uiStateObj.kms;this.$el.html(this.subViewTemplate(this.vtOptions({isEncryptionConfigured:t,isEncryptionOn:n,csrTable:"",footer:this._renderFooter()}))),this.isViewRendered=!0,this.subViewHelper.get(c.SUBVIEW_CONFIG_ENCRYPTION_TYPE).setElement(this.$(".config-encryption-type")).setKMS(o).setProtectionState(i).render(),this.subViewHelper.get(c.SUBVIEW_CONFIG_KMS_TYPE).setElement(this.$(".config-kms-type")).setHWEnforcement(s).setKMS(o).setSaveBtnDisabled(this.encryptionStateObj.kms===o).setEncryptionState(n).render(),this.subViewHelper.get(c.SUBVIEW_CONFIG_EXTERNAL_KMS).setElement(this.$(".config-external-kms")).render(),o===a.ENCRYPTION_PROP.EKM?this.showEKMS():this.hideEKMS()},_renderFooter:function(){if(!this.footerTempl)return"";var e=r.button({extraClasses:"btnBack",extraAttr:[{key:s.ENCRYPTION_ACTIONS.TARGET_ID,value:s.ENCRYPTION_ACTIONS.HOME},{key:s.ENCRYPTION_ACTIONS.ACTION,value:s.ENCRYPTION_ACTIONS.SHOW_SUBVIEW}],text:this.i18n("back"),iconLeft:"caret-left"}),t="";return this.encryptionStateObj.encryptionEnforcement&&!this.encryptionStateObj.isSoftwareEncryptionOn&&(t=r.button({isPrimary:!0,disabled:!this.canSoftwareEncryptionBeEnabled(this.encryptionStateObj),extraClasses:"btnEnableEncryption",text:this.i18n("enableEncryption")})),this.footerTempl(e,t)},didEncryptionGetConfigured:function(){this.render()},showView:function(){e.prototype.showView.apply(this,arguments),this.startServices()},refreshView:function(){this.render()},hideView:function(){e.prototype.hideView.apply(this,arguments),this.stopServices()},onStartServices:function(){e.prototype.onStartServices.apply(this,arguments),this.caEntries.startPolling(),this.kmipCollection.startPolling(),this.nodeEntries.startPolling()},onStopServices:function(){e.prototype.onStopServices.apply(this,arguments),this.caEntries.stopPolling(),this.kmipCollection.stopPolling(),this.nodeEntries.stopPolling()},destroy:function(){this.subViewHelper&&this.subViewHelper.destroy(),e.prototype.destroy.apply(this,arguments)},onClickEnableEncryption:function(){this.nydusObj.runActionEvent(s.ENCRYPTION_ACTIONS.ENABLE_ENCRYPTION)}})}),define("text!templates/popups/encryption/CertiListSubView.html",[],function(){return'<div class="desc">\n  <h4 class="n-title">Add a New Key Management Server</h4>\n  <div class="kmip-desc">Enter a name and at least one address for the Key\n    Management Server.\n  </div>\n</div>\n\n<div class="control-group button-row">\n  <div class="controls">\n    <button class="btn addIp">Add Address</button>\n  </div>\n</div>\n\n<div class="certificate-form-wrapper n-clearfix">\n  <div class="control-group first-level-elem ">\n    <label class="control-label">\n      Name\n    </label>\n    <div class="controls">\n      <input type="text" class="kmipName">\n    </div>\n  </div>\n</div>\n<div class="bottom-align-btns">\n  <div class="pull-left">\n    <button class="backForm form2Element btn n-secondary-btn btnBack noSave"\n        actionTargetId="create-config" action="showSubView">\n      <i data-icon="x" aria-hidden="true"></i>\n      Back\n    </button>\n  </div>\n\n  <div class="control-group btn-right">\n    <div class="controls">\n      <button disabled class="btnUpdate btn btn-primary"\n          data-loading-text="Saving..." actionTargetId="create-config"\n          action="showSubView">\n        Save\n      </button>\n    </div>\n  </div>\n</div>'}),define("views/popups/encryption/CertiListSubView",["views/basecomponents/BaseSubView","data/DataProperties","text!templates/popups/encryption/CertiListSubView.html"],function(e,t,n){"use strict";var i=_.template('<div class="control-group second-level-elem list-left-cell" data-index = "<%= index %>"><label class="control-label">Address</label><div class="controls"><input type="text" value= "<%= key %>" class="ipAdd" ></div></div><div class="control-group second-level-elem list-right-cell" data-index = "<%= index %>"><label class="control-label"> Port</label><span><i dataid="admin" class = "btnDeleteIP hideButton" data-icon="v" aria-hidden="true"  data-delindex = "<%= index %>"></i></span><div class="controls"><input type="text" value= "<%= value %>"  class="portNo" placeholder="5696" ></div></div>');return e.extend({encryptionModel:null,subViewTemplate:_.template(n),subModelHolder:null,flagToSave:null,ipIndex:null,events:{"click  .btnUpdate":"onClickLinkAction","click  .btnBack":"onClickLinkAction","click  .addIp":"onClickAddIp","click  input":"clearBaseHeader","click  .noSave":"unSavedChanges","click  .btnDeleteIP":"onClickDeleteIp","change input":"onChangeFieldValue","mouseover .second-level-elem":"onMouseActionOnIpCell","mouseout  .second-level-elem":"onMouseActionOnIpCell"},modelEvents:{"reset kmipCollection":"renderKMIPEntry","error kmipCollection":"showModelError"},initialize:function(t){e.prototype.initialize.apply(this,arguments),this.encryptionModel=t.encryptionModel,_.bindAll(this,"showModelError"),this.onChangeField=!1,this.flagToSave=!1,this.ipIndex=0,this.kmipCollection=this.encryptionModel.getKMIPCollection(),this.delegateModelEvents()},render:function(){this.$el.html(this.subViewTemplate())},setViewOption:function(t){e.prototype.setViewOption.apply(this,arguments),this.currentKMIPName=t.dataEntryId},enableSaveControls:function(){this.$(".btnUpdate").button("reset")},disableSaveControls:function(){this.$(".btnUpdate").button("loading")},refreshView:function(){this.kmipCollection.fetch()},hideView:function(){e.prototype.hideView.apply(this,arguments),this.onChangeField=!1},renderKMIPEntry:function(e){this.ipIndex=0,this.render();var n=this.kmipCollection.get(this.currentKMIPName);this.subModelHolder=n,n&&n.get(t.UUID)?this.setData():(this.ipIndex++,this.$(".certificate-form-wrapper").append(i({key:"",value:"",index:this.ipIndex})))},setData:function(){this.$(".kmipName").val(this.subModelHolder.get(t.ENCRYPTION_PROP.NAME)),this.$(".kmipName").prop("disabled",!0),this.$(".kmipName").parent().parent().addClass("disable-kmipConfig"),_.each(this.subModelHolder.get(t.ENCRYPTION_PROP.IP_ADDRESS_PORT_MAP),function(e,t){this.ipIndex++,this.$(".certificate-form-wrapper").append(i({key:t,value:e,index:this.ipIndex}))},this)},saveViewData:function(e){this.flagToSave?this.saveAndRenderFunction(e):e(),this.flagToSave=!1,this.enableSaveControls()},onClickLinkAction:function(t,n,i){if(this.$(".kmipName").val().trim().length>64)return void this.showError("Key management server name cannot exceed 64 characters.");if(n)this.flagToSave=i,this.onChangeField=!1;else{if(this.onChangeField&&$(t.currentTarget).hasClass("btnBack"))return;this.onChangeField&&$(t.currentTarget).hasClass("btnUpdate")&&(this.disableSaveControls(),this.flagToSave=!0)}e.prototype.onClickLinkAction.apply(this,arguments)},getDirtyKMIPModel:function(){for(var e={},n={},i=this.$(".list-left-cell"),s=0;s<i.length;s++){var a=this.$(".list-left-cell")[s],o=$.trim($(a).find(".ipAdd").val()),r=this.$(".list-right-cell")[s];if(o){if(void 0!==e[o])return this.showError("Duplicate IP addresses specified."),!1;var l=new RegExp("^[0-9]+$"),c=$.trim($(r).find(".portNo").val());if(!(l.test(c)&&0<c&&c<=65535||""===c))return this.showError("Invalid port specified. The port has to be a value from 1 to 65535"),!1;e[o]=$.trim($(r).find(".portNo").val())}}if(this.subModelHolder&&this.subModelHolder.get(t.UUID)){var d=this.subModelHolder.get(t.UUID);n[t.UUID]=d}return n.name=$.trim(this.$(".kmipName").val()),n.ipAddressPortMap=e,n},saveAndRenderFunction:function(e){var n,i={success:function(t,n){e()},error:this.showModelError};n=!this.subModelHolder||!this.subModelHolder.get(t.UUID),this.getDirtyKMIPModel()&&this.encryptionModel.saveKMIPDetails(this.getDirtyKMIPModel(),i,n)},onClickAddIp:function(){this.ipIndex++,this.$(".certificate-form-wrapper").append(i({key:"",value:"",index:this.ipIndex}))},onMouseActionOnIpCell:function(e){var t;this.$(".list-left-cell").length>=2&&(e.currentTarget&&$(e.currentTarget).hasClass("list-right-cell")?t=$(e.currentTarget).find(".btnDeleteIP"):$(e.currentTarget).hasClass("list-left-cell")&&(t=$(e.currentTarget).next().find(".btnDeleteIP")),t&&t.toggleClass("hideButton"))},onClickDeleteIp:function(e){var t=$(e.currentTarget).data("delindex");this.$("[data-index = "+t+"]").remove(),this.onChangeField=!0,this.$(".btnUpdate").prop("disabled",!1)},onChangeFieldValue:function(e){this.onChangeField=!0,this.$(".btnUpdate").prop("disabled",!1)},unSavedChanges:function(){this.onChangeField&&$.nutanixConfirm({msg:"You have unsaved changes. You will lose them on exiting. Do you still want to continue ?",yes:function(){$("#add-node .btnBack").trigger("click",[!0,!1])},yesText:"Yes",noText:"No",context:this})}})}),define("text!templates/popups/encryption/CaConfigSubView.html",[],function(){return'<form id="uploadCAForm" class="form-horizontal"\n    target="upload_target_ca" method="post" enctype="multipart/form-data">\n  <h4 class="n-title">Add a New Certificate Authority</h4>\n  <div class="control-group -multi">\n    <div class="pull-left">\n      <div class="description">\n        <span>\n          Upload the Certificate Authority (CA) certificate and enter a name for\n          the Certificate Authority.\n        </span>\n      </div>\n      <div class="action">\n        <div class="selectedUploadFiles">\n          <span class="selectedFileName"></span>\n        </div>\n      </div>\n    </div>\n    <div class="pull-right">\n      <label class="upload-ca-label">\n      <input type="file" id="CAfile" class="btn btn-primary longBtn\n      encryptionCAFileName" name="certificateFile"/>\n    </label>\n    </div>\n  </div>\n\n  <div class="control-group form-input">\n    <label class="control-label"\n      for="inputCertName">Certificate Authority name</label>\n    <div class="controls">\n      <input type="text" class="inputCAName"\n        name="name" value=""/>\n    </div>\n  </div>\n</form>\n\n<div class="bottom-align-btns">\n  <div class="pull-left">\n    <button class="backForm form2Element btn n-secondary-btn btnBack noSave"\n        actionTargetId="create-config" action="showSubView">\n      <i data-icon="x" aria-hidden="true"></i>\n      Back\n    </button>\n  </div>\n\n  <div class="control-group btn-right">\n    <div class="controls">\n      <button disabled class="btnUpdate btn btn-primary"\n          data-loading-text="Saving..." actionTargetId="create-config"\n          action="showSubView">\n        Save\n      </button>\n    </div>\n  </div>\n</div>'}),define("views/popups/encryption/CaConfigSubView",["views/basecomponents/BaseSubView","utils/AppUtil","data/DataManager","text!templates/popups/encryption/CaConfigSubView.html"],function(e,t,n,i){"use strict";return e.extend({encryptionModel:null,subViewTemplate:_.template(i),flagToSave:null,onChangeField:null,events:{"click  .btnUpdate":"onClickLinkAction","click  .btnBack":"onClickLinkAction","click  input":"clearBaseHeader","click  .noSave":"unSavedChanges","change #CAfile":"onChangeFileNameInput","change input":"onChangeFieldValue"},initialize:function(t){e.prototype.initialize.apply(this,arguments),this.encryptionModel=t.encryptionModel,_.bindAll(this,"showModelError"),this.onChangeField=!1,this.flagToSave=!1},render:function(){this.$el.html(this.subViewTemplate()),this.showMessageForLegacyBrowser()},enableSaveControls:function(){this.$(".btnUpdate").button("reset")},disableSaveControls:function(){this.$(".btnUpdate").button("loading")},refreshView:function(){this.render()},saveViewData:function(e){this.flagToSave?(this.uploadFile(e),this.enableSaveControls()):e()},onClickLinkAction:function(t,n,i){if(this.$(".inputCAName").val().trim().length>64)return void this.showError("The name cannot exceed 64 characters.");if(n)this.flagToSave=i,this.onChangeField=!1;else{if(this.onChangeField&&$(t.currentTarget).hasClass("btnBack"))return;this.onChangeField&&$(t.currentTarget).hasClass("btnUpdate")&&(this.disableSaveControls(),this.flagToSave=!0)}e.prototype.onClickLinkAction.apply(this,arguments)},uploadFile:function(e){var i={},s=this;i.success=e,i.error=function(e){s.clearBaseHeader(),s.showError(e)};var a=this.$(".encryptionCAFileName").val().trim(),o=this.$(".inputCAName").val().trim();if(o&&0!==o.length&&a&&0!==a.length){var r=n.getFormattedURL(this.encryptionModel.getCAUploadURL()+"?name="+o);t.uploadFile(this.$("#CAfile"),r,i)}else o?this.showError("Select a file"):this.showError("Enter a filename"),this.onChangeField=!0},onChangeFileNameInput:function(e){var t="";this.$(".inputCAName").prop("disabled")&&(this.$(".inputCAName").prop("disabled",!1),this.$(".inputCAName").parent().parent().removeClass("disable-ca")),this.$(".selectedUploadFiles").hide(),$(e.currentTarget).val()&&(t+=$(e.currentTarget).val().split("\\").pop()+" is selected",this.$(".selectedFileName").empty(),this.$(".selectedFileName").text(t),this.$(".selectedUploadFiles").show())},onChangeFieldValue:function(e){this.onChangeField=!0,this.$(".btnUpdate").prop("disabled",!1)},unSavedChanges:function(){this.onChangeField&&$.nutanixConfirm({msg:"You have unsaved changes. You will lose them on exiting. Do you still want to continue ?",yes:function(){$("#add-ca .btnUpdate").trigger("click",[!0,!1])},yesText:"Yes",noText:"No",context:this})},showMessageForLegacyBrowser:function(){var e=t.uploadCheck();e&&(this.showError(e),this.$(".upload-ca-label").addClass("disabled"),this.$("#CAfile").attr("disabled","disabled"))}})}),define("text!templates/popups/encryption/ManageKeysPopupView.html",[],function(){return"<div>\n  <%= actions %>\n</div>\n\n<%= keyBackupSection %>"}),define("views/popups/encryption/ManageKeysPopupView",["views/basecomponents/popups/BasePopupView","components/Components","text!templates/popups/encryption/ManageKeysPopupView.html"],function(e,t,n){"use strict";var i=_.template('\n      <div\n        <% if (multiple) { %>\n          data-ntnx-section="type-half" class="text-align-center"\n        <% } else { %>\n          data-ntnx-section\n        <% } %>\n      >\n        <div data-ntnx-content-inner>\n          <h4 class="n-title">\n            <%= rekeyTitle %>\n          </h4>\n        </div>\n\n        <div data-ntnx-content-inner>\n          <%= rekeyBtn %>\n        </div>\n      </div>\n    '),s=_.template('\n      <div data-ntnx-section="type-separator">\n        <div data-ntnx-content-inner>\n          <h4 class="n-title">\n            <%= i18n(\'key_backup\') %>\n          </h4>\n          <span>\n            <%= i18n(\'key_backup_description\') %>\n          </span>\n        </div>\n\n        <div class="control-group" data-ntnx-content-inner>\n          <label class="control-label">\n            <%= i18n(\'password\') %>\n          </label>\n          <div class="controls">\n            <input type="password" class="inputPassword">\n            <div>\n              <%= i18n(\'password_description\') %>\n            </div>\n          </div>\n        </div>\n\n        <div class="control-group" data-ntnx-content-inner>\n          <label class="control-label">\n            <%= i18n(\'confirm_password\') %>\n          </label>\n          <div class="controls">\n            <input type="password" class="inputConfirmPassword">\n          </div>\n        </div>\n\n        <div class="control-group" data-ntnx-content-inner>\n          <%= downloadBtn %>\n        </div>\n      </div>\n    ');return e.extend({templateView:_.template(n),overlayPopup:!0,name:"ManageKeysPopupView",events:{"click  .btnClose":"hide","click  .btnCancel":"hide","click  .modal-header .close":"hide","click .btnHWRekey":"hwRekey","click .btnSWRekey":"swRekey","click .btnDownloadKeys":"downloadKeys"},showLoading:function(){var e=this,t=e.$(".loading-cover");e&&!t.length&&(e.$(".n-modal-content-wrapper").append('\n      <div class="loading-cover vh-center">\n        <div class="donut-loader-blue-large"></div>\n      </div>\n    '),this.$(".btn").button("loading"))},hideLoading:function(){var e=this,t=e.$(".loading-cover");e&&t.length&&(t.remove(),this.$(".btn").button("reset"))},hwRekey:function(){var e=this,t=this.options.hwRekey;_.isFunction(t)&&t(function(){e.hide()})},swRekey:function(){var e=this,t=this.options.swRekey;_.isFunction(t)&&t(function(){e.hide()})},downloadKeys:function(){var e=this.validatePassword();e&&this.download(e)},download:function(e){this.clearHeader(),this.options.encryptionModel.downloadKeyBackup(e)},validatePassword:function(){var e=!0,t=this.$("input.inputPassword").val()||"",n=this.$("input.inputConfirmPassword").val()||"";return t&&n&&t===n?this.clearHeader():(this.showHeaderError(this.i18n("password_not_valid")),e=!1),!!e&&t},renderRekeyBtn:function(e){var n=void 0,i=void 0,s=void 0;switch(e){case"hwRekey":n="btnHWRekey",i=this.i18n("hw_rekey_btn_text_loading"),s=this.i18n("hw_rekey_btn_text");break;case"swRekey":n="btnSWRekey",i=this.i18n("sw_rekey_btn_text_loading"),s=this.i18n("sw_rekey_btn_text")}return t.button({isPrimary:!0,extraClasses:n+" n-popup-form-holder",extraAttr:[{key:"data-loading-text",value:i}],text:s})},renderHWRekey:function(e){return i(this.vtOptions({multiple:e,rekeyTitle:this.i18n("hardware_encryption"),rekeyBtn:this.renderRekeyBtn("hwRekey")}))},renderSWRekey:function(e){return i(this.vtOptions({multiple:e,rekeyTitle:this.i18n("software_encryption"),rekeyBtn:this.renderRekeyBtn("swRekey")}))},renderActions:function(){var e=this.options,t=e.isProtectionOn,n=e.isSoftwareEncryptionOn,i="",s=t&&n;return t&&(i+=this.renderHWRekey(s)),n&&(i+=this.renderSWRekey(s)),i},renderKeyBackup:function(){var e=this.options.isSoftwareEncryptionOn,n="";if(e){var i=t.button({isPrimary:!0,extraClasses:"btnDownloadKeys n-popup-form-holder",extraAttr:[{key:"data-loading-text",value:this.i18n("downloading")}],text:this.i18n("download_key_backup")});n=s(this.vtOptions({downloadBtn:i}))}return n},render:function(){var e=[{text:this.i18n("close"),extraClasses:"btnCancel",extraAttr:[{key:"data-loading-text",value:this.i18n("close")}]}];this.$el.html(this.defaultTemplate(this.vtOptions({title:this.i18n("title"),bodyContent:this.templateView(this.vtOptions({actions:this.renderActions(),keyBackupSection:this.renderKeyBackup()})),footerButtons:this.defaultFooter(e)})))}})}),define("text!templates/popups/encryption/EncryptionLaunchSubView.html",[],function(){return'<h4 class="n-title"><%= title %></h4>\n<span><%= i18n(\'view_description\') %></span>\n<%= keyWrapper %>\n<div class="control-group -primary">\n  <div class="controls">\n    <%= buttons %>\n  </div>\n</div>\n\n<%= message %>\n\n<%= configBoxTmpl %>\n\n<%= footer %>'}),define("text!templates/popups/encryption/EncryptionCompleteHomeSubView.html",[],function(){return'<h4 class="n-title">Cluster Encryption</h4>\n<span>Encrypting your cluster will help keep your information safe</span>\n<div class="key-wrapper">\n  <div id="key" class="key off">\n    <%= SVG.loadSVG(SVG.ENCRYPTION_KEY) %>\n  </div>\n</div>\n<div class="encryption-status">\n  <span class="encryption-state"></span>\n  <span class="loader"></span>\n  <div class="error-encryption-status">\n  </div>\n  \x3c!-- view --\x3e\n</div>\n<div class="rekey-status">\n  <span class="rekey-label"> Rekey Status: </span>\n  <span class="rekey-loader"></span>\n  \x3c!-- view --\x3e\n</div>\n<div class="encryption-control-switch">\n  <div class="controls">\n    <button class="btn btn-primary pull-left lockProtectionIntent"\n        data-loading-text="Protecting..." style="display:none">\n      Protect\n    </button>\n  </div>\n  <div class="controls">\n    <button class="btn btn-primary pull-left unlockProtectionIntent"\n        data-loading-text="Unprotecting..." style="display:none">\n      Unprotect\n    </button>\n  </div>\n  <div class="controls">\n    <button class="btn btn-primary pull-left rekeyProtection"\n        data-loading-text="Rekeying..." style="display:none">\n      Rekey All Disks\n    </button>\n  </div>\n  <div class="controls">\n    <button class="btn btn-primary btnConfig"\n        actionTargetId="create-config" action="showSubView"\n        style="display:none">\n      Edit Config\n    </button>\n  </div>\n</div>'}),define("views/popups/encryption/EncryptionLaunchSubView",["views/basecomponents/BaseSubView","views/popups/encryption/ManageKeysPopupView","views/alerts/AlertMessageView","components/Components","data/DataProperties","utils/AppUtil","utils/AppConstants","text!templates/popups/encryption/EncryptionLaunchSubView.html","text!templates/popups/encryption/EncryptionCompleteHomeSubView.html"],function(e,t,n,i,s,a,o,r,l){"use strict";var c={COMPLETE:"complete",NONE:"noRunningProgress",SUCCEEDED:"succeeded",FAILED:"failed",RUNNING:"running",QUEUED:"queued"},d={CONFIGURE:"configure",ERROR:"error",ON:"on",OFF:"off",REVERSE:"reverse"},p=_.template('<span class="state"><%= state %> <span class="fail-no"><%= no %></span></span>'),u=_.template('<div class="key-wrapper"><div id="key" class="key <%= state %>"><%= SVG.loadSVG(SVG.ENCRYPTION_KEY) %></div></div>'),h=_.template('<div class="key-progress <%= classNames %>"><div class="key progress-on"><%= SVG.loadSVG(SVG.ENCRYPTION_KEY) %></div></div>'),m=_.template('<p class="error"><%= msg %></p>'),f=_.template('<p class="error-label"><%= msg %></p>'),v=_.template('\n      <div class="error-list">\n        <span class="left"> <%= msg %> </span>\n        <span class="right">\n          <%= num %>\n          <span\n            data-toggle="popover"\n            data-id="<%= popoverId %>"\n            class="popover-icon"\n          >\n            <%= Components.icon(\'question-tooltip\', \'-inline -baseline\') %>\n          </span>\n        </span>\n      </div>'),g='<p class="error-header">The following disks failed </p>',E=_.template('<span class="controls"><button class="btn retryProtectionIntent">Retry <%= val %></button></span>'),T=(_.template('<span class="rekeyState"><%= msg %></span>'),_.template('<span class="errorHeader"><%= msg %></span>'),_.template('\n      <div class="n-cell-hover">\n         <div>\n          <% _.each(diskNos, function(no) { %>\n            <div>\n              Disk <%= no %>\n            </div>\n          <% }); %>\n          </div>\n      </div>\n    ')),C=_.template('<span>\n        <%= i18n(\'not_setup_msg_1\') %>\n        <a class="<%= linkClass %>" actionTargetId="create-config"\n          action="showSubView"><%= i18n("not_setup_msg_2_link") %></a>\n        <%= i18n(\'not_setup_msg_3\') %>\n      </span>'),S=_.template('<div class="encryptionStatusMsg encryption-status">\n        <%= message %>\n      </div>'),A=_.template('<div class="padded-lock-box"><%= i18n("no_storage_containers") %></div>'),b=_.template('\n      <div class="containers-box">\n        <div class="header n-clearfix">\n          <div class="left pull-left">\n            <%= i18n("encrypted_storage_containers") %>\n          </div>\n        </div>\n        <%= encryptedContainers %>\n      </div>'),y=_.template('\n      <div class="container n-clearfix">\n        <div class="left pull-left">\n          <%= name %>\n          <% if (progress) { %>\n            <span class="donut-loader-blue n-encryption-in-progress"/>\n            <%= progress %>\n          <% } %>\n        </div>\n      </div>'),I=_.template("<%= i18n('software_cluster_encryption_in-progress') %>\n      <span class=\"donut-loader-blue n-encryption-in-progress\"/>");return e.extend({name:"EncryptionLaunchSubView",
subViewHomeTemplate:_.template(r),subViewCompleteTemplate:_.template(l),alertMessageView:null,encryptionStateObj:null,containerCollection:null,tempSaveModel:null,saveTempData:null,isReadyForPasswordProtection:null,isEncryptionOn:null,diskEncryptionStatus:null,clusterSEDTaskModel:null,latestClusterSEDTasks:null,oneTaskCollection:null,updateTask:null,totalNoDisksInCluster:0,state:null,footerTempl:null,keyAnimationState:{incrementGoal:0,disksProcessed:0,increment:0,incrementCounter:null},events:{"click  .btnConfig":"onClickLinkAction","click  .btnEnableEncryption":"onClickEnableEncryption","click  .btnEnableDualEncryption":"onClickDualEncrypt","click  .btnConfigState":"onClickLinkAction","click  .linkConfig":"onClickLinkAction","click  .btnManageKeys":"onClickManageKeys","click  .lockProtectionIntent":"onClickProtect","click  .unlockProtectionIntent":"onClickUnprotect","click  .retryProtectionIntent":"changeProtectionIntent","click  .rekeyProtection":"rekeyConfirm","click  .rekeySoftware":"triggerSoftwareRekey"},initialize:function(t){e.prototype.initialize.apply(this,arguments),_.bindAll(this,"_renderDataChange"),this.encryptionModel=t.encryptionModel,_.bindAll(this.encryptionModel,"fetchCertiInfo"),_.isObject(t.nydusObj)&&(this.tempSaveModel=this.options.nydusObj.tempSaveModel||{},this.saveTempData=this.options.nydusObj.saveTempData||null,this.clusterSEDTaskModel=this.options.nydusObj.clusterSEDTaskModel||null,this.latestClusterSEDTasks=this.options.nydusObj.latestClusterSEDTasks||null,this.updateTask=this.options.nydusObj.updateTask||null,this.containerCollection=this.options.nydusObj.containerCollection||null,this.localTaskManager=this.options.nydusObj.localTaskManager||null,this.encryptionStateObj=this.options.nydusObj.encryptionStateObj||{},this.footerTempl=this.options.nydusObj.renderViewFooter,this.syncEncryptionState=t.nydusObj.syncEncryptionState,this.canSoftwareEncryptionBeEnabled=this.options.nydusObj.canSoftwareEncryptionBeEnabled),this.alertMessageView=new n({dismissible:!1,additionalClasses:"-left-align -rounded"}),this.state={currentRunningTask:_.clone(this.encryptionStateObj.currentRunningTask)||null},_.bindAll(this,"showModelError")},refreshView:function(){this.homeViewToShow()},destroy:function(){this.alertMessageView&&this.alertMessageView.destroy(),clearInterval(this.keyAnimationState.incrementCounter),this.oneTaskCollection&&(this.oneTaskCollection.stopPolling(),this.oneTaskCollection=null),e.prototype.destroy.apply(this,arguments)},getEncryptionKeyState:function(){var e=d.CONFIGURE;return this._isDiskErrors(this.diskEncryptionStatus)?e=d.ERROR:this.encryptionStateObj.isEncryptionOn?e=d.ON:this.encryptionStateObj.isEncryptionConfigured&&(e=d.OFF),e},onClickManageKeys:function(){var e=this,n=this.encryptionStateObj,i=n.isProtectionOn,s=n.isSoftwareEncryptionOn;this.manageKeysPopupView=new t({el:a.createPopupContainer("popupManageKeys"),encryptionModel:this.options.encryptionModel,isProtectionOn:i,isSoftwareEncryptionOn:s,hwRekey:function(t){e.rekeyConfirm(t)},swRekey:function(t){_.isFunction(t)&&t(),e.triggerSoftwareRekey()}}),this.manageKeysPopupView.show()},_renderDataChange:function(){var e=this._renderEncryptionStatusMsg(this.encryptionStateObj),t="",n="";this.encryptionStateObj.isSoftwareEncryptionLicenseValid||this.encryptionStateObj.isSEDAvailable?_.isEmpty(this.encryptionStateObj.availableEncryptionOptions)&&(t=e):(t=e,this.alertMessageView&&this.alertMessageView.setType(o.MODAL.ALERT.TYPE_WARNING)),this.encryptionStateObj.isSoftwareEncryptionOn&&this.encryptionStateObj.encryptionEnforcement===o.ENCRYPTION_PROP.SE_SCOPE_STORAGE_CONTAINER&&(n=this._renderStorageContainers(this.containerCollection)),this.$el.html(this.subViewHomeTemplate(this.vtOptions({isConfigurable:this.encryptionStateObj.isEncryptionConfigurable,title:this.i18n("view_title"),keyWrapper:this._renderEncryptionKey(),buttons:this._renderPrimaryBtns(this.encryptionStateObj),secondaryButtons:this._renderSecondaryButtons(this.encryptionStateObj),configBoxTmpl:n,message:e?S(this.vtOptions({message:e})):"",footer:this._renderFooter()}))),t&&this.alertMessageView&&this.alertMessageView.setContent(t).setElement(this.$(".encryptionStatusMsg")).render(),(this.state.currentRunningTask&&this.state.currentRunningTask.status===c.RUNNING||this.state.currentRunningTask&&this.state.currentRunningTask.status===c.QUEUED)&&this.renderViewFromProgressMonitor()},_renderStorageContainers:function(e){return this._renderEncryptedContainers(e)||A(this.vtOptions())},_renderEncryptedContainers:function(e){var t=this,n="";return e.length&&_.each(e.models,function(e){if(e.get(s.ENCRYPTED)){var i=e.getEncryptionProgress();i&&i!==o.DATA_NOT_AVAILABLE?i=e.getEncryptionStatus()+" ("+i+")":i&&(i=e.getEncryptionStatus()),n+=y(t.vtOptions({name:e.getName(),progress:i}))}}),n?b(this.vtOptions({encryptedContainers:n})):""},_renderFooter:function(){var e=i.button({extraClasses:"btn n-secondary-btn btn-primary btnConfig",extraAttr:[{key:s.ENCRYPTION_ACTIONS.TARGET_ID,value:s.ENCRYPTION_ACTIONS.CREATE_CONFIG},{key:s.ENCRYPTION_ACTIONS.ACTION,value:s.ENCRYPTION_ACTIONS.SHOW_SUBVIEW}],text:this.i18n("edit_configuration")}),t=i.button({isPrimary:!0,extraClasses:"btnClose",text:this.i18n("close")});return this.options.nydusObj.renderViewFooter(e,t)},_renderEncryptionKey:function(){var e=this.getEncryptionKeyState();return u(this.vtOptions({state:e}))},updateEncryptionKey:function(e){if(this.keyAnimationState.incrementGoal=e.diskInfo.totalFailedDisksSoFar+e.diskInfo.totalSucceededDisks,this.isEncryptionOperationComplete(e))this._renderKeyInCompleteProgress(e.diskInfo,e.operation);else if(this.keyAnimationState.disksProcessed<this.keyAnimationState.incrementGoal&&this.keyAnimationState.incrementGoal>0){this.keyAnimationState.increment=15/(this.keyAnimationState.incrementGoal-this.keyAnimationState.disksProcessed),clearInterval(this.keyAnimationState.incrementCounter);var t={diskInfo:e.diskInfo,operation:e.operation,keyAnimationState:this.keyAnimationState};this.updateKeyState(t),this._setAnimationKeyInterval(e.diskInfo,e.operation)}else{var n={diskInfo:e.diskInfo,operation:e.operation};this.updateKeyState(n)}},_renderKeyInCompleteProgress:function(e,t){var n={operation:t,diskInfo:e,keyAnimationState:this.keyAnimationState,status:c.COMPLETE};t===o.TASK_OPERATION_UNPROTECT&&(n.direction=d.REVERSE),this.updateKeyState(n),clearInterval(this.keyAnimationState.incrementCounter),this.keyAnimationState.incrementGoal=0,this.keyAnimationState.disksProcessed=0,this.keyAnimationState.increment=0,this.keyAnimationState.incrementCounter=null},_setAnimationKeyInterval:function(e,t){var n=this;this.keyAnimationState.incrementCounter=setInterval(function(){n.updateDisksProcessed(e.totalFailedDisksSoFar,e.totalSucceededDisks);var i={operation:t,diskInfo:e,keyAnimationState:n.keyAnimationState};t===o.TASK_OPERATION_UNPROTECT&&(i.direction=d.REVERSE),n.updateKeyState(i),n.keyAnimationState.disksProcessed>=n.keyAnimationState.incrementGoal&&clearInterval(n.keyAnimationState.incrementCounter)},1e3*n.keyAnimationState.increment)},updateKeyState:function(e){var t=e.diskInfo,n=this.$(".key-progress"),i=this.$("#key"),s=this.$("#key .key-highlight");if(n.addClass("transition-progress"),this._isProgressKeyNeeded(e)&&(this._updateKeyStateClassName(i,d.OFF),this.$(".key-wrapper").append(h(this.vtOptions({classNames:e.operation===o.TASK_OPERATION_UNPROTECT?d.REVERSE:""})))),t&&e.keyAnimationState){var r=this._getDisksProcessed(e.keyAnimationState,t,e.status),l=t.totalNoDisksInCluster;e.direction===d.REVERSE?n.css("width",this.getKeyReverseProgress(r,l)+"%"):n.css("width",this.getKeyProgress(r,l)+"%")}if(t&&t.totalFailedDisksSoFar&&this._updateKeyStateClassName(i,d.ERROR),e.status&&e.status===c.COMPLETE){var p=this,u=[o.TASK_OPERATION_PROTECT,o.TASK_OPERATION_REKEY,o.TASK_OPERATION_ENCRYPT,o.TASK_OPERATION_SW_REKEY],m="";if(t&&t.totalFailedDisksSoFar?m=d.ERROR:-1!==u.indexOf(e.operation)?m=d.ON:e.operation===o.TASK_OPERATION_UNPROTECT&&(m=d.OFF),this.$(".key-wrapper .key-progress").length){var f=function(){a.onTransitionEnd(s,function(e){e.remove()},null,n)};a.onTransitionEnd(n,function(e,t){p._updateKeyStateClassName(e,m),_.isFunction(t)&&t()},f,i)}else this._updateKeyStateClassName(i,m),_.isFunction(e.callback)&&a.onTransitionEnd(s,function(e,t){_.isFunction(t)&&t()},e.callback)}},_isProgressKeyNeeded:function(e){return-1!==[o.TASK_OPERATION_PROTECT,o.TASK_OPERATION_UNPROTECT,o.TASK_OPERATION_REKEY,o.TASK_OPERATION_SW_REKEY].indexOf(e.operation)&&!this.$(".key-wrapper .key-progress").length&&e.status!==c.COMPLETE},_updateKeyStateClassName:function(e,t){e.removeClass("on off configure error"),e.addClass(t)},_renderPrimaryBtns:function(e){return this._renderEncryptionBtn(e)+this._renderRekeyBtn(e)},_renderEncryptionBtn:function(e){var t=e.isEncryptionConfigured;if(!e.isEncryptionConfigurable)return"";var n=[];t&&e.hwEnforcement&&e.encryptionEnforcement?e.isSoftwareEncryptionOn&&e.isProtectionOn?n.push({isPrimary:!0,extraClasses:"unlockProtectionIntent",extraAttr:[{key:"data-loading-text",value:this.i18n("unprotecting_dot_dot_dot")}],text:this.i18n("unprotect")}):e.isSoftwareEncryptionOn&&!e.isProtectionOn?n.push({isPrimary:!0,extraClasses:"lockProtectionIntent",extraAttr:[{key:"data-loading-text",value:this.i18n("protecting_dot_dot_dot")}],text:this.i18n("protect")}):this.canSoftwareEncryptionBeEnabled(e)&&e.isProtectionOn?n.push({isPrimary:!0,extraClasses:"btnEnableEncryption",text:this.i18n("enable_encryption")},{isPrimary:!0,extraClasses:"unlockProtectionIntent",extraAttr:[{key:"data-loading-text",value:this.i18n("unprotecting_dot_dot_dot")}],text:this.i18n("unprotect")}):!this.canSoftwareEncryptionBeEnabled(e)&&e.isProtectionOn||n.push({isPrimary:!0,extraClasses:"btnEnableDualEncryption",text:this.i18n("enable_encryption")}):n.push(this._getSingleTypeEncryptionConfig(e));var s="";return _.each(n,function(e){s+=_.isEmpty(e)?"":i.button(e)}),s},_getSingleTypeEncryptionConfig:function(e){var t=e.isSoftwareEncryptionLicenseValid,n=e.isSEDAvailable,i={};return e.isEncryptionOn&&e.hwEnforcement?i={isPrimary:!0,extraClasses:"unlockProtectionIntent",extraAttr:[{key:"data-loading-text",value:this.i18n("unprotecting_dot_dot_dot")}],text:this.i18n("unprotect")}:e.isSoftwareEncryptionOn||(e.isEncryptionConfigured&&e.hwEnforcement?i={isPrimary:!0,extraClasses:"lockProtectionIntent",extraAttr:[{key:"data-loading-text",value:this.i18n("protecting_dot_dot_dot")}],text:this.i18n("protect")}:this.canSoftwareEncryptionBeEnabled(e)?i={isPrimary:!0,extraClasses:"btnEnableEncryption",text:this.i18n("enable_encryption")}:(t||n)&&(i={extraClasses:"btnConfig exLongHomeConfigBtn",extraAttr:[{key:s.ENCRYPTION_ACTIONS.TARGET_ID,value:s.ENCRYPTION_ACTIONS.CREATE_CONFIG},{key:s.ENCRYPTION_ACTIONS.ACTION,value:s.ENCRYPTION_ACTIONS.SHOW_SUBVIEW}],text:e.encryptionState?this.i18n("continue_configuration"):this.i18n("edit_configuration")})),i},_renderRekeyBtn:function(e){var t=e.isEncryptionOn,n={};return t&&(n={extraClasses:"btnManageKeys",text:this.i18n("manage_keys")}),_.isEmpty(n)?"":i.button(n)},_updatePrimaryBtns:function(){var e=this._renderPrimaryBtns(this.encryptionStateObj);this.$(".control-group.-primary").html(e)},_renderSecondaryButtons:function(e){if(!e.isEncryptionConfigurable)return"";var t={extraClasses:"btn btn-primary btnConfig",extraAttr:[{key:s.ENCRYPTION_ACTIONS.TARGET_ID,value:s.ENCRYPTION_ACTIONS.CREATE_CONFIG},{key:s.ENCRYPTION_ACTIONS.ACTION,value:s.ENCRYPTION_ACTIONS.SHOW_SUBVIEW}]};return e.isEncryptionConfigured?t.text=this.i18n("edit_configuration"):t.text=this.i18n("configure_encryption"),i.button(t)},updateState:function(e){this._isStateDifferent(this.state.currentRunningTask,e.encryptionStateObj.currentRunningTask)&&(this.state.currentRunningTask=_.clone(e.encryptionStateObj.currentRunningTask),this.latestClusterSEDTasks=e.latestClusterSEDTasks,!this.latestClusterSEDTasks&&_.isEmpty(this.state.currentRunningTask)||this.renderViewFromProgressMonitor())},setState:function(e){e&&_.isObject(e.currentRunningTask)&&this._isStateDifferent(this.state.currentRunningTask,e.currentRunningTask)&&(this.state.currentRunningTask=e.currentRunningTask,this.renderViewFromProgressMonitor())},_isStateDifferent:function(e,t){return!_.isEqual(e,t)},renderViewFromProgressMonitor:function(){var e=this.encryptionStateObj,t=e.diskEncryptionStatus,n=e.isEncryptionOn,i=this.state.currentRunningTask,s=i.operation;this.totalNoDisksInCluster=this.encryptionStateObj.totalNoDisksInCluster,this.destroyPopover();var a=this.getDisksInfo(this.latestClusterSEDTasks,this.totalNoDisksInCluster),r={diskInfo:a,operation:s,currentRunningTask:i};if(this.isEncryptionOperationComplete(r)){if(r.state=c.COMPLETE,this.updateEncryptionKey(r),a.totalFailedDisksSoFar){this._updateEnryptionStatusMsg(r),this.$(".encryptionStatusMsg").append('<div class="error-encryption-status"></div>');var l=this.$(".error-encryption-status"),d=[],p=[];_.isObject(t)&&_.each(t,function(e,t){(!n&&e||n&&!e)&&d.push(t.split("::")[1])}),_.each(a.errorMessagetoDiskMapping,function(e,t){$.merge(p,this.getDiskNosFailedWithSameReason(e));var n=v(this.vtOptions({msg:t,num:this.i18ns("disks_count",e.length),popoverId:t}));l.append(n)},this),a.errorEntriesInMap!==a.totalFailedDisksSoFar&&l.append(v(this.vtOptions({msg:"Other Failures",num:this.i18n("disks_count",a.totalFailedDisksSoFar-a.errorEntriesInMap),popoverId:"Other Failures"})));var u=$(d).not(p).get(),h=this;this.$('[data-toggle="popover"]').popover({title:"Failed Disks",placement:"right",trigger:"hover",html:!0,animation:!1,delay:0,container:$("body"),content:function(){var e=$(this).data("id");return T("Other Failures"!==e?{diskNos:h.getDiskNosFailedWithSameReason(a.errorMessagetoDiskMapping[e])}:{diskNos:u})}}),this._updatePrimaryBtns()}else l&&l.remove(),s===o.TASK_OPERATION_PROTECT?this.enableSaveControls(".unlockProtectionIntent"):s===o.TASK_OPERATION_UNPROTECT?this.enableSaveControls(".lockProtectionIntent"):(this.enableSaveControls(".rekeyProtection"),this.$(".unlockProtectionIntent").prop("disabled",!1),this.$(".btnConfig").prop("disabled",!1)),this.updateEncryptionStatus(s),r.state=c.COMPLETE,this._updateEnryptionStatusMsg(r),this._showRequiredButtons(s,a.totalFailedDisksSoFar),this._updatePrimaryBtns(),this.syncEncryptionState();this.$(".btnConfig").prop("disabled",!1)}else this.renderViewCurrentlyInProgress(r)},updateEncryptionStatus:function(e){var t=this.encryptionStateObj.isSoftwareEncryptionOn;e===o.TASK_OPERATION_PROTECT?(this.encryptionStateObj.isEncryptionOn=!0,this.encryptionStateObj.isProtectionOn=!0):e===o.TASK_OPERATION_UNPROTECT&&(t||(this.encryptionStateObj.isEncryptionOn=!1),this.encryptionStateObj.isProtectionOn=!1)},isEncryptionOperationComplete:function(e){switch(e.currentRunningTask.operation){case o.TASK_OPERATION_SW_REKEY:return 100===e.currentRunningTask.percentageComplete;case o.TASK_OPERATION_PROTECT:case o.TASK_OPERATION_UNPROTECT:case o.TASK_OPERATION_REKEY:return e.diskInfo.totalFailedDisksSoFar+e.diskInfo.totalRemainingSuccessfulDisks===e.diskInfo.totalNoDisksInCluster;default:return!1}},getDisksInfo:function(e,t){var n=0,i=0,s=0,a=0,o=0,r=0,l={};return _.each(e,function(e){_.each(e.subTaskList,function(e){switch(e.status){case c.FAILED:n++;var t=e.subTaskMessage.split(":")[1];l[t]||(l[t]=[]),l[t].push(e),o++;break;case c.SUCCEEDED:i++;break;case c.QUEUED:s++;break;case c.RUNNING:a++}},this)},this),r=t-n-s-a,{totalNoDisksInCluster:t,totalFailedDisksSoFar:n,totalSucceededDisks:i,totalQueuedDisks:s,totalInProgressDisks:a,errorEntriesInMap:o,totalRemainingSuccessfulDisks:r,errorMessagetoDiskMapping:l}},getDiskNosFailedWithSameReason:function(e){var t=[];return _.each(e,function(e){t.push(e.subTaskMessage.split(":")[0].split(" ")[1])},this),t},destroyPopover:function(){this.$('[data-toggle="popover"]').popover("destroy")},getKeyProgress:function(e,t){var n=0;return e>0&&t>0&&(n=Math.floor(e/t*100)),n},getKeyReverseProgress:function(e,t){return 100-this.getKeyProgress(e,t)},updateDisksProcessed:function(e,t){this.keyAnimationState.disksProcessed<e+t&&(this.keyAnimationState.disksProcessed++,this.$el.find(".disksProcessed").html(this.keyAnimationState.disksProcessed))},_getDisksProcessed:function(e,t,n){return t&&n===c.COMPLETE?t.totalNoDisksInCluster:e.disksProcessed},renderViewCurrentlyInProgress:function(e){this.updateEncryptionKey(e),this._updateEnryptionStatusMsg(e),this._showRequiredButtons(e.operation,e.diskInfo.totalFailedDisksSoFar,!0)},_updateEnryptionStatusMsg:function(e){e.state=e.state||c.NONE;var t=this._renderEncryptionStatusMsg(e);this.$(".encryption-status").html(t)},_renderEncryptionStatusMsg:function(e){var t="";if(e.state&&e.state===c.COMPLETE)t="<b>Encryption State of Cluster:</b>\n            "+this._renderEncryptionStatusMsgComplete(e);else if(e.state)t=this._renderEncryptionStatusMsgInProgress(e);else{var n="";this.encryptionStateObj.isSoftwareEncryptionLicenseValid||this.encryptionStateObj.isSEDAvailable?e.availableEncryptionOptions&&!e.availableEncryptionOptions.length?n=this.i18n("cluster_encryption_na"):e.isEncryptionConfigurable&&(n=e.isEncryptionConfigured?this.getEncryptionStateMsg("<b>Encryption State of Cluster:</b>",e):C(this.vtOptions({linkClass:"btnConfigState"}))):n=this.i18n("software_encryption_license_na"),t=n}return t},getEncryptionStateMsg:function(e,t){var n="",i="";if(t.isProtectionOn&&t.hwEnforcement?n=this.i18n("all_disks_protected"):t.isEncryptionConfigured&&t.hwEnforcement&&!t.isProtectionOn&&!this._isDiskErrors(this.diskEncryptionStatus)&&(n=this.i18n("all_disks_unprotected")),t.isSoftwareEncryptionOn&&t.encryptionEnforcement===o.ENCRYPTION_PROP.SE_SCOPE_CLUSTER){var a=this.clusterManager.getPrimaryClusterModel();i=a&&a.get(s.SOFTWARE_ENCRYPTED)?this.i18n("software_cluster_encryption_enabled"):I(this.vtOptions({}))}else t.isSoftwareEncryptionOn&&t.encryptionEnforcement===o.ENCRYPTION_PROP.SE_SCOPE_STORAGE_CONTAINER?i=this.i18n("software_container_encryption_enabled"):t.isEncryptionConfigured&&t.encryptionEnforcement===o.ENCRYPTION_PROP.SE_SCOPE_CLUSTER?i=this.i18n("cluster_encryption_ready"):t.isEncryptionConfigured&&t.encryptionEnforcement===o.ENCRYPTION_PROP.SE_SCOPE_STORAGE_CONTAINER&&(i=this.i18n("container_encryption_ready"));return e+" "+n+" "+i},_renderEncryptionStatusMsgComplete:function(e){var t=e.currentRunningTask,n=e.diskInfo,i=e.operation;if(n&&n.totalFailedDisksSoFar){return(i===o.TASK_OPERATION_PROTECT?this.i18n("protection"):i===o.TASK_OPERATION_UNPROTECT?this.i18n("unprotection"):this.i18n("rekey"))+" "+this.i18n("failed")}switch(t&&t.operation){case o.TASK_OPERATION_PROTECT:return this.i18n("all")+" "+this.i18n("disks_protected")+".";case o.TASK_OPERATION_UNPROTECT:return this.i18n("all")+" "+this.i18n("disks_unprotected")+".";case o.TASK_OPERATION_REKEY:return this.i18n("all")+" "+this.i18n("disks_rekeyed")+".";case o.TASK_OPERATION_SW_REKEY:return""+this.i18n("software_rekeyed");default:return""+this.i18n("operation_complete")}},_renderEncryptionStatusMsgInProgress:function(e){var t=e.diskInfo,n="";n=e.operation===o.TASK_OPERATION_PROTECT?this.i18n("protecting"):e.operation===o.TASK_OPERATION_UNPROTECT?this.i18n("unprotecting"):this.i18n("rekeying");var i="<strong>"+n+":</strong>",s="";switch(e.currentRunningTask.operation){case o.TASK_OPERATION_PROTECT:case o.TASK_OPERATION_UNPROTECT:case o.TASK_OPERATION_REKEY:s=p({state:'<span class="disksProcessed">'+this.keyAnimationState.disksProcessed+"</span>/"+t.totalNoDisksInCluster+" "+this.i18n("disks_processed")+".",no:t.totalFailedDisksSoFar?this.i18ns("disks_failed_long",t.totalFailedDisksSoFar):""});break;default:s=this.i18n("in_progress")}return'<div class="donut-loader"></div>&nbsp; '+i+" "+s},showRequiredButtons:function(e,t,n){e===o.TASK_OPERATION_PROTECT?(this.$(".unlockProtectionIntent").is(":visible")||this.$(".unlockProtectionIntent").show(),this.$(".lockProtectionIntent").hide(),t&&!n||(this.$(".rekeyProtection").show(),this.$(".rekeyProtection").prop("disabled",!1)),n&&(this.disableSaveControls(".unlockProtectionIntent"),this.$(".rekeyProtection").prop("disabled",!0),this.$(".btnConfig").prop("disabled",!0),t?this.$(".error").length||(this.$("#key").removeClass("on off configure error"),this.$("#key").addClass("error")):this.$(".off").length||(this.$("#key").removeClass("on off configure error"),this.$("#key").addClass("off")))):e===o.TASK_OPERATION_UNPROTECT?(this.$(".lockProtectionIntent").is(":visible")||this.$(".lockProtectionIntent").show(),this.$(".unlockProtectionIntent").hide(),this.$(".rekeyProtection").is(":visible")&&this.$(".rekeyProtection").hide(),n&&(this.disableSaveControls(".lockProtectionIntent"),this.$(".btnConfig").prop("disabled",!0),t?this.$(".error").length||(this.$("#key").removeClass("on off configure error"),this.$("#key").addClass("error")):this.$(".off").length||(this.$("#key").removeClass("on off configure error"),this.$("#key").addClass("off")))):(this.$(".unlockProtectionIntent").is(":visible")||this.$(".unlockProtectionIntent").show(),this.$(".lockProtectionIntent").hide(),this.$(".rekeyProtection").show(),n&&(this.disableSaveControls(".rekeyProtection"),this.$(".unlockProtectionIntent").prop("disabled",!0),this.$(".btnConfig").prop("disabled",!0),t?this.$(".error").length||(this.$("#key").removeClass("on off configure error"),this.$("#key").addClass("error")):this.$(".off").length||(this.$("#key").removeClass("on off configure error"),this.$("#key").addClass("off")))),this.$(".btnConfig").show()},_showRequiredButtons:function(e,t,n){switch(e){case o.TASK_OPERATION_PROTECT:this.$(".unlockProtectionIntent").is(":visible")||this.$(".unlockProtectionIntent").show(),t&&!n||(this.$(".rekeyProtection").show(),this.$(".rekeyProtection").prop("disabled",!1)),n&&(this.disableSaveControls(".unlockProtectionIntent"),this.$(".rekeyProtection").prop("disabled",!0),this.$(".btnConfig").prop("disabled",!0));break;case o.TASK_OPERATION_UNPROTECT:this.$(".lockProtectionIntent").is(":visible")||this.$(".lockProtectionIntent").show(),n&&(this.disableSaveControls(".lockProtectionIntent"),this.disableSaveControls(".rekeyProtection"),this.$(".btnConfig").prop("disabled",!0));break;case o.TASK_OPERATION_REKEY:this.$(".unlockProtectionIntent").is(":visible")||this.$(".unlockProtectionIntent").show(),this.$(".lockProtectionIntent").hide(),this.$(".rekeyProtection").show(),n&&(this.disableSaveControls(".rekeyProtection"),this.$(".unlockProtectionIntent").prop("disabled",!0),this.$(".btnConfig").prop("disabled",!0))}this.$(".btnConfig").show()},enableSaveControls:function(e){this.$(e).button("reset")},disableSaveControls:function(e){this.$(e).button("loading")},homeViewToShow:function(){this._renderDataChange()},displayEnabledProtectionIntent:function(e){var t,n="";this.$(".encryption-state").empty(),this.$(".encryption-state").removeClass("progressErrorState");for(var i in e)e[i]||(i.indexOf("::")>-1?n+="Disk"+i.split("::")[1]+" ":n+="Disk"+i+" ");this.$(".state").length&&this.$(".state").remove(),this.$(".loader").empty(),this.$(".key-progress").remove(),this.$(".error-encryption-status").empty(),n?(this.$(".error").length||(this.$("#key").removeClass("on off configure error"),this.$("#key").addClass("error")),this.displayErrorState(!0,m({msg:n}))):(this.$(".on").length||(this.$("#key").removeClass("on off configure error"),this.$("#key").addClass("on")),t=p({state:"All disks are in a protected state",no:""}),this.$(".encryption-state").text("Encryption State of Cluster : "),this.$(".encryption-state").append(t)),this.showRequiredButtons(o.TASK_OPERATION_PROTECT,n,!1),this.$(".btnConfig").prop("disabled",!1),this.enableSaveControls(".unlockProtectionIntent")},_isDiskErrors:function(e,t){var n="";if(t)for(var i in e)e[i]||(n+=this._createErrorStr(i));else for(var s in e)e[s]&&(n+=this._createErrorStr(s));return n},_createErrorStr:function(e){return e.indexOf("::")>-1?this.i18n("disk")+e.split("::")[1]+" ":this.i18n("disk")+e+" "},displayDisabledProtectionIntent:function(e){var t,n="";this.$(".encryption-state").empty(),this.$(".encryption-state").removeClass("progressErrorState");for(var i in e)e[i]&&(i.indexOf("::")>-1?n+=this.i18n("disk")+i.split("::")[1]+" ":n+=this.i18n("disk")+i+" ");this.$(".state").length&&this.$(".state").remove(),this.$(".loader").empty(),this.$(".key-progress").remove(),this.$(".error-encryption-status").empty(),n?(this.$(".error").length||(this.$("#key").removeClass("on off configure error"),this.$("#key").addClass("error")),this.displayErrorState(!1,m({msg:n}))):(this.$(".off").length||(this.$("#key").removeClass("on off configure error"),this.$("#key").addClass("off")),t=p({state:"All disks are in an unprotected state",no:""}),this.$(".encryption-state").text("Encryption State of Cluster : "),this.$(".encryption-state").append(t)),this.showRequiredButtons(o.TASK_OPERATION_UNPROTECT,n,!1),this.$(".btnConfig").prop("disabled",!1),this.enableSaveControls(".lockProtectionIntent")},onClickProtect:function(e){this.changeProtectionIntent(e,o.TASK_OPERATION_PROTECT,this.encryptionStateObj.encryptionEnforcement)},onClickUnprotect:function(e){this.changeProtectionIntent(e,o.TASK_OPERATION_UNPROTECT,this.encryptionStateObj.encryptionEnforcement)},onClickDualEncrypt:function(e){var t=this,n=function(){t.changeProtectionIntent(e,o.TASK_OPERATION_PROTECT,t.encryptionStateObj.encryptionEnforcement)};this.options.nydusObj.runActionEvent(s.ENCRYPTION_ACTIONS.ENABLE_ENCRYPTION,n)},onClickEnableEncryption:function(){this.options.nydusObj.runActionEvent(s.ENCRYPTION_ACTIONS.ENABLE_ENCRYPTION)},changeProtectionIntent:function(e,t,n){var i,a=this,r=!1;this.isEncryptionOn=!1,this.isReadyForPasswordProtection=!1,this.clearBaseHeader(),t===o.TASK_OPERATION_PROTECT?(r=!0,i=".lockProtectionIntent",this.$(".btnConfig").prop("disabled",!0)):$(e.target).hasClass("retryProtectionIntent")?(r=this.encryptionModel.getCurrentEncryptionStatusModel().currentEncryptionState,i=".retryProtectionIntent"):i=".unlockProtectionIntent",this.$(".error-encryption-status").hide(),this.$(".encryption-state").removeClass("progressErrorState"),this.$(".encryption-state").empty(),this.disableSaveControls(i);var l={success:function(e,t){if(a.$(".loader").empty(),a.$(".key-progress").remove(),a.$(".state").remove(),a.$(".error-encryption-status").empty(),t.value){var n=p({state:"",no:""});a.$(".encryption-state").append(n),e.get(s.PRIMITIVE_KEY)?a.isEncryptionOn=e.get(s.PRIMITIVE_KEY):(a.isReadyForPasswordProtection=!e.get(s.PRIMITIVE_KEY),a.encryptionStateObj.isReadyForPasswordProtection=!e.get(s.PRIMITIVE_KEY),a.encryptionStateObj.isReadyForSoftwareEncryption=!e.get(s.PRIMITIVE_KEY)),setTimeout(function(){a.localTaskManager.getGlobalTasks().fetch({force:!0})},2e3)}else a.showError(" Error : Cannot accept your request forencryption")},error:function(e,t){a.showModelError(e,t)}};if(r){var c={value:!0};n&&(c.software_encryption_scope=n),this.encryptionModel.setEncryptionIntent(c,l)}else{if(this.saveTempData){var d=o.ENCRYPTION_PROP.HARDWARE;this.saveTempData(d)}var u={value:!1};n&&(u.software_encryption_scope=n),this.encryptionModel.setEncryptionIntent(u,l)}},displayErrorState:function(e,t){var n=this.$(".error-encryption-status");this.$(".encryption-state").text("Encryption State of Cluster : ");var i;e?(i=p({state:"Some disks are protected",no:""}),this.$(".encryption-state").append(i),n.append(f({msg:"Protection failed"})),n.append(g),n.append(t),n.append(E({val:"Protect"})),n.show()):(i=p({state:"Some disks are unprotected",no:""}),this.$(".encryption-state").append(i),n.append(f({msg:"Unprotection failed"})),n.append(g),n.append(t),n.append(E({val:"Unprotect"})),n.show())},rekeyConfirm:function(e){var t=this,n='\n          <p class="text-center">\n            <strong>\n              '+this.i18n("rekey_confirm_dialogue_p1")+"\n            </strong>\n          </p>\n          <p>"+this.i18n("rekey_confirm_dialogue_p2")+"</p>\n        ";$.nutanixConfirm({msg:n,class:"-left-align",yes:function(){_.isFunction(e)&&e(),t.triggerRekey()},yesText:this.i18n("confirm_rekey"),noText:this.i18n("cancel"),context:this})},triggerRekey:function(){var e=this,t={success:function(t,n){n.value?setTimeout(function(){e.localTaskManager.getGlobalTasks().fetch({force:!0})},2e3):e.showError(this.i18n("error_rekey_api"))},error:function(t,n){e.showModelError(t,n)}};this.encryptionModel.doRekey(t)},triggerSoftwareRekey:function(){var e=this,t={success:function(t,n){if(n[s.TASK_UUID]){var i=n[s.TASK_UUID];e.setState({currentRunningTask:{operation:o.TASK_OPERATION_SW_REKEY,percentageComplete:0,status:null}}),e.oneTaskCollection=e.localTaskManager.trackTaskStatus(i,{onTaskUpdate:e.updateTask})}else e.showError(e.i18n("error_rekey_api"))},error:function(t,n){e.showModelError(t,n)}};this.encryptionModel.doSWRekey(t)}})}),define("text!templates/popups/encryption/DownloadCSRTableView.html",[],function(){return'<div class="desc">\n  <h4 class="n-title">Certificate Signing Requests </h4>\n  <span class="desc">Download the CSRs for the Nodes</span>\n</div>\n<div class="control-group button-row">\n  <div class="controls">\n    <button class="btn btn-primary longBtn downloadAllCSR">\n      Download CSRs for all nodes\n    </button>\n  </div>\n</div>\n\n<table id="encryptionCertiList" class="table table-hover">\n  <thead>\n  <tr>\n    <th>Node Address</th>\n    <th>Action</th>\n  </tr>\n  </thead>\n  <tbody>\n  </tbody>\n</table>\n\n<div class="bottom-align-btns">\n  <div class="control-group">\n    <div class="pull-left">\n      <button class="backForm form2Element btn n-secondary-btn btnBack"\n          actionTargetId="create-config" action="showSubView">\n        <i data-icon="x" aria-hidden="true"></i>\n        Back\n      </button>\n    </div>\n  </div>\n</div>'}),define("views/popups/encryption/DownloadCSRTableView",["views/basecomponents/BaseSubView","utils/AppConstants","managers/NavigationManager","data/DataProperties","text!templates/popups/encryption/DownloadCSRTableView.html"],function(e,t,n,i,s){"use strict";var a=_.template('<tr class="n-table-row"><td><%= (model.address) %></td><td><button value="Download All CSRS" class="btn btn-primary downloadCSR" <%= (model.action) %> data-node-id="<%= (model.nodeNo) %>">Download</button></td></tr>');return e.extend({encryptionModel:null,subViewTemplate:_.template(s),events:{"click  .btnBack":"onClickLinkAction","click  .downloadCSR":"onClickDownload","click  .downloadAllCSR":"onClickDownload"},modelEvents:{"reset  nodeEntries":"renderNodeEntries","remove nodeEntries":"renderNodeEntries"},initialize:function(t){e.prototype.initialize.apply(this,arguments),this.encryptionModel=t.encryptionModel,_.bindAll(this,"showModelError"),this.nodeEntries=this.encryptionModel.getNodeDetails(),this.nodeEntries.setIntervalTime(5e3),this.delegateModelEvents()},hideView:function(t){e.prototype.hideView.apply(this,arguments),this.stopServices()},showView:function(){e.prototype.showView.apply(this,arguments),this.startServices()},render:function(){this.$el.html(this.subViewTemplate())},onStartServices:function(){e.prototype.onStartServices.apply(this,arguments),this.nodeEntries.startPolling()},onStopServices:function(){e.prototype.onStopServices.apply(this,arguments),this.nodeEntries.stopPolling()},renderNodeEntries:function(e){if(this.isViewVisible()){var t=!0,n=this.$("#encryptionCertiList > tbody");n.empty(),_.each(e.models,function(e){var s=a({model:{address:e.get(i.SERVICE_VM_IP),nodeNo:e.get(i.SERVICE_VM_ID),action:e.get(i.ENCRYPTION_PROP.HAS_CSR)?"":"disabled"}});e.get(i.ENCRYPTION_PROP.HAS_CSR)||(t=!1),n.append(s)}),this.$(".downloadAllCSR").prop("disabled",!t)}},onClickDownload:function(e){var i;this.clearBaseHeader(),$(e.currentTarget).hasClass("downloadAllCSR")||(i=$(e.currentTarget).attr("data-node-id")),n.executeDownloadAction(t.FILE_ENCRYPTION_CSR,i)}})}),define("text!templates/popups/encryption/UploadCSRTableView.html",[],function(){
return'<div class="desc">\n  <h4 class="n-title">Manage Signed Certificates </h4>\n  <div class="selectedUploadFiles">\n    <span class="selectedFileName uploadFileName"></span>\n  </div>\n</div>\n\n<form id="uploadCSRForm" class="form-horizontal"\n    target="upload_target_svm" method="post" enctype="multipart/form-data">\n  <div class="control-group button-row">\n    <div class="controls">\n      <%= Components.fileInput({\n        btnText: \'Upload Files\',\n        id: "UploadCSRfiles",\n        classes: \'uploadItem btn-default\',\n        variants: \'-inline-flex -no-filename\',\n        name: "certificateFile",\n        multiple: true\n      }) %>\n      <button class="btn testAllNodes">\n        Test all nodes\n      </button>\n    </div>\n  </div>\n\n  <iframe id="uploadTargetSvm" name="upload_target_svm"/>\n</form>\n\n<div class="upload-table-wrapper">\n  <table id="encryptionUploadCertiList" class="table table-hover">\n    <thead>\n    <tr>\n      <th>Address</th>\n      <th class="col-status-heading">Status</th>\n      <th class="col-action-heading">Action</th>\n    </tr>\n    </thead>\n    <tbody>\n    </tbody>\n  </table>\n</div>\n<div class="bottom-align-btns">\n  <div class="control-group btn-right">\n    <div class="controls">\n      <button disabled class="btnUpload btn uploadItem">\n        Submit\n      </button>\n    </div>\n  </div>\n  <div class="pull-left">\n    <button class="backForm  form2Element  btn n-secondary-btn btnBack"\n          actionTargetId="create-config" action="showSubView">\n      <i data-icon="x" aria-hidden="true"></i>\n      Back\n    </button>\n    </div>\n</div>'}),define("views/popups/encryption/UploadCSRTableView",["views/basecomponents/BaseSubView","utils/AppUtil","utils/AppConstants","data/DataProperties","text!templates/popups/encryption/UploadCSRTableView.html"],function(e,t,n,i,s){"use strict";var a=_.template('<tr class="n-table-row"><td><%= (model.address) %></td><td class="status-csr <%=(model.className)%>" data-status-node-no ="<%=(model.nodeNo)%>"></td><td class="action-cell"><span class="test-csr <%=(model.className)%>" data-node-no ="<%=(model.nodeNo)%>"></span><span class="action-separator"></span><span class="delete-csr <%=(model.className)%>"data-del-node-no ="<%=(model.nodeNo)%>"></span></td></tr>'),o=_.template('<span class="<%= cName  %>"<% if (model.popoverVMId) { %> data-toggle="popover" data-id="<%= model.popoverVMId %>"<% } %>><%= (model.status) %><% if (model.popoverVMId) { %> <span class="n-info-icon">i</span><% } %></span>'),r=_.template('<span class="testSpan"><a><%= (model.action) %></a></span>'),l=_.template('<span class="deleteSpan"><a><%= (model.deleteAction) %></a></span>'),c=_.template('<div class="n-cell-hover"> <div class="n-row"> <div class="n-item">Address</div>  <div class="n-item">Status</div>  <div class="n-item">Message</div> </div> <% _.each(testResults, function(testResult) { %> <div class="n-row"> <div class="n-item"><%= testResult.ipAddress %></div> <div class="n-item"><%= testResult.testStatus %></div> <% if (testResult.message) { %> <div class="n-item"> <%= _.escape(testResult.message) %> </div> <% } %> </div><% }); %> </div>');return e.extend({encryptionModel:null,hostCollection:null,recentTestResults:null,fileStatusCallBacks:null,syncEncryptionState:null,certificateMap:null,subViewTemplate:_.template(s),events:{"click  .btnBack":"onClickLinkAction","click  .btnUpload":"onUpload","click  input":"clearBaseHeader","change #UploadCSRfiles":"handleFileSelect","click  .testAction":"testCertificate","click  .testAllNodes":"testAllCertificates","click  .deleteAction":"deleteConfirm"},modelEvents:{"reset  hostCollection":"fetchRecentTestResults","remove hostCollection":"fetchRecentTestResults"},initialize:function(t){e.prototype.initialize.apply(this,arguments),t&&_.isObject(t.nydusObj)&&_.isFunction(t.nydusObj.syncEncryptionState)&&(this.syncEncryptionState=this.options.nydusObj.syncEncryptionState),this.encryptionModel=t.encryptionModel,this.fileStatusCallBacks={},this.certificateMap={},this.fileStatusCallBacks.load=_.bind(this.onFileCompleteLoad,this),this.fileStatusCallBacks.progress=_.bind(this.onFileLoadinProgress,this),this.fileStatusCallBacks.error=_.bind(this.onFileLoadError,this),_.bindAll(this,"showModelError"),this.hostCollection=this.encryptionModel.getNodeDetails(),this.recentTestResults=this.encryptionModel.getRecentTestDetails(),this.delegateModelEvents()},render:function(){this.$el.html(this.subViewTemplate(this.vtOptions())),this.showMessageForLegacyBrowser()},setViewOption:function(t){e.prototype.setViewOption.apply(this,arguments),this.currentKMIPName=t.dataEntryId},refreshView:function(){var e;if(this.render(),this.encryptionModel.getCurrentEncryptionStatusModel().currentEncryptionState){this.encryptionModel.getKMIPCollection().checkActiveKMIPs(this.currentKMIPName).present&&(e=this.$(".uploadItem")[0],$(e).prop("disabled",!0),$(e).parent().addClass("disabled"))}else t.isIE9OrBelow()||(e=this.$(".uploadItem")[0],$(e).prop("disabled")&&$(e).prop("disabled",!1),$(e).parent().hasClass("disabled")&&$(e).parent().removeClass("disabled"))},renderNodeEntries:function(){var e={},t=this.$("#encryptionUploadCertiList > tbody");0===t.children().length&&this.hostCollection.each(function(n){e.address=n.get(i.SERVICE_VM_IP),e.nodeNo=n.get(i.SERVICE_VM_ID),e.className=n.get(i.SERVICE_VM_IP).replace(/\./g,"");var s=a({model:e});t.append(s)})},showMessageForLegacyBrowser:function(){var e=t.uploadCheck();e&&(this.showError(e),this.$(".uploadItem").addClass("disabled"),this.$("#UploadCSRfiles").attr("disabled","disabled"))},hideView:function(t){this.destroyPopover(),e.prototype.hideView.apply(this,arguments),this.stopServices()},showView:function(){e.prototype.showView.apply(this,arguments),this.startServices()},onStartServices:function(){e.prototype.onStartServices.apply(this,arguments),this.hostCollection.startPolling()},onStopServices:function(){e.prototype.onStopServices.apply(this,arguments),this.hostCollection.stopPolling()},renderData:function(){this.isViewVisible()&&(this.renderNodeEntries(),this.checkActionBeforeRendering())},fetchRecentTestResults:function(){var e=this,t={success:function(t,n){e.renderData()},error:this.showModelError};this.recentTestResults.fetch(t)},onUpload:function(){var e=this,t={keyManagementServerName:this.currentKMIPName,certificateMap:this.certificateMap},n={success:function(t,n){e.hostCollection.fetch(),e.$(".btnUpload").prop("disabled",!0),e.$(".selectedUploadFiles").hide(),n.value&&e.showInfo(n.value)},error:this.showModelError};this.encryptionModel.saveMultiFileUpload(t,n)},renderStatusEntries:function(e){var t=e.get(i.ENCRYPTION_PROP.KMIP_MAP)[this.currentKMIPName],n=!1,s=!1,a=!1,c=e.get(i.SERVICE_VM_ID);if(null!==t){var d=this.getRecentTestResults(this.currentKMIPName,c);if(d.length){var p=!1;_.each(d,function(e){"Success"===e.testStatus?p=!0:"Failure"===e.testStatus?s=!0:a=!0}),p||(n=!0)}}if(!a){var u={};if(null===t||void 0===t)u.status="Waiting for Upload",u.action="Test CS";else if(t){var h=this.encryptionModel.getKMIPCollection().checkActiveKMIPs(this.currentKMIPName);h.present&&n?u.status="Failed":u.status="Verified",u.action="Re-Test CS"}else n?(u.status="Failed",u.action="Re-Test CS"):s?(u.status="Verified",u.action="Re-Test CS"):(u.status="Uploaded",u.action="Test CS");u.deleteAction="Delete";var m=e.get(i.SERVICE_VM_IP).replace(/\./g,""),f=this.$(".status-csr."+m);f.empty();var v="";v=s&&n?"failedTesting partFailedIP":n?"failedTesting":s?"partFailedIP":"",s&&(u.popoverVMId=c);var g=o({model:u,cName:v});f.append(g);var E=this.$(".test-csr."+m);E.empty();var T=r({model:u});E.append(T);var C=this.$(".delete-csr."+m);C.empty();var S=l({model:u});C.append(S),"Waiting for Upload"!==u.status?(E.children().addClass("testAction"),C.children().addClass("deleteAction")):E.children().hasClass("testAction")&&(E.children().removeClass("testAction"),C.children().removeClass("deleteAction"))}},checkActionBeforeRendering:function(){if(this.destroyPopover(),this.singleTest||this.singleDelete?this.renderStatusEntries(this.hostCollection.get(this.singleTest||this.singleDelete)):this.hostCollection.each(function(e){this.renderStatusEntries(e)},this),this.singleTest=!1,this.singleDelete=!1,this.testObj={},this.encryptionModel.getCurrentEncryptionStatusModel().currentEncryptionState){var e=this.encryptionModel.getKMIPCollection().checkActiveKMIPs(this.currentKMIPName);e.present&&1===e.activeKMIPSize&&_.each(this.$(".deleteAction"),function(e){$(e).children().attr("disabled","disabled")})}var t=this;this.$(".partFailedIP").popover({title:"Test Results",placement:"top",trigger:"hover",html:!0,animation:!1,delay:0,container:$("body"),content:function(){var e=$(this).data("id");return c({testResults:t.getRecentTestResults(t.currentKMIPName,e)})}})},destroyPopover:function(){this.$(".partFailedIP").popover("destroy")},handleFileSelect:function(e){this.$(".selectedUploadFiles").hide(),this.$(".btnUpload").prop("disabled",!1);var i="",s=[];if(t.isIE9OrBelow())this.$(".selectedUploadFiles").hide(),$(e.currentTarget).val()&&(i+=$(e.currentTarget).val().split("\\").pop()+" Selected",this.$(".selectedFileName").empty(),this.$(".selectedFileName").text(i),this.$(".selectedUploadFiles").show());else{var a=e.target.files.length;if(a>0){for(var o=0;o<a;o++)s[o]=e.target.files[o].name.split("\\").pop();i=s.join(", ")+" selected",this.$(".selectedFileName").empty(),this.$(".selectedFileName").text(i),this.$(".selectedUploadFiles").show()}this.certificateMap={},t.loadMultipleFiles(e.target.files,this.fileStatusCallBacks,n.FILE_TYPE_TEXT)}e.target.value=null},onFileCompleteLoad:function(e,t){t.size<1e5?this.certificateMap[e.target.result]=t.name:(this.showError(t.name+" cannot be uploaded because it exceeds the maximum file size limit of 100KB"),this.$(".btnUpload").prop("disabled",!0))},onFileLoadinProgress:function(e){},onFileLoadError:function(e){},testCertificate:function(e){var t=[];t.push($(e.currentTarget).parent().attr("data-node-no")),this.singleTest=t[0],this.doTestCertificates({serverList:[this.currentKMIPName],nodeIdList:t})},testAllCertificates:function(){var e=[];this.hostCollection.each(function(t){null!==t.get(i.ENCRYPTION_PROP.KMIP_MAP)[this.currentKMIPName]&&e.push(t.get(i.SERVICE_VM_ID))},this),this.doTestCertificates({serverList:[this.currentKMIPName],nodeIdList:e})},doTestCertificates:function(e){var n=this,i={success:function(e,i){if(n.testObj=i,n.hostCollection.fetch(),i.hasFailures){n.showError(t.processAjaxError("Failure in testing"))}else n.syncEncryptionState(),n.showSuccess("Testing successful")},error:function(e,i){n.testObj=i,n.hostCollection.fetch(),n.showError(t.processAjaxError(i.responseText))}};this.encryptionModel.doTestResult(e,i),this.testInProgress(e)},testInProgress:function(e){var t={};t.status="In Progress";var n,i;_.each(e.nodeIdList,function(e){e.indexOf("::")>-1?(n=e.replace(/:/g,"\\:"),i="[data-status-node-no = "+n+"]"):i="[data-status-node-no = "+e+"]";var s=this.$(".status-csr."+i);s.empty();var a=o({model:t,cName:""});s.append(a)},this)},deleteConfirm:function(e){"disabled"!==$(e.target).attr("disabled")&&$.nutanixConfirm({msg:"Are you sure you want to delete the certificate ?",yes:function(){this.deleteCertificates(e.currentTarget)},yesText:"Yes",noText:"No",context:this})},deleteCertificates:function(e){var t=$(e).parent().attr("data-del-node-no"),n=this.currentKMIPName,i=this;this.singleDelete=t;var s={success:function(){i.showSuccess("Successfully deleted the certificate"),i.hostCollection.fetch()},error:this.showModelError};this.encryptionModel.deleteCertificate(t,n,s)},getRecentTestResults:function(e,t){return this.recentTestResults.getTestResults(e,t)}})}),define("views/popups/encryption/EncryptionPagePopupView",["views/basecomponents/popups/BasePagePopupView","views/popups/encryption/ConfigFormSubView","views/popups/encryption/CertiListSubView","views/popups/encryption/CaConfigSubView","views/popups/encryption/EncryptionLaunchSubView","views/popups/encryption/DownloadCSRTableView","views/popups/encryption/UploadCSRTableView","data/DataProperties","managers/TaskManager","utils/AppConstants","utils/HypervisorUtil","managers/ClusterManager","managers/LicenseManager","models/storage/ContainerCollection","models/encryption/EncryptionModel","models/systemdata/SystemDataModel"],function(e,t,n,i,s,a,o,r,l,c,d,p,u,h,m,f){"use strict";var v=_.template('\n      <div class="bottom-align-btns -primary clearfix">\n        <%= leftBtns %>\n        <%= rightBtns %>\n      </div>\n    '),g=_.template('\n      <div class="control-group <%= alignClass %>">\n        <div class="controls">\n        <%= btns %>\n        </div>\n      </div>\n    '),E=_.template("\n      <b><%= i18n('enable_encryption_q') %></b>\n      <br/><br/>\n      <%= i18n('type_encrypt_to_confirm') %>\n      <input type=\"text\" placeholder=\"<%= i18n('type_encrypt') %>\"\n        autofocus />\n    ");return e.extend({ENCRYPTION_SUBVIEWS:{ADD_NODE:"add-node",ADD_CA:"add-ca",CREATE_CONFIG:"create-config",EDIT_CONFIG:"edit-config",HOME:"home-subview",HOME_INPROCESS:"home-inprocess-subview",HOME_COMPLETE:"home-complete-subview",DOWNLOAD_CSR:"download-csr",UPLOAD_CSR:"upload-csr"},name:"EncryptionPopupView",fullPagePopup:!0,encryptionModel:null,containerCollection:null,nydusObj:null,encryptionStateObj:null,uiStateObj:null,tempSaveModel:null,localTaskManager:null,clusterSEDTaskModel:null,latestClusterSEDTasks:null,el:"#encryptionPagePopup",isLoadingCoverRendered:null,showLoader:null,events:{"click  .modal-header .close":"hide","click  .btnCancel":"hide","click  .btnClose":"hide"},initialize:function(t){e.prototype.initialize.apply(this,arguments),_.bindAll(this,"fetchAndGo","setLoadingState","loading","runActionEvent","enableEncryption","syncEncryptionState","updateTask"),this.tempSaveModel=new f({type:r.SYSTEM_DATA_TYPE_TEMP_SAVE},{enableNotifications:!1}),this.encryptionModel=new m,this.containerCollection=new h,this.localTaskManager=l,this.encryptionStateObj=this._initEncryptionStateObj(),this.uiStateObj=this._initUIStateObj(),this.setLoadingState(!0),this._fetchInitialViewData()},_initEncryptionStateObj:function(){return{isLoading:null,isPageRendered:null,disableUIConfig:!1,diskEncryptionStatus:null,clusterHypervisor:d.getClusterHypervisors()||null,currentRunningTask:null,hasDataBeenWritten:null,isEncryptionConfigurable:!0,isSEDAvailable:p.getCurrentClusterModel().get(r.CLUSTER_SED)||null,isOneOrTwoNodeCluster:p.isOneOrTwoNodeCluster(),totalNoDisksInCluster:null,tempSaveData:null,encryptionType:null,hwEnforcement:null,encryptionEnforcement:null,isStorageContainerEncryptionAllowed:null,isClusterLevelEncryptionAllowed:null,isSoftwareEncryptionAllowed:null,isSoftwareEncryptionLicenseValid:u.canUseFeat(u.FEAT_MAP.SOFTWARE_ENCRYPTION,null,!0),isSoftwareEnforcementAllowed:null,availableEncryptionOptions:null,encryptionState:0,isEncryptionConfigured:null,isReadyForPasswordProtection:null,isReadyForSoftwareEncryption:null,isEncryptionOn:null,isProtectionOn:null,isSoftwareEncryptionOn:null,kms:null}},_initUIStateObj:function(){return{kms:null}},_fetchInitialViewData:function(){var e=this,t=[this.tempSaveModel.fetch({alwaysTriggerChange:!0,error:this.showModelError}),this.encryptionModel.fetchCertiInfo({alwaysTriggerChange:!0,success:function(t,n){e.isCertInfoValid(t)&&0===e.encryptionStateObj.encryptionState&&e.encryptionStateObj.encryptionState++},error:this.showModelError}),this.encryptionModel.fetchCurrentEncryptionStatus({alwaysTriggerChange:!0,success:function(t,n){e._fetchEncryptionStatusSuccess(t,n)},error:this.showModelError}),this.encryptionModel.fetchKMSType({alwaysTriggerChange:!0,success:function(t,n){e.setKMSType(n.kmsType)},error:function(t,n){e.showHeaderError(t,n)}}),this.containerCollection.fetch({silent:!0,error:this.showModelError}),this.localTaskManager.getGlobalTasks().fetch({force:!0,success:function(t,n){e._onResetTasks(t,n)},error:this.showModelError})];$.whenAll.apply($,t).done(function(){e.updateEncryptionState(),e.tempSaveModel.on("change",e.onChangeTempSave,e),e.localTaskManager.getGlobalTasks().on("reset",e._onResetTasks,e),e.encryptionStateObj.isPageRendered||(e._renderContent(),e.setLoadingState(!1))})},setKMSType:function(e){this.encryptionStateObj.kms=e,this.uiStateObj.kms=e},setUIKMSType:function(e){this.uiStateObj.kms=e},syncEncryptionState:function(e){var t=this;this.encryptionModel.fetchCurrentEncryptionStatus({force:!0,success:function(n,i){t._fetchEncryptionStatusSuccess(n,i),t.updateEncryptionState(),e&&_.isFunction(e.success)&&e.success()},error:function(){e&&_.isFunction(e.error)&&e.error()}})},_fetchEncryptionStatusSuccess:function(e,t){this.encryptionStateObj.totalNoDisksInCluster=_.size(e.diskEncryptionStatus),this.encryptionStateObj.isReadyForPasswordProtection=t.isReadyForPasswordProtection,this.encryptionStateObj.isReadyForSoftwareEncryption=t.isReadyForSoftwareEncryption,this.encryptionStateObj.isSoftwareEncryptionOn=e.state.isSoftwareEncryptionOn,this.encryptionStateObj.isEncryptionOn=e.state.isEncryptionOn,this.encryptionStateObj.encryptionEnforcement=e.state.softwareEncryptionScope,this.encryptionStateObj.isProtectionOn=e.state.isSEDProtectionOn,this.encryptionStateObj.diskEncryptionStatus=e.diskEncryptionStatus,e.state.isSEDProtectionOn&&(this.encryptionStateObj.hwEnforcement=c.ENCRYPTION_PROP.HARDWARE)},isCertInfoValid:function(e){return(e||this.encryptionModel.getCertiInfo()).get(r.ENCRYPTION_PROP.EMAIL)},initializeProperties:function(){return $.extend(this.DEFAULT_POPUP_PROP,{title:this.i18n("page_title")})},_onResetTasks:function(e,t){var n=this;this.latestClusterSEDTasks=null,this.encryptionStateObj.currentRunningTask={},this.clusterSEDTaskModel=this.localTaskManager.getGlobalTasks().getClusterSEDTaskModel()||null;var i=null;this.clusterSEDTaskModel&&(this.latestClusterSEDTasks=this.getCurrentRunningTask(this.clusterSEDTaskModel.get(r.TASK_TYPE)),i=_.first(this.latestClusterSEDTasks),this.nydusObj&&(this.nydusObj.latestClusterSEDTasks=this.latestClusterSEDTasks)),this.syncEncryptionState({success:function(){n.updateTask(i)}})},updateTask:function(e){if(e){var t=e;e.entityType&&e.entityType===c.ENTITY_TASK&&(t=e.toJSON());var n={status:t[r.TASK_STATUS],percentageComplete:t[r.TASK_PERCENT_COMPLETE],operation:t[r.TASK_TYPE]};this.encryptionStateObj.currentRunningTask=_.extend(this.encryptionStateObj.currentRunningTask,n),this.nydusObj&&(this.nydusObj.encryptionStateObj=this.encryptionStateObj)}this.getSubView(this.ENCRYPTION_SUBVIEWS.HOME)&&this.getSubView(this.ENCRYPTION_SUBVIEWS.HOME).updateState(this.nydusObj)},getCurrentRunningTask:function(e){var t=null;switch(e){case c.TASK_OPERATION_PROTECT:case c.TASK_OPERATION_UNPROTECT:case c.TASK_OPERATION_REKEY:case c.TASK_OPERATION_SW_REKEY:t=this.localTaskManager.getGlobalTasks().getLatestSEDOperationTasks(e)}return t},render:function(){e.prototype.render.apply(this,arguments),this.showLoader||(this.showLoader=this.loading),this.encryptionStateObj.isLoading?this.showLoader(this.encryptionStateObj.isLoading):(this._renderContent(),this.encryptionStateObj.isPageRendered=!0)},_renderContent:function(e){e?this.selectSubView({subViewId:e}):this.selectSubView({subViewId:this.ENCRYPTION_SUBVIEWS.HOME}),this.applyNutanixInput()},_renderViewFooter:function(e,t){var n=e||"",i=t||"",s="",a=g(this.vtOptions({alignClass:"btn-left",btns:n})),o=g(this.vtOptions({alignClass:"btn-right",btns:i}));return(n||i)&&(s=v(this.vtOptions({leftBtns:n?a:"",rightBtns:i?o:""}))),s},hide:function(t){if(!t||!$(t.currentTarget).prop("disabled")){var n=arguments;t&&$(t.currentTarget).hasClass("encryptionInProgress")?$.nutanixConfirm({msg:"Warning: Encryption in progress. Nutanix recommends that you do not exit this session. Do you still want to exit ?",yes:function(){e.prototype.hide.apply(this,n)},yesText:"Yes",noText:"No",context:this}):e.prototype.hide.apply(this,arguments)}},destroy:function(){this.tempSaveModel&&this.tempSaveModel.off(),this.encryptionModel&&this.encryptionModel.off(),this.localTaskManager.getGlobalTasks().off("reset",this._onResetTasks,this),e.prototype.destroy.apply(this,arguments)},createSubView:function(e){var r=void 0,l={};switch(this.nydusObj={encryptionStateObj:this.encryptionStateObj||{},uiStateObj:this.uiStateObj||{},containerCollection:this.containerCollection||null,clusterSEDTaskModel:this.clusterSEDTaskModel||null,latestClusterSEDTasks:this.latestClusterSEDTasks||null,tempSaveModel:this.tempSaveModel||{},tempSaveData:this.getTempSaveData(),saveTempData:this.saveTempData.bind(this),fetchAndGo:this.fetchAndGo.bind(this),syncEncryptionState:this.syncEncryptionState.bind(this),renderViewFooter:this._renderViewFooter.bind(this),runActionEvent:this.runActionEvent,setLoadingState:this.setLoadingState,localTaskManager:this.localTaskManager,updateTask:this.updateTask,saveKMS:this.saveKMS.bind(this),setUIKMSType:this.setUIKMSType.bind(this),canSoftwareEncryptionBeEnabled:this.canSoftwareEncryptionBeEnabled.bind(this)},l.el="#"+e,l.encryptionModel=this.encryptionModel,l.nydusObj=this.nydusObj,e){case this.ENCRYPTION_SUBVIEWS.CREATE_CONFIG:r=new t(l);break;case this.ENCRYPTION_SUBVIEWS.ADD_NODE:r=new n(l);break;case this.ENCRYPTION_SUBVIEWS.ADD_CA:r=new i(l);break;case this.ENCRYPTION_SUBVIEWS.HOME:r=new s(l);break;case this.ENCRYPTION_SUBVIEWS.DOWNLOAD_CSR:r=new a(l);break;case this.ENCRYPTION_SUBVIEWS.UPLOAD_CSR:r=new o(l)}return r},setLoadingState:function(e){_.isFunction(this.showLoader)&&this.showLoader(e),this.encryptionStateObj.isLoading=e},loading:function(e){var t=this.$el||null;e&&t&&!this.isLoadingCoverRendered&&(t.find(".n-modal-wrapper").append('<div class="loading-cover vh-center"><div class="donut-loader-blue-large"></div></div>'),this.isLoadingCoverRendered=!0),!e&&t&&this.isLoadingCoverRendered&&(this.$(".loading-cover").remove(),this.isLoadingCoverRendered=!1)},fetchAndGo:function(e,t,n){var i={success:function(){t()}};_.isFunction(n)&&n(),e.fetch(i)},onChangeEncryptionModel:function(){},onChangeTempSave:function(){this.updateEncryptionState()},updateEncryptionState:function(){this.encryptionStateObj.isStorageContainerEncryptionAllowed=this.isStorageContainerEncryptionAllowed(),this.encryptionStateObj.isClusterLevelEncryptionAllowed=this.isClusterLevelEncryptionAllowed(),this.encryptionStateObj.isSoftwareEncryptionAllowed=this.isSoftwareEncryptionAllowed(),this.encryptionStateObj.isSoftwareEnforcementAllowed=this.isSoftwareEnforcementAllowed(),this.encryptionStateObj.availableEncryptionOptions=this.getAvailableEncryptionOptions(this.encryptionStateObj),this.encryptionStateObj.isEncryptionConfigurable=this.encryptionStateObj.availableEncryptionOptions&&this.encryptionStateObj.availableEncryptionOptions.length,this.encryptionStateObj.isEncryptionOn?(this.encryptionStateObj.isEncryptionConfigured=!0,this._updateTempDataState()):this.encryptionStateObj.availableEncryptionOptions&&1===this.encryptionStateObj.availableEncryptionOptions.length?(this.encryptionStateObj.encryptionType=this.encryptionStateObj.availableEncryptionOptions[0].encryptionType,this.encryptionStateObj.encryptionEnforcement=this.encryptionStateObj.availableEncryptionOptions[0].encryptionEnforcement,this.isAPIReadyforEncryption()?(this.encryptionStateObj.isEncryptionConfigured=!0,0===this.encryptionStateObj.encryptionState&&this.encryptionStateObj.encryptionState++):this.encryptionStateObj.isEncryptionConfigured=!1):this.encryptionStateObj.availableEncryptionOptions&&this.encryptionStateObj.availableEncryptionOptions.length>1&&this._updateTempDataState()},getAvailableEncryptionOptions:function(e){var t=[];return e.isSEDAvailable&&t.push({encryptionType:c.ENCRYPTION_PROP.HARDWARE,encryptionEnforcement:null}),e.isStorageContainerEncryptionAllowed&&t.push({encryptionType:c.ENCRYPTION_PROP.SOFTWARE,encryptionEnforcement:c.ENCRYPTION_PROP.SE_SCOPE_STORAGE_CONTAINER}),e.isClusterLevelEncryptionAllowed&&t.push({encryptionType:c.ENCRYPTION_PROP.SOFTWARE,encryptionEnforcement:c.ENCRYPTION_PROP.SE_SCOPE_CLUSTER}),t},_updateTempDataState:function(){var e=this.encryptionStateObj,t=e.isProtectionOn,n=e.isSoftwareEncryptionOn,i=e.encryptionEnforcement,s=this.encryptionStateObj.tempSaveData||this.getTempSaveData();s&&(this.encryptionStateObj.hwEnforcement=t?c.ENCRYPTION_PROP.HARDWARE:this.getHWEnforce(s),this.encryptionStateObj.encryptionEnforcement=n?i:this.getSWEnforce(s),0===this.encryptionStateObj.encryptionState&&this.encryptionStateObj.encryptionState++,this.isAPIReadyforEncryption()&&(this.encryptionStateObj.isEncryptionConfigured=!0),!this.encryptionStateObj.isSoftwareEncryptionAllowed&&this.encryptionStateObj.encryptionType===c.ENCRYPTION_PROP.SOFTWARE&&this.encryptionStateObj.isSEDAvailable?this.encryptionStateObj.encryptionType=c.ENCRYPTION_PROP.HARDWARE:this.encryptionStateObj.isSoftwareEncryptionAllowed||this.encryptionStateObj.encryptionType!==c.ENCRYPTION_PROP.SOFTWARE||(this.encryptionStateObj.isEncryptionConfigurable=!1))},getHWEnforce:function(e){var t=null;switch(e){case c.ENCRYPTION_PROP.HARDWARE+c.ENCRYPTION_PROP.SE_SCOPE_CLUSTER:case c.ENCRYPTION_PROP.HARDWARE+c.ENCRYPTION_PROP.SE_SCOPE_STORAGE_CONTAINER:case c.ENCRYPTION_PROP.HARDWARE:t=c.ENCRYPTION_PROP.HARDWARE;break;default:t=""}return t},getSWEnforce:function(e){var t=null;switch(e){case c.ENCRYPTION_PROP.HARDWARE+c.ENCRYPTION_PROP.SE_SCOPE_CLUSTER:t=c.ENCRYPTION_PROP.SE_SCOPE_CLUSTER;break;case c.ENCRYPTION_PROP.HARDWARE+c.ENCRYPTION_PROP.SE_SCOPE_STORAGE_CONTAINER:t=c.ENCRYPTION_PROP.SE_SCOPE_STORAGE_CONTAINER;break;case c.ENCRYPTION_PROP.SE_SCOPE_CLUSTER:t=c.ENCRYPTION_PROP.SE_SCOPE_CLUSTER;break;case c.ENCRYPTION_PROP.SE_SCOPE_STORAGE_CONTAINER:t=c.ENCRYPTION_PROP.SE_SCOPE_STORAGE_CONTAINER;break;default:t=""}return this.validateSWScope(t)},validateSWScope:function(e){var t=this.encryptionStateObj,n=t.isClusterLevelEncryptionAllowed,i=t.isStorageContainerEncryptionAllowed;return n||i?e===c.ENCRYPTION_PROP.SE_SCOPE_CLUSTER&&!n&&i?c.ENCRYPTION_PROP.SE_SCOPE_STORAGE_CONTAINER:e===c.ENCRYPTION_PROP.SE_SCOPE_STORAGE_CONTAINER&&n&&!i?c.ENCRYPTION_PROP.SE_SCOPE_CLUSTER:e:""},canSoftwareEncryptionBeEnabled:function(e){var t=e.isSoftwareEncryptionLicenseValid,n=e.isEncryptionConfigured,i=e.encryptionEnforcement,s=e.isSoftwareEncryptionOn,a=e.isReadyForSoftwareEncryption,o=e.kms;return!s&&t&&!!i&&n&&this.isSoftwareKMSSetup(a,o)},isSoftwareKMSSetup:function(e,t){return t===c.ENCRYPTION_PROP.LKM||t===c.ENCRYPTION_PROP.EKM&&e},isAPIReadyforEncryption:function(){var e=this.encryptionStateObj,t=e.kms,n=e.isReadyForPasswordProtection,i=e.isReadyForSoftwareEncryption;return t===c.ENCRYPTION_PROP.LKM||this.isEKMAPIReadyforEncryption(t,n,i)},isEKMAPIReadyforEncryption:function(e,t,n){return e===c.ENCRYPTION_PROP.EKM&&(t||n)},getEncryptionType:function(e){var t=null;return e===c.ENCRYPTION_PROP.HARDWARE?t=c.ENCRYPTION_PROP.HARDWARE:e!==c.ENCRYPTION_PROP.SE_SCOPE_STORAGE_CONTAINER&&e!==c.ENCRYPTION_PROP.SE_SCOPE_CLUSTER||(t=c.ENCRYPTION_PROP.SOFTWARE),t},getEncryptionEnforcement:function(e){var t=null;return e===c.ENCRYPTION_PROP.SE_SCOPE_STORAGE_CONTAINER?t=c.ENCRYPTION_PROP.SE_SCOPE_STORAGE_CONTAINER:e===c.ENCRYPTION_PROP.SE_SCOPE_CLUSTER&&(t=c.ENCRYPTION_PROP.SE_SCOPE_CLUSTER),t},getTempSaveData:function(){var e=null;return this.tempSaveModel.getTempSaveState(r.SYSTEM_DATA_TYPE_TEMP_SAVE_ENCRYPTION)&&(e=this.tempSaveModel.getTempSaveState(r.SYSTEM_DATA_TYPE_TEMP_SAVE_ENCRYPTION)),e},saveKMS:function(e,t){var n=this;this.encryptionModel.saveKMSType(e,{alwaysTriggerChange:!0,success:function(){n.setKMSType(e),n.syncEncryptionState(t)},error:function(e,n){t&&_.isFunction(t.error)&&t.error(e,n)}})},isStorageContainerEncryptionAllowed:function(){return d.hasESX(null,this.encryptionStateObj.clusterHypervisor)||d.hasHyperV(null,this.encryptionStateObj.clusterHypervisor)},isClusterLevelEncryptionAllowed:function(){return!this.encryptionStateObj.hasDataBeenWritten||this.encryptionStateObj.isEncryptionOn&&this.encryptionStateObj.encryptionEnforcement===c.ENCRYPTION_PROP.SE_SCOPE_CLUSTER},isSoftwareEncryptionAllowed:function(){return this.isStorageContainerEncryptionAllowed()||this.isClusterLevelEncryptionAllowed()||this.encryptionStateObj.isSoftwareEncryptionOn&&this.encryptionStateObj.encryptionEnforcement},isSoftwareEnforcementAllowed:function(){return this.isStorageContainerEncryptionAllowed()&&!this.encryptionStateObj.hasDataBeenWritten},saveTempData:function(e,t,n){_.isFunction(t)&&t(),this.tempSaveModel.saveTempSaveState(r.SYSTEM_DATA_TYPE_TEMP_SAVE_ENCRYPTION,e,n)},runActionEvent:function(e,t){e===r.ENCRYPTION_ACTIONS.ENABLE_ENCRYPTION?this.enableEncryption(t):"enable-dual-encryption"===e&&this.enableEncryption(t)},enableEncryption:function(e){var t=this,n=function(){t.encryptionStateObj.encryptionEnforcement===c.ENCRYPTION_PROP.SE_SCOPE_CLUSTER?t.encryptionModel.setEncryptionIntent({software_encryption_scope:c.ENCRYPTION_PROP.SE_SCOPE_CLUSTER},{success:function(){t._enableEncryptionSuccess(t.i18n("enable_encryption_cluster_success"))},error:function(e,n){t.showHeaderError(e,n)}}):t.encryptionStateObj.encryptionEnforcement===c.ENCRYPTION_PROP.SE_SCOPE_STORAGE_CONTAINER?t.encryptionModel.setEncryptionIntent({software_encryption_scope:c.ENCRYPTION_PROP.SE_SCOPE_STORAGE_CONTAINER},{success:function(){t._enableEncryptionSuccess(t.i18n("enable_encryption_storage_container_success"))},error:function(e,n){t.showHeaderError(e,n)}}):t.showError(t.i18n("enable_encryption_error_no_type"))},i=_.isFunction(e)?e:n;this.enableSWEncryptionConfirm(i)},enableSWEncryptionConfirm:function(e){$.nutanixConfirm({msg:E(this.vtOptions()),yes:function(){"ENCRYPT"!==$("#nutanixConfirmModal input[type=text]").val().toUpperCase()?this.showHeaderError(this.i18n("enable_encryption_error")):e()},yesText:this.i18n("encrypt"),noText:this.i18n("cancel"),context:this})},_enableEncryptionSuccess:function(e){this.encryptionStateObj.isEncryptionOn=!0,this.encryptionStateObj.isSoftwareEncryptionOn=!0,this.selectSubView({subViewId:this.ENCRYPTION_SUBVIEWS.HOME}),this.showSuccess(e)}})}),define("views/popups/httpproxy/WhiteListDisplayInputView",["views/basecomponents/tableinput/TableInputView","data/DataProperties","utils/AppConstants","utils/SVG","managers/NotificationManager"],function(e,t,n,i,s){"use strict";var a=_.template('<h5 data-ntnx-title>Whitelist<a data-ntnx-title-link class="link-table-input whiteListCreateLink"><%= Components.icon("plus-small") %> <%= actionName %></a></h5><section data-ntnx-section><table class = "httpWhiteList table table-data-items table-input" ><thead><tr><% _.each(columns, function(column) { %><th><%= column.columnName %></th><% }); %><% if (isActionEnabled) { %><th>Actions</th><% } %></tr></thead><tbody></tbody></table></section>'),o='<% if (isActionEnabled) { %><td class="data-cell"><div class="action-links whiteListLink">'+i.SVGIcon("pencil","edit not-active")+'<a class="save active"><%= i18n("save") %></a><span class="middot"> &middot; </span>'+i.SVGIcon("x-round","delete not-active")+'<a class="cancel active"><%= i18n("cancel") %></a></div></td><% } %>',r=_.template('<tr data-id="<%= dataId %>" <%=isNew ? "new":""%> class="n-table-row"model-attribute="user-row" model-validate="isRowSaved"><% _.each(columns, function(column) { %><td class="data-cell"><input type="<%= column.type ? column.type : "text" %>" class="input-data <%= column.className ? column.className : "" %>" readonly <% if (modelAttribute) { %>model-attribute="<%= modelAttribute %>" <% } %>value="<%= isNew ? "" : column.renderer(data) %>" placeholder="<%= (placeholderText) ? placeholderText : column.columnName %>"></td><% }); %>'+o+"</tr>");return e.extend({whiteListEntries:[],model:null,initialize:function(t){e.prototype.initialize.apply(this,arguments),this.addExtraEvents({"focus  tr.form-control-error":"resetFromError"}),this.tmplTable=a,this.tmplWithDataRow=r,this.whiteListEntries=t.data,this.model=t.model},render:function(){return this.$el.html(this.tmplTable(this.vtOptions({
actionName:n.ACTION_CREATE,columns:this.columns,isActionEnabled:this.isActionEnabled,isNewActionEnabled:this.isNewActionEnabled}))),this.renderTable(),this},insertTableRow:function(e,t){e instanceof Backbone.Model&&(e=e.attributes),t=void 0!==t&&t;var n=t?this.ID_TO_BE_ADDED:e[this.idAttribute],i=this.getRowToBeAddedElement();t&&i.length||(this.$(".table-data-items tbody").append(this.tmplWithDataRow(this.vtOptions({isNew:t,dataId:n,data:e,columns:this.columns,isActionEnabled:this.isActionEnabled,modelAttribute:this.modelAttribute,placeholderText:this.placeholderText}))),this.removeNoDataRow())},onClickSaveLink:function(t){if($(t.currentTarget).closest("tr").attr("data-id")===n.ID_TO_BE_ADDED){if(!this.saveWhiteListEntry(t,n.ACTION_CREATE))return}else if(!this.saveWhiteListEntry(t,n.ACTION_UPDATE))return;this.model.set({whitelist:this.whiteListEntries});var i=this;this.model.save(null,{type:"PUT",error:function(){s.showNotification(n.NOTIFY_ERROR,i.model,n.ACTION_UPDATE)}}),e.prototype.onClickSaveLink.apply(this,arguments)},saveWhiteListEntry:function(e,i){var s=$(e.currentTarget),a=s.closest("tr").find("input").val().trim(),o="";if(o+=this.model.validteEntryNumber(this.whiteListEntries),o+=this.model.validateTarget(this.whiteListEntries,a))return s.closest("tr").find("input").val(o),s.closest("tr").find("input").attr("readonly",!0),s.closest("tr").addClass("form-control-error"),!1;if(i===n.ACTION_CREATE){var r=this.model.getTargetType(a),l={};l[t.WHITE_LIST.TARGET]=a,l[t.WHITE_LIST.TARGET_TYPE]=r,this.whiteListEntries.push(l)}else{var c,d=s.closest("tr").attr("data-id");for(c=0;c<this.whiteListEntries.length;c++)if(this.whiteListEntries[c][t.WHITE_LIST.TARGET]===d){this.whiteListEntries[c];break}this.whiteListEntries[c][t.WHITE_LIST.TARGET]=a}return!0},resetFromError:function(e){var t=$(e.currentTarget);t.removeClass("form-control-error"),t.find("input").val(""),this.onClickEditLink(e)},onClickDeleteLink:function(i){var a,o=$(i.currentTarget),r=o.closest("tr").attr("data-id");for(a=0;a<this.whiteListEntries.length;a++)if(this.whiteListEntries[a][t.WHITE_LIST.TARGET]===r){this.whiteListEntries[a];break}this.whiteListEntries.splice(a,1),this.model.set({whitelist:this.whiteListEntries});var l=this;this.model.save(null,{type:"PUT",error:function(){s.showNotification(n.NOTIFY_ERROR,l.model,n.ACTION_UPDATE)}}),e.prototype.onClickDeleteLink.apply(this,arguments)}})}),define("text!templates/popups/httpproxy/HttpProxyContentView.html",[],function(){return"\x3c!-- The parent div modal is #popupHttpProxy --\x3e\n<div data-ntnx-content-inner class=\"listContainer\">\n\n  <% if (canModify) { %>\n\n    <section data-ntnx-section=\"type-text\">\n      <%= i18n('popup_description') %>\n    </section>\n\n    <section data-ntnx-section>\n      <%= Components.button({\n        extraClasses        : 'btnCreate',\n        extraAttr           : [{\n          key: 'data-loading-text',\n          value: i18n('saving')\n        }, {\n          key: 'stream-action',\n          value: 'create'\n        }, {\n          key: 'stream-target',\n          value: 'proxy'\n        }],\n        text                : i18n('new_proxy'),\n        iconLeft            : 'plus'\n      }) %>\n    </section>\n\n  <% } %>\n\n  <section data-ntnx-section>\n    <table id=\"httpProxyList\" class=\"table table-hover\">\n      <thead>\n      <tr>\n        <th class='name-cell'><%= i18n('name') %></th>\n        <th><%= i18n('address') %></th>\n        <th><%= i18n('port') %></th>\n        <th>&nbsp;</th>\n      </tr>\n      </thead>\n      <tbody>\n      \x3c!-- @view: proxies go here... --\x3e\n      </tbody>\n    </table>\n  </section>\n\n</div>\n\n<div data-ntnx-content-inner class=\"formContainer\" style=\"display: none;\">\n  <div id=\"httpProxyForm\">\n    \x3c!-- @view: form goes here... --\x3e\n  </div>\n</div>\n"}),define("text!templates/popups/httpproxy/HttpProxyItemView.html",[],function(){return'<tr class="n-table-row" data-id="<%= model.name %>">\n  <td  class=\'name-cell\'>\n    <%= model.name %>\n  </td>\n  <td>\n    <%= model.address %>\n  </td>\n  <td>\n    <%= model.port %>\n  </td>\n\n  <td class="cell-actions">\n    <% if (canModify) { %>\n      <i dataId=\'<%= model.name %>\' class=\'btnEdit\'\n         data-icon="F" aria-hidden="true"></i>\n      <span class="action-separator">&middot;</span>\n      <i dataId=\'<%= model.name %>\' class=\'btnDelete\'\n         data-icon="v" aria-hidden="true" ></i>\n    <% } %>\n  </td>\n</tr>\n'}),define("text!templates/popups/httpproxy/HttpProxyFormView.html",[],function(){return'\x3c!-- The parent div modal is #popupHttpProxy --\x3e\n\x3c!-- Http Proxy Form --\x3e\n<form id="httpProxyForm" class="form-horizontal">\n\n  <section data-ntnx-section>\n    <label data-ntnx-label for="inputUsername"><%= i18n(\'name\') %></label>\n    <input type="text" class="inputName"\n      value="<%= model.name === null ? \'\' : model.name %>"\n      <%= model.name !== null ? \'disabled\' : \'\' %> >\n  </section>\n\n  <section data-ntnx-section>\n    <label data-ntnx-label for="inputAddress"><%= i18n(\'address\') %></label>\n    <input type="text" class="inputAddress" value="<%= model.address %>">\n  </section>\n\n  <section data-ntnx-section>\n    <label data-ntnx-label for="inputPort"><%= i18n(\'port\') %></label>\n    <input type="text" class="inputPort" value="<%= model.port %>">\n  </section>\n\n  <section data-ntnx-section>\n    <label data-ntnx-label for="inputUserName"><%= i18n(\'username\') %></label>\n    <input type="text" class="inputUserName"\n      value="<%= model.username ? model.username : \'\' %>">\n  </section>\n\n  <section data-ntnx-section>\n    <label data-ntnx-label for="inputPassword"><%= i18n(\'password\') %></label>\n    <input type="password" autocomplete="off" class="inputPassword"\n      value="<%= model.password ? model.password : \'\' %>">\n    <div data-ntnx-hint class="password-row-description">\n      <%= i18n(\'new_password_msg\') %>\n    </div>\n  </section>\n\n  <section data-ntnx-section>\n    <label data-ntnx-label for=""><%= i18n(\'protocols\') %></label>\n    <div data-ntnx-form-inline>\n      <input id="HTTP" type="checkbox" class="linkRowCheckbox">\n      <label for=\'HTTP\' data-ntnx-inline-label><%= i18n(\'http\') %></label>\n    </div>\n    <div data-ntnx-form-inline>\n      <input id="HTTPS" type="checkbox" class="linkRowCheckbox">\n      <label for=\'HTTPS\' data-ntnx-inline-label><%= i18n(\'https\') %></label>\n    </div>\n  </section>\n\n  <section data-ntnx-section class="whitelist" id="httpProxyWhiteList">\n  </section>\n\n</form>\n'}),define("models/popup/HttpProxyWhiteListModel",["models/BaseModel","data/DataURLConstants","data/DataProperties","utils/AppConstants","utils/AppUtil","views/notification/NotificationTemplates"],function(e,t,n,i,s,a){"use strict";return e.extend({entityType:i.ENTITY_HTTPPROXY_WHITELIST,urlRoot:t.HTTP_PROXIES_WHITELIST,name:"ProxyWhiteListModel",validteEntryNumber:function(e){var t="";return e.length>=1e3&&(t=this.i18n("maxEntryNumber")),t},getTargetType:function(e){return s.isValidIP(e)?i.WHITELIST_TARGET_TYPE.IPV4_ADDRESS:s.isValidIpv4NetMask(e)?i.WHITELIST_TARGET_TYPE.IPV4_NETWORK_MASK:s.validDomainNameSuffix(e)?i.WHITELIST_TARGET_TYPE.DOMAIN_NAME_SUFFIX:s.isValidHostname(e)?i.WHITELIST_TARGET_TYPE.HOST_NAME:void 0},validateTarget:function(e,t){var s="";void 0===this.getTargetType(t)&&(s=this.i18n("invalidTarget")),t.length>i.WHITELIST_ENTRY_MAX_CHAR&&(s+=this.i18n("whiteListEntryExceed"));for(var a=0;a<e.length;a++)if(e[a][n.WHITE_LIST.TARGET]===t){s+=this.i18n("sameWhiteListEntry");break}return s},getNotificationMessage:function(e,t){switch(t){case i.NOTIFY_SUCCESS:var n=i.ENTITY_NAMES[this.entityType]||"The entity",o=i.ACTION_UPDATE,r=s.endsWith(o,"e")?"d":"ed";return a.MSG_GENERIC_SUCCESS({entityName:n,actionName:o,endingChars:r});case i.NOTIFY_WARNING:case i.NOTIFY_ERROR:default:return a.MSG_GENERIC_ERROR}}})}),define("views/popups/httpproxy/HttpProxyPopupView",["backbone","views/basecomponents/popups/BasePopupView","views/popups/httpproxy/WhiteListDisplayInputView","models/BaseModel","models/BaseCollection","data/DataURLConstants","data/DataManager","data/DataProperties","utils/AppConstants","utils/AppUtil","text!templates/popups/httpproxy/HttpProxyContentView.html","text!templates/popups/httpproxy/HttpProxyItemView.html","text!templates/popups/httpproxy/HttpProxyFormView.html","models/popup/HttpProxyWhiteListModel"],function(e,t,n,i,s,a,o,r,l,c,d,p,u,h){"use strict";u=_.template(u),d=_.template(d);var m=i.extend({idAttribute:"name",name:"HttpProxyModel",urlRoot:a.HTTP_PROXIES,entityType:l.ENTITY_HTTPPROXY,defaults:{id:null,name:null,address:"",port:"",username:null,password:null,proxyTypes:[r.PROTOCOLS.HTTP]},sync:function(t,n,i){return i=this.parseOptions(t,n,i),"update"!==t&&"create"!==t||(i.url=o.getFormattedURL(n.urlRoot),n.unset("id")),c.log("BaseModel : \n\t method: "+t+"\n\t data  : "+i.url),e.sync(t,n,i)},validate:function(e){var t="";if(0!==$.trim(e.name).length&&0!==$.trim(e.address).length&&0!==$.trim(e.port).length||(t=this.i18n("validation_error_msg_1")),(isNaN(e.port)||parseFloat(e.port)<l.MIN_PORT_VALUE||parseFloat(e.port)>l.MAX_PORT_VALUE)&&(t+=this.i18ns("validation_error_msg_2",l.MIN_PORT_VALUE,l.MAX_PORT_VALUE)),e.proxyTypes.length<=0&&(t+=this.i18n("validation_error_msg_3")),$.trim(t).length>0)return t}}),f=s.extend({model:m,url:a.HTTP_PROXIES});return t.extend({el:"#popupHttpProxy",httpProxyModel:null,httpProxyWhiteListModel:null,rowTemplate:_.template(p),tableInputView:null,name:"HttpProxyPopupView",events:{"click  .btnCreate:not(.n-a-button-disable)":"onCreateItem","click  .btnDelete":"onDeleteItem","click  .btnEdit":"onEditItem","click  .btnBack":"onBack","click  .btnSave":"onBeforeSave","click  .btnClose":"hide","click .modal-header .close":"hide","keypress input":"onKeyPress","click input":"hideAlert"},render:function(){var e=this.canModifyByEntityType(l.ENTITY_HTTPPROXY),t=[{text:this.i18n("cancel"),extraClasses:"btnBack n-btn-form hide"}];e&&t.push({isPrimary:!0,text:this.i18n("save"),extraClasses:"btnSave n-btn-form hide",extraAttr:[{key:"data-loading-text",value:"Saving..."}]}),this.$el.html(this.defaultTemplate({title:this.i18n("http_proxies"),bodyContent:d(this.vtOptions({canModify:e})),footerButtons:this.defaultFooter(t)}))},show:function(e){t.prototype.show.apply(this,arguments),this.listHttpProxy(),e.actionTargetId&&this.editItem(e.actionTargetId,!1)},showForm:function(e,t){this.mode=e,this.triggerAction(l.MODAL.ACT.ALERT_HIDE),this.setTitle(this.i18ns("http_proxy_operation",this.i18n(e.toLowerCase()))),this.hideSubview(".listContainer"),this.showSubview(".formContainer","left"),this.$(".n-btn-form").hide(),this.$(".btnBack").show(),this.$(".btnSave").show(),this.mode===l.ACTION_UPDATE?this.$(".password-row-description").show():this.$(".password-row-description").hide(),this._selectOrUnselectCheckboxes(),this.applyNutanixInput({types:["checkbox"]}),this.triggerAction(l.MODAL.ACT.AS_REBUILD)},showList:function(){this.revertTitle(),this.triggerAction(l.MODAL.ACT.ALERT_HIDE),this.hideSubview(".formContainer"),this.showSubview(".listContainer"),this.$(".n-btn-form").hide(),this.$(".btnClose").show()},reset:function(){this.triggerAction(l.MODAL.ACT.ALERT_HIDE),this.showList(),this.undelegateEvents()},onCreateItem:function(){this.httpProxyModel=new m,this.$("#httpProxyForm").html(u(this.vtOptions({model:this.httpProxyModel.toJSON()}))),this.showForm(l.ACTION_CREATE,!0)},onEditItem:function(e){var t=$(e.currentTarget).attr("dataId");this.editItem(t,!0)},editItem:function(e,t){var n=this;this.httpProxyModel=new m,this.httpProxyModel.id=e,this.httpProxyModel.fetch({success:function(){n.$("#httpProxyForm").html(u(n.vtOptions({model:n.httpProxyModel.toJSON()}))),n.showForm(l.ACTION_UPDATE,t),n.renderWhiteListTable()},error:function(e,t){n.triggerAction(l.MODAL.ACT.ALERT_SHOW,{type:l.MODAL.ALERT.TYPE_ERROR,message:t.responseText})}})},renderWhiteListTable:function(){var e=this;this.$(".whitelist").hide(),this.httpProxyWhiteListModel=new h,this.httpProxyWhiteListModel.fetch({success:function(){var t=e.$(".whitelist").show();e.tableInputView=e.setTableInputView(),t.append(e.tableInputView.render().el),e.triggerAction(l.MODAL.ACT.AS_REBUILD)},error:function(t,n){e.triggerAction(l.MODAL.ACT.ALERT_SHOW,{type:l.MODAL.ALERT.TYPE_ERROR,message:n.responseText})}})},setTableInputView:function(){var e=this.httpProxyWhiteListModel.toJSON().whitelist,t=this.i18n("project.section_users_row_placeholder");return new n({idAttribute:r.WHITE_LIST.TARGET,entityType:l.ENTITY_HTTPPROXY_WHITELIST,placeholderText:t,columns:[{columnName:this.i18n("target"),renderer:function(e){return e.target}}],data:e,inputHandler:this.inputHandler,model:this.httpProxyWhiteListModel})},onDeleteItem:function(e){var t=this,n=$(e.currentTarget).attr("dataId");$.nutanixConfirm({msg:this.i18ns("delete_confirmation_msg",n),yes:function(){t.deleteHttpProxy(n)}})},onBack:function(){this.triggerAction(l.MODAL.ACT.ALERT_HIDE),this.listHttpProxy(),this.showList()},onEnterKeyPress:function(){this.onBeforeSave()},hideAlert:function(){this.triggerAction(l.MODAL.ACT.ALERT_HIDE)},onBeforeSave:function(){var e=this;if(this.httpProxyModel){var t=_.pluck(this.$(".linkRowCheckbox:checked"),"id"),n=void 0;this.httpProxyModel.on("error",function(t,n){e.triggerAction(l.MODAL.ACT.ALERT_SHOW,{type:l.MODAL.ALERT.TYPE_ERROR,message:n})}),n=_.map(t,function(e){return r.PROTOCOLS[e]});!1!==this.httpProxyModel.set({name:this.$el.find(".inputName").val(),address:this.$el.find(".inputAddress").val(),port:this.$el.find(".inputPort").val(),username:this.$el.find(".inputUserName").val().length?this.$el.find(".inputUserName").val():null,password:this.$el.find(".inputPassword").val().length?this.$el.find(".inputPassword").val():null,proxyTypes:n})&&this.saveHttpProxy()}},listHttpProxy:function(){var e=this;this.model=new f,this.model.fetch({success:function(){var t=e.model.models,n=e.$("#httpProxyList > tbody");if(n.html(""),t&&t.length)for(var i=0;i<t.length;i++){var s=e.rowTemplate({model:t[i].toJSON(),canModify:e.canModifyByEntityType(l.ENTITY_HTTPPROXY)});n.append(s)}else n.html("<tr><td colspan=4>"+e.i18n("proxy_not_configured")+"</tr></td>");t.length?e._toggleCreateButton(!1):e._toggleCreateButton(!0),e.triggerAction(l.MODAL.ACT.AS_REBUILD)},error:function(t,n){e.triggerAction(l.MODAL.ACT.ALERT_SHOW,{type:l.MODAL.ALERT.TYPE_ERROR,message:n.responseText})}})},deleteHttpProxy:function(e){var t=this;this.model&&this.model.models&&this.model.get(e)&&(this.httpProxyModel=this.model.get(e),this.httpProxyModel.destroy({success:function(e,n){t.listHttpProxy()},error:function(e,n){t.triggerAction(l.MODAL.ACT.ALERT_SHOW,{type:l.MODAL.ALERT.TYPE_ERROR,message:n.responseText})}}))},saveHttpProxy:function(){var e=this;this.httpProxyModel&&(this.mode===l.ACTION_CREATE&&(this.httpProxyModel.id=null),this.$(".btnSave").button("loading"),this.httpProxyModel.save(null,{success:function(t,n){e.listHttpProxy(),e.$(".btnSave").button("reset"),e.showList()},error:function(t,n){e.triggerAction(l.MODAL.ACT.ALERT_SHOW,{type:l.MODAL.ALERT.TYPE_ERROR,message:n.responseText}),e.$(".btnSave").button("reset")}}))},destroy:function(){this.httpProxyModel&&this.httpProxyModel.off(),t.prototype.destroy.apply(this,arguments)},_selectOrUnselectCheckboxes:function(){var e=this.httpProxyModel.get(r.PROXY_TYPES),t=_.contains(e,r.PROTOCOLS.HTTP);this.$("#HTTP").attr("checked",t);var n=_.contains(e,r.PROTOCOLS.HTTPS);this.$("#HTTPS").attr("checked",n)},_toggleCreateButton:function(e){var t=this.$el.find(".btnCreate");e?(t.removeClass("n-a-button-disable"),t.tooltip("destroy")):(t.addClass("n-a-button-disable"),t.tooltip({title:this.i18n("only_one_proxy_allowed"),placement:"right",trigger:"hover",html:!0}))}})}),define("text!templates/popups/servicecenter/ServiceCenterPopupView.html",[],function(){return'\x3c!-- The parent div modal is #popupServiceCenter --\x3e\n<div class="modal-header">\n  <button type="button" class="close" data-dismiss="modal">\n    <i data-icon="K" aria-hidden="true"></i>\n  </button>\n  <h4 class="n-title">Service Centers</h4>\n</div>\n\n<div class="n-modal-wrapper">\n  <div class="n-modal-body">\n    <div class="n-modal-content-wrapper">\n      <div class="n-modal-alert-header">\n        \x3c!-- @view: alert goes here... --\x3e\n      </div>\n      <div class="n-modal-content listContainer">\n        <% if (canModify) { %>\n          <div class="n-popup-description">\n            Configure one or more service centers that the Nutanix software can\n            connect to. Servers that have been configured are displayed below.\n          </div>\n          <div>\n            <button class="btnCreate btn btn-small"\n                    data-loading-text="Saving...">\n              <i data-icon="H" aria-hidden="true"></i> New Center\n            </button>\n          </div>\n        <% } %>\n        <table id="serviceCenterList" class="table table-hover">\n          <thead>\n          <tr>\n            <th>Name</th>\n            <th>Address</th>\n            <th>Port</th>\n            <th>Username</th>\n            <th>&nbsp;</th>\n          </tr>\n          </thead>\n          <tbody>\n          \x3c!-- @view: proxies go here... --\x3e\n          </tbody>\n        </table>\n      </div>\n\n      <div class="n-modal-content formContainer"  style="display: none;">\n        <div id="serviceCenterForm">\n          \x3c!-- @view: form goes here... --\x3e\n        </div>\n      </div>\n    </div>\n  </div>\n\n  <div class="n-modal-footer">\n    \x3c!-- In form mode, we call it cancel, in list mode, its called close--\x3e\n    <button class="btnBack btn">\n      Cancel\n    </button>\n    <button class="btnClose btn btn-primary">\n      Close\n    </button>\n    <% if (canModify) { %>\n      <button class="btnSave btn btn-primary n-btn-form"\n              style="display:none;"\n              data-loading-text="Saving...">\n        Save\n      </button>\n    <% } %>\n  </div>\n</div>'}),define("text!templates/popups/servicecenter/ServiceCenterItemView.html",[],function(){return'<tr class="n-table-row">\n  <td>\n    <%= model.name %>\n  </td>\n  <td>\n    <%= model.ipAddress %>\n  </td>\n  <td>\n    <%= model.port %>\n  </td>\n  <td>\n    <%= model.username %>\n  </td>\n\n  <td class="cell-actions">\n    <% if (canModify) { %>\n      <i dataId=\'<%= model.name %>\' class=\'btnEdit\'\n         data-icon="F" aria-hidden="true"></i>\n      <span class="action-separator">&middot;</span>\n      <i dataId=\'<%= model.name %>\' class=\'btnDelete\'\n         data-icon="v" aria-hidden="true" ></i>\n    <% } %>\n  </td>\n</tr>'}),define("text!templates/popups/servicecenter/ServiceCenterFormView.html",[],function(){return'\x3c!-- Service Center Form --\x3e\n<form id="serviceCenterForm" class="form-horizontal">\n  <div class="control-group">\n    <label class="control-label" for="inputUsername">Name</label>\n    <div class="controls">\n      <input type="text" class="inputName"\n        value="<%= model.name === null ? \'\' : model.name %>"\n        <%= model.name !== null ? \'disabled\' : \'\' %> >\n    </div>\n  </div>\n  <div class="control-group">\n    <label class="control-label" for="inputIpAddress">IP Address</label>\n    <div class="controls">\n      <input type="text" class="inputIpAddress" value="<%= model.ipAddress %>"\n        placeholder="   .   .   .">\n    </div>\n  </div>\n  <div class="control-group">\n    <label class="control-label" for="inputPort">Port</label>\n    <div class="controls">\n      <input type="text" class="inputPort" value="<%= model.port %>">\n    </div>\n  </div>\n  <div class="control-group">\n    <label class="control-label" for="inputUserName">Username</label>\n    <div class="controls">\n      <input type="text" class="inputUserName" value="<%= model.username %>">\n      <div class="n-input-validation-msg"></div>\n    </div>\n  </div>\n</form>'}),define("views/popups/servicecenter/ServiceCenterPopupView",["backbone","views/basecomponents/popups/BasePopupView","models/BaseModel","models/BaseCollection","data/DataURLConstants","data/DataManager","utils/AppConstants","utils/AppUtil","text!templates/popups/servicecenter/ServiceCenterPopupView.html","text!templates/popups/servicecenter/ServiceCenterItemView.html","text!templates/popups/servicecenter/ServiceCenterFormView.html"],function(e,t,n,i,s,a,o,r,l,c,d){"use strict";var p=n.extend({idAttribute:"name",urlRoot:s.SERVICE_CENTERS,entityType:o.ENTITY_SERVICE_CENTER,defaults:{id:null,name:null,ipAddress:"",port:"",username:""},sync:function(t,n,i){return i=this.parseOptions(t,n,i),"update"!==t&&"create"!==t||(i.url=a.getFormattedURL(n.urlRoot),n.unset("id")),r.log("BaseModel : \n\t method: "+t+"\n\t data  : "+i.url),e.sync(t,n,i)},validate:function(e){var t="";if(0!==$.trim(e.name).length&&0!==$.trim(e.ipAddress).length&&0!==$.trim(e.port).length&&0!==$.trim(e.username).length||(t="Name, IP Address, Port and username are required."),(isNaN(e.port)||parseFloat(e.port)<o.MIN_PORT_VALUE||parseFloat(e.port)>o.MAX_PORT_VALUE)&&(t+="Port should be a number ranging from "+o.MIN_PORT_VALUE+" to "+o.MAX_PORT_VALUE+"."),$.trim(t).length>0)return t}}),u=i.extend({model:p,url:s.SERVICE_CENTERS});return t.extend({el:"#popupServiceCenter",serviceCenterModel:null,template:_.template(l),rowTemplate:_.template(c),events:{"click  .btnCreate":"onCreateItem","click  .btnDelete":"onDeleteItem","click  .btnEdit":"onEditItem","click  .btnBack":"onBack","click  .btnSave":"onBeforeSave","click  .btnClose":"hide","click  .modal-header .close":"hide","keyup .inputUserName":"onInputNameKeyUp","keypress input":"onKeyPress","click input":"clearHeader"},initialize:function(){this.render()},render:function(){this.$el.html(this.template({canModify:this.canModifyByEntityType(o.ENTITY_SERVICE_CENTER)}))},show:function(e){t.prototype.show.apply(this,arguments),this.$(".btnBack").hide(),this.$(".btnSave").hide(),this.$(".btnClose").show(),this.listServiceCenter(),e.actionTargetId&&this.editItem(e.actionTargetId,!1)},showForm:function(e,t){this.mode=e,this.clearHeader(),this.$el.find(".n-title").text(o.ACTION_NAMES[e]+" Service Centers"),this.hideSubview(".listContainer"),this.showSubview(".formContainer","left"),this.$(".btnBack").show(),this.$(".btnSave").show(),this.$(".btnClose").hide()},showList:function(){this.$el.find(".n-title").text("Service center"),this.hideSubview(".formContainer"),this.showSubview(".listContainer"),this.$(".btnBack").hide(),this.$(".btnSave").hide(),this.$(".btnClose").show()},reset:function(){this.clearHeader(),this.showList(),this.undelegateEvents()},onCreateItem:function(){this.serviceCenterModel=new p,$("#serviceCenterForm").html(_.template(d,{model:this.serviceCenterModel.toJSON()})),this.showForm(o.ACTION_CREATE,!0)},onEditItem:function(e){var t=$(e.currentTarget).attr("dataId");this.editItem(t,!0)},editItem:function(e,t){this.serviceCenterModel=new p,this.serviceCenterModel.id=e;var n=this;this.serviceCenterModel.fetch({success:function(){n.serviceCenterModel;$("#serviceCenterForm").html(_.template(d,{model:n.serviceCenterModel.toJSON()})),n.showForm(o.ACTION_UPDATE,t)},error:function(e,t){n.showHeaderError(t.responseText)}})},onDeleteItem:function(e){var t=this,n=$(e.currentTarget).attr("dataId");$.nutanixConfirm({msg:"Are you sure you want to delete, "+n+"?",yes:function(){t.deleteServiceCenter(n)}})},onBack:function(){this.clearHeader(),this.listServiceCenter(),this.showList()},onEnterKeyPress:function(){this.onBeforeSave()},onInputNameKeyUp:function(e){r.validNameCharactersEventHandler(e,this.$(".n-input-validation-msg"))},onBeforeSave:function(){if(this.serviceCenterModel){var e=this;this.serviceCenterModel.on("error",function(t,n){e.showHeaderError(n)});!1!==this.serviceCenterModel.set({name:this.$el.find(".inputName").val(),ipAddress:this.$el.find(".inputIpAddress").val(),port:this.$el.find(".inputPort").val(),username:this.$el.find(".inputUserName").val()})&&this.saveServiceCenter()}},listServiceCenter:function(){var e=this;this.model=new u,this.model.fetch({success:function(){var t=e.model.models,n=e.$("#serviceCenterList > tbody");if(n.html(""),t&&t.length)for(var i=0;i<t.length;i++){var s=e.rowTemplate({model:t[i].toJSON(),canModify:e.canModifyByEntityType(o.ENTITY_SERVICE_CENTER)});n.append(s)}else n.html("<tr><td colspan=5>Service centers have not been configured.</tr></td>")},error:function(t,n){e.showHeaderError(n.responseText)}})},deleteServiceCenter:function(e){if(this.model&&this.model.models&&this.model.get(e)){this.serviceCenterModel=this.model.get(e);var t=this;this.serviceCenterModel.destroy({success:function(e,n){t.listServiceCenter()},error:function(e,n){t.showHeaderError(n.responseText)}})}},saveServiceCenter:function(){if(this.serviceCenterModel){this.mode===o.ACTION_CREATE&&(this.serviceCenterModel.id=null),this.$(".btnSave").button("loading");var e=this;this.serviceCenterModel.save(null,{success:function(t,n){e.listServiceCenter(),e.$(".btnSave").button("reset"),e.showList()},error:function(t,n){e.showHeaderError(n.responseText),e.$(".btnSave").button("reset")}})}},destroy:function(){this.serviceCenterModel&&this.serviceCenterModel.off(),t.prototype.destroy.apply(this,arguments)}})}),define("models/managementserver/ManagementServerRegisterModel",["models/BaseModel","data/DataURLConstants","utils/AppConstants"],function(e,t,n){"use strict";var i={USERNAME:"adminUsername",PASSWORD:"adminPassword",ADDRESS:"ipAddress",PORT:"port"};return e.extend({url:t.REGISTER_MANAGEMENT_SERVER,defaults:{adminUsername:"",adminPassword:"",ipAddress:"",port:null},name:"ManagementServerRegisterModel",entityType:n.ENTITY_MANAGEMENT_SERVER,initialize:function(){this.initializeBaseModel()},getURL:function(){switch(this.actionMode){case n.ACTION_UNREGISTER:return t.UNREGISTER_MANAGEMENT_SERVER;case n.ACTION_REGISTER:default:return t.REGISTER_MANAGEMENT_SERVER}}},{DP:i})}),define("text!templates/popups/managementserver/ManagementServerRegisterPopupView.html",[],function(){return'\x3c!-- The parent div modal is #popupRegisterMgmtServer --\x3e\n<div class="modal-header">\n  <button type="button" class="close xClose" data-dismiss="modal">\n    <i data-icon="v" aria-hidden="true"></i>\n  </button>\n  <h4 class="n-title"><%= mgmtServerName %> Registration</h4>\n</div>\n<div class="n-modal-wrapper">\n  <div class="n-modal-body">\n    <div class="n-modal-content-wrapper">\n      <div class="n-modal-alert-header">\n        \x3c!-- @view: update message goes here --\x3e\n      </div>\n      <div id="main-ctr">\n        <div class="n-loading"></div>\n        <span>Loading...</span>\n      </div>\n    </div>\n  </div>\n  <div class="n-modal-footer">\n    <button class="btn btn-close btnClose hide">\n      Close\n    </button>\n    <% if (canModify) { %>\n    <button class="btn btn-save btnSave btn-primary n-btn-list"\n            stream-target="management_server"\n            stream-action="register"\n            data-loading-text="Saving...">\n    </button>\n    <% } %>\n  </div>\n</div>\n'}),define("text!templates/popups/managementserver/SingleServerRegisterFormView.html",[],function(){return'<div>\n  <div class="n-popup-description">\n    <% if (canModify) { %>\n      <%= isRegistered ? \'Unregister\' : \'Register\' %> this cluster\n      <%= isRegistered ? \'from\' : \'to\' %>\n      the <%= mgmtServerName %> server.\n    <% } %>\n  </div>\n  <div class="n-popup-registered n-popup-status" style="display:none">\n    <i aria-hidden="true" data-icon="J"></i>\n    This cluster is currently registered.\n  </div>\n  <div class="n-popup-unregistered n-popup-status" style="display:none">\n    This cluster is currently not registered.\n  </div>\n  <% var sDisabled = canModify ? \'\' : \'disabled\' ; %>\n  \x3c!-- vCenter registration form --\x3e\n  <form id="multiclusterRegisterPopupForm" class="auth-form">\n    <div class="control-group address">\n      <label class="control-label">Address</label>\n      <div class="controls">\n        <input type="text"\n               class="input-address"\n               value="<%= address %>"\n               readonly\n               <%= sDisabled %> >\n      </div>\n    </div>\n    <div class="control-group port">\n      <label class="control-label">Port</label>\n      <div class="controls">\n        <input type="text"\n               class="input-port"\n               value="<%= port %>"\n               model-validate="required"\n               model-attribute="Port"\n               <%= sDisabled %> >\n      </div>\n    </div>\n    <div class="control-group">\n      <label class="control-label">Admin Username</label>\n      <div class="controls">\n        <input type="text"\n               class="input-username"\n               model-validate="required"\n               model-attribute="User name"\n               <%= sDisabled %> >\n      </div>\n    </div>\n    <div class="control-group">\n      <label class="control-label">Admin Password</label>\n      <div class="controls">\n        <input type="password" autocomplete="off"\n               model-validate="required"\n               model-attribute="Password"\n               class="input-password"  <%= sDisabled %> >\n      </div>\n    </div>\n  </form>\n</div>'}),define("text!templates/popups/managementserver/MulticlusterRegisterFormView.html",[],function(){
return'<div>\n  \x3c!-- List of discovered management servers --\x3e\n  <% if (!serverList.length) { %>\n    <%= i18ns(\'noServers\', mgmtServerName) %>\n  <% } %>\n  <div class="mgmt-list-form">\n    <% if (serverList.length) { %>\n      <div class="title">\n        <%= i18ns(\'serverListHeading\', mgmtServerName) %>\n      </div>\n      <table class="table table-hover">\n        <thead>\n        <tr>\n          <th class="host">\n            <%= i18n(\'ipAddress\') %>\n          </th>\n          <th class="conn">\n            <%= i18n(\'hostConn\') %>\n          </th>\n          <% if (!disableActions) { %>\n          <th class="actions">\n            <%= i18n(\'actions\') %>\n          </th>\n          <% } %>\n        </tr>\n        </thead>\n        <tbody>\n          <% _.each(serverList, function (server) { %>\n            <tr class="<%= server[DP.IN_USE] ? \'\' : \'no-conn\' %>">\n              <td>\n                <div class="server-address"><%= server.address %></div>\n                <% if (server[DP.TOOLTIP]) { %>\n                  <span class="n-tooltip-circle"\n                        title="<%= server[DP.TOOLTIP] %>">\n                    ?\n                  </span>\n                <% } %>\n              </td>\n              <td>\n                <div class="conn-status">\n                  <%= server[DP.IN_USE] ?\n                    i18n(\'connected\') :\n                    i18n(\'notConnected\') %>\n                </div>\n              </td>\n              <% if (!disableActions) { %>\n              <td>\n                <% if (server.showRegisterOption) { %>\n                  <a class="action-edit"\n                     action="register"\n                     actionTargetId="<%= server[DP.ADDRESS] %>"\n                     data-test-ip="<%= server[DP.ADDRESS] %>">\n                    <%= i18n(\'register\') %>\n                  </a>\n                <% }\n                    if (server.showRegisterOption &&\n                        server.showUnregisterOption) { %>\n                  <span class="action-separator"></span>\n                <% }\n                   if (server.showUnregisterOption) { %>\n                  <a class="action-edit"\n                     action="unregister"\n                     actionTargetId="<%= server[DP.ADDRESS] %>"\n                     data-test-ip="<%= server[DP.ADDRESS] %>">\n                    <%= i18n(\'unregister\') %>\n                  </a>\n                <% } %>\n              </td>\n              <% } %>\n            </tr>\n          <% }) %>\n        </tbody>\n      </table>\n    <% } %>\n  </div>\n  <div class="mgmt-server-form" style="display: none">\n  </div>\n</div>'}),define("text!templates/popups/managementserver/MultiRegisterFormView.html",[],function(){return'<div>\n  <% if (multiClusterMode) { %>\n  <div>\n    <div>\n      <%= i18ns(\'clusterListHeading\',\n        i18n(action === REGISTER_ACTION ? \'enabled\' : \'disabled\')) %>\n    </div>\n    <div class="cluster-list-ctr">\n      <table id="reg-list"\n             class="table table-hover"\n             data-test="cluster-table">\n        <thead>\n        <tr>\n          <th>\n            <%= Components.checkbox({\n            jsClasses: \'select-all\',\n            checked: false\n            }) %>\n            <label class="select-cb"><%= i18n(\'clusterName\') %></label>\n          </th>\n          <th>\n            <%= i18n(\'hostConn\') %>\n          </th>\n        </tr>\n        </thead>\n        <tbody>\n        <% _.each(clusterList, function (clusterInfo) { %>\n        <tr>\n          <td>\n            <%= Components.checkbox({\n            jsClasses: \'select-cluster\',\n            disabled: !clusterInfo[DP.IS_CONFIGURABLE],\n            attributes: \'actionTargetId="\' + clusterInfo[DP.CLUSTER_UUID] + \'"\',\n            checked: false\n            }) %>\n            <label class="select-cb">\n              <%= clusterInfo[DP.CLUSTER_NAME] %>\n            </label>\n            <% if (!clusterInfo[DP.IS_CONFIGURABLE]) { %>\n                    <span class="n-tooltip-circle"\n                          title="Cannot configure this cluster\n                          since it is connected to more than one\n                          <%= mgmtServerName %> instances">\n                      ?\n                    </span>\n            <% } %>\n          </td>\n          <td>\n            <%= clusterInfo[DP.IN_USE] ?\n              i18n(\'connected\') : i18n(\'notConnected\') %>\n          </td>\n        </tr>\n        <% }) %>\n        </tbody>\n      </table>\n    </div>\n  </div>\n  <% } %>\n  <form class="auth-form">\n    <div class="control-group address">\n      <div class="controls">\n        <label><%= i18n(\'ipAddress\') %></label>\n        <input type="text"\n               class="input-address"\n               value="<%= serverInfo[DP.ADDRESS] %>"\n               readonly>\n      </div>\n    </div>\n    <div class="control-group port">\n      <div class="controls">\n        <label><%= i18n(\'port\') %></label>\n        <input type="text"\n               class="input-port"\n               value="<%= serverInfo[DP.PORT] %>"\n               model-attribute="Port"\n               model-validate="required">\n      </div>\n    </div>\n    <div class="control-group">\n      <div class="controls">\n        <label><%= i18n(\'username\') %></label>\n        <input type="text" class="input-username"\n               model-attribute="User name"\n               model-validate="required">\n      </div>\n    </div>\n    <div class="control-group">\n      <div class="controls">\n        <label><%= i18n(\'password\') %></label>\n        <input type="password" class="input-password"\n               model-attribute="Password"\n               model-validate="required">\n      </div>\n    </div>\n  </form>\n</div>'}),define("views/popups/managementserver/RegisterManagementServerPopupView",["components/Components","views/basecomponents/popups/BasePopupView","models/query/BaseQueryModel","models/managementserver/ManagementServerRegisterModel","utils/AppConstants","utils/AppUtil","utils/EntityUtil","utils/ValidationUtil","data/DataProperties","managers/ClusterManager","managers/TaskManager","managers/ActionManager","text!templates/popups/managementserver/ManagementServerRegisterPopupView.html","text!templates/popups/managementserver/SingleServerRegisterFormView.html","text!templates/popups/managementserver/MulticlusterRegisterFormView.html","text!templates/popups/managementserver/MultiRegisterFormView.html"],function(e,t,n,i,s,a,o,r,l,c,d,p,u,h,m,f){"use strict";u=_.template(u),h=_.template(h),m=_.template(m),f=_.template(f);var v={EXTENSION_KEY:"extension_key",MANAGEMENT_SERVER_TYPE:"management_server_type",ADDRESS:"address",CLUSTER_UUID:"cluster_uuid",PORT:"port",IN_USE:"in_use",CLUSTER_LIST:"clusterList",IS_REGISTERED:"isRegistered",CLUSTER_NAME:"clusterName",TOOLTIP:"tooltip",IS_CONFIGURABLE:"isConfigurable"},g={};g[s.MANAGEMENT_SERVER_NAME.VCENTER]="vcenter";var E=n.extend({name:"get_management_servers",initialize:function(){this.set(this.DP.ENTITY_TYPE,s.ENTITY_MANAGEMENT_SERVER_INFO),this.setGroupMemberAttributesList([v.EXTENSION_KEY,v.MANAGEMENT_SERVER_TYPE,v.ADDRESS,v.CLUSTER_UUID,v.PORT,v.IN_USE]),n.prototype.initialize.apply(this,arguments)}});return t.extend({el:"#popupRegisterMgmtServer",name:"RegisterManagementServerPopupView",isMulticlusterMode:!1,queryModel:null,managementServerMap:{},dataLoaded:!1,managementServerType:null,queryResultAttributes:null,taskListenerActive:!1,taskInProgress:!1,updateTaskCallback:null,events:{"click  .btn-close":"hide","click  .modal-header .close":"hide","click  .action-edit":"onEditItem","click  .btn-cancel":"onCancelClick","click  .btn-save":"onSaveClick","click  .select-all":"onSelectAll","change .select-cluster":"onToggleClusterSelect","keypress input":"onKeyPress","change input":"onKeyPress"},initialize:function(){this.isMulticlusterMode=c.isMulticlusterUI(),this.queryModel=new E,t.prototype.initialize.apply(this,arguments)},render:function(){if(this.dataLoaded)this.renderServerList();else{this.$el.html(u({mgmtServerName:this.actionRoute[s.NAV_ACTION_TARGET_ID],canModify:!0})),a.addInLineDonutLoader(this.$(".n-loading"));var e={};e[v.MANAGEMENT_SERVER_TYPE]=[{op:s.FILTER_OPERATORS.EQUALS,value1:this.managementServerType}],this.queryModel.set(this.queryModel.DP.FILTER_EXPR,e),this.queryModel.save(null).done(function(){this.dataLoaded=!0,this.processQueryData(),this.render()}.bind(this)).fail(function(e,t){this.showHeaderError(a.processAjaxError(t))}.bind(this))}this.$(".btn-save").hide()},destroy:function(){this.$(".n-tooltip-circle").tooltip("destroy"),d.unregisterHandlerForChangedTasks(this.updateTaskCallback),t.prototype.destroy.apply(this,arguments)},show:function(e){this.actionRoute=e,this.managementServerType=g[e[s.NAV_ACTION_TARGET_ID]],t.prototype.show.apply(this,arguments)},hide:function(){t.prototype.hide.apply(this,arguments),this.actionRoute.fsPrecheckFlow&&p.executeAction({action:s.ACTION_CREATE,actionTarget:s.ENTITY_FILE_SERVER})},processQueryData:function(){this.managementServerMap={},this.queryResultAttributes=this.queryModel.getQueryResultAttributes();var e=_.pluck(this.queryResultAttributes,v.CLUSTER_UUID);_.each(this.queryResultAttributes,function(t){var n=t[v.ADDRESS],i=this.managementServerMap[n]||{};i[v.ADDRESS]=t[v.ADDRESS],i[v.PORT]=i[v.PORT]||t[v.PORT],i[v.IN_USE]="false"!==t[v.IN_USE],i[v.CLUSTER_LIST]=i[v.CLUSTER_LIST]||[];var a={},o=t[v.CLUSTER_UUID],r=c.getClusterModelByClusterUuid(o);if(r){a[v.IN_USE]="false"!==t[v.IN_USE],a[v.CLUSTER_UUID]=o,a[v.CLUSTER_NAME]=r?r.get(l.NAME)||s.UNKNOWN_VALUE:s.UNKNOWN_VALUE,a[v.IS_REGISTERED]=!!t[v.EXTENSION_KEY],a[v.IS_CONFIGURABLE]=_.indexOf(e,o)===_.lastIndexOf(e,o),i[v.CLUSTER_LIST].push(a);_.pluck(i[v.CLUSTER_LIST],v.CLUSTER_NAME).join(", ");!a[v.IS_REGISTERED]&&this.isMulticlusterMode&&(i[v.TOOLTIP]=this.i18ns("registerHelp",this.actionRoute[s.NAV_ACTION_TARGET_ID]))}this.managementServerMap[n]=i},this)},renderServerList:function(){var e=[],t=0,n=0;_.each(this.managementServerMap,function(i){var s=i[v.CLUSTER_LIST];i.showRegisterOption=!1,i.showUnregisterOption=!1,_.each(s,function(e){e[v.IS_REGISTERED]?i.showUnregisterOption=!0:i.showRegisterOption=!0,e[v.IN_USE]?t++:n++}),e.push(i)});var i=!1;if(!this.isMulticlusterMode&&e.length>1)if(1===t&&1===n){var a=_.find(e,function(e){var t=e[v.CLUSTER_LIST],n=t[0];return n&&n[v.IN_USE]&&!n[v.IS_REGISTERED]}),o=_.find(e,function(e){var t=e[v.CLUSTER_LIST],n=t[0];return n&&!n[v.IN_USE]&&n[v.IS_REGISTERED]});o&&a&&(this.showHeaderInfo(this.i18ns("multiMgmtServerInfo",this.actionRoute[s.NAV_ACTION_TARGET_ID])),a[v.TOOLTIP]=this.i18ns("multiMgmtServerHelp",this.actionRoute[s.NAV_ACTION_TARGET_ID]))}else t>1&&(this.showHeaderError(this.i18ns("multiMgmtServerErr",this.actionRoute[s.NAV_ACTION_TARGET_ID])),i=!0);this.$("#main-ctr").html(m(this.vtOptions({multiClusterMode:this.isMulticlusterMode,mgmtServerName:this.actionRoute[s.NAV_ACTION_TARGET_ID],canModify:!0,serverList:e,disableActions:i,DP:v}))),this.$(".n-tooltip-circle").tooltip("destroy").tooltip({trigger:"hover",container:"body"}),this.$(".btn-save").hide(),this.taskListenerActive||(this.updateTaskCallback=this.onTaskChange.bind(this),d.registerHandlerForChangedTasks(this.updateTaskCallback),this.taskListenerActive=!0)},onTaskChange:function(){var e=d.getGlobalTasks(),t=e.find(function(e){var t=e.get(l.TASK_SUB_TASK_OPERATION);return(e.isStatusQueued()||e.isStatusActive())&&(t===s.TASK_OPERATION_MGMT_SERVER_REGISTER||t===s.TASK_OPERATION_MGMT_SERVER_UNREGISTER)},this);t||this.clearHeader(),!this.taskInProgress&&t?this.showHeaderInfo(this.i18n("taskInProgress")):this.taskInProgress&&!t&&(this.dataLoaded=!1,this.render()),this.taskInProgress=t},showButtonsOnMulticlusterForm:function(){this.$('.btn-save[action="unregister"]').hide(),this.$('.btn-save[action="register"]').hide(),this.$(".btn-close").show(),this.$(".btn-cancel").hide()},enableSaveButton:function(){this.$(".btn-save").prop("disabled",!1)},onToggleClusterSelect:function(){this.$(".btn-save").prop("disabled",0===this.$(".select-cluster:checked").length)},onKeyPress:function(e){this.isMulticlusterMode?this.onToggleClusterSelect():this.enableSaveButton(),t.prototype.onKeyPress.apply(this,arguments)},_save:function(e,t,n,s,o){var r=new i;r.actionMode=e,r.set(i.DP.USERNAME,t),r.set(i.DP.PASSWORD,n),r.set(i.DP.ADDRESS,s),r.set(i.DP.PORT,o),r.save().done(function(){this.dataLoaded=!1,this.render()}.bind(this)).fail(function(e){this.showHeaderError(a.processAjaxError(e.responseText))}.bind(this))},_performFanout:function(e,t){var n=o.createFanoutCollection(s.ENTITY_MANAGEMENT_SERVER,e,t);t.length&&n.performFanout().done(function(){this.dataLoaded=!1,this.render(),d.fetchOnDemand({force:!0}),this.showHeaderInfo(this.i18n("taskInProgress"))}.bind(this)).fail(function(e){this.showHeaderError(a.processAjaxError(e.responseText))}.bind(this))},onEditItem:function(e){var t=$(e.currentTarget),n=t.attr(s.NAV_ACTION),i=t.attr(s.NAV_ACTION_TARGET_ID);this.showEditForm(n,i)},onEnterKeyPress:function(e){var t=this.$(".btn-save:enabled").attr(s.NAV_ACTION);this.onSaveClick(null,t)},onSaveClick:function(e,t){var n=t;e&&(n=$(e.currentTarget).attr(s.NAV_ACTION));var a=this.$(".input-address").val(),o=this.$(".input-port").val(),c=this.$(".input-username").val(),d=this.$(".input-password").val(),p=this.$(".auth-form"),u=r.validateFormValues(p);if(u.length){var h=r.defaultErrorHandler(p,u);return void this.showHeaderError(h)}if(this.isMulticlusterMode){var m=[];this.$(".select-cluster").each(function(){var e=$(this);if(e.is(":checked")){var t=e.attr(s.NAV_ACTION_TARGET_ID),n=new i;n.set(i.DP.USERNAME,c),n.set(i.DP.PASSWORD,d),n.set(i.DP.ADDRESS,a),n.set(i.DP.PORT,o),n[l.CLUSTER_UUID]=t,m.push(n)}}),this.$(".btn-save").prop("disabled",!0),this._performFanout(n,m)}else this._save(n,c,d,a,o)},onCancelClick:function(){this.$(".mgmt-server-form").is(":visible")?(this.clearHeader(),this.hideSubview(".mgmt-server-form"),this.showSubview(".mgmt-list-form","left"),this.showButtonsOnMulticlusterForm()):this.hide()},onSelectAll:function(e){this.$(".select-cluster").prop("checked",$(e.currentTarget).is(":checked")),this.enableSaveButton()},showEditForm:function(t,n){var i=_.find(this.managementServerMap,function(e,t){return t===n},this),a=_.filter(i[v.CLUSTER_LIST],function(e){return t===s.ACTION_REGISTER?!e[v.IS_REGISTERED]:e[v.IS_REGISTERED]});this.$(".mgmt-server-form").html(f(this.vtOptions({action:t,REGISTER_ACTION:s.ACTION_REGISTER,multiClusterMode:this.isMulticlusterMode,serverInfo:i,clusterList:a,DP:v,Components:e,mgmtServerName:this.actionRoute[s.NAV_ACTION_TARGET_ID]}))),this.hideSubview(".mgmt-list-form"),this.showSubview(".mgmt-server-form"),this.clearHeader(),this.$(".n-tooltip-circle").tooltip("destroy").tooltip({trigger:"hover",container:"body"}),this.$(".btn-save").show().prop("disabled",!0).text(s.ACTION_NAMES[t]).attr(s.NAV_ACTION,t),this.$(".btn-close").hide(),this.$(".btn-cancel").show()}})}),define("text!templates/popups/nameserver/NameServerContentView.html",[],function(){return'\x3c!-- The parent div modal is #popupNameServer --\x3e\n<div data-ntnx-content-inner>\n  <section data-ntnx-section="type-text">\n    <% if (canModify) { %>\n      <%= i18n(\'ipAddressConfigurationInfo\') %>\n    <% } %>\n  </section>\n  \x3c!-- Form to add name servers --\x3e\n  <% if (canModify) { %>\n  <section data-ntnx-section>\n    <label data-ntnx-label for="input-name-server"><%= i18n(\'serverIP\') %></label>\n    <section data-ntnx-section="type-form-elements-inline">\n      <input type="text" class="inputNameServer">\n      <%= Components.button({\n        extraClasses        : \'btnCreate formControl\',\n        text                : \'Add\',\n        iconLeft            : \'plus\'\n      }) %>\n    </section>\n  </section>\n  <% } %>\n\n  <section data-ntnx-section>\n    <table id="nameServerList" class="table table-hover">\n      <thead>\n        <tr>\n          <th><%= i18n(\'ipAddress\') %></th>\n          <th>&nbsp;</th>\n        </tr>\n      </thead>\n      <tbody>\n      \x3c!-- @view: List goes here... --\x3e\n      </tbody>\n    </table>\n  </section>\n</div>\n'}),define("views/popups/nameserver/NameServerPopupView",["views/basecomponents/popups/BasePopupView","models/BaseModel","data/DataURLConstants","utils/AppConstants","utils/AppUtil","utils/CommonTemplates","text!templates/popups/nameserver/NameServerContentView.html"],function(e,t,n,i,s,a,o){"use strict";var r=t.extend({name:"NameServerModel",DP:{NAME_SERVERS:"nameServers"},urlRoot:n.NAME_SERVERS,entityType:i.ENTITY_NAME_SERVER,defaults:{nameServers:[]},getURL:function(e,t){if("update"===e||"create"===e){if(this.actionMode===i.ACTION_DELETE)return n.REMOVE_NAME_SERVERS;if(this.actionMode===i.ACTION_CREATE)return n.ADD_NAME_SERVERS}return n.NAME_SERVERS},validate:function(e,t){if(void 0!==e.nameServers&&_.isArray(e.nameServers)&&!_.isEmpty(e.nameServers)){var n=null;if(_.each(e.nameServers,function(e){_.isNull(n)&&(""===$.trim(e)?n=this.i18n("ipNotSpecified"):s.isValidIP(e)||(n=this.i18ns("ipNotValid",e)))},this),!_.isNull(n))return n}},toJSON:function(){return this.get(this.DP.NAME_SERVERS)},parse:function(e,n){t.prototype.parse.apply(this,arguments);var i={};return i.nameServers=e,i}});return e.extend({name:"NameServerPopupView",el:"#popupNameServer",nameServerModel:null,model:null,clusterUuid:null,template:_.template(o),rowTemplate:_.template(a.TABLE_ITEM_DELETE),events:{"click  .btnCreate":"onCreateItem","click  .btnDelete":"onDeleteItem","keypress input":"onKeyPress","click input":"clearHeader","click .btnCancel":"hide","click .btnOK":"hide","click .modal-header .close":"hide"},initialize:function(){e.prototype.initialize.apply(this,arguments),this.model=new r},render:function(){this.$el.html(this.defaultTemplate({title:this.i18n("nameServers"),footer:!1,bodyContent:this.template(this.vtOptions({canModify:this.canModifyByEntityType(i.ENTITY_NAME_SERVER)}))}))},show:function(t){e.prototype.show.apply(this,arguments),this.listNameServers()},reset:function(){this.clearHeader(),this.undelegateEvents()},onEnterKeyPress:function(){this.onCreateItem()},onCreateItem:function(){var e=this.$(".inputNameServer").val(),t=_.find(this.model.get(this.model.DP.NAME_SERVERS),function(t){return t===e});if(!_.isUndefined(t))return void this.showHeaderError(this.i18n("ipExistenceError"));this.updateNameServers(i.ACTION_CREATE,[e])},onDeleteItem:function(e){var t=this,n=$(e.currentTarget).attr("dataid");$.nutanixConfirm({msg:t.i18ns("confirmDelete",n),yes:function(){t.updateNameServers(i.ACTION_DELETE,[n])}})},listNameServers:function(){var e=this;this.model.fetch({success:function(){var t=$("#nameServerList > tbody");t.html("");var n=e.model.get(e.model.DP.NAME_SERVERS);if(n&&n.length)for(var s=0;s<n.length;s++){var a=e.rowTemplate({model:n[s],canModify:e.canModifyByEntityType(i.ENTITY_NAME_SERVER)});t.append(a)}else t.html("<tr><td colspan=2>"+e.i18n("nameServersNotConfigured")+"</tr></td>");e.showForm(),e.triggerAction(i.MODAL.ACT.AS_REBUILD)},error:function(t,n){e.showHeaderError(n.responseText)}})},updateNameServers:function(e,t){var n=this;this.nameServerModel=new r,this.clusterManager.isMulticlusterNavMode()&&this.nameServerModel.setProxyClusterUuid(this.clusterUuid),this.nameServerModel.actionMode=e,this.nameServerModel.save({nameServers:t},{success:function(e,t){n.listNameServers(),n.$(".inputNameServer").val(""),n.nameServerModel.retrievedResultMessage&&n.showHeaderInfo(n.nameServerModel.retrievedResultMessage)},error:function(e,t){var i=t;void 0!==t.responseText&&(i=t.responseText,s.log("NameServerPopupView. Error: "+s.processAjaxError(i))),n.showHeaderError(i)}})}})}),define("text!templates/popups/ntpserver/NtpServerContentView.html",[],function(){return'\x3c!-- The parent div modal is #popupNtpServer --\x3e\n<div data-ntnx-content-inner>\n  <% if (canModify) { %>\n    <section data-ntnx-section="type-text">\n      <%= i18n(\'configure_ntp_servers\') %>\n    </section>\n  <% } %>\n  \x3c!-- Form to add ntp servers --\x3e\n  <form onsubmit="return false;">\n    <% if (canModify) { %>\n      <section data-ntnx-section>\n        <label data-ntnx-label for="inputNtpServer">\n          <%= i18n(\'ntp_server\') %>\n        </label>\n        <div data-ntnx-action-input>\n          <%= Components.button({\n            extraClasses        : \'btnCreate pull-right\',\n            text                : i18n(\'add\'),\n            iconLeft            : \'plus\'\n          }) %>\n          <div data-ntnx-input-container>\n            <input type="text" class="inputNtpServer" id="inputNtpServer">\n          </div>\n        </div>\n      </section>\n    <% } %>\n    <section data-ntnx-section>\n      <table id="ntpServerList" class="table table-hover">\n        <thead>\n        <tr>\n          <th><%= i18n(\'host_name_ip\') %></th>\n          <th>&nbsp;</th>\n        </tr>\n        </thead>\n        <tbody>\n          \x3c!-- @view: NTP Servers list goes here... --\x3e\n        </tbody>\n      </table>\n    </section>\n  </form>\n</div>\n'}),define("views/popups/ntpserver/NtpServerPopupView",["backbone","views/basecomponents/popups/BasePopupView","models/BaseModel","data/DataURLConstants","utils/AppConstants","utils/AppUtil","utils/CommonTemplates","text!templates/popups/ntpserver/NtpServerContentView.html"],function(e,t,n,i,s,a,o,r){"use strict";r=_.template(r);var l=n.extend({urlRoot:i.NTP_SERVERS,entityType:s.ENTITY_NTP_SERVER,defaults:{ntpServers:[]},getURL:function(e,t){if("update"===e||"create"===e){if(this.actionMode===s.ACTION_DELETE)return i.REMOVE_NTP_SERVERS;if(this.actionMode===s.ACTION_CREATE)return i.ADD_NTP_SERVERS}return i.NTP_SERVERS},toJSON:function(){return this.get("ntpServers")},parse:function(e){var t={};return t.ntpServers=e,t}});return t.extend({name:"NtpServerPopupView",el:"#popupNtpServer",ntpServerModel:null,rowTemplate:_.template(o.TABLE_ITEM_DELETE),events:{"click  .btnCreate":"onCreateItem","click  .btnDelete":"onDeleteItem","keypress input":"onKeyPress","click input":"onClick","click .btnCancel":"hide","click .btnOK":"hide","click .modal-header .close":"hide"},render:function(){this.$el.html(this.defaultTemplate({title:this.i18n("ntp_servers"),footer:!1,bodyContent:r(this.vtOptions({canModify:this.canModifyByEntityType(s.ENTITY_NTP_SERVER)}))}))},show:function(e){t.prototype.show.apply(this,arguments),this.listNtpServers()},reset:function(){this.triggerAction(s.MODAL.ACT.ALERT_HIDE),this.undelegateEvents()},createNtpServerModel:function(){return new l},onClick:function(){this.triggerAction(s.MODAL.ACT.ALERT_HIDE)},onEnterKeyPress:function(){this.onCreateItem()},onCreateItem:function(){this.updateNtpServers(s.ACTION_CREATE,[this.$el.find(".inputNtpServer").val()])},onDeleteItem:function(e){var t=this,n=$(e.currentTarget).attr("dataid");$.nutanixConfirm({msg:this.i18ns("delete_server",n),yes:function(){t.updateNtpServers(s.ACTION_DELETE,[n])}})},listNtpServers:function(){var e=this;this.model=this.createNtpServerModel(),this.model.fetch({success:function(){var t=e.$("#ntpServerList > tbody");t.html("");var n=e.model.get("ntpServers");if(n&&n.length)for(var i=0;i<n.length;i++){var a=e.rowTemplate({model:n[i],canModify:e.canModifyByEntityType(s.ENTITY_NTP_SERVER)});e.$("#ntpServerList").append(a)}else t.html("<tr><td colspan=2>"+e.i18n("not_configured")+"</tr></td>");e.showForm(),e.triggerAction(s.MODAL.ACT.AS_REBUILD)},error:function(t,n){e.triggerAction(s.MODAL.ACT.ALERT_SHOW,{type:s.MODAL.ALERT.TYPE_ERROR,message:n.responseText})}})},updateNtpServers:function(e,t){var n=this;this.ntpServerModel=this.createNtpServerModel(),this.ntpServerModel.actionMode=e,this.mode=e,this.ntpServerModel.set("ntpServers",t),this.ntpServerModel.save(null,{success:function(e,t){n.listNtpServers(),n.$el.find(".inputNtpServer").val("")},error:function(e,t){a.log("NtpServerPopupView. Error: "+a.processAjaxError(t.responseText)),n.triggerAction(s.MODAL.ACT.ALERT_SHOW,{type:s.MODAL.ALERT.TYPE_ERROR,message:n.i18n("address_error")})}})}})}),define("views/pages/network/entities/HostVizSubView",["views/basecomponents/BaseSubView","models/graph/GraphModel","data/DataProperties","utils/AppUtil","utils/D3Util","utils/StatsUtil","utils/SVG","utils/AppConstants","d3"],function(e,t,n,i,s,a,o,r,l){"use strict";var c={GRAPH_PADDING:4,BRIDGE_WIDTH:140,BRIDGE_HEIGHT:50,BOND_HEIGHT:30,LONG_CONNECTOR:80,SHORT_CONNECTOR:17,MED_CONNECTOR:65,PORT_CIRCLE_RADIUS:9.5,NIC_CIRCLE_RADIUS:1.5,HALFPIX:.5},d={DATA_ID:"data-id",GTOP:"gtop",GLEFT:"gleft",E_TYPE:"e-type",SRC_ID:"src-id",TAR_ID:"tar-id"},p={SPLINE:"spline",ELBOW:"elbow",STRAIGHT:"straight"};return e.extend({model:null,name:"HostVizSubView",_svg:null,hostid:null,graphData:null,_PORT_ICON_PATH:o.networkPortIconPath,_PORT_ICON_PATH_10G:o.network10GPortIconPath,events:{"click .entity":"onEntityClick"},initialize:function(t){e.prototype.initialize.apply(this,arguments),t&&(this.hostid=t.hostid)},onStartServices:function(){this.model.on(this.model.CHANGE_EVENTS.REFRESH_DATA,this.renderViz,this)},onStopServices:function(){this.model.off(this.model.CHANGE_EVENTS.REFRESH_DATA,this.renderViz,this)},destroy:function(){this._svg&&(this._svg.remove(),this._svg=null),this.onStopServices(),e.prototype.destroy.apply(this,arguments)},onResize:function(){this.drawGraph()},render:function(){this.$el.html('<div class="loader"></div>'),i.addInLineDonutLoader(this.$(".loader"))},renderViz:function(e){e&&e.entityType!==n.NW_E_TYPES.HOST||(this.$el.html(""),this.drawGraph())},massageData:function(){if(this.hostid){var e=this.model.getRelatedSources(t.RELATIONSHIPS.VM2HOST,this.hostid),i=this.model.getRelatedTargets(t.RELATIONSHIPS.HOST2BRIDGE,this.hostid),s=this.model.getRelatedTargets(t.RELATIONSHIPS.HOST2BOND,this.hostid),a=this.model.getRelatedTargets(t.RELATIONSHIPS.HOST2SWITCH,this.hostid),o=this.model.getRelatedTargets(t.RELATIONSHIPS.HOST2PNIC,this.hostid);this.graphData={},this.graphData.bridgeStackGroups=[],this.graphData.switchStackGroup=[];var l=o;if(_.each(i,function(t){var i={},a=t.host_nic,c=_.find(e,function(e){return"1"===e[n.EB.VM.IS_CVM]&&_.contains([r.CVM_BRIDGE,r.CVM_BRIDGE_VIR],t.name)});c&&(i[n.NW_E_TYPES.CVM]=[],i[n.NW_E_TYPES.CVM].push({cvmUuid:c.id}));i[n.NW_E_TYPES.BRIDGE]=[],i[n.NW_E_TYPES.BRIDGE].push({brId:t.id,brName:t.name}),i[n.NW_E_TYPES.BOND]=[],i[n.NW_E_TYPES.PNIC]=[],_.each(t[n.EB.VIRTUAL_SWITCH.NIC_TEAM],function(e){var t=_.find(s,function(t){return t.id===e});if(t){i[n.NW_E_TYPES.BOND].push({bondId:t.id,bondName:t[n.EB.NIC_TEAM.NAME]}),a=_.filter(a,function(e){return!_.contains(t[n.EB.NIC_TEAM.HOST_NICS],e)});var r=_.map(t[n.EB.NIC_TEAM.HOST_NICS],function(e){return _.find(o,function(t){return t.id===e})});r=_.sortBy(r,function(e){return e[n.EB.PNIC.PORT_NAME]}),_.each(r,function(e){this._addPnicToBridgeGroup(i,e,t,n.NW_E_TYPES.BOND)},this)}},this),_.each(a,function(e){var t=_.find(o,function(t){return t.id===e});this._addPnicToBridgeGroup(i,t,null,n.NW_E_TYPES.BRIDGE)},this),l=_.filter(l,function(e){return!_.contains(t.host_nic,e.id)}),this.graphData.bridgeStackGroups.push(i)},this),l&&l.length){var c={};c[n.NW_E_TYPES.PNIC]=[],_.each(l,function(e){this._addPnicToBridgeGroup(c,e,null,null)},this),this.graphData.bridgeStackGroups.push(c)}this.graphData.switchStackGroup.push({network_switch:[]}),_.each(a,function(e){this.graphData.switchStackGroup[0][n.NW_E_TYPES.SWITCH].push({switchId:e.id,switchName:e.name})},this)}},_addPnicToBridgeGroup:function(e,t,i,s){if(t){var o,r=!0;if(s===n.NW_E_TYPES.BOND&&i){var l=i[n.EB.NIC_TEAM.ACTIVE_HOST_NIC];r=l&&l.length&&_.contains(l,t.id),o=i.id}var c=t[n.EB.PNIC.LINK_SPEED];c=c?c/a.KBPS_UNIT_RATIOS.mbps:"";var d=this._getSwitchInfoForPnic(this.hostid,t.id);e[n.NW_E_TYPES.PNIC].push({nicId:t.id,nicLinkSpeed:c,nicUplink:r,switchId:d.switchId,switchPortId:d.switchPortId,connectedFrom:s,bondId:o})}},_getSwitchInfoForPnic:function(e,n){var i=this.model.getEdges(t.RELATIONSHIPS.HOST2SWITCH),s=e+r.GRAPH_DATA_SEPARATOR+n,a={},o=_.find(i,function(e){if(e&&e.length&&e[0]===s)return!0});return o&&2===o.length&&(o=o[1].split(r.GRAPH_DATA_SEPARATOR),a.switchId=o[0],a.switchPortId=o[1]),a},drawGraph:function(){var e,t,n,i=this.$el.width();if(this.massageData(),this.graphData){this._svg&&(this._svg.remove(),this._svg=null),this._svg=l.select(this.$el[0]).append("svg").attr("width",i).attr("height",600).attr("class","network-host-viz"),this.layoutGraph(i,600),this.graphData.bridgeStackGroups&&this.graphData.bridgeStackGroups.length&&(n=this._svg.selectAll(".divLinesG").data([this.graphData.divisionLinesGroup]).enter().append("g").attr(d.GLEFT,function(e){return e.x}).attr(d.GTOP,function(e){return e.y}).attr("class","divLinesG").attr("transform",function(e){return"translate("+e.x+","+e.y+")"}),this.renderDivisionLinesGroup(n),t=this._svg.selectAll(".bridgeStackG").data(this.graphData.bridgeStackGroups).enter().append("g").attr(d.GLEFT,function(e){return e.x}).attr(d.GTOP,function(e){return e.y}).attr("class","bridgeStackG").attr("transform",function(e){return"translate("+e.x+","+e.y+")"}),this.renderBridgeStackGroups(t),this.renderBridgeStackGroupEdges(t,e));var s=this.$("svg.network-host-viz")[0].getBBox().height,a=this.$("svg.network-host-viz")[0].getBBox().width,o=s+50;this._svg.attr("height",o),this._svg.attr("width",a),this.$(".vizContent").height(o+50)}},renderDivisionLinesGroup:function(e){var t=this;e.each(function(e){var n=l.select(this);if(e.divLines){var i=n.selectAll(".divLines").data(e.divLines).enter().append("line").attr("class","div-line").attr("shape-rendering","crispEdges");t._setEntityLineAttribs(i)}})},renderBridgeStackGroups:function(e){var t=this;e.each(function(e){var i=l.select(this);if(e[n.NW_E_TYPES.BRIDGE]){var s=i.selectAll(".bridgeGroup").data(e[n.NW_E_TYPES.BRIDGE]).enter().append("g").attr("class","bridgeGroup entity").attr(d.DATA_ID,function(e){return e.brId}).attr(d.E_TYPE,n.NW_E_TYPES.BRIDGE).attr(d.GLEFT,function(e){return e.x}).attr(d.GTOP,function(e){return e.y}).attr("transform",function(e){return"translate("+e.x+","+e.y+")"}),a="bridge";s.data()&&s.data().length&&s.data()[0].brName===r.CVM_BRIDGE_VIR&&(a+=" passive"),t._renderEntityGs(s,a)}if(e[n.NW_E_TYPES.BOND]){var o=i.selectAll(".bondGroup").data(e[n.NW_E_TYPES.BOND]).enter().append("g").attr("class","bondGroup entity").attr(d.DATA_ID,function(e){return e.bondId}).attr(d.E_TYPE,n.NW_E_TYPES.BOND).attr(d.GLEFT,function(e){return e.x}).attr(d.GTOP,function(e){return e.y}).attr("transform",function(e){return"translate("+e.x+","+e.y+")"});t._renderEntityGs(o,"bond")}if(e[n.NW_E_TYPES.CVM]&&!t._svg.select(".cvmGroup").node()){var c=i.selectAll(".cvmGroup").data(e[n.NW_E_TYPES.CVM]).enter().append("g").attr("class","cvmGroup entity").attr(d.DATA_ID,function(e){return e.cvmUuid}).attr(d.E_TYPE,n.NW_E_TYPES.CVM).attr(d.GLEFT,function(e){return e.x}).attr(d.GTOP,function(e){return e.y}).attr("transform",function(e){return"translate("+e.x+","+e.y+")"});t._renderEntityGs(c,"cvm")}if(e.uvm){var p=i.selectAll(".uvmGroup").data(e.uvm).enter().append("g").attr("class","uvmGroup").attr(d.E_TYPE,n.NW_E_TYPES.UVM).attr(d.GLEFT,function(e){return e.x}).attr(d.GTOP,function(e){return e.y}).attr("transform",function(e){return"translate("+e.x+","+e.y+")"});t._renderEntityGs(p,"uvm")}if(e[n.NW_E_TYPES.PNIC]){var u=i.selectAll(".nicGroup").data(e[n.NW_E_TYPES.PNIC]).enter().append("g").attr("class","nicGroup").attr(d.DATA_ID,function(e){return e.nicId}).attr(d.E_TYPE,n.NW_E_TYPES.PNIC).attr(d.GLEFT,function(e){return e.x}).attr(d.GTOP,function(e){return e.y}).attr("transform",function(e){return"translate("+e.x+","+e.y+")"});t._renderEntityGs(u,"nic")}})},renderSwitchStackGroup:function(e){var t=this;e.each(function(e){l.select(this).selectAll(".switchBundle").data(e[n.NW_E_TYPES.SWITCH]).enter().append("g").attr(d.GLEFT,function(e){return e.x}).attr(d.GTOP,function(e){return e.y
}).attr("class","switchGroup entity").attr(d.DATA_ID,function(e){return e.switchId}).attr(d.E_TYPE,n.NW_E_TYPES.SWITCH).attr("transform",function(e){return"translate("+e.x+","+e.y+")"}).each(function(e){var n=l.select(this);if(e.network_switch){var i=n.selectAll(".switch").data(e.network_switch).enter().append("rect").attr("class","switch");t._setEntityRectAttribs(i)}if(e.portLine){var s=n.selectAll(".port-line").data(e.portLine).enter().append("line").attr("class","port-line").attr("shape-rendering","crispEdges");t._setEntityLineAttribs(s)}if(e.label){var a=n.selectAll(".switch-label").data(e.label).enter().append("text").attr("class","switch-label");a.each(function(e){var t=l.select(this);t.append("tspan").text(function(e){return e.type}).attr("class","type"),t.append("tspan").text(function(e){return e.name.substring(0,10)}).attr("dx",7).attr("class","name")}),t._setEntityTextAttribs(a)}})})},renderBridgeStackGroupEdges:function(e,t){var i=this;e.each(function(e){var a,o,r,c,u=l.select(this),h=u.select(".bridgeGroup"),m=u.select(".cvmGroup"),f=u.select(".uvmGroup"),v=u.selectAll(".bondGroup"),g=u.selectAll(".nicGroup"),E=!1;if(!m.node()&&e[n.NW_E_TYPES.CVM]&&(m=i._svg.select(".cvmGroup"),E=!0),!_.isNull(h.node())&&!_.isNull(m.node()))if(a=s.getConnectionPoint(h,"rect","T"),o=s.getConnectionPoint(m,"rect","B"),r=h.attr(d.DATA_ID),c=m.attr(d.DATA_ID),E){var T=l.select(m.node().parentNode);o.x=o.x+Number(T.attr("gleft")),o.y=o.y+Number(T.attr("gtop")),a.x=a.x+Number(u.attr("gleft")),a.y=a.y+Number(u.attr("gtop")),i._renderEdge(i._svg,a,o,"active",r,c,p.ELBOW)}else a.x=o.x,i._renderEdge(u,a,o,"active",r,c);_.isNull(h.node())||_.isNull(f.node())||(a=s.getConnectionPoint(h,"rect","T"),o=s.getConnectionPoint(f,"rect","B"),r=h.attr(d.DATA_ID),c=f.attr(d.DATA_ID),a.x=o.x,i._renderEdge(u,a,o,"active",r,c)),_.isNull(h.node())||_.isNull(v.node())||v.each(function(e,t){var n=l.select(this);a=s.getConnectionPoint(h,"rect","B"),o=s.getConnectionPoint(n,"rect","T"),a.x=o.x,r=h.attr(d.DATA_ID),c=n.attr(d.DATA_ID),i._renderEdge(u,a,o,"active",r,c)}),_.isNull(g.node())||(g.each(function(e,t){var p,m=l.select(this);if(e.connectedFrom===n.NW_E_TYPES.BRIDGE?p=h:e.connectedFrom===n.NW_E_TYPES.BOND&&(p=u.select('.bondGroup[data-id="'+e.bondId+'"]')),p&&!_.isNull(p.node())){a=s.getConnectionPoint(p,"rect","B"),o=s.getConnectionPoint(m,"rect","T");var f={},v={};a.x=o.x,f.y=a.y+1,f.x=a.x,v.x=o.x,v.y=o.y-2,r=p.attr(d.DATA_ID),c=m.attr(d.DATA_ID),i._renderEdge(u,f,v,e.nicUplink?"active":"passive-underline",r,c),i._renderEdge(u,a,o,e.nicUplink?"active":"passive",r,c)}}),_.isNull(g.node())||i._renderHostNicToSwitchPortEdges(u,t,g))})},_renderHostNicToSwitchPortEdges:function(e,t,i){var a,o=this;i.each(function(t,i){var r=l.select(this);a=s.getConnectionPoint(r,"rect","B"),a.dataId=r.attr(d.DATA_ID),a.eType=n.NW_E_TYPES.PNIC,a.icon=o.getIconForHostNIC(t.nicLinkSpeed),o._renderPortsOnEdge(e,a)})},getIconForHostNIC:function(e){return 10===e?this._PORT_ICON_PATH_10G:this._PORT_ICON_PATH},_renderPortsOnEdge:function(e,t,n){var i=n?[t,n]:[t];e.selectAll(".ports").data(i).enter().append("circle").attr("class","port entity").attr(d.DATA_ID,function(e){return e.dataId}).attr(d.E_TYPE,function(e){return e.eType}).attr("cx",function(e){return e.x}).attr("cy",function(e){return e.y}).attr("r",c.PORT_CIRCLE_RADIUS).each(function(t){var n=l.select(this),i=Number(n.attr("cx")),s=Number(n.attr("cy"));e.append("path").attr("d",t.icon).attr("class","port-icon entity").attr(d.DATA_ID,t.dataId).attr(d.E_TYPE,t.eType).attr("transform",function(e){return"translate("+(i-5.5)+","+(s-5)+")"})})},_renderEdge:function(e,t,n,i,a,o,r){switch(r){case p.SPLINE:e.selectAll(".lines").data([[t,n]]).enter().append("path").attr("class",i).attr(d.SRC_ID,a).attr(d.TAR_ID,o).attr("d",function(e){var t=s.curveXPoints(e[0],e[1],2);return"M"+t[0].x+","+t[0].y+"C"+t[1].x+","+t[1].y+","+t[2].x+","+t[2].y+","+t[3].x+","+t[3].y});break;case p.ELBOW:e.selectAll(".lines").data([[t,n]]).enter().append("path").attr("class",i).attr(d.SRC_ID,a).attr(d.TAR_ID,o).attr("d",function(e){var t=s.elbowPoints(e[0],e[1]);return"M"+t[0].x+","+t[0].y+","+t[1].x+","+t[1].y+","+t[2].x+","+t[2].y+","+t[3].x+","+t[3].y});break;default:e.selectAll(".lines").data([[t,n]]).enter().append("line").attr("class",i).attr(d.SRC_ID,a).attr(d.TAR_ID,o).attr("x1",function(e){return e[0].x}).attr("y1",function(e){return e[0].y}).attr("x2",function(e){return e[1].x}).attr("y2",function(e){return e[1].y})}},_renderEntityGs:function(e,t){var n=this;e.each(function(e){var i=l.select(this),s=i.selectAll("."+t).data(e.entityRect).enter().append("rect").attr("class",t);if(n._setEntityRectAttribs(s),e.entityCircles){i.selectAll("."+t+"-circle").data(e.entityCircles).enter().append("circle").attr("class",t+"-circle").attr("cx",function(e){return e.x}).attr("cy",function(e){return e.y}).attr("r",c.NIC_CIRCLE_RADIUS)}if(e.label){var a=i.selectAll("."+t+"-label").data(e.label).enter().append("text").attr("class",t+"-label");a.each(function(e){var t=l.select(this),n=t.datum();n.type&&t.append("tspan").text(function(e){return e.type}).attr("class","type"),n.name&&t.append("tspan").text(function(e){return e.name}).attr("dx",function(e){return e.type?7:0}).attr("class","name")}),n._setEntityTextAttribs(a)}})},_setEntityRectAttribs:function(e){e&&e.attr("x",function(e){return e.x+c.HALFPIX}).attr("y",function(e){return e.y+c.HALFPIX}).attr("rx",4+c.HALFPIX).attr("ry",4+c.HALFPIX).attr("width",function(e){return e.width}).attr("height",function(e){return e.height})},_setEntityLineAttribs:function(e){e&&e.attr("x1",function(e){return e.x1}).attr("y1",function(e){return e.y1}).attr("x2",function(e){return e.x2}).attr("y2",function(e){return e.y2})},_setEntityTextAttribs:function(e){e&&e.attr("x",function(e){return e.x}).attr("y",function(e){return e.y+c.HALFPIX})},layoutGraph:function(e,t){this.graphData.bridgeStackGroups&&this.graphData.bridgeStackGroups.length&&(this.layoutBridgeGroups(this.graphData.bridgeStackGroups,e,t),this.graphData.divisionLinesGroup={},this.layoutDivisionLines(this.graphData.divisionLinesGroup,e,t))},layoutBridgeGroups:function(e,t,i){var s=e.length,a=c.BRIDGE_WIDTH+10,o=t/(s+2);o<a&&(o=a);var r=_.any(e,function(e){return _.has(e,n.NW_E_TYPES.CVM)});_.each(e,function(e,t){e.x=o*(t+1),e.y=c.GRAPH_PADDING,_.each(e,function(e,t,i){var s,a,o=!1;switch(i.uvm&&i.cvm&&(s=c.BRIDGE_WIDTH/2.25,a=.25*s,o=!0),t){case n.NW_E_TYPES.BRIDGE:e&&e.length&&(e[0].x=0,e[0].y=r?c.BRIDGE_HEIGHT+c.LONG_CONNECTOR:0,e[0].entityRect=[{x:0,y:0,width:c.BRIDGE_WIDTH,height:c.BRIDGE_HEIGHT}],e[0].label=[{type:this.i18n("bridge_lbl"),name:e[0].brName,x:c.BRIDGE_WIDTH/2,y:c.BRIDGE_HEIGHT/2+3}]);break;case n.NW_E_TYPES.BOND:var l=e&&e.length?e.length:0,d=l>1?c.BRIDGE_WIDTH/(l+.05):c.BRIDGE_WIDTH,p=l>1?.05*d/(l-1):0;_.each(e,function(e,t){e.x=d*t+p*t,e.y=r?2*c.BRIDGE_HEIGHT+c.LONG_CONNECTOR+c.SHORT_CONNECTOR:c.BRIDGE_HEIGHT+c.SHORT_CONNECTOR,e.entityRect=[{x:0,y:0,width:d,height:c.BOND_HEIGHT}],e.label=[{type:this.i18n("bond_lbl"),name:e.bondName,x:d/2,y:c.BOND_HEIGHT/2+3}]},this);break;case n.NW_E_TYPES.CVM:e&&e.length&&(e[0].x=0,e[0].y=0,e[0].entityRect=[{x:0,y:0,width:o?s:c.BRIDGE_WIDTH/2,height:c.BRIDGE_HEIGHT}],e[0].label=[{type:this.i18n("cvm_lbl"),x:o?s/2:c.BRIDGE_WIDTH/4,y:c.BRIDGE_HEIGHT/2+3}]);break;case n.NW_E_TYPES.UVM:e&&e.length&&(e[0].x=o?s+a:0,e[0].y=0,e[0].entityRect=[{x:0,y:0,width:o?s:c.BRIDGE_WIDTH,height:c.BRIDGE_HEIGHT}],e[0].label=[{type:e[0].numUVMs+" "+this.i18n("uvm_lbl"),x:o?s/2:c.BRIDGE_WIDTH/2,y:c.BRIDGE_HEIGHT/2+3}]);break;case n.NW_E_TYPES.PNIC:var u=e&&e.length?e.length:0,h=c.BRIDGE_WIDTH/(u+.25),m=u>1?.25*h/(u-1):0;_.each(e,function(e,t){e.x=h*t+m*t,e.y=r?2*c.BRIDGE_HEIGHT+c.BOND_HEIGHT+2*c.LONG_CONNECTOR+c.SHORT_CONNECTOR:c.BRIDGE_HEIGHT+c.BOND_HEIGHT+c.LONG_CONNECTOR+c.SHORT_CONNECTOR,e.entityRect=[{x:0,y:0,width:h,height:c.BRIDGE_HEIGHT}],e.entityCircles=[{x:5,y:5},{x:h-5,y:5},{x:5,y:c.BRIDGE_HEIGHT-5},{x:h-5,y:c.BRIDGE_HEIGHT-5}],e.label=[{type:e.nicLinkSpeed+"G",x:h/2,y:c.BRIDGE_HEIGHT/2+3}]},this)}},this)},this)},layoutSwitches:function(e,t,i){_.each(e,function(e){e.x=c.GRAPH_PADDING,e.y=3*c.BRIDGE_HEIGHT+c.BOND_HEIGHT+2*c.LONG_CONNECTOR+c.MED_CONNECTOR+c.SHORT_CONNECTOR+c.GRAPH_PADDING,_.each(e,function(e,i){switch(i){case n.NW_E_TYPES.SWITCH:_.each(e,function(e,n,i){e.x=0,e.y=n*c.BRIDGE_HEIGHT,e.network_switch=[{width:c.BRIDGE_WIDTH,height:c.BOND_HEIGHT,x:0,y:0}],e.portLine=[{x1:c.BRIDGE_WIDTH,y1:c.BOND_HEIGHT/2,x2:t-c.GRAPH_PADDING,y2:c.BOND_HEIGHT/2}],e.label=[{type:this.i18n("tor_switch_lbl"),name:e.switchName,x:c.BRIDGE_WIDTH/2,y:c.BOND_HEIGHT/2+3}]},this)}},this)},this)},layoutDivisionLines:function(e,t,n){e.x=c.GRAPH_PADDING,e.y=c.GRAPH_PADDING+c.BRIDGE_HEIGHT+c.LONG_CONNECTOR/2,e.divLines=[],e.divLines.push({x1:0,y1:0,x2:t-c.GRAPH_PADDING,y2:0});var i=c.LONG_CONNECTOR+c.BRIDGE_HEIGHT+c.BOND_HEIGHT+c.SHORT_CONNECTOR;e.divLines.push({x1:0,y1:i,x2:t-c.GRAPH_PADDING,y2:i})},onEntityClick:function(e){var t=$(e.currentTarget),i=t.attr(d.DATA_ID),s=t.attr(d.E_TYPE);this._svg.selectAll(".entity.selected").classed("selected",!1),this._svg.selectAll('.entity[data-id="'+i+'"]').classed("selected",!0),s===n.NW_E_TYPES.PNIC&&(i=this.hostid+r.GRAPH_DATA_SEPARATOR+i),this.model.setEntitySelection(s,i)}})}),define("views/pages/network/entities/HostEntityDetailsSubView",["views/basecomponents/BaseSubView","data/DataProperties","models/graph/GraphModel","managers/I18nManager","utils/AppUtil","utils/AntiscrollUtil","utils/EntityUtil","utils/FilterUtil","utils/StatsUtil","utils/AppConstants","models/hardware/HostModel","models/ebrowser/EBQueryModel","views/basecomponents/charts/groups/MetricGroupChartView"],function(e,t,n,i,s,a,o,r,l,c,d,p,u){"use strict";var h=_.template('<tr class="attrib-row"> <td><%= name %></td><td><%= value %><% if (color) { %><span class="color-circle" style="background:<%= color %>"></span><% } %></td></tr>'),m=_.template('<select class="vm-nics"><% _.each(options, function(opt) { %><option value="<%= opt.id %>" <%= opt.selected%>><%= opt.name %></option><% }); %></select>'),f=_.template('<p><%= error.message %></p><% if (error.reasons && error.reasons.length) { %><p><%= error.link %></p><ul class="error"><% _.each(error.reasons, function(rs) { %><li><%= rs %></li><% }); %></ul><% } %>'),v=[t.NW_E_TYPES.PNIC,t.NW_E_TYPES.SWITCH_INTERFACE,t.NW_E_TYPES.VM,t.NW_E_TYPES.CVM],g=i.t("HostEntityDetailsSubView","fetch_error"),E={message:i.t("HostEntityDetailsSubView","unknown_port_msg"),link:i.t("HostEntityDetailsSubView","unknown_port_link"),reasons:[i.t("HostEntityDetailsSubView","unknown_port_reason1"),i.t("HostEntityDetailsSubView","unknown_port_reason2")]},T={message:i.t("HostEntityDetailsSubView","unknown_switch_msg"),link:i.t("HostEntityDetailsSubView","unknown_switch_link"),reasons:[i.t("HostEntityDetailsSubView","unknown_switch_reason1"),i.t("HostEntityDetailsSubView","unknown_switch_reason2"),i.t("HostEntityDetailsSubView","unknown_switch_reason3")]};return e.extend({model:null,name:"HostEntityDetailsSubView",entityType:null,entityId:null,entityModel:null,additionalModels:null,selectedChartEntity:null,events:{"change .vm-nics":"onSelectVmNic"},onStartServices:function(){this.model.on(this.model.CHANGE_EVENTS.ENTITY_SELECTION,this.renderEntityDetails,this)},onStopServices:function(){this.model.off(this.model.CHANGE_EVENTS.ENTITY_SELECTION,this.renderEntityDetails,this),this.selectedChartEntity&&this.selectedChartEntity.view&&this.selectedChartEntity.view.stopServices()},destroy:function(){this.onStopServices(),e.prototype.destroy.apply(this,arguments)},render:function(){this.$(".attribs-header").html('<div class="loader"></div>'),this.$(".charts-container").html('<div class="loader"></div>'),s.addInLineDonutLoader(this.$(".loader")),this.additionalModels=[]},renderEntityDetails:function(e){var n=e.entityType,i=this.model.getEntitySelection(n),s=[];if((this.entityType!==n||this.entityId!==i)&&(this.entityType=n,this.entityId=i,this.selectedChartEntity&&this.selectedChartEntity.view&&this.selectedChartEntity.view.stopServices(),!this.checkForUnknownEntity())){switch(this.entityType){case t.NW_E_TYPES.HOST:s=this._getHostQueries();break;case t.NW_E_TYPES.BRIDGE:s=this._getBridgeQueries();break;case t.NW_E_TYPES.BOND:s=this._getBondQueries();break;case t.NW_E_TYPES.PNIC:s=this._getPNicQueries();break;case t.NW_E_TYPES.CVM:s=this._getCVMQueries();break;case t.NW_E_TYPES.VM:s=this._getVMQueries();break;case t.NW_E_TYPES.SWITCH_INTERFACE:s=this._getSwitchInterfaceQueries();break;case t.NW_E_TYPES.SWITCH:s=this._getSwitchQueries()}var o=this;$.when.apply($,s).done(function(){switch(o.entityType){case t.NW_E_TYPES.CVM:case t.NW_E_TYPES.VM:o.entityModel=o.entityModel.getQueryResults().models;break;case t.NW_E_TYPES.SWITCH:case t.NW_E_TYPES.BRIDGE:case t.NW_E_TYPES.BOND:case t.NW_E_TYPES.PNIC:case t.NW_E_TYPES.SWITCH_INTERFACE:o.entityModel&&(o.entityModel=o.entityModel.getQueryResults().models[0])}_.each(o.additionalModels,function(e,t){o.additionalModels[t]=e.getQueryResults().models},o),o._clearPalette(),o._getAttribsAndRender(),o.renderCharts(),a.applyAntiScroll(o.$el.parents(".antiscroll-wrap"))}).fail(function(e){o._clearPalette(),o.$(".attribs-header").html(g),o.renderCharts()})}},_createQueryModel:function(e,t,n,i){var s;return s=new p,s.set(p.DP.ENTITY_TYPE,e),n&&s.set(p.DP.ENTITY_IDS,[n]),i&&s.set(p.DP.FILTER_EXPR,i),s.setGroupMemberAttributesList(t),s},_getHostQueries:function(){var e=[],n={};return this.additionalModels=[],this.entityModel=new d,this.entityModel.setId(this.entityId),e.push(this.entityModel.fetch()),r.addFilterCondition(n,t.EB.VIRTUAL_SWITCH.NODE,r.createFilterCondition(c.ENTITY_VIRTUAL_SWITCH,t.EB.VIRTUAL_SWITCH.NODE,c.FILTER_OPERATORS.EQUALS,this.entityId)),this.additionalModels.push(this._createQueryModel(c.ENTITY_VIRTUAL_SWITCH,[t.EB.VIRTUAL_SWITCH.NAME],null,n)),e.push(this.additionalModels[0].performQuery()),n={},r.addFilterCondition(n,t.EB.PNIC.NODE,r.createFilterCondition(t.NW_E_TYPES.PNIC,t.EB.PNIC.NODE,c.FILTER_OPERATORS.EQUALS,this.entityId)),this.additionalModels.push(this._createQueryModel(t.NW_E_TYPES.PNIC,[t.EB.PNIC.LINK_SPEED],null,n)),e.push(this.additionalModels[1].performQuery()),e},_getCVMQueries:function(){var e=[];this.additionalModels=[];var n={};return r.addFilterCondition(n,t.EB.VIRTUAL_NIC.VM,r.createFilterCondition(t.NW_E_TYPES.VNIC,t.EB.VIRTUAL_NIC.VM,c.FILTER_OPERATORS.EQUALS,this.entityId)),this.entityModel=this._createQueryModel(t.NW_E_TYPES.VNIC,this._getAttribNamesToFetch(this.entityType),null,n),e.push(this.entityModel.performQuery()),e},_getVMQueries:function(){var e=[];this.additionalModels=[];var n={};return r.addFilterCondition(n,t.EB.VIRTUAL_NIC.VM,r.createFilterCondition(t.NW_E_TYPES.VNIC,t.EB.VIRTUAL_NIC.VM,c.FILTER_OPERATORS.EQUALS,this.entityId)),this.entityModel=this._createQueryModel(t.NW_E_TYPES.VNIC,this._getAttribNamesToFetch(this.entityType),null,n),e.push(this.entityModel.performQuery()),this.additionalModels.push(this._createQueryModel(t.NW_E_TYPES.VIRTUAL_NETWORK,[t.EB.VIRTUAL_NETWORK.NAME],null,null)),e.push(this.additionalModels[0].performQuery()),e},_getBridgeQueries:function(){var e=[];return this.additionalModels=[],this.entityModel=this._createQueryModel(c.ENTITY_VIRTUAL_SWITCH,this._getAttribNamesToFetch(this.entityType),this.entityId,null),e.push(this.entityModel.performQuery()),e},_getBondQueries:function(){var e=[];return this.additionalModels=[],this.entityModel=this._createQueryModel(c.ENTITY_NIC_TEAM,this._getAttribNamesToFetch(this.entityType),this.entityId,null),e.push(this.entityModel.performQuery()),e},_getPNicQueries:function(){var e=[],n=this.entityId.split(c.GRAPH_DATA_SEPARATOR)[0],i=this.entityId.split(c.GRAPH_DATA_SEPARATOR)[1],s={};return this.additionalModels=[],r.addFilterCondition(s,t.EB.PNIC.NODE,r.createFilterCondition(t.NW_E_TYPES.PNIC,t.EB.PNIC.NODE,c.FILTER_OPERATORS.EQUALS,n)),this.entityModel=this._createQueryModel(t.NW_E_TYPES.PNIC,this._getAttribNamesToFetch(this.entityType),i,s),e.push(this.entityModel.performQuery()),e},_getSwitchInterfaceQueries:function(){var e=[],n=this.entityId.split(c.GRAPH_DATA_SEPARATOR)[0],i=this.entityId.split(c.GRAPH_DATA_SEPARATOR)[1],s={};return r.addFilterCondition(s,t.EB.SWITCH_INTERFACE.NETWORK_SWITCH,r.createFilterCondition(t.NW_E_TYPES.SWITCH_INTERFACE,t.EB.SWITCH_INTERFACE.NETWORK_SWITCH,c.FILTER_OPERATORS.EQUALS,n)),this.entityModel=this._createQueryModel(t.NW_E_TYPES.SWITCH_INTERFACE,this._getAttribNamesToFetch(this.entityType),i,s),e.push(this.entityModel.performQuery()),this.additionalModels=[],e},_getSwitchQueries:function(){var e=[],n=[].concat(this._getAttribNamesToFetch(this.entityType),[t.EB.NETWORK_SWITCH.VLANS_DISCOVERED]);return this.entityModel=this._createQueryModel(c.ENTITY_NETWORK_SWITCH,n,this.entityId,null),e.push(this.entityModel.performQuery()),this.additionalModels=[],e},_getAttribNamesToFetch:function(){var e=o.getNetworkEntityAttributes(this.entityType),t=[];return e&&(t=_.keys(e.attribs)),t},_getAttribsAndRender:function(e){var i,a,r=o.getNetworkEntityAttributes(this.entityType).attribs,d=this.$(".attribs-list");if(i=e&&this.entityModel&&this.entityModel.length?_.find(this.entityModel,function(n){return n.get(t.ID)===e}):this.entityModel[0],d.html(""),d.addClass("addBorder"),_.each(r,function(e,n){var o,r,p=!1;switch(this.entityType){case t.NW_E_TYPES.HOST:o=this.entityModel.get(n),n===t.EB.VIRTUAL_SWITCH.NAME?o=this.additionalModels&&this.additionalModels.length?s.pluckAttributeFromModels(this.additionalModels[0],n):[]:n===t.EB.PNIC.LINK_SPEED?o=this.additionalModels&&2===this.additionalModels.length?s.pluckAttributeFromModels(this.additionalModels[1],n):[]:n===t.SERVICE_VM_IP&&this.entityModel.isComputeOnly()&&(o=c.STATS_NOT_APPLICABLE);break;case t.NW_E_TYPES.CVM:case t.NW_E_TYPES.VM:if(o=i?i.get(n):"",n===t.NW_E_TYPES.VIRTUAL_NETWORK&&this.additionalModels.length){var u=this._getVirtualNetworkNameFromId(o);o=u||o,p=!o||o.length<=0}if(o&&n===t.EB.VIRTUAL_NETWORK.VLAN_ID){var m=this.model.getEntities(t.NW_E_TYPES.VLAN),f=_.find(m,function(e){return e.id===o});f&&(r="#"+f.colorHex)}break;case t.NW_E_TYPES.BRIDGE:case t.NW_E_TYPES.SWITCH_INTERFACE:if(o=this.entityModel.get(n),n===t.NW_E_TYPES.VIRTUAL_NETWORK&&this.additionalModels.length){var v=this._getVirtualNetworkNameFromId(o);o=v||o}n===t.EB.VIRTUAL_SWITCH.NAME&&(a=o),n===t.EB.SWITCH_INTERFACE.ALLOWED_VLAN_IDS&&(p=!o||o.length<=0);break;case t.NW_E_TYPES.SWITCH:o=this.entityModel.get(n),n===t.EB.NETWORK_SWITCH.VLAN_IDS&&"1"!==this.entityModel.get(t.EB.NETWORK_SWITCH.VLANS_DISCOVERED)&&(p=!0);break;case t.NW_E_TYPES.PNIC:o=this.entityModel.get(n),n===t.EB.PNIC.LINK_SPEED&&(o=o?o/l.KBPS_UNIT_RATIOS.mbps+"G":o),n!==t.EB.PNIC.DISCOVERY_PROTOCOL&&n!==t.EB.PNIC.SWITCH_NAME&&n!==t.EB.PNIC.SWITCH_PORT_NAME&&n!==t.EB.PNIC.SWITCH_MGMT_IP_ADD&&n!==t.EB.PNIC.SWITCH_PORT_N_VLAN||o||(p=!0);break;default:o=this.entityModel.get(n)}e.format&&(o=this._formatValue(n,o)),p||d.append(h({name:e.label,value:_.isUndefined(o)||_.isNull(o)?"":o.toString().replace(/,/g,", "),color:r}))},this),this.entityType===t.NW_E_TYPES.BRIDGE&&a===c.CVM_BRIDGE_VIR&&d.append(h({name:this.i18n("bridge_type_lbl"),value:this.i18n("internal_bridge_type"),color:null})),this.entityType===t.NW_E_TYPES.PNIC){var p=this.entityId?this.entityId.split(c.GRAPH_DATA_SEPARATOR)[0]:"",u=this.entityId?this.entityId.split(c.GRAPH_DATA_SEPARATOR)[1]:"",m=this.model.getRelatedTargets(n.RELATIONSHIPS.HOST2BOND,p),f=_.find(m,function(e){return _.contains(e[t.EB.NIC_TEAM.HOST_NICS],u)}),v=this.i18n("link_status_not_connected");if(f){var g=f[t.EB.NIC_TEAM.ACTIVE_HOST_NIC];v=this.i18n("link_status_connected")+c.NETWORK_VIZ_SEPARATOR;v+=g&&g.length&&_.contains(g,u)?this.i18n("link_status_active"):this.i18n("link_status_passive")}d.append(h({name:this.i18n("link_status_lbl"),value:v,color:null}))}e||this.entityType!==t.NW_E_TYPES.CVM&&this.entityType!==t.NW_E_TYPES.VM||this._styleVMNics()},_getVirtualNetworkNameFromId:function(e){var n;if(this.additionalModels&&this.additionalModels.length){var i=_.find(this.additionalModels[0],function(n){return n.get(t.ID)===e});i&&(n=i.get(t.VLAN_NAME))}return n},_styleVMNics:function(){var e,n=[];e=this.$(".attribs-header"),_.each(this.entityModel,function(e,i){n.push({id:e.get(t.ID),name:"VM NIC "+(i+1),selected:0===i?"selected":""}),0===i&&(this.selectedChartEntity={entityId:e.get(t.ID),entityType:t.NW_E_TYPES.VNIC,view:null})},this),e.prepend(m({options:n})),this.applyNutanixInput({types:["select"]})},_formatValue:function(e,n){var i=n;switch(e){case t.EB.PNIC.LINK_SPEED:i=l.formatBandwidth(n)}return i},renderCharts:function(){var e=this.$(".charts-container");if(e.html(""),_.contains(v,this.entityType)){var n,i,s=this.entityId,a=this.entityType;switch(this.entityType){case t.NW_E_TYPES.PNIC:i=t.NW_E_TYPES.HOST;break;case t.NW_E_TYPES.SWITCH_INTERFACE:i=t.NW_E_TYPES.SWITCH;break;case t.NW_E_TYPES.CVM:case t.NW_E_TYPES.VM:i=t.NW_E_TYPES.VM,a=t.NW_E_TYPES.VNIC}if(a!==t.NW_E_TYPES.PNIC&&a!==t.NW_E_TYPES.SWITCH_INTERFACE||(n=this.entityId.split(c.GRAPH_DATA_SEPARATOR)[0],s=this.entityId.split(c.GRAPH_DATA_SEPARATOR)[1]),a===t.NW_E_TYPES.VNIC){if(n=this.entityId,!this.selectedChartEntity||!this.selectedChartEntity.entityId)return;s=this.selectedChartEntity.entityId}var r=new u({entityId:s,entityType:t.NW_E_TYPES_TO_ENTITY_TYPES[a],entityParentType:t.NW_E_TYPES_TO_ENTITY_TYPES[i],entityParentId:n,metrics:o.getNetworkEntityMetrics(a)});e.append(r.render().el),this.selectedChartEntity={entityType:a,entityId:s,view:r},r.startServices()}},_clearPalette:function(){this.$(".charts-container").html(""),this.$(".attribs-list").html("").removeClass("addBorder"),this.$(".attribs-header").html("")},checkForUnknownEntity:function(){var e=!1;if(this.entityType===t.NW_E_TYPES.SWITCH||this.entityType===t.NW_E_TYPES.SWITCH_INTERFACE){var n,i;n=this.entityType===t.NW_E_TYPES.SWITCH?this.entityId.split(c.GRAPH_DATA_SEPARATOR)[0]:this.entityId.split(c.GRAPH_DATA_SEPARATOR)[1],i=this.entityType===t.NW_E_TYPES.SWITCH?T:E,(this.entityId<0||n<0)&&(this._clearPalette(),this.$(".attribs-header").html(f({error:i})),e=!0)}return e},onSelectVmNic:function(e){var t,n=$(e.currentTarget);this.$(".side-panel").length?(this.$(".side-row").removeClass("selected"),n.addClass("selected"),t=n.attr("data-id")):t=n.val(),this._getAttribsAndRender(t),this.selectedChartEntity&&this.selectedChartEntity.view&&this.selectedChartEntity.view.stopServices(),this.selectedChartEntity={entityId:t},this.renderCharts()}})}),define("text!templates/popups/network/NetworkEntitiesBasePopupView.html",[],function(){return'\x3c!-- The parent div modal is #popupNetworkEntitiesBase --\x3e\n<div class="modal-header">\n  <button type="button" class="close" data-dismiss="modal">\n    <i data-icon="K" aria-hidden="true"></i>\n  </button>\n  <h4 class="n-title"><%= name %></h4>\n</div>\n<div class="n-modal-wrapper">\n  <div class="n-modal-body">\n    <div class="n-modal-content-wrapper">\n      <div class="n-modal-alert-header">\n        \x3c!-- @view: alert goes here... --\x3e\n      </div>\n      <div class="n-modal-content">\n        <div class="left-pane">\n          <div class="viz-container">\n            \x3c!-- The diagram goes here... --\x3e\n          </div>\n        </div>\n        <div class="right-pane">\n          <div class="details-container">\n            <div class="attribs-container">\n              <div class="attribs-header"></div>\n              <table class="attribs-list table"></table>\n            </div>\n            <div class="charts-container">\n              \x3c!-- The charts go here... --\x3e\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n  <div class="n-modal-footer">\n    <button class="btnClose btn -default">\n      <%= i18n(\'close\') %>\n    </button>\n    <% if (details) { %>\n    <button class="btnDetails btn btnOK">\n      <%= detailsButton %>\n    </button>\n    <% } %>\n  </div>\n</div>'}),define("views/popups/network/NetworkEntitiesBasePopupView",["views/basecomponents/popups/BasePopupView","managers/NavigationManager","utils/SubViewHelper","views/pages/network/entities/HostVizSubView","views/pages/network/entities/HostEntityDetailsSubView","utils/AppConstants","utils/AppUtil","data/DataProperties","models/network/viz/NetworkVizBaseModel","text!templates/popups/network/NetworkEntitiesBasePopupView.html"],function(e,t,n,i,s,a,o,r,l,c){"use strict";var d=_.template(c);return e.extend({el:"#popupNetworkEntitiesBase",entityId:null,entityType:null,entityName:null,parentId:null,contextId:null,metrics:null,subViewHelper:null,name:"NetworkEntitiesBasePopupView",events:{"click .modal-header .close":"hide","click .btnClose":"hide","click .btnDetails":"onClickEntityDetails"},initialize:function(t){e.prototype.initialize.apply(this,arguments),this.model=l.getInstance(),this.subViewHelper||(this.subViewHelper=new n)},render:function(){this._initOptions(),this.$el.html(d(this.vtOptions({name:this.getEntityTypeText()+" "+this.entityName,details:this.showDetailsBtn(),detailsButton:this.i18ns("go_to_button",this._getDetailsButton())}))),this.renderHostNetworkViz(),this.renderDetails()},show:function(){e.prototype.show.apply(this,arguments);var t=this.subViewHelper.get("hostVizSubView");t&&t.renderViz()},showDetailsBtn:function(){return this.entityType!==r.NW_E_TYPES.SWITCH_INTERFACE},getEntityTypeText:function(){var e;switch(this.entityType){case r.NW_E_TYPES.HOST:e=this.i18n("CommonEntities.host");break;case r.NW_E_TYPES.CVM:case r.NW_E_TYPES.VM:e=this.i18n("CommonEntities.vm");break;case r.NW_E_TYPES.SWITCH_INTERFACE:e=this.i18n("CommonEntities.switch_port");break;case r.NW_E_TYPES.SWITCH:e=this.i18n("CommonEntities.switch");break;default:e=""}return e},_initOptions:function(){this.entityId=this.actionRoute[a.NAV_ACTION_TARGET_ID],this.entityType=this.actionRoute[a.NAV_ACTION_TARGET],this.entityName=this.actionRoute[a.NAV_ACTION_TARGET_NAME],this.parentId=this.actionRoute[a.NAV_ACTION_PARENT_ID],this.contextId=this.actionRoute[a.NAV_ACTION_CONTEXT_ID]},renderHostNetworkViz:function(){var e=new i({el:this.$(".viz-container"),model:this.model,hostid:this.entityId});this.subViewHelper.register("hostVizSubView",e),e.onStartServices(),e.render()},renderDetails:function(){var e=new s({el:this.$(".details-container"),model:this.model});this.subViewHelper.register("hostEntityDetailsSubView",e),e.onStartServices(),e.render();var t=this.parentId?this.parentId+a.GRAPH_DATA_SEPARATOR+this.entityId:this.entityId;this.model.setEntitySelection(this.entityType,t)},_getDetailsButton:function(){switch(this.entityType){case r.NW_E_TYPES.HOST:return this.i18n("CommonEntities.host");case r.NW_E_TYPES.VM:return this.i18n("CommonEntities.vm");case r.NW_E_TYPES.SWITCH:return this.i18n("CommonEntities.switch");default:return""}},onClickEntityDetails:function(e){var n,i,s,l;switch(this.entityType){case r.NW_E_TYPES.VM:n=a.PAGE_VMS,i=a.SUBPAGE_TABLE,l=a.ENTITY_VM;break;case r.NW_E_TYPES.HOST:n=a.PAGE_HARDWARE,i=a.SUBPAGE_TABLE,l=a.ENTITY_HOST;break;case r.NW_E_TYPES.SWITCH:n=a.PAGE_HARDWARE,i=a.SUBPAGE_TABLE,l=a.ENTITY_SWITCH;break;default:l=this.entityType}s={action:"details",actionTarget:l,actionTargetId:this.contextId?this.contextId:this.entityId},n&&i&&(t.navigateToPageRouteObject({pageId:n,subPageId:i,options:o.formatObjectToQuery(s,!0)}),t.clearNavigationContext(this.contextId)),this.hide()},destroy:function(){this.model=null,this.subViewHelper&&(this.subViewHelper.iterate("stopServices"),this.subViewHelper.removeAll()),this.subViewHelper=null,e.prototype.destroy.apply(this,arguments)}})}),define("text!templates/popups/network/NetworkEntityPopupView.html",[],function(){return'\x3c!-- The parent div modal is #popupNetworkEntities --\x3e\n<div class="modal-header">\n  <button type="button" class="close" data-dismiss="modal">\n    <i data-icon="K" aria-hidden="true"></i>\n  </button>\n  <h4 class="n-title"><%= name %></h4>\n</div>\n<div class="n-modal-wrapper">\n  <div class="n-modal-body">\n    <div class="n-modal-content-wrapper">\n      <div class="n-modal-alert-header">\n        \x3c!-- @view: alert goes here... --\x3e\n      </div>\n      <div class="n-modal-content">\n        <div class="details-container">\n          <div class="attribs-container">\n            <div class="attribs-header"></div>\n            <table class="attribs-list table"></table>\n          </div>\n          <div class="charts-container"></div>\n        </div>\n      </div>\n    </div>\n  </div>\n  <div class="n-modal-footer">\n    <button class="btnClose btn -default">\n      Close\n    </button>\n    <% if (details) { %>\n        <button class="btnDetails btn btnOK">\n          <%= detailsButton %>\n        </button>\n      <% } %>\n  </div>\n</div>'}),define("views/popups/network/NetworkEntityPopupView",["views/popups/network/NetworkEntitiesBasePopupView","text!templates/popups/network/NetworkEntityPopupView.html"],function(e,t){"use strict";var n=_.template(t);return e.extend({el:"#popupNetworkEntities",render:function(){this._initOptions(),this.$el.html(n({name:this.getEntityTypeText()+" "+this.entityName,details:this.showDetailsBtn(),detailsButton:this.i18ns("go_to_button",this._getDetailsButton())})),this.renderDetails()}})}),define("models/networkswitch/NetworkSwitchConfigModel",["models/BaseModel","data/DataURLConstants","utils/AppConstants"],function(e,t,n){"use strict";return e.extend({urlRoot:t.NETWORK_SWITCH,entityType:n.ENTITY_NETWORK_SWITCH,name:"NetworkSwitchConfigModel"})}),define("models/networkswitch/SnmpProfileModel",["models/BaseModel","data/DataURLConstants","utils/AppConstants"],function(e,t,n){"use strict";return e.extend({urlRoot:t.NETWORK_SWITCH_SNMP_PROFILE,entityType:n.ENTITY_SNMP_PROFILE,name:"SnmpProfileModel"})}),define("models/networkswitch/NetworkSwitchModel",["models/BaseModel","data/DataProperties","models/networkswitch/NetworkSwitchConfigModel","models/networkswitch/SnmpProfileModel","data/DataURLConstants","utils/AppUtil","utils/SubModelHelper","utils/AppConstants"],function(e,t,n,i,s,a,o,r){"use strict";return e.extend({urlRoot:s.NETWORK_SWITCH_CONFIG,entityType:r.ENTITY_NETWORK_SWITCH,name:"NetworkSwitchModel",subModelHelper:null,initialize:function(t){e.prototype.initialize.apply(this,arguments);var s=new n,a=new i;this.subModelHelper=new o,this.subModelHelper.register(r.NETWORK_SWITCH_CONFIG_VIEWS.SWITCH_CONFIG,s),this.subModelHelper.register(r.NETWORK_SWITCH_CONFIG_VIEWS.SNMP_PROFILE,a),_.bindAll(this,"_onErrorSubModel","_onSyncSubModel"),this.subModelHelper.attachEventHandler("sync",this._onSyncSubModel),this.subModelHelper.attachEventHandler("error",this._onErrorSubModel)},_onErrorSubModel:function(e,t,n){var i="";_.isString(t)?i=t:_.isObject(t)&&t.responseText&&(i=a.processAjaxError(t.responseText)),this.trigger("error",i)},_onSyncSubModel:function(){this.fetch({alwaysTriggerChange:!0})},saveSwitchConfig:function(e,n,i){var s=this.subModelHelper.get(r.NETWORK_SWITCH_CONFIG_VIEWS.SWITCH_CONFIG);n?(e[t.SWITCH_ID]=null,s.actionMode=r.ACTION_CREATE):s.actionMode=r.ACTION_UPDATE,s.isNew(n),s.save(e,i)},deleteSwitchConfig:function(e){var t=this.subModelHelper.get(r.NETWORK_SWITCH_CONFIG_VIEWS.SWITCH_CONFIG);t.isNew(!1),t.id=e.id,t.destroy()},saveSnmpProfile:function(e,n,i){var s=this.subModelHelper.get(r.NETWORK_SWITCH_CONFIG_VIEWS.SNMP_PROFILE);n?(e[t.SWITCH_SNMP_UUID]=null,s.actionMode=r.ACTION_CREATE):s.actionMode=r.ACTION_UPDATE,s.isNew(n),s.save(e,i)},deleteSnmpProfile:function(e){var t=this.subModelHelper.get(r.NETWORK_SWITCH_CONFIG_VIEWS.SNMP_PROFILE);t.isNew(!1),t.id=e.uuid,t.destroy()},destroy:function(){this.subModelHelper.destroy(),this.subModelHelper=null,e.prototype.initialize.destroy(this,arguments)}})}),define("models/networkswitch/NetworkSwitchConfigCollection",["models/BaseCollection","data/DataURLConstants","models/networkswitch/NetworkSwitchConfigModel"],function(e,t,n){"use strict";return e.extend({url:t.NETWORK_SWITCH,model:n,
name:"NetworkSwitchConfigCollection"})}),define("models/networkswitch/SnmpProfileCollection",["models/BaseCollection","data/DataURLConstants","models/networkswitch/SnmpProfileModel"],function(e,t,n){"use strict";return e.extend({url:t.NETWORK_SWITCH_SNMP_PROFILE,model:n,name:"SnmpProfileCollection"})}),define("text!templates/popups/networkswitch/NetworkSwitchConfigContentView.html",[],function(){return'\x3c!-- The parent div modal is #popupNetworkSwitchConfig --\x3e\n\n\x3c!-- Tab Content: Switch Config --\x3e\n<div data-ntnx-content-inner class="tab-pane tab-pane-switch_config">\n  \x3c!-- Content goes here--\x3e\n</div>\n\n\x3c!-- Tab Content: SNMP Profiles --\x3e\n<div data-ntnx-content-inner class="tab-pane tab-pane-snmp_profile">\n  \x3c!-- Content goes here--\x3e\n</div>\n\n\x3c!--  Form Container --\x3e\n<div data-ntnx-content-inner class="form-container">\n  \x3c!-- Forms go here--\x3e\n</div>\n'}),define("text!templates/popups/networkswitch/SwitchConfigContentView.html",[],function(){return'\x3c!-- (Network Switch Config) Switch Configuration Content --\x3e\n<div class="list-switch_config">\n\n  <% if (canModify) { %>\n    <section data-ntnx-section="type-text" class="description-switch_config">\n      Configure one or more network switches for stats collection.\n    </section>\n\n    \x3c!-- Create Network Switch Config --\x3e\n    <section data-ntnx-section>\n      <%= Components.button({\n        extraClasses        : \'btnCreate formControl\',\n        extraAttr           : [{\n          key: \'data-target\',\n          value: \'switch_config\'\n        }],\n        text                : \'Add Switch Configuration\',\n        iconLeft            : \'plus\'\n      }) %>\n    </section>\n  <% } %>\n\n  \x3c!-- List of Switch Configs --\x3e\n  <% if (list && list.length) { %>\n\n    <section data-ntnx-section>\n      <table id="switchConfigList"\n             class="table table-hover table-switch_config">\n        <thead>\n        <tr>\n          <th class="switchIP">Switch IP</th>\n          <th class="hostIPs">Host IPs</th>\n          <th>&nbsp;</th>\n        </tr>\n        </thead>\n        <tbody>\n        <% _.each(list, function(dir, idx) {\n             var hostAddresses = dir.toJSON().hostAddresses || \'\';\n             if (hostAddresses) {\n               hostAddresses = hostAddresses.join(\', \');\n             }\n        %>\n        <tr dataid="<%= idx %>" class="n-table-row">\n          <td class="dirName"><%= dir.toJSON().address || \'\' %></td>\n          <td><%= hostAddresses %></td>\n          <td class="cell-actions">\n            <% if (canModify) { %>\n            <i class="btnEdit" data-icon="F"\n               aria-hidden="true">\n            </i>\n            <span class="action-separator">&middot;</span>\n            <i class="btnDelete" data-icon="v"\n               aria-hidden="true">\n            </i>\n            <% } %>\n          </td>\n        </tr>\n        <% }); %>\n        </tbody>\n      </table>\n    </section>\n\n  <% } else { %>\n\n    \x3c!-- Empty list --\x3e\n    <section data-ntnx-section="type-text" class="n-message">\n      No Switch Configuration Found.\n    </section>\n\n  <% } %>\n\n</div>'}),define("text!templates/popups/networkswitch/SwitchConfigFormView.html",[],function(){return'\x3c!-- (Network Switch Config) Switch Configuration Form --\x3e\n<form id="networkSwitchAddForm">\n  <input type="hidden" class="dataId" value="<%= dataId || \'\' %>">\n\n  <section data-ntnx-section>\n    <label data-ntnx-label>Switch management IP address</label>\n    <input type="text" class="address" value="<%= model.address || \'\' %>"\n    <%= model.address && isEdit ? \'disabled\' : \'\' %>>\n  </section>\n\n  <section data-ntnx-section>\n    <label data-ntnx-label>\n      Host IP addresses or Host names (separated by commas)\n    </label>\n    <input type="text" class="hostAddresses"\n           value="<%= model.hostAddresses || \'\' %>">\n  </section>\n\n  <section data-ntnx-section>\n    <label data-ntnx-label>SNMP Profile</label>\n    <%= Components.select({\n      options: snmpProfileList,\n      jsClasses: \'snmpProfileNameToApply\'\n    }) %>\n  </section>\n\n  <section data-ntnx-section>\n    <label data-ntnx-label>SNMP version</label>\n    <%= Components.select({\n      options: versions,\n      jsClasses: \'version\'\n    }) %>\n  </section>\n\n  <section data-ntnx-section class="hide">\n    <label data-ntnx-label>SNMP Security Level</label>\n    <%= Components.select({\n      options: securityLevels,\n      jsClasses: \'securityLevel\'\n    }) %>\n  </section>\n\n\n  <div class="clearfix">\n\n    <section data-ntnx-section="type-half">\n      <label data-ntnx-label>SNMP community name</label>\n      <input type="text" class="community"\n             value="<%= model.community || \'\' %>">\n    </section>\n\n    <section data-ntnx-section="type-half">\n      <label data-ntnx-label>SNMP username</label>\n      <input type="text" class="username"\n             value="<%= model.username || \'\' %>">\n    </section>\n\n    <section data-ntnx-section="type-half">\n      <label data-ntnx-label>SNMP authentication type</label>\n      <%= Components.select({\n        options: authTypes,\n        jsClasses: \'authType\'\n      }) %>\n    </section>\n\n    <section data-ntnx-section="type-half">\n      <label data-ntnx-label>SNMP authentication pass phrase</label>\n      <input type="password" class="authKey" autocomplete="off"\n             value="<%= model.authKey || \'\' %>">\n    </section>\n\n    <section data-ntnx-section="type-half">\n      <label data-ntnx-label>SNMP privacy type</label>\n      <%= Components.select({\n        variants: \'bottom-anchor\',\n        options: privTypes,\n        jsClasses: \'privType\'\n      }) %>\n    </section>\n\n    <section data-ntnx-section="type-half">\n      <label data-ntnx-label>SNMP privacy pass phrase</label>\n      <input type="password" class="privKey" autocomplete="off"\n             value="<%= model.privKey || \'\' %>">\n    </section>\n\n  </div>\n</form>'}),define("text!templates/popups/networkswitch/SNMPContentView.html",[],function(){return'\x3c!-- (Network Switch Config) SNMP Profile Content --\x3e\n<section data-ntnx-section="type-text"\n         class="description description-snmp_profile">\n  Configure one or more SNMP Profiles which can be used in the\n  switch configuration for SNMP credentials.\n</section>\n\n\x3c!-- Create SNMP Profile --\x3e\n<% if (canModify) { %>\n  <section data-ntnx-section>\n    <%= Components.button({\n      extraClasses        : \'btnCreate formControl\',\n      extraAttr           : [{\n        key: \'data-target\',\n        value: \'snmp_profile\'\n      }],\n      text                : \'Add SNMP profile\',\n      iconLeft            : \'plus\'\n    }) %>\n  </section>\n<% } %>\n\n\x3c!-- List of SNMP Profiles --\x3e\n<% if (list && list.length) { %>\n\n  <section data-ntnx-section>\n    <table id="snmpProfileList"\n           class="table table-hover table-snmp_profile">\n      <thead>\n      <tr>\n        <th class="profileName">Profile Name</th>\n        <th class="snmpVersion">SNMP Version</th>\n        <th class="communityName">Community Name</th>\n        <th>&nbsp;</th>\n      </tr>\n      </thead>\n      <tbody>\n      <% _.each(list, function(dir, idx) { %>\n      <tr dataid="<%= idx %>" class="n-table-row">\n        <td><%= dir.toJSON().name || \'\' %></td>\n        <td><%= dir.toJSON().version || \'\' %></td>\n        <td><%= dir.toJSON().community || \'\' %></td>\n        <td class="cell-actions">\n          <% if (canModify) { %>\n          <i class="btnEdit" data-icon="F"\n             aria-hidden="true">\n          </i>\n          <span class="action-separator">&middot;</span>\n          <i class="btnDelete" data-icon="v"\n             aria-hidden="true">\n          </i>\n          <% } %>\n        </td>\n      </tr>\n      <% }); %>\n      </tbody>\n    </table>\n  </section>\n\n<% } else { %>\n\n  \x3c!-- Empty list --\x3e\n  <section data-ntnx-section="type-text" class="n-message">\n    No SNMP Profile Found.\n  </section>\n\n<% } %>'}),define("text!templates/popups/networkswitch/SNMPFormView.html",[],function(){return'\x3c!-- (Network Switch Config) SNMP Profile Form --\x3e\n<form id="snmpProfileAddForm">\n  <input type="hidden" class="dataId" value="<%= dataId || \'\' %>">\n\n  <section data-ntnx-section>\n    <label data-ntnx-label>Profile Name</label>\n    <input type="text" class="name" value="<%= model.name\n     || \'\' %>" <%= model.name ? \'disabled\' : \'\' %>>\n  </section>\n\n  <section data-ntnx-section>\n    <label data-ntnx-label>SNMP version</label>\n    <%= Components.select({\n      options: versions,\n      jsClasses: \'version\'\n    }) %>\n  </section>\n\n  <section data-ntnx-section class="hide">\n    <label data-ntnx-label>SNMP Security Level</label>\n    <%= Components.select({\n      options: securityLevels,\n      jsClasses: \'securityLevel\'\n    }) %>\n  </section>\n\n  <div class="clearfix">\n\n    <section data-ntnx-section="type-half">\n      <label data-ntnx-label>SNMP community\n        name</label>\n      <input type="text" class="community" value="<%= model.community || \'\' %>">\n    </section>\n\n    <section data-ntnx-section="type-half">\n      <label data-ntnx-label>SNMP username</label>\n      <input type="text" class="username" value="<%= model.username || \'\' %>">\n    </section>\n\n\n    <section data-ntnx-section="type-half">\n      <label data-ntnx-label>SNMP authentication type</label>\n      <%= Components.select({\n        options: authTypes,\n        jsClasses: \'authType\'\n      }) %>\n    </section>\n\n    <section data-ntnx-section="type-half">\n      <label data-ntnx-label>SNMP authentication pass phrase</label>\n      <input type="password" class="authKey" autocomplete="off"\n             value="<%= model.authKey || \'\' %>">\n    </section>\n\n\n    <section data-ntnx-section="type-half">\n      <label data-ntnx-label>SNMP privacy type</label>\n      <%= Components.select({\n        variants: \'bottom-anchor\',\n        options: privTypes,\n        jsClasses: \'privType\'\n      }) %>\n    </section>\n\n    <section data-ntnx-section="type-half">\n      <label data-ntnx-label>SNMP privacy pass phrase</label>\n      <input type="password" class="privKey" autocomplete="off"\n             value="<%= model.privKey || \'\' %>">\n    </section>\n\n  </div>\n\n</form>'}),define("views/popups/networkswitch/NetworkSwitchConfigPopupView",["views/basecomponents/popups/BasePopupView","data/DataProperties","utils/AppConstants","utils/AppUtil","utils/DataExportUtil","utils/HypervisorUtil","models/networkswitch/NetworkSwitchModel","models/networkswitch/NetworkSwitchConfigCollection","models/networkswitch/SnmpProfileCollection","managers/ClusterManager","text!templates/popups/networkswitch/NetworkSwitchConfigContentView.html","text!templates/popups/networkswitch/SwitchConfigContentView.html","text!templates/popups/networkswitch/SwitchConfigFormView.html","text!templates/popups/networkswitch/SNMPContentView.html","text!templates/popups/networkswitch/SNMPFormView.html"],function(e,t,n,i,s,a,o,r,l,c,d,p,u,h,m){"use strict";d=_.template(d),p=_.template(p),u=_.template(u),h=_.template(h),m=_.template(m);var f={INPUT:"input",SELECT:"select"},v={SWITCH_CONFIG:[{name:t.SWITCH_ADDRESS,type:f.INPUT},{name:t.SWITCH_HOST_ADDRESSES,type:f.INPUT},{name:t.SWITCH_SNMP_PROFILE_NAME_TO_APPLY,type:f.SELECT},{name:t.SWITCH_SNMP_VERSION,type:f.SELECT},{name:t.SWITCH_SNMP_SECURITY_LEVEL,type:f.SELECT},{name:t.SWITCH_SNMP_COMMUNITY_NAME,type:f.INPUT},{name:t.SWITCH_SNMP_AUTH_TYPE,type:f.SELECT},{name:t.SWITCH_SNMP_PRIVACY_TYPE,type:f.SELECT},{name:t.SWITCH_SNMP_USERNAME,type:f.INPUT},{name:t.SWITCH_SNMP_AUTH_KEY,type:f.INPUT},{name:t.SWITCH_SNMP_PRIVACY_KEY,type:f.INPUT}],SNMP_PROFILE:[{name:t.SWITCH_SNMP_NAME,type:f.INPUT},{name:t.SWITCH_SNMP_VERSION,type:f.SELECT},{name:t.SWITCH_SNMP_SECURITY_LEVEL,type:f.SELECT},{name:t.SWITCH_SNMP_COMMUNITY_NAME,type:f.INPUT},{name:t.SWITCH_SNMP_AUTH_TYPE,type:f.SELECT},{name:t.SWITCH_SNMP_PRIVACY_TYPE,type:f.SELECT},{name:t.SWITCH_SNMP_USERNAME,type:f.INPUT},{name:t.SWITCH_SNMP_AUTH_KEY,type:f.INPUT},{name:t.SWITCH_SNMP_PRIVACY_KEY,type:f.INPUT}]},g=_.template('Please enter a <%= isEmpty ? "" : "valid" %> switch management IP address.'),E=_.template("'<%- invalidAddress %>' is not a valid IP address or host name.");return e.extend({el:"#popupNetworkSwitchConfig",name:"NetworkSwitchConfigPopupView",selectedTab:n.NETWORK_SWITCH_CONFIG_VIEWS.SWITCH_CONFIG,tabs:{switch:n.NETWORK_SWITCH_CONFIG_VIEWS.SWITCH_CONFIG,snmp:n.NETWORK_SWITCH_CONFIG_VIEWS.SNMP_PROFILE},backClicked:!1,events:{"click  .btnCreate":"onClickCreate","click  .btnEdit":"onClickEdit","click  .btnBack":"onClickBack","click  .btnSave":"onClickSave","click  .n-modal-tab-header button":"onTabClick","click  .table .btnDelete":"onClickDelete","change .version ":"onChangeSNMPVersion","change .securityLevel ":"onChangeSecurityLevel","change .snmpProfileNameToApply ":"onChangeSnmpProfileName"},modelEvents:{"change  model":"onModelChange","error   model":"onModelError"},initialize:function(){e.prototype.initialize.apply(this,arguments),this.model=new o,this.networkSwitchConfigCollection=new r,this.snmpProfileCollection=new l,this.selectedSnmpProfile={},this.networkSwitchConfigCollection.on("reset",this.updateContent,this),this.snmpProfileCollection.on("reset",this.updateContent,this)},render:function(){var e=this;this.canModify=this.canModifyByEntityType(n.ENTITY_NETWORK_SWITCH),this.tabsList=[{isActive:this.selectedTab===this.tabs.switch,text:"Switch Configuration",extraClasses:"tab-"+this.tabs.switch,extraAttr:[{key:"data-target",value:this.tabs.switch}]},{isActive:this.selectedTab===this.tabs.snmp,text:"SNMP Profile",extraClasses:"tab-"+this.tabs.snmp,extraAttr:[{key:"data-target",value:this.tabs.snmp}]}],this.footerButtons=[{text:this.i18n("cancel"),extraClasses:"btnBack btnForm n-btn-form hide",iconLeft:"caret-left",leftAligned:!0}],this.canModify&&this.footerButtons.push({isPrimary:!0,text:this.i18n("save"),extraClasses:"btnSave btnForm n-btn-form hide",extraAttr:[{key:"data-loading-text",value:"Saving..."}]}),this.$el.html(this.defaultTemplate({title:"Network Switch Configuration",tabs:!0,tabsList:this.defaultTabs(this.tabsList),bodyContent:d({canModify:this.canModify}),footerButtons:this.defaultFooter(this.footerButtons)})),this.triggerAction(n.MODAL.ACT.ALERT_SHOW,{type:n.MODAL.ALERT.TYPE_LOADING}),this.model.fetch({silent:!0,success:function(){e.updateContent(),e.showSubview(e.$(".tab-pane-"+e.selectedTab),"left"),a.hasKVM(c.getCurrentClusterId())?e.triggerAction(n.MODAL.ACT.ALERT_HIDE):e.triggerAction(n.MODAL.ACT.ALERT_SHOW,{type:n.MODAL.ALERT.TYPE_WARNING,message:e.i18n("ahv_hvpervisor_support"),closeTiming:n.MODAL.ALERT.CLOSE_TYPE_PERMANENT})},error:function(t,i){e.triggerAction(n.MODAL.ACT.ALERT_SHOW,{type:n.MODAL.ALERT.TYPE_ERROR,message:i.responseText})}})},updateContent:function(){var e=p(this.vtOptions({canModify:this.canModify,list:this.networkSwitchConfigCollection.models})),t=h(this.vtOptions({canModify:this.canModify,list:this.snmpProfileCollection.models}));this.$(".tab-pane-"+this.tabs.switch).html(e),this.$(".tab-pane-"+this.tabs.snmp).html(t),this.triggerAction(n.MODAL.ACT.AS_REBUILD)},destroy:function(){this.networkSwitchConfigCollection.off("reset",this.updateContent,this),this.snmpProfileCollection.off("reset",this.updateContent,this),e.prototype.destroy.apply(this,arguments)},show:function(t){e.prototype.show.apply(this,arguments),this.fetchModel()},showForm:function(e,t){var s=void 0;this.newModel=t||this.getData(e)||{};var a=void 0!==e,o=_.map(this.snmpProfileCollection.models,function(e,t){return e=e.toJSON().name,{name:e,value:e,selected:this.newModel.snmpProfileNameToApply===e}},this);if(o.unshift({name:"None",value:"none"}),this.selectedTab===this.tabs.switch)s=u;else{if(this.selectedTab!==this.tabs.snmp)return void i.debug("Unknown form selected - NetworkSwitchConfig popup");s=m}this.triggerAction(n.MODAL.ACT.ALERT_HIDE),this.$(".form-container").html(s(this.vtOptions({dataId:e,model:this.newModel,isEdit:a,snmpProfileList:o,versions:this._mapDataForSelect("SNMP_VERSIONS","version"),securityLevels:this._mapDataForSelect("SNMP_SECURITY_LEVELS","securityLevel"),authTypes:this._mapDataForSelect("SNMP_AUTH_TYPES","authType",!0),privTypes:this._mapDataForSelect("SNMP_PRIVACY_TYPES","privType",!0)}))),this.toggleFormListElements(!0),this.applyNutanixInput()},_mapDataForSelect:function(e,t,i){var s=_.map(n[e],function(e,i){return{name:n.SNMP_ENTITY_NAMES[e],value:e,selected:this.newModel[t]===e}},this);return i&&s.unshift({name:"None",value:"none"}),s},getData:function(e,t){var n=void 0;switch(t||this.selectedTab){case this.tabs.switch:n=i.isBlank(e)?null:this.networkSwitchConfigCollection.models[e].toJSON();break;case this.tabs.snmp:n=i.isBlank(e)?null:this.snmpProfileCollection.models[e].toJSON()}return n},onModelChange:function(e,t,i){this.triggerAction(n.MODAL.ACT.COVER_HIDE),this.toggleShow(".n-inline-loading",!1),this.enableSaveControls(),this.enableFormControls(!0),this.fetchModel()},onModelError:function(e,t,i){this.triggerAction(n.MODAL.ACT.COVER_HIDE),this.toggleShow(".n-inline-loading",!1),this.enableSaveControls(),this.enableFormControls(),this.triggerAction(n.MODAL.ACT.ALERT_SHOW,{type:n.MODAL.ALERT.TYPE_ERROR,message:_.isString(e)?e:t&&t.responseText})},enableFormControls:function(){this.$(".formControl").removeAttr("disabled")},toggleShow:function(e,t){t?$(e).show():$(e).hide()},enableSaveControls:function(){this.$(".btnSave").button("reset")},disableSaveControls:function(){this.$(".btnSave").button("loading")},toggleTabs:function(e){this.hideSubview(this.$(".tab-pane-"+this.selectedTab)),this.showSubview(this.$(".tab-pane-"+e),e===this.tabs.switch?"right":"left"),this.selectedTab=e},toggleFormListElements:function(e){this.toggleShow(".btnList",!e),this.toggleShow(".btnForm",e),this.triggerAction(n.MODAL.ACT["TABS_"+(e?"HIDE":"SHOW")]),this[(e?"hide":"show")+"Subview"](".tab-pane-"+this.selectedTab,"right"),this[(e?"show":"hide")+"Subview"](".form-container","left")},showMessageForLegacyBrowser:function(){i.isIE9OrBelow()&&this.triggerAction(n.MODAL.ACT.ALERT_SHOW,{type:n.MODAL.ALERT.TYPE_INFO,message:"You are using a version of Internet Explorer that requires a manual refresh."})},fetchModel:function(){var e=this;$.when.apply($,[this.networkSwitchConfigCollection.fetch({data:{configOnly:!0}}),this.snmpProfileCollection.fetch()]).done(function(){e.updateContent()}).fail(function(){e.onModelError()})},saveSwitchConfig:function(){var e=this;this.triggerAction(n.MODAL.ACT.ALERT_HIDE);var t=this.validateSwitchConfig();if(!0!==t)return this.triggerAction(n.MODAL.ACT.ALERT_SHOW,{type:n.MODAL.ALERT.TYPE_ERROR,message:t}),void this.enableSaveControls();var i=this._getCurrentFormElement(),s=_.isEmpty(i.find(".dataId").val());this.model.saveSwitchConfig(this.postprocessSwitchDirtyModel(this.postProcessDirtyModelForAuthPrivType(this.getDirtyModel(v.SWITCH_CONFIG,this.tabs.switch))),s,{success:function(){e._goBackToList(),e.onModelChange()}})},saveSnmpProfile:function(){var e=this,t=this._getCurrentFormElement(),n=_.isEmpty(t.find(".dataId").val());this.model.saveSnmpProfile(this.postProcessDirtyModelForAuthPrivType(this.getDirtyModel(v.SNMP_PROFILE,this.tabs.snmp)),n,{success:function(){e._goBackToList(),e.onModelChange()}})},validateSwitchConfig:function(){var e=$("#networkSwitchAddForm"),n=e.find("."+t.SWITCH_ADDRESS).val().trim();if(!i.isValidIP(n))return g({isEmpty:0===n.length});var s="input."+t.SWITCH_HOST_ADDRESSES,a=e.find(s).val().trim();if(a.length)for(var o=a.split(","),r=0;r<o.length;r++)if(!i.isValidIP(o[r])&&!i.isValidHostname(o[r]))return E({invalidAddress:o[r]});return!0},isCurrentFormDirty:function(){if(!this.canModifyByEntityType(n.ENTITY_NETWORK_SWITCH))return!1;var e=!1,t=void 0,i=void 0,s=void 0;switch(this.selectedTab){case this.tabs.switch:t=this.$("#networkSwitchAddForm :input"),i=this.$("#networkSwitchAddForm .dataId").val(),s=this.getData(i);break;case this.tabs.snmp:t=this.$("#snmpProfileAddForm :input"),i=this.$("#snmpProfileAddForm .dataId").val(),s=this.getData(i)}return!s&&(_.each(t,function(t){$(t).is(":text")&&$.trim($(t).val()).length&&(e=!0)}),e)},getDirtyModel:function(e,t){var n={},i=void 0;switch(t){case this.tabs.switch:i=this.$("#networkSwitchAddForm");break;case this.tabs.snmp:i=this.$("#snmpProfileAddForm")}e.map(function(e){switch(e.type){case f.INPUT:n[e.name]=s.stripTags(i.find("."+e.name).val());break;case f.SELECT:var t=i.find("."+e.name+" option:selected").val();n[e.name]="none"===t?null:t}},this);var a=i.find(".dataId").val(),o=this.getData(a);if(null!==o)switch(t){case this.tabs.switch:n.id=o.id;break;case this.tabs.snmp:n.uuid=o.uuid}return n},postprocessSwitchDirtyModel:function(e){e[t.SWITCH_SNMP_PROFILE_NAME_TO_APPLY]=null;var n=[];return e[t.SWITCH_HOST_ADDRESSES].split(",").map(function(e){_.isEmpty(e)||n.push(e.trim())}),e[t.SWITCH_HOST_ADDRESSES]=_.isEmpty(n)?null:n,e},postProcessDirtyModelForAuthPrivType:function(e){return e[t.SWITCH_SNMP_VERSION]!==n.SNMP_VERSIONS.SNMPv3?(e[t.SWITCH_SNMP_SECURITY_LEVEL]=null,e[t.SWITCH_SNMP_AUTH_TYPE]=null,e[t.SWITCH_SNMP_PRIVACY_TYPE]=null):(e[t.SWITCH_SNMP_SECURITY_LEVEL]===n.SNMP_SECURITY_LEVELS.NO_AUTH_NO_PRIV&&(e[t.SWITCH_SNMP_AUTH_TYPE]=null,e[t.SWITCH_SNMP_PRIVACY_TYPE]=null),e[t.SWITCH_SNMP_SECURITY_LEVEL]===n.SNMP_SECURITY_LEVELS.AUTH_NO_PRIV&&(e[t.SWITCH_SNMP_PRIVACY_TYPE]=null)),e},onTabClick:function(e){var t=$(e.currentTarget).attr("data-target");t&&t!==this.selectedTab&&this.onTabClickHelperForFormSwitching(t)},onTabClickHelperForFormSwitching:function(e){this.triggerAction(n.MODAL.ACT.ALERT_HIDE),this.$(".n-modal-tab-header li").removeClass("active"),this.$(".n-modal-tab-header li .tab-"+e).closest("li").addClass("active"),this.toggleTabs(e)},clearFormInputs:function(e){var n=void 0;void 0===e&&(e=t.SWITCH_DATA_ID,n=!0);var i=!1,s=this._getCurrentFormElement(),a=s.find(":input");_.each(a,function(t){(i||-1!==t.className.indexOf(e))&&(i=!0,($(t).is(":text")||$(t).is(":password"))&&$.trim($(t).val()).length&&$(t).val(""))}),n&&this.resetSelectFields()},resetSelectFields:function(e){var n=this._getCurrentFormElement(),i=n.find("select");void 0===e&&(e=this.selectedTab===this.tabs.switch?t.SWITCH_SNMP_VERSION:t.SWITCH_SNMP_PROFILE_NAME_TO_APPLY);var s=!0;this.$(i.get().reverse()).each(function(){s&&(s=-1===$(this)[0].className.indexOf(e),$(this)[0].selectedIndex=0,$(this).trigger("update"))})},onClickCreate:function(e){this.triggerAction(n.MODAL.ACT.ALERT_HIDE),this.showForm(),this.onChangeSNMPVersion()},onClickEdit:function(e){var t=$(e.currentTarget).closest("tr").attr("dataid");this.showForm(t),this.onChangeSNMPVersion()},onClickDelete:function(e){var t=$(e.currentTarget).closest("tr").attr("dataid"),i=this.getData(t),s=void 0;this.selectedTab===this.tabs.switch?s=this.i18n("confirm_delete_switch"):this.selectedTab===this.tabs.snmp&&(s=this.i18n("confirm_delete_snmp")),$.nutanixConfirm({msg:s,yes:function(){this.triggerAction(n.MODAL.ACT.COVER_SHOW),this.selectedTab===this.tabs.switch?this.model.deleteSwitchConfig(i):this.selectedTab===this.tabs.snmp&&this.model.deleteSnmpProfile(i)},yesText:this.i18n("yes"),noText:this.i18n("no"),context:this})},onClickSave:function(){switch(this.disableSaveControls(),this.selectedTab){case this.tabs.switch:this.saveSwitchConfig();break;case this.tabs.snmp:this.saveSnmpProfile()}},onClickBack:function(){if(this.isCurrentFormDirty())return void $.nutanixConfirm({msg:this.i18n("confirm_cancel"),yes:function(){this._goBackToList()},no:function(){},yesText:this.i18n("yes"),noText:this.i18n("no"),context:this});this._goBackToList()},_goBackToList:function(){this.triggerAction(n.MODAL.ACT.ALERT_HIDE),this.toggleFormListElements(!1)},_getCurrentFormElement:function(){var e=void 0;switch(this.selectedTab){case this.tabs.switch:e=this.$("#networkSwitchAddForm");break;case this.tabs.snmp:e=this.$("#snmpProfileAddForm")}return e},onChangeSNMPVersion:function(){var e=this._getCurrentFormElement(),i=e.find(".version option:selected").val();i===n.SNMP_VERSIONS.SNMPv3?e.find(".securityLevel").closest("[data-ntnx-section]").show():i===n.SNMP_VERSIONS.SNMPv2c&&(e.find(".securityLevel").closest("[data-ntnx-section]").hide(),this.clearFormInputs(t.SWITCH_SNMP_AUTH_KEY),this.resetSelectFields(t.SWITCH_SNMP_AUTH_TYPE),this.disableAuthPrivFields(e,["auth","priv"],!1)),this.onChangeSecurityLevel()},onChangeSecurityLevel:function(){var e=this._getCurrentFormElement(),i=e.find(".version option:selected").val(),s=e.find(".securityLevel option:selected").val();if(i===n.SNMP_VERSIONS.SNMPv3)switch(s){case n.SNMP_SECURITY_LEVELS.AUTH_NO_PRIV:this.disableAuthPrivFields(e,["priv"],!1),this.disableAuthPrivFields(e,["auth"],!0),this.clearFormInputs(t.SWITCH_SNMP_PRIVACY_KEY),this.resetSelectFields(t.SWITCH_SNMP_PRIVACY_TYPE);break;case n.SNMP_SECURITY_LEVELS.NO_AUTH_NO_PRIV:this.disableAuthPrivFields(e,["auth","priv"],!1),this.clearFormInputs(t.SWITCH_SNMP_AUTH_KEY),this.resetSelectFields(t.SWITCH_SNMP_AUTH_TYPE);break;case n.SNMP_SECURITY_LEVELS.AUTH_PRIV:this.disableAuthPrivFields(e,["auth","priv"],!0)}this.triggerAction(n.MODAL.ACT.AS_REFRESH)},disableAuthPrivFields:function(e,t,n){console.log("enable",n),_.each(t,function(t){e.find("."+t+"Key").prop("disabled",!n),e.find("."+t+"Type").trigger(n?"enable":"disable").trigger("update")})},onChangeSnmpProfileName:function(){var e=this._getCurrentFormElement(),n=e.find(".snmpProfileNameToApply option:selected").index(),i=this.getDirtyModel(v.SWITCH_CONFIG,this.tabs.switch),s={};if(0!==n){var a=this.getData(n-1,this.tabs.snmp)||{};s=$.extend(i,a);var o=e.find(".dataId").val();o=""===o?void 0:o,this.showForm(o,s)}else this.clearFormInputs(t.SWITCH_SNMP_COMMUNITY_NAME),this.resetSelectFields(t.SWITCH_SNMP_VERSION);this.onChangeSNMPVersion(),this.onChangeSecurityLevel()}})}),define("text!templates/popups/nfswhitelist/NfsWhitelistPopupView.html",[],function(){return'\x3c!-- The parent div modal is #popupNfsWhitelist --\x3e\n<div class="modal-header">\n  <button type="button" class="close" data-dismiss="modal">\n    <i data-icon="K" aria-hidden="true"></i>\n  </button>\n  <h4 class="n-title">Filesystem Whitelists</h4>\n</div>\n<div class="n-modal-wrapper">\n  <div class="n-modal-body">\n    <div class="n-modal-content-wrapper">\n      <div class="n-modal-alert-header">\n        \x3c!-- @view: alert goes here... --\x3e\n      </div>\n      <% if (canModify) { %>\n      <div class="n-popup-description">\n        Configure global whitelist entries (NFS whitelist for AHV and ESX, CIFS\n        whitelist for Hyper-V). An entry consists of an IP Address and a\n        netmask. Container-level whitelists can be set when creating or\n        updating a storage container.\n      </div>\n      <% } %>\n      \x3c!-- Form to add NFS Whitelist --\x3e\n      <form class="form-horizontal" onsubmit="return false;">\n        <% if (canModify) { %>\n          <div class="control-group">\n            <label class="control-label" for="inputNfsWhitelist-ip">\n              IP Address\n            </label>\n            <input type="text" class="inputNfsWhitelist-ip"\n                   model-validate="ip_address"\n                   model-attribute="ip_address"\n                   model-attribute-name="IP Address:"\n                   placeholder="10.10.1.0">\n          </div>\n          <div class="control-group">\n            <label class="control-label" for="inputNfsWhitelist-mask">\n              Netmask\n            </label>\n            <input type="text" class="inputNfsWhitelist-mask"\n                   model-validate="netmask"\n                   model-attribute="netmask"\n                   model-attribute-name="Netmask:"\n                   placeholder="255.255.255.0">\n          </div>\n            <%= Components.button({\n              extraClasses: \'btnCreate\',\n              text: \'Add\',\n              iconLeft: \'plus\'\n            }) %>\n        <% } %>\n\n        <table id="nfsWhitelistList" class="table table-hover">\n          <thead>\n            <tr>\n              <th>Whitelist Entry</th>\n              <th>&nbsp;</th>\n            </tr>\n          </thead>\n          <tbody>\n          \x3c!-- @view: NFS Whitelist goes here... --\x3e\n          </tbody>\n        </table>\n      </form>\n    </div>\n  </div>\n</div>\n'}),define("views/popups/nfswhitelist/NfsWhitelistPopupView",["backbone","views/basecomponents/popups/BasePopupView","models/BaseModel","data/DataURLConstants","data/DataManager","utils/AppConstants","utils/AppUtil","utils/CommonTemplates","utils/ValidationUtil","text!templates/popups/nfswhitelist/NfsWhitelistPopupView.html"],function(e,t,n,i,s,a,o,r,l,c){"use strict";var d=n.extend({urlRoot:i.NFS_WHITELIST,entityType:a.ENTITY_NFS_WHITELIST,defaults:{id:null,nfsWhitelist:[]},sync:function(t,n,r){return r=this.parseOptions(t,n,r),"update"!==t&&"create"!==t||(n.unset("id"),t="create",n.actionMode===a.ACTION_CREATE?r.url=s.getFormattedURL(i.ADD_NFS_WHITELIST):n.actionMode===a.ACTION_DELETE&&(r.url=s.getFormattedURL(i.REMOVE_NFS_WHITELIST))),o.log("BaseModel : \n\t method: "+t+"\n\t data  : "+r.url),e.sync(t,n,r)},toJSON:function(){return this.get("nfsWhitelist")},parse:function(e){var t={};return t.nfsWhitelist=e,t}});return t.extend({el:"#popupNfsWhitelist",nfsWhitelistModel:null,template:_.template(c),rowTemplate:_.template(r.TABLE_ITEM_DELETE),events:{"click  .btnCreate":"onCreateItem","click  .btnDelete":"onDeleteItem","click  .selectAll":"onSelectAll","keypress input":"onKeyPress","click input":"clearHeader","click .btnCancel":"hide","click .btnOK":"hide","click .modal-header .close":"hide"},render:function(){this.$el.html(this.template(this.vtOptions({canModify:this.canModifyByEntityType(a.ENTITY_NFS_WHITELIST)})))},show:function(e){t.prototype.show.apply(this,arguments),this.listNfsWhitelists()},reset:function(){this.clearHeader(),this.undelegateEvents()},showForm:function(){this.model.get("nfsWhitelist").length>0?this.$el.find(".listRows").show():this.$el.find(".listRows").hide()},getCheckedItems:function(){return this.$el.find('input[class="linkRowCheckbox"]:checked').map(function(){return $.trim($(this).parent().text())}).get()},setDeleteButtonState:function(){this.getCheckedItems().length>0?this.$el.find(".btnDelete").removeAttr("disabled"):this.$el.find(".btnDelete").attr("disabled","disabled"),this.getCheckedItems().length===this.model.get("nfsWhitelist").length?this.$el.find(".selectAll").attr("checked",!0):this.$el.find(".selectAll").attr("checked",!1)},toggleChecked:function(e){$("#nfsWhitelistList input").each(function(){$(this).attr("checked",e)}),this.setDeleteButtonState()},onEnterKeyPress:function(){this.onCreateItem()},onSelectAll:function(){this.$el.find(".selectAll").attr("checked")?this.toggleChecked(!0):this.toggleChecked(!1)},onCreateItem:function(){var e=l.validateFormValues(this.$el);if(e.length){var t=l.defaultErrorHandler(this.$el,e);return void this.showHeaderError(t)}var n=this.$(".inputNfsWhitelist-ip").val().trim(),i=this.$(".inputNfsWhitelist-mask").val().trim(),s=n+"/"+i,o=this.model.get("nfsWhitelist");if(o.length&&this.checkDuplicateIp(o,s))return void this.showHeaderError("IP Address/Netmask already exisits Please add a new entry");this.updateNfsWhitelists(a.ACTION_CREATE,[s])},onDeleteItem:function(e){var t=this,n=$(e.currentTarget).attr("dataid");$.nutanixConfirm({msg:"Delete '"+n+"'?",yes:function(){t.updateNfsWhitelists(a.ACTION_DELETE,[n])}})},listNfsWhitelists:function(){var e=this;this.model=new d,this.model.fetch({success:function(){var t=$("#nfsWhitelistList > tbody");t.html("");var n=e.model.get("nfsWhitelist");if(n&&n.length)for(var i=0;i<n.length;i++){var s=e.rowTemplate({model:n[i],canModify:e.canModifyByEntityType(a.ENTITY_NFS_WHITELIST)});t.append(s)
}else t.html("<tr><td colspan=2>Whitelist entries have not been configured.</tr></td>");e.showForm()},error:function(t,n){e.showHeaderError(n.responseText)}})},updateNfsWhitelists:function(e,t){this.nfsWhitelistModel=new d,this.nfsWhitelistModel.actionMode=e,this.mode=e;var n=this;this.nfsWhitelistModel.set("nfsWhitelist",t),this.nfsWhitelistModel.save(null,{success:function(e,t){n.listNfsWhitelists(),n.$el.find(".inputNfsWhitelist-ip").val(""),n.$el.find(".inputNfsWhitelist-mask").val("")},error:function(e,t){o.log("NFSWhiteListContactPopupView. Error: "+o.processAjaxError(t.responseText)),n.showHeaderError("Error. Unable to add the entry you have typed in. Please verify that it is in a valid format.")}})},checkDuplicateIp:function(e,t){return _.contains(e,t)}})}),define("text!templates/popups/remotesupport/RemoteSupportContentView.html",[],function(){return'\x3c!-- The parent div modal is #popupRemoteSupport --\x3e\n<div data-ntnx-content-inner>\n\n  <section data-ntnx-section="type-text">\n    <% if (canModify) { %>\n      Nutanix technical support can provide remote assistance by logging\n      into the cluster through an SSH connection.\n    <% } else { %>\n      The current Nutanix remote support configuration is displayed below.\n    <% } %>\n  </section>\n\n  <section data-ntnx-section="type-text type-separator" class="currentStatus alert-wrapper">\n  </section>\n\n  <% var sDisabled = canModify ? \'\' : \'disabled\' ; %>\n\n  <section data-ntnx-section="type-separator">\n    <div data-ntnx-form-inline="form-full-width">\n      <input id="enabledInput" class="enabledWithDuration" type="radio"\n             name="status" <%= sDisabled %> >\n      <label for=\'enabledInput\' data-ntnx-inline-label>Enable for</label>\n        <input type="text" class="form-control duration combo-input">\n        <%= Components.select({\n          options: [{\n              name: \'hour(s)\',\n              value: \'hours\'\n            },\n            {\n              name: \'minute(s)\',\n              value: \'minutes\'\n            }],\n          jsClasses: \'inputUnitsType\',\n          classes: \'input-group-btn\',\n          useBrowserSelect: true\n        }) %>\n    </div>\n    <div data-ntnx-form-inline>\n      <input id="disabledInput" class="disabled" type="radio"\n             name="status" <%= sDisabled %> >\n      <label for=\'disabledInput\' data-ntnx-inline-label>Disable</label>\n    </div>\n  </section>\n\n  <section data-ntnx-section="type-separator" class="n-connection-group">\n  \x3c!-- Holder for displaying connection status --\x3e\n    <table class="table n-table-status-info">\n      <thead>\n        <tr>\n          <th>Connection Status</th>\n          <th>State</th>\n        </tr>\n      </thead>\n      \x3c!-- Container of view rendered from ConfigurationServicesView --\x3e\n      <tbody class="n-connection">\n      </tbody>\n    </table>\n  </section>\n\n</div>\n'}),define("views/popups/remotesupport/RemoteSupportPopupView",["backbone","datejs","views/basecomponents/popups/BasePopupView","views/utils/ConfigurationServicesView","models/BaseModel","data/DataURLConstants","data/DataManager","data/DataProperties","utils/AppConstants","utils/AppUtil","utils/TimeUtil","text!templates/popups/remotesupport/RemoteSupportContentView.html"],function(e,t,n,i,s,a,o,r,l,c,d,p){"use strict";p=_.template(p);var u=s.extend({urlRoot:a.REMOTE_SUPPORT,entityType:l.ENTITY_REMOTE_SUPPORT,actionMode:l.ACTION_UPDATE,defaults:{id:null,enable:null},sync:function(t,n,i){return i=this.parseOptions(t,n,i),"update"!==t&&"create"!==t||(n.unset("id"),n.unset("enable"),t="update",i.url=o.getFormattedURL(n.urlRoot)),c.log("BaseModel : \n\t method: "+t+"\n\t data  : "+i.url),e.sync(t,n,i)}});return n.extend({configuration:null,el:"#popupRemoteSupport",remoteSupportModel:null,name:"RemoteSupportPopupView",events:{"click input.n-radio":"onRadioClick","click .modal-header .close":"hide","click .btnOK":"onUpdateClick"},render:function(){var e=this.canModifyByEntityType(l.ENTITY_REMOTE_SUPPORT),t=[];e&&t.push({isPrimary:!0,text:this.i18n("save"),extraClasses:"btnOK",extraAttr:[{key:"data-loading-text",value:"Saving..."}]}),this.$el.html(this.defaultTemplate({title:"Remote Support",antiscroll:!1,bodyContent:p(this.vtOptions({canModify:e})),footerButtons:this.defaultFooter(t)})),this.applyNutanixInput()},show:function(e){n.prototype.show.apply(this,arguments),this.getRemoteSupport(),this.triggerAction(l.MODAL.ACT.AS_REBUILD)},reset:function(){this.clearForm(),this.triggerAction(l.MODAL.ACT.ALERT_HIDE),this.undelegateEvents()},showForm:function(){this.$(".currentStatus").html("").removeClass("enabled disabled"),this.$(".disabled").attr("checked","checked");var e=this.model.get(r.REMOTE_SUPPORT_ENABLE),t=void 0;if(e&&e.enabled){var n=e.duration;if(!n)throw new Error("Invalid duration value.");var s=n/1e3-(new Date).getTimezoneOffset()*l.MINUTES_PER_HOUR;t="Remote support is temporarily enabled until "+d.formatDateTime(s)+".",this.$(".currentStatus").addClass("enabled")}else t="Remote support is currently disabled.",this.$(".enabledWithDuration").attr("checked","checked"),this.$(".currentStatus").addClass("disabled");this.onRadioClick(),this.$(".currentStatus").html(t),this.configuration||(this.configuration=new i({el:this.$(".n-connection-group")})),this.configuration.fillConnectionStatusInfo(l.CONN_TYPE.REMOTE_SUPPORT,this.model),this.triggerAction(l.MODAL.ACT.AS_REBUILD)},clearForm:function(){this.$(".duration").val(""),this.$(".enabledWithDuration").attr("checked",!1),this.$(".disabled").attr("checked",!1)},destroy:function(){this.remoteSupportModel&&this.remoteSupportModel.off(),this.configuration&&this.configuration.destroy(),n.prototype.destroy.apply(this,arguments)},onEnterKeyPress:function(){this.onUpdateClick()},onUpdateClick:function(){var e=null,t=!1,n=l.MINUTES_PER_HOUR;if(this.$(".enabledWithDuration").attr("checked")){if(!this.durationValidate(this.$(".duration").val()))return;t=!0,$.trim(this.$(".duration").val()).length>0&&("minutes"===$.trim(this.$(".inputUnitsType").val())&&(n=1),e=this.$(".duration").val()*n)}this.updateRemoteSupport(t,e)},onRadioClick:function(){this.$(".enabledWithDuration").attr("checked")?(this.$(".duration, .inputUnitsType").removeAttr("disabled"),this.$(".inputUnitsType").parent().removeClass("disabled")):(this.$(".duration, .inputUnitsType").attr("disabled","disabled"),this.$(".inputUnitsType").parent().addClass("disabled"))},getRemoteSupport:function(){var e=this;this.model=new u,this.model.fetch({success:function(){e.showForm()},error:function(e,t){this.triggerAction(l.MODAL.ACT.ALERT_SHOW,{type:l.MODAL.ALERT.TYPE_ERROR,message:t.responseText})}})},updateRemoteSupport:function(e,t){this.remoteSupportModel=new u;var n=this;this.remoteSupportModel.on("error",function(e,t){this.triggerAction(l.MODAL.ACT.ALERT_SHOW,{type:l.MODAL.ALERT.TYPE_ERROR,message:t})}),!1!==this.remoteSupportModel.set({enabled:e,duration:t})&&(this.$(".btnOK").button("loading"),this.remoteSupportModel.save(null,{success:function(e,t){n.$(".btnOK").button("reset"),n.hide()},error:function(e,t){n.$(".btnOK").button("reset"),this.triggerAction(l.MODAL.ACT.ALERT_SHOW,{type:l.MODAL.ALERT.TYPE_ERROR,message:t.responseText})}}))},durationValidate:function(e){var t=void 0;e=(e||"").trim();var n=isNaN(e)?-1:Number(e),i=this.$(".inputUnitsType option:selected").val();return d.isTimeUnitAndValueValid(i,n)&&(t=c.isDisplayableNumber(n)&&n>0),t?(this.$(".duration").removeClass("error"),this.triggerAction(l.MODAL.ACT.ALERT_HIDE),!0):(this.triggerAction(l.MODAL.ACT.ALERT_SHOW,{type:l.MODAL.ALERT.TYPE_ERROR,message:this.i18n("errorMsg")}),this.$(".duration").addClass("error"),!1)}})}),define("views/popups/cluster/HypervSetupPopupView",["views/basecomponents/popups/BasePopupView","views/notification/NotificationView","models/hyperv/HypervDomainCredentialModel","models/notification/NotificationModel","data/DataProperties","utils/AppConstants"],function(e,t,n,i,s,a){"use strict";return e.extend({PROCESSING_MESSAGE:"Processing",notificationView:null,notificationModel:null,isSaving:!1,events:{"click     .btnCancel":"hide","click     .modal-header .close":"hide","click     .btnSave":"onEnterKeyPress","keypress  input":"onKeyPress","keyup     .inputRequired":"onInputRequiredKeyup","click     .btnMoreInfo":"onClickBtnMoreInfo"},initialize:function(){e.prototype.initialize.apply(this,arguments),this.notificationView=new t},destroy:function(){this.notificationView=null,this.notificationModel=null,e.prototype.destroy.apply(this,arguments)},onInputRequiredKeyup:_.debounce(function(){if(!this.isSaving){var e=this.$(".inputRequired");_.find(e,function(e){return""===$(e).val().trim()})||this.$(".btnSave").removeClass("disabled").attr("disabled",!1)}},100),onClickBtnMoreInfo:function(e){this.notificationView.showNotificationPopup(this.notificationModel)},validateAndReturnDomainCredentials:function(e,t){var i=new n;i.set(i.DP.USER_NAME,e),i.set(i.DP.PASSWORD,t);var s=i.validateModel();return s?void this.showHeaderError(s):i},handleMultiNodeReponse:function(e,t){this.clearHeader();var n=_.filter(this.getNodeSpecificStatusArray(t),function(e){return!1===e.successful});if(n&&n.length>0){this.notificationModel=new i({notifyType:a.NOTIFY_ERROR,model:_.clone(e),method:"update",response:_.clone(t)});var s=this.notificationView.createNotificationHTML(this.notificationModel);this.showHeaderError(s),this.onFailure(e,t)}else this.onSuccess(e,t)},getNodeSpecificStatusArray:function(e){return _.sortBy(e[s.NODE_STATUS],function(e){return e.successful})}})}),define("text!templates/popups/cluster/HypervFailoverClusterPopupView.html",[],function(){return'\x3c!-- The parent div modal is #popupHypervDomainJoin --\x3e\n<div class="modal-header">\n  <button type="button" class="close" data-dismiss="modal">\n      <i data-icon="K" aria-hidden="true"></i>\n  </button>\n  <h4 class="n-title">Configure Failover Cluster</h4>\n</div>\n<div class="n-modal-wrapper">\n  <div class="n-modal-body">\n    <div class="n-modal-content-wrapper">\n      <div class="n-modal-alert-header">\n        \x3c!-- @view: update message goes here --\x3e\n      </div>\n      <div class="n-popup-description">\n        This step allows you to setup a Hyper-V failover cluster.\n      </div>\n      \x3c!-- Create Failover cluster Form --\x3e\n      <form id="FailoverClusterForm" class="form-horizontal">\n        <div class="control-group">\n          <label class="control-label">Failover cluster name</label>\n          <div class="controls">\n            <input type="text" class="inputRequired failoverClustername"\n                   disabled/>\n          </div>\n        </div>\n        <div class="control-group">\n          <label class="control-label">Failover cluster IP address\n          </label>\n          <div class="controls">\n            <input type="text" class="inputRequired failoverClusterIpAddress"\n                   disabled/>\n          </div>\n        </div>\n        <div class="group-credentials groupCredentials">\n          \x3c!-- Credentials view will go here --\x3e\n        </div>\n      </form>\n    </div>\n  </div>\n  <div class="n-modal-footer">\n    <div class="pull-left">\n      <button class="btnCancel btn n-btn-list">\n        Cancel\n      </button>\n    </div>\n    <button class="btnSave btn btn-primary n-btn-list">\n      Create Cluster\n    </button>\n  </div>\n</div>'}),define("views/popups/cluster/HypervFailoverClusterPopupView",["views/popups/cluster/HypervSetupPopupView","models/BaseModel","models/BaseCollection","data/DataURLConstants","data/DataProperties","managers/ClusterManager","utils/AppConstants","utils/AppUtil","utils/TooltipContent","text!templates/popups/cluster/HypervFailoverClusterPopupView.html","text!templates/popups/cluster/HypervCredentialsView.html"],function(e,t,n,i,s,a,o,r,l,c,d){"use strict";var p=t.extend({urlRoot:i.CLUSTER_FAILOVER_CLUSTER,entityType:o.ENTITY_HYPERV_FAILOVER_CLUSTER,defaults:{name:null,ipAddress:null},name:"FailoverClusterDomainModel",getLatencyMessage:function(){return"Creating Failover cluster."}}),u=n.extend({model:p,url:i.CLUSTER_FAILOVER_CLUSTER,name:"FailoverClusterDomainCollection"}),h=_.template(c),m=_.template(d);return e.extend({el:"#popupHypervFailoverCluster",model:null,collection:null,render:function(){this.$el.html(h({canModify:this.canModifyByEntityType(o.ENTITY_CLUSTER)})),this.$(".groupCredentials").html(m)},show:function(t){e.prototype.show.apply(this,arguments),this.$(".btnSave").addClass("disabled").attr("disabled",!0),this.showHeaderLoading(),this.getFailoverClusterSetup(),this.applyNutanixInput()},showForm:function(){var e,t;this.model&&(e=this.model.get(s.IP_ADDRESS),t=this.model.get(s.NAME)),e?this.$(".failoverClusterIpAddress").val(e).prop("disabled",!0):this.$(".failoverClusterIpAddress").prop("disabled",!1),t?this.$(".failoverClustername").val(t).prop("disabled",!0):this.$(".failoverClustername").prop("disabled",!1),this.$(".n-button-help").tooltip({title:l[o.ENTITY_KERBEROS_CONFIG].CREDENTIALS_HELP,placement:"right",trigger:"hover",html:!1})},destroy:function(){r.debug("HypervFailoverClusterPopupView : destroy:  | viewid     : "+this.cid),this.$(".n-button-help").tooltip("destroy"),e.prototype.destroy.apply(this,arguments)},onEnterKeyPress:function(){var e=this,t={};t.ipAddress=this.$(".failoverClusterIpAddress").val().trim(),t.name=this.$(".failoverClustername").val().trim();var n=this.$(".username").val().trim(),i=this.$(".password").val().trim(),a=this.validateAndReturnDomainCredentials(n,i);a&&(t.credential=a.toJSON(),t.memberNodes=null,this.model.unset(s.NODE_STATUS,{silent:!0}),this.model.set(t),this.$(".btnSave").addClass("disabled").attr("disabled",!0),this.showHeaderSaving(this.PROCESSING_MESSAGE),this.isSaving=!0,this.model.save(null,{success:function(t,n){e.isSaving=!1,e.handleMultiNodeReponse(t,n)},error:function(t,n){e.isSaving=!1,e.showHeaderError(n.responseText)}}))},onSuccess:function(e,t){this.hide(),a.fetchOnDemand()},onFailure:function(e,t,n){this.getFailoverClusterSetup(!0)},getFailoverClusterSetup:function(e){this.collection=new u,this.model=new p;var t=this;this.collection.fetch({success:function(){t.collection.length>0&&(t.model=t.collection.models[0]),t.showForm(),e||t.clearHeader()},error:function(e,n){t.showHeaderError(n.responseText)}})}})}),define("text!templates/popups/storage/security/KerberosManagementPopupView.html",[],function(){return'\x3c!-- The parent div modal is #popupKerberosManagement --\x3e\n<div class="modal-header">\n  <button type="button" class="close" data-dismiss="modal">\n    <i data-icon="K" aria-hidden="true"></i>\n  </button>\n  <h4 class="n-title"><%= i18n(\'kerberos_popup_title\') %></h4>\n</div>\n<div class="n-modal-wrapper">\n  <div class="n-modal-body">\n    <div class="n-modal-content-wrapper">\n      <div class="n-modal-alert-header">\n        \x3c!-- @view: update message goes here --\x3e\n      </div>\n      <div class="n-popup-description">\n        <% if (canModify) { %>\n          <%= i18n(\'kerberos_popup_description\') %>\n        <% } %>\n      </div>\n      \x3c!-- Kerberos Form --\x3e\n      <form class="form-horizontal kerberos-popup-form">\n        <div class="kerberos-setup-warning kerberosSetupWarning">\n          <%= Components.icon(\'exclamation_badge\', \'-inline\') %>\n          <%= i18n(\'kerberos_check_warning\') %>\n        </div>\n        \x3c!-- Keberos status --\x3e\n        <div class="control-group kerberos-switch">\n          <label class="control-label n-kerberos-title-label">\n            <%= i18n(\'kerberos_required\') %>\n          </label>\n          <div class="controls">\n            <input id="enableKerberos" type="checkbox"\n                   class="n-switch kerberosEnabled"/>\n            <label for="enableKerberos" class="n-switch-medium\n              n-kerberos-checkbox-label"/>\n          </div>\n        </div>\n        <div class="group-credentials groupCredentials">\n          \x3c!-- Credentials view will go here --\x3e\n        </div>\n      </form>\n    </div>\n  </div>\n  <div class="n-modal-footer">\n    <button class="btnCancel btn n-btn-list">\n      <%= i18n(\'cancel\') %>\n    </button>\n    <button class="btnSave btn btn-primary n-btn-list" disabled>\n      <%= i18n(\'save\') %>\n    </button>\n  </div>\n</div>\n'}),define("views/popups/storage/security/KerberosManagementPopupView",["views/basecomponents/popups/BasePopupView","models/BaseModel","models/hyperv/HypervDomainCredentialModel","data/DataURLConstants","data/DataProperties","fancyselect","models/cluster/ClusterHealthStatsModel","utils/AppConstants","utils/AppUtil","utils/TooltipContent","text!templates/popups/storage/security/KerberosManagementPopupView.html","text!templates/popups/cluster/HypervCredentialsView.html"],function(e,t,n,i,s,a,o,r,l,c,d,p){"use strict";var u=t.extend({urlRoot:i.KERBEROS_CONFIG,entityType:r.ENTITY_KERBEROS_CONFIG,actionMode:r.ACTION_UPDATE,defaults:{kerberos:null,credential:null},name:"KerberosManagementModel"}),h=_.template(d),m=_.template(p);return e.extend({name:"KerberosManagementPopupView",el:"#popupKerberosManagement",model:{},isKerberosEnabled:null,healthStatsModel:null,events:{"click    .btnCancel":"hide","click    .modal-header .close":"hide","click    .kerberosEnabled":"onClickKerberosEnabled","click    .btnSave":"onEnterKeyPress","keypress input":"onKeyPress"},initialize:function(){e.prototype.initialize.apply(this,arguments),this.healthStatsModel=new o},render:function(){this.$el.html(h(this.vtOptions({canModify:this.canModifyByEntityType(r.ENTITY_KERBEROS_CONFIG)}))),this.$(".groupCredentials").html(m)},show:function(t){e.prototype.show.apply(this,arguments),this.getKerberosConfiguration()},reset:function(){this.clearForm(),this.clearHeader(),this.undelegateEvents()},showForm:function(){this.isKerberosEnabled=this.model.get(s.KERBEROS),this.$(".kerberosEnabled").attr("checked",this.isKerberosEnabled||!1),this.$(".n-button-help").tooltip({title:c[r.ENTITY_KERBEROS_CONFIG].CREDENTIALS_HELP,placement:"right",trigger:"hover",html:!1});var e=this.healthStatsModel.getFailedTestIds(),t=r.HEALTH_CHECKS.CHECK_KERBEROS_SETUP;e.indexOf(t)>-1?this.$(".kerberosSetupWarning").show():this.$(".kerberosSetupWarning").hide()},destroy:function(){l.debug("KerberosManagementPopupView : destroy:  | viewid     : "+this.cid),this.$(".n-button-help").tooltip("destroy"),e.prototype.destroy.apply(this,arguments)},onClickKerberosEnabled:function(){this.$(".kerberosEnabled").is(":checked")!==this.isKerberosEnabled?(this.$(".groupCredentials").show(),this.$(".btnSave").removeAttr("disabled")):(this.$(".groupCredentials").hide(),this.$(".btnSave").attr("disabled","true"))},onEnterKeyPress:function(){var e=this.$(".kerberosEnabled").is(":checked"),t=this.$(".username").val(),i=this.$(".password").val(),s=new n;s.set(s.DP.USER_NAME,t),s.set(s.DP.PASSWORD,i);var a=s.validateModel();if(a)return void this.showHeaderError(a);this.model.set({kerberos:e,credential:s});var o=this;this.model.save(null,{success:function(e,t){o.hide()},error:function(e,t){o.showHeaderError(t.responseText)}})},getKerberosConfiguration:function(){var e=this;this.model=new u;var t=[this.model.fetch(),this.healthStatsModel.fetch()];$.when.apply($,t).then(function(){e.showForm()}).fail(function(t){e.showHeaderError(_.isObject(t)?l.processAjaxError(t.responseText):t)})}})}),define("models/EmailModel",["models/BaseModel","models/alert/AlertServicesModel","data/DataProperties","data/DataURLConstants","utils/CommonTemplates","utils/AppConstants"],function(e,t,n,i,s,a){"use strict";var o={TO:"recipients",FROM:"from",SUBJECT:"subject",CONTENT:"text",CONTENT_HTML:"htmlText"},r=e.extend({urlRoot:i.SMTP});return e.extend({urlRoot:i.EMAIL_DELIVERY,alertServices:null,smtpServer:null,DP:o,initialize:function(){this.alertServices=new t,this.smtpServer=new r,e.prototype.initialize.apply(this,arguments)},showSuccessNotification:function(){},showErrorNotification:function(){},showLatencyNotification:function(){},showClientNotification:function(){},addRecipients:function(e){if(!_.isEmpty(e)){var t=(this.get(o.TO)||[]).concat(e);this.set(o.TO,t)}},prependToBody:function(e){e&&(this.set(o.CONTENT,e+"\n\n"+this.get(o.CONTENT)),this.set(o.CONTENT_HTML,e+"<br><br>"+this.get(o.CONTENT_HTML)))},getMailtoString:function(){return s.MAILTO_LINK({subject:encodeURIComponent(this.get(o.SUBJECT)),body:encodeURIComponent(this.get(o.CONTENT)),to:_.map(this.get(o.TO),function(e){return e.trim()})})},fetchSmtpStatus:function(){var e=this,t=$.Deferred(),n=[this.alertServices.fetch(),this.smtpServer.fetch()];return $.whenAll.apply($,n).done(function(){t.resolve(e._hasTunnel()||e._hasSmtp())}),t.promise()},_hasTunnel:function(){return(((this.alertServices.get(n.CONN_TUNNEL_DETAILS)||{}).connectionStatus||{}).status||"").toLowerCase()===a.CONN_STATUS_SUCCESS},_hasSmtp:function(){return((this.smtpServer.get(n.CONN_EMAIL_STATUS)||{}).status||"").toLowerCase()===a.CONN_STATUS_SUCCESS}})}),define("text!templates/popups/smtpserver/SmtpServerContentView.html",[],function(){return'\x3c!-- The parent div modal is #popupSmtpServer --\x3e\n<div data-ntnx-content-inner>\n\n  <div class="smtp-form">\n    <% var sDisabled = canModify ? \'\' : \'disabled\' ; %>\n\n    <% if (canModify) { %>\n      <section data-ntnx-section="type-text">\n        <%= i18n(\'popup_crud_description\') %>\n      </section>\n    <% } %>\n\n    \x3c!-- SMTP Settings Form --\x3e\n    <form id="smtpPopupForm">\n      \x3c!-- SMTP Settings --\x3e\n      <section data-ntnx-section>\n        <label data-ntnx-label>\n          <%= i18n(\'popup_form_caption_host\') %>\n        </label>\n        <input type="text"\n          class="inputAddress"\n          model-validate="required"\n          model-attribute="address"\n          <%= sDisabled %>\n        >\n      </section>\n\n      <section data-ntnx-section>\n        <label data-ntnx-label>\n          <%= i18n(\'port\') %>\n        </label>\n        <input type="text"\n          class="inputPort"\n          model-validate="required"\n          model-attribute="port"\n          <%= sDisabled %>\n        >\n      </section>\n\n      <section data-ntnx-section>\n        <label data-ntnx-label>\n          <%= i18n(\'popup_form_caption_secureMode\') %>\n        </label>\n        <%= Components.select({\n          id: \'inputSecureMode\',\n          disabled: sDisabled,\n          attributes: \'model-attribute="secureMode"\',\n          jsClasses: \'inputSecureMode\',\n          useBrowserSelect: true,\n          options: [{\n            name: i18n(\'popup_form_secureMode_option_none\'),\n            value: \'NONE\',\n            selected: true\n          }, {\n            name: i18n(\'popup_form_secureMode_option_starttls\'),\n            value: \'STARTTLS\'\n          }, {\n            name: i18n(\'popup_form_secureMode_option_ssl\'),\n            value: \'SSL\'\n          }]\n        }) %>\n      </section>\n\n      <section data-ntnx-section class="userName">\n        <label data-ntnx-label>\n          <%= i18n(\'popup_form_caption_user\') %>\n        </label>\n        <input type="text"\n          class="inputUsername"\n          model-attribute="username"\n        >\n      </section>\n\n      <section data-ntnx-section class="password">\n        <label data-ntnx-label>\n          <%= i18n(\'popup_form_caption_password\') %>\n        </label>\n        <input type="password" autocomplete="off"\n          model-attribute="password"\n          class="inputPassword"\n        >\n        <div data-ntnx-hint class="password-row-description">\n          <%= i18n(\'popup_form_description_password\') %>\n        </div>\n      </section>\n\n      <section data-ntnx-section>\n        <label data-ntnx-label>\n          <%= i18n(\'popup_form_caption_fromEmailAddress\') %>\n        </label>\n        <input type="text"\n          class="fromEmailAddress"\n          model-attribute="fromEmailAddress"\n          <%= sDisabled %>\n        >\n      </section>\n\n      \x3c!-- Holder for displaying connection status --\x3e\n      <div class="connectionStatus hide">\n\n        <section data-ntnx-section>\n          <h5 data-ntnx-title>\n            <%= i18n(\'popup_status_info_title\') %>\n          </h5>\n        </section>\n\n        <section data-ntnx-section>\n          <div class="n-connection">\n            <div class="n-connection-status">\n              <label>\n                <%= i18n(\'popup_status_info_caption_status\') %>\n              </label>\n              <span class="connectionStatus">\n                <label class="connectionMsg">\n                </label>\n              </span>\n            </div>\n            <div class="n-connection-last-changed">\n              <label>\n                <%= i18n(\'popup_status_info_caption_lastAttempted\') %>\n              </label>\n              <span class="lastSent"></span>\n            </div>\n          </div>\n        </section>\n\n      </div>\n\n    </form>\n  </div>\n\n  <div class="smtp-test-form">\n    <section data-ntnx-section="type-text">\n      <%= i18n(\'popup_test_description\') %>\n    </section>\n\n    <section data-ntnx-section="type-text" class="temporary-applied hide">\n      <%= i18n(\'popup_test_description_afterUpdateForm\') %>\n    </section>\n\n    <form id="smtpTestForm">\n\n      <section data-ntnx-section>\n        <label data-ntnx-label>\n          <%= i18n(\'popup_test_form_caption_recipient\') %>\n        </label>\n        <input type="text"\n          class="test-recipient"\n          model-attribute="recipient"\n          model-attribute-name="<%= i18n(\'popup_test_form_caption_recipient\') %>: "\n          model-validate="email"\n         >\n      </section>\n\n      <section data-ntnx-section>\n        <label data-ntnx-label>\n          <%= i18n(\'popup_test_form_caption_subject\') %>\n        </label>\n        <input type="text"\n          class="test-subject"\n          model-attribute="subject"\n          model-attribute-name="<%= i18n(\'popup_test_form_caption_subject\') %>"\n          model-validate="required"\n        >\n      </section>\n\n      <section data-ntnx-section>\n        <label data-ntnx-label>\n          <%= i18n(\'popup_test_form_caption_text\') %>\n        </label>\n        <input type="text"\n          class="test-text"\n          model-attribute="text"\n          model-attribute-name="<%= i18n(\'popup_test_form_caption_text\') %>"\n          model-validate="required"\n        >\n      </section>\n\n    </form>\n  </div>\n\n</div>\n'}),define("views/popups/smtpserver/SmtpServerPopupView",["views/basecomponents/popups/BasePopupView","data/DataProperties","fancyselect","models/smtpserver/SmtpServerModel","models/EmailModel","utils/AppConstants","utils/TimeUtil","utils/ValidationUtil","text!templates/popups/smtpserver/SmtpServerContentView.html"],function(e,t,n,i,s,a,o,r,l){"use strict";l=_.template(l);var c={NONE:"NONE"};return e.extend({name:"SmtpServerPopupView",el:"#popupSmtpServer",model:{},primaryConfigurationCache:{},events:{"click  .btnUpdate":"onUpdateClick","click  .btnCancel":"discardChanges","click  .modal-header .close":"onCloseWithoutSaving","click  .btnRemove":"onRemoveClick","click  .btnTest":"onTestClick","change .inputSecureMode":"updateSecurityMode","keypress input":"onKeyPress","click input":"clearHeader","mouseover .n-error-details":"onMouseOverErrorDetails","mouseout .n-error-details":"onMouseOutErrorDetails","click .btnBack":"hideTestForm","click .btnSend":"onSendTestEmailClick"},render:function(){var e=this.canModifyByEntityType(a.ENTITY_SMTP_SERVER);this.$el.html(this.defaultTemplate({title:this.i18n("popup_title"),antiscroll:!1,bodyContent:l(this.vtOptions({canModify:e})),footerButtons:this.defaultFooter(this.getFooterButtons(e))})),this.updateSecurityMode()},show:function(t){e.prototype.show.apply(this,arguments),this.getSmtpServer(),this.applyNutanixInput()},getFooterButtons:function(e){var t=[{text:this.i18n("back"),extraClasses:"btnBack smtp-test-form",leftAligned:!0,iconLeft:"caret-left"},{text:this.i18n("popup_button_caption_test"),extraClasses:"btnTest smtp-form",leftAligned:!0},{text:this.i18n(e?"discard_changes":"close"),extraClasses:"btnCancel smtp-form"},{isPrimary:!0,text:this.i18n("popup_button_caption_sendTestEmail"),extraClasses:"btnSend smtp-test-form"}];return e&&(t.unshift({text:this.i18n("popup_button_caption_remove"),extraClasses:"btnRemove smtp-form",leftAligned:!0}),t.push({isPrimary:!0,text:this.i18n("save"),extraClasses:"btnUpdate smtp-form"})),t},reset:function(){this.clearForm(),this.triggerAction(a.MODAL.ACT.ALERT_HIDE),this.undelegateEvents()},isPrimaryConfigurationCache:function(){return!_.isEmpty(this.primaryConfigurationCache)},showForm:function(){this.model._isEmpty()&&this.$(".btnRemove").attr("disabled","disabled");var e=this.model.get("username");this.$(".fromEmailAddress").val(this.model.get("fromEmailAddress")||""),this.$(".inputAddress").val(this.model.get("address")||""),this.$(".inputPort").val(this.model.get("port")||""),e&&(this.$(".inputUsername").val(e||""),this.$(".inputPassword").val("")),this.model.get("secureMode")&&this.$(".inputSecureMode").val(this.model.get("secureMode").toUpperCase()).trigger("change"),this.$(".password-row-description")[e?"show":"hide"]();var n=this.model.get(t.CONN_EMAIL_STATUS);if(n){this.$(".connectionStatus").show();var i=o.formatDateTime(n.lastCheckedTimeStampUsecs>0?n.lastCheckedTimeStampUsecs/1e3:0);this.$(".lastSent").html(i),this.$(".connectionMsg").html(n.status)}this.updateTestElementsVisibility()},clearForm:function(){this.$("\n          .inputAddress,\n          .inputPort,\n          .inputUsername,\n          .inputPassword,\n          .fromEmailAddress\n        ").val(""),this.$(".inputSecureMode").val("none").attr("selected",!0),this.$(".btnRemove").attr("disabled","disabled"),this.updateTestElementsVisibility()},getSmtpFormParameters:function(){return this.getDataModel(this.$("#smtpPopupForm"),!0)},isFormEmpty:function(e){return 0===$.trim(e.address).length||0===$.trim(e.port).length},validateForm:function(e){return!(isNaN(e.port)||e.port<=0||e.port>=65536)||(this.triggerAction(a.MODAL.ACT.ALERT_SHOW,{type:a.MODAL.ALERT.TYPE_ERROR,message:this.i18n("error_invalid_port_number")}),!1)},hideButtons:function(e){e||(e="button"),this.toggleButtons(e,!0)},showButtons:function(e){this.toggleButtons(e,!1)},toggleButtons:function(e,t){this.$(".n-modal-footer "+e).toggleClass("hidden",t)},setButtonsDisabledFlag:function(e,t){this.$(".n-modal-footer "+e).prop("disabled",t)},isUpdate:function(){var e=this.model.toJSON(),t=_.find(this.getSmtpFormParameters(),function(t,n){return!_.has(e,n)||e[n]+""!=t+""});return!_.isUndefined(t)},onRemoveClick:function(){var e=this;$.nutanixConfirm({msg:this.i18n("confirm_clear_settings"),yes:function(){e.clearForm(),e.triggerAction(a.MODAL.ACT.ALERT_HIDE),e.updateSmtpServer(e.getSmtpFormParameters(),{success:function(){e.getSmtpServer()}})}})},onEnterKeyPress:function(){this.onUpdateClick()},onUpdateClick:function(){var e=this,t=this.getSmtpFormParameters();this.isFormEmpty(t)?this.triggerAction(a.MODAL.ACT.ALERT_SHOW,{type:a.MODAL.ALERT.TYPE_ERROR,message:this.i18n("empty_smtp_setting")}):this.validateForm(t)&&this.updateSmtpServer(this.getSmtpFormParameters(),{success:function(){e.getSmtpServer()}})},onCloseWithoutSaving:function(){var e=this;this.isPrimaryConfigurationCache()?this.saveModelPrimaryAttributesFromCache({success:function(){e.hide()}}):this.hide()},onMouseOverErrorDetails:function(e){var t,n=$(e.currentTarget),i=n.attr("tooltip");$.trim(i).length&&(t=n.tooltip({title:i,placement:"bottom",trigger:"manual",html:"true",container:$("body")}),t.tooltip("show"))},onMouseOutErrorDetails:function(e){$(e.currentTarget).tooltip("destroy")},getSmtpServer:function(){var e=this;this.model=new i,this.model.fetch({success:function(){e.showForm()},error:function(t,n){e.triggerAction(a.MODAL.ACT.ALERT_SHOW,{type:a.MODAL.ALERT.TYPE_ERROR,
message:n.responseText})}})},updateSmtpServer:function(e,t){var n=this;!1!==this.model.set(e)&&(t=t||{},this.model.save(null,{success:function(e,i){_.isFunction(t.success)&&t.success(e,i),n.$(".inputPassword").val("")},error:function(e,i){_.isFunction(t.error)&&t.error(e,i),n.triggerAction(a.MODAL.ACT.ALERT_SHOW,{type:a.MODAL.ALERT.TYPE_ERROR,message:i.responseText}),n.$(".inputPassword").val("")}}))},saveModelPrimaryAttributesFromCache:function(e){this.updateSmtpServer(this.primaryConfigurationCache,e)},destroy:function(){this.$(".n-error-details").tooltip("destroy"),e.prototype.destroy.apply(this,arguments)},updateSecurityMode:function(){this.$(".userName, .password").toggle(this.$(".inputSecureMode").val()!==c.NONE),this.triggerAction(a.MODAL.ACT.AS_REBUILD)},onTestClick:function(){var e=this;this.isUpdate()?(this.isPrimaryConfigurationCache()||(this.primaryConfigurationCache=this.model.toJSON()),this.triggerAction(a.MODAL.ACT.ALERT_SHOW,{type:a.MODAL.ALERT.TYPE_SUCCESS,message:this.i18n("inform_applying_test_configuration")}),this.updateSmtpServer(this.getSmtpFormParameters(),{success:function(){e.showSmtpTestPopupContent()}})):this.showSmtpTestPopupContent()},onSendTestEmailClick:function(){var e=this.$("#smtpTestForm"),t=this.getDataModel(e,!0),n=r.validateFormValues(e);if(!_.isEmpty(n))return void this.triggerAction(a.MODAL.ACT.ALERT_SHOW,{type:a.MODAL.ALERT.TYPE_ERROR,message:r.defaultErrorHandler(e,n)});this.sentTestEmail(t.recipient,t.subject,t.text)},ifCanSendTestEmail:function(){return!!this.model.get(t.CONN_EMAIL_STATUS)},updateTestElementsVisibility:function(){this.$el.toggleClass("without-test-form",!this.ifCanSendTestEmail()),this.triggerAction(a.MODAL.ACT.AS_REBUILD)},showSmtpTestPopupContent:function(){this.ifCanSendTestEmail()&&(this.$el.addClass("test-form"),this.triggerAction(a.MODAL.ACT.ALERT_HIDE),this.$(".temporary-applied").toggleClass("hidden",_.isEmpty(this.primaryConfigurationCache)),this.triggerAction(a.MODAL.ACT.AS_REBUILD))},hideTestForm:function(){this.$el.removeClass("test-form"),this.triggerAction(a.MODAL.ACT.ALERT_HIDE),this.clearTestForm(),this.updateTestElementsVisibility(),r.removeAllErrors(this.$("#smtpTestForm"))},clearTestForm:function(){this.$("#smtpTestForm input").val("")},setTestFormDisabledFlag:function(e){this.$("#smtpTestForm input").prop("disabled",e)},sentTestEmail:function(e,t,n){var i=this,o=new s;o.smtpServer=this.model,o.addRecipients(e),o.set(o.DP.SUBJECT,t),o.set(o.DP.CONTENT,n),this.setTestFormDisabledFlag(!0),this.setButtonsDisabledFlag(".btnSend",!0),this.triggerAction(a.MODAL.ACT.ALERT_SHOW,{type:a.MODAL.ALERT.TYPE_INFO,message:this.i18n("inform_sending_test_email")}),o.save().done(function(){i.hideTestForm(),i.triggerAction(a.MODAL.ACT.ALERT_SHOW,{type:a.MODAL.ALERT.TYPE_SUCCESS,message:i.i18n("smtp_test_email_sent")}),i.setTestFormDisabledFlag(!1),i.setButtonsDisabledFlag(".btnSend",!1)}).fail(function(e){var t=JSON.parse(e.responseText);i.triggerAction(a.MODAL.ACT.ALERT_SHOW,{type:a.MODAL.ALERT.TYPE_ERROR,message:t.message}),i.setTestFormDisabledFlag(!1),i.setButtonsDisabledFlag(".btnSend",!1)})}})}),define("models/snmp/SnmpModel",["backbone","models/BaseModel","data/DataURLConstants","utils/AppConstants","utils/SubModelHelper","utils/AppUtil"],function(e,t,n,i,s,a){"use strict";var o=t.extend({urlRoot:n.SNMP_STATUS,entityType:i.ENTITY_SNMP,defaults:{status:!1},toJSON:function(){return a.convertPrimitiveToJSON(this.get("status"))}}),r=t.extend({urlRoot:n.SNMP_TRANSPORTS,entityType:i.ENTITY_SNMP_TRANSPORT,defaults:{transports:[]},validate:function(e){var t="",n=e.transports&&e.transports.length?e.transports[0]:null;if(n||(t+="Transport model should be provided."),(isNaN(n.port)||parseFloat(n.port)<i.MIN_PORT_VALUE||parseFloat(n.port)>i.MAX_PORT_VALUE)&&(t+="Port should be a number ranging from "+i.MIN_PORT_VALUE+" to "+i.MAX_PORT_VALUE+"."),$.trim(t).length>0)return t},getURL:function(e){return this.actionMode===i.ACTION_CREATE?n.SNMP_ADD_TRANSPORT:this.actionMode===i.ACTION_DELETE?n.SNMP_REMOVE_TRANSPORT:void 0},toJSON:function(){return this.get("transports")}}),l=t.extend({urlRoot:n.SNMP_USERS,entityType:i.ENTITY_SNMP_USER,validate:function(e){var t="";if($.trim(e.username).length&&$.trim(e.authKey).length||(t+="Username and Auth Key are required fields "),$.trim(e.privKey).length&&$.trim(e.privKey).length<8&&(t+="Priv key should be at least 8 characters long. "),$.trim(e.authKey).length&&$.trim(e.authKey).length<8&&(t+="Auth key should be at least 8 characters long. "),$.trim(t).length>0)return t},sync:function(t,n,i){return i=this.parseOptions(t,n,i),""===n.get("privKey")&&(n.unset("privKey",{silent:!0}),n.unset("privType",{silent:!0})),this._jqXHR=e.sync(t,n,i),this._jqXHR}}),c=t.extend({urlRoot:n.SNMP_TRAPS,entityType:i.ENTITY_SNMP_TRAP,validate:function(e){var t="";if($.trim(e.trapAddress).length||(t+="Trap address is required. "),e.version!==i.SNMP_VERSIONS.SNMPv3||$.trim(e.trapUsername).length||(t+="Trap username is required."),$.trim(t).length>0)return t}});return t.extend({urlRoot:n.SNMP,entityType:i.ENTITY_SNMP,defaults:{enabled:!1,snmpUsers:[],snmpTraps:[],snmpTransports:[]},initialize:function(e){t.prototype.initialize.apply(this,arguments);var n=new o,i=new r,a=new l,d=new c;this.subModelHelper=new s,this.subModelHelper.register("transportsModel",i),this.subModelHelper.register("statusModel",n),this.subModelHelper.register("userModel",a),this.subModelHelper.register("trapModel",d),_.bindAll(this,"_onErrorSubModel","_onSyncSubModel"),this.subModelHelper.attachEventHandler("sync",this._onSyncSubModel),this.subModelHelper.attachEventHandler("error",this._onErrorSubModel)},_onErrorSubModel:function(e,t,n){var i="";_.isString(t)?i=t:_.isObject(t)&&t.responseText&&(i=a.processAjaxError(t.responseText)),this.trigger("error",i)},_onSyncSubModel:function(){this.fetch({alwaysTriggerChange:!0})},updateStatus:function(e){var t=this.subModelHelper.get("statusModel");t.isNew(!1),t.save({status:e})},deleteTransport:function(e){var t=this.subModelHelper.get("transportsModel");t.actionMode=i.ACTION_DELETE,t.save({transports:[e]})},addTransport:function(e){var t=this.subModelHelper.get("transportsModel");t.actionMode=i.ACTION_CREATE,t.save({transports:[e]})},saveTrap:function(e,t){var n=this.subModelHelper.get("trapModel");n.isNew(t),n.save(e)},deleteTrap:function(e){var t=this.subModelHelper.get("trapModel");t.isNew(!1),t.id=e.trapAddress,t.destroy()},saveUser:function(e,t){var n=this.subModelHelper.get("userModel");n.isNew(t),n.save(e)},deleteUser:function(e){var t=this.subModelHelper.get("userModel");t.isNew(!1),t.id=e.username,t.destroy()},destroy:function(){this.subModelHelper.destroy(),t.prototype.initialize.destroy(this,arguments)}})}),define("models/genesis/TestSnmpModel",["models/genesis/GenesisBaseModel","utils/AppConstants"],function(e,t){"use strict";return e.extend({name:"AddNodeModel",methodName:t.CLUSTER_MANAGER_METHODS.SEND_SNMP_TEST_TRAP,managerName:t.GENESIS.CLUSTER_MANAGER,getErrorResponse:function(){var t=e.prototype.getErrorResponse.apply(this,arguments);if(t)return t;var n=this.getReturnResponse();return!1===n[0]?n[1]?n[1]:"Failed to send test alert.":void 0},getReturnResponse:function(){return this.get(e.DP.GENESIS_RETURN)||[]}})}),define("text!templates/popups/snmp/SnmpPopupView.html",[],function(){return'\x3c!-- The parent div modal is #popupSnmp --\x3e\n<div class="modal-header">\n  <button type="button" class="close xClose">\n    <i data-icon="K" aria-hidden="true"></i>\n  </button>\n  <h4 class="n-title"><%= i18n("title") %> </h4>\n</div>\n\n<div class="n-modal-wrapper">\n  <div class="n-modal-body">\n    <div class="n-modal-content-wrapper">\n    \x3c!-- Header --\x3e\n    <div class="n-modal-alert-header">\n      \x3c!-- @view: alert goes here... --\x3e\n    </div>\n\n    <% if (canModify) { %>\n      <div class="n-popup-description">\n        <%= i18n("description") %>\n      </div>\n    <% } %>\n\n    \x3c!-- SNMP Control --\x3e\n    <div class="n-top-control">\n      <div>\n        <input\n          type="checkbox"\n          class="checkboxSnmp formControl"\n          id="enableForNutanixObjects"\n          <%= model.enabled == true ? \'checked\' : \'\' %>\n          <%= canModify ? \'\' : \'disabled\' %>\n        />\n        <%= i18n("enable_for_nutanix") %>\n      </div>\n      <div class="n-inline-loading-container">\n        <div class="n-inline-loading">\n        </div>\n      </div>\n      <div class="n-inline-alert">\n      </div>\n    </div>\n\n    \x3c!-- Tabs --\x3e\n    <div class="n-popup-tabs tabbable tabs-top">\n\n      \x3c!-- Tab Header --\x3e\n      <ul class="n-nav-tab">\n        <% if (isPE) { %>\n        <li class="tab tab-transports\n          <%= selectedTab === \'transports\' ? \'active\' : \'\' %>"\n          data-target="transports" stream-action="select"\n          stream-target="transports">\n          <%= i18n("transports") %>\n        </li>\n        <li class="separator"> &middot; </li>\n        <% } %>\n        <li class="tab tab-users\n          <%= selectedTab === \'users\' ? \'active\' : \'\' %>"\n          data-target="users" stream-action="select" stream-target="users">\n          <%= i18n("users") %>\n        </li>\n        <li class="separator"> &middot; </li>\n        <li class="tab tab-traps\n          <%= selectedTab === \'traps\' ? \'active\' : \'\' %>"\n          data-target="traps" stream-action="select" stream-target="traps">\n          <%= i18n("traps") %>\n        </li>\n      </ul>\n\n      \x3c!-- Tab Body --\x3e\n      <div class="tab-content user-form-tabs-content">\n\n        \x3c!-- Tab Content: Transports --\x3e\n        <div class="tab-pane tab-pane-transports\n          <%= selectedTab === \'transports\' ? \'active\' : \'\' %>">\n          <div class="n-popup-description" style="display: none">\n          </div>\n\n          <% if (!initialized) { %>\n\n            <span class="n-message">\n              <%= i18n("loading") %>\n            </span>\n\n          <% } else { %>\n\n            \x3c!-- Create Transport --\x3e\n            <% if (canModify) { %>\n              <div class="pull-left">\n                <button\n                  class="btnCreate btnList formControl btn"\n                  data-target="transports"\n                  <%= getQaDataTestId(\'btn_create_transport\') %>\n                >\n                  <span class="plus-icon css-icon icon-left -small"></span>\n                  <span class="btn-content"><%= i18n("new_transport") %></span>\n                </button>\n              </div>\n              <div class="n-clearfix"></div>\n            <% } %>\n\n            \x3c!-- List of Transports --\x3e\n            <% if (model.snmpTransports && model.snmpTransports.length) { %>\n              <table id="snmpTransportList"\n                  class="table table-hover table-transports">\n                <thead>\n                  <tr>\n                    <th><%= i18n("protocal") %></th>\n                    <th><%= i18n("port") %></th>\n                    <th>&nbsp;</th>\n                  </tr>\n                </thead>\n                <tbody>\n                <% _.each(model.snmpTransports, function(t, idx) {  %>\n                  <tr class="n-table-row" data-id="<%= idx %>">\n                    <td><%= (t.transportProtocol || \'\').replace(\'_\', \'\')%></td>\n                    <td><%= t.port || \'\' %></td>\n                    <td class="cell-actions">\n                      <% if (canModify) { %>\n                        <i dataId=\'<%= idx %>\' class=\'btnDelete\'\n                           data-icon="v" aria-hidden="true" ></i>\n                      <% } %>\n                    </td>\n                  </tr>\n                <% }); %>\n                </tbody>\n              </table>\n\n            <% } else { %>\n\n              \x3c!-- Empty list --\x3e\n              <span class="n-message">\n                <%= i18n("no_transport_found") %>\n              </span>\n\n            <% } %>\n\n            \x3c!-- Transports Form --\x3e\n            <div class="n-snmp-form  form-transports">\n            </div>\n\n          <% } %>\n        </div>\n\n        \x3c!-- Traps --\x3e\n        <div class="tab-pane tab-pane-traps\n          <%= selectedTab === \'traps\' ? \'active\' : \'\' %>">\n          <div class="n-popup-description" style="display: none">\n          </div>\n\n          <% if (!initialized) { %>\n\n            <span class="n-message">\n              <%= i18n("loading") %>\n            </span>\n\n          <% } else { %>\n\n            \x3c!-- Create Trap --\x3e\n            <% if (canModify) { %>\n              <div class="pull-left">\n                \x3c!-- Message creating Trap if users list is empty --\x3e\n                <% if (model.snmpUsers.length === 0) { %>\n                  <div class="no-snmp-users n-message alert alert-info">\n                    <%= i18n("no_snmp_users") %>\n                    <%= i18ns("create_user", \'<a class="linkCreateUser">\',\n                      \'</a>\') %>\n                  </div>\n                <%  } %>\n                <button\n                  class="btnCreate btnList formControl btn btn-small"\n                  data-target="traps"\n                  <%= getQaDataTestId(\'btn_create_trap\') %>\n                >\n                  <span class="plus-icon css-icon icon-left -small"></span>\n                  <span class="btn-content"><%= i18n(\'new_trap_receiver\') %></span>\n                </button>\n                <button class="btnTest btnList formControl btn btn-small"\n                  data-target="test-traps"\n                  <%= (model.snmpTraps.length) ? \'\' : \'disabled\' %>>\n                  <%= i18n("test_all") %>\n                </button>\n              </div>\n              <div class="n-clearfix"></div>\n            <% } %>\n\n            \x3c!-- List of Traps --\x3e\n            <% if (model.snmpTraps && model.snmpTraps.length) { %>\n              <table id="snmpTrapList"\n                  class="table table-hover table-traps">\n                <thead>\n                  <tr>\n                    <th><%= i18n("address") %></th>\n                    <th><%= i18n("port") %></th>\n                    <th><%= i18n("engine_id") %></th>\n                    <th><%= i18n("username") %></th>\n                    <th><%= i18n("version") %></th>\n                    <th>&nbsp;</th>\n                  </tr>\n                </thead>\n                <tbody>\n                <% _.each(model.snmpTraps, function(t, idx) {  %>\n                  <tr class="n-table-row" data-id="<%= idx %>">\n                    <td><%= t.trapAddress || \'\' %></td>\n                    <td><%= t.port || \'\' %></td>\n                    <td><%= t.engineId || \'\' %></td>\n                    <td><%= t.trapUsername || \'\' %></td>\n                    <td><%= t.versionDisplay || \'\' %></td>\n                    <td class="cell-actions">\n                      <% if (canModify) { %>\n                        <i dataId=\'<%= idx %>\' class=\'btnEdit\'\n                           data-icon="F" aria-hidden="true"></i>\n                        <span class="action-separator">&middot;</span>\n                        <i dataId=\'<%= idx %>\' class=\'btnDelete\'\n                           data-icon="v" aria-hidden="true" ></i>\n                      <% } %>\n                    </td>\n                  </tr>\n                <% }); %>\n                </tbody>\n              </table>\n\n            <% } else { %>\n\n              \x3c!-- Empty list --\x3e\n              <span class="n-message">\n                <%= i18n(\'no_traps\') %>\n              </span>\n\n            <% } %>\n\n            \x3c!-- Traps Form --\x3e\n            <div class="n-snmp-form  form-traps">\n            </div>\n\n          <% } %>\n\n        </div>\n\n        \x3c!-- Users --\x3e\n        <div class="tab-pane tab-pane-users\n          <%= selectedTab === \'users\' ? \'active\' : \'\' %>">\n          <div class="n-popup-description" style="display: none">\n          </div>\n\n          <% if (!initialized) { %>\n\n            <span class="n-message">\n              <%= i18n("loading") %>\n            </span>\n\n          <% } else { %>\n\n            \x3c!-- Create User --\x3e\n            <% if (canModify) { %>\n              <div class="pull-left">\n                <button\n                  class="btnCreate btnList formControl btn btn-small"\n                  data-target="users"\n                  <%= getQaDataTestId(\'btn_create_user\') %>\n                >\n                  <span class="plus-icon css-icon icon-left -small"></span>\n                  <span class="btn-content"><%= i18n(\'new_user\') %></span>\n                </button>\n              </div>\n              <div class="n-clearfix"></div>\n            <% } %>\n\n            \x3c!-- List of Users --\x3e\n            <% if (model.snmpUsers && model.snmpUsers.length) { %>\n              <table id="snmpUserList"\n                  class="table table-hover table-users">\n                <thead>\n                  <tr>\n                    <th class="trap-username"><%= i18n("username") %></th>\n                    <th><%= i18n(\'priv_type\') %></th>\n                    <th><%= i18n(\'auth_type\') %></th>\n                    <th>&nbsp;</th>\n                  </tr>\n                </thead>\n                <tbody>\n                <% _.each(model.snmpUsers, function(t, idx) {  %>\n                  <tr class="n-table-row" data-id="<%= idx %>">\n                    <td><%= t.username || \'\' %></td>\n                    <td><%= (t.privType || \'\').replace(\'_\', \'\') %></td>\n                    <td><%= (t.authType || \'\').replace(\'_\', \'\') %></td>\n                    <td class="cell-actions">\n                      <% if (canModify) { %>\n                        <i dataId=\'<%= idx %>\' class=\'btnEdit\'\n                           data-icon="F" aria-hidden="true"></i>\n                        <span class="action-separator">&middot;</span>\n                        <i dataId=\'<%= idx %>\' class=\'btnDelete\'\n                           data-icon="v" aria-hidden="true" ></i>\n                      <% } %>\n                    </td>\n                  </tr>\n                <% }); %>\n                </tbody>\n              </table>\n\n            <% } else { %>\n\n              \x3c!-- Empty list --\x3e\n              <span class="n-message">\n                 <%= i18n(\'no_users_found\') %>\n              </span>\n\n            <% } %>\n\n            \x3c!-- Users Form --\x3e\n            <div class="n-snmp-form  form-users">\n            </div>\n\n          <% } %>\n\n        </div>\n\n      </div>\n\n      \x3c!-- Cover --\x3e\n      <div class="n-cover"\n        style="display: <%= model.enabled ? \'none\' : \'block\' %>">\n      </div>\n\n    </div>\n  </div>\n  </div>\n\n  <div class="n-modal-footer">\n    <div class="pull-left">\n      <button class="btnDownloadMIB btn" stream-action="download"\n              stream-target="mib">\n        <%= i18n(\'view_mib\') %>\n      </button>\n    </div>\n    \x3c!-- In form mode, we call it cancel, in list mode, its called close--\x3e\n    <button class="btnBack btnForm btn n-btn-form" style="display:none;">\n      <%= i18n(\'cancel\') %>\n    </button>\n    <% if (canModify) { %>\n      <button class="btnSave btnForm btn btn-primary n-btn-form"\n              style="display:none;"\n              data-loading-text="<%= i18n("saving") %>">\n        <%= i18n(\'save\') %>\n      </button>\n    <% } %>\n  </div>\n</div>\n'}),define("text!templates/popups/snmp/SnmpFormTransportView.html",[],function(){return'\x3c!-- SNMP Transport Form --\x3e\n<form id="snmpFormTransport" class="form-horizontal">\n  <div class="control-group">\n    <label class="control-label" for="inputTransportProtocol">Protocol</label>\n    <div class="controls">\n      <select class="inputTransportProtocol" data-class="fancy-select-bottom-anchor">\n        <option value="TCP">TCP</option>\n        <option value="TCP_6">TCP6</option>\n        \x3c!-- UDP is default. This form is only shown in create mode. --\x3e\n        <option value="UDP" selected>UDP</option>\n        <option value="UDP_6">UDP6</option>\n      </select>\n    </div>\n  </div>\n  <div class="control-group">\n    <label class="control-label" for="inputPort">Port</label>\n    <div class="controls">\n      <input type="text" class="inputPort"\n        value="<%= dataModel.port || \'\' %>">\n    </div>\n  </div>\n</form>'}),define("text!templates/popups/snmp/SnmpFormTrapView.html",[],function(){return'\x3c!-- SNMP Trap Form --\x3e\n<form id="snmpFormTrap" class="form-horizontal">\n  <input type="hidden" class="inputDataId" value="<%= dataId || \'\' %>">\n  <div class="control-group">\n    <label class="control-label" for="inputTrapName"><%= i18n(\'receivername\') %></label>\n    <div class="controls">\n      <input type="text" class="inputTrapName"\n        value="<%= dataModel.receiverName || \'\' %>">\n    </div>\n  </div>\n  <div class="control-group">\n    <label class="control-label" for="name"><%= i18n(\'snmp_version\') %></label>\n    <div class="controls">\n      <% _.each(snmpVersions, function(version) { %>\n        <div>\n          <%=\n            Components.radio({\n              id: \'snmpVersion\' + version.value,\n              name: \'snmpVersion\',\n              checked: version.selected ? true: false,\n              value: version.value,\n              classes: \'snmpVersion\'\n            })\n          %>\n          <%= version.name %>\n        </div>\n      <% }); %>\n    </div>\n  </div>\n  <div class="control-group community-input hide">\n    <label class="control-label" for="community"><%= i18n(\'community\') %></label>\n    <div class="controls">\n      <input type="text" class="community"\n        value="<%= dataModel.communityString || \'\' %>">\n    </div>\n  </div>\n  <div class="control-group user-input">\n    <label class="control-label" for="inputTransportProtocol">\n      <%= i18n(\'trap_name\') %>\n    </label>\n    <div class="controls">\n      <select class="inputTrapUsername"\n        data-class="fancy-select-bottom-anchor">\n      <% _.each(snmpModel.snmpUsers, function(uModel) { %>\n        <option value="<%= uModel.username %>"\n          <%= uModel.username === dataModel.trapUsername ? \'selected\' : \'\' %>>\n          <%= uModel.username %>\n        </option>\n      <% }); %>\n      </select>\n    </div>\n  </div>\n  <div class="control-group">\n    <label class="control-label" for="inputTrapAddress"><%= i18n(\'address\') %></label>\n    <div class="controls">\n      <input type="text" class="inputTrapAddress"\n        value="<%= dataModel.trapAddress || \'\' %>">\n    </div>\n  </div>\n  <div class="control-group">\n    <label class="control-label" for="inputPort"><%= i18n(\'port\') %></label>\n    <div class="controls">\n      <input type="text" class="inputPort"\n        value="<%= dataModel.port || 162 %>">\n    </div>\n  </div>\n  <div class="control-group">\n    <label class="control-label" for="inputEngineId"><%= i18n(\'engine_id\') %></label>\n    <div class="controls">\n      <input type="text" class="inputEngineId"\n        value="<%= dataModel.engineId || \'\' %>">\n    </div>\n  </div>\n  <div class="control-group">\n    <label class="control-label" for="inputInform"><%= i18n(\'inform\') %></label>\n    <% var inform = dataModel.inform || false; %>\n    <div class="controls">\n      <select class="inputInform">\n        <option value="true" <%= inform === true ? \'selected\':\'\' %>>\n          True\n        </option>\n        \x3c!-- False is default --\x3e\n        <option value="false"\n          <%= (inform === false) ? \'selected\':\'\'%> >\n          False\n        </option>\n      </select>\n    </div>\n  </div>\n  <div class="control-group">\n    <label class="control-label" for="inputTransportProtocol">\n      <%= i18n(\'transport_protocol\') %>\n    </label>\n    <% var protocol = dataModel.transportProtocol; %>\n    <div class="controls">\n      <select class="inputTransportProtocol" data-class="fancy-select-bottom-anchor">\n        <option value="TCP"\n          <%= protocol === \'TCP\' ? \'selected\' :\'\' %>>\n          TCP\n        </option>\n        <option value="TCP_6"\n          <%= protocol === \'TCP_6\' ? \'selected\' :\'\' %>>\n          TCP6\n        </option>\n         \x3c!-- UDP is default --\x3e\n        <option value="UDP"\n          <%= (_.isEmpty(protocol) || protocol === \'UDP\') ? \'selected\' :\'\' %>>\n          UDP\n        </option>\n        <option value="UDP_6"\n          <%= protocol === \'UDP_6\' ? \'selected\' :\'\' %>>\n          UDP6\n        </option>\n      </select>\n    </div>\n  </div>\n</form>\n'}),define("text!templates/popups/snmp/SnmpFormUserView.html",[],function(){return'\x3c!-- SNMP User Form --\x3e\n<form id="snmpFormUser" class="form-horizontal">\n  <input type="hidden" class="inputDataId" value="<%= dataId || \'\' %>">\n  <div class="control-group">\n    <label class="control-label" for="inputUsername">\n      <%= i18n(\'username\') %></label>\n    <div class="controls">\n      <input type="text" class="inputUsername"\n        value="<%= dataModel.username || \'\' %>"\n        <% if ( dataId ) { %>\n          title="<%= i18n(\'username_msg\') %>"\n          \' disabled \'\n        <% } %>\n      >\n    </div>\n  </div>\n  <div class="control-group">\n    <label class="control-label" for="inputPrivType">\n      <span class="n-control-label-priv"><%= i18n(\'priv_type\') %></span>\n      <span class="n-control-label-priv"><%= i18n(\'priv_key\') %></span>\n    </label>\n    <div class="controls inline-controls">\n      <div class="select-box-wrapper">\n        <select class="inputPrivType" data-class="select-box">\n          <option value="AES"\n            <%= dataModel.privType === \'AES\' ? \'selected\' :\'\' %>>\n            AES\n          </option>\n        </select>\n      </div>\n      <div class="inline-input">\n        <input type="password" autocomplete="off" class="inputPrivKey"\n          value="<%= dataModel.privKey || \'\' %>">\n      </div>\n    </div>\n  </div>\n  <div class="control-group">\n    <label class="control-label" for="inputAuthType">\n      <span class="n-control-label-auth"><%= i18n(\'auth_type\') %></span>\n      <span class="n-control-label-auth"><%= i18n(\'auth_key\') %></span>\n    </label>\n    <div class="controls inline-controls">\n      <div class="select-box-wrapper">\n        <select class="inputAuthType"\n          data-class="fancy-select-bottom-anchor select-box">\n          <option value="SHA"\n            <%= dataModel.authType === \'SHA\' ? \'selected\' :\'\' %>>\n            SHA\n          </option>\n        </select>\n      </div>\n      <div class="inline-input">\n        <input type="password" autocomplete="off" class="inputAuthKey"\n          value="<%= dataModel.authKey || \'\' %>">\n      </div>\n    </div>\n  </div>\n</form>\n'}),define("views/popups/snmp/SnmpPopupView",["views/basecomponents/popups/BasePopupView","models/snmp/SnmpModel","utils/AppConstants","utils/AppUtil","models/genesis/TestSnmpModel","managers/NavigationManager","managers/LicenseManager","managers/ClusterManager","text!templates/popups/snmp/SnmpPopupView.html","text!templates/popups/snmp/SnmpFormTransportView.html","text!templates/popups/snmp/SnmpFormTrapView.html","text!templates/popups/snmp/SnmpFormUserView.html"],function(e,t,n,i,s,a,o,r,l,c,d,p){"use strict";var u={V2:{NAME:"v2c",VALUE:n.SNMP_VERSIONS.SNMPv2c},V3:{NAME:"v3",VALUE:n.SNMP_VERSIONS.SNMPv3}};return e.extend({TYPE:{TRANSPORTS:"transports",TRAPS:"traps",USERS:"users"},name:"SnmpPopupView",DEFAULT_TRAP_PORT:162,el:"#popupSnmp",template:_.template(l),templateFormTransport:_.template(c),templateFormTrap:_.template(d),templateFormUser:_.template(p),initialized:!1,selectedTab:"transports",selectedDataId:null,events:{"click  .btnClose":"hide","click  .modal-header .close":"hide","click  .btnCreate":"onClickCreate","click  .btnTest":"onClickTest","click  .btnEdit":"onClickEdit","click  .btnDelete":"onClickDelete","click  .btnBack":"onClickBack","click  .btnSave":"onClickSave","click  .linkCreateUser":"onClickCreateUser","click  .n-nav-tab  li ":"onSelectTab","change .checkboxSnmp":"onChangeSnmp","click input[name=snmpVersion]":"onChangeSnmpVersion","click .btnDownloadMIB":"onClickDownloadMIB"},modelEvents:{"change  model":"onModelChange","error   model":"onModelError"},initialize:function(){this.model=new t,this.isPE=!r.isMulticlusterUI(),this.isPE||(this.selectedTab="users")},render:function(){var e=this.model.get("snmpTraps");_.map(e,function(e){e.version===u.V3.VALUE?e.versionDisplay=u.V3.NAME:e.versionDisplay=u.V2.NAME}),this.$el.html(this.template(this.vtOptions({canModify:this.canModifyByEntityType(n.ENTITY_SNMP),model:this.model.toJSON(),selectedTab:this.selectedTab,isPE:this.isPE,initialized:this.initialized})));var t=this.$(".checkboxSnmp").is(":checked"),i=o.FEATURE_MAP.LICENSE_SNMP,s=this.$(".n-inline-alert");t&&o.violatedFeatureLicense(i)&&this.isPE?s.html(o.getPopupMessageTemplate(i)).slideDown():s.slideUp(),this.applyNutanixInput()},show:function(t){this.initialized=!1,e.prototype.show.apply(this,arguments),this.fetchSNMP()},showForm:function(e){var t,n=this.getData(e)||{};switch(n.version=n.version||u.V3.VALUE,n.communityString=n.communityString||"public",this.selectedTab){case this.TYPE.TRANSPORTS:t=this.templateFormTransport;break;case this.TYPE.TRAPS:t=this.templateFormTrap;break;case this.TYPE.USERS:t=this.templateFormUser}this.$(".table-"+this.selectedTab).hide(),this.$(".form-"+this.selectedTab).show(),this.showFormElements(),this.$(".btnSave").prop("disabled",!1),this.$(".form-"+this.selectedTab).html(t(this.vtOptions({dataId:e,dataModel:n,snmpVersions:[{name:u.V2.NAME,value:u.V2.VALUE,selected:n.version===u.V2.VALUE},{name:u.V3.NAME,value:u.V3.VALUE,selected:n.version===u.V3.VALUE}],snmpModel:this.model.toJSON()}))),this.applyNutanixInput(),this.selectedTab===this.TYPE.TRAPS&&this.updateSNMPVersionInputs(n.version)},getData:function(e){var t;switch(this.selectedTab){case this.TYPE.TRANSPORTS:t=e?this.model.get("snmpTransports")[e]:null;break;case this.TYPE.TRAPS:t=e?this.model.get("snmpTraps")[e]:null;break;case this.TYPE.USERS:t=e?this.model.get("snmpUsers")[e]:null}return t},onModelChange:function(e,t,n){this.hideCover(),this.hideInlineLoader(),this.enableSaveControls(),this.enableFormControls(),this.initialized=!0,this.render()},onModelError:function(e,t,n){this.hideCover(),this.hideInlineLoader(),this.enableSaveControls(),this.enableFormControls(),this.showHeaderError(_.isObject(e)?i.processAjaxError(e.responseText):e)},onChangeSnmpVersion:function(e){var t=$(e.target),n=t.val();this.updateSNMPVersionInputs(n)},updateSNMPVersionInputs:function(e){if(e===u.V2.VALUE)this.$(".community-input").show(),this.$(".user-input").hide(),this.$(".inputEngineId").prop("disabled",!0),this.$(".btnSave").prop("disabled",!1);else{this.$(".community-input").hide(),this.$(".user-input").show(),this.$(".inputEngineId").prop("disabled",!1);var t=this.model.get("snmpUsers");t&&0!==t.length||this.$(".btnSave").prop("disabled",!0)}},enableFormControls:function(){this.$(".formControl").removeAttr("disabled")},disableFormControls:function(){this.$(".formControl").attr("disabled","disabled")},showInlineLoader:function(){this.$(".n-inline-loading").show()},hideInlineLoader:function(){this.$(".n-inline-loading").hide()},showCover:function(){this.$(".n-cover").show()},hideCover:function(){this.$(".n-cover").hide()},enableSaveControls:function(){this.$(".btnSave").button("reset")},disableSaveControls:function(){this.$(".btnSave").button("loading")},showListElements:function(){this.$(".btnList").show(),this.$(".btnForm").hide(),this.$(".n-clearfix").show(),this.$(".n-message").show()},showFormElements:function(){this.$(".btnList").hide(),
this.$(".btnForm").show(),this.$(".n-clearfix").hide(),this.$(".n-message").hide()},fetchSNMP:function(){this.model.fetch({alwaysTriggerChange:!0})},saveStatus:function(e){this.model.get("enabled")!==e&&(this.showInlineLoader(),this.disableFormControls(),this.model.updateStatus(e))},saveTransport:function(){this.model.addTransport(this.getDirtyTransportModel())},saveTrap:function(){var e=_.isEmpty(this.$(".form-traps .inputDataId").val());this.model.saveTrap(this.getDirtyTrapModel(),e)},saveUser:function(){var e=_.isEmpty(this.$(".form-users .inputDataId").val());this.model.saveUser(this.getDirtyUserModel(),e)},isCurrentFormDirty:function(){var e,t=!1,n=this.$(".form-"+this.selectedTab+" :input"),i=this.$(".form-"+this.selectedTab+" .inputDataId").val(),s=this.getData(i);if(s){switch(this.selectedTab){case this.TYPE.TRANSPORTS:e=this.getDirtyTransportModel();break;case this.TYPE.TRAPS:e=this.getDirtyTrapModel();break;case this.TYPE.USERS:e=this.getDirtyUserModel()}t=!_.isEqual(s,e)}else _.each(n,function(e){$(e).is(":text")&&$.trim($(e).val()).length&&(t=!0)});return t},getDirtyTransportModel:function(){return{transportProtocol:this.$(".form-transports .inputTransportProtocol").val(),port:Number(this.$(".form-transports .inputPort").val())}},getDirtyTrapModel:function(){var e=this.$(".form-traps input[name=snmpVersion]:checked").val(),t={engineId:_.isEmpty(this.$(".form-traps .inputEngineId").val())?null:this.$(".form-traps .inputEngineId").val(),inform:"true"===this.$(".form-traps .inputInform").val(),port:parseFloat(this.$(".form-traps .inputPort").val())||this.DEFAULT_TRAP_PORT,transportProtocol:this.$(".form-traps .inputTransportProtocol").val(),trapAddress:this.$(".form-traps .inputTrapAddress").val().trim(),receiverName:this.$(".form-traps .inputTrapName").val(),version:e};return e===u.V2.VALUE?t.communityString=this.$(".form-traps .community").val():t.trapUsername=this.$(".form-traps .inputTrapUsername").val(),t},getDirtyUserModel:function(){return{username:this.$(".form-users .inputUsername").val(),privType:this.$(".form-users .inputPrivType").val(),privKey:this.$(".form-users .inputPrivKey").val(),authType:this.$(".form-users .inputAuthType").val(),authKey:this.$(".form-users .inputAuthKey").val()}},onClickDownloadMIB:function(e){a.executeDownloadAction(n.FILE_NUTANIX_MIB)},onSelectTab:function(e,t){if(e&&void 0===t&&(t=$(e.currentTarget).attr("data-target")),(t=t||this.TYPE.TRANSPORTS)&&t!==this.selectedTab){if(this.$(".form-"+this.selectedTab).is(":visible")&&this.isCurrentFormDirty()&&!confirm("Your haven't saved your changes. Do you really want to leave?"))return;this.clearHeader(),this.$(".table-"+this.selectedTab).show(),this.$(".form-"+this.selectedTab).hide(),this.selectedTab=t,this.$(".n-nav-tab  li").removeClass("active"),this.$(".tab-content .tab-pane").removeClass("active"),this.$(".n-nav-tab  li.tab-"+t).addClass("active"),this.$(".tab-content .tab-pane-"+t).addClass("active"),this.$(".form-"+t).is(":visible")?this.showFormElements():this.showListElements()}},onChangeSnmp:function(e){var t=$(e.currentTarget).is(":checked");this.saveStatus(t)},onClickCreate:function(e){this.clearHeader(),this.showForm()},onClickTest:function(e){var t=this;this.clearHeader(),$.nutanixConfirm({msg:"Sending test alert to all traps",yes:function(){},yesText:"Yes",hideNo:!0,hideYes:!0,context:this}),(new s).fetch({success:function(){setTimeout(function(){$("#nutanixConfirmModal .btnYes").click(),t.showHeaderSuccess("A test alert has been sent to all traps.")},1e3)},error:function(e,n){setTimeout(function(){$("#nutanixConfirmModal .btnYes").click(),t.showHeaderError(n)},1e3)}})},onClickEdit:function(e){var t=$(e.currentTarget).attr("dataId");this.showForm(t)},onClickDelete:function(e){var t=$(e.currentTarget).attr("dataId"),n=this.getData(t);$.nutanixConfirm({msg:this.i18n("on_delete_confirmation"),yes:function(){switch(this.showCover(),this.selectedTab){case this.TYPE.TRANSPORTS:this.model.deleteTransport(n);break;case this.TYPE.TRAPS:this.model.deleteTrap(n);break;case this.TYPE.USERS:this.model.deleteUser(n)}},yesText:this.i18n("yes"),context:this})},onClickSave:function(){switch(this.disableSaveControls(),this.selectedTab){case this.TYPE.TRANSPORTS:this.saveTransport();break;case this.TYPE.TRAPS:this.saveTrap();break;case this.TYPE.USERS:this.saveUser()}},onClickBack:function(e){this.clearHeader(),this.$(".table-"+this.selectedTab).show(),this.$(".form-"+this.selectedTab).hide(),this.showListElements()},onClickCreateUser:function(){this.onSelectTab(null,this.TYPE.USERS),this.showForm()}})}),define("text!templates/popups/key/PrismPemKeyPopupView.html",[],function(){return'\x3c!-- The parent div modal is #popupPemKey --\x3e\n<div class="modal-header">\n  <button type="button" class="close" data-dismiss="modal">\n    <i data-icon="K" aria-hidden="true"></i>\n  </button>\n  <h4 class="n-title">SSL Certificate</h4>\n</div>\n<div class="n-modal-wrapper">\n  <div class="n-modal-body">\n    <div class="n-modal-content-wrapper">\n      <div class="n-popup-description">\n        <% if (canModify) { %>\n        <span>Note:</span> Any change made to a\n        certificate will restart the prism session and the user will be\n        logged out automatically.\n        <% } %>\n      </div>\n      <div class="n-modal-alert-header">\n        \x3c!-- @view: alert goes here... --\x3e\n      </div>\n      <div id="prismPemKeyList" class="n-modal-content listContainer">\n        \x3c!-- @view: proxies go here... --\x3e\n      </div>\n      <div class="n-modal-content formContainer" style="display: none;">\n        <div id="prismPemKeyForm">\n          \x3c!-- @view: form goes here... --\x3e\n        </div>\n      </div>\n      <div class="n-modal-content uploadContainer" style="display: none;">\n        <div id="prismPemUploadForm">\n          \x3c!-- @view: form upload goes here... --\x3e\n        </div>\n      </div>\n    </div>\n  </div>\n  <div class="n-modal-footer">\n    \x3c!-- In form mode, we call it cancel, in list mode, its called close--\x3e\n    <button class="btnBack btn">Cancel</button>\n    <button class="btnImport btn btn-primary">Import Files</button>\n    <button class="btnReplace btn btn-primary" stream-action="replace"\n            stream-target="certificate">Replace Certificate</button>\n    <% if (canModify) { %>\n    <button class="btnSave btn btn-primary n-btn-form" style="display:none;"\n      data-loading-text="Saving...">Save</button>\n    <% } %>\n  </div>\n</div>\n'}),define("text!templates/popups/key/PrismPemKeyItemView.html",[],function(){return'<div class="n-popup-title">\n  Installed Certificate\n</div>\n<div class="n-centerbox-content">\n  <table class="table readonly-table n-cert-info">\n    <tr>\n      <td>Organization</td>\n      <td><%= model.organizationName %></td>\n    </tr>\n    <tr>\n      <td>Organization Unit</td>\n      <td><%= model.organizationalUnitList %></td>\n    </tr>\n    <tr>\n      <td>Common Name</td>\n      <td><%= model.commonName %></td>\n    </tr>\n    <tr>\n      <td>Location</td>\n      <td><%= model.city %></td>\n    </tr>\n    <tr>\n      <td>State</td>\n      <td><%= model.state %></td>\n    </tr>\n    <tr>\n      <td>Country</td>\n      <td><%= model.countryCode %></td>\n    </tr>\n    <tr>\n      <td>Key Type</td>\n      <td><%= model.keyType %></td>\n    </tr>\n    <tr>\n      <td>Signing Algorithm</td>\n      <td><%= model.signAlgoName %></td>\n    </tr>\n    <tr>\n      <td>Expiry Date</td>\n      <td><%= model.expiryDate %></td>\n    </tr>\n  </table>\n</div>'}),define("text!templates/popups/key/PrismPemKeyFormView.html",[],function(){return"\x3c!-- Pem key and Certificate creation --\x3e\n<div class=\"form-group\">\n\t<div class=\"control-group\">\n\t  <%= Components.radio({\n\t    id         : 'certificateCreationOption',\n\t    name       : 'certificateCreationOption',\n\t    value      : 'RSA_2048',\n\t    variants   : '-blue',\n\t    checked    : false,\n\t    labelText  : 'Regenerate Self Signed Certificate'\n\t  }) %>\n\t</div>\n\t<div class=\"control-group\">\n    <%= Components.radio({\n\t\t  name       : 'certificateCreationOption',\n\t\t  id         : 'certificateCreationOptiontwo',\n\t\t  value      : 'Import',\n\t\t  variants   : '-blue',\n\t\t  checked    : false,\n\t\t  labelText  : 'Import Key and Certificate'\n\t\t}) %>\n\t</div>\n</div>"}),define("text!templates/popups/key/PrismPemKeyFormUploadView.html",[],function(){return'\x3c!-- Upload Pem key Form --\x3e\n<form id="uploadPemKeyForm" class="form-horizontal"\n  target="upload_target" method="post" enctype="multipart/form-data">\n  <div class="n-popup-guidelines" id="guidelines">\n    <span class="n-guidelines-title">Guidelines for RSA 2048: </span>\n      Please use a SHA-256 or SHA-384 signature algorithm with 2048\n      bit certificate for security and performance.\n  </div>\n  <div class="control-group">\n    <label class="control-label" for="selectKeyType">\n      Private Key Type\n    </label>\n    <div class="controls">\n      <select name="keyType" class="selectKeyType keyp-input" id="keyType">\n        <option value="<%= KEY_TYPE.RSA_2048 %>">RSA\n            2048 bit\n        </option>\n        <option value="<%= KEY_TYPE.ECDSA_256 %>">EC DSA\n            256 bit\n        </option>\n        <option value="<%= KEY_TYPE.ECDSA_384 %>">EC DSA\n            384 bit\n        </option>\n        <option value="<%= KEY_TYPE.ECDSA_521 %>">EC DSA\n            521 bit\n        </option>\n      </select>\n    </div>\n    </div>\n    <div class="control-group">\n      <label class="control-label" for="inputKey">\n      Private Key&nbsp; \x3c!-- mind the space --\x3e\n      <span class="privateKeyTip">\n        <%= Components.icon("question-tooltip", "-inline -top") %>\n      </span>\n    </label>\n      <div class="controls">\n        <input type="file" class="inputKey keyp-input" name="key" />\n      </div>\n    </div>\n    <div class="control-group">\n      <label class="control-label" for="inputCertificate">\n        Public Certificate\n      </label>\n      <div class="controls">\n        <input type="file" class="inputCertificate keyp-input" name="cert" />\n      </div>\n    </div>\n    <div class="control-group">\n      <label class="control-label" for="inputCAChain">\n        CA Certificate/Chain\n      </label>\n      <div class="controls">\n        <input type="file" class="inputCAChain keyp-input" name="caChain" />\n      </div>\n    </div>\n</form>\n'}),define("views/popups/key/PrismPemKeyPopupView",["backbone","views/basecomponents/popups/BasePopupView","models/BaseModel","models/BaseCollection","data/DataURLConstants","data/DataManager","utils/AppConstants","utils/AppUtil","text!templates/popups/key/PrismPemKeyPopupView.html","text!templates/popups/key/PrismPemKeyItemView.html","text!templates/popups/key/PrismPemKeyFormView.html","text!templates/popups/key/PrismPemKeyFormUploadView.html"],function(e,t,n,i,s,a,o,r,l,c,d,p){"use strict";var u=n.extend({urlRoot:s.SSL_PEM_PRISM_KEYS,entityType:o.ENTITY_SSL_PRISM_KEY,defaults:{keyType:"",key:"",cert:"",caChain:""},isImport:!1,sync:function(t,n,i){return i=this.parseOptions(t,n,i),"update"!==t&&"create"!==t||(i.url=a.getFormattedURL(n.urlRoot),n.unset("id")),r.log("BaseModel : \n\t method: "+t+"\n\t data  : "+i.url),e.sync(t,n,i)},validate:function(e){var t="";if(this.isImport&&(0===$.trim(e.key).length?t="Please select a Key file.":0===$.trim(e.cert).length?t="Please select a certificate file.":0===$.trim(e.caChain).length?t="Please select a CA certificate or chain file.":0===$.trim(e.keyType).length&&(t="Please select the Key type."),t.length))return t}}),h=n.extend({urlRoot:s.AUTH_CONFIG,entityType:o.ENTITY_AUTH_CONFIG,defaults:{enableClientAuth:!1,authTypeList:[],directoryList:[]}}),m=i.extend({model:u,url:s.SSL_PEM_PRISM_KEYS});return t.extend({KEY_TYPE:{RSA_2048:"RSA_2048",ECDSA_256:"ECDSA_256",ECDSA_384:"ECDSA_384",ECDSA_521:"ECDSA_521"},TEMPLATE_STRING:"certificate",BUTTON_APPLY_STRING:"Apply",BUTTON_NEXT_STRING:"Next",intervalId:null,el:"#popupPemKey",name:"PrismPemKeyPopupView",prismPemKeyModel:null,authConfigModel:null,template:_.template(l),rowTemplate:_.template(c),selectionTemplate:_.template(d),uploadTemplate:_.template(p),rsaTemplate:_.template(' <span class="n-guidelines-title">Guidelines for RSA 2048: </span> Please use a SHA-256 or SHA-384 signature algorithm with 2048 bit certificate for security and performance.'),ec256Template:_.template(' <span class="n-guidelines-title">Guidelines for ECDSA 256: </span> Please use a SHA-256 signature algorithm with EC DSA 256 bit certificate and curve type prime246v1 for security and performance.'),ec384Template:_.template(' <span class="n-guidelines-title">Guidelines for ECDSA 384: </span> Please use a SHA-384 signature algorithm with EC DSA 384 bit certificate and curve type secp384r1 for security and performance.'),ec521Template:_.template(' <span class="n-guidelines-title">Guidelines for ECDSA 521: </span> Please use a SHA-512 signature algorithm with EC DSA 521 bit certificate and curve type secp521r1 for security and performance. Please note Chrome does not support ECDSA 521'),events:{"click    .btnBack":"onBack","click    .btnSave":"onApply","click    .btnReplace":"onReplace","click    .btnImport":"onImport","click    .modal-header .close":"hide","click    .btnClose":"hide","keypress input":"onKeyPress","click    input":"clearHeader","click  input[name='certificateCreationOption']":"onSelectOption","change   #keyType":"onKeyTypeSelection"},render:function(){this.$el.html(this.template(this.vtOptions({canModify:this.canModifyByEntityType(o.ENTITY_PEM_PRISM_KEY)})))},show:function(e){t.prototype.show.apply(this,arguments),this.$(".btnBack").hide(),this.$(".btnSave").hide(),this.$(".btnImport").hide(),this.$(".btnClose").show(),this.canModifyByEntityType(o.ENTITY_SSL_PRISM_KEY)||this.$(".btnReplace").hide(),this.listPrismPemKeyDetails()},showMessageForLegacyBrowser:function(){var e=r.uploadCheck();e&&(this.showHeaderInfo(e),this.$(".btnSave").addClass("disabled").attr("disabled","disabled"))},showForm:function(e,t){this.mode=e,this.clearHeader(),this.hideSubview(".listContainer"),this.showSubview(".formContainer","left"),this.$(".btnBack").show(),this.$(".btnSave").show(),this.$(".btnClose").hide(),this.$(".btnImport").hide(),this.$(".btnSave").html(this.BUTTON_APPLY_STRING),this.$(".btnReplace").hide(),this.applyNutanixInput(),this.showMessageForLegacyBrowser()},showUploadForm:function(e,t){this.mode=e,this.clearHeader(),this.hideSubview(".listContainer"),this.hideSubview(".formContainer"),this.showSubview(".uploadContainer","left"),this.$(".btnBack").show(),this.$(".btnSave").hide(),this.$(".btnClose").hide(),this.$(".btnImport").show(),this.$(".btnSave").html(this.BUTTON_APPLY_STRING),this.applyNutanixInput(),this.showMessageForLegacyBrowser()},showList:function(){this.$el.find(".n-title").text("SSL Certificate"),this.hideSubview(".formContainer"),this.hideSubview(".uploadContainer"),this.showSubview(".listContainer"),this.$(".btnBack").hide(),this.$(".btnSave").hide(),this.$(".btnClose").show(),this.$(".btnImport").hide(),this.$(".btnReplace").show()},onKeyTypeSelection:function(){var e=this.$("#keyType"),t=this.$("#guidelines");switch(e.val()){case this.KEY_TYPE.RSA_2048:t.html(this.rsaTemplate);break;case this.KEY_TYPE.ECDSA_256:t.html(this.ec256Template);break;case this.KEY_TYPE.ECDSA_384:t.html(this.ec384Template);break;case this.KEY_TYPE.ECDSA_521:t.html(this.ec521Template)}},onSelectOption:function(){"Import"===$("input[name='certificateCreationOption']:checked").val()?this.$(".btnSave").html(this.BUTTON_NEXT_STRING):this.$(".btnSave").html(this.BUTTON_APPLY_STRING)},onBack:function(){this.clearHeader(),this.listPrismPemKeyDetails(),this.showList()},onEnterKeyPress:function(){this.onUpload()},onApply:function(){var e=this;this.prismPemKeyModel.on("error",function(t,n){e.showHeaderError(n)});var t=$("input[name='certificateCreationOption']:checked").val();"Import"===t?e.uploadPemFiles():"RSA_2048"===t?$.nutanixConfirm({msg:"Are you sure you want to generate a certificate with 'RSA 2048 bit key' ?",yes:function(){e.generatePrismPemKey(t)}}):e.showHeaderError("Please select a option.")},onReplace:function(){this.prismPemKeyModel=new u;var e=this.$("#prismPemKeyForm");e.html("");var t=this.selectionTemplate(this.vtOptions({model:this.prismPemKeyModel.toJSON()}));e.append(t),this.showForm(o.ACTION_CREATE,!0)},onImport:function(){var e={},t=this;this.prismPemKeyModel.on("error",function(e,n){t.showHeaderError(n)}),this.prismPemKeyModel.isImport=!0,this.prismPemKeyModel.set({cert:this.$(".inputCertificate").val(),key:this.$(".inputKey").val(),caChain:this.$(".inputCAChain").val(),keyType:this.$(".selectKeyType").val()})&&(e.success=function(){t.clearHeader(),t.showReload(t.TEMPLATE_STRING,o.ROUTE_LOGOUT_SSL)},e.error=function(e){t.clearHeader(),t.showHeaderError(e)},r.uploadMultipleFiles(a.getFormattedURL(s.SSL_PEM_IMPORT_KEYS),e,this.$(".keyp-input")))},listPrismPemKeyDetails:function(){var e=this;this.model=new m,this.authConfigModel=new h;var t=[];t.push(this.model.fetch()),t.push(this.authConfigModel.fetch()),$.when.apply($,t).done(function(){var t=e.model.models,n=!1,i=e.$("#prismPemKeyList");if(i.html(""),t&&t.length)for(var s=0;s<t.length;s++)if(e.checkValues(t[s])){n=!0;var a=e.rowTemplate({model:t[s].toJSON()});i.append(a)}n||i.html("<div>SSL Certificate is not encoded in PEM format or <br>SSL Certificate is not present.</div>")}).fail(function(t){e.showHeaderError(null,t)})},uploadPemFiles:function(){var e=this;this.prismPemKeyModel.on("error",function(t,n){e.showHeaderError(n)}),this.prismPemKeyModel=new u;var t=this.$("#prismPemUploadForm");t.html("");var n=this.uploadTemplate(this.vtOptions({model:this.prismPemKeyModel.toJSON(),KEY_TYPE:this.KEY_TYPE}));t.append(n),this.$(".privateKeyTip").tooltip({placement:"top",trigger:"hover",container:"body",title:this.i18n("private_key_msg")}),this.showUploadForm(o.ACTION_CREATE,!0)},generatePrismPemKey:function(e){var t=this;this.model=new u,this.authConfigModel=new h,this.model.isImport=!1,this.model.set({keyType:e}),this.model.save(null,{success:function(e,n){t.clearHeader(),t.showReload(t.TEMPLATE_STRING,o.ROUTE_LOGOUT_SSL)},error:function(e,n){t.showHeaderError(n.responseText)}})},checkValues:function(e){var t=e.attributes,n=_.find(t,function(e){return null!==e&&""!==e});return!_.isUndefined(n)},destroy:function(){this.$(".privateKeyTip").tooltip("destroy"),this.prismPemKeyModel&&this.prismPemKeyModel.off(),t.prototype.destroy.apply(this,arguments)}})}),define("models/popup/RoleMappingModel",["models/BaseModel","data/DataURLConstants","data/DataManager","data/DataProperties","utils/AppConstants","utils/AppUtil"],function(e,t,n,i,s,a){"use strict";return e.extend({urlRoot:t.ROLEMAPPING,entityType:s.ENTITY_GROUP,defaults:{directoryName:"",role:"",entityType:""},enableNotifications:!1,name:"RoleMappingModel",getUrlPrefix:function(){return this.get(i.ROLE_MAPPING.IS_IDP)||this.get(i.ROLE_MAPPING.IDP_UUID)?"authconfig/identity_providers/":t.DIRECTORIES},getAuthIdentifier:function(){return this.get(this.get(i.ROLE_MAPPING.IS_IDP)||this.get(i.ROLE_MAPPING.IDP_UUID)?i.ROLE_MAPPING.IDP_UUID:i.ROLE_MAPPING.DIRECTORY_NAME)},sync:function(e,s,o){return o=this.parseOptions(e,s,o),o.url=n.getFormattedURL(""+this.getUrlPrefix()+this.getAuthIdentifier()+t.ROLEMAPPING+"?&entityType="+s.get(i.ROLE_MAPPING.ENTITY_TYPE)+"&role="+s.get(i.ROLE_MAPPING.ROLE),"read"===e),"update"!==e&&"create"!==e||(s.unset("id"),s.unset("0"),s.get(i.ROLE_MAPPING.IS_IDP)&&s.unset(i.ROLE_MAPPING.DIRECTORY_NAME),s.unset(i.ROLE_MAPPING.IS_IDP)),a.log("BaseModel : \n\t method: "+e+"\n\t data  : "+o.url),Backbone.sync(e,s,o)}})}),define("models/popup/RoleMappingCollection",["models/BaseCollection","data/DataURLConstants","data/DataProperties","models/popup/RoleMappingModel","data/DataManager","utils/AppUtil"],function(e,t,n,i,s,a){"use strict";return e.extend({model:i,url:t.ROLEMAPPING,defaults:{directoryName:""},setDirectoryName:function(e){this.directoryName=e},setIDP:function(e){this.isIDP=e},sync:function(e,n,i){return i=this.parseOptions(e,n,i),i.url=s.getDataSourceURL()+(this.isIDP||t.DIRECTORIES)+this.directoryName+this.url,a.log("BaseModel : \n\t method: "+e+"\n\t data  : "+i.url),Backbone.sync(e,n,i)},getRoleMapping:function(e){var t=e.split(",");return _.find(this.models,function(e){return e.getAuthIdentifier()&&e.getAuthIdentifier()===t[0]&&e.get(n.ROLE_MAPPING.ROLE)&&e.get(n.ROLE_MAPPING.ROLE)===t[1]&&e.get(n.ROLE_MAPPING.ENTITY_TYPE)&&e.get(n.ROLE_MAPPING.ENTITY_TYPE)===t[2]})},comparator:function(e){return e.get("directoryName")+e.get("role")+e.get("entityType")}})}),define("models/identityprovider/IdentityProviderModel",["managers/NotificationManager","managers/UserBehaviorManager","models/BaseModel","data/DataProperties","data/DataURLConstants","utils/AppConstants","broker/api/AppAPI"],function(e,t,n,i,s,a,o){"use strict";return n.extend({name:"IdentityProviderModel",entityType:a.ENTITY_IDENTITY_PROVIDER,validate:function(e){var t=this,n=[],s=[i.NAME],o=i.IDENTITY_PROVIDER;if(e===a.IDENTITY_PROVIDER.CONFIG_TYPE.MANUAL?s.push(o.IDP_URL,o.LOGIN_URL,o.CERTIFICATE):e===a.IDENTITY_PROVIDER.CONFIG_TYPE.METADATA&&s.push(o.IDP_METADATA),s.forEach(function(e){t.get(e)||n.push(t.i18ns("mandatory_error_message",t.i18n(e)))}),n.length)return n},showErrorNotification:function(t,n,i){this.hideLatencyNotification(t,n),e.showClientNotification(a.NOTIFY_ERROR,i)},destroy:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n={};n.uuid=this.get(i.ID);var s=o.getAppAPI(),r=s.intentService,l=r.getBatchService();return this.showLatencyNotification(this,a.ACTION_DELETE),r.getIntentService(a.SSP_INTENT_KINDS.IDENTITY_PROVIDER).then(function(i){return l.addFromService(i,a.ACTION_DELETE,n),l.execute().then(function(n){e.showSuccessNotification(e,a.ACTION_DELETE),t.success&&t.success(n)})}).catch(function(e){throw e})},save:function(){var e=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r={},l=this.get(i.ID);this.unset(i.ID);var c=a.ACTION_CREATE;r.$metadata={},l&&(r.uuid=l,c=a.ACTION_UPDATE,r.$metadata[i.INTENT_SPEC_ATTR.VERSION]=this.get(i.INTENT_SPEC_ATTR.VERSION)),this.unset(i.INTENT_SPEC_ATTR.VERSION);var d=this.get(i.NAME);this.unset(i.NAME);var p=i.IDENTITY_PROVIDER.IDP_METADATA,u=this.get(p);return r.$body=u?_defineProperty({name:d},i.INTENT_RESOURCES,_defineProperty({},p,u)):_defineProperty({name:d},i.INTENT_RESOURCES,_defineProperty({},i.IDENTITY_PROVIDER.IDP_PROPERTIES,this.toJSON())),r.$url=s.IDENTITY_PROVIDER_INTENT.BASE,this.showLatencyNotification(this,c),o.getAppAPI().intentService[c](a.SSP_INTENT_KINDS.IDENTITY_PROVIDER,r).then(function(s){e.showSuccessNotification(e,c),n.success&&n.success(),c===a.ACTION_CREATE&&t.recordUserActivities({action:e.entityType,actionTarget:d+"::"+s[i.UUID]})}).catch(function(t){e.showErrorNotification(e,c,t.message),n.error&&n.error(t.message)})}})}),define("models/identityprovider/IdentityProviderCollection",["models/BaseCollection","models/identityprovider/IdentityProviderModel","data/DataProperties","utils/AppConstants","broker/api/AppAPI"],function(e,t,n,i,s){"use strict";return e.extend({name:"IdentityProviderCollection",model:t,getSpecVersionById:function(e){if(e){var t=this.findModelById(e);if(t)return t.get(n.INTENT_SPEC_ATTR.VERSION)}},fetch:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s.getAppAPI().intentService.all(i.SSP_INTENT_KINDS.IDENTITY_PROVIDER,{}).then(function(n){return e.reset(e.getModelListFromResponse(n)),t.success&&t.success(e),e}).catch(function(e){throw e})},getModelListFromResponse:function(e){var t=this,n=e.entities;return n=n.map(function(e){return t.parseModelFromResponse(e)})},parseModelFromResponse:function(e){var i=e[n.INTENT_STATUS],s={};return _.extend(s,i[n.INTENT_RESOURCES][n.IDENTITY_PROVIDER.IDP_PROPERTIES]),s.id=e[n.INTENT_METADATA][n.UUID],s.name=i[n.NAME],s[n.INTENT_SPEC_ATTR.VERSION]=e[n.INTENT_METADATA][n.INTENT_SPEC_ATTR.VERSION],new t(s)}})}),define("text!templates/popups/authconfig/AuthConfigContentView.html",[],function(){
return'<div data-ntnx-content-inner id="authConfigMainPage">\n\n  \x3c!-- Tab Content: Directory List --\x3e\n  <div class="tabPane tabPaneDirectory tab-pane-directory">\n\n    \x3c!-- Directory Table --\x3e\n    <section data-ntnx-section class="tableDirectory">\n      \x3c!-- NOTE: Table will be added here. --\x3e\n    </section>\n\n    \x3c!-- Directory Form --\x3e\n    <div class="formDirectory form-directory">\n      \x3c!-- NOTE: Form will be added here. --\x3e\n    </div>\n\n    <section data-ntnx-section class="tableIDP">\n    </section>\n\n    <div class="formIDP form-idp">\n    </div>\n  </div>\n\n  \x3c!-- Tab Content: Authentication Types --\x3e\n  <div class="tabPane tabPaneAuthtypes tab-pane-authtypes">\n\n    \x3c!-- Authentication types table --\x3e\n    <section data-ntnx-section class="tableAuthtypes">\n      \x3c!-- NOTE: Table will be added here. --\x3e\n    </section>\n\n  </div>\n\n  \x3c!-- Tab Content: Client Authentication --\x3e\n  <% if (showClientAuthTab) { %>\n    <div class="tabPane tabPaneClientauth tab-pane-clientauth">\n\n      <section data-ntnx-section id="clientAuthList" class="listContainer">\n\n        <h5 data-ntnx-title>\n          <%= Components.checkbox({\n            checked: chainCert !== null,\n            disabled: !canModify,\n            jsClasses: \'formControl checkboxChainCertificate\'\n          }) %>\n          <%= i18n(\'titleConfigureClientChainCertificate\') %>\n        </h5>\n        <section data-ntnx-section="type-subtitle">\n          <%= i18n(\'descConfigureClientChainCertificate\') %>\n        </section>\n\n        <section\n          data-ntnx-section\n          class="configureChainCertificate\n            <%= chainCert !== null ? \'enabled\' : \'\' %> "\n        >\n          <label data-ntnx-label>\n            <%= i18n(\'titleClientChainCertificate\') %>\n          </label>\n          <table class="table upload-table">\n            <tbody>\n              <% if (chainCert !== null) { %>\n                <tr dataid="<%= chainCert.name %>">\n                  <td>\n                    <%= Components.fileInput({\n                      id: "uploadChainCertificate",\n                      classes: \'upload-field inputChain\',\n                      name: "chain",\n                      defaultFilenameText: chainCert.name\n                    }) %>\n                    <input\n                      type="hidden"\n                      class="txtInfo"\n                      name="filename"\n                    >\n                  </td>\n                  <td class="cell-actions">\n                    <% if (canModify) { %>\n                     <a class="remove"><%= i18n(\'btnRemove\') %></a>\n                    <% } %>\n                  </td>\n                </tr>\n              <% } else { %>\n                <tr>\n                  <td>\n                    <%= Components.fileInput({\n                      id: "uploadChainCertificate",\n                      classes: \'upload-field inputChain\',\n                      name: "chain"\n                    }) %>\n                    <input\n                      type="hidden"\n                      class="txtInfo"\n                      name="filename"\n                    >\n                  </td>\n                </tr>\n              <% } %>\n            </tbody>\n          </table>\n        </section>\n\n        \x3c!-- Enable Client Authentication --\x3e\n        <% if (chainCert !== null) { %>\n          <section data-ntnx-section>\n            <div data-ntnx-form-inline>\n              <%= Components.checkbox({\n                id: \'checkboxClientAuth\',\n                jsClasses: \'checkboxClientAuth\',\n                checked: chainCert.enableClientAuth\n              }) %>\n              <label\n                data-ntnx-inline-label\n                for="checkboxClientAuth"\n                class="n-switch-medium -blue"\n              >\n                <%= i18n(\'lblEnableClientAuthentication\') %>\n              </label>\n              <div class="n-inline-loading-container">\n                <div class="n-inline-loading">\n                </div>\n              </div>\n            </div>\n          </section>\n        <%  } %>\n\n        \x3c!-- Configure Service Account --\x3e\n        <% if (chainCert !== null) { %>\n          <section data-ntnx-section>\n            <h5 data-ntnx-title>\n              <%= Components.checkbox({\n                jsClasses: \'formControl checkboxServiceAccount\',\n                checked: autoLogin !== null,\n                disabled: !model.directoryList || !model.directoryList.length ||\n                  (autoLogin !== null && autoLogin.enabled)\n              }) %>\n              <%= i18n(\'titleConfigureServiceAccount\') %>\n              <% if (model.directoryList && model.directoryList.length) { %>\n                <a\n                  class="editSA edit <%= autoLogin !== null ? \'\' : \'hide\' %>"\n                >\n                  <%= i18n(\'btnEdit\') %>\n                </a>\n              <% } %>\n            </h5>\n          </section>\n\n          <section data-ntnx-section="type-subtitle">\n            <%= i18n(\'descConfigureServiceAccount\') %>\n            <% if (!model.directoryList\n                   || !model.directoryList.length) { %>\n              <%= i18n(\'msgRequireActiveDirectory\') %>\n            <% } %>\n          </section>\n\n          <section class="configureServiceAccount\n            <%= autoLogin !== null ? \'enabled\' : \'\' %> "\n          >\n            <section data-ntnx-section>\n              <label data-ntnx-label>\n                <%= i18n(\'lblDirectory\') %>\n              </label>\n              <%\n                var serviceAccountOptions;\n                if (model.directoryList && model.directoryList.length) {\n                  serviceAccountOptions = _.map(\n                    model.directoryList, function (dir, idx) {\n                      return {\n                        selected: autoLogin !== null && dir.name ===\n                        autoLogin.serviceAccountDTO.directoryConfigName,\n                        value: dir.name || \'\',\n                        name: dir.name || \'\'\n                      };\n                    }\n                  );\n                } else {\n                  serviceAccountOptions = [{\n                    value: \'\',\n                    name: i18n(\'msgNoDirectoryFound\')\n                  }];\n                }\n              %>\n              <%= Components.select({\n                jsClasses: \'directoryConfigName\',\n                disabled: autoLogin !== null,\n                options: serviceAccountOptions\n              }) %>\n            </section>\n\n            <section data-ntnx-section>\n              <label data-ntnx-label>\n                <%= i18n(\'lblServiceUsername\') %>\n              </label>\n              <input\n                type="text"\n                value="<%= autoLogin !== null\n                  ? autoLogin.serviceAccountDTO.username : \'\' %>"\n                class="input-field username"\n                placeholder="username@domain"\n                <%= autoLogin !== null ? \'disabled\' : \'\' %>\n              >\n            </section>\n            <section data-ntnx-section>\n              <label data-ntnx-label>\n                <%= i18n(\'lblServicePassword\') %>\n              </label>\n              <input\n                type="password"\n                value="<%= autoLogin !== null\n                  ? autoLogin.serviceAccountDTO.password : \'\' %>"\n                class="input-field password"\n                placeholder="password"\n                <%= autoLogin !== null ? \'disabled\' : \'\' %>\n              >\n            </section>\n            <section\n              data-ntnx-section\n              class="<%= autoLogin !== null ? \'hide\' : \'\' %>"\n            >\n              <%= Components.button({\n                extraClasses: \'cancelServiceAccount\',\n                disabled: autoLogin !== null,\n                text: i18n(\'cancel\')\n              }) %>\n              <%= Components.button({\n              isPrimary: true,\n                extraClasses: \'saveServiceAccount\',\n                disabled: autoLogin !== null,\n                text: i18n(\'save\')\n              }) %>\n            </section>\n          </section>\n\n          \x3c!-- Enable CAC Authentication --\x3e\n          <section data-ntnx-section>\n            <div class="n-inline-alert">\n              <%= cacLicenseWarning %>\n            </div>\n          </section>\n\n          <section data-ntnx-section="type-subtitle">\n            <span class="bold"><%= i18n(\'descNote\') %></span>\n            <%= i18n(\'descCACAuthEnableClientAuth\') %>\n          </section>\n\n          <section data-ntnx-section>\n            <div data-ntnx-form-inline>\n              <%= Components.checkbox({\n                id: \'checkboxCACAuth\',\n                checked: autoLogin !== null && autoLogin.enabled,\n                disabled: autoLogin === null\n              }) %>\n              <label data-ntnx-inline-label for="checkboxCACAuth">\n                <%= i18n(\'lblEnableCACAuth\') %>\n              </label>\n              <div class="n-inline-loading-container">\n                <div class="n-inline-loading">\n                </div>\n              </div>\n            </div>\n          </section>\n        <% } %>\n      </section>\n    </div>\n  <% } %>\n</div>\n\n<div data-ntnx-content-inner id="authConfigTestForm" style="display: none;">\n  <div id="authTestFormWrapper">\n    \x3c!-- @view: form goes here... --\x3e\n  </div>\n</div>'}),define("text!templates/popups/authconfig/AuthConfigDirectoryItem.html",[],function(){return'<tr dataid="<%= idx %>" class="n-table-row">\n  <td>\n    <%= directory.name || \'\' %>\n    <% if (roleMappingNumbers[idx] === 0) { %>\n      <div class="warning-svg-icon role-mapping-icon" data = <%= directory.name %> >\n        <%= Components.icon(\'exclamation_badge\', \'-inline\') %>\n      </div>\n    <% } %>\n  </td>\n  <td><%= directory.domain || \'\' %></td>\n  <td><%= directory.directoryUrl || \'\' %></td>\n  <td class="cell-actions">\n    <% if (showTest) { %>\n      <span class="btnTest"><%= i18n(\'btnTest\') %></span>\n    <% } %>\n    <% if (canModify) { %>\n      <% if (showTest) { %>\n        <span class="action-separator">&middot;</span>\n      <% } %>\n      <i class="btnEdit" data-icon="F" aria-hidden="true">\n      </i>\n      <span class="action-separator">&middot;</span>\n      <i class="btnDelete" data-icon="v" aria-hidden="true">\n      </i>\n    <% } %>\n  </td>\n</tr>'}),define("text!templates/popups/authconfig/AuthConfigTypesList.html",[],function(){return'\x3c!-- List of AuthTypes --\x3e\n<table id="authConfigAuthTypesList" class="table table-hover">\n  <thead>\n    <tr>\n      <th class="cell-checkbox"><%= i18n(\'colEnabled\') %></th>\n      <th><%= i18n(\'colAuthType\') %></th>\n    </tr>\n  </thead>\n  <% if (authTypeList && authTypeList.length) { %>\n    <tbody>\n      <% _.each(authTypeList, function(authType, idx) {  %>\n        <tr>\n          <td class="cell-checkbox">\n            <% if (canModify) { %>\n              <%= Components.checkbox({\n                jsClasses: \'checkboxAuthType\',\n                value: authType.type,\n                checked: _.indexOf(model.authTypeList, authType.type) > -1\n              }) %>\n            <% } %>\n          </td>\n          <td><%= authType.label || \'\' %>\n          </td>\n        </tr>\n      <% }); %>\n    </tbody>\n  <% } else { %>\n  \x3c!-- Empty list --\x3e\n    <tbody>\n      <tr class="empty">\n        <td colspan="2"><%= i18n(\'msgNoAuthTypesFound\') %></td>\n      </tr>\n    </tbody>\n  <% } %>\n</table>'}),define("text!templates/popups/authconfig/AuthConfigTestFormView.html",[],function(){return'\x3c!-- Authentication test form --\x3e\n<form id="authTestForm" class="form-horizontal">\n  <div class="control-group authNameWrapper">\n    <label class="control-label" for="inputDirName">Directory Name</label>\n    <div class="controls">\n      <input type="text" class="inputDirName" value="<%= dirName %>" disabled>\n    </div>\n  </div>\n  <div class="control-group">\n    <label class="control-label" for="inputUsername">User</label>\n    <div class="controls">\n      <input type="text" class="inputUsername" value="">\n    </div>\n  </div>\n  <div class="control-group">\n    <label class="control-label" for="inputPassword">Password</label>\n    <div class="controls">\n      <input type="password" class="inputPassword" autocomplete="off" value="">\n    </div>\n  </div>\n</form>'}),define("text!templates/popups/authconfig/AuthConfigFormDirectoryView.html",[],function(){return'\x3c!-- AuthConfig Directory Form --\x3e\n<form id="authConfigFormDirectory">\n  <input type="hidden" class="inputDataId" value="<%= dataId || \'\' %>">\n\n  \x3c!-- Generic fields --\x3e\n  <section>\n\n    \x3c!-- Directory type --\x3e\n    <section data-ntnx-section>\n      <label data-ntnx-label>\n        <%= i18n(\'lblDirectoryType\') %>\n      </label>\n      <%= Components.select({\n        id: \'inputDirectoryType\',\n        jsClasses: \'inputDirectoryType\',\n        disabled: !!model.directoryType,\n        options: [{\n          value: \'ACTIVE_DIRECTORY\',\n          name: i18n(\'lblActiveDirectory\'),\n          selected: model.directoryType === \'ACTIVE_DIRECTORY\'\n        }, {\n          value: AppConstants.OPEN_LDAP,\n          name: i18n(\'lblOpenLDAP\'),\n          selected: model.directoryType === AppConstants.OPEN_LDAP\n        }]\n      }) %>\n    </section>\n\n    \x3c!-- Unknown, maybe only on some hypervisor ? --\x3e\n    <section data-ntnx-section class="hide">\n      <label data-ntnx-label>\n        <%= i18n(\'lblConnectionType\') %>\n      </label>\n      <%= Components.select({\n        jsClasses: \'inputConnectionType\',\n        variants: \'bottom-anchor\',\n        options: [{\n          value: \'LDAP\',\n          name: i18n(\'lblLDAP\'),\n          selected: model.connectionType === \'LDAP\'\n        }]\n      }) %>\n    </section>\n\n    \x3c!-- Name --\x3e\n    <section data-ntnx-section>\n      <label data-ntnx-label>\n        <%= i18n(\'lblName\') %>\n      </label>\n      <input\n        type="text"\n        class="inputName"\n        value="<%= model.name || \'\' %>"\n        model-validate="required"\n        placeholder = "<%= i18n(\'name\') %>"\n        <%= model.name ? \'disabled\' : \'\' %>\n      >\n    </section>\n\n    \x3c!-- Domain --\x3e\n    <section data-ntnx-section>\n      <label data-ntnx-label>\n        <%= i18n(\'lblDomain\') %>\n      </label>\n      <input\n        type="text"\n        class="inputDomain"\n        placeholder = "<%= i18n(\'placeholderDomain\') %>"\n        model-validate="required"\n        value="<%= model.domain || \'\' %>"\n      >\n    </section>\n\n    \x3c!-- Directory URL --\x3e\n    <section data-ntnx-section>\n      <label data-ntnx-label>\n        <%= i18n(\'lblDirectoryUrl\') %>\n      </label>\n      <input\n        type="text"\n        class="inputDirectoryUrl"\n        placeholder = "<%= i18n(\'placeholderDirectoryUrl\') %>"\n        model-validate="required"\n        value="<%= model.directoryUrl || \'\' %>"\n      >\n    </section>\n\n    \x3c!-- Search Type --\x3e\n    <section data-ntnx-section>\n      <label data-ntnx-label>\n        <%= i18n(\'lblGroupSearchType\') %>\n        <span class="search-type-more-info searchTypeMoreInfo"></span>\n      </label>\n      <%= Components.select({\n        jsClasses: \'groupSearchType\',\n        variants: \'bottom-anchor\',\n        options: [{\n          value: \'NON_RECURSIVE\',\n          name: i18n(\'non_recursive_default\'),\n          selected: model.groupSearchType === \'NON_RECURSIVE\'\n        }, {\n          value: \'RECURSIVE\',\n          name: i18n(\'recursive\'),\n          selected: model.groupSearchType === \'RECURSIVE\'\n        }]\n      }) %>\n    </section>\n  </section>\n\n  \x3c!-- LDAP-only fields --\x3e\n  <section class="open-ldap-form-fields\n    <%= model.directoryType !== AppConstants.OPEN_LDAP ? \'hide\' : \'\' %>"\n  >\n\n    \x3c!-- User object class --\x3e\n    <section data-ntnx-section>\n      <label data-ntnx-label>\n        <%= i18n(\'lblUserObjectClass\') %>\n      </label>\n      <input\n        type="text"\n        class="inputUserObjectClass"\n        placeholder = "<%= i18n(\'placeholderUserObjectClass\') %>"\n        model-validate=""\n        value="<%= ( model.openLdapConfig &&\n          model.openLdapConfig.userObjectClass ) || \'\' %>"\n      >\n    </section>\n\n    \x3c!-- User search base --\x3e\n    <section data-ntnx-section>\n      <label data-ntnx-label>\n        <%= i18n(\'lblUserSearchBase\') %>\n      </label>\n      <input\n        type="text"\n        class="inputUserSearchBase"\n        placeholder="<%= i18n(\'placeholderUserSearchBase\') %>"\n        model-validate=""\n        value="<%= ( model.openLdapConfig &&\n          model.openLdapConfig.userSearchBase ) || \'\' %>"\n      >\n    </section>\n\n    \x3c!-- Username attribute --\x3e\n    <section data-ntnx-section>\n      <label data-ntnx-label>\n        <%= i18n(\'lblUsernameAttribute\') %>\n      </label>\n      <input\n        type="text"\n        class="inputUsernameAttribute"\n        placeholder = "<%= i18n(\'placeholderUsernameAttribute\') %>"\n        model-validate=""\n        value="<%= ( model.openLdapConfig &&\n          model.openLdapConfig.usernameAttribute ) || \'\' %>"\n      >\n    </section>\n\n    \x3c!-- group object class --\x3e\n    <section data-ntnx-section>\n      <label data-ntnx-label>\n        <%= i18n(\'lblGroupObjectClass\') %>\n      </label>\n      <input\n        type="text"\n        class="inputGroupObjectClass"\n        placeholder = "<%= i18n(\'placeholderGroupObjectClass\') %>"\n        model-validate=""\n        value="<%= ( model.openLdapConfig &&\n          model.openLdapConfig.groupObjectClass ) || \'\' %>"\n      >\n    </section>\n\n    \x3c!-- group search base --\x3e\n    <section data-ntnx-section>\n      <label data-ntnx-label>\n        <%= i18n(\'lblGroupSearchBase\') %>\n      </label>\n      <input\n        type="text"\n        class="inputGroupSearchBase"\n        placeholder = "<%= i18n(\'placeholderGroupSearchBase\') %>"\n        model-validate=""\n        value="<%= ( model.openLdapConfig &&\n          model.openLdapConfig.groupSearchBase ) || \'\' %>"\n      >\n    </section>\n\n    \x3c!-- group member attribute --\x3e\n    <section data-ntnx-section>\n      <label data-ntnx-label>\n        <%= i18n(\'lblGroupMemberAttribute\') %>\n      </label>\n      <input\n        type="text"\n        class="inputGroupMemberAttribute"\n        placeholder = "<%= i18n(\'placeholderGroupMemberAttribute\') %>"\n        model-validate=""\n        value="<%= ( model.openLdapConfig &&\n          model.openLdapConfig.groupMemberAttribute ) || \'\' %>"\n      >\n    </section>\n\n    \x3c!-- group member attribute value --\x3e\n    <section data-ntnx-section>\n      <label data-ntnx-label>\n        <%= i18n(\'lblGroupMemberAttributeValue\') %>\n      </label>\n      <input\n        type="text"\n        class="inputGroupMemberAttributeValue"\n        placeholder = "<%= i18n(\'placeholderGroupMemberAttributeValue\') %>"\n        model-validate=""\n        value="<%= ( model.openLdapConfig &&\n          model.openLdapConfig.groupMemberAttributeValue ) || \'\' %>"\n      >\n    </section>\n  </section>\n\n  \x3c!-- Service account --\x3e\n  <section data-ntnx-section="type-separator">\n    <h5 data-ntnx-title>\n      <%= i18n(\'lblServiceAccount\') %>\n    </h5>\n    <section data-ntnx-section="type-subtitle">\n      <%= i18n(\'serviceAccountDescription\') %>\n    </section>\n\n    \x3c!-- Username --\x3e\n    <section data-ntnx-section>\n      <label data-ntnx-label>\n        <%= i18n(\'lblServiceAccountUsername\') %>\n      </label>\n      <input\n        type="text"\n        class="inputServiceAccountUsername"\n        placeholder = "<%= i18n(\'username\') %>"\n        model-validate=""\n        value="<%= model.serviceAccountUsername || \'\' %>"\n      >\n    </section>\n\n    \x3c!-- Password --\x3e\n    <section data-ntnx-section>\n      <label data-ntnx-label>\n        <%= i18n(\'lblServiceAccountPassword\') %>\n      </label>\n      <input\n        type="password"\n        class="inputServiceAccountPassword"\n        placeholder = "<%= i18n(\'password\') %>"\n        model-validate=""\n        value="<%= model.serviceAccountPassword || \'\' %>"\n      >\n    </section>\n  </section>\n</form>\n'}),define("text!templates/popups/authconfig/IDPConfigFormView.html",[],function(){return"<p data-ntnx-section=\"type-text\">\n  <%= i18n('IDPFormDescription') %>\n</p>\n<input type=\"hidden\" class=\"IDPUuid\" value=\"<%= model.id || '' %>\">\n<section data-ntnx-section>\n  <label data-ntnx-label>\n    <%= i18n('lblIDPName') %>\n  </label>\n  <input\n    type=\"text\"\n    class='IDPName'\n    value='<%= model.name || \"\"%>'\n    placeholder= \"<%= i18n('placeholderIDPName') %>\"\n    data-test= \"idp_name_input\"\n  >\n</section>\n\n<section data-ntnx-section>\n  <div data-ntnx-form-inline>\n    <%=\n      Components.radio({\n        name:'type',\n        checked: false,\n        jsClasses: 'idpConfigType',\n        value: 'metadata',\n        labelText: i18n('IDPUploadMetadata'),\n        dataTestAttribute: 'upload_metadata_radio'\n      })\n    %>\n  </div>\n\n  <section class=\"idpMetadataSection hide\">\n    <section data-ntnx-section>\n      <label data-ntnx-label>\n        <input type=\"file\" class='idpMetadataFileInput hidden' />\n        <div class=\"btn\"  data-test=\"idp_metadata_url\">\n          <%= Components.icon('plus-small') %>\n          <span class=\"btn-content\">\n            <%= i18n('IDPImportMetadata') %>\n          </span>\n        </div>\n      </label>\n      <p class=\"idpMetadataFileName\"></p>\n      <input\n        class='IDPMetadata hidden'\n        value='<%= model.metadata || \"\"%>'\n        placeholder= \"<%= i18n('placeholderIDPMetadata') %>\"\n      />\n    </section>\n  </section>\n\n\n  <div data-ntnx-form-inline>\n    <%=\n      Components.radio({\n        name:'type',\n        checked: true,\n        jsClasses: 'idpConfigType',\n        value: 'manual',\n        labelText: i18n('IDPManualConfiguration'),\n        dataTestAttribute: 'manual_config_radio'\n      })\n    %>\n  </div>\n\n  <section class=\"idpManualConfigSection\">\n    <section data-ntnx-section>\n      <label data-ntnx-label>\n        <%= i18n('lblIDPUrl') %>\n      </label>\n      <input\n        type=\"text\"\n        class='IDPUrl'\n        value='<%= model.idp_url || \"\"%>'\n        placeholder= \"<%= i18n('placeholderIDPUrl') %>\"\n        data-test= \"idp_url_input\"\n      >\n    </section>\n\n    <section data-ntnx-section>\n      <label data-ntnx-label>\n        <%= i18n('lblIDPLoginUrl') %>\n      </label>\n      <input\n        type=\"text\"\n        class='IDPLoginUrl'\n        value='<%= model.login_url || \"\"%>'\n        placeholder= \"<%= i18n('placeholderIDPLoginUrl') %>\"\n        data-test= \"login_url_input\"\n      >\n    </section>\n\n    <section data-ntnx-section>\n      <label data-ntnx-label>\n        <%= i18n('lblIDPLogoutUrl') %>\n      </label>\n      <input\n        type=\"text\"\n        class='IDPLogoutUrl'\n        value='<%= model.logout_url || \"\"%>'\n        placeholder = \"<%= i18n('placeholderIDPLogoutUrl') %>\"\n        data-test= \"logout_url_input\"\n      >\n    </section>\n\n    <section data-ntnx-section>\n      <label data-ntnx-label>\n        <%= i18n('lblIDPErrorUrl') %>\n      </label>\n      <input\n        type=\"text\"\n        class='IDPErrorUrl'\n        value='<%= model.error_url || \"\"%>'\n        placeholder = \"<%= i18n('placeholderIDPErrorUrl') %>\"\n        data-test= \"error_url_input\"\n      >\n    </section>\n\n    <section data-ntnx-section>\n      <label data-ntnx-label>\n        <%= i18n('lblIDPCertificate') %>\n      </label>\n      <textarea\n        type=\"text\"\n        class='IDPCertificate'\n        data-test= \"certificate_input\"\n        placeholder = \"<%= i18n('placeholderIDPCertificate') %>\"><%=\n          model.certificate || ''\n        %></textarea>\n    </section>\n  </section>\n</section>"}),define("text!templates/popups/authconfig/IDPItem.html",[],function(){return'<tr class="n-table-row" data-id="<%=uuid%>">\n  <td>\n    <%= idpName %>\n  </td>\n  <td><div class="break-word"><%= idpUrl %></div></td>\n  <td class="cell-actions">\n    <i class="idpEdit" data-icon="F" aria-hidden="true">\n    </i>\n    <span class="action-separator">&middot;</span>\n    <i class="idpDelete" data-icon="v" aria-hidden="true">\n    </i>\n  </td>\n</tr>'}),define("views/popups/authconfig/AuthConfigPopupView",["views/basecomponents/popups/BasePopupView","views/notification/NotificationTemplates","models/BaseModel","models/BaseCollection","models/popup/RoleMappingCollection","models/identityprovider/IdentityProviderCollection","models/identityprovider/IdentityProviderModel","utils/AppConstants","utils/AppUtil","utils/ValidationUtil","utils/SubModelHelper","utils/SVG","utils/CommonTemplates","utils/TooltipContent","events/AppEvents","managers/LicenseManager","managers/ActionManager","managers/I18nManager","data/DataURLConstants","data/DataManager","data/DataProperties","text!templates/popups/authconfig/AuthConfigContentView.html","text!templates/popups/authconfig/AuthConfigDirectoryItem.html","text!templates/popups/authconfig/AuthConfigTypesList.html","text!templates/popups/authconfig/AuthConfigTestFormView.html","text!templates/popups/authconfig/AuthConfigFormDirectoryView.html","text!templates/basecomponents/pagepopups/PopupListView.html","text!templates/popups/authconfig/IDPConfigFormView.html","text!templates/popups/authconfig/IDPItem.html"],function(e,t,n,i,s,a,o,r,l,c,d,p,u,h,m,f,v,g,E,T,C,S,A,b,y,I,w,P,N){"use strict";var R="AuthConfigPopupView",D={TYPE:{DIRECTORY:"Directory",AUTH_TYPES:"Authtypes",CLIENT_AUTH:"Clientauth"},AUTH_TYPES:[{type:"LOCAL",label:g.t(R,"lblLocal")},{type:"DIRECTORY_SERVICE",label:g.t(R,"lblDirectoryService")}]},M=_.template('.tabSelect[actiontarget="<%= actionTarget %>"]'),O=_.template('<tr class="loading"><td colspan="4"><%= i18n("loading") %></td></tr>'),L=_.template('<tr class="loading"><td colspan="3"><%= i18n("loading") %></td></tr>'),x=_.template(P),k=_.template(N),V=_.template('<a download target="_blank"\n      data-test="download_sp_metadata"\n      href="'+E.IDENTITY_PROVIDER_INTENT.SP_METADATA+'">\n      <%= i18n(\'downloadSPMetadata\') %> </a>\n      <span class="downloadSPMetadataTooltip"\n        data-toggle="tooltip"\n        data-original-title="<%= i18n(\'downloadSPMetadataInfo\')%>">\n        <%= Components.icon("question-tooltip", "-inline") %>\n      <span>\n      '),U=n.extend({urlRoot:E.AUTH_CONFIG_TEST_DIRECTORY,entityType:r.ENTITY_AUTH_CONFIG_TEST,name:"AuthConfigTestDirectoryModel",showSuccessNotification:function(){},showLatencyNotification:function(){}}),F=n.extend({name:"AuthConfigDirectoryModel",urlRoot:E.AUTH_CONFIG_DIRECTORIES,entityType:r.ENTITY_AUTH_CONFIG,initialize:function(e){n.prototype.initialize.apply(this,arguments),this.on("destroy sync",function(){m.triggerAppEvent(m.DIRECTORY_SERVICE_LIST_UPDATED)})},validate:function(e){var t=[];if(this.validateRequiredFields(e)||t.push(this.i18n("allFieldsRequiredError")),c.isValidLDAP(e.directoryUrl)||t.push(this.i18n("wrongLDAPError")),t.length>0)return t.join("<br>")},validateRequiredFields:function(e){return _.every(_.values(e),$.trim)}}),H=n.extend({urlRoot:E.AUTH_CONFIG_AUTH_TYPES,entityType:r.ENTITY_AUTH_CONFIG,defaults:{authTypes:[]},toJSON:function(){return this.get("authTypes")}}),B=n.extend({idAttribute:C.NAME,urlRoot:E.AUTH_CONFIG_CLIENT_AUTH,entityType:r.ENTITY_AUTH_CONFIG,defaults:{chain:"",name:"",enableClientAuth:"false"},toJSON:function(){return l.convertPrimitiveToJSON(this.get("enableClientAuth"))},getNotificationMessage:function(e,n){if(n===r.NOTIFY_SUCCESS){var i=r.ENTITY_NAMES[this.entityType],s=r.ACTION_NAMES[e].toLowerCase();e===r.ACTION_CREATE?(i="Client Authentication",s=r.ACTION_UPDATE):e===r.ACTION_DELETE&&(i=this.get(C.NAME));var a=l.endsWith(s,"e")?"d.":"ed.";return t.MSG_GENERIC_SUCCESS({entityName:i,actionName:s,endingChars:a})}return t.MSG_GENERIC_ERROR}}),G=n.extend({idAttribute:C.CLIENT_AUTH_ID,urlRoot:E.AUTH_CONFIG_CLIENT_AUTH,entityType:r.ENTITY_AUTH_CONFIG,defaults:{autoLoginInfo:""},getNotificationMessage:function(e,n){if(n===r.NOTIFY_SUCCESS){var i=r.ACTION_NAMES[e].toLowerCase(),s=r.ENTITY_NAMES[this.entityType];void 0!==this.attributes.autoLoginInfo.enabled?s="CAC Authentication":e===r.ACTION_UPDATE&&(s="Service Account");var a=l.endsWith(i,"e")?"d.":"ed.";return t.MSG_GENERIC_SUCCESS({entityName:s,actionName:i,endingChars:a})}return t.MSG_GENERIC_ERROR}}),Y=n.extend({urlRoot:E.AUTH_CONFIG,entityType:r.ENTITY_AUTH_CONFIG,name:"AuthConfigModel",subModelHelper:null,defaults:{enableClientAuth:!1,authTypeList:[],directoryList:[]},initialize:function(e){n.prototype.initialize.apply(this,arguments);var t=new F,i=new H,s=new B,a=new G;this.subModelHelper=new d,this.subModelHelper.register("directory",t),this.subModelHelper.register("authTypes",i),this.subModelHelper.register("clientAuth",s),this.subModelHelper.register("serviceAccount",a),_.bindAll(this,"_onErrorSubModel","_onSyncSubModel"),this.subModelHelper.attachEventHandler("sync",this._onSyncSubModel),this.subModelHelper.attachEventHandler("error",this._onErrorSubModel)},_onErrorSubModel:function(e,t,n){var i="";_.isString(t)?i=t:_.isObject(t)&&t.responseText&&(i=l.processAjaxError(t.responseText)),this.trigger("error",i)},_onSyncSubModel:function(){this.fetch({alwaysTriggerChange:!0})},saveServiceAccount:function(e,t,n){var i=this.subModelHelper.get("serviceAccount");t(),i.isNew(!1),i.save(e,n)},configCACAuth:function(e,t){var n=this.subModelHelper.get("serviceAccount");n.isNew(!1),n.save({autoLoginInfo:{enabled:e}},t)},saveDirectory:function(e,t){var n=this.subModelHelper.get("directory");t?(n.actionMode=r.ACTION_CREATE,n.clear({silent:!0})):n.actionMode=r.ACTION_UPDATE,n.isNew(t),n.save(e)},deleteDirectory:function(e){var t=this.subModelHelper.get("directory");t.actionMode=r.ACTION_DELETE,t.isNew(!1),t.id=e.name,t.destroy()},deleteChainCert:function(e,t){var n=this.subModelHelper.get("clientAuth");n.isNew(!1),n.set({name:e}),n.destroy(t)},saveAuthTypes:function(e){var t=this.subModelHelper.get("authTypes");t.isNew(!1),t.save({authTypes:e})},configClientAuth:function(e,t){var n=this.subModelHelper.get("clientAuth");n.isNew(!0),n.save({enableClientAuth:e},t)},destroy:function(){this.subModelHelper.destroy(),n.prototype.initialize.destroy(this,arguments)}}),W=i.extend({url:E.AUTH_CONFIG_CLIENT_AUTH});return e.extend({TEMPLATE_STRING:"setting",el:"#popupAuthConfig",name:"AuthConfigPopupView",template:_.template(S),templateFormDirectory:_.template(I),templateList:_.template(w),templateDirectoryItem:_.template(A),templateAuthTypesList:_.template(b),selectedTab:D.TYPE.DIRECTORY,selectedDataId:null,clientAuthKeyModel:null,roleMappingNumbers:null,isFirstTime:!0,isFirstTimeIDPloaded:!0,isIDPFormActive:!1,events:{"click  .btnClose":"hide","click  .modal-header .close":"hide","click  .btnCreate":"onClickCreate","click .btnCreateIDP":"onClickCreateIDP","click  .btnEdit":"onClickEdit","click  .btnBack":"onClickBack","click  .btnSave":"onClickSave","click  .btnTest":"onClickTest","click  .btnSubmitTest":"onClickSubmitTest","click  .tabSelect":"onSelectTab","click  .checkboxAuthType":"onClickCheckboxAuthType","click  .checkboxChainCertificate":"onClickCheckboxChainCertificate","change #uploadChainCertificate":"onChangeFileNameInput",
"click  .checkboxClientAuth":"onClickCheckboxClientAuth","click  .configureChainCertificate .remove":"onClickChainDelete","click  .tableDirectory .btnDelete":"onClickDelete","click  .btnUpload":"onClickChainUpload","click  .idpDelete":"onClickIDPDelete","click  .idpEdit":"onClickIDPEdit","change .idpConfigType":"onIdpConfigTypeChange","change .idpMetadataFileInput":"onMetadataFileChange","click  .checkboxServiceAccount":"onClickCheckboxServiceAccount","click  .editSA":"onClickEditServiceAccount","click  .cancelServiceAccount":"onClickCancelServiceAccount","click  .saveServiceAccount":"onClickSaveServiceAccount","click  #checkboxCACAuth":"onClickConfigCACAuth","mouseover  div[ntnxTooltip]":"onToolTipMouseOver","mouseleave #authConfigDirectoryList  tr":"onToolTipMouseLeave","change .inputDirectoryType":"onDirectoryTypeChange"},modelEvents:{"change  model":"onModelChange","error   model":"onModelError","reset   clientAuthKeyModel":"onResetClientAuthKey","error   clientAuthKeyModel":"onModelError"},initialize:function(){e.prototype.initialize.apply(this,arguments),l.debug("AuthConfigPopView : initialize: "," | viewid     : ",this.cid),this.model=new Y,this.subModelHelper=new d,this.roleMappingNumbers=[],this.IDPCollection=new a,this.clusterManager.isMulticlusterNavMode()||(this.clientAuthKeyModel=new W)},render:function(){var e="",t=f.FEATURE_MAP.LICENSE_COMMON_ACCESS_CARD;if(f.violatedFeatureLicense(t)){var n=f.getPopupMessageTemplate(t);e=u.WARNING({msg:n})}var i=null!==this.clientAuthKeyModel,s=i?this.checkChainCert(this.clientAuthKeyModel.toJSON()):null,a=i?this.checkAutoLogin(this.clientAuthKeyModel.toJSON()):null,o=this.canModifyByEntityType(r.ENTITY_AUTH_CONFIG),l=!this.clusterManager.isMulticlusterNavMode();this.$el.html(this.defaultTemplate({title:this.i18n("titleAuthConfig"),tabs:l||i,tabsList:this.defaultTabs(this.getTabs(i)),bodyContent:this.template(this.vtOptions({canModify:o,model:this.model.toJSON(),selectedTab:this.selectedTab,chainCert:s,autoLogin:a,showClientAuthTab:i,cacLicenseWarning:e})),footerButtons:this.defaultFooter(this.getFooterButtons(o))})),this.showTab(this.selectedTab),this.checkIDPScreen(),this.selectedTab===D.TYPE.DIRECTORY&&(this.renderDirectoriesList(),this.renderIDPList()),this.selectedTab===D.TYPE.AUTH_TYPES&&this.renderAuthTypesList(),this.$(".role-mapping-icon").attr("ntnxTooltip","role_mapping"),this.createHelpIcon()},renderIDPList:function(){var e=this;this.clusterManager.isMulticlusterUI()&&(this._renderIDPList([]),this.IDPCollection.fetch({success:function(t){e.isFirstTimeIDPloaded=!1;var n=t.toJSON();e._renderIDPList(n)}}))},_renderIDPList:function(e){var t=this,n=this.canModifyByEntityType(r.ENTITY_AUTH_CONFIG),i=[],s=[{title:this.i18n("name")},{title:this.i18n("url")},{title:"&nbsp;"}];e&&e.length?i=_.map(e,function(e){return k({idpName:e.name,idpUrl:t.getTrimmedURL(e.idp_url),uuid:e.id})}):(i=[],this.isFirstTimeIDPloaded&&i.push(L(this.vtOptions())));var a=this.templateList(this.vtOptions({isCleanPopup:!0,className:"",dataTest:"add_idp_link",btnClass:"btnCreateIDP",btnText:this.i18n("btnNewIDP"),streamAction:"create",streamTarget:"new idp",tableId:"idpList",emptyText:this.i18n("msgNoIDPFound"),title:this.i18n("IDPs"),titleClass:"",tableHeaders:s,tableRows:i,dataTableTest:""})),o=this.$(".tableIDP");o.html(a),e.length>0&&this.$("a.btnCreateIDP").addClass("hidden"),n||(this.$("a.btnCreateIDP").addClass("hidden"),this.$("button.btnCreateIDP").addClass("hidden")),o.append(V(this.vtOptions())),this.$(".downloadSPMetadataTooltip").tooltip()},renderDirectoriesList:function(){var e=this,t=this.model.toJSON(),n=this.canModifyByEntityType(r.ENTITY_AUTH_CONFIG),i=[{title:this.i18n("name")},{title:this.i18n("colDomain")},{title:this.i18n("colUrl")},{title:"&nbsp;"}],s=void 0;t.directoryList&&t.directoryList.length?s=_.map(t.directoryList,function(t,i){return e.templateDirectoryItem(e.vtOptions({directory:t,idx:i,canModify:n,roleMappingNumbers:e.roleMappingNumbers,showTest:!e.clusterManager.isMulticlusterNavMode()}))}):(s=[],this.isFirstTime&&s.push(O(this.vtOptions())));var a=this.templateList(this.vtOptions({isCleanPopup:!0,className:"",btnClass:"btnCreate",btnText:this.i18n("btnNewDirectory"),dataTest:"",streamAction:"create",streamTarget:"new directory",tableId:"authConfigDirectoryList",dataTableTest:"",emptyText:this.i18n("msgNoDirectoryFound"),title:"Directories",titleClass:"",tableHeaders:i,tableRows:s}));this.$(".tableDirectory").html(a),n||this.$(".btnCreate").attr("disabled","disabled")},renderAuthTypesList:function(){var e=this.model.toJSON(),t=this.canModifyByEntityType(r.ENTITY_AUTH_CONFIG),n=this.templateAuthTypesList(this.vtOptions({model:e,canModify:t,authTypeList:D.AUTH_TYPES}));this.$(".tableAuthtypes").html(n)},getTrimmedURL:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:20;return e.length>t-3?e.substr(0,t-3)+"...":e},getTabs:function(e){var t=!this.clusterManager.isMulticlusterNavMode(),n=t||e,i=[{isActive:n&&this.selectedTab===D.TYPE.DIRECTORY,text:this.i18n("tabDirectoryList"),extraClasses:"tabSelect",extraAttr:[{key:r.NAV_ACTION,value:r.ACTION_SHOW_SUBVIEW},{key:r.NAV_ACTION_TARGET,value:D.TYPE.DIRECTORY},{key:"stream-action",value:"select"},{key:"stream-target",value:"directory list"}]}];return t&&i.push({isActive:this.selectedTab===D.TYPE.AUTH_TYPES,text:this.i18n("tabAuthenticationTypes"),extraClasses:"tabSelect",extraAttr:[{key:r.NAV_ACTION,value:r.ACTION_SHOW_SUBVIEW},{key:r.NAV_ACTION_TARGET,value:D.TYPE.AUTH_TYPES},{key:"stream-action",value:"select"},{key:"stream-target",value:"authentication types"}]}),e&&i.push({isActive:this.selectedTab===D.TYPE.CLIENT_AUTH,text:this.i18n("tabClient"),extraClasses:"tabSelect",extraAttr:[{key:r.NAV_ACTION,value:r.ACTION_SHOW_SUBVIEW},{key:r.NAV_ACTION_TARGET,value:D.TYPE.CLIENT_AUTH},{key:"stream-action",value:"select"},{key:"stream-target",value:"client"}]}),i},getFooterButtons:function(e){var t=[{text:this.i18n("back"),extraClasses:"btnFooter btnForm btnBack initially-hidden",leftAligned:!0,iconLeft:"caret-left"}];return e&&(t.push({text:this.i18n("btnTest"),extraClasses:"btnFooter btnForm btnSubmitTest btnOK initially-hidden",extraAttr:[{key:"data-loading-text",value:this.i18n("msgTesting")}]}),t.push({isPrimary:!0,text:this.i18n("save"),extraClasses:"btnFooter btnForm btnSave initially-hidden",extraAttr:[{key:"data-loading-text",value:this.i18n("saving")}]}),t.push({text:this.i18n("btnUpload"),extraClasses:"btnFooter btnUpload btnOK initially-hidden",extraAttr:[{key:"data-loading-text",value:this.i18n("msgUploading")}]})),t},checkChainCert:function(e){return e.length&&e[0][C.CA_CHAIN_INFO]&&e[0][C.CA_CHAIN_INFO].caChain?e[0][C.CA_CHAIN_INFO]:null},checkAutoLogin:function(e){return e.length&&e[0][C.AUTO_LOGIN_INFO]&&e[0][C.AUTO_LOGIN_INFO].serviceAccountDTO&&e[0][C.AUTO_LOGIN_INFO].serviceAccountDTO.username?e[0][C.AUTO_LOGIN_INFO]:null},show:function(t){e.prototype.show.apply(this,arguments),this.fetchModel()},showForm:function(e){var t=this.getData(e)||{};this.selectedTab===D.TYPE.DIRECTORY&&(this.$(".table"+this.selectedTab).hide(),this.$(".form"+this.selectedTab).show(),this.$(".tableIDP").hide(),this.showFormElements(),this.$(".form"+this.selectedTab).html(this.templateFormDirectory(this.vtOptions({dataId:e,model:t}))),this.setupTooltips())},setupTooltips:function(){this.$el.find(".searchTypeMoreInfo").nutanixMoreInfo({title:g.t(R,"searchTypeHelpText"),placement:"right"})},getData:function(e){var t;switch(this.selectedTab){case D.TYPE.DIRECTORY:t=e?this.model.get("directoryList")[e]:null;break;case D.TYPE.AUTH_TYPES:t=this.model.get("authTypeList");break;case D.TYPE.CLIENT_AUTH:t=this.clientAuthKeyModel.models[0].get(C.CA_CHAIN_INFO)[C.ENABLE_CLIENT_AUTH]}return t},processTest:function(e){var t={},n=this;t.directoryName=this.$(".inputDirName").val().trim(),t.username=this.$(".inputUsername").val().trim(),t.password=this.$(".inputPassword").val().trim(),U.validate||(U.validate=F.validate);var i=new U(t);this.showHeaderInfo("Performing authentication test..."),setTimeout(function(){i.save(null,{success:function(e,t){e.get(C.PRIMITIVE_KEY)?n.showHeaderSuccess("Authentication test successful."):n.showHeaderError("Authentication test failed.")},error:function(e,t){var i={};t&&(i=l.processSerializedObject(t.responseText));var s="Authentication test failed. "+(i.message||"");n.showHeaderError(s)}})},2e3)},showTestForm:function(e){this.clearHeader(),this.$("#authTestFormWrapper").html(_.template(y,{dirName:e})),this.tmpHeader=this.$(".n-title").text(),this.$(".n-title").text(this.i18n("titleTestConnection")),this.tmpBack=this.$(".btnBack").text(),this.$(".btnBack").text(this.i18n("back")),this.hideSubview("#authConfigMainPage"),this.showSubview("#authConfigTestForm","left"),this.$(".btnFooter").hide(),this.$(".btnBack").show(),this.$(".btnSubmitTest").show()},showChainListForm:function(){this.clearHeader(),this.hideSubview(".uploadContainer"),this.showSubview(".listContainer","left"),this.clientAuthKeyModel&&this.clientAuthKeyModel.fetch(),this.showMessageForLegacyBrowser()},hideTestForm:function(){this.clearHeader(),this.$(".n-title").text(this.tmpHeader),this.$(".btnBack").text(this.tmpBack),this.showSubview("#authConfigMainPage"),this.hideSubview("#authConfigTestForm","left"),this.$(".btnFooter").hide(),this.$(".btnClose").show()},onModelChange:function(e,t,n){this.model.getState()!==r.STATE_PENDING&&(this.hideInlineLoader(),this.enableSaveControls(),this.enableFormControls(),this.clientAuthKeyModel?this.clientAuthKeyModel.fetch():this.clusterManager.isMulticlusterNavMode()&&this.fetchRoleMapCollection())},fetchRoleMapCollection:function(){var e=this,t=this.model.toJSON().directoryList;this.subModelHelper.removeAll();for(var n=0;n<t.length;n++){var i=new s;i.setDirectoryName(t[n][C.NAME]),e.subModelHelper.register(t[n][C.NAME],i)}$.when.apply($,e.subModelHelper.iterate("fetch")).fail(function(){e.isFirstTime=!1,l.log("RoleMappingCollection: fetch: One or more of the requests failed for "+e.name)}).done(function(){e.isFirstTime=!1;for(var n=0;n<t.length;n++){var i=e.subModelHelper.get(t[n][C.NAME]).models;e.roleMappingNumbers[n]=i.length}}).always(function(){e.isFirstTime=!1,e.render()})},onResetClientAuthKey:function(e,t,n){this.isFirstTime=!1,this.fetchRoleMapCollection(),this.render(),this.selectedTab===D.TYPE.CLIENT_AUTH&&this.showMessageForLegacyBrowser()},onModelError:function(e,t,n){this.hideInlineLoader(),this.enableSaveControls(),this.enableFormControls(),_.isString(e)?this.showHeaderError(e):t&&t.responseText?this.showHeaderError(t.responseText):this.showHeaderError()},onClickToRoleMapping:function(e){e.data.context.clearHeader(),v.executeActionElement(e.target)},onToolTipMouseOver:function(e){var t=$(e.currentTarget),n=h.getRoleMappingLink();t.tooltip({title:n,placement:"right",trigger:"manual",html:!0}),t.tooltip("show"),$(".role-mapping-link").click({context:this},this.onClickToRoleMapping)},onToolTipMouseLeave:function(e){var t=$(e.currentTarget),n=t.find("div[ntnxTooltip]");$(n).tooltip("destroy")},onDirectoryTypeChange:function(){var e=this.getDirectoryTypeFromUI(),t="";e===r.OPEN_LDAP?(this.$(".open-ldap-form-fields").removeClass("hide"),t=c.RULE.REQUIRED):this.$(".open-ldap-form-fields").addClass("hide"),this.$(".open-ldap-form-fields [model-validate]").each(function(e,n){$(n).attr("model-validate",t)})},enableFormControls:function(){this.$(".formControl").removeAttr("disabled")},disableFormControls:function(){this.$(".formControl").attr("disabled","disabled")},showInlineLoader:function(){this.$(".n-inline-loading").show()},hideInlineLoader:function(){this.$(".n-inline-loading").hide()},enableSaveControls:function(){this.$(".btnSave").button("reset")},disableSaveControls:function(){this.$(".btnSave").button("loading")},showListElements:function(){this.$(".btnList").show(),this.$(".btnForm").hide(),this.$(".n-clearfix").show(),this.$(".n-message").show()},showFormElements:function(){this.$(".btnList").hide(),this.$(".btnForm").show(),this.$(".btnSubmitTest").hide(),this.$(".n-clearfix").hide(),this.$(".n-message").hide()},clientAuthElementsWhenDirty:function(){this.$(".btnList").hide(),this.$(".btnBack").show(),this.$(".btnUpload").show(),this.$(".n-clearfix").hide(),this.$(".n-message").show()},clientAuthListElementsWhenDirty:function(){this.$(".btnList").hide(),this.$(".btnBack").show(),this.$(".btnSave").show(),this.$(".n-clearfix").hide(),this.$(".n-message").show()},clientAuthElementsWhenClean:function(){this.$(".btnForm").hide(),this.$(".btnList").show(),this.$(".n-clearfix").hide(),this.$(".n-message").show(),this.$(".btnUpload").hide()},showMessageForLegacyBrowser:function(){l.isIE9OrBelow()&&this.showHeaderInfo("File uploads are not supported in this version of Internet Explorer. Please use Internet Explorer 10+, Chrome or Firefox (another option is to use the Nutanix command line interface).")},fetchModel:function(){this.model.fetch({alwaysTriggerChange:!0})},saveDirectory:function(){var e=this.validateFormValues();if(e&&e.length)return void this.onModelError(e);var t=_.isEmpty(this.$(".formDirectory .inputDataId").val());this.model.saveDirectory(this.getDirtyDirectoryModel(),t)},saveIDP:function(){var e=this,t=this.getIDPFormData(),n=this.getIDPIdFromUI(),i=this.IDPCollection.getSpecVersionById(n);t.spec_version=i;var s=new o(t),a=this.getIDPConfigTypeFromUI(),r=s.validate(a);r?(this.showHeaderError(r.join("<br/>"),null,!0),this.enableSaveControls()):s.save({success:this.render.bind(this),error:function(t){e.enableSaveControls()}})},validateFormValues:function(){var e=[],t=c.validateFormValues(this.$el);return t&&t.length&&(_.every(t,function(e){return e.valid})||e.push(this.i18n("all_fields_required"))),c.isValidLDAP(this.getDirectoryUrlFromUI())||e.push(this.i18n("wrongLDAPError")),e.join("<br>")},saveAuthTypes:function(){this.model.saveAuthTypes(this.getDirtyAuthTypesModel())},unlockServiceAccountForm:function(){this.$(".editSA").addClass("hide"),this.$(".checkboxServiceAccount").prop("disabled",!0),this.$(".configureServiceAccount .input-field").prop("disabled",!1),this.$(".configureServiceAccount .directoryConfigName").trigger("enable"),this.$(".configureServiceAccount .directoryConfigName").trigger("update"),this.$(".configureServiceAccount .saveServiceAccount, .configureServiceAccount .cancelServiceAccount, .configureServiceAccount .-actions").removeClass("disabled")},lockServiceAccountForm:function(){this.$(".editSA").removeClass("hide"),this.isAutoLoginEnabled()||this.$(".checkboxServiceAccount").prop("disabled",!1),this.$(".configureServiceAccount .input-field").prop("disabled",!0),this.$(".configureServiceAccount .directoryConfigName").trigger("disable"),this.$(".configureServiceAccount .saveServiceAccount, .configureServiceAccount .cancelServiceAccount, .configureServiceAccount .-actions").addClass("disabled")},getAutoLogin:function(){return null!==this.clientAuthKeyModel?this.checkAutoLogin(this.clientAuthKeyModel.toJSON()):null},isAutoLoginEnabled:function(){var e=this.getAutoLogin();return e&&e.enabled},removeServiceAccount:function(){var e=this,t={success:function(){e.$(".configureServiceAccount").toggle(),e.$(".configureServiceAccount .directoryConfigName").val(""),e.$(".configureServiceAccount .username").val(""),e.$(".configureServiceAccount .password").val(""),e.unlockServiceAccountForm(),e.$(".checkboxServiceAccount").prop("disabled",!1),e.$(".editSA").addClass("hide"),e.$("#checkboxCACAuth").prop("disabled",!0)},error:function(t,n){e.clearHeader(),e.showHeaderError(n.responseText)}};$.nutanixConfirm({msg:this.i18n("confirmRemoveServiceAccount"),yes:function(){this.model.saveServiceAccount(this.getCleanServiceAccountModel(),function(){e.$("#authConfigCover").show()},t)},no:function(){l.toggleCheckbox(e.$(".checkboxServiceAccount"))},yesText:this.i18n("yes"),noText:this.i18n("no"),context:this})},onClickConfigCACAuth:function(){var e,t=this,n={success:function(){t.clearHeader(),t.showReload(t.TEMPLATE_STRING,r.ROUTE_LOGOUT_RESTART)},error:function(e,n){t.clearHeader(),t.showHeaderError(n.responseText)}};e=this.isAutoLoginEnabled()?this.i18n("confirmDisableCACAuth"):this.i18n("confirmEnableCACAuth"),$.nutanixConfirm({msg:"<p>"+e+"</p><p>"+this.i18n("warningServerRestart")+"</p>",yes:function(){t.model.configCACAuth(t.getDirtyCACAuthModel(),n)},no:function(){l.toggleCheckbox(t.$("#checkboxCACAuth"))},yesText:this.i18n("yes"),noText:this.i18n("no"),context:this})},configClientAuth:function(){var e,t=null!==this.clientAuthKeyModel,n=t?this.checkChainCert(this.clientAuthKeyModel.toJSON()):null,i=this,s={success:function(){i.clearHeader(),i.showReload(i.TEMPLATE_STRING,r.ROUTE_LOGOUT_RESTART)},error:function(e,t){i.clearHeader(),i.showHeaderError(t.responseText)}};e=null!==n&&n[C.ENABLE_CLIENT_AUTH]?this.i18n("confirmDisableClientAuth"):this.i18n("confirmEnableClientAuth"),$.nutanixConfirm({msg:"<p>"+e+"</p><p>"+this.i18n("warningServerRestart")+"</p>",yes:function(){this.model.configClientAuth(this.getDirtyClientListAuthModel(),s)},no:function(){l.toggleCheckbox(i.$("#checkboxClientAuth"))},yesText:this.i18n("yes"),noText:this.i18n("no"),context:this})},deleteClientChain:function(e){var t=this,n={success:function(){t.clearHeader(),t.showReload(t.TEMPLATE_STRING,r.ROUTE_LOGOUT_RESTART)},error:function(e,n){t.clearHeader(),t.showHeaderError(n.responseText)}};this.model.deleteChainCert(e,n)},saveClientAuth:function(){var e={},t=this,n=this.$("#uploadChainCertificate").val().replace(/^.*[\\\/]/,"");this.$(".txtInfo").val(n),e.success=function(){t.clearHeader(),t.showReload(t.TEMPLATE_STRING,r.ROUTE_LOGOUT_RESTART)},e.error=function(e){t.clearHeader(),t.showHeaderError(e),t.resetSelectedFileName()},l.uploadFile(this.$("#uploadChainCertificate"),T.getFormattedURL(E.AUTH_CONFIG_CLIENT_AUTH_UPLOAD),e,this.$(".txtInfo"))},isCurrentFormDirty:function(){if(this.selectedTab===D.TYPE.AUTH_TYPES&&!this.canModifyByEntityType(r.ENTITY_AUTH_CONFIG))return!1;var e,t=!1,n=this.$(".form"+this.selectedTab+" :input"),i=this.$(".form"+this.selectedTab+" .inputDataId").val(),s=this.getData(i);if(null!==s&&void 0!==s){switch(this.selectedTab){case D.TYPE.DIRECTORY:e=this.getDirtyDirectoryModel();break;case D.TYPE.AUTH_TYPES:e=this.getDirtyAuthTypesModel();break;case D.TYPE.CLIENT_AUTH:e=this.getDirtyClientAuthModel()}t=!_.isEqual(s,e)}else{if(this.selectedTab===D.TYPE.CLIENT_AUTH)return this.getDirtyClientAuthModel();_.each(n,function(e){$(e).is(":text")&&$.trim($(e).val()).length&&(t=!0)})}return t},getCleanServiceAccountModel:function(){return{autoLoginInfo:{serviceAccountDTO:{directoryConfigName:this.$(".configureServiceAccount .directoryConfigName").val(),username:"",password:""}}}},getDirtyServiceAccountModel:function(){return{autoLoginInfo:{serviceAccountDTO:{directoryConfigName:this.$(".configureServiceAccount .directoryConfigName").val(),username:this.$(".configureServiceAccount .username").val(),password:this.$(".configureServiceAccount .password").val()}}}},getDirtyDirectoryModel:function(){var e,t=(e={name:this.$(".formDirectory .inputName").val().trim(),domain:this.$(".formDirectory .inputDomain").val().trim(),directoryUrl:this.$(".formDirectory .inputDirectoryUrl").val().trim(),groupSearchType:this.$(".formDirectory .groupSearchType").val(),directoryType:this.$(".formDirectory .inputDirectoryType").val().trim(),connectionType:this.$(".formDirectory .inputConnectionType").val().trim()},_defineProperty(e,C.SERVICE_ACCOUNT_USERNAME,this.getServiceAccountUsernameFromUI()),_defineProperty(e,C.SERVICE_ACCOUNT_PASSWORD,this.getServiceAccountPasswordFromUI()),e);return this.getDirectoryTypeFromUI()===r.OPEN_LDAP&&_.extend(t,this.getOpenLdapFormData()),t},getOpenLdapFormData:function(){var e;return _defineProperty({},C.OPEN_LDAP_CONFIG,(e={},_defineProperty(e,C.USER_OBJECT_CLASS,this.getUserObjectClassFromUI()),_defineProperty(e,C.USER_SEARCH_BASE,this.getUserSearchBaseFromUI()),_defineProperty(e,C.USER_NAME_ATTRIBUTES,this.getUsernameAttributeFromUI()),_defineProperty(e,C.GROUP_OBJECT_CLASS,this.getGroupObjectClassFromUI()),_defineProperty(e,C.GROUP_SEARCH_BASE,this.getGroupSearchBaseFromUI()),_defineProperty(e,C.GROUP_MEMBER_ATTRIBUTE,this.getGroupMemberAttributeFromUI()),_defineProperty(e,C.GROUP_MEMBER_ATTRIBUTE_VALUE,this.getGroupMemberAttributeValueFromUI()),e))},getIDPFormData:function(){var e=this.getIDPConfigTypeFromUI(),t={};return e===r.IDENTITY_PROVIDER.CONFIG_TYPE.MANUAL?t={id:this.getIDPIdFromUI(),name:this.getIDPNameFromUI(),idp_url:this.getIDPUrlFromUI(),login_url:this.getIDPLoginUrlFromUI(),logout_url:this.getIDPLogoutUrlFromUI(),error_url:this.getIDPErrorUrlFromUI(),certificate:this.getIDPCertificateFromUI()}:e===r.IDENTITY_PROVIDER.CONFIG_TYPE.METADATA&&(t={id:this.getIDPIdFromUI(),name:this.getIDPNameFromUI(),idp_metadata:this.getIDPMetadataFromUI()}),t},getIDPConfigTypeFromUI:function(){return this.$(".idpConfigType:checked").val()},getIDPIdFromUI:function(){return this.$(".IDPUuid").val().trim()},getIDPMetadataFromUI:function(){return this.$(".IDPMetadata").val().trim()},getIDPNameFromUI:function(){return this.$(".IDPName").val().trim()},getIDPUrlFromUI:function(){return this.$(".IDPUrl").val().trim()},getIDPLoginUrlFromUI:function(){return this.$(".IDPLoginUrl").val().trim()},getIDPLogoutUrlFromUI:function(){return this.$(".IDPLogoutUrl").val().trim()},getIDPErrorUrlFromUI:function(){return this.$(".IDPErrorUrl").val().trim()},getIDPCertificateFromUI:function(){return this.$(".IDPCertificate").val().trim()},getDirectoryUrlFromUI:function(){return this.$(".inputDirectoryUrl").val().trim()},getUserObjectClassFromUI:function(){return this.$(".inputUserObjectClass").val().trim()},getUserSearchBaseFromUI:function(){return this.$(".inputUserSearchBase").val().trim()},getUsernameAttributeFromUI:function(){return this.$(".inputUsernameAttribute").val().trim()},getGroupObjectClassFromUI:function(){return this.$(".inputGroupObjectClass").val().trim()},getGroupSearchBaseFromUI:function(){return this.$(".inputGroupSearchBase").val().trim()},getGroupMemberAttributeFromUI:function(){return this.$(".inputGroupMemberAttribute").val().trim()},getGroupMemberAttributeValueFromUI:function(){return this.$(".inputGroupMemberAttributeValue").val().trim()},getServiceAccountUsernameFromUI:function(){return this.$(".inputServiceAccountUsername").val().trim()},getServiceAccountPasswordFromUI:function(){return this.$(".inputServiceAccountPassword").val().trim()},getDirectoryTypeFromUI:function(){return this.$(".inputDirectoryType").val()},getDirtyAuthTypesModel:function(){var e=[];return _.each(this.$(".tableAuthtypes .checkboxAuthType:checked"),function(t){e.push($(t).val())}),e},getDirtyClientAuthModel:function(){return this.$("#clientAuthList").is(":visible")?this.getDirtyClientListAuthModel():this.getDirtyClientUploadAuthModel()},getDirtyClientListAuthModel:function(){return this.$(".tabPaneClientauth .listContainer .checkboxClientAuth").is(":checked")},getDirtyCACAuthModel:function(){return this.$(".tabPaneClientauth #checkboxCACAuth").is(":checked")},getDirtyClientUploadAuthModel:function(){return $.trim(this.$(".tabPaneClientauth #uploadChainCertificate").val()).length>0},onSelectTab:function(e){var t=$(e.currentTarget),n=t.attr(r.NAV_ACTION_TARGET);if(n&&n!==this.selectedTab){if((this.$(".form"+D.TYPE.DIRECTORY).is(":visible")||this.selectedTab===D.TYPE.AUTH_TYPES||this.selectedTab===D.TYPE.CLIENT_AUTH)&&this.isCurrentFormDirty()&&!confirm("You haven't saved your changes. Do you really want to leave?"))return;this.selectedTab!==D.TYPE.AUTH_TYPES&&this.selectedTab!==D.TYPE.CLIENT_AUTH||!this.isCurrentFormDirty()||this.fetchRoleMapCollection(),this.clearHeader(),this.$(".table"+this.selectedTab).show(),this.$(".form"+this.selectedTab).hide(),this.selectedTab=n,this.$(M({actionTarget:n})).tab("show"),this.showTab(n),this.$(".form"+n).is(":visible")?this.showFormElements():(this.showChainListForm(),this.showListElements())}},showTab:function(e){this.$(".tabPane").hide(),this.$(".tabPane"+e).show()},onClickCreate:function(e){this.clearHeader(),this.showForm()},onIdpConfigTypeChange:function(){var e=this.getIDPConfigTypeFromUI();e===r.IDENTITY_PROVIDER.CONFIG_TYPE.METADATA?(this.$(".idpMetadataSection").removeClass("hide"),this.$(".idpManualConfigSection").addClass("hide")):e===r.IDENTITY_PROVIDER.CONFIG_TYPE.MANUAL&&(this.$(".idpManualConfigSection").removeClass("hide"),this.$(".idpMetadataSection").addClass("hide"))},onMetadataFileChange:function(){var e=this,t=this.$(".idpMetadataFileInput")[0].files[0];t&&l.readFileSync(t,function(){e.$(".IDPMetadata").val(arguments.length<=0?void 0:arguments[0]),e.$(".idpMetadataFileName").text(t.name)},function(){l.log("Error occured while reading the contents of file.")})},onClickCreateIDP:function(){this.clearHeader(),this.showIDPForm()},showIDPForm:function(e){var t=this.IDPCollection.findModelById(e),n=t?t.toJSON():{};this.selectedTab===D.TYPE.DIRECTORY&&(this.$(".table"+this.selectedTab).hide(),this.$(".tableIDP").hide(),this.$(".formIDP").show(),this.showFormElements(),this.$(".formIDP").html(x(this.vtOptions({model:n}))),this.isIDPFormActive=!0)},onClickChainUpload:function(e){var t=this,n=this.$(".filename").text();$.nutanixConfirm({msg:"<p>"+this.i18n("confirmUploadChainCert")+'</p><p>  <span class="bold">'+n+"</span></p><p>"+this.i18n("warningServerRestart")+"</p>",yes:function(){this.clearHeader(),this.saveClientAuth()},no:function(){t.resetSelectedFileName()},yesText:this.i18n("yes"),noText:this.i18n("no"),context:this})},resetSelectedFileName:function(){var e=null!==this.clientAuthKeyModel,t=e?this.checkChainCert(this.clientAuthKeyModel.toJSON()):null,n=this.$(".filename"),i=this.$("#uploadChainCertificate");i.replaceWith(i=i.clone(!0)),n.empty(),t?n.text(t.name):n.text(this.i18n("msgNoFileChosen"))},onClickEdit:function(e){var t=$(e.currentTarget).closest("tr").attr("dataid");this.showForm(t)},onClickDelete:function(e){var t=$(e.currentTarget).closest("tr").attr("dataid"),n=this.getData(t);$.nutanixConfirm({msg:this.i18n("confirmDeleteDirectory"),yes:function(){this.selectedTab===D.TYPE.DIRECTORY&&this.model.deleteDirectory(n)},yesText:this.i18n("yes"),noText:this.i18n("no"),context:this})},onClickIDPEdit:function(e){var t=$(e.currentTarget).closest("tr").attr("data-id");this.showIDPForm(t)},onClickIDPDelete:function(e){var t=$(e.currentTarget).closest("tr").attr("data-id");$.nutanixConfirm({msg:this.i18n("idpDeleteConfirmation"),yes:function(){this.IDPCollection.findModelById(t).destroy({success:this.render.bind(this),error:function(e){}})},yesText:this.i18n("yes"),noText:this.i18n("no"),context:this})},onClickChainDelete:function(e){var t=$(e.currentTarget).closest("tr").attr("dataid");$.nutanixConfirm({msg:"<p>"+this.i18n("confirmDeleteChainCert")+"</p><p>"+this.i18n("warningServerRestart")+"</p>",yes:function(){this.selectedTab===D.TYPE.CLIENT_AUTH&&this.deleteClientChain(t)},yesText:this.i18n("yes"),noText:this.i18n("no"),context:this})},onClickSave:function(){switch(this.disableSaveControls(),this.selectedTab){case D.TYPE.DIRECTORY:this.isIDPFormActive?this.saveIDP():this.saveDirectory();break;case D.TYPE.AUTH_TYPES:this.saveAuthTypes();break;case D.TYPE.CLIENT_AUTH:this.configClientAuth()}},onClickBack:function(e){this.clearHeader(),this.$("#authTestForm").is(":visible")?this.hideTestForm():this.selectedTab===D.TYPE.AUTH_TYPES?this.fetchRoleMapCollection():this.selectedTab===D.TYPE.CLIENT_AUTH?this.fetchRoleMapCollection():(this.$(".table"+this.selectedTab).show(),this.$(".form"+this.selectedTab).hide(),this.$(".tabPane > .btnCreate").show(),this.checkIDPScreen(),this.showListElements())},checkIDPScreen:function(){this.selectedTab===D.TYPE.DIRECTORY&&(this.$(".formIDP").hide(),this.$(".tableIDP").show()),this.isIDPFormActive=!1},onClickSubmitTest:function(){this.processTest()},onClickTest:function(e){var t=this.model.get("directoryList"),n=parseInt($(e.currentTarget).closest("tr").attr("dataid"),10);if(!t||0===t.length||!t[n]||!t[n].name)return void l.log("AuthConfigPopupView.onClickTest: There is no tested directory name in model or directory list is empty.");this.clearHeader(),this.showTestForm(t[n].name)},onClickCheckboxAuthType:function(e){this.isCurrentFormDirty()?this.showFormElements():this.showListElements()},onChangeFileNameInput:function(e){var t="",n=this.$(".filename");$(e.currentTarget).val()&&(t+=$(e.currentTarget).val().split("\\").pop(),n.empty(),n.text(t),this.$(".selectedUploadFiles").show(),this.onClickChainUpload())},onClickCheckboxChainCertificate:function(e){this.checkChainCert(this.clientAuthKeyModel.toJSON())?(this.$(".configureChainCertificate .remove").click(),this.$(".checkboxChainCertificate").attr("checked",!0)):this.$(".configureChainCertificate").toggle()},onClickCheckboxServiceAccount:function(e){""!==this.$(".configureServiceAccount .username").val()||""!==this.$(".configureServiceAccount .password").val()?this.removeServiceAccount():this.$(".configureServiceAccount").toggle()},onClickEditServiceAccount:function(e){this.unlockServiceAccountForm()},onClickCancelServiceAccount:function(e){this.clearHeader();var t,n,i,s=this.model.subModelHelper.get("serviceAccount"),a=this.getAutoLogin(),o=s.get("autoLoginInfo")||a;o&&(t=o.serviceAccountDTO.directoryConfigName,n=o.serviceAccountDTO.username,i=o.serviceAccountDTO.password),n&&i?(this.$(".configureServiceAccount .directoryConfigName").val(t),this.$(".configureServiceAccount .directoryConfigName").trigger("update"),this.$(".configureServiceAccount .username").val(n),this.$(".configureServiceAccount .password").val(i),this.lockServiceAccountForm()):(this.$(".configureServiceAccount").toggle(),l.toggleCheckbox(this.$(".checkboxServiceAccount")),this.$(".configureServiceAccount .username").val(""),this.$(".configureServiceAccount .password").val(""))},onClickSaveServiceAccount:function(){var e=this,t={success:function(){e.clearHeader(),e.$("#checkboxCACAuth").prop("disabled",!1),e.$(".saveServiceAccount:not(.inline-check)").prepend(p.inlineCheck),e.$(".saveServiceAccount").addClass("saved disabled inline-check"),e.$(".configureServiceAccount").addClass("disabled"),l.onAnimationEnd(e.$(".saveServiceAccount"),function(t){e.lockServiceAccountForm(),e.$(".saveServiceAccount").removeClass("saved disabled"),e.$(".configureServiceAccount").removeClass("disabled")})},error:function(t,n){e.clearHeader(),e.showHeaderError(n.responseText)}},n=this.$(".configureServiceAccount .username").val(),i=this.$(".configureServiceAccount .password").val();n&&i?c.isValidServiceUsername(n)?this.model.saveServiceAccount(this.getDirtyServiceAccountModel(),function(){e.$("#authConfigCover").show()},t):(this.clearHeader(),this.showHeaderError(this.i18n("invalid_username"))):(this.clearHeader(),this.showHeaderError(this.i18n("missing_username_password")))},onClickCheckboxClientAuth:function(e){this.isCurrentFormDirty()?this.configClientAuth():this.clientAuthElementsWhenClean()},destroy:function(){this.subModelHelper&&this.subModelHelper.removeAll(),this.$(".downloadSPMetadataTooltip").tooltip("destroy"),e.prototype.destroy.apply(this,arguments)}})}),define("text!templates/popups/lockdown/LockDownContentView.html",[],function(){
return"\x3c!-- The parent div modal is #popupAuthConfig --\x3e\n<div data-ntnx-content-inner>\n  <% if (initialized) { %>\n    <section data-ntnx-section class=\"lock-status\">\n      <% if (isUnlocked) { %>\n      <span class=\"n-lock-icon unlocked\"></span>\n      <h5 data-ntnx-title>\n        <%= i18n('cluster_unlocked') %>\n      </h5>\n      <% } else { %>\n      <span class=\"n-lock-icon locked\"></span>\n      <h5 data-ntnx-title>\n        <%= i18n('cluster_locked') %>\n      </h5>\n      <% } %>\n    </section>\n  <% } %>\n\n  <% if (canModify && initialized) { %>\n    <section data-ntnx-section=\"type-text\">\n      <%= i18n('summary') %>\n      <% if (isUnlocked) { %>\n        <%= i18n('cluster_unlocked_desc') %>\n      <% } else { %>\n        <%= i18n('cluster_locked_desc') %>\n      <% } %>\n    </section>\n  <% } %>\n\n  \x3c!-- Tabs --\x3e\n  <div class=\"n-popup-tabs tabbable tabs-top\">\n\n    \x3c!-- Tab Header --\x3e\n    <ul class=\"n-nav-tab\" style=\"display:none\">\n      <li class=\"tab tab-keys\n        <%= selectedTab === 'keys' ? 'active' : '' %>\"\n        data-target=\"keys\">\n        <%= i18n('public_keys') %>\n      </li>\n    </ul>\n\n    \x3c!-- Tab Body --\x3e\n    <div class=\"tab-content user-form-tabs-content\">\n\n      \x3c!-- Tab Content: Lockdown --\x3e\n      <div class=\"tab-pane tab-pane-keys\n        <%= selectedTab === 'keys' ? 'active' : '' %>\">\n        <div style=\"display: none\">\n        </div>\n\n        <% if (!initialized) { %>\n\n          <section data-ntnx-section class=\"n-message loading\">\n            <%= i18n('loading') %>\n          </section>\n\n        <% } else { %>\n\n          <% if (canModify) { %>\n            \x3c!-- Enable Password Remote Login --\x3e\n            <section data-ntnx-section\n              class=\"n-enable-password\">\n              <div data-ntnx-form-inline>\n                <%= Components.checkbox({\n                    id: 'checkboxRemoteLoginPassword',\n                    jsClasses: 'checkboxPassword',\n                    name: 'checkboxPassword',\n                    checked: enablePassword ? 'checked' : '',\n                    labelText : i18n('enable_remote_login_with_password')\n                }) %>\n              </div>\n            </section>\n\n            \x3c!-- Create SSH Key --\x3e\n            <section data-ntnx-section class=\"btnList\">\n              <%= Components.button({\n                extraClasses  : 'btnCreate formControl',\n                text          : i18n('new_public_key'),\n                iconLeft      : 'plus',\n                extraAttr     : [{\n                                  key: 'data-target',\n                                  value: 'keys'\n                                }]\n              }) %>\n\n            </section>\n          <% } %>\n\n          \x3c!-- List of SSH Keys --\x3e\n          <% if (keys && keys.length) { %>\n            <section data-ntnx-section class=\"table-keys\">\n              <table\n                  class=\"table table-hover\">\n                <thead>\n                  <tr>\n                    <th><%= i18n('name') %></th>\n                    <th><%= i18n('key') %></th>\n                    <th> </th>\n                  </tr>\n                </thead>\n                <tbody>\n                <% _.each(keys, function(model, idx) {  %>\n                  <tr class=\"n-table-row\" data-id=\"<%= model.name %>\">\n                    <td>\n                      <%= model.name || '' %>\n                    </td>\n                    <td>\n                      <%= (model.key || '').substring(0, 30) + '...' %>\n                    </td>\n                    <td class=\"cell-actions\">\n                      <% if (canModify) { %>\n                        <i dataId='<%= model.name %>' class='btnDelete'\n                           data-icon=\"v\" aria-hidden=\"true\" ></i>\n                      <% } %>\n                    </td>\n                  </tr>\n                <% }); %>\n                </tbody>\n              </table>\n            </section>\n          <% } else { %>\n\n            \x3c!-- Empty list --\x3e\n            <section data-ntnx-section class=\"n-message\">\n              <table class=\"table table-hover\">\n                <thead>\n                  <tr>\n                    <th><%= i18n('name') %></th>\n                    <th><%= i18n('key') %></th>\n                    <th> </th>\n                  </tr>\n                </thead>\n                <tbody>\n                <tr>\n                  <td><%= i18n('no_keys_found') %></td>\n                  <td></td>\n                  <td></td>\n                </tr>\n                </tbody>\n              </table>\n            </section>\n\n          <% } %>\n\n          \x3c!-- Directory Form --\x3e\n          <div class=\"hide form-keys\">\n            \x3c!-- NOTE: Form will be added here. --\x3e\n          </div>\n\n        <% } %>\n      </div>\n    </div>\n\n    \x3c!-- Cover --\x3e\n    <div class=\"n-cover\" style=\"display: none\">\n    </div>\n  </div>\n</div>"}),define("text!templates/popups/lockdown/PublicKeyFormView.html",[],function(){return'\x3c!-- Public Key Form --\x3e\n<form id="lockdownFormPublicKey">\n  <input type="hidden" class="inputDataId" value="<%= model.name || \'\' %>">\n  <section data-ntnx-section>\n    <label data-ntnx-inline-label for="inputName"><%= i18n(\'name\') %></label>\n    <input type="text" class="inputName"\n      value="<%= model.name || \'\' %>"\n      <%= model.name ? \'disabled\' : \'\' %>>\n  </section>\n  <section data-ntnx-section>\n    <label data-ntnx-inline-label for="inputKey"><%= i18n(\'key\') %></label>\n    <textarea rows="6" cols="200" class="textareaKey"></textarea>\n  </section>\n</form>'}),define("views/popups/lockdown/LockDownPopupView",["views/basecomponents/popups/BasePopupView","models/BaseModel","models/BaseCollection","models/cluster/ClusterModel","managers/LicenseManager","data/DataURLConstants","data/DataProperties","utils/AppConstants","utils/AppUtil","text!templates/popups/lockdown/LockDownContentView.html","text!templates/popups/lockdown/PublicKeyFormView.html"],function(e,t,n,i,s,a,o,r,l,c,d){"use strict";var p={KEY_NAME_DEFAULT:"default",TYPE:{KEYS:"keys"}},u=t.extend({urlRoot:a.PUBLIC_KEYS_LOCKDOWN,entityType:r.ENTITY_CLUSTER_LOCKDOWN,defaults:{enabled:!1},toJSON:function(){return l.convertPrimitiveToJSON(this.get("enabled"))}}),h=t.extend({name:"PublicKeyModel",idAttribute:o.NAME,urlRoot:a.PUBLIC_KEYS,entityType:r.ENTITY_CLUSTER_PUBLIC_KEY,defaults:{name:null,key:null},validate:function(e){var t="";if(0!==$.trim(e.name).length&&0!==$.trim(e.key).length||(t+=this.i18n("name_key_required")),$.trim(t).length>0)return t}}),m=n.extend({model:h,url:a.PUBLIC_KEYS});return e.extend({el:"#popupLockDown",name:"LockDownPopupView",template:_.template(c),templateFormKey:_.template(d),initialized:!1,selectedDataId:null,keyCollection:null,keyModel:null,clusterModel:null,selectedTab:p.TYPE.KEYS,events:{"click  .btnClose":"discardChanges","click  .modal-header .close":"hide","click  .btnCreate":"onClickCreate","click  .btnEdit":"onClickEdit","click  .btnDelete":"onClickDelete","click  .btnBack":"onClickBack","click  .btnSave":"onClickSave","click  .n-nav-tab  li ":"onSelectTab","change .checkboxPassword":"onSetEnablePassword"},modelEvents:{"change  model":"onModelChange","error   model":"onModelError","sync    keyModel":"onModelChange","error   keyModel":"onModelError"},initialize:function(){e.prototype.initialize.apply(this,arguments),this.model=new u,this.keyModel=new h,this.keyCollection=new m,this.clusterModel=new i,this.clusterModel.isAlwaysMulticluster=!1,this.clusterModel.urlRoot=a.CLUSTER,this.clusterModel.url=function(){return a.CLUSTER},this.clusterModel.on("change",this.onClusterModelChange,this),this.clusterModel.on("error",this.onModelError,this)},render:function(){var e=this.keyCollection.length||this.clusterModel.get(o.CLUSTER_ENABLE_PASSWORD),t=this.canModifyByEntityType(r.ENTITY_CLUSTER_LOCKDOWN),n=[{leftAligned:!0,iconLeft:"caret-left",text:this.i18n("back"),extraClasses:"btnBack btnForm hide"},{text:this.i18n("cancel"),extraClasses:"btnClose btnForm hide"}];t&&n.push({isPrimary:!0,text:this.i18n("save"),extraClasses:"btnSave btnForm hide",extraAttr:[{key:"data-loading-text",value:"Saving..."}]}),this.$el.html(this.defaultTemplate({antiscroll:!1,title:this.i18n("title_cluster_lockdown"),bodyContent:this.template(this.vtOptions({initialized:this.initialized,canModify:t,selectedTab:this.selectedTab,enablePassword:this.clusterModel.get(o.CLUSTER_ENABLE_PASSWORD),keys:this.keyCollection.toJSON(),isUnlocked:e})),footerButtons:this.defaultFooter(n)})),this.clearHeader();var i=s.FEATURE_MAP.LICENSE_LOCK_DOWN;if(this.initialized&&!e&&s.violatedFeatureLicense(i)){var a=s.getPopupMessageTemplate(i);this.showHeaderWarning(a)}this.createHelpIcon();var l=this.clusterManager.isMulticlusterUI()?r.ENTITY_NAMES[r.ENTITY_PC_VM]:r.ENTITY_NAMES[r.ENTITY_CVM];this.triggerAction(r.MODAL.ACT.ALERT_SHOW,{type:r.MODAL.ALERT.TYPE_WARNING,message:this.i18ns("summary_tooltip",{entityName:l}),closeTiming:r.MODAL.ALERT.CLOSE_TYPE_PERMANENT})},show:function(t){this.initialized=!1,e.prototype.show.apply(this,arguments),this.fetchData()},showForm:function(e){var t=void 0,n=this.getDataModel(e)||{};this.selectedTab===p.TYPE.KEYS&&(t=this.templateFormKey,this.$(".table-"+this.selectedTab).hide(),this.$(".form-"+this.selectedTab).show(),this.showFormElements(),this.$(".form-"+this.selectedTab).html(t(this.vtOptions({model:n}))))},getDataModel:function(e){var t=void 0;return this.selectedTab===p.TYPE.KEYS&&(t=e?this.keyCollection.get(e):null),t},destroy:function(){this.clusterModel.off("change",this.onClusterModelChange,this),this.clusterModel.off("error",this.onModelError,this),this.$(".tooltip-wrapper").nutanixMoreInfo("destroy"),e.prototype.destroy.apply(this,arguments)},onModelChange:function(e){this.fetchData()},onModelError:function(e,t,n){this.hideCover(),this.hideInlineLoader(),this.enableSaveControls(),this.enableFormControls(),this.showHeaderError(e,t,n)},onKeyCollectionReset:function(){this.hideCover(),this.hideInlineLoader(),this.enableSaveControls(),this.enableFormControls(),this.initialized=!0,this.render()},onClusterModelChange:function(e){this.hideCover(),this.hideInlineLoader(),this.enableSaveControls(),this.enableFormControls(),this.initialized=!0,this.render()},enableFormControls:function(){this.$(".formControl").removeAttr("disabled")},disableFormControls:function(){this.$(".formControl").attr("disabled","disabled")},showInlineLoader:function(){this.$(".n-inline-loading").show()},hideInlineLoader:function(){this.$(".n-inline-loading").hide()},showCover:function(){this.$(".n-cover").show()},hideCover:function(){this.$(".n-cover").hide()},enableSaveControls:function(){this.$(".btnSave").button("reset")},disableSaveControls:function(){this.$(".btnSave").button("loading")},showListElements:function(){this.$(".btnList, .n-message, .n-enable-password").show(),this.$(".btnForm").hide()},showFormElements:function(){this.$(".btnList, .n-message, .n-enable-password").hide(),this.$(".btnForm").show()},fetchData:function(){var e=this,t=[];t.push(this.keyCollection.fetch()),t.push(this.clusterModel.fetch()),$.whenAll.apply($,t).done(function(){e.onKeyCollectionReset()}).fail(function(){e.onModelError()})},saveKey:function(){this.keyModel.isNew(!0),this.keyModel.actionMode=null,this.keyModel.save(this.getDirtyKeyModel())},isCurrentFormDirty:function(){var e=!1,t=this.$(".form-"+this.selectedTab+" :input"),n=this.$(".form-"+this.selectedTab+" .inputDataId").val(),i=this.getDataModel(n),s=void 0;return i?(this.selectedTab===p.TYPE.KEYS&&(s=this.getDirtyKeyModel()),e=!_.isEqual(i,s)):_.each(t,function(t){$(t).is(":text")&&$.trim($(t).val()).length&&(e=!0)}),e},getDirtyKeyModel:function(){return{name:this.$(".form-keys .inputName").val(),key:this.$(".form-keys .textareaKey").val()}},onSelectTab:function(e){var t=$(e.currentTarget).attr("data-target");if(t&&t!==this.selectedTab){var n=this,i=function(){n.clearHeader(),n.$(".table-"+n.selectedTab).show(),n.$(".form-"+n.selectedTab).hide(),n.selectedTab=t,n.$(".n-nav-tab  li").removeClass("active"),n.$(".tab-content .tab-pane").removeClass("active"),n.$(".n-nav-tab  li.tab-"+t).addClass("active"),n.$(".tab-content .tab-pane-"+t).addClass("active"),n.$(".form-"+t).is(":visible")?n.showFormElements():n.showListElements()};n.$(".form-"+p.TYPE.KEYS).is(":visible")&&n.isCurrentFormDirty()?$.nutanixConfirm({msg:n.i18n("unsaved_changes_msg"),yes:i}):i()}},onClickCreate:function(e){this.clearHeader(),this.showForm()},onClickEdit:function(e){var t=$(e.currentTarget).attr("dataId");this.showForm(t)},onClickDelete:function(e){var t=this.i18n("delete_key_confirm_msg"),n=r.DELETE_WARNING_MESSAGES[r.ENTITY_CLUSTER_PUBLIC_KEY];n&&(t+="<br><br>"+n),$.nutanixConfirm({msg:t,context:this,yes:function(){var t=$(e.currentTarget).attr("dataId"),n=this.getDataModel(t);n&&(this.showCover(),this.selectedTab===p.TYPE.KEYS&&(this.keyModel.isNew(!1),this.keyModel.set(n.toJSON(),{silent:!0}),this.keyModel.id=n.get(o.NAME),this.keyModel.destroy()))}})},onClickSave:function(){this.disableSaveControls(),this.selectedTab===p.TYPE.KEYS&&this.saveKey()},onSetEnablePassword:function(e){var t=$(e.currentTarget).prop("checked"),n=t?"enable":"disable";$.nutanixConfirm({context:this,msg:this.i18ns("remote_access_action_confirm_msg",n),yes:function(){this.showCover(),this.clusterModel.set(o.CLUSTER_ENABLE_PASSWORD,t,{silent:!0}),this.clusterModel.save()},no:function(){$(e.currentTarget).prop("checked",!t)}})},onClickBack:function(e){this.clearHeader(),this.$(".table-"+this.selectedTab).show(),this.$(".form-"+this.selectedTab).hide(),this.showListElements()}})}),define("text!templates/popups/multicluster/filters/MulticlusterFilterPopupView.html",[],function(){return'\x3c!-- The parent div modal is #popupMulticlusterFilter --\x3e\n<div class="modal-header">\n  <button type="button" class="close" data-dismiss="modal">\n    <i data-icon="v" aria-hidden="true"></i>\n  </button>\n  <h4 class="n-title">Data Policies</h4>\n</div>\n\n<div class="n-modal-wrapper">\n  <div class="n-modal-body">\n    <div class="n-modal-content-wrapper">\n      <div class="n-modal-filter-header">\n      </div>\n      <div class="n-modal-content listContainer">\n        <% if (canModify) { %>\n          <div class="n-popup-description">\n            Configure multicluster data collection policies which control how\n            stats data is transferred to the multicluster server.\n            <span class="n-modal-loading" style="display:none;">\n              ( <span class="n-loading-text">Loading data...&nbsp;</span>\n              <img src="./app/assets/images/spinners/loading.gif"\n                width="16px" height="16px"> )\n            </span>\n          </div>\n        <% } %>\n        <div class="antiscroll-wrap n-filter-antiscroll" >\n          <div class="box-wrap" >\n            <div class="antiscroll-inner" >\n              <div class="box-inner  n-content-inner" >\n                <table id="multiclusterFilterList" class="table table-hover">\n                  <thead>\n                    <tr>\n                      <th>Cluster Name</th>\n                      <th>Stats detail</th>\n                    </tr>\n                  </thead>\n                  <tbody>\n                    \x3c!-- @view: filters go here... --\x3e\n                  </tbody>\n                </table>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n      <div class="n-modal-content formContainer"  style="display:none;">\n        <div id="multiclusterFilterForm">\n          \x3c!-- @view: form goes here... --\x3e\n        </div>\n      </div>\n    </div>\n  </div>\n  <div class="n-modal-footer">\n    <button class="btnClose btn n-btn-form -blue">\n      Close\n    </button>\n    <button class="btnBack btn n-btn-form pull-left" style="display:none;">\n      <i class="form2Element icon-chevron-left"></i> Back\n    </button>\n    <button class="btnCancel btn n-btn-form" style="display:none;">\n      Cancel\n    </button>\n    <% if (canModify) { %>\n      <button class="btnSave btn n-btn-form"\n              style="display:none;"\n              data-loading-text="Saving...">\n        Save\n      </button>\n    <% } %>\n  </div>\n</div>'}),define("text!templates/popups/multicluster/filters/MulticlusterFilterItemView.html",[],function(){return'<tr class="n-table-row">\n  <td>\n    <div class="n-name-wrapper">\n      <%= model.name %>\n     </div>\n  </td>\n  <td class="n-detail-wrapper">\n    <div>\n      <%= model.detail %>\n    </div>\n  </td>\n</tr>'}),define("text!templates/popups/multicluster/filters/MulticlusterFilterFormView.html",[],function(){return'\x3c!-- Multicluster Filter Form --\x3e\n<form id="multiclusterFilterForm" class="form-horizontal">\n  <div class="columnLeft">\n    <div class="control-group">\n      <label class="control-label" for="inputName">Name</label>\n      <div class="controls">\n        <input type="text" class="inputSeverity"\n          value="<%= model.get(\'name\') %>" disabled>\n      </div>\n    </div>\n    <div class="control-group">\n      <label class="control-label" for="inputMessage">Detail</label>\n      <div class="controls">\n        <input type="text" class="inputDetail"\n          value="<%= model.get(\'detail\') %>">\n      </div>\n    </div>\n  </div>\n  <div class="columnRight">\n    <div class="control-group">\n      <label class="control-label inputFrequencyLabel" for="inputFrequency">\n        Frequency\n      </label>\n      <div class="controls n-frequency-controls">\n        <div class="n-frequency-desc">Check alert condition once every:</div>\n        <input type="radio" name="inputFrequencyType"\n          class="inputSystemFrequency inputFrequencyType"\n          value="true" <%= model.isUserDefinedFrequency() ? "" : "checked" %>>\n        <label style="display:inline-block;"\n          for="inputSystemFrequency">System default</label><br>\n        <div class="inputSystemFrequencyValue"></div>\n        <input type="radio" name="inputFrequencyType"\n          class="inputUserFrequency inputFrequencyType"\n          value="false" <%= model.isUserDefinedFrequency() ? "checked" : "" %>>\n        <label style="display:inline-block;margin-top:15px;"\n          for="inputUserFrequency">\n          User defined\n        </label>\n        <div class="inputUserFrequencyWrapper">\n          <input type="text" class="inputFrequency" value="">\n          <select class="n-units">\n            <option value="day" selected>Day(s)</option>\n            <option value="hour">Hour(s)</option>\n          </select>\n        </div>\n      </div>\n    </div>\n    <div class="control-group">\n      <label class="control-label" for="inputEnabled">Enabled</label>\n      <div class="controls n-radio-enabled">\n        <input type="radio" name="inputEnabled" class="inputEnabledTrue"\n          value="true" <%= model.attributes.enabled ? "checked" : "" %>>\n        <label style="display:inline-block;" for="inputEnabledTrue">Yes</label>\n        <input type="radio" name="inputEnabled" class="inputEnabledFalse"\n          value="false" style="margin-left:15px;"\n          <%= model.attributes.enabled ? "" : "checked" %>>\n        <label style="display:inline-block;" for="inputEnabledFalse">No</label>\n      </div>\n    </div>\n  </div>\n</form>'}),define("views/popups/multicluster/filters/MulticlusterFilterPopupView",["views/basecomponents/popups/BasePopupView","models/BaseModel","models/BaseCollection","data/DataURLConstants","data/DataProperties","utils/AppConstants","utils/AppUtil","utils/AntiscrollUtil","text!templates/popups/multicluster/filters/MulticlusterFilterPopupView.html","text!templates/popups/multicluster/filters/MulticlusterFilterItemView.html","text!templates/popups/multicluster/filters/MulticlusterFilterFormView.html"],function(e,t,n,i,s,a,o,r,l,c,d){"use strict";var p=t.extend({urlRoot:i.MULTICLUSTER_FILTER,entityType:a.ENTITY_MULTICLUSTER_FILTER,name:"MulticlusterFilterModel",defaults:{uuid:null,name:null,detai:null},parse:function(e){return _.isArray(e)?e[0]:e},isUserDefinedFrequency:function(){return null!==this.get(s.MC_FILTER_USER_FREQUENCY)},getDisplayableFrequency:function(e){var t;if(e){if(e!==s.MC_FILTER_USER_FREQUENCY&&e!==s.MC_FILTER_DEFAULT_FREQUENCY)return void o.log("MulticlusterFilterPopupView: Invalid frequency type: "+e);if(!(t=this.get(e)))return null}else if(_.isNumber(this.get(s.MC_FILTER_USER_FREQUENCY)))t=this.get(s.MC_FILTER_USER_FREQUENCY);else{if(!_.isNumber(this.get(s.MC_FILTER_USER_FREQUENCY)))return null;t=this.get(s.MC_FILTER_USER_FREQUENCY)}return t=parseFloat(t),_.isNumber(t)&&_.isFinite(t)||o.log("MulticlusterFilterPopupView: Issue converting ' + 'frequency value to number: "+t),o.generateDisplayableTimeValue(t)},getDisplayableSeverity:function(){return this.get(s.ALERT_SEVERITY).substring(1)}}),u=n.extend({model:p,url:i.MULTICLUSTER_FILTER,comparator:function(e){return e.get(e.idAttribute)}}),h=_.template(l),m=_.template(c),f=_.template(d);return e.extend({SYSTEM_DEFAULT:"System default",ANTISCROLL_WIDTH:500,ANTISCROLL_HEIGHT:300,el:"#popupMulticlusterFilter",multiclusterFilterModel:null,events:{"click  .btnEdit":"onEditItem","click  .btnBack":"onBack","click  .btnSave":"onBeforeSave","click  .btnClose":"hide","click  .btnCancel":"hide","click  .modal-header .close":"hide","click  .inputFrequencyType":"onChangeFrequencyType","keypress input":"onKeyPress","click input":"clearHeader"},initialize:function(){_.bindAll(this,"onChangeFrequencyType")},render:function(){this.$el.html(h({canModify:this.canModifyByEntityType(a.ENTITY_MULTICLUSTER_FILTER)})),this.applyAntiScroll(0,this.ANTISCROLL_WIDTH,this.ANTISCROLL_HEIGHT)},show:function(t){e.prototype.show.apply(this,arguments),this.$(".antiscroll-wrap").css("visibility","hidden"),this.listMulticlusterFilter(),t.actionTargetId&&this.editItem(t.actionTargetId,!1),this.applyAntiScroll(2e3,this.ANTISCROLL_WIDTH,this.ANTISCROLL_HEIGHT)},showForm:function(e,t){this.mode=e,this.clearHeader(),this.$el.find(".n-title").text(a.ACTION_NAMES[e]+" Filter"),this.hideSubview(".listContainer"),this.showSubview(".formContainer","left"),this.$(".n-btn-form").hide(),this.$(".btnBack").show(),this.$(".btnCancel").show(),this.$(".btnSave").show()},showList:function(){this.$el.find(".n-title").text("Filters"),this.hideSubview(".formContainer"),this.showSubview(".listContainer"),this.$(".n-btn-form").hide(),this.$(".btnClose").show(),this.$(".btnSave").hide(),this.$(".btnBack").hide(),this.$(".btnCancel").hide()},reset:function(){this.clearHeader(),this.showList(),this.undelegateEvents()},_isValidUserFrequencyValue:function(){var e=parseFloat(this.$(".inputFrequency").val());return _.isNumber(e)&&_.isFinite(e)&&o.isInt(e)?(e<1||e>23)&&this.$(".n-units ").val()===a.HOURS?(this.showHeaderError("Hours input needs to be an integer from 1 to 23."),!1):!(e<1||e>365)||this.$(".n-units ").val()!==a.DAYS||(this.showHeaderError("Days input needs to be an integer from 1 to 365."),!1):(this.showHeaderError("User defined frequency value is not a valid integer."),!1)},onEditItem:function(e){this.$(".n-modal-loading").show();var t=$(e.currentTarget).attr("dataId");this.editItem(t,!0)},editItem:function(e,t){this.multiclusterFilterModel=new p,this.multiclusterFilterModel.id=e;var n=this;this.multiclusterFilterModel.fetch({success:function(){n.$(".n-modal-loading").hide();n.multiclusterFilterModel;n.$("#multiclusterFilterForm").html(f({model:n.multiclusterFilterModel}));var e=n.multiclusterFilterModel.getDisplayableFrequency(s.MC_FILTER_USER_FREQUENCY);if(e&&n.$(".inputSystemFrequencyValue").html(e.value+" "+e.units),n.multiclusterFilterModel.isUserDefinedFrequency()){var i=n.multiclusterFilterModel.getDisplayableFrequency(s.MC_FILTER_USER_FREQUENCY);i&&(n.$(".inputFrequency").val(i.value),n.$(".n-units").val(i.units))}n.onChangeFrequencyType(),n.showForm(a.ACTION_UPDATE,t)},error:function(e,t){n.$(".n-modal-loading").hide(),n.showHeaderError(t.responseText)}})},onChangeFrequencyType:function(e){this.$(".inputSystemFrequency").is(":checked")?(this.$(".inputFrequency").prop("disabled",!0),this.$(".n-units").prop("disabled",!0),this.$(".inputSystemFrequencyValue").css("opacity","inherit")):(this.$(".inputFrequency").prop("disabled",!1),this.$(".n-units").prop("disabled",!1),this.$(".inputSystemFrequencyValue").css("opacity",.5))},onBack:function(){this.clearHeader(),this.listMulticlusterFilter(),this.showList()},onEnterKeyPress:function(){this.onBeforeSave()},onBeforeSave:function(){if(!this.multiclusterFilterModel)return void o.log("MulticlusterFilterPopupView: MulticlusterFilter model is not set.");var e=this,t=null,n={};if(this.multiclusterFilterModel.on("error",function(t,n){e.showHeaderError(n)}),this.$(".inputUserFrequency").is(":checked")){if(!this._isValidUserFrequencyValue())return;n.value=parseFloat(this.$(".inputFrequency").val()),n.units=this.$(".n-units option:selected").val(),t=o.convertTimeValue(n,{units:a.MICROSECONDS})}!1!==this.multiclusterFilterModel.set({enabled:this.$(".n-radio-enabled input:checked").val(),userDefinedFrequencyUsecs:t})&&this.saveMulticlusterFilter()},listMulticlusterFilter:function(){var e=this;this.model=new u,this.$(".n-modal-loading").show(),this.$("#multiclusterFilterList > tbody").empty(),this.model.fetch({success:function(){e.$(".n-modal-loading").hide();var t=e.model.models,n=e.$("#multiclusterFilterList > tbody");if(n.html(""),t&&t.length)for(var i=0;i<t.length;i++){var s=m({model:t[i].toJSON(),canModify:e.canModifyByEntityType(a.ENTITY_MULTICLUSTER_FILTER)});n.append(s)}else n.html("<tr><td colspan=4>Issue retrieving multicluster filters.</tr></td>");r.applyAntiScroll(e.$(".antiscroll-wrap"),e.ANTISCROLL_WIDTH+"px",e.ANTISCROLL_HEIGHT+"px")},error:function(t,n){e.$(".n-modal-loading").hide(),e.showHeaderError(n.responseText)}})},saveMulticlusterFilter:function(){if(this.multiclusterFilterModel){this.$(".btnSave").button("loading");var e=this;this.multiclusterFilterModel.save(null,{success:function(t,n){e.listMulticlusterFilter(),e.$(".btnSave").button("reset"),e.showList()},error:function(t,n){e.showHeaderError(n.responseText),e.$(".btnSave").button("reset")}})}}})}),define("text!templates/popups/multicluster/clustermanagement/MulticlusterManagementPopupView.html",[],function(){return'\x3c!-- The parent div modal is #popupMulticlusterManagement --\x3e\n<div class="modal-header">\n  <button type="button" class="close" data-dismiss="modal">\n    <i data-icon="v" aria-hidden="true"></i>\n  </button>\n  <h4 class="n-title">Multicluster Management</h4>\n</div>\n\n<div class="n-modal-wrapper">\n  <div class="n-modal-body">\n    <div class="n-modal-content-wrapper">\n      <div class="n-modal-alert-header">\n        \x3c!-- @view: alert goes here... --\x3e\n      </div>\n      <div class="n-modal-content listContainer">\n        <% if (canModify) { %>\n          <div class="n-popup-description">\n            Add or remove clusters that are part of this multicluster instance.\n          </div>\n          <div>\n            <button class="btnCreate btn btn-small"\n                    data-loading-text="Saving...">\n              <i class="glyphicon glyphicon-plus"></i> Add Cluster\n            </button>\n          </div>\n        <% } %>\n        <table id="clusterList" class="table table-hover">\n          <thead>\n          <tr>\n            <th>Name</th>\n            <th>Acropolis Version</th>\n            <th>&nbsp;</th>\n          </tr>\n          </thead>\n          <tbody>\n          \x3c!-- @view: server items go here... --\x3e\n          </tbody>\n        </table>\n      </div>\n\n      <div class="n-modal-content formContainer"  style="display: none;">\n        <div id="multiclusterManagementForm">\n          \x3c!-- @view: form goes here... --\x3e\n        </div>\n      </div>\n    </div>\n  </div>\n  <div class="n-modal-footer">\n    \x3c!-- In form mode, we call it cancel, in list mode, its called close--\x3e\n    <button class="btnBack btn">\n      Cancel\n    </button>\n    <button class="btnClose btn btn-primary">\n      Close\n    </button>\n    <% if (canModify) { %>\n      <button class="btnSave btn btn-primary n-btn-form"\n              style="display:none;"\n              data-loading-text="Saving...">\n        Save\n      </button>\n    <% } %>\n  </div>\n</div>'}),define("text!templates/popups/multicluster/clustermanagement/MulticlusterManagementItemView.html",[],function(){return'<tr class="n-table-row">\n  <td>\n    <%= model.name %>\n  </td>\n  <td>\n    <%= model.version %>\n  </td>\n\n  <td class="cell-actions">\n    <% if (canModify) { %>\n      <i dataId=\'<%= model.name %>\' class=\'btnEdit\'\n         data-icon="F" aria-hidden="true"></i>\n      <span class="action-separator">&middot;</span>\n      <i dataId=\'<%= model.name %>\' class=\'btnDelete\'\n         data-icon="v" aria-hidden="true" ></i>\n    <% } %>\n  </td>\n</tr>'}),define("text!templates/popups/multicluster/clustermanagement/MulticlusterManagementFormView.html",[],function(){return'\x3c!-- Multicluster management Form --\x3e\n<form id="serviceCenterForm" class="form-horizontal">\n  <div class="control-group">\n    <label class="control-label" for="inputUrl">HOST OR IP</label>\n    <div class="controls">\n      <input type="text" class="inputUrl"\n        value="<%= model.name  ? model.name : \'\' %>">\n    </div>\n  </div>\n  <div class="control-group">\n    <label class="control-label" for="inputUserName">USERNAME</label>\n    <div class="controls">\n      <input type="text" class="inputUserName" value="">\n      <div class="n-input-validation-msg"></div>\n    </div>\n  </div>\n  <div class="control-group">\n    <label class="control-label" for="inputPassword">PASSWORD</label>\n    <div class="controls">\n      <input type="password" autocomplete="off" class="inputPassword" value="">\n    </div>\n  </div>\n</form>'}),define("views/popups/multicluster/clustermanagement/MulticlusterManagementPopupView",["backbone","views/basecomponents/popups/BasePopupView","models/BaseModel","data/DataURLConstants","utils/AppConstants","utils/AppUtil","managers/ClusterManager","data/DataManager","text!templates/popups/multicluster/clustermanagement/MulticlusterManagementPopupView.html","text!templates/popups/multicluster/clustermanagement/MulticlusterManagementItemView.html","text!templates/popups/multicluster/clustermanagement/MulticlusterManagementFormView.html"],function(e,t,n,i,s,a,o,r,l,c,d){"use strict";var p=n.extend({idAttribute:"name",urlRoot:i.MULTICLUSTER_MANAGEMENT,entityType:s.ENTITY_MULTICLUSTER_MANAGEMENT,defaults:{id:null,name:null,type:null,url:null,username:null,password:null},sync:function(t,n,i){i=this.parseOptions(t,n,i),i.url=r.getDataSourceURL()+n.url(),"update"!==t&&"create"!==t||(i.url=r.getDataSourceURL()+n.urlRoot,n.unset("id")),a.log("MulticlusterManagementModel : \n\t method: "+t+"\n\t data  : "+i.url),e.sync(t,n,i)},validate:function(e){var t="";if(0!==$.trim(e.name).length&&0!==$.trim(e.username).length&&0!==$.trim(e.url).length||(t="Please enter values for all the fields."),$.trim(t).length>0)return t}});return t.extend({el:"#popupMulticlusterManagement",multiclusterManagementModel:null,template:_.template(l),rowTemplate:_.template(c),events:{"click  .btnCreate":"onCreateItem","click  .btnDelete":"onDeleteItem","click  .btnEdit":"onEditItem","click  .btnBack":"onBack","click  .btnSave":"onBeforeSave","click  .btnClose":"hide","click  .modal-header .close":"hide","keyup  .inputUserName":"onInputNameKeyUp","keypress input":"onKeyPress","click input":"clearHeader"},render:function(){this.$el.html(this.template({canModify:this.canModifyByEntityType(s.ENTITY_MANAGEMENT_SERVER)}))},show:function(e){t.prototype.show.apply(this,arguments),this.$(".btnBack").hide(),
this.$(".btnSave").hide(),this.$(".btnClose").show(),this.listMulticlusterManagement(),e.actionTargetId&&this.editItem(e.actionTargetId,!1)},showForm:function(e,t){this.mode=e,this.clearHeader(),this.$el.find(".n-title").text(s.ACTION_NAMES[e]+" Cluster"),this.hideSubview(".listContainer"),this.showSubview(".formContainer","left"),this.$(".btnBack").show(),this.$(".btnSave").show(),this.$(".btnClose").hide()},showList:function(){this.$el.find(".n-title").text(s.MULTICLUSTER_NAME+" Management"),this.clearHeader(),this.hideSubview(".formContainer"),this.showSubview(".listContainer"),this.$(".btnBack").hide(),this.$(".btnSave").hide(),this.$(".btnClose").show()},reset:function(){this.clearHeader(),this.showList(),this.undelegateEvents()},onInputNameKeyUp:function(e){a.validNameCharactersEventHandler(e,this.$(".n-input-validation-msg"))},onCreateItem:function(){this.multiclusterManagementModel=new p,$("#multiclusterManagementForm").html(_.template(d,{model:this.multiclusterManagementModel.toJSON()})),this.showForm(s.ACTION_ADD,!0)},onEditItem:function(e){var t=$(e.currentTarget).attr("dataId");this.editItem(t,!0)},editItem:function(e,t){this.multiclusterManagementModel=new p,this.multiclusterManagementModel.id=e;var n=this;this.multiclusterManagementModel.fetch({success:function(){n.multiclusterManagementModel;$("#managementServerForm").html(_.template(d,{model:n.multiclusterManagementModel.toJSON()})),n.showForm(s.ACTION_UPDATE,t)},error:function(e,t){n.showHeaderError(t.responseText)}})},onDeleteItem:function(e){var t=$(e.currentTarget).attr("dataId");confirm("Are you sure you want to delete, "+t+"?")&&this.deleteMulticlusterManagement(t)},onBack:function(){this.clearHeader(),this.listMulticlusterManagement(),this.showList()},onEnterKeyPress:function(){this.onBeforeSave()},onBeforeSave:function(){if(this.multiclusterManagementModel){var e=this;this.multiclusterManagementModel.on("error",function(t,n){e.showHeaderError(n)});!1!==this.multiclusterManagementModel.set({name:this.$el.find(".inputName").val(),url:this.$el.find(".inputUrl").val(),password:this.$el.find(".inputPassword").val().length?this.$el.find(".inputPassword").val():null,username:this.$el.find(".inputUserName").val()})&&this.saveMulticlusterManagement()}},listMulticlusterManagement:function(){var e=o.getClusterCollection(),t=this.$("#clusterList > tbody");t.html(""),e.length?e.each(function(e){var n=this.rowTemplate({model:e.toJSON(),canModify:this.canModifyByEntityType(s.ENTITY_CLUSTER)});t.append(n)},this):t.html("<tr><td colspan=4>No clusters have been added.</tr></td>")},deleteMulticlusterManagement:function(e){if(this.model&&this.model.models&&this.model.get(e)){this.multiclusterManagementModel=this.model.get(e);var t=this;this.multiclusterManagementModel.destroy({success:function(e,n){t.listMulticlusterManagement()},error:function(e,n){t.showHeaderError(n.responseText)}})}},saveMulticlusterManagement:function(){if(this.multiclusterManagementModel){this.mode===s.ACTION_ADD&&(this.multiclusterManagementModel.id=null),this.$(".btnSave").button("loading");var e=this;this.multiclusterManagementModel.save(null,{success:function(t,n){e.listMulticlusterManagement(),e.$(".btnSave").button("reset"),e.showList()},error:function(t,n){e.showHeaderError(n.responseText),e.$(".btnSave").button("reset")}})}},destroy:function(){this.multiclusterManagementModel&&this.multiclusterManagementModel.off(),t.prototype.destroy.apply(this,arguments)}})}),define("text!templates/popups/alertpolicy/PopoverAlertThresholdDetails.html",[],function(){return"<table class=\"table\">\n  <thead>\n    <tr>\n      <th><%= i18n('Terms.severity') %></th>\n      <th><%= i18n('enabled') %></th>\n      <% if (hasThresholdConfig) { %>\n        <th><%= i18n('value') %></th>\n        <% if (!isUserDefined) { %>\n          <th><%= i18n('defaultValue') %></th>\n        <% } %>\n      <% } %>\n    </tr>\n  </thead>\n  <tbody>\n  <% _.each(parameters, function(parameter){ %>\n    <tr>\n      <td class=\"n-policy-severity-label\">\n        <%= parameter.severityLabel %>\n      </td>\n      <td>\n        <%= parameter.enabled? 'Yes': 'No' %>\n      </td>\n      <% if (hasThresholdConfig) { %>\n        <td>\n          <%= (parameter.enabled) ? ((parameter.value !== null) ?\n            parameter.value + (parameter.unit || '') : '') : '' %>\n        </td>\n        <% if (!isUserDefined) { %>\n          <td>\n            <%= parameter.defaultValue || '' %><%= parameter.unit || '' %>\n          </td>\n        <% } %>\n      <% } %>\n    </tr>\n  <% }) %>\n  </tbody>\n</table>"}),define("views/popups/alertpolicy/AlertPolicyListView",["views/basecomponents/datatables/BaseTableView","models/alert/AlertPolicyModel","models/alert/AlertPolicyCollection","utils/AppConstants","utils/AppUtil","utils/AlertUtil","utils/TimeUtil","views/basecomponents/datatables/DataTableTemplates","text!templates/popups/alertpolicy/PopoverAlertThresholdDetails.html"],function(e,t,n,i,s,a,o,r,l){"use strict";var c=_.template(l),d=_.template('<tr><td colspan="<%= colCnt %>"><%= i18n("retrievingError") %></td></tr>'),p=_.template('<tr><td colspan="<%= colCnt %>"><%= i18n("noMatchingResults") %></td></tr>'),u=_.template('<tr><td colspan="<%= colCnt %>"><div class="donut-loader-blue"></div> <span class="loading-msg"><%= i18n("loadingPolicies") %></span></td></tr>'),h=_.template('<div class="n-message-wrapper entity-link searchable" action="show"actionTargetId="<%= id %>" actionTarget="<%= policy %>"><%= title %></div>'),m=_.template('<% if (configurable) { %><span><i action="update" actionTargetId="<%= id %>"actionTarget="alert_policy" dataId="<%= id %>" class="btnEdit"data-icon="F" aria-hidden="true"></i></span><% } else { %><i data-icon="F" aria-hidden="true" class="policy-tooltip disabled"data-toggle="tooltip"data-original-title="<%= i18n("notConfigurableMsg") %>"></i><% } %>');return e.extend({name:"AlertPolicyListView",events:{"click .btnEdit":"onClickLinkAction","click .entity-link":"onClickLinkAction"},isSelectionEnabled:!1,policyType:"alert_policy",initialize:function(t){e.prototype.initialize.apply(this,arguments),this.defaultMinRows=1;var n={bPaginate:!1,bDeferRender:!0,sScrollY:"auto"};(s.isIEBrowser()||s.isEdgeBrowser())&&(n.bPaginate=!0,n.iDisplayLength=50,n.bScrollInfinite=!0,n.bScrollCollapse=!0),this.dataTableSettings=_.extend({},this.dataTableSettings,n),this.ebTableStyle=!0,this.enablePopoverOnHover()},initializeTableModel:function(e){var t={};t[n.INCLUDE_INTERNAL_CHECKS_PARAM]=!0,t[n.EXCLUDE_UDA_POLICY]=!0,this.model=new n(null,t)},loadTableData:function(){this.model.fetch(this.getOptions())},onStartServices:function(){this.delegateEvents(),this.delegateModelEvents(),this.loadTableData(),this.subViewHelper.iterate("startServices")},onStopServices:function(){$(".tooltip").tooltip("destroy"),this._removePopovers(),this.undelegateEvents(),this.undelegateModelEvents(),this.subViewHelper.iterate("stopServices")},onClickLinkAction:_.debounce(function(e){this.parentView.onClickLinkAction(e)},300),onDrawCallback:function(e){this.searchTextChanged=!1,this.model.models.length&&0!==e.fnRecordsDisplay()||this.renderTableMessage(p)},onDataLoading:function(){this.$(".n-loading-wrapper").hide(),this.renderTableMessage(u)},onDataError:function(e,t){this.showError(s.processThrownError(t.responseText))},onDataChange:function(){this.clusterManager.isMulticlusterNavMode()||this.model.reset(_.filter(this.model.models,function(e){return e.get(e.DP.APPLICABLE_FOR_PE)}),{silent:!0}),e.prototype.onDataChange.apply(this,arguments)},onTableFilter:function(t){this.setSearchString($(t.currentTarget).val()),e.prototype.onTableFilter.apply(this,arguments)},setSearchString:function(e){this.searchVal=e,this.searchTextChanged=!0},getSearchString:function(){return this.searchVal},getDefaultSort:function(e){return[]},getDefaultColumns:function(e,n){var s=this,a=this.clusterManager.isMulticlusterNavMode()?"globalRule":"rule",o=[{sTitle:this.i18n("id"),sWidth:"8%",sClass:"searchable",mData:t.DP.ALERT_TYPE_ID,bSearchable:!0,bSortable:!0},{sTitle:this.i18n("title"),mData:t.DP.TITLE,sWidth:"18%",bSearchable:!0,bSortable:!0,mRender:function(e,n,a){return n===i.TABLE_COL_TYPE_DISPLAY?s.formatTitle(a[t.DP.ID],e):e}},{sTitle:this.i18n("impactType"),sWidth:"10%",mData:t.DP.CATEGORY_LIST,bSearchable:!1,bSortable:!0},{sTitle:this.i18n("entityType"),sWidth:"9%",mData:t.DP.AFFECTED_ENTITY_LIST,bSearchable:!1,bSortable:!0},{sTitle:this.i18n(a),sWidth:"9%",mData:t.DP.CONFIGURABLE_RULE,tmplHover:c,bSortable:!0,bSearchable:!1,mRender:function(e,n,s){if(n===i.TABLE_COL_TYPE_DISPLAY){var a='data-id="'+s[t.DP.ID]+'"';return r.HOVER_TABLE_CELL({value:e,dataIdAttr:a,customClassName:""})}return e}},{sTitle:this.i18n("enabled"),mData:t.DP.ENABLED,sWidth:"8%",bSortable:!0,bSearchable:!1,mRender:function(e,t,n){return s.i18n(e?"enabled":"disabled")}},{sTitle:this.i18n("autoResolve"),sWidth:"8%",mData:t.DP.AUTO_RESOLVE,bSortable:!0,bSearchable:!1,mRender:function(e,t,n){return s.i18n(e)}}];return this.clusterManager.isMulticlusterNavMode()&&o.push({sTitle:this.i18n("exception"),sClass:"n-exception-wrapper",sWidth:"9%",mData:t.DP.EXCEPTION_COUNT,bSortable:!0,bSearchable:!1}),o.push({sTitle:this.i18n("lastUpdateTime"),mData:t.DP.MODIFIED_TIME_STAMP_IN_USECS,sWidth:"15%",bSortable:!0,bSearchable:!1,mRender:function(e,t,n){return s.formatUpdatedTime(e)}}),this.canModifyByEntityType(i.ENTITY_ALERT_POLICY)&&o.push({sTitle:this.i18n("action"),mData:t.DP.ID,sWidth:"6%",sClass:"cell-actions",bSortable:!1,bSearchable:!1,mRender:function(e,n,a){return n===i.TABLE_COL_TYPE_DISPLAY?m(s.vtOptions({id:e,configurable:a[t.DP.CONFIGURABLE]})):""}}),o},highlightText:function(e){var t=e.innerHTML,n=this.searchVal?this.searchVal.toLowerCase():"",i=t?t.toLowerCase().indexOf(n):-1;if(-1!==i){var s=t.slice(i,i+n.length);e.innerHTML=t.replace(s,'<span class="highlighted">'+s+"</span>")}},formatTitle:function(e,t){return h({id:e,title:t,policy:this.policyType})},formatUpdatedTime:function(e){return o.formatDateTime(e>0?e/i.MICROS_PER_MILLI:0)},refreshData:function(){a.getMetaDataLoadState()&&a.loadAlertTypeMetadata(!0),e.prototype.refreshData.apply(this,arguments)},renderTableMessage:function(e){var t=this.$(".dataTable.entity-table > thead > tr:first th"),n=this.$(".dataTable.entity-table > tbody");n.empty(),n.html(e(this.vtOptions({colCnt:t.length})))},setParentView:function(e){this.parentView=e},showError:function(e){this.parentView.showError(e),this.renderTableMessage(d)},_getDefaultColumnsWrapper:function(e,t){s.getHashParameters();return this.getDefaultColumns(e,t)},_dataTableRowCallback:function(e,t,n){return $(e).addClass("n-table-row"),(this.searchVal||this.searchTextChanged)&&($(e).find("span.highlighted").contents().unwrap(),this.searchVal&&_.each($(e).find(".searchable"),this.highlightText,this)),e},getHoverTooltip:function(e,t,n,i){return this._getPopoverContent(e,t.id)},getHoverTitle:function(){return this.i18n("thresholdDetails")},getPopoverContainer:function(){return""},_getPopoverContent:function(e,t){var n=this.model.findModelById(t);if(n){var i=n.getConfigurableParameters(),s=n.get(n.DP.ALERT_CONFIGURABLE_PARAMETERS);return e(this.vtOptions({hasThresholdConfig:s&&_.size(s)>0,parameters:i,isUserDefined:n.get(n.DP.IS_USER_DEFINED)}))}}})}),define("views/popups/alertpolicy/UDAPolicyListView",["views/popups/alertpolicy/AlertPolicyListView","models/alert/UDAPolicyModel","models/alert/UDAPolicyCollection","data/DataProperties","data/DataURLConstants","managers/EntityManager","utils/AppConstants","utils/AlertUtil","utils/AppUtil"],function(e,t,n,i,s,a,o,r,l){"use strict";var c=_.template('<span><i action="update" actionTargetId="<%= id %>" actionTarget="user_defined_alert_policy" class="btnEdit" data-icon="F" aria-hidden="true"></i><i dataId="<%= id %>" class="btnDelete" data-icon="v" aria-hidden="true" actionTarget="uda"></i></span>');return e.extend({events:{"click .btnEdit":"onClickLinkAction","click .entity-link":"onClickLinkAction","click .btnDelete":"onDeletePolicy"},policyType:"user_defined_alert_policy",initializeTableModel:function(e){this.model=new n,this.metricsCollection=a.createGenericEntityCollection("metric",null,s.ALERT_METRICS)},loadTableData:function(){var e=this;this.onDataLoading(),this.metricsCollection.fetch().done(function(){e.model.fetch(e.getOptions())}).fail(function(t){e.model.fetch(e.getOptions()),e.showError(l.processThrownError(t))})},getDefaultColumns:function(e,n){var s=this,a=[{sTitle:this.i18n("policyName"),mData:t.DP.TITLE,sWidth:"17%",bSearchable:!0,bSortable:!0,mRender:function(e,n,a){return e||(e=a[i.NAME]),n===o.TABLE_COL_TYPE_DISPLAY?s.formatTitle(a[t.DP.ID],e):e}},{sTitle:this.i18n("entity"),sWidth:"9%",sClass:"searchable",mData:t.HELPER_DP.ENTITY_TYPE,bSearchable:!0,bSortable:!0,mRender:function(e,n,i){var s=i[t.HELPER_DP.ENTITY_SCOPE];return r.getEntityScopeLabel(s,e)||""}},{sTitle:this.i18n("metric"),sWidth:"12%",mData:t.HELPER_DP.METRIC,sClass:"searchable",bSearchable:!0,bSortable:!0,mRender:function(e,n,i){var a=s._findMetricByName(i[t.HELPER_DP.ENTITY_TYPE],e);return a&&a.displayName||e}},{sTitle:this.i18n("thresholds"),sWidth:"15%",mData:t.DP.ID,bSearchable:!1,bSortable:!1,mRender:function(e,t,n){return s.model.get(e).formatMetricExpressions()}},{sTitle:this.i18n("impactType"),sWidth:"10%",mData:t.DP.IMPACT_TYPES,bSearchable:!1,bSortable:!0},{sTitle:this.i18n("enabled"),mData:t.DP.ENABLED,sWidth:"8%",bSearchable:!1,bSortable:!0,mRender:function(e,t,n){return s.i18n(e?"enabled":"disabled")}},{sTitle:this.i18n("autoResolve"),sWidth:"8%",mData:t.DP.AUTO_RESOLVE,bSortable:!0,bSearchable:!1,mRender:function(e,t,n){return s.i18n(e?"enabled":"disabled")}},{sTitle:this.i18n("lastUpdateTime"),mData:t.HELPER_DP.UPDATED_TIMESTAMP,sWidth:"15%",bSearchable:!1,bSortable:!0}];return this.canModifyByEntityType(o.ENTITY_USER_DEFINED_ALERT_POLICY)&&a.push({sTitle:this.i18n("action"),sWidth:"6%",mData:t.DP.ID,sClass:"cell-actions",bSearchable:!1,bSortable:!1,mRender:function(e,t,n){return t===o.TABLE_COL_TYPE_DISPLAY?c({id:e}):""}}),a},onDeletePolicy:function(e){var t=$(e.currentTarget).attr("dataId");$.nutanixConfirm({msg:this.i18n("confirm_delete"),yes:function(){this.$(".n-loading-wrapper").show(),this._deletePolicy(t)},yesText:this.i18n("yes"),noText:this.i18n("cancel"),context:this})},_deletePolicy:function(e){var n=this,i=new t;i.setId(e),i.destroy().always(function(){n.$(".n-loading-wrapper").hide(),n.refreshData()})},_findMetricByName:function(e,t){return r.findMetricByName(this.metricsCollection,e,t)},_getEntityTypeDisplayName:function(e,t){var n=e;return e===o.ENTITY_NODE&&(n=o.ENTITY_HOST),l.getEntityNameFromCount(n,t)||l.toUpperCaseFirstChar(n)}})}),define("text!templates/popups/alertpolicy/AlertPoliciesPopupView.html",[],function(){return'\x3c!-- The parent div modal is #popupAlertPolicies --\x3e\n<div class="modal-header">\n  <button type="button" class="close" data-dismiss="modal">\n    <i data-icon="K" aria-hidden="true"></i>\n  </button>\n  <h4 class="n-title popupTitle"><%= i18n(\'alertPoliciesTitle\') %></h4>\n</div>\n\n<div class="n-modal-wrapper">\n  <div class="n-modal-body">\n    <div class="n-modal-content-wrapper">\n      <div class="n-modal-alert-header">\n      </div>\n      <div class="n-modal-content listContainer">\n        <div class="alert-policy-content">\n          <div class="alert-policy-header">\n            <header class=\'policy-header\' tab="system">\n              <% if (isPCMode) { %>\n              <form role="form" lpformnum="1" class="alert-policy-header-controls -grid">\n                <div class="form-group -inline" >\n                  <div class="grid-cell -minimize">\n                    <div class="btn-group -nowrap alerts-list-subgroups">\n                      <button type="button" class="btn btn-default tab -no-border selected"\n                          data-id="user" data-test="alertpoliciespopupview_button_user_created">\n                        <%= i18n(\'user\') %>\n                      </button>\n                      <button type="button" class="btn btn-default tab -no-border"\n                          data-id="system" data-test="alertpoliciespopupview_button_system_created">\n                        <%= i18n(\'system\') %>\n                      </button>\n                    </div>\n                  </div>\n                  <div class="grid-cell filter-box-cell">\n                    <div class="filter-box">\n                      <div class="searchIcon icon -search">\n                        <%= Components.icon("mag-glass", "-inline") %>\n                      </div>\n                      <input class="searchFilter" type="text" placeholder=" <%= i18n(\'search\') %>"\n                        data-test="alertpolicy_alertpoliciespopupview_input_search-box">\n                    </div>\n                  </div>\n                  <% if (canModify) { %>\n                  <div class="grid-cell -minimize">\n                    <button type="button" class="btn btn-primary btn-new-uda-policy -no-border"\n                       action="create" actionTarget="user_defined_alert_policy"\n                        data-test="alertpoliciespopupview_button_create_uda_policy"\n                      >\n                      <%= Components.icon(\'plus\', \'-inline -small\') %>\n                      <span class="btn-content"><%= i18n(\'newAlertPolicy\') %></span>\n                    </button>\n                  </div>\n                  <% } %>\n                </div>\n              </form>\n              <% }  else { %>\n                <div class="filter-box">\n                  <div class="searchIcon icon -search">\n                    <%= Components.icon("mag-glass", "-inline") %>\n                  </div>\n                  <input class="searchFilter" type="text" placeholder="<%= i18n(\'search\') %>"\n                    data-test="udapolicy_alertpoliciespopupview_input_search-box">\n                </div>\n              <% } %>\n            </header>\n          </div>\n\n          <div class="alert-policy-container-wrapper">\n            <div class="tab-content">\n              <div class="n-base-data-table n-tab tab-pane system-content">\n                \x3c!--  Tab System policy contents --\x3e\n              </div>\n              <div class="n-base-data-table n-tab tab-pane user-content">\n                \x3c!--  Tab user policy contents --\x3e\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n\n  </div>\n</div>\n'}),define("views/popups/alertpolicy/AlertPoliciesPopupView",["views/basecomponents/popups/BasePopupView","views/popups/alertpolicy/AlertPolicyListView","views/popups/alertpolicy/UDAPolicyListView","events/AppEvents","utils/AppConstants","utils/SubViewHelper","managers/ActionManager","text!templates/popups/alertpolicy/AlertPoliciesPopupView.html"],function(e,t,n,i,s,a,o,r){"use strict";var l={SYSTEM:"system",USER:"user"},c={system:t,user:n};return e.extend({name:"AlertPoliciesPopupView",el:"#popupAlertPolicies",compiledViewTemplate:_.template(r),events:{"click .modal-header .close":"hide","keydown input.searchFilter":"onKeyDownSearch"},extraEvents:{"click .btn-default":"onShowPolicy","click .btn-new-uda-policy":"onClickLinkAction"},overlayPopup:!0,initialize:function(t){e.prototype.initialize.apply(this,arguments),_.bindAll(this,"policyUpdated"),i.onAppEvent(i.ENTITIES_UPDATED,this.policyUpdated),this.clusterManager.isMulticlusterNavMode()&&this.addExtraEvents(this.extraEvents),this.subViewHelper=new a},render:function(){this.$el.html(this.compiledViewTemplate(this.vtOptions({isPCMode:this.clusterManager.isMulticlusterNavMode(),canModify:this.canModifyByEntityType(s.ENTITY_ALERT_POLICY)})));var e=this.clusterManager.isMulticlusterNavMode()?l.USER:l.SYSTEM;this.showPolicyListView(e),this.$(".searchFilter").focus()},destroy:function(){this.subViewHelper.iterate("stopServices"),this.subViewHelper.destroy(),i.offAppEvent(i.ENTITIES_UPDATED,this.policyUpdated),e.prototype.destroy.apply(this,arguments)},show:function(t){e.prototype.show.apply(this,arguments)},policyUpdated:function(e,t){if(e.type===i.ENTITIES_UPDATED&&(t.entityType===s.ENTITY_ALERT_POLICY||t.entityType===s.ENTITY_USER_DEFINED_ALERT_POLICY)){var n;t.entityType===s.ENTITY_ALERT_POLICY?n=l.SYSTEM:t.entityType===s.ENTITY_USER_DEFINED_ALERT_POLICY&&(n=l.USER);var a=this.subViewHelper.get(n);a&&a.refreshData()}},onClickLinkAction:function(e){o.executeActionElement(e.currentTarget)},onKeyDownSearch:_.debounce(function(e){var t=this.subViewHelper.get(this.currentViewId);t&&t.onTableFilter(e)},100),onShowPolicy:function(e){this.$(".btn-default.selected").removeClass("selected"),$(e.currentTarget).addClass("selected");var t=$(e.currentTarget).attr("data-id");this.showPolicyListView(t)},showError:function(e){this.showHeaderError(e)},createPolicyListView:function(e){var t="."+e+"-content",n=new c[e]({el:this.$(t),entityType:s.ENTITY_ALERT_POLICY,ebTableStyle:!0});return n.setParentView(this),n},showPolicyListView:function(e){if(this.currentViewId!==e){var t=this.subViewHelper.get(this.currentViewId);t&&t.hideView(),this.currentViewId=e;var n=this.subViewHelper.get(e);n||(n=this.createPolicyListView(e),this.subViewHelper.register(e,n),n.render()),this.$(".searchFilter").val(n.getSearchString()||""),n.startServices(),n.showView()}}})}),define("text!templates/popups/alertpolicy/AlertPolicyView.html",[],function(){return'<div class="alert-policy-form">\n  <div class="alert-policy">\n\n    <section data-ntnx-section>\n      <h5 data-ntnx-title>\n        <%= i18ns(hasThresholds ? \'configureThresholdMsg\' : \'enableAlertMsg\', policyTitle) %>\n      </h5>\n    </section>\n\n    <section data-ntnx-section class="control-div alert-parameters">\n    </section>\n\n  </div>\n</div>'}),define("text!templates/popups/alertpolicy/AlertPolicyParametersView.html",[],function(){return'<section class="threshold-params">\n  <% _.each(parameters, function(parameter) { %>\n    <section class="threshold-param" data-ntnx-section="type-half">\n      <section data-ntnx-section="type-form-elements-inline">\n        <div data-ntnx-form-inline>\n          <%= Components.checkbox({\n            attributes: \'data-class="-blue" data-index="\' + index + \'" data-id="\' + parameter.severity + \'"\',\n            jsClasses: \'exceptionCheckbox\',\n            checked: parameter.enabled,\n            disabled: disabled\n          }) %>\n          <label data-ntnx-inline-label class="severity-label"><%= parameter.severityLabel %></label>\n          <% if (hasThresholdConfig) {%>\n            <div class="input-group-item">\n              <input type="text" class="thresholdInput"\n                     data-index="<%= index %>"\n                     data-id="<%= parameter.severity%>"\n                     data-attr="<%= parameter.valueAttribute %>"\n                     valid-values="<%= parameter.validValues %>"\n                     value="<%= (parameter.value !== null) ? parameter.value :\n                     parameter.defaultValue%>" <%= disabled %>>\n              <div class="input-unit"><%= parameter.unit || \'\' %></div>\n            </div>\n          <% } %>\n        </div>\n      </section>\n      <% if (hasThresholdConfig) {%>\n        <div data-ntnx-hint class="light-text">\n          <% if (parameter.unit) { %>\n            <%= i18ns(\'defaultWithUnit\', parameter.defaultValue, parameter.unit) %>\n          <% } else { %>\n            <%= i18ns(\'default\', parameter.defaultValue) %>\n          <% } %>\n        </div>\n      <% } %>\n    </section>\n  <% }) %>\n</section>\n<section>\n  <% if (index === \'configParam\' && !isAutoResolveSupported) { %>\n    <div data-ntnx-hint class="auto-resolve-not-supported">\n      <%= i18n(\'autoResolveNotSupported\') %>\n    </div>\n  <%} else if (isAutoResolveSupported &&  autoResolveVersionSupport !== \'none\') { %>\n    <div data-ntnx-form-inline class="autoResolve" data-index="<%= index %>">\n      <%= Components.checkbox({\n        attributes: \'data-index="\' + index + \'"\',\n        jsClasses: \'inputEnabled autoResolveChkBox\',\n        checked: autoResolve === \'enabled\',\n        disabled: disabled,\n        name: \'inputEnabled\',\n        value: true\n      }) %>\n      <label data-ntnx-inline-label for="AutoResolveEnabled">\n        <%= i18n(\'autoResolveSupported\') %>\n        <% if (index === \'configParam\' && autoResolveVersionSupport === \'partial\') { %>\n          <span class="light-text"> <%= i18n(\'autoResolvePartialSupport\') %></span>\n        <% } %>\n      </label>\n    </div>\n  <% } %>\n</section>'}),define("views/popups/alertpolicy/AlertPolicyView",["views/basecomponents/popups/BasePopupSubView","events/AppEvents","utils/AppConstants","text!templates/popups/alertpolicy/AlertPolicyView.html","text!templates/popups/alertpolicy/AlertPolicyParametersView.html"],function(e,t,n,i,s){"use strict";var a={FULL:"full",PARTIAL:"partial",NONE:"none"},o=_.template(i),r=_.template(s),l=_.template('.exceptionCheckbox[data-index="<%=index%>"]'),c=_.template('.thresholdInput[data-index="<%=index %>"][data-id="<%= severity %>"]');return e.extend({CONFIG_PARAMETER_INDEX:"configParam",name:"AlertPolicyView",render:function(){var e=this.model.getConfigurableParameters(),t=this.canModifyByEntityType(n.ENTITY_ALERT_POLICY),i=this.model.get(this.model.DP.ALERT_CONFIGURABLE_PARAMETERS);this.$el.html(this.getViewTemplate()(this.vtOptions({hasThresholds:i&&i.length,policyTitle:this.model.get(this.model.DP.TITLE),canModify:t})));var s=this.model.get(this.model.DP.AUTO_RESOLVE),a=s!==this.model.DP.AUTO_RESOLVE_VALUES.NOT_SUPPORTED,o=this.getGlobalClusterModels();this.$(".alert-parameters").html(r(this.vtOptions({parameters:e,index:this.CONFIG_PARAMETER_INDEX,hasThresholdConfig:i&&_.size(i)>0,autoResolve:this.model.get(this.model.DP.AUTO_RESOLVE),isAutoResolveSupported:a,disabled:!t,autoResolveVersionSupport:this.getAutoResolveVersionSupport(o)}))),this.applyNutanixInput()},getAutoResolveVersionSupport:function(e){var t=function(e){return e&&(e===n.MULTICLUSTER_NAME||e.isAutoResolveSupported&&e.isAutoResolveSupported())};return _.every(e,t)?a.FULL:_.some(e,t)?a.PARTIAL:a.NONE},getViewTemplate:function(){return o},getGlobalClusterModels:function(){return this.clusterManager.getClusterCollection().models},checkPrerequisites:function(){},onSave:function(e){var t=this.getUpdatedParameters(this.CONFIG_PARAMETER_INDEX);if(null===t)return void e.error();var n=this.setSeverityThresholdInfo(t.severityThresholdInfo),i=this.setPolicyParameters(t.policyParameters),s=this.hasAutoResolveValueChanged(t.autoResolve);null!==i||null!==n||s?this.updateAlertPolicy(i,n,t.autoResolve,e):e.success()},triggerPolicyUpdatedEvent:function(e,i){t.triggerAppEvent(t.ENTITIES_UPDATED,{entityType:n.ENTITY_ALERT_POLICY,entity:e,customErrorMessage:i})},hasAutoResolveValueChanged:function(e){return e!==this.model.get(this.model.DP.AUTO_RESOLVE)},updateAlertPolicy:function(e,t,i,s){var a=this,o=this.model.get(this.model.DP.ALERT_CONFIGURABLE_PARAMETERS),r=this.model.get(this.model.DP.SEVERITY_THRESHOLD_INFOS),l=this.model.get(this.model.DP.AUTO_RESOLVE);null!==e&&this.model.set(this.model.DP.ALERT_CONFIGURABLE_PARAMETERS,e),null!==t&&this.model.set(this.model.DP.SEVERITY_THRESHOLD_INFOS,t),this.model.set(this.model.DP.AUTO_RESOLVE,i),this.model.save(null,{success:function(e,t){s.success(),a.triggerPolicyUpdatedEvent(e)},error:function(e,t){a.model.set(a.model.DP.ALERT_CONFIGURABLE_PARAMETERS,o),a.model.set(a.model.DP.SEVERITY_THRESHOLD_INFOS,r),a.model.set(a.model.DP.AUTO_RESOLVE,l),a.triggerAction(n.MODAL.ACT.ALERT_SHOW,{type:n.MODAL.ALERT.TYPE_ERROR,message:t.responseText}),s.error()}})},getUpdatedParameters:function(e){var t=this,i=[],s=[],a=this.model.DP.AUTO_RESOLVE_VALUES.NOT_SUPPORTED,o=this.$(".autoResolveChkBox[data-index="+e+"]");o.length&&(a=o.is(":checked")?this.model.DP.AUTO_RESOLVE_VALUES.ENABLED:this.model.DP.AUTO_RESOLVE_VALUES.DISABLED);var r=this.$(l({index:e}));return _.some(r,function(a){var o=$(a),r=o.data("id"),l={enabled:o.is(":checked"),severity:r};s.push(l);var d=t.$(c({index:e,severity:r}));if(d.length){var p={severity:r},u=$.trim(d.val()),h=d.data("attr"),m=d.attr("valid-values"),f=n.ALERT_SEVERITY_NAMES[r]||r,v=t.getAttributeValue(u,h,m,f);if(null===v)return!0;p[h]=v,i.push(p)}})?null:{autoResolve:a,severityThresholdInfo:s,policyParameters:i}},getAttributeValue:function(e,t,i,s){if(""===e)return this.triggerAction(n.MODAL.ACT.ALERT_SHOW,{type:n.MODAL.ALERT.TYPE_ERROR,message:this.i18ns("missingThresholdError",s)}),null;if(t===this.model.DP.PARAM_LONG_VALUE){var a=parseInt(e,10),o=i.split("-"),r=parseInt(o[0],10),l=parseInt(o[1],10);return isNaN(r)&&(r=0),isNaN(l)&&(l=100),e.match(/\D/)||isNaN(a)||!(a>=r&&a<=l)?(this.triggerAction(n.MODAL.ACT.ALERT_SHOW,{type:n.MODAL.ALERT.TYPE_ERROR,message:this.i18ns("invalidThresholdError",s,i)}),null):a}return e},cloneParameters:function(e){return JSON.parse(JSON.stringify(e))},setPolicyParameters:function(e){var t=this,n=this.cloneParameters(this.model.get(this.model.DP.ALERT_CONFIGURABLE_PARAMETERS)),i=!1;return _.each(e,function(e){var s=t.findMatchingParameter(n,e.severity);_.each(e,function(e,n){t.hasValueChanged(s,n,e)&&(s[n]=e,i=!0)})}),i?n:null},hasValueChanged:function(e,t,n){if(t===this.model.DP.SEVERITY)return!1;if(t===this.model.DP.ENABLED)return e[t]!==n;if(_.isNull(e[t])){return e[this.model.getDefaultValueAttributeName(t)]!==n}return e[t]!==n},findMatchingParameter:function(e,t){return _.find(e,function(e){return e.severity===t})},setSeverityThresholdInfo:function(e){var t=this,n=!1;return _.each(e,function(e){var i=t.findMatchingParameter(t.model.get(t.model.DP.SEVERITY_THRESHOLD_INFOS),e.severity);_.each(e,function(e,t){i[t]!==e&&(n=!0)})}),n?e:null},onResize:function(){}})}),define("text!templates/popups/alertpolicy/PCAlertPolicyView.html",[],function(){return"<div class=\"alert-policy-form\">\n\n  <section data-ntnx-section>\n    <h5 data-ntnx-title>\n      <%= policyTitle %> <span class='policy-kb'></span>\n    </h5>\n  </section>\n\n  <section data-ntnx-section>\n    <h5 data-ntnx-title>\n      <%= i18n('globalRule') %>\n    </h5>\n  </section>\n\n  <section data-ntnx-section=\"type-subtitle\" class=\"alert-policy\">\n    <% if (hasThresholds) { %>\n      <%= i18ns('configureThresholdMsg', policyTitle) %>\n    <% } else { %>\n      <%= i18ns('enableAlertMsg', policyTitle) %>\n    <% } %>\n    <%= i18ns('allClustersMsg', policyTitle) %>\n  </section>\n\n  <section data-ntnx-section class=\"alert-parameters\">\n  </section>\n\n  <section data-ntnx-section=\"type-separator\">\n    <h5 data-ntnx-title>\n      <%= i18n('exceptions') %>\n    </h5>\n  </section>\n\n  <section data-ntnx-section=\"type-subtitle\">\n    <%= i18n('createExceptionMsg') %>\n  </section>\n\n  <div class=\"policy-exceptions\"></div>\n\n  <% if (canModify) {%>\n\n    <section data-ntnx-section class=\"button-wrapper\">\n      <button type=\"button\" class=\"btn -blue addException\">\n        <%= Components.icon('plus', '-inline -mini') %>\n        <%= i18n('addException') %>\n      </button>\n    </section>\n\n  <% } %>\n\n</div>\n"}),define("text!templates/popups/alertpolicy/AlertPolicyExceptionView.html",[],function(){return'<section data-ntnx-section="type-separator">\n  <div class="policyException" data-index="<%= index %>">\n\n    <h5 data-ntnx-title>\n      <span class="exceptionTitle"><%= title %></span>\n      <% if (allowRemovalOfException) { %>\n        <button data-ntnx-title-link class="close deleteException" type="button">\n          <i aria-hidden="true" data-icon="K"></i>\n        </button>\n      <% } %>\n    </h5>\n\n    <section data-ntnx-section class="clusterSelector">\n    </section>\n\n    <section data-ntnx-section class="exceptionParameter">\n    </section>\n\n  </div>\n</section>\n'}),
define("views/popups/alertpolicy/PCAlertPolicyView",["views/popups/alertpolicy/AlertPolicyView","views/utils/MultipleItemPickerView","models/BaseModel","models/alert/AlertPolicyModel","data/DataURLConstants","data/DataProperties","managers/prechecks/PCCompatibilityManager","utils/AppConstants","utils/AppUtil","text!templates/popups/alertpolicy/PCAlertPolicyView.html","text!templates/popups/alertpolicy/AlertPolicyExceptionView.html","text!templates/popups/alertpolicy/AlertPolicyParametersView.html"],function(e,t,n,i,s,a,o,r,l,c,d,p){"use strict";var u=_.template(c),h=_.template(d),m=_.template(p),f=n.extend({idAttribute:a.ALERT_METADATA_ID,urlRoot:s.ALERT_BATCH,entityType:r.ENTITY_ALERT_POLICY,name:"AlertBatchModel",toJSON:function(){return _.map(this.attributes,function(e){return e})},showLatencyNotification:function(e,t){},showSuccessNotification:function(e,t,n){},triggerAppViewRefresh:function(){}},{DP:{CLUSTER_UUID:"clusterUuid",OPERATION:"operation",GENERIC_DTO:"genericDTO"}}),v=i.extend({isGlobalConfig:function(){return!1}});return e.extend({policyExceptions:null,clusterSelectors:null,name:"PCAlertPolicyView",events:{"click .addException":"addException","click .deleteException":"deleteException"},initialize:function(t){e.prototype.initialize.apply(this,arguments),_.bindAll(this,"selectionChangeEvent","getClusterName"),this.clusterSelectors=[],this.policyExceptions=[]},render:function(){e.prototype.render.apply(this,arguments),this.renderAlertPolicyExceptions(),this.applyNutanixInput(),this.addKbInfo()},destroy:function(){_.each(this.clusterSelectors,function(e){e.destroy()}),this.clusterSelectors=null,this.policyExceptions=null,e.prototype.destroy.apply(this,arguments)},checkPrerequisites:function(){if(!this.isLocalPCUpdate()){var e=o.getIncompatiblePEWarningMessage(r.PC_DELOS_VERSION);e&&this.triggerAction(r.MODAL.ACT.ALERT_SHOW,{type:r.MODAL.ALERT.TYPE_WARNING,message:e})}},allowRemovalOfException:function(e,t,n,i){return e.length===n.length&&t!==this.model.DP.AUTO_RESOLVE_VALUES.NOT_SUPPORTED==(i!==this.model.DP.AUTO_RESOLVE_VALUES.NOT_SUPPORTED)},renderAlertPolicyExceptions:function(){var e=this;this.clusterSelectors=[],this.policyExceptions=this.model.getExceptions();var t=this.model.get(this.model.DP.ALERT_CONFIGURABLE_PARAMETERS),n=this.getSelectableClusters(),i={},s=this.model.getConfigurableParameters(),a=this.model.get(this.model.DP.AUTO_RESOLVE);_.each(this.policyExceptions,function(e,t){i[t]=this.allowRemovalOfException(s,a,e.parameters,e.autoResolve),this.$(".policy-exceptions").append(h({index:t,title:this.i18ns("exception",t+1),parameters:e.parameters,allowRemovalOfException:i[t]}))},this),_.each(this.$(".clusterSelector"),function(t){var s=$(t).closest(".policyException").data("index"),a=_.map(e.policyExceptions[s].clusters,function(e){return e.clusterUuid});e.createClusterSelector(t,n,a,!i[s])});var o=this.canModifyByEntityType(r.ENTITY_ALERT_POLICY);_.each(this.$(".exceptionParameter"),function(e){var n=$(e).closest(".policyException").data("index"),i=_.map(this.policyExceptions[n].clusters,function(e){return this.clusterManager.getClusterModelByClusterUuid(e.clusterUuid)||e.name},this),s=this.policyExceptions[n].parameters,a=this.policyExceptions[n].autoResolve,r=a!==this.model.DP.AUTO_RESOLVE_VALUES.NOT_SUPPORTED;this.$(e).html(m(this.vtOptions({parameters:s,index:n,autoResolve:a,isAutoResolveSupported:r,hasThresholdConfig:t&&_.size(t)>0,disabled:!o,autoResolveVersionSupport:this.getAutoResolveVersionSupport(i)})))},this),o&&n.length?this.$(".addException").show():this.$(".addException").hide()},getViewTemplate:function(){return u},getGlobalClusterModels:function(){var e=_.clone(this.clusterManager.getClusterCollection().models);return e.push(r.MULTICLUSTER_NAME),e},onSave:function(e){var t=this,n=this.getUpdatedParameters(this.CONFIG_PARAMETER_INDEX);if(null===n)return void e.error();var i=this.getUpdatedExceptionData();if(null===i)return void e.error();var s=this.setSeverityThresholdInfo(n.severityThresholdInfo),a=this.setPolicyParameters(n.policyParameters),o=this.hasAutoResolveValueChanged(n.autoResolve),r=this.model.get(this.model.DP.ALERT_CONFIG_EXCEPTION_GROUP);null!==a||null!==s||o?this.updateAlertPolicy(a,s,n.autoResolve,{success:function(){t.updateExceptions(i,r,!0,e)},error:e.error}):this.updateExceptions(i,r,!1,e)},getUpdatedExceptionData:function(){var e=this,t={},n=!1;return _.each(this.clusterSelectors,function(i,s){var a=i.getSelectedItems();(!a||a.length<=0)&&(e.triggerAction(r.MODAL.ACT.ALERT_SHOW,{type:r.MODAL.ALERT.TYPE_ERROR,message:e.i18n("invalidSelectionError")}),n=!0),t[s]={clusterUuids:a}}),n?null:(n=_.some(this.$(".policyException"),function(e){var n=$(e),i=n.data("index");if(i!==this.CONFIG_PARAMETER_INDEX){var s=this.getUpdatedParameters(i);return null===s||(t[i][this.model.DP.SEVERITY_THRESHOLD_INFOS]=s.severityThresholdInfo,t[i][this.model.DP.CONFIGURABLE_PARAMETERS]=s.policyParameters,t[i][this.model.DP.AUTO_RESOLVE]=s.autoResolve,!1)}},this),n?null:t)},updateExceptions:function(e,t,n,i){var s=this.getExceptionsParameters(e,t,n);this.isLocalPCUpdate()?this.localPCUpdate(s,i):this.fanOutUpdate(s,i)},fanOutUpdate:function(e,t){var n=this;if(e.length>0){var i=this.clusterManager.getPrismCentralClusterUuid(),s=_.find(e,function(e){return e[f.DP.CLUSTER_UUID]===i},this);if(s&&e.length>1){var a=[];a.push([s]),a.push(_.filter(e,function(e){return e[f.DP.CLUSTER_UUID]!==i},this));var o=[],l=!1;_.each(a,function(e){o.push(this.batchUpdate(e,{error:function(){l=!0}}))},this),$.whenAll.apply($,o).done(function(){l?t.error():(t.success(),n.showSuccess(n.i18n("updateSuccessMsg")),n.triggerPolicyUpdatedEvent(n.model))}).fail(function(){t.error(),n.triggerAction(r.MODAL.ACT.ALERT_SHOW,{type:r.MODAL.ALERT.TYPE_ERROR,message:n.i18n("updateFailedError")})})}else this.batchUpdate(e,t)}else t.success()},localPCUpdate:function(e,t){var n=this;if(e.length>0){var i=[],s=!1;_.each(e,function(e){var t=new v(e);i.push(t.save(null,{error:function(){s=!0}}))}),$.whenAll.apply($,i).done(function(){s?t.error():(t.success(),n.showSuccess(n.i18n("updateSuccessMsg")),n.triggerPolicyUpdatedEvent(n.model))}).fail(function(){t.error(),n.triggerAction(r.MODAL.ACT.ALERT_SHOW,{type:r.MODAL.ALERT.TYPE_ERROR,message:n.i18n("updateFailedError")})})}else t.success()},batchUpdate:function(e,t){var n=this,i=new f(e);return i.isNew(!1),i.save(null,{success:function(e,i){var s=n.getResponseErrorDetails(i);s?(t&&t.error&&t.error(),n.triggerPolicyUpdatedEvent(n.model,s)):t&&t.success&&(t.success(),n.showSuccess(n.i18n("updateSuccessMsg")),n.triggerPolicyUpdatedEvent(n.model))},error:function(e,i){n.triggerAction(r.MODAL.ACT.ALERT_SHOW,{type:r.MODAL.ALERT.TYPE_ERROR,message:i.responseText}),t.error()}})},getResponseErrorDetails:function(e){if(e.errorList){var t=e.errorList,n=[],i=[];if(_.each(t,function(e){if(e.message)if(-1!==e.message.search("cluster not reachable")&&e.entityUuid){var t=e.entityUuid.split("::")[0];i.push(this.getClusterName(t))}else n.push(e.message)},this),i.length&&(i=i.join(", "),n.push(this.i18ns("errorChangesNotApplied",i))),n.length)return n.join(",")}return null},populateGlobalBatchAttributes:function(e,t){var n=this,i=o.getPEs(r.PC_DELOS_VERSION,!0),s=_.map(e,function(e){return e[f.DP.CLUSTER_UUID]}),l=_.filter(i,function(e){var n=e.get(a.CLUSTER_UUID);return-1===s.indexOf(n)&&-1===t.indexOf(n)}),c=this.model.get(this.model.DP.ALERT_CONFIGURABLE_PARAMETERS),d=this.model.get(this.model.DP.ALERT_TYPE_ID),p=this.model.getId(),u=this.model.get(this.model.DP.NAME),h=this.model.get(this.model.DP.SEVERITY_THRESHOLD_INFOS),m=this.model.get(this.model.DP.AUTO_RESOLVE),v=this.clusterManager.getPrismCentralClusterUuid();-1===s.indexOf(v)&&-1===t.indexOf(v)&&e.push(this.createUpdatePayload(this.clusterManager.getPrismCentralClusterUuid(),d,p,u,m,h,c)),_.each(l,function(t){e.push(n.createUpdatePayload(t.get(a.CLUSTER_UUID),d,p,u,m,h,c))})},selectionChangeEvent:function(e){var t=this,n=$(e.currentTarget).closest(".policyException").data("index"),i=this.clusterSelectors[n],s=i.getSelectedItems(),a=_.map(s,function(e){return{clusterUuid:e,name:t.getClusterName(e)}});this.policyExceptions[n].clusters=a,this.refreshClusterSelectors(),0===a.length&&this.model.get(this.model.DP.AUTO_RESOLVE)===this.model.DP.AUTO_RESOLVE_VALUES.NOT_SUPPORTED&&this.$("[data-index="+n+"] .autoResolve").hide()},onResize:function(){_.each(this.clusterSelectors,function(e){e.resizeSelector()})},getClusterName:function(e){return this.clusterManager.getNameById(e)||this.i18n("unnamed")},addException:function(e){var t=this.model.getConfigurableParameters(),n=this.policyExceptions.length;this.$(".policy-exceptions").append(h({index:n,title:this.i18ns("exception",n+1),parameters:t,allowRemovalOfException:!0}));var i=this.getSelectableClusters();this.createClusterSelector("[data-index="+n+"] .clusterSelector",i,[],!1);var s=this.model.get(this.model.DP.ALERT_CONFIGURABLE_PARAMETERS),a=this.model.get(this.model.DP.AUTO_RESOLVE),o=a!==this.model.DP.AUTO_RESOLVE_VALUES.NOT_SUPPORTED,l=_.map(i,function(e){return this.clusterManager.getClusterModelByClusterUuid(e.id)||e.name},this);this.$("[data-index="+n+"] .exceptionParameter").html(m(this.vtOptions({index:n,isAutoResolveSupported:o,parameters:t,hasThresholdConfig:s&&_.size(s)>0,autoResolve:a,disabled:!1,autoResolveVersionSupport:this.getAutoResolveVersionSupport(l)}))),this.applyNutanixInput(),this.policyExceptions.push({clusters:[],parameters:t}),1===this.policyExceptions.length?this.triggerAction(r.MODAL.ACT.AS_REBUILD):this.triggerAction(r.MODAL.ACT.AS_REFRESH)},deleteException:function(e){var t=this;this.clearBaseHeader();var n=this.$(e.currentTarget).closest(".policyException"),i=n.data("index");this.policyExceptions.splice(i,1),this.clusterSelectors[i].destroy(),this.clusterSelectors.splice(i,1),n.parent().remove();var s=0;_.each(this.$(".policyException"),function(e,n){$(e).attr("data-index",s).find(".exceptionTitle").html(t.i18ns("exception",++s))}),this.refreshClusterSelectors(),0===this.policyExceptions.length?this.triggerAction(r.MODAL.ACT.AS_REBUILD):this.triggerAction(r.MODAL.ACT.AS_REFRESH)},createClusterSelector:function(e,n,i,s){var a=new t({el:e,inputType:t.INPUT_TYPES.SELECT,initalSelectPrompt:this.i18n("CommonEntities.cluster"),selectedItems:i,selectableItems:n,itemNameLookupFunc:this.getClusterName,customClass:"modal-autocomplete",readOnly:s});a.onSelectionChangeEvent(this.selectionChangeEvent),a.render(),this.clusterSelectors.push(a)},refreshClusterSelectors:function(){var e=this.getSelectableClusters();_.each(this.clusterSelectors,function(t,n){t.setSelectableItems(e)}),e.length?this.$(".addException").show():this.$(".addException").hide()},getSelectableClusters:function(){var e=[];_.each(this.policyExceptions,function(t){t&&(e=e.concat(t.clusters))});var t=function(t){return _.find(e,function(e){return e.clusterUuid===t})},n=[];t(this.clusterManager.getPrismCentralClusterUuid())||n.push({id:this.clusterManager.getPrismCentralClusterUuid(),name:r.MULTICLUSTER_NAME});var i=void 0;return i=this.isLocalPCUpdate()?this.clusterManager.getClusterCollection().models:o.getPEs(r.PC_DELOS_VERSION,!0),_.each(i,function(e){t(e.get(a.CLUSTER_UUID))||n.push({id:e.get(a.CLUSTER_UUID),name:e.get(a.CLUSTER_NAME)})}),n},getExceptionsParameters:function(e,t,n){var i=this,s=[],a={};_.each(t,function(e){_.each(e[i.model.DP.PARAM_CLUSTER_UUIDS],function(t){a[t]={configurableParameters:e[i.model.DP.CONFIGURABLE_PARAMETERS],severityThresholdInfos:e[i.model.DP.SEVERITY_THRESHOLD_INFOS],autoResolve:e[i.model.DP.AUTO_RESOLVE]}})});var o={};_.each(e,function(e,t){_.each(e[i.model.DP.PARAM_CLUSTER_UUIDS],function(t){o[t]={configurableParameters:e[i.model.DP.CONFIGURABLE_PARAMETERS],severityThresholdInfos:e[i.model.DP.SEVERITY_THRESHOLD_INFOS],autoResolve:e[i.model.DP.AUTO_RESOLVE]}})});var r=[],l=this.model.get(this.model.DP.ALERT_CONFIGURABLE_PARAMETERS),c=this.model.get(this.model.DP.SEVERITY_THRESHOLD_INFOS),d=this.model.get(this.model.DP.AUTO_RESOLVE),p=this.model.get(this.model.DP.ALERT_TYPE_UUID),u=this.model.getId(),h=this.model.get(this.model.DP.NAME);return _.each(a,function(e,t){if(o[t]){var n=o[t][i.model.DP.AUTO_RESOLVE],a=e[i.model.DP.AUTO_RESOLVE],m=n!==a,f=o[t][i.model.DP.SEVERITY_THRESHOLD_INFOS],v=e[i.model.DP.SEVERITY_THRESHOLD_INFOS],g=_.some(v,function(e){if(null!==e[i.model.DP.ENABLED]){if(i.findMatchingParameter(f,e[i.model.DP.SEVERITY])[i.model.DP.ENABLED]!==e[i.model.DP.ENABLED])return!0}}),E=o[t][i.model.DP.CONFIGURABLE_PARAMETERS];if(E){var T=i.cloneParameters(e[i.model.DP.CONFIGURABLE_PARAMETERS]),C=i.copyParameters(T,E);C||g||m?r.push(i.createUpdatePayload(t,p,u,h,m?n:null,g?f:null,C?T:null)):s.push(t)}delete o[t]}else r.push(i.createUpdatePayload(t,p,u,h,d,c,l))}),_.each(o,function(e,t){var n=i.cloneParameters(l);i.copyParameters(n,e[i.model.DP.CONFIGURABLE_PARAMETERS]),r.push(i.createUpdatePayload(t,p,u,h,e[i.model.DP.AUTO_RESOLVE],e[i.model.DP.SEVERITY_THRESHOLD_INFOS],n))}),n&&this.populateGlobalBatchAttributes(r,s),r},copyParameters:function(e,t){var n=this,i=!1;return e&&e.length&&_.each(t,function(t){var s=n.findMatchingParameter(e,t[n.model.DP.SEVERITY]);_.each(t,function(e,t){n.hasValueChanged(s,t,e)&&(s[t]=e,i=!0)})}),i},createUpdatePayload:function(e,t,n,i,s,a,o){return this.isLocalPCUpdate()?this.createLocalPayload(e,t,n,i,s,a,o):this.createFanOutPayload(e,t,n,i,s,a,o)},createLocalPayload:function(e,t,n,s,a,o,r){var c,d=l.getDisplayableId(n);return c={},_defineProperty(c,f.DP.CLUSTER_UUID,e),_defineProperty(c,i.DP.ALERT_TYPE_ID,t),_defineProperty(c,i.DP.ID,e+"::"+d),_defineProperty(c,i.DP.SEVERITY_THRESHOLD_INFOS,o),_defineProperty(c,i.DP.ALERT_CONFIGURABLE_PARAMETERS,r),_defineProperty(c,i.DP.AUTO_RESOLVE,a),c},createFanOutPayload:function(e,t,n,s,a,o,c){var d={},p={},u=l.getDisplayableId(n);return d[f.DP.CLUSTER_UUID]=e,d[f.DP.OPERATION]=r.ACTION_UPDATE,p[i.DP.ALERT_TYPE_ID]=t,a!==this.model.DP.AUTO_RESOLVE_VALUES.NOT_SUPPORTED&&this.isAutoResolveSupportedInCluster(e)&&(p[i.DP.AUTO_RESOLVE]=a),p[i.DP.ID]=e+"::"+u,p[i.DP.NAME]=s,null!==o&&(p[i.DP.SEVERITY_THRESHOLD_INFOS]=o),null!==c&&(p[i.DP.ALERT_CONFIGURABLE_PARAMETERS]=c),d[f.DP.GENERIC_DTO]=p,d},isLocalPCUpdate:function(){return this.model.get(this.model.DP.APPLICABLE_FOR_PC)&&!this.model.get(this.model.DP.APPLICABLE_FOR_PE)},isAutoResolveSupportedInCluster:function(e){var t=this.clusterManager.getPrismCentralClusterUuid(),n=null;if(t===e)return!0;if(n=this.clusterManager.getClusterModelByClusterUuid(e)){var i=n.getNosVersion();return-1!==l.compareVersions(i,"4.6.2")}return!1},addKbInfo:function(){var e=this.model.get(this.model.DP.KB_LIST);if(e&&e.length){var t=_.first(e),n=this.$(".policy-kb");if(n.length){var i='<a href="'+t+'" target="_blank">\n              '+this.i18n("learn_more")+"</a>";n.nutanixMoreInfo({trigger:"hoverable",html:!0,placement:"right",title:i,template:'<div class="tooltip">\n                            <div class="tooltip-arrow"></div>\n                            <div class="tooltip-inner"></div>\n                          </div>'})}}}})}),define("text!templates/popups/alertpolicy/AlertPolicyContentView.html",[],function(){return'\x3c!-- The parent div modal is #popupAlertPolicy --\x3e\n<div data-ntnx-content-inner class="formContainer">\n  <div class="n-modal-loading" data-ntnx-section>\n    <div class="donut-loader-blue"></div>\n    <span class="n-loading-text"><%= i18n(\'loading\') %></span>\n  </div>\n  <div id="alertPolicyForm">\n    \x3c!-- @view: form goes here... --\x3e\n  </div>\n</div>\n'}),define("views/popups/alertpolicy/AlertPolicyPopupView",["views/basecomponents/popups/BasePopupView","views/popups/alertpolicy/AlertPolicyView","views/popups/alertpolicy/PCAlertPolicyView","models/alert/AlertPolicyModel","events/AppEvents","utils/AppConstants","text!templates/popups/alertpolicy/AlertPolicyContentView.html"],function(e,t,n,i,s,a,o){"use strict";return o=_.template(o),e.extend({el:"#popupAlertPolicy",alertPolicyModel:null,policyView:null,name:"AlertPolicyPopupView",events:{"click  .btnSave":"onBeforeSave","click  .btnClose":"hide","click  .btnCancel":"hide","click  .modal-header .close":"hide","keypress input":"onKeyPress","click input":"hideAlert"},overlayPopup:!0,initialize:function(t){e.prototype.initialize.apply(this,arguments),this.clusterManager.isMulticlusterUI()&&(_.bindAll(this,"policyUpdated"),s.onAppEvent(s.ENTITIES_UPDATED,this.policyUpdated))},render:function(){var e=this.canModifyByEntityType(a.ENTITY_ALERT_POLICY),t=[{text:e?this.i18n("cancel"):this.i18n("close"),extraClasses:"btnCancel n-btn-form"}];e&&t.push({isPrimary:!0,text:this.i18n("save"),extraClasses:"btnSave n-btn-form",extraAttr:[{key:"data-loading-text",value:"Saving..."}]}),this.$el.html(this.defaultTemplate({title:this.i18n("updatePolicy"),bodyContent:o(this.vtOptions({})),footerButtons:this.defaultFooter(t)})),this.$("#alertPolicyForm").addClass("alert-policy-container")},destroy:function(){this.policyView&&this.policyView.destroy(),this.policyView=null,s.offAppEvent(s.ENTITIES_UPDATED,this.policyUpdated),e.prototype.destroy.apply(this,arguments)},show:function(t){e.prototype.show.apply(this,arguments),t.actionTarget===a.ENTITY_ALERT_POLICY&&t.actionTargetId?this.editPolicy(t.actionTargetId,!1):this.$(".n-modal-loading").hide()},showForm:function(e,t){this.mode=e,this.triggerAction(a.MODAL.ACT.ALERT_HIDE),this.$(".popupTitle").text(this.i18ns("alertPolicy",a.ACTION_NAMES[e])),this.showSubview(".formContainer","left"),this.$(".btnCancel").show(),this.$(".btnSave").show()},editPolicy:function(e,s){this.$("#alertPolicyForm").empty(),this.alertPolicyModel=new i,this.alertPolicyModel.set(this.alertPolicyModel.idAttribute,e),this.clusterManager.isMulticlusterNavMode()?this.policyView=new n({el:"#alertPolicyForm",model:this.alertPolicyModel}):this.policyView=new t({el:"#alertPolicyForm",model:this.alertPolicyModel}),this.policyView.setParentView(this),this.loadPolicy({isAnimate:s})},loadPolicy:function(e){var t=this;this.$(".n-modal-loading").show(),this.alertPolicyModel.fetch({success:function(){t.$(".n-modal-loading").hide(),t.renderAlertPolicy(a.ACTION_UPDATE,t.policyView,e)},error:function(e,n){t.$(".n-modal-loading").hide(),t.triggerAction(a.MODAL.ACT.ALERT_SHOW,{type:a.MODAL.ALERT.TYPE_ERROR,message:n.responseText})}})},renderAlertPolicy:function(e,t,n){t.render(),this.showForm(e,n.isAnimate),n.showExceptionsWarning&&this.triggerAction(a.MODAL.ACT.ALERT_SHOW,{type:a.MODAL.ALERT.TYPE_WARNING,message:this.i18n("warningExceptionsAddedMsg")}),t.checkPrerequisites(),t.onResize()},onBeforeSave:function(){var e=this;this.policyView&&this.canModifyByEntityType(a.ENTITY_ALERT_POLICY)&&(this.$(".btnSave").button("loading"),this.policyView.onSave({success:function(){e.hide()},error:function(){e.$(".btnSave").button("reset")}}))},hideAlert:function(){this.triggerAction(a.MODAL.ACT.ALERT_HIDE)},policyUpdated:function(e,t){t.entityType===a.ENTITY_ALERT_POLICY&&t.customErrorMessage&&$.nutanixConfirm({msg:t.customErrorMessage,yes:function(){this.onBeforeSave()},no:function(){this.loadPolicy({showExceptionsWarning:!0})},yesText:this.i18n("btnRetry"),noText:this.i18n("btnAddExceptions"),context:this})}})}),define("text!templates/popups/alertpolicy/UDAPolicyAnomalyThreshold.html",[],function(){return"<h5 data-ntnx-title class=\"anomaly-title\">\n  <span><%= i18n('behavioralAnomaly') %></span>\n  <span class=\"anomaly-info\"></span>\n</h5>\n<form role=\"form\" lpformnum=\"1\"\n      class=\"policy-options-form behavioral-anomaly-form\">\n  <div data-ntnx-form-inline=\"form-full-width\">\n    <%= Components.checkbox({\n      id     : 'anomaly-trigger-check',\n      jsClasses: 'threshold-checkbox anomaly-checkbox',\n      checked: anomalyChecked,\n      disabled: featureDisabled\n    }) %>\n    <label data-ntnx-inline-label for=\"anomaly-trigger-check\">\n      <span class=\"alert-indicator css-icon state-icon anomaly-indicator -<%= severity && severity.toLowerCase() || 'warning'%>\"></span>\n      <span><%= i18n('alertAnomalies') %></span>\n    </label>\n    <%= Components.select({\n      id : 'anomaly-severity',\n      dataTestAttribute: 'alertpolicy_udapolicythresholdview_anomaly-severity',\n      disabled: featureDisabled,\n      options : [\n        {\n          name : i18n('warning'),\n          value : 'WARNING',\n          selected: severity === 'WARNING'\n        },\n        {\n          name : i18n('critical'),\n          value : 'CRITICAL',\n          selected: severity === 'CRITICAL'\n        }\n      ]\n    }) %>\n  </div>\n  <div data-ntnx-form-inline=\"form-full-width\">\n    <%= Components.checkbox({\n      id     : 'ignore-trigger-check',\n      jsClasses: 'threshold-checkbox ignore-checkbox',\n      checked: safetyZone.hasValue,\n      disabled: featureDisabled\n    }) %>\n    <label data-ntnx-inline-label for=\"threshold-label ignore-trigger-check\">\n      <span class=\"alert-indicator css-icon state-icon -ignore\"></span>\n      <span><%= i18n('ignoreAnomaliesBtwn') %></span>\n    </label>\n\n    <input id=\"ignore-lower-operator\" class=\"ignore-operator\" value=\"<%= operators.LESS_THAN %>\"/>\n    <%= Components.groupInput({\n      label : null,\n      placeholder : '',\n      value : safetyZone.lower && safetyZone.lower.hasValue ? safetyZone.lower.displayVal : '',\n      attr : '',\n      classes : 'ignore-threshold lower-threshold threshold-input',\n      converter: converter,\n      unit: unit || '',\n      disabled: featureDisabled\n    }) %>\n    <span class=\"comparison-label\"><%= i18n('and') %></span>\n    <input id=\"ignore-upper-operator\" class=\"ignore-operator\" value=\"<%= operators.GREATER_THAN %>\"/>\n    <%= Components.groupInput({\n      label : null,\n      placeholder : '',\n      value : safetyZone.upper && safetyZone.upper.hasValue ? safetyZone.upper.displayVal : '',\n      attr : '',\n      classes : 'ignore-threshold upper-threshold threshold-input',\n      converter: converter,\n      unit: unit || '',\n      disabled: featureDisabled\n    }) %>\n  </div>\n</form>\n"}),define("text!templates/popups/alertpolicy/UDAPolicyThreshold.html",[],function(){return"<h5 data-ntnx-title class=\"static-title\">\n  <span class=\"static static-title\"><%= i18n('staticThreshold') %></span>\n  <span class=\"static-info\"></span>\n</h5>\n<form role=\"form\" lpformnum=\"1\"\n    class=\"policy-options-form policy-threshold static -grid\">\n<% _.each(thresholds, function(threshold) { %>\n  <div data-ntnx-form-inline=\"form-full-width\" class=\"<%= threshold.type %> threshold-box \">\n      <%= Components.checkbox({\n        id     : threshold.type + '-trigger-check',\n        jsClasses: 'threshold-checkbox '+ threshold.type + '-checkbox',\n        checked: threshold.hasValue,\n        disabled: threshold.disabled\n      }) %>\n      <label data-ntnx-inline-label for=\"threshold-label <%= threshold.type %>-trigger-check\">\n        <span class=\"alert-indicator css-icon state-icon -<%= threshold.type %>\"></span>\n        <span><%- i18n(threshold.type + 'Trigger') %></span>\n      </label>\n      \x3c!-- the lower operator --\x3e\n      <%= Components.select({\n        id : threshold.type + '-lower-operator',\n        disabled: threshold.disabled,\n        options : [\n          {\n            name : i18n('le'),\n            value : operators.LESS_THAN_OR_EQUAL,\n            selected: threshold.lower && threshold.lower.operator === operators.LESS_THAN_OR_EQUAL\n          },\n          {\n            name : i18n('lt'),\n            value : '=lt=',\n            selected: threshold.lower && threshold.lower.operator === operators.LESS_THAN\n          }\n        ]\n      }) %>\n      <%= Components.groupInput({\n        label : null,\n        placeholder : '',\n        value : threshold.lower && threshold.lower.hasValue ? threshold.lower.displayVal : '',\n        attr : '',\n        classes : threshold.type + '-threshold lower-threshold threshold-input',\n        converter: converter,\n        unit: unit || '',\n        disabled: threshold.disabled\n      }) %>\n      <span class=\"comparison-label\"><%= i18n('or') %></span>\n      \x3c!-- the upper operator --\x3e\n      <%= Components.select({\n        id : threshold.type + '-upper-operator',\n        disabled: threshold.disabled,\n        options : [\n          {\n            name : i18n('ge'),\n            value : operators.GREATER_THAN_OR_EQUAL,\n          selected: threshold.upper && threshold.upper.operator === operators.GREATER_THAN_OR_EQUAL\n          },\n          {\n            name :  i18n('gt'),\n            value : operators.GREATER_THAN,\n            selected: threshold.upper && threshold.upper.operator === operators.GREATER_THAN\n          }\n        ]\n      }) %>\n      <%= Components.groupInput({\n        label : null,\n        placeholder : '',\n        value : threshold.upper && threshold.upper.hasValue ? threshold.upper.displayVal : '',\n        attr : '',\n        classes : threshold.type + '-threshold upper-threshold threshold-input',\n        converter: converter,\n        unit: unit || '',\n        disabled: threshold.disabled\n      }) %>\n  </div>\n<% }); %>\n  </div>\n</form>"}),define("views/popups/alertpolicy/UDAPolicyThresholdView",["views/basecomponents/popups/BasePopupSubView","components/Components","data/DataProperties","utils/AppConstants","utils/ConversionUtil","text!templates/popups/alertpolicy/UDAPolicyAnomalyThreshold.html","text!templates/popups/alertpolicy/UDAPolicyThreshold.html"],function(e,t,n,i,s,a,o){"use strict";var r=_.template(a),l=_.template(o),c={CRITICAL:"CRITICAL",WARNING:"WARNING"},d=[0,5,10,15,20,30],p=_.template("<%= entityType%>.<%=metric%><%=operator%><%=threshold%>"),u=_.template("<%= entityType %>.<%= metric %>"),h=_.template('<section data-ntnx-section class="anomaly-threshold">\n      </section>\n      <section data-ntnx-section="type-separator" class="static-threshold">\n      </section>\n      <section data-ntnx-section="type-separator" class="trigger-conditions">\n        <form role="form" lpformnum="1"\n            class="policy-options-form policy-threshold -grid">\n          <div data-ntnx-form-inline="form-full-width" class="trigger-box">\n            <label data-ntnx-inline-label>\n              <div><span><%= i18n("triggerCondition") %></span></div>\n            </label>\n          </div>\n        </form>\n      </section>'),m={EQUALS:"==",NOT_EQUALS:"!=",GREATER_THAN:"=gt=",LESS_THAN:"=lt=",GREATER_THAN_OR_EQUAL:"=ge=",LESS_THAN_OR_EQUAL:"=le="},f={UPPER:"upper",LOWER:"lower"};return e.extend({name:"UDAPolicyThresholdView",events:{"input .threshold-input":"thresholdValueChanged","click .threshold-checkbox":"onThresholdCheckboxClick","change #anomaly-severity":"onAnomalySeverityChanged","change #critical-operator":"onSelectItem","change #warning-operator":"onSelectItem"},initialize:function(t){e.prototype.initialize.apply(this,arguments),this.chartView=t.chartView,this.entityType=t.entityType,this.metric=t.metric,this.unit=t.unit,this.model=t.model,this.xfitInfo=t.xfitInfo||{},this.conditions={},this.initThresholdValues()},render:function(){return this.$el.html(h(this.vtOptions())),this.renderThresholdDetails(),this},destroy:function(){this.$(".static-info").nutanixMoreInfo("destroy"),this.$(".anomaly-info").nutanixMoreInfo("destroy"),e.prototype.destroy.apply(this,arguments)},setThresholdValue:function(e,t,n,i,a){var o=this.validateThresholdValue(t)||this.validateThresholdRange(a,t,i);if(o)return this.showHeaderError(o),this.chartThresholdValue(e,null,i),!1;var r=t;return _.isNull(t)||(r=s.convertDisplayValueToUnit(t,n)),this.chartThresholdValue(e,r,i),!0},getThresholdConditions:function(e){var t=this.getAllConditionsToSave(this.entityType,this.metric);if(null!==t){if(_.size(t)<=0)return void this.showHeaderError(this.i18n("selectThresholdError"));var n=parseInt(this.$("#trigger_wait_period_in_secs").val(),10)*i.SECONDS_PER_MINUTE;return e[this.model.DP.TRIGGER_CONDITIONS]=t,e[this.model.DP.TRIGGER_WAIT_PERIOD]=n,e}},findMetricByName:function(e,t){if(this.parentView)return this.parentView.findMetricByName(e,t)},clearThresholdValue:function(e){this.chartView&&this.chartView.resetThresholdValue(e)},chartThresholdValue:function(e,t,i,s){if(this.chartView){var a={silent:s};e===n.ALERT_POLICY.CONDITION_TYPE.ANOMALY?this.chartView.setAnomalyThresholdValue(t):_.isNull(e)?this.chartView.setThresholdValues(t):this.chartView.setThresholdValue(e,t,i,a)}},clearWarningHeader:function(){this.parentView&&this.parentView.clearWarningHeader()},initThresholdValues:function(){var e=this;if(!this.model.isNew()){var t=n.ALERT_POLICY.CONDITION_TYPE,i=this.model.getMetricConditionByType(t.STATIC_THRESHOLD);_.each(i,function(t){e.prepareConditions(t)}),this.conditions.CRITICAL=i.CRITICAL,this.conditions.WARNING=i.WARNING,this.conditions[t.ANOMALY]=this.model.getMetricConditionByType(t.ANOMALY);var s=this.model.getMetricConditionByType(t.SAFETY_ZONE);this.prepareConditions(s),this.conditions[t.SAFETY_ZONE]=s,this.chartThresholdValue(null,this.conditions,null,!0)}},prepareConditions:function(e){var t=this;_.each(e,function(n){n.hasValue=n.value||0===n.value,n.hasValue&&(e.hasValue=!0,n.displayVal=s.convertUnitValueToDisplay(n.value,t.unit))})},renderThresholdDetails:function(){this._renderStaticThresholdDetails(),this._renderAnomalyThresholdDetails(),this._renderWaitPeriodDetails(),this.triggerAction(i.MODAL.ACT.AS_REBUILD)},_renderStaticThresholdDetails:function(){var e=this.conditions.CRITICAL||{};e.type=c.CRITICAL.toLowerCase();var t=this.conditions.WARNING||{};if(t.type=c.WARNING.toLowerCase(),this.model.isNew()){var n=this.getDefaultThresholdValue();parseFloat(n)>=0&&(e.hasValue=!0,e.upper={hasValue:!0,displayVal:s.convertUnitValueToDisplay(n,this.unit),operator:m.GREATER_THAN},this.chartThresholdValue(c.CRITICAL,n,f.UPPER,!0))}t.disabled=this.shouldAnomalyThresholdBeEnabled(),this.$(".static-threshold").html(l(this.vtOptions({thresholds:[e,t],operators:m,unit:s.getUnitLabel(this.unit),converter:this.unit}))),this.$(".static-info").nutanixMoreInfo({icon:"information-tooltip",classes:["-nudge-up"],placement:"right",title:this.i18n("staticInfo")})},shouldAnomalyThresholdBeEnabled:function(){return this.model.isNew()&&!this.xfitInfo.disabled||this.conditions[n.ALERT_POLICY.CONDITION_TYPE.ANOMALY]},_renderAnomalyThresholdDetails:function(){var e=n.ALERT_POLICY.CONDITION_TYPE,t=this.conditions[e.ANOMALY];this.model.isNew()&&(t=n.ALERT_POLICY.SEVERITY_LEVEL.WARNING,this.chartThresholdValue(e.ANOMALY,t,!0));var i=!this.xfitInfo.disabled;this.$(".anomaly-threshold").html(r(this.vtOptions({unit:s.getUnitLabel(this.unit),converter:this.unit,severity:t,operators:m,anomalyChecked:this.shouldAnomalyThresholdBeEnabled(),safetyZone:this.conditions[e.SAFETY_ZONE]||{},featureDisabled:!i})));var a=this.i18n("anomalyInfo");i||(a+=" "+this.xfitInfo.message),this.$(".anomaly-info").nutanixMoreInfo({icon:"information-tooltip",classes:["-nudge-up"],placement:"right",title:a})},_renderWaitPeriodDetails:function(){var e=this.model.get(this.model.DP.TRIGGER_WAIT_PERIOD);0===e||e||(e=600),this.$(".trigger-box").append(t.select({id:"trigger_wait_period_in_secs",dataTestAttribute:"alertpolicy_udapolicythresholdview_trigger_wait_period_in_secs",jsClasses:"wait_period_trigger",variants:"bottom-anchor",options:this.getWaitPeriodOptions(e)}))},updateChartView:function(e){var t=this;if(this.chartView=e,this.metric&&this.entityType){var i=[c.CRITICAL,c.WARNING];this.$("#anomaly-trigger-check").is(":checked")&&(i.push("ignore"),this.chartThresholdValue(n.ALERT_POLICY.CONDITION_TYPE.ANOMALY,this.getAnomalyThresholdSeverity())),_.each(i,function(e){var i=t.getThresholdFromInput(e.toLowerCase());_.each(i,function(i){var a=s.convertDisplayValueToUnit(i.thresholdValue,i.unit);"ignore"===e&&(e=n.ALERT_POLICY.CONDITION_TYPE.SAFETY_ZONE),t.chartThresholdValue(e,a,i.range)})})}},getAnomalyThresholdSeverity:function(){return this.$("#anomaly-severity").val()},
getAllConditionsToSave:function(e,t){var i=this,s=this.findMetricByName(e,t),a=s[n.METRICS_DP.DATA_TYPE],o=[],r={entityType:e,metric:t,dataType:a},l=[];l.push(_.extend({threshold:c.CRITICAL,type:n.ALERT_POLICY.CONDITION_TYPE.STATIC_THRESHOLD,severity:c.CRITICAL},r)),l.push(_.extend({threshold:c.WARNING,type:n.ALERT_POLICY.CONDITION_TYPE.STATIC_THRESHOLD,severity:c.WARNING},r)),this.$("#anomaly-trigger-check").is(":checked")&&(o.push(this.getAnomalyConditionFromInput(e,t)),l.push(_.extend({threshold:"ignore",type:n.ALERT_POLICY.CONDITION_TYPE.SAFETY_ZONE,severity:this.getAnomalyThresholdSeverity()},r)));var d=null;return _.some(l,function(e){var t=i.getConditionForSave(e);if(!_.isArray(t))return d=t,!0;t.length&&(o=o.concat(t))}),d?(this.showHeaderError(d),null):o},getConditionForSave:function(e){var t=this,i=null,a=[],o=e.threshold.toLowerCase(),r=this.getThresholdFromInput(o);return r?r.length?(_.some(r,function(o){if(e.dataType===n.METRICS_DP.DATA_TYPES.LONG||e.dataType===n.METRICS_DP.DATA_TYPES.DOUBLE){if(i=t.validateThresholdValue(o.thresholdValue))return!0;o.thresholdValue=s.convertDisplayValueToUnit(o.thresholdValue,o.unit)}if(null===o.thresholdValue)return i=t.i18n("invalidThresholdValueError"),!0;a.push({condition_type:e.type,condition:p({entityType:e.entityType,metric:e.metric,operator:o.operator,threshold:o.thresholdValue}),severity_level:e.severity})}),i||a):this.i18ns("enterThresholdError",o):a},getThresholdFromInput:function(e,t){var n=this,i=f;if(t&&(i=[t]),this.$("#"+e+"-trigger-check").is(":checked")){var s=[],a=this.$("."+e+"-threshold").attr("model-converter");return _.each(i,function(t){var i=n.$("#"+e+"-"+t+"-operator").val(),o=n.$("."+e+"-threshold."+t+"-threshold").val();o&&s.push({thresholdValue:o,operator:i,threshold:e,range:t,unit:a})},this),s}},getAnomalyConditionFromInput:function(e,t){return{condition_type:n.ALERT_POLICY.CONDITION_TYPE.ANOMALY,condition:u({entityType:e,metric:t}),severity_level:this.getAnomalyThresholdSeverity()}},getWaitPeriodOptions:function(e){var t=this,n=e/i.SECONDS_PER_MINUTE,s=[];return _.each(d,function(e){s.push({name:e+" "+t.i18n("minutes"),value:e,selected:n===e})}),s},getDefaultThresholdValue:function(){var e=this.findMetricByName(this.entityType,this.metric);return e?e[n.METRICS_DP.DEFAULT_VALUE]:""},validateThresholdValue:function(e){var t=this.findMetricByName(this.entityType,this.metric);if(t){var i=t[n.METRICS_DP.RANGE],a=t[n.METRICS_DP.DATA_TYPE];if(a===n.METRICS_DP.DATA_TYPES.LONG||a===n.METRICS_DP.DATA_TYPES.DOUBLE){var o=i[n.METRICS_DP.START_RANGE],r=i[n.METRICS_DP.END_RANGE];if(null!==o&&(o=s.convertUnitValueToDisplay(o,t.unit)),null!==r&&(r=s.convertUnitValueToDisplay(r,t.unit)),isNaN(e))return this.i18n("invalidThresholdError");var l=parseFloat(e);if(null!==r&&null!==o&&(l<o||l>r))return this.i18ns("thresholdRangeError",o,r);if(null!==o&&l<o)return this.i18ns("thresholdStartRangeError",o)}}return null},validateThresholdRange:function(e,t,n){var i=n===f.UPPER,s=i?f.LOWER:f.UPPER,a=this.getThresholdFromInput(e,s);if(a&&a.length){var o=parseInt(_.first(a).thresholdValue,10);return i&&t<=o?this.i18n("upperThresholdRangeError"):!i&&t>=o?this.i18n("lowerThresholdRangeError"):void 0}},thresholdValueChanged:_.debounce(function(e){this.clearWarningHeader();var t=$(e.currentTarget),i=t.attr("model-converter"),s=$.trim(t.val()),a=void 0,o=void 0;t.hasClass("critical-threshold")?(a=c.CRITICAL,o=a.toLowerCase()):t.hasClass("warning-threshold")?(a=c.WARNING,o=a.toLowerCase()):t.hasClass("ignore-threshold")&&(a=n.ALERT_POLICY.CONDITION_TYPE.SAFETY_ZONE,o="ignore");var r=t.hasClass("lower-threshold")?f.LOWER:f.UPPER;if(a){var l=this.setThresholdValue(a,s,i,r,o),d=this.$("#"+o+"-trigger-check");d.prop("disabled")||d.prop("checked",l)}},300),onThresholdCheckboxClick:function(e){this.clearWarningHeader();var t=$(e.currentTarget);if(!t.is(":checked"))return void(t.hasClass("critical-checkbox")?(this.$(".critical-threshold").val(""),this.clearThresholdValue(c.CRITICAL)):t.hasClass("warning-checkbox")?(this.$(".warning-threshold").val(""),this.clearThresholdValue(c.WARNING)):t.hasClass("ignore-checkbox")?(this.$(".ignore-threshold").val(""),this.clearThresholdValue(n.ALERT_POLICY.CONDITION_TYPE.SAFETY_ZONE)):this.disableAnomalyThreshold());t.hasClass("anomaly-checkbox")?this.enableAnomalyThreshold():t.hasClass("ignore-checkbox")&&(this.$("#anomaly-trigger-check").prop("checked",!0),this.enableAnomalyThreshold(),this.setDefaultSafetyZone())},setDefaultSafetyZone:function(){if(this.chartView){var e=Math.floor(this.chartView.getBandMin()),t=Math.ceil(this.chartView.getBandMax());this.validateThresholdValue(e)||(this.$(".ignore-threshold.lower-threshold").val(e),this.chartThresholdValue(n.ALERT_POLICY.CONDITION_TYPE.SAFETY_ZONE,s.convertDisplayValueToUnit(e,this.unit),f.LOWER)),this.validateThresholdValue(t)||(this.$(".ignore-threshold.upper-threshold").val(t),this.chartThresholdValue(n.ALERT_POLICY.CONDITION_TYPE.SAFETY_ZONE,s.convertDisplayValueToUnit(t,this.unit),f.UPPER))}},enableAnomalyThreshold:function(){this.chartThresholdValue(n.ALERT_POLICY.CONDITION_TYPE.ANOMALY,this.getAnomalyThresholdSeverity()),this.$(".warning-threshold").val(""),this.$(".warning-threshold").prop("disabled",!0),this.$("#warning-trigger-check").prop("checked",!1),this.$("#warning-trigger-check").prop("disabled",!0),this.$("#warning-lower-operator").trigger("disable"),this.$("#warning-upper-operator").trigger("disable"),this.clearThresholdValue(c.WARNING)},disableAnomalyThreshold:function(){this.clearThresholdValue(n.ALERT_POLICY.CONDITION_TYPE.ANOMALY),this.$(".warning-threshold").prop("disabled",!1),this.$("#warning-trigger-check").prop("disabled",!1),this.$("#warning-lower-operator").prop("disabled",!1).trigger("enable"),this.$("#warning-upper-operator").prop("disabled",!1).trigger("enable"),this.$(".ignore-threshold").val(""),this.$("#ignore-trigger-check").prop("checked",!1),this.clearThresholdValue(n.ALERT_POLICY.CONDITION_TYPE.SAFETY_ZONE)},onAnomalySeverityChanged:function(){var e=this.getAnomalyThresholdSeverity(),t=this.$(".anomaly-indicator");e===c.CRITICAL?(t.removeClass("-warning"),t.addClass("-critical")):e===c.WARNING&&(t.removeClass("-critical"),t.addClass("-warning")),this.chartThresholdValue(n.ALERT_POLICY.CONDITION_TYPE.ANOMALY,e)},onSelectItem:function(){this.clearWarningHeader()}})}),define("views/charts/MetricDistributionBarChartView",["d3","nvd3","d3tip","managers/NotificationManager","views/basecomponents/charts/BaseNVD3Chart","views/charts/ThresholdChartMixin","models/capacityplanning/CPQueryModel","utils/AppConstants","utils/ConversionUtil","utils/StatsUtil"],function(e,t,n,i,s,a,o,r,l,c){"use strict";var d={top:15,bottom:15,right:50,left:30};return s.extend(_.extend({},a,{name:"MetricDistributionBarChartView",entityType:null,chartMargins:d,className:"d3-chart n-chart",initializeStatsProperties:function(e){if(e=e||{},!e.entityType||!e.metricType)throw new Error("entityType and metrics are mandatory options");this.entityType=e.entityType,this.filterEntityType=e.filterEntityType,this.metricType=e.metricType,this.clusterId=e.clusterId,this.numberOfBuckets=e.numberOfBuckets||5,this.unit=e.unit||c.getMetricUnits(this.metricType)||c.UOM_PPM,this.chartType=s.CHART_TYPE.HORIZONTAL_BAR_CHART,this.thresholdValues={}},addAdditonalInfoToChart:function(e){!e||this.chart},validateChartData:function(e){return!!(e&&e.length&&e[0].values&&e[0].values.length)},getChartData:function(){var e=this,t=this.getQueryModel();this.model=t,this.showLoader(),t.save(null,{success:function(){var n=e.parseQueryResponse(t);e.chartData=n,e.hideLoader(),e.renderChart(e.chartData)},error:function(){e.hideLoader(),i.showClientNotification(r.NOTIFY_ERROR,e.i18n("error.data_fetch"))}})},getQueryModel:function(){var e=new o({entity_type:this.entityType,grouping_attribute:this.metricType,number_of_buckets:this.numberOfBuckets,group_member_count:0});return e.set(o.DP.GROUPING_ATTR_TYPE,e.GROUPING_TYPE_CONTINUOUS),e.setTimeInterval(this.startTime,this.endTime,this.samplingInterval),e},parseQueryResponse:function(e){var t=this;if(e){var n=e.DP,i=e.get(n.GROUP_RESULTS),s=[];if(!i||i.length<2)return void this.showNoData();var a=parseInt(i[0][n.GROUP_BY_COLUMN_VALUE],10)+(parseInt(i[0][n.GROUP_BY_COLUMN_VALUE],10)-parseInt(i[1][n.GROUP_BY_COLUMN_VALUE],10));return s.push({range:this.getBucketRange(a,i[0][n.GROUP_BY_COLUMN_VALUE]),value:i[0][n.TOTAL_ENTITY_COUNT]}),_.each(i,function(e,a){a!==i.length-1&&s.push({range:t.getBucketRange(i[a][n.GROUP_BY_COLUMN_VALUE],i[a+1][n.GROUP_BY_COLUMN_VALUE]),value:i[a+1][n.TOTAL_ENTITY_COUNT]})}),[{key:this.metricType,values:s}]}},getBucketRange:function(e,t){var n=parseInt(l.convertUnitValueToDisplay(e,this.unit),10);return[parseInt(l.convertUnitValueToDisplay(t,this.unit),10),n]},getXAxisDataPicker:function(){return function(e){return e&&e.range}},getYAxisDataPicker:function(){return function(e){return e&&e.value}},xAxisTickFormatter:function(e){return e&&e[1]},yAxisTickFormatter:function(e){return e},setMetric:function(e){this.metric=e,this.getChartData()}}))}),define("views/charts/AnomalyDistributionBarChartView",["views/charts/MetricDistributionBarChartView","models/capacityplanning/CPQueryModel","data/DataProperties","utils/AppConstants","utils/ConversionUtil","utils/AlertUtil"],function(e,t,n,i,s,a){"use strict";var o={top:15,bottom:15,right:50,left:30},r=_.template("<div class='metric-threshold-tooltip'>\n        <div><%= lower %> - <%= upper %> <%= units %></div>\n        <div><%= i18ns('anomalies', anomalyCount) %></div>\n      </div>");return e.extend({name:"AnomalyDistributionBarChartView",chartMargins:o,addAdditonalInfoToChart:function(){e.prototype.addAdditonalInfoToChart.apply(this,arguments),this.addChartOverrides()},addChartOverrides:function(){var e=this;this._svg.selectAll(".nv-x.nv-axis text").style("text-anchor","start").attr("transform","translate(-20,0)"),this.chart.tooltipContent(function(t,n,i,a){var o=a&&a.point&&a.point.range||[];return r(e.vtOptions({lower:o[0],upper:o[1],units:s.getUnitLabel(e.unit),anomalyCount:i}))})},getQueryModel:function(){var e=new t({entity_type:this.entityType,grouping_attribute:n.ALERT_METRIC_LONG_VALUE,number_of_buckets:this.numberOfBuckets,group_member_count:0});e.set(t.DP.GROUPING_ATTR_TYPE,e.GROUPING_TYPE_CONTINUOUS);var i=this._setAnomalyQueryFilters({});return e.set(e.DP.FILTER_EXPR,i),e},_setAnomalyQueryFilters:function(e){return e=a.setMetricFilter(e,this.metricName,i.ENTITY_EVENT),e=a.setIndicatorEntityTypeFilter(e,this.filterEntityType,i.ENTITY_EVENT),e=a.setClassificationFilter(e,i.EVENT.TYPE.ANOMALOUS,i.ENTITY_EVENT),e=a.setTimeRangeFilter(e,this.startTime,this.endTime,i.ENTITY_EVENT),this.clusterId&&(e=a.setClusterFilter(e,this.clusterId,i.ENTITY_EVENT)),e}})}),define("models/alert/MetricDataVisualizationModel",["models/stats/StatsModel","models/PollingModel","data/DataURLConstants","utils/AppConstants"],function(e,t,n,i){"use strict";var s={SAMPLING_INTERVAL_SECS:"samplingIntervalSecs",INTERVAL:"interval",START_TIME_IN_USECS:"startTimeInUsecs",END_TIME_IN_USECS:"endTimeInUsecs",START_TIME:"startTime",END_TIME:"endTime",VALUES:"metricValues",ENTITY_TYPE:"entityType",METRIC_IDS:"metricIds",SCOPE_ENTITY_TYPE:"scopeEntityType",SCOPE_ENTITY_ID:"scopeEntityUuid"};return e.extend({urlRoot:n.METRIC_DATA_VISUALIZATION,name:"MetricDataVisualizationModel",defaults:{metricName:null,startTimeInUsecs:null,endTimeInUsecs:null,interval:null,metricValues:[]},DP:s,initialize:function(){t.prototype.initialize.apply(this,arguments),this.enableNotifications=!1},getStatsURL:function(){return this.urlRoot},setEntityFilter:function(e,t){var n;this.set((n={},_defineProperty(n,this.DP.SCOPE_ENTITY_TYPE,e),_defineProperty(n,this.DP.SCOPE_ENTITY_ID,t),n),{silent:!0})},parse:function(e){var t=[];return e&&e[this.DP.VALUES]&&e[this.DP.VALUES].length>0&&(e.successful=!0,this.set(s.START_TIME,Math.round(e[s.START_TIME_IN_USECS]/1e3),{silent:!0}),this.set(s.END_TIME,Math.round(e[s.END_TIME_IN_USECS]/1e3),{silent:!0}),t.push(this.processStats(this.getDataPoints(e)))),{stats:t}},toJSON:function(){return{entityType:this.get(this.DP.ENTITY_TYPE),metricName:_.first(this.get(this.DP.METRIC_IDS)),scopeEntityType:this.get(this.DP.SCOPE_ENTITY_TYPE),scopeEntityUuid:this.get(this.DP.SCOPE_ENTITY_ID),startTimeInUsecs:this.get(this.DP.START_TIME)*i.MICROS_PER_MILLI,endTimeInUsecs:this.get(this.DP.END_TIME)*i.MICROS_PER_MILLI}}},{DP:s})}),define("text!templates/popups/alertpolicy/UDAPolicyView.html",[],function(){return'<div class="new-alert-policy">\n  \x3c!-- First Column --\x3e\n  <div class="alert-policy-properties">\n\n    <form role="form" lpformnum="1">\n\n      <section data-ntnx-section>\n        <label for="entity-type" data-ntnx-label>\n          <%= i18n(\'entityType\') %>\n        </label>\n        <div class="entity-type-control">\n          \x3c!--Entity type control here--\x3e\n        </div>\n      </section>\n\n      <section data-ntnx-section>\n        <label for="entity-scope" data-ntnx-label>\n          <%= i18n(\'entity\') %>\n        </label>\n        <div class="entity-scope-control">\n          \x3c!--Entity scope control here--\x3e\n        </div>\n        <div class="spotlight-control">\n          <section data-ntnx-section data-test="alertpolicy_udapolicyview_spotlight-search" class="n-spotlight">\n          </section>\n        </div>\n        <div class="category-control">\n          <section data-ntnx-section class="category-selector-outer">\n          </section>\n        </div>\n      </section>\n\n      <section data-ntnx-section>\n        <label for="metric" data-ntnx-label>\n          <%= i18n("metric")%>\n        </label>\n        <div class="metric-control">\n          \x3c!--Metric control here--\x3e\n        </div>\n      </section>\n\n      <section data-ntnx-section>\n        <label for="impactType" data-ntnx-label>\n          <%= i18n("impactType")%>\n        </label>\n        <div class="impact-type-control">\n          \x3c!-- Impact type control here--\x3e\n        </div>\n      </section>\n\n      <section data-ntnx-section="type-separator">\n        <label for="policy-name" data-ntnx-label>\n          <%= i18n("policyName")%>\n        </label>\n        <input type="text" id="title" class="policy-title" value="<%- model.title || \'\'%>">\n      </section>\n\n      <section data-ntnx-section>\n        <label for="description" data-ntnx-label>\n          <%= i18n("description")%>\n          <span data-ntnx-label-flag>*<%= i18n("optional")%></span>\n        </label>\n        <input type="text" id="description"\n               value="<%- model.description || \'\'%>">\n      </section>\n\n      <section data-ntnx-section="type-separtor">\n        <div data-ntnx-form-inline class="auto-resolve-checkbox">\n          <%= Components.checkbox({\n            id     : \'autoResolve-trigger-check\',\n            checked: autoResolve ? true: false,\n          }) %>\n          <label data-ntnx-inline-label for="autoResolve-trigger-check">\n            <span><%= i18n("autoResolveAlerts") %></span>\n            <div class="auto-resolve-info"></div>\n          </label>\n        </div>\n        <div data-ntnx-form-inline>\n          <%= Components.checkbox({\n            id     : \'enable-trigger-check\',\n            checked: enabled ? true: false,\n          }) %>\n          <label data-ntnx-inline-label for="enable-trigger-check">\n            <span><%= i18n("enablePolicy") %></span>\n          </label>\n        </div>\n      </section>\n\n    </form>\n  </div>\n\n  \x3c!-- Second Column --\x3e\n  \x3c!-- Policy instructions, show by default--\x3e\n  <div class="alert-policy-instruction">\n    <div class="policy-instruction">\n      <%= i18n("selectEntityAndMetric")%>\n    </div>\n  </div>\n\n  \x3c!-- Second Column --\x3e\n  <div class="alert-policy-options">\n    <div class="metric-history">\n      <section data-ntnx-section>\n\n        <h5 data-ntnx-title>\n          <div class="header-left">\n            <span class="metric-header"></span>\n            <span class="anomaly-count"></span>\n            <span class="chart-info"></span>\n          </div>\n          <div class="header-right"></div>\n        </h5>\n        <div class="charts-container metric-chart">\n          <div class="chart-titles">\n            <span class="metric-chart-title chart-title"><%= i18n(\'metric_chart\') %></span>\n            <span class="anomaly-chart-title chart-title"><%= i18n(\'anomaly_chart\') %></span>\n          </div>\n          <div class="chart-container"></div>\n          <div class="anomaly-chart-container"></div>\n        </div>\n      </section>\n    </div>\n\n    <div class="thresholds"></div>\n\n  </div>\n</div>\n'}),define("views/popups/alertpolicy/UDAPolicyView",["views/basecomponents/popups/BasePopupSubView","views/basecomponents/spotlight/SpotlightView","views/utils/CategorySelector","views/popups/alertpolicy/UDAPolicyThresholdView","views/charts/MetricThresholdChartView","views/charts/AnomalyDistributionBarChartView","models/alert/MetricDataVisualizationModel","models/capacityplanning/EntityEventQueryModel","components/Components","data/DataProperties","utils/AppUtil","utils/AlertUtil","utils/AppConstants","utils/StatsUtil","utils/SubViewHelper","text!templates/popups/alertpolicy/UDAPolicyView.html"],function(e,t,n,i,s,a,o,r,l,c,d,p,u,h,m,f){"use strict";var v=_.template(f),g=_.template('<input type="text" disabled value="<%= value %>" class="form-control">'),E={LAST_12_HOURS:12,LAST_24_HOURS:24,LAST_WEEK:168};return e.extend({name:"UDAPolicyView",metricsCollection:null,subViewHelper:null,metricRange:null,events:{"click .metric-range":"onMetricRangeChange","click .metric-chart-title":"onClickMetricChartTab"},extraEvents:{"change #entity-type":"onEntityTypeSelect","change #entity-scope":"onEntityScopeSelect","change #metric":"onMetricSelect","mousedown .n-spotlight-list":"onSelectItem","click .n-icon-search":"onSearchTextFocus","focus #searchText":"onSearchTextFocus","blur #searchText":"onSearchTextBlur","input .policy-title":"onPolicyNameChanged"},initialize:function(t){e.prototype.initialize.apply(this,arguments),_.bindAll(this,"onSpotlightSearch","onCategorySearch"),this.model=t.model,this.metricsCollection=t.metricsCollection,this.policyInfo=t.params||{},this.metricRange=7*u.HOURS_PER_DAY,this.xfitInfo=p.getXfitFeatureInfo(),this.subViewHelper=new m,this.model.isNew()&&this.addExtraEvents(this.extraEvents)},render:function(){this.policyHasUserGivenTitle=Boolean(this.model.get(this.model.DP.TITLE));var e=this.model.get(this.model.DP.ENABLED),t=this.model.get(this.model.DP.AUTO_RESOLVE);this.model.getId()||(e=!0,t=!0);var n=v(this.vtOptions({model:this.model.toJSON(),disabled:this.model.getId()?"disabled":"",enabled:e,autoResolve:t}));return this.$el.html(n),this.$(".auto-resolve-info").nutanixMoreInfo({icon:"information-tooltip",placement:"right",title:this.i18n("autoResolveInfo")}),this.$(".header-right").append(l.dropdown({id:"metric-history-select",classes:"metric-range-selection",variants:"dropdown-menu-right -compact",text:this.i18n("lastWeek"),rightAlign:!0,options:[{name:this.i18ns("lastHours",E.LAST_12_HOURS),class:"metric-range",attributes:'data-value="'+E.LAST_12_HOURS+'"'},{name:this.i18ns("lastHours",E.LAST_24_HOURS),class:"metric-range",attributes:'data-value="'+E.LAST_24_HOURS+'"'},{name:this.i18n("lastWeek"),class:"metric-range last-week",attributes:'data-value="'+E.LAST_WEEK+'"',selected:!0}]})),this.model.getId()?this.renderPolicyDetails():(this.renderCreatePolicyDetails(),this._autoFillFormFields()),this.triggerAction(u.MODAL.ACT.AS_REBUILD),this},destroy:function(){this.subViewHelper.destroy(),this.subViewHelper=null,this.$(".auto-resolve-info").nutanixMoreInfo("destroy"),this.$(".chart-info").nutanixMoreInfo("destroy"),e.prototype.destroy.apply(this)},getSavedData:function(){var e=this.getGeneralInputData();if(null!==e){if(!this.model.getId()){var t=this.getSelectedEntityOptionValue();if(""===t)return this.triggerAction(u.MODAL.ACT.ALERT_SHOW,{type:u.MODAL.ALERT.TYPE_ERROR,message:this.i18n("selectEntityError")}),null;this.model.setEditAttribute(this.model.HELPER_DP.ENTITY_TYPE,t);var n=this.getSelectedMetric();if(!n)return void this.triggerAction(u.MODAL.ACT.ALERT_SHOW,{type:u.MODAL.ALERT.TYPE_ERROR,message:this.i18n("selectMetricError")});this.model.setEditAttribute(this.model.HELPER_DP.METRIC,n);var i=this.getInputFilter(t);if(null===i)return;e[this.model.DP.FILTER]=i}var s=this.$("#autoResolve-trigger-check").is(":checked"),a=this.$("#enable-trigger-check").is(":checked");e[this.model.DP.AUTO_RESOLVE]=s,e[this.model.DP.ENABLED]=a;var o=this.subViewHelper.get("thresholdView");return o&&(e=o.getThresholdConditions(e)),e}},onSearchTextFocus:function(e){this.subViewHelper.get("spotlight")&&(this.$(".n-spotlight #searchText").val(""),this.subViewHelper.get("spotlight").search(this.$(".n-spotlight #searchText").val(),e))},onPolicyNameChanged:_.debounce(function(e){$(e.currentTarget).val()&&(this.policyHasUserGivenTitle=!0)},300),clearWarningHeader:function(){this.parentView&&(this.parentView.clearConflictingWarningHeader(),this.parentView.resetButton(".btnSave"))},onSelectItem:function(e){this.clearWarningHeader()},onSearchTextBlur:function(){if(this.subViewHelper.get("spotlight")){this.subViewHelper.get("spotlight").stopSearch();var e=this.model.getEditAttributes()[this.model.HELPER_DP.ENTITY_NAME];$.trim(this.$(".n-spotlight #searchText").val())!==e&&this.$(".n-spotlight #searchText").val(e)}},onCategorySearch:function(e){var t=this.subViewHelper.get("categorySelector"),n=t.getCategoryId(e);this.updateSelectedEntity(n,e)},onSpotlightSearch:function(e,t){var n=t[c.ENTITY_UUID]?t[c.ENTITY_UUID]:t[c.ENTITY_ID],i=t.entityName?t.entityName:n;return this.$("#searchText").val(i),this.updateSelectedEntity(n,i),!1},updateSelectedEntity:function(e,t){this.model.setSelectedEntity(e,t,this.getScopeEntityType());var n=this.getSelectedMetric(),i=this.getSelectedEntityType();this.toggleMetricHistory(i,n);var s=this.findMetricByName(i,n);this.populatePolicyName(i,s)},showAllEntityChart:function(e){var t="metric-chart"===e?"anomaly-chart":"metric-chart",n=this.$(".charts-container");n.addClass(e),n.removeClass(t)},toggleMetricHistory:function(e,t){var n=this.getCurrentChartView(),i=this.model.getAndStoreEntityId(),s=this.isAllScope(),a=this.$(".metric-history");if(t&&(this.model.isExistingEntity(i)||s)){a.show();var o=this.model.getAndStoreEntityScope();return this.isCategoryScope(o)?void a.hide():o===this.model.HELPER_DP.CLUSTER_SCOPE&&this.xfitInfo.disabled?void a.hide():void this.loadChart(e,i,t,n)}i&&!this.model.isExistingEntity(i)&&this.triggerAction(u.MODAL.ACT.ALERT_SHOW,{type:u.MODAL.ALERT.TYPE_WARNING,message:this.i18n("entityNotFoundError"),closeTiming:u.MODAL.ALERT.CLOSE_TYPE_PERMANENT}),a.hide()},loadChart:function(e,t,n,i){if(!i||!i.isSameEntityAndMetric(e,t,n)){this.removeChartViews();var a=this.findMetricByName(e,n);i=new s({disableBand:this.xfitInfo.disabled,activeMetric:n,unit:a.unit,samplingOperation:a.downSamplingOperator&&a.downSamplingOperator.toUpperCase(),title:a.displayName,entityType:e}),this.subViewHelper.register("chartView",i);var o=this.subViewHelper.get("thresholdView");o&&o.updateChartView(i),this.$(".chart-container").html(i.render().el),this.$(".metric-header").html(a.displayName),this.isSingleEntityScope()?this.eventModel=new r({indicatorEntityType:e,entityType:e,entityId:t,metricName:n,anomalyOnly:!0}):this.xfitInfo.disabled}this.loadMetricHistory(i)},_adjustMetricSelector:function(e){var t=[];if(e){var n=e;if("none"!==e){t=_.find(this.metricsCollection.models,function(e){return e.get(c.ENTITY_TYPE)===n}).get(c.METRICS_DP.SUPPORTED_METRICS),t=_.filter(t,function(e){return!e.deprecated})}}this._renderMetrics(t)},onEntityTypeSelect:function(){this.clearWarningHeader();var e=this.getSelectedEntityOptionValue();this.model.setEditAttribute(this.model.HELPER_DP.ENTITY_ID,null),this.model.setEditAttribute(this.model.HELPER_DP.ENTITY_NAME,null),this.model.setEditAttribute(this.model.HELPER_DP.ENTITY_SCOPE,null),this.model.setEditAttribute(this.model.HELPER_DP.ENTITY_TYPE,e),this._adjustMetricSelector(e),this._renderEntityScopeControl(e),this._adjustEntityInput(null,null);var t=this.getSelectedMetric();this.togglePolicyOptionsView(e,t);var n=this.findMetricByName(e,t);this.populatePolicyName(e,n),this.triggerAction(u.MODAL.ACT.AS_REBUILD)},onEntityScopeSelect:function(){this.clearWarningHeader();var e=this.getSelectedEntityScopeValue();this.model.setEditAttribute(this.model.HELPER_DP.ENTITY_ID,null),this.model.setEditAttribute(this.model.HELPER_DP.ENTITY_NAME,null),this.model.setEditAttribute(this.model.HELPER_DP.ENTITY_SCOPE,e);var t=this.getSelectedMetric(),n=this.getSelectedEntityType();this.toggleMetricHistory(n,t),this._adjustEntityInput(this.getSelectedEntityOptionValue(),e),this.triggerAction(u.MODAL.ACT.AS_REBUILD)},onMetricSelect:function(e){this.clearWarningHeader();var t=this.findMetricByName(this.getSelectedEntityType(),$(e.currentTarget).val()),n=this.getSelectedEntityType();this.togglePolicyOptionsView(n,t);var i=t?t.unit:"",s=t?t.name:"";this.renderThresholdDetails(n,s,i),this.populatePolicyName(n,t)},onMetricRangeChange:function(e){this.metricRange=parseInt($(e.currentTarget).attr("data-value"),10),this.loadMetricHistory(this.getCurrentChartView())},onClickAnomalyDistributionTab:function(){this.showAllEntityChart("anomaly-chart");var e=this.getCurrentChartView();e||(e=this.createAndRenderAnomalyChart()),this.loadMetricHistory(e)},onClickMetricChartTab:function(){this.showAllEntityChart("metric-chart"),this.loadMetricHistory(this.getCurrentChartView())},loadMetricHistory:function(e){var t=this;this.$(".anomaly-count").hide(),this.$(".last-week").show(),this.hideAllEntityChartTooltip();var n=this.model.getAndStoreEntityId(),i=h.getStatsStartTime(this.metricRange),s=h.getStatsCurrentTime(),a=this.isSingleEntityScope();if(e){if(a)e.setSamplingInterval(5*u.SECONDS_PER_MINUTE),e.setStartTime(i),e.setEndTime(s),e.setEntityId(n),this.eventModel.startTime=i,this.eventModel.setAttributesForQuery(),this.eventModel.save().done(function(){var n=t.eventModel.getQueryResultAttributes();if(e.setAnomalyModel(n),e.updateChartData(),n.length){var i=1===n.length?t.i18n("anomaly"):t.i18ns("anomalies",n.length);t.$(".anomaly-count").html(i),t.$(".anomaly-count").show()}});else if(this.$(".charts-container").hasClass("anomaly-chart"))e.setStartTime(i),e.setEndTime(s),e.getChartData();else{var r=this.getSelectedMetric(),l=this.getSelectedEntityType(),c=new o;this.$(".last-week").hide(),this.metricRange===E.LAST_WEEK&&(this.metricRange=E.LAST_12_HOURS,this.$(".metric-range-selection .text").text(this.i18ns("lastHours",this.metricRange)),i=h.getStatsStartTime(this.metricRange)),c.setStatsFor(null,l,[r]),c.setTimeInterval(i,s),n&&c.setEntityFilter(this.getScopeEntityType(),n),this.renderAllEntityChartTooltip(l,r),e.showLoader(),c.save().done(function(){e.chartDataProvided=!0,e.updateChartData(c)}).fail(function(){e.showNoData()})}this.triggerAction(u.MODAL.ACT.AS_REBUILD)}},togglePolicyOptionsView:function(e,t){e&&t?(this.$(".alert-policy-instruction").hide(),this.$(".alert-policy-options").show()):(this.$(".alert-policy-instruction").show(),this.$(".alert-policy-options").hide()),this.triggerAction(u.MODAL.ACT.AS_REBUILD)},createAndRenderAnomalyChart:function(){var e=this.model.getAndStoreEntityId(),t=this.getSelectedMetric(),n=this.getSelectedEntityType(),i=this.findMetricByName(n,t),s={metricType:t,unit:i.unit,entityType:u.ENTITY_EVENT,filterEntityType:n};e&&(s.clusterId=e);var o=new a(s);return this.subViewHelper.register("anomalyChartView",o),this.$(".anomaly-chart-container").html(o.render().el),o},renderPolicyDetails:function(){var e=this.model.getAndStoreEntityType(),t=this.model.getAndStoreEntityScope();this.$(".entity-type-control").html(g({value:this.getEntityTypeDisplayName(e)}));var n=p.getEntityScopeLabel(t,e);this.$(".entity-scope-control").html(g({value:n}));var i=this.model.getMetricFromCondition(),s=this.findMetricByName(e,i);this.$(".metric-control").html(g({value:s?s.displayName:""})),this.renderEntityName();var a=this.model.get(this.model.DP.IMPACT_TYPES)||[];this._renderImpactTypeOptions(_.first(a));var o=s?s.unit:"",r=s?s.name:"";this.togglePolicyOptionsView(e,r),this.renderThresholdDetails(e,i,o),this.triggerAction(u.MODAL.ACT.AS_REBUILD)},renderEntityName:function(){var e=this.model.getAndStoreEntityId();if(e){var t=this.$(".n-spotlight"),n=this.model.findEntityNameById(e)||this.i18n("unknown");t.html(g({value:n})),t.show()}},renderCreatePolicyDetails:function(){this.togglePolicyOptionsView(null,null),this._renderEntityTypes(null),this._renderEntityScopeControl(null),this._adjustMetricSelector(null),this._renderImpactTypeOptions();var e=this.getSelectedEntityType();e===u.ENTITY_NODE&&(e=u.ENTITY_HOST);var n=new t({el:this.$(".n-spotlight")},{selectHandler:this.onSpotlightSearch,entityType:e,wrapperEl:this.$(".n-spotlight"),containerEl:this.$el,cssPosition:"absolute",useInnerWidth:!0});this.subViewHelper.register("spotlight",n),this._adjustEntityInput(null,null)},renderThresholdDetails:function(e,t,n){var s=this.subViewHelper.get("thresholdView");s&&this.subViewHelper.remove("thresholdView"),this.toggleMetricHistory(e,t);var a={xfitInfo:this.xfitInfo,model:this.model,chartView:this.getCurrentChartView(),entityType:e,metric:t,unit:n};s=new i(a),this.subViewHelper.register("thresholdView",s),s.setParentView(this),this.$(".thresholds").html(s.render().el),this.triggerAction(u.MODAL.ACT.AS_REBUILD)},_renderEntityTypes:function(e){var t=_.map(this.metricsCollection.models,function(e){return e.get(c.ENTITY_TYPE)}),n=[];n.push({name:this.i18n("selectEntityType"),value:""}),_.each(t,function(t){n.push({name:this.getEntityTypeDisplayName(t),value:t,selected:t===e})},this),this.$(".entity-type-control").html(l.select({id:"entity-type",dataTestAttribute:"alertpolicy_udapolicyview_entity-type",options:n})),this.triggerAction(u.MODAL.ACT.AS_REBUILD)},_renderEntityScopeControl:function(e){var t=[],n=this.model.HELPER_DP;t.push({name:this.i18n("selectEntityScope"),value:""}),e&&(t.push({name:p.getEntityScopeLabel(n.ALL_ENTITY_SCOPE,e),value:n.ALL_ENTITY_SCOPE}),t.push({name:p.getEntityScopeLabel(n.SINGLE_ENTITY_SCOPE,e),value:n.SINGLE_ENTITY_SCOPE}),e===u.ENTITY_VM&&t.push({name:p.getEntityScopeLabel(n.CATEGORY_SCOPE,e),value:n.CATEGORY_SCOPE}),e!==u.ENTITY_CLUSTER&&t.push({name:p.getEntityScopeLabel(n.CLUSTER_SCOPE,e),value:n.CLUSTER_SCOPE})),this.$(".entity-scope-control").html(l.select({id:"entity-scope",dataTestAttribute:"alertpolicy_udapolicyview_entity-scope",options:t})),this.triggerAction(u.MODAL.ACT.AS_REBUILD)},_renderMetrics:function(e){var t=this,n=void 0;this.model.getId()&&(n=this.model.getMetricFromCondition());var i=[];i.push({name:this.i18n("selectMetric"),value:""}),_.each(e,function(e){e&&i.push({name:e.displayName,value:e.name,selected:e.name===n})},this),_.sortBy(i,function(e){return e.name}),this.$(".metric-control").html(l.select({id:"metric",dataTestAttribute:"alertpolicy_udapolicyview_metric",options:i})),setTimeout(function(){t.triggerAction(u.MODAL.ACT.AS_REBUILD)},0)},_renderImpactTypeOptions:function(e){var t=[];_.each(u.ALERT_IMPACT_TYPES,function(n,i){n!==u.ALERT_IMPACT_TYPES.SystemIndicator&&t.push({name:i,value:n[0],selected:i===e})}),this.$(".impact-type-control").html(l.select({id:"impactType",dataTestAttribute:"alertpolicy_udapolicyview_impactType",jsClasses:"impact-type-selector",options:t}))},_adjustEntityInput:function(e,t){var i=this.model.HELPER_DP;this.$("#searchText").val("");var s=this.subViewHelper.get("spotlight");if(this.isCategoryScope(t)){if(s&&s.hide(),!this.subViewHelper.get("categorySelector")){var a=new n({el:this.$(".category-selector-outer"),onChangeCB:this.onCategorySearch,inModal:!0});this.subViewHelper.register("categorySelector",a),a.render()}this.$(".category-control").show()
}else e&&t&&t!==i.ALL_ENTITY_SCOPE?(this.$(".category-control").hide(),t===i.CLUSTER_SCOPE?e=t:e===u.ENTITY_NODE&&(e=u.ENTITY_HOST),s&&(s.setEntityType(e),s.setFieldNameByEntityType(e),s.show())):(s&&s.hide(),this.$(".category-control").hide());this.triggerAction(u.MODAL.ACT.AS_REBUILD)},_autoFillFormFields:function(){var e=this.policyInfo.entityId;this.model.getEditAttributes();this.$("#entity-type").val(this.policyInfo.entityType),this.$("#entity-type").trigger("change"),this.$("#metric").val(this.policyInfo.metricName);var t=this.model.findEntityNameById(e);this.model.isExistingEntity(e)&&(this.$("#entity-scope").val(this.model.HELPER_DP.SINGLE_ENTITY_SCOPE),this.$("#entity-scope").trigger("change"),this.$("#searchText").val(t)),this.model.setEditAttribute(this.model.HELPER_DP.ENTITY_ID,e),this.model.setEditAttribute(this.model.HELPER_DP.ENTITY_NAME,t),this.$("#metric").trigger("change")},findMetricByName:function(e,t){if(e&&t){var n=e,i=_.find(this.metricsCollection.models,function(e){return e.get(c.ENTITY_TYPE)===n}),s=i.get(c.METRICS_DP.SUPPORTED_METRICS);if(s)return _.find(s,function(e){return e.name===t})}this.triggerAction(u.MODAL.ACT.AS_REBUILD)},getEntityTypeDisplayName:function(e){var t=e;return e===u.ENTITY_NODE&&(t=u.ENTITY_HOST),d.getSingularEntityName(t)},getPluralEntityName:function(e){var t=e;return e===u.ENTITY_NODE&&(t=u.ENTITY_HOST),d.getPluralEntityName(t)},getSelectedEntityType:function(){return this.model.getId()?this.model.getAndStoreEntityType():this.getSelectedEntityOptionValue()},getScopeEntityType:function(){return this.model.getScopeEntityType()},getSelectedEntityOptionValue:function(){return this.$("#entity-type").val()},getSelectedEntityScopeValue:function(){return this.$("#entity-scope").val()},getSelectedMetric:function(){return this.model.getId()?this.model.getMetricFromCondition():this.$("#metric").val()},getGeneralInputData:function(){var e=this.$("#title").val();if(!e)return this.triggerAction(u.MODAL.ACT.ALERT_SHOW,{type:u.MODAL.ALERT.TYPE_ERROR,message:this.i18n("enterNameError")}),null;if(e.match(/[<>="']/))return this.triggerAction(u.MODAL.ACT.ALERT_SHOW,{type:u.MODAL.ALERT.TYPE_ERROR,message:this.i18ns("invalidNameError","<>=\"'")}),null;var t=this.$("#description").val(),n=this.$("#impactType").val();return n?{impact_types:[n],title:e,description:t}:(this.triggerAction(u.MODAL.ACT.ALERT_SHOW,{type:u.MODAL.ALERT.TYPE_ERROR,message:this.i18n("selectImpactTypeError")}),null)},getInputFilter:function(e){var t="entity_type=="+e,n=this.model.getAndStoreEntityScope(),i=this.model.getAndStoreEntityId();return this.isAllScope(n)?t:n&&i?(this.isSingleEntityScope(n)?t+=";entity_id=="+i:t+=";(group_entity_type=="+n+";group_entity_id=="+i+")",t):(this.triggerAction(u.MODAL.ACT.ALERT_SHOW,{type:u.MODAL.ALERT.TYPE_ERROR,message:this.i18n("selectEntityError")}),null)},getCurrentChartView:function(){var e=this.$(".charts-container").hasClass("metric-chart");return this.subViewHelper.get(e?"chartView":"anomalyChartView")},removeChartViews:function(){this.$(".chart-titles").hide(),this.showAllEntityChart("metric-chart"),this.subViewHelper.remove("chartView"),this.subViewHelper.remove("anomalyChartView")},renderAllEntityChartTooltip:function(e,t){var n=this.$(".chart-info");n.removeClass("hide");var i=this.findMetricByName(e,t),s=this.getPluralEntityName(e),a=this.i18ns("allEntityTooltipMsg",s,i.displayName);n.nutanixMoreInfo({icon:"information-tooltip",classes:["-nudge-down"],placement:"right",title:a})},hideAllEntityChartTooltip:function(){var e=this.$(".chart-info");e.nutanixMoreInfo("destroy"),e.addClass("hide")},populatePolicyName:function(e,t){if(!this.$("#title").val()&&this.policyHasUserGivenTitle)this.policyHasUserGivenTitle=!1;else if(this.policyHasUserGivenTitle)return;if(t){var n=this.getEntityTypeDisplayName(e),i=this.model.getEditAttributes()[this.model.HELPER_DP.ENTITY_NAME],s=void 0;s=this.isAllScope()||!i?n:i+" - "+n;var a=s+" "+t.displayName;a.length>200&&(a=n+" "+t.displayName+" "+Date.now()),this.$("#title").val(a)}else this.$("#title").val("")},isAllScope:function(e){return e?e===this.model.HELPER_DP.ALL_ENTITY_SCOPE:this.model.isAllScope()},isSingleEntityScope:function(e){return e?e===this.model.HELPER_DP.SINGLE_ENTITY_SCOPE:this.model.isSingleEntityScope()},isCategoryScope:function(e){return e?e===this.model.HELPER_DP.CATEGORY_SCOPE:this.model.isCategoryScope()}})}),define("text!templates/popups/alertpolicy/ConflictingPolicyView.html",[],function(){return"\n<section data-ntnx-section>\n<% if (isSave) { %>\n  <h5 data-ntnx-title><%= i18n('related_policies') %></h5>\n<% } %>\n  <section data-ntnx-section=\"type-subtitle\">\n    <%= descriptionMessage %><span class=\"info-icon\"></span>\n  </section>\n</section>\n<section data-ntnx-section>\n  <table class=\"test table table-hover conflicting-policies\">\n    <thead>\n    <tr>\n      <% if (!mustOverride) { %>\n        <th></th>\n      <% } %>\n      <th><%= i18n('policyName') %></th>\n      <th><%= i18n('entity') %></th>\n      <th><%= i18n('threshold') %></th>\n      <th><%= i18n('last_updated') %></th>\n    </tr>\n    </thead>\n    <tbody>\n    \x3c!-- @view: conflicting policies go here... --\x3e\n    <% _.each(policies, function(policy) { %>\n    <tr>\n      <% if (!mustOverride) { %>\n        <td>\n          <% var className = policy.isCurrent ? '-current' : (policy.executeBefore ? '-before' : '-after') %>\n          <span class=\"css-icon state-icon <%= className %>\"></span>\n        </td>\n      <% } %>\n      <td>\n        <%- policy.title %>\n      </td>\n      <td>\n        <%= policy.entity%>\n      </td>\n      <td>\n        <%= policy.threshold %>\n      </td>\n      <td>\n        <%= policy.updated_timestamp %>\n      </td>\n    </tr>\n    <% }) %>\n    </tbody>\n  </table>\n</section>\n<% if (!mustOverride) { %>\n  <section class=\"section-key\">\n    <div class=\"key\">\n      <div><span class=\"css-icon state-icon -before\"></span><%= i18n('overrides_msg') %></div>\n      <div><span class=\"css-icon state-icon -current\"></span><%= i18n('current_policy') %></div>\n      <div><span class=\"css-icon state-icon -after\"></span><%= i18n('overridden_msg') %></div>\n    </div>\n  </section>\n<% } %>\n"}),define("views/popups/alertpolicy/ConflictingPolicyView",["views/basecomponents/BaseSubView","utils/AlertUtil","text!templates/popups/alertpolicy/ConflictingPolicyView.html"],function(e,t,n){"use strict";var i=_.template(n),s=_.template('<a class="btnOverride -blue" action="<%= action %>">\n        <%= i18n(\'view\') %>\n      </a>');return e.extend({name:"ConflictingPolicyView",OVERRIDE_ACTION:"override",policies:null,initialize:function(t){e.prototype.initialize.apply(this,arguments),this.policies=t.policies,this.model=t.model},render:function(e){var t=this.processPolicies(this.policies,e);return this.mustOverride?this.$el.html(i(this.vtOptions({policies:[this.mustOverride],isSave:e||this.model.isNew(),mustOverride:!0,descriptionMessage:this.i18n("must_override")}))):(this.$el.html(i(this.vtOptions({policies:t,isSave:e||this.model.isNew(),mustOverride:!1,descriptionMessage:this.i18n("conflict_description")}))),this.setConflictTableDescription()),this},setPolicies:function(e){this.policies=e},getPolicies:function(){return this.policies},processPolicies:function(e,n){var i=this;delete this.mustOverride;var s=this.model.HELPER_DP,a=e.slice();this.model.parseThresholdFIQLConditions(this.model.attributes[this.model.DP.TRIGGER_CONDITIONS]);var o=this.model.toJSON({includeCustomAttributes:!0});return o[s.THRESHOLD]=this.model.formatMetricExpressions(),n&&(o.ignoreUpdateTime=!0),a.push(o),_.some(a,function(e){var n=e[s.ENTITY_ID];return e.entity=t.getEntityScopeLabel(e[s.ENTITY_SCOPE],e[s.ENTITY_TYPE],i.model.findEntityNameById(n)),e.mustOverride?(i.mustOverride=e,!0):e.id===o.id?void(e.isCurrent=!0):void(e.executeBefore=i._isPolicyExecutedBefore(o,e))}),this._sortPoliciesInExecutionOrder(a),a},_isPolicyExecutedBefore:function(e,t){var n=this.model.DP,i=this.model.HELPER_DP,s=1e3*Date.now(),a=e[i.SCOPE_VALUE],o=t[i.SCOPE_VALUE],r=!e.ignoreUpdateTime&&e[n.MODIFIED_TIME_STAMP_IN_USECS]||s,l=!t.ignoreUpdateTime&&t[n.MODIFIED_TIME_STAMP_IN_USECS]||s;return!(o>a||o===a&&l<r)},_sortPoliciesInExecutionOrder:function(e){var t=this;e.sort(function(e,n){return t._isPolicyExecutedBefore(e,n)?1:-1})},getOverrideData:function(){return this.mustOverride?[this.mustOverride.id]:[]},getWarningMessage:function(){var e=_.size(this.policies);this.mustOverride||(e=1);var t=this.vtOptions({action:"override"}),n=e>1?"similar_policies_msg":"similar_policy_msg";return this.i18n(n)+" "+s(t)},getSaveButtonText:function(){return this.i18n(this.mustOverride?"saveAndReplace":"save")},setConflictTableDescription:function(){var e=this.i18n("conflict_description_tooltip");this.model.isCategoryScope()&&(e+=this.i18n("category_note")),this.$(".info-icon").nutanixMoreInfo({icon:"information-tooltip",classes:["-nudge-down"],placement:"bottom",title:e})}})}),define("text!templates/popups/alertpolicy/UDAPolicyContentView.html",[],function(){return'\x3c!-- The parent div modal is #popupUDAPolicy --\x3e\n<div data-ntnx-content-inner class="formContainer">\n  <div id="alertPolicyForm">\n    \x3c!-- @view: form goes here... --\x3e\n  </div>\n</div>\n'}),define("views/popups/alertpolicy/UDAPolicyPopupView",["views/basecomponents/popups/BasePopupView","views/popups/alertpolicy/UDAPolicyView","views/popups/alertpolicy/ConflictingPolicyView","models/alert/UDAPolicyModel","models/alert/UDAPolicyCollection","data/DataProperties","events/AppEvents","utils/AppConstants","utils/AppUtil","utils/CommonTemplates","utils/SubViewHelper","utils/StatsUtil","utils/TimeUtil","utils/AlertUtil","managers/EntityManager","text!templates/popups/alertpolicy/UDAPolicyContentView.html"],function(e,t,n,i,s,a,o,r,l,c,d,p,u,h,m,f){"use strict";var v=_.template('<span class="alert-link"><%= i18n("reload") %></span>'),g={CONFLICTING_POLICIES:"kPolicyConflict",VERSION_MISMATCH:"kUpdateVersionMisMatch"};return f=_.template(f),e.extend({el:"#popupUDAPolicy",subViewHelper:null,name:"UDAPolicyPopupView",conflictingWarningHeaderVisible:!1,events:{"click .btnSave":"onSave","click .btnClose":"hide","click .btnCancel":"onCancel","click .modal-header .close":"hide","click .btnOverride":"onOverride","keypress input":"onKeyPress","click input":"_hideAlert","click .tab-uda":"onSelectTab","click .alert-link":"onSelectReload"},overlayPopup:!0,initialize:function(t){e.prototype.initialize.apply(this,arguments),this.subViewHelper=new d,_.bindAll(this,"onModelUpdated","onModelError","onEntityDetails")},render:function(){var e=this.canModifyByEntityType(r.ENTITY_USER_DEFINED_ALERT_POLICY),t=[{text:e?this.i18n("cancel"):this.i18n("close"),extraClasses:"btnCancel n-btn-form"}];e&&t.push({isPrimary:!0,text:this.i18n("save"),extraClasses:"btnSave n-btn-form",extraAttr:[{key:"data-loading-text",value:"Saving..."}]}),this.$el.html(this.defaultTemplate({title:this.i18n("createPolicy"),tabs:!0,tabsList:this.defaultTabs([{isActive:!0,text:this.i18n("settings"),extraClasses:"tab-uda",extraAttr:[{key:"action",value:"showSubView"},{key:"actiontarget",value:"uda"},{key:"actionTargetId",value:"user_defined_alert_policy"}]},{text:this.i18n("related_policies"),extraClasses:"tab-uda",extraAttr:[{key:"action",value:"showSubView"},{key:"actiontarget",value:"uda"},{key:"actionTargetId",value:"related"}]}]),bodyContent:f(),footerButtons:this.defaultFooter(t)})),this.$("#alertPolicyForm").addClass("uda-policy-container"),this.$("#alertPolicyForm").html(c.LOADING_MSG({msg:this.i18n("loading")}))},destroy:function(){this.subViewHelper.destroy(),this.subViewHelper=null,e.prototype.destroy.apply(this,arguments)},show:function(t){var n=this,s=arguments;if(t.actionTarget===r.ENTITY_USER_DEFINED_ALERT_POLICY){this.params=t.params||{};var a=t.actionTargetId;this.model=new i;var o=r.ACTION_CREATE;a&&this.model.setId(a),this._loadData().done(function(){n.model.getId()&&(o=r.ACTION_UPDATE,n.$(".n-title").text(n.model.get("title"))),e.prototype.show.apply(n,s),n._renderUDAPolicyView(o,!0)}).fail(function(e){n.model.showClientNotification(r.NOTIFY_ERROR,e)})}},_hideAlert:function(){this.conflictingWarningHeaderVisible||e.prototype._hideAlert.apply(this,arguments)},showForm:function(e,t){this.triggerAction(r.MODAL.ACT.ALERT_HIDE),this.model.getId()&&this.$(".n-title").text(this.model.get("title")),this.showSubview(".formContainer","left",!t),this.$(".btnCancel").show(),this.$(".btnSave").show(),this.triggerAction(r.MODAL.ACT.AS_REBUILD)},onModelUpdated:function(e){o.triggerAppEvent(o.ENTITIES_UPDATED,{entityType:r.ENTITY_USER_DEFINED_ALERT_POLICY,entity:e}),this.hide()},onModelError:function(e,t){var n=l.processAjaxError(t.responseText),i=l.processSerializedObject(t.responseText);if(_.isObject(i)&&i[a.DETAILED_MESSAGE]){var s=l.processSerializedObject(i[a.DETAILED_MESSAGE]);if(_.isObject(s)){var o=s[a.ERROR_CODE];if(o===g.CONFLICTING_POLICIES){var r=l.processSerializedObject(s[a.ADDITIONAL_DETAILS]);return void this._processConflictingPolicies(r)}if(o===g.VERSION_MISMATCH)return this.resetButton(".btnSave"),void this.showError(n+" "+v(this.vtOptions()))}}this.resetButton(".btnSave"),this.showError(n)},saveModel:function(e){e&&e.length&&(this.inputData[this.model.DP.POLICIES_TO_OVERRIDE]=e),this.$(".btnSave").button("loading"),this.model.save(this.inputData,{success:this.onModelUpdated,error:this.onModelError})},onSave:function(e){if(this.canModifyByEntityType(r.ENTITY_USER_DEFINED_ALERT_POLICY)){var t=this.$(".btnSave").hasClass("overrideMode"),n=this.subViewHelper.get("policyView"),s=this.subViewHelper.get("conflictingPolicyView");if(n&&!t){var a=n.getSavedData();if(a){this.inputData=a;var o=!!(this.model.isNew()||n.isCategoryScope()&&this.hasCategoryConflict);this.model.set(i.DP.ERROR_ON_CONFLICT,o,{silent:!0}),this.saveModel()}}else if(s&&t){var l=s.getOverrideData();this.model.set(i.DP.ERROR_ON_CONFLICT,!1,{silent:!0}),this.saveModel(l)}}},onCancel:function(e){this.$(".btnSave").hasClass("overrideMode")?(this.triggerAction(r.MODAL.ACT.ALERT_HIDE),this.resetButton(".btnSave",this.i18n("Save")),this.resetButton(".btnCancel",this.i18n("Cancel")),this.subViewHelper.get("conflictingPolicyView").hideView(),this.subViewHelper.get("policyView").showView(),this.$(".btnSave").removeClass("overrideMode"),this.model.isNew()||this._findSimilarPolicies(),this.showSubview(".formContainer","left"),this.triggerAction(r.MODAL.ACT.AS_REBUILD)):this.hide()},onOverride:function(e){var t=this,n=$(e.currentTarget).attr(r.NAV_ACTION),i=this.subViewHelper.get("conflictingPolicyView");if(i&&n===i.OVERRIDE_ACTION){this.clearConflictingWarningHeader();var s=i.getPolicies();_.size(s)&&this._loadSimilarPoliciesEntityDetails(s).done(function(){t.showConflictingPolicyView(i)}).fail(function(e){t.showConflictingPolicyView(i)})}else this.clearConflictingWarningHeader(),this.resetButton(".btnSave")},onEntityDetails:function(e,t,n){this.model.setEntityDetails(e,t,n)},showConflictingPolicyView:function(e){this.clearConflictingWarningHeader(),this.resetButton(".btnCancel",this.i18n("back")),this.subViewHelper.get("policyView").hideView(),this.$(".n-modal-tab-header").css("display","none"),e.showView(),e.render(!0),this.resetButton(".btnSave",e.getSaveButtonText()),this.showSubview(".formContainer","left"),this.$(".btnSave").addClass("overrideMode")},clearConflictingWarningHeader:function(){this.conflictingWarningHeaderVisible=!1,this.triggerAction(r.MODAL.ACT.ALERT_HIDE)},showConflictingWarningHeader:function(e){this.triggerAction(r.MODAL.ACT.ALERT_SHOW,{type:r.MODAL.ALERT.TYPE_WARNING,message:e,closeButton:!1,closeTiming:r.MODAL.ALERT.CLOSE_TYPE_PERMANENT}),this.conflictingWarningHeaderVisible=!0},resetButton:function(e,t){this.$(e).button("reset"),t&&this.$(e).text(t)},onSelectTab:function(e){var t=this.subViewHelper.get("conflictingPolicyView");if(t){var n=$(e.currentTarget),i=n.attr(r.NAV_ACTION_TARGET_ID);this.$(".tab-uda[actionTargetId="+i+"]").tab("show"),i===r.ENTITY_USER_DEFINED_ALERT_POLICY?(t.hideView(),this.subViewHelper.get("policyView").showView()):(this.subViewHelper.get("policyView").hideView(),t.showView(),t.render())}this.triggerAction(r.MODAL.ACT.AS_REBUILD)},onSelectReload:function(){var e=this,t=r.ACTION_UPDATE;this._loadData().done(function(){e._renderUDAPolicyView(t,!1)}).fail(function(t){e.showError(l.processAjaxError(t.responseText))})},_renderUDAPolicyView:function(e,n){this.$("#alertPolicyForm").empty();var i=new t({el:"#alertPolicyForm",model:this.model,metricsCollection:this.metricsCollection,params:this.params});i.setParentView(this),this.subViewHelper.register("policyView",i),this.model.getId()?(this._loadPolicyEntities(this.model.getAllEntitiesFromFilterGroupedByType(),e,n),this._populateLastUpdated(),this._findSimilarPolicies()):this.params.entityId?this._loadPolicyEntities(_defineProperty({},this.params.entityType,[this.params.entityId]),e,n):this._renderAlertPolicy(e,this.subViewHelper.get("policyView"),n),this.triggerAction(r.MODAL.ACT.AS_REBUILD)},_loadData:function(){var e=this,t=[],n=$.Deferred();t.push(h.getSupportedMetrics().always(function(t){e.metricsCollection=t}));var i=function(){n.resolve(),e.triggerAction(r.MODAL.ACT.AS_REBUILD)};if(this.model.getId()){var a=this.model.fetch();t.push(a),i=function(){a.isRejected()?n.reject(l.processAjaxError(a.responseText)):n.resolve()}}else if(this.params.entityId){var o=new s,c=this.params.entityType,d=this.params.entityId;t.push(o.fetch({data:{entity_type:c,entity_ids:d}}).done(function(){var t=_.find(o.models,function(t){return t.getMetricFromCondition()===e.params.metricName});t&&(e.model=t)}))}return $.whenAll.apply($,t).done(i),n.promise()},_loadPolicyEntities:function(e,t,n){var i=this,s=this.subViewHelper.get("policyView");m.loadEntityDetails(e,this.onEntityDetails).done(function(){i._renderAlertPolicy(t,s,n)}).fail(function(e){i.showError(e),i._renderAlertPolicy(t,s,n)})},_loadSimilarPoliciesEntityDetails:function(e){var t=this,n={};return this.hasCategoryConflict=!1,_.each(e,function(e){var s=e[t.model.HELPER_DP.ENTITY_ID],a=e.selectedEntityType;e.selectedEntityType===i.DP.CATEGORY_SCOPE&&(t.hasCategoryConflict=!0),s&&!t.model.isExistingEntity(s)&&a&&(n[a]||(n[a]=[]),n[a].push(s))}),m.loadEntityDetails(n,this.onEntityDetails)},_renderAlertPolicy:function(e,t,n){t.render(),this.showForm(e,n)},_findSimilarPolicies:function(){var e=this;if(this.similarPolicies){var t=this.similarPolicies.get("entities");return void this._updateConflictingPolicyView(this._parseSimilarPolicies(t))}this.similarPolicies=m.createGenericEntityModel(r.ENTITY_CONFLICTING_POLICY,{enableNotifications:!1}),this.similarPolicies.isNew(!1),this.similarPolicies.save(this.model.toJSON(),{type:"POST"}).done(function(t){var n=e._parseSimilarPolicies(t&&t.entities);n&&n.length&&e._loadSimilarPoliciesEntityDetails(n).done(function(){e._updateConflictingPolicyView(n),e.$(".n-modal-tab-header").css("display","flex")}).fail(function(t){e._updateConflictingPolicyView(n),e.$(".n-modal-tab-header").css("display","flex")})}).fail(function(e){})},_showConflictingWarning:function(e,t){if(e&&_.size(e)){var n=this._updateConflictingPolicyView(e);if(this.model.isNew()||t){var i=n.getWarningMessage();this.showConflictingWarningHeader(i)}else this.$(".n-modal-tab-header").css("display","flex")}else this.model.isNew()&&this.saveModel()},_updateConflictingPolicyView:function(e){var t=this.subViewHelper.get("conflictingPolicyView");return t?t.setPolicies(e):(this.$(".formContainer").append('<div class="conflicting-alert-policy" id="conflictingPolicyList"></div>'),t=new n({el:"#conflictingPolicyList",model:this.model,policies:e}),t.hideView(),this.subViewHelper.register("conflictingPolicyView",t)),t},_processConflictingPolicies:function(e){var t=this._parseSimilarPolicies(e);this._showConflictingWarning(t,!0)},_parseSimilarPolicies:function(e){var t=this;if(e&&_.size(e))return _.map(e,function(e){var n=t._mapAttributes(e),s=new i(n),a=t._formatPolicy(s);if(t.model.isNew()){var o=a[i.HELPER_DP.ENTITY_ID],r=t.model.getAndStoreEntityId();o!==r&&(o||r)||(a.mustOverride=!0)}return a})},_mapAttributes:function(e){var t=void 0;return _.each(i.MAP,function(n,i){t=e[i],_.isUndefined(t)||(delete e[i],e[n]=t)}),e},_getEntityTypeDisplayName:function(e){return e===r.ENTITY_NODE?r.ENTITY_NAMES[r.ENTITY_HOST]:r.ENTITY_NAMES[e]||l.toUpperCaseFirstChar(e)},_findMetricByName:function(e,t){var n=e,i=_.find(this.metricsCollection.models,function(e){return e.get(a.ENTITY_TYPE)===n}),s=i.get(a.METRICS_DP.SUPPORTED_METRICS);return _.find(s,function(e){return e.name===t})},_formatPolicy:function(e){var t=i.HELPER_DP,n=e.toJSON({includeCustomAttributes:!0}),s=n[t.ENTITY_ID];return e.parseEntityIdFIQLFromFilter(e.get(this.model.DP.FILTER)),n.selectedEntityType=e.findEntityTypeById(s),n[t.THRESHOLD]=e.formatMetricExpressions(),n},_populateLastUpdated:function(){var e=this.model&&this.model.get(this.model.DP.MODIFIED_TIME_STAMP_IN_USECS);if(e){var t=this.$(".last-updated");t.length||(t=$('<span class="last-updated"></span>').prependTo(this.$(".n-modal-footer"))),t.text(this.i18ns("lastUpdated",u.formatDateTime(p.toMilliseconds(e))))}},showSuccess:function(e){this.triggerAction(r.MODAL.ACT.ALERT_SHOW,{type:r.MODAL.ALERT.TYPE_SUCCESS,message:e})},showError:function(e){this.triggerAction(r.MODAL.ACT.ALERT_SHOW,{type:r.MODAL.ALERT.TYPE_ERROR,message:e})}})}),define("models/alert/CPAlertPolicyModel",["models/alert/AlertPolicyModel"],function(e){"use strict";return e.extend({name:"CPAlertPolicyModel",globalConfigVal:null,toJSON:function(e){return{alertTypeId:this.get(this.DP.ALERT_TYPE_ID),id:this.getId(),isGlobalConfig:this.getGlobalConfigVal(),parameters:this.get(this.DP.PARAMETERS)}},setGlobalConfigVal:function(e){this.globalConfigVal=e},getGlobalConfigVal:function(){return this.globalConfigVal}},{DP:e.DP})}),define("text!templates/popups/alertpolicy/CPAlertPolicyView.html",[],function(){return'<div class="alert-policy-form">\n  <div class="alert-policy">\n    <div class="n-title">\n      <%= i18n(\'allClusterConfigMsg\') %>\n    </div>\n    <div class="control-div alert-parameters">\n    </div>\n  </div>\n</div>'});define("text!templates/popups/alertpolicy/CPAlertPolicyParametersView.html",[],function(){return'<% if(!isRendered) { %>\n<div class="control-group">\n  <div class="controls">\n    <div class="radio-title"> <%= i18n(\'reserveCapacityFailure\') %></div>\n    <div class="radio-option">\n      <input type="radio"\n             id="reserve-one-node-failure"\n             data-param = "config-reservation"\n             name = "reservation" />\n      <label class="n-label-text" for="reserve-one-node-failure">\n        <span class="n-label-str">\n            <%= i18n(\'auto_detect\') %>\n        </span>\n      </label>\n    </div>\n    <div class="radio-option">\n      <input type="radio"\n             id="reserve-none"\n             data-param = "config-reservation"\n             name = "reservation"/>\n      <label class="n-label-text" for="reserve-none">\n        <span class="n-label-str">\n          <%= i18n(\'none\') %>\n        </span>\n      </label>\n    </div>\n  </div>\n</div>\n<div class="n-separator"></div>\n<% } %>\n\n<div class="control-group">\n  <div class="controls">\n    <span class="check-name"><%= title %></span>\n    <input type="text" class="n-input reserved-val"\n           data-param = "<%= cName %>"\n           data-name = "<%= name %>"\n           value="<%= (reservedValue!== null) ? reservedValue : 100 %>">\n  </div>\n</div>'}),define("views/popups/alertpolicy/CPAlertPolicyView",["views/basecomponents/BaseSubView","models/alert/CPAlertPolicyModel","managers/prechecks/PCCompatibilityManager","managers/NotificationManager","data/DataProperties","utils/AppConstants","text!templates/popups/alertpolicy/CPAlertPolicyView.html","text!templates/popups/alertpolicy/CPAlertPolicyParametersView.html"],function(e,t,n,i,s,a,o,r){"use strict";var l={PARAMETERS:"parameters",CAPACITY_THRESHOLD:"cluster_threshold_pct",CAPACITY_TYPE:"capacity_type"},c=_.template(o),d=_.template(r),p={STORAGE:"cluster_storage_hts_prediction_check_insights",CPU:"cluster_cpu_hts_prediction_check_insights",MEMORY:"cluster_memory_hts_prediction_check_insights"},u=_.template('<div class = "no-cap-params"> <%= i18n("noAvailableConfigMsg") %> </div>');return e.extend({capacityCheckModels:null,name:"CPAlertPolicyView",initialize:function(t){e.prototype.initialize.apply(this,arguments),this.capacityCheckModels=t.models,this.parentView=t.parentView},render:function(){var e;this.capacityCheckModels&&this.capacityCheckModels.length?(this.$el.html(c(this.vtOptions())),_.each(this.capacityCheckModels,function(t){var n=t.get(l.PARAMETERS),i=parseInt(n[l.CAPACITY_TYPE].value,10),a=parseInt(n[l.CAPACITY_THRESHOLD].value,10),o=t.get(s.NAME);if(_.contains(p,o)){var r=this.getTitleAndClass(o);this.$(".alert-parameters").append(d(this.vtOptions({reservedValue:100-a,name:o,title:r.title,cName:r.cName,isRendered:e}))),e=!0;var c=this.$("[data-param = 'config-reservation']");3===i?(c.eq(0).prop("checked",!0),c.eq(1).prop("checked",!1)):(c.eq(0).prop("checked",!1),c.eq(1).prop("checked",!0))}},this)):this.$el.html(u(this.vtOptions()))},getTitleAndClass:function(e){switch(e){case p.STORAGE:return{title:this.i18n("reserveStorageCapacity"),cName:"storage_check"};case p.CPU:return{title:this.i18n("reserveCPUCapacity"),cName:"cpu_check"};case p.MEMORY:return{title:this.i18n("reserveMemoryCapacity"),cName:"memory_check"}}},onSave:function(){var e,n,o=this,r=[],c=this.getUpdatedParameters(this.$(".alert-parameters").children());if(null===c)return this.showHeaderError(this.i18n("globalParamsError")),void $(".btnSave").button("reset");if(!1===c)return this.showHeaderError(this.i18n("invalidReservedValueError")),void $(".btnSave").button("reset");var d=this.getClusterIds();_.each(this.capacityCheckModels,function(i){_.each(c,function(t,n){t[i.get(s.NAME)]&&(e=t[i.get(s.NAME)])},this),e&&d.forEach(function(a){var o=i.get(s.ID).split("::")[1];a.id===this.clusterManager.getPrismCentralClusterUuid()&&(n=new t,$.extend(!0,n,i),n.set(l.PARAMETERS,e),n.setGlobalConfigVal(!0),n.set(s.ID,a.id+"::"+o),r.push(n.save({}))),n=new t,$.extend(!0,n,i),n.set(l.PARAMETERS,e),n.setGlobalConfigVal(!1),n.set(s.ID,a.id+"::"+o),r.push(n.save({}))},this)},this),$.when.apply($,r).done(function(){i.showClientNotification(a.NOTIFY_SUCCESS,o.i18n("saveSuccessMsg")),o.parentView.$(".btnSave").button("reset")}).fail(function(){$(".btnSave").button("reset"),o.showHeaderError(o.i18n("saveFailedError"))})},getUpdatedParameters:function(e){var t=[],n=this.$("#reserve-one-node-failure").prop("checked"),i=!1;return _.each($(e),function(e){var a={},o=$(e).find(".reserved-val").attr("data-name"),r=100-parseFloat($(e).find(".reserved-val").val());a[o]={},a[o][l.CAPACITY_TYPE]={},a[o][l.CAPACITY_TYPE][s.SYSTEM_DATA_VALUE]=n?3:"0",a[o][l.CAPACITY_THRESHOLD]={},a[o][l.CAPACITY_THRESHOLD][s.SYSTEM_DATA_VALUE]=r,(r>100||r<0)&&(i=!0),t.push(a)},this),!i&&t},getClusterIds:function(){var e=[];return this.clusterManager.getPrismCentralClusterUuid()&&e.push({id:this.clusterManager.getPrismCentralClusterUuid(),name:a.MULTICLUSTER_NAME}),_.each(n.getPEs(a.PC_DELOS_VERSION,!0),function(t){t.get(s.CLUSTER_UUID)&&e.push({id:t.get(s.CLUSTER_UUID),name:t.get(s.CLUSTER_NAME)})}),e}})}),define("models/alert/CPAlertPolicyCollection",["models/alert/CPAlertPolicyModel","models/BaseCollection","data/DataURLConstants"],function(e,t,n){"use strict";return t.extend({model:e,url:n.ALERT_POLICY,initializeBaseCollection:function(e,n){t.prototype.initializeBaseCollection.apply(this,arguments),this.clusterManager.isMulticlusterNavMode()&&(this._parameters.includeInternalChecks=!0)}})}),define("text!templates/popups/alertpolicy/CPAlertPolicyPopupView.html",[],function(){return'\x3c!-- The parent div modal is #popupCPAlertPolicy --\x3e\n<div class="modal-header">\n  <button type="button" class="close" data-dismiss="modal">\n    <i data-icon="K" aria-hidden="true"></i>\n  </button>\n  <h4 class="n-title popupTitle"><%= i18n(\'capacityConfigTitle\') %></h4>\n</div>\n\n<div class="n-modal-wrapper">\n  <div class="n-modal-body">\n    <div class="n-modal-content-wrapper">\n      <div class = "n-popup-description">\n        <span class="n-modal-loading" style="display:none;">\n          <span class="n-loading-text"><%= i18n(\'loading\') %></span>\n          <div class="donut-loader-blue"></div>\n        </span>\n      </div>\n      <div class="n-modal-alert-header">\n      </div>\n      <div class="n-modal-content formContainer" >\n        <div id="alertPolicyForm">\n          \x3c!-- @view: form goes here... --\x3e\n        </div>\n      </div>\n    </div>\n  </div>\n  <div class="n-modal-footer">\n    <button class="btnCancel btn n-btn-form">\n      <%= i18n(\'discard_changes\') %>\n    </button>\n      <button class="btnSave btn n-btn-form"\n              style="display:none;"\n              data-loading-text="<%= i18n(\'saving\') %>">\n        <%= i18n(\'save\') %>\n      </button>\n  </div>\n</div>'}),define("views/popups/alertpolicy/CPAlertPolicyPopupView",["views/basecomponents/popups/BasePopupView","views/popups/alertpolicy/CPAlertPolicyView","models/alert/CPAlertPolicyCollection","data/DataProperties","utils/AppConstants","utils/AntiscrollUtil","text!templates/popups/alertpolicy/CPAlertPolicyPopupView.html"],function(e,t,n,i,s,a,o){"use strict";var r={STORAGE:"cluster_storage_hts_prediction_check_insights",CPU:"cluster_cpu_hts_prediction_check_insights",MEMORY:"cluster_memory_hts_prediction_check_insights"};return e.extend({el:"#popupCPAlertPolicy",name:"CPAlertPolicyPopupView",alertPolicyModel:null,compiledViewTemplate:_.template(o),policyView:null,capacityRelatedChecks:null,events:{"click  .btnSave":"onBeforeSave","click  .btnClose":"hide","click  .btnCancel":"discardChanges","click  .modal-header .close":"hide"},render:function(){this.$el.html(this.compiledViewTemplate(this.vtOptions())),this.onEditConfigParams(),this.applyAntiScroll(0,724,350)},destroy:function(){this.policyView&&this.policyView.destroy(),this.policyView=null,e.prototype.destroy.apply(this,arguments)},show:function(t){e.prototype.show.apply(this,arguments),t.actionTargetId&&this.editPolicy(t.actionTargetId,!1),this.applyAntiScroll(800,724,350),this.$(".searchBox").focus()},showForm:function(e,t){this.mode=e,this.clearHeader(),this.$(".popupTitle").text(this.i18n("updateCapacityConfigMsg")),this.showSubview(".formContainer","left"),this.$(".n-btn-form").hide(),this.$(".btnCancel").show(),this.capacityRelatedChecks.length&&this.$(".btnSave").show(),this.applyNutanixInput()},onEditConfigParams:function(e){this.$(".n-modal-loading").show(),this.editPolicy()},editPolicy:function(e,s){this.capacityRelatedChecks=[],this.$("#alertPolicyForm").empty(),this.alertPolicyCollection=new n;var a=this;this.alertPolicyCollection.fetch({success:function(e,n){a.$(".n-modal-loading").hide(),e.each(function(e){e.get(i.NAME)!==r.STORAGE&&e.get(i.NAME)!==r.CPU&&e.get(i.NAME)!==r.MEMORY||a.capacityRelatedChecks.push(e)}),a.policyView=new t({el:"#alertPolicyForm",models:a.capacityRelatedChecks,parentView:a}),a.renderAlertPolicy(a.policyView,s)},error:function(e,t){a.$(".n-modal-loading").hide(),a.showHeaderError(t.responseText)}})},renderAlertPolicy:function(e,t){e.render(),this.showForm(s.ACTION_UPDATE,t),a.applyAntiScroll(this.$(".antiscroll-wrap"),"672px","350px")},onBeforeSave:function(){this.policyView&&$.nutanixConfirm({context:this,msg:this.i18n("beforeSaveMsg"),yes:function(){var e=this;this.$(".btnSave").button("loading"),this.policyView.onSave({success:function(){e.policyUpdated()},error:function(){e.$(".btnSave").button("reset")}})}})},policyUpdated:function(){this.showHeaderSuccess(this.i18n("saveSuccessMsg"))},showSuccess:function(e){this.showHeaderSuccess(e)}})}),define("models/softwareupgrade/SoftwareUpgradePopupModel",["models/BaseModel"],function(e){"use strict"
;return e.extend({defaults:{currentSoftwareType:null},setCurrentSoftwareType:function(e){this.get("currentSoftwareType")!==e&&this.set("currentSoftwareType",e)},getCurrentSoftwareType:function(){return this.get("currentSoftwareType")},getPreviousSoftwareType:function(){return this.previous("currentSoftwareType")}})}),define("text!templates/popups/softwareupgrade/SoftwareUpgradeView.html",[],function(){return'<div class="n-modal-body">\n  <div class="n-modal-content-wrapper">\n    \x3c!-- TODO: Move alerts to the subviews --\x3e\n    <div class="n-modal-alert-header">\n      \x3c!-- @view: alert goes here... --\x3e\n    </div>\n    <div class="n-modal-content">\n      <% if (canModify) { %>\n\n        <% if (canShowVCenter) { %>\n          \x3c!-- vCenter --\x3e\n          <div class="n-vcenter-content n-bottom-line">\n          </div>\n        <% } %>\n        \x3c!-- Current version --\x3e\n        <div class="n-version-row n-bottom-line">\n          <p class="n-title">\n            <%= i18nStatic(viewName, "currentVersion").toUpperCase() %>\n          </p>\n          <p class="n-version lblCurrentVersion">\n            \x3c!-- @view: Current version goes here... --\x3e\n          </p>\n          <div class="n-clearfix"></div>\n        </div>\n        \x3c!-- Content based upgrade state --\x3e\n        <div class="n-state-content">\n\n          \x3c!-- Content goes here either:\n            (A) Download/Upload Versions\n            (B) Upgade Status\n          --\x3e\n\n          \x3c!-- To be replaced when view state changes --\x3e\n          <div class="n-popup-loading">\n            <%= i18nStatic(viewName, "loading") %>\n          </div>\n\n        </div>\n      <% } else { %>\n        <div class="n-no-access">\n          <%= i18nStatic(viewName, "noAccess") %>\n        </div>\n      <% } %>\n    </div>\n  </div>\n</div>\n\n<div class="n-modal-footer n-clearfix">\n  <% if (canModify) { %>\n    <div class="n-left-control">\n      <%= Components.checkbox({\n        jsClasses: \'checkboxAutoDownload formControl\',\n        labelText: i18nStatic(viewName, \'autoDownload\')\n      }) %>\n      <div class="n-inline-loading-container">\n        <div class="n-inline-loading  loaderAutoDownload" />\n      </div>\n    </div>\n    <% if (!is2048Disabled) { %>\n      <div class="n-game-message">\n        <a id="linkPlayEasterEgg"><%= i18nStatic(viewName, "nothingToDo") %></a>\n      </div>\n    <% } %>\n  <% } %>\n  <button class="btnBack btnBackProgress btn n-btn-form btn-primary"\n      style="display:none">\n    <%= i18nStatic(viewName, "backToProgress") %>\n  </button>\n  <button class="btnBack btnBackVersion btn n-btn-form btn-primary"\n      style="display:none">\n    <%= i18nStatic(viewName, "backToVersions") %>\n  </button>\n</div>\n'}),define("text!templates/popups/softwareupgrade/SoftwareUpgradePopupStateVersionsView.html",[],function(){return'\x3c!-- State: Versions template --\x3e\n<div class="n-version-row">\n  <div>\n    <p class="n-title">\n      <%= i18nStatic(viewName, "availableCompatible").toUpperCase() %>\n      <span data-toggle="tooltip"\n        class="n-tooltip-circle eol-versions-tooltip">?</span>\n    </p>\n  </div>\n  \x3c!-- Software release table --\x3e\n  <table id="softwareReleaseList" class="table table-hover">\n    \x3c!-- @view: Compatible versions list... --\x3e\n    <tbody>\n      <tr>\n        <td class="n-message  loadingSpinner">\n          \x3c!-- @view: inline spinner goes here... --\x3e\n        </td>\n      </tr>\n    </tbody>\n  </table>\n</div>\n\x3c!-- Upgrade Software Binary --\x3e\n<div class="n-version-row upload-binary">\n  <p class="n-title">\n    <%= i18nStatic(viewName, "uploadBinary").toUpperCase() %>\n  </p>\n  <p class="n-description  n-upload-description">\n    <%= i18nsStatic(viewName, softwareTypeState === AppConstants.UPGRADE_SOFTWARE_LABEL.hypervisor ? "youCanUploadHvBinary" : "youCanUploadBinary", {\n      linkStart: "<a class=\'linkUpload\'>",\n      softwareType: softwareTypeState,\n      linkEnd: "</a>"\n    }) %>\n  </p>\n  <div class="n-upload-form-container">\n    \x3c!-- The upload form. We use the HTML5 File interface to send the data and\n         not directly with the form.  --\x3e\n    <form class="form-horizontal  formUpload"\n        target="upload_target" method="post" enctype="multipart/form-data">\n      \x3c!-- File browser --\x3e\n      <div class="control-group  metadataUploadSection">\n        <label class="control-label" for="inputMetadataFile">\n          <%= softwareTypeState %> <%= i18nStatic(viewName, "metadataFile") %>\n        </label>\n        <div class="controls">\n          <input type="file" class="inputMetadataFile" name="metadataFile"  accept=".json,.txt" data-test="metadata_file_upload" />\n        </div>\n      </div>\n      \x3c!-- File browser --\x3e\n      <div class="control-group">\n        <label class="control-label" for="inputFile">\n          <%= softwareTypeState %> <%= i18nStatic(viewName, "binaryFile") %>\n          <span class="software-filetype-example"></span>\n        </label>\n        <div class="controls">\n          <input type="file" class="inputFile" name="file" data-test="binary_file_upload"/>\n        </div>\n      </div>\n      \x3c!-- Overwrite checkbox--\x3e\n      <% if (overwriteCheckbox) {%>\n        <div class="control-group">\n          <div class="controls">\n            <%=\n              Components.checkbox({\n                checked: false,\n                jsClasses: \'overwrite\',\n                name: \'overwrite\'\n              })\n            %>\n            <span class="helpText">\n              <%= i18nsStatic(viewName, "overwriteExisting", softwareTypeState) %>\n            </span>\n          </div>\n        </div>\n      <% } %>\n      \x3c!-- Hidden elements --\x3e\n      <input type="hidden" class="inputName" />\n      <input type="hidden" class="inputMD5Sum"/>\n      <input type="hidden" class="inputFileSize" />\n      <input type="hidden" class="inputOffset" />\n      <input type="hidden" class="inputVersion" />\n      \x3c!-- Footer  --\x3e\n      <div class="n-upload-form-footer">\n        <a class="btnUploadNow btn  btn-primary  btn-control  pull-right"\n            data-loading-text="Processing">\n          <%= i18nStatic(viewName, "uploadNow") %>\n        </a>\n        <a class="btnCancel  btn  btn-control  pull-right">\n          <%= i18nStatic(viewName, "cancel") %>\n        </a>\n        <div class="n-clearfix"></div>\n      </div>\n    </form>\n    \x3c!-- Processing upload. Toggles with the form\'s visibility. --\x3e\n    <div class="n-upload-processing">\n      <div class="n-inline-loading-container">\n        <div class="n-inline-loading" style="display:block" />\n      </div>\n      <%= i18nStatic(viewName, "uploadingFile") %>\n    </div>\n  </div>\n  \x3c!-- This makes sure that the form will not refresh the page. This could be\n       used when upload form in IE9 is supported. --\x3e\n  <iframe id="uploadTarget" name="upload_target" />\n</div>\n'}),define("text!templates/popups/softwareupgrade/SoftwareUpgradePopupStateUpgradingView.html",[],function(){return'\x3c!-- State: Upgrade status template --\x3e\n<div class="n-upgrade-row">\n  \x3c!-- Initial state --\x3e\n  <div class="n-upgrade-initial">\n    <span class="loadingSpinner"></span> <%= i18nStatic(viewName, "checkingUpgradeStatus") %>\n  </div>\n  \x3c!-- Global upgrade bar --\x3e\n  <div class="n-upgrade-global-bar-container">\n    <div class="n-upgrade-global-bar-header">\n      <p class="pull-left  globalUpgradeTitle">\n      </p>\n      <p class="pull-right  globalUpgradePercent">\n      </p>\n      <div class="n-clearfix"></div>\n    </div>\n    <div class="globalUpgradeProgressBar">\n      <div class="fillProgress">\n      </div>\n    </div>\n    <div class="n-upgrade-global-bar-footer">\n      <p class="pull-left  globalUpgradeSubtitle">\n      </p>\n      <p class="pull-right">\n        <a class="globalLinkTask"><%= i18nStatic(viewName, "open") %></a>\n      </p>\n      <div class="n-clearfix"></div>\n    </div>\n  </div>\n  \x3c!-- Upgrade tasks --\x3e\n  <div class="n-upgrade-tasks">\n    \x3c!-- Caret --\x3e\n    <div class="n-container-caret">\n      <div class="n-container-caret-border"></div>\n      <div class="n-container-caret-content"></div>\n    </div>\n    \x3c!-- List of upgrade tasks --\x3e\n    <div class="n-upgrade-tasks-list">\n      \x3c!-- Host tasks with their subtasks will be added here... --\x3e\n    </div>\n  </div>\n  \x3c!-- Retry Upgrade (only shown in failed preupgrade) --\x3e\n  <button class="btn btn-primary btnRetryUpgrade n-upgrade-retry">\n    <%= i18nStatic(viewName, "retryUpgrade") %>\n  </button>\n\n  <button class="btn btn-primary btnRetryPreUpgrade n-upgrade-retry">\n    <%= i18nStatic(viewName, "retryPreUpgrade") %>\n  </button>\n</div>\n'}),define("text!templates/popups/softwareupgrade/SoftwareUpgradePopupVersionRowsView.html",[],function(){return'\x3c!-- The tbody content will replace the inline spinner from the table\n     softwareReleaseList.\n--\x3e\n<tbody>\n<% if (softwareReleaseCollection && softwareReleaseCollection.length) { %>\n  <% _.each(softwareReleaseCollection, function(model) { %>\n  <tr dataId="<%= model.name %>" class="<%= !showIncompatible &&\n  model.status === statusMap.INCOMPATIBLE ? \'hide\' : \'\' %>">\n    <td class="n-col-version">\n      <p class="n-version">\n        <%= model.name || model.version %> <%= model.isLTS? i18n(\'long_term_support\') : \'\' %>\n        <span class="qualification">\n          <%= model.qualifiedDate === -1 ? \' (not qualified)\' : \'\' %>\n        </span>\n      </p>\n      <% if (model.releaseDate) { %>\n        <div class="release-inline-row">\n          <label class="n-release-date-label">Release Date: </label>\n          <span class="n-release-date">\n            <%= TimeUtil.formatShortDate(model.releaseDate * 1000) %>\n          </span>\n        </div>\n      <% } %>\n      <% if (model.releaseNoteUrl) { %>\n      <div>\n        <a href="<%=model.releaseNoteUrl%>"\n           target="_blank">View Release Notes\n        </a>\n      </div>\n      <% } %>\n      <div class="n-requirements hidden"></div>\n    </td>\n    <td class="n-col-download">\n      \x3c!-- Container --\x3e\n      <div class="n-col-download-container">\n\n        \x3c!-- Details or Download --\x3e\n        <div class="n-link-status-details">\n          <% if (model.status === statusMap.INPROGRESS ||\n                 model.status === statusMap.QUEUED ) { %>\n\n            \x3c!-- Stop button. Automatic downloads can\'t be canceled --\x3e\n            <% if (model.status === statusMap.INPROGRESS &&\n                   model.transferType !== transferTypeMap.AUTOMATIC_DOWNLOAD &&\n                   softwareTypeState !== softwareTypeStateMap.NCC) { %>\n              <button class="btn btnStop btn-control" title="Stop"\n                   dataId="<%= model.name %>">\n              </button>\n            <% } %>\n\n            \x3c!-- Type of progress --\x3e\n            <% if (model.transferType ===\n                   transferTypeMap.DOWNLOAD) { %>\n              <div class="progress-type">downloading...</div>\n            <% } else if (model.transferType ===\n                 transferTypeMap.UPLOAD) { %>\n              <div class="progress-type">uploading...</div>\n            <% } else if (model.transferType ===\n                 transferTypeMap.AUTOMATIC_DOWNLOAD){%>\n              <div class="progress-type">automatic download</div>\n            <% } else if (model.transferType ===\n                 transferTypeMap.PROCESS) { %>\n              <div class="progress-type">processing...</div>\n            <% } else { %>\n              <div class="progress-type">transferring...</div>\n            <% } %>\n\n          <% } else { %>\n\n            \x3c!-- Loader --\x3e\n            <div class="n-inline-loading-container">\n              <div class="n-inline-loading  loaderRow" />\n            </div>\n\n            <% if (model.status !== statusMap.AVAILABLE\n              && model.status !== statusMap.INCOMPATIBLE) { %>\n              \x3c!-- Delete --\x3e\n              <i dataId="<%= model.name %>" class="btnDelete  btn-control"\n                 data-icon="v" aria-hidden="true" title="Delete"></i>\n            <% } %>\n\n            \x3c!-- Details --\x3e\n            <% if (model.transferType !== transferTypeMap.UPLOAD &&\n                   model.status !== statusMap.CORRUPTED  &&\n                   model.status !== statusMap.FAILED) { %>\n              <a dataId="<%= model.name %>" class="linkDetails"\n                 title="Release Notes">details</a>\n            <% } %>\n\n            \x3c!-- Corrupted --\x3e\n            <% if (model.status === statusMap.CORRUPTED) { %>\n              Corrupted\n            <% } else if (model.status === statusMap.FAILED) { %>\n              Failed\n            <% } %>\n\n          <% } %>\n\n        </div>\n\n        \x3c!-- Button and progress bar --\x3e\n        <div class="n-upgrade-control">\n\n          \x3c!-- Download --\x3e\n          <button class="btn -default btnDownload btn-control" style="display:\n            <%= model.status===statusMap.AVAILABLE ? \'inline-block\': \'none\'%>"\n            dataId="<%= model.name %>">\n              Download\n          </button>\n\n          <div style="display:\n            <%= model.status===statusMap.INCOMPATIBLE ? \'inline-block\': \'none\'%>"\n            dataId="<%= model.name %>">\n              Incompatible with registered PC.\n          </div>\n\n          \x3c!-- Progress --\x3e\n          <% var percent = model.totalSizeInBytes > 0 ? Math.max(0, Math.floor(\n              100 * model.currentSizeInBytes / model.totalSizeInBytes )) : 0 %>\n          <div class="progress -compact" style="display:\n          <%= model.status === statusMap.INPROGRESS ||\n          model.status === statusMap.QUEUED ? \'inline-block\' : \'none\'%>">\n            <div class="progress-bar" role="progressbar" aria-valuenow=\n            "<%= percent %>" aria-valuemin="0" aria-valuemax="100"\n            style="width: <%= percent %>%;">\n              <span class="sr-only"><%= percent %>% Complete</span>\n            </div>\n          </div>\n\n          \x3c!-- Upgrade --\x3e\n          <% var upgradeBtnStyle = model.status === statusMap.COMPLETED ?\n              \'display:inline-block;\' : \'display:none;\' %>\n          <% if (softwareTypeState === softwareTypeStateMap.NCC) { %>\n            <button type="button"\n              class="btn btn-primary btn-control btnUpgrade btnsUpgrade"\n              style="<%= upgradeBtnStyle %>"\n              dataId="<%= model.name %>"\n              dataCheck="<%= model.md5Sum || model.md5_sum || \'\' %>">\n              Upgrade\n            </button>\n          <% } else if (softwareTypeState ===\n                        softwareTypeStateMap.FILE_SERVER) { %>\n            <button type="button"\n              class="btn btn-primary btn-control btnUpgrade btnsUpgrade"\n              style="<%= upgradeBtnStyle %>"\n              dataId="<%= model.name %>"\n              dataCheck="<%= model.md5Sum || model.md5_sum || \'\' %>">\n              Upgrade\n            </button>\n          <% } else { %>\n            <div class="btn-group">\n              <button type="button" data-toggle="dropdown"\n                dataId="<%= model.name %>"\n                class="btn btn-primary dropdown-toggle btn-control btnsUpgrade"\n                style="<%= upgradeBtnStyle %>">\n                <%= isUpgrade ? "Upgrade" : "Install" %>\n                <span class="caret"></span>\n              </button>\n              <ul class="dropdown-menu dropdown-menu-right" role="menu">\n                <% if (model.status === statusMap.COMPLETED) { %>\n                  <li>\n                    <a class="btnPreUpgrade"\n                      dataId="<%= model.name %>"\n                      dataCheck="<%= model.md5Sum || model.md5_sum || \'\' %>">\n                      <%= isUpgrade ? "Pre-upgrade" : "Pre-install" %>\n                    </a>\n                  </li>\n                  <li>\n                    <a class="btnUpgrade"\n                      dataId="<%= model.name %>"\n                      dataCheck="<%= model.md5Sum || model.md5_sum || \'\' %>">\n                      <%= isUpgrade ? "Upgrade Now" : "Install Now" %>\n                    </a>\n                  </li>\n                <% } %>\n              </ul>\n            </div>\n          <% } %>\n\n          \x3c!-- Failed --\x3e\n          <button class="btn btn-danger btnFailed  btn-control" style="display:\n            <%= model.status === statusMap.FAILED &&\n                model.transferType !== transferTypeMap.UPLOAD ?\n                \'inline-block\': \'none\'\n            %>"\n            dataId="<%= model.name %>"\n            title="<%= percent+\'%\' %>">\n            Retry\n          </button>\n\n          \x3c!-- Paused --\x3e\n          <button class="btn btnResume  btn-control" style="display:\n            <%= model.status === statusMap.PAUSED ? \'inline-block\': \'none\'%>"\n            dataId="<%= model.name %>"\n            title="<%= percent+\'%\' %>">\n            \x3c!-- Type of progress --\x3e\n            <% if (model.transferType === transferTypeMap.DOWNLOAD) { %>\n              Resume Download\n            <% } else if (model.transferType === transferTypeMap.UPLOAD) { %>\n              Resume Upload\n            <% } else { %>\n              Resume\n            <% } %>\n          </button>\n\n          \x3c!-- Corrupted --\x3e\n          <button class="btn btn-danger btnCorrupted  btn-control" style="display:\n            <%= model.status === statusMap.CORRUPTED ? \'inline-block\':\'none\'%>"\n            dataId="<%= model.name %>" >\n            Delete\n          </button>\n        </div>\n\n      </div> \x3c!-- End of n-col-download-container --\x3e\n\n    </td>\n  </tr>\n  <% }); %>\n<% } else { %>\n  <tr>\n    <td class="n-message">\n      No available versions for upgrade.\n    </td>\n  </tr>\n<% } %>\n</tbody>\n'}),define("text!templates/popups/softwareupgrade/SoftwareUpgradePopupUpgradeConfirmView.html",[],function(){return'<tr class="n-row-upgrade-confirm" dataId="<%= dataId %>">\n  <td class="n-col-upgrade-confirm" colspan="2">\n    <div class="pull-left n-choose-upgrade">\n      Choose upgrade type\n    </div>\n    <div class="pull-right">\n      <div class="btnUpgradeAutomatic btn-control" dataId="<%= dataId %>">\n        Automatic\n      </div>\n      <div class="btnUpgradeManual btn-control" dataId="<%= dataId %>">\n        Manual\n      </div>\n      <div class="btnUpgradeCancel btn-control" dataId="<%= dataId %>">\n        Cancel\n      </div>\n    </div>\n    <div class="n-clearfix"></div>\n  </td>\n</tr>'}),define("text!templates/popups/softwareupgrade/SoftwareUpgradePopupTaskRowView.html",[],function(){return'\x3c!-- Task row --\x3e\n<div class="n-upgrade-task-row" dataId="<%= model.entityId %>">\n  \x3c!-- Task header --\x3e\n  <div class="n-upgrade-task-row-header">\n    <p class="pull-left">\n      <span class="rowTaskName">\n        <%= AppUtil.generateKBLinkFromMessage(model.taskName || model.subTaskMessage) %>\n      </span>\n      <span class="rowTaskEntity">\n        <% if (model.entity === AppConstants.ENTITY_NODE ||\n               model.entity === AppConstants.ENTITY_HOST) { %>\n          \x3c!-- TODO: Waiting for infra team to fill host ip (entity name) --\x3e\n          (Host ID: <%= model.entityId %>)\n        <% } %>\n      </span>\n      <span class="n-upgrade-task-label-failed  rowTaskStatus"\n        style="display:\n          <%= (model.status === \'failed\' || model.status === \'canceled\' ||\n               model.status === \'aborted\') ?\n              \'inline-block\' : \'none\' %>">\n        <%= model.status %>\n      <span>\n      <% if (isManualUpgrade) { %>\n        <div class="btnManualReboot" dataId="<%= model.entityId %>">\n          Reboot\n        </div>\n      <% } %>\n    </p>\n    <p class="pull-right rowTaskPercent">\n      <%= model.percentageCompleted %>%\n    </p>\n    <div class="n-clearfix"></div>\n  </div>\n  \x3c!-- Task progress bar --\x3e\n  <div class="n-upgrade-task-row-progress-container">\n    <div class="n-upgrade-task-row-progress rowTaskProgress <%=model.status%>">\n      <div class="fillProgress"\n           style="width:<%= model.percentageCompleted %>%">\n      </div>\n    </div>\n    <% if (model.subTaskList && model.subTaskList.length) { %>\n      <a class="linkRowSubTask" dataId="<%= model.entityId %>">open</a>\n    <% } %>\n  </div>\n  \x3c!-- Subtask rows --\x3e\n  <div class="n-upgrade-subtask-row  rowSubTasks"\n       dataId="<%= model.entityId %>">\n    \x3c!-- Caret --\x3e\n    <div class="n-container-caret">\n      <div class="n-container-caret-border"></div>\n      <div class="n-container-caret-content"></div>\n    </div>\n    \x3c!-- Tabs --\x3e\n    <ul class="n-upgrade-subtask-row-tab">\n      <li class="n-upgrade-tab  tabRowSubTask  active"\n          dataId="<%= model.entityId %>"\n          dataTarget="bar">\n        Subtasks\n      </li>\n      <li class="n-upgrade-tab  tabRowSubTask"\n          dataId="<%= model.entityId %>"\n          dataTarget="log">\n        Details\n      </li>\n    </ul>\n    <div class="n-clearfix"></div>\n    \x3c!-- Tab content: progress bars --\x3e\n    <div class="n-upgrade-subtask-row-tab-content  active"\n         dataId="<%= model.entityId %>"\n         dataTarget="bar">\n      <% _.each( model.subTaskList, function(subTaskModel, subTaskIndex) { %>\n        <% var subTaskId =  model.entityId + \'-\' + subTaskIndex; %>\n        <div class="rowSubTask" dataId="<%= subTaskId %>">\n          \x3c!-- Subtask row header --\x3e\n          <div class="n-upgrade-subtask-row-header  rowSubTaskMessage">\n            <%= subTaskModel.taskTag %>\n          </div>\n          \x3c!-- Subtask row progress --\x3e\n          <div class="n-upgrade-subtask-row-progress-container">\n            <div dataId="<%= subTaskId %>"\n                 class="n-upgrade-subtask-row-progress  rowSubTaskProgress\n                        <%= subTaskModel.status %>">\n              <div class="fillProgress"\n                   style="width:<%= subTaskModel.percentageCompleted %>%">\n              </div>\n            </div>\n            <div class="rowSubTaskPercent" dataId="<%= subTaskId %>">\n              <%= subTaskModel.percentageCompleted %>%\n            </div>\n          </div>\n        </div>\n      <% }); %>\n    </div>\n    \x3c!-- Tab content: log messages --\x3e\n    <div class="n-upgrade-subtask-row-tab-content"\n         dataId="<%= model.entityId %>"\n         dataTarget="log">\n      <div class="n-upgrade-log">\n        <% _.each( model.subTaskList, function(subTaskModel, subTaskIndex) { %>\n          <% if( subTaskModel.percentageCompleted ) { %>\n            <p><%= subTaskModel.subTaskMessage %></p>\n          <% } %>\n        <% }); %>\n      </div>\n    </div>\n  </div>\n</div>'}),define("text!templates/popups/softwareupgrade/SoftwareUpgradePopupPreupgradeNotificationView.html",[],function(){return'<div class="n-upgrade-dialog">\n  <h4 class="n-title"><%= metadataMsg.title %></h4>\n  <div class="upgrade-msg-list">\n    <table class="table table-hover">\n      <tbody>\n        <% _.each(metadataMsg.descriptionItemList, function(item){ %>\n          <tr class=\'n-table-row\'>\n            <td>\n              <span class="n-preupgrade-msg">\n                <%= Components.icon(\'Circular_Exclamation\',\n                  \'msg-icon -large n-notification-\' + item.severityLevel) %>\n              </span>\n            </td>\n            <td>\n              <span>\n                <%= item.message %>\n              </span>\n            </td>\n          </tr>\n        <% }) %>\n      </tbody>\n    </table>\n  </div>\n  <%= additionalInfo %>\n</div>'}),define("views/popups/softwareupgrade/SoftwareUpgradeView",["views/basecomponents/popups/BasePopupView","data/DataProperties","managers/IdleManager","managers/I18nManager","managers/NavigationManager","utils/AppConstants","utils/AppUtil","utils/AntiscrollUtil","utils/GpuUtil","utils/TimeUtil","utils/VMUtil","utils/I18nMixin","text!templates/popups/softwareupgrade/SoftwareUpgradeView.html","text!templates/popups/softwareupgrade/SoftwareUpgradePopupStateVersionsView.html","text!templates/popups/softwareupgrade/SoftwareUpgradePopupStateUpgradingView.html","text!templates/popups/softwareupgrade/SoftwareUpgradePopupVersionRowsView.html","text!templates/popups/softwareupgrade/SoftwareUpgradePopupUpgradeConfirmView.html","text!templates/popups/softwareupgrade/SoftwareUpgradePopupTaskRowView.html","text!templates/popups/softwareupgrade/SoftwareUpgradePopupPreupgradeNotificationView.html"],function(e,t,n,i,s,a,o,r,l,c,d,p,u,h,m,f,v,g,E){"use strict";var T=_.template(u),C=_.template(h),S=_.template(m),A=_.template(f),b=(_.template(v),_.template(g)),y=_.template('<div class="n-message-row"><%=softwareType%> upgrade is in progress. Please wait for it to be completed.</div>'),I=_.template("<div><%= warning %></div>"),w=_.template('<span class="gpu-vm-msg" data-toggle="popover"><a><%= vms_using_gpu %></a></span>'),P=_.template(E),N=a.TASK_STATUS_CANCELED+" "+a.TASK_STATUS_FAILED+" "+a.TASK_STATUS_COMPLETE+" "+a.TASK_STATUS_ACTIVE+" "+a.TASK_STATUS_QUEUED,R="SoftwareUpgradeView";return e.extend({name:R,cvmRebootRequired:!1,className:"n-modal-tab-content",LicenseManager:require("managers/LicenseManager"),_prevCountSoftwareReleases:0,_prevCountUpgradeTasks:0,preupgradeModel:null,prismInfoHeaderErrorShown:!1,prismInforHeaderErrorMap:null,showIncompatible:!0,NO_CHECK_WARNING:"<br><br>Warning: pre-upgrade checks will *not* be performed.",UPGRADE_CONFIRM:i.t("SoftwareUpgradeView","upgrade_confirm_msg")+i.t("SoftwareUpgradeView","upgrade_warning_msg"),events:{"click  .btn-control":"onClickButtonControl","click  .linkUpload":"onClickLinkUpload","click  .btnCancel":"onClickUploadCancel","click  .btnUploadNow":"onClickUploadNow","click  .btnDelete":"onClickDelete","click  .btnDownload":"onClickDownload","click  .btnFailed":"onClickFailed","click  .btnCorrupted":"onClickDelete","click  .btnStop":"onClickStop","click  .btnResume":"onClickResume","click  .btnUpgrade":"onClickUpgrade","click  .btnPreUpgrade":"onClickPreUpgrade","click  .btnUpgradeAutomatic":"onClickUpgradeAutomatic","click  .btnUpgradeManual":"onClickUpgradeManual","click  .btnUpgradeCancel":"onClickUpgradeConfirmCancel","click  .globalLinkTask":"onClickLinkTask","click  .linkRowSubTask":"onClickLinkRowSubTask","click  .tabRowSubTask":"onClickTabSubTask","click  .btnRetryUpgrade":"onClickRetryUpgradeButton","click  .btnRetryPreUpgrade":"onClickRetryPreUpgradeButton","change .checkboxAutoDownload":"onChangeAutoDownload","click  .btnBackProgress":"onClickBackProgress","click  .btnBackVersion":"onClickBackVersion","click  .docLink":"onKBLinkClick"},viewEvents:{LEAVE_VIEW:"leaveView"},modelEvents:{"error                      model":"onModelError","change.state               model":"onStateChange","change.currentVersionModel model":"onCurrentVersionChange","change.upgradeConfigModel  model":"onUpradeConfigChange","change.softwareReleases    model":"onSoftwareReleasesChange","change.stateUpload         model":"onStateUploadChange","change.upgradeTasks        model":"onChangeUpgradeTasks","change.clusterUpgradeModel model":"onChangeClusterUpgradeModel"},initialize:function(){e.prototype.initialize.apply(this,arguments),this.model=this.createSoftwareUpgradeModelInstance()},createSoftwareUpgradeModelInstance:function(){return null},render:function(e){return this.$el.html(T(this.vtOptions({softwareType:this.softwareType,canShowVCenter:this.canShowVCenter(),canModify:this.canModifyByEntityType(a.ENTITY_UPGRADE),is2048Disabled:e,viewName:R}))),this.$('input[type="checkbox"]').nutanixInput({type:"checkbox"}),this.applyAntiScroll(100),this},onStartServices:function(){this.delegateModelEvents(),this.refreshView()},onStopServices:function(){this.undelegateModelEvents()},hide:function(){this.$el.hide()},show:function(){this.$el.show()},refreshView:function(){this.model.getSoftwareCurrentVersion()||o.addInLineDonutLoader(this.$(".lblCurrentVersion")),this.model.fetchCurrentVersion(),this.model.fetchUpgradeState()},destroy:function(){this.model&&this.model.destroyAll(),this.$(".eol-versions-tooltip").tooltip("destroy"),e.prototype.destroy.apply(this,arguments)},getUpgradeTemplate:function(){return S},getParallelOpNoShowTemplate:function(){return null},displayUpgradeVersions:function(){this.$(".n-state-content").html(C(this.vtOptions({softwareTypeState:this.model.softwareTypeState,overwriteCheckbox:!1,viewName:R})))},canShowVCenter:function(){return!1},executeStateVersionView:function(){this.$(".n-state-content").empty(),this._prevCountSoftwareReleases=0,this.displayUpgradeVersions();var e=this.$(".metadataUploadSection");this.model.getSoftwareType()===a.UPGRADE_SOFTWARE_TYPE.FOUNDATION?e.hide():e.show(),o.addInLineDonutLoader(this.$(".loadingSpinner")),this.$(".eol-versions-tooltip").tooltip({placement:"top",trigger:"hover",container:"body",title:i.ts(R,"eolVersionsWarningMsg")}),this.model.startPollingSoftwareReleases(),this.model.fetchUpgradeConfig(),this._isAutomaticDownloadVisible()&&this.$(".n-left-control").show(),this.$(".n-game-message").hide(),this.$(".btnBackVersion").hide(),this.showBackToProgress()},showBackToProgress:function(){(this.model.isGlobalUpgradeComplete()||this.model.isPreupgradeCheckFailed()||this.preupgradeModel&&this.preupgradeModel.isStatusComplete()&&this.model.get(t.UPGRADE_IGNORE_UPGRADE))&&this.$(".btnBackProgress").show()},onStateChange:function(){this.model.isStateUpgrade()||this.model.isCvmMemoryConfigRunning()?(this.$(".n-state-content").empty(),this.executeStateUpgradeView()):this.model.isStateVersion()&&this.executeStateVersionView()},onCurrentVersionChange:function(){this.$(".lblCurrentVersion").html(this.model.getSoftwareCurrentVersion())},onUpradeConfigChange:function(){var e=this.model.get(t.UPGRADE_UPGRADE_CONFIG_MODEL),n=this.$(".checkboxAutoDownload");this._isAutomaticDownloadVisible()&&this.$(".n-left-control").show(),n.removeAttr("disabled"),this.$(".loaderAutoDownload").hide(),n.prop("checked",e.get(t.UPGRADE_ENABLE_AUTOMATIC_DOWNLOAD))},onSoftwareReleasesChange:function(){var e=this.model&&this.model.get(t.UPGRADE_SOFTWARE_RELEASES);if(e){var n=this.areFileInputsPresent();this.$("#softwareReleaseList").html(A(this.vtOptions({statusMap:a.UPGRADE_SOFTWARE_RELEASE_STATUS,transferTypeMap:a.UPGRADE_TRANSFER_TYPE,softwareReleaseCollection:e.toJSON(),softwareTypeState:this.model.softwareTypeState,showIncompatible:this.showIncompatible,softwareTypeStateMap:a.UPGRADE_SOFTWARE_TYPE_STATE,TimeUtil:c,isUpgrade:this.isUpgrade(),areFileInputsPresent:n}))),this._prevCountSoftwareReleases!==e.length&&(this.applyAntiScroll(),this._prevCountSoftwareReleases=e.length),this.checkPrismInfoHeaderError(e)}},areFileInputsPresent:function(){var e=!1,t=this.$(".inputMetadataFile").val(),n=this.$(".inputFile").val();return t&&n&&""!==t&&""!==n&&(e=!0),e},isUpgrade:function(){return!0},onChangeDisableSelection:function(){},checkPrismInfoHeaderError:function(e){var n;if(e&&e._jqXHR&&(n=e._jqXHR.getResponseHeader(t.UPGRADE_SOFTWARE_RELEASES_PRISM_INFO_HEADER)),n){this.prismInforHeaderErrorMap=this.prismInforHeaderErrorMap||{};var i=decodeURIComponent(n).replace(/\+/g," ");this.prismInforHeaderErrorMap[i]?o.log("SoftwareUpgradeView: Error fetching releases :"+i):(this.prismInforHeaderErrorMap[i]=!0,this.showHeaderError(i,!0))}else this.prismInfoHeaderErrorShown&&this.clearHeader()},onModelError:function(e,t,n){this.showHeaderError(_.isObject(e)?o.processAjaxError(e.responseText):e),this.applyAntiScroll()},showHeaderError:function(t,n){this.prismInfoHeaderErrorShown=!!n,e.prototype.showHeaderError.apply(this,arguments)},
onClickButtonControl:function(){this.clearHeader()},onClickDownload:function(e){var t=$(e.currentTarget).attr("dataId");$.nutanixConfirm({msg:"Do you want to download "+t+"?",yes:function(){this.$('[dataId="'+t+'"]').css("opacity",.5).attr("disabled",!0),this.$('tr[dataId="'+t+'"] .loaderRow').show(),this.model.downloadSoftwareRelease(t),this.resetUploadForm()},yesText:"Yes",noText:"No",context:this})},onClickDelete:function(e){var t=$(e.currentTarget).attr("dataId");$.nutanixConfirm({msg:"Do you want to delete "+t+"?",yes:function(){this.$('[dataId="'+t+'"]').css("opacity",.5).attr("disabled",!0),this.$('tr[dataId="'+t+'"] .loaderRow').show(),this.$('tr[dataId="'+t+'"] .btnDelete').remove(),this.model.deleteSoftwareRelease(t),this.resetUploadForm()},yesText:"Yes",noText:"No",context:this})},onClickFailed:function(e){$.nutanixConfirm({msg:"Do you want to retry?",yes:function(){var t=$(e.currentTarget).attr("dataId");this.resumeTransfer(t),this.resetUploadForm()},yesText:"Yes",noText:"No",context:this})},onClickResume:function(e){var n,i=$(e.currentTarget).attr("dataId"),s=this.model.getSoftwareRelease(i);n=s&&s.get(t.UPGRADE_TRANSFER_TYPE)?s.get(t.UPGRADE_TRANSFER_TYPE):a.UPGRADE_TRANSFER_TYPE.PROCESS,$.nutanixConfirm({msg:"Do you want to resume "+n.toLowerCase()+"?",yes:function(){this.resumeTransfer(i)},yesText:"Yes",noText:"No",context:this})},resumeTransfer:function(e){var n=this.model.getSoftwareRelease(e);this.$('[dataId="'+e+'"]').css("opacity",.5).attr("disabled",!0),this.$('tr[dataId="'+e+'"] .loaderRow').show(),this.$('tr[dataId="'+e+'"] .btnDelete').remove(),n&&n.get(t.UPGRADE_TRANSFER_TYPE)===a.UPGRADE_TRANSFER_TYPE.UPLOAD?(this.$(".inputName").val(n.get(t.UPGRADE_NAME)),this.$(".inputVersion").val(n.get(t.UPGRADE_VERSION)),this.$(".inputMD5Sum").val(n.get(t.UPGRADE_MD5SUM)),this.$(".inputFileSize").val(n.get(t.UPGRADE_CURRENT_TOTAL_IN_BYTES)),this.$(".inputOffset").val(n.get(t.UPGRADE_CURRENT_SIZE_IN_BYTES)),this.showUploadForm(),this.startUpload()):(this.model.downloadSoftwareRelease(e),this.resetUploadForm())},onChangeAutoDownload:function(e){var t=this.$(".checkboxAutoDownload"),n=t.prop("checked");if(this.clearHeader(),t.is(":checked")){var i=this.LicenseManager.FEATURE_MAP.LICENSE_AUTOMATIC_DOWNLOAD;if(this.LicenseManager.violatedFeatureLicense(i)){var s=this.LicenseManager.getPopupMessageTemplate(i);this.showHeaderWarning(s)}}this.$(".loaderAutoDownload").show(),t.attr("disabled",!0),this.model.updateUpgradeConfigAutoDownload(n)},onClickLinkUpload:function(e){this.showUploadForm()},onClickUploadCancel:function(e){this.showBackToProgress(),this.clearSelectedFiles(),this.hideUploadForm()},clearSelectedFiles:function(){this.$(".inputMetadataFile").val(""),this.$("inputFile").val("")},onClickUploadNow:function(){this.clearHeader(),this.startUpload()},onClickStop:function(e){var n,i=$(e.currentTarget).attr("dataId"),s=this.model.getSoftwareRelease(i);n=s&&s.get(t.UPGRADE_TRANSFER_TYPE)?s.get(t.UPGRADE_TRANSFER_TYPE):a.UPGRADE_TRANSFER_TYPE.PROCESS,$.nutanixConfirm({msg:"Do you want to stop "+n.toLowerCase()+"?",yes:function(){this.$('[dataId="'+i+'"]').css("opacity",.5).attr("disabled",!0),this.$('tr[dataId="'+i+'"] .loaderRow').show(),this.$('tr[dataId="'+i+'"] .btnPause').remove(),this.model.cancelTransferSoftwareRelease(i),this.showBackToProgress(),this.enableUploadForm()},yesText:"Yes",noText:"No",context:this})},showUploadForm:function(){this.$(".n-upload-description").hide(),this.$(".n-upload-form-container").show(),this.applyAntiScroll()},hideUploadForm:function(){this.$(".n-upload-description").show(),this.$(".n-upload-form-container").hide(),this.applyAntiScroll()},startUpload:function(){this.hideBackToProgress(),this.disableUploadForm(),this.model.uploadSoftwareRelease(this.$(".formUpload"))},onStateUploadChange:function(){var e=this.model.get(t.UPGRADE_STATE_UPLOAD);e===this.model.STATE_UPLOAD_READY?this.enableUploadForm():e===this.model.STATE_UPLOAD_RESET?this.enableUploadForm():e===this.model.STATE_UPLOAD_FINISHED?(this.resetUploadForm(),this.hideUploadForm()):e===this.model.STATE_UPLOAD_INPROGRESS?(this.hideBackToProgress(),this.showUploadProgress()):e===this.model.STATE_UPLOAD_FAILED&&this.enableUploadForm(),this.applyAntiScroll()},disableUploadForm:function(){this.$(".formUpload input").attr("disabled",!0),this.$(".formUpload .btn").attr("disabled",!0),this.$(".btnUploadNow").button("loading")},enableUploadForm:function(){this.$(".formUpload").show(),this.$(".n-upload-processing").hide(),this.$(".formUpload input").removeAttr("disabled"),this.$(".formUpload .btn").removeAttr("disabled"),this.$(".btnUploadNow").button("reset")},resetUploadForm:function(){this.enableUploadForm(),this.$(".formUpload input").val("")},showUploadProgress:function(){this.disableUploadForm(),this.$(".n-upload-file").html(this.$(".inputFile").val()),this.$(".n-upload-processing").show(),this.$(".formUpload").hide(),n.reset()},onClickPreUpgrade:function(e){var n=$(e.currentTarget).attr("dataId"),i=$(e.currentTarget).attr("dataCheck");o.hasLocalStorage()&&(localStorage[t.UPGRADE_VERSION_ID]=n,localStorage[t.UPGRADE_IGNORE_UPGRADE]=!0,localStorage[t.UPGRADE_IGNORE_PREUPGRADE]=!1,localStorage[t.UPGRADE_MANUAL_UPGRADE]=!1,localStorage[t.UPGRADE_TO_MD5SUM]=i),this.confirmUpgrade(n,!1,!1,!0,i)},onClickUpgrade:function(e){var n=$(e.currentTarget).attr("dataId"),i=$(e.currentTarget).attr("dataCheck"),s=!1,a=!1;e.shiftKey&&e.altKey?s=!0:(e.ctrlKey||e.metaKey)&&(a=!0),o.hasLocalStorage()&&(localStorage[t.UPGRADE_VERSION_ID]=n,localStorage[t.UPGRADE_IGNORE_UPGRADE]=a,localStorage[t.UPGRADE_IGNORE_PREUPGRADE]=s,localStorage[t.UPGRADE_MANUAL_UPGRADE]=!1,localStorage[t.UPGRADE_TO_MD5SUM]=i),this.confirmUpgrade(n,!1,s,a,i)},onClickRetryUpgradeButton:function(){this.confirmDialog({versionId:null,isManualUpgrade:!1,isIgnorePreupgradeTests:!1,isIgnoreUpgrade:!1,msg:"Do you want to retry this upgrade?",isRetryUpgrade:!0})},onClickRetryPreUpgradeButton:function(){var e=this.model.get("versionIdToUpgrade");o.hasLocalStorage()&&(localStorage[t.UPGRADE_VERSION_ID]=e,localStorage[t.UPGRADE_IGNORE_UPGRADE]=!0,localStorage[t.UPGRADE_IGNORE_PREUPGRADE]=!1,localStorage[t.UPGRADE_MANUAL_UPGRADE]=!1),this.confirmUpgrade(e,!1,!1,!0)},onClickUpgradeAutomatic:function(e){var t=$(e.currentTarget).attr("dataId");this.confirmUpgrade(t,!1,!1,!1)},onClickUpgradeManual:function(e){var t=$(e.currentTarget).attr("dataId");this.confirmUpgrade(t,!0,!1,!1)},onClickUpgradeConfirmCancel:function(e){var t=$(e.currentTarget).attr("dataId");this.$('tr.n-row-upgrade-confirm[dataId="'+t+'"]').remove(),this.$('tr[dataId="'+t+'"]').show(),this.model.startPollingSoftwareReleases()},_isAutomaticDownloadVisible:function(){return this.model.isAutomaticDownloadEnabled()},confirmUpgrade:function(e,n,s,a){var r=this.model.getSoftwareRelease(e),l="",c="";if(!r)throw new Error("Software release, "+e+", does not exist.");(l=r.get(t.UPGRADE_VERSION))||this.showHeaderError(this.i18ns("software_release_doesnt_exist",e));var d=o.sprintf(this.UPGRADE_CONFIRM,l);if(s&&!this.clusterManager.isMulticlusterNavMode()&&(d+=this.NO_CHECK_WARNING),a&&!s)d=i.ts("NOSSoftwareUpgradeView","confirm_preupgrade_only");else if(c=r.get(t.UPGRADE_NOTIFICATION)){var p=this.model.getSoftwareCurrentVersion();c.descriptionItemList=_.filter(c.descriptionItemList,function(e){return e.affectedReleases.indexOf(p)>-1}),c.descriptionItemList.length>0&&(d=P(this.vtOptions({metadataMsg:c,additionalInfo:d})))}this.confirmDialog({versionId:l,isManualUpgrade:n,isIgnorePreupgradeTests:s,isIgnoreUpgrade:a,msg:d,isRetryUpgrade:!1,metadataMsg:c})},confirmDialog:function(e){var t=this,n=this.i18n("yes"),i=this.i18n("no"),s="",a=e.metadataMsg;a&&(n=a.proceedMessage,i=a.cancelMessage,s="-preupgrade-confirm"),$.nutanixConfirm({msg:e.msg,yes:function(){t.model.stopPollingSoftwareReleases(),t.startUpgrade(e)},no:function(){this.model.startPollingSoftwareReleases()},yesText:n,noText:i,context:this,class:s})},startUpgrade:function(e){var t=this;this.setLastUpgradeWarningTime(),e.isRetryUpgrade?this.model.retryUpgrade():(this.disableRowElements(),e.successCallback=e.errorCallback=function(){t.enableRowElements()},this.model.startUpgrade(e))},platformStateChecks:function(e){var t=this;if(this.cvmRebootRequired)return void d.getRunningUVMs(function(n){var i=n.length;if(i)return void t._promptUserPowerOffVms(i);e()});e()},_promptUserPowerOffVms:function(e){var t=this,n=d.getLinkedVMPoweroffMsgTemplate({linkClass:"vmsLink",count:e}),i=$(n);i.find(".vmsLink").on("click",function(e){e.preventDefault();var n=a.PAGE_VMS,i=a.SUBPAGE_TABLE;s.navigateToPage(n,i),$("#nutanixConfirmModal .btnYes").trigger("click"),t.trigger(t.viewEvents.LEAVE_VIEW)}),$.nutanixConfirm({msg:i,hideNo:!0,class:"-left-align"})},setLastUpgradeWarningTime:function(){o.hasLocalStorage()&&localStorage.setItem("lastUpgradeWarningTime",Date.now())},disableRowElements:function(){this.$(".btn-control").removeClass("enabled").addClass("disabled").attr("disabled",!0)},enableRowElements:function(){this.$(".btn-control").removeClass("disabled").addClass("enabled").removeAttr("disabled")},executeStateUpgradeView:function(){var e=this.model.isCvmMemoryConfigRunning();if(e||!this.model.isSoftwareTypeUpgradeRunning()&&!this.model.isSoftwareTypeUpgradeCompleted()){var n=a.UPGRADE_SOFTWARE_LABEL[this.model.get(t.UPGRADE_SOFTWARE_UPGRADING)];e&&(n=a.UPGRADE_SOFTWARE_LABEL[a.UPGRADE_SOFTWARE_TYPE.CVM]),(this.model.localTaskManager.getGlobalTasks().hasActiveUpgradeTasks()||e)&&this.$(".n-state-content").html(y({softwareType:n}))}else this.$(".n-state-content").html(this.getUpgradeTemplate()(this.vtOptions({viewName:R}))),o.addInlineSpinner(this.$(".loadingSpinner"));this.model.stopPollingSoftwareReleases(),this.$(".n-game-message").show(),this.$(".n-left-control").hide(),this.$(".btnBackProgress").hide()},getGlobalProgressInfo:function(e){var n=e.get(t.TASK_NAME),i=void 0;return this.clusterManager.isMulticlusterNavMode()&&(i=-1!==n.toLowerCase().indexOf("preupgrade")?"Preupgrade Checks":"Upgrading Prism Central"),{title:i||n,subtitleEntity:" CVM(s)"}},onChangeUpgradeTasks:function(e){if(this.$(".n-upgrade-initial").remove(),this.$(".n-upgrade-global-bar-container").show(),0!==this._prevCountUpgradeTasks||!this.isPreupgradeCheckRunning(e)){var t=_.filter(e,function(e){return!e.isPreupgradeCheckTask()});this._prevCountUpgradeTasks!==t.length||0===this.$(".n-upgrade-tasks-list").children().length?(this._prevCountUpgradeTasks=t.length,this.createUpgradeProgressBars(t)):this.updateUpgradeProgressBars(t)}},onChangeClusterUpgradeModel:function(e){var n=this.getGlobalProgressInfo(e),i=e.get(t.TASK_STATUS)===a.TASK_STATUS_COMPLETE,s={title:n.title,percent:e.get(t.TASK_PERCENT_COMPLETE),subtasks:!0},o=0,r=!0,l=e.get(t.TASK_SUB_TASKS)||[],c=e.get(t.TASK_SUB_TASK_UUIDS)||[];e.get(t.TASK_STATUS)!==a.TASK_STATUS_FAILED&&e.get(t.TASK_STATUS)!==a.TASK_STATUS_CANCELED&&e.get(t.TASK_STATUS)!==a.TASK_STATUS_ABORTED||(r=!1),!l.length&&c.length&&this.model.forceFetchSubTasks(),_.each(l,function(e){e[t.TASK_STATUS]===a.TASK_STATUS_COMPLETE&&_.contains(e[t.TASK_ENTITY_TYPE],a.ENTITY_NODE)&&o++,e[t.TASK_STATUS]!==a.TASK_STATUS_FAILED&&e[t.TASK_STATUS]!==a.TASK_STATUS_CANCELED&&e[t.TASK_STATUS]!==a.TASK_STATUS_ABORTED||(r=!1)}),s.isRunning=r;var d=!1;if(-1!==e.get(t.TASK_NAME).toLowerCase().indexOf("preupgrade")&&(d=!0),s.subtitle=d?p.i18nsStatic(R,"performingPreUpgradeChecks"):p.i18nsStatic(R,"upgradingCountMsg",{count:l.length-o,entity:n.subtitleEntity}),i){var u=e.get(t.TASK_TYPE);s.title=a.TASK_OPERATION_COMPLETED_LABELS[u],d?(s.title=p.i18nsStatic(R,"preUpgradeChecksSuccessful"),s.subtitle=p.i18nsStatic(R,"preUpgradeChecksCompleted")):s.subtitle=p.i18nsStatic(R,"upgradedCountMsg",{count:o,entity:n.subtitleEntity})}s.subTasks=l,this.updateGlobalProgressBar(s),this.model.isGlobalUpgradeComplete()&&this.model.fetchCurrentVersion()},updateGlobalProgressBar:function(e){e=e||{};var t=this.$(".globalUpgradeProgressBar");$(t).removeClass("running").removeClass("failed"),e.isRunning?$(t).addClass("running"):$(t).addClass("failed"),$(t).find(".fillProgress").css("width",e.percent+"%"),this.$(".globalUpgradePercent").html(e.percent+"%"),this.$(".globalUpgradeTitle").html(e.title),this.$(".globalUpgradeSubtitle").html(e.subtitle),e.subtasks?this.$(".globalLinkTask").show():this.$(".globalLinkTask").hide(),this.$(".globalUpgradeProgressBar").removeClass("n-preupgrade"),e.isPreupgrade?this.$(".globalUpgradeProgressBar").addClass("n-preupgrade"):this.model.areGlobalUpgradeProcessesComplete()&&(this.$(".btnBackVersion").show(),this.$(".n-game-message").hide())},getPreupgradeTaskToDisplay:function(e){var n=_.max(e,function(e){return e.get(t.TASK_START_TIME)});return n.isPreupgradeCheckTask()?n:null},isPreupgradeCheckRunning:function(e){var n,s=!1;if(this.preupgradeModel=this.getPreupgradeTaskToDisplay(e),this.preupgradeModel){s=!0,n={isRunning:!(this.preupgradeModel.isStatusFailed()||this.preupgradeModel.isStatusCanceled()||this.preupgradeModel.isStatusAborted()),percent:this.preupgradeModel.get(t.TASK_PERCENT_COMPLETE),title:this.preupgradeModel.get(t.TASK_NAME),subtasks:!0,isPreupgrade:!0},this.$(".btnRetryUpgrade").hide(),this.$(".btnBackVersion").hide(),this.preupgradeModel.isStatusComplete()?(n.subtitle=i.ts("SoftwareUpgradeView","preupgradeComplete"),this.model.isStateUpgrade()&&this.$(".btnBackVersion").show()):this.preupgradeModel.isStatusFailed()?(n.subtitle="Failed.",this.$(".btnBackProgress").is(":visible")||(this.$(".btnBackVersion").show(),this.$(".n-game-message").hide()),this.model.get(t.UPGRADE_VERSION_ID)&&(-1!==this.preupgradeModel.get(t.TASK_NAME).toLowerCase().indexOf("preupgrade")?(this.$(".btnRetryUpgrade").show(),this.$(".btnRetryPreUpgrade").show(),this.model.startPollingSoftwareReleases(),this.model.fetchUpgradeConfig()):(this.$(".btnRetryUpgrade").show(),this.$(".btnRetryPreUpgrade").hide()))):this.preupgradeModel.isStatusCanceled()?n.subtitle="Canceled.":this.preupgradeModel.isStatusAborted()?(n.subtitle="Aborted.",this.$(".btnBackProgress").is(":visible")||(this.$(".btnBackVersion").show(),this.$(".n-game-message").hide())):n.subtitle="Checking all components for upgrade. Please wait.",this.updateGlobalProgressBar(n);var a=this.preupgradeModel.get(t.TASK_SUB_TASKS);this.createUpgradeProgressBars(a)}return s},createUpgradeProgressBars:function(e){this.$(".n-upgrade-tasks-list").empty();var t=this.model.fetchLatestUpgradeTask(e);_.each(t,function(e){this.$(".n-upgrade-tasks-list").append(b(this.vtOptions({model:e.toJSON?e.toJSON():e,isManualUpgrade:this.model.isManualUpgrade(),AppConstants:a})))},this)},updateUpgradeProgressBars:function(e){var n,i,s=this.model.fetchLatestUpgradeTask(e);_.each(s,function(e){i=e.getValue(t.TASK_ENTITY_ID),n=this.$('.n-upgrade-task-row[dataId="'+i+'"]');var s=e.get(t.TASK_NAME);e.isStatusFailed()&&(s=e.getFailedTaskMessageWithKBLink()),n.find(".rowTaskName").html(s),n.find(".rowTaskPercent").html(e.get(t.TASK_PERCENT_COMPLETE)+"%"),e.isStatusFailed()||e.isStatusCanceled()?n.find(".rowTaskStatus").show():n.find(".rowTaskStatus").hide(),n.find(".rowTaskProgress").removeClass(N).addClass(e.get(t.TASK_STATUS)).find(".fillProgress").css("width",e.get(t.TASK_PERCENT_COMPLETE)+"%"),_.each(e.get(t.TASK_SUB_TASKS),function(e,s){var a=i+"-"+s,o=n.find('.rowSubTask[dataId="'+a+'"]');o.find(".rowSubTaskMessage").html(e[t.SUB_TASK_MESSAGE]),o.find(".rowSubTaskProgress").removeClass(N).addClass(e[t.TASK_STATUS]).find(".fillProgress").css("width",e[t.TASK_PERCENT_COMPLETE]+"%"),o.find(".rowSubTaskPercent").html(e[t.TASK_PERCENT_COMPLETE]+"%")})},this)},onClickLinkTask:function(){var e=this;this.$(".n-upgrade-tasks").is(":visible")?(this.$(".globalLinkTask").html("open"),this.$(".n-upgrade-tasks").slideUp("fast",function(){e.applyAntiScroll()})):(this.$(".globalLinkTask").html("close"),this.$(".n-upgrade-tasks").slideDown("fast",function(){e.applyAntiScroll()}))},onClickLinkRowSubTask:function(e){var t=this,n=$(e.currentTarget),i=n.attr("dataId"),s=this.$('.n-upgrade-subtask-row[dataId="'+i+'"]');s.is(":visible")?(n.html("open"),s.slideUp("fast",function(){t.applyAntiScroll()})):(n.html("close"),s.slideDown("fast",function(){t.applyAntiScroll()}))},onClickTabSubTask:function(e){var t=$(e.currentTarget),n=t.hasClass("active"),i=t.attr("dataId"),s=t.attr("dataTarget");n||(t.siblings().removeClass("active").end().addClass("active"),this.$('.n-upgrade-subtask-row-tab-content[dataId="'+i+'"][dataTarget="'+s+'"]').siblings().removeClass("active").end().addClass("active"),this.applyAntiScroll())},onClickBackProgress:function(){this.model.changeStateToUpgrade()},onClickBackVersion:function(){this.model.changeStateToVersion()},parseEntityId:function(e){var t="";return _.isString(e)?t=e:_.isArray(e)&&e.length&&(t=e[0]),t.indexOf(":")>0?t.split(":")[0]:t},checkGpuBeforeUpgrade:function(e,t){var n=this,s=w(n.vtOptions({vms_using_gpu:i.ts("SoftwareUpgradeView","vms_using_gpu")})),o=I(n.vtOptions({warning:i.ts("SoftwareUpgradeView","vm_gpu_warning_msg",s)}));$.nutanixConfirm({msg:i.t("Common","loading"),hideYes:!0,hideNo:!0}),l.nonLiveMigratablePoweredOnUserVms(a.HYPERVISOR_TYPE.KVM).fetch().done(function(n){var i=!1;n.length&&(e+=(e.length?"<br><br>":"")+o,i=!0),t(e,i,n)}).fail(function(){e+=(e.length?"<br><br>":"")+o,t(e,!0)})},applyAntiScroll:function(e,t,n){if(e){var i=this;setTimeout(function(){i._createAntiScroll(t,n)},e)}else this._createAntiScroll(t,n)},_createAntiScroll:function(e,t){e=(e||this.$(".n-modal-body").width())+"px",t=(t||this.$(".n-modal-body").height())+"px",r.applyAntiScroll(this.$(".antiscroll-wrap"),e,t),this.$(".antiscroll-wrap").css("visibility","visible")},hideBackToProgress:function(){this.$(".btnBackProgress").hide()}})}),define("models/softwareupgrade/NOSSoftwareUpgradeModel",["models/softwareupgrade/SoftwareUpgradeModel","models/version/VersionModel","models/fileserver/FileServerCollection","data/DataProperties","utils/AppConstants","utils/AppUtil"],function(e,t,n,i,s,a){"use strict";return e.extend({name:"NOSSoftwareUpgradeModel",softwareTypeState:s.UPGRADE_SOFTWARE_TYPE_STATE.NOS,isValidateMetadataBeforeUpload:!0,initialize:function(){e.prototype.initialize.apply(this,arguments);var t=new n;this.subModelHelper.register(i.UPGRADE_FILESERVER_COLLECTION,t),t.on("reset",function(){this.trigger("change.softwareReleases")},this)},getSoftwareType:function(e){return s.UPGRADE_SOFTWARE_TYPE.NOS},createVersionModelInstance:function(){return new t},startPollingSoftwareReleases:function(){e.prototype.startPollingSoftwareReleases.apply(this,arguments),this.subModelHelper.get(i.UPGRADE_FILESERVER_COLLECTION).fetch()},getSoftwareCurrentVersion:function(){var e=this.get(i.UPGRADE_VERSION_MODEL);if(e)return e.getCurrentVersion()},getSoftwareTaggedCurrentVersion:function(){var e=this.get(i.UPGRADE_VERSION_MODEL);if(e)return e.getTaggedCurrentVersion()},hasDeployedFileServers:function(){return this.subModelHelper.get(i.UPGRADE_FILESERVER_COLLECTION).some(function(e){return e.get(e.DP.VERSION)})},isFileServerUpgradeInProgress:function(){return this.subModelHelper.get(i.UPGRADE_FILESERVER_COLLECTION).some(function(e){return e.get(e.DP.UPGRADE_IN_PROGRESS)})},isCompatibleWithFileServers:function(e){var t=this.subModelHelper.get(i.UPGRADE_SOFTWARE_RELEASES),n=t.find(function(t){return t.get(i.VERSION)===e}),s=this.subModelHelper.get(i.UPGRADE_FILESERVER_COLLECTION);if(n&&s){var o=n.get(i.UPGRADE_COMPATIBLE_FS_VERSIONS);if(o)return s.all(function(e){var t=e.get(e.DP.VERSION);return _.find(o,function(e){return 0===a.compareVersions(t,e)})})}return!0},getMinimumFileServerVersion:function(e){var t=this.subModelHelper.get(i.UPGRADE_SOFTWARE_RELEASES),n=t.find(function(t){return t.get(i.VERSION)===e}),s=n.get(i.UPGRADE_COMPATIBLE_FS_VERSIONS);return s&&s.length>0?s.sort(function(e,t){return a.compareVersions(e,t)})[0]:""},getRecommendedFileServerVersion:function(e){return this.subModelHelper.get(i.UPGRADE_SOFTWARE_RELEASES).find(function(t){return t.get(i.VERSION)===e}).get(i.UPGRADE_RECOMMENDED_FS_VERSIONS)},getInstalledFileServerVersion:function(){var e=this.subModelHelper.get(i.UPGRADE_FILESERVER_COLLECTION);return e&&e.length>0?e.at(0).get(i.VERSION):""}})}),define("models/softwareupgrade/NOSSoftwareCompatibilityModel",["backbone","models/BaseModel","data/DataURLConstants","data/DataManager","utils/AppConstants","utils/AppUtil"],function(e,t,n,i,s,a){"use strict";return t.extend({urlRoot:n.UPGRADE_SOFTWARE_RELEASES,entityType:s.SYSTEM_VERSION,defaults:{id:null,name:"",version:"",md5Sum:"",totalSizeInBytes:"",currentSizeInBytes:"",status:"",transferType:"",softwareType:"",url:"",compatiblePeNosVersions:"",compatibleNosVersions:"",compatibleVersions:"",qualifiedDate:"",upgradeNotification:""},name:"NOSSoftwareCompatibilityModel",initialize:function(e){e&&(this.version=e.version),t.prototype.initialize.apply(this,arguments)},sync:function(t,s,o){o=this.parseOptions(t,s,o),o.url=i.getDataSourceURL()+_.template(n.UPGRADE_COMPATIBLE_NOS_RELEASES,{type:n.PRISM_CENTRAL_VM,version:this.version}),t="read",a.log("BaseModel : \n\t method: "+t+"\n\t data  : "+o.url),e.sync(t,s,o)},parse:function(e){return e}})}),define("text!templates/popups/softwareupgrade/SoftwareUpgradePopupVCenterView.html",[],function(){return'<div id="vCenterCredential" class="n-version-row">\n  <p class="n-title">\n    <%= i18ns(\'vcenter_authentication\') %>\n  </p>\n  <div class="btnAddVCenter" style="display: none;">\n    <button class="add-vcenter btn">\n      <i data-icon="H" aria-hidden="true" class="-small"></i>\n      <span class="btn-content">\n        <%= i18ns(\'add_vcenter\') %>\n      </span>\n    </button>\n    <a class="delete-all-entries"><%= i18ns(\'delete_all_entries\') %></a>\n  </div>\n  <div class="n-clearfix"></div>\n  <table id="vCenterCredentialList" class="table">\n    <tbody>\n    </tbody>\n  </table>\n</div>\n'}),define("text!templates/popups/softwareupgrade/SoftwareUpgradePopupVCenterFormView.html",[],function(){return'<div id="formVCenterCredential" class="n-modal-body n-modal-form-container hidden">\n  <div class="n-modal-content-wrapper">\n    <div class="n-modal-alert-header">\n      \x3c!-- alert goes here --\x3e\n    </div>\n    <div class="n-modal-content add-vcenter-form">\n      \x3c!-- Content goes here --\x3e\n      <form class="form-horizontal">\n        <div class="control-group">\n          <label for="vCenterIpAddress" class="control-label"><%= i18ns(\'vcenter_ip_address\') %></label>\n          <div>\n            <input type="text" class="form-control host-ip" id="vCenterIpAddress">\n          </div>\n        </div>\n        <div class="control-group -half">\n          <div class="control-group">\n            <label for="username" class="control-label"><%= i18ns(\'username\') %></label>\n            <div>\n              <input type="text" class="form-control username" id="username">\n            </div>\n          </div>\n        </div>\n        <div class="control-group -half">\n          <div class="control-group">\n            <label for="password" class="control-label"><%= i18ns(\'password\') %></label>\n            <div>\n              <input type="password" class="form-control password" id="password">\n            </div>\n          </div>\n        </div>\n      </form>\n    </div>\n  </div>\n</div>\n<div class="n-modal-footer n-modal-footer-vcenter" style="display: none;">\n  <div class="pull-left">\n    <button class="btnBack btn">\n      <%= i18ns(\'back\') %>\n    </button>\n  </div>\n  <a class="btnAdd btn -blue"><%= i18ns(\'add\') %></a>\n</div>\n'}),define("text!templates/popups/softwareupgrade/SoftwareUpgradePopupVCenterListView.html",[],function(){return'<thead>\n  <tr>\n    <th><%= i18ns(\'vcenter_ip_address\') %></th>\n    <th class="host-ips-header"><%= i18ns(\'host_ip_address\') %></th>\n  </tr>\n</thead>\n<tbody>\n  <% _.each(credentials, function(hostIps, serverIp) { %>\n  <tr class="n-table-row">\n    <td  class="name-cell" title="<%= serverIp %>">\n      <%= serverIp %>\n    </td>\n    <td  class="name-cell host-ips-cell" title="<%= hostIps.join(\', \') %>">\n      <%= hostIps.join(\', \') %>\n    </td>\n  </tr>\n  <% }); %>\n</tbody>\n'}),define("text!templates/popups/softwareupgrade/SoftwareUpgradePopupVCenterEmptyView.html",[],function(){return'<tr>\n  <td class="n-message">\n    <p class="message">\n      <span>\n        <%= i18ns(\'havent_authenticated\') %>\n      </span>\n    </p>\n    <p class="actions">\n      <button class="btn btn-small btn-primary add-vcenter">\n        <i data-icon="H" aria-hidden="true"></i>\n        <span><%= i18ns(\'add_vcenter\') %></span>\n      </button>\n    </p>\n  </td>\n</tr>\n'}),define("views/popups/softwareupgrade/NOSSoftwareUpgradeView",["views/popups/softwareupgrade/SoftwareUpgradeView","models/softwareupgrade/NOSSoftwareUpgradeModel","models/softwareupgrade/NOSSoftwareCompatibilityModel","models/version/VersionModel","models/softwareupgrade/FileServerSoftwareUpgradeModel","models/genesis/VCenterCredentialModel","models/cluster/ClusterExternalStateModel","data/DataProperties","managers/ClusterManager","utils/AppConstants","utils/AppUtil","utils/HypervisorUtil","utils/ManagerMixin","text!templates/popups/softwareupgrade/SoftwareUpgradePopupStateVersionsView.html","text!templates/popups/softwareupgrade/SoftwareUpgradePopupVCenterView.html","text!templates/popups/softwareupgrade/SoftwareUpgradePopupVCenterFormView.html","text!templates/popups/softwareupgrade/SoftwareUpgradePopupVCenterListView.html","text!templates/popups/softwareupgrade/SoftwareUpgradePopupVCenterEmptyView.html","text!templates/popups/softwareupgrade/SoftwareUpgradePopupPreupgradeNotificationView.html"],function(e,t,n,i,s,a,o,r,l,c,d,p,u,h,m,f,v,g,E){"use strict";var T=(_.template(E),_.template(h)),C=_.template(m),S=_.template(f),A=_.template(v),b=_.template(g),y=_.template('<tr><td class="n-message loadingSpinner"></td></tr>'),I={CREDENTIALS:"creds",ESX:"esx"};return e.extend({events:_.extend({"click  .add-vcenter":"showForm","click  .btnAdd":"onAdd","click  .btnBack":"onBack","click  .delete-all-entries":"onDelete"},e.prototype.events),name:"NOSSoftwareUpgradeView",parentViewName:"SoftwareUpgradeView",cvmRebootRequired:u.getClusterManager().isOneNodeCluster(),fsReleaseModel:null,showVCenter:!1,initialize:function(){e.prototype.initialize.apply(this,arguments),this.vCenterCredentialAddModel=new a({method:c.CLUSTER_MANAGER_METHODS.SET_VCENTER_CREDENTIAL}),this.vCenterCredentialDeleteModel=new a({method:c.CLUSTER_MANAGER_METHODS.DELETE_VCENTER_CREDENTIAL}),this.vCenterCredentialListModel=new a({method:c.CLUSTER_MANAGER_METHODS.GET_VCENTER_CREDENTIAL})},canShowVCenter:function(){return!!this.showVCenter&&p.hasESX(l.getCurrentClusterId())},onBack:function(){this.clearHeader(),this.showSubview(".n-modal-body","right"),this.$(".n-modal-form-container").addClass("hidden"),this.$(".n-modal-footer").show(),this.$(".n-modal-footer-vcenter").hide()},onAdd:function(){var e=this.$(".username").val().trim(),t=this.$(".password").val(),n=this.$(".host-ip").val(),i=this;this.vCenterCredentialAddModel.setRPCParams({hostType:I.ESX,serverIp:n,username:e,password:t}),this.vCenterCredentialAddModel.fetch({success:function(){i.getVCenterCredentials(),i.onBack()},error:_.bind(this.showVCenterError,this)})},showVCenterError:function(e,t){t&&this.showHeaderError(t)},onDelete:function(e){$.nutanixConfirm({msg:this.i18ns("clear_vcenter_credentials"),yes:_.bind(this.onDeleteNow,this),yesText:this.i18n("clear_entries"),noText:this.i18n("cancel"),context:this})},onDeleteNow:function(){var e=this;this.vCenterLoading(),this.vCenterCredentialDeleteModel.setRPCParams({hostType:I.ESX}),this.vCenterCredentialDeleteModel.fetch({success:function(t){e.getVCenterCredentials()},error:_.bind(this.showVCenterError,this)})},getVCenterCredentials:function(){var e=this;this.vCenterLoading(),this.vCenterCredentialListModel.on("change",function(t){e.displayVCenterList(t)}),this.vCenterCredentialListModel.setRPCParams({mgmtServer:I.ESX}),this.vCenterCredentialListModel.fetch({error:_.bind(this.showVCenterError,this)})},vCenterLoading:function(){this.resetVCenterTable(),this.$("#vCenterCredentialList tbody").html(y(this.vtOptions({}))),d.addInLineDonutLoader("#vCenterCredentialList tbody .loadingSpinner")},resetVCenterTable:function(){this.$("#vCenterCredentialList tbody").empty(),this.$("#vCenterCredentialList thead").empty()},showForm:function(){this.clearHeader(),this.hideSubview(".n-modal-body"),this.$(".n-modal-form-container").removeClass("hidden"),this.showSubview(".n-modal-form-container","left"),this.$(".n-modal-form-container input").val(""),this.$(".n-modal-footer").hide(),this.$(".n-modal-footer-vcenter").show()},createSoftwareUpgradeModelInstance:function(){return this.fsReleaseModel=new s,this.fsReleaseModel.fetchSoftwareReleases(),new t},displayUpgradeVersions:function(){this.$(".n-state-content").html(T(this.vtOptions({softwareTypeState:this.model.softwareTypeState,overwriteCheckbox:!0,viewName:this.parentViewName})))},fetchCompatibilityMatrix:function(e,t){var s=this;if(this.compatibilityModel)return this.setSoftwareCompatibilityFlag(),void e();var a=new o;a.fetch({success:function(){var o,l=a.get(r.CLUSTER_EXTERNAL_STATE);if(!l||!l.length)return void e();o=l[0].clusterUuid;var c=new i;c.fetch({data:{proxyClusterUuid:o},success:function(){var i=c.getCurrentVersion(),a=new n({version:i});a.fetch({success:function(){s.compatibilityModel=a,s.setSoftwareCompatibilityFlag(),e()},error:t})},error:t})},error:t})},setSoftwareCompatibilityFlag:function(){if(this.compatibilityModel){var e=this.compatibilityModel.get(r.UPGRADE_COMPATIBLE_NOS_VERSIONS),t=this.model.get(r.UPGRADE_SOFTWARE_RELEASES);_.each(t.models,function(t){-1===e.indexOf(t.get(r.VERSION))&&t.set("status",c.UPGRADE_SOFTWARE_RELEASE_STATUS.INCOMPATIBLE)})}},render:function(){var t=e.prototype.render.apply(this,arguments);return this.showVCenter&&(this.displayVCenter(),this.getVCenterCredentials()),t},displayVCenterList:function(e){var t={},n=0,i=e.getReturnResponse();_.each(i,function(e,i){t[e]?t[e].push(i):t[e]=[i],n++}),n>0?(this.$("#vCenterCredentialList").html(A(this.vtOptions({credentials:t||{}}))),this.$("#vCenterCredentialList table").addClass("table-hover"),this.toggleAddVCenter(!0)):this.displayEmptyVCenter()},displayVCenter:function(){this.$(".n-vcenter-content").html(C(this.vtOptions({}))),this.$el.append(S(this.vtOptions({})))},displayEmptyVCenter:function(){this.resetVCenterTable(),this.toggleAddVCenter(!1),this.$("#vCenterCredentialList tbody").html(b(this.vtOptions({})))},toggleAddVCenter:function(e){this.$(".btnAddVCenter").toggle(e)},onCurrentVersionChange:function(){this.$(".lblCurrentVersion").html(this.model.getSoftwareTaggedCurrentVersion())},onSoftwareReleasesChange:function(){this.fsReleaseModel.subModelHelper.get(r.UPGRADE_SOFTWARE_RELEASES).getState()!==c.STATE_PENDING&&e.prototype.onSoftwareReleasesChange.apply(this)},getGlobalProgressInfo:function(e){var t="";if(this.clusterManager.isMulticlusterNavMode())t=this.i18n("upgrading_prism_central");else{var n=this.clusterManager.getTargetClusterVersion(),i=this.clusterManager.getCurrentClusterVersion();t=e.get(r.TASK_NAME),n&&""!==n&&n!==i&&(t+=this.i18ns("to_version",n))}return{title:t,subtitleEntity:this.i18n("cvms")}},onClickDownload:function(e){var t=$(e.currentTarget).attr("dataId");$.nutanixConfirm({msg:"Do you want to download "+t+"?",yes:function(){this.startDownload(t)},yesText:"Yes",noText:"No",context:this})},startDownload:function(e){var t=this.model.hasDeployedFileServers(),n=this.fsReleaseModel.getLatestCompatibleFSRelease(e);if(n){var i=0===d.compareVersions(n,this.model.getInstalledFileServerVersion());t&&!i&&(this.showHeaderInfo("We recommend upgrading File Server to "+n+" to make sure compatibility with Acropolis "+e),this.fsReleaseModel.downloadSoftwareRelease(n))}this.$('[dataId="'+e+'"]').css("opacity",.5).attr("disabled",!0),this.$('tr[dataId="'+e+'"] .loaderRow').show(),
this.model.downloadSoftwareRelease(e),this.resetUploadForm()},onStartServices:function(){e.prototype.onStartServices.apply(this,arguments),this.fsReleaseModel.on("change.softwareReleases",this.onSoftwareReleasesChange,this)},onStopServices:function(){e.prototype.onStopServices.apply(this,arguments),this.fsReleaseModel.off("change.softwareReleases",this.onSoftwareReleasesChange)}})}),define("text!templates/popups/softwareupgrade/ConfirmHypervUpgradeWarningContent.html",[],function(){return"<div data-ntnx-content-inner>\n  <section data-ntnx-section>\n    <h5 data-ntnx-title>\n        <%= i18n('please_note') %>\n    </h5>\n  </section>\n  <% _.each(warnings, function(list, key) { %>\n    <section data-ntnx-section>\n      <h5 data-ntnx-title class=\"warning-item-title\">\n        <span class=\"icon\">\n          <%= Components.icon('Circular_Exclamation',\n          ' -large -') %>\n        </span>\n        <span><%= i18n(list.itemLabel) %></span>\n      </h5>\n    </section>\n    <section>\n      <ul>\n      <% _.each(list.warnings, function(warning) { %>\n        <li>\n            <%= i18n(warning) %>\n        </li>\n      <% }) %>\n      </ul>\n    </section>\n  <% }) %>\n  <section data-ntnx-section=\"type-text\">\n    <%= i18n('upgradeConfirmMsg') %>\n  </section>\n</div>\n"}),define("views/popups/softwareupgrade/ConfirmHypervUpgradeWarningPopupView",["views/basecomponents/popups/BasePopupView","text!templates/popups/softwareupgrade/ConfirmHypervUpgradeWarningContent.html"],function(e,t){"use strict";return t=_.template(t),e.extend({name:"ConfirmHypervUpgradeWarningPopupView",el:"#popupConfirmHypervUpgradeWarning",yesCallback:null,events:{'click .close[data-dismiss="modal"]':"hide","click .btnYes":"onClickYes","click .btnNo":"hide"},initialize:function(t){if(!t.yesCallback)throw new Error("No yes callback provided!");e.prototype.initialize.apply(this,arguments),this.yesCallback=t.yesCallback,_.bindAll(this,"onClickYes")},render:function(){this.$el.html(this.defaultTemplate({antiscroll:!1,title:this.i18n("popup_title"),bodyContent:t(this.vtOptions({warnings:[{itemLabel:"general",warnings:["hyperv_re_image_warn","hyperv_scvmm_2012_warn","hyperv_vm_warn","hyperv_network_warn","hyperv_vm_no_ha_warn"]},{itemLabel:"dr",warnings:["hyperv_dm_warn"]}]})),footerButtons:this.defaultFooter([{text:this.i18ns("no"),extraClasses:"btnNo"},{isPrimary:!0,text:this.i18ns("yes"),extraClasses:"btnYes"}])}))},onClickYes:function(){this.hide(),setTimeout(this.yesCallback,0)}})}),define("text!templates/popups/softwareupgrade/HyperVAuthenticationTemplate.html",[],function(){return'<div>\n  <label class="n-popup-captcha-error"></label>\n</div>\n\n<div class="n-popup-title credentials-prompt">\n  <%= i18n(\'hyperv_auth_title\') %>\n</div>\n<div>\n  <label class="n-popup-title credentials">\n    <%= i18n(\'hyperv_domain_username\') %>\n    </label>\n  <input class="domain-username-auth credentials-input n-popup-fields"\n  type="text" placeholder="domain\\username or username@domain" value>\n</div>\n<div>\n  <label class="n-popup-title credentials">\n    <%= i18n(\'hyperv_password\') %>\n    </label>\n  <input class="domain-password-auth credentials-input n-popup-fields"\n  type="password" autocomplete="off" value>\n</div>\n<div>\n  <div class="sku-loading n-popup-title credentials" style="display:none">\n    <div class="n-inline-loading-container">\n      <div class="n-inline-loading" style="display:block" />\n    </div>\n    <div class="sku-loading-msg"><%= i18n(\'hyperv_loading_sku\') %></div>\n  </div>\n  <div class="sku-options n-popup-title credentials">\n    <p>SKU:</p>\n    <div class="sku-input">\n      \x3c!-- SKU options go here --\x3e\n    </div>\n  </div>\n</div>\n'}),define("models/genesis/SkuModel",["models/genesis/GenesisBaseModel","utils/AppConstants"],function(e,t){"use strict";return e.extend({name:"SkuModel",methodName:t.CLUSTER_MANAGER_METHODS.HYPERV_SKUS,managerName:t.GENESIS.CLUSTER_MANAGER,getErrorResponse:function(){return this.getParsedErrorResponse("Failed to fetch SKUs.")},setRPCParams:function(e){_.extend(this.kwargs,{md5sum:e})}})}),define("views/popups/softwareupgrade/HypervisorSoftwareUpgradeView",["views/popups/softwareupgrade/SoftwareUpgradeView","views/popups/softwareupgrade/ConfirmHypervUpgradeWarningPopupView","models/softwareupgrade/HypervisorSoftwareUpgradeModel","models/genesis/LaJollaClusterModel","text!templates/popups/softwareupgrade/SoftwareUpgradePopupStateVersionsView.html","text!templates/popups/softwareupgrade/HypervisorAuthenticationTemplate.html","text!templates/popups/softwareupgrade/HyperVAuthenticationTemplate.html","text!templates/popups/lcm/PopoverGPUList.html","data/DataProperties","data/DataURLConstants","managers/I18nManager","utils/HypervisorUtil","utils/AppConstants","utils/AppUtil","models/genesis/SkuModel","utils/ManagerMixin"],function(e,t,n,i,s,a,o,r,l,c,d,p,u,h,m,f){"use strict";var v=_.template(a),g=_.template(s),E=_.template("<p><span><%=version%></span>&nbsp;<span><%=numhosts%></span></p>"),T=_.template('<div class="md5UploadSection"><p class="upload-md5-disclaimer alert-info">Uploading without metadata file from the Nutanix Support portal allows you to upgrade to a version not yet qualified by Nutanix. Nutanix strongly recommends upgrading the cluster to a qualified release by using the metadata file downloaded from the Nutanix portal. Please refer to <a href="<%= hypervisorSupportPolicyUrl %>">Nutanix KB3123</a> for the Hypervisor Support Policy.</p><div class="control-group"><label class="control-label" for="inputMD5"><%= softwareTypeState %> MD5 Checksum</label><div class="controls"><input type="text" class="inputMD5 input-md5" name="md5" /></div></div><p class="uploadMetadataDescription n-upload-toggle">Or <a class="linkUploadMetadata">upload metadata file</a></p></div>'),C=_.template("<div>\n        <%= Components.select({\n          id: \"hypervSku\",\n          options: skuOptions,\n          jsClasses: 'hyperv-sku n-popup-fields',\n          variants: 'bottom-anchor'\n        }) %>\n      </div>"),S={free:"Free",standard:"Standard",standard_gui:"Standard GUI",datacenter:"Datacenter",datacenter_gui:"Datacenter GUI"},A=[{name:"Standard",value:"standard"},{name:"Standard GUI",value:"standard_gui"},{name:"Datacenter",value:"datacenter"},{name:"Datacenter GUI",value:"datacenter_gui"}],b=_.template(o),y=_.template(r);return e.extend({name:"HypervisorSoftwareUpgradeView",parentViewName:"SoftwareUpgradeView",cvmRebootRequired:f.getClusterManager().isOneNodeCluster(),initialize:function(t){e.prototype.initialize.apply(this,arguments),this.addExtraEvents({"click  .linkUploadMD5":"onClickLinkUploadMD5","click  .linkUploadMetadata":"onClickLinkUploadMetatdata","change .inputFile":"onInputFileChange"})},getGlobalProgressInfo:function(e){return{title:e.get(l.TASK_NAME),subtitleEntity:this.i18n("hosts")}},render:function(){return e.prototype.render.apply(this,arguments),p.hasESX()&&this.showHeaderInfo(this.i18n("releaseNotes")),this},createSoftwareUpgradeModelInstance:function(){return new n},displayUpgradeVersions:function(){this.$(".n-state-content").html(g(this.vtOptions({overwriteCheckbox:!0,softwareTypeState:this.model.softwareTypeState,viewName:this.parentViewName})))},onClickLinkUpload:function(e){this.showUploadForm();var t="";p.hasESX()?(t=this.i18n("zipFile"),this.$(".software-filetype-example").html(t)):t=this.i18n("isoFile"),p.hasESX()&&0===this.$(".n-upload-toggle").length&&this.$(".metadataUploadSection").append('<p class="uploadMd5Description n-upload-toggle">Or <a class="linkUploadMD5">enter md5 checksum</a></p>')},onClickLinkUploadMD5:function(){this.$(".formUpload").prepend(T({softwareTypeState:this.model.softwareTypeState,hypervisorSupportPolicyUrl:c.HYPERV_SUPPORT_POLICY})),this.$(".metadataUploadSection").hide(),this.$(".btnUploadNow").addClass("uploadMD5Now")},onClickLinkUploadMetatdata:function(e){this.$(".md5UploadSection").remove(),this.$(".metadataUploadSection").show(),this.$(".btnUploadNow").removeClass("uploadMD5Now")},onInputFileChange:function(e){if((h.isIEBrowser()||h.isEdgeBrowser())&&!h.isFileSizeSupported(e.currentTarget)){var t=h.isEdgeBrowser()?u.BROWSER_EDGE:u.BROWSER_IE;this.showHeaderWarning(this.i18ns("ie_filesize_warning",t))}},startUpload:function(){this.disableUploadForm(),this.$(".btnUploadNow").hasClass("uploadMD5Now")?this.model.uploadSoftwareReleaseWithMD5(this.$(".formUpload")):this.model.uploadSoftwareRelease(this.$(".formUpload"))},onCurrentVersionChange:function(){var e=this,t=!1,n=f.getClusterManager().getCurrentClusterModel();if(n){if(p.hasHyperV(n.get(l.CLUSTER_UUID))){var s=new i;s.fetch({success:function(n,i){!0===s.getReturnResponse()&&(t=!0,e.updateVersion(t))}})}}e.updateVersion(t)},confirmUpgrade:function(e,t,n,i,s){var a=this,o=this.model.getSoftwareRelease(e);if(!o)throw new Error("Software release, "+e+", does not exist.");var r=o.get(l.UPGRADE_VERSION);r||h.log("Version ID of the hypervisor software release, "+e+", does not exist.");var c="";r||o.get(l.UPGRADE_NAME)?c=h.sprintf(this.UPGRADE_CONFIRM,r):(c=this.i18ns("want_to_upgrade"),c+=d.t("SoftwareUpgradeView","upgrade_warning_msg")),n&&(c+=this.NO_CHECK_WARNING),i&&!n&&(c=this.i18ns("run_pre_upgrade_tests"));this.checkGpuBeforeUpgrade(c,function(e,l,c){a.confirmDialog({versionId:r,isManualUpgrade:t,isIgnorePreupgradeTests:n,isIgnoreUpgrade:i,msg:e,isRetryUpgrade:!1,softwareModel:o,leftAlign:l,gpuVmCollection:c,md5sum:s})})},confirmDialog:function(e){var t="",n=!1,i=!1,s=!1,a=e.softwareModel;this.model.isVCenterUsed()&&a.get(l.HYPERVISOR_TYPE)===u.SOFTWARE_RELEASES_HYP_TYPE.ESXI?(t=v(this.vtOptions({serverDetails:"vCenter IP Address:",hyperV:!1})),n=!0):this.model.isSCVMMUsed()&&a.get(l.HYPERVISOR_TYPE)===u.SOFTWARE_RELEASES_HYP_TYPE.HYPERV&&(t=b(this.vtOptions()),n=!0,i=!0,s=!0),$.nutanixConfirm({class:e.leftAlign?"-left-align":"",msg:e.msg,yes:function(){var t=this;this.platformStateChecks(function(){e.username=null,e.password=null,e.hostDetails=null,n&&!i?(e.username=$("#nutanixConfirmModal .username-auth").val().trim(),e.password=$("#nutanixConfirmModal .password-auth").val().trim(),e.hostDetails=$("#nutanixConfirmModal .host-details").val().trim()):n&&i&&_.extend(e,t._getHyperVCredetianlsFromForm()),n&&i&&!e.isIgnoreUpgrade?t._reconfirmHyperVUpgrade(e):t._performPlatformCheckAndUpgrade(e)})},yesText:this.i18ns("yes"),noText:this.i18ns("no"),extHTML:t,captcha:function(){if(n&&!i){var e=$("#nutanixConfirmModal .username-auth").val().trim(),t=$("#nutanixConfirmModal .password-auth").val().trim(),s=$("#nutanixConfirmModal .host-details").val().trim();return _.isEmpty(e)||_.isEmpty(t)||_.isEmpty(s)?($("#nutanixConfirmModal .n-popup-captcha-error").html(this.i18ns("all_fields_required")).show(),!1):!!h.isValidDomainName(s)||($("#nutanixConfirmModal .n-popup-captcha-error").html(this.i18ns("vcener_invalid_ip")).show(),!1)}if(n&&i){var a=this._getHyperVCredetianlsFromForm(),o=[];return(_.isEmpty(a.domainUsername)||_.isEmpty(a.domainPassword)||_.isEmpty(a.hypervSku))&&o.push(this.i18ns("all_fields_required")),this.isValidDomainUserNameFormat(a.domainUsername)||o.push(this.i18n("invalid_domain_username_format")),!o.length||($("#nutanixConfirmModal .n-popup-captcha-error").html(o.join("<br/>")).show(),!1)}return!0},context:this}),s&&this.fetchSKUs(a.get(l.UPGRADE_MD5SUM));var o=this,r=o._formatGpuVmInfo(e.gpuVmCollection.models);$(".gpu-vm-msg").popover({title:o.i18n("vm_to_be_powered_off"),placement:"left",trigger:"hover",html:!0,container:$("body"),content:function(){return o._getGPUVMPopoverContent(r)}})},_formatGpuVmInfo:function(e){var t=[];return _.each(e,function(e,n){t[n]={},t[n].vm_name=e.get(l.EB.VM.VM_NAME),t[n].node_name=e.get(l.EB.VM.NODE_NAME)}),t},_getGPUVMPopoverContent:function(e){e=_.sortBy(e,function(e){return e[l.EB.VM.VM_NAME]});var t=y(this.vtOptions({vmLabel:h.getSingularEntityName(u.ENTITY_VM),nodeLabel:h.getSingularEntityName(u.ENTITY_NODE),vms:_.first(e,6)}));if(e.length>6){var n=e.length-6;t+="<section>"+this.i18ns("and_num_other",n)+" "+h.pluralize(this.name," ",this.i18n("vms"),this.i18n("vm"),this.i18n("vms"),n)+"</section>"}return t},startUpgrade:function(e){var t=this;this.setLastUpgradeWarningTime(),e.isRetryUpgrade?this.model.retryUpgrade(e.username,e.password,e.hostDetails):(this.$(".btn-control").css("opacity",.5).attr("disabled",!0),e.successCallback=e.errorCallback=function(){t.$(".btn-control").css("opacity",1).removeAttr("disabled")},this.model.startUpgrade(e))},onClickRetryUpgradeButton:function(){var e=this.i18ns("retry_upgrade");this.confirmDialog({versionId:null,isManualUpgrade:!1,isIgnorePreupgradeTests:!1,isIgnoreUpgrade:!1,msg:e,isRetryUpgrade:!0})},updateVersion:function(e){var t=this.model.getSoftwareCurrentVersion(),n="",i=this;t&&t.length&&_.each(t,function(s){var a="";t.length>1&&(a=1===s[1]?i.i18ns("versionOnHost",s[1]):i.i18ns("versionOnHosts",s[1])),n+=E({version:!0===e?s[0]+" (CPS)":s[0],numhosts:1===t.length?"":a})},t),this.$(".lblCurrentVersion").html(n)},_reconfirmHyperVUpgrade:function(e){var n=this;new t({el:h.createPopupContainer("popupConfirmHypervUpgradeWarning"),yesCallback:function(){n._performPlatformCheckAndUpgrade(e)}}).show()},_performPlatformCheckAndUpgrade:function(e){this.model.stopPollingSoftwareReleases(),this.startUpgrade(e)},fetchSKUs:function(e){var t=this;if(!e)return this.renderSKUOptions();var n=new m;n.setRPCParams(e),this.showSKULoading(),n.fetch({success:function(e){var n=e.getParsedReturnResponse();t.renderSKUOptions(n)},error:function(e,n){var i=n||"";h.log(i);var s=t.i18ns("sku_fetch_error");s+=i,t.triggerAction(u.MODAL.ACT.ALERT_SHOW,{type:u.MODAL.ALERT.TYPE_ERROR,message:s}),t.isError=!0,t.renderSKUOptions()}})},showSKULoading:function(){$(".sku-loading").show(),$(".sku-options").hide()},renderSKUOptions:function(e){e=e&&e.length?_.map(e,function(e,t){var n="";return h.isInt(t)&&(t=e,n=S[t]||t),{name:n,value:e}}):A;var t=this.vtOptions(),n=t.Components;$(".sku-input").html(C({Components:n,skuOptions:e})),$(".sku-loading").hide(),$(".sku-options").show()},_getHyperVCredetianlsFromForm:function(){return{domainUsername:$("#nutanixConfirmModal .domain-username-auth").val().trim(),domainPassword:$("#nutanixConfirmModal .domain-password-auth").val().trim(),hypervSku:$("#hypervSku").val().trim()}},isValidDomainUserNameFormat:function(e){var t=e.split("@").filter(Boolean),n=e.split("\\").filter(Boolean);return 2===t.length||2===n.length}})}),define("models/genesis/NCCUpgradeModel",["models/genesis/GenesisBaseModel","utils/AppConstants"],function(e,t){"use strict";return e.extend({name:"NCCUpgradeModel",methodName:t.CLUSTER_MANAGER_METHODS.NCC_UPGRADE,managerName:t.GENESIS.CLUSTER_MANAGER,setRPCParams:function(e){_.extend(this.kwargs,{ncc_version:e})},getErrorResponse:function(){var t=e.prototype.getErrorResponse.apply(this,arguments);if(t)return t;var n=this.getReturnResponse();return!1===n[0]?n[1]?n[1]:"Failed to upgrade.":void 0}})}),define("models/softwareupgrade/NCCSoftwareUpgradeModel",["models/softwareupgrade/SoftwareUpgradeModel","models/version/VersionModel","models/genesis/NCCUpgradeModel","data/DataProperties","utils/AppConstants","utils/AppUtil"],function(e,t,n,i,s,a){"use strict";return e.extend({name:"NCCSoftwareUpgradeModel",softwareTypeState:s.UPGRADE_SOFTWARE_TYPE_STATE.NCC,isValidateMetadataBeforeUpload:!0,getSoftwareType:function(e){return s.UPGRADE_SOFTWARE_TYPE.NCC},createVersionModelInstance:function(){return new t},getSoftwareCurrentVersion:function(){var e=this.get(i.UPGRADE_VERSION_MODEL);if(e)return e.getNCCVersion()},startUpgrade:function(e){var t=this;a.log("NCCSoftwareUpgradeModel: Start NCC upgrade  | Version ID: "+e.versionId+" | isManualUpgrade: "+e.isManualUpgrade+" | isIgnorePreupgradeTests: "+e.isIgnorePreupgradeTests),this.set({versionIdToUpgrade:e.versionId,isManualUpgrade:e.isManualUpgrade,isIgnorePreupgrade:e.isIgnorePreupgradeTests,isIgnoreUpgrade:e.isIgnoreUpgrade},{silent:!0});var s=new n;s.setRPCParams(e.versionId),s.fetch({success:function(){a.log("NCCSoftwareUpgradeModel : Successfully started upgrade"),e.successCallback&&e.successCallback(),t.stopStateChange=!0,t.setProperty(i.UPGRADE_SOFTWARE_UPGRADING,t.getSoftwareType()),t.setProperty(i.UPGRADE_STATE,t.STATE_UPGRADING),t.fetchUpgradeState()},error:function(n,i){a.log("NCCSoftwareUpgradeModel : Error : "+i),e.errorCallback&&e.errorCallback(),t.trigger("error",i)}})}})}),define("views/popups/softwareupgrade/NCCSoftwareUpgradeView",["views/popups/softwareupgrade/SoftwareUpgradeView","models/softwareupgrade/NCCSoftwareUpgradeModel","managers/I18nManager"],function(e,t,n){"use strict";return e.extend({name:"NCCSoftwareUpgradeView",UPGRADE_CONFIRM:n.t("SoftwareUpgradeView","upgrade_confirm_msg"),createSoftwareUpgradeModelInstance:function(){return new t},setLastUpgradeWarningTime:function(){}})}),define("models/genesis/FoundationVersionModel",["models/genesis/GenesisBaseModel","utils/AppConstants"],function(e,t){"use strict";return e.extend({name:"FoundationVersionModel",methodName:t.NODE_MANAGER_METHODS.GET_FOUNDATION_VERSION,managerName:t.GENESIS.NODE_MANAGER,getReturnResponse:function(){return this.get(e.DP.GENESIS_RETURN)||" "},getCurrentVersion:function(){return this.getReturnResponse()}})}),define("models/genesis/FoundationUpgradeModel",["models/genesis/GenesisBaseModel","utils/AppConstants"],function(e,t){"use strict";return e.extend({name:"FoundationUpgradeModel",methodName:t.CLUSTER_MANAGER_METHODS.FOUNDATION_UPGRADE,managerName:t.GENESIS.CLUSTER_MANAGER,setRPCParams:function(e,t,n){_.isUndefined(t)&&(t=!1),_.isUndefined(n)&&(n=!1),_.extend(this.kwargs,{md5sum:e,skip_upgrade:n,ignore_preupgrade_tests:t})},getErrorResponse:function(){var t=e.prototype.getErrorResponse.apply(this,arguments);if(t)return t;var n=this.getReturnResponse();return!1===n[0]?n[1]?n[1]:"Failed to upgrade.":void 0}})}),define("models/softwareupgrade/FoundationSoftwareUpgradeModel",["models/softwareupgrade/SoftwareUpgradeModel","models/genesis/FoundationVersionModel","models/genesis/FoundationUpgradeModel","data/DataProperties","utils/AppConstants","utils/AppUtil"],function(e,t,n,i,s,a){"use strict";return e.extend({name:"FoundationSoftwareUpgradeModel",softwareTypeState:s.UPGRADE_SOFTWARE_TYPE_STATE.FOUNDATION,getSoftwareType:function(e){return s.UPGRADE_SOFTWARE_TYPE.FOUNDATION},createVersionModelInstance:function(){return new t},fetchCurrentVersion:function(){var e=this.subModelHelper.get(i.UPGRADE_VERSION_MODEL),t=this;e&&e.fetch({success:function(e){t.setProperty(i.UPGRADE_VERSION_MODEL,e)},error:function(e,t){a.log("FoundationSoftwareUpgradeModel: Current version could not be fetched.")}})},getSoftwareCurrentVersion:function(){var e=this.get(i.UPGRADE_VERSION_MODEL);if(e)return e.getCurrentVersion()},validateUploadForm:function(e){var t="";return 0===e.find(".inputFile").val().trim().length&&(t+="Please select the "+this.softwareTypeState+" binary file. "),$.trim(t)},isParallelOperationRunning:function(){var e=this.localTaskManager.getGlobalTasks().getExpandClusterTask();return this.getSoftwareType()===s.UPGRADE_SOFTWARE_TYPE.FOUNDATION&&e&&(e.isStatusActive()||e.isStatusQueued())},uploadSoftwareRelease:function(e){var t=this.validateUploadForm(e,!0);if(t.length)return this.trigger("error",t),void this.setProperty(i.UPGRADE_STATE_UPLOAD,this.STATE_UPLOAD_READY);a.log("SoftwareUpgradeModel : Start uploading the files...\n "+this.softwareTypeState+" File: "+e.find(".inputFile").val()),this.setProperty(i.UPGRADE_STATE_UPLOAD,this.STATE_UPLOAD_INPROGRESS),this.uploadNutanixBinaryFile(e)},uploadNutanixBinaryFile:function(e){a.log("SoftwareUpgradeModel : Upload foundation tar file via HTML5 browser.");var t=this.validateUploadForm(e,!1);if(t.length)return this.trigger("error",t),void this.setProperty(i.UPGRADE_STATE_UPLOAD,this.STATE_UPLOAD_READY);this.softwareMetadata=null,this.startFileUpload(e),this.fetchSoftwareReleases({force:!0})},startFileUpload:function(e){var t,n,i,s,o,r=e.find(".inputFile")[0],l=this,c=r.files[0];c&&(t=e.find(".inputFileSize").val().trim(),o=e.find(".overwrite").is(":checked"),i=e.find(".inputName").val().trim(),n=e.find(".inputOffset").val().trim(),s=e.find(".inputVersion").val().trim(),t=t.length>0?t:c.size,i=i.length>0?i:c.name,a.calculateFileMD5Async(c,{},function(a){e.find(".inputMD5Sum").val(a),l._startUploadFile(t,a,o,i,n,s,c)}))},retryUpgrade:function(){var e=this.getPreupgradeTaskModel();if(e&&e.isStatusFailed()){var t=this.get(i.UPGRADE_VERSION_ID),n=this.get(i.UPGRADE_TO_MD5SUM),s=this.get(i.UPGRADE_IGNORE_UPGRADE),o=this.get(i.UPGRADE_MANUAL_UPGRADE),r=this.get(i.UPGRADE_IGNORE_PREUPGRADE);n?this.startUpgrade({versionId:t,md5Sum:n,isManualUpgrade:o,isIgnorePreupgradeTests:r,ignoreUpgrade:s}):a.log("SoftwareUpgradeModel: md5Sum of the software to upgrade to is not found.")}else a.log("SoftwareUpgradeModel : You can only retry upgrade if it is in preupgrade check mode that is in failed state.")},startUpgrade:function(e){var t=this;a.log("FoundationSoftwareUpgradeModel: Start Foundation upgrade  | Version ID: "+e.versionId+" | isManualUpgrade: "+e.isManualUpgrade),this.set({isManualUpgrade:e.isManualUpgrade,isIgnoreUpgrade:e.isIgnoreUpgrade,isIgnorePreupgrade:e.isIgnorePreupgradeTests,upgradeToMd5sum:e.md5Sum},{silent:!0});var s=new n;s.setRPCParams(e.md5Sum,e.isIgnorePreupgradeTests,e.isIgnoreUpgrade),s.fetch({success:function(){a.log("FoundationUpgradeModel : Successfully started upgrade"),e.successCallback&&e.successCallback(),t.stopStateChange=!0,t.setProperty(i.UPGRADE_SOFTWARE_UPGRADING,t.getSoftwareType()),t.setProperty(i.UPGRADE_STATE,t.STATE_UPGRADING),t.fetchUpgradeState()},error:function(n,i){a.log("FoundationUpgradeModel : Error : "+i),e.errorCallback&&e.errorCallback(),t.trigger("error",i)}})}})}),define("views/popups/softwareupgrade/FoundationSoftwareUpgradeView",["views/popups/softwareupgrade/SoftwareUpgradeView","models/softwareupgrade/FoundationSoftwareUpgradeModel","data/DataProperties","managers/ClusterManager","managers/I18nManager"],function(e,t,n,i,s){"use strict";var a=_.template('<div class="n-message-row">Expand cluster operation is in progress. Please wait for it to be completed.</div>');return e.extend({name:"FoundationSoftwareUpgradeView",UPGRADE_CONFIRM:s.t("SoftwareUpgradeView","upgrade_confirm_msg"),createSoftwareUpgradeModelInstance:function(){return new t},getParallelOpNoShowTemplate:function(){return a()},startUpgrade:function(e){var t=this,i=this.$(".btnUpgrade["+n.UPGRADE_DATA_ID+'\n                       *="'+e.versionName+'"]').attr(n.UPGRADE_DATA_CHECK);_.extend(e,{md5Sum:i}),e.isRetryUpgrade?this.model.retryUpgrade():(this.disableRowElements(),e.successCallback=e.errorCallback=function(){t.enableRowElements()},this.model.startUpgrade(e))},confirmUpgrade:function(e,t,s,a){var o=this.model.getSoftwareRelease(e);if(!o)throw new Error("Software release, "+e+", does not exist.");var r=o.get(n.UPGRADE_NAME),l="Do you want to upgrade to "+r+"?";s&&!i.isMulticlusterNavMode()&&(l+=this.NO_CHECK_WARNING),a&&!s&&(l="Do you want to run pre-upgrade tests only?"),this.confirmDialog({versionId:null,versionName:r,isManualUpgrade:t,isIgnorePreupgradeTests:s,isIgnoreUpgrade:a,msg:l,isRetryUpgrade:!1})}})}),define("models/docker/DockerUpgradeModel",["models/BaseModel","data/DataURLConstants","data/DataManager"],function(e,t,n){"use strict";var i={VERSION:"version",MD5SUM:"md5",IGNORE_PREUPGRADE_CHECKS:"ignore_preupgrade_checks",SKIP_UPDATE:"skip_update"};return e.extend({DP:i,showError:!0,urlRoot:t.DOCKER_UPGRADE_URL,name:"DockerUpgradeModel",getDataSourceURL:function(){return n.getV2DataSourceURL()},toJSON:function(){var e={};return e[i.VERSION]=this.get(i.VERSION),e[i.IGNORE_PREUPGRADE_CHECKS]=this.get(i.IGNORE_PREUPGRADE_CHECKS),e[i.SKIP_UPDATE]=this.get(i.SKIP_UPDATE),e[i.MD5SUM]=this.get(i.MD5SUM),e}})}),define("models/softwareupgrade/DockerSoftwareUpgradeModel",["models/softwareupgrade/SoftwareUpgradeModel","models/docker/DockerCollection","models/docker/DockerUpgradeModel","models/docker/DockerModel","data/DataProperties","utils/AppConstants","utils/AppUtil"],function(e,t,n,i,s,a,o){"use strict";return e.extend({name:"DockerSoftwareUpgradeModel",softwareTypeState:a.UPGRADE_SOFTWARE_TYPE_STATE.DOCKER,getSoftwareType:function(e){return a.UPGRADE_SOFTWARE_TYPE.DOCKER},createVersionModelInstance:function(){return new t},fetchCurrentVersion:function(){var e=this.subModelHelper.get(s.UPGRADE_VERSION_MODEL),t=this;e&&e.fetch({success:function(e){t.setProperty(s.UPGRADE_VERSION_MODEL,e)},error:function(e,t){o.log("DockerSoftwareUpgradeModel: Current version could not be fetched.")}})},getSoftwareCurrentVersion:function(){var e=this.getVersionCollectionValues(i.DP.VERSION,"");return _.isEmpty(e)&&(e=this.i18n("not_installed","Not installed")),e},getEnabledState:function(){return this.getVersionCollectionValues(i.DP.STATE,"")===i.DP.ENABLED},getBusyReason:function(){return this.getVersionCollectionValues(i.DP.BUSY_REASON,"")},getVersionCollectionValues:function(e,t){t=t||",";var n=this.subModelHelper.get(s.UPGRADE_VERSION_MODEL);if(n){return n.chain().map(function(t){return t.get(e)}).filter(function(e){return e}).value().join(t)}return""},isParallelOperationRunning:function(){var e=this.localTaskManager.getGlobalTasks().getExpandClusterTask();return this.getSoftwareType()===a.UPGRADE_SOFTWARE_TYPE.DOCKER&&e&&(e.isStatusActive()||e.isStatusQueued())},retryUpgrade:function(){var e=this.getPreupgradeTaskModel();if(e&&e.isStatusFailed()){var t=this.get(s.UPGRADE_VERSION_ID),n=this.get(s.UPGRADE_TO_MD5SUM),i=this.get(s.UPGRADE_IGNORE_UPGRADE),a=this.get(s.UPGRADE_MANUAL_UPGRADE),r=this.get(s.UPGRADE_IGNORE_PREUPGRADE);n?this.startUpgrade({versionId:t,md5Sum:n,isManualUpgrade:a,isIgnorePreupgradeTests:r,ignoreUpgrade:i}):o.log("DockerSoftwareUpgradeModel: md5Sum of the software to upgrade to is not found.")}else o.log("DockerSoftwareUpgradeModel : You can only retry upgrade if it is in preupgrade check mode that is in failed state.")},startUpgrade:function(e){var t=this;o.log("DockerSoftwareUpgradeModel: Start Docker upgrade  | Version ID: "+e.versionId+" | isManualUpgrade: "+e.isManualUpgrade),this.set({isManualUpgrade:e.isManualUpgrade,isIgnoreUpgrade:e.isIgnoreUpgrade,isIgnorePreupgrade:e.isIgnorePreupgradeTests,upgradeToMd5sum:e.md5Sum},{silent:!0});var i=new n;i.set(i.DP.MD5SUM,e.md5Sum),i.set(i.DP.VERSION,e.versionId),i.set(i.DP.SKIP_UPDATE,e.isIgnoreUpgrade),i.set(i.DP.IGNORE_PREUPGRADE_CHECKS,e.isIgnorePreupgradeTests),i.save({success:function(){o.log("DockerUpgradeModel : Successfully started upgrade"),e.successCallback&&e.successCallback(),t.stopStateChange=!0,t.setProperty(s.UPGRADE_SOFTWARE_UPGRADING,t.getSoftwareType()),t.setProperty(s.UPGRADE_STATE,t.STATE_UPGRADING),t.fetchUpgradeState()},error:function(n,i){o.log("DockerUpgradeModel : Error : "+i),e.errorCallback&&e.errorCallback(),t.trigger("error",i)}})}})}),define("models/docker/DockerEnableModel",["models/BaseModel","utils/AppConstants","data/DataURLConstants","data/DataManager"],function(e,t,n,i){"use strict";return e.extend({urlRoot:n.DOCKER_ENABLE_URL,name:"DockerEnableModel",getLatencyMessage:function(){return this.i18ns("enabling_container")},getNotificationMessage:function(e,n){if(e===t.ACTION_CREATE)return n===t.NOTIFY_SUCCESS?this.i18ns("enable_container"):this.i18ns("failed_enable_container")},getDataSourceURL:function(){return i.getV2DataSourceURL()}})}),define("models/docker/DockerDisableModel",["models/BaseModel","utils/AppConstants","data/DataURLConstants","data/DataManager"],function(e,t,n,i){"use strict";return e.extend({urlRoot:n.DOCKER_DISABLE_URL,name:"DockerDisableModel",getLatencyMessage:function(){return this.i18ns("disabling_container")},getNotificationMessage:function(e,n){if(e===t.ACTION_CREATE){return n===t.NOTIFY_SUCCESS?this.i18ns("disable_container"):this.i18ns("failed_disable_container")}},getDataSourceURL:function(){return i.getV2DataSourceURL()}})}),define("views/popups/softwareupgrade/DockerSoftwareUpgradeView",["views/popups/softwareupgrade/SoftwareUpgradeView","models/softwareupgrade/DockerSoftwareUpgradeModel","models/docker/DockerEnableModel","models/docker/DockerDisableModel","models/docker/DockerModel","data/DataProperties","managers/ClusterManager","utils/AppConstants"],function(e,t,n,i,s,a,o,r){"use strict";var l=_.template('<div class="n-enable-container"><input type="checkbox" name="enable-container"class="checkbox-container formControl" disabled><label for="enable-container"><%= i18n("enable_container", "Enable Container")%></label></div>'),c={BUSY_STATUS:[r.UPGRADE_SOFTWARE_RELEASE_STATUS.INPROGRESS,r.UPGRADE_SOFTWARE_RELEASE_STATUS.QUEUED]};return e.extend({name:"DockerSoftwareUpgradeView",createSoftwareUpgradeModelInstance:function(){return new t},render:function(){var t=e.prototype.render.apply(this,arguments);return this.$(".n-modal-content").append(l(this.vtOptions())),this.$('.n-enable-container input[type="checkbox"]').on("click",this.onEnableContainer),t},onCurrentVersionChange:function(){e.prototype.onCurrentVersionChange.apply(this,arguments),this.$('.n-enable-container input[type="checkbox"]').prop("checked",this.model.getEnabledState())},onEnableContainer:function(e){($(this).prop("checked")?new n:new i).save()},onSoftwareReleasesChange:function(){e.prototype.onSoftwareReleasesChange.apply(this,arguments),this._updateEnabledState()},isUpgrade:function(){return this.model.getVersionCollectionValues(s.DP.VERSION,"").length>0},_updateEnabledState:function(){var e=!1,t=this.$('.n-enable-container input[type="checkbox"]'),n=this.model.get(a.UPGRADE_SOFTWARE_RELEASES),i=n.toJSON();this.model.getVersionCollectionValues(s.DP.VERSION,"").length<=0?e=!0:_.some(i,function(t){if(-1!==c.BUSY_STATUS.indexOf(t.status))return e=!0,!0});var o=this.model.getBusyReason();o?(e=!0,t.attr(r.FORM_ATTR.TITLE,o)):t.removeAttr(r.FORM_ATTR.TITLE),e?t.attr(r.FORM_ATTR.DISABLED,!0):t.removeAttr(r.FORM_ATTR.DISABLED)},startUpgrade:function(e){var t=this;this.$(".btnUpgrade").attr("dataCheck");e.isRetryUpgrade?this.model.retryUpgrade():(this.disableRowElements(),e.successCallback=e.errorCallback=function(){t.enableRowElements()},this.model.startUpgrade(e))},confirmUpgrade:function(e,t,n,i){var s=this.model.getSoftwareRelease(e),r=e;if(!s)throw new Error(this.i18ns("does_not_exists",e));var l=s.get(a.UPGRADE_NAME),c=this.i18ns("want_to_upgrade",l);n&&!o.isMulticlusterNavMode()&&(c+=this.NO_CHECK_WARNING),i&&!n&&(c=this.i18n("pre_upgrade_only","Do you want to run pre-upgrade tests only?")),this.confirmDialog({versionId:r,isManualUpgrade:t,isIgnorePreupgradeTests:n,isIgnoreUpgrade:i,msg:c,isRetryUpgrade:!1})}})}),define("models/genesis/FirmwareUpgradeModel",["models/genesis/GenesisBaseModel","utils/AppConstants"],function(e,t){"use strict";return e.extend({name:"FirmwareUpgradeModel",methodName:t.CLUSTER_MANAGER_METHODS.FIRMWARE_UPGRADE,managerName:t.GENESIS.CLUSTER_MANAGER,setRPCParams:function(e){void 0===e.isIgnorePreupgradeTests&&(e.isIgnorePreupgradeTests=!1),void 0===e.isIgnoreUpgrade&&(e.isIgnoreUpgrade=!1);var t=e.isIgnorePreupgradeTests;_.extend(this.kwargs,{md5sum:e.versionChecksum,model_list:e.softwareReleaseFWGrpModel,ignore_firmware_preupgrade_tests:t,skip_upgrade:e.isIgnoreUpgrade}),void 0!==e.username&&_.extend(this.kwargs,{username:e.username}),void 0!==e.password&&_.extend(this.kwargs,{password:e.password}),void 0!==e.hostDetails&&_.extend(this.kwargs,{host_ip:e.hostDetails})},getErrorResponse:function(){var t=e.prototype.getErrorResponse.apply(this,arguments);if(t)return t;var n=this.getReturnResponse();return Array.isArray(n)&&!1===n[0]?n[1]?n[1]:"Failed to initiate firmware upgrade.":!1===n?"Failed to initiate firmware upgrade due to missing md5sum file":void 0}})}),define("models/softwareupgrade/FirmwareSoftwareUpgradeModel",["models/softwareupgrade/SoftwareUpgradeModel","models/genesis/FirmwareUpgradeModel","data/DataProperties","utils/AppConstants","utils/AppUtil"],function(e,t,n,i,s){"use strict";var a={
FIRMWARE_GRP_DISPLAYED:"firmwareGroupDisplayed",NEW_VERSIONS_AVAIL:"newVersionsAvailable"};return e.extend({name:"FirmwareSoftwareUpgradeModel",softwareTypeState:i.UPGRADE_SOFTWARE_TYPE_STATE.FIRMWARE,DP:a,defaults:{selectedFirmwareType:i.UPGRADE_SOFTWARE_TYPE.FIRMWARE_DISK,selectedFirmwareUpgradeVersion:null,disableSelectionOptions:!1},_onResetSubModel:function(t){e.prototype._onResetSubModel.apply(this,arguments),"DiskCollection"===t.name?this.setProperty(n.UPGRADE_VERSION_MODEL,t):"HostCollection"===t.name&&this.setProperty(n.UPGRADE_VERSION_MODEL,t)},fetchCurrentVersion:function(e){var t=this.subModelHelper.get(n.UPGRADE_VERSION_MODEL);t&&t.fetch({success:function(t,n,i){e&&"function"==typeof e&&e()},error:function(e,t,n){s.log("FirmwareSoftwareUpgradeModel : Error in fetching the latest version. "+t)}})},isSingleMetadataFileUpload:function(){return!0},makeFirmwareMap:function(){},collectDiskInformation:function(){},isUploadedVersionCompatible:function(e){},showSoftwareIncompatibleError:function(){},getSelectedFirmwareType:function(){return this.get("selectedFirmwareType")},setSelectedFirmwareType:function(e){this.setProperty("selectedFirmwareType",e)},startUpgrade:function(e){var i=this;s.log("FirmwareSoftwareUpgradeModel: Start upgrade  | Version ID: "+e.versionId+" | Version Checksum: "+e.versionChecksum+" | isManualUpgrade: "+e.isManualUpgrade+" | isIgnorePreupgradeTests: "+e.isIgnorePreupgradeTests),this.set({versionIdToUpgrade:e.versionId,diskGroupModel:e.softwareReleaseFWGrpModel,versionChecksumToUpgrade:e.versionChecksum,isManualUpgrade:e.isManualUpgrade,isIgnorePreupgrade:e.isIgnorePreupgradeTests,isIgnoreUpgrade:e.isIgnoreUpgrade},{silent:!0});var a=new t;a.setRPCParams(e),a.save({success:function(){s.log("FirmwareSoftwareUpgradeModel : Successfully started upgrade"),e.successCallback&&e.successCallback(),i.stopStateChange=!0,i.setProperty(n.UPGRADE_SOFTWARE_UPGRADING,i.getSoftwareType()),i.setProperty(n.UPGRADE_STATE,i.STATE_UPGRADING),i.fetchUpgradeState()},error:function(t,n){s.log("SoftwareUpgradeModel : Error : "+n),e.errorCallback&&e.errorCallback(),i.trigger("error",n)}})}})}),define("models/softwareupgrade/DiskSoftwareUpgradeModel",["models/softwareupgrade/FirmwareSoftwareUpgradeModel","models/hardware/DiskCollection","data/DataProperties","utils/AppConstants"],function(e,t,n,i){"use strict";return e.extend({name:"DiskSoftwareUpgradeModel",newVersionsAvailable:null,disksGroupDisplayed:null,getSoftwareType:function(e){return i.UPGRADE_SOFTWARE_TYPE.FIRMWARE_DISK},createVersionModelInstance:function(){return new t},collectDiskInformation:function(e){var t={};return t[i.TASK_STATUS_QUEUED]=null,t[i.TASK_STATUS_COMPLETE]=null,t[i.TASK_STATUS_CANCELED]=null,t[i.TASK_STATUS_ABORTED]=null,_.each(e,function(e,s){var a=[];s!==i.TASK_STATUS_ACTIVE&&(_.each(e,function(e){var t=e.get(n.TASK_ENTITY_ID);if(t){var i=t.split(":");a.unshift({hostId:i[0],diskId:i[1]})}}),t[s]=_.groupBy(a,"hostId"))}),t},makeFirmwareMap:function(){var e,t=this.get(n.UPGRADE_VERSION_MODEL),i=this.get(n.UPGRADE_SOFTWARE_RELEASES);t=t?t.toJSON():null,i=i?i.toJSON():null,t&&t.length&&(t=_.filter(t,function(e){return e.diskHardwareConfig&&e.diskHardwareConfig.model&&e.diskHardwareConfig.currentFirmwareVersion}),e=_.groupBy(t,function(e){return e.diskHardwareConfig.model})),e&&(_.each(_.keys(e),function(t){e[t]={currentVersions:e[t],versionsMap:[],upgradeVersions:[]};var n,s=!1;if(e[t].versionsMap=_.groupBy(e[t].currentVersions,function(e){return e.diskHardwareConfig.currentFirmwareVersion}),i&&i.length){_.each(i,function(n){_.each(n.supportedModels,function(i){t.slice(0,i.length)===i&&(e[t].upgradeVersions||(e[t].upgradeVersions=[]),e[t].upgradeVersions.unshift(n))})});var a=e[t].upgradeVersions.length,o=0;(!o&&a||o<a)&&(this.setProperty("newVersionsAvailable",!1),o=a),_.each(e[t].versionsMap,function(i,a){var o=_.find(e[t].upgradeVersions,function(e){return e.version===a});o?n=n?Math.min(n,o.qualifiedDate):o.qualifiedDate:s=!0}),!s&&n&&(e[t].upgradeVersions=_.filter(e[t].upgradeVersions,function(e){return e.qualifiedDate>n}))}},this),this.setProperty(n.UPGRADE_DISK_MAP,e))},isUploadedVersionCompatible:function(e){var t=e&&e.entities&&e.entities[0]&&e.entities[0].version,i=!1;if(t){var s=this.get(n.UPGRADE_DISK_MAP);i=_.some(s,function(e){return _.some(e.upgradeVersions,function(e){return e.version===t})})}return i},showSoftwareIncompatibleError:function(){this.trigger("error",this.i18n("incompatibleDiskUploadErrorMsg"))}})}),define("models/softwareupgrade/BIOSSoftwareUpgradeModel",["models/softwareupgrade/FirmwareSoftwareUpgradeModel","models/hardware/HostCollection","data/DataProperties","utils/AppConstants"],function(e,t,n,i){"use strict";return e.extend({name:"BIOSSoftwareUpgradeModel",getSoftwareType:function(e){return i.UPGRADE_SOFTWARE_TYPE.FIRMWARE_BIOS},createVersionModelInstance:function(){return new t},makeFirmwareMap:function(){var e,t=this.get(n.UPGRADE_VERSION_MODEL);t=t?t.toJSON():null,t&&t.length&&(e=_.groupBy(t,function(e){return e[n.BLOCK_MODEL_NAME]||e[n.BLOCK_MODEL]||"Unknown"})),_.isEmpty(e)||(_.each(_.keys(e),function(t){e[t]={versionsMap:{},currentVersions:e[t]},e[t].versionsMap=_.groupBy(e[t].currentVersions,function(e){return e[n.BIOS_VERSION]});var i=e[t].versionsMap;_.each(i,function(e,t){var s=_.groupBy(e,function(e){return e[n.BIOS_MODEL]});_.each(s,function(e,n){var i={};i.hostsGroup=e,i.upgradeVersions=this.getCompatibleReleaseVersions(n,t),s[n]=i},this),i[t]=s},this)},this),this.setProperty(n.UPGRADE_HOST_MAP,e))},getCompatibleReleaseVersions:function(e,t){var i=this.get(n.UPGRADE_SOFTWARE_RELEASES),s=[];return i=i?i.toJSON():null,i&&i.length&&_.each(i,function(n){var i=n;_.each(i.supportedModels,function(n){n===e&&_.contains(i.compatibleVersions,t)&&s.push(i)})}),s}})}),define("models/softwareupgrade/BMCSoftwareUpgradeModel",["models/softwareupgrade/FirmwareSoftwareUpgradeModel","models/hardware/HostCollection","data/DataProperties","utils/AppConstants"],function(e,t,n,i){"use strict";return e.extend({name:"BMCSoftwareUpgradeModel",getSoftwareType:function(e){return i.UPGRADE_SOFTWARE_TYPE.FIRMWARE_BMC},createVersionModelInstance:function(){return new t},makeFirmwareMap:function(){var e,t=this.get(n.UPGRADE_VERSION_MODEL);t=t?t.toJSON():null,t&&t.length&&(e=_.groupBy(t,function(e){return e[n.BLOCK_MODEL_NAME]})),_.isEmpty(e)||(_.each(_.keys(e),function(t){e[t]={versionsMap:{},currentVersions:e[t]},e[t].versionsMap=_.groupBy(e[t].currentVersions,function(e){return e[n.BMC_VERSION]});var i=e[t].versionsMap;_.each(i,function(e,t){var s=_.groupBy(e,function(e){return e[n.BMC_MODEL]});_.each(s,function(e,n){var i={};i.hostsGroup=e,i.upgradeVersions=this.getCompatibleReleaseVersions(n,t),s[n]=i},this),i[t]=s},this)},this),this.setProperty(n.UPGRADE_HOST_MAP,e))},getCompatibleReleaseVersions:function(e,t){var i=this.get(n.UPGRADE_SOFTWARE_RELEASES),s=[];return i=i?i.toJSON():null,i&&i.length&&_.each(i,function(n){var i=n;_.each(i.supportedModels,function(n){n===e&&_.contains(i.compatibleVersions,t)&&s.push(i)})}),s}})}),define("models/softwareupgrade/HBASoftwareUpgradeModel",["models/softwareupgrade/FirmwareSoftwareUpgradeModel","models/hardware/HostCollection","data/DataProperties","utils/AppConstants"],function(e,t,n,i){"use strict";return e.extend({name:"HBASoftwareUpgradeModel",getSoftwareType:function(e){return i.UPGRADE_SOFTWARE_TYPE.FIRMWARE_HBA},createVersionModelInstance:function(){return new t},makeFirmwareMap:function(){var e=this.get(n.UPGRADE_VERSION_MODEL),t={};e=e?e.toJSON():null,e&&e.length&&_.each(e,function(e){var i=[];_.each(e.hbaFirmwaresList,function(e){_.any(i,function(t){return t[n.HBA_MODEL]===e[n.HBA_MODEL]&&t[n.HBA_VERSION]===e[n.HBA_VERSION]})||i.push(e)}),_.each(i,function(e){t[e[n.HBA_MODEL]]||(t[e[n.HBA_MODEL]]=[]),t[e[n.HBA_MODEL]].push(e)})}),_.isEmpty(t)||(_.each(_.keys(t),function(e){t[e]={versionsMap:{},currentVersions:t[e]},t[e].versionsMap=_.groupBy(t[e].currentVersions,function(e){return e[n.HBA_VERSION]});var i=t[e].versionsMap;_.each(i,function(e,t){var s=_.groupBy(e,function(e){return e[n.HBA_MODEL]});_.each(s,function(e,n){var i={};i.hostsGroup=e,i.upgradeVersions=this.getCompatibleReleaseVersions(n,t),s[n]=i},this),i[t]=s},this)},this),this.setProperty(n.UPGRADE_HOST_MAP,t))},getCompatibleReleaseVersions:function(e,t){var i=this.get(n.UPGRADE_SOFTWARE_RELEASES),s=[];return i=i?i.toJSON():null,i&&i.length&&_.each(i,function(n){var i=n;_.each(i.supportedModels,function(n){n===e&&_.contains(i.compatibleVersions,t)&&s.push(i)})}),s}})}),define("text!templates/popups/softwareupgrade/FirmwareSoftwareUpgradeHostGroupsView.html",[],function(){return'\x3c!-- Groups view --\x3e\n<div class="n-host-group firmwareGroup" data-block-model="<%= blockModel%>">\n  <p class="n-title">Model: <%= blockModel %></p>\n</div>'}),define("text!templates/popups/softwareupgrade/FirmwareSoftwareUpgradeHostGroupsUpgradesView.html",[],function(){return'<div class="n-version-download-container">\n  \x3c!-- Details or Download --\x3e\n  <div class="n-link-status-details">\n   <% if (upgradeVersion.status === statusMap.INPROGRESS ||\n         upgradeVersion.status === statusMap.QUEUED ) { %>\n\n     \x3c!-- Stop button. Automatic downloads can\'t be canceled --\x3e\n     <% if (upgradeVersion.status === statusMap.INPROGRESS &&\n           upgradeVersion.transferType !==\n            transferTypeMap.AUTOMATIC_DOWNLOAD) { %>\n       <div class="btnStop btn-control" title="Stop"\n            dataId="<%= upgradeVersion.name %>"\n            dataVersionId="<%= version %>">\n       </div>\n     <% } %>\n\n     \x3c!-- Type of progress --\x3e\n     <% if (upgradeVersion.transferType === transferTypeMap.DOWNLOAD) { %>\n      downloading...\n     <%} else if (upgradeVersion.transferType ===\n                  transferTypeMap.UPLOAD) { %>\n      uploading...\n     <%} else if (upgradeVersion.transferType ===\n                 transferTypeMap.AUTOMATIC_DOWNLOAD){ %>\n      automatic download\n     <%} else if (upgradeVersion.transferType ===\n                 transferTypeMap.PROCESS) { %>\n      processing...\n     <%} else { %>\n      transferring...\n     <% } %>\n\n   <% } else { %>\n\n     \x3c!-- Loader --\x3e\n     <div class="n-inline-loading-container">\n       <div class="n-inline-loading  loaderRow" />\n     </div>\n\n     <% if (upgradeVersion.status !== statusMap.AVAILABLE &&\n           upgradeVersion.status !== statusMap.CORRUPTED &&\n           upgradeVersion.status !== statusMap.FAILED) { %>\n     \x3c!-- Delete --\x3e\n     <i dataId="<%= upgradeVersion.name %>"\n        dataVersionId="<%= version %>"\n        class="btnDelete  btn-control"\n        data-icon="v" aria-hidden="true" title="Delete"></i>\n     <% } %>\n\n     \x3c!-- Details --\x3e\n     <% if (upgradeVersion.transferType !== transferTypeMap.UPLOAD &&\n           upgradeVersion.status !== statusMap.CORRUPTED  &&\n           upgradeVersion.status !== statusMap.FAILED) { %>\n       <a dataId="<%= upgradeVersion.name %>"\n          dataVersionId="<%= version %>"\n          class="linkDetails"\n          title="Release Notes">details</a>\n     <% } %>\n\n     \x3c!-- Corrupted --\x3e\n     <% if (upgradeVersion.status === statusMap.CORRUPTED) { %>\n      Corrupted\n     <% } else if (upgradeVersion.status === statusMap.FAILED) { %>\n      Failed\n     <% } %>\n\n   <% } %>\n  </div>\n\n  \x3c!-- Button and progress bar --\x3e\n  <div class="n-upgrade-control">\n\n   \x3c!-- Download --\x3e\n   <div class="btnDownload btn -default btn-control" style="display:\n        <%= upgradeVersion.status === statusMap.AVAILABLE ?\n        \'inline-block\': \'none\'%>"\n        dataId="<%= upgradeVersion.name %>"\n        dataVersionId="<%= version %>">\n     Download\n   </div>\n\n   \x3c!-- Progress --\x3e\n   <% var totalBytesUploaded =\n      upgradeVersion.currentSizeInBytes / upgradeVersion.totalSizeInBytes\n\n      var percent =\n        upgradeVersion.totalSizeInBytes > 0 ? Math.max(0, Math.floor(\n          100 * totalBytesUploaded)) : 0 %>\n   <div class="softwareReleaseProgressBar blendedColorProgressBar\n                <%= \'percent\'+ Math.floor(percent / 10) * 10 %>"\n        style="display:\n      <%= upgradeVersion.status === statusMap.INPROGRESS ||\n          upgradeVersion.status === statusMap.QUEUED ?\n            \'inline-block\' : \'none\'%>"\n        dataId="<%= upgradeVersion.name %>"\n        dataVersionId="<%= version %>"\n        title="<%= percent %>%">\n     <div class="fillProgress n-percent-<%= percent%>"\n          style="width:<%= percent%>%"\n          title="<%= percent %>%">\n     </div>\n   </div>\n\n    \x3c!-- Upgrade --\x3e\n    <% var upgradeBtnStyle = upgradeVersion.status === statusMap.COMPLETED ?\n        \'display:inline-block;\' : \'display:none;\' %>\n\n    <div class="btn-group">\n      <button type="button" data-toggle="dropdown"\n        dataId="<%= upgradeVersion.name %>"\n        dataVersionId="<%= version %>"\n        class="btn btn-primary dropdown-toggle btn-control btnsUpgrade"\n        style="<%= upgradeBtnStyle %>">\n        Upgrade <span class="caret"></span>\n      </button>\n      <ul class="dropdown-menu dropdown-menu-right" role="menu">\n        <% if (upgradeVersion.status === statusMap.COMPLETED) { %>\n          <li>\n            <a class="btnPreUpgrade"\n              dataId="<%= upgradeVersion.name %>"\n              dataVersionId="<%= version %>">\n              Pre-upgrade\n            </a>\n          </li>\n          <li>\n            <a class="btnUpgrade"\n              dataId="<%= upgradeVersion.name %>"\n              dataVersionId="<%= version %>">\n              Upgrade Now\n            </a>\n          </li>\n        <% } %>\n      </ul>\n    </div>\n\n   \x3c!-- Failed --\x3e\n   <div class="btnFailed  btn-control"\n        style="display: <%= upgradeVersion.status === statusMap.FAILED ?\n        \'inline-block\': \'none\'%>"\n        dataId="<%= upgradeVersion.name %>"\n        dataVersionId="<%= version %>"\n        title="<%= percent+\'%\' %>">\n     Retry\n   </div>\n\n   \x3c!-- Paused --\x3e\n   <div class="btnResume  btn-control"\n        style="display: <%= upgradeVersion.status === statusMap.PAUSED ?\n        \'inline-block\': \'none\'%>"\n        dataId="<%= upgradeVersion.name %>"\n        dataVersionId="<%= version %>"\n        title="<%= percent+\'%\' %>">\n     \x3c!-- Type of progress --\x3e\n     <% if (upgradeVersion.transferType === transferTypeMap.DOWNLOAD) { %>\n      Resume Download\n     <% } else if (upgradeVersion.transferType === transferTypeMap.UPLOAD) { %>\n      Resume Upload\n     <% } else { %>\n      Resume\n     <% } %>\n   </div>\n\n   \x3c!-- Corrupted --\x3e\n   <div class="btnCorrupted  btn-control"\n        style="display:<%= upgradeVersion.status === statusMap.CORRUPTED ?\n        \'inline-block\':\'none\'%>"\n        dataId="<%= upgradeVersion.name %>"\n        dataVersionId="<%= version %>">\n     Delete\n   </div>\n\n  </div>\n</div>\n'}),define("views/popups/softwareupgrade/firmwareupgrade/BaseFirmwareGroupView",["views/basecomponents/BaseSubView","utils/AppConstants","utils/AppUtil","data/DataProperties","text!templates/popups/softwareupgrade/FirmwareSoftwareUpgradeHostGroupsView.html","text!templates/popups/softwareupgrade/FirmwareSoftwareUpgradeHostGroupsUpgradesView.html"],function(e,t,n,i,s,a){"use strict";var o=_.template(s),r=_.template(a),l=_.template('<div class="host-firmware-upgrade-group"></div>'),c=_.template('<p class="n-title firmware-version-row"data-versions="<%= upgradeVersionList %>"> Version: <span class="firmware-version"><%=currentVersion%> (<%=numNodes%> nodes)</span></p>'),d=_.template('<option value="<%= firmwareVersion %>"><%= firmwareName %></option>');return e.extend({renderFirmwareGroup:function(){var e=this.model.get(i.UPGRADE_SOFTWARE_RELEASES),t=this.model.get(i.UPGRADE_HOST_MAP);if(t&&e){if(this.getParentView().checkPrismInfoHeaderError(e),this.getParentView().$(".firmwareUpgradeGroups").html(""),this.getParentView().$(".firmwareUpgradeGroups").html(l({})),t){var s;_.each(t,function(e,t){var n=e.versionsMap;this.getParentView().$(".host-firmware-upgrade-group").append(o({blockModel:t})),_.each(n,function(e,n){var a=this._getHostsWithCurrentVersion(e),o=this._getUpgradeVersionsForHosts(e);o&&o.length&&(s=[],_.each(o,function(e){s.push(e[i.UPGRADE_VERSION])})),"null"===n&&(n="unknown"),this.getParentView().$('.n-host-group:[data-block-model="'+t+'"]').append(c({currentVersion:n,numNodes:a.length,upgradeVersionList:s}))},this)},this)}this.model.setProperty(this.model.DP.FIRMWARE_GRP_DISPLAYED,!0),this.getParentView().hideUpgradesContainer()}else this.getParentView().$(".firmwareUpgradeGroups").html(""),this.model.setProperty(this.model.DP.FIRMWARE_GRP_DISPLAYED,!1),n.addInLineDonutLoader(this.getParentView().$(".loadingSpinnerVersion")),this.getParentView().$(".loadingSpinnerVersion").append("Loading...")},renderFirmwareReleaseList:function(){},renderUpgradeVersionDownload:function(e){var n=this.getUpgradeRelease(e);n&&this.getParentView().$(".firmwareDownloadSection").html(r({version:n[i.UPGRADE_VERSION],upgradeVersion:n,statusMap:t.UPGRADE_SOFTWARE_RELEASE_STATUS,transferTypeMap:t.UPGRADE_TRANSFER_TYPE}))},renderSoftwareReleasesChange:function(){!this.model.get(this.model.DP.NEW_VERSIONS_AVAIL)&&this.model.get(this.model.DP.FIRMWARE_GRP_DISPLAYED)||(this.getParentView().onStateChange(),this.model.setProperty(this.model.DP.NEW_VERSIONS_AVAIL,!1)),this.renderUpgradeVersionSelection()},renderUpgradeVersionSelection:function(){var e=this.model.get(i.UPGRADE_SOFTWARE_RELEASES),n=this.getParentView().$(".firmwareUpgradeVersion"),s=this.getParentView().$(".firmwareVersionsSelection");if((e=e?e.toJSON():null)&&e.length){e=_.sortBy(e,function(e){return e[i.UPGRADE_NAME]}),n.empty(),_.each(e,function(e){var a=e[i.UPGRADE_VERSION],o=this.getFirmwareName(e);if(a&&o&&n.append(d({firmwareVersion:a,firmwareName:o})),s.show(),this.model.get("selectedFirmwareUpgradeVersion")===a){var r=e[i.UPGRADE_STATUS],l=[t.UPGRADE_SOFTWARE_RELEASE_STATUS.INPROGRESS],c=_.contains(l,r);this.model.setProperty("disableSelectionOptions",c)}},this),this.getParentView().$("select.firmwareUpgradeVersion").nutanixInput({type:"select"}),this.getParentView().$("select.firmwareUpgradeVersion").trigger("update");var a=this.getParentView().$(".firmwareUpgradeVersion").val();this.renderUpgradeVersionDownload(a)}else s.hide()},getUpgradeRelease:function(e){var t=this.model.get(i.UPGRADE_SOFTWARE_RELEASES),n=null;return t=t?t.toJSON():null,t&&t.length&&(n=_.find(t,function(t){return t[i.UPGRADE_VERSION]===e})),n},handleFirmwareVersionChange:function(e){this.model.setProperty("selectedFirmwareUpgradeVersion",e),this.renderUpgradeVersionDownload(e),this.highlightEligibleHostGroups(e)},getSupportedModelList:function(e){var t=this.model.get(i.UPGRADE_SOFTWARE_RELEASES),n="";return t=t?t.toJSON():null,t&&t.length&&(n=_.find(t,function(t){return e===t[i.UPGRADE_NAME]})),n[i.UPGRADE_SUPPORTED_MODELS]||[]},highlightEligibleHostGroups:function(e){var t=this.getParentView().$(".firmware-version");t&&t.length&&_.each(t,function(t){var n=$(t).attr("data-versions"),i=[];n&&(i=n.split(",")),_.contains(i,e)?$(t).addClass("n-highlight-version"):$(t).removeClass("n-highlight-version")})},getFirmwareName:function(e){return e[i.UPGRADE_NAME]},_getHostsWithCurrentVersion:function(e){var t=[];return _.each(e,function(e,n){var i=e.hostsGroup;t=t.concat(i)}),t},_getUpgradeVersionsForHosts:function(e){var t=[];return _.each(e,function(e,n){var i=e.upgradeVersions;t=t.concat(i)}),_.uniq(t)}})}),define("views/popups/softwareupgrade/firmwareupgrade/BIOSFirmwareGroupView",["data/DataProperties","views/popups/softwareupgrade/firmwareupgrade/BaseFirmwareGroupView"],function(e,t){"use strict";return t.extend({initialize:function(e){e=e||{},this.model=e.model,t.prototype.initialize.apply(this,arguments)},getFirmwareName:function(t){var n=t[e.UPGRADE_NAME],i=t[e.UPGRADE_COMPATIBLE_PlATFORMS];return i&&(n=n+"_"+i.join("_")),n}})}),define("views/popups/softwareupgrade/firmwareupgrade/BMCFirmwareGroupView",["data/DataProperties","views/popups/softwareupgrade/firmwareupgrade/BaseFirmwareGroupView"],function(e,t){"use strict";return t.extend({initialize:function(e){e=e||{},this.model=e.model,t.prototype.initialize.apply(this,arguments)},getFirmwareName:function(t){var n=t[e.UPGRADE_NAME],i=t[e.UPGRADE_COMPATIBLE_PlATFORMS];return i&&(n=n+"_"+i.join("_")),n}})}),define("text!templates/popups/softwareupgrade/FirmwareSoftwareUpgradeDiskGroupsView.html",[],function(){return'<div class="disk-firmware-upgrade-group">\n  <%\n   if (disksMap) {\n    _.each(_.keys(disksMap), function(model){\n  %>\n\n  <div class="n-disk-group firmwareGroup">\n    <p class="n-title">Disk Group: <%= model %></p>\n    <p class="n-title">Total Disks in group:\n        <%= disksMap[model].currentVersions.length %></p>\n    <%\n      if (disksMap[model].versionsMap) {\n        _.each(disksMap[model].versionsMap, function(version, key) {\n    %>\n\n    <p class="n-title">Version: <%= key %>\n      ( <%= version.length%> disks )</p>\n    <%\n        });\n      }\n    %>\n\n    <% if (disksMap[model].upgradeVersions &&\n           disksMap[model].upgradeVersions.length > 0) { %>\n      <% if (_.contains(singleSSDgroups, model)) { %>\n        <span class="upgrade-avail-link pull-right">\n          <a href="<%= DataURLConstants.GLOBAL_SUPPORT %>" target="_blank">\n            <%= i18n("upgradeAvailable") %>: <%= i18n("contactSupport") %>.\n          </a>\n        </span>\n        <div class="n-clearfix"></div>\n      <% } else { %>\n        <a class="upgrade-avail-link pull-right"\n           data-model="<%=model%>"><%= i18n("upgradeAvailable") %></a>\n        <a class="hide-link pull-right" data-model="<%=model%>"><%= i18n("hide") %></a>\n        <div class="n-clearfix"></div>\n      <% } %>\n    <% } %>\n\n  </div>\n\n  <div class="upgrades-container" data-model="<%=model%>">\n      <p class="n-title">\n          AVAILABLE COMPATIBLE VERSIONS\n      </p>\n      <table data-model="<%=model%>"\n             class="firmwareReleaseList table table-hover">\n        \x3c!-- The tbody for the firmware software releases list goes here --\x3e\n      </table>\n  </div>\n  <%\n    });\n  }\n  %>\n</div>'}),define("text!templates/popups/softwareupgrade/FirmwareSoftwareUpgradeDiskGroupsUpgradesView.html",[],function(){return'<tbody>\n<% _.each(disksMap[model].upgradeVersions, function(ver){ %>\n<tr>\n  <td class="n-col-version">\n    <p class="n-version"><%= ver.version %></p>\n  </td>\n  <td class="n-col-download" align="right" valign="middle">\n    \x3c!-- Container --\x3e\n    <div class="n-col-download-container">\n\n      \x3c!-- Details or Download --\x3e\n      <div class="n-link-status-details">\n        <% if (ver.status === statusMap.INPROGRESS ||\n               ver.status === statusMap.QUEUED ) { %>\n\n          \x3c!-- Stop button. Automatic downloads can\'t be canceled --\x3e\n          <% if (ver.status === statusMap.INPROGRESS &&\n                 ver.transferType !== transferTypeMap.AUTOMATIC_DOWNLOAD) { %>\n            <div class="btnStop btn-control" title="Stop"\n                 dataId="<%= ver.name %>" data-model="<%=model%>">\n            </div>\n          <% } %>\n\n          \x3c!-- Type of progress --\x3e\n          <% if (ver.transferType === transferTypeMap.DOWNLOAD) { %>\n            downloading...\n          <%} else if (ver.transferType === transferTypeMap.UPLOAD) { %>\n            uploading...\n          <%} else if (ver.transferType ===\n                       transferTypeMap.AUTOMATIC_DOWNLOAD){%>\n            automatic download\n          <%} else if (ver.transferType === transferTypeMap.PROCESS) { %>\n            processing...\n          <%} else { %>\n            transferring...\n          <% } %>\n\n        <% } else { %>\n\n                \x3c!-- Loader --\x3e\n          <div class="n-inline-loading-container">\n            <div class="n-inline-loading  loaderRow" />\n          </div>\n\n          <% if (ver.status !== statusMap.AVAILABLE &&\n                 ver.status !== statusMap.CORRUPTED &&\n                 ver.status !== statusMap.FAILED) { %>\n            \x3c!-- Delete --\x3e\n            <i dataId="<%= ver.name %>" data-model="<%=model%>"\n               class="btnDelete  btn-control"\n               data-icon="v" aria-hidden="true" title="Delete"></i>\n          <% } %>\n\n          \x3c!-- Details --\x3e\n          <% if (ver.transferType !== transferTypeMap.UPLOAD &&\n                 ver.status !== statusMap.CORRUPTED  &&\n                 ver.status !== statusMap.FAILED) { %>\n            <a dataId="<%= ver.name %>" data-model="<%=model%>"\n               class="linkDetails"\n               title="Release Notes">details</a>\n          <% } %>\n\n          \x3c!-- Corrupted --\x3e\n          <% if (ver.status === statusMap.CORRUPTED) { %>\n            Corrupted\n          <% } else if (ver.status === statusMap.FAILED) { %>\n            Failed\n          <% } %>\n\n        <% } %>\n\n        </div>\n\n        \x3c!-- Button and progress bar --\x3e\n        <div class="n-upgrade-control">\n\n          \x3c!-- Download --\x3e\n          <div class="btnDownload btn -default btn-control" style="display:\n            <%= ver.status===statusMap.AVAILABLE ? \'inline-block\': \'none\'%>"\n               dataId="<%= ver.name %>" data-model="<%=model%>">\n            Download\n          </div>\n\n          \x3c!-- Progress --\x3e\n          <% var percent = ver.totalSizeInBytes > 0 ? Math.max(0, Math.floor(\n               100 * ver.currentSizeInBytes / ver.totalSizeInBytes )) : 0 %>\n            <div class="softwareReleaseProgressBar blendedColorProgressBar\n                      <%= \'percent\'+ Math.floor(percent / 10) * 10 %>"\n                 style="display:\n            <%= ver.status === statusMap.INPROGRESS ||\n                ver.status === statusMap.QUEUED ? \'inline-block\' : \'none\'%>"\n                 dataId="<%= model.name %>"\n                 title="<%= percent %>%">\n              <div class="fillProgress n-percent-<%= percent%>"\n                   style="width:<%= percent%>%"\n                   title="<%= percent %>%">\n              </div>\n            </div>\n\n          \x3c!-- Upgrade --\x3e\n          <% var upgradeBtnStyle = ver.status === statusMap.COMPLETED ?\n              \'display:inline-block;\' : \'display:none;\' %>\n\n          <div class="btn-group">\n            <button type="button" data-toggle="dropdown"\n              dataId="<%= ver.name %>"\n              data-model="<%= model %>"\n              class="btn btn-primary dropdown-toggle btn-control btnsUpgrade"\n              style="<%= upgradeBtnStyle %>">\n              Upgrade <span class="caret"></span>\n            </button>\n            <ul class="dropdown-menu dropdown-menu-right" role="menu">\n              <% if (ver.status === statusMap.COMPLETED) { %>\n                <li>\n                  <a class="btnPreUpgrade"\n                    dataId="<%= ver.name %>"\n                    data-model="<%= model %>">\n                    Pre-upgrade\n                  </a>\n                </li>\n                <li>\n                  <a class="btnUpgrade"\n                    dataId="<%= ver.name %>"\n                    data-model="<%= model %>">\n                    Upgrade Now\n                  </a>\n                </li>\n              <% } %>\n            </ul>\n          </div>\n\n            \x3c!-- Failed --\x3e\n            <div class="btnFailed  btn-control" style="display:\n            <%= ver.status === statusMap.FAILED ? \'inline-block\': \'none\'%>"\n                 dataId="<%= ver.name %>" data-model="<%=model%>"\n                 title="<%= percent+\'%\' %>">\n              Retry\n            </div>\n\n            \x3c!-- Paused --\x3e\n            <div class="btnResume  btn-control" style="display:\n            <%= ver.status === statusMap.PAUSED ? \'inline-block\': \'none\'%>"\n                 dataId="<%= model.name %>" data-model="<%=model%>"\n                 title="<%= percent+\'%\' %>">\n              \x3c!-- Type of progress --\x3e\n              <% if (model.transferType === transferTypeMap.DOWNLOAD) { %>\n                Resume Download\n              <% } else if (model.transferType === transferTypeMap.UPLOAD) { %>\n                Resume Upload\n              <% } else { %>\n                Resume\n              <% } %>\n            </div>\n\n            \x3c!-- Corrupted --\x3e\n            <div class="btnCorrupted  btn-control" style="display:\n            <%= ver.status === statusMap.CORRUPTED ? \'inline-block\':\'none\'%>"\n                 dataId="<%= ver.name %>" data-model="<%=model%>">\n              Delete\n            </div>\n\n        </div>\n\n      </div> \x3c!-- End of n-col-download-container --\x3e\n  </td>\n</tr>\n<%  }); %>\n\n</tbody>'}),define("views/popups/softwareupgrade/firmwareupgrade/DiskFirmwareGroupView",["views/popups/softwareupgrade/firmwareupgrade/BaseFirmwareGroupView","utils/AppConstants","utils/AppUtil","data/DataProperties","data/DataURLConstants","text!templates/popups/softwareupgrade/FirmwareSoftwareUpgradeDiskGroupsView.html","text!templates/popups/softwareupgrade/FirmwareSoftwareUpgradeDiskGroupsUpgradesView.html"],function(e,t,n,i,s,a,o){"use strict";var r=_.template(a),l=_.template(o);return e.extend({name:"DiskFirmwareGroupView",renderFirmwareGroup:function(){var e=this.model.get(i.UPGRADE_SOFTWARE_RELEASES),t=this.model.get(i.UPGRADE_DISK_MAP);t&&e?(this.getParentView().checkPrismInfoHeaderError(e),this.getParentView().$(".firmwareUpgradeGroups").html(""),this.getParentView().$(".firmwareUpgradeGroups").html(r(this.vtOptions({disksMap:t,singleSSDgroups:this.getSingleSSDdisks(),DataURLConstants:s}))),this.model.setProperty("disksGroupDisplayed",!0),this.getParentView().hideUpgradesContainer()):(n.addInLineDonutLoader(this.getParentView().$(".loadingSpinnerVersion")),this.getParentView().$(".loadingSpinnerVersion").append("Loading..."),this.model.setProperty("disksGroupDisplayed",!1))},renderDiskFirmwareReleaseList:function(e,n){this.getParentView().$('.firmwareReleaseList[data-model="'+e+'"]').html(l({disksMap:n,model:e,statusMap:t.UPGRADE_SOFTWARE_RELEASE_STATUS,transferTypeMap:t.UPGRADE_TRANSFER_TYPE}))},renderFirmwareReleaseList:function(e){var t=this.model.get(i.UPGRADE_DISK_MAP);this.renderDiskFirmwareReleaseList(e,t)},renderSoftwareReleasesChange:function(){var e=this.model.get(i.UPGRADE_DISK_MAP);!this.model.get("newVersionsAvailable")&&this.model.get("disksGroupDisplayed")||(this.getParentView().onStateChange(),this.model.setProperty("newVersionsAvailable",!1)),e&&(this.renderFirmwareGroup(),_.each(_.keys(e),function(t){this.renderDiskFirmwareReleaseList(t,e)},this))},handleFirmwareVersionChange:function(){return null},getSingleSSDdisks:function(){var e=this.model.get(i.UPGRADE_VERSION_MODEL),n=_.filter(e.models,function(e){return e.get(i.TIER_NAME)===t.DISK_TIER.SSD}),s=_.groupBy(n,function(e){return e.get(i.DISK_HW_CONFIG_CVM_IP)}),a=[];return _.each(s,function(e){1===e.length&&a.push(e[0].get(i.DISK_HW_CONFIG)[i.DISK_HW_CONFIGS_DISK_MODEL])}),a}})}),define("views/popups/softwareupgrade/firmwareupgrade/HBAFirmwareGroupView",["views/popups/softwareupgrade/firmwareupgrade/BaseFirmwareGroupView"],function(e){"use strict";return e.extend({initialize:function(t){t=t||{},this.model=t.model,e.prototype.initialize.apply(this,arguments)}})}),define("text!templates/popups/softwareupgrade/FirmwareSoftwareUpgradeView.html",[],function(){
return'<div class="n-modal-body">\n  <div class="n-modal-content-wrapper">\n    \x3c!-- TODO: Move alerts to the subviews --\x3e\n    <div class="n-modal-alert-header">\n      \x3c!-- @view: alert goes here... --\x3e\n    </div>\n    <div class="n-modal-content">\n      <% if (canModify) { %>\n        \x3c!-- Content based upgrade state --\x3e\n        <div class="n-state-initial">\n            <span class="loadingSpinnerVersion"></span>\n        </div>\n        <div class="n-state-content">\n\n          \x3c!-- Content goes here either:\n            (A) Download/Upload Versions\n            (B) Upgrade Status\n          --\x3e\n\n          \x3c!-- To be replaced when view state changes --\x3e\n          <div class="n-popup-loading">\n            Loading...\n          </div>\n\n        </div>\n      <% } else { %>\n        <div class="n-no-access">\n          You don\'t have access to manage upgrades.\n        </div>\n      <% } %>\n    </div>\n  </div>\n</div>\n\n<div class="n-modal-footer">\n  <% if (canModify) { %>\n    <div class="n-left-control">\n      <input type="checkbox" class="checkboxAutoDownload  formControl">\n      Enable Automatic Download\n      <div class="n-inline-loading-container">\n          <div class="n-inline-loading  loaderAutoDownload" />\n      </div>\n    </div>\n    <% if (!is2048Disabled) { %>\n      <div class="n-game-message">\n        <a id="linkPlayEasterEgg">Nothing to do?</a>\n      </div>\n    <% } %>\n  <% } %>\n  <button class="btnBack btnBackProgress btn n-btn-form"\n          style="display:none">\n      Back to Progress\n  </button>\n  <button class="btnBack btnBackVersion btn n-btn-form"\n          style="display:none">\n      Back to Versions\n  </button>\n  <button class="btnClose btn btn-primary n-btn-form">\n      Close\n  </button>\n</div>'}),define("text!templates/popups/softwareupgrade/FirmwareSoftwareUpgradeGroupView.html",[],function(){return'<div class="firmware-upgrade">\n  \x3c!-- Firmware type Dropdown --\x3e\n  <div class="n-version-row">\n    <p class="n-title">\n      FIRMWARE TO UPGRADE:\n    </p>\n    <select class="firmwareType">\n      <option value="firmware.disk">Disks</option>\n      <% if (!showOnlyDisk) { %>\n        <option value="firmware.bios">BIOS</option>\n        <option value="firmware.bmc">BMC</option>\n        <option value="firmware.hba">HBA</option>\n      <% } %>\n    </select>\n    <div class="firmwareVersionsSelection" style="display: none">\n      <p class="n-title">\n        CHOOSE VERSION:\n      </p>\n      <select class="firmwareUpgradeVersion"></select>\n      <div class="firmwareDownloadSection n-firmware-download"></div>\n    </div>\n  </div>\n  <div class="firmwareUpgradeGroups">\n    \x3c!-- The firmware version groupby are appended here. --\x3e\n  </div>\n</div>\n\n\x3c!-- Upgrade Software Binary --\x3e\n<div class="n-version-row upload-binary">\n  <p class="n-title">UPLOAD UPGRADE SOFTWARE BINARY</p>\n  <p class="n-description  n-upload-description">\n    You can <a class="linkUpload">upload a <%= softwareTypeState %> binary</a>\n    here through the browser instead of downloading directly from the internet.\n  </p>\n  <div class="n-upload-form-container">\n    \x3c!-- The upload form. We use the HTML5 File interface to send the data and\n         not directly with the form.  --\x3e\n    <form class="form-horizontal  formUpload"\n          target="upload_target" method="post" enctype="multipart/form-data">\n      \x3c!-- File browser --\x3e\n      <div class="control-group">\n        <label class="control-label" for="inputMetadataFile">\n          <%= softwareTypeState %> Metadata File\n        </label>\n        <div class="controls">\n          <input type="file" class="inputMetadataFile" name="metadataFile" />\n        </div>\n      </div>\n      \x3c!-- File browser --\x3e\n      <div class="control-group">\n        <label class="control-label" for="inputFile">\n          <%= softwareTypeState %> Binary File\n        </label>\n        <div class="controls">\n          <input type="file" class="inputFile" name="file" />\n        </div>\n      </div>\n      \x3c!-- Overwrite checkbox--\x3e\n      <div class="control-group">\n        <div class="controls">\n          <%= overwriteCheckbox %>\n          <span class="helpText">\n            Overwrite existing <%= softwareTypeState %> binary file\n            (if present).\n          </span>\n        </div>\n      </div>\n      \x3c!-- Hidden elements --\x3e\n      <input type="hidden" class="inputName" />\n      <input type="hidden" class="inputMD5Sum"/>\n      <input type="hidden" class="inputFileSize" />\n      <input type="hidden" class="inputOffset" />\n      <input type="hidden" class="inputVersion" />\n      \x3c!-- Footer  --\x3e\n      <div class="n-upload-form-footer">\n        <a class="btnUploadNow btn  btn-primary  btn-control  pull-right"\n           data-loading-text="Processing">\n          Upload Now\n        </a>\n        <a class="btnCancel  btn  btn-control  pull-right">\n          Cancel\n        </a>\n        <div class="n-clearfix"></div>\n      </div>\n    </form>\n    \x3c!-- Processing upload. Toggles with the form\'s visibility. --\x3e\n    <div class="n-upload-processing">\n      <div class="n-inline-loading-container">\n        <div class="n-inline-loading" style="display:block" />\n      </div>\n      Uploading file...\n    </div>\n  </div>\n  \x3c!-- This makes sure that the form will not refresh the page. This could\n       be used when upload form in IE9 is supported. --\x3e\n  <iframe id="uploadTarget" name="upload_target" class="n-upload-target"/>\n</div>'}),define("text!templates/popups/softwareupgrade/FirmwareSoftwareUpgradeStateUpgradingView.html",[],function(){return'\x3c!-- State: Upgrade status template --\x3e\n<div class="n-upgrade-row">\n  \x3c!-- Initial state --\x3e\n  <div class="n-upgrade-initial">\n    <span class="donut-loader-blue"></span> Checking upgrade status...\n  </div>\n  \x3c!-- Global upgrade bar --\x3e\n  <div class="n-upgrade-global-bar-container">\n    <div class="n-upgrade-global-bar-header">\n      <p class="pull-left  globalUpgradeTitle">\n      </p>\n      <p class="pull-right  globalUpgradePercent">\n      </p>\n      <div class="n-clearfix"></div>\n    </div>\n    <div class="globalUpgradeProgressBar">\n      <div class="fillProgress">\n      </div>\n    </div>\n    <div class="n-upgrade-global-bar-footer">\n      <p class="pull-left  globalUpgradeSubtitle">\n      </p>\n      <p class="pull-right">\n        <a class="globalLinkTask">open</a>\n      </p>\n      <div class="n-clearfix"></div>\n    </div>\n  </div>\n  \x3c!-- Upgrade tasks --\x3e\n  <div class="n-upgrade-tasks">\n    \x3c!-- Caret --\x3e\n    <div class="n-container-caret">\n      <div class="n-container-caret-border"></div>\n      <div class="n-container-caret-content"></div>\n    </div>\n    \x3c!-- List of upgrade tasks --\x3e\n    <div class="n-upgrade-tasks-list">\n      \x3c!-- Firmware tasks with their subtasks will be added here... --\x3e\n    </div>\n    <div class="n-upgrade-non-running-tasks-list">\n      \x3c!-- Firmware tasks that are not running currently are listed\n      here... --\x3e\n    </div>\n  </div>\n</div>'}),define("text!templates/popups/softwareupgrade/FirmwareSoftwareUpgradeStateUpgradingTaskRowView.html",[],function(){return'\x3c!-- Task row --\x3e\n<div class="n-upgrade-task-row" dataId="<%= model.entityId %>">\n  \x3c!-- Task header --\x3e\n  <div class="n-upgrade-task-row-header">\n    <p class="pull-left">\n      <span class="rowTaskName">\n        <%= AppUtil.generateKBLinkFromMessage(model.taskName || model.subTaskMessage) %>\n      </span>\n      <span class="rowTaskEntity">\n        <% if (model.entity === AppConstants.ENTITY_NODE ||\n               model.entity === AppConstants.ENTITY_HOST) { %>\n          \x3c!-- TODO: Waiting for infra team to fill host ip (entity name) --\x3e\n          (Host ID: <%= model.entityId %>)\n        <% } %>\n      </span>\n      <span class="n-upgrade-task-label-failed  rowTaskStatus"\n            style="display:\n          <%= (model.status === AppConstants.TASK_STATUS_FAILED ||\n            model.status === AppConstants.TASK_STATUS_CANCELED) ?\n              \'inline-block\' : \'none\' %>">\n        <%= model.status %>\n      <span>\n      <% if (isManualUpgrade) { %>\n        <div class="btnManualReboot" dataId="<%= model.entityId %>">\n          Reboot\n        </div>\n      <% } %>\n    </p>\n    <p class="pull-right rowTaskPercent">\n      <%= model.percentageCompleted %>%\n    </p>\n    <div class="n-clearfix"></div>\n  </div>\n  \x3c!-- Task progress bar --\x3e\n  <div class="n-upgrade-task-row-progress-container">\n    <div class="n-upgrade-task-row-progress rowTaskProgress <%=model.status%>">\n      <div class="fillProgress"\n           style="width:<%= model.percentageCompleted %>%">\n      </div>\n    </div>\n    <% if (model.subTaskList && model.subTaskList.length) { %>\n    <a class="linkRowSubTask" dataId="<%= model.entityId %>">open</a>\n    <% } %>\n  </div>\n  \x3c!-- Subtask rows --\x3e\n  <div class="n-upgrade-subtask-row  rowSubTasks"\n       dataId="<%= model.entityId %>">\n    \x3c!-- Caret --\x3e\n    <div class="n-container-caret">\n      <div class="n-container-caret-border"></div>\n      <div class="n-container-caret-content"></div>\n    </div>\n    \x3c!-- Tabs --\x3e\n    <ul class="n-upgrade-subtask-row-tab">\n      <li class="n-upgrade-tab  tabRowSubTask  active"\n          dataId="<%= model.entityId %>"\n          dataTarget="bar">\n        Subtasks\n      </li>\n      <li class="n-upgrade-tab  tabRowSubTask"\n          dataId="<%= model.entityId %>"\n          dataTarget="log">\n        Details\n      </li>\n    </ul>\n    <div class="n-clearfix"></div>\n    \x3c!-- Tab content: progress bars --\x3e\n    <div class="n-upgrade-subtask-row-tab-content  active"\n         dataId="<%= model.entityId %>"\n         dataTarget="bar">\n      <% _.each( model.subTaskList, function(subTaskModel, subTaskIndex) { %>\n      <% var subTaskId =  model.entityId + \'-\' + subTaskIndex; %>\n      <div class="rowSubTask" dataId="<%= subTaskId %>">\n        \x3c!-- Subtask row header --\x3e\n        <div class="n-upgrade-subtask-row-header  rowSubTaskMessage">\n          <%= subTaskModel.taskTag %>\n        </div>\n        \x3c!-- Subtask row progress --\x3e\n        <div class="n-upgrade-subtask-row-progress-container">\n          <div dataId="<%= subTaskId %>"\n               class="n-upgrade-subtask-row-progress  rowSubTaskProgress\n                        <%= subTaskModel.status %>">\n            <div class="fillProgress"\n                 style="width:<%= subTaskModel.percentageCompleted %>%">\n            </div>\n          </div>\n          <div class="rowSubTaskPercent" dataId="<%= subTaskId %>">\n            <%= subTaskModel.percentageCompleted %>%\n          </div>\n        </div>\n      </div>\n      <% }); %>\n    </div>\n    \x3c!-- Tab content: log messages --\x3e\n    <div class="n-upgrade-subtask-row-tab-content"\n         dataId="<%= model.entityId %>"\n         dataTarget="log">\n      <div class="n-upgrade-log">\n        <% _.each( model.subTaskList, function(subTaskModel, subTaskIndex) { %>\n        <%= subTaskModel.subTaskMessage %><br/>\n        <% }); %>\n      </div>\n    </div>\n  </div>\n</div>'}),define("text!templates/popups/softwareupgrade/FirmwareSoftwareUpgradeStateUpgradingTaskNonRunning.html",[],function(){return'\n<div class="upgrade-non-running-border"></div>\n\n<div class="upgrade-non-running-tasks">\n  <div class="upgrade-non-running-header">\n    <%= heading %>\n  </div>\n  <div class="upgrade-non-running-row">\n\n    <% if (diskMap) {\n      _.each(_.keys(diskMap), function(hostId) { %>\n        <div>\n          <span>Host IP: <%=hostId%> </span>\n\n          <% _.each(diskMap[hostId], function(diskObj) {%>\n            <div class="upgrade-non-running-disk">\n              Disk Location: <%=diskObj.diskId%></div>\n          <% });%>\n        </div>\n    <% }); } else {%>\n\n      <div class="upgrade-non-running-disk">\n        None\n      </div>\n\n    <% } %>\n  </div>\n</div>'}),define("views/popups/softwareupgrade/FirmwareSoftwareUpgradeView",["views/popups/softwareupgrade/SoftwareUpgradeView","models/softwareupgrade/DiskSoftwareUpgradeModel","models/softwareupgrade/BIOSSoftwareUpgradeModel","models/softwareupgrade/BMCSoftwareUpgradeModel","models/softwareupgrade/HBASoftwareUpgradeModel","data/DataProperties","components/Components","utils/SubViewHelper","utils/AppConstants","utils/AppUtil","utils/ManagerMixin","views/popups/softwareupgrade/firmwareupgrade/BIOSFirmwareGroupView","views/popups/softwareupgrade/firmwareupgrade/BMCFirmwareGroupView","views/popups/softwareupgrade/firmwareupgrade/DiskFirmwareGroupView","views/popups/softwareupgrade/firmwareupgrade/HBAFirmwareGroupView","models/hardware/HostCollection","text!templates/popups/softwareupgrade/FirmwareSoftwareUpgradeView.html","text!templates/popups/softwareupgrade/FirmwareSoftwareUpgradeGroupView.html","text!templates/popups/softwareupgrade/FirmwareSoftwareUpgradeStateUpgradingView.html","text!templates/popups/softwareupgrade/FirmwareSoftwareUpgradeStateUpgradingTaskRowView.html","text!templates/popups/softwareupgrade/FirmwareSoftwareUpgradeStateUpgradingTaskNonRunning.html","text!templates/popups/softwareupgrade/HypervisorAuthenticationTemplate.html"],function(e,t,n,i,s,a,o,r,l,c,d,p,u,h,m,f,v,g,E,T,C,S){"use strict";var A=_.template(v),b=_.template(g),y=_.template(E),I=_.template(T),w=_.template(C),P=_.template(S),N=l.TASK_STATUS_CANCELED+" "+l.TASK_STATUS_FAILED+" "+l.TASK_STATUS_COMPLETE+" "+l.TASK_STATUS_ACTIVE+" "+l.TASK_STATUS_QUEUED;return e.extend({SUBTITLE_DISK:" disk(s)",SUBTITLE_HOST:" host(s)",name:"FirmwareSoftwareUpgradeView",parentViewName:"SoftwareUpgradeView",cvmRebootRequired:d.getClusterManager().isOneNodeCluster(),DiskSoftwareUpgradeModel:null,BIOSSoftwareUpgradeModel:null,BMCSoftwareUpgradeModel:null,HBASoftwareUpgradeModel:null,subViewHelper:null,subtitleEntity:null,events:{"change .firmwareType":"onChangeFirmwareType","click  .upgrade-avail-link":"onClickUpgradeAvailable","click  .hide-link":"onClickHideUpgradeAvailable","click  .linkUpload":"onClickLinkUpload","click  .btnCancel":"onClickUploadCancel","click  .btnUploadNow":"onClickUploadNow","click  .btnDelete":"onClickDelete","click  .btnDownload":"onClickDownload","click  .btnFailed":"onClickFailed","click  .btnCorrupted":"onClickDelete","click  .btnStop":"onClickStop","click  .btnResume":"onClickResume","click  .btnUpgrade":"onClickUpgrade","click  .btnPreUpgrade":"onClickPreUpgrade","click  .globalLinkTask":"onClickLinkTask","click  .linkRowSubTask":"onClickLinkRowSubTask","click  .tabRowSubTask":"onClickTabSubTask","click  .btnBackProgress":"onClickBackProgress","click  .btnBackVersion":"onClickBackVersion","change .firmwareUpgradeVersion":"onChangeFirmwareUpgradeVersion"},initialize:function(){this.subViewHelper=new r,this.BIOSSoftwareUpgradeModel=new n,this.BMCSoftwareUpgradeModel=new i,this.DiskSoftwareUpgradeModel=new t,this.HBASoftwareUpgradeModel=new s,this.subtitleEntity=this.SUBTITLE_DISK,e.prototype.initialize.apply(this,arguments),_.extend(this.modelEvents,{"change.disableSelectionOptions model":"onChangeDisableSelection"}),this.setDefaultSubView()},render:function(e){return this._renderViewContent(e),this},_renderViewContent:function(e){this.$el.html(A({softwareType:this.softwareType,canModify:this.canModifyByEntityType(l.ENTITY_UPGRADE),is2048Disabled:e,viewName:this.parentViewName})),this.applyAntiScroll(100)},createSoftwareUpgradeModelInstance:function(){return this.DiskSoftwareUpgradeModel},setDefaultSubView:function(){var e=new h({model:this.model});e.setParentView(this),this.subViewHelper.register(l.UPGRADE_SOFTWARE_TYPE.FIRMWARE_DISK,e)},onChangeFirmwareUpgradeVersion:function(e){var t=$(e.currentTarget).val();this.getCurrentGroupView().handleFirmwareVersionChange(t)},setUpgradeViewModel:function(){var e=this.model.get(a.UPGRADE_SOFTWARE_UPGRADING);switch(e){case l.UPGRADE_SOFTWARE_TYPE.FIRMWARE_DISK:this.model=this.DiskSoftwareUpgradeModel;break;case l.UPGRADE_SOFTWARE_TYPE.FIRMWARE_BIOS:this.model=this.BIOSSoftwareUpgradeModel;break;case l.UPGRADE_SOFTWARE_TYPE.FIRMWARE_BMC:this.model=this.BMCSoftwareUpgradeModel;break;case l.UPGRADE_SOFTWARE_TYPE.FIRMWARE_HBA:this.model=this.HBASoftwareUpgradeModel}this.delegateModelEvents(),this.model.setProperty(a.UPGRADE_SOFTWARE_UPGRADING,e)},onChangeFirmwareType:function(e){var t=this.$(e.currentTarget).attr("value");this.model.stopPollingSoftwareReleases();var n=this.subViewHelper.get(t);switch(t){case l.UPGRADE_SOFTWARE_TYPE.FIRMWARE_DISK:this.model=this.DiskSoftwareUpgradeModel,n=n||new h({model:this.model});break;case l.UPGRADE_SOFTWARE_TYPE.FIRMWARE_BIOS:this.model=this.BIOSSoftwareUpgradeModel,n=n||new p({model:this.model});break;case l.UPGRADE_SOFTWARE_TYPE.FIRMWARE_BMC:this.model=this.BMCSoftwareUpgradeModel,n=n||new u({model:this.model});break;case l.UPGRADE_SOFTWARE_TYPE.FIRMWARE_HBA:this.model=this.HBASoftwareUpgradeModel,n=n||new m({model:this.model})}n.setParentView(this),this.delegateModelEvents(),this.subViewHelper.register(t,n),this.model.setSelectedFirmwareType(t),this.model.startPollingSoftwareReleases(),this._showBackToProgress();var i=this;this.model.fetchCurrentVersion(function(){i.renderFirmwareGroups(),i._adjustViewRelatedVisibility()})},getCurrentGroupView:function(){var e=this.model.getSelectedFirmwareType();return this.subViewHelper.get(e)},getUpgradeTemplate:function(){return y},executeStateUpgradeView:function(){this.setUpgradeViewModel(),e.prototype.executeStateUpgradeView.apply(this,arguments)},executeStateVersionView:function(){if(!this.isStateVersionView()){this._checkIfNXCluster().done(function(e){var t=e.onlyDisk||d.getClusterManager().isOneNodeCluster();this.$(".n-state-content").empty(),this.model.startPollingSoftwareReleases(),this.displaySelectAndUploadsSection(t),this.renderFirmwareGroups(),this.$(".n-game-message").hide(),this.$(".btnBackVersion").hide(),this.showBackToProgress()}.bind(this))}},isStateVersionView:function(){return this.$(".firmwareGroup").length},_checkIfNXCluster:function(){var e=new f,t=$.Deferred();return e.fetch({success:function(e,n){if(e&&e.length){var i=e.at(0).getBlockModelName();i&&(i.toLowerCase().indexOf("nx")>=0||i.toLowerCase().indexOf("sx"))>=0?t.resolve({onlyDisk:!1}):t.resolve({onlyDisk:!0})}else t.resolve({onlyDisk:!0})}}),t.promise()},_showBackToProgress:function(){this.model.isGlobalUpgradeComplete()||this.model.isPreupgradeCheckFailed()||this.preupgradeModel&&this.preupgradeModel.isStatusComplete()&&this.model.get(a.UPGRADE_IGNORE_UPGRADE)?this.$(".btnBackProgress").show():this.$(".btnBackProgress").hide()},_adjustViewRelatedVisibility:function(){var e=this.model.getSelectedFirmwareType(),t=this.$(".firmwareVersionsSelection");e===l.UPGRADE_SOFTWARE_TYPE.FIRMWARE_DISK&&t.hide()},renderFirmwareGroups:function(){this.model.makeFirmwareMap(),this.getCurrentGroupView().renderFirmwareGroup()},onSoftwareReleasesChange:function(){this.model.makeFirmwareMap(),this.checkPrismInfoHeaderError(this.model.get(a.UPGRADE_SOFTWARE_RELEASES)),this.getCurrentGroupView().renderSoftwareReleasesChange()},onCurrentVersionChange:function(){this.model.isStateVersion()&&!this.model.get("disksGroupDisplayed")&&this.onStateChange()},onClickUpgradeAvailable:function(e){var t;t=$(e.currentTarget).attr("data-model"),this.getCurrentGroupView().renderFirmwareReleaseList(t),$(e.currentTarget).hide(),this.$(".hide-link[data-model='"+t+"']").show(),this.$(".upgrades-container[data-model='"+t+"']").show(),this.applyAntiScroll()},onClickHideUpgradeAvailable:function(e){var t;t=$(e.currentTarget).attr("data-model"),$(e.currentTarget).hide(),this.$(".upgrade-avail-link[data-model='"+t+"']").show(),this.$(".upgrades-container[data-model='"+t+"']").hide(),this.applyAntiScroll()},onClickPreUpgrade:function(e){var t=$(e.currentTarget).attr("dataId"),n=$(e.currentTarget).attr("data-model");this._setLocalStorage(t,!0,!1,!1),n=n||this.getSupportedModelList(t),this._confirmUpgrade(t,n,!1,!1,!0)},getSupportedModelList:function(e){var t="",n=this.model.getSelectedFirmwareType();return n!==l.UPGRADE_SOFTWARE_TYPE.FIRMWARE_BMC&&n!==l.UPGRADE_SOFTWARE_TYPE.FIRMWARE_BIOS&&n!==l.UPGRADE_SOFTWARE_TYPE.FIRMWARE_HBA||(t=this.getCurrentGroupView().getSupportedModelList(e)),t},onClickUpgrade:function(e){var t=$(e.currentTarget).attr("dataId"),n=$(e.currentTarget).attr("data-model"),i=!1,s=!1;e.shiftKey&&e.altKey?i=!0:(e.ctrlKey||e.metaKey)&&(s=!0),n=n||this.getSupportedModelList(t),this._setLocalStorage(t,s,i,!1),this._confirmUpgrade(t,n,!1,i,s)},_setLocalStorage:function(e,t,n,i){c.hasLocalStorage()&&(localStorage[a.UPGRADE_VERSION_ID]=e,localStorage[a.UPGRADE_IGNORE_UPGRADE]=t,localStorage[a.UPGRADE_IGNORE_PREUPGRADE]=n,localStorage[a.UPGRADE_MANUAL_UPGRADE]=i)},_confirmUpgrade:function(e,t,n,i,s){var o,r,l=this.model.getSoftwareRelease(e);if(!l)throw new Error("Software release, "+e+", does not exist.");o=l.get(a.UPGRADE_VERSION),o||this.showHeaderError("Version ID of the software release, "+e+", does not exist."),(r=l.get(a.UPGRADE_MD5SUM))||this.showHeaderError("Version Checksum of the software release, "+e+", does not exist.");var d=c.sprintf(this.UPGRADE_CONFIRM,o);i&&(d+=this.NO_CHECK_WARNING),s&&!i&&(d="Do you want to run pre-upgrade tests only?"),this._confirmDialog(o,r,t,n,i,s,d)},_confirmDialog:function(e,t,n,i,s,a,o){var r=this;switch(this.model.getSelectedFirmwareType()){case l.UPGRADE_SOFTWARE_TYPE.FIRMWARE_DISK:case l.UPGRADE_SOFTWARE_TYPE.FIRMWARE_HBA:this._confirmFirmwareUpgrade(e,t,n,i,s,a,o);break;case l.UPGRADE_SOFTWARE_TYPE.FIRMWARE_BMC:case l.UPGRADE_SOFTWARE_TYPE.FIRMWARE_BIOS:this.checkGpuBeforeUpgrade(o,function(o,l){r._confirmBiosBmcUpgrade(e,t,n,i,s,a,o,l)})}},_confirmBiosBmcUpgrade:function(e,t,n,i,s,a,o,r){var l="",c="",d=!1;c=a?this.i18n("runTests"):this.i18n("upgradeNow"),this.model.isVCenterUsed()&&(l=P({serverDetails:"vCenter IP Address:"}),d=!0),$.nutanixConfirm({class:r?"-left-align":"",msg:o,yes:function(){var o=null,r=null,l=null;d&&(o=$("#nutanixConfirmModal .username-auth").val().trim(),r=$("#nutanixConfirmModal .password-auth").val().trim(),l=$("#nutanixConfirmModal .host-details").val().trim()),this.model.stopPollingSoftwareReleases(),this.startUpgrade({versionId:e,versionChecksum:t,softwareReleaseFWGrpModel:n,isManualUpgrade:i,isIgnorePreupgradeTests:s,isIgnoreUpgrade:a,username:o,password:r,hostDetails:l})},yesText:c,noText:this.i18n("cancel"),extHTML:l,captcha:function(){if(d){var e=$("#nutanixConfirmModal .username-auth").val().trim(),t=$("#nutanixConfirmModal .password-auth").val().trim(),n=$("#nutanixConfirmModal .host-details").val().trim();return!(_.isEmpty(e)||_.isEmpty(t)||_.isEmpty(n))||($("#nutanixConfirmModal .n-popup-captcha-error").html("All fields are required.").show(),!1)}return!0},context:this})},_confirmFirmwareUpgrade:function(e,t,n,i,s,a,o){$.nutanixConfirm({msg:o,yes:function(){var o=this;this.platformStateChecks(function(){o.model.stopPollingSoftwareReleases(),o.startUpgrade({versionId:e,versionChecksum:t,softwareReleaseFWGrpModel:n,isManualUpgrade:i,isIgnorePreupgradeTests:s,isIgnoreUpgrade:a})})},no:function(){this.model.startPollingSoftwareReleases()},yesText:"Yes",noText:"No",context:this})},startUpgrade:function(e){var t=this;this.setLastUpgradeWarningTime(),this.$(".btn-control").css("opacity",.5).attr("disabled",!0),e.successCallback=e.errorCallback=function(){t.$(".btn-control").css("opacity",1).removeAttr("disabled")},this.model.startUpgrade(e)},getGlobalProgressInfo:function(){var e="Upgrading Firmware ";this.model.get(a.UPGRADE_UPGRADING_NODE);switch(this.model.getSoftwareType()){case l.UPGRADE_SOFTWARE_TYPE.FIRMWARE_BIOS:e=l.TASK_OPERATION_LABELS.upgrade_firmware_bios;break;case l.UPGRADE_SOFTWARE_TYPE.FIRMWARE_BMC:e=l.TASK_OPERATION_LABELS.upgrade_firmware_bmc;break;case l.UPGRADE_SOFTWARE_TYPE.FIRMWARE_HBA:e=l.TASK_OPERATION_LABELS.upgrade_firmware_hba}return{title:e,subtitleEntity:""}},updateUpgradeProgressBars:function(e){var t,n,i,s,o,r=_.groupBy(e,function(e){return e.get(a.UPGRADE_STATUS)}),l=this.getUpgradeTasksToBeDisplayed(r);_.each(l,function(e,r){n=e.get(a.TASK_ENTITY_ID),n?(this.model.set(a.UPGRADE_UPGRADING_NODE,this.parseEntityId(n)),t=this.$('.n-upgrade-task-row[dataid="'+n+'"]')):t=this.$(this.$(".n-upgrade-task-row")[r]);var l=e.get(a.TASK_NAME);e.isStatusFailed()&&(l=e.getFailedTaskMessageWithKBLink()),t.find(".rowTaskName").html(l),t.find(".rowTaskPercent").html(e.get(a.TASK_PERCENT_COMPLETE)+"%"),e.isStatusFailed()||e.isStatusCanceled()?t.find(".rowTaskStatus").show():t.find(".rowTaskStatus").hide(),s=this.model.get(a.TASK_PERCENT)||0,o=e.get(a.TASK_PERCENT_COMPLETE),i=s>o?"fillProgressWithoutAnimation":"",this.model.set(a.TASK_PERCENT,o),t.find(".rowTaskProgress").removeClass(N).addClass(e.get(a.TASK_STATUS)).find(".fillProgress").removeClass("fillProgressWithoutAnimation").addClass(i).css("width",e.get(a.TASK_PERCENT_COMPLETE)+"%"),_.each(e.get(a.TASK_SUB_TASKS),function(e,r){var l=n+"-"+r,c=t.find('.rowSubTask[dataId="'+l+'"]');c.find(".rowSubTaskMessage").html(e[a.SUB_TASK_MESSAGE]),s=this.model.get(a.SUBTASK_PERCENT)||0,o=e[a.TASK_PERCENT_COMPLETE],i=s>o?"fillProgressWithoutAnimation":"",this.model.set(a.SUBTASK_PERCENT,o),c.find(".rowSubTaskProgress").removeClass(N).addClass(e[a.TASK_STATUS]).find(".fillProgress").removeClass("fillProgressWithoutAnimation").addClass(i).css("width",e[a.TASK_PERCENT_COMPLETE]+"%"),c.find(".rowSubTaskPercent").html(e[a.TASK_PERCENT_COMPLETE]+"%")},this)},this),this._displayNonRunningDiskInformation(r)},updateGlobalProgressBar:function(t){e.prototype.updateGlobalProgressBar.apply(this,arguments),100===t.percent&&this.$(".n-upgrade-task-row").remove()},createUpgradeProgressBars:function(e){if(this.$(".n-upgrade-tasks-list").empty(),e){var t=!1,n=_.groupBy(e,function(e){return e[a.UPGRADE_STATUS]?(t=!0,e[a.UPGRADE_STATUS]):e.get(a.UPGRADE_STATUS)}),i=this.getUpgradeTasksToBeDisplayed(n);_.each(i,function(e){if(this.$(".n-upgrade-tasks-list").append(I(this.vtOptions({model:e.toJSON?e.toJSON():e,isManualUpgrade:this.model.isManualUpgrade(),AppConstants:l}))),!t){var n=e.getValue(a.TASK_ENTITY_ID);n&&this.model.set(a.UPGRADE_UPGRADING_NODE,this.parseEntityId(n))}},this),t||this._displayNonRunningDiskInformation(n)}},getUpgradeTasksToBeDisplayed:function(e){var t=this.model.getSoftwareType();return t===l.UPGRADE_SOFTWARE_TYPE.DISKS?e[l.TASK_STATUS_ACTIVE]:_.flatten(_.values(e))},hideUpgradesContainer:function(){this.$(".upgrades-container").hide(),this.$(".hide-link").hide()},displaySelectAndUploadsSection:function(e){this.$(".n-state-initial").remove(),this.$(".n-state-content").html(b({softwareTypeState:this.model.softwareTypeState,showOnlyDisk:e,overwriteCheckbox:o.checkbox({jsClasses:"overwrite",name:"overwrite"})}));var t=this.model.getSelectedFirmwareType();this.$('.firmwareType option[value="'+t+'"]').attr("selected","selected"),this.$("select.firmwareType").nutanixInput({type:"select"})},_displayNonRunningDiskInformation:function(e){if(this.model.getSoftwareType()===l.UPGRADE_SOFTWARE_TYPE.DISKS){var t;t=this.model.collectDiskInformation(e),t?(this.$(".n-upgrade-non-running-tasks-list").empty(),_.each(_.keys(t),function(e){this.$(".n-upgrade-non-running-tasks-list").append(w({heading:l.TASK_STATUS_STRING_DISK[e],diskMap:t[e]}))},this)):c.addInlineSpinner(this.$(".n-upgrade-non-running-tasks-list"))}},onChangeDisableSelection:function(){this._enableDisableSelectionDropdowns(this.model.get("disableSelectionOptions"))},_enableDisableSelectionDropdowns:function(e){var t=this.$(".firmwareType"),n=this.$(".firmwareUpgradeVersion");e?(t.trigger("disable"),n&&n.trigger("disable")):(t.trigger("enable"),t.trigger("update"),n&&(n.trigger("enable"),n.trigger("update")))}})}),define("models/softwareupgrade/PrismCentralSoftwareUpgradeModel",["models/softwareupgrade/SoftwareUpgradeModel","models/version/VersionModel","data/DataProperties","utils/AppConstants"],function(e,t,n,i){"use strict";return e.extend({name:"PrismCentralSoftwareUpgradeModel",softwareTypeState:i.UPGRADE_SOFTWARE_TYPE_STATE.PRISM_CENTRAL,isValidateMetadataBeforeUpload:!0,getSoftwareType:function(e){return i.UPGRADE_SOFTWARE_TYPE.PRISM_CENTRAL},createVersionModelInstance:function(){return new t},getSoftwareCurrentVersion:function(){var e=this.get(n.UPGRADE_VERSION_MODEL);if(e)return e.getCurrentVersion()}})}),define("views/popups/softwareupgrade/PrismCentralSoftwareUpgradeView",["views/popups/softwareupgrade/SoftwareUpgradeView","models/softwareupgrade/PrismCentralSoftwareUpgradeModel","managers/I18nManager"],function(e,t,n){"use strict";return e.extend({name:"PrismCentralSoftwareUpgradeView",createSoftwareUpgradeModelInstance:function(){return new t},onClickDownload:function(e){var t=$(e.currentTarget).attr("dataId");$.nutanixConfirm({msg:n.ts(this.name,"doYouWantToDownload",t),yes:function(){this.startDownload(t)},yesText:n.t("Common","yes"),noText:n.t("Common","no"),context:this})},startDownload:function(e){this.$('[dataId="'+e+'"]').css("opacity",.5).attr("disabled",!0),this.$('tr[dataId="'+e+'"] .loaderRow').show(),this.model.downloadSoftwareRelease(e),this.resetUploadForm()}})}),define("views/popups/softwareupgrade/FileServerSoftwareUpgradeView",["views/popups/softwareupgrade/SoftwareUpgradeView","models/softwareupgrade/FileServerSoftwareUpgradeModel","data/DataProperties","managers/ActionManager","managers/I18nManager","utils/AppConstants","utils/AppUtil"],function(e,t,n,i,s,a,o){"use strict";return e.extend({name:"FileServerSoftwareUpgradeView",UPGRADE_CONFIRM:s.t("FileServerSoftwareUpgradeView","upgrade_confirm_msg")+s.t("FileServerSoftwareUpgradeView","upgrade_warning_msg"),initialize:function(){e.prototype.initialize.apply(this,arguments),this.model.on("change.currentVersionModel",this.checkAndDisableUpgradeButton,this),this.model.on("change.currentVersionModel",this.checkAndShowDeployMessage,this)},createSoftwareUpgradeModelInstance:function(){return new t},onSoftwareReleasesChange:function(){var t=this.model&&this.model.get(n.UPGRADE_SOFTWARE_RELEASES)&&this.model.get(n.UPGRADE_SOFTWARE_RELEASES).models,i=this.clusterManager.getCurrentClusterModel();if(i.get(n.CLUSTER_NUM_NODES)<3&&t){var s=[];_.each(t,function(e){o.compareVersions(i.get(n.VERSION),a.AOS_VERSIONS.FIVE_DOT_EIGHT)>=0&&o.compareVersions(e.get(n.VERSION),a.FILE_SERVER_VERSIONS.THREE_DOT_ONE)>=0&&s.push(e)}),this.model.get(n.UPGRADE_SOFTWARE_RELEASES).models=s}e.prototype.onSoftwareReleasesChange.apply(this),this.checkAndDisableUpgradeButton(),this.checkAndShowDeployMessage()},checkAndDisableUpgradeButton:function(){var e=this;this.$(".btnUpgrade").each(function(){var t=$(this).attr("dataId"),n=$(this);e.model.hasDeployedFileServers()?(n.attr("dataContinue",!1),e.model.isUpgradableFromCurrentFS(t)?n.prop("disabled",!1).text("Upgrade"):(n.prop("disabled",!0).text("Upgrade"),e.model.isCompatibleWithCurrentNos(t)||n.closest("tr").find(".n-requirements").removeClass("hidden").text("Requires at least Acropolis "+e.model.getMinimalNosVersion(t)))):n.prop("disabled",!1).attr("dataContinue",!0).text("Continue")})},checkAndShowDeployMessage:function(){var e=this.model.subModelHelper.get(n.UPGRADE_SOFTWARE_RELEASES),t=e.some(function(e){return e.get("status")===a.UPGRADE_SOFTWARE_RELEASE_STATUS.COMPLETED});this.model.subModelHelper.get(n.UPGRADE_VERSION_MODEL).getState()===a.STATE_PENDING||this.model.hasDeployedFileServers()||!t?this.$(".deployment-msg").remove():0===this.$(".deployment-msg").length&&this.$(".n-state-content").prepend('<div class="deployment-msg">AFS software added, please proceed to the File Server page to deploy</div>')},confirmUpgrade:function(t,i,s,r){if(!this.model.getSoftwareRelease(t))throw new Error("Software release, "+t+", does not exist.")
;var l=o.compareVersions(t,a.FILE_SERVER_VERSIONS.THREE_DOT_ONE)>=0,c=this.clusterManager.getCurrentClusterModel().get(n.CLUSTER_NUM_NODES);l&&c<3&&(this.UPGRADE_CONFIRM=this.i18n("one_node_upgrade_confirm_msg")),e.prototype.confirmUpgrade.apply(this,arguments)},onClickUpgrade:function(t){if("true"===$(t.currentTarget).attr("dataContinue")){var n={};return n[a.NAV_ACTION]=a.ACTION_CREATE,n[a.NAV_ACTION_TARGET]=a.ENTITY_FILE_SERVER,this.$el.closest("#popupSoftwareUpgrade").find("button.close").click(),void i.executeAction(n)}e.prototype.onClickUpgrade.apply(this,arguments)},getGlobalProgressInfo:function(e){var t=e.get(n.TASK_NAME);return t=o.generateKBLinkFromMessage(t),{title:t,subtitleEntity:" file server(s)"}},onCurrentVersionChange:function(){var e,t=this.model.getFSNameVersionMap();e=_.size(t)>1?_.map(t,function(e,t){return'<div><span class="fs-name">'+t+'</span><span class="fs-version">'+e+"</span></div>"}):_.map(t,function(e,t){return'<div><span class="fs-version">'+e+"</span></div>"}),this.$(".lblCurrentVersion").html(e.join("")),e.length>1?this.$(".n-version-row:first .n-title").text("CURRENT VERSIONS"):this.$(".n-version-row:first .n-title").text("CURRENT VERSION")}})}),define("text!templates/popups/softwareupgrade/SoftwareUpgradePopupView.html",[],function(){return'\x3c!-- The parent div modal is #popupSoftwareUpgrade --\x3e\n<div class="modal-header">\n  <button type="button" class="close" data-dismiss="modal">\n    <i data-icon="K" aria-hidden="true"></i>\n  </button>\n  <h4 class="n-title">\n    <% if (isPC) { %>\n      <%= i18n(\'upgradePC\') %>\n    <% } else { %>\n      <%= i18n(\'upgradeSoftware\') %>\n    <% } %>\n  </h4>\n</div>\n<div class="n-modal-wrapper">\n  <% if (softwareTypeTabs) { %>\n  <div class="n-modal-tabs">\n    <ul class="n-modal-tab-header">\n      <% _.each( _.keys(softwareTypeTabs), function(key, index) { %>\n        <% if (index > 0) { %>\n          <li class="sep">&middot;</li>\n        <% } %>\n        <li type="<%= softwareTypeTabs[key] %>"\n            class="tabSoftwareType" stream-action="select"\n            stream-target="<%= softwareTypeTabs[key] %>">\n          <%= softwareTypeLabels[key] %>\n        </li>\n      <% }); %>\n    </ul>\n    <div class="n-modal-tab-content-holder">\n      \x3c!-- Content will be dynamically created here --\x3e\n    </div>\n  </div>\n  <% } else { %>\n  <div class="n-modal-body">\n    <div class="n-modal-content-wrapper">\n      <div class="n-modal-content">\n        <div class="n-no-access">\n          <%= reason %>\n        </div>\n      </div>\n    </div>\n  </div>\n  <div class="n-modal-footer">\n    <button class="btnClose btn btn-primary n-btn-form">\n      <%= i18n(\'close\') %>\n    </button>\n  </div>\n  <% } %>\n</div>'}),define("views/popups/softwareupgrade/SoftwareUpgradePopupView",["views/basecomponents/popups/BasePopupView","models/cluster/ClusterCollection","models/softwareupgrade/SoftwareUpgradePopupModel","models/genesis/LCMActionModel","data/DataURLConstants","data/DataProperties","managers/AppManager","managers/ClusterManager","managers/CommunityEditionManager","managers/ActionManager","managers/HelpManager","managers/LicenseManager","managers/NavigationManager","managers/AccessManager","utils/AppConstants","utils/AppUtil","utils/CommonTemplates","utils/SubViewHelper","utils/HypervisorUtil","utils/ManagerMixin","views/popups/softwareupgrade/NOSSoftwareUpgradeView","views/popups/softwareupgrade/HypervisorSoftwareUpgradeView","views/popups/softwareupgrade/NCCSoftwareUpgradeView","views/popups/softwareupgrade/FoundationSoftwareUpgradeView","views/popups/softwareupgrade/DockerSoftwareUpgradeView","views/popups/softwareupgrade/FirmwareSoftwareUpgradeView","views/popups/softwareupgrade/PrismCentralSoftwareUpgradeView","views/popups/softwareupgrade/FileServerSoftwareUpgradeView","models/systemdata/SystemDataModel","text!templates/popups/softwareupgrade/SoftwareUpgradePopupView.html"],function(e,t,n,i,s,a,o,r,l,c,d,p,u,h,m,f,v,g,E,T,C,S,A,b,y,I,w,P,N,R){"use strict";var D=_.template(R);return e.extend({el:"#popupSoftwareUpgrade",subViewHelper:null,defaultTab:null,name:"SoftwareUpgradePopupView",inProgress:!1,events:{"click  .tabSoftwareType":"onClickTabSoftwareType","click  .btnClose":"hide","click  .modal-header .close":"hide","click  #linkPlayEasterEgg":"onClickEET","click .lcm-link":"onLCMClick"},modelEvents:{"change:currentSoftwareType  model":"onChangeStateSoftwareType"},deprecatedUpdates:null,lcmUpdates:null,lcmLinkTemplate:_.template('<a class="lcm-link" action="show" actionTarget="lcm_entity"><%= i18n("gotoLCM") %></a>'),currentViewType:null,initialize:function(){e.prototype.initialize.apply(this,arguments),this.model=new n,this.subViewHelper=new g,r.isMulticlusterNavMode()?(this.defaultTab=m.UPGRADE_SOFTWARE_TYPE_STATE.PRISM_CENTRAL,this.initialized=!this._needToCheckClusterRFNumber()):(this.defaultTab=m.UPGRADE_SOFTWARE_TYPE_STATE.NOS,this.initialized=!0),this.lcmUpdates=[],this.deprecatedUpdates=[]},render:function(){var e=this;if(this.initialized)this._render(!0);else{var n=new t;n.url=s.CLUSTER,n.fetch().then(function(){e.initialized=!0,e.inProgress=e._isAddNodeInProgress(n),e._render(!1)},function(t){var n=f.processThrownError(t);e._showUpgradeNotAllowedReason(n)}),this.$el.html(v.LOADING_MSG({msg:this.i18n("loading")}))}return this},hide:function(){e.prototype.hide.apply(this,arguments),this.actionRoute.fsPrecheckFlow&&c.executeAction({action:m.ACTION_CREATE,actionTarget:m.ENTITY_FILE_SERVER})},confirmHide:function(e){var t=this.model.getCurrentSoftwareType(),n=this.subViewHelper.get(t);n?n.confirmHide(e):e()},destroy:function(){this.subViewHelper&&(this.subViewHelper.iterate("stopServices"),this.subViewHelper.removeAll()),e.prototype.destroy.apply(this,arguments)},navigateToHelpPage:function(e){this.model.get(a.UPGRADE_CURRENT_SOFTWARE_TYPE)===m.UPGRADE_SOFTWARE_TYPE_STATE.HYPERVISOR&&(e.action=m.TASK_OPERATION_TYPES[m.UPGRADE_SOFTWARE_TYPE.HYPERVISOR]),d.navigationToHelpPage(this.getHelpUrl(e))},onChangeStateSoftwareType:function(){var e,t,n=this,i=this.model.getCurrentSoftwareType(),s=this.subViewHelper.get(i),o=this.model.getPreviousSoftwareType(),r=this.subViewHelper.get(o);if(this.$(".tabSoftwareType").removeClass("active"),this.$('.tabSoftwareType[type="'+i+'"]').addClass("active"),r&&(this.$(".n-modal-tabs").addClass("cover"),e=r.model.get(a.UPGRADE_STATE),t=r.model.get(a.UPGRADE_SOFTWARE_UPGRADING)),s)this.showSubview(s,t,e,r);else{switch(i){case m.UPGRADE_SOFTWARE_TYPE_STATE.NOS:s=new C;break;case m.UPGRADE_SOFTWARE_TYPE_STATE.HYPERVISOR:s=new S;break;case m.UPGRADE_SOFTWARE_TYPE_STATE.FIRMWARE:s=new I;break;case m.UPGRADE_SOFTWARE_TYPE_STATE.NCC:s=new A;break;case m.UPGRADE_SOFTWARE_TYPE_STATE.PRISM_CENTRAL:s=new w;break;case m.UPGRADE_SOFTWARE_TYPE_STATE.FOUNDATION:s=new b;break;case m.UPGRADE_SOFTWARE_TYPE_STATE.DOCKER:s=new y;break;case m.UPGRADE_SOFTWARE_TYPE_STATE.FILE_SERVER:s=new P}s.on(s.viewEvents.LEAVE_VIEW,function(){return n.hide(!0)}),this.subViewHelper.register(i,s);var l=new N({type:a.SYSTEM_DATA_TYPE_UI_CONFIG},{enableNotifications:!1}),c=this,d=!0;l.fetch().done(function(){d=l.is2048Disabled()}).always(function(){c.$(".n-modal-tab-content-holder").append(s.render(d).el),c.showSubview(s,t,e,r)})}},showSubview:function(e,t,n,i){if(t&&e.model.setProperty(a.UPGRADE_SOFTWARE_UPGRADING,t),e.startServices(),n&&e.model.setProperty(a.UPGRADE_STATE,n),i&&(i.stopServices(),i.hide()),e.show(),this.$(".n-modal-tabs").removeClass("cover"),this.lcmUpdates&&this.lcmUpdates.indexOf(this.model.getCurrentSoftwareType())>=0){var s=this.i18ns("updateLabel",this._getSoftwareTypeLabel(this.model.getCurrentSoftwareType())),o=this.lcmLinkTemplate(this.vtOptions({}));e.showHeaderInfo(s+" "+o)}},_getUnsupportedTabs:function(){var e,t=r.getCurrentClusterId(),n=(e={},_defineProperty(e,m.UPGRADE_SOFTWARE_TYPE_STATE.HYPERVISOR,this.isClusterFFEnabled(m.FFLAGS.HYPER_FIRMWARE_UPGRADE)),_defineProperty(e,m.UPGRADE_SOFTWARE_TYPE_STATE.NCC,this.isClusterFFEnabled(m.FFLAGS.NCC_FIRMWARE_UPGRADE)),_defineProperty(e,m.ENTITY_NAMES[m.ENTITY_FILE_SERVER],!p.hasXPressLicense()&&!r.isPowerPcCluster()&&!E.hasHyperV(t)),_defineProperty(e,m.UPGRADE_SOFTWARE_TYPE_STATE.FIRMWARE,!r.isTwoNodeCluster()),e),i=[];return Object.keys(n).forEach(function(e){n[e]||i.push(e)}),i},onClickTabSoftwareType:function(e){var t=$(e.currentTarget).attr("type");this.model.setCurrentSoftwareType(t)},onClickEET:function(){this.hide(),o.showEE(m.EET)},onLCMClick:function(e){u.navigateToPage(m.PAGE_SETTINGS,m.ENTITY_LCM)},_showUpgradeNotAllowedReason:function(e){this.$el.html(D(this.vtOptions({softwareTypeTabs:null,softwareTypeLabels:null,reason:e,canModify:this.canModifyByEntityType(m.ENTITY_UPGRADE),isPC:r.isMulticlusterNavMode()})))},_needToCheckClusterRFNumber:function(){var e=T.getTaskManager().getGlobalTasks().getLatestPCAddNodeTask();if(e){var t=e.isTaskCompleted();return this.inProgress=!t,t}return this.inProgress=!1,!1},_isAddNodeInProgress:function(e){var t=e.at(0);return!!t&&!t.isDesiredRFReached()},_isPCDeploymentInProgress:function(){var e=T.getTaskManager(),t=e.getGlobalTasks().getLatestPcDeploymentTask(),n=T.getTaskManager().getGlobalTasks().getLatestRemotePcDeploymentTask();return!!(t&&!t.isTaskCompleted()||n&&!n.isTaskCompleted())},_getInitialTab:function(){return this.actionRoute[m.NAV_ACTION_TARGET_ID]===m.ENTITY_FILE_SERVER?m.UPGRADE_SOFTWARE_TYPE_STATE.FILE_SERVER:this.defaultTab},_getSoftwareTypeLabel:function(e){return e===m.UPGRADE_SOFTWARE_TYPE_STATE.NOS?m.UPGRADE_SOFTWARE_TYPE_LABEL.NOS:e},_parseLCMConfig:function(e){if(e.hasErrorResponse())this.lcmUpdates=[],this.deprecatedUpdates=[];else{var t=e.getReturnResponse();this.lcmUpdates=t[i.DP.SUPPORTED_LCM_UPDATE_ENTITIES]||[],this.deprecatedUpdates=t[i.DP.DEPRECATED_ONECLICK_UPDATE_ENTITIES]||[]}},_render:function(e){var t=this;if(this.inProgress||!r.isMulticlusterNavMode()&&this._isPCDeploymentInProgress())return void this._showUpgradeNotAllowedReason(this.i18n("pcscaleOutInProgress"));if(h.isClusterAdmin()){e&&this.$el.html(v.LOADING_MSG({msg:this.i18n("loading")}));try{var n=new i;n.setRPCParams(i.LCM_ACTIONS.GET_CONFIG),n.save().always(function(){t._parseLCMConfig(n),t._renderTabs()})}catch(e){f.log("Error fetch LCM config data "+e),this._renderTabs(),this.onChangeStateSoftwareType()}}else this._renderTabs(),this.onChangeStateSoftwareType()},_renderTabs:function(){var e,t=void 0,n=this._getSupportedTabs();t=_.filter(m.UPGRADE_SOFTWARE_TYPE_STATE,function(e){return _.indexOf(n,e)>=0});var i=this._getUnsupportedTabs();t=(e=_).without.apply(e,[t].concat(_toConsumableArray(i))),l.isCommunityEditionCluster()&&l.isPreCheckMode()&&(t=[m.UPGRADE_SOFTWARE_TYPE_STATE.NOS]);var s=t.slice();_.each(s,function(e,t){e===m.UPGRADE_SOFTWARE_TYPE_STATE.NOS&&(s[t]=m.UPGRADE_SOFTWARE_TYPE_LABEL.NOS)});var a=null,o=t;if(!_.size(t)){var c=this.lcmLinkTemplate(this.vtOptions({}));a=this.i18n("allUpdateLabel")+" "+c,o=null}if(this.$el.html(D(this.vtOptions({softwareTypeTabs:o,softwareTypeLabels:s,canModify:this.canModifyByEntityType(m.ENTITY_UPGRADE),isPC:r.isMulticlusterNavMode(),reason:a}))),o){var d=this.model.getCurrentSoftwareType(),p=d||this._getInitialTab(),u=t.indexOf(p)>=0;d&&u||(u||(p=_.first(t)),this.model.setCurrentSoftwareType(p))}},_getSupportedTabs:function(){var e=this,t=void 0;return t=r.isMulticlusterNavMode()?[m.UPGRADE_SOFTWARE_TYPE_STATE.PRISM_CENTRAL,m.UPGRADE_SOFTWARE_TYPE_STATE.NCC]:[m.UPGRADE_SOFTWARE_TYPE_STATE.NOS,m.UPGRADE_SOFTWARE_TYPE_STATE.FILE_SERVER,m.UPGRADE_SOFTWARE_TYPE_STATE.HYPERVISOR,m.UPGRADE_SOFTWARE_TYPE_STATE.FIRMWARE,m.UPGRADE_SOFTWARE_TYPE_STATE.NCC,m.UPGRADE_SOFTWARE_TYPE_STATE.FOUNDATION,m.UPGRADE_SOFTWARE_TYPE_STATE.DOCKER],r.isMulticlusterNavMode()||E.hasKVM()||(t=_.without(t,m.UPGRADE_SOFTWARE_TYPE_STATE.DOCKER)),r.isMulticlusterNavMode()||!p.hasXPressLicense()&&(E.hasKVM()||E.hasESX())&&!r.isPowerPcCluster()||(t=_.without(t,m.UPGRADE_SOFTWARE_TYPE_STATE.FILE_SERVER)),_.filter(t,function(t){return e.deprecatedUpdates.indexOf(t)<0})}})}),define("text!templates/popups/cluster/HypervBlockRenameView.html",[],function(){return'<div class="block-row">\n  <div class="block-row-title hostName">\n    Host Names:\n  </div>\n  <div class="block-row-title">\n    <%= block_title %>\n  </div>\n\n  <div class="block-row-top">\n    <div class="node-group">\n      <% _.each( nodes, function(node) { %>\n        <div class="node-element <%- node.position %>" >\n          <span class="node-title" > <%= node.ip %></span>\n          <span class="node-id" style="display: none;">\n              <%=node.id%>\n          </span>\n          <%\n              var isDisabled = !node.isEditable ? \'disabled\' : \'\';\n          %>\n          <input type="text" class="inputRequired node-name"\n            data-hyperv-node="<%= node.isHypervNode %>" <%= isDisabled %>\n            value="<%= node.name %>"/>\n        </div>\n      <% }) %>\n    </div>\n  </div>\n</div>'}),define("views/popups/cluster/HypervBlockRenameView",["views/basecomponents/BaseView","data/DataProperties","utils/AppConstants","text!templates/popups/cluster/HypervBlockRenameView.html"],function(e,t,n,i){"use strict";var s=_.template(i);return e.extend({hosts:null,name:"HypervBlockRenameView",initialize:function(e){this.el=e.el,this.hosts=e.hosts},render:function(){var e=this.constructBlockMap(),t=_.keys(e);_.each(t,function(t){var n={block_title:t,nodes:e[t]};this.el.append(s(n))},this)},constructBlockMap:function(){var e={};return _.each(this.hosts,function(i){var s=i.get(t.BLOCK_MODEL_NAME),a=i.get(t.BLOCK_SERIAL),o=s+" ("+a+")";e[o]||(e[o]=[]);var r=i.get(t.HYPERVISOR_TYPE)===n.HYPERVISOR_TYPE.HYPERV,l=!0;i.hasDomainName()&&(l=!1);var c=i.get(t.SERVICE_VM_ID),d=i.get("position").ordinal;e[o].push({ip:i.get(t.HYPERVISOR_IP),name:i.getSimpleName(),id:c,isEditable:l,isHypervNode:r,position:d})}),e}})}),define("text!templates/popups/cluster/HypervDomainJoinPopupView.html",[],function(){return'\x3c!-- The parent div modal is #popupHypervDomainJoin --\x3e\n<div class="modal-header">\n  <button type="button" class="close" data-dismiss="modal">\n      <i data-icon="K" aria-hidden="true"></i>\n  </button>\n  <h4 class="n-title">Join Cluster and Hosts to the Domain</h4>\n</div>\n<div class="n-modal-wrapper">\n  <div class="n-modal-body">\n    <div class="n-modal-content-wrapper">\n      <div class="n-modal-alert-header">\n        \x3c!-- @view: update message goes here --\x3e\n      </div>\n      <div class="n-popup-description">\n        Here you can join the cluster and its constituent hosts to an Active\n        Directory domain. This step requires a reboot.\n      </div>\n      \x3c!-- Domain Join Form --\x3e\n      <form id="HypervDomainJoinForm" class="form-horizontal">\n        <div class="control-group">\n          <label class="control-label">Full domain name</label>\n          <div class="controls">\n            <input type="text" class="inputRequired domainName" disabled />\n          </div>\n        </div>\n\n        <div class="control-group">\n          <label class="control-label">Name server IP address</label>\n          <div class="controls">\n            <input type="text" class="inputRequired dnsIpAddress"/>\n          </div>\n        </div>\n\n        <div class="control-group non-la-jolla">\n          <label class="control-label">Base OU Path</label>\n          <div class="controls">\n            <input type="text" class="ouPath"\n            placeholder="OU=aa,DC=bb,DC=cc,DC=dd"/>\n          </div>\n        </div>\n\n        <div class="control-group">\n          <label class="control-label">Nutanix Cluster name</label>\n          <div class="controls">\n            <input type="text" class="inputRequired clusterName" disabled />\n          </div>\n        </div>\n\n        <div class="control-group">\n          <label class="control-label">Nutanix Cluster virtual IP address</label>\n          <div class="controls">\n            <input type="text" class="inputRequired clusterExternalIp" />\n          </div>\n        </div>\n\n        <div class="group la-jolla-group">\n          <label class="group-label control-label">CPS details </label>\n          <div class="control-group">\n            <label class="control-label">Base OU Path</label>\n            <div class="controls">\n              <input type="text" class="inputRequired ouPath"\n              placeholder="OU=aa,DC=bb,DC=cc,DC=dd"/>\n            </div>\n          </div>\n\n          <div class="control-group">\n            <label class="control-label">CPS Prefix</label>\n            <div class="controls">\n              <input type="text" class="inputRequired namePrefix"\n                     maxlength="8" />\n            </div>\n          </div>\n        </div>\n\n        <div class="group">\n          <label class="group-label control-label host-detail-label"> Host\n            details </label>\n          <div class="controls n-node-detail-description">\n            <div class="n-form-row-description host-description">\n              <span class="n-inline-description">\n                All hosts can be renamed with the prefix. Hosts can also be\n                individually renamed in the Advanced View.\n              </span>\n            </div>\n          </div>\n          <div class="control-group n-prefix-group">\n            <label class="control-label prefix-label">Prefix</label>\n            <div class="controls">\n              <input type="text" class="n-input-prefix inputPrefix"/>\n              <div class="showMorePrefix n-more-info">\n                <a href="#" class="expandDetails"> Advanced View </a>\n                <a href="#" class="collapseDetails collapse-details">\n                  Simple View\n                </a>\n              </div>\n              <div class="n-rename-holder renameHolder">\n              </div>\n            </div>\n          </div>\n        </div>\n        <div class="group group-credentials groupCredentials">\n          \x3c!-- Credentials form will go here --\x3e\n        </div>\n      </form>\n      </div>\n  </div>\n  <div class="n-modal-footer">\n    <div class="pull-left">\n      <button class="btnCancel btn n-btn-list">\n        Cancel\n      </button>\n    </div>\n    <button class="btnSave btn btn-primary n-btn-list">\n      Join\n    </button>\n  </div>\n</div>\n'}),define("views/popups/cluster/HypervDomainJoinPopupView",["views/popups/cluster/HypervBlockRenameView","views/popups/cluster/HypervSetupPopupView","models/BaseModel","models/hardware/HostCollection","models/genesis/LaJollaClusterModel","data/DataManager","data/DataURLConstants","data/DataProperties","managers/ClusterManager","utils/AppConstants","utils/AppUtil","utils/TooltipContent","utils/CommonTemplates","text!templates/popups/cluster/HypervDomainJoinPopupView.html","text!templates/popups/cluster/HypervCredentialsView.html"],function(e,t,n,i,s,a,o,r,l,c,d,p,u,h,m){"use strict";var f=n.extend({urlRoot:o.CLUSTER_DOMAIN_JOIN,entityType:c.ENTITY_HYPERV_DOMAIN_JOIN,defaults:{domainDescriptor:null,credential:null,nosClusterDescriptor:null,nodeDescriptors:null},name:"ClusterDomainModel",validate:function(e){if(!e.domainDescriptor.nameServer||!d.isValidIP(e.domainDescriptor.nameServer))return"Invalid Nameserver IP address specified.";for(var t=0;t<e.nodeDescriptors.length;t++)if(e.nodeDescriptors[t].name&&e.nodeDescriptors[t].name.length>15)return"Node names cannot be more than 15 chars "+e.nodeDescriptors[t].name},getLatencyMessage:function(){return"Domain joining hosts and Acropolis cluster."}}),v=_.template(h),g=_.template(m);return t.extend({HYPERV_NODE_RESTART_WAIT_PERIOD:12e4,GATEWAY_STATUS_CHECK_PERIOD:3e4,ERROR_HOST_RETRIEVE:"Unable to retrieve hosts information.",el:"#popupHypervDomainJoin",clusterModel:null,hostCollection:null,blockView:null,isLaJolla:!1,extraEvents:{"keyup      .inputPrefix":"onInputPrefixKeyup","click      .expandDetails":"onClickExpandLink","click      .collapseDetails":"onClickCollapseLink","mouseenter .node-element":"onMouseOverNodeName","mouseleave .node-element":"onMouseOutNodeName","keyup      .namePrefix":"onNamePrefixKeyup"},initialize:function(){t.prototype.initialize.apply(this,arguments),this.clusterModel=l.getCurrentClusterModel(),this.hostCollection=new i,this.addExtraEvents(this.extraEvents)},render:function(){this.$el.html(v({canModify:this.canModifyByEntityType(c.ENTITY_HYPERV_DOMAIN_JOIN)})),this.$(".groupCredentials").html(g)},show:function(e){var n=this,i=[];t.prototype.show.apply(this,arguments),this.showHeaderLoading();var a=new s;i.push(a.fetch()),i.push(this.hostCollection.fetch()),$.when.apply($,i).done(function(){!1===a.getReturnResponse()?(n.$(".ouPath").removeClass("inputRequired"),n.$(".namePrefix").removeClass("inputRequired")):(n.$(".prefix-label").hide(),n.$(".inputPrefix").removeClass("inputRequired"),n.$(".inputPrefix").hide(),n.$(".host-detail-label").hide(),n.$(".host-description").hide(),n.$el.addClass("la-jolla"),n.isLaJolla=!0),n.clearHeader(),n.showForm()}).fail(function(){if(n.clearHeader(),a.getState()===c.STATE_ERROR)throw new Error("HyperVDomainJoinpopupView: Error in LaJolla cluster check.");n.$el.addClass("la-jolla"),n.isLaJolla=!0,n.hostCollection.getState()===c.STATE_ERROR&&n.showHeaderError(this.ERROR_HOST_RETRIEVE)}),this.$(".btnSave").addClass("disabled").attr("disabled",!0),this.applyNutanixInput()},showForm:function(){var e,t,n;this.clusterModel&&(e=this.clusterModel.get(r.DOMAIN),t=this.clusterModel.get(r.NAME)||"",n=this.clusterModel.get(r.CLUSTER_EXTERNAL_IP_ADRESS)||""),this.$(".clusterExternalIp").val(n),e?(this.$(".domainName").val(e).prop("disabled",!0),this.$(".clusterName").val(t).prop("disabled",!0)):(this.$(".domainName").prop("disabled",!1),this.$(".clusterName").val(t).prop("disabled",!1)),this.renderBlockView(),this.$(".n-button-help").tooltip({title:p[c.ENTITY_KERBEROS_CONFIG].CREDENTIALS_HELP,placement:"right",trigger:"hover",html:!1})},destroy:function(){d.debug("HypervDomainJoinPopupView : destroy:  | viewid     : "+this.cid),this.$(".n-button-help").tooltip("destroy"),this.hostCollection&&(this.hostCollection.off(),this.hostCollection=null),this.blockView&&(this.blockView.destroy(),this.blockView=null),t.prototype.destroy.apply(this,arguments)},onInputPrefixKeyup:_.debounce(function(){var e=this.$(".inputPrefix").val().trim();""!==e&&this._populateNodeNamesFromPrefix(e)},300),onNamePrefixKeyup:_.debounce(function(){var e=this.$(".namePrefix").val().trim();""!==e&&this._populateNodeNamesFromCPSPrefix(e)},300),onClickExpandLink:function(){this.$(".expandDetails").hide(),this.$(".collapseDetails").show(),this.$(".renameHolder").show()},onClickCollapseLink:function(){this.$(".expandDetails").show(),this.$(".collapseDetails").hide(),this.$(".renameHolder").hide()},onEnterKeyPress:function(){var e=new f,t=this,n={},i={};i.domainName=this.$(".domainName").val().trim(),i.nameServer=this.$(".dnsIpAddress").val().trim(),i.ouPath=this.isLaJolla?this.$(".la-jolla-group .ouPath").val().trim():this.$(".non-la-jolla .ouPath").val().trim(),i.namePrefix=this.$(".namePrefix").val().trim(),n.domainDescriptor=i;var s={};s.clusterName=this.$(".clusterName").val().trim(),s.virtualIp=this.$(".clusterExternalIp").val().trim(),n.nosClusterDescriptor=s;var a=this.$(".username").val().trim(),o=this.$(".password").val().trim(),r=this.validateAndReturnDomainCredentials(a,o);if(r){n.credential=r.toJSON(),n.nodeDescriptors=this.getNodesChanges(),e.on("error",function(e,n){t.showHeaderError(n)});!1!==e.set(n)&&(this.$(".btnSave").addClass("disabled").attr("disabled",!0),this.showHeaderSaving(this.PROCESSING_MESSAGE),this.isSaving=!0,e.save(null,{success:function(e,n){t.isSaving=!1,t.handleMultiNodeReponse(e,n)},error:function(e,n){t.isSaving=!1,t.showHeaderError(n.responseText)}}))}},onSuccess:function(e,t){this.hide();var n=this.getRebootInitiatedHostStatuses(t);n.length&&this.showLoader(n.length),l.fetchOnDemand()},onFailure:function(e,t,n){var i=this;this.$(".n-modal-alert-header").append(u.LOADING),this.hostCollection.fetch({success:function(e,t){i.clearLoadingHeader(),i.showForm(),i.onInputPrefixKeyup(),i.$(".btnSave").removeClass("disabled").attr("disabled",!1)},error:function(e,t){i.showHeaderError(this.ERROR_HOST_RETRIEVE)}})},clearLoadingHeader:function(){this.$(".n-modal-alert-header .alert-info").remove()},showLoader:function(e){this.addLoader(e);var t=this;setTimeout(function(){t.checkIfGatewayIsBackUp()},t.HYPERV_NODE_RESTART_WAIT_PERIOD)},onMouseOverNodeName:function(e){var t,n=$(e.currentTarget).find(".node-name");if(n.prop("disabled")){var i,s=n.data("hypervNode");i=s?"This "+c.HYPERVISOR_LABEL.kHyperv+" node is already joined to the domain.":"This is not a "+c.HYPERVISOR_LABEL.kHyperv+" node.",t=n.tooltip({title:i,placement:"top",trigger:"manual",html:"false"}),t.tooltip("show")}},onMouseOutNodeName:function(e){$(e.currentTarget).find(".node-name").tooltip("destroy")},renderBlockView:function(){this.$(".renameHolder").empty();var t=this.hostCollection.sortBy(function(e){return e.get(r.HYPERVISOR_IP)});this.blockView=new e({el:this.$(".renameHolder"),hosts:t}),this.blockView.render()},getNodesChanges:function(){var e=[],t=this.$(".node-element");return _.each(t,function(t){var n=$(t).find(".node-id").text().trim(),i=$(t).find(".node-name");i.data("hypervNode")&&e.push({nodeId:n,name:i.val().trim()})}),e},_getPresentNodeNames:function(){var e=[],t=this.$(".node-element");return _.each(t,function(t){var n=$(t).find(".node-name");if(n.prop("disabled")){var i=n.val();i&&e.push(i.trim().toLowerCase())}}),e},checkIfGatewayIsBackUp:function(){var e=this;$.get(a.getGatewayURL()+o.HEART_BEAT_API).done(function(){e.logout(c.ROUTE_LOGOUT_RESTART)}).fail(function(){setTimeout(function(){e.checkIfGatewayIsBackUp()},e.GATEWAY_STATUS_CHECK_PERIOD)})},addLoader:function(e){var t="Restarting "+e+" hosts.";d.addFullPageLoader(t)},_populateNodeNamesFromPrefix:function(e){var t=1,n=this._getPresentNodeNames(),i=this.$(".node-element");_.each(i,function(i){var s=$(i).find(".node-name");if(!s.prop("disabled")){for(var a=e+"-"+t;-1!==n.indexOf(a.trim().toLowerCase());)t++,a=e+"-"+t;n.push(a.trim().toLowerCase()),s.val(a)}})},_populateNodeNamesFromCPSPrefix:function(e){var t=this._getPresentNodeNames(),n=this.$(".node-element"),i=this,s=0;_.each(n,function(n){var a=$(n).find(".node-name");if(!a.prop("disabled")){var o=$(n).attr("class");o&&(s=parseInt(o.split(" ")[1]));for(var r=1,l=d.getNodePositionFromNumber(s),c=i._getCpsHostName(e,r,l);-1!==t.indexOf(c.trim().toLowerCase());)r++,c=i._getCpsHostName(e,r,l);t.push(c.trim().toLowerCase()),a.val(c)}})},getRebootInitiatedHostStatuses:function(e){return _.filter(e[r.NODE_STATUS],function(e){return!0===e.rebootInitiated})},_getCpsHostName:function(e,t,n){var i=""+t;return 1===i.length&&(i="0"+i),e+"C"+i+n}})}),define("models/genesis/LaJollaSetDvmConfigurationModel",["models/genesis/GenesisBaseModel","utils/AppConstants"],function(e,t){"use strict";return e.extend({name:"LaJollaSetDvmConfigurationModel",methodName:t.CLUSTER_MANAGER_METHODS.SET_DVM_CONFIGURATION,managerName:t.GENESIS.CLUSTER_MANAGER,getErrorResponse:function(){var t=e.prototype.getErrorResponse.apply(this,arguments);if(t)return t;var n=this.getReturnResponse();return!1===n[0]?n[1]?n[1]:"Failed to set DVM configuration.":void 0},getReturnResponse:function(){return this.get(e.DP.GENESIS_RETURN)||[]},setRPCParams:function(e){_.extend(this.kwargs,{param_dict:e})}})}),define("models/genesis/StartLajollaDeploymentModel",["models/genesis/LajollaGenesisBaseModel","utils/AppConstants"],function(e,t){"use strict";return e.extend({ERROR_MSG:"Failed to start LaJolla deployment",name:"StartLajollaDeploymentModel",methodName:t.CLUSTER_MANAGER_METHODS.START_LAJOLLA_DEPLOYMENT,getReturnResponse:function(){return this.get(e.DP.GENESIS_RETURN)||[]},setRPCParams:function(e){_.extend(this.kwargs,{param_dict:e})}})}),define("models/genesis/LajollaSubscriptionDetailsModel",["models/genesis/LajollaGenesisBaseModel","utils/AppConstants"],function(e,t){"use strict";var n={ONBOARDING_DONE:"onboarding_done",SUBSCRIPTION_NAME:"subscription_name",SUBSCRIPTION_ID:"subscription_id",SITE_RECOVERY_REGIONS:"site_recovery_regions",OPS_INSIGHTS_REGIONS:"ops_insights_regions",SUBSCRIPTION_MAP:"subscription_map_list"};return e.extend({ERROR_MSG:"Failed to get Subscription details",name:"LajollaSubscriptionDetails",methodName:t.CLUSTER_MANAGER_METHODS.GET_SUBSCRIPTION_DETAILS,getOnboardingStatus:function(){return this.getReturnResponse()[n.ONBOARDING_DONE]},getSubscriptionNames:function(){var e=[];return this.getReturnResponse()[n.SUBSCRIPTION_MAP].forEach(function(t){e.push(t[n.SUBSCRIPTION_NAME])}),e},getSubscriptionIds:function(){var e=[];return this.getReturnResponse()[n.SUBSCRIPTION_MAP].forEach(function(t){e.push(t[n.SUBSCRIPTION_ID])}),e},buildSubscriptionMap:function(){var e={};return this.getReturnResponse()[n.SUBSCRIPTION_MAP].forEach(function(t){e[t[n.SUBSCRIPTION_NAME]]={},e[t[n.SUBSCRIPTION_NAME]][n.OPS_INSIGHTS_REGIONS]=t[n.OPS_INSIGHTS_REGIONS],e[t[n.SUBSCRIPTION_NAME]][n.SITE_RECOVERY_REGIONS]=t[n.SITE_RECOVERY_REGIONS]}),e},getReturnResponse:function(){return this.get(e.DP.GENESIS_RETURN)||[]},setRPCParams:function(e,t){_.extend(this.kwargs,{username:e,password:t})}})}),define("models/genesis/LajollaDVMIpModel",["models/genesis/LajollaGenesisBaseModel","utils/AppConstants"],function(e,t){"use strict";return e.extend({ERROR_MSG:"Failed to get DVM IP",name:"LajollaDVMIpModel",methodName:t.CLUSTER_MANAGER_METHODS.GET_DVM_IP,getReturnResponse:function(){return this.get(e.DP.GENESIS_RETURN)||[]}})}),define("text!templates/popups/cluster/HypervCpsDeploymentPopupView.html",[],function(){
return'\x3c!-- The parent div modal is #popupHypervCpsDeployment --\x3e\n<div class="modal-header">\n  <button type="button" class="close" data-dismiss="modal">\n    <i data-icon="K" aria-hidden="true"></i>\n  </button>\n  <h4 class="n-title">CPS Standard Deployment: Step 1/2</h4>\n  <div class="help-icon"><i aria-hidden="true" data-icon="O"></i></div>\n</div>\n\n<div class="n-modal-wrapper">\n  <div class="n-modal-content-wrapper">\n    <div class="n-modal-alert-header">\n            \x3c!-- alert goes here --\x3e\n    </div>\n\n    <div class="n-modal-content">\n      \x3c!-- Content goes here --\x3e\n      <form role="form" class="form-horizontal">\n\n        <div class="group group1">\n          <label class="group-label control-label">CPS Config</label>\n          <div class="control-group">\n            <label class="control-label">IP RANGE - START</label>\n            <div class="controls">\n            <input type="text" class="inputRequired ipRangeStart"\n                   placeholder="x.x.x.x">\n            </div>\n          </div>\n\n          <div class="control-group">\n            <label class="control-label">IP RANGE - END</label>\n            <div class="controls">\n            <input type="text" class="inputRequired ipRangeEnd"\n                   placeholder="x.x.x.x">\n            </div>\n          </div>\n\n          <div class="control-group">\n            <label class="control-label">SUBNET</label>\n            <div class="controls">\n            <input type="text" class="inputRequired subnet"\n                   placeholder="x.x.x.x/y">\n            </div>\n          </div>\n\n          <div class="control-group">\n            <label class="control-label">GATEWAY</label>\n            <div class="controls">\n            <input type="text" class="inputRequired gateway"\n                   placeholder="x.x.x.x">\n            </div>\n          </div>\n        </div>\n\n        <div class="group group2">\n          <label class="group-label control-label">Registration\n          </label>\n          <div class="control-group">\n            <label class="control-label">COMPANY NAME</label>\n            <div class="controls">\n            <input type="text" class="inputRequired companyName"\n                   placeholder="Company Name">\n            </div>\n          </div>\n\n          <div class="control-group">\n            <label class="control-label">SYSTEM CENTER LICENSE KEY (Optional)\n            </label>\n            <div class="controls">\n                <input type="text" class="licenseKey"\n                       placeholder="xxxxx-xxxxx-xxxxx-xxxxx-xxxxx">\n            </div>\n          </div>\n        </div>\n\n        <div class="group group3">\n          <label class="group-label control-label">\n              Data Telemetry to Microsoft</label>\n          <div class="control-group">\n            <div class="controls">\n              <input type="checkbox" class="agreement">\n              <a href= "<%- url %>" target="_blank"><%- displayMsg %></a>.\n            </div>\n          </div>\n        </div>\n\n        <div class="group group4">\n        \x3c!-- Placeholder to show loader for DVM configuration --\x3e\n        </div>\n      </form>\n    </div>\n  </div>\n  <div class="n-modal-footer">\n    <button class="btnCancel btn">\n      Cancel\n    </button>\n    <button class="btnSave btn -blue btnNext"\n      title="Click to go to next step"\n      data-loading-text="Loading..."> Next</button>\n  </div>\n</div>'}),define("text!templates/popups/cluster/HypervAzureDeploymentPopupView.html",[],function(){return'<div class="modal-header">\n  <button type="button" class="close" data-dismiss="modal">\n    <i data-icon="K" aria-hidden="true"></i>\n  </button>\n  <h4 class="n-title">CPS Standard Deployment: Step 2/2</h4>\n  <div class="help-icon"><i aria-hidden="true" data-icon="O"></i></div>\n</div>\n\n<div class="n-modal-wrapper">\n  <div class="n-modal-content-wrapper">\n    <div class="n-modal-alert-header">\n        \x3c!-- alert goes here --\x3e\n    </div>\n\n    <div class="n-modal-content">\n        \x3c!-- Content goes here --\x3e\n      <form role="form" class="azureinfo-form form-horizontal">\n\n        <div class="group">\n          <label class="group-label control-label">\n            Azure Deployment (Optional)</label>\n          <div class="control-group outer-table">\n            <table class="table">\n              <tbody>\n              <tr class="n-table-row">\n                <td class="colored-font"> <span class="semi-bold"> Step 1:\n                </span> Login into your Console VM.\n                  <table class="table inner-table-bordered">\n                    <tbody>\n                    <tr class="n-table-row">\n                      <td class="">IP Address</td>\n                      <td class="dvmIpAddress">\x3c!-- DVM IP here --\x3e</td>\n                    </tr>\n\n                    <tr class="n-table-row">\n                      <td>Username</td>\n                      <td>administrator</td>\n                    </tr>\n\n                    <tr class="n-table-row">\n                      <td class="no-bottom-padding">Temporary Password</td>\n                      <td class="no-bottom-padding password-field hidden-field">\n                        <span class="password-text">nutanix/4u</span>\n                        <span class="password-secure"></span>\n                        <span class="btnSwitchPassword">\n                          <span class="button-show">Show</span>\n                          <span class="button-hide">Hide</span>\n                        </span>\n                      </td>\n                    </tr>\n                    </tbody>\n                  </table>\n                </td>\n              </tr>\n              <tr class="n-table-row">\n                  <td class="colored-font"> <span class="semi-bold"> Step 2: </span>Launch Azure\n                    Onboarding shortcut on\n                    your desktop.\n                  </td>\n              </tr>\n              <tr class="colored-font n-table-row">\n                  <td class="no-bottom-padding">\n                    <span class="semi-bold"> Step 3:</span> After\n                    completion\n                    come back and\n                    <a class="verification"> click here </a> to continue.\n                  </td>\n              </tr>\n              </tbody>\n            </table>\n          </div>\n        </div>\n\n        <div class="group skipAzureOnboarding">\n          <label class="group-label control-group">Or skip this step</label>\n\n          <div class="control-group no-bottom-margin">\n            <p class="controls">\n                You can always trigger this process from the\n                <i aria-hidden="true" data-icon="C" class="gear-icon"></i>\n                settings menu.\n            </p>\n\n            <a class="controls btn -blue btnSkipAndDeploy"> Skip &amp;\n              Deploy </a>\n\n          </div>\n        </div>\n      </form>\n    </div>\n  </div>\n  <div class="n-modal-footer">\n    <button class="btnBack btn n-btn-form pull-left">\n      Back\n    </button>\n    <button class="btnCancel btn">\n      Cancel\n    </button>\n    <button class="btnDeploy btnSave btn -blue disabled"\n            title="Click to Save" data-loading-text="Saving...">\n      Deploy\n    </button>\n  </div>\n</div>\n'}),define("text!templates/popups/cluster/HypervSubscriptionDetails.html",[],function(){return'<form role="form" class="form-horizontal">\n  <div class="group">\n    <div class="control-group increased-padding">\n      <label class="control-label">Subscription</label>\n      <div class="controls clearfix subscriptionList">\n        <select class="subscription fancy-select"\n                data-class="fancy-select-top-anchor">\n          <option value="default">Select Subscription</option>\n        </select>\n      </div>\n    </div>\n\n    <div class="control-group increased-padding">\n      <label class="control-label">Azure Site Recovery</label>\n      <div class="controls clearfix siterecoveryList">\n        <select class="siterecovery fancy-select"\n                data-class="fancy-select-top-anchor">\n          <option value="default">Select Region</option>\n        </select>\n      </div>\n    </div>\n\n    <div class="control-group no-bottom-margin">\n      <label class="control-label">Azure Operational Insight</label>\n      <div class="controls clearfix opsinsightList">\n        <select class="opsinsight fancy-select"\n                data-class="fancy-select-top-anchor">\n          <option value="default">Select Region</option>\n        </select>\n      </div>\n    </div>\n  </div>\n  </form>'}),define("text!templates/popups/cluster/HypervCpsDeploymentAuthPopupView.html",[],function(){return'<div class="modal-header">\n  <button type="button" class="close" data-dismiss="modal">\n    <i data-icon="K" aria-hidden="true"></i>\n  </button>\n  <h4 class="n-title">CPS Standard Deployment: Step 2/2</h4>\n  <div class="help-icon"><i aria-hidden="true" data-icon="O"></i></div>\n</div>\n\n<div class="n-modal-wrapper">\n  <div class="n-modal-content-wrapper">\n    <div class="n-modal-alert-header">\n      \x3c!-- alert goes here --\x3e\n    </div>\n\n    <div class="n-modal-content">\n      \x3c!-- Content goes here --\x3e\n      <form role="form" class="form-horizontal authentication-form">\n\n        <div class="group">\n          <label class="group-label control-label">\n            Authentication Required</label>\n          <div class="control-group">\n            <p class="controls auth-description">\n              Input an Active Directory ID and password.\n              You must have admin rights to make any changes.\n            </p>\n          </div>\n        </div>\n\n        <div class="group">\n          <div class="control-group">\n            <label class="control-label-col1">Domain\\Username</label>\n            <label class="control-label-col2">Password</label>\n            <div class="controls">\n              <input type="text" class="col1 inputRequired userName"\n                     placeholder="Domain\\Username">\n              <input type="password"\n                     class="col2 inputRequired password"\n                     placeholder="Password">\n            </div>\n          </div>\n        </div>\n\n        <div class="group admin-pwd-group">\n          <div class="control-group no-bottom-margin">\n            <label class="control-label top-padding">PRISM Admin\n              Password</label>\n            <p class="controls auth-description">\n              Enter the PRISM Admin password to make any changes.\n            </p>\n            <div class="controls">\n              <input type="password" class="inputRequired adminPassword">\n            </div>\n          </div>\n        </div>\n      </form>\n    </div>\n  </div>\n  <div class="n-modal-footer">\n    <button class="btnCancel btn">\n      Cancel\n    </button>\n    <button class="btnConfirm btnSave btn -blue">\n      Confirm\n    </button>\n  </div>\n</div>'}),define("views/popups/cluster/HypervCpsDeploymentPopupView",["views/popups/cluster/HypervSetupPopupView","models/genesis/LaJollaSetDvmConfigurationModel","models/genesis/StartLajollaDeploymentModel","models/genesis/LajollaSubscriptionDetailsModel","models/genesis/LajollaDVMIpModel","data/DataURLConstants","utils/AppConstants","utils/AppUtil","utils/SVG","text!templates/popups/cluster/HypervCpsDeploymentPopupView.html","text!templates/popups/cluster/HypervAzureDeploymentPopupView.html","text!templates/popups/cluster/HypervSubscriptionDetails.html","text!templates/popups/cluster/HypervCpsDeploymentAuthPopupView.html"],function(e,t,n,i,s,a,o,r,l,c,d,p,u){"use strict";var h=_.template(c),m=_.template(p),f=_.template(u);return e.extend({el:"#popupHypervCpsDeployment",azureTemplate:_.template(d),dictionary:null,subscriptionMap:{},name:"HypervCpsDeploymentPopupView",AZURE_ONBOARDING_ERROR_MSG:"Azure Onboarding is not done yet. Go back and complete step 1 and step 2.",AZURE_POLICY_DETAILS_MSG:"I would like to send information about my CPS standard deployment to Microsoft Corporation. See Data Collection policies.",DICTIONARY_DETAILS:{USERNAME:"username",PASSWORD:"password",ADMIN_PASSWORD:"storage_admin_password",DEFAULT_GW:"default_gateway",IP_START:"ip_start",IP_END:"ip_end",IP_MASK:"ip_mask",COMPANY_NAME:"company_name",LICENSE_KEY:"system_center_license_key",DATA_TELEMETRY:"data_telemetry",SUBSCRIPTION:"azure_subscription_name",SITE_RECOVERY:"azure_site_recovery_region",OPS_INSIGHT:"azure_ops_insights_region",ONBOARDING_STATE:"azure_onboarding_enabled",SUBSCRIPTION_ID:"azure_subscription_id"},extraEvents:{"click .btnSwitchPassword":"onClickSwitchPassword","click .btnSkipAndDeploy":"onClickSkipAndDeploy","click .btnConfirm":"onClickConfirm","click .verification":"onClickVerification","click .btnNext":"onClickNext","click .btnDeploy":"onClickDeploy","click .backToAzureDeployment":"onClickBackToAzureDeployment","change .subscriptionList>.fancy-select":"onClickSubscription"},initialize:function(){e.prototype.initialize.apply(this,arguments),this.addExtraEvents(this.extraEvents),this.dictionary={}},render:function(){this.$el.html(h({url:a.LAJOLLA_DATA_POLICY_URL,displayMsg:this.AZURE_POLICY_DETAILS_MSG}))},show:function(t){e.prototype.show.apply(this,arguments),this.$(".btnSave").addClass("disabled").attr("disabled",!0),this.applyNutanixInput()},onClickNext:function(){this.validateFields()&&(this.populateDictionaryWithDVMConfig(),this.callSetDvmGenesisRpc(),this.hideDeploymentPopup())},onClickSwitchPassword:function(){this.$(".password-field").toggleClass("hidden-field")},onClickSkipAndDeploy:function(){this.getAuthenticationDetails(),this.applyNutanixInput()},onClickDeploy:function(){this.populateDictionaryWithSubscriptionDetails(),this.getAuthenticationDetails(),this.applyNutanixInput()},onClickVerification:function(){this.$(".outer-table").html(m()),this.showHeaderLoading(),this.$(".btnDeploy").prop("disabled",!0),this.populateDetails(),this.$(".btnDeploy").removeClass("disabled"),this.$(".btnBack").show(),this.$(".btnBack").toggleClass("backToAzureDeployment"),this.applyNutanixInput()},onClickConfirm:function(){this.populateDictionaryWitAuthDetails(),this.callStartDeploymentGenesisRpc()},onClickBackToAzureDeployment:function(){this.showAzureDeployment()},onClickSubscription:function(){var e=this.$(".subscriptionList .trigger").html();this.$(".siterecovery").empty(),this.appendDropDown(".siterecovery",this.subscriptionMap[e][o.SITE_RECOVERY_REGIONS]),this.$(".siterecovery").trigger("update"),this.$(".opsinsight").empty(),this.appendDropDown(".opsinsight",this.subscriptionMap[e][o.OPS_INSIGHTS_REGIONS]),this.$(".opsinsight").trigger("update"),this.$(".btnDeploy").prop("disabled",!1)},populateDictionaryWitAuthDetails:function(){this.dictionary[this.DICTIONARY_DETAILS.USERNAME]=this.$(".userName").val(),this.dictionary[this.DICTIONARY_DETAILS.PASSWORD]=this.$(".password").val(),this.dictionary[this.DICTIONARY_DETAILS.ADMIN_PASSWORD]=this.$(".adminPassword").val()},populateDictionaryWithDVMConfig:function(){this.dictionary={},this.dictionary[this.DICTIONARY_DETAILS.DEFAULT_GW]=this.$(".gateway").val(),this.dictionary[this.DICTIONARY_DETAILS.IP_START]=this.$(".ipRangeStart").val(),this.dictionary[this.DICTIONARY_DETAILS.IP_END]=this.$(".ipRangeEnd").val(),this.dictionary[this.DICTIONARY_DETAILS.IP_MASK]=this.$(".subnet").val(),this.dictionary[this.DICTIONARY_DETAILS.COMPANY_NAME]=this.$(".companyName").val(),this.dictionary[this.DICTIONARY_DETAILS.LICENSE_KEY]=this.$(".licenseKey").val(),this.dictionary[this.DICTIONARY_DETAILS.DATA_TELEMETRY]=this.$(".agreement").is(":checked"),this.dictionary[this.DICTIONARY_DETAILS.ONBOARDING_STATE]=!1},populateDictionaryWithSubscriptionDetails:function(){this.dictionary[this.DICTIONARY_DETAILS.ONBOARDING_STATE]=!0,this.dictionary[this.DICTIONARY_DETAILS.SUBSCRIPTION]=this.$(".subscriptionList .selected").text(),this.dictionary[this.DICTIONARY_DETAILS.SUBSCRIPTION_ID]=this.$(".subscriptionList .selected").data("value"),this.dictionary[this.DICTIONARY_DETAILS.SITE_RECOVERY]=this.$(".siterecoveryList .selected").data("value"),this.dictionary[this.DICTIONARY_DETAILS.OPS_INSIGHT]=this.$(".opsinsightList .selected").data("value")},callStartDeploymentGenesisRpc:function(){var e=this,t=new n;t.setRPCParams(this.dictionary),t.fetch({success:function(t,n){e.$(".btnCancel").trigger("click")},error:function(t,n){e.showHeaderError(n)}})},callSetDvmGenesisRpc:function(){var e=this,n=new t;n.setRPCParams(this.dictionary),n.fetch({success:function(t,i){var s=n.getReturnResponse();1!==s[0]?(e.showDeploymentPopup(),e.showHeaderError(s[1])):e.showAzureDeployment()},error:function(t,n){e.showDeploymentPopup(),e.showHeaderError(n)}})},showAzureDeployment:function(){var e=this;this.$(".btnNext").show(),this.$(".btnCancel").show(),this.$el.html(this.azureTemplate({SVG:l}));var t=new s;t.fetch({success:function(n,i){e.$(".dvmIpAddress").html(t.getReturnResponse()[0])},error:function(t,n){e.showHeaderError(n)}}),this.$(".btnBack").hide(),this.applyNutanixInput()},getAuthenticationDetails:function(){this.$el.html(f()),this.$(".btnSave").addClass("disabled"),this.applyNutanixInput()},populateDetails:function(){var e=new i;this.fetchDetailsAndFillPopup(e)},appendDropDown:function(e,t){var n=this;t&&t.forEach(function(t){n.$(e).append('<option value="'+t+'">'+t+"</option>")})},appendSubscriptionDetails:function(e,t,n){var i=this;if(t&&n)for(var s=0;s<t.length;s++)i.$(e).append('<option value="'+n[s]+'">'+t[s]+"</option>")},hideDeploymentPopup:function(){this.clearHeader(),this.$(".btnNext").hide(),this.$(".btnCancel").hide(),this.$(".group1").hide(),this.$(".group2").hide(),this.$(".group3").hide(),this.$(".group4").show(),this.$(".group4").html('<div class="control-group"><div class="controls loader"><div class="no-data page-loading-message"><div class="donut-loader-blue"></div>Configuring Console VM. This may take a few minutes...</div></div></div>')},showDeploymentPopup:function(){this.$(".btnNext").show(),this.$(".btnCancel").show(),this.$(".group1").show(),this.$(".group2").show(),this.$(".group3").show(),this.$(".group4").hide()},validateFields:function(){var e=this.$(".subnet").val();if(!e)return this.showHeaderError("Empty Subnet entry"),!1;if(!r.isValidSubnet(e))return this.showHeaderError("Invalid Subnet. Correct format is x.x.x.x/y"),!1;e=this.$(".licenseKey").val();var t=/^([A-Za-z0-9]{5}-){4}[A-Za-z0-9]{5}$/;if(e){if(null===e.match(t))return this.showHeaderError("Invalid System Center License Key. Correct format is xxxxx-xxxxx-xxxxx-xxxxx-xxxxx"),!1}return!0},fetchDetailsAndFillPopup:function(e){var t=this;e.fetch({success:function(n,i){t.showHeaderInfo(t.i18n("dropdownOption","Select options from dropdown.")),!1===e.getOnboardingStatus()?t.showHeaderError(t.AZURE_ONBOARDING_ERROR_MSG):(t.appendSubscriptionDetails(".subscription",e.getSubscriptionNames(),e.getSubscriptionIds()),t.$(".subscription").trigger("update"),t.subscriptionMap=e.buildSubscriptionMap())},error:function(e,n){t.showHeaderError(n)}})}})}),define("models/cluster/ClusterRedundancyStateModel",["backbone","models/BaseModel","data/DataURLConstants","utils/AppConstants"],function(e,t,n,i){"use strict";return t.extend({urlRoot:n.REDUNDANCY_FACTOR,entityType:i.ENTITY_REDUNDANCY_FACTOR,actionMode:i.ACTION_UPDATE,name:"ClusterRedundancyStateModel",defaults:{currentRedundancyFactor:0,desiredRedundancyFactor:0,redundancyStatus:null},sync:function(t,n,i){return i=this.parseOptions(t,n,i),"create"===t&&(t="update"),e.sync(t,n,i)}})}),define("text!templates/popups/redundancystate/RedundancyStateContentView.html",[],function(){return'\x3c!-- The parent div modal is #popupRedundancyState --\x3e\n<div data-ntnx-content-inner>\n\n  <% if (canModify) { %>\n    <section data-ntnx-section="type-text">\n      Configure the cluster\'s redundacy factor readiness which is the\n      ability to respond gracefully to an unexpected hardware failure. This\n      doesn\'t override the redundacy factor of existing storage container(s).\n    </section>\n  <% } %>\n\n  \x3c!-- Redundancy State Form --\x3e\n  <form id="redundacyStateForm" class="form-horizontal redundancy-state-form">\n\n    <section data-ntnx-section>\n      <h5 data-ntnx-title>\n        Current Redundancy Factor is <%= model.currentRedundancyFactor %>\n      </h5>\n    </section>\n\n    <section data-ntnx-section="type-text">\n      This means that the cluster can be ready for\n      <%= model.currentRedundancyFactor - 1 %> host or\n      disk failure(s). The data replication factor\n      is <%= model.currentRedundancyFactor %>.\n    </section>\n\n    <% if (isStatusDone) { %>\n      \x3c!-- Allow user to change the current Redundancy Factor when all\n           the backend components states are ready to process the\n           desired Redundancy Factor. --\x3e\n\n      <section data-ntnx-section>\n        <label data-ntnx-label for="selectDesiredRF">\n          Desired Redundancy Factor\n        </label>\n        <select id="selectDesiredRF">\n          <% for (var ii=2; ii <= maxRF; ii++) { %>\n            <option value="<%= ii %>"\n              <%= model.desiredRedundancyFactor == ii ?\n              \'selected\' :\'\'%>>\n              <%= ii %>\n            </option>\n          <% } %>\n        </select>\n      </section>\n\n      <section data-ntnx-section="type-text">\n        This means the cluster can tolerate\n        <span class="lblDesiredFT">\n          <%=  Number(model.desiredRedundancyFactor) - 1 %>\n        </span>\n        host or disk failure(s). The data replication factor is\n        <span class="lblDesiredRF lbl-desired-rf">\n          <%=  Number(model.desiredRedundancyFactor) %>\n        </span>.\n      </section>\n\n    <% } else { %>\n\n      <section data-ntnx-section>\n        <h5 data-ntnx-title>\n          Desired Redundancy Factor is <%= model.desiredRedundancyFactor %>\n        </h5>\n      </section>\n\n      <section data-ntnx-section="type-text">\n        The desired redundancy factor is being processed to become\n        the current redundancy factor. Please see the status below.\n      </section>\n\n      <section data-ntnx-section>\n        <table id="httpProxyList" class="table readonly-table">\n          <tbody>\n            \x3c!-- Show the status rows, if one of the data-path backend\n            components is still being processed. --\x3e\n            <% _.each(model.redundancyStatus,function(\n            status,key){ %>\n              <tr>\n                <td><%= key.replace(\'k\',\'\').replace(\'PrepareDone\',\'\') %></td>\n                <td><%= status ? \'Done\' : \'Processing...\' %></td>\n              </tr>\n            <% }); %>\n          </tbody>\n        </table>\n      </section>\n\n    <% } %>\n  </form>\n\n</div>\n'}),define("views/popups/redundancystate/RedundancyStatePopupView",["backbone","views/basecomponents/popups/BasePopupView","models/cluster/ClusterRedundancyStateModel","data/DataProperties","utils/AppConstants","utils/AppUtil","text!templates/popups/redundancystate/RedundancyStateContentView.html"],function(e,t,n,i,s,a,o){"use strict";return o=_.template(o),t.extend({el:"#popupRedundancyState",initialized:!1,name:"RedundancyStatePopupView",events:{"click  .btnSave":"onClickSave","change #selectDesiredRF":"onChangeSelectDesiredRF"},modelEvents:{"sync    model":"onModelChange","change  model":"onModelChange","error   model":"onModelError"},initialize:function(){this.model=new n,t.prototype.initialize.apply(this,arguments)},render:function(){var e=this.canModifyByEntityType(s.ENTITY_REDUNDANCY_FACTOR),t=[],n=!0;_.each(this.model.get(i.REDUNDANCY_FACTOR_STATUS),function(e,t){e||(n=!1)}),e&&n&&t.push({isPrimary:!0,text:this.i18n("save"),extraClasses:"btnSave btnForm n-btn-form",extraAttr:[{key:"data-loading-text",value:"Saving..."}]}),this.$el.html(this.defaultTemplate({title:"Redundancy Factor Readiness",bodyContent:o({initialized:this.initialized,canModify:e,model:this.model.toJSON(),maxRF:s.MAX_REDUNDANCY_FACTOR,isStatusDone:n}),footerButtons:this.defaultFooter(t)})),this.applyNutanixInput(),a.addInLineDonutLoader(this.$(".loadingSpinner"))},show:function(e){this.initialized=!1,t.prototype.show.apply(this,arguments),this.fetchModel()},onModelChange:function(e,t,n){this.enableSaveControls(),this.enableFormControls(),this.initialized=!0,this.render()},onModelError:function(e,t,n){this.enableSaveControls(),this.enableFormControls(),this.triggerAction(s.MODAL.ACT.ALERT_SHOW,{type:s.MODAL.ALERT.TYPE_ERROR,message:_.isString(e)?e:t&&t.responseText})},enableFormControls:function(){this.$(".formControl").removeAttr("disabled")},disableFormControls:function(){this.$(".formControl").attr("disabled","disabled")},enableSaveControls:function(){this.$(".btnSave").button("reset")},disableSaveControls:function(){this.$(".btnSave").button("loading")},fetchModel:function(){this.model.fetch({alwaysTriggerChange:!0})},saveModel:function(){this.model.save(this.getDirtyModel(),{alwaysTriggerChange:!0,silent:!0})},getDirtyModel:function(){return _defineProperty({},i.DESIRED_REDUNDANCY_FACTOR,this.$("#selectDesiredRF").val())},onChangeSelectDesiredRF:function(){var e=Number(this.$("#selectDesiredRF").val());this.$(".lblDesiredFT").html(e-1),this.$(".lblDesiredRF").html(e)},onClickSave:function(){this.disableSaveControls(),this.disableFormControls(),this.saveModel()}})}),define("models/portal/PortalProxyConfigModel",["models/BaseModel","data/DataURLConstants","utils/AppConstants","utils/AppUtil"],function(e,t,n,i){"use strict";var s={STATUS:"status",MESSAGE:"message",API_KEY:"portalApiKey",DEST_HOST:"destHost",DEST_PORT:"destPort",DEST_PUB_CERT:"destPubCert"},a={OK:"OK",OFF:"OFF",ERROR:"ERROR"};return e.extend({name:"PortalProxyConfigModel",urlRoot:t.PORTAL_PROXY_CONFIG,entityType:n.ENTITY_PORTAL_PROXY,DP:s,defaults:{portalApiKey:"",destPubCert:"",destHost:"",destPort:null},url:function(){return this.urlRoot},sync:function(t,n,i){return i=i||{},i=_.defaults(i,{success:function(){}}),t=n.isConfigured()||"update"!==t?t:"create",i.success=_.wrap(i.success,function(){var e=[].splice.call(arguments,0),t=e.splice(0,1)[0];n.isNew(!1),t.apply(this,e)}),e.prototype.sync.call(this,t,n,i)},isConfigured:function(){return this.has(s.STATUS)&&this.get(s.STATUS)!==a.OFF},isActive:function(){return this.isConfigured()&&this.get(s.STATUS)===a.OK},isEnabled:function(e){return!i.isLocalStorageProperty(n.LOCAL_STORAGE.ONE_CLICK_DISABLED)&&!e&&this.isActive()},getStatusActions:function(){var e;return this.isConfigured()&&(e={update:this.i18n("update"),disable:this.i18n("disable")}),e||{}},getStatusMsg:function(){var e=this.get(s.STATUS),t=this.get(s.MESSAGE)||"";switch(e){case a.OFF:t=this.i18n("status_off");break;case a.OK:t=i.sprintf(this.i18n("status_ok"),this.get(s.DEST_HOST),this.get(s.DEST_PORT));break;case a.ERROR:t=t.match(/failed to connect/i)?i.sprintf(this.i18n("status_unreachable"),this.get(s.DEST_HOST),this.get(s.DEST_PORT)):t.match(/invalid api key/i)?this.i18n("status_bad_key"):t||this.i18n("status_unknown");break;default:t=this.i18n("status_unknown")}return t}},{DP:s,STATUS:a})}),define("models/license/ClusterIdModel",["models/BaseModel","utils/AppConstants","data/DataProperties"],function(e,t,n){"use strict";return e.extend({DP:{CSF_VERSION:"version",CSF_CLUSTER_VERSION:"cluster_version",CSF_NODE_LIST:"node_list",CSF_NUM_NODES:"num_nodes",CSF_MODEL:"model",CSF_LIC_CLASS:"license_class",CSF_CAPACITY:"capacity",CSF_COIN:"coin_applied",CSF_CORES:"num_cores",CSF_HDD:"hdd_size_tebibytes",CSF_FLASH:"ssd_size_tebibytes",CSF_UUID:"cluster_uuid",CSF_BLOCK_SERIAL:"block_serial",CSF_BLOCK_SERIAL_LIST:"block_serial_list",CSF_CLUSTER_TIMESTAMP:"cluster_logical_timestamp"},urlRoot:t.NUTANIX_CLUSTER_INFO_FILE,name:"ClusterIdModel",getVersion:function(){return this.get(this.DP.CSF_VERSION)},getAOSVersion:function(){return this.get(this.DP.CSF_CLUSTER_VERSION)||""},getClusterTimestamp:function(){return this.get(this.DP.CSF_CLUSTER_TIMESTAMP)},hasCapacityInfo:function(){return!!this.get(this.DP.CSF_CAPACITY)},getDisplayableNodeCounts:function(){return _.filter(this.get(this.DP.CSF_NODE_LIST),function(e){return e[this.DP.CSF_LIC_CLASS]!==t.LICENSE_CLASSES.FLOW.toLowerCase()&&e[this.DP.CSF_LIC_CLASS]!==t.LICENSE_CLASSES.CALM.toLowerCase()},this)},getModels:function(){return _.groupBy(this.get(this.DP.CSF_NODE_LIST),this.DP.CSF_MODEL)},getBlockList:function(){return this.get(this.DP.CSF_BLOCK_SERIAL_LIST)||[]},getSignature:function(){return this.get(n.LICENSE_SIGNATURE)||""},getSignatureFragments:function(e){return e=e||7,this.getSignature().match(new RegExp(".{1,"+e+"}","g"))},getCapacity:function(){return this.get(this.DP.CSF_CAPACITY)||{}},getCoinApplied:function(){return this.get(this.DP.CSF_COIN)||0},getClusterUuid:function(){return this.get(this.DP.CSF_UUID)||null}})}),define("models/license/LicenseFileModel",["models/BaseModel","data/DataURLConstants","utils/AppConstants"],function(e,t,n){"use strict";var i={};return e.extend({urlRoot:t.LICENSE,entityType:n.ENTITY_LICENSING,name:"LicenseFileModel",sync:function(t,n,i){if("create"!==t)throw new Error('Model only supports "create" method');var s=new FormData,a=new Blob([JSON.stringify(this.toJSON())],{type:"text/plain"});return s.append("LicenseFile",a),i=_.extend({},i,{data:s,contentType:!1,processData:!1}),e.prototype.sync.call(this,t,n,i)},showLatencyNotification:function(){},showSuccessNotification:function(){},showErrorNotification:function(){}},{DP:i})}),define("models/portal/PortalProxyModel",["models/BaseModel","data/DataURLConstants"],function(e,t){"use strict";var n={METHOD:"method",URL:"url",BODY:"body",RESPONSE:"responseDTO"},i={create:"POST",update:"PUT",patch:"PATCH",delete:"DELETE",read:"GET"};return e.extend({urlRoot:t.PORTAL_PROXY,enableNotifications:!1,setMethod:function(e){this.set(n.METHOD,i[e])},setBody:function(e){this.set(n.BODY,JSON.stringify(e))},showLatencyNotification:function(){},showSuccessNotification:function(){},showErrorNotification:function(){}},{DP:n})}),define("models/portal/BasePortalModel",["models/BaseModel","models/portal/PortalProxyModel","data/DataURLConstants","utils/AppUtil"],function(e,t,n,i){"use strict";var s=_.template(n.PORTAL_API);return e.extend({restVersion:"v1",urlRoot:null,sync:function(e,n,i){i=i||{};var s=this,a=$.Deferred(),o=this.createProxy();return this.triggerPendingEvent(i),this._previousId=this._newId,o.setMethod(e),o.set(t.DP.URL,this.getDataSourceURL()+this.getURL(i)),"create"!==e&&"update"!==e||o.setBody(this.toJSON()),o.save(null,{success:function(e,n){s.set(e.get(t.DP.RESPONSE)),a.resolve(s,n),_.isFunction(i.success)&&i.success(s,n)},error:function(e,t){s.trigger("error",s,t),a.reject(s,t),_.isFunction(i.error)&&i.error(s,t)}}),a.promise()},getURL:function(e){var t=this.url();return e&&e.data&&(t+="?"+i.formatObjectToQuery(e.data)),t},getDataSourceURL:function(){return s({version:this.restVersion})},createProxy:function(){return new t}})}),define("models/portal/PortalLicenseStateModel",["models/portal/BasePortalModel","data/DataURLConstants"],function(e,t){"use strict";var n={CSF:"clusterSummaryFile",LSF:"licenseSummaryFile",COIN:"coinSummary",WORKFLOW:"workflow",LICENSES:"licenseIds",LICENSE_MODE:"licenseMode"};return e.extend({urlRoot:t.PORTAL_LICENSE_STATE,name:"PortalLicenseStateModel",DP:n,setLicenses:function(e){this.set(n.LICENSES,[].concat(e))},setCSF:function(e){this.set(n.CSF,e)},getLSF:function(){return this.get(n.LSF)},setCoin:function(e){this.set(n.COIN,e)},setWorkflow:function(e){this.set(n.WORKFLOW,e)},setLicenseMode:function(e){this.set(n.LICENSE_MODE,e)}},{DP:n})}),define("models/portal/PortalLicenseTypeModel",["models/portal/BasePortalModel","data/DataURLConstants","utils/AppUtil"],function(e,t,n){"use strict";var i={CATEGORY:"category",SUBCATEGORY:"subcategory",
ALLOWED_MODELS:"allowedModels",ALLOWED_PAIRINGS:"allowedPairings",PRIORITY:"priority",LICENSE_TYPE:"licenseType"};return e.extend({DP:i,urlRoot:t.PORTAL_LICENSE_TYPE,name:"PortalLicenseTypeModel",set:function(t,n){return _.isString(t[i.ALLOWED_MODELS])&&(t[i.ALLOWED_MODELS]=t[i.ALLOWED_MODELS]?t[i.ALLOWED_MODELS].split(";"):[]),_.isString(t[i.ALLOWED_PAIRINGS])&&(t[i.ALLOWED_PAIRINGS]=t[i.ALLOWED_PAIRINGS]?t[i.ALLOWED_PAIRINGS].split(";"):[]),e.prototype.set.call(this,t,n)},isOfCategory:function(e){return _.isString(e)&&this.getCategory().toLowerCase()===e.toLowerCase()},isOfType:function(e,t){return t?this.getType().toLowerCase()===(t+"_"+e).toLowerCase():this.isOfCategory(e)&&this.getType()===e},compare:function(e,t){if(!t)throw new Error("Missing license type");return n.operatorCompare(e,this.getPriority(),t.getPriority())},isModelAllowed:function(e){e=(e||"").replace(/-/g,"").toLowerCase();var t=this.getAllowedModels();return _.isEmpty(t)||_.any(t,function(t){return t=t.replace(/-/g,"").toLowerCase(),e===t})},isPairingAllowed:function(e){var t=this.get(i.ALLOWED_PAIRINGS),n=new RegExp("^"+e+"$","i");return _.isEmpty(t)||_.any(t,function(e){return n.test(e)})},getType:function(){return this.get(i.LICENSE_TYPE)||""},getCategory:function(){return this.get(i.CATEGORY)||""},getSubcategory:function(){return this.get(i.SUBCATEGORY)},getPriority:function(){return this.get(i.PRIORITY)},getAllowedModels:function(){return this.get(i.ALLOWED_MODELS)}},{DP:i})}),define("models/portal/PortalLicenseModel",["models/portal/BasePortalModel","models/portal/PortalLicenseTypeModel","data/DataURLConstants","utils/AppConstants"],function(e,t,n,i){"use strict";var s={LICENSE_NUMBER:"number",LICENSE_CLASS:"licenseClass",LICENSE_TYPE:"licenseType",LICENSE_EXPIRY:"licenseExpiry",LICENSE_CATEGORY:"licenseType.category",CLUSTER:"cluster",MODEL_NUMBER:"modelNumber",IS_AVAILABLE:"isAvailable",IS_EXPIRED:"isExpired",COIN_USED:"coinUsed",COIN_TOTAL:"quantity",QUANTITY_USED:"quantityUsed",COIN_LICENSE:"coinLicense",LICENSE_ATTRIBUTE:"attribute",QUANTITY_REMAINING:"quantityRemaining",ATTRIBUTE_LICENSE:"attributeLicense"};return e.extend({urlRoot:n.PORTAL_LICENSE,name:"PortalLicenseModel",DP:s,set:function(n,i){return _.isObject(n[s.LICENSE_TYPE])&&(n[s.LICENSE_TYPE]=new t(n[s.LICENSE_TYPE])),e.prototype.set.call(this,n,i)},isNodeLicense:function(){return!(this.isCoinLicense()||this.isAttributeLicense())},isCoinLicense:function(){return this.get(s.COIN_LICENSE)||!1},isAttributeLicense:function(){return this.get(s.ATTRIBUTE_LICENSE)||!1},getExpiryUsecs:function(){var e=this.get(s.LICENSE_EXPIRY);if(_.isEmpty(e))return 0;var t=e.split("-");return new Date(Date.UTC(+t[0],+t[1]-1,+t[2])).getTime()*i.MICROS_PER_MILLI},isNodeBased:function(){var e=this.getCategory().toLowerCase();return e!==i.LICENSE_TYPES.PRO_SPECIAL.toLowerCase()&&e!==i.LICENSE_TYPES.STARTER.toLowerCase()},isOfCategory:function(e){return this.getCategory().toLowerCase()===e.toLowerCase()},isOfSubcategory:function(e){return e=(e||"").toLowerCase(),this.getSubcategory().toLowerCase()===e},isAddon:function(){return this.isOfSubcategory("addon")},isAvailable:function(){return this.get(s.IS_AVAILABLE)},getType:function(){return this.get(s.LICENSE_TYPE)},getModelNumber:function(){return this.get(s.MODEL_NUMBER)},getLicenseId:function(){return this.get(s.LICENSE_NUMBER)},getExpiry:function(){return this.get(s.LICENSE_EXPIRY)},getLicenseClass:function(){return this.get(s.LICENSE_CLASS)},isOfClass:function(e){return this.getLicenseClass().toLowerCase()===(e||"").toLowerCase()},isPrimaryLicense:function(){return!this.getLicenseClass()||(this.isOfClass(i.LICENSE_CLASSES.APPLIANCE)||this.isOfClass(i.LICENSE_CLASSES.SOFTWARE_ONLY)||this.isOfClass(i.LICENSE_CLASSES.PRISM_CENTRAL)||this.isOfClass(i.LICENSE_CLASSES.XPRESS))},isFlowLicense:function(){return this.isOfClass(i.LICENSE_CLASSES.FLOW)},isCalmLicense:function(){return this.isOfClass(i.LICENSE_CLASSES.CALM)},getCategory:function(){return this.getType().getCategory()||""},getSubcategory:function(){return this.getType().getSubcategory()||""},getAllowedModels:function(){return this.getType().getAllowedModels()},isModelAllowed:function(e){return this.getType().isModelAllowed(e)},isPairingAllowed:function(e){return this.getType().isPairingAllowed(e)},compare:function(e,t){return this.getType().compare(e,t)},getLicenseCoinTotal:function(){return this.get(s.COIN_TOTAL)||0},getLicenseCoinUsed:function(){return this.get(s.COIN_USED)||0},getCoinAvailable:function(){return this.getLicenseCoinTotal()-this.getLicenseCoinUsed()},getAttributeType:function(){return this.get(s.LICENSE_ATTRIBUTE)||""},getQuantityAvailable:function(){return this.get(s.QUANTITY_REMAINING)||0},getQuantityUsed:function(){return this.get(s.QUANTITY_USED)||0}},{DP:s})}),define("models/portal/BasePortalCollection",["models/BaseCollection","models/portal/PortalProxyModel","data/DataURLConstants","utils/AppUtil","utils/AppConstants"],function(e,t,n,i,s){"use strict";var a=_.template(n.PORTAL_API);return e.extend({restVersion:"v1",url:null,alwaysTriggerPending:!0,initialize:function(t,n){n=_.defaults({},n,{alwaysTriggerPending:this.alwaysTriggerPending}),e.prototype.initialize.call(this,t,n)},fetch:function(e){return this.sync.call(this,"read",this,e)},sync:function(e,n,i){i=i||{};var a=this,o=$.Deferred(),r=this.createProxy();return this.triggerPendingEvent(i),this.updateState(s.STATE_PENDING),this._previousOptions=_.clone(i),r.setMethod(e),r.set(t.DP.URL,this.getDataSourceURL()+this.getURL(i)),r.save(null,{success:function(e,n){a.updateState(s.STATE_SUCCESS),a.reset(e.get(t.DP.RESPONSE)),o.resolve(a,n),_.isFunction(i.success)&&i.success(a,n)},error:function(e,t){a.updateState(s.STATE_ERROR),a.trigger("error",a,t),o.reject(a,t),_.isFunction(i.error)&&i.error(a,t)}}),o.promise()},getURL:function(e){var t=this.url;return e&&e.data&&(t+="?"+i.formatObjectToQuery(e.data)),t},getDataSourceURL:function(){return a({version:this.restVersion})},createProxy:function(){return new t}})}),define("models/portal/PortalLicenseCollection",["models/portal/BasePortalCollection","models/portal/PortalLicenseModel","data/DataURLConstants"],function(e,t,n){"use strict";return e.extend({url:n.PORTAL_LICENSE,model:t,name:"PortalLicenseCollection",comparator:function(e,t){if(!e.isCoinLicense()&&!t.isCoinLicense())return e.getSubcategory()===t.getSubcategory()?e.getExpiry()>t.getExpiry()?-1:1:e.getSubcategory()>t.getSubcategory()?-1:1},hasNodeLicenses:function(){return this.some(function(e){return e.isNodeLicense()})},hasCoinLicenses:function(){return this.some(function(e){return e.isCoinLicense()})},hasAttributeLicenses:function(){return this.some(function(e){return e.isAttributeLicense()})},getLicenseById:function(e){return this.find(function(t){return t.getLicenseId()===e})}})}),define("managers/LicenseActionManager",["managers/ClusterManager","models/portal/PortalLicenseModel","models/portal/PortalLicenseCollection","models/license/LicenseModel","utils/AppUtil","utils/AppConstants"],function(e,t,n,i,s,a){"use strict";function o(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!(t.collection&&t.clusterLicenseModel&&t.licTypeCollection))throw new Error("Missing required licensing data");this.clusterManager=e,this.collection=t.collection,this.model=t.clusterLicenseModel,this.clusterNodeSummary=t.clusterNodeSummary,this.licTypeCollection=t.licTypeCollection,this.clusterCollection=this.clusterManager.getClusterCollection(),this.actions=[],this.coinLic=t.coinLic,this.ablLic=t.ablLic,this.calmLic=t.calmLic,this.flowEnabled=t.flowEnabled,this.isPC=this.clusterManager.isMulticlusterUI(),this.calmLic&&(this.calmConsumptionModel=t.calmConsumptionModel),this.licenses=new n}var r={UPGRADE:"upgrade",DOWNGRADE:"downgrade",RECLAIM:"reclaim",EXPAND:"expand",UPDATE:"update",RENEW:"renew",ADD:"add",REMOVE:"remove"},l={RECLAIM_CALM:"reclaim_calm",EXPAND_CALM:"expand_calm",UPDATE_CALM:"update_calm"},c={UPGRADE_FLOW:"upgrade_flow",EXPAND_FLOW:"expand_flow",RECLAIM_FLOW:"reclaim_flow",RENEW_FLOW:"renew_flow"},d=[r.UPGRADE,c.UPGRADE_FLOW,r.ADD,r.RECLAIM,l.RECLAIM_CALM,c.RECLAIM_FLOW,r.EXPAND,l.EXPAND_CALM,c.EXPAND_FLOW,r.UPDATE,r.RENEW,c.RENEW_FLOW,r.DOWNGRADE,r.REMOVE];return _.extend(o.prototype,{ACTIONS:r,CALM_ACTIONS:l,FLOW_ACTIONS:c,calculate:function(){var e=this.getClusterNodeCount(),t=this.getClusterLicenseType();this.actions=[],this.setLicenses(this.collection),this.licenses.each(this.getLicenseInspector(this.model,e)),this.hasUnusedLicenses(this.model.getAllLicenses())&&this.addLicenseToAction(r.RECLAIM),t&&t.getPriority()>0&&this.addLicenseToGroupedAction(r.DOWNGRADE,this.createStarterLicense()),this.model.hasAddons()&&_.each(this.model.getAllAddons(),this.addRemovalAction,this),this.prune(),this.sort()},getLicenseInspector:function(e,t){var n=this;if(!e||_.isUndefined(t))throw new Error("Missing required params: model,nodeCount");var i=this.getClusterLicenseType(),s=e.getLicensedNodeCount(),o=e.getCalmLicenseCount(),d=!_.isEmpty(e.getExpired()),p=e.getAddonListGroupByType(),u=e.getExpiredAddons();return function(h,m){if(h.isCalmLicense())return h.isAvailable()&&n.addLicenseToAction(l.EXPAND_CALM,h,m),void(o>0&&n.addLicenseToAction(l.RECLAIM_CALM,h,m));if(h.isFlowLicense()){var f=n.licTypeCollection.findByType(n.model.getPrimaryCategory(a.LICENSE_CLASSES.FLOW)),v=h.compare("=",f);return void(n.model.isFlowPurchased()?h.isAvailable()&&v?_.indexOf(n.model.getExpiredLicenseTypes(),a.LICENSE_CLASSES.FLOW)>-1?n.addLicenseToGroupedAction(c.RENEW_FLOW,h,m):n.getFlowCompliance()>0&&n.addLicenseToGroupedAction(c.EXPAND_FLOW,h,m):n.getFlowCompliance()<0&&!h.isAvailable()&&n.addLicenseToGroupedAction(c.RECLAIM_FLOW,h,m):n.flowEnabled&&n.addLicenseToGroupedAction(c.UPGRADE_FLOW,h,m))}var g=s,E=d,T=h.compare("=",i),C=h.getCategory(),S=h.isAvailable();h.isAddon()?n.isPC||(g=(p[C]||[]).length,T=g>0,E=!!u[C],0===g&&S&&h.isPairingAllowed(i.getCategory())&&n.addLicenseToGroupedAction(r.ADD,h,m)):(h.compare(">",i)&&S&&n.addLicenseToGroupedAction(r.UPGRADE,h,m),h.compare("<",i)&&S&&n.addLicenseToGroupedAction(r.DOWNGRADE,h,m)),n.canBeUpdated(e,h)&&n.addLicenseToGroupedAction(r.UPDATE,h,m),E&&T&&S&&n.addLicenseToGroupedAction(r.RENEW,h,m),n.isPC&&(g-=e.getLicensesByProduct(a.LICENSE_CLASSES.FLOW).length,g-=n.getNumCalmPacksPurchased()),g<t&&T&&h.isNodeBased()&&S&&n.addLicenseToGroupedAction(r.EXPAND,h,m)}},canBeUpdated:function(e,t){var n=e.getLicenseById(t.getLicenseId());if(!n)return!1;var s=i.DP.LICENSE_NODE_EXPIRY;return(this.coinLic||this.ablLic)&&(s=i.DP.LICENSE_COIN_EXPIRY),n[s]!==t.getExpiryUsecs()},addLicenseToAction:function(e,t,n){if(!e)throw new Error("Missing required param: actionId");var i=this.getActionById(e),s=t?a.LICENSE_ACTION_TYPES.GENERAL:this.getActionType(t);i||(i=this.createAction(e,null,{rank:this.getActionRankById(e),licenses:[],actionType:s}),this.actions.push(i)),t&&(i.data.isNodeBased=t.isNodeBased(),i.data.licenses.push(n))},addLicenseToGroupedAction:function(e,t,n){if(!e||!t)throw new Error("Missing required params: actionId, license");var i=t.getType(),o=i.getCategory(),r=this.createChildId(e,o),l=this.getActionById(e),c=this.getActionById(r),d=this.getActionType(t);l||(l=this.createAction(e,null,{rank:this.getActionRankById(e),isAddon:t.isAddon(),actionType:d,isGroupedAction:!0}),this.actions.push(l)),c||(c=this.createAction(r,e,{name:s.toTitleCase(o),category:o,rank:i.getPriority(),isNodeBased:t.isNodeBased(),isAddon:t.isAddon(),actionType:d,licenses:[]}),l.children.push(c)),t.isOfCategory(a.LICENSE_TYPES.STARTER)||c.data.licenses.push(n)},addRemovalAction:function(e){var t=r.REMOVE,n=this.createChildId(t,e.category),i=this.getActionById(t),o=this.getActionById(n),l=a.LICENSE_ACTION_TYPES.ADDON;i||(i=this.createAction(t,null,{rank:this.getActionRankById(t),isAddon:!0,actionType:l,isGroupedAction:!0}),this.actions.push(i)),o||(o=this.createAction(n,t,{name:s.toTitleCase(e.category),isAddon:!0,actionType:l,licenses:[]}),i.children.push(o)),o.data.licenses.push(e)},prune:function(e){e=e||this.actions;for(var t=e.length;t--;){var n,i=e[t];_.isEmpty(i.children)||this.prune(i.children),n=!this.hasMinLicenses(i),n&&_.isEmpty(i.children)&&(i.data.isNodeBased||i.data.isGroupedAction)&&e.splice(t,1)}},sort:function(e){e=e||this.actions,e.sort(s.getSort("data.rank")),_.each(e,function(e){_.isEmpty(e.children)||this.sort(e.children)},this)},createAction:function(e,t,n,i){if(!e)throw new Error("Missing required param: id");return{id:e,pid:t,data:n||{},children:i?[].concat(i):[]}},createStarterLicense:function(){return new t(_defineProperty({},t.DP.LICENSE_TYPE,this.licTypeCollection.createDefaultType("starter")))},createChildId:function(e,t){return(e+"_"+t).toLowerCase()},createLicenseSummary:function(e){var t=this;return _.groupBy(e,function(e){return t.licenses.at(e).getModelNumber()})},calcNumExpired:function(e){var t=Date.now()*a.MICROS_PER_MILLI;return _.reduce(e,function(e,n){var s=n[i.DP.LICENSE_EXPIRY];return s>0&&s<t?e+1:e},0)},calcNumLicensed:function(e){return this.filterUnlicensedNodes(e).length},filterUnlicensedNodes:function(e){return e=_.difference(e,this.model.getLicensesByProduct(a.LICENSE_CLASSES.FLOW)),_.filter(e,function(e){var t=(e[i.DP.LICENSE_ID]||"").trim();return Boolean(t)})},hasUnusedLicenses:function(e){return this.model.hasProduct(a.LICENSE_CLASSES.FLOW)&&(e=_.difference(e,this.model.getLicensesByProduct(a.LICENSE_CLASSES.FLOW))),_.any(e,function(e){return!e[i.DP.LICENSE_IN_USE]&&e[i.DP.LICENSE_CLASSES]!==a.LICENSE_CLASSES.FLOW})},getFlowCompliance:function(){var e=this.model.getCapacity()[a.LICENSE_ATTRIBUTE_TYPE.FLOW],t=this.model.getLicensesByClass(a.LICENSE_CLASSES.FLOW).length;return t>e?-1:t<e?1:0},hasMinLicenses:function(e){var t=e.pid||e.id;return this.model.isModelBased()&&t!==r.REMOVE?this.hasMinModelBasedLicenses(e):this.hasMinNodeBasedLicenses(e)},hasMinNodeBasedLicenses:function(e){var t=e.pid||e.id,n=(e.data.licenses||[]).length,i=this.model.getLicensesByProduct(a.LICENSE_CLASSES.FLOW),s=e.data.isAddon?this.model.getAddonNodes(e.data.category):_.difference(this.model.getNodes(),i),o=_.values(c).indexOf(t)>-1?i:s,r=_.values(c).indexOf(t)>-1?this.getFlowNodeCount():this.getClusterNodeCount();return n>=this.getMinLicenseCount(t,o,r)},hasMinModelBasedLicenses:function(e){var t=this.getClusterNodeSummary(),n=e.data.isAddon?this.model.getAddonNodeSummary(e.data.category):this.model.getNodeSummary(),i=this.createLicenseSummary(e.data.licenses);return _.all(t,function(t,s){var a=(i[s]||[]).length,o=n[s]||[];return a>=this.getMinLicenseCountByNodeGroup(e,o,s)},this)},isLicenseClassAllowed:function(e){if(this.isPC){return[a.LICENSE_CLASSES.PRISM_CENTRAL,a.LICENSE_CLASSES.FLOW,a.LICENSE_CLASSES.CALM].indexOf(e)>=0}return this.model.isOfClass(e)},isCalmAction:function(e){return _.any(l,function(t){return t===e.id})},isFlowAction:function(e){return _.any(c,function(t){return t===e.id||t===e.pid})},isGeneralAction:function(e){return _.any(r,function(t){return t===e.id})},processNeededLicenses:function(e,t,n){for(var i=[],s=0;s<e.licenses.length;s++){var o=e.attribute[s],r=a.LICENSE_ATTRIBUTE_TYPE[o.attribute],l=o.category;if(n){if(0===_.reduce(t,function(e,t){return e+t>0?1:0},0))break;t[r]>0&&(o.quantity>t[r]&&(o.quantity=t[r]),t[r]-=o.quantity,i.push(e.licenses[s]))}else{if("break"===function(){var n=[];if(_.each(t,function(e){var t=_.reduce(e,function(e,t){return e+t>0?1:0},0);n.push(t)}),_.every(n,function(e){return 0===e}))return"break";t[l][r]>0&&(t[l][r]-=o.quantity,i.push(e.licenses[s]))}())break}}return i},getActionType:function(e){return e.isAddon()?a.LICENSE_ACTION_TYPES.ADDON:e.isPrimaryLicense()?a.LICENSE_ACTION_TYPES.GENERAL:a.LICENSE_ACTION_TYPES[e.getLicenseClass().toUpperCase()]},getActionById:function(e,t){t=t||this.actions;for(var n,i=0;i<t.length&&!(n=t[i].id===e?t[i]:this.getActionById(e,t[i].children));i++);return n},getActionRankById:function(e){return d.indexOf(e)},getActions:function(){return $.extend(!0,[],this.actions)},getAddonActions:function(){return _.filter(this.getActions(),function(e){return e.id===r.ADD||e.id===r.REMOVE})},getMinLicenseCount:function(e,t,n){var i=void 0,s=0;switch(e){case c.EXPAND_FLOW:i=n-t.length;break;case c.RENEW_FLOW:var a=this.calcNumExpired(t);s=n-t.length,i=a+s;break;case r.EXPAND:s=n-this.calcNumLicensed(t);var o=s;i=s>0?o:0;break;case r.RENEW:i=this.calcNumExpired(t);break;case r.UPDATE:i=1;break;default:i=n}return i},getMinLicenseCountByNodeGroup:function(e,t,n){var i=this.getClusterNodeSummary(),s=(i[n]||[]).length;return this.getMinLicenseCount(e.pid||e.id,t,s)},getClusterLicenseType:function(){return this.licTypeCollection.findByType(this.model.getCategory())},getClusterNodeCount:function(){var e=this.clusterNodeSummary[a.NODES_COUNTS];return this.isPC&&0===e?1:e},getFlowNodeCount:function(){return this.model.getCapacity()[a.LICENSE_ATTRIBUTE_TYPE.FLOW]||0},getClusterNodeModels:function(){return _.keys(this.getClusterNodeSummary())},getClusterNodeSummary:function(){return this.clusterNodeSummary[a.NODES_MODELS]},getModelNumberValidator:function(e){var t={};return function(n){var i=n.getAllowedModels(),s=!1;if(_.isEmpty(i))return!0;for(var a in e)if(e.hasOwnProperty(a)){var o=t[a]||0,r=e[a].length;if(s=o<r&&_.contains(i,a)){t[a]=t[a]?t[a]+1:1;break}}return s}},setLicenses:function(e){var t=this,n=this.getClusterNodeModels(),i=this.model.isModelBased(),o=this.getModelNumberValidator(this.getClusterNodeSummary()),r=e.filter(function(e){return!(s.compareVersions(t.clusterManager.getCurrentClusterVersion(),a.LICENSE_FILE_BUCKET_VERSION)>=0&&e.isOfCategory(a.ADDON_LICENSE_TYPES.FILE_SERVER)&&e.isAddon())&&(!!t.isLicenseClassAllowed(e.getLicenseClass())&&(i?_.contains(n,e.getModelNumber()):!e.isCoinLicense()&&!e.isAttributeLicense()&&o(e)))});this.licenses.reset(r)},pluckByRef:function(e,t){return _.map(t,function(t){return this.licenses.at(t).get(e)},this)},pluckIdByRef:function(e){return this.pluckByRef(t.DP.LICENSE_NUMBER,e)},cloneModelFromNodes:function(e){var t=this.model.clone();return t.set(i.DP.NODE_LICENSE_LIST,e),t},mixinExisting:function(e,t){if(e=e||[],t){if(t.id!==r.RECLAIM&&t.id!==r.UPDATE)if(this.isFlowAction(t))e=e.concat(_.pluck(this.model.getLicensesByProduct(a.LICENSE_CLASSES.PRISM_CENTRAL),i.DP.LICENSE_ID));else{var n=t.data.isAddon?this.model.getLicensedNodes():this.model.getAllAddons();if(e=e.concat(_.pluck(n,i.DP.LICENSE_ID)),this.model.getLicensesByProduct(a.LICENSE_CLASSES.FLOW).length){var s=this.model.getLicensesByProduct(a.LICENSE_CLASSES.FLOW);e=e.concat(_.pluck(s,"licenseId"))}}if(this.calmLic&&!this.isCalmAction(t)&&this.model.getCalmLicenses().length){var o=this.model.getCalmLicenses();e=e.concat(_.pluck(o,"licenseId"))}}return e},processAction:function(e){var t=e.pid||e.id,n=_.bind(this.getActionProcessor(t),this),i=[];if(this.model.isModelBased()&&t!==r.REMOVE&&t!==r.RECLAIM&&t!==r.UPDATE){var s=this.getClusterNodeSummary(),o=e.data.isAddon?this.model.getAddonNodeSummary(e.data.category):this.model.getNodeSummary(),l=this.createLicenseSummary(e.data.licenses);_.each(s,function(e,t){var s=o[t]||[],a=(this.cloneModelFromNodes(s),l[t]||[]);i=i.concat(n(a,s,e.length))},this)}else{var c=e.data.isAddon?this.model.getAddonNodes(e.data.category):this.model.getNodes();i=this.isCalmAction(e)?i.concat(n(e.data.licenses,c,e.data.calmPacks)):this.isFlowAction(e)?i.concat(n(e.data.licenses,c,this.model.getCapacity()[a.LICENSE_ATTRIBUTE_TYPE.FLOW])):i.concat(n(e.data.licenses,c,this.getClusterNodeCount()))}return this.mixinExisting(i,e)},getActionProcessor:function(e){var t;switch(e){case r.RECLAIM:t=this.processReclaim;break;case l.RECLAIM_CALM:t=this.processReclaimCalm;break;case r.EXPAND:t=this.processExpand;break;case l.EXPAND_CALM:t=this.processExpandCalm;break;case r.RENEW:t=this.processRenew;break;case r.ADD:t=this.processAdd;break;case r.REMOVE:t=this.processRemove;break;case r.UPDATE:t=this.processUpdate;break;case c.EXPAND_FLOW:t=this.processExpandFlow;break;case c.RECLAIM_FLOW:t=this.processReclaimFlow;break;case c.RENEW_FLOW:t=this.processRenewFlow;break;default:t=this.processGeneric}return t},processGeneric:function(e,t,n){return this.pluckIdByRef(e.slice(0,n))},processAdd:function(e,t,n){var i=_.pluck(this.model.getAllAddons(),"licenseId"),s=this.pluckIdByRef(e.slice(0,n));return _.union(i,s)},processRemove:function(e,t,n){var i=_.pluck(this.model.getAllAddons(),"licenseId"),s=_.pluck(e,"licenseId");return _.difference(i,s)},processUpdate:function(e,t,n){return _.pluck(this.model.getAllLicenses(),"licenseId")},processReclaim:function(e,t,n){var s=[];return _.each(this.model.getAllLicenses(),function(e){e[i.DP.LICENSE_ID]&&e[i.DP.LICENSE_IN_USE]&&s.push(e[i.DP.LICENSE_ID])}),s},processExpand:function(e,t,n){var i=this.filterUnlicensedNodes(t),s=e.slice(0,n-i.length),a=_.pluck(i,"licenseId"),o=this.pluckIdByRef(s);return a.concat(o)},processExpandCalm:function(e,t,n){var i=this.filterUnlicensedNodes(t),s=e.slice(0,n),a=this.pluckIdByRef(s);return _.pluck(i,"licenseId").concat(a)},processReclaimCalm:function(e,t,n){var i=this,s=[],o=[];_.each(t,function(e){i.model.isOfClass(a.LICENSE_CLASSES.CALM,e)?s.push(e):e.licenseId&&o.push(e)}),s=s.slice(0,s.length-n);var r=_.pluck(o,"licenseId"),l=_.pluck(s,"licenseId");return r.concat(l)},processRenew:function(e,n,i){var s=t.DP,o=_.clone(e),r=Date.now()*a.MICROS_PER_MILLI,l=this.filterUnlicensedNodes(n),c=[];return _.each(l,function(e){var t=e.nodeExpiryUsecs<r?this.licenses.at(o.shift()).get(s.LICENSE_NUMBER):e.licenseId;c.push(t)},this),c},processExpandFlow:function(e,t,n){var i=this,s=_.filter(t,function(e){i.model.isOfClass(a.LICENSE_CLASSES.FLOW,e)}),o=e.slice(0,n-s.length),r=_.pluck(s,"licenseId"),l=this.pluckIdByRef(o);return r.concat(l)},processReclaimFlow:function(e,t,n){var i=this,s=_.filter(t,function(e){i.model.isOfClass(a.LICENSE_CLASSES.FLOW,e)}),o=t.slice(0,s.length-n);return _.pluck(o,"licenseId")},processRenewFlow:function(e,t,n){var i=this,s=Date.now()*a.MICROS_PER_MILLI,o=_.filter(t,function(e){return i.model.isOfClass(a.LICENSE_CLASSES.FLOW,e)&&e.nodeExpiryUsecs>s}),r=e.slice(0,n-o.length),l=_.pluck(o,"licenseId"),c=this.pluckIdByRef(r);return l.concat(c)},getTotalCalmPacksRequired:function(){if(this.calmConsumptionModel&&this.calmConsumptionModel.getQueryResultAttributes()){var e=this.calmConsumptionModel.getQueryResultAttributes()[0],t=e?e.required_packs:0;return Number(t)}return 0},getCalmVmCount:function(){if(this.calmConsumptionModel&&this.calmConsumptionModel.getQueryResultAttributes()){var e=this.calmConsumptionModel.getQueryResultAttributes()[0],t=e?e.unique_active_vms:0;return Number(t)}return 0},getNumCalmPacksPurchased:function(){return this.model.getCalmLicenses().length},getCalmExtraPacks:function(){return this.model.getCalmExtraPacks()},getCalmPackDiff:function(){return this.getTotalCalmPacksRequired()-this.getNumCalmPacksPurchased()}}),o}),define("views/popups/licensing/LicenseActionsView",["views/basecomponents/BaseSubView","models/license/LicenseFileModel","models/portal/PortalLicenseStateModel","managers/LicenseActionManager","utils/CommonTemplates","utils/AppConstants","utils/AppUtil"],function(e,t,n,i,s,a,o){"use strict";var r=_.template('<div class="action-msg"></div><% if (canModify) { %><div class="action-ctr"><span class="dynamic-actions"><%= Components.button({extraClasses: "btnConfigure",isPrimary: true,text: i18n("update_manually")}) %></span></div><% } %>'),l=_.template('<%= Components.button({extraClasses: "actionBtn " + actionType + "Btn",isPrimary: true,text: i18ns(pid || id, data.name),extraAttr: [{key: "data-action",value: id}]}) %>'),c=_.template('<div class="btn-group multi-action-btn <%= actionType %>Btn"><button type="button" class="btn btn-<%= btnType %> dropdown-toggle" data-toggle="dropdown"><%= i18n(id + "_grouped") %> <span class="caret"></span></button><ul class="dropdown-menu actions" role="menu"><% _.each(children, function(child) { %><li><a class="actionBtn" data-action="<%= child.id %>"><%= i18ns(child.pid || id, child.data.name) %></a></li><% }) %></ul></div>'),d=_.template('<%= Components.button({extraClasses: actionType + "Btn",isPrimary: true,text: btnDisplayName,extraAttr: [{key: "data-action",value: id}]}) %>'),p=_.template('<div data-action="<%= id %>" class="calm-action-popover"><%= inputLabel %><section class="calm-pack-input"><input type="number" min="0" class="inputCalmPacks" value="<%= calmPackInputVal %>"></section><% if (calmCoinRows) { %><div class="calmCoinPricing"><%= calmCoinRows %></div><% } %><section class="btn-container"><%= Components.button({extraClasses: disableConfirm + actionType + "Btn popoverActionBtn action-btn",isPrimary: true,text: i18n("confirm"),extraAttr: [{key: "data-action",value: id}]}) %></section></div>'),u=_.template('<section><table class="table"><tbody><% _.each(rows, function(row) { %><tr><td><%= row.label %></td><td class="text-right calm-info"><%= row.value %></td></tr><% }) %></tbody></table></section>');return e.extend({name:"LicenseActionsView",collection:null,coinLic:!1,portalCoinModel:null,showDynamic:!0,_sweAddonRegex:null,events:{"click .actionBtn":"onClickAction","click .popoverBtn":"onClickPopoverBtn"},EVENTS:{ACTION_START:"action:start",ACTION_COMPLETE:"action:complete",ACTION_PROGRESS:"action:progress",ACTION_ERROR:"action:error"},initialize:function(t){if(e.prototype.initialize.call(this,arguments),!t||!t.parentView)throw new Error("Missing required param: parentView");this.collection=t.collection,this.parentView=t.parentView,this.proxyConfigModel=t.proxyConfigModel,this.clusterLicenseModel=t.clusterLicenseModel,this.clusterNodeSummary=t.clusterNodeSummary,this.licTypeCollection=t.licTypeCollection,this.csfModel=t.csfModel,this.clusterCollection=this.clusterManager.getClusterCollection(),this.coinLic=t.coinLic,this.ablLic=t.ablLic,this.nodeLic=t.nodeLic,this.mixedLic=t.mixedLic,this.calmLic=t.calmLic,this.flowEnabled=t.flowEnabled||!1,this.actionViewType=t.actionViewType,this.portalCoinModel=t.coinModel,this.actions=t.actions||[];var n={collection:t.collection,clusterNodeSummary:t.clusterNodeSummary,licTypeCollection:t.licTypeCollection,clusterLicenseModel:t.clusterLicenseModel,coinLic:t.coinLic,flowEnabled:t.flowEnabled};this.calmLic&&(this.calmConsumptionModel=t.calmConsumptionModel,this.popoverDataStore={},n=_.extend(n,{calmConsumptionModel:t.calmConsumptionModel})),this.actionManager=t.licActionManager||new i(n),this._sweAddonRegex=new RegExp("^"+this.actionManager.ACTIONS.ADD+"_"+a.ADDON_LICENSE_TYPES.SOFTWARE_ENCRYPTION+"$","i"),_.bindAll(this,"getErrorHandler","renderActions","onKeypress","popoverClickHandler","onCalmPackInput","getPopoverActionData")},render:function(){if(!this.allDepsFetched()&&this.proxyConfigModel.isActive())this.renderLoading();else{var e=this.parentView.canModify(),t=r(this.vtOptions({canModify:e}));if(this.$el.html(t),this.calmLic){var n=this.actionManager.getCalmPackDiff();if(n>0){var i="",s=o.pluralize(this.name,"packs","packs","pack","packs",n);if(this.coinLic){var a=this.actionManager.getCalmCoinDiff(),l=o.pluralize(this.name,"coins","coins","coin","coins",a);i+=this.i18ns("pls_expand_calm_lics",n,s,a,l)}else i+=this.i18ns("pls_expand_calm_lics",n,s,n,s);this.showHeaderError(i)}}e&&this.canUseDynamicActions()&&this.renderActions()}return this},canUseDynamicActions:function(){var e=this.showDynamic&&this.proxyConfigModel.isActive()&&this.collection.getState()===a.STATE_SUCCESS&&this.licTypeCollection.getState()===a.STATE_SUCCESS;return this.coinLic?e&&this.portalCoinModel.getState()===a.STATE_SUCCESS:e},allDepsFetched:function(){var e=this.mixedLic||this.clusterLicenseModel.hasProduct(a.LICENSE_CLASSES.FILE)||this.clusterLicenseModel.hasProduct(a.LICENSE_CLASSES.BUCKET)||this.clusterLicenseModel.isVDIEnabled()||this.clusterLicenseModel.isRoboEnabled();if(!this.proxyConfigModel.isEnabled(e))return!0;var t=[this.collection.getState()];return this.coinLic&&t.push(this.portalCoinModel.getState()),_.all(t,function(e){return!(e===a.STATE_INIT||e===a.STATE_PENDING)})},renderActions:function(){var e=this,t=this.getActions();if(_.isEmpty(t)){var n=!_.isEmpty(this.clusterLicenseModel.getFeatureViolations()),i="";return this.nodeLic?(i=a.LICENSE_CLUSTER_TYPE.NODE,n=n||this.clusterLicenseModel.hasUnlicensedNodes()):this.coinLic?(i=a.LICENSE_CLUSTER_TYPE.COINS,n=n||this.clusterLicenseModel.hasUnlicensedCapacity()>0):this.ablLic&&(i=a.LICENSE_CLUSTER_TYPE.ATTRIBUTE,n=n||this.clusterLicenseModel.hasUnlicensedCapacity()>0),void(n&&this.showHeaderError(this.i18ns("no_licenses_msg",i,this.i18n("update_manually"))))}if(this.clusterManager.isMulticlusterUI())switch(this.actionViewType){case a.LICENSE_CLASSES.CALM:t=_.filter(t,function(t){return e.actionManager.isCalmAction(t)});break;case a.LICENSE_CLASSES.FLOW:t=_.filter(t,function(t){return e.actionManager.isFlowAction(t)});break;default:t=_.filter(t,function(t){return e.actionManager.isGeneralAction(t)})}this._renderActions(t)},renderLoading:function(e){e=e||this.i18n("loading_actions"),this.$el.html(s.LOADING_MSG({msg:e}))},getPopoverActionData:function(e){var t=this;return-1!==[this.actionManager.CALM_ACTIONS.EXPAND_CALM,this.actionManager.CALM_ACTIONS.RECLAIM_CALM].indexOf(e.id)&&{title:this.i18n(e.id.split("_")[0]),placement:"top",trigger:"manual",container:$("."+a.LICENSE_CLASSES.CALM+"-summary"),html:!0,content:function(){var n=t.actionManager.getCalmPackDiff(),i=e,s=t.getPopoverState(e.id,"calmPackInputVal");return _.isUndefined(s)&&(s=e.id===t.actionManager.CALM_ACTIONS.EXPAND_CALM&&n>0?n:e.id===t.actionManager.CALM_ACTIONS.RECLAIM_CALM&&n<0?Math.abs(n):0,t.setPopoverState(e.id,"calmPackInputVal",s)),i=_.extend(i,{isPrimary:!0,actionType:"general",calmPackInputVal:s,disableConfirm:s<1||!_.isNumber(s)?"disabled ":"",inputLabel:t.i18n("num_calm_packs"),calmCoinRows:!!t.coinLic&&t.getCalmActionTableInfo(e)}),p(t.vtOptions(i))}}},setPopoverState:function(e,t,n){this.popoverDataStore[e]=this.popoverDataStore[e]||{},this.popoverDataStore[e][t]=n},getPopoverState:function(e,t){return(this.popoverDataStore[e]||{})[t]},_renderActions:function(e){var t=this,n="",i=this.$(".action-ctr > .dynamic-actions"),s="",a={},o=e.length>1&&this.nodeLic;o&&(s=e[0].data.actionType,a={id:"manage",children:[],data:{actionType:s}}),_.each(e,function(e,i,s){o?(a.children=a.children.concat(e.children.length>0?e.children:e),i===s.length-1&&(n+=t.createGroupedActionBtn(a))):e.data.isBanner||(t.getPopoverActionData(e)?n+=t.createGroupedPopoverActionBtn(e):n+=t.createGroupedActionBtn(e))}),i.html(n),_.each(e,function(e){$('[data-action="'+e.id+'"]').popover(t.getPopoverActionData(e))})},getActions:function(){return this.actionManager.getActions()},getBannerActions:function(){var e=this.getActions();return e?_.filter(e,function(e){return e.data.isBanner}):[]},getErrorHandler:function(e,t){var n=this;return function(i,s){var a=n.i18n(e)||n.i18n("error_unknown"),o=s&&s.responseText;!t&&o||n.showHeaderError(a),n.trigger(n.EVENTS.ACTION_ERROR,s),n.render()}},updateLicenseState:function(e){var i=this;this.renderLoading(this.i18n("loading_license_req")),this.trigger(this.EVENTS.ACTION_START,e),this.csfModel.fetch({success:function(s){i.trigger(i.EVENTS.ACTION_PROGRESS,e);var o=new n,r=i.actionManager.processAction(e),l=i.nodeLic?r:r.licIds;o.setLicenses(l),o.setCSF(s),i.coinLic&&(o.setCoin(r.coinSummary||{}),o.setLicenseMode(a.LICENSE_CLUSTER_TYPE.COINS)),i.ablLic&&o.setLicenseMode(a.LICENSE_CLUSTER_TYPE.ATTRIBUTE),i.nodeLic&&o.setLicenseMode(a.LICENSE_CLUSTER_TYPE.NODE),r.workflow&&o.setWorkflow(r.workflow),o.save(null,{success:function(n){i.trigger(i.EVENTS.ACTION_PROGRESS,e),new t(n.getLSF()).save(null,{success:function(){i.trigger(i.EVENTS.ACTION_PROGRESS,e),i.trigger(i.EVENTS.ACTION_COMPLETE,e)},error:i.getErrorHandler("error_license_apply")})},error:i.getErrorHandler("error_lsf_generation")})},error:this.getErrorHandler("error_csf_generation")})},delegateViewEvents:function(){$(window).on("keydown",{isPressed:!0},this.onKeypress),
$(window).on("keyup",{isPressed:!1},this.onKeypress)},undelegateViewEvents:function(){$(window).off("keydown",this.onKeypress),$(window).off("keyup",this.onKeypress)},onStartServices:function(){this.delegateEvents(),this.delegateModelEvents(),this.delegateViewEvents()},onStopServices:function(){this.undelegateEvents(),this.undelegateModelEvents(),this.undelegateViewEvents()},onKeypress:function(e){e.which===$.ui.keyCode.SHIFT&&this.proxyConfigModel.isActive()&&(this.showDynamic=!e.data.isPressed,this.render(),this.parentView.hideButtons())},onClickAction:function(e){var t=$(e.target).closest("[data-action]").attr("data-action"),n=this.actionManager.getActionById(t);this.executeAction(n)},executeAction:function(e){this.updateLicenseState(e)},createGroupedActionBtn:function(e){e=1===e.children.length?_.first(e.children):e;var t=e.data.actionType;return(_.isEmpty(e.children)?l:c)(_.extend(this.vtOptions(e),{btnType:"primary",isPrimary:!0,actionType:t}))},createGroupedPopoverActionBtn:function(e){var t=_.extend(this.vtOptions(e),{isPrimary:!0,actionType:"popover",btnDisplayName:this.i18n(e.id.split("_")[0])});return d(t)},onClickPopoverBtn:function(e){var t=$(e.target).closest("[data-action]").attr("data-action"),n=$(".popoverBtn");_.each(n,function(e){$(e).attr("data-action")===t?$(e).popover("show"):$(e).popover("hide")}),e.stopPropagation(),$(window).on("click",this,this.popoverClickHandler),$(".inputCalmPacks").on("click",this,this.onCalmPackInput),$(".inputCalmPacks").on("keyup",this,this.onCalmPackInput)},getCalmActionTableInfo:function(e){var t=this.getPopoverState(e.id,"calmPackInputVal"),n=[];if(e.id===this.actionManager.CALM_ACTIONS.EXPAND_CALM){var i=25*t,s=t*this.actionManager.getCoinsRequiredPerCalmPack();n=[{label:this.i18n("vms_supported"),value:i},{label:this.i18n("coins_required"),value:s}]}else if(e.id===this.actionManager.CALM_ACTIONS.RECLAIM_CALM){var a=t*this.actionManager.getCoinsRequiredPerCalmPack();n=[{label:this.i18n("coins_reclaimed"),value:a}]}return u({rows:n})},onCalmPackInput:function(e){if(e.which===$.ui.keyCode.ENTER)this.onClickPopoverAction(e);else{var t=$(e.target).closest("[data-action]").attr("data-action"),n=Number($(e.currentTarget).val())||0,i=$('.popoverActionBtn[data-action="'+t+'"]');n<1||!_.isNumber(n)?i.addClass("disabled"):i.removeClass("disabled");var s=this.actionManager.getActionById(t);this.setPopoverState(s.id,"calmPackInputVal",n),this.coinLic&&$(".calmCoinPricing").html(this.getCalmActionTableInfo(s))}},hidePopovers:function(){this.$(".popoverBtn").popover("hide"),$(window).off("click",this,this.popoverClickHandler),$(".inputCalmPacks").off("click",this,this.onCalmPackInput),$(".inputCalmPacks").off("keyup",this,this.onCalmPackInput)},onClickPopoverAction:function(e){var t=$(e.target).closest("[data-action]").attr("data-action"),n=this.actionManager.getActionById(t),i=$('[data-action="'+t+'"] .inputCalmPacks'),s=Number(i.val());if(_.isNumber(s)){var a=this.actionManager.getCalmExtraPacks();if(n.id===this.actionManager.CALM_ACTIONS.RECLAIM_CALM&&s>a)this.showHeaderError(this.i18ns("max_reclaim_err",a));else if(n.id===this.actionManager.CALM_ACTIONS.EXPAND_CALM){if(this.nodeLic&&s>n.data.licenses.length)return void this.showHeaderError(this.i18ns("max_expand_err_node",n.data.licenses.length));if(this.coinLic){var r=_.reduce(n.data.coin,function(e,t){return e+t},0),l=s*this.actionManager.getCoinsRequiredPerCalmPack();if(l>r){var c=o.pluralize(this.name,"packs","packs","pack","packs",s);return void this.showHeaderError(this.i18ns("max_expand_err_coin",s,c,l,r))}}}n.data.calmPacks=s,this.executeAction(n),this.hidePopovers()}},popoverClickHandler:function(e){var t=$(e.target),n=t.hasClass("popover")||t.parents(".popover").length;t.parent().hasClass("popoverActionBtn");n||this.hidePopovers(),t.parent().hasClass("popoverActionBtn")&&this.onClickPopoverAction(e)}})}),define("models/portal/PortalLicenseTypeCollection",["models/portal/BasePortalCollection","models/portal/PortalLicenseTypeModel","data/DataURLConstants","utils/AppConstants"],function(e,t,n,i){"use strict";var s={no_license:{category:"no_license",subcategory:null,name:"No License",priority:0},pro_trial:{category:"pro_trial",subcategory:null,name:"Pro Trial",priority:0},starter:{category:"Starter",subcategory:null,name:"Starter",priority:0},pro:{category:"Pro",subcategory:null,name:"Pro",priority:2},ultimate:{category:"Ultimate",subcategory:null,name:"Ultimate",priority:3.1},prism_pro:{category:"Pro",subcategory:null,name:"Pro",priority:2}},a=["starter","pro","ultimate"],o=["pro_trial","prism_pro"];return e.extend({url:n.PORTAL_LICENSE_TYPE,model:t,name:"PortalLicenseTypeCollection",createDefaultType:function(e){return _.isString(e)?(e=e.toLowerCase(),new t(s[e]||{})):null},findByType:function(e){return this.find(function(t){return t.isOfType(e)})||this.createDefaultType(e)},findBySubCategory:function(e){return e===i.LICENSE_SUBCATEGORIES.ADDON?this.filter(function(t){return t.getSubcategory()===e}):e===i.LICENSE_SUBCATEGORIES.PRISM_CENTRAL?_.map(o,this.createDefaultType):_.map(a,this.createDefaultType)}})}),define("models/portal/PortalCoinModel",["models/portal/BasePortalModel","utils/AppConstants","data/DataURLConstants"],function(e,t,n){"use strict";var i={LICENSE_TYPE:"licensetype",COIN_REQUIRED:"COIN",LICENSE_ADDON:"addon"};return e.extend({urlRoot:n.PORTAL_PRICER,name:"PortalCoinModel",DP:i,getLicenseType:function(){return this.get(i.LICENSE_TYPE)||{}},getAddon:function(){return this.get(i.LICENSE_ADDON)||{}},getAllTypes:function(){return _.extend({},this.getLicenseType(),this.getAddon())},getCoinRequired:function(e,n){return e===t.LICENSE_TYPES.ULTIMATE&&this.getAddon()[n]?0:this.getAllTypes()[n]||0},isOfCategory:function(e){return!!this.getAllTypes()[e]},getCoinByType:function(e,n){return n=n?n.toLowerCase():"","prism_central_pro"===n&&(n=t.LICENSE_TYPES.PRISM_PRO.toLowerCase()),n===t.LICENSE_TYPES.CALM.toLowerCase()?this.getCoinRequired(e,n):(n===t.ADDON_LICENSE_TYPES.SOFTWARE_ENCRYPTION.toLowerCase()&&e===t.LICENSE_TYPES.PRO&&(n=t.ADDON_LICENSE_TYPES.DATA_ENCRYPTION.toLowerCase()),this.isOfCategory(n)?this.getCoinRequired(e,n):0)}})}),define("managers/CoinLicenseActionManager",["managers/LicenseActionManager","data/DataProperties","utils/AppUtil","utils/AppConstants"],function(e,t,n,i){"use strict";function s(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.call(this,t),this.portalCoinModel=t.portalCoinModel}var a={SELECT_GENERAL:"select",SELECT_ADDON:"select_addon",SELECT:"select",MANAGE_GENERAL:"manage",MANAGE_ADDON:"manage_addon",UPGRADE:"upgrade",DOWNGRADE:"downgrade",RECLAIM:"reclaim",EXPAND:"expand",RENEW:"renew",ADD:"add",REMOVE:"remove"},o={RECLAIM_CALM:"reclaim_calm",EXPAND_CALM:"expand_calm"},r=[a.SELECT_GENERAL,a.SELECT_ADDON,a.SELECT,a.MANAGE_GENERAL,a.MANAGE_ADDON,a.UPGRADE,a.RENEW,a.DOWNGRADE,a.ADD,a.REMOVE,a.EXPAND,o.EXPAND_CALM,a.RECLAIM,o.RECLAIM_CALM],l=i.LICENSE_COIN_EXPIRY_THRESHOLD;return s.prototype=Object.create(e.prototype),_.extend(s.prototype,{name:"CoinLicenseActionManager",ACTIONS:a,calculate:function(){var e=this;this.actions=[],this.setCoinLicenses(this.collection),this.isPC||(this.addonLicenses=this.model.getAddonLicenseList()),this.clusterLicenses=this.model.getCoinLicenseList(),this.totalCoinRequired=this.getTotalCoinRequired(),this.coinDiff=this.getCoinDiff(),this.calmLic&&(this.calmCoinDiff=this.getCalmCoinDiff()),this.licenses.each(this.getCoinLicenseInspector(this.model)),this.model.hasGeneralLicense()&&this.coinDiff<0&&_.each(this.clusterLicenses,function(t){var n={actionId:a.RECLAIM,childActionId:null,license:t,isAddon:!1,isBanner:!0};e.addCoinReduceAction(n)}),this.model.hasAddons()&&_.each(this.addonLicenses,function(t){var n={actionId:a.MANAGE_ADDON,childActionId:a.REMOVE,license:t,isAddon:!0,isBanner:!1};e.addCoinReduceAction(n)}),this.prune(),this.sort()},prune:function(e){e=e||this.actions;for(var t=e.length;t--;){var n=e[t],i=void 0;_.isEmpty(n.children)||this.prune(n.children),i=!!n.data.isGroupedAction||(n.data.isAddon?!this.hasMinCoinAddonLicense(n):!this.hasMinCoinLicense(n)),(i&&_.isEmpty(n.children)&&!n.data.isGroupedAction||n.data.isGroupedAction&&_.isEmpty(n.children))&&e.splice(t,1)}},setCoinLicenses:function(e){var t=e.filter(function(e){return e.getLicenseCoinTotal()>0&&e.isCoinLicense()});this.licenses.reset(t)},getCoinLicenseInspector:function(e){var t=this;if(!e)throw new Error("Missing required params: model");var n=this.getClusterLicenseType(),s=this.isPC?[]:this.licTypeCollection.findBySubCategory(i.LICENSE_SUBCATEGORIES.ADDON),r=this.isPC?this.licTypeCollection.findBySubCategory(i.LICENSE_SUBCATEGORIES.PRISM_CENTRAL):this.licTypeCollection.findBySubCategory(),l=void 0;this.calmLic&&(l=[this.licTypeCollection.findByType("Calm")]);var c=this.getRenewMilli(),d=this.model.getCoinExpiryAfterDate(null,c),p={};return function(e,i){e.isAvailable()&&(_.each(r,function(s){t.model.hasGeneralLicense()?t.compare(s,">",n)?(p={actionId:a.MANAGE_GENERAL,childActionId:a.UPGRADE,license:e,type:s,isAddon:!1,idx:i},t.addLicenseToGroupedAction(p)):t.compare(s,"<",n)?(p={actionId:a.MANAGE_GENERAL,childActionId:a.DOWNGRADE,license:e,type:s,isAddon:!1,idx:i},t.addLicenseToGroupedAction(p)):t.compare(s,"=",n)&&(t.coinDiff>0&&(p={actionId:a.EXPAND,license:e,type:s,isBanner:!0,idx:i},t.addLicenseToAction(p)),(t.model.getCoinExpired()||d>0)&&(p={actionId:a.RENEW,license:e,type:s,isBanner:!0,idx:i},t.addLicenseToAction(p))):(p={actionId:a.SELECT_GENERAL,childActionId:a.SELECT_GENERAL,license:e,type:s,isAddon:!1,idx:i},t.addLicenseToGroupedAction(p))}),t.calmLic&&_.each(l,function(n){p={actionId:o.EXPAND_CALM,license:e,type:n,isBanner:!1,idx:i},t.addLicenseToAction(p),t.calmCoinDiff<0&&(p={actionId:o.RECLAIM_CALM,license:e,type:n,isBanner:!1,idx:i},t.addLicenseToAction(p))}),t.isPC||_.each(s,function(s){s.isPairingAllowed(n.getCategory())&&(t.model.hasAddons()?t.model.getAddonCoinByType(s.getCategory())<0&&(p={actionId:a.MANAGE_ADDON,childActionId:a.ADD,license:e,type:s,isAddon:!0,idx:i},t.addLicenseToGroupedAction(p)):(p={actionId:a.SELECT_ADDON,childActionId:a.ADD,license:e,type:s,isAddon:!0,idx:i},t.addLicenseToGroupedAction(p)))}))}},addLicenseToAction:function(e){var t=e.actionId,i=e.license,s=e.type,a=e.isBanner,o=e.idx;if(!t)throw new Error("Missing required param: actionId");var r=this.getActionById(t),l=s.getCategory()||"";r||(r=this.createAction(t,null,{rank:this.getActionRankById(t),licenses:[],category:l,name:n.toTitleCase(l),coin:[],isBanner:a||!1}),this.actions.push(r)),i&&(r.data.coin.push(i.getCoinAvailable()),r.data.licenses.push(o))},addLicenseToGroupedAction:function(e){var t=e.actionId,s=e.childActionId,a=e.license,o=e.type,r=e.isAddon,l=e.idx;if(!t||!a)throw new Error("Missing required params: actionId, license");var c=o,d=c.getCategory(),p=this.createChildId(s||t,d),u=this.getActionById(t),h=this.getActionById(p),m=r?i.LICENSE_ADDON_NAMES[d.toUpperCase()]:d;m&&(u||(u=this.createAction(t,null,{rank:this.getActionRankById(t),isGroupedAction:!0,isAddon:r,isBanner:!1}),this.actions.push(u)),h||(h=this.createAction(p,s||t,{name:n.toTitleCase(m),category:d,rank:s?c.getPriority():this.getActionRankById(t),isAddon:r,licenses:[],coin:[],isBanner:!1}),u.children.push(h)),h.data.coin.push(a.getCoinAvailable()),h.data.licenses.push(l))},addCoinReduceAction:function(e){var s=e.actionId,a=e.childActionId,o=e.license,r=e.isAddon,l=e.isBanner,c=this.createChildId(a,o.category||""),d=this.getActionById(s),p=this.getActionById(c),u=r?i.LICENSE_ADDON_NAMES[o.category.toUpperCase()]:o.category;a?(d||(d=this.createAction(s,null,{rank:this.getActionRankById(s),isGroupedAction:!0,isAddon:r,isBanner:l||!1}),this.actions.push(d)),p||(p=this.createAction(c,a,{name:n.toTitleCase(u),rank:this.getActionRankById(s),category:o.category,isAddon:r,licenses:[],coin:[],isBanner:l||!1}),d.children.push(p)),o&&(p.data.licenses.push(o),p.data.coin.push(o[t.LICENSE_COINS_APPLIED]))):d||(d=this.createAction(s,null,{rank:this.getActionRankById(s),licenses:[],category:this.model.getCategory(),name:"",coin:[],isBanner:l||!1}),this.actions.push(d),o&&(d.data.licenses.push(o),d.data.coin.push(o[t.LICENSE_COINS_APPLIED])))},getActionRankById:function(e){return r.indexOf(e)},hasMinCoinLicense:function(e){var t=this.model.getGeneralCoinTotal(),n=this.getAvailableCoinTotal(e.data.coin);return this.hasMinCoinNum(e,t,n)>=0},hasMinCoinAddonLicense:function(e){if(!e)throw new Error("Missing required param: action");var t=this.model.getAddonCoinByType(e.data.category),n=this.getAvailableCoinTotal(e.data.coin);return this.hasMinCoinNum(e,t,n)>=0},hasMinCoinNum:function(e,t,n){var i=e.pid||e.id,s=e.data.category,o=void 0,r=0;switch(i){case a.EXPAND:o=this.totalCoinRequired,r=n-(o-t);break;case a.RENEW:var l=this.getRenewMilli();r=n-this.model.getCoinExpiryAfterDate(this.clusterLicenses,l),r-=this.totalCoinRequired-t;break;case a.UPGRADE:case a.ADD:case a.SELECT:o=this.getCoinRequirement(s),r=n-(o-t);break;default:r=t}return r},getAvailableCoinTotal:function(e){var t=0;return _.each(e,function(e){t+=e}),t},getCoinRequirement:function(e){var t=this.model.getCategory();return e!==i.LICENSE_CLASSES.CALM&&(e=this.isPC?this.model.getLicenseClass()+"_"+e:e),this.portalCoinModel.getCoinByType(t,e)},getLicListToAdd:function(e,t){for(var n=[],i=0;i<e.length&&!(t<=0);i++)t-=e[i],n.push(i);return n},getCoinsRequiredPerCalmPack:function(){return this.getCoinRequirement(i.LICENSE_CLASSES.CALM)},getCoinsAppliedTowardCalm:function(){return this.model.getCalmCoinTotal()},getNumCalmPacksPurchased:function(){return this.getCoinsAppliedTowardCalm()/this.getCoinsRequiredPerCalmPack()},getTotalCalmCoinRequired:function(){return this.getTotalCalmPacksRequired()*this.getCoinsRequiredPerCalmPack()},getTotalCoinRequired:function(){var e=this,n=this.model.getCategory();return n?_.reduce(this.addonLicenses,function(n,i){return n+e.getCoinRequirement(i[t.LICENSE_TYPE])},this.getCoinRequirement(n)):0},getCoinDiff:function(){var e=this.model.getGeneralCoinTotal()+this.model.getAddonCoinTotal();return this.getTotalCoinRequired()-e},getCalmCoinDiff:function(){return this.getTotalCalmCoinRequired()-this.getCoinsAppliedTowardCalm()},getReductionLicList:function(e,n,i){for(var s=_.pluck(n,"licenseId"),a=[],o=0;o<n.length&&!(i<=0);o++){var r=this.model.getLicenseCoinApplied(n[o]);i>=r&&a.push(n[o][t.LICENSE_ID]),i-=r}return _.difference(s,a)},getIncrementLicList:function(e,t,n){var i=this.getLicListToAdd(e.coin,n),s=_.pluck(t,"licenseId"),a=this.pluckIdByRef(i);return _.union(s,a)},getCoinSummary:function(){var e=[],n=this.model.getClusterCoinTotal(),s=this.model.getCategory();this.isPC&&s===i.LICENSE_TYPES.PRO&&(s=i.LICENSE_TYPES.PRISM_PRO);var a={category:s,coinUsed:this.model.getGeneralCoinTotal()};if(e.push(a),this.calmLic){var o={category:i.LICENSE_TYPES.CALM,coinUsed:this.model.getCalmCoinTotal()};e.push(o)}return{coinUsed:n,addons:_.map(this.addonLicenses,function(e){return{category:e[t.LICENSE_TYPE],coinUsed:e[t.LICENSE_COINS_APPLIED]}}),licenses:e}},getRenewMilli:function(){return l*i.MILLIS_PER_DAY+Date.now()},compare:function(e,t,i){return n.operatorCompare(t,e.getPriority(),i.getPriority())},isGeneralAction:function(e){return _.any(a,function(t){return t===e.id})},processAction:function(e){var t=e.pid||e.id,n=_.bind(this.getActionProcessor(t),this),i=this.clusterLicenses,s=this.getCoinDiff(),a=this.getCoinSummary(),o=n(e.data,i,s,a),r=[].concat(o.licIds);return a=o.coinSummary,{licIds:r,coinSummary:a,workflow:o.workflow||""}},getActionProcessor:function(e){var t=void 0;switch(e){case a.SELECT:t=this.processSelect;break;case a.UPGRADE:t=this.processUpgrade;break;case a.DOWNGRADE:t=this.processDowngrade;break;case a.RECLAIM:t=this.processReclaim;break;case o.RECLAIM_CALM:t=this.processReclaimCalm;break;case a.EXPAND:t=this.processExpand;break;case o.EXPAND_CALM:t=this.processExpandCalm;break;case a.RENEW:t=this.processRenew;break;case a.ADD:t=this.processAdd;break;case a.REMOVE:t=this.processRemove;break;default:t=this.processGeneric}return t},processGeneric:function(e,t,n,i){var s=this.getLicListToAdd(e.coin,n);return{licIds:this.pluckIdByRef(s),coinSummary:i}},processSelect:function(e,t,n,i){var s=this;return n=this.getCoinRequirement(e.category),_.each(i.licenses,function(t){s.model.isOfCategory(s.model.getCategory(),t)&&(t.category=e.category,t.coinUsed=n)}),i.coinUsed+=n,{licIds:this.getIncrementLicList(e,t,n),coinSummary:i}},processAdd:function(e,t,n,i){n=this.getCoinRequirement(e.category);var s={category:e.category,coinUsed:n};return i.addons.push(s),i.coinUsed+=n,{licIds:this.getIncrementLicList(e,t,n),coinSummary:i}},processRemove:function(e,t,n,i){n=this.model.getAddonCoinByType(e.category),i.coinUsed-=n;var s=_.find(i.addons,function(t){return t.category===e.category});return i.addons=_.without(i.addons,s),{licIds:this.getReductionLicList(e,t,n),coinSummary:i}},processReclaim:function(e,t,n,i){var s=this;return n=Math.abs(n),i.coinUsed-=n,_.each(i.licenses,function(t){s.model.isOfCategory(s.model.getCategory(),t)&&(t.coinUsed=s.getCoinRequirement(e.category))}),_.each(i.addons,function(e){e.coinUsed=s.getCoinRequirement(e.category)}),{licIds:this.getReductionLicList(e,t,n),coinSummary:i}},processReclaimCalm:function(e,t,n,s){var a=this,o=e.calmPacks*this.getCoinsRequiredPerCalmPack();return s.coinUsed-=o,_.each(s.licenses,function(e){a.model.isOfCategory(i.LICENSE_TYPES.CALM,e)&&(e.coinUsed-=o)}),{licIds:this.getReductionLicList(e,t,o),coinSummary:s}},processExpand:function(e,t,n,i){var s=this;return i.coinUsed+=n,_.each(i.licenses,function(t){s.model.isOfCategory(s.model.getCategory(),t)&&(t.coinUsed=s.getCoinRequirement(e.category))}),{licIds:this.getIncrementLicList(e,t,n),coinSummary:i}},processExpandCalm:function(e,t,n,s){var a=this,o=e.calmPacks*this.getCoinsRequiredPerCalmPack();return s.coinUsed+=o,_.each(s.licenses,function(e){a.model.isOfCategory(i.LICENSE_TYPES.CALM,e)&&(e.coinUsed+=o)}),{licIds:this.getIncrementLicList(e,t,o),coinSummary:s}},processUpgrade:function(e,t,n,s){var a=this;return n=this.getCoinRequirement(e.category)-this.model.getGeneralCoinTotal(),s.coinUsed+=n,e.category===i.LICENSE_TYPES.ULTIMATE&&(_.each(s.addons,function(e){s.coinUsed-=e.coinUsed}),s.addons=[].concat({category:i.ADDON_LICENSE_TYPES.SOFTWARE_ENCRYPTION,coinUsed:0})),_.each(s.licenses,function(t){a.model.isOfCategory(a.model.getCategory(),t)&&(t.category=a.isPC?i.LICENSE_TYPES.PRISM_PRO:e.category,t.coinUsed+=n)}),{licIds:this.getIncrementLicList(e,t,n),coinSummary:s}},processDowngrade:function(e,t,n,i){var s=this;n=Math.abs(this.model.getGeneralCoinTotal()-this.getCoinRequirement(e.category)),i.coinUsed-=n,_.each(i.licenses,function(t){s.model.isOfCategory(s.model.getCategory(),t)&&(t.category=e.category,t.coinUsed-=n,s.isPC&&(t=[]))});var a={licIds:this.getReductionLicList(e,t,n),coinSummary:i};return this.isPC?_.extend(a,{workflow:"reclaim"}):a},processRenew:function(e,t,n,i){var s=this,a=this.getRenewMilli(),o=this.model.getExpiredAfterDate(a),r=_.difference(t,o);return n=this.totalCoinRequired-this.model.getClusterCoinTotal(),n+=this.model.getTotal(o),i.coinUsed=this.totalCoinRequired,_.each(i.licenses,function(t){s.model.isOfCategory(s.model.getCategory(),t)&&(t.coinUsed=s.getCoinRequirement(e.category))}),_.each(i.addons,function(e){e.coinUsed=s.getCoinRequirement(e.category)}),{licIds:n>0?this.getIncrementLicList(e,r,n):this.getReductionLicList(e,r,Math.abs(n)),coinSummary:i}}}),s}),define("managers/AttributeLicenseActionManager",["managers/LicenseActionManager","data/DataProperties","utils/AppUtil","utils/AppConstants"],function(e,t,n,i){"use strict";function s(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.call(this,t)}var a={SELECT_GENERAL:"select",SELECT_ADDON:"select_addon",SELECT:"select",MANAGE_GENERAL:"manage",MANAGE_ADDON:"manage_addon",UPGRADE:"upgrade",DOWNGRADE:"downgrade",RECLAIM:"reclaim",EXPAND:"expand",RENEW:"renew",ADD:"add",REMOVE:"remove"},o=[a.SELECT_GENERAL,a.SELECT_ADDON,a.SELECT,a.MANAGE_GENERAL,a.MANAGE_ADDON,a.RENEW,a.UPGRADE,a.DOWNGRADE,a.ADD,a.REMOVE,a.EXPAND,a.RECLAIM],r=i.LICENSE_EXPIRY_THRESHOLD,l=[i.LICENSE_ATTRIBUTE_TYPE.CORES,i.LICENSE_ATTRIBUTE_TYPE.FLASH];return s.prototype=Object.create(e.prototype),_.extend(s.prototype,{name:"AttributeLicenseActionManager",ACTIONS:a,calculate:function(){var e=this;this.actions=[],this.updateLicense=[],this.setAttributeLicenses(this.collection),this.curCap=this.model.getCapacity(),this.licensedCap=this.model.getLicensedCapacity(),this.capacityDiff=this.model.getCapacityDiff(),this.isPC||(this.addonLicenses=this.model.getAddonLicenseList()),this.clusterLicenses=this.model.getAllLicenses(),this.licenses.each(this.getAttributeLicenseInspector(this.model)),this.model.hasOverlicensedCapacity(!0)&&_.each(this.clusterLicenses,function(t){var n={actionId:a.RECLAIM,childActionId:null,license:t,isAddon:!1,actionType:"general",isBanner:!0};e.addAttributeReduceAction(n)}),this.model.hasAddons()&&_.each(this.addonLicenses,function(t){var n={actionId:a.MANAGE_ADDON,childActionId:a.REMOVE,license:t,isAddon:!0,actionType:"addon",isBanner:!1};e.addAttributeReduceAction(n)}),this.prune(),this.sort()},prune:function(e){e=e||this.actions;for(var t=e.length;t--;){var n=e[t],i=void 0;_.isEmpty(n.children)||this.prune(n.children),i=!!n.data.isGroupedAction||!this.hasMinAttributeLicenses(n),(i&&_.isEmpty(n.children)&&!n.data.isGroupedAction||n.data.isGroupedAction&&_.isEmpty(n.children))&&e.splice(t,1)}},setAttributeLicenses:function(e){var t=this,n=e.filter(function(e){return e.isAttributeLicense()&&!(t.isProduct(e,i.LICENSE_CLASSES.FILE)||t.isProduct(e,i.LICENSE_CLASSES.BUCKET)||t.isProduct(e,i.LICENSE_CLASSES.VDI_CORE)||t.isProduct(e,i.LICENSE_CLASSES.ROBO))});this.licenses.reset(n)},getAttributeLicenseInspector:function(e){var t=this;if(!e)throw new Error("Missing required params: model");var n=this.getClusterLicenseType(),i=e.getAddonListGroupByType(),s=e.isExpired(),o=e.getExpiredAddons();return function(r,l){var c=r.getType(),d=r.getCategory(),p=r.isAvailable(),u={};if(e.hasGeneralLicense())if(r.isAddon()){if(!t.isPC&&r.isPairingAllowed(n.getCategory())){var h=(i[d]||[]).length;t.model.hasAddons()?(p&&(0===h?(u={actionId:a.MANAGE_ADDON,childActionId:a.ADD,license:r,type:c,isAddon:!0,isBanner:!1,idx:l},t.addLicenseToGroupedAction(u)):e.hasUnlicensedCapacity()>0&&(u={actionId:a.EXPAND,license:r,type:c,isBanner:!0,idx:l},t.addLicenseToAction(u))),o[d]&&(u={actionId:a.MANAGE_ADDON,childActionId:a.RENEW,license:r,type:c,isAddon:!0,isBanner:!1,idx:l},t.addLicenseToGroupedAction(u))):p&&(u={actionId:a.SELECT_ADDON,childActionId:a.ADD,license:r,type:c,isAddon:!0,isBanner:!1,idx:l},t.addLicenseToGroupedAction(u))}}else t.compare(c,">",n)?(u={actionId:a.MANAGE_GENERAL,childActionId:a.UPGRADE,license:r,type:c,isAddon:!1,isBanner:!1,idx:l},t.addLicenseToGroupedAction(u)):t.compare(c,"<",n)?(u={actionId:a.MANAGE_GENERAL,childActionId:a.DOWNGRADE,license:r,type:c,isAddon:!1,isBanner:!1,idx:l},t.addLicenseToGroupedAction(u)):t.compare(c,"=",n)&&(p&&e.hasUnlicensedCapacity()>0&&(u={actionId:a.EXPAND,license:r,type:c,isBanner:!0,idx:l},t.addLicenseToAction(u)),s&&(u={actionId:a.MANAGE_GENERAL,childActionId:a.RENEW,license:r,type:c,isAddon:!1,isBanner:!1,idx:l},t.addLicenseToGroupedAction(u),t.canBeUpdated(e,r)&&t.updateLicense.push(r.getLicenseId())));else!r.isAddon()&&p&&(u={actionId:a.SELECT_GENERAL,childActionId:a.SELECT,license:r,type:c,isAddon:!1,isBanner:!1,idx:l},t.addLicenseToGroupedAction(u))}},addLicenseToAction:function(e){var t=e.actionId,i=e.license,s=e.type,a=e.isBanner,o=e.idx;if(!t)throw new Error("Missing required param: actionId");var r=this.getActionById(t),l=s.getCategory()||"";if(r||(r=this.createAction(t,null,{rank:this.getActionRankById(t),licenses:[],category:a?"":l,name:a?"":n.toTitleCase(l),attribute:[],isBanner:a||!1}),this.actions.push(r)),i){var c={};c.attribute=i.getAttributeType(),c.quantity=i.getQuantityAvailable(),c.category=l;var d=i.getLicenseId();this.model.getLicenseIds().indexOf(d)>=0?(r.data.attribute.unshift(c),r.data.licenses.unshift(o)):(r.data.attribute.push(c),r.data.licenses.push(o))}},addLicenseToGroupedAction:function(e){var t=e.actionId,i=e.childActionId,s=e.license,a=e.type,o=e.isAddon,r=e.isBanner,l=this.getActionType(s),c=e.idx;if(!t||!s)throw new Error("Missing required params: actionId, license");var d=a,p=d.getCategory(),u=this.createChildId(i||t,p),h=this.getActionById(t),m=this.getActionById(u);h||(h=this.createAction(t,null,{rank:this.getActionRankById(t),isGroupedAction:!0,isAddon:o,actionType:l,isBanner:r||!1}),this.actions.push(h)),m||(m=this.createAction(u,i||t,{name:n.toTitleCase(p),category:p,rank:this.getActionRankById(i),isAddon:o,licenses:[],attribute:[],actionType:l,isBanner:r||!1}),h.children.push(m));var f={};f.attribute=s.getAttributeType(),f.quantity=s.getQuantityAvailable(),f.category=p;var v=s.getLicenseId();this.model.getLicenseIds().indexOf(v)>=0?(m.data.attribute.unshift(f),m.data.licenses.unshift(c)):(m.data.attribute.push(f),m.data.licenses.push(c))},addAttributeReduceAction:function(e){var i=e.actionId,s=e.childActionId,a=e.license,o=e.isAddon,r=e.actionType,l=e.isBanner,c=this.createChildId(s,a.category||""),d=this.getActionById(i),p=this.getActionById(c),u={};u.attribute=a[t.LICENSE_ATTRIBUTE],u.quantity=a[t.LICENSE_QUANTITY_APPLIED],u.category=a[t.LICENSE_TYPE],s?(d||(d=this.createAction(i,null,{rank:this.getActionRankById(i),isGroupedAction:!0,isAddon:o,actionType:r,isBanner:l||!1}),this.actions.push(d)),p||(p=this.createAction(c,s,{name:n.toTitleCase(a.category),rank:this.getActionRankById(s),category:a.category,isAddon:o,licenses:[],attribute:[],actionType:r,isBanner:l||!1}),d.children.push(p)),a&&(p.data.licenses.push(a),p.data.attribute.push(u))):(d||(d=this.createAction(i,null,{rank:this.getActionRankById(i),licenses:[],category:this.model.getCategory(),name:"",attribute:[],actionType:r,isBanner:l||!1}),this.actions.push(d)),a&&d.data.attribute.push(u))},getActionRankById:function(e){return o.indexOf(e)},hasMinAttributeLicenses:function(e){var t=this,n=e.pid||e.id,i=this.getAvailableCapacity(e.data),s=this.getNeededCapacity(n,e.data.category),o=_.every(i,function(e){return t.model.hasEnoughCapacity(s,e)<=0});return n===a.EXPAND?i.length===this.getCategoryCount()&&o:o},getNeededCapacity:function(e,t){var n=this,i={};if(e===a.REMOVE||e===a.RECLAIM)return i;switch(e){case a.EXPAND:for(var s in this.curCap)if(Object.prototype.hasOwnProperty.call(this.licensedCap,s)&&_.contains(l,s)){var o=this.curCap[s]-this.licensedCap[s];i[s]=o&&o.toFixed(2)>0?o.toFixed(2):0}break;case a.RENEW:i=this.getExpiredLicensedCapacity(t),this.updateLicense.length&&_.each(this.updateLicense,function(e){var t=n.getCapacityLicensedById(e);Object.prototype.hasOwnProperty.call(i,t.attribute)&&(i[t.attribute]=(i[t.attribute]-t.quantity).toFixed(2))});break;default:_.each(this.curCap,function(e,t){l.indexOf(t)>=0&&(i[t]=e)})}return i},getExtraCapacity:function(e,t){var n={};for(var s in e)if(Object.prototype.hasOwnProperty.call(t,s)&&_.contains(i.LICENSE_CAPACITY_TYPE,s)){var a=t[s]-e[s];n[s]=a>0?a:0}return n},getCategoryCount:function(){if(this.model.hasGeneralLicense()){var e=_.keys(this.model.getAddonListGroupByType());return e.indexOf(i.ADDON_LICENSE_TYPES.SOFTWARE_ENCRYPTION)>=0?e.length:e.length+1}return 0},getAvailableCapacity:function(e){var n=_.groupBy(e.attribute,t.LICENSE_TYPE),s=[];return _.each(n,function(e){var t={};_.each(e,function(e){var n=i.LICENSE_ATTRIBUTE_TYPE[e.attribute];Object.prototype.hasOwnProperty.call(t,n)?t[n]+=e.quantity:t[n]=e.quantity}),s.push(t)}),s},isProduct:function(e,n){return!(!e||!n)&&(!!e[t.LICENSE_PORTAL_TYPE]&&e[t.LICENSE_PORTAL_TYPE][t.LICENSE_PORTAL_TYPE].toLowerCase()===n.toLowerCase())},getRenewMilli:function(){return r*i.MILLIS_PER_DAY+Date.now()},compare:function(e,t,i){return n.operatorCompare(t,e.getPriority(),i.getPriority())},hasUnlicensedCapacity:function(){return _.any(this.capacityDiff,function(e){return e<0})},getCapacityLicensedById:function(e){var n=this.model.getLicenseById(e);if(!n)return{};var s={},a=i.LICENSE_ATTRIBUTE_TYPE[n[t.LICENSE_ATTRIBUTE]];return s.attribute=a,s.quantity=n[t.LICENSE_QUANTITY_APPLIED],s},getLicensesGroupByType:function(){return _.groupBy(this.clusterLicenses,function(e){return e[t.LICENSE_TYPE]})},getExpiredLicenseByCategory:function(e){return e?this.model.getExpiredAfterDate(Date.now(),this.getLicensesGroupByType()[e]):[]},getExpiredLicensedCapacity:function(e){var n={},s=this.getExpiredLicenseByCategory(e);return _.each(s,function(e){var s=e[t.LICENSE_ATTRIBUTE],a=i.LICENSE_ATTRIBUTE_TYPE[s];Object.prototype.hasOwnProperty.call(n,a)?n[a]+=e[t.LICENSE_QUANTITY_APPLIED]:n[a]=e[t.LICENSE_QUANTITY_APPLIED]}),n},processAction:function(e){var t=e.pid||e.id,n=_.bind(this.getActionProcessor(t),this),i=this.clusterLicenses;return{licIds:[].concat(n(e.data,i).licIds)}},getActionProcessor:function(e){var t=void 0;switch(e){case a.RECLAIM:t=this.processReclaim;break;case a.EXPAND:t=this.processExpand;break;case a.RENEW:t=this.processRenew;break;case a.ADD:t=this.processAdd;break;case a.REMOVE:t=this.processRemove;break;default:t=this.processGeneric}return t},processSingleType:function(e){var t=this.getNeededCapacity(),n=this.processNeededLicenses(e,t,!0);return this.pluckIdByRef(n)},processGeneric:function(e){return{licIds:this.processSingleType(e)}},processAdd:function(e,t){var n=_.pluck(t,"licenseId");return{licIds:this.processSingleType(e).concat(n)}},processRemove:function(e,t){var n=_.difference(t,e.licenses);return{licIds:_.pluck(n,"licenseId")}},processReclaim:function(e,n){var s=this,a=_.groupBy(e.attribute,function(e){return e[t.LICENSE_TYPE]}),o={};_.each(_.keys(a),function(e){o[e]=_.extend({},s.curCap)});var r=[];return _.each(n,function(e){var t=i.LICENSE_ATTRIBUTE_TYPE[e.attribute],n=e.category;o[n][t]>0&&(o[n][t]-=e.quantity,r.push(e))}),{licIds:_.pluck(r,"licenseId")}},processExpand:function(e,n){var i=_.pluck(n,"licenseId");this.model.hasOverlicensedCapacity(!0)&&(i=this.processReclaim(e,n).licIds);var s=this.getNeededCapacity(a.EXPAND),o=_.groupBy(e.attribute,function(e){return e[t.LICENSE_TYPE]}),r={};_.each(_.keys(o),function(e){r[e]=_.extend({},s)});var l=this.processNeededLicenses(e,r,!1),c=this.pluckIdByRef(l);return i=_.union(i,c),{licIds:i}},processRenew:function(e,t){var n=_.extend({},this.getNeededCapacity(a.RENEW,e.category)),i=this.processNeededLicenses(e,n,!0),s=this.pluckIdByRef(i),o=this.getExpiredLicenseByCategory(e.category),r=_.difference(t,o),l=_.pluck(r,"licenseId");return l=l.concat(this.updateLicense),s=_.union(s,l),{licIds:s}},processUpdate:function(e,t){return{licIds:_.pluck(t,"licenseId")}}}),s}),define("views/popups/licensing/LicenseSummaryView",["views/basecomponents/BaseSubView","views/popups/licensing/LicenseActionsView","models/license/LicenseModel","models/portal/PortalLicenseModel","models/portal/PortalLicenseCollection","models/portal/PortalLicenseTypeCollection","models/portal/PortalCoinModel","managers/ServiceManager","managers/LicenseManager","managers/LicenseActionManager","managers/CoinLicenseActionManager","managers/AttributeLicenseActionManager","data/DataProperties","utils/CommonTemplates","utils/SubViewHelper","utils/AppConstants","utils/AppUtil","utils/TimeUtil","utils/SVG"],function(e,t,n,i,s,a,o,r,l,c,d,p,u,h,m,f,v,g,E){"use strict"
;var T=_.template('<div class="license-view license-summary-ctr"></div><div class="license-view license-action-ctr"></div>'),C=_.template('<div class="license-detail-actions"><% if (hasFeatViolations) { %><a class="feat-violations">Show Violations</a>&emsp;<% } %><% if (showLicenses) { %><a class="detailedView license-list"><%= i18n("showLicenses") %></a><% } %></div><div class="separator"></div><div class="license-actions"></div>'),S=_.template('<div class="license-summary-item <%= type %>-summary"><div class="license-title"><%= licTitle %></div><% _.each(licStates, function(state) { %><div class="license-state <%= state.licState %>"><div class="license-icon license-<%= state.type %>-icon <%= state.iconClickDisabled ? "click-disabled" : ""%>"><%= licIcon %><div class="license-level" data-category="<%= state.category %>"><%= state.categoryName %></div></div><div class="license-state-message license-expiry-msg"><%= state.licMsg %></div><% if (state.noOneClick) { %> <div><div><%= i18ns("productNotSupported", licTitle) %></div><div><a class="productManual" data-title="<%= licTitle%>"><%= i18n("licenseManually") %></a></div></div><% } %></div><% }) %><div class="license-action-ctr"></div></div>'),A=_.template(".<%= licenseClass %>-summary .license-actions");return e.extend({name:"LicenseSummaryView",parentView:null,actionView:null,clusterLicenseModel:null,proxyConfigModel:null,csfModel:null,clusterCollection:null,licTypeCollection:null,collection:null,calmConsumptionModel:null,svg:null,coinLic:!1,calmLic:!1,ablLic:!1,nodeLic:!0,coinModel:null,licActionManager:null,initialize:function(t){e.prototype.initialize.call(this,arguments),t=t||{},this.parentView=t.parentView,this.clusterLicenseModel=t.clusterLicenseModel,this.clusterNodeSummary=t.clusterNodeSummary,t.calmLic&&(this.calmConsumptionModel=t.calmConsumptionModel),this.proxyConfigModel=t.proxyConfigModel,this.csfModel=t.csfModel,this.clusterCollection=this.clusterManager.getClusterCollection(),this.licTypeCollection=new a,this.collection=new s,this.coinModel=new o,this.coinLic=t.coinLic,this.ablLic=t.ablLic,this.nodeLic=t.nodeLic,this.calmLic=t.calmLic,this.mixedLic=t.mixedLic,this.flowEnabled=!!this.clusterManager.isMulticlusterUI()&&r.isServiceEnabled(r.SERVICES.MICROSEG),this.initializeActionLicenseManager(),this.svg={},_.bindAll(this,"getFetchOptions","getCoinBasedFetchOptions","getAttributeBasedFetchOptions","getModelBasedFetchOptions","getCalmFetchOptions","onFetchError")},initializeSubviews:function(){var e={collection:this.collection,parentView:this.parentView,clusterLicenseModel:this.clusterLicenseModel,clusterNodeSummary:this.clusterNodeSummary,licTypeCollection:this.licTypeCollection,proxyConfigModel:this.proxyConfigModel,csfModel:this.csfModel,coinLic:this.coinLic,ablLic:this.ablLic,nodeLic:this.nodeLic,mixedLic:this.mixedLic,calmLic:this.calmLic,calmConsumptionModel:this.calmLic?this.calmConsumptionModel:null,coinModel:this.coinModel,licActionManager:this.licActionManager};this.subViewHelper=new m,this.generalActionView=new t(e);var n=new t(e);if(this.subViewHelper.register("generalActionView",this.generalActionView),this.subViewHelper.register("addonActionView",n),this.calmLic){var i=_.defaults({},e);_.extend(i,{actionViewType:f.LICENSE_CLASSES.CALM});var s=new t(i);this.subViewHelper.register("calmActionView",s)}if(this.clusterManager.isMulticlusterUI()){var a=_.defaults({},e,{flowEnabled:this.flowEnabled,actionViewType:f.LICENSE_CLASSES.FLOW});this.subViewHelper.register("flowActionView",new t(a))}},destroy:function(){this.$(".tooltipKnowMore").tooltip("destroy"),this.subViewHelper.destroy(),e.prototype.destroy.apply(this,arguments)},initializeActionLicenseManager:function(e){var t=this.mixedLic||this.clusterLicenseModel.hasProduct(f.LICENSE_CLASSES.FILE)||this.clusterLicenseModel.hasProduct(f.LICENSE_CLASSES.BUCKET),n={collection:this.collection,clusterNodeSummary:this.clusterNodeSummary,licTypeCollection:this.licTypeCollection,clusterLicenseModel:this.clusterLicenseModel};if(this.calmLic&&(n=_.extend(n,{calmConsumptionModel:this.calmConsumptionModel})),!this.mixedLic&&!t)if(this.coinLic||e===f.LICENSE_CLUSTER_TYPE.COINS){this.resetLicenseMode(),this.coinLic=!0;var i=_.extend(n,{nodeLic:this.nodeLic,coinLic:this.coinLic,ablLic:this.ablLic,calmLic:this.calmLic,portalCoinModel:this.coinModel});this.licActionManager=new d(i)}else if(this.ablLic||e===f.LICENSE_CLUSTER_TYPE.ATTRIBUTE)this.resetLicenseMode(),this.ablLic=!0,this.licActionManager=new p(_.extend(n,{nodeLic:this.nodeLic,coinLic:this.coinLic,ablLic:this.ablLic}));else{this.resetLicenseMode(),this.nodeLic=!0;var s=_.extend(n,{nodeLic:this.nodeLic,coinLic:this.coinLic,ablLic:this.ablLic,calmLic:this.calmLic,flowEnabled:this.flowEnabled});this.licActionManager=new c(s)}this.initializeSubviews(),this.parentView.licActionManager=this.licActionManager},render:function(){return this.$el.html(T()),this.$summaryCtr=this.$(".license-summary-ctr"),this.allDepsFetched()?this.renderLayout():this.renderLoading(),this.el},renderHeaderMsg:function(){var e=this.clusterLicenseModel.getCategory();if(this.coinLic){var t=this.clusterLicenseModel.getGeneralCoinTotal()+this.clusterLicenseModel.getAddonCoinTotal(),n=this.getTotalCoinRequired(),i=n-t;this.parentView.renderHeaderMessages(e,i,this.generalActionView)}else this.parentView.renderHeaderMessages(e,0,this.generalActionView)},renderLoading:function(e){this.$summaryCtr.html(h.LOADING_MSG({msg:this.i18n("data_fetching")}))},addTooltip:function(e,t,n){this.$("."+e).tooltip({title:t,placement:n,trigger:"hover",html:!0,animation:!1})},renderLayout:function(){if(this.clusterLicenseModel.getState()===f.STATE_ERROR)return void this.$summaryCtr.html("");this.clusterManager.isMulticlusterUI()?this.renderPCLayout():this.renderPELayout()},renderPELayout:function(){var e="",t=!1,n=!1;this.clusterManager.isMulticlusterUI()||(t=t||this.clusterLicenseModel.isVDIEnabled(),n=n||this.clusterLicenseModel.isRoboEnabled()),this.proxyConfigModel.isEnabled(this.mixedLic||this.clusterLicenseModel.hasProduct(f.LICENSE_CLASSES.FILE)||this.clusterLicenseModel.hasProduct(f.LICENSE_CLASSES.BUCKET)||t||n)?(e+=this.createGeneralSummary(!0),e+=this.createGeneralSummary(!1,f.LICENSE_CLASSES.FILE),e+=this.createGeneralSummary(!1,f.LICENSE_CLASSES.BUCKET),this.clusterLicenseModel.hasGeneralLicense()&&(e+=this.createAddonSummary(!0)),this.$summaryCtr.html(e),this.renderSubActionViews()):(e+=this.createGeneralSummary(!1),e+=this.createGeneralSummary(!1,f.LICENSE_CLASSES.FILE),e+=this.createGeneralSummary(!1,f.LICENSE_CLASSES.BUCKET),e+=this.createAddonSummary(),this.$summaryCtr.html(e),this.createCommonActionContainer(e))},renderPCLayout:function(){var e="",t=void 0,n=this.proxyConfigModel.isActive();if(this.nodeLic)e+=this.createGeneralSummary(n,"prism_central"),e+=this.createGeneralSummary(n,f.LICENSE_CLASSES.FLOW),this.calmLic&&(e+=this.createGeneralSummary(n,f.LICENSE_CLASSES.CALM)),e+=this.createGeneralSummary(n,f.LICENSE_CLASSES.BUCKET),this.$summaryCtr.html(e),n?this.renderSubActionViews():this.createCommonActionContainer(e);else if(e+=this.createGeneralSummary(n),this.calmLic&&(e+=this.createGeneralSummary(n,f.LICENSE_CLASSES.CALM)),this.$summaryCtr.html(e),n){if(t=".general-summary .license-actions",this.renderActionView("generalActionView",t),this.calmLic){var i=A({licenseClass:f.LICENSE_CLASSES.CALM});this.renderActionView("calmActionView",i)}}else this.createCommonActionContainer(e)},createCommonActionContainer:function(e){this.$("> .license-action-ctr").html(this.createActionContainer({hasFeatViolations:l.hasFeatureViolations()||l.hasAddonFeatureViolations()}));this.renderActionView("generalActionView","> .license-action-ctr > .license-actions")},renderActionView:function(e,t){this.subViewHelper.get(e).setElement(this.$(t)).render()},renderSubActionViews:function(){if(this.clusterManager.isMulticlusterUI()&&!this.coinLic){var e=A({licenseClass:f.LICENSE_CLASSES.FLOW});if(this.renderActionView("generalActionView",".general-summary .license-actions"),this.renderActionView("flowActionView",e),this.calmLic){var t=A({licenseClass:f.LICENSE_CLASSES.CALM});this.renderActionView("calmActionView",t)}}else{if(this.clusterManager.isMulticlusterUI()&&this.calmLic){var n=A({licenseClass:f.LICENSE_CLASSES.CALM});this.renderActionView("calmActionView",n)}this.renderActionView("generalActionView",".general-summary .license-actions"),this.renderActionView("addonActionView",".addon-summary .license-actions"),this.clusterLicenseModel.hasGeneralLicense()?this.enableButton(".addon-summary .license-actions .btn"):this.disableButton(".addon-summary .license-actions .btn"),this.parentView.hideButtons()}},fetchData:function(){var e=this,t=[this.fetchIcons()];if(this.proxyConfigModel.isEnabled(this.mixedLic||this.clusterLicenseModel.hasProduct(f.LICENSE_CLASSES.FILE)||this.clusterLicenseModel.hasProduct(f.LICENSE_CLASSES.BUCKET)||this.clusterLicenseModel.isVDIEnabled()||this.clusterLicenseModel.isRoboEnabled())){var n=this.clusterLicenseModel.getLicenseIds();t.push(this.licTypeCollection.fetch());var a=void 0,o=this.clusterLicenseModel.isModelBased()?this.getModelBasedFetchOptions():this.getFetchOptions(),r=this.getCoinBasedFetchOptions(),c=this.getAttributeBasedFetchOptions();if(this.coinLic&&(a=r),this.ablLic&&(a=c),this.nodeLic&&(a=o,this.clusterManager.isMulticlusterUI()&&a.push(this.getFlowFetchOptions()),this.calmLic&&a.push(this.getCalmFetchOptions())),this.clusterLicenseModel.hasGeneralLicense()&&!l.isStarterViolation())return n.length&&(this.coinLic||a.push(_.defaults({},{isAvailable:!1,populate:i.DP.LICENSE_TYPE,number:n.join(",")}))),t.push(this.fetchDataChunks(a,s,this.collection)),this.coinLic&&t.push(this.coinModel.fetch({data:this.createPricerFetchParams()})),void $.when.apply(this,t).then(function(){e.licActionManager.calculate(),e.render(),e.renderHeaderMsg(),e.addTooltip("tooltipKnowMore",e.i18n("bucketKnowledgeTip"),"bottom")}).fail(function(){e.onFetchError(),e.renderLayout(),e.renderHeaderMsg(),e.addTooltip("tooltipKnowMore",e.i18n("bucketKnowledgeTip"),"bottom")})}$.when.apply(this,t).then(function(){e.render(),e.addTooltip("tooltipKnowMore",e.i18n("bucketKnowledgeTip"),"bottom")}).fail(function(){return e.onFetchError()})},fetchDataChunks:function(e,t,n){var i=_.map(e,function(e){return(new t).fetch({data:e})});return n.trigger("pending"),$.when.apply(this,i).then(this.getChunkAssembler(n))},fetchIcons:function(){var e=[];return this.svg[E.LICENSE_ICON]||e.push(this.fetchSVG(E.LICENSE_ICON)),this.svg[E.LICENSE_ADDON_ICON]||e.push(this.fetchSVG(E.LICENSE_ADDON_ICON)),$.when.apply(this,e)},fetchSVG:function(e){var t=this,n=jQuery.Deferred();return E.loadSVG(e,{success:function(i){t.svg[e]=i,n.resolve()},error:function(){n.resolve()}}),n},createActionContainer:function(e){var t=(l.hasFeatureViolations(),_.defaults({},e,{hasFeatViolations:l.hasFeatureViolations(),showLicenses:!0}));return C(this.vtOptions(t))},createGeneralSummary:function(e,t){var n=S(this.getGeneralTemplateOpts(t));if(e){var i;i=t===f.LICENSE_TYPES.CALM||t===f.LICENSE_CLASSES.FILES||t===f.LICENSE_CLASSES.BUCKET?{hasFeatViolations:!1}:t===f.LICENSE_CLASSES.FLOW?{hasFeatViolations:this.clusterLicenseModel.isFlowLicensesExpired()}:this.clusterLicenseModel.hasGeneralLicense()?{hasFeatViolations:l.hasFeatureViolations()}:{hasFeatViolations:!1,showLicenses:!1},n=this.insertActionContainer(n,i)}return n},getCalmTemplateOpts:function(){var e=this.coinLic?this.clusterLicenseModel.getLicenseList():this.clusterLicenseModel.getCalmLicenses(),t=void 0,n=f.LICENSE_STATUS.OK,i=this.i18n("calm"),s=this.clusterLicenseModel.getLicenseCalmMessage(),a=this.coinLic?this.licActionManager.getCoinsAppliedTowardCalm():0,o=this.clusterLicenseModel.getCoinExpired(),r=this.coinLic?o>0:this.clusterLicenseModel.isCalmLicensesExpired(),l=this.clusterLicenseModel.getExpiryUsecs(e);return this.coinLic?r?(t=this.getCoinExpiryText(o,l).toUpperCase(),n=f.LICENSE_STATUS.ERROR):(a>0?t=this.getCoinExpiryText(a,l).toUpperCase():(t=this.i18n("calmExpiryMsgNoExpiry"),i=v.toTitleCase(f.LICENSE_TYPES.NO_LICENSE),n=f.LICENSE_STATUS.NONE),n=r||s?f.LICENSE_STATUS.ERROR:n):(l?t=this.getExpiryText(l).toUpperCase():(t=this.i18n("calmExpiryMsgNoExpiry"),i=v.toTitleCase(f.LICENSE_TYPES.NO_LICENSE),n=f.LICENSE_STATUS.NONE),n=r||s?f.LICENSE_STATUS.ERROR:n),this.vtOptions({canModify:!1,licIcon:this.svg[E.LICENSE_ICON]||"",licTitle:f.LICENSE_TITLES.CALM,licStates:[{category:f.LICENSE_CLASSES.CALM,type:f.LICENSE_ICON_TYPES.GENERAL,categoryName:i,licState:n,licMsg:t,iconClickDisabled:!0}],type:f.LICENSE_CLASSES.CALM})},getStandAloneProductTemplateOpts:function(e){if(e.toLowerCase()===f.LICENSE_CLASSES.BUCKET.toLowerCase()&&this.clusterManager.isMulticlusterUI())return this.getBucketsSpecifiedPCTemplates();var t=v.toTitleCase(f.LICENSE_TYPES.NO_LICENSE),n=f.LICENSE_STATUS.NONE,i="",s=this.proxyConfigModel.isActive(),a=f.LICENSE_TITLES[e],o=f.LICENSE_CLASSES[e],r=f.LICENSE_ICON_TYPES.GENERAL,l=this.coinLic?this.clusterLicenseModel.getLicenseList():this.clusterLicenseModel.getLicensesByProduct(e),c=this.coinLic?this.clusterLicenseModel.getCoinsLicensedByProduct(e):0,d=this.clusterLicenseModel.getCoinExpired(),p=_.indexOf(this.clusterLicenseModel.getExpiredLicenseTypes(),e)>-1,u=this.clusterLicenseModel.getExpiryUsecs(l);return this.coinLic?p?(i=this.getCoinExpiryText(d,u),n=f.LICENSE_STATUS.ERROR):(i=this.getCoinExpiryText(c,u),n=f.LICENSE_STATUS.OK):this.clusterLicenseModel.hasProduct(e)?(i=this.getExpiryText(u),n=p?f.LICENSE_STATUS.ERROR:f.LICENSE_STATUS.OK):n=f.LICENSE_STATUS.NONE,this.clusterLicenseModel.hasProduct(f.LICENSE_CLASSES[e])&&(t=this.clusterLicenseModel.getLicenseTypeOfProduct(f.LICENSE_CLASSES[e])),this.vtOptions({canModify:!1,licIcon:this.svg[E.LICENSE_ICON]||"",licTitle:a,licStates:[{category:o,type:r,categoryName:t,licState:n,noOneClick:s,licMsg:i.toUpperCase(),iconClickDisabled:!0}],type:r})},getBucketsSpecifiedPCTemplates:function(){var e=v.toTitleCase(f.LICENSE_TYPES.NO_LICENSE),t=f.LICENSE_STATUS.NONE,n=_.template('<div><%= i18n("bucketPCMsg") %> <a class="tooltipKnowMore" data-test="licensesummaryview_a_knowmore"><%= i18n("knowMoreLink") %></a></div>'),i=n(this.vtOptions()),s=f.LICENSE_TITLES.BUCKET,a=f.LICENSE_CLASSES.BUCKET,o=f.LICENSE_ICON_TYPES.GENERAL;return this.parentView.hasBucketLicenses()&&(e=f.BUCKET_PC_CATEGORY_NAME,t=f.LICENSE_STATUS.OK),this.vtOptions({canModify:!1,licIcon:this.svg[E.LICENSE_ICON]||"",licTitle:s,licStates:[{category:a,type:o,categoryName:e,licState:t,noOneClick:!1,licMsg:i,iconClickDisabled:!0}],type:f.LICENSE_CLASSES.BUCKET})},getFlowTemplateOpts:function(){var e="",t=f.LICENSE_STATUS.OK,n=this.i18n("flowNotEnabled"),i=f.LICENSE_TITLES.FLOW,s=this.clusterLicenseModel.getLicensesByProduct(f.LICENSE_CLASSES.FLOW);if(this.clusterLicenseModel.hasProduct(f.LICENSE_CLASSES.FLOW)){e=this.clusterLicenseModel.getPrimaryCategory(f.LICENSE_CLASSES.FLOW);var a=this.clusterLicenseModel.getExpiryUsecs(s);n=this.getExpiryText(a),t=this.clusterLicenseModel.isFlowLicensesExpired()?f.LICENSE_STATUS.ERROR:f.LICENSE_STATUS.OK}else if(this.flowEnabled){var o=r.getServiceModel(r.SERVICES.MICROSEG),l=o.getServiceEnablementUTC(),c=l+f.MICROSEG_SERVICE_TRIAL_PERIOD*f.MILLIS_PER_DAY;e=this.i18n("flowTrial"),n=this.i18ns("flowTrialExpiryMsg",this.getExpiryDate(c*f.MICROS_PER_MILLI)),o.isMicrosegTrialPeriodFinished()&&(t=f.LICENSE_STATUS.ERROR,n=this.i18ns("flowTrialExpiredMsg",this.getExpiryDate(c*f.MICROS_PER_MILLI)))}else e=v.toTitleCase(f.LICENSE_TYPES.NO_LICENSE),t=f.LICENSE_STATUS.NONE;return this.vtOptions({canModify:!1,licIcon:this.svg[E.LICENSE_ICON]||"",licTitle:i,licStates:[{category:f.LICENSE_CLASSES.FLOW,type:f.LICENSE_ICON_TYPES.GENERAL,categoryName:e,licState:t,licMsg:n.toUpperCase(),noOneClick:!1,iconClickDisabled:!0}],type:f.LICENSE_CLASSES.FLOW})},createAddonSummary:function(e){var t,n,i=this.clusterLicenseModel.hasAddons(),s="",a={};return this.clusterManager.isMulticlusterUI()?i&&(a=this.clusterLicenseModel.getAddonListGroupByType(),t=_.first(_.keys(a)),n={hasFeatViolations:l.hasFeatureViolations(t),showLicenses:!1},s+=S(this.getAddonTemplateOpts(a)),e&&(s=this.insertActionContainer(s,n))):(i&&(a=this.coinLic?this.clusterLicenseModel.getAddonLicenseList():this.clusterLicenseModel.getAddonListGroupByType()),n={hasFeatViolations:!1,showLicenses:i},s+=S(this.coinLic?this.getCoinAddonTemplateOpts(a):this.getAddonTemplateOpts(a)),e&&(s=this.insertActionContainer(s,n))),s},createFetchParams:function(e){return _.defaults({},e,{isAvailable:!0,coinLicense:!1,attributeLicense:!1,populate:i.DP.LICENSE_TYPE,licenseClass:this.clusterLicenseModel.getLicenseClass(),sort:i.DP.LICENSE_EXPIRY+" DESC",limit:4e3})},createPricerFetchParams:function(){var e=this.clusterLicenseModel.getCapacity(),t={};return this.clusterManager.isMulticlusterUI()?(t={node:e[u.LICENSE_CAPACITY_NODE]},this.calmLic&&_.extend(t,{VM:1})):t={flash:e[u.LICENSE_CAPACITY_FLASH],hdd:e[u.LICENSE_CAPACITY_HDD],cores:e[u.LICENSE_CAPACITY_CORES]},{capacity:JSON.stringify(t)}},insertActionContainer:function(e,t){t=t||{};var n=$(e);return n.find(".license-action-ctr").html(this.createActionContainer(t)),n.prop("outerHTML")},allDepsFetched:function(){var e=[this.clusterLicenseModel.getState(),this.proxyConfigModel.getState()];return this.proxyConfigModel.isEnabled(this.mixedLic||this.clusterLicenseModel.hasProduct(f.LICENSE_CLASSES.FILE)||this.clusterLicenseModel.hasProduct(f.LICENSE_CLASSES.BUCKET)||this.clusterLicenseModel.isVDIEnabled()||this.clusterLicenseModel.isRoboEnabled())&&(e.push(this.licTypeCollection.getState()),e.push(this.collection.getState())),_.all(e,function(e){return!(e===f.STATE_INIT||e===f.STATE_PENDING)})},getChunkAssembler:function(e){return function(){var t=[].slice.call(arguments);t=_.isArray(t[0])?t:[t],_.each(t,function(t){e.add(t[0].models,{silent:!0})}),e.trigger("reset")}},getFetchOptions:function(e){return[this.createFetchParams(e)]},getModelBasedFetchOptions:function(e){var t=_.groupBy(this.clusterLicenseModel.getNodes(),n.DP.NODE_MODEL_NAME);return _.map(t,function(t,n){return this.createFetchParams(_.defaults({},e,{modelNumber:n,limit:4e3}))},this)},getSWLicensesFetchOptions:function(){var e=_.defaults({},{isAvailable:!0,populate:i.DP.LICENSE_TYPE,sort:i.DP.LICENSE_EXPIRY+" ASC",licenseClass:this.clusterManager.isMulticlusterUI()?f.LICENSE_CLASSES.PRISM_CENTRAL:f.LICENSE_CLASSES.SOFTWARE_ONLY,limit:4e3});return this.getFetchOptions(e)},getCoinBasedFetchOptions:function(){return this.getFetchOptions({coinLicense:!0,licenseClass:f.LICENSE_CLASSES.SOFTWARE_ONLY,sort:i.DP.LICENSE_EXPIRY+" ASC"})},getCalmFetchOptions:function(e){return e=_.extend(e||{},{licenseClass:f.LICENSE_CLASSES.CALM}),this.createFetchParams(e)},getFlowFetchOptions:function(e){return e=_.extend(e||{},{licenseClass:f.LICENSE_CLASSES.FLOW}),this.createFetchParams(e)},getAttributeBasedFetchOptions:function(){return this.getFetchOptions({attributeLicense:!0,licenseClass:f.LICENSE_CLASSES.SOFTWARE_ONLY,sort:i.DP.LICENSE_EXPIRY+" ASC"})},getAllLicensesFetchOptions:function(){var e=[];return this.clusterLicenseModel.getLicenseClass()===f.LICENSE_CLASSES.APPLIANCE?e=e.concat(this.getModelBasedFetchOptions()):l.isThirdPartyCluster()?e=e.concat(this.getSWLicensesFetchOptions()):!this.clusterManager.isMulticlusterUI()&&this.isFFEnabled(f.FFLAGS.CAPACITY_LICENSING)&&(e=e.concat(this.getAttributeBasedFetchOptions())),(this.clusterManager.isMulticlusterUI()||this.clusterLicenseModel.getLicenseClass()===f.LICENSE_CLASSES.SOFTWARE_ONLY)&&(e=e.concat(this.getCoinBasedFetchOptions())),e},resetLicenseMode:function(){this.nodeLic=!1,this.coinLic=!1,this.ablLic=!1,this.mixedLic=!1},getTitle:function(e){return e?this.i18n("addon_title"):this.clusterManager.isMulticlusterUI()?f.LICENSE_TITLES.PRISM:this.clusterLicenseModel.getDisplayableLicenseClass()},getIsExpired:function(e){return!_.isNumber(e)||0===e||e/1e3<Date.now()},getExpiryDate:function(e){if(!_.isNumber(e)||0===e)return this.i18n("expiryMsgNoExpiry");var t=e/1e3;return g.formatLongDate(t)},getExpiryText:function(e){if(!_.isNumber(e)||0===e)return this.i18n("expiryMsgNoExpiry");var t=this.getIsExpired(e)?this.i18n("expiryMsgExpired"):this.i18n("expiryMsgValid");return v.sprintf(t,this.getExpiryDate(e))},getCoinExpiryText:function(e,t){var n=this.getExpiryDate(t);return this.getIsExpired(t)?v.sprintf(this.i18n("coinExpiredMsg"),e,n):v.sprintf(this.i18n("coinExpiryMsg"),e,n)},getGeneralTemplateOpts:function(e){if(e===f.LICENSE_CLASSES.FLOW)return this.getFlowTemplateOpts();if(e===f.LICENSE_CLASSES.FILE)return this.getStandAloneProductTemplateOpts(f.LICENSE_CLASSES.FILE.toUpperCase());if(e===f.LICENSE_CLASSES.BUCKET)return this.getStandAloneProductTemplateOpts(f.LICENSE_CLASSES.BUCKET.toUpperCase());if(e===f.LICENSE_CLASSES.CALM)return this.getCalmTemplateOpts();var t=void 0,n=void 0,i=this.clusterLicenseModel.getLicenseList();_.difference(i,this.clusterLicenseModel.getLicensesByProduct(f.LICENSE_CLASSES.FILE),this.clusterLicenseModel.getLicensesByProduct(f.LICENSE_CLASSES.BUCKET));var s=this.coinLic?this.clusterLicenseModel.getGeneralCoinTotal():0,a=this.clusterLicenseModel.getCoinExpired(),o=f.LICENSE_ICON_TYPES.GENERAL,r=this.clusterLicenseModel.getCategory(),c=l.hasFeatureViolations(),d=this.coinLic?a>0:this.clusterLicenseModel.isGeneralLicensesExpired(),p=c||d||l.isStarterViolation(r),u=this.coinLic?this.clusterLicenseModel.getExpiryUsecs(i):this.clusterLicenseModel.getExpiryUsecs(i,r);this.coinLic?d?(t=this.getCoinExpiryText(a,u),n=f.LICENSE_STATUS.ERROR):(t=this.getCoinExpiryText(s,u),n=p?f.LICENSE_STATUS.ERROR:f.LICENSE_STATUS.OK):(t=this.getExpiryText(u),n=p?f.LICENSE_STATUS.ERROR:f.LICENSE_STATUS.OK),r===f.LICENSE_TYPES.NO_LICENSE&&(t="",n=f.LICENSE_STATUS.NONE);var h=c?this.i18n("errorFeatViolation"):t;return this.vtOptions({canModify:this.parentView.canModify(),licTitle:this.getTitle(),licIcon:this.svg[E.LICENSE_ICON]||"",licStates:[{licState:n,licMsg:h.toUpperCase(),categoryName:v.toTitleCase(r),category:r,type:o}],type:o})},getAddonTemplateOpts:function(e){var t=this,n=f.LICENSE_ICON_TYPES.ADDON,i=this.clusterLicenseModel.hasAddons()?_.map(e,function(e,i){var s=void 0,a=void 0,o=void 0,r=void 0,c=void 0,d=void 0;return c=t.clusterLicenseModel.getExpiryUsecs(e),s=l.hasFeatureViolations(i),a=s||t.clusterLicenseModel.isExpired(e),d=t.getExpiryText(c),o=s?t.i18n("errorFeatViolation"):d,r=a?f.LICENSE_STATUS.ERROR:f.LICENSE_STATUS.OK,{categoryName:"<p>"+v.toTitleCase(i).split(" ").join("</p><p>")+"</p>",category:i,licMsg:o.toUpperCase(),licState:r,type:n}}):[];if(!this.clusterLicenseModel.hasAddons()){var s=f.LICENSE_ADDON_NAMES.NO_ADDON;i.push({categoryName:"<p>"+v.toTitleCase(s).split(" ").join("</p><p>")+"</p>",licMsg:"",licState:"none",category:s,type:n})}return this.vtOptions({canModify:this.parentView.canModify(),licTitle:this.getTitle(!0),licIcon:this.svg[E.LICENSE_ADDON_ICON]||"",licStates:i,type:n})},getCoinAddonTemplateOpts:function(e){var t=this,n=f.LICENSE_ICON_TYPES.ADDON,i=[];return this.clusterLicenseModel.hasAddons()?(i=_.map(e,function(e){var i=void 0,s=void 0,a=void 0,o=void 0,r=void 0,c=void 0,d=void 0,p=void 0,h=e[u.LICENSE_TYPE],m=e[u.LICENSE_COINS_APPLIED];return r=t.clusterLicenseModel.getExpiryUsecs(t.clusterLicenseModel.getCoinLicenseList()),d=t.clusterLicenseModel.getCoinExpired(),p=d>0,i=l.hasFeatureViolations(h),s=i||p,c=p?t.getCoinExpiryText(d,r):t.getCoinExpiryText(m,r),o=i?t.i18n("errorFeatViolation"):c,a=s?f.LICENSE_STATUS.ERROR:f.LICENSE_STATUS.OK,h=f.LICENSE_ADDON_NAMES[h.toUpperCase()]||f.LICENSE_ADDON_NAMES.NO_ADDON,{categoryName:"<p>"+v.toTitleCase(h).split(" ").join("</p><p>")+"</p>",category:h,licMsg:o.toUpperCase(),licState:a,type:n}}),this.vtOptions({canModify:this.parentView.canModify(),licTitle:this.getTitle(!0),licIcon:this.svg[E.LICENSE_ADDON_ICON]||"",licStates:i,type:n})):this.vtOptions({canModify:this.parentView.canModify(),licTitle:this.getTitle(!0),licIcon:this.svg[E.LICENSE_ADDON_ICON]||"",licStates:[{categoryName:"<p>"+v.toTitleCase(f.ADDON_LICENSE_TYPES.NO_ADDON).split(" ").join("</p><p>")+"</p>",category:"NO ADDON",licMsg:"",licState:f.LICENSE_STATUS.NONE,type:f.LICENSE_ICON_TYPES.ADDON}],type:n})},getTotalCoinRequired:function(){var e=this,t=this.clusterLicenseModel.getPrimaryCategory(f.LICENSE_CLASSES.SOFTWARE_ONLY),n=this.clusterLicenseModel.getLicenseClass(),i=this.clusterManager.isMulticlusterUI()?n+"_"+t:t,s=this.coinModel.getCoinByType(t,i);return _.reduce(this.clusterLicenseModel.getAddonLicenseList(),function(n,i){return n+e.coinModel.getCoinByType(t,i[u.LICENSE_TYPE])},s)},disableButton:function(e){this.$("."+e).attr("disabled","disabled")},enableButton:function(e){this.$("."+e).removeAttr("disabled")},getActionsSubViews:function(){if(!this.clusterManager.isMulticlusterUI())return[this.subViewHelper.get("generalActionView"),this.subViewHelper.get("addonActionView")];var e=[this.subViewHelper.get("generalActionView")];return this.clusterManager.isMulticlusterUI()&&e.push(this.subViewHelper.get("flowActionView")),this.calmLic&&e.push(this.subViewHelper.get("calmActionView")),e},delegateSubviewEvents:function(){var e=this,t=this.getActionsSubViews();_.each(t,function(t){t.on(t.EVENTS.ACTION_START,e.onActionStart,e),t.on(t.EVENTS.ACTION_COMPLETE,e.onActionComplete,e),t.on(t.EVENTS.ACTION_PROGRESS,e.onActionProgress,e),t.on(t.EVENTS.ACTION_ERROR,e.onActionError,e)})},undelegateSubviewEvents:function(){var e=this,t=this.getActionsSubViews();_.each(t,function(t){t.off(t.EVENTS.ACTION_START,e.onActionStart,e),t.off(t.EVENTS.ACTION_COMPLETE,e.onActionComplete,e),t.off(t.EVENTS.ACTION_PROGRESS,e.onActionProgress,e),t.off(t.EVENTS.ACTION_ERROR,e.onActionError,e)})},onStartServices:function(){this.delegateEvents(),this.delegateModelEvents(),this.delegateSubviewEvents(),this.subViewHelper.iterate("startServices")},onStopServices:function(){this.undelegateEvents(),this.undelegateModelEvents(),this.undelegateSubviewEvents(),this.subViewHelper.iterate("stopServices")},onFetchError:function(){this.showHeaderError(this.i18n("license_fetch_fail_msg")),this.render()},onActionStart:function(e){this.parentView.onActionStart(e)},onActionProgress:function(e){this.parentView.onActionProgress(e)},onActionComplete:function(e){this.parentView.onActionComplete(e)},onActionError:function(e){this.parentView.onActionError(e)}})}),define("text!templates/popups/user/PortalConfigView.html",[],function(){return'<h5 data-ntnx-title class="connHeader"><%= i18n(\'header\') %></h5>\n\n<% if (isConfigured) { %>\n  <section data-ntnx-section="type-text">\n    <div class="status-ctr">\n      <div class="status-msg status-indicator <%= status %>">\n        <%= statusMsg %>\n      </div>\n      <div class="status-actions pull-right">\n        <% _.each(statusActions, function(name, id) { %>\n          <a class="action action-<%= id %>"><%= name %></a>\n        <% }) %>\n      </div>\n    </div>\n  </section>\n<% } %>\n\n<form role="form" autocomplete="off"\n      class="portal-config-form <%= formState %>">\n\n  <section data-ntnx-section>\n    <label data-ntnx-label for="apiKeyInput"><%= i18n(\'api_key\') %></label>\n    <input id="apiKeyInput" type="text" class="form-control inputApiKey"\n      model-attribute="<%= DP.API_KEY %>">\n  </section>\n\n  <section data-ntnx-section>\n    <label data-ntnx-label for="publicKeyInput">\n      <%= i18n(\'public_key\') %>\n      <span data-ntnx-label-flag><%= i18n(\'optional\') %></span>\n    </label>\n    <%= certFileInput %>\n  </section>\n\n  <section data-ntnx-section="type-text">\n    <%= formInfo %>\n  </section>\n\n</form>\n'}),define("views/popups/user/PortalConfigView",["views/basecomponents/popups/BasePopupSubView","models/portal/PortalProxyConfigModel","components/Components","data/DataURLConstants","utils/AppConstants","utils/CommonTemplates","text!templates/popups/user/PortalConfigView.html"],function(e,t,n,i,s,a,o){"use strict";var r=t.DP,l=32*s.UNITS_PER_K;return e.extend({name:"PortalConfigView",template:_.template(o),model:null,isShowingAdvanced:!1,events:{"click .action":"onClickAction","click .action-update":"onClickUpdate","click .action-disable":"onClickDisable","click .connHeader":"onClickHeaderText","change #portal-cert-file":"onFileSelect"},modelEvents:{"request model":"onRequest","change  model":"onDataChange","error   model":"onError"},initialize:function(n){if(n=n||{},!n.parentView)throw new Error("Missing required param: parentView");this.parentView=n.parentView,this.model=new t,e.prototype.initialize.apply(this,arguments)},render:function(){var e=this.model.isConfigured(),t=this.template(this.vtOptions({DP:r,model:this.model.toJSON(),formInfo:this.getFormDescription(),formState:e?"hide":"",isConfigured:e,status:(this.model.get(r.STATUS)||"").toLowerCase(),statusMsg:this.model.getStatusMsg(),statusActions:this.model.getStatusActions(),certFileInput:n.fileInput({id:"portal-cert-file",attr:r.DEST_PUB_CERT})}));return this.$el.html(t),this.triggerAction(s.MODAL.ACT.AS_REFRESH),this},parseFormValues:function(){var e={};return this.$('input[type="text"]').each(function(t,n){var i=n.value.trim();i&&(e[n.getAttribute("model-attribute")]=i)}),e},saveForm:function(){var e=this.parseFormValues();if(!_.isEmpty(e))return this.model.set(e,{silent:!0}),this.model.save()},getFormDescription:function(){return this.i18ns("api_key_info",a.NEW_TAB_LINK({destUrl:i.SUPPORT_PORTAL_API_KEY,content:this.i18n("api_keys")}))},onStartServices:function(){this.delegateEvents(),this.delegateModelEvents(),this.model.fetch(),e.prototype.onStartServices.apply(this,arguments)},onStopServices:function(){this.undelegateEvents(),this.undelegateModelEvents(),e.prototype.onStartServices.apply(this,arguments)},onRequest:function(){this.triggerAction(s.MODAL.ACT.ALERT_SHOW,{type:s.MODAL.ALERT.TYPE_LOADING})},onDataChange:function(){this.triggerAction(s.MODAL.ACT.ALERT_HIDE),this.render()},onFileSelect:function(e){var t=this,n=e.target.files[0],i=e.target.getAttribute("model-attribute"),a=new FileReader;if(this.clearBaseHeader(),n){if(n.size>l)return void this.triggerAction(s.MODAL.ACT.ALERT_SHOW,{type:s.MODAL.ALERT.TYPE_ERROR,message:this.i18n("error_bad_file")});a.onload=function(e){t.model.set(i,e.target.result,{silent:!0})},a.readAsText(n)}else this.model.unset(i,{silent:!0})},onDestroy:function(e,t){e.clear({silent:!0}),e.set(t,{silent:!0}),this.render()},onError:function(e,t){this.triggerAction(s.MODAL.ACT.ALERT_SHOW,{type:s.MODAL.ALERT.TYPE_ERROR,message:t.responseText}),this.render()},onClickHeaderText:function(e){if(e.shiftKey&&!this.isShowingAdvanced){var t=_.template('<section data-ntnx-section><label data-ntnx-label for="destHostInput">Dest host</label><input id="destHostInput" type="text"class="inputDestHost"model-attribute="<%= DP.DEST_HOST %>"></section><section data-ntnx-section><label data-ntnx-label for="destPortInput">Dest port</label><input id="destPortInput" type="text"class="inputDestPort"model-attribute="<%= DP.DEST_PORT %>"></section>');this.isShowingAdvanced=!0,this.$(".portal-config-form").append(t({DP:r}))}},onClickAction:function(e){this.triggerAction(s.MODAL.ACT.ALERT_HIDE)},onClickUpdate:function(e){this.$(".status-actions").addClass("hide"),this.$(".portal-config-form").removeClass("hide")},onClickDisable:function(e){$.nutanixConfirm({context:this,msg:this.i18n("confirm_delete"),yesText:this.i18n("yes"),yes:function(){this.model.destroy({success:_.bind(this.onDestroy,this)})}})}})}),define("text!templates/popups/portal/PortalProxyConfigPopupView.html",[],function(){
return'<div class="modal-header">\n  <button type="button" class="close" data-dismiss="modal">\n    <i data-icon="K" aria-hidden="true"></i>\n  </button>\n  <h4 class="n-title"><%= i18n("proxy_title") %></h4>\n  <div class="help-icon"><i aria-hidden="true" data-icon="O"></i></div>\n</div>\n\n<div class="n-modal-wrapper">\n  <div class="n-modal-body">\n    <div class="n-modal-alert-header not-empty">\n      \x3c!-- alert goes here --\x3e\n    </div>\n    <div class="n-modal-content-wrapper">\n      <div class="n-modal-content">\n        <p class="description">\n          <%= i18n("proxy_description") %> <strong><%= username %></strong>.\n        <div class="portal-config-ctr">\n          \x3c!-- @view: Portal configuration view rendered here --\x3e\n        </div>\n      </div>\n    </div>\n  </div>\n  <div class="n-modal-footer">\n    <button class="btnCancel btn"><%= i18n("cancel") %></button>\n    <button class="btnSave btn -blue" title="Click to Save">\n      <%= i18n("save") %>\n    </button>\n  </div>\n</div>\n'}),define("views/popups/portal/PortalProxyConfigPopupView",["views/basecomponents/popups/BasePopupView","views/popups/user/PortalConfigView","managers/NamespaceManager","utils/AjaxUtil","text!templates/popups/portal/PortalProxyConfigPopupView.html"],function(e,t,n,i,s){"use strict";var a=_.template(s);return e.extend({el:"#popupPortalProxyConfig",name:"PortalProxyConfigPopupView",overlayPopup:!0,events:{"click .modal-header > .close":"hide","click .btnCancel":"hide","click .btnSave":"onClickSave"},initialize:function(e){if(e.onSave&&!_.isFunction(e.onSave))throw new Error("onSave callback must be a function");this.onSave=e.onSave||function(){},this.portalCfgView=new t({parentView:this})},render:function(){this.$el.html(a(this.vtOptions({username:this.getUsername()}))),this.portalCfgView.setElement(this.$(".portal-config-ctr")).render()},show:function(){this.portalCfgView.startServices(),e.prototype.show.apply(this,arguments)},hide:function(){this.portalCfgView.stopServices(),_.isFunction(this.onHide)&&this.onHide(),e.prototype.hide.apply(this,arguments)},destroy:function(){this.portalCfgView.destroy(),e.prototype.destroy.apply(this,arguments)},getUsername:function(){return((n.get(n.USER_DETAILS)||{}).profile||{}).username||this.i18n("uname_default")},onClickSave:function(){var e=this;this.portalCfgView.saveForm().then(function(){e.onSave(),e.hide()}).fail(function(t){e.showHeaderError(i.processAjaxError(t.responseText))})}})}),define("text!templates/popups/licensing/ClusterInfoTableView.html",[],function(){return'<table class="cluster-details general-info">\n  <tbody>\n  <tr>\n    <td class="row-key">cluster uuid</td>\n    <td class="row-val"><%= clusterUUID %></td>\n  </tr>\n  <tr>\n    <td class="row-key">signature</td>\n    <td class="row-val license-sig">\n      <% _.each(csfModel.getSignatureFragments(), function(sig) { %>\n        <span><%= sig %></span>\n      <% }) %>\n    </td>\n  </tr>\n  <tr>\n    <td class="row-key">license class</td>\n    <td class="row-val"><%= licModel.getLicenseClass() %></td>\n  </tr>\n  <tr>\n    <td class="row-key">license version</td>\n    <td class="row-val"><%= csfModel.getVersion() %></td>\n  </tr>\n  <% if (!isPC) { %>\n  <tr>\n    <td colspan="2" class="row-key">\n      <div class="capacity-row">\n        <%= Components.groupInput({\n          label: i18n(\'CORES\'),\n          classes: \'capacity-input row-key\',\n          value: capacity["num_cores"],\n          attributes: \'name="num_cores" autocomplete="off" disabled\'\n        }) %>\n        <%= Components.groupInput({\n          label: i18n(\'FLASH\'),\n          classes: \'capacity-input row-key\',\n          unit: \'TiB\',\n          value: capacity["ssd_size_tebibytes"],\n          attributes: \'name="ssd_size_tebibytes" autocomplete="off" disabled\'\n        }) %>\n        <%= Components.groupInput({\n          label: i18n(\'HDD\'),\n          classes: \'capacity-input row-key\',\n          unit: \'TiB\',\n          value: capacity["hdd_size_tebibytes"],\n          attributes: \'name="hdd_size_tebibytes" autocomplete="off" disabled\'\n        }) %>\n      </div>\n    </td>\n  </tr>\n  <% } else { %>\n  <tr>\n    <td colspan="2" class="row-key">\n      <div class="capacity-row">\n        <%= Components.groupInput({\n          label: i18n(\'node\'),\n          classes: \'capacity-input row-key\',\n          value: capacity["num_nodes"],\n          attributes: \'name="num_nodes" autocomplete="off" disabled\'\n        }) %>\n        <%= Components.groupInput({\n          label: i18n(\'flow_num_protected_nodes\'),\n          classes: \'capacity-input row-key\',\n          value: capacity["flow_num_protected_nodes"],\n          attributes: \'name="flow_num_protected_nodes" autocomplete="off" disabled\'\n        }) %>\n        <%= Components.groupInput({\n          label: i18n(\'calm_num_required_packs\'),\n          classes: \'capacity-input row-key\',\n          value: capacity["calm_num_required_packs"],\n          attributes: \'name="calm_num_required_packs" autocomplete="off" disabled\'\n        }) %>\n      </div>\n    </td>\n  </tr>\n  <% } %>\n  </tbody>\n</table>\n<div class="cluster-details">\n  <div class="row-key">\n    <%= i18n("clusterInfoBlockDetails") %>\n  </div>\n</div>\n<table class="cluster-details block-details-table table table-condensed">\n  <thead>\n  <tr>\n    <th><%= i18n("clusterInfoModel") %></th>\n    <th><%= i18n("clusterInfoBlockId") %></th>\n    <th><%= i18n("lic_list_table_nodes") %></th>\n    <% if (!isPC) { %>\n      <th><%= i18n("CORES") %></th>\n      <th><%= i18n("FLASH") %></th>\n      <th><%= i18n("HDD") %></th>\n    <% } %>\n  </tr>\n  </thead>\n  <tbody>\n  <% var nodes = csfModel.getDisplayableNodeCounts() %>\n  <% _.each(nodes, function(node) { %>\n  <tr>\n    <td class="row-val"><%= node["model"] || \'-\' %></td>\n    <td class="row-val"><%= node["block_serial"] || \'-\' %></td>\n    <td class="row-val"><%= node["num_nodes"] %></td>\n    <% if (!isPC) { %>\n      <td class="row-val"><%= node.capacity["num_cores"] %></td>\n      <td class="row-val"><%= node.capacity["ssd_size_tebibytes"] %></td>\n      <td class="row-val"><%= node.capacity["hdd_size_tebibytes"] %></td>\n    <% } %>\n  </tr>\n  <% }) %>\n  </tbody>\n</table>\n'}),define("utils/LicensingMixin",["data/DataProperties","utils/AppUtil","utils/AppConstants","text!templates/popups/licensing/ClusterInfoTableView.html"],function(e,t,n,i){"use strict";var s=_.template('<table class="cluster-details"><tbody><tr><td class="msg-box"><%= msg %></td></tr></tbody></table>'),a=_.template(i);return{getLicenseModel:function(){return this.clusterLicenseModel||this.model},getClusterIdModel:function(){return this.clusterIdModel||this.csfModel},getLicenseActionManager:function(){return this.licActionManager||this.actionManager},confirmCSFgenerate:function(t,n){var i=this.getLicenseModel();n=n||this.i18n("csfGenerateConfirmText")+"<br /><br />"+this.i18n("continueText"),i.isOfCategory(e.LICENSE_STANDARD)||i.isInStandbyMode()||!i.hasGeneralLicense()?t():$.nutanixConfirm({yes:t,yesText:this.i18n("btnYes"),msg:n,class:"-compact"})},renderCSFloading:function(e){e=e||this.i18n("loading");var t='<span class="spinit donut-loader-blue"></span> '+e;this.$(".cluster-detail-ctr").html(s({msg:t}))},renderCSFerror:function(e){e=e||"An error occurred",this.$(".cluster-detail-ctr").html(s({msg:e}))},renderCSF:function(){this.$(".cluster-detail-ctr").html(a(this.vtOptions({clusterUUID:this.getClusterUuid(),licModel:this.getLicenseModel(),csfModel:this.getClusterIdModel(),capacity:this.getClusterIdModel().getCapacity(),isPC:this.clusterManager.isMulticlusterUI()})))},getClusterUuid:function(){var e=this.clusterManager.getClusterCollection(),t=null;return this.clusterManager.isMulticlusterUI()?t=this.clusterManager.getPrismCentralClusterUuid():e&&e.length&&(t=e.first().getClusterUuid()),t},_showManualWorkflow:function(){var e=this,i=this.$(".manualWorkflowLink");this.$(".cluster-detail-ctr").show(),i.hide(),this.renderCSFloading(),this.getClusterIdModel().fetch().then(function(){e.renderCSF(),e.triggerAction(n.MODAL.ACT.AS_REBUILD)}).fail(function(n,s){i.show(),e.renderCSFerror(e.i18n("error_csf_fetch")),t.log("Error: Failed fetch for CSF details\n"+s)})},fetchDataChunks:function(e,t,n){var i=_.map(e,function(e){return(new t).fetch({data:e})});return n.trigger("pending"),$.when.apply(this,i).then(this.getChunkAssembler(n))},getChunkAssembler:function(e){return function(){var t=[].slice.call(arguments);t=_.isArray(t[0])?t:[t],_.each(t,function(t){e.add(t[0].models,{silent:!0})}),e.trigger("reset")}},createFetchParams:function(t){return _.defaults({},t,{isAvailable:!0,coinLicense:!1,populate:e.LICENSE_PORTAL_TYPE,licenseClass:this.getLicenseModel().getLicenseClass(),sort:e.LICENSE_PORTAL_EXPIRY+" DESC",limit:4e3})},createPricerFetchParams:function(t){var n=this.getLicenseModel().getCapacity(),i={};return i=t?{node:n[e.LICENSE_CAPACITY_NODE]}:{flash:n[e.LICENSE_CAPACITY_FLASH],hdd:n[e.LICENSE_CAPACITY_HDD],cores:n[e.LICENSE_CAPACITY_CORES]},{capacity:JSON.stringify(i)}},getFetchOptions:function(e){return[this.createFetchParams(e)]},getCoinBasedFetchOptions:function(){return this.getFetchOptions({coinLicense:!0,licenseClass:n.LICENSE_CLASSES.SOFTWARE_ONLY})},getModelBasedFetchOptions:function(t){var n=this,i=_.groupBy(this.getLicenseModel().getNodes(),e.LICENSE_MODEL_TYPE);return _.map(i,function(e,i){return n.createFetchParams(_.defaults({},t,{modelNumber:i,limit:4e3}))},this)}}}),define("text!templates/popups/licensing/LicensingPopupView.html",[],function(){return'<header class="modal-header">\n  <h4 class="n-title"><%= i18n("popup_title") %></h4>\n  \x3c!-- Help icon automatically inserted here if help is available --\x3e\n  <button type="button" class="close" data-dismiss="modal">\n    <i data-icon="K" aria-hidden="true"></i>\n  </button>\n  <div class="header-btn-group">\n    <button class="btn btnConfigureProxy">\n      <%= i18n("btn_enable_portal") %>\n    </button>\n  </div>\n</header>\n\n<div class="n-modal-wrapper">\n  <div class="n-modal-body">\n    <div class="n-modal-alert-header"></div>\n    <div class="n-modal-content-wrapper">\n      <div class="n-modal-content listContainer license-summary-wrapper">\n        \x3c!-- @view: LicenseSummaryView rendered here --\x3e\n      </div>\n\n      \x3c!-- Licensing sub-view containers --\x3e\n      <div class="n-modal-content clusterOptionsContainer" style="display:none">\n        <div id="clusterFileOptions">\n          \x3c!-- @view: options go here.. --\x3e\n        </div>\n      </div>\n      <div class="n-modal-content contact-sales-container" style="display:none">\n        <div id="contactSales">\n          \x3c!-- @view: options go here.. --\x3e\n        </div>\n      </div>\n      <div class="n-modal-content detailsContainer" style="display:none">\n        <div id="detailList">\n          \x3c!-- @view: Details list goes here.. --\x3e\n        </div>\n      </div>\n    </div>\n  </div>\n  <div class="n-modal-footer" style="display:none;">\n    <button type="button" class="btnBack btn -default pull-left">\n      <%= Components.icon(\'caret-left\') %> <%= i18n("back") %>\n    </button>\n  </div>\n</div>\n'}),define("text!templates/popups/licensing/ClusterFileOptionsView.html",[],function(){return'<div class="license-view license-proc-manual">\n  <div data-ntnx-title class="license-title">\n    <%= i18n("manual_lic_page_title") %>\n  </div>\n  <div class="license-op-step-ctr">\n    \x3c!-- TODO: remove this after 5.5.1 --\x3e\n    <% if (type) { %>\n    <div class="license-flow-intro">\n      <%= i18ns("license_no_oneclick_intro", type) %>\n    </div>\n    <% } %>\n\n    \x3c!-- TODO: remove this after 5.5.1 --\x3e\n    <div data-ntnx-section class="n-proc-steps license-proc-steps">\n      <div data-ntnx-section class="n-proc-step <%= (standbyMode) ? \'complete\' : \'\' %>">\n        <div class="proc-step-title"><%= i18n("manual_lic_s1_title") %></div>\n        <div class="proc-step-content">\n          <%= i18ns("manual_lic_s1_op1", generateLink) %><br>\n          <%= i18n("manual_lic_s1_op2") %>\n          <a class="manualWorkflowLink"><%= i18n("show_info") %></a>\n\n          <div class="cluster-detail-ctr hide">\n            \x3c!-- Cluster details rendered here if the user chooses to follow\n                 the manual workflow instead of the file based --\x3e\n          </div>\n        </div>\n      </div>\n      <div class="n-proc-step <%= (standbyMode) ? \'complete\' : \'\' %>">\n        <div class="proc-step-title"><%= i18n("manual_lic_s2_title") %></div>\n        <div class="proc-step-content">\n          <%= i18ns("manual_lic_s2", portalLink) %>\n        </div>\n      </div>\n      <div class="n-proc-step">\n        <div class="proc-step-title"><%= i18n("manual_lic_s3_title") %></div>\n        <div class="proc-step-content">\n          <%= i18ns("manual_lic_s3", uploadLink) %>\n          <div class="lsf-file-submit-ctr hide">\n            <div class="lsf-filename"></div>\n            <button class="btn -blue lsf-file-submit" disabled>\n              <%= i18n("manual_lic_submit_btn") %>\n            </button>\n          </div>\n\n          <form id="uploadLicenseKeyForm" class="form-horizontal"\n              target="upload_target" method="post" enctype="multipart/form-data"\n              style="position:absolute;display:none">\n            <div class="control-group">\n              <div class="controls" >\n                <input type="file" class="inputFileName" name="LicenseFile" />\n              </div>\n            </div>\n          </form>\n        </div>\n      </div>\n    </div>\n  </div>\n</div>\n'}),define("text!templates/popups/licensing/LicensingInProgressView.html",[],function(){return'<div class="license-view license-proc-manual license-in-progress">\n  <div class="license-title"><%= i18n("license_in_progress_title") %></div>\n  <div class="license-op-step-ctr">\n    <div class="n-proc-steps license-proc-steps">\n      <div class="n-proc-step">\n        <div class="proc-step-title"><%= i18n("license_in_progress_s1") %></div>\n        <div class="proc-step-content">\n          <%= i18n("license_has_gen_csf") %>\n        </div>\n      </div>\n      <div class="n-proc-step">\n        <div class="proc-step-title"><%= i18n("license_in_progress_s2") %></div>\n        <div class="proc-step-content">\n          <%= i18n("license_has_sent_csf") %>\n        </div>\n      </div>\n      <div class="n-proc-step">\n        <div class="proc-step-title"><%= i18n("license_in_progress_s3") %></div>\n        <div class="proc-step-content">\n          <%= i18n("license_has_set_lsf") %>\n        </div>\n      </div>\n    </div>\n  </div>\n</div>\n'}),define("text!templates/popups/licensing/ContactSalesFormView.html",[],function(){return'<div class="license-view license-detail-view contact-sales-view">\n  <div class="license-title"><%= i18n("cs_title") %></div>\n  <section class="detail-description">\n    <%= i18n("cs_desc") %>\n  </section>\n  <section class="user-inputs">\n    <form role="form">\n      <div class="form-group">\n        <label for="emailInput"><%= i18n("cs_email_label") %></label>\n        <input type="email" class="form-control" id="emailInput"\n          value="<%= emailId %>"\n          placeholder="<%= i18n(\'cs_email_placeholder\') %>">\n      </div>\n      <div class="form-group">\n        <label for="commentInput"><%= i18n("cs_comment_label") %></label>\n        <textarea class="form-control" rows="3" id="commentInput"\n          placeholder="<%= i18n(\'cs_comment_placeholder\') %>"></textarea>\n      </div>\n    </form>\n  </section>\n\n  <section class="cluster-details">\n    <div class="notice">\n      <%= i18n("cs_cluster_details_desc") %>\n      <a class="toggle-details"><%= i18n("show_details") %></a>\n    </div>\n    <div class="details-container" style="display: none;">\n      <%= email[DataProp.CONTENT_HTML] %>\n    </div>\n  </section>\n\n  <section class="view-action-ctr">\n    <button class="btn btn-primary btnSave"><%= i18n("btn_send") %></button>\n  </section>\n</div>\n'}),define("text!templates/popups/licensing/DetailedLicensingItemView.html",[],function(){return'<tr class="n-table-row">\n  <td>\n    <span>\n      <%= license.licenseId || "&mdash;" %>\n    </span>\n  </td>\n  <% if (!isPC) { %>\n    <td>\n      <span>\n        <%= license.model || \'-\' %>\n      </span>\n    </td>\n  <% } %>\n  <td>\n    <div>\n      <%= category %>\n    </div>\n  </td>\n  <td>\n    <div>\n      <%= license.used ? "Yes" : "No" %>\n    </div>\n  </td>\n  <td>\n    <div>\n      <%= formattedDate %>\n    </div>\n  </td>\n</tr>'}),define("text!templates/popups/licensing/FeatureViolationView.html",[],function(){return'<div class="license-view license-detail-view license-violation-details">\n  <div class="license-title"><%= i18n("fv_page_title") %></div>\n  <div class="license-table-description">\n    <%= i18n("fv_table_desc") %>\n  </div>\n  <table class="table featureViolationsTable">\n    <thead>\n      <tr>\n        <th><%= i18n("fv_table_header_feat") %></th>\n        <th><%= i18n("fv_table_header_affected") %></th>\n        <th><%= i18n("fv_table_header_desc") %></th>\n      </tr>\n    </thead>\n    <tbody>\n      <% _.each(featViolations, function(violation) { %>\n        <tr>\n          <td class="feature-cell"><%= violation[DP.FV_FEAT_NAME] %></td>\n          <td><%= violation[DP.FV_AFFECTED] %></td>\n          <td><%= violation[DP.FV_DESC] %></td>\n        </tr>\n      <% }) %>\n    </tbody>\n  </table>\n</div>'}),define("text!templates/popups/licensing/FeatureListView.html",[],function(){return'<div class="license-view license-detail-view license-feature-details">\n  <div class="license-title">\n    <%= i18ns("feat_list_page_title", displayableLicenseClass) %>\n    <div class="license-level"><%= i18ns("feat_list_license_level", licenseName) %></div>\n  </div>\n\n  <% if (!isAddon) { %>\n\n    <div class="license-table-description">\n      <%= i18n("feat_list_table_desc") %>\n    </div>\n    <% if (showFeatureToggle) { %>\n      <div class="enable-input-wrapper">\n        <%= featureCheckbox %>\n        <label class="enable-label" for="lic-feature-enable">\n          <%= i18n("feat_list_enable_all") %>\n        </label>\n      </div>\n    <% } %>\n    <table class="table license-features">\n      <thead>\n        <tr>\n          <td class="feature-name">\n            <%= i18n("feat_list_table_header_name") %>\n          </td>\n          <td class="feature-state">\n            <%= i18n("feat_list_table_header_state") %>\n          </td>\n        </tr>\n      </thead>\n      <tbody>\n        <% _.each(allowanceGroup, function(allowances) { %>\n          <% _.each(allowances, function(item) { %>\n            <tr class="n-table-row">\n              <td><%= item.featureName %></td>\n              <td><%= item.details %></td>\n            </tr>\n          <% }) %>\n        <% }) %>\n      </tbody>\n    </table>\n\n  <% } else if (!_.isEmpty(addonAllowanceGroup)) { %>\n\n    <table class="table license-features">\n      <thead>\n        <tr>\n          <td class="feature-name">\n            <%= i18n("feat_list_table_header_name") %>\n          </td>\n          <td class="feature-state">\n            <%= i18n("feat_list_table_header_state") %>\n          </td>\n        </tr>\n      </thead>\n      <tbody>\n        <% _.each(addonAllowanceGroup, function(allowances) { %>\n          <% _.each(allowances, function(item) { %>\n            <tr class="n-table-row">\n              <td><%= item.featureName %></td>\n              <td><%= item.details %></td>\n            </tr>\n          <% }) %>\n        <% }) %>\n      </tbody>\n    </table>\n\n  <% } %>\n\n</div>'}),define("text!templates/popups/licensing/LicenseListView.html",[],function(){return'<div class="license-view license-detail-view license-details">\n  <div class="license-title"><%= i18n("lic_list_page_title") %></div>\n  <section id="licensingTablesContainer"></section>\n</div>\n'}),define("text!templates/popups/licensing/LicenseListSubView.html",[],function(){return'<div data-ntnx-content-inner\n     class="license-view license-detail-view license-details">\n    <section class="license-detail-header">\n        <div class="license-title"><%= i18n("lic_list_page_title") %></div>\n    </section>\n    <section id="licensingTablesContainer"></section>\n</div>\n'}),define("text!templates/popups/licensing/LicensingDetailsTableView.html",[],function(){return'<% if (title || description) { %>\n<section data-ntnx-section class="license-table-title">\n  <% if (title) { %>\n  <h5 data-ntnx-title>\n    <%= title %>\n  </h5>\n  <% } %>\n  <% if (description) { %>\n  <div data-ntnx-section="type-text" class="license-table-description">\n    <%= description %>\n  </div>\n  <% } %>\n</section>\n<% } %>\n<section data-ntnx-section class="license-table-container">\n  <table id="<%= id %>" class="table license-details">\n    <thead>\n      <tr>\n        <% _.each(columns, function(column) { %>\n        <th class="<%= column.multilevelHeader ? \'multilevel-header\' : \'\'%>">\n          <%= column.header %>\n        </th>\n        <% }); %>\n      </tr>\n    </thead>\n    <tbody>\n    <% if (!_.isEmpty(rows)) { %>\n    <% _.each(rows, function(row) { %>\n      <tr>\n      <% _.each(columns, function(column) { %>\n        <td>\n          <%= column.dataSrc(row) %>\n        </td>\n      <% }); %>\n      </tr>\n    <% }); %>\n    <% } else { %>\n      <tr>\n        <td colspan="<%= columns.length %>">\n          <%= i18ns(\'noLicenseDetails\') %>\n        </td>\n      </tr>\n    <% } %>\n    </tbody>\n  </table>\n</section>'}),define("text!templates/popups/licensing/LicensingDetailsSectionView.html",[],function(){return'<section data-ntnx-section\n         class="license-section-ctr <%= extraClass || \'\' %>">\n  <h5 data-ntnx-title class="text-center">\n    <%= secTitle %>\n  </h5>\n  <% if (secDescription) { %>\n    <div class="license-table-description text-center">\n      <%= secDescription %>\n    </div>\n  <% } %>\n  <section>\n    <%= licensingTables %>\n  </section>\n</section>'}),define("views/popups/licensing/LicensingPopupView",["views/basecomponents/popups/BasePopupView","models/BaseModel","models/EmailModel","models/license/LicenseModel","models/portal/PortalProxyConfigModel","models/hardware/HostCollection","models/capacityplanning/CPQueryModel","models/ebrowser/EBQueryModel","models/license/ClusterIdModel","models/fileserver/FileServerUsageModel","views/popups/licensing/LicenseSummaryView","views/popups/portal/PortalProxyConfigPopupView","managers/LicenseManager","data/DataManager","managers/NavigationManager","managers/NamespaceManager","managers/PopupManager","managers/ServiceManager","managers/ReleaseManager","utils/AppConstants","utils/AppUtil","utils/CommonTemplates","utils/TimeUtil","utils/StatsUtil","components/Components","utils/LicensingMixin","data/DataURLConstants","data/DataProperties","text!templates/popups/licensing/LicensingPopupView.html","text!templates/popups/licensing/ClusterFileOptionsView.html","text!templates/popups/licensing/LicensingInProgressView.html","text!templates/popups/licensing/ClusterInfoTableView.html","text!templates/popups/licensing/ContactSalesFormView.html","text!templates/popups/licensing/DetailedLicensingItemView.html","text!templates/popups/licensing/FeatureViolationView.html","text!templates/popups/licensing/FeatureListView.html","text!templates/popups/licensing/LicenseListView.html","text!templates/popups/licensing/LicenseListSubView.html","text!templates/popups/licensing/LicensingDetailsTableView.html","text!templates/popups/licensing/LicensingDetailsSectionView.html"],function(e,t,n,i,s,a,o,r,l,c,d,p,u,h,m,f,v,g,E,T,C,S,A,b,y,I,w,P,N,R,D,M,O,L,x,k,V,U,F,H){"use strict";var B=T.LICENSE_COIN_EXPIRY_THRESHOLD,G=_.template(N),Y=_.template(R),W=_.template(D),K=(_.template(M),_.template(O),_.template(k)),z=_.template(V),j=_.template(F),q=_.template(x),X=_.template(L),Q=_.template(U),J=_.template(H),Z=_.template('<span class="cfg-proxy-msg"><%= msg %></span>. <a class="cfg-proxy-action alert-link"><%= actionMsg %></a>'),ee=_.template('<%= i18n("error_cs_email_fail") %> <a href="<%= mailtoString %>" class="alert-link"><%= i18n("here_link") %></a>.'),te=_.template("Cluster Type   : <%= clusterType %>\n<% _.each(details, function(item) { %>Cluster UUID   : <%= item."+P.CLUSTER_UUID+" %>\nNode Count     : <%= item."+P.CLUSTER_NUM_NODES+" %>\nSerial Numbers : <%= item."+P.CLUSTER_BLOCK_SERIALS+" %>\n\n<% }) %>"),ne=_.template('<table style="border:none; margin:0; font-size: 12px;"><tr><td style="width: 100px;">Cluster Type:</td><td><%= clusterType %></td></tr><% _.each(details, function(item) { %><tr><td style="width: 100px;">Cluster UUID:</td><td><%= item.'+P.CLUSTER_UUID+' %></td></tr><tr><td style="width: 100px;">Node Count:</td><td><%= item.'+P.CLUSTER_NUM_NODES+' %></td></tr><tr><td style="width: 100px;">Serial Numbers:</td><td><%= item.'+P.CLUSTER_BLOCK_SERIALS+" %></td></tr><tr><td>&nbsp;</td></tr><% }) %></table>"),ie=_.template('<div class="license-view license-detail-view contact-sales-view"><div class="license-title"><%= i18n("cs_manual_title") %></div><div class="detail-description"><%= i18n("cs_manual_desc") %></div><div class="manual-fallback-info"><table class="table table-bordered"><tr><td>TO</td><td><%= to %></td></tr><tr><td>SUBJECT</td><td><%= subject %></td></tr><tr><td>BODY</td><td><%= body %></td></tr></table></div></div>'),se=_.template('<div class="alert alert-warning">    <h4><%= msg %></h4></div>'),ae=_.template('<span class="coinActionMsg"><%= msg %></span> <a class="coinAction alert-link <%= actionType %>Action"stream-action="licAction" stream-target="banner"><%= actionMsg %></a>'),oe=_.template('<div class="parent-header"><%= parent %></div><% _.each(children, function(child) { %><div class="child-header"><%= child %></div><% }); %>'),re=_.template('<% _.each(tableCells, function(cell) { %><div class="text-center"><%= cell %></div><% }); %>'),le=_.template('<a class="<%= classes %>"><%= content %></a>');return e.extend(_.extend({},I,{MODE_LICENSE_LIST:"licenseList",MODE_CONFIGURE_LICENSES:"generate",MODE_ACTION_IN_PROGRESS:"actionInProgress",MODE_FEATURE_LIST:"featureList",MODE_FEATURE_VIOLATIONS:"featureViolations",TOGGLE_FEATURE_CONFIRM_TEXT:"This operation requires you to log out and log back in to see the results. Do you want to continue?",el:"#popupLicensing",name:"LicensingPopupView",model:null,salesEmail:null,clusterIdModel:null,initialized:!1,overlayPopup:!0,calmConsumptionModel:null,fileServerUsageModel:null,bucketsUsageTiB:0,clusterNodeSummary:{},objectStoreModel:null,peLicenseSummary:{},peLicenseModels:[],events:{"click .productManual":"onClickProductManual","click  .btnClose":"hide","click  .modal-header .close:not(.disabled)":"hide",'click  [data-dismiss="alert"]':"clearHeader","click  .btnBack":"onClickBack","click  .btnConfigure, .coinManualAction":"onClickConfigure","click  .clusterInfoDownload":"onClickInfoDownload","click  .fileUpload":"onClickFileUpload","change .inputFileName":"onChangeInputFileName","click  a.cfg-proxy-action, .btnConfigureProxy":"onClickConfigureProxy","click .alert-info > .dismiss":"onClickDismissConfigMsg","click  a.detailedView":"onClickDetailedView","click  a.toggle-details":"onClickToggleDetails","click  a.fetch-try-again":"onRetry","click  .license-icon":"onClickLicenseLink","click  .btnUpload":"onClickFileUpload","click  a.feat-violations":"onClickFeatureViolations","click  .manualWorkflowLink":"onClickManualWorkflow","click  .standby-mode":"onClickLicenseStatusLink","click  .lsf-file-submit":"onUpload",'click [data-mode="contactSales"] .btnSave':"onClickSendMessage","click #lic-feature-enable":"onClickToggleFeatures","click  .oneClickAction":"onClickBannerAction"},initialize:function(t){e.prototype.initialize.call(this,arguments),this.completeLicensing=!!t.actionRoute&&t.actionRoute.options.completeLicensing,this.model=u.getLicenseModel(),this.proxyConfigModel=new s,this.clusterIdModel=new l,this.hostCollection=new a,this.pcNodeCollection=new r,this.objectStoreModel=this.createObjectStoreQueryModel(),this.fileServerUsageModel=new c,this.pcNodeCollection.set({entity_type:T.ENTITY_NODE,group_member_attributes:[{attribute:P.HOST_MODEL_NAME}],query_name:"prism:BaseGroupModel"}),this.objectStoreModel.set({entity_type:T.ENTITY_OBJECT_STORE,group_member_count:500,group_member_attributes:[{attribute:P.OBJECT_STORE.USAGE_BYTES,operation:P.AGGREGATORS.AVERAGE},{attribute:P.OBJECT_STORE.CLUSTER_REFERENCE}]}),this.setLicenseMode(),this.calmLic&&(this.calmConsumptionModel=new o({entity_type:T.ENTITY_NUCALM_CONSUMPTION,group_member_attributes:["required_packs","unique_active_vms"]})),this.resetPELicenseSummary(),this.coinDiff=0,this.actionView=null;var n={parentView:this,clusterLicenseModel:this.model,clusterNodeSummary:this.clusterNodeSummary,proxyConfigModel:this.proxyConfigModel,csfModel:this.clusterIdModel,coinLic:this.coinLic,ablLic:this.ablLic,nodeLic:this.nodeLic,calmLic:this.calmLic,mixedLic:this.mixedLic};this.calmLic&&_.extend(n,{calmConsumptionModel:this.calmConsumptionModel}),this.summaryView=new d(n),_.bindAll(this,"onUpload","listLicensing","onSubviewTransitionComplete","_handleMessageSubmit","_handleManualMessageSubmit"),e.prototype.initialize.apply(this,arguments)},createObjectStoreQueryModel:function(){return new(r.extend({getDataSourceURL:function(){return h.getV3ServiceDataSourceURL("oss")}}))},createPELicensingModel:function(){return new(t.extend({urlRoot:w.LICENSE,DP:{LICENSE_LIST:"licenseList",CAPACITY_LICENSED:"capacityLicensed"},getBucketLicenseList:function(){var e=this.get(this.DP.LICENSE_LIST)||[];return _.filter(e,function(e){return e[P.LICENSE_CLASS].toLowerCase()===T.LICENSE_CLASSES.BUCKET.toLowerCase()})},getBucketCapacityLicensed:function(){var e=this.get(this.DP.CAPACITY_LICENSED)||{};return e[T.LICENSE_ATTRIBUTE_TYPE.BUCKET]?e[T.LICENSE_ATTRIBUTE_TYPE.BUCKET]:0}}))},render:function(){this.$el.html(G(this.vtOptions())),this.renderSubviews()},renderSubviews:function(){this.summaryView.setElement(this.$(".license-summary-wrapper")).render()},show:function(t){this.summaryView.startServices(),e.prototype.show.apply(this,arguments),this.listLicensing()},hide:function(){this.enableCloseButton(),this.summaryView.stopServices(),e.prototype.hide.apply(this,arguments)&&this.$(".n-tooltip-circle").each(function(){$(this).tooltip("destroy")})},destroy:function(){this.summaryView.destroy(),e.prototype.destroy.apply(this,arguments)},canModify:function(){return this.canModifyByEntityType(T.ENTITY_LICENSING)&&!this.model.isOfClass(T.LICENSE_CLASSES.XPRESS)},showList:function(){this.$(".detailsContainer").hide(),this.$(".clusterOptionsContainer").hide(),this.$(".contact-sales-container").hide(),this.$(".n-modal-footer").hide(),this.$(".n-modal-wrapper").removeAttr("data-mode"),this.showSubview(".listContainer",null,!0)},showConfigMessaging:function(){C.isLocalStorageProperty(T.LOCAL_STORAGE.NO_PORTAL_PROMPT)||(this.clearHeader(),this.proxyConfigModel.isConfigured()&&(this.$(".btnConfigureProxy").hide(),this.proxyConfigModel.isActive()||this.showHeaderWarning(Z({msg:this.i18n("proxyError"),actionMsg:this.i18n("proxyErrorAction")}))))},renderHeaderMessages:function(e,t,n){this.model.isInStandbyMode()&&this.showHeaderInfo(this.i18n("licenseActionNotCompleted")),e=e||this.model.getCategory(),this.actionView=void 0===n?this.actionView:n;var i=this.model.getExpiredLicenseTypes();if(u.isStarterViolation(e)&&this.showHeaderError(this.i18n("starter_violation")),i.length){var s=i.join(", ");this.showHeaderError(this.i18ns("attribute_expired_msg",s))}if(e&&this.renderHeaderActionMsg(t),this.coinLic&&this.renderCoinHeaderMsg(e,t),this.clusterManager.isMulticlusterUI()){if(!this.coinLic&&this.model.getCategory()===T.LICENSE_TYPES.PRO){var a=this.clusterNodeSummary[T.NODES_COUNTS]
;this.model.getNodes().length<a&&this.showHeaderError(this.i18ns("manual_expand_node_msg",T.MULTICLUSTER_NAME))}g.getServiceModel(g.SERVICES.MICROSEG).isMicrosegTrialPeriodFinished()&&!this.model.isFlowPurchased()&&this.showHeaderError(this.i18n("microseg_trial_violation"))}else this.proxyConfigModel.isActive()&&(this.mixedLic?this.showHeaderInfo(this.i18n("one_click_not_available_mixed")):u.isAOSUnlicensed()&&this.showHeaderInfo(ae({msg:this.i18ns("one_click_not_available_usecase"),actionType:"coinManual",actionMsg:this.i18n("click_here")})));this.addBannerStream()},renderCoinHeaderMsg:function(e,t,n){var i=this.mixedLic||this.model.hasProduct(T.LICENSE_CLASSES.FILE)||this.model.hasProduct(T.LICENSE_CLASSES.BUCKET);this.coinDiff=void 0===t?this.coinDiff:t;var s=this.model.getCoinExpired(),a=B*T.MILLIS_PER_DAY;a+=Date.now();var o=this.model.getCoinExpiryAfterDate(null,a);s>0?(this.showHeaderError(ae({msg:this.i18ns("coin_expiry_header_msg",s),actionType:this.proxyConfigModel.isEnabled(i)?"oneClick":"coinManual",actionMsg:this.i18n("renewErrorAction")})),this.proxyConfigModel.isActive()&&this._createBannerAction(T.LICENSE_ACTIONS.RENEW)):o>0&&(this.showHeaderInfo(ae({msg:this.i18ns("license_will_expire",o,B),actionType:this.proxyConfigModel.isEnabled(i)?"oneClick":"coinManual",actionMsg:this.i18n("renewErrorAction")})),this.proxyConfigModel.isActive()&&this._createBannerAction(T.LICENSE_ACTIONS.RENEW))},fetchCalmConsumptionData:function(){return this.calmConsumptionModel.save(null,{error:function(e,t){C.log(t.responseText)}})},renderHeaderActionMsg:function(e){var t=!this.model.isVDIEnabled()&&!this.model.isRoboEnabled(),n=this.mixedLic||this.model.hasProduct(T.LICENSE_CLASSES.FILE)||this.model.hasProduct(T.LICENSE_CLASSES.BUCKET);this.coinDiff=void 0===e?this.coinDiff:e;var i="",s=this.proxyConfigModel.isEnabled(n);this.coinDiff?this.coinDiff<0?(i=this.i18ns("reclaim_msg",Math.abs(this.coinDiff).toFixed(2)),this.showHeaderInfo(ae({msg:i,actionType:"oneClick",actionMsg:this.i18n("reclaimWarningAction")})),this._createBannerAction(T.LICENSE_ACTIONS.RECLAIM)):this.coinDiff>0&&(i=this.i18ns("expand_msg",this.coinDiff),this.showHeaderError(ae({msg:i,actionType:"oneClick",actionMsg:this.i18n("expandErrorAction")})),this._createBannerAction(T.LICENSE_ACTIONS.EXPAND)):t&&(this.model.hasUnlicensedCapacity()>0?(this.showHeaderError(ae({msg:this.coinLic?this.i18n("manual_expand_msg"):this.i18n("has_unlicensed_cap_msg"),actionType:s?"oneClick":"coinManual",actionMsg:this.i18n("expandErrorAction")})),this.ablLic&&this._createBannerAction(T.LICENSE_ACTIONS.EXPAND)):this.model.hasUnlicensedCapacity()<0&&(this.showHeaderInfo(ae({msg:this.coinLic?this.i18n("manual_reclaim_msg"):this.i18n("has_unused_cap_msg"),actionType:s?"oneClick":"coinManual",actionMsg:this.i18n("reclaimWarningAction")})),this.ablLic&&this._createBannerAction(T.LICENSE_ACTIONS.RECLAIM)))},reset:function(){this.clearHeader(),this.showList(),this.undelegateEvents()},resetPELicenseSummary:function(){var e;this.peLicenseSummary=(e={},_defineProperty(e,P.LICENSE_COIN_LIST,[]),_defineProperty(e,P.LICENSE_CAPACITY_LICENSED,_defineProperty({},T.LICENSE_ATTRIBUTE_TYPE.BUCKET,0)),e)},setLicenseMode:function(){this.coinLic=this.model.isCoinEnabled(),this.ablLic=this.model.isABLEnabled(),this.nodeLic=this.model.isNodeEnabled(),this.calmLic=this.isFFEnabled(T.FFLAGS.CALM_LICENSING),this.mixedLic=this.model.isMixedCluster(),this.licenseMode=this.model.getLicenseMode(),localStorage.setItem(T.LOCAL_STORAGE.ONE_CLICK_DISABLED,localStorage[T.LOCAL_STORAGE.ONE_CLICK_DISABLED]||!1)},listLicensing:function(e){var t=this,n=[this.model.fetch({alwaysTriggerChange:!0}),this.proxyConfigModel.fetch({alwaysTriggerChange:!0})];this.clusterManager.isMulticlusterUI()?E.isFeatureEnabled(T.FEATURE_IDS.OBJECT_STORE)?this.objectStoreModel.performQuery().then(function(){var e=t.getObjectStoreData(),i=[];t.peLicenseModels=[],_.each(e,function(e){var n=t.createPELicensingModel();t.peLicenseModels.push(n),i.push(n.fetch({data:{proxyClusterUuid:e}}))}),Promise.all(i).then(function(){t._setPELicenseSummary(),n.push(t.pcNodeCollection.performQuery()),t.calmLic&&n.push(t.fetchCalmConsumptionData()),t.renderSubviews(),t.performDeferredCall(n)})}).error(function(){n.push(t.pcNodeCollection.performQuery()),t.calmLic&&n.push(t.fetchCalmConsumptionData()),t.renderSubviews(),t.performDeferredCall(n)}):(n.push(this.pcNodeCollection.performQuery()),this.calmLic&&n.push(this.fetchCalmConsumptionData()),this.renderSubviews(),this.performDeferredCall(n)):(n.push(this.hostCollection.fetch()),n.push(this.fileServerUsageModel.fetch()),this.renderSubviews(),this.performDeferredCall(n))},performDeferredCall:function(e){var t=this;$.whenAll.apply($,e).done(function(){t.setNodeSummary(),_.some(e,function(e){return e.isRejected()})?t.showHeaderError(t.i18ns("errorDataFetch",le({classes:"alert-link fetch-try-again",content:t.i18n("try_again")}))):t.licenseMode!==t.model.getLicenseMode()?t._reloadSummaryView():(t.showConfigMessaging(),t.renderHeaderMessages(),t._createDetailedAction()),t.summaryView.fetchData(),t.completeLicensing&&t.renderManualSteps()})},buildCapacitySummary:function(e){var t=this,n={},i=void 0;return _.each(e,function(e){i=e[P.LICENSE_CLASS]===T.LICENSE_CLASSES.FILE||e[P.LICENSE_CLASS]===T.LICENSE_CLASSES.BUCKET?e[P.LICENSE_ATTRIBUTE]+"_"+e[P.LICENSE_CLASS]:e[P.LICENSE_ATTRIBUTE]===T.LICENSE_PORTAL_ATTRIBUTE_TYPES.FLASH?t.i18n("TIB")+"_"+e[P.LICENSE_ATTRIBUTE]:e[P.LICENSE_ATTRIBUTE],n[i]?n[i]+=e[P.LICENSE_QUANTITY_APPLIED]:n[i]=e[P.LICENSE_QUANTITY_APPLIED]}),n},_getLicenseDetailsTableColumns:function(e){var t=this,n={header:this.i18n("lic_list_table_header_id"),dataSrc:function(e){return e.licenseId||"&mdash;"}},i={header:this.i18n("lic_list_table_header_model"),dataSrc:function(e){return e.model||"&mdash;"}},s={header:this.i18n("lic_list_table_header_type"),dataSrc:this._formatLicenseCategory.bind(this)},a={header:this.i18n("lic_list_table_header_type"),dataSrc:function(e){return e.category||"&mdash;"}},o={header:this.i18n("lic_list_table_header_status"),dataSrc:function(e){return e.used?"Yes":"No"}},r={header:this.i18n("lic_list_table_header_expiry"),dataSrc:function(e){return t._formatLicenseExpirationDate(e)||"&mdash;"}},l={header:this.i18n("lic_list_table_header_count"),dataSrc:function(e){return e.count}},c={header:this.i18n("lic_list_table_header_licensed"),dataSrc:function(e){return e.quantity}},d={header:this.i18n("lic_list_table_header_licensed"),dataSrc:function(e){return C.toTitleCase(e.licenseType)}},p={header:this.i18n("lic_list_table_header_coin"),dataSrc:function(e){return e.coinsLicensed}},u={header:this.i18n("lic_list_table_licenses"),dataSrc:function(e){return e.license}},h={header:oe({parent:this.i18n("lic_list_table_header_capacity"),children:[this.i18n("lic_list_table_header_type"),this.i18n("lic_list_table_header_quantity")]}),dataSrc:function(e){return re({tableCells:[e.type,e.quantity]})},multilevelHeader:!0},m={header:this.i18n("lic_list_table_header_coin"),dataSrc:function(e){return e.coins}},f={header:this.i18n("lic_list_table_header_quantity"),dataSrc:function(e){return e.type}},v={header:this.i18n("lic_list_table_cores"),dataSrc:function(e){return e.cores}},g={header:this.i18n("lic_list_table_ssds"),dataSrc:function(e){return e.ssds}},E={header:this.i18n("lic_list_table_file_tib"),dataSrc:function(e){return e.file}},_={header:this.i18n("lic_list_table_bucket_tib"),dataSrc:function(e){return e.bucket}},T={header:this.i18n("lic_list_table_vdi_num"),dataSrc:function(e){return e.vdi}},S={header:this.i18n("lic_list_table_robo_num"),dataSrc:function(e){return e.robo}},A={header:this.i18n("lic_list_table_header_license"),dataSrc:function(e){return e.name}},b={header:this.i18n("lic_list_table_header_type"),dataSrc:function(e){return e.type}},y={header:this.i18n("lic_list_table_header_coin"),dataSrc:function(e){return e.coins}},I={header:this.i18n("lic_list_table_header_expiry"),dataSrc:function(e){return e.expiryDate}},w={header:this.i18n("lic_list_table_header_coin"),dataSrc:function(e){return e.coins}},P={header:this.i18n("lic_list_table_capacity_type"),dataSrc:function(e){return t.i18n(e.attribute)}},N={header:this.i18n("lic_list_table_header_quantity"),dataSrc:function(e){return e.quantity}},R=[];if(this.coinLic)switch(e){case"pcCoinSummary":R.push(u),R.push(h),R.push(m);break;case"coinClusterLicenses":R.push(A),R.push(b),R.push(y);break;case"coinDetails":R.push(n),R.push(I),R.push(p);break;case"coinClusterCapacity":R.push(f),R.push(v),R.push(g),R.push(w);break;default:R.push(n),R.push(r),R.push(p)}else if(this.ablLic)switch(e){case"ablVDICapacity":R.push(f),R.push(T);break;case"ablRoboCapacity":R.push(f),R.push(S);break;case"ablClusterCapacity":R.push(f),R.push(v),R.push(g);break;case"ablFileCapacity":R.push(f),R.push(E);break;case"ablBucketCapacity":R.push(f),R.push(_);break;case"attributeDetails":R.push(n),R.push(s),R.push(P),R.push(N),R.push(r)}else if(this.mixedLic)switch(e){case"ablClusterCapacity":R.push(f),R.push(v),R.push(g);break;case"ablFileCapacity":R.push(f),R.push(E);break;case"ablBucketCapacity":R.push(f),R.push(_);break;case"mixedNodeDetails":R.push(n),R.push(s),R.push(i),R.push(r);break;case"mixedAttributeDetails":R.push(n),R.push(s),R.push(P),R.push(N),R.push(r)}else switch(e){case"pcModelSummary":R.push(i),R.push(l);break;case"calmLicensingList":R.push(n),R.push(a),R.push(o),R.push(r);break;case"bucketsLicensingList":R.push(n),R.push(d),R.push(c),R.push(r);break;default:R.push(n),this.clusterManager.isMulticlusterUI()||R.push(i),R.push(s),R.push(o),R.push(r)}return R},_createLicensingTable:function(e){return e=_.defaults(e,{title:!1,description:!1,textCenter:!1}),e.columns=this._getLicenseDetailsTableColumns(e.id),j(this.vtOptions(e))},_createManualStepView:function(){return Y(this.vtOptions({standbyMode:this.model.isInStandbyMode(),generateLink:le({classes:"clusterInfoDownload",content:this.i18n("manual_lic_generate_link_text")}),uploadLink:le({classes:"fileUpload",content:this.i18n("manual_lic_upload_link_text")}),portalLink:S.NEW_TAB_LINK({destUrl:w.SUPPORT_PORTAL_LICENSING,content:this.i18n("manual_lic_portal_link_text")}),type:""}))},renderManualSteps:function(){this.$("#clusterFileOptions").html(this._createManualStepView()),this.showForm(this.MODE_CONFIGURE_LICENSES,!0)},renderLicenseList:function(){var e=this,t=this.mixedLic||this.model.hasProduct(T.LICENSE_CLASSES.FILE)||this.model.hasProduct(T.LICENSE_CLASSES.BUCKET),n=this.clusterManager.isMulticlusterUI(),i=this.model.get(P.LICENSE_NODE_LIST)||[],s="";if(this.coinLic){var a=this._getClusterSummary(),o=this._getCoinLicenses(),r=a.coinExpired>0,l=r?this.i18ns("lic_list_coin_expired_summary",a.coinExpired,a.coinTotal,a.minExpiryDate):this.i18ns("lic_list_coin_summary",a.coinExpiryNum,a.coinTotal,a.minExpiryDate),c={id:"coinDetails",title:"",description:"",centerTableDetails:!0,rows:o};if(n){var d={license:a.primaryLic?a.primaryLic.split("_").join(" "):"",type:this.i18n("lic_list_table_node"),quantity:a.nodeInfo,coins:this.model.getGeneralCoinTotal()},p=[d];if(this.calmLic){var u={license:T.LICENSE_CLASSES.CALM,type:this.i18n("lic_list_table_license_packs"),quantity:this.licActionManager.getTotalCalmPacksRequired(),coins:this.model.getCalmCoinTotal()};p.push(u)}r=a.coinExpired>0,l=r?this.i18ns("lic_list_coin_expired_summary",a.coinExpired,a.coinTotal,a.minExpiryDate):this.i18ns("lic_list_coin_summary",a.coinExpiryNum,a.coinTotal,a.minExpiryDate);var h={id:"pcCoinSummary",description:l,centerTableDetails:!0,rows:p};c={id:"coinDetails",description:this.i18ns("lic_list_table_total_coins",this.model.getClusterCoinTotal()),rows:o},s+=this._createLicensingTable(h),s+=this._createLicensingTable(c)}else{var m=0,f=0,v=_.map(a.clusterLicenseList,function(t){return t.subCategory?m++:f++,{name:C.toTitleCase(t.licenseType),type:t.subCategory?e.i18n("lic_list_table_addon_lic"):e.i18n("lic_list_table_primary_lic"),coins:t.coinsLicensed}}),g={id:"coinClusterLicenses",title:"",description:"",centerTableDetails:!0,rows:v},S=[];a.coinDiff&&S.push({type:this.i18n("lic_list_table_current"),cores:a.licensedCap[T.LICENSE_ATTRIBUTE_TYPE.CORES],hdds:a.licensedCap[T.LICENSE_ATTRIBUTE_TYPE.HDD],ssds:a.licensedCap[T.LICENSE_ATTRIBUTE_TYPE.FLASH],file:a.licensedCap[T.LICENSE_ATTRIBUTE_TYPE.FILE],bucket:a.licensedCap[T.LICENSE_ATTRIBUTE_TYPE.BUCKET],coins:a.coinTotal}),0!==a.coinDiff&&S.push({type:a.coinDiff>0?this.i18n("lic_list_table_added_cap"):this.i18n("lic_list_table_removed_cap"),cores:Math.abs(a.capacity[T.LICENSE_ATTRIBUTE_TYPE.CORES]-a.licensedCap[T.LICENSE_ATTRIBUTE_TYPE.CORES]),hdds:Math.abs((a.capacity[T.LICENSE_ATTRIBUTE_TYPE.HDD]-a.licensedCap[T.LICENSE_ATTRIBUTE_TYPE.HDD]).toFixed(2)),ssds:Math.abs((a.capacity[T.LICENSE_ATTRIBUTE_TYPE.FLASH]-a.licensedCap[T.LICENSE_ATTRIBUTE_TYPE.FLASH]).toFixed(2)),file:0,bucket:0,coins:a.coinDiff>0?this.i18n("lic_list_table_require_coin"):this.i18n("lic_list_table_reclaim_coin")});var A=void 0,b=this.proxyConfigModel.isEnabled(t)?"oneClick":"coinManual";if(a.coinDiff){A='<a data-ntnx-title-link class="n-link '+b+'Action" stream-action="licAction"stream-target="detail">'+(a.coinDiff>0?this.i18n("lic_list_table_require_coin"):this.i18n("lic_list_table_reclaim_coin"))+"</a>"}else A=a.coinTotal;S.push({type:this.i18n("lic_list_table_header_total"),cores:a.capacity[T.LICENSE_ATTRIBUTE_TYPE.CORES],hdds:a.capacity[T.LICENSE_ATTRIBUTE_TYPE.HDD],ssds:a.capacity[T.LICENSE_ATTRIBUTE_TYPE.FLASH],file:a.licensedCap[T.LICENSE_ATTRIBUTE_TYPE.FILE],bucket:a.licensedCap[T.LICENSE_ATTRIBUTE_TYPE.BUCKET],coins:A});var y={id:"coinClusterCapacity",title:"",description:"",centerTableDetails:!0,rows:S},I=this._createLicensingTable(g),w=this._createLicensingTable(c),N=this._createLicensingTable(y),R=J(this.vtOptions({secTitle:this.i18n("lic_list_table_title_lic_type"),secDescription:this.i18ns("lic_list_table_subtitle_lic_type",m,f),licensingTables:I,extraClass:""})),D=J(this.vtOptions({secTitle:this.i18ns("lic_list_table_title_id"),secDescription:l,licensingTables:w,extraClass:""})),M=J(this.vtOptions({secTitle:this.i18ns("lic_list_table_title_consumption"),secDescription:this.i18ns("lic_list_table_subtitle_cap"),licensingTables:N,extraClass:""}));s+=R,s+=D,s+=M}}else if(this.ablLic){var O=this._getClusterSummary(),L=this._getABLLicenses(),x=[];this.model.isVDIEnabled()?x.push({type:this.i18n("lic_list_table_header_total_licensed"),vdi:this.model.getVDIUsersTotal()}):this.model.isRoboEnabled()?x.push({type:this.i18n("lic_list_table_header_total_licensed"),robo:this.model.getRoboVMsTotal()}):((O.isUnlicensed||O.isOverLicensed)&&(x.push({type:this.i18n("lic_list_table_current"),cores:O.licensedCap[T.LICENSE_ATTRIBUTE_TYPE.CORES],hdds:O.licensedCap[T.LICENSE_ATTRIBUTE_TYPE.HDD],ssds:O.licensedCap[T.LICENSE_ATTRIBUTE_TYPE.FLASH],file:O.licensedCap[T.LICENSE_ATTRIBUTE_TYPE.FILE],bucket:O.licensedCap[T.LICENSE_ATTRIBUTE_TYPE.BUCKET]}),x.push(O.isUnlicensed?{type:this.i18n("lic_list_table_added_cap"),cores:O.capacity[T.LICENSE_ATTRIBUTE_TYPE.CORES]-O.licensedCap[T.LICENSE_ATTRIBUTE_TYPE.CORES],hdds:(O.capacity[T.LICENSE_ATTRIBUTE_TYPE.HDD]-O.licensedCap[T.LICENSE_ATTRIBUTE_TYPE.HDD]).toFixed(2),ssds:(O.capacity[T.LICENSE_ATTRIBUTE_TYPE.FLASH]-O.licensedCap[T.LICENSE_ATTRIBUTE_TYPE.FLASH]).toFixed(2),file:0,bucket:0}:{type:this.i18n("lic_list_table_removed_cap"),cores:O.licensedCap[T.LICENSE_ATTRIBUTE_TYPE.CORES]-O.capacity[T.LICENSE_ATTRIBUTE_TYPE.CORES],hdds:(O.licensedCap[T.LICENSE_ATTRIBUTE_TYPE.HDD]-O.capacity[T.LICENSE_ATTRIBUTE_TYPE.HDD]).toFixed(2),ssds:(O.licensedCap[T.LICENSE_ATTRIBUTE_TYPE.FLASH]-O.capacity[T.LICENSE_ATTRIBUTE_TYPE.FLASH]).toFixed(2),file:0,bucket:0})),x.push({type:this.i18n("lic_list_table_header_total"),cores:O.capacity[T.LICENSE_ATTRIBUTE_TYPE.CORES],hdds:O.capacity[T.LICENSE_ATTRIBUTE_TYPE.HDD],ssds:O.capacity[T.LICENSE_ATTRIBUTE_TYPE.FLASH]}));var k=[].concat([{type:this.i18n("lic_list_table_header_total_licensed"),file:O.licensedCap[T.LICENSE_ATTRIBUTE_TYPE.FILE]||0},{type:this.i18n("lic_list_table_header_total_consumed"),file:O.capacity[T.LICENSE_ATTRIBUTE_TYPE.FILE]}]),V=[].concat([{type:this.i18n("lic_list_table_header_total_licensed"),bucket:O.licensedCap[T.LICENSE_ATTRIBUTE_TYPE.BUCKET]||0}]),U={id:"attributeDetails",title:"",description:"",centerTableDetails:!0,rows:L},$="",F="";this.model.isVDIEnabled()?($="ablVDICapacity",F=this.i18ns("lic_list_table_title_vdi_consumption")):this.model.isRoboEnabled()?($="ablRoboCapacity",F=this.i18ns("lic_list_table_title_robo_consumption")):($="ablClusterCapacity",F=this.i18ns("lic_list_table_title_aos_consumption"));var H={id:$,title:F,description:"",centerTableDetails:!1,rows:x},B={id:"ablFileCapacity",title:this.i18ns("lic_list_table_title_file_consumption"),description:"",centerTableDetails:!1,rows:k},G={id:"ablBucketCapacity",title:this.i18ns("lic_list_table_title_bucket_consumption"),description:"",centerTableDetails:!1,rows:V},Y=this._createLicensingTable(H);Y+=this._createLicensingTable(B),Y+=this._createLicensingTable(G);var W=this._createLicensingTable(U),K=J(this.vtOptions({secTitle:this.i18ns("lic_list_table_title_consumption"),secDescription:"",licensingTables:Y,extraClass:"capacityTable"})),z=J(this.vtOptions({secTitle:this.i18ns("lic_list_table_title_id"),secDescription:"",licensingTables:W,extraClass:""}));s+=K,s+=z}else if(this.mixedLic){var j=this._getClusterSummary(),q=[];q.push({type:this.i18n("lic_list_table_header_total"),cores:j.capacity[T.LICENSE_ATTRIBUTE_TYPE.CORES],ssds:j.capacity[T.LICENSE_ATTRIBUTE_TYPE.FLASH],file:j.capacity[T.LICENSE_ATTRIBUTE_TYPE.FILE],bucket:j.licensedCap[T.LICENSE_ATTRIBUTE_TYPE.BUCKET]});var X=_.filter(this._getMixedNodeLicenses(),function(t){return!e.model.isCapacityLicense(t)}),Q=_.filter(this._getMixedNodeLicenses(),function(t){return e.model.isCapacityLicense(t)}),Z=[];_.each(this.buildCapacitySummary(Q),function(e,t){Z.push(e+" "+C.toTitleCase(t))});var ee=[].concat([{type:this.i18n("lic_list_table_header_total_licensed"),file:j.licensedCap[T.LICENSE_ATTRIBUTE_TYPE.FILE]||0},{type:this.i18n("lic_list_table_header_total_consumed"),file:j.capacity[T.LICENSE_ATTRIBUTE_TYPE.FILE]}]),te=[].concat([{type:this.i18n("lic_list_table_header_total_licensed"),bucket:j.licensedCap[T.LICENSE_ATTRIBUTE_TYPE.BUCKET]||0}]),ne={id:"ablClusterCapacity",title:this.i18ns("lic_list_table_title_aos_consumption"),description:"",centerTableDetails:!1,rows:q},ie={id:"ablFileCapacity",title:this.i18ns("lic_list_table_title_file_consumption"),description:"",centerTableDetails:!1,rows:ee},se={id:"ablBucketCapacity",title:this.i18ns("lic_list_table_title_bucket_consumption"),description:"",centerTableDetails:!1,rows:te},ae={id:"mixedAttributeDetails",title:this.i18ns("lic_list_table_title_cbl"),description:"",centerTableDetails:!0,rows:Q},oe={id:"mixedNodeDetails",title:this.i18ns("lic_list_table_title_nbl"),description:"",centerTableDetails:!0,rows:X},re=this._createLicensingTable(ne);re+=this._createLicensingTable(ie),re+=this._createLicensingTable(se);var le=this._createLicensingTable(ae);le+=this._createLicensingTable(oe);var ce=J(this.vtOptions({secTitle:this.i18ns("lic_list_table_title_consumption"),secDescription:this.i18ns("lic_list_table_mixed_consumption_description"),licensingTables:re,extraClass:"capacityTable"})),de=J(this.vtOptions({secTitle:this.i18ns("lic_list_table_title_id"),secDescription:"",licensingTables:le,extraClass:""}));s+=ce,s+=de}else if(n){var pe=_.template('<div class="pcTitleCtr"><span class="pcLicenseTitle"><%= title %></span><span class="pcCapacityInfo"><%= capacityInfo %></span></div>'),ue=_.template('<span><%= i18ns("lic_list_table_capacity_info_desc", cap, type) %></span><span class="sep"> &middot; </span><span><%= i18ns("lic_list_table_total_info_desc", total) %></span>'),he=this._getPCCapacitySummary(),me=_.groupBy(i,"licenseClass"),fe=me[T.LICENSE_CLASSES.PRISM_CENTRAL],ve={id:"licensingList",title:pe(this.vtOptions({title:this.i18ns("lic_list_table_prism_desc"),capacityInfo:ue(this.vtOptions({cap:he.capacity[T.LICENSE_ATTRIBUTE_TYPE.NODES],total:he.capacityLicensed[T.LICENSE_ATTRIBUTE_TYPE.NODES],type:this.i18n("node")}))})),rows:fe},ge={};if(this.model.hasProduct(T.LICENSE_CLASSES.FLOW)){var Ee=me[T.LICENSE_CLASSES.FLOW];ge={id:"flowLicensingList",title:pe(this.vtOptions({title:this.i18ns("lic_list_table_flow_desc"),capacityInfo:ue(this.vtOptions({cap:he.capacity[T.LICENSE_ATTRIBUTE_TYPE.FLOW],total:he.capacityLicensed[T.LICENSE_ATTRIBUTE_TYPE.FLOW],type:this.i18n("node")}))})),rows:Ee}}var _e={};if(this.calmLic){var Te=me[T.LICENSE_CLASSES.CALM]||[],Ce=this.licActionManager.getNumCalmPacksPurchased(),Se=Ce*T.LICENSE_CALM_VMS_PER_PACK;Te.push({category:T.LICENSE_TYPES.CALM_TRIAL,used:!0}),_e={id:"calmLicensingList",title:pe(this.vtOptions({title:this.i18ns("lic_list_table_calm_desc"),capacityInfo:ue(this.vtOptions({cap:he.capacity[T.LICENSE_ATTRIBUTE_TYPE.CALM],total:Se,type:this.i18n("VM")}))})),rows:Te}}var Ae={};E.isFeatureEnabled(T.FEATURE_IDS.OBJECT_STORE)&&(this.bucketLicenses=this.peLicenseSummary[P.LICENSE_COIN_LIST],Ae={id:"bucketsLicensingList",title:pe(this.vtOptions({title:this.i18ns("lic_list_table_buckets_desc"),capacityInfo:ue(this.vtOptions({cap:he.capacity[T.LICENSE_ATTRIBUTE_TYPE.BUCKET],total:he.capacityLicensed[T.LICENSE_ATTRIBUTE_TYPE.BUCKET],type:this.i18n("TIB")}))})),rows:this.bucketLicenses});var be=this.clusterNodeSummary[T.NODES_MODELS],ye=_.map(be,function(e,t){return{model:t,count:e.length}}),Ie={id:"pcModelSummary",title:this.i18n("lic_list_table_model_summary_desc"),rows:ye};s+=this._createLicensingTable(ve),this.model.hasProduct(T.LICENSE_CLASSES.FLOW)&&(s+=this._createLicensingTable(ge)),this.calmLic&&(s+=this._createLicensingTable(_e)),E.isFeatureEnabled(T.FEATURE_IDS.OBJECT_STORE)&&(s+=this._createLicensingTable(Ae)),s+=this._createLicensingTable(Ie)}else{var we={id:"licensingList",description:this.i18n("lic_list_table_desc"),rows:i},Pe=this.model.get(P.LICENSE_ADDON_LIST)||[],Ne={id:"addonLicensingList",description:this.i18n("lic_list_table_addon_desc"),rows:Pe};s+=this._createLicensingTable(we),s+=this._createLicensingTable(Ne)}this.$("#licensingTablesContainer").html(s)},_formatLicenseExpirationDate:function(e){var t=this.model.isCapacityLicense(e)?e[P.LICENSE_COIN_EXPIRATION]:e[P.LICENSE_EXPIRATION];return _.isUndefined(t)?null:0===t?T.LICENSE_NEVER_EXPIRES:A.formatLongDate(new Date(t/1e3))},_formatLicenseCategory:function(e){var t=void 0;return t=e.licenseType||e.category,this.model.isPrimaryLicense(e)||(t=C.toTitleCase(e.licenseClass)+"_"+e.category),C.toTitleCase(t)},_generateLicensingRows:function(e){var t="",n=void 0,i=void 0;return e.length&&this.model.hasGeneralLicense()?_.each(e,function(e){n=this._formatLicenseExpirationDate(e),i=this._formatLicenseCategory(e),t+=X({license:e,formattedDate:n,isPC:this.clusterManager.isMulticlusterUI(),category:i})},this):t="<tr><td>"+this.i18ns("noLicenseDetails")+"</td></tr>",t},_listLicensing:function(e,t){var n=this.$("#"+t+" > tbody"),i=this._generateLicensingRows(e);n.html(i)},clearHeader:function(){this.$(".n-modal-alert-header").slideUp(0),this.$(".n-modal-alert-header").removeClass("not-empty")},showHeaderWarning:function(e){e=e||"Warning";var t=se({msg:e});this._showHeader(t)},showForm:function(e,t){this.mode=e,this.completeLicensing||this.clearHeader(),e!==this.MODE_ACTION_IN_PROGRESS&&this.$(".n-modal-footer").show(),this.hideSubview(".listContainer"),this.hideSubview(".contact-sales-container"),this.hideSubview(".detailsContainer"),this.hideSubview(".clusterOptionsContainer"),this.$(".n-modal-wrapper").attr("data-mode",e);var n=this.mode===this.MODE_FEATURE_LIST||this.mode===this.MODE_LICENSE_LIST||this.mode===this.MODE_FEATURE_VIOLATIONS;this.mode===this.MODE_CONFIGURE_LICENSES?this.showSubview(".clusterOptionsContainer",null,!0,{complete:this.onSubviewTransitionComplete}):this.mode===this.MODE_ACTION_IN_PROGRESS?this.showSubview(".clusterOptionsContainer",null,!0):n&&this.showSubview(".detailsContainer",null,!0)},_formatFeatureText:function(e){return e=e||"",e=e.replace(/_/g," ").trim().toLowerCase(),e.replace("dr","DR")},_buildClusterSummary:function(){var e={details:[],clusterType:this.clusterManager.isMulticlusterUI()?T.MULTICLUSTER_NAME:T.SINGLE_CLUSTER_NAME};return this.clusterManager.getClusterCollection().each(function(t){var n={};n[P.CLUSTER_UUID]=t.get(P.CLUSTER_UUID),n[P.CLUSTER_NUM_NODES]=t.get(P.CLUSTER_NUM_NODES),n[P.CLUSTER_BLOCK_SERIALS]=(t.get(P.CLUSTER_BLOCK_SERIALS)||[]).join(", "),e.details.push(n)}),e},getObjectStoreData:function(){var e=this,t=[];return _.each(this.objectStoreModel.getQueryResults().models,function(n){var i=parseInt(n.get(P.OBJECT_STORE.USAGE_BYTES),10)||0;e.bucketsUsageTiB=parseFloat(e.bucketsUsageTiB)+parseFloat(b.convertBytesToUnit(i,b.UOM_TIB).toFixed(2));var s=n.get(P.OBJECT_STORE.CLUSTER_REFERENCE);-1===t.indexOf(s)&&t.push(s)}),t},setNodeSummary:function(){if(this.clusterManager.isMulticlusterUI()){var e=this.pcNodeCollection.getQueryResults().models;this.clusterNodeSummary[T.NODES_COUNTS]=e.length,this.clusterNodeSummary[T.NODES_MODELS]=_.groupBy(e,function(e){return e.get([P.HOST_MODEL_NAME])})}else this.clusterNodeSummary[T.NODES_COUNTS]=this.hostCollection.getNodeCount(),this.clusterNodeSummary[T.NODES_MODELS]=this.hostCollection.groupByModelNumber()},_buildSalesEmail:function(){var e=this._buildClusterSummary(),t=new n;return t.addRecipients("dl-request-license@nutanix.com"),t.set(t.DP.SUBJECT,"Request for licenses"),t.set(t.DP.CONTENT,te(e)),t.set(t.DP.CONTENT_HTML,ne(e)),t},_setPELicenseSummary:function(){var e=this;this.resetPELicenseSummary(),_.each(this.peLicenseModels,function(t){e.peLicenseSummary[P.LICENSE_COIN_LIST]=e.peLicenseSummary[P.LICENSE_COIN_LIST].concat(t.getBucketLicenseList()),e.peLicenseSummary[P.LICENSE_CAPACITY_LICENSED][T.LICENSE_ATTRIBUTE_TYPE.BUCKET]=parseFloat(e.peLicenseSummary[P.LICENSE_CAPACITY_LICENSED][T.LICENSE_ATTRIBUTE_TYPE.BUCKET])+parseFloat(t.getBucketCapacityLicensed())})},hasBucketLicenses:function(){return this.peLicenseSummary[P.LICENSE_COIN_LIST].length>0},_getPCCapacitySummary:function(){var e,t,n=(e={},_defineProperty(e,T.LICENSE_ATTRIBUTE_TYPE.BUCKET,this.bucketsUsageTiB),_defineProperty(e,T.LICENSE_ATTRIBUTE_TYPE.NODES,this.clusterNodeSummary[T.NODES_COUNTS]),e),i=_.defaults(n,this.model.getCapacity()),s=0,a=0;return this.model.hasProduct(T.LICENSE_CLASSES.PRISM_CENTRAL)&&(s=this.model.getLicensesByProduct(T.LICENSE_CLASSES.PRISM_CENTRAL).length),this.model.hasProduct(T.LICENSE_CLASSES.FLOW)&&(a=this.model.getLicensesByProduct(T.LICENSE_CLASSES.FLOW).length),{capacity:i,capacityLicensed:this.model.getLicensedCapacity()?_.defaults(_defineProperty({},T.LICENSE_ATTRIBUTE_TYPE.BUCKET,this.bucketsUsageTiB),this.model.getLicensedCapacity()):(t={},_defineProperty(t,T.LICENSE_ATTRIBUTE_TYPE.BUCKET,this.peLicenseSummary[P.LICENSE_CAPACITY_LICENSED][T.LICENSE_ATTRIBUTE_TYPE.BUCKET]),_defineProperty(t,T.LICENSE_ATTRIBUTE_TYPE.NODES,s),_defineProperty(t,T.LICENSE_ATTRIBUTE_TYPE.FLOW,a),_defineProperty(t,T.LICENSE_ATTRIBUTE_TYPE.CALM,0),t)}},_getClusterSummary:function(){var e=this.model.getCapacity();if(!this.clusterManager.isMulticlusterUI()){var t=this.fileServerUsageModel.get(this.fileServerUsageModel.DP.TOTAL_FILE_SERVERS_SPACE_USED_IN_BYTES);e[T.LICENSE_ATTRIBUTE_TYPE.FILE]=b.convertBytesToUnit(t,b.UOM_TIB).toFixed(2)}var n=this.model.getLicensedCapacity(),i=this.model.getMinExpiryLic(this.model.getLicenseList()),s=_.map(this.model.getAddonLicenseList(),function(e){return _.extend({},e,{name:T.LICENSE_ADDON_NAMES[e.category.toUpperCase()]})}),a=this.model.isGeneralLicensesExpired(),o={capacity:e,licensedCap:n,hasExpired:a,minExpiryDate:i?A.formatLongDate(new Date(i[P.LICENSE_COIN_EXPIRATION]/1e3)):""};if(this.coinLic)return _.extend(o,{coinExpired:this.model.getCoinExpired(),coinExpiryNum:this.model.getEarliestExpiryCoin(),primaryLic:this.model.getCategory(),addonLic:s,primaryCoin:this.model.getGeneralCoinTotal(),coinTotal:this.model.getClusterCoinTotal(),nodeInfo:this.clusterNodeSummary[T.NODES_COUNTS],coinDiff:this.model.hasUnlicensedCapacity(),clusterLicenseList:_.extend({},this.model.getClusterLicenseList())});if(this.ablLic)return _.extend(o,{isOverLicensed:this.model.hasOverlicensedCapacity(!0),isUnlicensed:this.model.hasUnlicensedCapacity()>0});if(this.mixedLic){var r={};return _.each(this.model.getLicenseList(),function(e){var t=void 0;t="TIB"===e[P.LICENSE_ATTRIBUTE]?e[P.LICENSE_CLASS]+"_"+T.LICENSE_ATTRIBUTE_TYPE.TIB:T.LICENSE_ATTRIBUTE_TYPE[e[P.LICENSE_ATTRIBUTE]],r[t]?r[t]+=e[P.LICENSE_QUANTITY_APPLIED]:r[t]=e[P.LICENSE_QUANTITY_APPLIED]}),r=_.defaults(r,o.capacityLicensed),_.defaults({capacityLicensed:r},o)}return o},_getCoinLicenses:function(){var e=_.clone(this.model.getCoinLicenseList());return e?_.map(e,function(e){var t=e[P.LICENSE_COIN_EXPIRATION]||0;return e.expiryDate=A.formatLongDate(new Date(t/1e3)),e}):[]},_getABLLicenses:function(){var e=this,t=_.extend({},this.model.getAllLicenses());return t?_.map(t,function(t){var n=t[P.LICENSE_COIN_EXPIRATION];return t.expiryDate=A.formatLongDate(new Date(n/1e3)),t.name=t.subCategory===T.LICENSE_SUBCATEGORIES.ADDON?t.category.split("_").join(" "):e.i18n("lic_list_table_acroplolis")+" "+t.category,t}):[]},_getMixedNodeLicenses:function(){var e=this,t=_.extend({},this.model.getAllLicenses());return t?_.map(t,function(t){var n=t[P.LICENSE_COIN_EXPIRATION]||t[P.LICENSE_EXPIRATION];return t.expiryDate=A.formatLongDate(new Date(n/1e3)),t.name=t.subCategory===T.LICENSE_SUBCATEGORIES.ADDON?t.category.split("_").join(" "):e.i18n("lic_list_table_acroplolis")+" "+t.category,t}):[]},_createBannerAction:function(e){if(this.actionView){var t=_.first(this.actionView.getBannerActions());if(t&&t.id===e)this.$(".oneClickAction").attr("data-action",t.id);else{var n=this.$(".coinActionMsg").html()+this.i18ns("not_enough_license_msg");this.$(".coinActionMsg").html(n),this.$(".n-modal-alert-header .coinAction").html("").removeClass("oneClickAction")}}},_createDetailedAction:function(){if(this.actionView&&0!==this.coinDiff){var e=_.find(this.actionView.getBannerActions(),function(e){return e.id!==T.LICENSE_ACTIONS.RENEW});e&&this.$("#coinClusterCapacity .oneClickAction").attr("data-action",e.id)}},_reloadSummaryView:function(){this.setLicenseMode(),this.summaryView.stopServices(),this.summaryView.destroy(),this.summaryView=new d({parentView:this,clusterLicenseModel:this.model,clusterNodeSummary:this.clusterNodeSummary,proxyConfigModel:this.proxyConfigModel,csfModel:this.clusterIdModel,peLicenseSummary:this.peLicenseSummary,coinLic:this.coinLic,ablLic:this.ablLic,nodeLic:this.nodeLic,calmLic:this.calmLic,mixedLic:this.mixedLic}),this.summaryView.startServices(),this.render(),this.listLicensing()},onChangeInputFileName:function(e){var t=$(e.target).val(),n=t.split("\\").slice(-1)[0],i=this.$(".lsf-file-submit-ctr"),s=i.find(".lsf-filename"),a=i.find(".lsf-file-submit");n.length?(a.removeAttr("disabled"),i.removeClass("hide"),s.text(n)):(a.attr("disabled",""),s.text(this.i18n("fileUploadNoFile")))},onClickFileUpload:function(e){var t=C.uploadCheck();t?this.showHeaderInfo(t):this.$(".inputFileName").click()},onClickInfoDownload:function(e){m.executeDownloadAction(T.FILE_LICENSE)},onClickDetailedView:function(e){var t=void 0,n=void 0;this.nodeLic?(n={isPC:this.clusterManager.isMulticlusterUI(),modelInfo:this.clusterNodeSummary[T.NODES_MODELS]},t=z(this.vtOptions(n))):t=Q(this.vtOptions()),this.$("#detailList").html(t),this.renderLicenseList(),this._createDetailedAction(),this.showForm(this.MODE_LICENSE_LIST)},onUpload:function(){var e=this,t=this.$(".inputFileName"),n=h.getFormattedURL(w.LICENSE);C.uploadFile(t,n,{success:function(){e.showHeaderSuccess(e.i18n("applyLicenseSuccess")),e.listLicensing(),e.showList()},error:function(t){e.clearHeader(),e.showHeaderError(t)}})},onClickConfigureProxy:function(e){var t=this;v.renderPopupView(p,{onSave:function(){t.listLicensing()}})},onClickDismissConfigMsg:function(){
localStorage.setItem(T.LOCAL_STORAGE.NO_PORTAL_PROMPT,"true")},getUserEmail:function(){return((f.get(f.SESSION_INFO)[P.USER_DTO]||{}).profile||{}).emailId||""},_handleMessageSubmit:function(){var e=this;this.salesEmail.save().done(function(){e.clearHeader(),e.$(".btnBack").click(),$.whenShown(e.$("#licensingList"),function(){e.showHeaderSuccess(e.i18n("success_msg_send"))})}).fail(function(){e.showHeaderError(ee(e.vtOptions({mailtoString:e.salesEmail.getMailtoString()}))),e._renderMessagePreview()})},_handleManualMessageSubmit:function(){var e=document.createElement("a");e.setAttribute("href",this.salesEmail.getMailtoString()),e.setAttribute("style","display:none;"),this.$el.append(e),this.$(e)[0].click(),this.$(e).remove(),this.clearHeader(),this._renderMessagePreview()},_renderMessagePreview:function(){this.$("#contactSales").html(ie(this.vtOptions({to:this.salesEmail.get(this.salesEmail.DP.TO),subject:this.salesEmail.get(this.salesEmail.DP.SUBJECT),body:this.salesEmail.get(this.salesEmail.DP.CONTENT_HTML)})))},applyStepSpinner:function(){this.$(".n-proc-step .spinner").remove();var e=this.$(".n-proc-step:not(.complete):first .proc-step-content");e.length&&(e.prepend('<span class="spinner"><span>'),C.addInLineDonutLoader(e.find(".spinner")))},hideButtons:function(){this.$(".general-summary .addonBtn").hide(),this.$(".addon-summary .generalBtn").hide(),this.$(".addon-summary .manualBtn").hide(),this.clusterManager.isMulticlusterUI()&&this.$(".Bucket-summary .license-actions").hide()},addBannerStream:function(){this.$("#popupLicensing .n-modal-alert-header button.close").attr("stream-action","close").attr("stream-target","licBanner")},onClickManualWorkflow:function(){this._showManualWorkflow()},onClickFeatureViolations:function(e){this.$("#detailList").html(q(this.vtOptions({DP:i.DP,featViolations:this.model.getFeatureViolations()}))),this.showForm(this.MODE_FEATURE_VIOLATIONS)},onClickLicenseLink:function(e){var t=$(e.currentTarget);if(!t.closest(".license-state").hasClass("disabled")&&!t.closest(".license-icon").hasClass("click-disabled")){var n=t.find(".license-level").data("category"),i=n.split(" ").join("_").toUpperCase(),s=t.hasClass("license-addon-icon"),a=u.getAllFeatureAllowancesGroupByDetails(),o=u.getAllFeatureAllowancesGroupByDetails(!0,i);this.$("#detailList").html(K(this.vtOptions({displayableLicenseClass:this.model.getDisplayableLicenseClass(),allowanceGroup:a,addonAllowanceGroup:o,isAddon:s,licenseName:C.toTitleCase(n),showFeatureToggle:this.model.showFeatureToggle(),featureCheckbox:y.checkbox({id:"lic-feature-enable",checked:this.model.isFeatureEnabled(),disabled:!this.canModify()})}))),this.showForm(this.MODE_FEATURE_LIST,!0)}},onClickLicenseStatusLink:function(e){this.$(e.currentTarget).html()===T.LICENSE_MODES.STANDBY&&this.onClickConfigure(e)},onClickProductManual:function(e){this.onClickConfigure(e,$(e.target).attr("data-title"))},onClickConfigure:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";this.$("#clusterFileOptions").html(Y(this.vtOptions({standbyMode:this.model.isInStandbyMode(),generateLink:le({classes:"clusterInfoDownload",content:this.i18n("manual_lic_generate_link_text")}),uploadLink:le({classes:"fileUpload",content:this.i18n("manual_lic_upload_link_text")}),portalLink:S.NEW_TAB_LINK({destUrl:w.SUPPORT_PORTAL_LICENSING,content:this.i18n("manual_lic_portal_link_text")}),type:t}))),this.showForm(this.MODE_CONFIGURE_LICENSES,!0),this.$(".btnSave").show().attr("disabled",!0)},onClickToggleDetails:function(e){var t=this.$(".toggle-details"),n=this.$(".cluster-details > .details-container"),i=n.is(":visible")?this.i18n("show_details"):this.i18n("hide_details");t.html(i),n.toggle()},onClickSendMessage:function(e){var t=this.$("#contactSales").attr("data-send-method"),n="manual"===t?this._handleManualMessageSubmit:this._handleMessageSubmit,i=new RegExp(/[ ,]+/);this.$(e.currentTarget).attr("disabled","disabled"),this.salesEmail.prependToBody(this.$("#commentInput").val().trim()),this.salesEmail.addRecipients(this.$("#emailInput").val().trim().split(i)),n()},onRetry:function(){this.clearHeader(),this.showList(),this.listLicensing()},onClickBack:function(){this.clearHeader(),this.showList(),this.showConfigMessaging(),this.renderHeaderMessages()},onClickToggleFeatures:function(e){var t=this,n=$(e.currentTarget),i=this.model.isFeatureEnabled();$.nutanixConfirm({msg:this.i18n("toggleFeatureConfirmText",this.TOGGLE_FEATURE_CONFIRM_TEXT),yes:function(){var e=t.model;e.actionMode=T.ACTION_UPDATE;var s={};s[P.LICENSE_TYPE]=u.model.getCategory(),s[P.LICENSE_ENABLED]=!t.model.isFeatureEnabled(),e.save(s,{success:function(){$(".n-notification-loading").remove(),m.navigateToRoute(T.ROUTE_LOGOUT)},error:function(e,t,s){n.attr("checked",i)}})},no:function(){n.attr("checked",i)},yesText:this.i18n("btnContinue"),noText:this.i18n("btnCancel")})},onClickBannerAction:function(e){this.actionView.onClickAction(e)},onSubviewTransitionComplete:function(){this.mode===this.MODE_CONFIGURE_LICENSES&&this.model.isInStandbyMode()&&this.showHeaderWarning("Licensing workflow in progress...")},onActionStart:function(e){this.disableCloseButton(this.i18n("actionInProgress")),this.$(".header-btn-group .btn").addClass("disabled"),this.$("#clusterFileOptions").html(W(this.vtOptions())),this.showForm(this.MODE_ACTION_IN_PROGRESS,!0),this.applyStepSpinner()},onActionProgress:function(e){this.$(".n-proc-step:not(.complete):first").addClass("complete"),this.applyStepSpinner()},onActionComplete:function(e){var t=this;this.coinDiff=0,this.completeLicensing=!1,this.enableCloseButton(),this.$(".header-btn-group .btn").removeClass("disabled"),this.showHeaderSuccess(this.i18n("applyLicenseSuccess")),setTimeout(function(){t.clearHeader(),t.showList(),t.listLicensing(),t.hideButtons()},2e3)},onActionError:function(e){var t=this;this.enableCloseButton(),this.$(".header-btn-group .btn").removeClass("disabled"),e.responseText.includes(T.LICENSE_CLUSTER_TYPE.MIXED.toUpperCase())?(this.showHeaderError(this.i18n("oneClickNotAvailable")),localStorage.setItem(T.LOCAL_STORAGE.ONE_CLICK_DISABLED,"true")):e.responseText&&this.showHeaderError(e.responseText),setTimeout(function(){t._reloadSummaryView()},3e3)}}))}),define("text!templates/popups/hardwareadministration/RemoveHostConfirmView.html",[],function(){return"<div class=\"text-left\">\n  <%= i18n('removal_confirm_intro') %>\n  <ul class=\"indented -compact\">\n    <% if (isAHV) { %>\n    <li><%= i18n('removal_confirm_vms_migrated') %></li>\n    <%} else { %>\n    <li><%= i18n('removal_confirm_vms_not_migrated') %></li>\n    <%}%>\n    <li><%= i18n('removal_confirm_host_detached') %></li>\n    <% if (showLicMsg) { %>\n    <li>\n      <%= i18ns('removal_confirm_license_unused', licenseType, helpLink) %>\n    </li>\n    <% } %>\n    <% if (showBlockAwareness) { %>\n    <li>\n      <%= i18n('removal_confirm_ba') %>\n    </li>\n    <% } %>\n    <% if (showRackAwareness) { %>\n    <li>\n      <%= i18n('removal_confirm_ra') %>\n    </li>\n    <% } %>\n    <% if (showGpuMsg) { %>\n    <li>\n      <%= i18ns('removal_confirm_gpus_vms',\n      '<span class=\"certain-vm-msg\" data-toggle=\"popover\"><a>' +\n        i18n('certain_vms') + '</a></span>') %>\n    </li>\n    <% } %>\n  </ul>\n</div>"}),define("views/popups/hardwareadmin/RemoveHostPopupView",["backbone","views/basecomponents/popups/BasePopupView","text!templates/popups/hardwareadministration/RemoveHostConfirmView.html","data/DataProperties","utils/AppConstants","utils/AppUtil","utils/GpuUtil","utils/HypervisorUtil","utils/CommonTemplates","managers/NavigationManager","managers/NotificationManager","managers/TaskManager","managers/ClusterManager","managers/LicenseManager","managers/HelpManager","models/hardware/HostModel"],function(e,t,n,i,s,a,o,r,l,c,d,p,u,h,m,f){"use strict";var v=_.template(n),g=f.extend({name:"RemoveHostMode",showErrorNotification:function(e,t,n){var i=a.processAjaxError(n.responseText);d.hideLatencyAction(e,t),d.showClientNotification(s.NOTIFY_ERROR,this.processMessage(i))},processMessage:function(e){return"Removing this node can cause replication requirements to be unmet. Use the 'force' option to forcefully mark this host for removal."===e?this.i18n("replication_requirements_unmet"):"There are some powered on VMs on this node. Its not safe to mark this node for removal. Use 'force' option to override."===e?this.i18n("uvm_found"):e}});return t.extend({el:"#popupHardware",name:"RemoveHostPopupView",show:function(e){this.actionRoute=e,e[s.NAV_ACTION]===s.ACTION_REMOVE&&this.renderRemove(e)},destroy:function(){$(".certain-vm-msg").popover("destroy"),t.prototype.destroy.apply(this,arguments)},renderRemove:function(e){var t=this,n=[];e.actionTargetId&&n.push(e.actionTargetId),o.nonLiveMigratablePoweredOnUserVms(s.HYPERVISOR_TYPE.KVM,n).fetch().done(function(n){t._showPopup(n.length,e,n)}).fail(function(){t._showPopup(!0,e)})},_showPopup:function(e,t,n){var a=this,o=h.getLicenseModel(),c=u.getClusterCollection(),d=m.getHelpUrlForAction({actionTarget:s.ENTITY_LICENSING,action:s.LICENSE_ACTIONS.RECLAIM}),p=o.getLicensedNodeCount()===c.getNodeCount(),f=u.getCurrentClusterModel(),g=f.isFFEnabled(s.FFLAGS.RA_DOMAIN_AWARENESS),E=!1,T=!1;if(g){var C=f.get(i.CLUSTER_FAULT_TOLERANCE_DOMAIN);C===s.RESILIENCY_DOMAIN_TYPE.BLOCK?E=!0:C===s.RESILIENCY_DOMAIN_TYPE.RACK&&(T=!0)}if(this.confirmDelete(t,{extHTML:v(this.vtOptions({isAHV:r.hasKVMOnly(),showBlockAwareness:E,showRackAwareness:T,showLicMsg:p,showGpuMsg:e,licenseType:o.getCategory(),helpLink:l.NEW_TAB_LINK({destUrl:d,content:"reclaim"})}))}),e&&n){var S=n.models;if(S&&S.length){var A=_.map(S,function(e){return e.get(i.EB.VM.VM_NAME)});$(".certain-vm-msg").popover({title:this.i18n("vms"),placement:"left",trigger:"hover",html:!0,container:$("body"),content:function(){return a.getCertainVmPopoverContent(A)}})}}},deleteEntity:function(e,t){if(e===s.ENTITY_HOST){var n=new g({serviceVMId:t});if(n){var i=this;n.startRemove({success:function(e,t){p.fetchOnDemand(),c.showDetailsSummary(),i.hide()}})}}},getCertainVmPopoverContent:function(e){var t="";return _.each(e,function(e){t+="<li>"+e+"</li>"}),'<ul class="indented -compact">'+t+"</ul>"}})}),define("models/genesis/NodeDiscoveryModel",["models/genesis/GenesisBaseModel","utils/AppConstants"],function(e,t){"use strict";var n={FAIL:"fail",PHOENIX:"phoenix",NORMAL:"normal"};return e.extend({name:"NodeDiscoveryModel",methodName:t.CLUSTER_MANAGER_METHODS.NODE_DISCOVERY,managerName:t.GENESIS.CLUSTER_MANAGER,setRPCParams:function(e){_.extend(this.kwargs,{node_uuid:e})},getDiscoveryStatus:function(){var e=this.getReturnResponse();return!1===e[0]?n.FAIL:!0===e[0]&&void 0!==e[1]?e[1]:null},getDiscoveryError:function(){var e=this.getReturnResponse();return!1===e[0]?e[1]:null}},{DISCOVER_STATUS:n})}),define("models/genesis/BootDiskRepairModel",["models/genesis/GenesisBaseModel","utils/AppConstants"],function(e,t){"use strict";return e.extend({name:"BootDiskRepairModel",methodName:t.CLUSTER_MANAGER_METHODS.NODE_BOOTDISK_REPAIR,managerName:t.GENESIS.CLUSTER_MANAGER,getErrorResponse:function(){return this.getParsedErrorResponse("Failed to fetch hypervisors types for nodes.")},getTaskId:function(){return this.getReturnResponse()[1]},setRPCParams:function(e,t,n,i,s,a,o,r,l,c,d){var p={},u={};p.node_uuid=e,p.graceful=t,p.host_type=n,!1===t&&i&&(p.iso_md5=i),r&&(p.hyperv_sku=r),s&&(u.ip=s,u.username=a,u.password=o),l&&_.extend(p,{hyperv_param:{username:l,password:c,failover_cluster_name:d}}),_.extend(this.kwargs,{node_param:p,mgmt_server_credentials:u})}})}),define("text!templates/popups/noderepair/NodeSelectView.html",[],function(){return"<div>\n  <div class=\"n-popup-description\">\n    <div class=\"n-desc-title\">\n      <%= i18n('select_host_title') %>\n    </div>\n    <div>\n      <%= i18n('select_host_desc') %>\n      <% if (hasCoNodes) { %>\n        <%= i18n('select_host_desc_co') %>\n      <% } %>\n    </div>\n  </div>\n  <%= Components.select({\n    id: 'node-select',\n    options: hosts,\n    useBrowserSelect: true }) %>\n</div>\n"}),define("views/popups/noderepair/NodeSelectView",["views/basecomponents/BaseSubView","models/hardware/HostCollection","data/DataProperties","utils/HypervisorUtil","text!templates/popups/noderepair/NodeSelectView.html"],function(e,t,n,i,s){"use strict";var a=_.template(s);return e.extend({name:"NodeSelectView",viewOption:null,dataLoaded:!1,hostCollection:null,events:{"change #node-select":"setTargetNode"},initialize:function(){e.prototype.initialize.apply(this,arguments),this.hostCollection=new t},render:function(){var e=this;if(this.dataLoaded){var t=void 0,i=this.hostCollection.map(function(i){var s=i.isComputeOnly();return t=t||s,e.vtOptions({name:i.get(n.NAME),value:i.get(n.UUID),disabled:s})});this.$el.html(a(this.vtOptions({hasCoNodes:t,hosts:i}))),this.$el.find("#node-select").trigger("update"),this.setTargetNode()}else{var s=this;this.$el.html(this.parentView.loadingTemplate(this.vtOptions({msg:this.parentView.LOADING_WAIT_MSG}))),this.hostCollection.fetch({success:function(){s.dataLoaded=!0,s.render(),s.parentView.showButton("next",!0)},error:function(){s.showHeaderError(),s.$el.html("")}})}},destroy:function(){this.clearBaseHeader(),e.prototype.destroy.apply(this,arguments)},setViewOption:function(e){this.viewOption=e},setTargetNode:function(){var e=this.$("#node-select").val();this.parentView.targetNodeId=e;var t=_.find(this.hostCollection.models,function(t){return t.get(n.UUID)===e},this);this.parentView.targetNodeId=e,this.parentView.targetHypervisorType=t?i.getHypervisorSoftwareType(t.get(n.HYPERVISOR_TYPE)):null,this.parentView.targetCVMip=t.get(n.SERVICE_VM_IP)}})}),define("models/genesis/PhoenixIsoPathModel",["models/genesis/GenesisBaseModel","utils/AppConstants"],function(e,t){"use strict";return e.extend({name:"BootDiskRepairModel",methodName:t.CLUSTER_MANAGER_METHODS.GET_PHOENIX_ISO_PATH,managerName:t.GENESIS.CLUSTER_MANAGER,getErrorResponse:function(){return this.getParsedErrorResponse("Failed to fetch the Phoenix ISO location.")},getIP:function(){return this.getReturnResponse()[0]},getFilename:function(){return this.getReturnResponse()[1]},setRPCParams:function(e){var t={};t.assign_ip=e.cvmIpAddress,_.extend(this.kwargs,t)}})}),define("text!templates/popups/noderepair/PhoenixImageView.html",[],function(){return'<div>\n  <div class="n-popup-description">\n    <div class="n-desc-title">\n      <%= i18n(\'download\') %>\n    </div>\n    <div>\n      <%= i18n(\'phoenixHelp\') %>\n    </div>\n  </div>\n  <div class="image-link">\n    <div class="software-list-ctr">\n      <%= softwareRow %>\n    </div>\n  </div>\n</div>'}),define("views/popups/noderepair/PhoenixImageView",["utils/AppConstants","managers/ActionManager","models/genesis/PhoenixIsoPathModel","views/basecomponents/BaseSubView","text!templates/popups/noderepair/PhoenixImageView.html"],function(e,t,n,i,s){"use strict";var a=_.template(s);return i.extend({name:"PhoenixImageView",viewOption:null,model:null,dataLoaded:!1,events:{"click .btn-download":"onClickLinkAction"},initialize:function(){this.model=new n,i.prototype.initialize.apply(this,arguments)},render:function(){var t=this;if(this.dataLoaded){var n=this.model.getIP(),i=e.DOWNLOADS_PATH,s=this.model.getFilename(),o=window.location.protocol+"//"+n+":"+window.location.port+window.location.pathname+i+"/"+s;this.$el.html(a(this.vtOptions({softwareRow:this.parentView.softwareRowTemplate({name:s,progressTemplate:"",cancelIcon:"",uploadComplete:!0,action:e.ACTION_DOWNLOAD,actionTarget:e.FILE_PHOENIX_IMAGE,actionTargetId:o,buttonClass:"btn-download",actionText:"Download"})})))}else{this.$el.html(this.parentView.loadingTemplate({msg:this.parentView.LOADING_WAIT_MSG}));var r=this.parentView.targetCVMip;r&&this.model.setRPCParams({cvmIpAddress:r}),this.model.fetch({success:function(){t.dataLoaded=!0,t.render()},error:function(){t.parentView.showHeaderError(t.model.getErrorResponse())}})}},destroy:function(){this.clearBaseHeader(),i.prototype.destroy.apply(this,arguments)},onClickLinkAction:function(e){t.executeActionElement($(e.currentTarget))},setViewOption:function(e){this.viewOption=e}})}),define("text!templates/popups/noderepair/SoftwareSelectView.html",[],function(){return'<div>\n  <div class="n-popup-description">\n    <div class="n-desc-title">Upload Hypervisor Installer</div>\n    <div>\n      Please select the <%= hypervisorName %> software from the list below or\n      upload a file from your computer to proceed.\n    </div>\n  </div>\n  <div class="software-list">\n    <div class="n-list-title">\n      Available Installers\n    </div>\n    <div class="software-list-ctr">\n      <div class="n-inline-loading-container">\n        <div class="n-inline-loading" style="display:block">\n        </div>\n      </div>\n    </div>\n  </div>\n  <div class="n-upload-form-container">\n    <form class="form-horizontal form-iso-upload">\n      <div class="n-upload-success" style="display:none">\n        <div class="status-icon"><%= checkIcon %></div>\n        <span class="n-upload-msg"></span>\n      </div>\n      <div class="control-group">\n        <label class="control-label">\n          Upload Hypervisor Binary File\n        </label>\n        <div class="controls">\n          <input type="file" name="file" class="input-iso">\n          <div class="n-upload-progress" style="display:none">\n            <div class="n-inline-loading-container">\n              <div class="n-inline-loading" style="display:block">\n              </div>\n            </div>\n            <span class="progress-msg">\n              Computing MD5 sum...\n            </span>\n          </div>\n        </div>\n      </div>\n    </form>\n  </div>\n</div>'}),define("views/popups/noderepair/SoftwareSelectView",["data/DataProperties","data/DataManager","managers/IdleManager","views/basecomponents/BaseSubView","utils/AppConstants","utils/AppUtil","utils/SVG","utils/HypervisorUtil","utils/VisualizationUtil","data/DataURLConstants","models/softwareupgrade/SoftwareReleaseCollection","text!templates/popups/noderepair/SoftwareSelectView.html"],function(e,t,n,i,s,a,o,r,l,c,d,p){"use strict";var u=_.template(p);return i.extend({viewOption:null,jqXhr:null,softwareReleaseId:null,dataLoaded:!1,softwareType:s.UPGRADE_SOFTWARE_TYPE_ADD_NODE.HYPERVISOR_INSTALLER,events:{"change .input-iso":"uploadISO","click  .input-iso":"resetInputFile","click  .cancel-btn":"cancelUpload"},modelEvents:{"reset model":"renderUploadProgress"},initialize:function(e){i.prototype.initialize.apply(this,arguments),this.softwareType=e.softwareType||this.softwareType,this.model=new d(null,{softwareType:this.softwareType}),this.delegateModelEvents()},render:function(){var e=this,t=r.getFormattedHypervisorType(this.parentView.getTargetHypervisorType());this.$el.html(u({hypervisorName:t,checkIcon:o.SVGIcon("G","check-icon",""),cancelIcon:o.SVGIcon("K","cancel-icon","")})),this.dataLoaded?(this.clearBaseHeader(),this.parentView.disableButton("main")):this.model.fetch({success:function(){e.dataLoaded=!0,e.renderSoftwareReleases()},error:function(){a.log("SoftwareSelectView : Failed to fetch software release collection."),e.dataLoaded=!0,e.render()}})},destroy:function(){this.jqXhr&&this.jqXhr.abort(),this.clearBaseHeader(),this.model.stopPollingSoftwareReleases({force:!0}),i.prototype.destroy.apply(this,arguments)},refreshView:function(){this.render()},setViewOption:function(e){this.viewOption=e},renderSoftwareReleases:function(){var t="";this.model.each(function(n){var i=n.get(e.UPGRADE_CURRENT_SIZE_IN_BYTES),a=n.get(e.UPGRADE_CURRENT_TOTAL_IN_BYTES),r=Math.round(i/a*100),c="";if(n.get(e.UPGRADE_STATUS)===s.UPGRADE_SOFTWARE_RELEASE_STATUS.COMPLETE||a===i||n.get(e.UPGRADE_MD5SUM)===this.softwareReleaseId){var d=status===s.TASK_STATUS_FAILED||status===s.TASK_STATUS_CANCELED||status===s.TASK_STATUS_ABORTED;c=l.renderProgressBar({barClass:"n-progress-bar "+(d?"error":""),percentUsed:r,rightTextLabel:r+"%"}),t+=this.parentView.softwareRowTemplate({name:n.get(e.UPGRADE_NAME),progressTemplate:c,cancelIcon:o.SVGIcon("K","cancel-icon",""),uploadComplete:a===i,action:s.ACTION_REPAIR,actionTarget:"",actionTargetId:n.get(e.UPGRADE_MD5SUM),buttonClass:"btn-repair",actionText:"Proceed"})}},this),this.$(".software-list-ctr").html(t||'<div class="no-software">No software available.</div>')},renderUploadSuccess:function(e){this.$(".n-upload-success").show(),this.$(".n-upload-progress").hide(),this.$(".n-upload-msg").html("Successfully uploaded file: "+e),this.parentView.enableButton("main")},renderUploadStart:function(){this.clearBaseHeader(),this.$(".n-upload-progress").show(),this.$(".n-upload-success").hide()},renderUploadProgress:function(e){if(this.dataLoaded){var t=(this.$(".form-iso-upload"),"");!0===e?t="Computing MD5 sum...":(this.renderSoftwareReleases(),t="Uploading file..."),this.$(".progress-msg").html(t),n.reset()}},renderUploadError:function(e){this.$(".n-upload-progress").hide(),this.parentView.showHeaderError("Error uploading file: "+e)},resetInputFile:function(e){$(e.currentTarget).val(null)},getSoftwareHypervisorType:function(e){switch(e){case s.SOFTWARE_RELEASES_HYP_TYPE.KVM:return s.SOFTWARE_RELEASES_HYP_TYPE.AHV;default:return e}},_startUpload:function(n,i,s,o){if("undefined"==typeof File)return a.log("NodeConversionPopupView : Upload software via legacy browser."),void("function"==typeof o&&o(a.uploadCheck()));var r=n.name,l=0,d=this.model.find(function(t){return t.get(e.UPGRADE_MD5SUM)===this.softwareReleaseId},this);l=d?d.get(e.UPGRADE_CURRENT_SIZE_IN_BYTES):0;var p={fileName:r,fileSize:n.size,offset:l,md5Sum:i,hypervisorType:this.getSoftwareHypervisorType(this.parentView.getTargetHypervisorType()),overwrite:!0};p=a.formatObjectToQuery(p);var u=t.getFormattedURL(_.template(c.UPGRADE_UPLOAD,{id:encodeURI(r),params:p,type:this.softwareType}));return this.$(".n-upload-progress").hide(),a.uploadBinaryFile({type:"POST",url:u,data:n,offset:l},function(e){a.log("SoftwareSelectView : Successfully Uploaded the file!"),"function"==typeof s&&s(r)},function(e,t,n){if("abort"===n)return void a.log("SoftwareSelectView : Upload was aborted.");var i=e.status+" "+n+" "+a.processAjaxError(e.responseText);a.log("SoftwareSelectView : Error in uploading file: "+n+" | "+a.processAjaxError(e.responseText)+" | "+e.status),"function"==typeof o&&o(i)})},setSoftwareReleaseId:function(e){this.softwareReleaseId=e},uploadISO:function(e){var t=this.$(".form-iso-upload"),n=t[0].file.files[0],i=(n&&n.name,this);n?(this.parentView.disableButton("main"),this.parentView.setUploadInProgress(!0),this.renderUploadStart(),this.renderUploadProgress(!0),this.jqXhr&&this.jqXhr.abort(),a.calculateFileMD5Async(n,{},function(e){i.setSoftwareReleaseId(e),i.jqXhr=i._startUpload(n,e,function(e){i.renderUploadSuccess(e),i.parentView.setISOUploaded(),i.jqXhr=null,i.model.stopPolling({force:!0}),i.parentView.setUploadInProgress(!1),i.model.fetch()},function(e){i.renderUploadError(e),i.model.stopPolling({force:!0}),i.parentView.setUploadInProgress(!1),i.model.fetch()}),i.model.startPolling({force:!0}),i.renderUploadProgress()})):this.showHeaderError("Please select a file to upload.")},cancelUpload:function(){this.jqXhr&&(this.jqXhr.abort(),this.softwareReleaseId=null,this.$(".n-upload-progress").hide(),this.$('.form-iso-upload input[type="file"]').val(""),this.parentView.setUploadInProgress(!1),this.model.stopPolling({force:!0}),this.model.fetch())}})}),define("views/popups/noderepair/ProgressView",["data/DataProperties","managers/TaskManager","views/basecomponents/BaseSubView","utils/VisualizationUtil","text!templates/popups/nodeconversion/ProgressView.html"],function(e,t,n,i,s){"use strict";var a=_.template('<div><div id="task-progress" class="n-task-progress-view"></div></div>'),o=_.template(s);return n.extend({name:"NodeRepairProgressView",viewOption:null,subtasksOpen:!1,events:{"click  .expand-trigger":"toggleSubTasks"},updateProgressCallback:null,initialize:function(e){n.prototype.initialize.apply(this,arguments),this.updateProgressCallback=this.renderTaskProgress.bind(this),t.registerHandlerForChangedTasks(this.updateProgressCallback)},render:function(){this.viewOption.headerInfoMsg?this.parentView.showHeaderInfo(this.viewOption.headerInfoMsg):this.clearBaseHeader(),this.$el.html(a()),this.viewOption.refreshView&&this.$("#task-progress").html(""),this.renderTaskProgress(),t.fetchOnDemand({force:!0})},destroy:function(){this.clearBaseHeader(),this.off(),t.unregisterHandlerForChangedTasks(this.updateProgressCallback),n.prototype.destroy.apply(this,arguments)},refreshView:function(){this.render()},setViewOption:function(e){this.viewOption=e},renderTaskProgress:function(){var t=this.parentView.getTask(this.parentView.targetNodeId,this.viewOption.taskType);if(t){this.clearBaseHeader();var n=t.get(e.TASK_MESSAGE)||t.get(e.SUB_TASK_MESSAGE)||this.viewOption.taskTitle;this.$("#task-progress").html(o({title:n,task:t,VisualizationUtil:i,propStatus:e.TASK_STATUS,propPercentComplete:e.TASK_PERCENT_COMPLETE,propTaskMessage:e.SUB_TASK_MESSAGE,propSubTasks:e.TASK_SUB_TASKS,collapsible:t.get(e.TASK_SUB_TASKS)&&t.get(e.TASK_SUB_TASKS).length,showMasterProgressBar:!0,collapsed:!this.subtasksOpen})),t.isStatusComplete()?this.trigger(this.parentView.TASK_COMPLETE_EVENT,{taskType:this.viewOption.taskType,taskModel:t}):(t.isStatusFailed()||t.isStatusAborted())&&this.trigger(this.parentView.TASK_FAILED_EVENT,this.viewOption.taskType)}else this.viewOption.showWaitMsg&&this.$("#task-progress").html(this.parentView.loadingTemplate({msg:this.viewOption.showWaitMsg}))},toggleSubTasks:function(e){var t=$(e.currentTarget),n=this.$(".subtasks");n.is(":visible")?(n.slideUp("fast"),t.html("open"),this.subtasksOpen=!1):(n.slideDown("fast"),t.html("close"),this.subtasksOpen=!0)}})}),define("text!templates/popups/noderepair/BootDiskSnapshotView.html",[],function(){return'<div>\n  <div class="n-popup-description">\n    <div class="n-desc-title">\n      Restore from current disk\n    </div>\n    <div>\n      The boot disk seems to be functioning properly. However, you can still\n      replace the boot disk and restore the data on the current disk from a\n      snapshot.\n    </div>\n    <div id="graceful-msg" class="snapshot">\n      <div class="n-warning-msg snapshot">\n        Please note: in case the data on the existing boot disk is\n        corrupted, restoring a snapshot of this disk could lead to\n        errors in the data on the new disk.\n      </div>\n      <div class="normal">\n        Please make sure you have replaced the boot disk before proceeding.\n      </div>\n    </div>\n  </div>\n  <div class="replace-option">\n    <div>\n      <input type="radio" id="option-snapshot" class="n-radio"\n             data-test="" name="replace-option"\n             value="snapshot"\n             checked>\n      <label class="description" for="option-snapshot">\n        Restore boot disk data from snapshot\n      </label>\n    </div>\n    <div>\n      <input type="radio" id="option-normal" class="n-radio"\n             data-test="" name="replace-option"\n             value="normal">\n      <label class="description" for="option-normal">\n        Continue without snapshot\n      </label>\n    </div>\n  </div>\n</div>'}),define("views/popups/noderepair/BootDiskSnapshotView",["views/basecomponents/BaseSubView","text!templates/popups/noderepair/BootDiskSnapshotView.html"],function(e,t){"use strict";var n=_.template(t);return e.extend({name:"NodeSelectView",viewOption:null,dataLoaded:!1,events:{'change input[type="radio"]':"onRadioClick"},initialize:function(){e.prototype.initialize.apply(this,arguments)},render:function(){this.$el.html(n()),this.applyNutanixInput()},destroy:function(){this.clearBaseHeader(),e.prototype.destroy.apply(this,arguments)},setViewOption:function(e){this.viewOption=e},onRadioClick:function(e){var t=this.$('input[name="replace-option"]:checked').val();this.$("#graceful-msg").removeClass().addClass(t)}})}),define("text!templates/popups/noderepair/BootDiskRepairPopupView.html",[],function(){return'\x3c!-- The parent div is #popupNodeConvert --\x3e\n<div class="modal-header">\n  <button type="button" class="close" data-dismiss="modal"\n          id="node-convert-popup-close">\n    <i data-icon="K" aria-hidden="true"></i>\n  </button>\n  <h4 class="n-title">\n    <%= i18n(\'main_title\') %>\n  </h4>\n</div>\n<div class="n-modal-wrapper">\n  <div class="n-modal-body">\n    <div class="n-modal-content-wrapper">\n      <div class="n-modal-alert-header">\n        \x3c!-- @view: alert goes here... --\x3e\n      </div>\n      <div class="n-modal-content n-modal-node-repair-content"\n           id="node-repair-main">\n        \x3c!-- Loading sub view --\x3e\n        <div class="loading">\n          <%= loaderTemplate %>\n        </div>\n        \x3c!-- @view: dynamic subviews go here... --\x3e\n      </div>\n    </div>\n  </div>\n  <div class="n-modal-footer">\n    \x3c!-- Form buttons --\x3e\n    <button class="btn-back btn n-btn-form" style="display:none;"\n            action="previous">\n      <%= i18n(\'back\') %>\n    </button>\n    <button class="btn-cancel btn n-btn-form">\n      <%= i18n(\'cancel\') %>\n    </button>\n    <button class="btn-next btn n-btn-form" style="display:none"\n            action="next">\n     <%= i18n(\'next\') %>\n    </button>\n    <button class="btn-close btn n-btn-form -blue" style="display:none">\n      <%= i18n(\'close\') %>\n    </button>\n    <button class="btn-save btn-main btn btn-primary n-btn-form"\n            style="display:none;"\n            data-loading-text="Saving..." action="repair">\n      <%= i18n(\'repair\') %>\n    </button>\n  </div>\n</div>\n'}),define("text!templates/popups/noderepair/SoftwareRowTemplate.html",[],function(){return'<div class="software-row">\n  <div class="software-name" title="<%- name %>">\n    <%- name %>\n  </div>\n  <div class="software-progress <%= uploadComplete ? \'upload-complete\' : \'\' %>">\n    <div class="progress-ctr">\n      <%= progressTemplate %>\n    </div>\n    <div class="cancel-btn" title="Cancel Upload">\n      <%= cancelIcon %>\n    </div>\n  </div>\n  <button class="btn -blue <%= buttonClass %>"\n       action="<%= action %>"\n       actionTarget="<%= actionTarget %>"\n       actionTargetId="<%= actionTargetId %>"\n       <%= !uploadComplete ? \'disabled\' : \'\'%>>\n    <%- actionText %>\n  </button>\n</div>'}),define("text!templates/popups/noderepair/HyperVAuthTemplate.html",[],function(){return'<div>\n  <label class="n-popup-captcha-error"></label>\n</div>\n<div>\n  <label class="n-popup-title">\n    Domain Username (Domain\\Username):\n  </label>\n  <input class="username-domain n-popup-fields"\n         type="text" value>\n</div>\n<div>\n  <label class="n-popup-title">\n    Domain Password:\n  </label>\n  <input class="password-domain n-popup-fields"\n         type="password" autocomplete="off" value>\n</div>\n<div>\n  <label class="n-popup-title">\n    Failover Cluster Name:\n  </label>\n  <input class="failover-cluster n-popup-fields"\n         type="text" autocomplete="off" value>\n</div>'}),define("views/popups/noderepair/BootDiskRepairPopupView",["views/basecomponents/popups/BasePopupView","data/DataProperties","utils/AppConstants","utils/SubViewHelper","utils/HypervisorUtil","managers/TaskManager","managers/NotificationManager","models/genesis/NodeDiscoveryModel","models/genesis/BootDiskRepairModel","models/genesis/LaJollaClusterModel","views/popups/noderepair/NodeSelectView","views/popups/noderepair/PhoenixImageView","views/popups/noderepair/SoftwareSelectView","views/popups/noderepair/ProgressView","views/popups/noderepair/BootDiskSnapshotView","text!templates/popups/noderepair/BootDiskRepairPopupView.html","text!templates/popups/noderepair/SoftwareRowTemplate.html","text!templates/popups/softwareupgrade/HypervisorAuthenticationTemplate.html","text!templates/popups/noderepair/HyperVAuthTemplate.html"],function(e,t,n,i,s,a,o,r,l,c,d,p,u,h,m,f,v,g,E){"use strict"
;var T=_.template(f),C=_.template('<div class="n-loading"><div class="n-inline-loading-container"><div class="donut-loader-blue -large"></div><div class="n-loading-msg"><strong><%= msg %></strong></div></div></div>'),S=_.template(v),A=_.template(g),b=_.template('<div><label class="n-popup-title">SKU:</label><div><select class="hyperv-sku n-popup-fields"data-class="fancy-select-bottom-anchor"><option value="free">Free</option><option value="standard">Standard</option><option value="datacenter">Datacenter</option><option value="standard_gui">Standard GUI</option><option value="datacenter_gui">Datacenter GUI</option></select></div></div>');return e.extend({SUBVIEW:{SELECT_NODE:"select-node",PHOENIX_IMAGE:"phoenix-img",HYPERVISOR_UPLOAD:"iso-upload",PROGRESS:"task-progress",SNAPSHOT:"snapshot"},TASK_COMPLETE_EVENT:"taskComplete",TASK_FAILED_EVENT:"taskFail",TASK_TYPE:{SNAPSHOT:0,REPAIR:1,PRECHECK:2},DISCOVER_STATUS:{FAIL:"fail",PHOENIX:"phoenix",NORMAL:"normal"},LAJOLLA_SKU:"lajolla",LOADING_WAIT_MSG:"Loading. Please wait...",DISK_REPLACE_WAIT_MSG:"Detecting new boot disk. Please wait...",name:"BootDiskRepairPopupView",subViewHelper:null,el:"#popupNodeRepair",currentSubViewId:null,loadingTemplate:C,softwareRowTemplate:S,targetNodeId:null,targetHypervisorType:null,isoUploadRequired:!1,uploadInProgress:!1,nodeDiscoveryModel:null,bootDiskRepairModel:null,laJollaClusterModel:null,precheckTaskId:null,events:{"click  .modal-header .close":"hide","click  .btn-cancel":"hide","click  .btn-close":"hide","click  .btn-save":"onClickLinkAction","click  .btn-next":"onClickLinkAction","click  .btn-back":"onClickLinkAction","click  .btn-main":"onClickLinkAction","click  .btn-repair":"onClickLinkAction","click  .btn-validate":"onClickLinkAction","click  .action-icon":"onClickLinkAction"},initialize:function(){e.prototype.initialize.apply(this,arguments),this.subViewHelper=new i,this.nodeDiscoveryModel=new r,this.bootDiskRepairModel=new l,this.laJollaClusterModel=new c},render:function(){return this.$el.html(T(this.vtOptions({loaderTemplate:this.loadingTemplate({msg:this.LOADING_WAIT_MSG})}))),this.targetNodeId=this.actionRoute[n.NAV_ACTION_TARGET_ID],this.targetHypervisorType=s.getHypervisorSoftwareType(this.actionRoute[n.NAV_ACTION_TARGET_NAME]),this.laJollaClusterModel.fetch({success:_.bind(this.renderSubview,this),error:_.bind(function(){this.showHeaderError(this.laJollaClusterModel.getParsedErrorResponse())},this)}),this},renderSubview:function(){this.targetNodeId?this.isSnapshotProgress(this.targetNodeId)?this.showSnapshotProgressView():this.isRepairProgress(this.targetNodeId)?this.showRepairProgressView():!this.isSnapshotSuccess(this.targetNodeId)||this.isRepairProgress(this.targetNodeId)||this.isRepairComplete(this.targetNodeId)?this.discoverNode():this.showPhoenixView():this.selectSubView({subViewId:this.SUBVIEW.SELECT_NODE})},dispose:function(){e.prototype.hide.apply(this,arguments),this.subViewHelper.destroy(),this.model&&this.model.destroyAll()},isUploadInProgress:function(){return this.uploadInProgress},selectSubView:function(e){this.hideLoadingWait();var t,n;t=this.subViewHelper.get(this.currentSubViewId),t&&t.hideView(),n=e.subViewId,t=this.subViewHelper.get(n),this.currentSubViewId=n;var i=e.options||{};if(t)t.setViewOption(i);else{$('<div id="'+n+'"></div>').appendTo(".n-modal-node-repair-content"),t=this.createSubView(n),this.subViewHelper.register(this.currentSubViewId,t),t.setParentView(this),t.setViewOption(i),t.render()}this._showSubView(t)},_showSubView:function(e){e&&(e.refreshView(),e.showView())},onViewTransition:function(e){var t=this.subViewHelper.get(this.currentSubViewId);if(t){var n=_.bind(function(){this.selectSubView(e)},this);t.saveViewData(n,e)}},showLoadingWait:function(){var e=this.subViewHelper.get(this.currentSubViewId);e&&e.hideView(),this.$(".loading").show()},hideLoadingWait:function(){this.$(".loading").hide()},onClickLinkAction:function(e){var t=$(e.currentTarget),i=t.attr(n.NAV_ACTION);if(i===n.ACTION_NEXT)this.currentSubViewId===this.SUBVIEW.SNAPSHOT?this.initiateSnapshot():(this.clearHeader(),this.isSnapshotSuccess(this.targetNodeId)&&this.currentSubViewId!==this.SUBVIEW.PHOENIX_IMAGE?this.showPhoenixView():this.isSnapshotSuccess(this.targetNodeId)&&this.isRepairProgress(this.targetNodeId)&&this.currentSubViewId===this.SUBVIEW.PHOENIX_IMAGE?this.showRepairProgressView(null,this.DISK_REPLACE_WAIT_MSG):this.discoverNode());else if(i===n.ACTION_REPAIR){var s=$(e.currentTarget).attr(n.NAV_ACTION_TARGET_ID);this.initiateBootDiskRepair(s)}},createSubView:function(e){var t,n={el:"#"+e,model:this.model};switch(e){case this.SUBVIEW.SELECT_NODE:t=new d(n);break;case this.SUBVIEW.PHOENIX_IMAGE:t=new p(n);break;case this.SUBVIEW.HYPERVISOR_UPLOAD:t=new u(n);break;case this.SUBVIEW.PROGRESS:t=new h(n),t.on(this.TASK_COMPLETE_EVENT,function(e){this.onTaskComplete(e)},this),t.on(this.TASK_FAILED_EVENT,function(e){this.onTaskFailed()},this);break;case this.SUBVIEW.SNAPSHOT:t=new m(n)}return t},showButton:function(e,t){var n=".btn-"+e;t?this.$(n).show():this.$(n).hide()},disableButton:function(e){this.$(".btn-"+e).attr("disabled","disabled")},enableButton:function(e){this.$(".btn-"+e).removeAttr("disabled")},discoverNode:function(){var e=this;this.disableButton("next"),this.showLoadingWait(),this.nodeDiscoveryModel.setRPCParams(this.targetNodeId),this.nodeDiscoveryModel.fetch({success:function(){e.showPostDiscoveryView.apply(e)},error:function(t,n){e.showHeaderError(e.nodeDiscoveryModel.getParsedErrorResponse())}})},showPostDiscoveryView:function(){var e=r.DISCOVER_STATUS;switch(this.nodeDiscoveryModel.getDiscoveryStatus()){case e.FAIL:this.showPhoenixView();break;case e.PHOENIX:this.targetHypervisorType===n.SOFTWARE_RELEASES_HYP_TYPE.HYPERV&&this.laJollaClusterModel.getReturnResponse()?this.initiateBootDiskRepair():this.showHypervisorUploadView();break;case e.NORMAL:this.showSnapshotView();break;default:this.showHeaderError("Failed to discover node."),this.hideLoadingWait(),this.showButton("close",!0),this.showButton("cancel",!1)}var t=this.nodeDiscoveryModel.getDiscoveryError();t&&this.showHeaderError(t)},showPhoenixView:function(){this.selectSubView({subViewId:this.SUBVIEW.PHOENIX_IMAGE}),this.$(".btn-next").removeClass("-blue"),this.showButton("next",!0),this.enableButton("next"),this.showButton("main",!1)},showHypervisorUploadView:function(){this.selectSubView({subViewId:this.SUBVIEW.HYPERVISOR_UPLOAD}),this.showButton("next",!1)},showSnapshotView:function(){this.selectSubView({subViewId:this.SUBVIEW.SNAPSHOT}),this.$(".btn-next").addClass("-blue"),this.showButton("next",!0),this.enableButton("next")},showSnapshotProgressView:function(){this.showButton("main",!1),this.showButton("next",!1),this.showButton("close",!0),this.showButton("cancel",!1),this.selectSubView({subViewId:this.SUBVIEW.PROGRESS,options:{taskType:this.TASK_TYPE.SNAPSHOT,taskTitle:"Creating snapshot of boot disk"}})},showPrecheckProgressView:function(e){this.showButton("main",!1),this.showButton("next",!1),this.showButton("close",!0),this.showButton("cancel",!1),this.selectSubView({subViewId:this.SUBVIEW.PROGRESS,options:{taskType:this.TASK_TYPE.PRECHECK,taskTitle:e||"Running pre-check"}})},showRepairProgressView:function(e,t){this.showButton("main",!1),this.showButton("next",!1),this.showButton("close",!0),this.showButton("cancel",!1),this.selectSubView({subViewId:this.SUBVIEW.PROGRESS,options:{taskType:this.TASK_TYPE.REPAIR,taskTitle:"Repairing boot disk",headerInfoMsg:e,showWaitMsg:t}})},onTaskComplete:function(e){var t=e.taskType,n=e.taskModel;switch(t){case this.TASK_TYPE.REPAIR:this.clearHeader(),this.showButton("next",!1),this.showButton("main",!1),this.showButton("cancel",!1),this.showButton("close",!0),this.enableButton("close");break;case this.TASK_TYPE.PRECHECK:this.clearHeader(),this.showButton("next",!0),this.showButton("main",!1),this.showButton("cancel",!1),this.showButton("close",!0),this.enableButton("close"),this.isSnapshotTaskAfter(this.targetNodeId,n)?this.showSnapshotProgressView():this.showRepairProgressView(null,this.LOADING_WAIT_MSG);break;case this.TASK_TYPE.SNAPSHOT:this.clearHeader(),this.showButton("next",!0),this.showButton("main",!1),this.showButton("cancel",!1),this.showButton("close",!0),this.enableButton("close"),this.showPhoenixView()}},onTaskFailed:function(){this.showButton("main",!1),this.showButton("next",!1),this.showButton("cancel",!1),this.showButton("close",!0),this.enableButton("close")},getTask:function(e,i){var s,o=a.getGlobalTasks();switch(i){case this.TASK_TYPE.SNAPSHOT:s=n.TASK_OPERATION_BOOT_DISK_SNAPSHOT;break;case this.TASK_TYPE.PRECHECK:s=n.TASK_OPERATION_BOOT_DISK_PRECHECK;break;default:case this.TASK_TYPE.REPAIR:s=n.TASK_OPERATION_BOOT_DISK_REPAIR}return o.find(function(i){var a=i.get(t.TASK_ENTITY_ID);return a&&"string"!=typeof a&&(a=a[0]),s===n.TASK_OPERATION_BOOT_DISK_PRECHECK&&this.precheckTaskId?i.get(t.TASK_TYPE)===s&&a===e&&i.get(t.ID)===this.precheckTaskId:i.get(t.TASK_TYPE)===s&&a===e},this)},isSnapshotSuccess:function(e){var t=this.getTask(e,this.TASK_TYPE.SNAPSHOT);return t&&t.isStatusComplete()},isSnapshotProgress:function(e){var t=this.getTask(e,this.TASK_TYPE.SNAPSHOT);return t&&(t.isStatusActive()||t.isStatusQueued())},isSnapshotTaskAfter:function(e,n){var i=this.getTask(e,this.TASK_TYPE.SNAPSHOT);return i&&i.get(t.TASK_CREATE_TIME)>n.get(t.TASK_CREATE_TIME)},isRepairProgress:function(e){var t=this.getTask(e,this.TASK_TYPE.REPAIR);return t&&(t.isStatusActive()||t.isStatusQueued())},isRepairComplete:function(e){var t=this.getTask(e,this.TASK_TYPE.REPAIR);return t&&(t.isStatusComplete()||t.isStatusFailed()||t.isStatusAborted())},initiateSnapshot:function(){var e=this;this.$("#option-snapshot").is(":checked")?this._confirmAndSubmitOperation("Once the snapshot of the current disk is complete please replace the boot disk with a new one. Are you sure you wish to proceed?",!0,function(t,n,i,s,r,l,c){e.showLoadingWait();var d=o.showLatencyMessage("Submitting operation to create a snapshot of the current boot disk...");e.showLoadingWait(),e.targetHypervisorType?(e.bootDiskRepairModel.setRPCParams(e.targetNodeId,!0,e.targetHypervisorType,null,i,t,n,s,r,l,c),e.bootDiskRepairModel.fetch({success:function(){o.hideLatencyMessage(d),e.precheckTaskId=e.bootDiskRepairModel.getTaskId(),a.fetchOnDemand({success:function(){e.clearHeader(),e.showPrecheckProgressView()},error:function(){e.showHeaderError("Error fetching tasks."),e.showPrecheckProgressView()}})},error:function(t,n){o.hideLatencyMessage(d),e.showHeaderError(n),e.showButton("main",!0),e.enableButton("main")}})):e.showHeaderError("Unknown target hypervisor type.")}):(this.clearHeader(),this.showPhoenixView())},initiateBootDiskRepair:function(e){var t=this;this.disableButton("main"),this._confirmAndSubmitOperation("Are you sure you wish to repair the boot disk for this node?",!1,function(n,i,s,r,l,c,d){t.showLoadingWait();var p=o.showLatencyMessage("Submitting operation to repair boot device...");t.targetHypervisorType?(t.bootDiskRepairModel.setRPCParams(t.targetNodeId,!1,t.targetHypervisorType,e,s,n,i,r,l,c,d),t.bootDiskRepairModel.fetch({success:function(){o.hideLatencyMessage(p),t.precheckTaskId=t.bootDiskRepairModel.getTaskId(),a.fetchOnDemand({success:function(){t.clearHeader(),t.showPrecheckProgressView()},error:function(){t.showHeaderError("Error fetching tasks."),t.showPrecheckProgressView()}})},error:function(e,n){o.hideLatencyMessage(p),t.showHeaderError(n),t.showButton("main",!0),t.enableButton("main")}})):t.showHeaderError("Unknown target hypervisor type.")})},_confirmAndSubmitOperation:function(e,t,i){var s="",a=!1;this.targetHypervisorType===n.SOFTWARE_RELEASES_HYP_TYPE.ESXI?(s=A({serverDetails:"vCenter IP Address:"}),a=!0):this.targetHypervisorType===n.SOFTWARE_RELEASES_HYP_TYPE.HYPERV&&(t||(s+=E,this.laJollaClusterModel.getReturnResponse()||(s+=b()))),$.nutanixConfirm({msg:e,yes:function(){var e=null,t=null,s=null,o=null,r=null,l=null,c=null;if(a&&(e=$("#nutanixConfirmModal .username-auth").val().trim(),t=$("#nutanixConfirmModal .password-auth").val().trim(),s=$("#nutanixConfirmModal .host-details").val().trim()),this.targetHypervisorType===n.SOFTWARE_RELEASES_HYP_TYPE.HYPERV){r=($("#nutanixConfirmModal .username-domain").val()||"").trim(),l=($("#nutanixConfirmModal .password-domain").val()||"").trim(),c=($("#nutanixConfirmModal .failover-cluster").val()||"").trim();var d=$("#nutanixConfirmModal .hyperv-sku");d.length&&(o=d.val()),this.laJollaClusterModel.getReturnResponse()&&(o=this.LAJOLLA_SKU)}i(e,t,s,o,r,l,c)},yesText:n.LABEL_YES,noText:n.LABEL_NO,extHTML:s,captcha:function(){var e=!1;if(a){var i=$("#nutanixConfirmModal .username-auth").val().trim(),s=$("#nutanixConfirmModal .password-auth").val().trim(),o=$("#nutanixConfirmModal .host-details").val().trim();e=_.isEmpty(i)||_.isEmpty(s)||_.isEmpty(o)}var r=!1;if(this.targetHypervisorType===n.SOFTWARE_RELEASES_HYP_TYPE.HYPERV&&!t){var l=($("#nutanixConfirmModal .username-domain").val()||"").trim(),c=($("#nutanixConfirmModal .password-domain").val()||"").trim(),d=($("#nutanixConfirmModal .failover-cluster").val()||"").trim();r=_.isEmpty(l)||_.isEmpty(c)||_.isEmpty(d)}return!e&&!r||($("#nutanixConfirmModal .n-popup-captcha-error").html("All fields are required.").show(),!1)},context:this}),$("#nutanixConfirmModal .hyperv-sku").fancySelect(),$("#nutanixConfirmModal .n-modal-body").addClass("vscroll")},isISOUploadRequired:function(){return this.isoUploadRequired},setISOUploaded:function(){this.isoUploadRequired=!1},setUploadInProgress:function(e){this.uploadInProgress=e},getTargetHypervisorType:function(){return this.targetHypervisorType}})}),define("text!templates/popups/hardwareadministration/IPConfigurationGroup.html",[],function(){return'\x3c!-- This is an HTML templat that represents an individual IP configuration UI --\x3e\n\x3c!-- Range --\x3e\n<h5 data-ntnx-title class="label-main">\n  <i class="icon-ip-details" data-icon="z" aria-hidden="true"\n     title="Click to enter individual IP addresses"></i>\n\n  <span class="group-name">\n    <span class="group-name-title">\n      <%= groupName %>\n    </span>\n  </span>\n</h5>\n\n\x3c!-- Individual hosts --\x3e\n<div class="ip-host-panel">\n  <div class="ip-host-row ip-range-master-container clearfix">\n    <% if (showRange) { %>\n      <input type="text" maxlength="3"\n             class="ip-range-value ip-range-value-master"\n             data-group="<%= groupId %>" data-ipindex="0" >\n      <span class="ip-range-separator"></span>\n      <input type="text" maxlength="3"\n             class="ip-range-value ip-range-value-master"\n             data-group="<%= groupId %>" data-ipindex="1" >\n      <span class="ip-range-separator"></span>\n      <input type="text" maxlength="3"\n             class="ip-range-value ip-range-value-master"\n             data-group="<%= groupId %>" data-ipindex="2" >\n      <span class="ip-range-separator"></span>\n      <input type="text" maxlength="3"\n             class="ip-range-value ip-range-value-master"\n             data-group="<%= groupId %>" data-ipindex="3" >\n      <span class="ip-range-label">to</span>\n      <input type="text" disabled="disabled" maxlength="3"\n             class="ip-range-value ip-range-end" data-group="<%= groupId %>">\n  <% } %>\n  </div>\n  <% _.each( sorted_node_titles, function(nodeTitleTuple) {  %>\n    <% if ( nodeTitleTuple[1] ) { %>\n\n      <div class="ip-host-row clearfix"\n           data-node-pos="<%= nodeTitleTuple[0] %>">\n        <div class="label-host label-host-<%= nodeTitleTuple[0] %>">\n          Host <%= nodeTitleTuple[1] %>\n        </div>\n        <input type="text" maxlength="3"\n               class="ip-range-value ip-range-value-host"\n               data-group="<%= groupId %>"\n               data-node-pos="<%= nodeTitleTuple[0] %>"\n               data-ipindex="0" >\n        <span class="ip-range-separator"></span>\n        <input type="text" maxlength="3"\n               class="ip-range-value ip-range-value-host"\n               data-group="<%= groupId %>"\n               data-node-pos="<%= nodeTitleTuple[0] %>"\n               data-ipindex="1" >\n        <span class="ip-range-separator"></span>\n        <input type="text" maxlength="3"\n               class="ip-range-value ip-range-value-host"\n               data-group="<%= groupId %>"\n               data-node-pos="<%= nodeTitleTuple[0] %>"\n               data-ipindex="2" >\n        <span class="ip-range-separator"></span>\n        <input type="text" maxlength="3"\n               class="ip-range-value ip-range-value-host"\n               data-group="<%= groupId %>"\n               data-node-pos="<%= nodeTitleTuple[0] %>"\n               data-ipindex="3" >\n      </div>\n    <%  } %>\n  <%  }); %>\n</div>\n'}),define("views/popups/hardwareadmin/IPConfigurationGroupView",["views/basecomponents/BaseView","utils/AppUtil","text!templates/popups/hardwareadministration/IPConfigurationGroup.html"],function(e,t,n){"use strict";var i=_.template(n);return e.extend({events:{"click   .icon-ip-details":"onIPDetailsSelect","keyup   .ip-range-value-master":"onIPRangeValueMasterKeyup","keyup   .ip-range-value-host":"onIPRangeValueHostKeyup"},initialize:function(e){t.debug("IPConfigurationGroupView: initi: | viewid: ",this.cid),this.el=e.el,this.model=e.model,this.nodeInfo=e.nodeInfo,this.model.on("change:ipAddressChangeTrigger",this.onIPAddressChange,this),this.render()},render:function(){t.debug("IPConfigurationGroupView : render: "," | viewid     : "+this.cid," | nodeInfo:"+JSON.stringify(this.nodeInfo));var e=_.sortBy(this.nodeInfo.node_titles,function(e){return e[1]}),n=i(_.extend(this.nodeInfo,{sorted_node_titles:e,showRange:!this.model.isManualDiscover()&&this.model.getRackNodeCount()>1}));this.$el.html(n)},destroy:function(){this.model.off("change:ipAddressChangeTrigger",this.onIPAddressChange,this),this.undelegateEvents(),$(this.el).empty()},onIPAddressChange:function(){var e=this;_.each(this.$(".ip-range-value-host"),function(t){var n=$(t),i=n.attr("data-group"),s=n.attr("data-node-pos"),a=Number(n.attr("data-ipindex")),o=e.model.getNodeIpAddress(i,s);o[a]&&n.val(o[a])}),_.each(this.$(".ip-host-row"),function(t){var n=$(t),i=n.attr("data-node-pos");e.model.isNodeEnabled(i)?(n.removeClass("ip-host-row-disabled"),n.find("input").removeAttr("disabled")):(n.addClass("ip-host-row-disabled"),n.find("input").attr("disabled","disabled"))});var t=this.model.getNumberOfEnabledNodes();_.each(this.$(".ip-range-end"),function(n){var i=$(n),s=i.attr("data-group"),a=e.model.getMasterIpValue(s,3);a?i.val(a+t-1):i.val("")}),0===t?this.$(".ip-range-value-master").attr("disabled","disabled"):this.$(".ip-range-value-master").removeAttr("disabled")},onIPDetailsSelect:function(e){var t=$(e.currentTarget),n=t.parents(".label-main").siblings(".ip-host-panel");"z"===t.attr("data-icon")?(t.attr("data-icon","y"),n.hide()):(t.attr("data-icon","z"),n.show())},onIPRangeValueMasterKeyup:function(e){var t=$(e.currentTarget),n=$(e.currentTarget).val().trim();if(n.length>0&&this._validateIP(t)){var i=parseInt(n,10),s=t.attr("data-group"),a=Number(t.attr("data-ipindex"));this.model.updateMasterIP(s,a,i),t.focus()}},onIPRangeValueHostKeyup:function(e){var t=$(e.currentTarget),n=$(e.currentTarget).val().trim();if(n.length>0&&this._validateIP(t)){var i=parseInt(n,10),s=t.attr("data-group"),a=t.attr("data-node-pos"),o=Number(t.attr("data-ipindex"));this.model.updateNodeIP(s,a,o,i,!1),t.focus()}},_validateIP:function(e){var t=e.val().trim(),n=t.length>0?parseInt(t,10):0;return n>=0&&n<256?(e.removeClass("invalid-ip-range-value"),!0):(e.addClass("invalid-ip-range-value"),!1)}})}),define("text!templates/popups/hardwareadministration/HostnameConfigurationGroup.html",[],function(){return'\x3c!-- This is an HTML templat that represents an individual host name --\x3e\n\x3c!-- configuration UI --\x3e\n\x3c!-- Individual hosts --\x3e\n<div class="host-name ip-host-panel">\n  <h5 data-ntnx-title>\n    Host Name\n    <span class="subnet-label-main host-name-help">\n        Only required for Hyper-V\n    </span>\n  </h5>\n  <div class="clearfix">\n    <% _.each( sorted_node_titles, function(nodeTitleTuple) {\n         if ( nodeTitleTuple[1] ) {\n    %>\n\n      <section data-ntnx-section="type-half">\n        <div\n          class="ip-host-row"\n          data-node-pos="<%= nodeTitleTuple[0] %>"\n          data-node-label="<%= nodeTitleTuple[1] %>">\n          <label data-ntnx-label class="label-hostname label-host-<%= nodeTitleTuple[0] %>">\n            Host <%= nodeTitleTuple[1] %>\n          </label>\n          <input type="text"\n                 class="input-hostname"\n                 data-node-pos="<%= nodeTitleTuple[0] %>">\n        </div>\n      </section>\n\n    <%   } %>\n    <% }); %>\n  </div>\n</div>\n'}),define("views/popups/hardwareadmin/HostnameConfigurationGroupView",["views/basecomponents/BaseView","utils/AppUtil","text!templates/popups/hardwareadministration/HostnameConfigurationGroup.html"],function(e,t,n){"use strict";var i=_.template(n);return e.extend({nodeInfo:null,events:{"click   .icon-host-details":"onNodeSelect","keyup   .input-hostname":"onHostNameKeyup"},initialize:function(e){t.debug("HostnameConfigurationGroupView: initi: | viewid: ",this.cid),this.el=e.el,this.model=e.model,this.nodeInfo=e.nodeInfo,this.model.on("change:ipAddressChangeTrigger",this.onIPAddressChange,this),this.render()},render:function(){t.debug("HostnameConfigurationGroupView : render: "," | viewid     : "+this.cid," | nodeInfo:"+JSON.stringify(this.nodeInfo));var e=_.sortBy(this.nodeInfo.node_titles,function(e){return e[1]}),n=i(_.extend(this.nodeInfo,{sorted_node_titles:e}));this.$el.html(n)},destroy:function(){this.model.off("change:ipAddressChangeTrigger",this.onIPAddressChange,this),this.undelegateEvents()},onNodeSelect:function(e){var t=$(e.currentTarget),n=t.parents(".label-main").siblings(".ip-range-master-container"),i=t.parents(".ip-config-row").siblings(".ip-host-panel");"z"===t.attr("data-icon")?(t.attr("data-icon","y"),i.hide(),n.hide()):(t.attr("data-icon","z"),i.show(),n.show())},onHostNameKeyup:function(e){var t=$(e.currentTarget),n=t.attr("data-node-pos"),i=$(e.currentTarget).val().trim();this.model.updateHostName(i,n)},onIPAddressChange:function(){_.each(this.$(".ip-host-row"),function(e){var t=$(e),n=t.attr("data-node-pos");this.model.isNodeEnabled(n)?(t.removeClass("ip-host-row-disabled"),t.find("input").removeAttr("disabled")):(t.addClass("ip-host-row-disabled"),t.find("input").attr("disabled","disabled"))},this)}})}),define("text!templates/popups/hardwareadministration/DiscoveredNodeView.html",[],function(){return'<div class="block-row">\n  <% if (!isSupported) { %>\n    <span class="nutanixMoreInfo"\n          data-tooltip-container="body"\n          data-tooltip-title="This model is not supported by the current\n            Acropolis version"></span>\n  <% } %>\n\n  <section data-ntnx-section class="block-row-top">\n    \x3c!-- The 4 boxes UI--\x3e\n    <div class="node-group">\n      \x3c!-- nodeTitles are tuples:\n      [position, label, hypervisor type, hypervisor version] --\x3e\n      <% _.each( node_titles, function(nodeTitle) {\n          if ( nodeTitle[1] ) {\n      %>\n            <div class="node-item" data-position="<%= nodeTitle[0] %>">\n              \x3c!--  By default checked and disabled. Turned on when the user\n                    selects this block. --\x3e\n              <div data-ntnx-form-inline class="checkbox-container">\n                <input type="checkbox" data-position="<%= nodeTitle[0] %>"\n                       class="node-select-checkbox"\n                       data-test="<%= nodeTitle[4] %>">\n                <label title="<%= nodeTitle[1] %>"\n                  data-ntnx-inline-label class="label-ip">\n                  <%= nodeTitle[1] %>\n                  <span class=\'controllervm-ip\'\n                        id="controllervm-ip-<%= nodeTitle[0] %>"></span>\n                </label>\n              </div>\n\n              <span class="nutanixMoreInfo"\n                    data-tooltip-container="body"\n                    data-tooltip-icon="information-tooltip"\n                    data-tooltip-title="<%- nodeTitle[2] || \'Hypervisor: Null\' %>\n                      <%- nodeTitle[3] ? \' (\' + nodeTitle[3] + \')\' : \'\' %>">\n              </span>\n            </div>\n          <% } else { %>\n            <div class="node-item node-item-inactive"\n                 data-position="<%= nodeTitle[0] %>"/>\n        <% } %>\n      <% })%>\n    </div>\n  </section>\n\n\n  <section data-ntnx-section class="loadingAddresses loading-addresses">\n    <div class="n-inline-loading-container">\n      <div class="n-inline-loading" style="display:block" />\n    </div>\n    Retrieving IP addresses....\n  </section>\n\n\n  \x3c!-- IP Configuration Container\n       This slides when one of respective nodes is selected --\x3e\n  <div class="ip-config-panel">\n\n    \x3c!-- Host name (required for HyperV) --\x3e\n    <section data-ntnx-section class="hostname-panel ip-config-group">\n    </section>\n\n    \x3c!-- Controller VM IP --\x3e\n    <section data-ntnx-section class="controllervm-panel ip-config-group">\n    </section>\n\n    \x3c!-- Hypervisor IP --\x3e\n    <section data-ntnx-section class="hypervisor-panel ip-config-group">\n    </section>\n\n    \x3c!-- IPMI IP --\x3e\n    <section data-ntnx-section class="ipmi-panel ip-config-group">\n    </section>\n  </div>\n  \x3c!-- End of [ip_config_panel] --\x3e\n</div>\n'}),define("views/popups/hardwareadmin/DiscoveredNodeView",["jquery","backbone","views/basecomponents/popups/BasePopupSubView","views/popups/hardwareadmin/IPConfigurationGroupView","views/popups/hardwareadmin/HostnameConfigurationGroupView","utils/AppConstants","utils/AppUtil","utils/SubViewHelper","utils/HypervisorUtil","text!templates/popups/hardwareadministration/DiscoveredNodeView.html"],function(e,t,n,i,s,a,o,r,l,c){"use strict";return c=_.template(c),n.extend({name:"DiscoveredNodeView",template:c,subViewHelper:null,events:{"click .node-select-checkbox":"onNodeSelect","keydown .ip-range-value":"onDigitOnlyKeyDown"},initialize:function(e){o.debug("DiscoveredNodeView : initialize: | viewid: ",this.cid),this.el=e.el,this.model=e.model,this.subViewHelper=new r,this.initialized=!1,this.render()},render:function(){var t=this;o.debug("DiscoveredNodeView : render: | viewid: ",this.cid);var n=this.model.isModelSupported(),r=[];_.each(this.model.getDisplayedNodePositions(),function(e){var n=t.model.getRackNodeAt(e),i=l.getFormattedHypervisorType(n?n.hypervisor:""),s=n?n.hypervisor_version:"",a=n?n.node_uuid:"";r.push([e,t.model.getRackNodeLabelAt(e),i,s,a])});var c={node_titles:r,initialized:this.initialized,isSupported:n};this.$el.html(this.template(c)),this.$(".nutanixMoreInfo").nutanixMoreInfo({parseDataAttrs:!0});var d=this.model.hasOnlyComputeNodes(),p={};if(p[this.model.CONTROLLER_VM]=this.i18n("cvm_ip"),p[this.model.HYPERVISOR]=this.i18n("hypervisor_ip"),p[this.model.IPMI]=this.i18n("ipmi_ip"),l.hasHyperV()){var u=this.$el.find(".hostname-panel"),h=new s({el:u,model:this.model,nodeInfo:e.extend(c)});this.subViewHelper.register("hostname",h)}_.each(p,function(n,s){var a=t.$el.find("."+s+"-panel");if(d&&s===t.model.CONTROLLER_VM)return void a.hide();var o=new i({el:a,model:t.model,nodeInfo:e.extend(c,{groupId:s,groupName:n})});t.subViewHelper.register(s,o)});var m=null;this.model.is1NodeModel()&&(m=["10","01","11"],this.$(".node-group").addClass("node-group-single")),this.model.is2NodeModel()&&(m=["10","11"]),m&&_.each(this.$("div.node-item"),function(t){var n=e(t).attr("data-position");m.indexOf(n)>=0&&e(t).hide()}),this.triggerAction(a.MODAL.ACT.AS_REBUILD)},destroy:function(){this.$(".nutanixMoreInfo").nutanixMoreInfo("destroy"),this.subViewHelper.destroy(),this.undelegateEvents(),e(this.el).empty()},onDigitOnlyKeyDown:function(e){var t=e.charCode||e.keyCode||0;return 190===t&&this.moveToNext(e),8===t||9===t||46===t||t>=37&&t<=40||t>=48&&t<=57||t>=96&&t<=105},moveToNext:function(t){var n=e(event.target),i=n.parent(),s=n.data("ipindex");if(s<3){var a=+s+1;i.find("[data-ipindex="+a+"]").focus()}},showDetails:function(){var e=this;arguments.length>0&&void 0!==arguments[0]&&arguments[0]&&this._enableSelectCheckboxes(!0);var t=function(){e.initialized=!0,e.$(".loadingAddresses").hide(),e.$(".ip-config-panel").show(),e.$(".block-row-subnet-mask").show(),e.$(".controllervm-ip").show()};this.initialized?t():(this.$(".loadingAddresses").show(),this.model.loadDefaultAddresses(t)),this.triggerAction(a.MODAL.ACT.AS_REFRESH)},hideDetails:function(){this.$(".loadingAddresses").hide(),this.$(".ip-config-panel").hide(),this.$(".block-row-subnet-mask").hide(),this.$(".controllervm-ip").hide(),this._enableSelectCheckboxes(!1),this.triggerAction(a.MODAL.ACT.AS_REFRESH)},onNodeSelect:function(t){var n=e(t.currentTarget),i=n.attr("data-position"),s=n.is(":checked");e(".tab-host-config-view").removeClass("display-tab-inactive"),e(".tab-host-config-view").addClass("display-tab-active");var a=this.$el.prev(".node-container").find(".checkbox-container > .block-select-checkbox"),o=!!this.$(".node-group").find(".node-select-checkbox").filter(":checked").length;a.prop("checked",o),this.model.enableNode(i,s),s?this.showDetails():o||this.hideDetails()},_enableSelectCheckboxes:function(e){var t=this.$(".node-select-checkbox");t.prop("checked",e),_.each(t,function(t){var n=this.$(t).attr("data-position");this.model.enableNode(n,e)},this)}})}),define("text!templates/popups/hardwareadministration/ExpandClusterView.html",[],function(){return'<section data-ntnx-section="type-text" id="no-nodes-found">\n  <%= i18n(\'no_nodes_found\') %>\n</section>\n<div id="nodes-found">\n  <section data-ntnx-section="type-text">\n    <%= i18ns(\'nodes_found\', subnet) %>\n    <div class="add-license-info" style="display:none;">\n      <%= i18n(\'add_license_info\') %>\n    </div>\n  </section>\n</div>\n\x3c!-- After submit, results are displayed here (for non-SED)--\x3e\n<section data-ntnx-section id="configuration-results">\n</section>\n<% if (enableManualDiscovery) { %>\n  <section id="nodes-found-manually" data-ntnx-section="type-separator">\n  </section>\n  <section id="manual-discover-action" data-ntnx-section="type-separator">\n    <div data-ntnx-title>\n      <%= i18n(\'manual_discover_title\') %>\n      <span class="discovery-tooltip">\n        <%= Components.icon(\'question-tooltip\') %>\n      </span>\n    </div>\n    <div data-ntnx-section>\n      <%= Components.button({\n        extraClasses: \'manual-discovery\',\n        iconLeft: \'plus\',\n        text: i18n(\'show_manual_discovery\')\n      }) %>\n    </div>\n  </section>\n<% } %>\n'}),define("models/genesis/ManualHostDiscoveryModel",["models/genesis/GenesisBaseModel","utils/AppConstants"],function(e,t){"use strict";var n={DISCOVERED_NODES:"discovered_nodes",UNDISCOVERED_NODES:"undiscovered_nodes",NODE_IP:"node_ip",NODE_TYPE:"type",ARGS:{DISCOVERY_PARAMS:"discovery_params",PARAM_IP_ADDRS:"node_ips"}};return e.extend({name:"ManualHostDiscoveryModel",methodName:t.NODE_MANAGER_METHODS.DISCOVER_BY_IP,managerName:t.GENESIS.NODE_MANAGER,setHostIps:function(e){this.setRPCParams(n.ARGS.DISCOVERY_PARAMS,_defineProperty({},n.ARGS.PARAM_IP_ADDRS,e))},setRPCParams:function(e,t){this.kwargs[e]=t},getDiscoveredNodes:function(){return this.getReturnResponse()[n.DISCOVERED_NODES]||[]},getUndiscoveredNodes:function(){var e=this.getReturnResponse()[n.UNDISCOVERED_NODES];return _.map(e,function(e){return e[n.NODE_IP]})}})}),define("models/genesis/SoftwareVersionModel",["models/genesis/GenesisBaseModel","utils/AppConstants"],function(e,t){"use strict";var n={NUTANIX_RELEASE_VERSION:"nutanix_release_version"};return e.extend({name:"SoftwareVersionModel",DP:n,methodName:t.NODE_MANAGER_METHODS.SOFTWARE_VERSION,managerName:t.GENESIS.NODE_MANAGER,getVersionString:function(){var e=this.getReturnResponse()
;return e?e[n.NUTANIX_RELEASE_VERSION]:null},getErrorResponse:function(){var t=e.prototype.getErrorResponse.apply(this,arguments);return t||(void 0===this.getReturnResponse()[n.NUTANIX_RELEASE_VERSION]?"The local SVM does not contain a release version file":void 0)}},{DP:n})}),define("models/genesis/SelfEncryptDriveModel",["models/genesis/GenesisBaseModel","utils/AppConstants"],function(e,t){"use strict";return e.extend({name:"SelfEncryptDriveModel",methodName:t.NODE_MANAGER_METHODS.SELF_ENCRYPTING_DRIVES,managerName:t.GENESIS.NODE_MANAGER,setRPCParams:function(e){"undefined"!=typeof username&&_.extend(this.kwargs,{disk_serial_list:e})}})}),define("models/genesis/ConfigureIPModel",["models/genesis/GenesisBaseModel","utils/AppConstants"],function(e,t){"use strict";return e.extend({name:"ConfigureIPModel",methodName:t.NODE_MANAGER_METHODS.CONFIGURE_IP,managerName:t.GENESIS.NODE_MANAGER,getErrorResponse:function(){var t=e.prototype.getErrorResponse.apply(this,arguments);if(t)return t;var n=this.getReturnResponse();return!1===n[0]?n[1]?n[1]:"Failed to configure IP.":void 0},getReturnResponse:function(){return this.get(e.DP.GENESIS_RETURN)||[]},setRPCParams:function(e,t,n){_.extend(this.kwargs,{svm_ip:e,hypervisor_ip:t,ipmi_ip:n})}})}),define("models/genesis/UpdateClusterWhitelistModel",["models/genesis/GenesisBaseModel","utils/AppConstants"],function(e,t){"use strict";return e.extend({name:"UpdateClusterWhitelistModel",methodName:t.CLUSTER_MANAGER_METHODS.UPDATE_WHITELIST,managerName:t.GENESIS.CLUSTER_MANAGER,getErrorResponse:function(){return this.getParsedErrorResponse("Failed to update expand cluster whitelist.")}})}),define("models/genesis/NodeHypervisorModel",["models/genesis/GenesisBaseModel","utils/AppConstants"],function(e,t){"use strict";return e.extend({name:"NodeHypervisorModel",methodName:t.CLUSTER_MANAGER_METHODS.NODE_HYPERVISOR,managerName:t.GENESIS.CLUSTER_MANAGER,getErrorResponse:function(){return this.getParsedErrorResponse("Failed to fetch hypervisors types for nodes.")},setRPCParams:function(e){_.extend(this.kwargs,{node_list:e})}})}),define("views/popups/hardwareadmin/ExpandClusterView",["data/DataProperties","managers/ClusterManager","managers/TaskManager","managers/AppManager","managers/LicenseManager","views/popups/hardwareadmin/DiscoveredNodeView","views/basecomponents/popups/BasePopupSubView","utils/AppConstants","utils/AppUtil","utils/HypervisorUtil","utils/SubViewHelper","utils/ValidationUtil","utils/CommonTemplates","text!templates/popups/hardwareadministration/ExpandClusterView.html","models/hardware/HostCollection","models/hardware/DiskCollection","models/hardware/DiscoveredBlockModel","models/genesis/UnConfiguredNodesModel","models/genesis/ManualHostDiscoveryModel","models/genesis/SoftwareVersionModel","models/genesis/SelfEncryptDriveModel","models/genesis/GetIPModel","models/genesis/ConfigureIPModel","models/genesis/UpdateClusterWhitelistModel","models/genesis/NodeHypervisorModel"],function(e,t,n,i,s,a,o,r,l,c,d,p,u,h,m,f,v,g,E,T,C,S,A,b,y){"use strict";var I={HYPERVISOR_HOSTNAME:"hypervisor_hostname",NODE_UUID:"node_uuid",BLOCK_ID:"block_id",RACK_NODE_POSITION:"node_position",CVM_IP_ADDRESS:"cvm_ip",HYPERVISOR_IP_ADDRESS:"hypervisor_ip",IPMI_IP_ADDRESS:"ipmi_ip",DIGITAL_CERTIFICATE_MAP_LIST:"digital_certificate_map_list",NODE_MODEL:"model",IS_LIGHT_COMPUTE:"is_light_compute",IS_COMPUTE_ONLY:"is_compute_only",DIGITAL_CERTIFICATE_MAP:"digital_certificate_map_list",HYPERVISOR_TYPE:"hypervisor_type",HYPERVISOR_VERSION:"hypervisor_version",NOS_VERSION:"nos_version",IS_MANDATORY:"isMandatory",NODE_UUIDS:"nodeUuids",CURRENT_NETWORK_INTERFACE:"current_network_interface",ROBO_MIXED_HYPERVISOR:"robo_mixed_hypervisor"},w=_.template(h),P='<section data-ntnx-section="type-separator"\n            class="node-container checkbox-container">\n            <div data-ntnx-form-inline class="checkbox-container">\n              <input class="block-select-checkbox"\n                type="checkbox"\n                <%= !isModelSupported ? \'disabled\' : \'\' %>\n                id="checkbox-<%= nodeId %>">\n              <label data-ntnx-inline-label class="\n                <%= isModelSupported ? \'\' : \'model-unsupported\'%>"\n                for="checkbox-<%= nodeId %>"\n                data-test="<%= serial %>">\n                <%= blockTitle %>\n              </label>\n            </div>\n          </section>\n          <div id="<%= nodeId %>" class="checkbox-content" />',N=_.template('<div class="unavailable-nodes">\n              <h4 class="n-popup-block-title">\n                Unavailable nodes\n              </h4>\n              <div class="n-popup-description">\n                Your XPress class license allows adding nodes with the SX type\n                only. Nodes with other types will be unavailable.\n                <a href="#" class="toggle-declined-nodes">\n                  <span data-is-show="1">Show</span>\n                  <span data-is-show="0" class="hide">Hide</span>\n                   nodes\n                </a>.\n                <ul class="descripton-unordered-list\n                           top-margin hide declined-nodes">\n                <% _.each(nodes, function(node) { %>\n                  <li>\n                    <%- node.model %> (Serial Number: <%- node.serial %>)\n                  </li>\n                <% }); %>\n                </ul>\n              </div>\n            </div>');return o.extend({viewOption:null,subViewHelper:null,name:"ExpandClusterView",events:{"click #checkbox-select-all":"onSelectAll","click .block-select-checkbox":"onBlockSelect","click .toggle-declined-nodes":"onDeclinedNodesToggle","click .manual-discovery":"onManualDiscovery"},initialize:function(e){o.prototype.initialize.apply(this,arguments),l.debug("ExpandClusterView : initialize: "," | viewid     : ",this.cid),this.subViewHelper=new d,this.model=e.model,this.encryptionModel=e.encryptionModel,this.hostCollection=new m,this.diskCollection=new f,this.unConfiguredNodesModel=new g,this.getIPModel=new S},render:function(){l.debug("ExpandClusterView : render: "," | viewid     : ",this.cid);var n=t.getCurrentClusterModel(),i=n.get(e.CLUSTER_EXTERNAL_SUBNET);this.$el.html(w(this.vtOptions({subnet:i,enableManualDiscovery:t.isClusterFFEnabled(r.FFLAGS.MANUAL_NODE_DISCOVERY)}))),this.$(".discovery-tooltip").tooltip({title:this.i18n("manual_discover_tip"),container:$("body")})},renderDiscoveredNodes:function(e,t){var n=this,i=_.template(P);t.empty(),_.each(e,function(e){var s=e.getBlockId(),o=e.getRackableUnitSerial(),r=n.i18ns("block_title",e.getRackableUnitModel(),o),l="node-"+s,c=i(n.vtOptions({blockTitle:r,serial:o,nodeId:l,isModelSupported:e.isModelSupported()}));t.append(c),n.subViewHelper.register(s,new a({el:"#"+l,model:e}))}),this.applyNutanixInput({types:["checkbox"]}),this.triggerAction(r.MODAL.ACT.AS_REBUILD)},destroy:function(){l.debug("ExpandClusterView : destroy: "," | viewid     : ",this.cid),this.subViewHelper.destroy(),this.$(".discovery-tooltip").tooltip("destroy"),this.model.reset(),this.clearBaseHeader(),o.prototype.destroy.apply(this,arguments)},showView:function(){this.clearBaseHeader(),l.debug("ExpandClusterView : show: "," | viewid     : ",this.cid),o.prototype.showView.apply(this,arguments);var t=this.parentView;t.showButton("Save",!1),t.showButton("Close",!1),t.showButton("Cancel",!1),t.showButton("Back",!1),this.viewOption&&(t.showButton("Validate",!1),t.showButton("ExpandCluster",!1),t.showButton("Back",!1),t.showButton("Next",!0),t.showButton("Cancel",!0),t.showButton("Close",!1)),this.viewOption&&!1!==this.viewOption.refreshView&&this.loadUnconfiguredNodes(),s.getLicenseModel().get(e.LICENSE_CATEGORY)!==e.LICENSE_STANDARD&&this.$(".add-license-info").show()},clearNodesInfo:function(){this.model.clearDiscoveredNodes(),this.render()},setViewOption:function(e){this.viewOption=e},refreshDataContentView:function(){var e=this,t=[];this.clearBaseHeader(),this.subViewHelper.removeAll();var n=this.model.getDiscoveredNodes();_.each(n,function(n){var i=!0;_.each(n.NODE_POSITIONS,function(s){if(n.isNodeAvailable(s)){var a=n.getRackNodeLabelAt(s),o=n.getNodeUUIDOrSerial(a);"error"!==e.sedInfoForEachDisk[o]&&i&&(i=!1,t.push(n))}})});var i=this.parentView;if(this.$("#configuration-results").hide(),this.$("#manual-discover-action").show(),0===t.length)this.$("#no-nodes-found").show(),i.showButton("Save",!1),i.showButton("Close",!0),i.showButton("Cancel",!1);else{this.isEkmEncryptionOn(),i.showButton("Next",!0),i.showButton("Close",!1),i.showButton("Cancel",!0);var o=this.$("#nodes-found").show();this.$(".node-container").remove(),_.each(t,function(t){var n=t.getBlockId(),i=t.isModelSupported(),s=t.getRackableUnitModel(!0)+" (Serial Number: "+t.getRackableUnitSerial()+")",r="node-"+n;o.append(_.template(P,{serial:t.getRackableUnitSerial(),blockTitle:s,nodeId:r,isModelSupported:i}));var l=new a({el:"#"+r,model:t});e.subViewHelper.register(n,l),e.applyNutanixInput({types:["checkbox"]})});var l=s.FEATURE_MAP.LICENSE_MAX_NODES,c=this.hostCollection.length;s.violatedFeatureLicense(l,c)&&setTimeout(function(){e.triggerAction(r.MODAL.ACT.ALERT_SHOW,{type:r.MODAL.ALERT.TYPE_WARNING,message:s.getLimitPopupMessageTemplate(l,"host")})},600),this.model.isFilteredByArchType()&&this.triggerAction(r.MODAL.ACT.ALERT_SHOW,{type:r.MODAL.ALERT.TYPE_INFO,message:this.i18ns("filteredByArchType",this.clusterManager.getClusterArch())}),this.$(".alert-warning h4").addClass("onload-warning")}this.$(".unavailable-nodes").remove(),this.$el.append(this.getDeclinedDiscoveredNodesListCode()),this.triggerAction(r.MODAL.ACT.AS_REBUILD)},getDeclinedDiscoveredNodesListCode:function(){var e=this.model.getDeclinedDiscoveredNodes();if(0===e.length)return"";var t=[];return _.each(e,function(e){t.push({model:e.getRackableUnitModel(),serial:e.getRackableUnitSerial()})},this),N({nodes:t})},loadUnconfiguredNodesManually:function(e){var t=this,n=this.$("#nodes-found-manually"),i=new E;i.setHostIps(e),n.show().html(u.LOADING_MSG({msg:this.i18n("manual_discover_in_progress")})),this.parentView.scrollToBottom(),i.fetch({success:function(e){var s=i.getDiscoveredNodes(),a=i.getUndiscoveredNodes();a.length&&t.parentView.showHeaderError(t.i18ns("manual_discover_unreachable",a.join(", "))),s.length?(t.model.processManuallyDiscoveredNodes(e),t.renderDiscoveredNodes(t.model.getManuallyDiscoveredNodes(),n)):n.empty().hide()},error:function(e){this.parentView.showHeaderError("manual_discover_error"),l.error(e)}})},loadUnconfiguredNodes:function(){var e=this;this.triggerAction(r.MODAL.ACT.ALERT_SHOW,{type:r.MODAL.ALERT.TYPE_LOADING});var t=[];t.push(this.getIPModel.fetch({success:function(t){e.model.processClusterNetworkSettings(t)},error:function(t,n){var i=n;l.log(i);var s="Unable to get cluster network settings. ";s+=i||"",e.triggerAction(r.MODAL.ACT.ALERT_SHOW,{type:r.MODAL.ALERT.TYPE_ERROR,message:s})}})),t.push(this.unConfiguredNodesModel.fetch({success:function(t){e.model.processNewlyDiscoveredNodes(t)},error:function(t,n){var i=t.getErrorResponse()||n;l.log(i);var s="Unable to retrieve newly discovered nodes. ";s+=i||"",e.triggerAction(r.MODAL.ACT.ALERT_SHOW,{type:r.MODAL.ALERT.TYPE_ERROR,message:s})}})),t.push(this.hostCollection.fetch({success:function(){e._checkLicenseViolations()},error:function(){e.triggerAction(r.MODAL.ACT.ALERT_SHOW,{type:r.MODAL.ALERT.TYPE_ERROR,message:"Error in fetching host collection."})}})),$.when.apply($,t).done(function(){e.getSEDStatusofNode()})},getSEDStatusofNode:function(){var e=this,t=[],n=void 0;this.sedInfoForEachDisk={},_.each(this.model.getDiscoveredNodes(),function(i){n=0,_.each(i.NODE_POSITIONS,function(s){if(i.isNodeAvailable(s)){var a=i.getRackNodeLabelAt(s),o=i.getNodeUUIDOrSerial(a);e.sedInfoForEachDisk[o]=null;var r=i.get("rackNodes")[n].ip;n++;var l=new T;l.setProxyIpv6(r),t.push(l.fetch().always(function(n,i){var s=l.getVersionString();if(s){var a=s.split("-")[3];if(parseFloat(a).toFixed(5)<4.1)e.sedInfoForEachDisk[o]=!1;else{var c=new C;c.setProxyIpv6(r),t.push(c.fetch({success:function(t){var n=t.getReturnResponse();_.each(n,function(t,n){e.sedInfoForEachDisk[o]=t})},error:function(t,n){e.sedInfoForEachDisk[o]="error"}}))}}}))}})}),t.push((new b).fetch({success:function(){e.model.setClusterWhiteListUpdateSuccess()},error:function(){e.triggerAction(r.MODAL.ACT.ALERT_SHOW,{type:r.MODAL.ALERT.TYPE_ERROR,message:"Error in updating cluster whitelist."})}}),this.encryptionModel.fetchCurrentEncryptionStatus({error:function(e,t){l.log("Error in getting the current encryption state.")}})),$.whenAll.apply($,t).done(function(){e.refreshDataContentView()}),this.model.getDiscoveredNodes().length||this.refreshDataContentView()},_checkLicenseViolations:function(){var t=this.$(".block-select-checkbox:checked"),n=s.FEATURE_MAP.LICENSE_MAX_NODES,i=s.FEATURE_MAP.LICENSE_MIXED_NODE_CLUSTER,a=this.hostCollection.length;if(a+=t.length,s.violatedFeatureLicense(n,a)?this.$(".alert-warning h4").hasClass("onload-warning")&&this.$(".alert-warning h4").is(":visible")||this.triggerAction(r.MODAL.ACT.ALERT_SHOW,{type:r.MODAL.ALERT.TYPE_WARNING,message:s.getLimitPopupMessageTemplate(n,r.ENTITY_HOST)}):this.$(".n-license-warning").is(":visible")&&this.clearBaseHeader(),s.violatedFeatureLicense(i)){var o=this.hostCollection.models.map(function(t){return t.get(e.BLOCK_MODEL)});_.uniq(o).length===o.length&&this.triggerAction(r.MODAL.ACT.ALERT_SHOW,{type:r.MODAL.ALERT.TYPE_WARNING,message:s.getLimitPopupMessageTemplate(i,r.ENTITY_HOST)})}},onSelectAll:function(e){var t=this,n="checked"===$(e.currentTarget).attr("checked");this.$(".block-select-checkbox").each(function(){var e=$(t),i=e.is(":checked");(n&&!i||!n&&i)&&(e.click(),t._updateBlockState(e[0].id,n))})},onBlockSelect:function(e){this._checkLicenseViolations(),this._updateBlockState(e.currentTarget.id,$(e.currentTarget).is(":checked"))},onDeclinedNodesToggle:function(e){e.preventDefault();var t=this.$(".toggle-declined-nodes"),n=this.$(".declined-nodes"),i=n.is(":visible");this.$("span[data-is-show]",t).removeClass("hide"),this.$("span[data-is-show="+(i?0:1)+"]",t).addClass("hide"),n.toggle(!i)},onManualDiscovery:function(){this.parentView.selectSubView({subViewId:this.parentView.DISCOVER_MANUAL_VIEW})},saveViewData:function(e){this.onSubmit(e)},onSubmit:function(e){this._validate()&&(this.parentView.enableButton("btnSave"),this.clearBaseHeader(),this._saveConfigurationData(e))},_saveConfigurationData:function(e){var t=this;this.configurationError=!1,this.combinedErrorMessage="";var n=[],i=!1,s={};this.model.discoveredNodesChecked={},_.each(this.model.getAllDiscoveredNodes(),function(e){var n=e.getBlockId();t.$("#checkbox-node-"+n).is(":checked")&&_.each(e.NODE_POSITIONS,function(i){if(e.isNodeEnabled(i)){var a=_.map(e.IP_GROUPS,function(t){return t===e.CONTROLLER_VM&&e.isRackNodeComputeOnly(i)?null:e.getNodeIpAddress(t,i).join(".")}),o=e.getRackNodeLabelAt(i),r=e.getNodeUUIDOrSerial(o),l=e.getNodeIPV6AddressEncoded(o);a.push(l);var c=e.getRackNodeHypervisorAt(i);s[r]={addresses:a,hostName:e.getHostName(i),nodePosition:o,blockId:e.getRackableUnitSerial(),model:e.getRackableUnitModel(!0),isLightCompute:e.isRackNodeLightCompute(i),isComputeOnly:e.isRackNodeComputeOnly(i),skipHypervisorCheck:e.isManualDiscover(),hypervisorType:c.type,hypervisorVersion:c.version,nosVersion:e.getNodeNOSVersion(i),currentNetworkInterface:e.getRackNodeNetworkInterface(i),roboMixedHypervisor:e.getRoboMixedHypervisor(i)},t.model.discoveredNodesChecked[n]||(t.model.discoveredNodesChecked[n]=e)}})});var a={};if(this.model.successfullyConfiguredIp=[],_.each(s,function(o,r){var c;i=i||o.skipHypervisorCheck;var d=o.addresses;l.log("ExpandClusterPopupView: Begin Configuration: nodeUUIDOrSerial:"+r);var p=(c={},_defineProperty(c,I.HYPERVISOR_HOSTNAME,o.hostName),_defineProperty(c,I.NODE_UUID,r),_defineProperty(c,I.BLOCK_ID,o.blockId),_defineProperty(c,I.RACK_NODE_POSITION,o.nodePosition),_defineProperty(c,I.CVM_IP_ADDRESS,d[0]),_defineProperty(c,I.HYPERVISOR_IP_ADDRESS,d[1]),_defineProperty(c,I.IPMI_IP_ADDRESS,d[2]),_defineProperty(c,I.DIGITAL_CERTIFICATE_MAP,[]),_defineProperty(c,I.NODE_MODEL,o.model),_defineProperty(c,I.IS_COMPUTE_ONLY,o.isComputeOnly),_defineProperty(c,I.IS_LIGHT_COMPUTE,o.isLightCompute),_defineProperty(c,I.HYPERVISOR_TYPE,o.hypervisorType),_defineProperty(c,I.HYPERVISOR_VERSION,o.hypervisorVersion),_defineProperty(c,I.NOS_VERSION,o.nosVersion),_defineProperty(c,I.CURRENT_NETWORK_INTERFACE,o.currentNetworkInterface),_defineProperty(c,I.ROBO_MIXED_HYPERVISOR,o.roboMixedHypervisor),c),u={svm_ip:t._getIPConfigurationData(d[0],t.model.getControllerSubnetMask(),t.model.getControllerGateway()),hypervisor_ip:t._getIPConfigurationData(d[1],t.model.getHypervisorSubnetMask(),t.model.getHypervisorGateway()),ipmi_ip:t._getIPConfigurationData(d[2],t.model.getIPMISubnetMask(),t.model.getIPMIGateway()),ipv6:t._getIPConfigurationData(d[3],t.model.getIPMISubnetMask(),t.model.getIPMIGateway())},h=d[3],m=new A;m.setRPCParams(u.svm_ip,u.hypervisor_ip,u.ipmi_ip),m.setProxyIpv6(h),t.isEkmEncryptionOn()&&m.fetch({success:function(n,i){l.log("ExpandClusterPopupView: Successful Configuration: ",r);var o=n.getReturnResponse();o[1]&&(t.combinedErrorMessage+=o[1]+" "),t.model.setSuccessfulConfiguredIps(u),a[r]="",t.model.forEncryptionOnlyNodeAddressMap[r]=s[r].addresses,t._showEncryptionOptions(s,a,e)},error:function(n,i){var o=i;l.log("ExpandClusterPopupView: Error on ","configureIPAddresses: ","UUID/Serial:",r,"error:",o),a[r]=o,t.configurationError=!0,t._showEncryptionOptions(s,a,e)}}),n.push(p)}),n.length>0){if(this.model.setExpandNodeConfigurationList(n),i)return _.isFunction(e)?e():null;var o=new y,c=[];_.each(n,function(e){c.push({node_uuid:e[I.NODE_UUID],model:e[I.NODE_MODEL],nos_version:e[I.NOS_VERSION],hypervisor_type:e[I.HYPERVISOR_TYPE],hypervisor_version:e[I.HYPERVISOR_VERSION],current_network_interface:e[I.CURRENT_NETWORK_INTERFACE],is_light_compute:e[I.IS_LIGHT_COMPUTE],robo_mixed_hypervisor:e[I.ROBO_MIXED_HYPERVISOR]})}),o.setRPCParams(c),this.triggerAction(r.MODAL.ACT.ALERT_SHOW,{type:r.MODAL.ALERT.TYPE_INFO,message:"Validating"}),this.parentView.scrollToTop(),this.parentView.disableButton("Next"),o.fetch({success:function(n){var i=n.getReturnResponse(),a=i[0],o=!1;if(_.each(s,function(e,n){if(a[n][0]===r.SOFTWARE_RELEASES_HYP_TYPE.HYPERV&&(!e.hostName||0===e.hostName.length)){t.triggerAction(r.MODAL.ACT.ALERT_SHOW,{type:r.MODAL.ALERT.TYPE_ERROR,message:"Please enter host name(s)."});var i=t.$("#node-"+e.blockId);i.find('div[data-node-label="'+e.nodePosition+'"] .label-hostname').addClass("invalid-entry"),i.find(".host-name-title").addClass("invalid-entry"),o=!0}}),!o){var l={};_.each(a,function(e,t){var n=e[0],i=e[1];l[n]||(l[n]={nodeUuids:[],isMandatory:!1}),l[n][I.NODE_UUIDS].push(t),l[n][I.IS_MANDATORY]=l[n][I.IS_MANDATORY]||i}),t.model.setHypervisorsForNodes(l),t.model.setCompatibilityMessage(i[1]),"function"==typeof e&&e()}t.parentView.enableButton("Next")},error:function(e,n){var i=n;l.log(i);var s="Unable to get hypervisor type(s) for selected node(s). ";s+=i||"",t.triggerAction(r.MODAL.ACT.ALERT_SHOW,{type:r.MODAL.ALERT.TYPE_ERROR,message:s}),t.isError=!0,t.parentView.enableButton("Next")}})}},_showEncryptionOptions:function(e,t,n){if(_.size(t)===_.size(e)){if(this.configurationError){var i="";return _.each(t,function(e,t){e.length>0&&(i+=" nodeUUIDOrSerial : "+t)}),i+=" could not be configured.",this.triggerAction(r.MODAL.ACT.ALERT_SHOW,{type:r.MODAL.ALERT.TYPE_ERROR,message:i}),void(this.model.discoveredNodesChecked=[])}this.clearBaseHeader(),n()}},_submitComplete:function(e,t){var s=!1;if(_.size(t)===_.size(e)){this.$("#nodes-found").hide(),this.$("#configuration-results").show(),this.clearBaseHeader();var a=0,o='<div class="results-processing alert alert-info"></div><div class="results-title">Results</div>';_.each(this.model.getDiscoveredNodes(),function(n){var i=n.getBlockId();if(this.$("#checkbox-node-"+i).is(":checked")){var r=n.getRackableUnitModel()+" (Serial Number: "+n.getRackableUnitSerial()+")",l=!0;_.each(n.NODE_POSITIONS,function(i){if(n.isNodeEnabled(i)){l&&(o+='<div class="results-block">'+r+"</div>",l=!1);var c=n.getRackNodeLabelAt(i),d=n.getNodeUUIDOrSerial(c),p=t[d].length>0,u=e[d].addresses,h="";p?h='<span class="error"><i aria-hidden="true" data-icon="v"></i></span>':(h='<span class="success"><i aria-hidden="true" data-icon="J"></i></span>',a++),o+='<div class="result-host"> <span class="result">'+h+"</span>Host "+c+'  [<span class="address">  CVM: '+u[0]+'</span><span class="address">  HYP: '+u[1]+'</span><span class="address"> IPMI: '+u[2]+"</span>  ]</div>",p&&(o+='<div class="result-error-message"> Error: '+t[d]+"</div>",s=!0)}},this)}},this),this.$("#configuration-results").html(o),s?this.$(".results-processing").hide():this.$(".results-processing").show();var l=this.$("#configuration-results .results-processing");1===a?this.combinedErrorMessage?l.html(r.SINGLE_NODE_ADD_MESSAGE+" but "+this.combinedErrorMessage):l.html(r.SINGLE_NODE_ADD_MESSAGE):a>1&&(this.combinedErrorMessage?l.html(_.template(r.MULTIPLE_NODE_ADD_MESSAGE,{num:a})+" but "+this.combinedErrorMessage):l.html(_.template(r.MULTIPLE_NODE_ADD_MESSAGE,{num:a}))),this.parentView.showButton("Save",!1),this.parentView.showButton("Cancel",!0),this.parentView.showButton("Close",!1),n.fetchOnDemand(),i.refreshView()}},_getIPConfigurationData:function(e,t,n){return t?{address:e,netmask:t,gateway:n}:null},_updateBlockState:function(e,t){var n=e.split("-")[2],i=this.subViewHelper.get(n);i&&(t?(i.showDetails(!0),$(".tab-host-config-view").removeClass("display-tab-inactive"),$(".tab-host-config-view").addClass("display-tab-active")):(i.hideDetails(),$(".tab-host-config-view").addClass("display-tab-inactive"),$(".tab-host-config-view").removeClass("display-tab-active")))},_highlightInvalidEntries:function(e){_.each(e,function(e){var t=this.$("#node-"+e.nodeId),n=t.find("."+e.ipGroup+"-panel");n.find(".label-main").addClass("invalid-entry"),n.find(".label-host-"+e.nodePosition).addClass("invalid-entry")},this)},_validate:function(){var e=this;if(this.$(".invalid-entry").removeClass("invalid-entry"),this.$(".invalid-ip-range-value").length>0)return this.triggerAction(r.MODAL.ACT.ALERT_SHOW,{type:r.MODAL.ALERT.TYPE_ERROR,message:this.i18n("invalidIpValue")}),!1;var t=[],n=[],i=[],s=[],a=[],o="",d=0;if(_.each(this.model.getAllDiscoveredNodes(),function(l){var c=l.getBlockId();e.$("#checkbox-node-"+c).is(":checked")&&_.each(l.NODE_POSITIONS,function(u){if(l.isNodeEnabled(u)){var h=l.getRackNodeIpGroups(u);o=l.getHostName(u),a.push(o?p.shouldOnlyContain(o,"a-zA-Z0-9\\-"):{valid:!0}),d++,_.each(h,function(a){var o={nodeId:c,ipGroup:a,nodePosition:u};if(e.model.canConfigureIP(a)){var d=l.getNodeIpAddress(a,u),p=d.join(".");"0.0.0.0"===p&&(a===l.CONTROLLER_VM||a===l.HYPERVISOR&&"null"!==l.getRackableUnitModel(!0))&&n.push(o),o.ipAddress=p;var h=l.getRackNodeLabelAt(u);l.getNodeUUIDOrSerial(h)?e.isClusterFFEnabled(r.FFLAGS.ENCRYPTION)===e.sedInfoForEachDisk[l.getNodeUUIDOrSerial(h)]||_.isNull(e.sedInfoForEachDisk[l.getNodeUUIDOrSerial(h)])||_.isUndefined(e.sedInfoForEachDisk[l.getNodeUUIDOrSerial(h)])||e.clusterManager.isMulticlusterUI()||s.push(o):i.push(o)}t.push(o)})}})}),0!==s.length&&this.encryptionModel.getCurrentEncryptionStatusModel().state.isSEDProtectionOn){var u=this.i18n("notSEDCapable");return this.triggerAction(r.MODAL.ACT.ALERT_SHOW,{type:r.MODAL.ALERT.TYPE_ERROR,message:u}),this._highlightInvalidEntries(s),!1}if(0===t.length)return this.triggerAction(r.MODAL.ACT.ALERT_SHOW,{type:r.MODAL.ALERT.TYPE_ERROR,message:this.i18n("noHostSelected")}),!1;if(n.length>0)return this.triggerAction(r.MODAL.ACT.ALERT_SHOW,{type:r.MODAL.ALERT.TYPE_ERROR,message:this.i18n("notEnterIpAddress")}),this._highlightInvalidEntries(n),!1;if(i.length>0)return this.triggerAction(r.MODAL.ACT.ALERT_SHOW,{type:r.MODAL.ALERT.TYPE_ERROR,message:this.i18n("invalidNodes")}),this._highlightInvalidEntries(i),!1;if(this.willExceedMaxNode(d))return this.triggerAction(r.MODAL.ACT.ALERT_SHOW,{type:r.MODAL.ALERT.TYPE_ERROR,message:l.sprintf(this.i18n("xpressNodeLimit","An XPress license only allows the cluster to be expanded up to %d nodes"),r.MAX_XPRESS_NODE)}),!1;if(c.hasHyperV()){if(""===!o)return this.triggerAction(r.MODAL.ACT.ALERT_SHOW,{type:r.MODAL.ALERT.TYPE_ERROR,message:this.i18n("hostNameEmpty")}),!1;if(_.any(a,function(e){return!e.valid}))return this.triggerAction(r.MODAL.ACT.ALERT_SHOW,{type:r.MODAL.ALERT.TYPE_ERROR,message:this.i18n("invalidHostName")}),!1}var h=[],m=[];if(_.each(t,function(e){e.ipAddress&&"0.0.0.0"!==e.ipAddress&&(h.indexOf(e.ipAddress)<0?h.push(e.ipAddress):m.push(e))}),m.length>0)return this.triggerAction(r.MODAL.ACT.ALERT_SHOW,{type:r.MODAL.ALERT.TYPE_ERROR,message:this.i18n("dupAddress")}),this._highlightInvalidEntries(m),!1;var f=new v,g=[];return _.each(t,function(t){var n=null,i=null,s=t.ipAddress,a=!0;switch(t.ipGroup){case f.CONTROLLER_VM:n=e.model.getControllerSubnetMask(),i=e.model.getCurrentControllerVMAddress();break;case f.HYPERVISOR:n=e.model.getHypervisorSubnetMask(),i=e.model.getCurrentHypervisorAddress();break;case f.IPMI:a=!1,n=e.model.getIPMISubnetMask(),i=e.model.getCurrentIPMIAddress()}if(a){var o=l.getSubnet(i,n),r=l.getSubnet(s,n);o&&r&&o!==r&&g.push(t)}}),!(g.length>0)||(this.triggerAction(r.MODAL.ACT.ALERT_SHOW,{type:r.MODAL.ALERT.TYPE_ERROR,message:this.i18n("invalidEntry")}),this._highlightInvalidEntries(g),!1)},isEkmEncryptionOn:function(){return this.parentView.isEkmEncryptionOn()},willExceedMaxNode:function(e){var t=this.hostCollection.length+e,n=s.violatedFeatureLicense(s.FEATURE_MAP.LICENSE_MAX_NODES,t);return!(!s.hasXPressLicense()||!n)}})}),define("views/popups/hardwareadmin/ManualNodeDiscoveryView",["views/basecomponents/popups/BasePopupSubView","views/basecomponents/tableinput/TableInputView","utils/AppConstants","utils/AppUtil"],function(e,t,n,i){"use strict";var s=t.ACTION_EVENTS,a=_.template(i.trimmedTemplate("\n      <div data-ntnx-section>\n        <div data-ntnx-title><%= i18n('view_title') %></div>\n        <div data-ntnx-section=\"type-text\">\n          <%= i18n('view_description') %>\n        </div>\n        <div data-ntnx-section class=\"ip-form component-table-input\">\n        </div>\n      </div>\n    ")),o={NODE_IP:"node_ip"};return e.extend({name:"ManualNodeDiscoveryView",render:function(){this.$el.html(a(this.vtOptions({})))},renderIpForm:function(){this._tableView||(this._tableView=new t({el:this.$(".ip-form"),entityType:"host",columns:[{columnName:this.i18n("ip_column_header"),modelAttribute:o.NODE_IP,modelValidate:n.VALIDATION_NAMES.IP_ADDRESS}],idAttribute:"value",addCaption:this.i18n("add_node")})),this.parentView.disableButton("btnDiscover"),this._tableView.render()},delegateSubViewEvents:function(){this._tableView.on(s.ADD,this._rebuild,this),this._tableView.on(s.ERROR,this.onRowError,this),this._tableView.on(s.SAVE,this.onChange,this),this._tableView.on(s.DELETE,this.onChange,this)},showView:function(){e.prototype.showView.apply(this,arguments),this.parentView.hideAllButtons(),this.parentView.showButton("Back",!0),this.parentView.showButton("Discover",!0),this.renderIpForm(),this.delegateSubViewEvents()},hideView:function(){e.prototype.hideView.apply(this,arguments),this.parentView.showButton("Discover",!1),this._tableView.off(),this._tableView.destroy(),this._tableView=null},onChange:function(){this._tableView.getData().length?this.parentView.enableButton("btnDiscover"):this.parentView.disableButton("btnDiscover"),this._rebuild()},onRowError:function(){this.parentView.showHeaderError(this.i18n("ip_validation_error"))},onClickDiscover:function(){this.parentView.onSubmitManualDiscover(_.map(this._tableView.getData(),function(e){return e[o.NODE_IP]}))},_rebuild:function(){this.parentView.clearHeader(),this.parentView.triggerAction(n.MODAL.ACT.AS_REBUILD)}})}),define("text!templates/popups/hardwareadministration/GenerateCSRExpandClusterView.html",[],function(){return'<h4 class="csr-title">Certificate Signing Requests </h4>\n<span class="ec-desc">Download the CSRs for the discovered nodes</span>\n<table id="discoverNodeDownloadCSR" class="table table-hover">\n  <thead>\n    <tr>\n      <th>Node Address</th>\n      <th>Action</th>\n    </tr>\n  </thead>\n  <tbody>\n  </tbody>\n</table>\n'}),define("views/popups/hardwareadmin/GenerateCSRExpandClusterView",["views/basecomponents/popups/BasePopupSubView","utils/AppConstants","managers/NavigationManager","text!templates/popups/hardwareadministration/GenerateCSRExpandClusterView.html"],function(e,t,n,i){"use strict";var s=_.template('<tr class="n-table-row"><td><%= address %></td><td><button value="Download All CSRS" class="btn btn-primary downloadCSR" data-node-id="<%= address %>">Download</button></td></tr>');return e.extend({subViewTemplate:_.template(i),events:{"click  .downloadCSR":"onClickDownload"},initialize:function(t){e.prototype.initialize.apply(this,arguments),this.model=t.model},refreshView:function(){this.displayButtonsRequired(),this.renderNodeEntries()},render:function(){this.$el.html(this.subViewTemplate())},displayButtonsRequired:function(){var e=this.parentView,t={actionTargetId:"encryption-config-view",action:"showSubView"};e.showButton("Save",!1),e.showButton("Back",!0),e.$(".btnBack").attr("actionTargetId")||e.setButtonAttribute("btnBack",t)},renderNodeEntries:function(){var e=this.$("#discoverNodeDownloadCSR > tbody");e.empty(),_.each(this.model.getSuccessfulConfiguredIps(),function(t){var n=s(t.svm_ip);e.append(n)})},onClickDownload:function(e){n.executeDownloadAction(t.FILE_ENCRYPTION_EXPAND_CLUSTER_CSR,$(e.currentTarget).attr("data-node-id"))}})}),define("views/popups/hardwareadmin/ExpandClusterResultsView",["views/basecomponents/popups/BasePopupSubView","managers/TaskManager","managers/AppManager"],function(e,t,n){"use strict";var i=_.template('<div class="results-block"><%= blockTitle %></div>'),s=_.template('<span class="error"><i aria-hidden="true" data-icon="v"></i></span>'),a=_.template('<span class="success"><i aria-hidden="true" data-icon="J"></i></span>'),o=_.template('<div class="result-host"> <span class="result"> <%=statusHTML%> </span>Host  <%=nodeLabel %>   [<span class="address">CVM:  <%=CVMAddress%> </span><span class="address"> HYP:  <%=HYPAddress%> </span><span class="address"> IPMI:  <%=IPMIAddress%> </span>  ]</div>'),r=_.template('<div class="result-error-message"> Error: <%= errorMsg %></div>');return e.extend({initialize:function(t){e.prototype.initialize.apply(this,arguments),this.model=t.model},refreshView:function(){var e={actionTargetId:"encryption-config-view",action:"showSubView"},t={actionTargetId:"encryption-config-view",action:"showSubView"};this.parentView.removeButtonAttribute("btnSave",e),this.parentView.removeButtonAttribute("btnBack",t),this.submitComplete()},submitComplete:function(){var e=this;this.clearBaseHeader();var l='<div class="results-title">Results</div>',c=!1;_.each(this.model.discoveredNodesChecked,function(t){var n=t.getRackableUnitModel()+" (Serial Number: "+t.getRackableUnitSerial()+")",d=!0;_.each(t.NODE_POSITIONS,function(p){if(t.isNodeEnabled(p)){d&&(l+=i({blockTitle:n}),d=!1);var u=t.getRackNodeLabelAt(p),h=t.getNodeUUIDOrSerial(u),m=e.model.forEncryptionOnlyResultsErrorMap[h].length>0,f=e.model.forEncryptionOnlyNodeAddressMap[h],v="";m?(v=s(),c=!0):v=a(),l+=o({statusHTML:v,CVMAddress:f[0],HYPAddress:f[1],IPMIAddress:f[2],nodeLabel:u}),m&&(l+=r({errorMsg:e.model.forEncryptionOnlyResultsErrorMap[h]}))}})}),this.$el.html(l),this.parentView.showButton("Save",!1),this.parentView.showButton("Cancel",!1),this.parentView.showButton("Close",!0),this.parentView.showButton("Back",c),t.fetchOnDemand(),n.refreshView()}})}),define("models/genesis/MatchSignedCertificateModel",["models/genesis/GenesisBaseModel","utils/AppConstants"],function(e,t){"use strict";return e.extend({name:"MatchSignedCertificateModel",methodName:t.NODE_MANAGER_METHODS.MATCH_CERTIFICATE_TO_NODE,
managerName:t.GENESIS.NODE_MANAGER,setRPCParams:function(e){_.extend(this.kwargs,{certificate_list:e})},getErrorResponse:function(){var t=e.prototype.getErrorResponse.apply(this,arguments);if(t)return t;var n=this.getReturnResponse();return null===n||""===n?"Failed to matched signed certificate.":void 0}})}),define("text!templates/popups/hardwareadministration/EncryptionConfigExpandClusterView.html",[],function(){return'<section data-ntnx-section>\n  <div class="n-ec-title"><%= i18n(\'encryption\') %></div>\n  <div class="ec-desc">\n    <%= i18n(\'encryption_description\') %>\n  </div>\n  <div class="n-separator"></div>\n  <div class="download-title">\n    <h4 class="csr-title"></h4>\n    <span class="ec-desc"><%= i18n(\'csr_info\') %></span>\n  </div>\n  <div class="download-csr-wrapper">\n    <table id="discoverNodeDownloadCSR" class="table table-hover">\n      <thead>\n        <tr>\n          <th><%= i18n(\'node_address\') %></th>\n          <th><%= i18n(\'action\') %></th>\n        </tr>\n      </thead>\n      <tbody>\n      </tbody>\n    </table>\n  </div>\n  <div class="n-separator"></div>\n  <div id="kmip-wrapper">\n    <div class="kmip-header-info">\n      <h4 class="csr-title"></h4>\n      <span class="ec-desc">\n        <%= i18n(\'upload_signed_certs\') %>\n      </span>\n    </div>\n    <div id="kmip-entry-container"></div>\n  </div>\n</section>'}),define("text!templates/popups/hardwareadministration/KMIPServerTableExpandCluster.html",[],function(){return'<table id="encryptionKMS-ec" class="table table-hover">\n  <tbody>\n    <tr class="n-table-row">\n      <td class="kmip-name">\n        <span class="col-heading"> Name </span>\n        <span> <%= name %> </span>\n      </td>\n      <td class="kmip-ip-address">\n        <span class="col-heading"> Address </span>\n        \x3c!-- @ span view --\x3e\n      </td>\n      <td>\n        <span class="col-heading"> Action </span>\n        <label class="upload-cert-label">\n          <span data-kmip-files-loading = "<%= name %>"></span>\n          <input type="file" id="UploadCSRfiles-ec" class="btn btn-primary\n            longBtn uploadCSR uploadItem" data-kmip-uuid = "<%= uuid %>"\n            data-kmip-name = "<%= name %>" multiple name="certificateFile" />\n        </label>\n      </td>\n    </tr>\n    <tr class="selectedUploadFiles <%= name %>" style="display:none;">\n      <td colspan="3">\n        <span class="selectedFileName uploadFileName <%= name %>"></span>\n      </td>\n    </tr>\n  </tbody>\n</table>'}),define("text!templates/popups/hardwareadministration/EncryptionConfigExpandClusterNodeRowTemplateView.html",[],function(){return'<tr class="n-table-row">\n  <td>\n    <%=ipv4_address %>\n  </td>\n  <td>\n    <button value="Download All CSRS" class="btn btn-primary downloadCSR"\n      data-node-ip="<%=ipv6_address %>">\n      <%= i18n(\'gen_and_download\') %>\n    </button>\n  </td>\n</tr>'}),define("views/popups/hardwareadmin/EncryptionConfigExpandClusterView",["views/popups/encryption/ConfigFormSubView","views/popups/encryption/ConfigExternalKMSView","models/genesis/MatchSignedCertificateModel","utils/AppUtil","utils/AppConstants","managers/NavigationManager","data/DataProperties","text!templates/popups/hardwareadministration/EncryptionConfigExpandClusterView.html","text!templates/popups/hardwareadministration/KMIPServerTableExpandCluster.html","text!templates/popups/hardwareadministration/EncryptionConfigExpandClusterNodeRowTemplateView.html"],function(e,t,n,i,s,a,o,r,l,c){"use strict";var d=_.template('<div class="kmip-inline-value"><%= key %> : <%= value %></div>'),p=(_.template('<div class="kmip-inline-value"><%=status %></div>'),e.extend({name:"EncryptionConfigExpandClusterView",subViewTemplate:_.template(r),kmipTemplate:_.template(l),nodeTableRowTemplate:_.template(c),loadingInProgress:null,noOfFilesLoaded:null,noOfFilesToBeLoaded:null,nodesInKMSWithNoCert:null,eachNodeToKMIPToFileMap:null,events:{"click  .downloadCSRView":"onClickLinkAction","click  .downloadCSR":"onClickDownloadCSR","click  .btnUpload":"onClickLinkAction","click  .btnSave":"onClickLinkAction","change #UploadCSRfiles-ec":"handleFileSelect"},modelEvents:{"reset   kmipCollection":"renderKMIP","reset   nodeEntries":"fetchKMIPCollection"},initialize:function(t){e.prototype.initialize.apply(this,arguments),this.model=t.model,this.fileStatusCallBacks={},_.bindAll(this,"onFileCompleteLoad","onFileLoadStart"),this.fileStatusCallBacks.load=this.onFileCompleteLoad,this.fileStatusCallBacks.loadStart=this.onFileLoadStart,this.eachNodeToKMIPToFileMap={},this.loadingInProgress=!1,this.noOfFilesLoaded=0,this.noOfFilesToBeLoaded=0,this.nodesInKMSWithNoCert=[],this.eachNodeToKMIPToFileMap={},this.activeKMIPsUUID=[]},refreshView:function(){this.displayRequiredButtons(),this.nodeEntries.fetch()},showView:function(){this.clearBaseHeader(),$(this.el).show()},hideView:function(){$(this.el).hide()},showMessageForLegacyBrowser:function(){var e=i.uploadCheck();e&&(this.showHeaderError(e),this.$(".upload-cert-label").addClass("disabled"),this.$(".uploadCSR").each(function(){$(this).prop("disabled",!0)}))},fetchKMIPCollection:function(){var e=this;if(this.isViewVisible()){this.kmipCollection.fetch().done(function(){e.model.getSuccessfulConfiguredIps().length<8?e.renderDiscoverNodeEntries():e.$(".download-csr-wrapper").hide()})}},displayRequiredButtons:function(){var e=this.parentView,t={actionTargetId:"configuration-results-sed",action:"showSubView"};e.showButton("Next",!0),e.showButton("Back",!0),e.showButton("Save",!1),e.enableButton("btnSave"),e.setButtonAttribute("btnSave",t)},handleFileSelect:function(e){var t=e.target,n=$(t),a=n.attr("data-kmip-name"),o=n.attr("data-kmip-uuid");this.$(".selectedUploadFiles."+a).hide(),this.noOfFilesLoaded=0,this.noOfFilesToBeLoaded=t.files.length,this.loadingInProgress=!1,this.clearBaseHeader(),this.certificateList=[];var r="";if(!i.isIE9OrBelow()){var l=t.files.length;l>0&&(r=l+" "+this.i18n("filesSelected"),this.$(".selectedFileName."+a).empty().text(r),this.$(".selectedUploadFiles."+a).show()),this.currentKMIPUUID=o,this.currentKMIPName=a,this.activeKMIPsUUID&&-1===this.activeKMIPsUUID.indexOf(this.currentKMIPUUID)&&this.activeKMIPsUUID.push(this.currentKMIPUUID),i.loadMultipleFiles(t.files,this.fileStatusCallBacks,s.FILE_TYPE_BASE64)}},onFileLoadStart:function(){this.loadingInProgress||(this.$(".uploadCSR").each(function(){$(this).prop("disabled",!0)}),this.loadingInProgress=!0)},onFileCompleteLoad:function(e,t){var n=e.target.result.split(",")[1];this.certificateList.push(n),this.noOfFilesLoaded++,this.noOfFilesToBeLoaded===this.noOfFilesLoaded&&(this.matchSignedCertificateToNode(),this.loadingInProgress=!1)},matchSignedCertificateToNode:function(){var e=this,t=[];this.nodesInKMSWithNoCert=[],_.each(this.model.forEncryptionOnlyNodeAddressMap,function(i,s){var a=new n;a.setProxyIpv6(i[3]),a.setRPCParams(e.certificateList),t.push(a.fetch({success:function(t,n){var a=t.getReturnResponse();a||e.nodesInKMSWithNoCert.push(i[0]),e.eachNodeToKMIPToFileMap[s]||(e.eachNodeToKMIPToFileMap[s]={}),e.eachNodeToKMIPToFileMap[s][e.currentKMIPUUID]=a},error:function(t,n){e.showHeaderError(n)}}))}),$.when.apply($,t).done(function(){e.removeLoadingUI(),e.showErrorForEachKMS(e.nodesInKMSWithNoCert)}).fail(function(){e.removeLoadingUI()})},removeLoadingUI:function(){this.$(".uploadCSR").each(function(){$(this).prop("disabled",!1)})},showErrorForEachKMS:function(e){if(e.length){var t="No matching certificate found for the following node(s) :"+e.join(",")+" for KMS server "+this.currentKMIPName;this.showHeaderError(t)}},saveViewData:function(e){var t=this;if(this.isNoActiveKMIPs())return void this.showHeaderError(this.i18n("noActiveKMS"));var n=[];if(_.each(this.model.forEncryptionOnlyNodeAddressMap,function(e,i){t.eachNodeToKMIPToFileMap[i]&&_.each(t.activeKMIPsUUID,function(e){n.push({node_uuid:i,digital_certificate_base64:t.eachNodeToKMIPToFileMap[i][e],key_management_server_uuid:e})})}),!this.isEnoughCertsPerNode(this.activeKMIPsUUID,this.model.forEncryptionOnlyNodeAddressMap,n))return void this.showHeaderError(this.i18n("notEnoughCerts"));this.parentView.model.setDigitalCertificateMapList(n),this.triggerAction(s.MODAL.ACT.ALERT_SHOW,{type:s.MODAL.ALERT.TYPE_LOADING}),e()},isEnoughCertsPerNode:function(e,t,n){if(e&&e.length>=1){var i=e.length,s=t&&_.keys(t).length||0;return(n&&n.length||0)>=i*s}return!1},renderKMIPEntries:function(e){var t=this,n=this.$("#kmip-entry-container");if(n.empty(),this.isNoActiveKMIPs())this.$(".n-ec-kmip-title").text("No Active KMS Server(s) at  this time."),$(".btnSave").prop("disabled",!0),this.showHeaderError(this.i18n("noActiveKMS"));else{var i=0;_.each(e,function(e){var s=e.get(o.ENCRYPTION_PROP.NAME);if(-1!==t.kmipCollection.activeKMIP.indexOf(s)){var a=t.kmipTemplate({name:s,uuid:e.get(o.UUID)});n.append(a);var r=t.$(".kmip-ip-address")[i];_.each(e.get(o.ENCRYPTION_PROP.IP_ADDRESS_PORT_MAP),function(e,t){var n=d({key:t,value:e});$(r).append(n)}),i++}})}this.showMessageForLegacyBrowser()},isNoActiveKMIPs:function(){return _.isEmpty(this.kmipCollection.activeKMIP)},renderDiscoverNodeEntries:function(){var e=this,t=this.$("#discoverNodeDownloadCSR > tbody");t.empty(),_.each(this.model.getSuccessfulConfiguredIps(),function(n){var i=e.nodeTableRowTemplate(e.vtOptions({ipv4_address:n.svm_ip.address,ipv6_address:n.ipv6.address}));t.append(i)})},onClickDownloadCSR:function(e){a.executeDownloadAction(s.FILE_ENCRYPTION_EXPAND_CLUSTER_CSR,$(e.currentTarget).attr("data-node-ip"))},_getIPConfigurationData:function(e,t,n){return t?{address:e,netmask:t,gateway:n}:null}}));return t.extend(p.prototype)}),define("text!templates/popups/hardwareadministration/ExpandClusterHypervisorUploadView.html",[],function(){return'\x3c!-- Upgrade Hypervisor binary --\x3e\n<div>\n  <div class="n-version-row upload-binary">\n\n    <section data-ntnx-section>\n      <h5 data-ntnx-title>\n        Hypervisor(s) Needed\n      </h5>\n    </section>\n\n    <%\n      if (hypervisors.length > 0) {\n    %>\n      <section data-ntnx-section="type-text">\n        <%= _.size(hypervisors) %>\n        hypervisor<%= hypervisors.length > 1 ? \'s\' : \'\' %>\n        <%= hypervisors.length > 1 ? \'are\' : \'is\' %>\n        detected. You might need to upload the correct\n        software bundle or ISO image(s) respectively before expanding\n        with selected host(s).\n      </section>\n    <%\n      }\n    %>\n\n    <div class="n-upload-form-container">\n      <%\n        hypervisors.forEach(function(hypervisorObj) {\n          var hypervisor = hypervisorObj.hypervisor,\n              type = hypervisorObj.type;\n      %>\n        <section data-ntnx-section>\n          <div class="section hypervisor-section hyp-<%= type %>">\n\n            <section data-ntnx-section>\n              <h5 data-ntnx-title>\n                Hypervisor : <%= hypervisor.type %>\n                <span class="section-subtitle">\n                  Required by <%= hypervisor.numNodes %>\n                    <%= hypervisor.numNodes > 1 ? \'hosts\' : \'host\' %>\n                </span>\n              </h5>\n            </section>\n\n            <div class="n-iso">\n              <div class="n-iso-details"\n                   style="<%= hypervisor.friendlyName ? \'\' : \'display: none\' %>">\n                <span><%= checkIcon %></span>\n                <span class="n-upload-success">\n                  <%= hypervisor.friendlyName ?\n                    (hypervisor.friendlyName + \' software available\') : \'\' %>\n                </span>\n              </div>\n            </div>\n            <div class="n-upload"\n                 style="<%= hypervisor.friendlyName ? \'\' : \'display: none\' %>">\n              <a class="n-hyp-upload" data-target="<%= type %>">\n                <%= hypervisor.friendlyName ? \'Change File\' : \'Upload File\' %>\n              </a>\n            </div>\n            \x3c!-- The upload form. We use the HTML5 File interface to send the\n                 data and not directly with the form.  --\x3e\n            <form class="form-horizontal formUpload form-hyp-<%= type %>"\n                  style="<%= hypervisor.friendlyName ? \'display: none\' : \'\' %>"\n                  target="upload_target"\n                  method="post"\n                  enctype="multipart/form-data">\n              \x3c!-- File upload indicator --\x3e\n              <div class="n-upload-processing" style="display:none">\n                <div class="n-inline-loading-container">\n                  <div class="n-inline-loading" style="display:block">\n                  </div>\n                </div>\n                \x3c!-- Progress bar --\x3e\n                <div class="n-upload-progress"></div>\n                <div class="n-upload-msg"></div>\n                \x3c!-- Cancel/Retry options --\x3e\n                <div class="upload-options">\n                  <span class="cancel-option"\n                        style="display: none"\n                        data-type="<%= type %>">\n                    <%= cancelIcon %>\n                  </span>\n                  <a class="n-retry-btn"\n                     data-type="<%= type %>"\n                     style="display: none">\n                    Retry\n                  </a>\n                </div>\n              </div>\n              \x3c!-- File browser --\x3e\n              <div class="control-group">\n                <input type="file"\n                       class="inputFile input-hyp-bin"\n                       name="file"\n                       data-type="<%= type %>"/>\n              </div>\n              \x3c!-- Hidden input field --\x3e\n              <input type="hidden" class="md5sum" name="md5sum"/>\n            </form>\n            <% if (hypervisor.isMandatory === false) { %>\n              <div class="control-group skip-imaging">\n                <input type="checkbox" class="n-checkbox skip-img"\n                       data-type="<%= type %>"\n                       data-test="test_expand_cluster_skip_imaging">\n                <span>Skip imaging</span>\n              </div>\n            <% } %>\n            <% if (hasHyperv) { %>\n              <div class="hyperv-sku">\n                <div class="sku-loading" style="display:none">\n                  <div class="n-inline-loading-container">\n                    <div class="n-inline-loading" style="display:block" />\n                  </div>\n                  <div class="sku-loading-msg">Loading SKUs...</div>\n                </div>\n                <div class="sku-options">\n                  <div class="select-sku">Select SKU</div>\n                  <div class="sku-input">\n                    \x3c!-- SKU options go here --\x3e\n                  </div>\n                </div>\n              </div>\n            <% } %>\n          </div>\n        </section>\n      <%\n        });\n\n        if (hypervisors.length < 1) {\n      %>\n        <section data-ntnx-section="type-text">\n          The detected hypervisor on the new node has the same Hypervisor and\n          AOS version as the rest of the nodes on this cluster.\n          No re-imaging needed.\n        </section>\n      <%\n        }\n      %>\n      \x3c!-- Upload Hypervisor compatibility whitelist --\x3e\n      <% if (hypervisors.length) { %>\n      <section data-ntnx-section>\n        <div class="section whitelist-controls">\n          <section data-ntnx-section>\n            <h5 data-ntnx-title class="hyp-whitelist-title">\n              Hypervisor Whitelist\n            </h5>\n            <h5 data-ntnx-title class="hyp-whitelist">\n              <span class="hyp-whitelist-updated section-subtitle">\n                <%= whitelistUpdated ? \'Updated: just now\' : \'Not updated\' %>\n              </span>\n            </h5>\n          </section>\n\n          <section data-ntnx-section="type-text" class="upload-whitelist">\n            <div class="whitelist-upload-success" style="display:none">\n              <span><%= checkIcon %></span>\n              <span class="whitelist-upload-msg"></span>\n            </div>\n            <a class="whitelist-upload">Update</a>\n          </section>\n\n          <form class="form-whitelist-upload" style="display: none">\n            <div class="caution-msg">\n              <span>\n                CAUTION: Make sure you upload a whitelist provided by Nutanix.\n                If you are uploading a customized whitelist please proceed at\n                your own risk.\n              </span>\n              <div class="download-sample-whitelist">\n                <a href="<%= sampleWhitelistDownloadLink %>"\n                   target="_blank"\n                   class="download-whitelist">Download Sample</a>\n              </div>\n            </div>\n            \x3c!-- File browser --\x3e\n            <div class="control-group">\n              <div class="controls">\n                <input type="file" class="inputFile input-whitelist"\n                       name="file" />\n                <a class="btn-upload-whitelist btn btn-control\n                  pull-right"\n                   data-loading-text="Processing">\n                  Upload\n                </a>\n                <div class="n-clearfix"></div>\n              </div>\n              <div class="n-upload-processing" style="display:none">\n                <div class="n-inline-loading-container">\n                  <div class="n-inline-loading" style="display:inline-block">\n                  </div>\n                  <span>Uploading whitelist...</span>\n                </div>\n              </div>\n            </div>\n          </form>\n        </div>\n      </section>\n      <% } %>\n\n      <% if (hasHyperv) { %>\n        <div class="credentials-ctr">\n\n          <section data-ntnx-section>\n            <h5 data-ntnx-title>\n              <%= i18n("credentials", "Credentials") %>\n            </h5>\n          </section>\n\n          <section data-ntnx-section="type-text">\n            <%= i18n("hypervCredentialsDescription") %>\n          </section>\n\n          <section data-ntnx-section>\n            <label data-ntnx-label>\n              <%= i18n("failoverClusterName") %>\n            </label>\n            <input type="text" id="inputHypervClusterName">\n          </section>\n\n          <section data-ntnx-section>\n            <label data-ntnx-label>\n              <%= i18n("hypervUsername") %>\n            </label>\n            <input type="text" id="inputHypervUsername">\n          </section>\n\n          <section data-ntnx-section>\n            <label data-ntnx-label>\n              <%= i18n("password") %>\n            </label>\n            <input type="password" id="inputHypervPassword">\n          </section>\n\n        </div>\n      <% } %>\n      <% if (hasXenserver) { %>\n        <div class="credentials-ctr">\n\n          <section data-ntnx-section>\n            <h5 data-ntnx-title>\n              <%= i18n("credentials") %>\n            </h5>\n          </section>\n\n          <section data-ntnx-section="type-text">\n            <%= i18n("xenCredentialsDescription") %>\n          </section>\n\n          <section data-ntnx-section>\n            <label data-ntnx-label>\n              <%= i18n("xenserverPoolMasterUsername") %>\n            </label>\n            <input type="text" id="inputXenUsername">\n          </section>\n\n          <section data-ntnx-section>\n            <label data-ntnx-label>\n              <%= i18n("xenserverPoolMasterPassword") %>\n            </label>\n            <input type="password" id="inputXenPassword">\n          </section>\n        </div>\n      <% } %>\n    </div>\n    \x3c!-- This makes sure that the form will not refresh the page. This could be\n         used when upload form in IE9 is supported. --\x3e\n    <iframe id="uploadTarget" name="upload_target" />\n  </div>\n</div>'}),define("models/genesis/ExpandClusterModel",["models/genesis/GenesisBaseModel","utils/AppConstants"],function(e,t){"use strict";return e.extend({name:"ExpandClusterModel",methodName:t.CLUSTER_MANAGER_METHODS.EXPAND_CLUSTER,managerName:t.GENESIS.CLUSTER_MANAGER,getErrorResponse:function(){return this.getParsedErrorResponse("Failed to expand cluster.")},getReturnResponse:function(){return this.get(e.DP.GENESIS_RETURN)||[]},setRPCParams:function(e,t,n,i){_.extend(this.kwargs,{node_params:e}),t&&_.extend(this.kwargs,{extra_params:t}),"boolean"==typeof n&&_.extend(this.kwargs,{skip_add_node:n}),"boolean"==typeof i&&_.extend(this.kwargs,{skip_pre_expand_checks:i})}})}),define("models/genesis/ValidateExpandClusterModel",["models/genesis/GenesisBaseModel","utils/AppConstants"],function(e,t){"use strict";return e.extend({name:"ExpandClusterModel",methodName:t.CLUSTER_MANAGER_METHODS.VALIDATE_EXPAND_CLUSTER,managerName:t.GENESIS.CLUSTER_MANAGER,getErrorResponse:function(){return this.getParsedErrorResponse("Failed to expand cluster.")},getReturnResponse:function(){return this.get(e.DP.GENESIS_RETURN)||[]},setRPCParams:function(e,t){_.extend(this.kwargs,{node_params:e}),t&&_.extend(this.kwargs,{extra_params:t})}})});var _slicedToArray=function(){function e(e,t){var n=[],i=!0,s=!1,a=void 0;try{for(var o,r=e[Symbol.iterator]();!(i=(o=r.next()).done)&&(n.push(o.value),!t||n.length!==t);i=!0);}catch(e){s=!0,a=e}finally{try{!i&&r.return&&r.return()}finally{if(s)throw a}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();define("views/popups/hardwareadmin/ExpandClusterHostConfigView",["data/DataProperties","data/DataURLConstants","managers/TaskManager","managers/LicenseManager","managers/IdleManager","views/basecomponents/popups/BasePopupSubView","utils/AppConstants","utils/AppUtil","utils/VisualizationUtil","utils/HypervisorUtil","utils/SVG","text!templates/popups/hardwareadministration/ExpandClusterHypervisorUploadView.html","models/genesis/ExpandClusterModel","models/genesis/ValidateExpandClusterModel","models/genesis/SkuModel"],function(e,t,n,i,s,a,o,r,l,c,d,p,u,h,m){"use strict";var f=_.template(p),v=_.template('<div><input type="radio" name="sku" value="<%= value %>" id="sku-<%= value %>" <%= checked ? "checked" : "" %>><label for="sku-<%= value %>"><%= name %></label></div>'),g=_.template('\n      <div class="-warnings">\n        <%= heading %>\n        <ul>\n          <% _.each(warnings, function(warning) { %>\n            <li><%= warning %></li>\n          <% }) %>\n        </ul>\n      </div>\n    ');return a.extend({name:"ExpandClusterHostConfigView",initialized:!1,isError:!1,hypervisorNodeMap:null,events:{"click .n-hyp-upload":"showHypervisorUploadForm","change .input-hyp-bin":"uploadHypervisorFile","click .input-hyp-bin":"resetInputFile","click .cancel-option":"onCancelFileUpload","click .n-retry-btn":"onRetryUpload","click .whitelist-upload":"toggleWhitelistUploadForm","click .btn-upload-whitelist":"uploadWhitelist","change .skip-img":"toggleSkipImaging","change .input-whitelist":"hintWhitelistUpload"},initialize:function(e){a.prototype.initialize.apply(this,arguments),this.model=e.model,this.hypervisorNodeMap={}},render:function(){var n=this;if(this.clearBaseHeader(),r.debug("ExpandClusterHostConfigView : render: "," | viewid     : ",this.cid),this.initialized){this.hypervisorNodeMap=this.model.getHypervisorsForNodes();var i={},s=[];_.each(this.hypervisorNodeMap,function(e,t){n.model.setSkipImaging(t,!1);var a=[o.SOFTWARE_RELEASES_HYP_TYPE.HYPERV,o.SOFTWARE_RELEASES_HYP_TYPE.XEN];_.contains(a,t)&&s.push(t),i[t]={numNodes:e.nodeUuids?e.nodeUuids.length:0,type:c.getFormattedHypervisorType(t),friendlyName:null,isMandatory:e.isMandatory}}),_.each(this.model.getAvailableHypervisorInstallerModels(),function(t){t.get(e.UPGRADE_STATUS)!==o.UPGRADE_SOFTWARE_RELEASE_STATUS.COMPLETED&&t.get(e.UPGRADE_CURRENT_TOTAL_IN_BYTES)!==t.get(e.UPGRADE_CURRENT_SIZE_IN_BYTES)||i[t.get(e.HYPERVISOR_TYPE)]&&(i[t.get(e.HYPERVISOR_TYPE)].friendlyName=t.get(e.UPGRADE_NAME))});var a=_.contains(s,o.SOFTWARE_RELEASES_HYP_TYPE.HYPERV),l=_.contains(s,o.SOFTWARE_RELEASES_HYP_TYPE.XEN),p=_.map(i,function(e,t){return{hypervisor:e,type:t}}).filter(function(e){if("null"!==e.type&&!_.isNull(e.hypervisor.isMandatory))return!0;n.model.setSkipImaging(e.type,!0)});if(this.$el.html(f(this.vtOptions({requireCredentials:s,hasHyperv:a,hasXenserver:l,numNodes:this.model.getNumNodes(),hypervisors:p,whitelistUpdated:this.model.getClusterWhitelistUpdateSuccess(),checkIcon:d.SVGIcon("G","check-icon",""),cancelIcon:d.SVGIcon("K","cancel-icon",""),sampleWhitelistDownloadLink:t.SAMPLE_EXPAND_CLUSTER_WHITELIST_PATH}))),a){var u=this.model.getHypervisorISO(o.SOFTWARE_RELEASES_HYP_TYPE.HYPERV);u?this.fetchSKUs(u):this.renderSKUOptions()}var h=this.model.getCompatibilityMessage();h&&this.triggerAction(o.MODAL.ACT.ALERT_SHOW,{type:o.MODAL.ALERT.TYPE_INFO,message:h,closeTiming:o.MODAL.ALERT.CLOSE_TYPE_PERMANENT})}this.applyNutanixInput(),this.triggerAction(o.MODAL.ACT.AS_REBUILD)},destroy:function(){r.debug("ExpandClusterHostConfigView : destroy: "," | viewid     : ",this.cid),this.clearBaseHeader(),a.prototype.destroy.apply(this,arguments)},showView:function(){this.clearBaseHeader(),this.$el.empty(),r.debug("ExpandClusterPopupHostConfigView : show: "," | viewid     : ",this.cid),a.prototype.showView.apply(this,arguments);var t=this.parentView;t.showButton("Save",!1),t.showButton("Close",!1),t.showButton("Cancel",!1),t.showButton("Next",!1),this.loadCompatibleHypervisors(),i.getLicenseModel().get(e.LICENSE_CATEGORY)!==e.LICENSE_STANDARD&&this.$(".add-license-info").show()},loadCompatibleHypervisors:function(){var t=this;this.triggerAction(o.MODAL.ACT.ALERT_SHOW,{type:o.MODAL.ALERT.TYPE_LOADING});var n=this.model.getExpandNodeConfigurationList(),i=[];_.each(n,function(e){i.push({node_uuid:e.node_uuid,block_id:e.block_id,model:e.model,node_position:e.node_position,is_light_compute:e.is_light_compute})}),this.model.fetchAvailableHypervisorInstallers(i,{success:function(){_.each(t.model.getAvailableHypervisorInstallerModels(),function(n){t.model.setHypervisorISO(n.get(e.HYPERVISOR_TYPE),n.get(e.UPGRADE_MD5SUM))}),t.initialized=!0,t.render(),t.enableControlButtons();var n=(t.model.getHypervisorsForNodes(),t.parentView);n.showButton("Back",!0),n.showButton("Validate",!0),n.showButton("ExpandCluster",!0),t._checkImagingStatus()},error:function(e){var n=e;r.log(n);var i="Unable to get available Hypervisor images. ";i+=n||"",t.triggerAction(o.MODAL.ACT.ALERT_SHOW,{type:o.MODAL.ALERT.TYPE_ERROR,message:i}),t.isError=!0;var s=t.parentView;s.showButton("Save",!1),s.showButton("Close",!1),s.showButton("Cancel",!0),s.showButton("NextImg",!1),s.showButton("Validate",!1),s.showButton("ExpandCluster",!1)}})},_checkImagingStatus:function(){var e=this,t=this.model.getHypervisorsForNodes();this.enableControlButtons();var n=!1;_.each(t,function(t,i){e.model.getSkipImaging()||e.model.getHypervisorISO(i)||(n=!0)}),n&&this.disableControlButtons()},hintWhitelistUpload:function(e){this.$(".btn-upload-whitelist").addClass("-blue")},showSKULoading:function(){this.$(".sku-loading").show(),this.$(".sku-options").hide()},renderSKUOptions:function(e){var t="";e=e||this.model.DEFAULT_SKU_MAP;var n=!0;_.each(e,function(e,i){r.isInt(i)&&(i=e,e=this.model.DEFAULT_SKU_MAP[i]||i),t+=v({value:i,name:e,checked:n}),n=!1},this),this.$(".sku-input").html(t),this.applyNutanixInput(),this.$(".sku-loading").hide(),this.$(".sku-options").show()},fetchSKUs:function(e){var t=this,n=new m;n.setRPCParams(e),this.showSKULoading(),n.fetch({success:function(e){var n=e.getParsedReturnResponse();t.renderSKUOptions(n)},error:function(e,n){var i=n;r.log(i);var s="Unable to fetch SKUs. ";s+=i||"",t.triggerAction(o.MODAL.ACT.ALERT_SHOW,{type:o.MODAL.ALERT.TYPE_ERROR,message:s}),t.isError=!0,t.renderSKUOptions()}})},showUploadWait:function(e,t,n){var i=e.find(".n-upload-processing");t||(t="Uploading file..."),i.find(".n-upload-msg").html(t).attr("title",t),n?(i.find(".n-upload-progress").show(),i.find(".n-inline-loading-container").hide()):(i.find(".n-upload-progress").hide(),i.find(".n-inline-loading-container").show()),i.show()},hideUploadWait:function(e,t){e.find(".n-upload-processing").hide()},disableControlButtons:function(){this.parentView.disableButton("btnValidate"),this.parentView.disableButton("btnExpandCluster")},enableControlButtons:function(){this.parentView.enableButton("btnValidate"),this.parentView.enableButton("btnExpandCluster")},showHypervisorUploadForm:function(e){var t=$(e.currentTarget).attr("data-target"),n=this.$(".form-hyp-"+t);n.show(),n.find(".input-hyp-bin").show()},toggleWhitelistUploadForm:function(e){this.$(".form-whitelist-upload").toggle()},toggleSkipImaging:function(e){var t=$(e.currentTarget).attr("data-type"),n=$(e.currentTarget).is(":checked");this.$(".input-hyp-bin").prop(o.FORM_ATTR.DISABLED,n),this.model.setSkipImaging(t,n),this._checkImagingStatus()},uploadWhitelist:function(e){var t=this,n=this.$(".form-whitelist-upload"),i=n[0].file.files[0];i?(this.$(".form-whitelist-upload .n-upload-processing").show(),this.model.uploadWhitelist(i,function(){t.$(".hyp-whitelist-updated").html("Updated: just now"),t.$(".form-whitelist-upload .n-upload-processing").hide(),t.$(".whitelist-upload-msg").html(i.name),t.$(".whitelist-upload-success").show(),t.$(".form-whitelist-upload").hide()},function(e){t.triggerAction(o.MODAL.ACT.ALERT_SHOW,{type:o.MODAL.ALERT.TYPE_ERROR,message:e}),t.$(".form-whitelist-upload .n-upload-processing").hide()})):this.triggerAction(o.MODAL.ACT.ALERT_SHOW,{type:o.MODAL.ALERT.TYPE_ERROR,message:"Please select a file"})},onCancelFileUpload:function(e){var t=$(e.currentTarget).attr("data-type");_.each(this.model.getUploadingHypervisors(),function(e,n){if(n===t){var i=e.xhr;i&&i.abort()}}),this.model.endHypervisorUpload(t);var i=this.model.getHypervisorISO(t),s=$(".hyp-"+t);s.find(".cancel-option").hide(),this.renderProgressBarError(t),this.hideUploadWait(this.$(".form-hyp-"+t)),this.enableControlButtons(),i?(s.find(".n-upload").show(),s.find(".input-hyp-bin").hide()):(s.find(".n-upload").hide(),s.find(".input-hyp-bin").show()),n.fetchOnDemand()},onRetryUpload:function(e){var t=$(e.currentTarget).attr("data-type");this.$(".hyp-"+t+" .n-retry-btn").hide(),this.uploadHypervisorFile(e,!0),n.fetchOnDemand()},renderUploadSuccess:function(e,t){var i=$(".hyp-"+e);i.find(".n-upload-success").html(t),i.find(".n-iso-details").show(),this.hideUploadWait(i.find(".form-hyp-"+e)),i.find(".n-hyp-upload").html("Change File"),i.find(".n-upload").show(),i.find(".input-hyp-bin").hide(),this.enableControlButtons(),n.fetchOnDemand()},renderUploadFailed:function(e,t,i,s){var a=this.model.getHypervisorISO(e),r=$(".hyp-"+e);a?(r.find(".n-upload").show(),r.find(".input-hyp-bin").hide()):(r.find(".n-upload").hide(),r.find(".input-hyp-bin").show()),s?(this.showUploadWait(r.find(".form-hyp-"+e),"Error: "+i,!0),r.find(".n-retry-btn").show(),r.find(".cancel-option").hide()):this.hideUploadWait(r.find(".form-hyp-"+e));var l=r.find(".form-hyp-"+e);l&&l.length&&l[0].reset(),this.triggerAction(o.MODAL.ACT.ALERT_SHOW,{type:o.MODAL.ALERT.TYPE_ERROR,message:t}),this.renderProgressBarError(e),this.disableControlButtons(),n.fetchOnDemand()},renderCompatibilityChecking:function(e,t,n){this.clearBaseHeader(),t.hide(),this.showUploadWait(n,"Checking compatibility..."),this.$(".hyp-"+e+" .n-upload").hide()},renderSoftwareUploading:function(e,t,i){this.showUploadWait(t,"Uploading: "+i,!0),this.$(".hyp-"+e+" .n-upload").hide(),t.find(".cancel-option").show(),t.find(".n-retry-btn").hide(),this.refreshProgressBar(e,null,!1),n.fetchOnDemand()},renderProgressBarError:function(e){this.$(".form-hyp-"+e+" .n-progress-bar").addClass("error")},_startUpload:function(e,t,n,i,s,a){var r=this;this.model.validateFileForCompatibility(e,t,s,function(){r._validationSuccess.call(r,e,t,s,n,a,i)},function(e){r.triggerAction(o.MODAL.ACT.ALERT_SHOW,{
type:o.MODAL.ALERT.TYPE_ERROR,message:e}),r.renderUploadFailed(n,e,i,!1)})},_uploadSuccess:function(t,n,i){this.model.setHypervisorISO(t,n),this.model.endHypervisorUpload(t);var s=this.model.getSoftwareReleaseModel(n);s&&(i=s.get(e.UPGRADE_NAME)||i),this.renderUploadSuccess.call(this,t,i);var a=this.model.getUploadingHypervisors();0===_.size(a)&&this.model.stopPollingSoftwareReleases()},_uploadError:function(e,t,n){this.renderUploadFailed.call(this,t,e,n,!0),this.model.endHypervisorUpload(t);var i=this.model.getUploadingHypervisors();0===_.size(i)&&this.model.stopPollingSoftwareReleases()},_validationSuccess:function(e,t,n,i,s,a){var o=this,r=this.model.uploadHypervisorImageWithMD5(e,t,n,function(){o._uploadSuccess.call(o,i,t,a)},function(e){o._uploadError.call(o,e,i,a)});this.renderSoftwareUploading.call(this,i,s,a),this.model.startHypervisorUpload(i,{name:encodeURI(a),md5:t,xhr:r}),this.model.startPollingSoftwareReleases()},resetInputFile:function(e){$(e.currentTarget).val(null)},uploadHypervisorFile:function(e,t){var n=this,i=$(e.currentTarget),s=i.attr("data-type"),a=this.$(".form-hyp-"+s),l=a[0].file.files[0],c=l?l.name:"";if(l){this.disableControlButtons(),_.each(this.model.getUploadingHypervisors(),function(e,t){if(t===s){var i=e.xhr;i&&i.abort(),n.model.endHypervisorUpload(s)}}),this.renderCompatibilityChecking.call(this,s,i,a);var d=this.model.getExpandNodeConfigurationList(),p=[];if(_.each(this.hypervisorNodeMap[s].nodeUuids,function(e){var t=_.find(d,function(t){return t.node_uuid===e});p.push(t)}),t){var u=a.find('input[name="md5sum"]').val().trim();if(u)return void this._startUpload(l,u,s,c,p,a)}r.calculateFileMD5Async(l,{},function(e){a.find('input[name="md5sum"]').val(e),s===o.SOFTWARE_RELEASES_HYP_TYPE.HYPERV&&n.fetchSKUs(e),n._startUpload(l,e,s,c,p,a)})}else this.triggerAction(o.MODAL.ACT.ALERT_SHOW,{type:o.MODAL.ALERT.TYPE_ERROR,message:"Please select a file to upload."})},onSoftwareReleasesChange:function(){var e=this;this.model&&this.model.isUploadInProgress()&&_.each(this.model.getUploadingHypervisors(),function(t,n){var i=e.model.getSoftwareReleaseModel(t.md5);i&&e.refreshProgressBar(n,i)})},refreshProgressBar:function(t,n,i){var a=this.$(".form-hyp-"+t),r=0,c=null;n&&(r=Math.round(n.get(e.UPGRADE_CURRENT_SIZE_IN_BYTES)/n.get(e.UPGRADE_CURRENT_TOTAL_IN_BYTES)*100),c=n.get(e.UPGRADE_STATUS)),i=i||c===o.TASK_STATUS_FAILED||c===o.TASK_STATUS_CANCELED||c===o.TASK_STATUS_ABORTED,a.find(".n-upload-progress").html(l.renderProgressBar({barClass:"n-progress-bar "+(i?"error":""),percentUsed:r})),s.reset()},saveViewData:function(e,t){this.onSubmit(e,t)},onBack:function(){this.disableControlButtons()},onSubmit:function(e,t){this.validateForm()&&(this.parentView.disableButton("btnExpandCluster"),this.triggerAction(o.MODAL.ACT.ALERT_SHOW,{type:o.MODAL.ALERT.TYPE_SAVING}),this._submit(e,t))},validateForm:function(){var e={},t=this.$(".credentials-ctr"),n=t.find("#inputHypervUsername"),i=t.find("#inputHypervPassword"),s=t.find("#inputHypervClusterName");if(n.length>0&&i.length>0){var a=n.val().trim(),r=i.val().trim(),l=s.val().trim();t.find(".form-control-error").removeClass("form-control-error");var c=[];if(0===a.length&&c.push(n),0===r.length&&c.push(i),0===l.length&&c.push(s),c.length>0)return this.triggerAction(o.MODAL.ACT.ALERT_SHOW,{type:o.MODAL.ALERT.TYPE_ERROR,message:this.i18n("hypervMissingCredentialsError")}),_.each(c,function(e){e.addClass("form-control-error")}),!1;e[o.SOFTWARE_RELEASES_HYP_TYPE.HYPERV]={domain_details:{username:a,password:r},failover_cluster_details:{username:a,password:r,cluster_name:l}}}var d=t.find("#inputXenUsername"),p=t.find("#inputXenPassword");if(d.length>0&&p.length>0){var u=d.val().trim(),h=p.val().trim();e[o.SOFTWARE_RELEASES_HYP_TYPE.XEN]={xen_pool_master_username:u,xen_pool_master_password:h}}this.model.setCredentials(e);var m=this.$('input[type="radio"][name="sku"]:checked');return m.length>0&&this.model.setHypervSKU(m.val()),!this.model.isUploadInProgress()||(this.triggerAction(o.MODAL.ACT.ALERT_SHOW,{type:o.MODAL.ALERT.TYPE_ERROR,message:"Software upload is in progress. Please wait for it to complete."}),!1)},_expand_cluster:function(e,t){var n=this,i=new u;i.setRPCParams(this.model.getExpandNodeConfiguration(),this.model.getAdditionalExpandClusterInfo(),!1,e),this.triggerAction(o.MODAL.ACT.ALERT_SHOW,{type:o.MODAL.ALERT.TYPE_INFO,message:this.i18n("submit_expand_cluster")}),i.save({success:function(){t&&t()},error:function(e,t){var i=t;r.log("ExpandClusterPopupView: Error on ","expandCluster: ","error:",i),n.triggerAction(o.MODAL.ACT.ALERT_SHOW,{type:o.MODAL.ALERT.TYPE_ERROR,message:i}),n.parentView.enableButton("btnExpandCluster")}})},_submit:function(e,t){var n=this;this.combinedErrorMessage="";var i=new h;i.setRPCParams(this.model.getExpandNodeConfiguration(),this.model.getAdditionalExpandClusterInfo()),this.triggerAction(o.MODAL.ACT.ALERT_SHOW,{type:o.MODAL.ALERT.TYPE_INFO,message:this.i18n("validate_expand_cluster")}),i.save({success:function(i){var s=i.getReturnResponse(),a=_slicedToArray(s,2),r=a[0],l=a[1];r.length?r.forEach(function(e){n.triggerAction(o.MODAL.ACT.ALERT_SHOW,{type:o.MODAL.ALERT.TYPE_ERROR,message:e})}):l.length?$.nutanixConfirm({yes:function(){n._expand_cluster(t,e)},msg:g({warnings:l,heading:n.i18n("fault_tolerance_warnings_found")})}):n._expand_cluster(t,e)},error:function(e,t){var i=t;r.log("ExpandClusterPopupView: Error on ","validateExpandCluster: ","error:",i),n.triggerAction(o.MODAL.ACT.ALERT_SHOW,{type:o.MODAL.ALERT.TYPE_ERROR,message:i}),n.parentView.enableButton("btnExpandCluster")}})},validate:function(e){var t=this;if(this.validateForm()){var n=new u;n.setRPCParams(this.model.getExpandNodeConfiguration(),this.model.getAdditionalExpandClusterInfo(),!0,!1),this.triggerAction(o.MODAL.ACT.ALERT_SHOW,{type:o.MODAL.ALERT.TYPE_INFO,message:"Running pre-expand cluster checks..."}),n.fetch({success:function(){e&&e()},error:function(e,n){var i=n;r.log("ExpandClusterPopupView: Error on ","expandCluster validate operation: ","error:",i),t.triggerAction(o.MODAL.ACT.ALERT_SHOW,{type:o.MODAL.ALERT.TYPE_ERROR,message:i})}})}}})}),define("text!templates/popups/hardwareadministration/ExpandClusterHostRackConfigView.html",[],function(){return'\x3c!-- ExpandClusterHostRackConfigView --\x3e\n<div class="rack-config-accordion accordion">\n  <% _.each( blocks, function(block, index) { %>\n    <div class="accordion-item block <%= (index === 0)? \'active\': \'\' %>">\n      <div class="accordion-item-header block-model"\n           data-block-id="<%= block.nodeId %>">\n        <div data-ntnx-form-inline="" class="checkbox-container">\n          <label data-ntnx-inline-label="">\n            <span class="block-model-name">\n              <%= block.model %>\n            </span>\n              <span class="block-serial">\n              <%= i18ns(\'serial_number\', block.serial) %>\n            </span>\n          </label>\n          <span class="accordion-caret">\n            <%= Components.icon(\'caret-down\') %>\n          </span>\n        </div>\n      </div>\n      <div class="accordion-item-body block-details block-row"\n        id="<%= block.nodeId %>">\n        <section class="block-row-top" data-ntnx-section>\n          \x3c!-- The 4 boxes UI--\x3e\n          <div class="node-group">\n            \x3c!-- nodeTitles are tuples:\n            [position, label, hypervisor type, hypervisor version] --\x3e\n            <% _.each( block.nodeTitles, function(nodeTitle) {\n              if ( nodeTitle[1] ) {\n            %>\n            <div class="node-item" data-position="<%= nodeTitle[0] %>">\n              \x3c!--  By default checked and disabled. Turned on when the user\n                    selects this block. --\x3e\n              <div data-ntnx-form-inline class="checkbox-container">\n                <label title="<%= nodeTitle[1] %>"\n                  data-ntnx-inline-label class="label-ip">\n                  <%= nodeTitle[1] %>\n                  <span class=\'controllervm-ip\'\n                    id="controllervm-ip-<%= nodeTitle[0] %>"></span>\n                </label>\n              </div>\n\n              <span class="nutanixMoreInfo"\n                data-tooltip-container="body"\n                data-tooltip-icon="information-tooltip"\n                data-tooltip-title="<%- nodeTitle[2] || i18n(\'hypervisor_null\') %>\n                      <%- nodeTitle[3] ? \' (\' + nodeTitle[3] + \')\' : \'\' %>">\n              </span>\n            </div>\n            <% } else { %>\n            <div class="node-item node-item-inactive"\n                 data-position="<%= nodeTitle[0] %>"></div>\n            <% }\n            })%>\n          </div>\n        </section>\n        <div class="rack-selection-wrapper" data-ntnx-section>\n          <div data-ntnx-label>\n            <span>\n              <%= i18n(\'assign_to_rack\') %>\n            </span>\n            <span class="pull-right">\n              <a href="javascript: void(0);" class="create-rack"\n                data-toggle="modal"\n                data-target=".create-rack-popup"\n                data-test="test_assign_rack_create_rack">\n                <%= Components.icon(\'plus\', \'-small -inline\') %>\n                <%= i18n(\'create_rack\') %>\n              </a>\n            </span>\n          </div>\n          <%= Components.select({\n            options: block.rackOptions,\n            variants: \'bottom-anchor\',\n            attributes: `data-block-id="${block.serial}"`,\n            dataTestAttribute: \'test_assign_rack_drop_down\'\n          }) %>\n        </div>\n      </div>\n    </div>\n  <% }) %>\n</div>'}),define("views/popups/hardwareadmin/ExpandClusterHostRackConfigView",["bluebird","data/DataURLConstants","views/basecomponents/popups/BasePopupSubView","utils/AppConstants","utils/AppUtil","utils/SubViewHelper","utils/HypervisorUtil","text!templates/popups/hardwareadministration/ExpandClusterHostRackConfigView.html","models/hardware/HostCollection","models/intent/IntentParser"],function(e,t,n,i,s,a,o,r,l,c){"use strict";return n.extend({name:"ExpandClusterHostRackConfigView",initialized:!1,rackService:null,blocks:[],racks:[],events:{"change .rack-selection-wrapper select":"onRackChange","click .accordion-item-header":"onBlockSelected"},initialize:function(e){var o=this;n.prototype.initialize.apply(this,arguments),this.model=e.model,this.blocks=e.blocks,this.subViewHelper=new a,this.hostCollection=new l;var r=c.getInstance();this.rackService=r.getServiceByEntityType(i.ENTITY_RACK),$("body").on("click",".assign-rack-popover .btn.btn-default",function(){o.$(".create-rack").popover("hide")}).on("click",".assign-rack-popover .btn.btn-primary",function(){var e=$('.assign-rack-popover [name="rack-name"]').val();if(o.racks.find(function(t){return t.status.name.toLowerCase()===e.toLowerCase()}))return void o.triggerAction(i.MODAL.ACT.ALERT_SHOW,{type:i.MODAL.ALERT.TYPE_ERROR,message:o.i18ns("duplicate_new_rack_error",e)});o.triggerAction(i.MODAL.ACT.ALERT_SHOW,{type:i.MODAL.ALERT.TYPE_LOADING});var n=o.rackService.then(function(n){return n.post({$url:"/"+t.RACKS,$body:{name:e,resources:{}}})}),a=!1;n.then(function(){return o.rackService.then(function(e){return e.all({})})}).catch(function(t){throw a=!0,s.log("ExpandClusterHostRackConfigView: initialize: ",t),o.triggerAction(i.MODAL.ACT.ALERT_SHOW,{type:i.MODAL.ALERT.TYPE_ERROR,message:o.i18ns("new_rack_error",e)}),t}).then(function(e){o.racks=e.entities,o.$(".create-rack").popover("hide"),o.triggerAction(i.MODAL.ACT.ALERT_HIDE),o.refreshDataContentView()}).catch(function(){a||o.triggerAction(i.MODAL.ACT.ALERT_SHOW,{type:i.MODAL.ALERT.TYPE_ERROR,message:o.i18n("rack_fetch_error")})})})},render:function(){s.debug("ExpandClusterHostRackConfigView : render: "," | viewid     : ",this.cid)},destroy:function(){s.debug("ExpandClusterHostRackConfigView : destroy: "," | viewid     : ",this.cid),this.clearBaseHeader(),this.$(".nutanixMoreInfo").nutanixMoreInfo("destroy"),this.$(".create-rack").popover("destroy"),$("body").off("click",".btn.btn-default").off("click",".btn.btn-primary"),n.prototype.destroy.apply(this,arguments)},showView:function(){s.debug("ExpandClusterHostRackConfigView : show: "," | viewid     : ",this.cid),n.prototype.showView.apply(this,arguments);var e=this.parentView;e.showButton("Save",!1),e.showButton("Close",!1),e.showButton("Cancel",!0),e.showButton("NextImg",!1),e.showButton("Back",!0),e.showButton("NextImg.host-config-btn",!0),this.viewOption&&!1===this.viewOption.refreshView&&(e.showButton("Validate",!1),e.showButton("ExpandCluster",!1),e.showButton("Next",!0)),this.viewOption&&!1!==this.viewOption.refreshView&&this.loadUnconfiguredNodes()},onRackChange:function(e){var t=this.$(e.target).val(),n=this.$(e.target).attr("data-block-id"),i=this.racks.find(function(e){return e.metadata.uuid===t}),s=this.model.getExpandNodeConfigurationBlockList(),a=s.find(function(e){return e.block_id===n});a?a.rack_name=i.status.name:s.push({block_id:n,rack_name:i.status.name})},onBlockSelected:function(e){$(".accordion-item").removeClass("active"),$(e.target).closest(".accordion-item").addClass("active")},saveViewData:function(e){this.onSubmit(e)},onSubmit:function(e){var t=this.getNodeWithNoRackMapping();if(t)return void this.triggerAction(i.MODAL.ACT.ALERT_SHOW,{type:i.MODAL.ALERT.TYPE_ERROR,message:this.i18ns("map_all_blocks_to_rack",t.getRackableUnitSerial())});"function"==typeof e&&e()},getNodeWithNoRackMapping:function(){var e=this.model.getExpandNodeConfigurationBlockList(),t={};e.forEach(function(e){t[e.block_id]=!0});var n=this.selectedNodes(),i=Object.keys(n).find(function(e){var i=n[e];return!t[i.getRackableUnitSerial()]});return n[i]},setViewOption:function(e){this.viewOption=e},loadUnconfiguredNodes:function(){var t=this;this.triggerAction(i.MODAL.ACT.ALERT_SHOW,{type:i.MODAL.ALERT.TYPE_LOADING});var n=this.rackService.then(function(e){return e.all()});n.catch(function(){t.triggerAction(i.MODAL.ACT.ALERT_SHOW,{type:i.MODAL.ALERT.TYPE_ERROR,message:t.i18n("rack_fetch_error")})});var s=e.resolve(this.hostCollection.fetch());s.catch(function(){t.triggerAction(i.MODAL.ACT.ALERT_SHOW,{type:i.MODAL.ALERT.TYPE_ERROR,message:t.i18n("host_fetch_error")})}),e.join(n,s,function(e){t.racks=e.entities,t.refreshDataContentView()})},refreshDataContentView:function(){var e=this;this.clearBaseHeader(),this.model.setExpandNodeConfigurationBlockList([]),this.$el.html("");var t=[];_.each(this.selectedNodes(),function(n){var i=n.getBlockId(),s=n.isModelSupported(),a=n.getRackableUnitModel(!0),r=n.getRackableUnitSerial(),l=[];_.each(n.getDisplayedNodePositions(),function(e){var t=n.getRackNodeAt(e),i=o.getFormattedHypervisorType(t?t.hypervisor:""),s=t?t.hypervisor_version:"",a=t?t.node_uuid:"";l.push([e,n.getRackNodeLabelAt(e),i,s,a])});var c="rack-node-"+i,d=e.getBlockBySerial(r),p=null;d&&d.status.resources.rack_reference&&(p=d.status.resources.rack_reference.uuid);var u=e.getRackOptions(p);p?e.updateBlockList(r,p):u.splice(0,0,{name:"Select Rack",value:"",disabled:!0,selected:!0}),t.push({model:a,serial:r,nodeId:c,nodeTitles:l,isModelSupported:s,rackOptions:u})}),this.initialized=!0,this.$el.html(_.template(r,this.vtOptions({blocks:t}))),this.triggerAction(i.MODAL.ACT.AS_REBUILD),this.$(".nutanixMoreInfo").nutanixMoreInfo({parseDataAttrs:!0}),this.$(".create-rack").popover({trigger:"click",content:_.template('<div class="assign-rack-popover"><div data-ntnx-section class="text-left"><span data-ntnx-label><label><%=i18n(\'name\')%></label><input type="text" name="rack-name" value="" data-test="test_assign_rack_enter_new_rack_name" placeholder="<%= i18n(\'new_rack_name\')%>" /></span></div><div class="modal-footer" data-ntnx-section><button type="button"class="btn btn-default"data-test="test_assign_rack_new_rack_cancel_btn"data-dismiss="modal"><%=i18n("close")%></button><button type="button"data-test="test_assign_rack_new_rack_ok_btn"class="btn btn-primary"><%=i18n("save")%></button></div></div>',this.vtOptions({})),html:!0,placement:"right",container:"body",title:this.i18n("new_rack")})},selectedNodes:function(){return this.model.discoveredNodesChecked},updateBlockList:function(e,t){var n=this;return this.racks.forEach(function(i){var s=n.model.getExpandNodeConfigurationBlockList();i.metadata.uuid===t&&s.push({block_id:e,rack_name:i.status.name})})},getRackOptions:function(e){return this.racks.map(function(t){return{name:t.status.name,value:t.metadata.uuid,selected:t.metadata.uuid===e}})},getBlockBySerial:function(e){return this.blocks.find(function(t){return t.status.serial===e})}})}),define("text!templates/popups/hardwareadministration/ExpandClusterProgressView.html",[],function(){return'<section data-ntnx-section class="task">\n  <% if (showMasterProgressBar) { %>\n  <div class="status">\n    <div class="title"><%= title %></div>\n    <%= VisualizationUtil.renderProgressBar({\n      barClass: \'n-progress-bar \' + task.get(propStatus),\n      percentUsed: task.get(propPercentComplete),\n      rightTextLabel: task.get(propPercentComplete) ?\n      task.get(propPercentComplete) + \' %\' : \'\'\n    }) %>\n  </div>\n  <% } else { %>\n  <div class="status percent-complete">\n    <h2><%= task && task.get(propPercentComplete) ?\n      task.get(propPercentComplete) + \' %\' : \'\'%></h2>\n  </div>\n  <% } %>\n  <% if (collapsible) { %>\n  <section data-ntnx-section>\n    <div class="expand-btn pull-right">\n      <a class="expand-trigger"><%= i18n(collapsed ? \'open\' : \'close\') %></a>\n    </div>\n  </section>\n  <% } %>\n  <section data-ntnx-section class="subtasks-ctr">\n    <div class="subtasks">\n      <div class="subtask-separator"></div>\n      <div class="n-container-caret">\n        <div class="n-container-caret-border"></div>\n        <div class="n-container-caret-content"></div>\n      </div>\n      \x3c!-- Subtasks go in here --\x3e\n      <% _.each(subTasks, function (subTask) { %>\n      <section data-ntnx-section class="subtask">\n        <div class="subtask-msg">\n          <%= subTask[propTaskMessage] %>\n        </div>\n        <%= VisualizationUtil.renderProgressBar({\n          barClass: \'n-progress-bar \' + subTask[propStatus],\n          percentUsed: subTask[propPercentComplete],\n          rightTextLabel: subTask[propPercentComplete] ?\n          subTask[propPercentComplete] + \' %\' : \'\'\n        }) %>\n      </section>\n      <% }); %>\n    </div>\n  </section>\n</section>'}),define("views/popups/hardwareadmin/ExpandClusterProgressView",["data/DataProperties","managers/TaskManager","views/basecomponents/popups/BasePopupSubView","utils/AppConstants","utils/VisualizationUtil","utils/AppUtil","text!templates/popups/hardwareadministration/ExpandClusterProgressView.html"],function(e,t,n,i,s,a,o){"use strict";var r=_.template('<div><div id="task-progress" class="n-task-progress-view"></div></div>'),l=_.template(o);return n.extend({viewOption:null,subtasksOpen:!1,name:"ExpandClusterProgressView",events:{"click  .expand-trigger":"toggleSubTasks"},updateProgressCallback:null,initialize:function(e){n.prototype.initialize.apply(this,arguments),this.updateProgressCallback=this.renderTaskProgress.bind(this),t.registerHandlerForChangedTasks(this.updateProgressCallback)},render:function(){var e=this;this.clearBaseHeader(),this.$el.html(r()),this.viewOption.refreshView&&this.$("#task-progress").html(""),t.fetchOnDemand({success:function(){e.renderTaskProgress()},error:function(t,n){e.renderTaskProgress(),a.log("ExpandClusterProgressView: "+n)}})},destroy:function(){this.clearBaseHeader(),t.unregisterHandlerForChangedTasks(this.updateProgressCallback),n.prototype.destroy.apply(this,arguments)},refreshView:function(){this.render()},setViewOption:function(e){this.viewOption=e},renderTaskProgress:function(){var n=t.getGlobalTasks().getExpandClusterTask(),a=this.parentView;a.disableButton("btnBack"),!n||n.isStatusActive()||n.isStatusQueued()||(a.showButton("Cancel",!1),a.showButton("Validate",!1),a.showButton("ExpandCluster",!1),a.showButton("Back",!0),n.isTaskCompleted()&&a.enableButton("btnBack"));var o=this.viewOption.validate?"Running Pre-Expand Cluster Checks":"Expanding Cluster";n&&(this.$("#task-progress").html(l(this.vtOptions({title:o,task:n,subTasks:n.get(e.TASK_SUB_TASKS)||[],VisualizationUtil:s,propStatus:e.TASK_STATUS,propPercentComplete:e.TASK_PERCENT_COMPLETE,propTaskMessage:e.SUB_TASK_MESSAGE,collapsible:!0,showMasterProgressBar:!0,collapsed:!this.subtasksOpen}))),this.subtasksOpen||this.$("#task-progress").find(".subtasks").hide()),this.triggerAction(i.MODAL.ACT.AS_REBUILD)},toggleSubTasks:function(e){var t=this,n=$(e.currentTarget),s=this.$(".subtasks");s.is(":visible")?(s.slideUp("fast",function(){t.triggerAction(i.MODAL.ACT.AS_REBUILD)}),n.html(this.i18n("open")),this.subtasksOpen=!1):(s.slideDown("fast",function(){t.triggerAction(i.MODAL.ACT.AS_REBUILD)}),n.html(this.i18n("close")),this.subtasksOpen=!0)}})}),define("models/PostPollingCollection",["models/PollingCollection"],function(e){"use strict";return e.extend({name:"PostPollingCollection",parseOptions:function(t,n,i){return i=e.prototype.parseOptions.apply(this,arguments),i.data=JSON.stringify(this.getPostRequestData()),i.type="POST",i.contentType="application/json",i},getPostRequestData:function(){throw new Error("getPostRequestData: Subclass must implement this function.")}})}),define("models/softwareupgrade/HypervisorInstallerCollection",["models/softwareupgrade/SoftwareReleaseModel","models/PostPollingCollection","data/DataURLConstants","utils/AppConstants"],function(e,t,n,i){"use strict";return t.extend({model:e,name:"HypervisorInstallerModel",entityType:i.ENTITY_SOFTWARE_RELEASE,url:_.template(n.UPGRADE_SOFTWARE_RELEASES,{type:i.UPGRADE_SOFTWARE_TYPE_ADD_NODE.HYPERVISOR_INSTALLER}),targetNodes:null,getPostRequestData:function(){return this.targetNodes},setTargetNodes:function(e){this.targetNodes=e}})}),define("models/hardware/ExpandClusterPopupModel",["models/BaseModel","data/DataURLConstants","data/DataProperties","managers/LicenseManager","managers/ClusterManager","data/DataManager","models/hardware/DiscoveredBlockModel","models/encryption/EncryptionModel","models/softwareupgrade/HypervisorInstallerCollection","utils/AppConstants","utils/AppUtil","utils/SubModelHelper"],function(e,t,n,i,s,a,o,r,l,c,d,p){"use strict";var u={DISCOVERED_NODES:"discoveredNodes",DISCOVERED_MANUAL_NODES:"discoveredManualNodes",DECLINED_DISCOVERED_NODES:"declinedDiscoveredNodes",CONFIG:{IS_COMPUTE_ONLY:"is_compute_only",NODE_LIST:"node_list",COMPUTE_NODE_LIST:"compute_node_list"}};return e.extend({STATE_UPLOAD_RUNNING:"state_upload_running",STATE_UPLOAD_DONE:"state_upload_done",DP:u,DEFAULT_SKU_MAP:{free:"Free",standard:"Standard",datacenter:"Datacenter"},name:"ExpandClusterPopupModel",urlRoot:"-",defaults:{declinedDiscoveredNodes:null,discoveredNodes:null,subnetMasks:null,gateways:null,currentAddresses:null,softwareReleases:null,stateUpload:null,whitelistUpdated:!1},successfullyConfiguredIp:null,discoveredNodesChecked:null,forEncryptionOnlyNodeAddressMap:null,forEncryptionOnlyResultsErrorMap:null,expandNodeConfiguration:null,additionalInfo:null,hypervisorsForNodes:null,skipImaging:!1,compatibilityMessage:null,hypervisorsUploadMap:null,archTypeFiltering:!1,subModelHelper:null,initialize:function(){this.set({discoveredNodes:[],declinedDiscoveredNodes:[]}),this.successfullyConfiguredIp=[],this.discoveredNodesChecked={},this.forEncryptionOnlyNodeAddressMap={},this.forEncryptionOnlyResultsErrorMap={},this.hypervisorsUploadMap={},this.expandNodeConfiguration={},this.additionalInfo={},this.encryptionModel=new r,this.subModelHelper=new p;var e=new l;this.subModelHelper.register(n.UPGRADE_SOFTWARE_RELEASES,e)},destroyAll:function(){this.stopPollingSoftwareReleases(),_.each(this.getUploadingHypervisors(),function(e,t){var n=e.xhr;n&&n.abort()}),this.subModelHelper.iterate("off"),this.subModelHelper.destroy()},_onResetSubModel:function(e){e.entityType===c.ENTITY_SOFTWARE_RELEASE&&this.setProperty(n.UPGRADE_SOFTWARE_RELEASES,e)},getAllDiscoveredNodes:function(){return[].concat(this.getDiscoveredNodes(),this.getManuallyDiscoveredNodes())},getDiscoveredNodes:function(){var e=this.get(this.DP.DISCOVERED_NODES);return Array.isArray(e)||(e=[]),e},getManuallyDiscoveredNodes:function(){return this.get(u.DISCOVERED_MANUAL_NODES)||[]},setDiscoveredNodes:function(e){this.set(this.DP.DISCOVERED_NODES,e)},getDeclinedDiscoveredNodes:function(){var e=this.get(this.DP.DECLINED_DISCOVERED_NODES);return Array.isArray(e)||(e=[]),e},addDiscoveredNode:function(e){i.hasXPressLicense()&&!e.hasXPressNode()?this.getDeclinedDiscoveredNodes().push(e):this.getDiscoveredNodes().push(e)},clearDiscoveredNodes:function(){this.set("discoveredNodes",[])},getDiscoveredBlockModelById:function(e){return _.find(this.getDiscoveredNodes(),function(t){return t.getBlockId()===e})},setDigitalCertificateMapList:function(e){this.digitalCertificateMapList=e},getDigitalCertsForNode:function(e,t){var n=[];return _.each(t,function(t){e.node_uuid===t.node_uuid&&n.push({digital_certificate_base64:t.digital_certificate_base64,key_management_server_uuid:t.key_management_server_uuid})}),n},getExpandNodeConfiguration:function(){var e=this,t=$.extend(!0,{},this.expandNodeConfiguration);return this.digitalCertificateMapList&&_.each(t.node_list,function(t){t.digital_certificate_map_list=e.getDigitalCertsForNode(t,e.digitalCertificateMapList)}),_.each(this.expandNodeConfiguration.hypervisor_isos,function(e,n){!e||e.skip_imaging?t.hypervisor_isos={}:t.hypervisor_isos[n]=e.md5}),t},getExpandNodeConfigurationList:function(){return this.expandNodeConfiguration.node_list},setExpandNodeConfigurationList:function(e){var t=this;delete this.expandNodeConfiguration[u.CONFIG.COMPUTE_NODE_LIST],delete this.expandNodeConfiguration[u.CONFIG.NODE_LIST],_.each(e,function(e){var n=e[u.CONFIG.IS_COMPUTE_ONLY]?u.CONFIG.COMPUTE_NODE_LIST:u.CONFIG.NODE_LIST;t.expandNodeConfiguration[n]=t.expandNodeConfiguration[n]||[],t.expandNodeConfiguration[n].push(e)})},setExpandNodeConfigurationBlockList:function(e){this.expandNodeConfiguration.block_list=e},getExpandNodeConfigurationBlockList:function(){return this.expandNodeConfiguration.block_list},setHypervSKU:function(e){this.expandNodeConfiguration.hyperv_sku=e},getHypervSKU:function(){return this.expandNodeConfiguration.hyperv_sku},setHypervisorISO:function(e,t){this.expandNodeConfiguration.hypervisor_isos||(this.expandNodeConfiguration.hypervisor_isos={}),this.expandNodeConfiguration.hypervisor_isos[e]={md5:t}},setSkipImaging:function(e,t){this.skipImaging=t,this.expandNodeConfiguration.hypervisor_isos||(this.expandNodeConfiguration.hypervisor_isos={}),this.expandNodeConfiguration.hypervisor_isos[e]&&(this.expandNodeConfiguration.hypervisor_isos[e].skip_imaging=t)},getSkipImaging:function(){return this.skipImaging},getHypervisorISO:function(e){return this.expandNodeConfiguration.hypervisor_isos&&this.expandNodeConfiguration.hypervisor_isos[e]?this.expandNodeConfiguration.hypervisor_isos[e].md5:null},getHypervisorISOList:function(){return this.expandNodeConfiguration.hypervisor_isos},getHypervisorsForNodes:function(){return this.hypervisorsForNodes},setHypervisorsForNodes:function(e){this.hypervisorsForNodes=e},getCompatibilityMessage:function(){return"string"==typeof this.compatibilityMessage&&this.compatibilityMessage.trim().length>0?this.compatibilityMessage:null},setCompatibilityMessage:function(e){this.compatibilityMessage=e},setCredentials:function(e){this.additionalInfo=e},getNumNodes:function(){var e=this.expandNodeConfiguration.node_list;return e&&e.length>0?e.length:0},getAdditionalExpandClusterInfo:function(){return this.additionalInfo},setClusterWhiteListUpdateSuccess:function(){this.set("whitelistUpdated",!0)},getClusterWhitelistUpdateSuccess:function(){return this.get("whitelistUpdated")},canConfigureIP:function(e){var t=!1;switch(e){case"controllervm":t=this.getControllerGateway()&&this.getControllerSubnetMask();break;case"hypervisor":t=this.getHypervisorGateway()&&this.getHypervisorSubnetMask();break;case"ipmi":t=this.getIPMIGateway()&&this.getIPMISubnetMask()}return t},setGateways:function(e){this.set({gateways:e})},getControllerGateway:function(){return this.get("gateways")[0]},getHypervisorGateway:function(){return this.get("gateways")[1]},getIPMIGateway:function(){return this.get("gateways")[2]},setSubnetMasks:function(e){this.set({subnetMasks:e})},getControllerSubnetMask:function(){return this.get("subnetMasks")[0]},getHypervisorSubnetMask:function(){return this.get("subnetMasks")[1]},getIPMISubnetMask:function(){return this.get("subnetMasks")[2]},setCurrentAddresses:function(e){this.set({currentAddresses:e})},getCurrentControllerVMAddress:function(){return this.get("currentAddresses")[0]},getCurrentHypervisorAddress:function(){return this.get("currentAddresses")[1]},getCurrentIPMIAddress:function(){return this.get("currentAddresses")[2]},isFilteredByArchType:function(){return this.archTypeFiltering},processManuallyDiscoveredNodes:function(e){var t=e.getDiscoveredNodes(),n=_.groupBy(t,"rackable_unit_serial"),i=_.map(n,function(e,t){var n=new o(_defineProperty({},o.DP.DISCOVERY_METHOD,o.DISCOVERY_METHODS.MANUAL));return n.setBlockId(t),n.setRackNodes(e),n});this.set(this.DP.DISCOVERED_MANUAL_NODES,i)},processNewlyDiscoveredNodes:function(e){var t=this;this.setDiscoveredNodes([]);var n=e.getReturnResponse();this.archTypeFiltering=!1;var i=s.isPowerPcCluster();if(n){var a={};_.each(n,function(e){var n=d.isPowerPcArchType(e.arch);if(i&&!n||!i&&n)return void(t.archTypeFiltering=!0);var s=e.rackable_unit_serial,o=a[s];o||(o=[],a[s]=o),o.push(e)});var r=(new Date).getTime();_.each(a,function(e){var t=new o;t.setBlockId(r),t.setRackNodes(e),this.addDiscoveredNode(t),r+=1},this)}},processClusterNetworkSettings:function(e){var t=e.getReturnResponse();if(t){var n=[],i=[],s=[];_.each(t,function(e){e&&(n.push(e.netmask),i.push(e.gateway),s.push(e.address))}),this.setSubnetMasks(n),this.setGateways(i),this.setCurrentAddresses(s)}},reset:function(){return this.set({discoveredNodes:[],subnetMasks:[]})},setSuccessfulConfiguredIps:function(e){this.successfullyConfiguredIp.push(e)},getSuccessfulConfiguredIps:function(){return this.successfullyConfiguredIp},validateFileForCompatibility:function(e,n,i,s,o){var r={name:e.name,fileSize:e.size,hex_md5:n,node_list:i},l=a.getFormattedURL(_.template(t.UPGRADE_VALIDATE_METADATA,{type:c.UPGRADE_SOFTWARE_TYPE_ADD_NODE.HYPERVISOR_INSTALLER}));d.uploadBinaryFile({type:"POST",url:l,data:JSON.stringify(r)},function(e){d.log("ExpandClusterPopupModel : Valid metadata file."),"function"==typeof s&&s()},function(e,t,n){var i=d.processAjaxError(e.responseText);d.log("ExpandClusterPopupModel : Invalid metadata file: "+i),"function"==typeof o&&o(i)})},uploadHypervisorImageWithMD5:function(e,i,s,o,r){if("undefined"==typeof File)return d.log("ExpandClusterPopupModel : Upload software via legacy browser."),void("function"==typeof r&&r("Upload is currently supported only on IE10+, Chrome and Firefox."));var l=e.name,p=this.getSoftwareReleaseModel(i),u=p?p.get(n.UPGRADE_CURRENT_SIZE_IN_BYTES):0,h={name:l,fileSize:e.size,md5Sum:i,offset:u||0,overwrite:!0};h=d.formatObjectToQuery(h);var m=a.getFormattedURL(_.template(t.UPGRADE_UPLOAD,{id:encodeURI(e.name),params:h,type:c.UPGRADE_SOFTWARE_TYPE_ADD_NODE.HYPERVISOR_INSTALLER}));return d.uploadBinaryFile({url:m,data:e,offset:u,beforeSend:function(t){var n={name:e.name,size:e.size,hex_md5:i,node_list:s};t.setRequestHeader("softwareMetadata",encodeURIComponent(JSON.stringify(n)))}},function(e){d.log("ExpandClusterPopupModel : Successfully Uploaded the file!"),"function"==typeof o&&o()},function(e,t,n){if("abort"===n)return void d.log("ExpandClusterPopupModel : Upload was aborted.");d.log("ExpandClusterPopupModel : Error in uploading file: "+n+" | "+d.processAjaxError(e.responseText)+" | "+e.status),"function"==typeof r&&r(d.processAjaxError(e.responseText))})},startHypervisorUpload:function(e,t){
this.hypervisorsUploadMap[e]=t,this.setProperty(n.UPGRADE_STATE_UPLOAD,this.STATE_UPLOAD_RUNNING)},endHypervisorUpload:function(e){delete this.hypervisorsUploadMap[e],0===_.size(this.hypervisorsUploadMap)&&this.setProperty(n.UPGRADE_STATE_UPLOAD,this.STATE_UPLOAD_DONE)},getUploadingHypervisors:function(){return this.hypervisorsUploadMap},isUploadInProgress:function(){return this.get(n.UPGRADE_STATE_UPLOAD)===this.STATE_UPLOAD_RUNNING},startPollingSoftwareReleases:function(e){var t=this.subModelHelper.get(n.UPGRADE_SOFTWARE_RELEASES);t&&(this.subModelHelper.attachEventHandler("reset",this._onResetSubModel,this),t.startPolling({force:"true"}))},stopPollingSoftwareReleases:function(e){var t=this.subModelHelper.get(n.UPGRADE_SOFTWARE_RELEASES);t&&(t.stopPolling(),this.subModelHelper.removeAllEventHandlers())},fetchAvailableHypervisorInstallers:function(e,t){var i=this.subModelHelper.get(n.UPGRADE_SOFTWARE_RELEASES);i&&(i.setTargetNodes(e),i.fetch(t))},getAvailableHypervisorInstallerModels:function(){var e=this.subModelHelper.get(n.UPGRADE_SOFTWARE_RELEASES);if(e)return e.models},getSoftwareReleaseModel:function(e){var t=this.subModelHelper.get(n.UPGRADE_SOFTWARE_RELEASES),i=null;return t&&_.each(this.getAvailableHypervisorInstallerModels(),function(t){t.get(n.UPGRADE_MD5SUM)===e&&(i=t)}),i},uploadWhitelist:function(e,n,i){if("undefined"==typeof File)return d.log("ExpandClusterPopupModel : Upload software via legacy browser."),void("function"==typeof i&&i("Upload is currently supported only on IE0+, Chrome and Firefox."));$.ajax({type:"PUT",url:a.getFormattedURL(t.UPLOAD_WHITELIST),data:e,cache:!1,contentType:"application/octet-stream",processData:!1}).done(function(e){d.log("ExpandClusterPopupModel : Successfully Uploaded the file!"),"function"==typeof n&&n()}).fail(function(e,t,n){if("abort"===n)return void d.log("ExpandClusterPopupModel : Upload was aborted.");d.log("SoftwareUpgradeModel : Error in uploading file: "+n+" | "+d.processAjaxError(e.responseText)+" | "+e.status),"function"==typeof i&&i(d.processAjaxError(e.responseText))})}},{DP:u})}),define("text!templates/popups/hardwareadministration/ExpandClusterContentView.html",[],function(){return'\x3c!-- The parent div is #popupExpandCluster --\x3e\n<div id="expand-cluster-main" data-ntnx-content-inner class="n-modal-expand-cluster-content">\n  \x3c!-- @subviews go in here --\x3e\n</div>\n'}),define("views/popups/hardwareadmin/ExpandClusterPopupView",["bluebird","views/basecomponents/popups/BasePopupView","data/DataProperties","managers/TaskManager","views/popups/hardwareadmin/ExpandClusterView","views/popups/hardwareadmin/ManualNodeDiscoveryView","views/popups/hardwareadmin/GenerateCSRExpandClusterView","views/popups/hardwareadmin/ExpandClusterResultsView","views/popups/hardwareadmin/EncryptionConfigExpandClusterView","views/popups/hardwareadmin/ExpandClusterHostConfigView","views/popups/hardwareadmin/ExpandClusterHostRackConfigView","views/popups/hardwareadmin/ExpandClusterProgressView","models/encryption/EncryptionModel","models/hardware/ExpandClusterPopupModel","models/intent/IntentParser","utils/AppConstants","utils/AppUtil","utils/SubViewHelper","text!templates/popups/hardwareadministration/ExpandClusterContentView.html"],function(e,t,n,i,s,a,o,r,l,c,d,p,u,h,m,f,v,g,E){"use strict";var T=_.template('<div class="msg-disallow">A Foundation upgrade is in progress. Please wait for it to be completed.</div>');return E=_.template(E),t.extend({DEFAULT_POPUP_PROP:{title:"Title",subViewContainerEl:".n-modal-expand-cluster-content"},DISCOVER_NODE_VIEW:"discover-node-view",DISCOVER_MANUAL_VIEW:"discover-node-manual-view",ENCRYPTION_CONFIG_VIEW:"encryption-config-view",DOWNLOAD_CSR_VIEW:"download-csr",CONFIG_RESULTS_SED_VIEW:"configuration-results-sed",HOST_CONFIG_VIEW:"host-config-view",HOST_RACK_CONFIG_VIEW:"host-rack-config-view",PROGRESS_VIEW:"progress-view",subViewHelper:null,el:"#popupExpandCluster",name:"ExpandClusterPopupView",currentSubViewId:null,isExpandClusterTaskActive:!1,blocks:[],kmsType:null,events:{"click  .modal-header .close":"hide","click  .btnCancel":"hide","click  .btnClose":"hide","click  .btnDiscover":"onClickDiscover","click  .btnSave":"onClickLinkAction","click  .btnNext":"onClickLinkAction","click  .btnBack":"onClickLinkAction","click  .btnValidate":"onClickLinkAction","click  .btnExpandCluster":"onClickLinkAction"},modelEvents:{"change.softwareReleases    model":"onSoftwareReleasesChange"},initialize:function(){t.prototype.initialize.apply(this,arguments),this.subViewHelper=new g,this.model=new h,this.encryptionModel=new u},show:function(){var e=this;this.fetchInProgress=!0,v.showLoader();var n=[];n.push(function(){var t=$.Deferred();return m.getInstance().getServiceByEntityType(f.ENTITY_RACKABLE_UNIT).then(function(e){return e.all()}).then(function(e){return v.hideLoader(),e.entities}).then(function(n){n?(e.blocks=n,t.resolve()):t.reject()}).catch(function(n){v.log(n),v.hideLoader(),e.triggerAction(f.MODAL.ACT.ALERT_SHOW,{type:f.MODAL.ALERT.TYPE_ERROR,message:e.i18n("block_fetch_error")}),t.reject()}),t.promise()}()),n.push(this.fetchKMSType()),n.push(this.fetchCurrentEncryptionStatus()),t.prototype.show.apply(this,arguments),$.whenAll.apply($,n).done(function(){v.hideLoader(),e.fetchInProgress=!1,e.render(),e._initSteps(),e.triggerAction(f.MODAL.ACT.SET_STEP,0)})},render:function(){var e=this;if(!this.fetchInProgress){var t=i.getGlobalTasks().getExpandClusterTask();t&&(t.isStatusActive()||t.isStatusQueued())&&(this.isExpandClusterTaskActive=!0);var n=[{text:this.i18n("back"),leftAligned:!0,extraAttr:[{key:"data-test",value:"test_expand_cluster_back_btn"}],extraClasses:"btnBack n-btn-form hide"},{isPrimary:!0,text:this.i18n("close"),extraAttr:[{key:"data-test",value:"test_expand_cluster_close_btn"}],extraClasses:"btnClose n-btn-form"},{text:this.i18n("cancel"),extraAttr:[{key:"data-test",value:"test_expand_cluster_cancel_btn"}],extraClasses:"btnCancel n-btn-form"},{isPrimary:!0,text:this.i18n("save"),extraClasses:"btnSave n-btn-form hide",extraAttr:[{key:"data-loading-text",value:"Saving..."},{key:"action",value:"showSubView"}]},{isPrimary:!0,text:this.i18n("do_manual_discovery"),extraClasses:"btnDiscover n-btn-form hide",extraAttr:[{key:"data-test",value:"test_discover_nodes_btn"}]},{isPrimary:!0,text:this.i18n("next"),extraClasses:"btnNext n-btn-form hide",extraAttr:[{key:"action",value:"showSubView"},{key:"data-test",value:"test_expand_cluster_next_btn"}]},{text:"Run Checks",extraClasses:"btnValidate n-btn-form hide",extraAttr:[{key:"data-loading-text",value:"Validating..."},{key:"data-test",value:"test_expand_cluster_run_checks_btn"}]},{isPrimary:!0,text:"Expand Cluster",extraAttr:[{key:"data-test",value:"test_expand_cluster_btn"}],extraClasses:"btnExpandCluster n-btn-form hide"}],s={isActive:!0,text:this.i18n("select_host_step"),extraClasses:"tab-discover-node-view",extraAttr:[{key:"type",value:"host_selection"}],subViewId:"discover-node-view"},a={text:this.i18n("config_host_step"),extraClasses:"tab-host-config-view tab-progress-view",extraAttr:[{key:"type",value:"host_config"}],subViewId:"host-config-view"},o={text:this.i18n("encrypt_host"),extraClasses:"tab-encryption-config-view tab-download-csr tab-configuration-results-sed",extraAttr:[{key:"type",value:"encrypt_host"}],subViewId:"encryption-config-view"},r={text:this.i18n("assign_rack_step"),extraClasses:"tab-host-rack-config-view tab-progress-view",extraAttr:[{key:"type",value:"host_rack_config"}],subViewId:"host-rack-config-view"};this.tabList=[s],this._hasBlocksMapped(this.blocks)&&this.tabList.push(r),this.isEkmEncryptionOn()&&this.tabList.push(o),this.tabList.push(a),_.each(this.tabList,function(t,n){t.text=e.i18ns("step_number",n+1)+t.text}),this.$el.html(this.defaultTemplate({title:this.i18n("expand_cluster"),tabs:!0,stepTabs:!0,tabsList:this.defaultTabs(this.tabList),bodyContent:E(),footerButtons:this.defaultFooter(n)})),this.isExpandClusterTaskActive?(v.log("ExpandClusterPopupView : Expand cluster task already running"),this.selectSubView({subViewId:this.PROGRESS_VIEW}),this.showButton("Back",!0),this.disableButton("btnBack"),this.showButton("Close",!0),this.showButton("Cancel",!1),this.showButton("Save",!1),this.showButton("Next",!1)):this.isFoundationUpgradeInProgress()?this.$("#expand-cluster-main").html(T()):this.selectSubView({subViewId:this.DISCOVER_NODE_VIEW}),this.triggerAction(f.MODAL.ACT.AS_REBUILD)}},onClickStepCallback:function(e,t){var n=-1,i=_.pluck(this.tabList,"subViewId");if(t.hasClass("tab-discover-node-view")&&this.currentSubViewId!==this.DISCOVER_NODE_VIEW?n=i.indexOf(this.DISCOVER_NODE_VIEW):t.hasClass("tab-host-rack-config-view")&&this.currentSubViewId!==this.HOST_RACK_CONFIG_VIEW&&(n=i.indexOf(this.HOST_RACK_CONFIG_VIEW)),-1!==n){this.triggerAction(f.MODAL.ACT.SET_STEP,n);var s=this.tabList[n].subViewId;s&&this.selectSubView({subViewId:s,options:{refreshView:!1}})}},hide:function(){this.model.isUploadInProgress()?$.nutanixConfirm({msg:"You're currently uploading a software binary. Are you sure you want to exit?",yes:function(){this.dispose()},yesText:"Yes",noText:"No",context:this}):this.dispose()},dispose:function(){t.prototype.hide.apply(this,arguments),this.subViewHelper.destroy(),this.model&&this.model.destroyAll()},fetchCurrentEncryptionStatus:function(){var e=$.Deferred();return this.encryptionModel.fetchCurrentEncryptionStatus({success:function(){e.resolve()},error:function(t,n){e.reject(),v.log("Error in getting the current encryption state.")}}),e.promise()},fetchKMSType:function(){var e=this,t=$.Deferred();return this.encryptionModel.fetchKMSType({success:function(n,i){e.kmsType=i.kmsType,t.resolve()},error:function(){t.reject(),v.log("Error fetching KMS type.")}}),t.promise()},isEkmEncryptionOn:function(){var e=this.encryptionModel.getCurrentEncryptionStatusModel().state||null;return!(!e||!e.isEncryptionOn||this.clusterManager.isMulticlusterUI()||this.kmsType===f.ENCRYPTION_PROP.LKM)},isFoundationUpgradeInProgress:function(){var e=i.getGlobalTasks().getActiveUpgradeTaskModel();return e&&e.get(n.TASK_TYPE)===f.TASK_OPERATION_TYPES[f.UPGRADE_SOFTWARE_TYPE.FOUNDATION]&&!e.isStatusFailed()},selectSubView:function(e){var t=void 0,n=void 0;this.currentSubViewId;t=this.subViewHelper.get(this.currentSubViewId),t&&t.hideView(),n=e.subViewId,t=this.subViewHelper.get(n),this.currentSubViewId=n;var i=e.options||{};if(t)t.setViewOption(i);else{$('<div id="'+n+'"></div>').appendTo(this.DEFAULT_POPUP_PROP.subViewContainerEl),t=this.createSubView(n),this.subViewHelper.register(this.currentSubViewId,t),t.setParentView(this),t.setViewOption(i),t.render()}this._showSubView(t);var s=0;return s=_.pluck(this.tabList,"subViewId").indexOf(n),this.triggerAction(f.MODAL.ACT.SET_STEP,s),this.triggerAction(f.MODAL.ACT.AS_REBUILD),t},_showSubView:function(e){e&&(e.refreshView(),e.showView(),this.triggerAction(f.MODAL.ACT.AS_REBUILD))},onViewTransition:function(e){var t=this,n=this.subViewHelper.get(this.currentSubViewId);if(n){var i=function(){t.selectSubView(e)};n.saveViewData(i,e)}},_hasBlocksMapped:function(e){return!!e&&e.findIndex(function(e){return e.status.resources.rack_reference&&e.status.resources.rack_reference.uuid})>-1},onSubmitManualDiscover:function(e){this.selectSubView({subViewId:this.DISCOVER_NODE_VIEW,options:{refreshView:!1}}).loadUnconfiguredNodesManually(e)},onClickLinkAction:function(e){var t=this,n=$(e.currentTarget);if(n.hasClass("btnBack")){this.showButton("Validate",!1),this.showButton("ExpandCluster",!1);var s=0,a=!1,o=_.pluck(this.tabList,"subViewId");this.currentSubViewId===this.PROGRESS_VIEW?(this.subViewHelper.remove(this.DISCOVER_NODE_VIEW),a=!0):o.indexOf(this.currentSubViewId)>-1&&(s=o.indexOf(this.currentSubViewId)-1),this.triggerAction(f.MODAL.ACT.SET_STEP,s);var r=this.tabList[s].subViewId;if(r)return void this.selectSubView({subViewId:r,options:{refreshView:a}})}if(n.hasClass("btnValidate"))this.subViewHelper.get(this.HOST_CONFIG_VIEW).validate(function(){t.triggerAction(f.MODAL.ACT.ALERT_HIDE),t.showButton("Validate",!1),t.showButton("ExpandCluster",!1),t.disableButton("btnBack"),i.fetchOnDemand({success:function(){t.showProgress(!0)},error:function(e,n){t.showProgress(!0),v.log("ExpandClusterPopupView: "+n)}})});else if(n.hasClass("btnExpandCluster")){var l=!1;e.shiftKey&&e.altKey&&(l=!0),this.subViewHelper.get(this.HOST_CONFIG_VIEW).saveViewData(function(){t.triggerAction(f.MODAL.ACT.ALERT_HIDE),t.showButton("Validate",!1),t.showButton("ExpandCluster",!1),t.disableButton("btnBack"),i.fetchOnDemand({success:function(){t.showProgress(!1)},error:function(e,n){t.showProgress(!1),v.log("ExpandClusterPopupView: "+n)}})},l)}var c=n.attr(f.NAV_ACTION),d=_.pluck(this.tabList,"subViewId"),p=d.indexOf(this.currentSubViewId),u=this.tabList[p].subViewId;if(c===f.ACTION_SHOW_SUBVIEW){var h={};n.attr("dataEntryId")&&(h.dataEntryId=n.attr("dataEntryId")),n.hasClass("btnNext")&&_.each(this.tabList,function(e,n){e.extraClasses.indexOf(t.currentSubViewId)>-1&&(u=t.tabList[n+1].subViewId)}),this.onViewTransition({subViewId:u,options:h})}},onClickDiscover:function(e){this.currentSubViewId===this.DISCOVER_MANUAL_VIEW&&this.subViewHelper.get(this.currentSubViewId).onClickDiscover(e)},showProgress:function(e){this.selectSubView({subViewId:this.PROGRESS_VIEW,options:{refreshView:!0,validate:e}})},createSubView:function(e){var t=void 0,n={el:"#"+e,encryptionModel:this.encryptionModel,model:this.model};switch(e){case this.DISCOVER_NODE_VIEW:t=new s(_.extend(n,{hasRackView:this._hasBlocksMapped(this.blocks)}));break;case this.DISCOVER_MANUAL_VIEW:t=new a(n);break;case this.ENCRYPTION_CONFIG_VIEW:t=new l(n);break;case this.DOWNLOAD_CSR_VIEW:t=new o(n);break;case this.CONFIG_RESULTS_SED_VIEW:t=new r(n);break;case this.HOST_CONFIG_VIEW:t=new c(n);break;case this.HOST_RACK_CONFIG_VIEW:t=new d(_.extend(n,{hasRackView:this._hasBlocksMapped(this.blocks),blocks:this.blocks}));break;case this.PROGRESS_VIEW:t=new p(n)}return t},onSoftwareReleasesChange:function(){var e=this.subViewHelper.get(this.currentSubViewId);e&&"function"==typeof e.onSoftwareReleasesChange&&e.onSoftwareReleasesChange()},showButton:function(e,t){var n=".btn"+e;t?this.$(n).show():this.$(n).hide()},hideAllButtons:function(){this.$(".n-btn-form").hide()},disableButton:function(e){this.$("."+e).attr("disabled","disabled")},enableButton:function(e){this.$("."+e).removeAttr("disabled")},setButtonAttribute:function(e,t){var n=this.$("."+e);_.each(t,function(e,t){n.attr(t,e)})},removeButtonAttribute:function(e,t){var n=this.$("."+e);_.each(t,function(e){n.removeAttr(e)})}})}),define("views/popups/hardwareadmin/RemoveDiskPopupView",["backbone","views/basecomponents/popups/BasePopupView","utils/AppConstants","managers/NavigationManager","managers/TaskManager","models/hardware/DiskModel"],function(e,t,n,i,s,a){"use strict";return t.extend({el:"#popupHardware",show:function(e){this.actionRoute=e,e[n.NAV_ACTION]===n.ACTION_REMOVE&&this.renderRemove(e)},renderRemove:function(e){this.confirmDelete(e)},deleteEntity:function(e,t){if(e===n.ENTITY_DISK){var o=new a({id:t});if(o){var r=this;o.startRemove({success:function(e,t){s.fetchOnDemand(),i.showDetailsSummary(),r.hide()}})}}}})}),define("text!templates/popups/hardwareadministration/ReplaceHardwareContentView.html",[],function(){return'<div data-ntnx-content-inner>\n  <section data-ntnx-section="type-text" class="replace-sub-title">\n    <%= i18n("replace_sub_title") %>\n  </section>\n  <ol class="remove-step">\n    <li>\n      <section data-ntnx-section="type-text">\n        <p><%= i18n(\'replace_step_1\')%></p>\n        <div class="link-wrapper">\n          <button class=\'btn btnUpdate btn-primary\'>\n            <%= i18n(\'remove_drive\')%>\n          </button>\n        </div>\n      </section>\n    </li>\n    <li>\n      <section data-ntnx-section="type-text">\n        <p><%= i18n(\'replace_step_2\')%></p>\n        <a href="<%= portal_url %>" target="_blank"><%= i18n(\'portal_link\') %>\n        </a>\n      </section>\n    </li>\n  </ol>\n</div>\n'}),define("views/popups/hardwareadmin/ReplaceDiskPopupView",["backbone","views/basecomponents/popups/BasePopupView","models/hardware/DiskModel","utils/AppConstants","utils/AppUtil","data/DataURLConstants","managers/I18nManager","managers/NavigationManager","managers/TaskManager","text!templates/popups/hardwareadministration/ReplaceHardwareContentView.html"],function(e,t,n,i,s,a,o,r,l,c){"use strict";var d=_.template(c),p=_.template("\n      <p><%=i18n('replace_warning_1')%></p>\n      <p><%=i18n('replace_warning_2')%></p>\n      "),u=_.template("\n      <p><%=i18n('remove_drive_alert_1')%></p>\n      <p><%=i18n('remove_drive_alert_2')%></p>\n      ");return t.extend({el:"#popupReplaceDisk",name:"ReplaceDiskPopupView",events:{"click  .close":"hide","click  .btnClose":"hide","click  .btnUpdate":"onRemoveDrive","click  .task-link":"onGotoTaskPage"},render:function(){var e=[{text:this.i18n("close"),extraClasses:"btnClose"}];this.$el.html(this.defaultTemplate({title:this.i18n("replace_title"),bodyContent:d(this.vtOptions({portal_url:a.PRISM_REPLACE_NVME})),footerButtons:this.defaultFooter(e)}))},onRemoveDrive:function(){var e=this.actionRoute[i.NAV_ACTION_TARGET],t=this.actionRoute[i.NAV_ACTION_TARGET_NAME],n=this.actionRoute[i.NAV_ACTION_TARGET_ID],a=o.t("BasePopupView","action_remove_disk_or_host"),r=o.ts("BasePopupView","confirm_delete",[{actionText:a,entityTypeText:i.ENTITY_DISK,entityName:t}]),l=_.template('<a class="task-link"><%=i18n("task_list")%><i aria-hidden="true" data-icon="y"></i></a>'),c={};c.extHTML=p(this.vtOptions()),$.nutanixConfirm(_.defaults({},c,{msg:r,context:this,class:"-compact -red-confirm",yesText:s.toTitleCase(a),yes:function(){this.deleteEntity(e,n,t),this.$(".link-wrapper").html(l(this.vtOptions())),this.showHeaderInfo(u(this.vtOptions())),this.triggerAction(i.MODAL.ACT.AS_REBUILD)}}))},deleteEntity:function(e,t){var i=new n({id:t});i&&i.startRemove({success:function(e,t){l.fetchOnDemand(),r.showDetailsSummary()}})},onGotoTaskPage:function(){this.hide(),r.navigateToPage(i.PAGE_TASKS)}})}),define("models/UpdateProfileModel",["models/BaseModel","data/DataURLConstants","data/DataProperties","data/DataManager","managers/NamespaceManager","utils/AppConstants","utils/AppUtil"],function(e,t,n,i,s,a,o){"use strict";var r={LOCALE:"locale",REGION:"region",FIRSTNAME:"firstName",LASTNAME:"lastName",MIDDLEINITIAL:"middleInitial",EMAILID:"emailId"};return e.extend({idAttribute:"username",nameAttribute:n.NAME,urlRoot:t.USERS,name:"UpdateProfileModel",DP:r,entityType:a.ENTITY_USER_PROFILE,actionMode:a.ACTION_UPDATE,defaults:{id:null,username:null,firstName:"",middleInitial:null,lastName:"",region:"",emailId:""},sync:function(e,n,a){return a=this.parseOptions(e,n,a),a.url=i.getFormattedURL(n.urlRoot+t.DETAILS,!0),"update"!==e&&"create"!==e||(n.unset("id"),e="update",s.get(s.SESSION_INFO).local||n.setId(n.get(r.EMAILID)),a.url=i.getFormattedURL(n.url()+t.PROFILE)),o.log("BaseModel : \n\t method: "+e+"\n\t data  : "+a.url),Backbone.sync(e,n,a)},parse:function(e){return e.profile}})}),define("text!templates/popups/user/UpdateProfileContentView.html",[],function(){return'\x3c!-- The parent div modal is #popupUpdateProfile --\x3e\n<div data-ntnx-content-inner>\n\n  <div class="updateProfileForm"></div>\n\n  <section data-ntnx-section="type-separator" class="portal-config-ctr">\n    \x3c!-- @view: Portal configuration view rendered here --\x3e\n  </section>\n</div>'}),define("text!templates/popups/user/UpdateProfileFormView.html",[],function(){return'<section data-ntnx-section="type-text">\n  <%= i18ns(\'popup_description\', \'<strong>\' + model.username + \'</strong>\') %>\n</section>\n\n<form role="form" class="general-settings-form">\n\n  <section data-ntnx-section="type-separator">\n    <h5 data-ntnx-title><%= i18n(\'general\') %></h5>\n  </section>\n\n  <div>\n\n    <section data-ntnx-section="type-half">\n      <label data-ntnx-label for="inputFirstName">\n        <%= i18n(\'first_name\') %>\n      </label>\n      <input model-validate="required" model-attribute="params.firstName"\n        model-attribute-name="<%= i18n(\'first_name\') %>"\n        id="inputFirstName" type="text"\n        class="form-control inputFirstName"\n        value="<%- model.firstName %>">\n    </section>\n\n    <section data-ntnx-section="type-half">\n      <label data-ntnx-label for="inputLastName">\n        <%= i18n(\'last_name\') %>\n      </label>\n      <input model-validate="required" model-attribute="params.lastName"\n        model-attribute-name="<%= i18n(\'last_name\') %>"\n        id="inputLastName" type="text"\n        class="form-control inputLastName"\n        value="<%- model.lastName %>">\n    </section>\n\n  </div>\n\n  <section data-ntnx-section>\n    <label data-ntnx-label for="inputEmailId"><%= i18n(\'email_address\') %></label>\n    <input model-validate="email" model-attribute="params.email"\n      model-attribute-name="<%= i18n(\'email\') %>"\n      id="inputEmailId" type="email"\n      class="form-control inputEmailId"\n      value="<%- model.emailId %>">\n  </section>\n\n  <section data-ntnx-section>\n    <label data-ntnx-label for="inputLocale"><%= i18n(\'language\') %></label>\n    <%= Components.select({\n      id: \'inputLocale\',\n      options: locales,\n      variants: \'bottom-anchor\',\n      jsClasses: \'language-list inputLocale\'\n    }) %>\n  </section>\n\n</form>\n'}),define("views/popups/user/UpdateProfilePopupView",["backbone","views/basecomponents/popups/BasePopupView","models/UpdateProfileModel","views/popups/user/PortalConfigView","utils/AppConstants","utils/AppUtil","utils/ValidationUtil","text!templates/popups/user/UpdateProfileContentView.html","text!templates/popups/user/UpdateProfileFormView.html"],function(e,t,n,i,s,a,o,r,l){"use strict";return r=_.template(r),l=_.template(l),t.extend({name:"UpdateProfilePopupView",el:"#popupUpdateProfile",model:null,portalCfgView:null,events:{"click  .btnUpdate":"updateProfile","click  .btnCancel":"hide","click .modal-header .close":"hide","keypress input":"onKeyPress","click input":"hideAlert"},initialize:function(){t.prototype.initialize.apply(this,arguments),this.model=new n,this.portalCfgView=new i({parentView:this})},render:function(){var e=[{text:this.i18n("cancel"),extraClasses:"btnCancel"},{isPrimary:!0,text:this.i18n("save"),extraClasses:"btnUpdate",extraAttr:[{key:"data-loading-text",value:this.i18n("saving")}]}];this.$el.html(this.defaultTemplate({title:this.i18n("popup_title"),antiscroll:!1,bodyContent:r(),footerButtons:this.defaultFooter(e)})),this.renderSubviews()},renderSubviews:function(){this.renderFormView(),this.renderPortalView()},show:function(e){t.prototype.show.apply(this,arguments),this.loadProfileDetails()},hide:function(){this.portalCfgView.stopServices(),t.prototype.hide.apply(this,arguments)},renderFormView:function(){var e=this.model.get(this.model.DP.LOCALE);this.$(".updateProfileForm").html(l(this.vtOptions({model:this.model.toJSON(),locales:_.map(s.I18N_LOCALES,function(t,n){return{value:n,name:t,selected:e===n}})}))),this.applyNutanixInput()},renderPortalView:function(){this.$(".portal-config-ctr").html(this.portalCfgView.render().el),this.portalCfgView.delegateEvents()},reset:function(){this.triggerAction(s.MODAL.ACT.ALERT_HIDE),this.undelegateEvents()},onEnterKeyPress:function(){this.updateProfile()},loadProfileDetails:function(){var e=this;this.model.fetch({success:function(){e.renderFormView(),e.portalCfgView.startServices()},error:function(e,t){this.triggerAction(s.MODAL.ACT.ALERT_SHOW,{type:s.MODAL.ALERT.TYPE_ERROR,message:t.responseText})}})},updateProfile:function(){var e=o.validateFormValues(this.$el);if(e.length){var t=o.defaultErrorHandler(this.$el,e);return void this.triggerAction(s.MODAL.ACT.ALERT_SHOW,{type:s.MODAL.ALERT.TYPE_ERROR,message:t})}var n=this;this.model.set({firstName:this.$el.find(".inputFirstName").val(),lastName:this.$el.find(".inputLastName").val(),emailId:this.$el.find(".inputEmailId").val(),locale:this.$el.find(".inputLocale").val()}),this.$(".btnUpdate").button("loading");var i=[this.model.save()],a=this.portalCfgView.saveForm();void 0!==a&&i.push(a),$.whenAll.apply($,i).done(function(){n.$(".btnUpdate").button("reset");var e=!1,t=[];_.each(i,function(n){void 0!==n&&n.isRejected()&&(t.push(n),e=!0)}),n.showConcatHeaderError(t),e||(n.loadProfileDetails(),n.hide())})},hideAlert:function(){this.triggerAction(s.MODAL.ACT.ALERT_HIDE)},showConcatHeaderError:function(e,t){var n="";_.each(e,function(e){var t=void 0;_.isString(e)?t=e:e&&e.responseText&&(t=e.responseText),t=a.processAjaxError(t),t=a.removeServerException(t)||"Server Error",n=n.concat(t)}),this.triggerAction(s.MODAL.ACT.ALERT_SHOW,{type:s.MODAL.ALERT.TYPE_ERROR,message:n})}})}),define("text!templates/popups/user/ChangePasswordContentView.html",[],function(){return'\x3c!-- The parent div modal is #popupChangePassword --\x3e\n<div data-ntnx-content-inner>\n  \x3c!-- Form to change password --\x3e\n  <form onsubmit="return false;">\n    <section data-ntnx-section>\n      <label data-ntnx-label for="inputCurrentPassword">\n        <%= i18n(\'label_current_password\') %>\n      </label>\n      <input type="password" autocomplete="off" class="inputCurrentPassword">\n    </section>\n    <section data-ntnx-section>\n      <label data-ntnx-label for="inputNewPassword">\n        <%= i18n(\'label_new_password\') %>\n      </label>\n      <input type="password" autocomplete="off" class="inputNewPassword">\n    </section>\n    <section data-ntnx-section>\n      <label data-ntnx-label for="inputConfirmPassword">\n        <%= i18n(\'label_confirm_password\') %>\n      </label>\n      <input type="password" autocomplete="off" class="inputConfirmPassword">\n    </section>\n    <section data-ntnx-section="type-text">\n      <%= i18n(\'help_text\') %>\n    </section>\n  </form>\n</div>\n'}),define("views/popups/user/ChangePasswordPopupView",["backbone","views/basecomponents/popups/BasePopupView","models/BaseModel","data/DataURLConstants","data/DataManager","managers/AccessManager","utils/AppConstants","utils/AppUtil","text!templates/popups/user/ChangePasswordContentView.html"],function(e,t,n,i,s,a,o,r,l){"use strict";l=_.template(l);var c=n.extend({urlRoot:i.USERS,entityType:o.ENTITY_USER_PASSWORD,actionMode:o.ACTION_UPDATE,defaults:{oldPassword:"",newPassword:""},sync:function(t,n,a){a=this.parseOptions(t,n,a),a.url=s.getDataSourceURL()+i.USERS+i.CHANGE_PASSWORD,t="update",n.unset("id"),r.log("BaseModel : \n\t method: "+t+"\n\t data  : "+a.url),e.sync(t,n,a)}});return t.extend({name:"ChangePasswordPopupView",el:"#popupChangePassword",changePasswordModel:null,MSG_SUCCESS:"Password changed successfully",events:{"click .modal-header .close":"hide","click  .btnUpdate":"changePassword","click  .btnCancel":"onCancel","keypress input":"onKeyPress"},render:function(){var e=this;this.$el.html(this.defaultTemplate({title:this.i18n("title_change_password"),bodyContent:l(this.vtOptions()),footerButtons:this.defaultFooter([{text:this.i18n("cancel"),extraClasses:"btnCancel",leftAligned:!0},{isPrimary:!0,text:this.i18n("save"),extraClasses:"btnUpdate",extraAttr:[{key:"data-loading-text",value:this.i18n("saving")}]}])})),a.hasAdminUsername()&&r.getPAMCriteria(s.getPAMCriteriaURL(),function(t){e.triggerAction(o.MODAL.ACT.ALERT_SHOW,{type:o.MODAL.ALERT.TYPE_INFO,message:t,closeTiming:o.MODAL.ALERT.CLOSE_TYPE_PERMANENT})})},reset:function(){this.triggerAction(o.MODAL.ACT.ALERT_HIDE),this.clearForm(),this.undelegateEvents()},validateForm:function(){var e=[];return 0!==this.$(".inputCurrentPassword").val().trim().length&&0!==this.$(".inputNewPassword").val().trim().length&&0!==this.$(".inputConfirmPassword").val().trim().length||e.push(this.i18n("error_form_incomplete")),e.length||(this.$(".inputCurrentPassword").val()===this.$(".inputNewPassword").val()&&e.push(this.i18n("error_new_password_must_be_different")),this.$(".inputConfirmPassword").val()!==this.$(".inputNewPassword").val()&&e.push(this.i18n("error_password_confirm_does_not_match"))),e.join("<br>")},clearForm:function(){this.$(".inputCurrentPassword").val(""),this.$(".inputNewPassword").val(""),this.$(".inputConfirmPassword").val("")},onCancel:function(){this.hide()},onEnterKeyPress:function(){this.changePassword()},changePassword:function(){var e=this,t=this.validateForm();if(t.trim().length>0)return void this.triggerAction(o.MODAL.ACT.ALERT_SHOW,{type:o.MODAL.ALERT.TYPE_ERROR,message:t});this.triggerAction(o.MODAL.ACT.COVER_SHOW),this.changePasswordModel=new c,this.changePasswordModel.set({oldPassword:this.$(".inputCurrentPassword").val(),newPassword:this.$(".inputNewPassword").val()}),this.$(".btnUpdate").button("loading"),this.changePasswordModel.save(null,{success:function(t,n){e.triggerAction(o.MODAL.ACT.COVER_HIDE),e.$(".btnUpdate").button("reset"),e.clearForm(),e.hide()},error:function(t,n){e.triggerAction(o.MODAL.ACT.COVER_HIDE);var i=r.processPamErrorResponse(n);e.triggerAction(o.MODAL.ACT.ALERT_SHOW,{type:o.MODAL.ALERT.TYPE_ERROR,message:a.hasAdminUsername()&&i?i:r.processAjaxError(n.responseText)}),e.$(".btnUpdate").button("reset")}})}})}),define("text!templates/popups/user/UserContentView.html",[],function(){return"\x3c!-- The parent div modal is #popupUser --\x3e\n<div data-ntnx-content-inner class=\"usersListContainer\">\n  <section data-ntnx-section=\"type-text\">\n    <%= i18n('userPopupDescription') %>\n  </section>\n  <section data-ntnx-section>\n    <%= Components.button({\n      extraClasses        : 'btnCreate',\n      extraAttr           : [{\n        key: 'data-loading-text',\n        value: i18n('saving')\n      }],\n      text                : i18n('newUser'),\n      iconLeft            : 'plus'\n    }) %>\n  </section>\n  <section data-ntnx-section>\n    <table id=\"userList\" class=\"table table-hover\">\n      <thead>\n        <tr>\n          <th><%= i18n('username') %></th>\n          <th><%= i18n('name') %></th>\n          <th><%= i18n('email') %></th>\n          <th><%= i18n('roles') %></th>\n          <th class='enableDisable'><%= i18n('enabled') %></th>\n          <th class='cell-actions'></th>\n        </tr>\n      </thead>\n      <tbody>\n        \x3c!-- @view: users go here... --\x3e\n      </tbody>\n    </table>\n  </section>\n</div>\n\n<div data-ntnx-content-inner class=\"userFormContainer\">\n  <div id=\"userForm\">\n    \x3c!-- @view: form goes here... --\x3e\n  </div>\n</div>\n"}),define("text!templates/popups/user/UserItemView.html",[],function(){return"<tr class=\"n-table-row\" data-id=\"<%= model.profile.username %>\">\n  <td class=\"userName\">\n    <%= model.profile.username %>\n  </td>\n  <td class=\"name\">\n    <%= model.profile.firstName %> <%= model.profile.lastName %>\n  </td>\n  <td class='emailAddress'>\n    <%= model.profile.emailId %>\n  </td>\n  <td class='userRoles'>\n    <%= roleLabels.join(',<br />') %>\n  </td>\n  <td class='enableDisable'>\n    <% if ( model.enabled ) {  %>\n      <a class='enableDisableLink' title=\"<%= i18n('clickToDisableUser') %>\"\n        dataId='<%= model.profile.username %>'\n        data-enable='enabled'>\n        <%= i18n('yes') %>\n      </a>\n    <% } else { %>\n      <a class='enableDisableLink' title=\"<%= i18n('clickToEnableUser') %>\"\n        dataId='<%= model.profile.username %>'\n        data-enable='disabled'>\n        <%= i18n('no') %>\n      </a>\n    <% } %>\n  </td>\n  <td class=\"user-list-cell cell-actions\">\n    <i dataId='<%= model.profile.username %>'\n      data-icon='F' aria-hidden='true' class='btnEdit'></i>\n    <% if (! isDefaultAdmin ) { %>\n      <span class=\"action-separator\">&middot;</span>\n      <i dataId='<%= model.profile.username %>' class='btnDelete'\n        data-icon='v' aria-hidden='true'></i>\n    <% } %>\n  </td>\n</tr>"}),define("text!templates/popups/user/UserFormView.html",[],function(){
return'<section data-ntnx-section="type-text">\n  <%= i18n(\'userCrudDescription\') %>\n</section>\n\n\x3c!-- Tab for profile User Form --\x3e\n<form id="userForm">\n  <section data-ntnx-section>\n    <label data-ntnx-label for="inputUsername"><%= i18n(\'username\') %></label>\n    <input type="text" class="inputUsername" id="inputUsername"\n      value="<%= model.profile.username || \'\' %>"\n      <% if ( model.profile.username !== null ) { %>\n        title="<%= i18n(\'usernameCannotBeChanged\') %>" disabled\n      <% } %>\n    >\n    <div data-ntnx-hint class="n-input-validation-msg"></div>\n  </section>\n\n  <section data-ntnx-section>\n    <label data-ntnx-label for="inputFirstName"><%= i18n(\'firstName\') %></label>\n    <input type="text" class="inputFirstName" id="inputFirstName"\n      value="<%= model.profile.firstName || \'\' %>"\n    >\n  </section>\n\n  <section data-ntnx-section>\n    <label data-ntnx-label for="inputLastName"><%= i18n(\'lastName\') %></label>\n    <input type="text" class="inputLastName" id="inputLastName"\n      value="<%= model.profile.lastName || \'\' %>"\n    >\n  </section>\n\n  <section data-ntnx-section>\n    <label data-ntnx-label for="inputEmailId"><%= i18n(\'email\') %></label>\n    <input type="text" class="inputEmailId" id="inputEmailId"\n      value="<%= model.profile.emailId || \'\' %>"\n    >\n  </section>\n\n  <section data-ntnx-section class="inputPassword">\n    <label data-ntnx-label for="inputNewPassword"><%= i18n(\'pwd\') %></label>\n    <input type="password" autocomplete="off"\n      class="inputNewPassword" id="inputNewPassword"\n    >\n  </section>\n\n  <section data-ntnx-section>\n    <label data-ntnx-label for="inputLocale"><%= i18n(\'language\') %></label>\n    <select class="language-list inputLocale" id="inputLocale"\n      data-class="fancy-select-bottom-anchor"\n    >\n      <% _.each(locales, function(value,key) { %>\n        <% var selected = (user_locale === key) ? \'selected\' : \'\'; %>\n        <option value="<%= key %>" <%= selected %>>\n          <%= value %>\n        </option>\n      <% }) %>\n    </select>\n  </section>\n\n  <section data-ntnx-section>\n    <label data-ntnx-label><%= i18n(\'roles\') %></label>\n    <div data-ntnx-form-inline>\n      <%= Components.checkbox({\n        id: \'ROLE_USER_ADMIN\',\n        jsClasses: \'linkRowCheckbox\',\n        checked: model.roles && (model.roles.indexOf(\'ROLE_USER_ADMIN\') >= 0),\n        disabled: model.profile.username === ROOT_USERNAME\n      }) %>\n      <label data-ntnx-inline-label for="ROLE_USER_ADMIN">\n        <%= USER_ROLE_LABELS.ROLE_USER_ADMIN %>\n        <span class="nutanixMoreInfo"\n          data-tooltip-placement="right"\n          data-tooltip-title="<%= i18n(\'adminClusterUserTooltip\') %>"\n        >\n        </span>\n      </label>\n    </div>\n    <div data-ntnx-form-inline>\n      <%= Components.checkbox({\n        id: \'ROLE_\' + (isMulticlusterUI ? \'MULTI\' : \'\') + \'CLUSTER_ADMIN\',\n        jsClasses: "linkRowCheckbox",\n        checked: isClusterAdmin,\n        disabled: model.profile.username === ROOT_USERNAME\n      }) %>\n      <label data-ntnx-inline-label\n        for="ROLE_<%= (isMulticlusterUI ? \'MULTI\' : \'\') %>CLUSTER_ADMIN">\n        <%= (!isMulticlusterUI ?\n              USER_ROLE_LABELS.ROLE_CLUSTER_ADMIN :\n              USER_ROLE_LABELS.ROLE_MULTICLUSTER_ADMIN) %>\n      </label>\n    </div>\n  </section>\n\n  \x3c!-- ResetPassword --\x3e\n  \x3c!-- TODO: Revisit the design with jeremy and Brian --\x3e\n  <div id="resetPasswordContainer" class="hide">\n    <section data-ntnx-section="type-separator">\n      <h5 data-ntnx-title><%= i18n(\'resetPwd\') %></h5>\n    </section>\n\n    <section data-ntnx-section>\n      <label data-ntnx-label>\n        <%= i18n(\'pwd\') %>\n      </label>\n      <input type="password" autocomplete="off" class="resetPassword">\n    </section>\n\n    <section data-ntnx-section>\n      <label data-ntnx-label>\n        <%= i18n(\'confirmPwd\') %>\n      </label>\n      <input type="password" autocomplete="off" class="confirmResetPassword">\n    </section>\n  </div>\n</form>'}),define("views/popups/user/UserPopupView",["backbone","views/basecomponents/popups/BasePopupView","models/BaseModel","models/BaseCollection","data/DataURLConstants","data/DataManager","managers/I18nManager","managers/ClusterManager","managers/AccessManager","utils/AppConstants","utils/AppUtil","utils/I18NUtil","data/DataProperties","text!templates/popups/user/UserContentView.html","text!templates/popups/user/UserItemView.html","text!templates/popups/user/UserFormView.html"],function(e,t,n,i,s,a,o,r,l,c,d,p,u,h,m,f){"use strict";h=_.template(h);var v=n.extend({urlRoot:s.USERS,entityType:c.ENTITY_USER,defaults:{id:null,profile:{username:null,firstName:null,middleInitial:null,lastName:null,emailId:null,password:null,locale:null},enabled:!1,roles:[]},name:"UserModel",sync:function(t,n,i){return i=this.parseOptions(t,n,i),"update"!==t&&"create"!==t||(i.url=a.getFormattedURL(n.urlRoot),n.unset("id")),d.log("BaseModel : \n\t method: "+t+"\n\t data  : "+i.url),e.sync(t,n,i)},validate:function(e){var t=[];if(0===$.trim(e.profile.username).length&&t.push(this.i18n("username")),0===$.trim(e.profile.firstName).length&&t.push(this.i18n("firstName")),0===$.trim(e.profile.lastName).length&&t.push(this.i18n("lastName")),0===$.trim(e.profile.emailId).length&&t.push(this.i18n("email")),void 0===e.creationTimeUsecs){var n=$.trim(e.profile.password).length;if(0===n)t.push(this.i18n("pwd"));else if(n<8)return this.i18n("pwdLengthError")}if(t.length>0)return this.i18ns("fieldsRequiredError",t.join(", "))},enableUser:function(e,t,n){var i=a.getDataSourceURL()+s.USERS+"/"+this.get("profile").username+"/enable";$.ajax({type:"PUT",url:i,contentType:"application/json; charset=UTF-8",data:d.convertPrimitiveToJSON(""+e,!0),statusCode:this.getStatusCode(),success:function(e,n,i){t(e)},error:function(e,t,i){var s=this.i18n("unableToEnableDisableUserError")+" ";e&&e.responseText&&e.responseText.length>0&&(s+=" "+d.processAjaxError(e.responseText)),n(s)}})}}),g=n.extend({urlRoot:s.USERS,entityType:c.ENTITY_USER,actionMode:c.ACTION_UPDATE,defaults:{id:null,roles:[]},sync:function(t,n,i){i=this.parseOptions(t,n,i),t="update",i.url=a.getFormattedURL(n.url()+"/"+s.ROLES),n.unset("id"),d.log("BaseModel : \n\t method: "+t+"\n\t data  : "+i.url),e.sync(t,n,i)},toJSON:function(){return this.get("roles")}}),E=n.extend({urlRoot:s.USERS+s.RESET_PASSWORD,entityType:c.ENTITY_USER_PASSWORD,defaults:{username:null}}),T=i.extend({model:v,url:s.USERS,getUser:function(e){var t=this.models;if(t&&t.length)for(var n=0;n<t.length;n++)if(t[n].toJSON().profile&&t[n].toJSON().profile.username===e)return t[n];return null},comparator:function(e){return e.get("profile").username}});return t.extend({name:"UserPopupView",el:"#popupUser",userModel:null,rolesModel:null,resetPasswordModel:null,MODE_CREATE:"Create",MODE_UPDATE_PROFILE:"UpdateProfile",MODE_UPDATE_ROLES:"UpdateRoles",isEnablingUser:!1,events:{"click  .modal-header .close":"hide","click  .btnCreate":"onCreateItem","click  .btnDelete":"onDeleteItem","click  .btnEdit":"onEditItem","click  .enableDisableLink":"onEnableDisableUser","click  .btnAddUser":"onSave","click  .btnUpdateProfile":"onSave","click  .btnBack":"onBack","click  .btnCancel":"discardChanges","click  .btnClose":"hide","keyup .inputUsername":"onInputNameKeyUp","keypress input":"onKeyPress","click input":"clearHeader","click #ROLE_USER_ADMIN":"onCheckUserAdmin","click .btnResetPassword":"onClickResetPassword"},render:function(){this.$el.html(this.defaultTemplate({title:this.i18n("userManagement"),antiscroll:!1,bodyContent:h(this.vtOptions()),footerButtons:this.defaultFooter(this.getFooterButtons())}))},show:function(e){t.prototype.show.apply(this,arguments),this.$(".n-btn-list").hide(),this.$(".n-btn-form").hide(),this.$(".btnResetPassword").hide(),this.$(".btnClose").show(),this.listUser(),e.actionTargetId&&this.editItem(e.actionTargetId,!1)},hide:function(){this.$(".nutanixMoreInfo").nutanixMoreInfo("destroy"),t.prototype.hide.apply(this,arguments)},discardChanges:function(){this.showList()},getFooterButtons:function(){return[{text:this.i18n("cancel"),extraClasses:"btnCancel n-btn-form hide"},{text:this.i18n("back"),extraClasses:"btnBack n-btn-form hide",leftAligned:!0,iconLeft:"caret-left"},{text:this.i18n("resetPwd"),extraClasses:"btnResetPassword",leftAligned:!0},{isPrimary:!0,text:this.i18n("save"),extraClasses:"btnAddUser n-btn-form hide",extraAttr:[{key:"data-loading-text",value:this.i18n("saving")},{key:"title",value:this.i18n("clickToAddThisUser")}]},{isPrimary:!0,text:this.i18n("save"),extraClasses:"btnUpdateProfile n-btn-form hide",extraAttr:[{key:"data-loading-text",value:this.i18n("saving")},{key:"title",value:this.i18n("clickToUpdateSettings")}]},{isPrimary:!0,text:this.i18n("save"),extraClasses:"tnUpdateRoles n-btn-form hide",extraAttr:[{key:"data-loading-text",value:this.i18n("saving")},{key:"title",value:this.i18n("clickToUpdateRoles")}]},{isPrimary:!0,text:this.i18n("save"),extraClasses:"btnUpdatePassword n-btn-form hide",extraAttr:[{key:"data-loading-text",value:this.i18n("saving")},{key:"title",value:this.i18n("clickToChangePwd")}]}]},showForm:function(e,t){this.mode=e,this.triggerAction(c.MODAL.ACT.ALERT_HIDE),this.$(".n-btn-list").hide(),this.$(".n-btn-form").hide(),this.$(".tab-pane").hide(),this.$(".btnBack").show(),this.$(".btnClose").hide(),this.$(".btnCancel").show(),this.$("#resetPasswordContainer").hide(),"Create"===this.mode?(this.$(".btnAddUser").show(),this.$(".tab-pane-profile").show(),this.$(".nav").hide(),this.$(".user-form-tabs-content").addClass("user-form-tabs-content-standalone"),this.$(".inputUsername").focus(),this.setTitle(this.i18n("createUser"))):"UpdateProfile"===this.mode&&(this.$(".tab-pane-profile").show(),this.$(".inputPassword").hide(),this.$(".resetPassword").show(),this.$(".btnUpdateProfile").show(),this.$(".btnResetPassword").show(),this.$('.nav a[data-target="#profile"]').tab("show"),this.$(".user-form-tabs-content").removeClass("user-form-tabs-content-standalone"),this.setTitle(this.i18n("updateUser"))),this.hideSubview(".usersListContainer"),t?this.showSubview(".userFormContainer","left"):this.$(".userFormContainer").show(),this.$(".nutanixMoreInfo").nutanixMoreInfo({parseDataAttrs:!0})},showList:function(){this.$(".nutanixMoreInfo").nutanixMoreInfo("destroy"),this.setTitle(this.i18n("userManagement")),this.$(".n-btn-list").hide(),this.$(".n-btn-form").hide(),this.$(".btnResetPassword").hide(),this.$(".btnClose").show(),this.hideSubview(".userFormContainer"),this.showSubview(".usersListContainer")},reset:function(){this.clearHeader(),this.triggerAction(c.MODAL.ACT.ALERT_HIDE),this.showList(),this.undelegateEvents()},getCheckedRoles:function(){return _.pluck(this.$(".linkRowCheckbox:checked"),"id")},onInputNameKeyUp:function(e){var t=new RegExp("^(_|-|"+p.validNameRange+")+$");d.validNameCharactersEventHandler(e,this.$(".n-input-validation-msg"),!1,this.i18n("invalidNameMessage"),t)},onCheckUserAdmin:function(e){$(e.target).prop("checked")&&this.$("#ROLE_CLUSTER_ADMIN").prop({checked:!0})},getFormTemplate:function(e){return e=e||{},_.template(f,this.vtOptions({model:this.userModel.toJSON(),locales:c.I18N_LOCALES,user_locale:e.locale||o.DEFAULT_LOCALE,ROOT_USERNAME:c.ROOT_USERNAME,isClusterAdmin:this._isRoleClusterAdmin(),USER_ROLE_LABELS:c.USER_ROLE_LABELS,isMulticlusterUI:r.isMulticlusterUI()}))},onCreateItem:function(){this.userModel=new v,this.$("#userForm").html(this.getFormTemplate()),this.showForm(this.MODE_CREATE,!0),this.applyNutanixInput()},onEditItem:function(e){var t=$(e.currentTarget).attr("dataId");this.editItem(t,!0)},editItem:function(e,t){var n=this;this.userModel=new v,this.userModel.id=e,this.userModel.fetch({silent:!0,success:function(){n.$("#userForm").html(n.getFormTemplate({locale:n.userModel.get("profile")[u.USER_LOCALE]})),n.showForm(n.MODE_UPDATE_PROFILE,t),n.applyNutanixInput()},error:function(e,t){n.triggerAction(c.MODAL.ACT.ALERT_SHOW,{type:c.MODAL.ALERT.TYPE_ERROR,message:t.responseText})}})},onEnableDisableUser:function(e){var t=this;if(this.isEnablingUser)return void d.log("UserPopupView:onEnableDisableUser","Request to enable/disable a user ignored. ","Enable/Disable already in progress");var n=$(e.currentTarget),i="enabled"===n.attr("data-enable"),s=$(e.currentTarget).attr("dataId"),a=this.model.getUser(s);a&&(this.isEnablingUser=!0,a.enableUser(!i,function(){t.isEnablingUser=!1,t.listUser()},function(e){t.isEnablingUser=!1,t.triggerAction(c.MODAL.ACT.ALERT_SHOW,{type:c.MODAL.ALERT.TYPE_ERROR,message:e})}))},onDeleteItem:function(e){var t=this,n=$(e.currentTarget).attr("dataId"),i=this.i18ns("userDeleteConfirmation",n)+"<br><br>"+c.DELETE_WARNING_MESSAGES[c.SSP_MAPPING_EB_TO_ENTITY[c.ENTITY_USER]];$.nutanixConfirm({msg:i,yes:function(){t.deleteUser(n)}})},onBack:function(){this.triggerAction(c.MODAL.ACT.ALERT_HIDE),this.listUser(),this.showList()},onSave:function(){var e=this;if(this.userModel){this.userModel.on("error",function(t,n){e.triggerAction(c.MODAL.ACT.ALERT_SHOW,{type:c.MODAL.ALERT.TYPE_ERROR,message:n})});!1!==this.userModel.set({profile:{username:this.$(".inputUsername").val(),firstName:this.$(".inputFirstName").val(),middleInitial:this.$(".inputMiddleInitial").val(),lastName:this.$(".inputLastName").val(),emailId:this.$(".inputEmailId").val(),password:this.$(".inputNewPassword").val(),locale:this.$(".inputLocale").val()}})&&this.validateAndResetPassword()}},onClickResetPassword:function(){this.toggleResetPassword()},validateAndResetPassword:function(){var e=this,t=this.$(".inputUsername").val(),n=this.$(".resetPassword").val(),i=this.$(".confirmResetPassword").val();if(""!==n||""!==i){if(n!==i)return void this.triggerAction(c.MODAL.ACT.ALERT_SHOW,{type:c.MODAL.ALERT.TYPE_ERROR,message:this.i18n("confirmPwdError")});if(!(n=n.trim()))return void this.triggerAction(c.MODAL.ACT.ALERT_SHOW,{type:c.MODAL.ALERT.TYPE_ERROR,message:this.i18n("emptyPwdError")});this.resetPasswordModel.set({username:t,password:n}),this.resetPasswordModel.save(null,{success:function(t,n){e.saveUser()},error:function(t,n){var i=d.processPamErrorResponse(n);e.triggerAction(c.MODAL.ACT.ALERT_SHOW,{type:c.MODAL.ALERT.TYPE_ERROR,message:l.hasAdminUsername()&&i?i:e.i18ns("resetPwdError",d.processAjaxError(n.responseText))})}})}else this.saveUser()},toggleResetPassword:function(){var e=this,t=this.$("#resetPasswordContainer"),n=t.is(":visible");return t.slideToggle("fast",function(){e.triggerAction(c.MODAL.ACT.AS_REBUILD),t.is(":visible")?l.hasAdminUsername()&&d.getPAMCriteria(a.getPAMCriteriaURL(),function(t){e.triggerAction(c.MODAL.ACT.ALERT_SHOW,{type:c.MODAL.ALERT.TYPE_INFO,message:t,closeTiming:c.MODAL.ALERT.CLOSE_TYPE_PERMANENT})}):e.triggerAction(c.MODAL.ACT.ALERT_HIDE)}),n||this.resetPasswordModel||(this.resetPasswordModel=new E),!n},onEnterKeyPress:function(){this.onSave()},listUser:function(){var e=this;this.model=new T,this.model.fetch({silent:!0,success:function(){var t=e.model.models,n=$("#userList > tbody");if(n.html(""),t&&t.length)for(var i=0;i<t.length;i++){var s=t[i].toJSON(),a=_.template(m,e.vtOptions({model:s,roleLabels:e._getDisplayRoleLabels(s.roles),isDefaultAdmin:c.ROOT_USERNAME===s.profile.username}));n.append(a)}else n.append(e.i18n("usersHaveNotBeenCreated"));e.triggerAction(c.MODAL.ACT.AS_REBUILD)},error:function(t,n){e.triggerAction(c.MODAL.ACT.ALERT_SHOW,{type:c.MODAL.ALERT.TYPE_ERROR,message:n.responseText})}})},_getDisplayRoleLabels:function(e){return _.map(e,function(e){return c.USER_ROLE_LABELS[e]})},deleteUser:function(e){var t=this;this.model&&this.model.models&&this.model.getUser(e)&&(this.userModel=this.model.getUser(e),this.userModel.set("id",e),this.userModel.destroy({success:function(e,n){t.listUser()},error:function(e,n){t.triggerAction(c.MODAL.ACT.ALERT_SHOW,{type:c.MODAL.ALERT.TYPE_ERROR,message:n.responseText})}}))},_onSuccessUpdate:function(){this.listUser(),this.showList(),this.$(".btnUpdateProfile").button("reset"),this.$(".btnAddUser").button("reset")},saveUser:function(){var e=this;this.userModel&&(this.userModel.isNew(this.mode===this.MODE_CREATE),this.$(".btnUpdateProfile").button("loading"),this.$(".btnAddUser").button("loading"),this.userModel.save(null,{success:function(t,n){t.get("profile").username===c.ROOT_USERNAME?e._onSuccessUpdate():e._onUpdateRoles()},error:function(t,n){e.triggerAction(c.MODAL.ACT.ALERT_SHOW,{type:c.MODAL.ALERT.TYPE_ERROR,message:e.i18ns("userSettingsSaveError",d.processAjaxError(n.responseText))}),e.$(".btnUpdateProfile").button("reset"),e.$(".btnAddUser").button("reset")}}))},_onUpdateRoles:function(){var e=this,t=this.getCheckedRoles(),n=this.$(".inputUsername").val();this.rolesModel=new g,this.rolesModel.set("id",n),this.rolesModel.set("roles",t),this.$(".btnUpdateProfile").button("loading"),this.rolesModel.save(null,{success:_.bind(this._onSuccessUpdate,this),error:function(t,n){e.triggerAction(c.MODAL.ACT.ALERT_SHOW,{type:c.MODAL.ALERT.TYPE_ERROR,message:e.i18ns("userRolesSaveError",d.processAjaxError(n.responseText))}),e.$(".btnUpdateProfile").button("reset"),e.$(".btnAddUser").button("reset")}})},_isRoleClusterAdmin:function(){var e=this.userModel.get(u.USER_ROLES);return this.clusterManager.isMulticlusterUI()?e&&e.indexOf(c.USER_ROLE.MULTICLUSTER_ADMIN)>=0:e&&e.indexOf(c.USER_ROLE.CLUSTER_ADMIN)>=0},destroy:function(){this.userModel&&this.userModel.off(),this.$(".nutanixMoreInfo").nutanixMoreInfo("destroy"),t.prototype.destroy.apply(this,arguments)}})}),define("text!templates/popups/dashboards/ManageDashboardsPopupView.html",[],function(){return'\x3c!-- The parent div modal is #popupManageDashboards --\x3e\n<div class="modal-header">\n  <button\n    type="button"\n    class="close xClose"\n    data-dismiss="modal"\n  >\n    <i data-icon="K" aria-hidden="true"></i>\n  </button>\n  <h4 class="n-title">\n    <%= i18n(\'manage_dashboards\') %>\n  </h4>\n</div>\n\n<div class="n-modal-wrapper">\n  <div class="n-modal-body">\n    <div class="n-modal-content-wrapper">\n      <div class="n-modal-alert-header">\n        \x3c!-- @view: alert goes here... --\x3e\n      </div>\n      <div class="n-modal-content dashboardListContainer">\n        <div>\n          <button class="btnCreate btn btn-create"\n                  stream-action="Dashboards: NewDashboard"\n                  stream-target="Dashboard"\n                  data-loading-text="Saving...">\n            <%= Components.icon("H") %>\n            <span class="btn-content">\n              <%= i18n(\'new_dashboard\') %>\n            </span>\n          </button>\n          <span class="n-modal-loading" style="display:none;">\n                      <span class="n-loading-text">Loading data </span>\n                      <div class="donut-loader-blue"></div>\n                    </span>\n        </div>\n        <div class="dashboardListWrapper dashboards-list-wrapper">\n          <table id="dashboardList" class="dashboards-list table table-hover">\n            <tbody>\n            \x3c!-- @view: dashboard go here... --\x3e\n            </tbody>\n          </table>\n        </div>\n      </div>\n    </div>\n  </div>\n  <div class="n-modal-footer">\n    <%= Components.button({\n      extraClasses        : \'btnClose btn\',\n      text                : i18n(\'close\')\n    }) %>\n\n    <%= Components.button({\n      extraClasses        : \'btnBack btn n-btn-form pull-left\',\n      text                : i18n(\'back\'),\n      iconLeft            : \'caret-left\'\n    }) %>\n\n    <%= Components.button({\n      extraClasses        : \'btnSave btn n-btn-form\',\n      extraAttr           : [{\n        key: \'data-loading-text\',\n        value: i18n(\'saving\')\n      }],\n      text                : i18n(\'save\'),\n    }) %>\n\n  </div>\n</div>'}),define("text!templates/popups/dashboards/CreateDashboardFormView.html",[],function(){return'<tr class="n-table-row create-dashboard-row edit">\n  <td class="name">\n    <span class="editable show">\n      <input type="text" value=""\n        placeholder="<%= i18n(\'enter_new_dashboard_name\',\n          \'Enter new dashboard name\') %>"\n        class="inputDashboardName edit-text">\n    </span>\n  </td>\n  <td class="cell-actions">\n    <span class="editable show">\n      <a class="btnSave action"><%= i18n("save", "Save") %></a>\n      <a class="btnCancel action"><%= i18n("cancel", "Cancel") %></a>\n    </span>\n  </td>\n</tr>'}),define("text!templates/popups/dashboards/DashboardItemView.html",[],function(){return'<tr class="n-table-row" data-id="<%= model.id %>">\n  <td class="name">\n    <span class="noneditable title">\n      <%- model.title %>\n    </span>\n    <span class="editable">\n      <input type="text" value="<%-model.title%>" class="edit-text editTxt"\n             placeholder="<%= i18n(\'enter_dashboard_name\',\n              \'Enter dashboard name\') %>">\n    </span>\n  </td>\n  <td class="cell-actions">\n    <span class="noneditable">\n      <% if (isPrismProFeaturesEnabled) { %>\n        <i class="btn-edit btnEdit" data-icon="F" aria-hidden="true"\n           stream-action="Dashboards: EditDashboard"\n           stream-target="<%- model.title %>" ></i>\n        <span class="action-separator">&middot;</span>\n      <% } %>\n      <i class="btn-del btnDel" data-icon="v" aria-hidden="true"\n         stream-action="Dashboards: DeleteDashboard"\n         stream-target="<%- model.title %>"></i>\n    </span>\n    <span class="editable">\n      <a class="btnUpdate action"><%= i18n("save", "Save") %></a>\n      <a class="btnCancel action"><%= i18n("cancel", "Cancel") %></a>\n    </span>\n  </td>\n</tr>\n'}),define("views/popups/dashboards/ManageDashboardsPopupView",["views/basecomponents/popups/BasePopupView","managers/DashboardManager","managers/LicenseManager","utils/AppUtil","text!templates/popups/dashboards/ManageDashboardsPopupView.html","text!templates/popups/dashboards/CreateDashboardFormView.html","text!templates/popups/dashboards/DashboardItemView.html"],function(e,t,n,i,s,a,o){"use strict";return e.extend({el:"#popupManageDashboards",name:"ManagaDashboardsPopupView",events:{"click  .modal-header .close":"hide","click  .btnCreate":"onClickNewDashboard","click  .btnBack":"showDashboardsList","click  .btnClose":"hide","click  .btnDel":"onDeleteItem","click  .btnEdit":"onEditItem","click  .btnUpdate":"onUpdateDashboard","click  .btnSave":"onNewDashboard","click  .btnCancel":"render"},render:function(){this.template=_.template(s),this.$el.html(this.template(this.vtOptions())),this.addLoader(),t.fetchOnDemand()},show:function(n){t.registerDashboardListener(t.EVENTS.FETCH_DASHBOARDS,this.showDashboardsList,this),t.registerDashboardListener(t.EVENTS.ERROR,this.showHeaderError,this),t.registerDashboardListener(t.EVENTS.SUCCESS,this.showHeaderSuccess,this),e.prototype.show.apply(this,arguments)},hide:function(){this.$(".n-tooltip-circle").tooltip("destroy"),e.prototype.hide.apply(this,arguments),t.unregisterDashboardListener(t.EVENTS.FETCH_DASHBOARDS,this.showDashboardsList,this),t.unregisterDashboardListener(t.EVENTS.ERROR),t.unregisterDashboardListener(t.EVENTS.SUCCESS)},showList:function(){this.$(".n-title").text(this.i18n("manage_dashboards","Manage Dashboards")),this.$(".n-btn-form").hide(),this.$(".btnClose").show(),this.$(".btnClose").attr("disabled",!1),this.$(".dashboardListContainer").show()},reset:function(){this.clearHeader(),this.showList(),this.undelegateEvents()},showHeaderSuccess:function(t,n){this.showDashboardsList(),e.prototype.showHeaderSuccess.call(this,n)},addLoader:function(){this.$(".dashboardListWrapper").prepend('<div class="loader"><span class="donut-loader-blue"></span><span class="msg"> Loading dashboards...</span></div>'),this.$(".btnCreate").attr("disabled",""),this.$("#dashboardList").addClass("empty")},removeLoader:function(){this.$(".loader").remove(),this.$(".btnCreate").removeAttr("disabled"),this.$("#dashboardList").removeClass("empty")},listDashboards:function(){var e=t.getDashboards(),i=this.$(".dashboardListWrapper"),s=this.$("#dashboardList"),a=this.$("#dashboardList > tbody");if(a.empty(),e&&e.length){s.removeClass("empty");for(var r=0;r<e.length;r++){var l=_.template(o,this.vtOptions({model:e[r].toJSON(),isPrismProFeaturesEnabled:n.isPrismProFeaturesEnabled()}));a.append(l)}}else i.prepend('<div class="no-dashboards">There are currently no custom dashboards. Click the New Dashboard button above to create a new custom dashboard.</div>'),s.addClass("empty")},deleteDashboard:function(e){this.showHeaderSaving(),this.$(".btnCreate").attr("disabled","disabled"),this.$(".btnClose").attr("disabled","disabled"),this.$(".btnEdit").addClass("btn-disabled"),this.$(".btnDel").addClass("btn-disabled"),t.deleteDashboard(e)},onNewDashboard:function(){var e=this,n=e.$(".inputDashboardName").val().trim();e.showHeaderSaving();var i=e.$(".no-dashboards");i.length&&i.remove(),t.addDashboard(n,function(){e.hide()})},onUpdateDashboard:function(e){var n=this.$(e.currentTarget).parents(".n-table-row"),i=n.attr("data-id"),s=n.find(".editTxt").val().trim();this.showHeaderSaving(),t.editDashboard(i,s)},onEditItem:function(e){var t=this.$("#dashboardList .n-table-row");t.removeClass("edit"),t.find(".editable").removeClass("show"),t.find(".noneditable").removeClass("hide"),this.$(".create-dashboard-row").remove();var n=this.$(e.currentTarget).parents(".n-table-row").addClass("edit");n.find(".noneditable").addClass("hide"),n.find(".editable").addClass("show"),n.find(".editTxt").focus(),this.$(".btnCreate").attr("disabled","disabled"),this.$(".btnClose").attr("disabled","disabled")},onClickNewDashboard:function(){this.$(".btnCreate").attr("disabled","disabled"),this.$(".btnClose").attr("disabled","disabled"),this.$("#dashboardList > tbody").append(_.template(a)(this.vtOptions())),this.$("#dashboardList").removeClass("empty"),this.$(".inputDashboardName").focus(),this.applyNutanixInput()},showDashboardsList:function(){this.removeLoader(),this.listDashboards(),this.showList(),t.getDashboards().length>=20?(this.$(".btnCreate").attr("disabled",""),this.showHeaderWarning(this.i18ns("error_max_dashboards",20))):n.isPrismProFeaturesEnabled()?(this.clearHeader(),this.$(".btnCreate").attr("disabled",!1)):(this.$(".btnCreate").hide(),this.showHeaderWarning(this.i18n("license_message")))},onDeleteItem:function(e){var t=this.$(e.currentTarget).parents(".n-table-row"),n=t.attr("data-id"),s=_.escape(t.find(".title").text().trim()),a=i.sprintf(this.i18n("confirm_delete","Are you sure you want to delete %s?"),s);$.nutanixConfirm({context:this,msg:a,yes:function(){this.deleteDashboard(n)}})},showHeaderError:function(t){this.$(".btnClose").prop("disabled",!1),this.$(".btnEdit").removeClass("btn-disabled"),this.$(".btnDel").removeClass("btn-disabled"),e.prototype.showHeaderError.apply(this,arguments)}})}),define("text!templates/popups/user/RoleMappingsPopupView.html",[],function(){return'\x3c!-- The parent div modal is #popuprolemappings --\x3e\n<div class="modal-header">\n  <button type="button" class="close" data-dismiss="modal">\n    <i data-icon="K" aria-hidden="true"></i>\n  </button>\n  <h4 class="n-title"><%=i18n(\'configureTitle\')%></h4>\n</div>\n\n<div class="n-modal-wrapper">\n  <div class="n-modal-body">\n    <div class="n-modal-content-wrapper">\n      <div class="n-modal-alert-header">\n        \x3c!-- @view: alert goes here... --\x3e\n      </div>\n      <div class="n-modal-content roleMappingsListContainer">\n        <div class="n-popup-description">\n          <%=i18n(\'configureDesc\')%>\n        </div>\n        <% if (canModify) { %>\n        <div class="n-popup-description">\n          <%= Components.button({\n            extraClasses        : \'btnCreate\',\n            extraAttr           : [{\n              key: \'data-loading-text\',\n              value: i18n(\'saving\')\n            }],\n            text                : i18n(\'newMapping\'),\n            iconLeft            : \'plus\'\n          }) %>\n        </div>\n        <% } %>\n        <table id="roleMappingList" class="table table-hover">\n          <thead>\n          <tr>\n            <th><%=i18n(\'directory\')%></th>\n            <th><%=i18n(\'role\')%></th>\n            <th><%=i18n(\'LDAPType\')%></th>\n            <th><%=i18n(\'values\')%></th>\n            <th class=\'cell-actions\'>&nbsp;</th>\n          </tr>\n          </thead>\n          <tbody>\n          \x3c!-- @view: role mappings go here... --\x3e\n          </tbody>\n        </table>\n      </div>\n\n      <div class="n-modal-content roleMappingFormContainer"\n           style="display: none;">\n        <div id="roleMappingForm">\n          \x3c!-- @view: form goes here... --\x3e\n        </div>\n      </div>\n    </div>\n  </div>\n  <div class="n-modal-footer">\n    <button class="btnCancel btn n-btn-form secondary-btn"\n            style="display:none">\n      Cancel\n    </button>\n\n    \x3c!-- back btn --\x3e\n\n    <button style="display:none"\n            class="btnBack btn n-btn-form secondary-btn pull-left">\n      <%= SVG.SVGIcon("caret-left") %>\n      <span class="btn-content">Back</span>\n    </button>\n\n\n    \x3c!-- OK button for add role mapping --\x3e\n    <button class="btnAddRoleMapping btn btn-primary n-btn-form"\n            style="display:none"\n            title="Click to add this role mapping"\n            data-loading-text="Saving...">\n      <span class="btn-content">Save</span>\n    </button>\n\n    \x3c!-- OK button for update role mapping --\x3e\n    <button class="btnUpdateRoleMapping btn btn-primary n-btn-form"\n            style="display:none"\n            title="Click to update the settings above"\n            data-loading-text="Saving...">\n      <span class="btn-content">Save</span>\n    </button>\n\n  </div>\n</div>\n'}),define("text!templates/popups/user/RoleMappingItemView.html",[],function(){return'<% var id = (model.directoryName || model.idpUuid) + "," + model.role + "," +\n  model.entityType + "," + model.isIDP; %>\n<tr class="n-table-row" data-id="<%= id %>">\n  <td>\n    <%= _.escape(model.directoryName || model.name) %>\n  </td>\n  <td>\n    <%= model.roleLabel %>\n  </td>\n  <td>\n    <%= model.entityType %>\n  </td>\n  <td>\n    <%= _.escape(model.entityValues) %>\n  </td>\n  <td class="user-list-cell cell-actions">\n    <i dataId=\'<%= id %>\' data-icon="F" aria-hidden="true" class=\'btnEdit\'>\n    </i>\n    <i dataId=\'<%= id %>\' class=\'btnDelete\' data-icon="v" aria-hidden="true">\n    </i>\n  </td>\n</tr>\n'}),define("text!templates/popups/user/RoleMappingFormView.html",[],function(){
return"<div class=\"n-popup-tabs\">\n    <div class=\"n-popup-description\">\n        <%=i18n('createDesc')%>\n    </div>\n    \x3c!-- Tab for role mapping --\x3e\n    <form id=\"rolemappingForm\" class=\"form-horizontal\" stype=\"padding-top:5px\">\n        <div class=\"control-group\">\n            <label class=\"control-label\" for=\"directory\">\n                <%=i18n('directory')%>\n            </label>\n\n            <% if(mode === 'Update') { %>\n            <input type=\"text\" disabled\n                   value='<%= _.escape(model.directoryName || model.name) %>'\n                   />\n            <input type=\"hidden\" class=\"directory\"\n                   value='<%= _.escape(model.directoryName || model.idpUuid) %>'\n                   />\n            <% } else { %>\n            <div class=\"controls select-wrapper\">\n                <select class=\"directory\">\n                </select>\n            </div>\n\n            <% }%>\n        </div>\n        <div class=\"control-group ldapTypeSection <%= isIDP ? 'hide' : ''%>\">\n            <label class=\"control-label\" for=\"ldapType\">\n                <%=i18n('LDAPType')%>\n            </label>\n\n            <% if(mode === 'Update') { %>\n            <input type=\"text\" class='ldapType' disabled\n                   value='<%=model.entityType%>'/>\n            <% } else { %>\n\n            <div class=\"controls select-wrapper\">\n                <select class=\"ldapType\">\n                    <option value=\"USER\"\n                    <%= model.entityType === 'USER' ? 'selected' :''\n                    %>><%=i18n('user')%></option>\n                    <option value=\"GROUP\"\n                    <%= model.entityType === 'GROUP' ? 'selected' :''\n                    %>><%=i18n('group')%></option>\n                    <option value=\"OU\"\n                    <%= model.entityType === 'OU' ? 'selected' :''\n                    %>><%=i18n('ou')%></option>\n                </select>\n            </div>\n            <% }%>\n        </div>\n        <div class=\"control-group\">\n            <label class=\"control-label\" for=\"role\">\n                <%=i18n('role')%>\n            </label>\n            <% if(mode === 'Update') { %>\n            <input type=\"text\" class='role' disabled\n              value='<%=model.roleLabel%>'/>\n            <% } else { %>\n            <div class=\"controls select-wrapper\">\n                <select class=\"role\">\n                    <option value=\"ROLE_CLUSTER_VIEWER\"\n                    <%= model.role === 'ROLE_CLUSTER_VIEWER' ? 'selected' :''\n                    %>><%=i18n('viewer')%></option>\n                    <option value=\"ROLE_CLUSTER_ADMIN\"\n                    <%= model.role === 'ROLE_CLUSTER_ADMIN' ? 'selected' :''\n                    %>><%=i18n('clusterAdmin')%></option>\n                    <option value=\"ROLE_USER_ADMIN\"\n                    <%= model.role === 'ROLE_USER_ADMIN' ? 'selected' :''\n                    %>><%=i18n('userAdmin')%></option>\n                </select>\n            </div>\n            <% }%>\n        </div>\n\n        <div class=\"control-group\">\n            <label class=\"control-label\" for=\"values\"><%=i18n('values')%></label>\n            <div class=\"controls\">\n                <input type=\"text\" class=\"inputMappingName values\"\n                  placeholder=\"<%=i18n('roleMappingPlaceHolderText')%>\"\n                  value=\"<%= _.escape(model.entityValues || '') %>\">\n                <div data-ntnx-hint class=\"n-input-validation-msg roleMappingHelpText\"></div>\n            </div>\n        </div>\n\n    </form>\n</div>"}),define("views/popups/user/RoleMappingPopupView",["backbone","views/basecomponents/popups/BasePopupView","bluebird","models/BaseModel","models/BaseCollection","models/popup/RoleMappingModel","models/popup/RoleMappingCollection","models/identityprovider/IdentityProviderCollection","data/DataProperties","data/DataURLConstants","data/DataManager","managers/ActionManager","utils/AppConstants","utils/AppUtil","utils/SubModelHelper","utils/ValidationUtil","text!templates/popups/user/RoleMappingsPopupView.html","text!templates/popups/user/RoleMappingItemView.html","text!templates/popups/user/RoleMappingFormView.html"],function(e,t,n,i,s,a,o,r,l,c,d,p,u,h,m,f,v,g,E){"use strict";var T=i.extend({urlRoot:c.DIRECTORIES,entityType:u.ENTITY_ROLE_MAPPING,roleMappings:null,defaults:{directoryType:"ACTIVE_DIRECTORY",connectionType:"LDAP",directoryUrl:"",domain:"",name:""},sync:function(t,n,i){i=this.parseOptions(t,n,i),i.url=d.getDataSourceURL()+c.DIRECTORIES,h.log("BaseModel : \n\t method: "+t+"\n\t data  : "+i.url),e.sync(t,n,i)}}),C=s.extend({model:T,url:c.DIRECTORIES,sync:function(t,n,i){return i=this.parseOptions(t,n,i),i.url=d.getDataSourceURL()+c.DIRECTORIES,h.log("BaseModel : \n\t method: "+t+"\n\t data  : "+i.url),e.sync(t,n,i)},getDirectory:function(e){return _.find(this.models,function(t){return t.get(l.NAME)===e})}});return t.extend({roleMappingsCollection:null,subModelHelper:null,el:"#popupRoleMapping",MODE_CREATE:"Create",MODE_UPDATE:"Update",name:"RoleMappingPopupView",events:{"click  .btnCreate":"onCreateItem","click  .modal-header .close":"hide","click  .btnDelete":"onDeleteItem","click  .btnEdit":"onEditItem","click  .linkAuth":"onClickShowAuth","click  .btnAddRoleMapping":"onSave","click  .btnUpdateRoleMapping":"onSave","click  .btnBack":"onBack","click  .btnCancel":"hide","click  .btnClose":"hide","change .directory":"onDirectoryChange","keypress input":"onKeyPress","keyup .inputMappingName":"onInputMappingNameKeyUp"},TEMPLATES:{OPTION:_.template('<option value="<%= model.name %>" selected><%= model.name %></option>'),OPTION_IDP:_.template('<option value="<%= model.value %>"><%= model.name %></option>'),LIST:_.template(v),ITEM:_.template(g),FORM:_.template(E),MSG_LINK:_.template('<a class="linkAuth" <%= actionAttributes %> ><%= title %></a>'),EMPTYROW:_.template('<td colspan="5"> <%= i18n("noMappingFound") %></td>')},initialize:function(){t.prototype.initialize.apply(this,arguments),this.subModelHelper=new m,this.roleMappingsCollection=new o},render:function(){this.template=this.TEMPLATES.LIST,this.$el.html(this.template(this.vtOptions({canModify:this.canModifyByEntityType(u.ENTITY_ROLE_MAPPING)})))},show:function(e){t.prototype.show.apply(this,arguments),this.$(".n-btn-list").hide(),this.$(".n-btn-form").hide(),this.$(".btnClose").show(),this.listRoleMappings()},onBack:function(){this.clearHeader(),this.listRoleMappings(),this.showList()},showList:function(){this.$(".n-title").text(this.i18n("roleMappingManagement")),this.$(".n-btn-list").hide(),this.$(".n-btn-form").hide(),this.$(".btnClose").show(),this.hideSubview(".roleMappingFormContainer"),this.showSubview(".roleMappingsListContainer")},onClickShowAuth:function(e){this.clearHeader(),p.executeActionElement(e.target)},reset:function(){this.clearHeader(),this.showList(),this.undelegateEvents()},showForm:function(e,t){this.mode=e,this.clearHeader(),this.$(".n-btn-list").hide(),this.$(".n-btn-form").hide(),this.$(".tab-pane").hide(),this.$(".btnBack").show(),this.$(".btnClose").hide(),this.mode===this.MODE_CREATE?(this.$(".btnAddRoleMapping").show(),this.$(".tab-pane-profile").show(),this.$(".nav").hide(),this.$(".user-form-tabs-content").addClass("user-form-tabs-content-standalone"),this.$(".directory").focus(),this.$(".n-title").text("Create Role Mapping")):this.mode===this.MODE_UPDATE&&(this.$(".btnUpdateRoleMapping").show(),this.$(".n-title").text(this.i18n("updateRoleMapping"))),this.hideSubview(".roleMappingsListContainer"),t?this.showSubview(".roleMappingFormContainer","left"):this.$(".roleMappingFormContainer").show()},onInputMappingNameKeyUp:function(e){var t=$(e.currentTarget).val(),n="";t&&t.length>0?(t.indexOf(" ")>-1&&(n=this.i18n("roleMappingSpaceWarnText")+" <br>"),f.doesActiveDirectoryNameHasRestrictedChars(t)&&(n+=this.i18n("roleMappingHelpText")),this.$(".roleMappingHelpText").html(n)):this.$(".roleMappingHelpText").empty()},onCreateItem:function(){var e=this;this.roleMappingModel=new a,this.$("#roleMappingForm").html(this.TEMPLATES.FORM(this.vtOptions({model:this.roleMappingModel.toJSON(),mode:this.MODE_CREATE,isIDP:!1}))),this.directoryCollection=new C;var t=this;this.fetchAuthProviders().then(function(){0===t.directoryCollection.size()&&0===e.idpList.length?t.showDirectoriesMsg():(t.showForm(t.MODE_CREATE,!0),t.directoryCollection.each(function(e){t.$(".directory").append(t.TEMPLATES.OPTION({model:e.toJSON()}))}),t.idpList.forEach(function(e){t.$(".directory").append(t.TEMPLATES.OPTION_IDP({model:{value:e.get(l.ID),name:e.get(l.NAME)}}))}),e.onDirectoryChange())}).catch(function(e){})},showDirectoriesMsg:function(){var e=this.TEMPLATES.MSG_LINK({title:this.i18n("addDirectory"),actionAttributes:h.createActionAttr(u.ENTITY_AUTH_CONFIG,u.ACTION_SHOW)});this.showHeaderInfo(this.i18n("directoriesNotConfigured")+e)},onDirectoryChange:function(){var e=this.$(".directory").val();_.find(this.idpList,function(t){return t.id===e})?$(".ldapTypeSection").addClass("hide"):$(".ldapTypeSection").removeClass("hide")},onEnterKeyPress:function(){this.onSave()},fetchAuthProviders:function(e){var t=this;this.directoryCollection=new C;var i=void 0,s=n.resolve(this.directoryCollection.fetch({silent:!0}));return i=this.clusterManager.isMulticlusterUI()?(new r).fetch():n.resolve(new r),n.all([s,i]).then(function(e){t.idpList=e[1].models}).catch(function(e){throw e})},onSave:function(){var e;if(!this.roleMappingModel)return void this.showHeaderError(this.i18n("onSaveError"));this.clearHeader();var t=this;this.roleMappingModel.on("error",function(e,n){t.showHeaderError(n)});var n=f.validate(this.$(".values").val(),f.RULE.REQUIRED);if(!n.valid)return void this.showHeaderError(n.message+": "+this.i18ns("Validation.required",'"Values"')+" "+this.i18n("userNotAssignedMessage"));for(var i=this.$(".values").val().split(","),s=0;s<i.length;s++)i[s]=i[s];var a=this.$(".role").val();this.mode===this.MODE_UPDATE&&(a=_.find(_.keys(u.USER_ROLE_LABELS),function(e){return u.USER_ROLE_LABELS[e]===a}));var o=this.$(".directory").val();if(this.idpList){this.idpList.filter(function(e){return e.get(l.ID)===o}).length>0&&this.roleMappingModel.set(l.ROLE_MAPPING.IS_IDP,l.ROLE_MAPPING.IS_IDP)}var r=this.roleMappingModel.get(l.ROLE_MAPPING.IS_IDP)?l.ROLE_MAPPING.IDP_UUID:l.ROLE_MAPPING.DIRECTORY_NAME;this.roleMappingModel.set((e={},_defineProperty(e,r,this.$(".directory").val()),_defineProperty(e,"role",a),_defineProperty(e,"entityType",this.$(".ldapType").val()),_defineProperty(e,"entityValues",i),e));var c=this.$(".directory").val();this.saveRoleMappings(),$('.warning-svg-icon[data = "'+c+'"]').remove()},listRoleMappings:function(){var e=this,t=this;this.model=new C,this.fetchAuthProviders().then(function(){var n=e.directoryCollection.models,i=e.idpList;if(e.roleMappingsCollection.reset(),0===n.length&&0===i.length)e.showDirectoriesMsg(),e.$("#roleMappingList > tbody").append(e.TEMPLATES.EMPTYROW(e.vtOptions()));else{for(var s=0;s<n.length;s++){var a=new o;a.setDirectoryName(n[s].get(l.NAME)),e.subModelHelper.register(n[s].get(l.NAME),a)}for(var r=0;r<i.length;r++){var d=i[r],p=new o;p.setDirectoryName(d.get(l.ID)),p.setIDP(c.ROLEMAPPING_IDP),e.subModelHelper.register(d.get(l.ID),p)}$.when.apply($,t.subModelHelper.iterate("fetch")).fail(function(){h.log("RoleMappingCollection: fetch: One or more of the requests failed for "+t.name)}).always(function(){var e=t.$("#roleMappingList > tbody");e.html("");for(var s=[],a=0;a<n.length;a++){var o=t.subModelHelper.get(n[a].get(l.NAME)).models;s=s.concat(o)}for(var r=0;r<i.length;r++){var c=t.subModelHelper.get(i[r].get(l.ID)).models;s=s.concat(c)}if(s&&s.length)for(var d=0;d<s.length;d++)!function(n){var a=s[n].toJSON();a.roleLabel=u.USER_ROLE_LABELS[a.role],a.isIDP=a.idpUuid?l.ROLE_MAPPING.IS_IDP:"",a.isIDP&&(a.name=i.filter(function(e){return e.get(l.ID)===a.idpUuid})[0].get(l.NAME));var o=t.TEMPLATES.ITEM({model:a});t.roleMappingsCollection.add(s[n].toJSON()),e.append(o)}(d);else e.append(t.TEMPLATES.EMPTYROW(t.vtOptions()))})}}).catch(function(e){})},_onSuccessUpdate:function(){this.listRoleMappings(),this.showList(),this.$(".btnUpdateRoleMapping").button("reset"),this.$(".btnAddRoleMapping").button("reset")},saveRoleMappings:function(){if(this.roleMappingModel){this.roleMappingModel.isNew(this.mode===this.MODE_CREATE),this.$(".btnUpdateRoleMapping").button("loading"),this.$(".btnAddRoleMapping").button("loading");var e=this;this.roleMappingModel.save(null,{success:function(t,n){e.showHeaderSuccess(e.i18n("saveSuccess")),e._onSuccessUpdate()},error:function(t,n){e.showHeaderError(e.i18n("saveRoleMappingError")+h.processAjaxError(n.responseText)),e.$(".btnUpdateRoleMapping").button("reset"),e.$(".btnAddRoleMapping").button("reset")}})}},onEditItem:function(e){var t=$(e.currentTarget).attr("dataId");this.editItem(t,!0)},editItem:function(e,t){var n=!1;this.roleMappingModel=new a;var i=_.compact(e.split(","));if(this.roleMappingModel.set("role",i[1]),this.roleMappingModel.set("entityType",i[2]),i.length>3){this.roleMappingModel.set(l.ROLE_MAPPING.IS_IDP,i[3]);var s=this.idpList.filter(function(e){return e.get(l.ID)===i[0]})[0].get(l.NAME);this.roleMappingModel.set("name",s),n=!0}var o=this.roleMappingModel.get(l.ROLE_MAPPING.IS_IDP)?l.ROLE_MAPPING.IDP_UUID:l.ROLE_MAPPING.DIRECTORY_NAME;this.roleMappingModel.set(o,i[0]);var r=this;this.roleMappingModel.fetch({silent:!0,success:function(){r.roleMappingModel.set("entityValues",r.roleMappingModel.get("0").entityValues);var e=r.roleMappingModel.toJSON();e.roleLabel=u.USER_ROLE_LABELS[e.role],r.$("#roleMappingForm").html(r.TEMPLATES.FORM(r.vtOptions({model:e,mode:r.MODE_UPDATE,isIDP:n}))),r.showForm(r.MODE_UPDATE,t)},error:function(e,t){r.showHeaderError(t.responseText)}})},onDeleteItem:function(e){var t=$(e.currentTarget).attr("dataId"),n=this;$.nutanixConfirm({msg:this.i18n("confirmDelete"),yes:function(){n.deleteItem(t)},yesText:"OK"})},deleteItem:function(e){var t=_.compact(e.split(","));this.roleMappingModel=this.roleMappingsCollection.getRoleMapping(e);var n=this;this.roleMappingModel.set("id","junk"),this.roleMappingModel.set("role",t[1]),this.roleMappingModel.set("entityType",t[2]),t.length>3&&this.roleMappingModel.set(l.ROLE_MAPPING.IS_IDP,t[3]);var i=this.roleMappingModel.get(l.ROLE_MAPPING.IS_IDP)?l.ROLE_MAPPING.IDP_UUID:l.ROLE_MAPPING.DIRECTORY_NAME;this.roleMappingModel.set(i,t[0]),this.roleMappingModel.destroy({success:function(e,t){n.showHeaderSuccess(n.i18n("saveSuccess")),n._onSuccessUpdate()},error:function(e,t){n.showHeaderError(t.responseText)}})}})}),define("text!templates/popups/version/VersionPopupView.html",[],function(){return'\x3c!-- The parent div modal is #popupVersion --\x3e\n<div class="modal-header">\n  <button type="button" class="close xClose" data-dismiss="modal">\n    <i data-icon="K" aria-hidden="true"></i>\n  </button>\n  <h4 class="n-title"><%= i18ns(\'about_product\', productName) %></h4>\n  </div>\n</div>\n\n<div class="n-modal-wrapper">\n  <div class="n-modal-body">\n    <div class="n-modal-content-wrapper">\n      <div class="n-modal-content">\n        <div class="product-logos">\n          <% if(isBrandingHX) { %>\n            <div class="product-logo">\n              <div class="lenovo"><%= SVG.loadSVG(SVG.LENOVOLOGO) %></div>\n              <div class="hx-series">\n                <div class="hx-svg"><%= SVG.loadSVG(SVG.HXLOGO) %></div>\n                <span><%= i18n(\'series\') %></span>\n              </div>\n            </div>\n          <% } else { %>\n            <div class="n-product-logo"></div>\n          <% } %>\n        </div>\n        <div class="n-product-version">\n          <span class="lblVersionPrefix"></span>\n          <span class="lblVersion"></span>\n          <span class="lblLicenseType"></span>\n        </div>\n        <div class="n-product-div n-product-ncc-version">\n          <span class="lblNCCVersion"></span>\n        </div>\n        <div class="n-product-div n-product-lcm-version">\n          <span class="lblLCMVersion"></span>\n        </div>\n        <div class="n-product-div n-product-patent">\n          <span><%= i18n(\'patent_information\') %>:</span>\n          <a target="_blank" href="<%=NUTANIX_PATENTS_URL%>" >\n            nutanix.com/patents</a>\n        </div>\n        \x3c!-- dev only block so no need for i18n --\x3e\n        <div class="n-product-dev-details" style="display:none">\n          Change Set Date: <span class="lblChangeSetDate"></span>\n          <br/>\n          Commit ID: <span class="lblCommitId"></span>\n        </div>\n      </div>\n    </div>\n  </div>\n  <div class="n-modal-footer">\n    <div class="n-product-copyright">\n      <%= i18n(\'copyright_text1\') %> <br />\n      <%= i18n(\'copyright_text2\') %>\n    </div>\n    <button type="button" class="btnClose btn n-primary-btn"\n            data-dismiss="modal">\n      Close\n    </button>\n  </div>\n</div>'}),define("views/popups/version/VersionPopupView",["views/basecomponents/popups/BasePopupView","models/version/VersionModel","models/genesis/LCMActionModel","data/DataProperties","data/DataURLConstants","managers/ClusterManager","managers/AccessManager","utils/AppConstants","utils/AppUtil","text!templates/popups/version/VersionPopupView.html"],function(e,t,n,i,s,a,o,r,l,c){"use strict";var d={VERSION:"version"};return e.extend({name:"VersionPopupView",LicenseManager:require("managers/LicenseManager"),el:"#popupVersion",versionModel:null,overlayPopup:!0,events:{"dblclick  .product-logos":"onDoubleClickLogo","click .modal-header .close":"hide","click .btnClose":"hide"},techPreviewDetailsTmpl:_.template('<div class="n-tech-preview-details"><%= i18n("technical_preview_text") %>:<ul></ul><span class="warning"><%= i18n("technical_preview_warning") %></span></div>'),render:function(){this.template=_.template(c),this.$el.html(this.template(this.vtOptions({NUTANIX_PATENTS_URL:s.NUTANIX_PATENTS,isBrandingHX:a.isBrandingHX(),productName:this.productName()}))),this.showTechPreviewDetails()},show:function(n){var i=this;e.prototype.show.apply(this,arguments),this.versionModel=new t,this.versionModel.on("change",this.onChange,this),l.addInLineDonutLoader(this.$(".lblVersionPrefix"),"gray"),this.canShowLCMVersionInfo()?this.fetchLCMVersion().always(function(){i.versionModel.fetch()}):this.versionModel.fetch()},onChange:function(){$(".lblVersionPrefix",this.el).html(this.i18n("version")),$(".lblVersion",this.el).html(this.versionModel.getTaggedCurrentVersion()),$(".lblUIVersion",this.el).html(this.versionModel.get(i.UI_VERSION)),$(".lblNCCVersion",this.el).html(this.i18ns("ncc_version",this.versionModel.getNCCVersion())),$(".lblChangeSetDate",this.el).html(this.versionModel.get(i.LAST_COMMIT_DATE)),$(".lblCommitId",this.el).html(this.versionModel.get(i.COMMIT_ID_SHORT));var e=(new Date).getFullYear();if(this.versionModel.get(i.LAST_COMMIT_DATE)&&(e=this.versionModel.get(i.LAST_COMMIT_DATE).split("-")[0]),$(".lblYear",this.el).html(e),a.isMulticlusterNavMode())this.$(".lblNCCVersion").hide();else{var t=this.LicenseManager.getLicenseModel().getCategory();this.$(".lblLicenseType").html(" - "+t+" License"),this.$(".lblNCCVersion").show()}this.showLCMVersionInfo()},showLCMVersionInfo:function(){if(this.canShowLCMVersionInfo()&&this.lcmModel)if(this.lcmModel&&!this.lcmModel.hasErrorResponse()){var e=this.lcmModel.getReturnResponse();this.$(".lblLCMVersion").html(this.i18ns("lcm_version",e[d.VERSION]))}else this.$(".lblLCMVersion").hide();else this.$(".lblLCMVersion").hide()},onDoubleClickLogo:function(e){e.shiftKey&&this.$(".n-product-dev-details").show()},productName:function(){var e=r.HARDWARE_VENDORS.Nutanix;return a.isBrandingHX()&&(e=r.ABOUT_POPUP.HX_PRODUCT_LABEL),e},destroy:function(){this.versionModel&&this.versionModel.off(),e.prototype.destroy.apply(this,arguments)},showTechPreviewDetails:function(){a.isPCTechPreviewVersion()&&this.$(".n-modal-content").append(this.techPreviewDetailsTmpl(this.vtOptions()))},fetchLCMVersion:function(){return this.lcmModel=new n,this.lcmModel.setRPCParams(n.LCM_ACTIONS.GET_CONFIG),this.lcmModel.save()},canShowLCMVersionInfo:function(){return!a.isMulticlusterNavMode()||o.isClusterAdmin()}})}),define("text!templates/popups/dr/RemoteSiteAdvancedView.html",[],function(){
return'\x3c!-- Remote Site Form --\x3e\n<form id="remoteSiteForm" class="form-horizontal n-form-rows">\n\n  <% if ( ! initialized ) { %>\n    <div class=\'no-data\'>\n      <span class="loader-icon"></span>\n      <span>Loading...</span>\n    </div>\n  <% } else { %>\n  \x3c!-- Advanced stuff below --\x3e\n  <div id="advancedSettingsContainer"\n       class="n-form-advanced-settings">\n    <div class="n-form-advanced-settings-inner">\n\n      \x3c!-- Bandwidth throttling --\x3e\n      <h2 class="remote-site-heading">\n        Bandwidth Throttling\n      </h2>\n      <div class="control-group bandwith-control">\n        <div class="control-group-label">\n          <label class="control-label">\n            Bandwidth Throttling\n          </label>\n        </div>\n        <div class="control-group-input">\n          <div class="control-input-section">\n            <%= Components.switchInput({\n                  checked: bandwidthPolicyEnabled,\n                  id: \'enableBwThrottle\',\n                  value: \'\',\n                  classes: \'n-switch-medium -blue\' }) %>\n          </div>\n        </div>\n\n\n        \x3c!-- Default bandwidth limit --\x3e\n        <div>\n          <div class="control-group-label">\n            <label class="control-label">Default Bandwidth Limit</label>\n          </div>\n          <div class="control-group-input">\n            <div class="controls">\n              <input type="text" class="input-default-bw"\n                     value=\'<%= defaultBandwidth || "" %>\'>\n              <br>\n              <div class="row-description">\n                Enter the maximum bandwidth in megabytes per second\n                (up to 2 decimal places).\n              </div>\n            </div>\n          </div>\n        </div>\n\n        <div class="control-group-label">\n          <label class="control-label">Bandwidth Throttling Policies</label>\n        </div>\n        <div class="control-group-input bw">\n            \x3c!-- Here be bandwidth policy configurations --\x3e\n            <div id="bandwidth-policies"></div>\n          </div>\n        </div>\n      </div>\n\n\n      \x3c!-- Use Compression --\x3e\n      <h2 class="remote-site-heading">\n        Compression\n      </h2>\n      <div class="control-group">\n        <div class="control-group-label">\n          <label class="control-label">Compress On Wire</label>\n        </div>\n        <div class="control-group-input">\n          <div class="controls compressGroup">\n            <div class="control-input-section">\n              <%= Components.switchInput({\n                    checked: compressionEnabled,\n                    id: \'UseCompression\',\n                    value: \'\',\n                    classes: \'n-switch-medium -blue\' }) %>\n            </div>\n          </div>\n          <div class="n-inline-alert alertCompression"\n               style="display: none;">\n            <div class="n-license-warning"></div>\n          </div>\n        </div>\n      </div>\n\n      \x3c!-- Cost savings mode --\x3e\n      <% if (cloudRemoteSite) { %>\n        \x3c!-- ENG-105492: hiding cost-savings mode for now --\x3e\n        <h2 class="remote-site-heading hide">\n          Cloud Settings\n        </h2>\n        <div class="control-group hide">\n          <div class="control-group-label cost-saving-group">\n            <label class="control-label">Cost Saving Mode</label>\n            <span class="cost-saving-help"></span>\n          </div>\n          <div class="control-group-input">\n            <div class="controls compressGroup">\n              <div class="control-input-section">\n                <%= Components.switchInput({\n                      checked: costSavingEnabled,\n                      id: \'cost-saving-mode\',\n                      value: \'\',\n                      classes: \'n-switch-medium -blue\',\n                      disabled: !costSavingCapable }) %>\n                <% if (!costSavingCapable) { %>\n                  <span class="cost-saving-input-help"></span>\n                <% } %>\n              </div>\n            </div>\n          </div>\n        </div>\n      <% } %>\n\n      <h2 class="remote-site-heading">\n        Mappings\n      </h2>\n      \x3c!-- Network section--\x3e\n      <div class="control-group">\n        <label> <%= i18n(\'network_mapping\') %></label>\n        <% if ( showNetworkMappings ) { %>\n          <% if (networkMapErrror) { %>\n            <div class="controls net-error">\n              <%= i18n(\'connectivity_error\') %>\n            </div>\n          <% } else if (_.size(localNetworkMap) === 0) { %>\n            <div class="controls">\n              <%= i18n(\'no_network_mapping_msg\') %>\n            </div>\n          <% } else if (_.size(remoteNetworkMap) === 0) { %>\n            <div class="controls">\n              <%= i18n(\'no_remote_network_msg\') %>\n            </div>\n          <% } else { %>\n            <div class="containerMap">\n              <ul>\n                \x3c!-- Header for the container map--\x3e\n                <li class="ctrMapHeader">\n                  <div class="ctrSourceLabel">\n                    <%= i18n(\'source_cluster\') %>\n                  </div>\n                  <div class="ctrDestinationLabel">\n                    <%= i18n(\'destination_cluster\') %>\n                  </div>\n                </li>\n\n                \x3c!-- Container map entries--\x3e\n                <% _.each(networkMapping.l2NetworkMappings,\n                function(map) { %>\n                  <li class="ctrNetMapEntry">\n                    <input type="text"\n                           class="ctrNetSource ctr-net-source ctrAddMapSource"\n                           disabled\n                           value="<%= hypervisorLabels[map.srcHypervisorType] +\n                                    \': \' + map.srcNetworkName %>"\n                           data-hypervisorType="<%= map.srcHypervisorType %>"\n                           data-name="<%= map.srcNetworkName %>" >\n                    <input type="text"\n                           class="ctrAddMapDestination ctr-add-map-destination"\n                           disabled\n                           value="<%= hypervisorLabels[map.destHypervisorType] +\n                                    \': \' + map.destNetworkName %>"\n                           data-hypervisorType="<%= map.destHypervisorType %>"\n                           data-name="<%= map.destNetworkName %>">\n                    <i data-name="<%= map.srcNetworkName %>"\n                       data-hypervisorType="<%= map.srcHypervisorType %>"\n                       aria-hidden="true"\n                       class="btnDeleteNet btn btnDelete"></i>\n                  </li>\n                <% }) %>\n\n                \x3c!-- Add network map entry--\x3e\n                <% if (_.size(unmappedLocalNetworks) > 0 &&\n                      _.size(unmappedRemoteNetworks) > 0) { %>\n                  <li class="ctrNetMapEntry">\n                    <select class="ctrNetSource ctrAddMapSource">\n                      \x3c!-- Add a blank entry --\x3e\n                      <option value=""><%= i18n(\'source_cluster\') %></option>\n                      <% _.each(unmappedLocalNetworks, function(obj) { %>\n                      <option value="<%= obj.hypervisorType + obj.name %>"\n                        data-hypervisorType="<%= obj.hypervisorType %>"\n                        data-name="<%= obj.name %>">\n                        <%= hypervisorLabels[obj.hypervisorType] +\n                          \': \' + obj.name %>\n                      </option>\n                      <% }) %>\n                    </select>\n                    <select class="ctrNetSource ctrAddMapDestination">\n                      \x3c!-- Add a blank entry --\x3e\n                      <option value=""><%= i18n(\'destination_cluster\') %></option>\n                      <% _.each(unmappedRemoteNetworks, function(obj) {\n                        %>\n                      <option value="<%= obj.hypervisorType + obj.name %>"\n                        data-hypervisorType="<%= obj.hypervisorType %>"\n                        data-name="<%= obj.name %>">\n                        <%= hypervisorLabels[obj.hypervisorType] +\n                          \': \' + obj.name %>\n                      </option>\n                      <% }) %>\n                    </select>\n                    <a class="btnCreate btn btnAddNet">\n                      <i data-icon="H" aria-hidden="true"></i>\n                    </a>\n                  </li>\n                  <div class="row-description">\n                    <%= i18n(\'unique_mapping_msg\') %>\n                  </div>\n                <% } %>\n              </ul>\n            </div>\n          <% } %>\n        <% } else { %>\n          <div class="controls">\n            <%= i18n(\'network_mapping_not_supported\') %>\n          </div>\n        <% } %>\n      </div>\n      \x3c!-- Vstores table--\x3e\n      <div class="control-group">\n        <label>vStore Name Mapping</label>\n        <% if (isRemoteNotReachable) { %>\n          <div class="controls net-error">\n            <%= i18n(\'rs_unreachable\') %>\n          </div>\n        <% } else if (localVstores && (localVstores.size() > 0) &&\n          remoteVstores.length) { %>\n          <div class="containerMap">\n            <ul>\n              \x3c!-- Header for the container map--\x3e\n              <li class="ctrMapHeader">\n                <div class="ctrSourceLabel">\n                  Source VStore\n                </div>\n                <div class="ctrDestinationLabel">\n                  Destination VStore\n                </div>\n              </li>\n\n              \x3c!-- Container map entries--\x3e\n              <% _.each(vstoreNameMap, function(destination, src) { %>\n              <li class="ctrMapEntry">\n                <input type="text" class="ctrSource" disabled\n                       value=\'<%= src %>\'>\n                <input type="text" class="destination" disabled\n                       value=\'<%= destination %>\'>\n                <i data-ctr=\'<%= src %>\'\n                   aria-hidden="true"\n                   class="btnDeleteVS btn btnDelete"></i>\n              </li>\n              <% }) %>\n\n              \x3c!-- Add container map entry--\x3e\n              <% if (unmappedLocalVstores.length > 0 &&\n                    unmappedRemoteVsores.length > 0) { %>\n                <li class="ctrMapEntry">\n                  <select class="ctrSource ctrAddSource unmappedVstores"\n                          data-class="fancy-select-bottom-anchor">\n                    \x3c!-- Add a blank entry --\x3e\n                    <option value="">Select a VStore</option>\n                    <% _.each(unmappedLocalVstores, function(vsLoc) { %>\n                    <option id="<%= vsLoc.get(\'id\')%>">\n                      <%= vsLoc.get(\'name\') %>\n                    </option>\n                    <% }) %>\n                  </select>\n                  <select class="ctrSource destination ctrAddDestination"\n                          data-class="fancy-select-bottom-anchor">\n                    \x3c!-- Add a blank entry --\x3e\n                    <option value="">Select a VStore</option>\n                    <% _.each(unmappedRemoteVsores, function(vsRem) { %>\n                    <option id="<%= vsRem %>">\n                      <%= vsRem %>\n                    </option>\n                    <% }) %>\n                  </select>\n                  <a class="btnCreate btn btnAddVS">\n                    <i data-icon="H" aria-hidden="true"></i>\n                  </a>\n                </li>\n                <div class="row-description">\n                  <%= i18n(\'unique_mapping_msg\') %>\n                </div>\n              <% } %>\n            </ul>\n          </div>\n        <% } else { %>\n          <% if (!remoteVstores.length) { %>\n            <div class="controls">\n              <%= i18n(\'remote_datastores_not_configured\') %>\n            </div>\n          <% } else { %>\n            <div class="controls">\n              <%= i18n(\'unable_to_fetch_vstore_mappings\') %>\n            </div>\n          <% } %>\n        <% } %>\n      </div>\n\n    </div>\n  </div>\n  <% } %>\n</form>'}),define("views/popups/dr/RemoteSiteAdvancedView",["data/DataProperties","components/Components","views/basecomponents/BaseSubView","views/wizards/remotesite/BandwidthConfigListView","utils/AppConstants","utils/StatsUtil","utils/AppUtil","text!templates/popups/dr/RemoteSiteAdvancedView.html"],function(e,t,n,i,s,a,o,r){"use strict";var l=_.template(r);return n.extend({name:"RemoteSiteAdvancedView",events:{"click  .btnAddVS":"onAddVStoreMapping","click  .btnDeleteVS":"onDeleteVStoreMapping","click  .btnAddNet":"onAddNMap","click  .btnDeleteNet":"onDeleteNMap","change .ctrAddSource":"onCtrSourceChange","change #enableBwThrottle":"onBwThrottleChange"},initialize:function(e){e=e||{},n.prototype.initialize.apply(this,arguments),this.el=e.el,this.model=e.model,this.localVstores=e.localVstores,this.localNetworkMap=e.localNetworkMap,this.remoteNetworkMap=e.remoteNetworkMap},render:function(){var n=this,i=this.model.get(e.RS_VSTORE_NAME_MAP),a=(this.model.get(e.RS_NETWORK_NAME_MAP),[]),r=_.keys(this.model.get(e.RS_VSTORE_INFO)||{}),c=_.values(this.model.get(e.RS_VSTORE_NAME_MAP)),d=[],p=[],u=[],h=this.model.get(e.RS_STATUS);this.initialized&&this.localVstores&&this.localVstores.each(function(t){i[t.get(e.NAME)]||a.push(t)}),this.initialized&&r.length&&(d=_.difference(r,c)),this.initialized&&(_.each(this.localNetworkMap,function(e){n.model.findLocalNetMap(e)||p.push(e)}),_.each(this.remoteNetworkMap,function(e){n.model.findRemoteNetMap(e)||u.push(e)}));var m=this.model.get(e.RS_BANDWIDTH_POLICY_ENABLED),f={Components:t,bandwidthPolicyEnabled:m,localVstores:this.localVstores,remoteVstores:r,unmappedLocalVstores:a,unmappedRemoteVsores:d,unmappedLocalNetworks:p,unmappedRemoteNetworks:u,showNetworkMappings:this.getParentView().showNetworkMappings(),localNetworkMap:this.localNetworkMap,remoteNetworkMap:this.remoteNetworkMap,initialized:this.initialized,defaultBandwidth:this.model.getDefaultBandwidthLimit(),networkMapErrror:this.networkMapErrror,hypervisorLabels:s.HYPERVISOR_LABEL,cloudRemoteSite:this.model.get(e.RS_CLOUD_TYPE),costSavingCapable:this.model.isCostSavingCapable(),costSavingEnabled:this.model.isCostSavingEnabled(),isRemoteNotReachable:h===s.RS_STATUS.UNREACHABLE};this.$el.html(l(this.vtOptions(_.extend(this.model.toJSON(),f)))),o.addInLineDonutLoader(this.$("loader-icon")),this.refreshBandwidthConfigList(),this.applyNutanixInput({types:["select"]}),this.$(".cost-saving-help").nutanixMoreInfo({title:"When enabled, the cloud instance will automatically switch off when not in use to reduce costs.",placement:"right"}),this.$(".cost-saving-input-help").nutanixMoreInfo({title:"To enable this feature, update all the cloud instances to the latest version.",placement:"right"}),this._updateBandwidthControlsState()},destroy:function(){this.$(".nutanixMoreInfo").nutanixMoreInfo("destroy"),n.prototype.destroy.apply(this,arguments)},refreshBandwidthConfigList:function(){new i({model:this.model}).render()},setInitialized:function(e){this.initialized=e},syncFormAndModel:function(){var t={name:this.model.get(e.NAME),bandwidthPolicyEnabled:!!this.$("#enableBwThrottle").attr("checked"),proxyEnabled:this.model.get(e.RS_PROXY_ENABLED),sshEnabled:this.model.get(e.RS_SSH_ENABLED),compressionEnabled:!!this.$("#UseCompression").attr("checked")};this.model.get(e.RS_CLOUD_TYPE)&&(t[e.RS_COST_SAVING_ENABLED]=this.$("#cost-saving-mode").is(":checked"));var n=!1,i=this.$(".input-default-bw").val().trim();if(i&&i.length){var o=parseFloat(i);(isNaN(o)||o<0)&&(this.showHeaderTextError("Please enter a value in the range 0 to "+s.MAX_MBPS+" for the default bandwidth."),n=!0);var r=a.round(o,2);r>=s.MAX_MBPS&&(this.showHeaderTextError("The maximum bandwidth should be less than "+s.MAX_MBPS+" Mbps."),n=!0),this.model.setDefaultBandwidthLimit(r)}else this.model.setDefaultBandwidthLimit(null);var l={};_.each(this.$(".ctrMapEntry"),function(e){var t=this.$(e),n=t.find(".ctrSource").val().trim();if(n.length){var i=t.find(".destination"),s=i.val().trim();0!==s.length&&(l[n]=s)}},this);var c=[];if(_.each(this.$(".ctrNetMapEntry"),function(t){var n={},i=this.$(t),a=i.find(".ctrAddMapSource"),o="input"===a.prop("tagName").toLowerCase()?a:a.find("option:selected");if(o.attr(s.RS_NAME_ATTR)){n[e.RS_NETWORK_SRC_HYPER_TYPE]=o.attr(s.RS_HYPERVISOR_ATTR),n[e.RS_NETWORK_SRC_NAME]=o.attr(s.RS_NAME_ATTR);var r=i.find(".ctrAddMapDestination"),l="input"===r.prop("tagName").toLowerCase()?r:r.find("option:selected");l.attr(s.RS_NAME_ATTR)&&(n[e.RS_NETWORK_DEST_HYPER_TYPE]=l.attr(s.RS_HYPERVISOR_ATTR),n[e.RS_NETWORK_DEST_NAME]=l.attr(s.RS_NAME_ATTR),c.push(n))}},this),!n){var d=this.model.get(e.RS_NETWORK_NAME_MAP);t[e.RS_VSTORE_NAME_MAP]=l,t[e.RS_NETWORK_NAME_MAP]={uuid:d?d.uuid:null},t[e.RS_NETWORK_NAME_MAP][e.RS_NETWORK_MAPPING_LIST]=c,this.model.set(t)}return n},showHeaderTextError:function(e){this.getParentView().showHeaderTextError(e)},_confirm:function(e,t){this.getParentView()._confirm(e,t)},_updateBandwidthControlsState:function(){!this.$("#enableBwThrottle").attr("checked")?(this.$(".input-default-bw, .btnAddConfig").attr("disabled","disabled"),this.$(".btnEditConfig, .btnDeleteConfig, .sep").attr("hidden","hidden")):(this.$(".input-default-bw, .btnAddConfig").removeAttr("disabled"),this.$(".btnEditConfig, .btnDeleteConfig, .sep").removeAttr("hidden"))},onAddVStoreMapping:function(e){var t=this.$(".ctrAddSource").val().trim(),n=this.$(".ctrAddDestination").val();return 0===t.length?void this.showHeaderTextError("Please select a source storage container."):0===n.length?void this.showHeaderTextError("Please select a destination storage container."):(this.model.addVStore(t,n),void(this.syncFormAndModel()||(this.render(),this.getParentView().scrollToBottom())))},onDeleteVStoreMapping:function(e){var t=this,n=$(e.currentTarget).attr("data-ctr");this._confirm(this.i18n("delete_vstore_mapping_confirmation"),function(){t.model.removeVStore(n),t.render(),t.getParentView().scrollToBottom()})},onAddNMap:function(t){var n=this.$("select.ctrAddMapSource"),i=this.$("select.ctrAddMapDestination"),a=n.find("option:selected").attr(s.RS_HYPERVISOR_ATTR),o=n.find("option:selected").attr(s.RS_NAME_ATTR),r=i.find("option:selected").attr(s.RS_HYPERVISOR_ATTR),l=i.find("option:selected").attr(s.RS_NAME_ATTR),c={};return a?r?(c[e.RS_NETWORK_SRC_NAME]=o,c[e.RS_NETWORK_SRC_HYPER_TYPE]=a,c[e.RS_NETWORK_DEST_NAME]=l,c[e.RS_NETWORK_DEST_HYPER_TYPE]=r,this.model.addNetMap(c),void(this.syncFormAndModel()||(this.render(),this.getParentView().scrollToBottom()))):void this.showHeaderTextError("Please select a destination."):void this.showHeaderTextError("Please select a source.")},onDeleteNMap:function(e){var t=this,n=$(e.currentTarget).attr(s.RS_NAME_ATTR),i=$(e.currentTarget).attr(s.RS_HYPERVISOR_ATTR);this._confirm("Are you sure you want to delete the Network Map entry?",function(){t.model.removeNetMap({srcNetworkName:n,srcHypervisorType:i}),t.render(),t.getParentView().scrollToBottom()})},onCtrSourceChange:function(e){var t=$(e.currentTarget),n=t.data("prevSelected")||"",i=t.val().trim(),s=this.$(".ctrAddDestination").val().trim();""!==s&&s!==n||this.$(".ctrAddDestination").val(i),t.data("prevSelected",i)},onUpdateClick:function(){this.syncFormAndModel()||(this.getParentView().scrollToTop(),this.getParentView().showHeaderInfo("Saving remote site settings..."),this.getParentView().updateModel())},onBwThrottleChange:function(){this._updateBandwidthControlsState()}})}),define("text!templates/popups/dr/RemoteSiteCreateView.html",[],function(){return'<form id="remoteSiteForm" class="form-horizontal n-form-rows">\n\n  <% if ( ! initialized ) { %>\n  <div class=\'no-data\'>\n    <div class="donut-loader-blue -small"></div>\n    <span>Loading...</span>\n  </div>\n  <% } else { %>\n  \x3c!-- Remote Site Settings --\x3e\n  <div class="control-group">\n    <label class="control-label">Remote Site Name</label>\n    <div class="controls">\n      <input type="text" class="inputName"\n             value=\'<%= name || "" %>\'>\n      <div class="n-input-validation-msg"></div>\n      <div class="n-input-name-warning-msg"></div>\n    </div>\n  </div>\n\n\n  \x3c!-- Destination types --\x3e\n  <div class="control-group">\n    <div class="checkboxGroup enable-proxy">\n      <input type="checkbox" class="useProxy" value="true"\n      <%= proxyEnabled ? \'checked\' : \'\' %>>\n      <label>Enable Proxy</label>\n    </div>\n  </div>\n\n  \x3c!-- Capabilities --\x3e\n  <div class="control-group">\n    <label class="control-label">Capabilities</label>\n    <div class="checkboxGroup">\n      <% _.each (editableCapabilities, function (value, key) { %>\n        <input type="radio"\n               name="capabilities" value="<%= key %>" id="cap-<%= key %>"\n               <%= key == disasterRecovery && disableDR  ? \'disabled\' : \'\' %>\n        <%= capabilities.indexOf(key) !== -1 ? \' checked \' : \'\' %>>\n        <label for="cap-<%= key %>"><%= value %></label>\n      <% }) %>\n    </div>\n  </div>\n\n  <div class="control-group">\n    <label class="control-label address-label">Addresses</label>\n    <div class="controls addressList">\n      <ul>\n        <% _.each(remoteIpPorts, function(port, address) { %>\n        <li class="addressTuple">\n          <input type="text" class="ipAddress" value=\'<%= address %>\'>\n          <input type="hidden" class="port" value=\'<%= port %>\'>\n          <label class="port-label">Port: <%= defaultPort %></label>\n          <i data-addr=\'<%= address %>\'\n             aria-hidden="true"\n             class="btnDeleteAddress btn btnDelete"></i>\n        </li>\n        <% }) %>\n      </ul>\n      <li class="addressTuple">\n        <input type="text" class="ipAddress addAddress"\n           placeholder="Virtual IP Address">\n        \x3c!-- ENG-30732: Prepopulate port number to 2020. --\x3e\n        <input type="hidden" class="port addPort" value="<%= defaultPort %>">\n        <label class="port-label">Port: <%= defaultPort %></label>\n        <a class="btnCreate btn btnAddAddress">\n          <i data-icon="H" aria-hidden="true"></i>\n        </a>\n      </li>\n    </div>\n  </div>\n  <% } %>\n</form>'}),define("views/popups/dr/RemoteSiteCreateView",["data/DataProperties","views/basecomponents/BaseView","views/basecomponents/BaseSubView","utils/AppConstants","utils/AppUtil","utils/RemoteSiteUtil","text!templates/popups/dr/RemoteSiteCreateView.html"],function(e,t,n,i,s,a,o){"use strict";var r=_.template(o);return n.extend({initialized:!1,name:"RemoteSiteCreateView",formAttributes:[e.RS_CAPABILITIES,e.RS_PROXY_ENABLED,e.RS_NAME,e.RS_REMOTE_ADDRESS],events:{"click .btnAddAddress":"onAddAddress","click .btnDeleteAddress":"onDeleteAddress"},initialize:function(e){e=e||{},n.prototype.initialize.apply(this,arguments),this.el=e.el,this.model=e.model,this.viewModel=e.viewModel},render:function(){var e={};this.initialized&&_.each(i.RS_USER_EDITABLE_CAPABILITIES,function(t){this.model.isIncompatibleCapability(t)||(e[t]=i.RS_CAPABILITY_NAMES[t])},this);var t=!1,n="";a.isLightCompute(this.model)?(t=!0,n=a.getDRDisableMsgForLightCompute()):a.isSingleNodeBackup(this.model)?(t=!0,n=a.getDRDisableMsgForSingleNodeBackup()):this.model.getId()&&!a.isArchSameAsSource(this.model)&&(t=!0,n=a.getDRDisableMsgForArchMismatch(this.model));var s=_.extend(this.model.toJSON(),{editableCapabilities:e,disasterRecovery:i.RS_CAPABILITIES.DISASTER_RECOVERY,initialized:this.initialized,defaultPort:2020,disableDR:t});if(this.$el.html(r(s)),this.applyNutanixInput(),this.$(".nutanixMoreInfo").nutanixMoreInfo({parseDataAttrs:!0}),this.model.getId()){var o=this.$(".inputName");o.attr("title","The remote site name cannot be changed once it is assigned."),o.attr("disabled","disabled")}this.initialized&&this.disableNonEditableAttributes(),t&&this.$('label[for="cap-DISASTER_RECOVERY"].n-radio').tooltip({title:n,placement:"top"})},isFormDirty:function(){var e=JSON.parse(JSON.stringify(_.pick(this.model.attributes,this.formAttributes))),t=JSON.parse(JSON.stringify(_.pick(this.getParentView().originalAttributes,this.formAttributes)));return!_.isEqual(e,t)},disableNonEditableAttributes:function(){this.model.isAddressConfigNonEditable()&&(this.$(".addressTuple .ipAddress").prop("disabled",!0),this.$(".btnDeleteAddress").prop("disabled",!0),this.$(".port").prop("disabled",!0),this.$(".btnAddAddress").addClass("disabled"),this.$(".addAddress").prop("disabled",!0),this.$(".addPort").prop("disabled",!0))},setInitialized:function(e){this.initialized=e},syncFormAndModel:function(){var t={name:this.$(".inputName").length&&this.$(".inputName").val().trim(),proxyEnabled:"true"===this.$(".useProxy:checked").val()},n={},a=!1;_.each(this.$(".addressTuple"),function(e){var t=this.$(e),i=t.find(".ipAddress").val().trim();if(i.length>0)if(isNaN(s.strToLongIP(i)))this.showHeaderTextError("Invalid IP Address: "+i),a=!0;else{var o=t.find(".port").val().trim(),r=parseInt(o,10);n[i]=isNaN(r)?null:r}},this);var o=[];this.$("input[name=capabilities]:checked").each(function(){var e=$(this).attr("value");o.push(e)});var r=this.model.getId()?_.difference(this.getParentView().originalAttributes[e.RS_CAPABILITIES],i.RS_USER_EDITABLE_CAPABILITIES):[];return t[e.RS_CAPABILITIES]=_.union(o,r||[]),a||(a||(t[e.RS_REMOTE_ADDRESS]=n,this.model.set(t)),a)},onAddAddress:function(e){if(!$(e.currentTarget).hasClass("disabled")){var t=this.$(".addAddress").val().trim();if(0===t.length)return void this.showHeaderTextError("Please enter an IP Address and a port.");if(isNaN(s.strToLongIP(t)))return void this.showHeaderTextError("Invalid IP Address:"+t);var n=this.$(".addPort").val().trim(),i=null;if(n.length>0&&(i=parseInt(n,10),isNaN(i)))return void this.showHeaderTextError("Invalid Port: "+n);this.model.addAddress(t,i),this.syncFormAndModel()||this.render()}},onDeleteAddress:function(e){var t=this,n=$(e.currentTarget).attr("data-addr");this._confirm("Delete address ?",function(){t.model.removeAddress(n),t.render()})},showHeaderTextError:function(e){this.getParentView().showHeaderTextError(e)},_confirm:function(e,t){this.getParentView()._confirm(e,t)},destroy:function(){this.$(".nutanixMoreInfo").nutanixMoreInfo("destroy"),this.$(".ssh-tunnel-tooltip").tooltip("destroy"),t.prototype.destroy.apply(this,arguments)},onUpdateClick:function(){var t=this;if(!this.syncFormAndModel()){var n=this.model.get(e.RS_NAME);if(!(n&&n.length>0))return void this.showHeaderTextError("Please enter a remote site name.");if(!this.model.get(e.RS_CAPABILITIES).length)return void this.showHeaderTextError("Please specify the remote site capability.");var i=this.model.get(e.RS_REMOTE_ADDRESS);if(_.isEmpty(i))return void this.showHeaderTextError("Please enter at least one address.");var s=t.getParentView(),a=this.$("#cap-DISASTER_RECOVERY").is(":checked");this.isFormDirty()?s.updateModel(a):s.refreshView()}}})}),define("text!templates/popups/dr/RemoteSiteFormView.html",[],function(){return'\x3c!-- The parent div modal is #popupRemoteSite --\x3e\n<div class="modal-header">\n  <button type="button" class="close" data-dismiss="modal">\n    <i data-icon="K" aria-hidden="true"></i>\n  </button>\n  <h4 class="n-title">Remote Site</h4>\n</div>\n<div class="n-modal-wrapper">\n  <div class="n-modal-body">\n    <div class="modal-state-wrapper">\n      <ul class="state-ul">\n        <li class="modal-state rs-create">\n          <div class="state-wrapper">\n            1. Details\n          </div>\n        </li>\n        <li class="separator">  </li>\n        <li class="modal-state rs-advanced">\n          <div class="state-wrapper ">\n            2. Settings\n          </div>\n        </li>\n      </ul>\n    </div>\n    <div class="n-modal-content-wrapper">\n      <div class="n-modal-alert-header">\n        \x3c!-- @view: update message goes here --\x3e\n      </div>\n      \x3c!-- Remote Site Form --\x3e\n      <div id="remoteSiteFormContainer">\n\n      </div>\n\n      \x3c!-- Policy form --\x3e\n      <div id="policy-form-container"></div>\n\n    </div>\n  </div>\n\n  <div class="n-modal-footer">\n    \x3c!-- Back button --\x3e\n    <div class="pull-left">\n    </div>\n    <button class="btnCancel btn n-btn-list">\n      Cancel\n    </button>\n    <button class="btnUpdate btn-update btn btn-primary n-btn-list">\n      <%= isEditMode ? \'Next\' : \'Add Site\' %>\n    </button>\n    <button class="btnUpdate btn-edit btn btn-primary n-btn-list">\n      Save\n    </button>\n  </div>\n</div>\n'}),define("views/popups/dr/RemoteSiteFormView",["backbone","views/basecomponents/popups/BasePopupView","views/popups/dr/RemoteSiteAdvancedView","views/popups/dr/RemoteSiteCreateView","views/wizards/remotesite/BandwidthConfigView","data/DataProperties","data/DataURLConstants","data/DataManager","managers/NavigationManager","managers/LicenseManager","models/storage/VStoreCollection","models/dataprotection/RemoteSiteCollection","models/BaseCollection","models/BaseModel","utils/AppConstants","utils/AppUtil","utils/SubViewHelper","utils/HypervisorUtil","utils/RemoteSiteUtil","text!templates/popups/dr/RemoteSiteFormView.html"],function(e,t,n,i,s,a,o,r,l,c,d,p,u,h,m,f,v,g,E,T){"use strict";var C=h.extend({MBPS:1e6,urlRoot:o.REMOTE_SITE,entityType:m.ENTITY_REMOTE_SITE,actionMode:m.ACTION_UPDATE,defaults:{id:null,name:null,vstoreNameMap:null,remoteIpPorts:null,maxBps:null,proxyEnabled:!1,bandwidthPolicy:null,compressionEnabled:!0,sshEnabled:!1,capabilities:[m.RS_CAPABILITIES.DISASTER_RECOVERY]},name:"RemoteSiteModel",dirty:!1,fullDetails:!0,initialize:function(e,t){h.prototype.initialize.apply(this,arguments),this.set({remoteIpPorts:{},vstoreNameMap:{},networkMapping:{uuid:null,l2NetworkMappings:[]}})},isDirty:function(){return this.dirty},sync:function(t,n,i){return i=this.parseOptions(t,n,i),"update"!==t&&"create"!==t||(n.unset("id"),i.url=r.getFormattedURL(n.urlRoot)),"read"===t&&(i.url+="?fullDetails="+this.fullDetails),f.debug("BaseModel : \n\t method: "+t+"\n\t data  : "+i.url),this.dirty=!1,e.sync(t,n,i)},setId:function(e){this.set(this.idAttribute,e,{silent:!0})},getId:function(){return this.get(this.idAttribute)},getClusterArch:function(){return this.get(a.CLUSTER_ARCH)||m.ARCH_TYPE.X86_64},addAddress:function(e,t){this.get(a.RS_REMOTE_ADDRESS)[e]=t},removeAddress:function(e){delete this.get(a.RS_REMOTE_ADDRESS)[e]},clearAddresses:function(){this.set(a.RS_REMOTE_ADDRESS,{})},addVStore:function(e,t){this.get(a.RS_VSTORE_NAME_MAP)[e]=t},addNetMap:function(e){this.get(a.RS_NETWORK_NAME_MAP)[a.RS_NETWORK_MAPPING_LIST].push(e)},removeVStore:function(e){delete this.get(a.RS_VSTORE_NAME_MAP)[e]},removeNetMap:function(e){var t=this.get(a.RS_NETWORK_NAME_MAP),n=t[a.RS_NETWORK_MAPPING_LIST];t[a.RS_NETWORK_MAPPING_LIST]=_.filter(n,function(t){return t[a.RS_NETWORK_SRC_NAME]!==e[a.RS_NETWORK_SRC_NAME]||t[a.RS_NETWORK_SRC_HYPER_TYPE]!==e[a.RS_NETWORK_SRC_HYPER_TYPE]})},findLocalNetMap:function(e){var t=this.get(a.RS_NETWORK_NAME_MAP),n=t[a.RS_NETWORK_MAPPING_LIST];return _.find(n,function(t){return e[a.RS_NETWORK_NAME]===t[a.RS_NETWORK_SRC_NAME]&&e[a.RS_HYPER_TYPE]===t[a.RS_NETWORK_SRC_HYPER_TYPE]})},findRemoteNetMap:function(e){var t=this.get(a.RS_NETWORK_NAME_MAP),n=t[a.RS_NETWORK_MAPPING_LIST];return _.find(n,function(t){return e[a.RS_NETWORK_NAME]===t[a.RS_NETWORK_DEST_NAME]&&e[a.RS_HYPER_TYPE]===t[a.RS_NETWORK_DEST_HYPER_TYPE]})},getBandwidthPolicyConfigs:function(){var e=this.get(a.RS_BANDWIDTH_POLICY);return e?e[a.RS_BANDWIDTH_CONFIGS]:null},addBandwidthPolicyConfig:function(e){var t=this.get(a.RS_BANDWIDTH_POLICY);if(!t){t={policyName:this.get(a.NAME)?this.get(a.NAME)+"_policy":"policy"}}t[a.RS_BANDWIDTH_CONFIGS]||(t[a.RS_BANDWIDTH_CONFIGS]=[]),
t[a.RS_BANDWIDTH_CONFIGS].push(e),this.set(a.RS_BANDWIDTH_POLICY,t),this.dirty=!0},updateBandwidthPolicyConfig:function(e,t){var n=this.get(a.RS_BANDWIDTH_POLICY);n&&(n[a.RS_BANDWIDTH_CONFIGS][e]=t),this.set(a.RS_BANDWIDTH_POLICY,n),this.dirty=!0},removeBandwidthPolicyConfig:function(e){var t=this.get(a.RS_BANDWIDTH_POLICY);t&&(delete t[a.RS_BANDWIDTH_CONFIGS][e],t[a.RS_BANDWIDTH_CONFIGS]=_.compact(t[a.RS_BANDWIDTH_CONFIGS])),this.set(a.RS_BANDWIDTH_POLICY,t),this.dirty=!0},getDefaultBandwidthLimit:function(){var e=this.get(a.RS_BANDWIDTH_POLICY);if(e){var t=e[a.RS_DEFAULT_BANDWIDTH_LIMIT];if(!isNaN(t))return t/m.MBPS}return null},setDefaultBandwidthLimit:function(e){var t=this.get(a.RS_BANDWIDTH_POLICY);if(!t){t={policyName:this.get(a.NAME)?this.get(a.NAME)+"_policy":"policy"}}t.defaultBandwidthLimit=e?e*m.MBPS:null,this.set(a.RS_BANDWIDTH_POLICY,t),this.dirty=!0},isIncompatibleCapability:function(e){if(e===m.RS_CAPABILITIES.DISASTER_RECOVERY){var t=this.get(a.RS_CLOUD_TYPE);return t&&t===m.CLOUD_TYPES.AWS}return!1},isAddressConfigNonEditable:function(){var e=this.get(a.RS_CLOUD_TYPE);return e&&e===m.CLOUD_TYPES.AWS},isCostSavingCapable:function(){return _.indexOf(this.get(a.RS_CAPABILITIES),m.RS_CAPABILITIES.COST_SAVING_MODE>=0)},isCostSavingEnabled:function(){return this.get(a.RS_COST_SAVING_ENABLED)}}),S=h.extend({defaults:{hypervisorType:null,name:null},name:"NetworkMapModel"}),A=u.extend({model:S,name:"NetworkMapCollection",setCollectionURL:function(e){e?this.setURL(o.NETWORK_MAP+"?remoteSite="+e):this.setURL(o.NETWORK_MAP)},findNetworkMap:function(e,t){return this.find(function(n){return n.get(a.RS_NETWORK_NAME)===e&&n.get(a.RS_HYPER_TYPE)===t})}}),b=_.template(T);return t.extend({POLICY_VIEW_ID:"policy-form-container",ADVANCED_SETTINGS_VIEW_ID:"remoteSiteAdvancedView",BANDWIDTH_CONFIG:"bandwidthConfig",localVstores:null,el:"#popupRemoteSite",subViewHelper:null,initialized:!1,sshEnabled:!1,originalAttributes:null,currentSubViewId:null,isEditMode:!1,isUpdateAction:!1,name:"RemoteSiteFormView",events:{"click  .btnUpdate":"onUpdateClick","click  .modal-header .close":"hide","click  .btnCancel":"onCancelClick","click  .btnAddConfig":"onClickLinkAction","click  .btnEditConfig":"onClickLinkAction","click  .btnDeleteConfig":"onClickLinkAction","keydown input":"onKeyDown","keyup .inputName":"onInputNameKeyUp","click input":"onClickInput","click .useCompress":"onClickUseCompress",'click .modal-state:not(".sel-tab")':"changeTab"},initialize:function(){t.prototype.initialize.apply(this,arguments),this.subViewHelper=new v},render:function(){var e=this.getDOM("#advancedSettingsContainer"),t=$(e).is(":visible");this.$el.html(b({isEditMode:this.isEditMode})),this.isUpdateAction=this.isEditMode;var n=new i({el:"#remoteSiteFormContainer",model:this.model});this.subViewHelper.register(m.RS_VIEWS.CREATE,n),this.setCurrentState(m.RS_VIEWS.CREATE),n.setParentView(this),n.setInitialized(this.initialized),n.render(),t&&this.$("#advancedSettingsContainer").show(),this.applyNutanixInput()},changeTab:function(e){this.currentSubViewId===m.RS_VIEWS.CREATE?this.onUpdateClick():this.currentSubViewId===m.RS_VIEWS.ADVANCED&&(this.clearHeader(),this.setCurrentState(m.RS_VIEWS.CREATE),this.subViewHelper.get(m.RS_VIEWS.CREATE).render())},destroy:function(){this.subViewHelper.destroy(),t.prototype.destroy.apply(this,arguments)},show:function(e){this.initialized=!1,this.model=new C,this.originalAttributes={},e[m.NAV_ACTION]===m.ACTION_UPDATE&&(this.isEditMode=!0),t.prototype.show.apply(this,arguments);var n=e[m.NAV_ACTION_TARGET],i=e[m.NAV_ACTION_TARGET_ID];e[m.NAV_ACTION]===m.ACTION_DELETE?this._confirm("Delete remote site?",function(){this._deleteSite(n,i)},function(){this.hide()}):(e[m.NAV_ACTION]===m.ACTION_UPDATE&&this.model.setId(i),this.getRemoteSite())},showForm:function(){this.initialized=!0,this.render()},setCurrentState:function(e){var t={remoteSiteCreateView:"rs-create",remoteSiteAdvancedView:"rs-advanced"};this.currentSubViewId=e,this.clearState(),this.$("."+t[e]).addClass("sel-tab"),this.$el.addClass(t[e]+"-view")},clearState:function(){this.$(".modal-state").removeClass("sel-tab"),this.$el.removeClass("rs-create-view rs-advanced-view")},showNetworkMappings:function(){var e=this.model.get(a.RS_CAPABILITIES);return g.hasKVMOnly()&&(_.contains(e,m.RS_CAPABILITIES.SUPPORT_KVM)||_.contains(e,m.RS_CAPABILITIES.SUPPORT_VSPHERE))||g.hasESXandKVMOnly()&&_.contains(e,m.RS_CAPABILITIES.SUPPORT_KVM)},_deleteSite:function(e,t){var n=new C;n.setId(t);var i=this;n.destroy({success:function(e,t){l.showDetailsSummary(),i.hide()}})},clearForm:function(){},onClickLinkAction:function(e){var t=$(e.currentTarget),n={action:t.attr(m.NAV_ACTION),actionTarget:t.attr(m.NAV_ACTION_TARGET),actionTargetId:t.attr(m.NAV_ACTION_TARGET_ID)};return n.action===m.ACTION_CREATE&&n.actionTarget===this.BANDWIDTH_CONFIG?this.showBandwidthPolicyForm(n):n.action===m.ACTION_UPDATE&&n.actionTarget===this.BANDWIDTH_CONFIG?this.showBandwidthPolicyForm(n):n.action===m.ACTION_DELETE&&n.actionTarget===this.BANDWIDTH_CONFIG&&$.nutanixConfirm({msg:"Are you sure you want to delete this bandwidth throttling policy?",yes:function(){this.model.removeBandwidthPolicyConfig(n.actionTargetId);var e=this.subViewHelper.get(this.ADVANCED_SETTINGS_VIEW_ID);e&&e.refreshBandwidthConfigList()},no:function(){},yesText:"Yes",noText:"No",context:this}),!1},onClickInput:function(){this.$(".n-license-warning").is(":visible")||this.clearHeader()},onClickUseCompress:function(e){var t=c.FEATURE_MAP.LICENSE_DR_COMPRESSION,n=$(e.target).closest(".control-group").find(".n-inline-alert");if(-1!==e.target.id.indexOf("True")){if(c.violatedFeatureLicense(t)){var i=c.getPopupMessageTemplate(t);n.html(i).slideDown()}}else n.slideUp()},onInputNameKeyUp:function(e){f.validNameCharactersEventHandler(e,this.$(".n-input-validation-msg"))?this._showRemoteSiteWarning(this.$(".n-input-name-warning-msg"),$(e.currentTarget).val(),this.getCurrentClusterName()):this.$(".n-input-name-warning-msg").hide()},onKeyDown:function(e){this.$(".n-license-warning").is(":visible")||t.prototype.onKeyPress.apply(this,[e])},onEnterKeyPress:function(){this.onUpdateClick()},onUpdateClick:function(){if(this.currentSubViewId===this.POLICY_VIEW_ID){var e=this.subViewHelper.get(this.POLICY_VIEW_ID),t=this;return void(e&&e.isViewVisible()&&e.validateForm()&&(e.saveViewData(function(){t.subViewHelper.get("remoteSiteAdvancedView").refreshBandwidthConfigList()}),this.hideBandwidthPolicyForm()))}this.subViewHelper.get(this.currentSubViewId).onUpdateClick()},onCancelClick:function(){this.currentSubViewId===this.POLICY_VIEW_ID?this.hideBandwidthPolicyForm():this.model.isDirty()?$.nutanixConfirm({msg:"You have unsaved changes. Are you sure you want to proceed (this will discard your unsaved changes)?",yes:function(){this.hide()},yesText:"Yes",noText:"No",context:this}):this.hide()},showError:function(e){this.showHeaderTextError(e)},getRemoteSite:function(){var e=this,t=c.FEATURE_MAP.LICENSE_DR_MULTIPLE_REMOTE_SITES;if(c.violatedFeatureLicense(t)){this.collection=new p;var n=function(){f.log("RemoteSiteFormView: timeoutHandler: Issue with  displaying remote site form license message.")},i=function(){return!!e.$(".n-modal-alert-header").length&&(e.showHeaderWarning(c.getPopupMessageTemplate(t)),!0)};this.collection.fetch({success:function(t){if(t.length>1||!e.model.getId()&&1===t.length){var s={};s.intervalHandler=i,s.timeoutHandler=n,s.timeoutPeriod=1e3,s.intervalPeriod=100,f.setIntervalWithTimeout(s)}}})}this.model.getId()?this.model.fetch({success:function(){e.originalAttributes=JSON.parse(JSON.stringify(e.model.attributes)),e.getVStores()},error:function(t,n){e.showHeaderError(n.responseText)}}):this.getVStores()},getVStores:function(){var e=this;this.localVstores=new d,this.localVstores.fetch({success:function(){e.showForm()},error:function(t,n){e.showForm(),e.showHeaderErrorWithDetails("Unable to retrieve vstore list.",n.responseText)}})},saveRemoteSite:function(e){var t=this;this.undelegateEvents(),this._showModalLoading();var n=this.model.getId();this.model.save(null,{success:function(n,i){var s=(_.first(n.get(a.RS_CAPABILITIES)),!1),o="";e&&(E.isLightCompute(n)?(s=!0,o=E.getDRDisableMsgForLightCompute()):E.isSingleNodeBackup(n)?(s=!0,o=E.getDRDisableMsgForSingleNodeBackup()):E.isArchSameAsSource(n)||(s=!0,o=E.getDRDisableMsgForArchMismatch(n))),t.hideModal(),t.delegateEvents(),t.refreshView();var r=t.isUpdateAction?"updated":"created",l="Remote site "+r+" successfully.";s?t.showHeaderWarning(o):t.showHeaderSuccess(l),t.isUpdateAction=!0},error:function(e,i){t.hideModal(),t.delegateEvents(),t.model.setId(n),t.showHeaderError(t.i18n("remote_site_error")+" "+(f.processAjaxError(i.responseText)||""))}})},refreshView:function(){this.currentSubViewId===m.RS_VIEWS.ADVANCED?this.hide():(this.model.get(a.RS_NETWORK_NAME_MAP)||this.model.set(a.RS_NETWORK_NAME_MAP,{uuid:null,l2NetworkMappings:[]}),this.initializeAdvancedView())},initializeAdvancedView:function(){if(this.originalAttributes=JSON.parse(JSON.stringify(this.model.attributes)),this.showAdvancedView(!1),this.model.setId(this.model.get(a.RS_NAME)),this.localNetworkMap={},this.remoteNetworkMap={},!this.showNetworkMappings())return void this.showAdvancedView(!0);var e=new A,t=new A;e.setCollectionURL(),t.setCollectionURL(this.model.get(a.RS_NAME));var n=this;$.when.apply($,[e.fetch(),t.fetch()]).then(function(){n.networkMapErrror=!1,n.localNetworkMap=e.toJSON(),n.remoteNetworkMap=t.toJSON();var i=n.model.get(a.RS_NETWORK_NAME_MAP),s=i[a.RS_NETWORK_MAPPING_LIST];_.each(s,function(i){e.findNetworkMap(i[a.RS_NETWORK_SRC_NAME],i[a.RS_NETWORK_SRC_HYPER_TYPE])||n.localNetworkMap.push({name:i[a.RS_NETWORK_SRC_NAME],hypervisorType:i[a.RS_NETWORK_SRC_HYPER_TYPE]}),t.findNetworkMap(i[a.RS_NETWORK_DEST_NAME],i[a.RS_NETWORK_DEST_HYPER_TYPE])||n.remoteNetworkMap.push({name:i[a.RS_NETWORK_DEST_NAME],hypervisorType:i[a.RS_NETWORK_DEST_HYPER_TYPE]})}),n.showAdvancedView(!0)},function(){n.networkMapErrror=!0,n.showAdvancedView(!0)})},createSubView:function(e){var t,n={el:"#"+e,model:this.model};switch(e){case this.POLICY_VIEW_ID:t=new s(n)}return t},selectSubView:function(e){var t,n;t=this.subViewHelper.get(this.currentSubViewId),t&&t.hideView(),n=e.subViewId,t=this.subViewHelper.get(n),this.currentSubViewId=n;var i=e.options||{};t||(t=this.createSubView(n),this.subViewHelper.register(this.currentSubViewId,t)),t.setParentView(this),t.setViewOption(i),t.showView()},showBandwidthPolicyForm:function(e){this.clearHeader(),this.selectSubView({subViewId:this.POLICY_VIEW_ID,options:e});var t=this.subViewHelper.get(this.ADVANCED_SETTINGS_VIEW_ID);t&&t.hideView()},hideBandwidthPolicyForm:function(){var e=this.subViewHelper.get(this.POLICY_VIEW_ID);e&&e.hideView(),this.selectSubView({subViewId:this.ADVANCED_SETTINGS_VIEW_ID})},showAdvancedView:function(e){var t=this.subViewHelper.get(m.RS_VIEWS.ADVANCED);t||(t=new n({el:"#remoteSiteFormContainer",model:this.model,localVstores:this.localVstores}),this.subViewHelper.register(m.RS_VIEWS.ADVANCED,t),t.setParentView(this)),this.setCurrentState(m.RS_VIEWS.ADVANCED),t.localNetworkMap=this.localNetworkMap,t.remoteNetworkMap=this.remoteNetworkMap,t.networkMapErrror=this.networkMapErrror,t.setInitialized(e),t.render()},updateModel:function(e){this.model.get(a.RS_SSH_ENABLED)?this._confirm(m.RS_SSH_TUNNEL_WARNING_MESSAGE+"<br>Are you sure you want to continue?",function(){this.saveRemoteSite(e)}):this.saveRemoteSite(e)},_showModalLoading:function(){if(this.currentSubViewId===m.RS_VIEWS.CREATE){var e=this.isUpdateAction?"Updating":"Creating";$.nutanixConfirm({msg:e+" remote site ...",hideNo:!0,hideYes:!0,context:this})}},hideModal:function(){this.currentSubViewId===m.RS_VIEWS.CREATE&&$("#nutanixConfirmModal .btnYes").click()},_confirm:function(e,t,n){$.nutanixConfirm({msg:e,yes:t,no:n,yesText:"Yes",noText:"No",context:this})},getNewlyCreatedMappings:function(e,t){if(0===_.size(e))return t;if(!_.isEmpty(t)){if(!_.find(e,function(e,n){if(e!==t[n])return!0}))return _.each(e,function(e,n){e===t[n]&&delete t[n]}),t}return{}},_showRemoteSiteWarning:function(e,t,n){t?(e.html("Ensure '"+t+"' has also configured '"+n+"' as a remote site."),e.show()):(e.empty(),e.hide())}})}),define("text!templates/popups/dr/MigratePDFormView.html",[],function(){return'\x3c!-- The parent div modal is #popupMigratePD --\x3e\n<div class="modal-header">\n  <button type="button" class="close" data-dismiss="modal">\n    <i data-icon="K" aria-hidden="true"></i>\n  </button>\n  <h4 class="n-title">Migrate Protection Domain</h4>\n</div>\n\n<div class="n-modal-wrapper">\n    <div class="n-modal-body">\n      <div class="n-modal-content-wrapper">\n        <div class="n-modal-alert-header">\n          \x3c!-- @view: update message goes here --\x3e\n        </div>\n        \x3c!-- Remote Site Select Form --\x3e\n        <form id="remoteSiteForm" class="form-horizontal n-form-rows">\n          <% if ( ! initialized ) { %>\n            <div class=\'no-data\'>\n              <div class="loader"></div>\n              &nbsp;Loading...\n            </div>\n          <% } else if (remoteSitesVmsData.length == 0) { %>\n              <div class=\'n-popup-description\'>\n                There are no remote sites configured. <br> Please\n                create one to target a migration of this Protection Domain.\n              </div>\n          <% } else { %>\n              <div class="n-popup-description">\n                Select a Remote Site to migrate this Protection Domain to.\n              </div>\n\n              <div class="n-popup-description site-selction">Select Site</div>\n              <ul class="remote-site-list">\n                <% _.each(remoteSitesVmsData, function(rs) { %>\n                  <li class="remote-site-row" data-name="<%= rs.name %>"\n                    data-nonRecoverableLength="<%= rs.nonRecoverableLength %>"\n                    data-showMACWarning="<%= rs.showMACWarning %>"\n                    data-isRemoteMappingDone="<%= rs.isRemoteMappingDone %>"\n                      data-test="migratepdformview_li_site_name">\n                    <input type="radio" name="remote-sites"\n                           class="cb-remote-site"\n                           id="<%= rs.name %>"\n                        data-test="migratepdformview_radio_name">\n                    <label for="<%= rs.name %>"> <%= rs.name %></label>\n                  </li>\n\n                <% }) %>\n              </ul>\n              <% if (isFileServerPD) { %>\n                <div class="n-popup-description fs-migrate-warning">\n                <span class="warning-icon"><%= warningIcon %></span>\n                 Note: After migration, please go to the File Server page on\n                  the remote site to complete the process.</div>\n              <% } %>\n              <div class="promote-captcha-wr promoteCaptchaWrapper">\n              </div>\n          <% } %>\n        </form>\n        <div class="vm-details-wr hide">\n          \x3c!-- Table for nonrecoverable vms --\x3e\n        </div>\n      </div>\n    </div>\n\n  <div class="n-modal-footer">\n    \x3c!-- Back button --\x3e\n    <button class="btnCancel btn n-btn-list">\n      Cancel\n    </button>\n    <button class="btnUpdate btn btn-primary n-btn-list">\n      Migrate\n    </button>\n  </div>\n</div>'}),define("text!templates/popups/dr/MigratePDDetailsTemplate.html",[],function(){return'<% if (nonRecoverableVmsData.showErrMsg) { %>\n<div class="n-modal-alert-header">\n  <div class="alert alert-warning">\n      <div class="note">\n        Manual intervention will be required to recover these VMs.\n      </div>\n  </div>\n</div>\n<% } %>\n\n\n<table id="pd-non-recoverable-vms" class="table table-hover">\n  <thead>\n  <tr>\n    <th>NAME</th>\n    <th>REASON</th>\n  </tr>\n  </thead>\n  <tbody>\n  <% _.each(nonRecoverableVmsData, function (vmData) { %>\n    <tr class="n-table-row">\n      <td><%= vmData.vmName %></td>\n      <td><%= vmData.reasons %></td>\n    </tr>\n  <% }) %>\n  </tbody>\n</table>'}),define("views/popups/dr/MigratePDFormView",["views/basecomponents/popups/BasePopupView","data/DataProperties","data/DataURLConstants","managers/NotificationManager","managers/TaskManager","managers/AppManager","models/BaseModel","models/dataprotection/ProtectionDomainModel","models/BaseCollection","models/dataprotection/RemoteSiteCollection","utils/AppConstants","utils/AppUtil","utils/HypervisorUtil","utils/VisualizationUtil","utils/SVG","text!templates/popups/dr/MigratePDFormView.html","text!templates/popups/dr/MigratePDDetailsTemplate.html"],function(e,t,n,i,s,a,o,r,l,c,d,p,u,h,m,f,v){"use strict";var g=_.template(v),E=o.extend({name:"ValidateRemoteSiteVMModel",defaults:{erroCode:null,errorMessage:null,remoteSiteName:null,unRecoverableVms:[]}}),T=l.extend({model:E,remoteSites:[],parseOptions:function(e,t,n){return n=l.prototype.parseOptions.apply(this,arguments),n.data=JSON.stringify(this.remoteSites),n.type="POST",n.contentType="application/json",n},setRemoteSites:function(e){this.remoteSites=e}}),C=_.template('<div class="info-wr"><div class="alert alert-warning"><div><ul class="msg-list"><% if(showMACWarning) { %><li class="vm-details">The original VM configuration (including MAC address) will not be preserved during cross hypervisor migration.</li><% } %><% if(nonRecoverableLength) { %><li class="vm-details"><%= nonRecoverableLength %> VM(s) will not be recovered. <a class="alert-link migrate-details" data-pd="<%= name %>">Show Details</a></li><% } %><% if(showRemoteMappingWarning) { %><li class="vm-details">Network Mapping is not set on the Remote Site.</li><% } %></ul></div></div></div>');return e.extend({name:"MigratePDFormView",allPDRemoteSites:null,allRemoteSites:null,nonPDRemoteSiteNames:null,remoteSitesVmsData:null,vmDetailsState:!1,el:"#popupMigratePD",initialized:!1,NONE:"__none__",events:{"click  .btnUpdate":"onUpdateClick","click  .btnCancel":"onCancel","click  .modal-header .close":"hide","change  #other-remote-site":"onSelectOtherSite","click  .cb-remote-site":"onRemoteSiteClick","keypress input":"onKeyPress","click .migrate-details":"showPdVmsDetail"},onRemoteSiteClick:function(e){var t=$(e.currentTarget).closest("li"),n={name:t.attr("data-name"),nonRecoverableLength:this.isFileServerPD?"":parseInt(t.attr("data-nonRecoverableLength"),10),showRemoteMappingWarning:"false"===t.attr("data-isRemoteMappingDone"),showMACWarning:"true"===t.attr("data-showMACWarning")};if(n.nonRecoverableLength||n.showRemoteMappingWarning||n.showMACWarning){var i=C(n);this.$(".n-modal-alert-header").html(i).slideDown(100)}else this.$(".n-modal-alert-header").hide();n.nonRecoverableLength&&n.showMACWarning?this.$(".btnUpdate").prop("disabled",!0):this.$(".btnUpdate").prop("disabled",!1),this.$("#other-remote-site").val(this.NONE).trigger("update")},onSelectOtherSite:function(e){this.clearHeader(),this.$("#other-remote-site").val()!==this.NONE&&this.$("input:checked").removeAttr("checked")},render:function(){var e=this;this.$el.addClass("popupPD");var t=this.actionRoute[d.NAV_ACTION_TARGET_ID],n=new r;n.set(n.idAttribute,t,{silent:!0}),n.fetch({success:function(){e.isFileServerPD=n.isFileServerPD(),e.migratePDFormRenderer(e.isFileServerPD)},error:function(){e.migratePDFormRenderer(!1)}}),p.addInLineDonutLoader(this.$("#remoteSiteForm .loader")),this.applyNutanixInput({types:["select","radio"]})},show:function(t){this.pdName=t.actionTargetId,this.initialized=!1,e.prototype.show.apply(this,arguments),this.getRemoteSites()},showForm:function(){this.initialized=!0,this.nonPDRemoteSiteNames=[],this.remoteSitesVmsData=[];var e=this;this.warningIcon=m.SVGIcon("Exclamation_Mark","warning-icon",""),this.allDRRemoteSites=this.allRemoteSites.filter(function(e){return-1!==(e.get(t.RS_CAPABILITIES)||[]).indexOf(d.RS_CAPABILITIES.DISASTER_RECOVERY)&&-1===_.indexOf(_.values(d.CLOUD_TYPES),e.get(t.RS_CLOUD_TYPE))});var n=this.clusterManager.getCurrentClusterUuid(),i=u.getDominantHypervisor(n);_.each(this.allDRRemoteSites,function(n){var s,a={},o=0,r=n.get(t.RS_NAME);a.name=r;var l=n.get(t.RS_CAPABILITIES)||[],c=[];_.each(l,function(e){switch(e){case d.RS_CAPABILITIES.SUPPORT_KVM:c.push(d.HYPERVISOR_TYPE.KVM);break;case d.RS_CAPABILITIES.SUPPORT_VSPHERE:c.push(d.HYPERVISOR_TYPE.ESXI);break;case d.RS_CAPABILITIES.SUPPORT_HYPERV:c.push(d.HYPERVISOR_TYPE.HYPERV);break;case d.RS_CAPABILITIES.XEN:c.push(d.HYPERVISOR_TYPE.XEN)}});var p=u.getDominantHypervisor(null,c),h=p===i;h||(a.showMACWarning=!0);var m=e.validateVMCollection.find(function(e){return e.get(t.PD_VALIDATE_RS_NAME)===r});m?(h||(a.isRemoteMappingDone=m.get(t.PD_VALIDATE_RS_MAPPING)),s=m.get(t.PD_VALIDATE_UNRECOVERABLE),o=s.length,a.nonRecoverableLength=o,o&&(a.nonRecoverableVmsData=[],_.each(s,function(e){_.each(e[t.VM_RECOVERABILITY],function(n){n[t.VM_ERROR_CODE]===d.ERROR_NGT_NOT_INSTALLED&&(a.nonRecoverableVmsData.showErrMsg=!0),a.nonRecoverableVmsData.push({vmName:e.vmName,reasons:n.reason})})}))):a.nonRecoverableLength=0,e.remoteSitesVmsData.push(a)}),this.render(),0===this.allRemoteSites.length?this.$(".btnUpdate").hide():this.$(".btnUpdate").show()},clearForm:function(){},onUpdateClick:function(){var e="",t=this.$("input:checked");if(t.length>0&&(e=t.attr("id")),0===e.length)return void this.showHeaderError("Please select a remote site.");if(!this.validateMigrateCaptcha())return void this.showHeaderError(this.i18n("captcha_error"));var n=this,o=new r;o.set(o.idAttribute,this.pdName),o.migrate(e,function(){n.hide(),s.fetchOnDemand(),i.showClientNotification(d.NOTIFY_INFO,"Protection Domain migration initiated successfully"),setTimeout(function(){a.refreshView(o)},8e3)},function(e){n.showHeaderError("Error migrating to remote site. "+e)})},validateMigrateCaptcha:function(){return d.ACTION_MIGRATE.toUpperCase()===(this.$(".promoteCaptchaWrapper .captcha-text").val()||"").toUpperCase()},getRemoteSites:function(){var e=this;this.validateVMCollection=new T,this.validateVMCollection.setURL(_.template(n.PD_VALIDATE_MIGRATE,{pdName:this.pdName})),this.allRemoteSites=new c,$.when.apply($,[this.allRemoteSites.fetch(),this.validateVMCollection.fetch()]).then(function(){e.showForm()},function(t){e.showHeaderErrorWithDetails("Unable to retrieve remote sites.",t.responseText)})},onCancel:function(){this.vmDetailsState?(this.$(".btnCancel").html("Cancel"),this.$(".vm-details-wr").hide(),this.$("#remoteSiteForm").show(),this.$(".btnUpdate").prop("disabled",!1),this.$("input[name=remote-sites]:checked").trigger("click"),this.vmDetailsState=!1):this.hide()},showPdVmsDetail:function(e){this.clearHeader();var t=$(e.currentTarget).attr("data-pd"),n=this.remoteSitesVmsData.find(function(e){return e.name===t});this.vmDetailsState=!0,this.$(".btnUpdate").prop("disabled",!0),this.$(".btnCancel").html("Back"),this.$("#remoteSiteForm").hide(),this.$(".vm-details-wr").html(g({nonRecoverableVmsData:n.nonRecoverableVmsData})).show()},migratePDFormRenderer:function(e){this.template=_.template(f,{remoteSitesVmsData:this.remoteSitesVmsData,isFileServerPD:e,warningIcon:this.warningIcon,initialized:this.initialized}),this.$el.html(this.template);var t=this.clusterManager.getCurrentClusterUuid();t&&u.hasHyperV(t)&&this.showHeaderWarning(this.i18nStatic("RestoreSnapshotPopupView","hyperv_ha_msg"));var n=h.renderCaptchaTemplate(this.i18ns("migrate_captcha_msg",d.ACTION_MIGRATE.toUpperCase()));this.$(".promoteCaptchaWrapper").html(n)}})}),define("text!templates/popups/dr/ReplicatePDFormView.html",[],function(){return'\x3c!-- The parent div modal is #popupMigratePD --\x3e\n<div class="modal-header">\n  <button type="button" class="close" data-dismiss="modal">\n    <i data-icon="K" aria-hidden="true"></i>\n  </button>\n  <h4 class="n-title">Replicate Protection Domain</h4>\n</div>\n\n<div class="n-modal-wrapper">\n  <div class="n-modal-body">\n    <div class="n-modal-content-wrapper">\n      <div class="n-modal-alert-header">\n        \x3c!-- @view: update message goes here --\x3e\n      </div>\n      <div class="n-popup-description">\n        Select one or more targets to replicate to. This is a one time\n        replication that can start now or at a later time.\n      </div>\n\n      \x3c!-- Remote Site Select Form --\x3e\n      <form id="remoteSiteForm" class="form-horizontal n-form-rows">\n        <% if ( ! initialized ) { %>\n          <div class=\'no-data\'>\n            <img src=\'app/assets/images/spinners/loading.gif\'\n                 width=16px height=16px />&nbsp;Loading...\n          </div>\n        <% } else { %>\n          <div class="control-group">\n            <div class="target-row">\n              <input type="checkbox" id="localTarget" disabled checked>\n              <label  class="control-label" for="localTarget">\n                Local\n              </label>\n            </div>\n            <label class="control-label">Remote sites</label>\n            <% if ( allRemoteSites.length > 0 ) { %>\n            <% _.each(allRemoteSites, function(rs, idx) { %>\n              <div class=remote-site-row>\n                <input type="checkbox" name="remote-sites"\n                       class="cb-remote-site"\n                       id="<%= rs.get(\'name\') %>">\n                <%= rs.get(\'name\') %>\n                </input>\n              </div>\n              <% }) %>\n            <% } else { %>\n              <div class="msg-text">\n                There are no remote sites on this cluster.\n              </div>\n            <% } %>\n         </div>\n\n          <div class="control-group">\n            <label class="control-label">Replication start time</label>\n            <div class="controls">\n              <select id="replicationStartTime" data-class="overflowing">\n                <option value="0h">Now</option>\n                <option value="2h">2 hours from now</option>\n                <option value="4h">4 hours from now</option>\n                <option value="8h">8 hours from now</option>\n                <option value="16h">16 hours from now</option>\n                <option value="24h">24 hours from now</option>\n                <option value="36h">36 hours from now</option>\n                <option value="48h">48 hours from now</option>\n              </select>\n            </div>\n          </div>\n\n          <div class="control-group">\n            <label class="control-label">Retention time</label>\n            <div class="controls">\n              <select id="retentionStartTime" data-class="overflowing fancy-select-bottom-anchor">\n                <option value="">No Expiration</option>\n                <option value="1d">1 day</option>\n                <option value="2d">2 days</option>\n                <option value="4d">4 days</option>\n                <option value="7d">1 week</option>\n                <option value="14d">2 weeks</option>\n                <option value="1m">1 month</option>\n                <option value="2m">2 months</option>\n                <option value="3m">3 months</option>\n              </select>\n            </div>\n          </div>\n\n          <% if (showAppConsistent) { %>\n            <div class="control-group">\n              <div class="controls">\n                <input type="checkbox" class="cb-app-consistent" value="false">\n                Create application consistent snapshot\n              </div>\n            </div>\n          <% } %>\n        <% } %>\n      </form>\n    </div>\n  </div>\n\n  <div class="n-modal-footer">\n    \x3c!-- Back button --\x3e\n    <button class="btnCancel btn n-btn-list">\n      Cancel\n    </button>\n    <button class="btnUpdate btn btn-primary n-btn-list">\n      Save\n    </button>\n  </div>\n</div>\n'}),define("views/popups/dr/ReplicatePDFormView",["views/basecomponents/popups/BasePopupView","managers/NotificationManager","managers/TaskManager","managers/AppManager","managers/LicenseManager","models/dataprotection/ProtectionDomainModel","models/dataprotection/RemoteSiteCollection","utils/AppConstants","utils/AppUtil","utils/HypervisorUtil","text!templates/popups/dr/ReplicatePDFormView.html"],function(e,t,n,i,s,a,o,r,l,c,d){"use strict";return e.extend({allRemoteSites:null,el:"#popupReplicatePD",initialized:!1,protectionDomain:null,events:{"click  .btnUpdate":"onUpdateClick","click  .btnCancel":"hide","click  .modal-header .close":"hide","keypress input":"onKeyPress","click input":"clearHeader","click .cb-app-consistent":"onClickSnapshots"},initialize:function(e){},render:function(){var e=[];if(this.initialized){e=this.allRemoteSites.models;var t=this.protectionDomain.getMetroStandbySiteName();t&&(e=_.filter(this.allRemoteSites.models,function(e){return e.get(e.nameAttribute)!==t},this))}this.template=_.template(d,{allRemoteSites:e,initialized:this.initialized,showAppConsistent:this.initialized&&!this.protectionDomain.isMetroAvailPD()&&c.isAppConsistentSnapshotSupported()}),this.$el.html(this.template),this.applyNutanixInput({types:["select","checkbox"]})},show:function(t){this.pdName=t.actionTargetId,this.initialized=!1,e.prototype.show.apply(this,arguments),this.protectionDomain=new a,this.protectionDomain.setId(this.pdName),this.allRemoteSites=new o;var n=[];n=t.actionTarget===r.ENTITY_METRO_AVAILABILITY_PD?[this.protectionDomain.fetch(),this.allRemoteSites.fetch()]:[this.allRemoteSites.fetch()],this.loadModels(n)},showForm:function(){this.initialized=!0,this.render()},clearForm:function(){},onUpdateClick:function(){var e=this,s=this.$("input[name=remote-sites]:checked"),a=[];_.each(s,function(e){a.push(e.id)});var o=l.convertToUsecs(this.$("#replicationStartTime").val());o+=1e3*Date.now();var c=l.convertToUsecs(this.$("#retentionStartTime").val());c&&(c/=r.MICROS_PER_SECOND);var d=null;this.protectionDomain.isMetroAvailPD()||(d=this.$(".cb-app-consistent").is(":checked"));var p="Successfully scheduled a one time replication.";a.length||(p="Successfully scheduled a local snapshot."),this.protectionDomain.replicate(a,o,c,d,function(){e.hide(),t.showClientNotification(r.NOTIFY_SUCCESS,p),n.fetchOnDemand(),setTimeout(function(){i.refreshView(e.protectionDomain)},8e3)},function(t){e.showHeaderError(t)})},onClickSnapshots:function(e){e.stopPropagation();var t=s.FEATURE_MAP.LICENSE_DR_APPLICATION_CONSISTENT_SNAPSHOT;$(e.target).attr("checked")?s.violatedFeatureLicense(t)&&this.showHeaderWarning(s.getPopupMessageTemplate(t,"Application consistent snapshots are not allowed under the current license level.")):this.clearHeader()},loadModels:function(e){var t=this;$.when.apply($,e).done(function(){t.showForm()}).fail(function(e,n,i){t.showForm(),t.showHeaderErrorWithDetails("Unable to retrieve data.",e.responseText)})}})}),define("text!templates/popups/dr/ActivatePDFormView.html",[],function(){return'\x3c!-- The parent div modal is #popupMigratePD --\x3e\n<div class="modal-header">\n  <button type="button" class="close" data-dismiss="modal">\n    <i data-icon="K" aria-hidden="true"></i>\n  </button>\n  <h4 class="n-title">Activate Protection Domain</h4>\n</div>\n\n<div class="n-modal-wrapper">\n  <div class="n-modal-body">\n    <div class="n-modal-content-wrapper">\n      <div class="n-modal-alert-header">\n        \x3c!-- @view: update message goes here --\x3e\n      </div>\n\n      <div id="nonRecoverableTemplate">\n        \x3c!-- @view: template goes here --\x3e\n      </div>\n    </div>\n  </div>\n\n  <div class="n-modal-footer">\n    \x3c!-- Back button --\x3e\n    <button class="btnCancel btn n-btn-list">\n      Cancel\n    </button>\n    <button class="btnUpdate btn btn-primary n-btn-list">\n      Continue\n    </button>\n  </div>\n</div>'}),define("text!templates/popups/dr/NonRecoverableVMDataView.html",[],function(){
return'\n<div class="n-popup-description">\n  <% if (! initialized) { %>\n    <div class="n-modal-loader">\n      <div class="donut-loader-blue"></div>\n      <span class="n-loading-text">&nbsp; Loading data...</span>\n    </div>\n  <% } else if (!hasError) { %>\n    <div id="non-recoverable-vms-list" class="non-recoverable-vms-list">\n      <div class="n-base-data-table">\n        <% if (snapshotEntities.length > 0) { %>\n          <div class="n-header">\n            \x3c!-- Header left components go here... --\x3e\n            <ul class="n-header-left">\n              <li><%= i18n(\'table_header\') %></li>\n            </ul>\n            \x3c!-- Header right components go here... --\x3e\n            <ul class="n-header-right">\n              <li class="n-page-info-container">\n                <p class="n-page-info">\n                  <%- startEntity %> - <%- endEntity %> of <%- totalEntities %>\n                </p>\n              </li>\n              <li class="n-sep">\n                &middot;\n              </li>\n              <li class="n-page-nav-container">\n                <a class="btn btnPrevious n-button-previous n-disabled">\n                  <i aria-hidden="true" data-icon="x"></i>\n                </a>\n                <a class="btn btnNext n-button-next n-disabled" >\n                  <i aria-hidden="true" data-icon="y"></i>\n                </a>\n              </li>\n            </ul>\n          </div>\n          <table id="non-recoverable-vms-table" class="dataTable">\n            <thead>\n            <tr>\n              <th class="sorting" data-key="name">\n                <%= i18n(\'column_name\') %>\n              </th>\n              <th class="sorting" data-key="type">\n                <%= i18n(\'column_type\') %>\n              </th>\n              <th class="sorting" data-key="consistencyGroup">\n                <%= i18n(\'column_consistency_group\') %>\n              </th>\n              <th class="sorting" data-key="recoveryStatus">\n                <%= i18n(\'column_recovery_Status\') %>\n              </th>\n            </tr>\n            </thead>\n            <tbody>\n              <% _.each(snapshotEntities, function (entity, index) {%>\n                <tr class="n-table-row">\n                  <td><%- entity.name %></td>\n                  <td><%- entity.type %></td>\n                  <td><%- entity.consistencyGroup %></td>\n                  <td>\n                    <%- entity.recoveryStatus %>\n                    <% if (entity.recoveryErrors.length) { %>\n                      <span class="missing-snapshots-info" data-index=<%- index %>>\n                        <%= Components.icon(\'exclamation_badge\', \'-critical -inline\') %>\n                      </span>\n                    <% } %>\n                  </td>\n                </tr>\n              <% }) %>\n            </tbody>\n          </table>\n        <% } else { %>\n          <span><%= i18n(\'no_entities\') %></span>\n        <% } %>\n      </div>\n    </div>\n  <% } %>\n</div>'}),define("views/popups/dr/ActivatePDFormView",["views/basecomponents/popups/BasePopupView","models/dataprotection/ProtectionDomainModel","data/DataProperties","managers/NotificationManager","managers/AppManager","models/dataprotection/SnapshotCollection","data/DataManager","data/DataURLConstants","utils/AppUtil","utils/AppConstants","utils/SVG","text!templates/popups/dr/ActivatePDFormView.html","text!templates/popups/dr/NonRecoverableVMDataView.html"],function(e,t,n,i,s,a,o,r,l,c,d,p,u){"use strict";var h=_.template(u),m=_.template('<div class="fs-activate-warning"><span class="warning-icon"><%= warningIcon %></span> Note: After activation, please go to the File Server page to complete the process.</div>');return e.extend({el:"#popupActivatePD",initialized:!1,name:"ActivatePDFormView",events:{"click  .btnUpdate":"activate","click  .btnCancel":"hide","click  .modal-header .close":"hide"},render:function(){this.$el.addClass("popupPD"),this.$el.html(p),this.$el.find("#nonRecoverableTemplate").html(h({nonRecoverableVmsList:this._getNonRecoverableVms(),initialized:this.initialized,clusterName:this.clusterManager.getCurrentClusterName(),isLocalSnapshot:this.snapshotType===c.SNAPSHOT_TYPE.LOCAL}))},_getNonRecoverableVms:function(){return _.filter(this.vmsList,function(e){var t=e[n.VM_RECOVERABILITY];return t=_.filter(t,function(e){return 0===e.remoteSite.length}),!_.isEmpty(t)})},show:function(t){this.initialized=!1,e.prototype.show.apply(this,arguments);var i=this;this.actionRoute=t,this.collection=new a,this.collection.enableFullDetails();var s=t.actionTargetId.split(" ");this.collection.setCollectionFilterId(t.actionTargetName),this.collection.setCollectionFilterIdType(c.ENTITY_PROTECTION_DOMAIN),this.snapshotType=parseInt(s[0],10),this.collection.setSnapshotType(this.snapshotType),this.collection.setSnapshotFilterId(s[1]),this.collection.fetch({success:function(e){if(!e.length)return void i.activate();var t=_.sortBy(e.models,c.SNAP_CREATE_TIME).reverse();if(i.vmsList=_.first(t).get(n.SNAP_VMS),!i.vmsList.length)return void i.activate();var s=i.vmsList.length,a=0;if(_.each(i.vmsList,function(e){var t=e[n.VM_RECOVERABILITY];t=_.filter(t,function(e){return 0===e.remoteSite.length}),_.each(t,function(e){e[n.VM_ERROR_CODE]===c.ERROR_RECOVERY_NOT_SUPPORTED&&++a})}),0===a)return void i.activate();i.initialized=!0,i.render(),a===s?i.$(".btnUpdate").attr("disabled",!0):a<s&&i.showHeaderWarning(i.i18ns("activation_warning",a,s))},error:function(){i.showHeaderError("Error fetching data.")}})},activate:function(e){this.hide();var t=this.actionRoute[c.NAV_ACTION_TARGET_ID];this._activatePD(t,!0)},_pdAction:function(e,n){var a=new t;a.set(a.idAttribute,e,{silent:!0}),a.fetch({success:function(t,a){var d=o.getFormattedURL(r.PROTECTION_DOMAIN+"/"+e+"/"+n);$.ajax({type:"POST",url:d,contentType:"application/json; charset=UTF-8",data:"{}",statusCode:t.getStatusCode(),success:function(e,n,a){i.showClientNotification(c.NOTIFY_INFO,"Protection Domain update has been initiated successfully. This process can take a while."),setTimeout(function(){s.refreshView(t)},8e3)},error:function(e,t,n){l.log("Error updating Protection Domain: "+n);var s="Error updating protection domain. ";e&&e.responseText&&e.responseText.length>0&&(s+=" "+l.processAjaxError(e.responseText)),i.showClientNotification(c.NOTIFY_ERROR,s)}})}})},_activatePD:function(e,n){var i=this,s=n?"Are you sure you want to activate Protection Domain '"+e+"' ?":"Inactivating this Protection Domain will also delete its VM(s). Do you want to proceed?";if(n){var a=new t;a.set(a.idAttribute,e,{silent:!0}),a.fetch({success:function(){if(a.isFileServerPD()){var t=d.SVGIcon("Exclamation_Mark","warning-icon","");s+=m({warningIcon:t})}i.showConfirmMessage(s,e,"activate")},error:function(){i.showConfirmMessage(s,e,"activate")}})}else i.showConfirmMessage(s,e,"deactivate")},showConfirmMessage:function(e,t,n){var i=this;$.nutanixConfirm({msg:e,yes:function(){i._pdAction(t,n)},no:function(){i.hide()},yesText:"Yes",noText:"No"})}})}),define("text!templates/popups/dr/PDWarningPopupView.html",[],function(){return'<div class="modal-header">\n  <button type="button" class="close" data-dismiss="modal">\n    <i data-icon="K" aria-hidden="true"></i>\n  </button>\n  <h4 class="n-title"><%= i18n(\'pd_warning_title\') %></h4>\n</div>\n<div class="n-modal-wrapper">\n  <div class="n-modal-body">\n    <div class="n-modal-content-wrapper">\n      <%= i18n(\'pd_warning_msg\') %>\n    </div>\n  </div>\n  <div class="n-modal-footer">\n    \x3c!-- Form buttons --\x3e\n    <button class="btnUpdate btn -blue n-primary-btn n-btn-form">\n      <%= i18n(\'ok\') %>\n    </button>\n  </div>\n</div>'}),define("views/popups/dr/PDWarningPopupView",["views/basecomponents/popups/BasePopupView","utils/AppConstants","models/userdata/UserDataModel","text!templates/popups/dr/PDWarningPopupView.html"],function(e,t,n,i){"use strict";return e.extend({el:"#pdWarningPopup",name:"PDWarningPopupView",events:{"click  .modal-header .close":"hide","click  .btnUpdate":"onOKClick"},render:function(){this.template=_.template(i,this.vtOptions()),this.$el.html(this.template)},onOKClick:function(e){var i=new n;i.set({type:t.UI_CONFIG,key:t.DR_POPUP_SHOWN,value:!1}),i.save(),this.hide()}})}),define("utils/NetworkTemplates",[],function(){"use strict";return{UNDERSTAND_PRIORITIES:_.template('<section data-ntnx-content-inner>\n        <section data-ntnx-section>\n          <%= description %>\n        </section>\n        <section data-ntnx-section>\n          <%= example %>\n          <table class="priorities-example table">\n            <thead>\n              <tr>\n                 <th scope="col"><%= routing_policy.priority %></th>\n                 <th scope="col"><%= routing_policy.source %></th>\n                 <th scope="col"><%= routing_policy.destination %></th>\n                 <th scope="col"><%= routing_policy.protocol %></th>\n              </tr>\n            </thead>\n            <tbody>\n              <tr>\n                <td>100</td>\n                <td>10.1.20.0/15</td>\n                <td>Any</td>\n                <td>ICMP</td>\n              </tr>\n              <tr>\n                <td>70</td>\n                <td>External</td>\n                <td>Any</td>\n                <td>TCP</td>\n              </tr>\n            </tbody>\n          </table>\n        </section>\n      </section>')}}),define("text!templates/popups/notification/GenericNotificationPopupView.html",[],function(){return'\x3c!-- The parent div modal is #popupGenericNotification--\x3e\n<div class="modal-header">\n  <button type="button" class="close" data-dismiss="modal">\n    <i data-icon="K" aria-hidden="true"></i>\n  </button>\n  <h4 class="n-title"></h4>\n</div>\n</div>\n\n<div class="n-modal-wrapper">\n  <div class="n-modal-body">\n    <div class="n-modal-content-wrapper">\n      <div class="n-modal-content">\n        <div class="n-notification-content">\n          \x3c!-- Notification Content here--\x3e\n        </div>\n      </div>\n    </div>\n  </div>\n  <div class="modal-footer">\n    <button type="button" class="btnClose btn n-primary-btn"\n            data-dismiss="modal">\n      Close\n    </button>\n  </div>\n</div>'}),define("views/popups/notification/GenericNotificationPopupView",["views/basecomponents/popups/BasePopupView","utils/AppConstants","utils/CommonTemplates","utils/NetworkTemplates","text!templates/popups/notification/GenericNotificationPopupView.html"],function(e,t,n,i,s){"use strict";return e.extend({el:"#popupGenericNotification",events:{"click .modal-header .close":"hide","click .btnClose":"hide","click .docLink":"onDocLinkClick"},initialize:function(){e.prototype.initialize.apply(this,arguments),_.bindAll(this,"renderNotificationContent")},render:function(){this.$el.html(s);var e=this.actionRoute[t.NAV_ACTION_TARGET],n=this.actionRoute[t.NAV_ACTION];e===t.ENTITY_METRO_AVAILABILITY_PD?n===t.ACTION_CHECK_PREREQUISITE&&(this.$(".n-title").html("Enable Metro Availability"),require(["text!templates/popups/dr/EnableMetroAvailabilityInfo.html"],this.renderNotificationContent)):e===t.ENTITY_CLUSTER&&n===t.ACTION_UNREGISTER?this._showUnRegisterInstructions():e===t.ENTITY_ROUTING_POLICY&&n===t.ROUTING_POLICY.ACTION_UNDERSTAND_PRIORITIES&&this._showUnderstandPriorities()},renderNotificationContent:function(e){this.$(".n-notification-content").html(e)},onDocLinkClick:function(e){var n=$(e.currentTarget);this.navigateToHelpPage({action:n.attr(t.NAV_ACTION),actionTarget:n.attr(t.NAV_ACTION_TARGET)})},_showUnRegisterInstructions:function(){this.$(".n-title").html(this.i18nStatic("common","unregisterPE.unregister_title"));var e=this.clusterManager.getClusterModelByClusterUuid(this.actionRoute[t.NAV_ACTION_TARGET_ID]),i=e&&e.getName(),s=this.i18nsStatic("common","unregisterPE.msg_registered",i||this.i18nStatic("common","unregisterPE.thisCluster"),this.i18nStatic("common","unregisterPE.thisPrismCentral")),a=n.DOCUMENT_LINK({here:this.i18nStatic("common","unregisterPE.here"),action:t.ACTION_UNREGISTER,actionTarget:t.ENTITY_CLUSTER}),o=this.i18nsStatic("common","unregisterPE.unregister_instruction",a),r=n.PE_UNREGISTER_TEMPLATE(this.vtOptions({registrationInfo:s,unregisterInstruction:o}));this.renderNotificationContent(r)},_showUnderstandPriorities:function(){this.overlayPopup=!0,this.$(".n-title").html(this.i18nStatic("common","routingPolicy.understandpriorities_title"));var e=i.UNDERSTAND_PRIORITIES(this.vtOptions({description:this.i18nStatic("common","routingPolicy.priorities_description"),example:this.i18nStatic("common","routingPolicy.example"),routing_policy:this.i18nStatic("IntentDynamicPopupView","routing_policy")}));this.renderNotificationContent(e)}})}),define("text!templates/popups/dr/VMAvailabilityPopupView.html",[],function(){return'\x3c!-- The parent div modal is #popupVMAvailability --\x3e\n<div class="modal-header">\n  <button type="button" class="close" data-dismiss="modal">\n    <i data-icon="K" aria-hidden="true"></i>\n  </button>\n  <h4 class="n-title">\n    Update Protection Domain (Metro Availability): \'<%= pdName %>\'\n  </h4>\n</div>\n\n<div class="n-modal-wrapper">\n  <div class="n-modal-body">\n    <div class="n-modal-content-wrapper">\n      <div class="n-modal-alert-header">\n        \x3c!-- @view: update message goes here --\x3e\n      </div>\n      <% if ( ! initialized ) { %>\n        <div class=\'no-data page-loading-message\'>\n          <img src=\'app/assets/images/spinners/loading.gif\'\n               width=16px height=16px/>&nbsp;Loading...\n        </div>\n      <% } else { %>\n        <div class="pd-vmAvail">\n          \x3c!-- VM availability view goes here... --\x3e\n        </div>\n      <% } %>\n    </div>\n  </div>\n\n  <div class="n-modal-footer">\n    \x3c!-- Cancel button --\x3e\n    <button class="btnCancel btn n-btn-list">\n      Cancel\n    </button>\n    <button class="btnUpdate btn btn-primary n-btn-list"\n    <%= initialized ? \'\' : \'disabled\'%> >\n    Save\n    </button>\n  </div>\n</div>\n'}),define("views/popups/dr/VMAvailabilityPopupView",["views/basecomponents/popups/BasePopupView","data/DataProperties","data/DataURLConstants","models/BaseModel","models/dataprotection/ProtectionDomainModel","utils/AppConstants","text!templates/wizards/pd/FailureHandlingPage.html","text!templates/popups/dr/VMAvailabilityPopupView.html"],function(e,t,n,i,s,a,o,r){"use strict";var l=i.extend({urlRoot:n.PROTECTION_DOMAIN,name:"ProtectionDomainTimeoutModel",pdName:null,entityType:a.ENTITY_METRO_AVAILABILITY_PD,getValue:function(e){return e===t.NAME?this.pdName:i.prototype.getValue.apply(this,arguments)},setPDName:function(e){this.pdName=e},getURL:function(){return _.template(n.PROTECTION_DOMAIN_BREAK_REPLICATION_TIMEOUT)({pdName:this.pdName})}});return e.extend({el:"#popupVMAvailability",initialized:!1,model:null,template:_.template(r),vmAvailTemplate:_.template(o),events:{"click  .btnUpdate":"onUpdateClick","click  .btnCancel":"hide","click  .modal-header .close":"hide","keypress input":"onKeyPress","click    input":"clearHeader","click input[name=vmAvailability]":"onVMAvailabilityClick"},initialize:function(e){this.model=new s},render:function(){this.$el.html(this.template({initialized:this.initialized,pdName:this.model.get(this.model.idAttribute)})),this.initialized&&(this.$(".pd-vmAvail").html(this.vmAvailTemplate({timeout:this.model.getMetroTimeout(),defaultTimeout:this.model.getMetroMaxTimeoutValue(),timeoutTooltip:this.model.getMetroTimeoutTooltip(),pdEntityType:a.ENTITY_NAMES[a.ENTITY_METRO_AVAILABILITY_PD]})),this.$(".timeout-tooltip").tooltip({placement:"right",trigger:"hover",html:!1})),this.applyNutanixInput()},show:function(t){this.initialized=!1,this.model.set(this.model.idAttribute,t.actionTargetId,{silent:!0}),e.prototype.show.apply(this,arguments);var n=this;this.model.fetch({success:function(){n.initialized=!0,n.render()},error:function(e){n.$(".page-loading-message").hide(),n.showHeaderErrorWithDescription(e,"Error retrieving protection domain.")}})},destroy:function(){this.$(".timeout-tooltip").tooltip("destroy"),e.prototype.destroy.apply(this,arguments)},onUpdateClick:function(){var e=0;if(this.$("input[value=timeout]").is(":checked")){var t=$.trim(this.$(".timeout").val());e=Number(t);var n=this.model.validateTimeoutValue(e);if(n)return void this.showHeaderTextError(n)}var i=this.model.getMetroTimeout();if(i===e||0===e&&null===i)return void this.hide();var s=new l;s.setPDName(this.model.get(this.model.idAttribute));var a=null;e>0&&(a={timeout:e});var o=this;s.isNew(!1),s.save(a,{success:function(){o.hide()},error:function(e,t){o.showHeaderErrorWithDetails("Error updating failure handling timeout.",t.responseText)}})},onVMAvailabilityClick:function(e){"timeout"===$(e.currentTarget).val()?this.$(".timeout").prop("disabled",!1):this.$(".timeout").prop("disabled",!0)}})}),define("text!templates/popups/dr/RestoreSnapshotPopupView.html",[],function(){return'\x3c!-- The parent div modal is #popupRestoreSnapshot --\x3e\n<div class="modal-header">\n  <button type="button" class="close" data-dismiss="modal">\n    <i data-icon="K" aria-hidden="true"></i>\n  </button>\n  <h4 class="n-title">Restore Snapshot</h4>\n</div>\n\n<div class="n-modal-wrapper">\n  <div class="n-modal-body">\n    <div class="n-modal-content-wrapper">\n      <div class="n-modal-alert-header">\n        \x3c!-- @view: update message goes here --\x3e\n      </div>\n      <% if (initialized && !hasError) { %>\n        <div class="n-popup-description">\n          Restore entities in this protection domain to snapshot \'<%= name %>\'\n          created on \'<%= createTime %>\'.\n        </div>\n      <% } %>\n\n      \x3c!-- Vms Select Form --\x3e\n      <form id="restoreForm" class="form-horizontal n-form-rows">\n        <% if ( ! initialized ) { %>\n        <div class=\'no-data\'>\n          <img src=\'app/assets/images/spinners/loading.gif\'\n               width=16px height=16px/>&nbsp;Loading...\n        </div>\n        <% } else if (!hasError) { %>\n        <div>\n          <div class="form-div">\n            <div class="n-from-title">\n              Select entities to be restored\n            </div>\n            <div class="table-snapshotVMs">\n              \x3c!--table here--\x3e\n            </div>\n          </div>\n          <div class="form-div">\n            <div class="n-from-title">\n              <%= i18n(\'restore_settings\') %>\n            </div>\n            <div class="inner-form-div">\n              <div class="restore-type-btn">\n                <input type=\'radio\' class=\'replace\' name=\'replaceOption\'\n                       <%= (!isActive) ? \'disabled\' :\'\' %>\n                       value=\'true\'>\n                <%= i18n(\'overwrite_option\') %>\n              </div>\n            </div>\n            <div class="inner-form-div">\n              <div class="restore-type-btn">\n                <input type=\'radio\' class=\'newPath\' name=\'replaceOption\'\n                       checked\n                       value=\'false\'>\n                <%= i18n(\'create_new_option\') %>\n              </div>\n              <div class="restore-parameter restore-path">\n                <% if (showPath) { %>\n                  <div class="n-from-title">Path</div>\n                  <input type="text" id="restorePath">\n                <% } %>\n                <div class="n-from-title">VM Name Prefix </div>\n                <input type="text" class="namePrefix"\n                       id="vmNamePrefix"  value="Nutanix-Clone-">\n                <div class="n-from-title namePrefixExample vmPrefixExample">\n                </div>\n                <div class="n-from-title">Volume Group Name Prefix </div>\n                <input type="text" class="namePrefix"\n                       id="vgNamePrefix" value="Nutanix-Clone-">\n                <div class="n-from-title namePrefixExample vgPrefixExample">\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n        <% } %>\n      </form>\n    </div>\n  </div>\n\n  <div class="n-modal-footer">\n    \x3c!-- Back button --\x3e\n    <button class="btnCancel btn n-btn-list">\n      Cancel\n    </button>\n    <button class="btnUpdate btn btn-primary n-btn-list"\n     <%= hasError ? \'disabled\' : \'\'%> >\n      OK\n    </button>\n  </div>\n</div>\n'}),define("views/popups/dr/RestoreSnapshotPopupView",["views/basecomponents/popups/BasePopupView","data/DataProperties","data/DataURLConstants","models/BaseCollection","models/dataprotection/SnapshotModel","models/dataprotection/ProtectionDomainModel","models/vm/VMCollection","views/basecomponents/datatables/DetailsTableView","views/basecomponents/datatables/DataTableTemplates","views/basecomponents/datatables/DataTableColumnProvider","utils/AppConstants","utils/SubModelHelper","utils/HypervisorUtil","utils/TimeUtil","utils/ValidationUtil","components/Components","text!templates/popups/dr/RestoreSnapshotPopupView.html"],function(e,t,n,i,s,a,o,r,l,c,d,p,u,h,m,f,v){"use strict";var g=_.template('<div class="n-popup-title"> The following <%= title %> will be replaced with the contents of the snapshot.</div><div class="n-popup-data-list"><% for (var i = 0; i < entityNames.length; i++) { %><div class="n-popup-data"><%= _.escape(entityNames[i])%></div><% } %></div><div class="n-popup-title">Are you sure you want to continue?</div>'),E=_.template('<span class="vm-recoverability-tooltip"data-toggle="tooltip" data-original-title="<%= reason %>"><span class="n-tooltip-circle-small">!</span></span>'),T=_.template('<span class="vm-disabled"><%= _.escape(data) %></span>'),C=_.template('<div data-entityType="<%= className %>"><%= data %></div>'),S={IS_AUTO_ADDED:"isAutoAdded",IS_DEPENDENT:"isDependent",IS_CHECKED:"isChecked"};return e.extend({el:"#popupRestoreSnapshot",initialized:!1,snapshotId:null,pdName:null,model:null,subModelHelper:null,sampleEntity:null,allEntities:null,hasNonRecoverableVMs:!1,entityTable:null,name:"RestoreSnapshotPopupView",events:{"click  .btnUpdate":"onUpdateClick","click  .btnCancel":"hide","click  .modal-header .close":"hide","click .n-datatable-checkbox":"onSelectEntityClick","click .checkboxSelectAll":"onSelectAllClick","click input[name=replaceOption]":"onReplaceOptionClick","keyup  .namePrefix":"onEntityNamePrefixKeyUp","focus  .namePrefix":"onEntityNamePrefixFocus"},initialize:function(t){e.prototype.initialize.apply(this,arguments),this.subModelHelper=new p},render:function(){var e=null,n=!1;if(this.initialized){var i=this.subModelHelper.get(this.snapshotId);i.length>0?this.model=i.models[0]:e="Unable to restore snapshot, snapshot is no longer exist.";var s=this.subModelHelper.get(this.pdName);n=!!s&&s.isActive(),s.isMetroAvailPD()?e="Restoring a snapshot is not available for Protection Domains with Metro Availability on.":null!==s.get(t.PD_VSTORE_ID)&&(e="Restoring a snapshot is not available for VStore protected Protection Domains.")}var a=null!==e,o=this.model?this.model.get(t.SNAP_VMS):[],r=this.model?this.model.get(t.SNAP_VGS):[];o.map(function(e){e[t.RESTORE_ENTITY_TYPE]=d.RESTORE_ENTITY_TYPES.VM,e[t.NAME]=e[t.VM_NAME]}),r.map(function(e){e[t.RESTORE_ENTITY_TYPE]=d.RESTORE_ENTITY_TYPES.VG}),o=_.sortBy(o,t.VM_NAME),r=_.sortBy(r,t.NAME);var l=o.concat(r);this.template=_.template(v,this.vtOptions({hasError:a,isActive:n,initialized:this.initialized,name:this.initialized?this.model.get(t.SNAP_ID):"",createTime:this.initialized?h.formatDateTime(this.model.get(t.SNAP_CREATE_TIME)/1e3):"",showPath:this.showPath()})),this.$el.html(this.template),this.initialized&&!a&&this.populateEntities(l),this.sampleEntity=l.length?l[0].name:"",this.allEntities=l,this.$(".vm-recoverability-tooltip").tooltip("destroy"),this.$(".vm-recoverability-tooltip").tooltip({placement:"right",trigger:"hover",html:!1}),this.applyNutanixInput(),null!==e&&this.showHeaderTextError(e)},show:function(t){this.snapshotId=t.actionTargetId,this.pdName=t.actionTargetName,this.initialized=!1,e.prototype.show.apply(this,arguments),this.subModelHelper.register(this.snapshotId,this._initSnapshotCollection());var n=new a;n.set(n.idAttribute,this.pdName,{silent:!0}),this.subModelHelper.register(this.pdName,n);var i=new o;i.setProjection(d.PROJECTION.BASIC_INFO),this.subModelHelper.register("VMS",i);var s=this;$.when.apply($,this.subModelHelper.iterate("fetch")).done(function(){s.initialized=!0,s.showForm()}).fail(function(e,t,n){s.initialized=!1,s.showForm(),s.showHeaderErrorWithDescription(e,"Error restoring snapshot.")})},showForm:function(){this.render(),this._toggleHyperVWarning()},clearForm:function(){},_toggleHyperVWarning:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._isInPlaceRestore(),t=this.clusterManager.getCurrentClusterUuid();e&&t&&u.hasHyperV(t)?this.showHeaderWarning(this.i18n("hyperv_ha_msg")):this.clearHeader()},destroy:function(){this.entityTable&&this.entityTable.destroy(),this.$(".vm-recoverability-tooltip").tooltip("destroy"),e.prototype.destroy.apply(this,arguments)},showPath:function(){return!u.hasKVMOnly()},onUpdateClick:function(){var e={},t=this.allEntities?this.allEntities:[],n=this.$(".checkboxSelectAll").is(":checked")||0===t.length;if(e.vms=null,e.vgs=null,this.clearHeader(),(!n||this.hasNonRecoverableVMs)&&(e.vms=[],e.vgs=[],$.each(this.$(".n-datatable-checkbox:checked"),function(){var t=$(this).parent().attr("data-entityType"),n=$(this).val();t===d.RESTORE_ENTITY_TYPES.VG?e.vgs.push(n):e.vms.push(n)}),0===e.vms.length&&0===e.vgs.length))return void this.showHeaderTextError("Please select an entity.");if(e.replaceChecked=this.$(".replace").is(":checked"),e.path=null,e.vmNamePrefix=null,e.vgNamePrefix=null,e.replaceChecked){var i=this._getReplacedVMNames(e.vms).concat(this._getReplacedVGNames(e.vgs)),s=i.length;s?$.nutanixConfirm({msg:g({title:1===s?"entity":s+" entities",entityNames:_.sortBy(i,function(e){return e})}),yes:function(){this._restoreSnapshot(e)},yesText:"Yes",noText:"No",context:this}):this._restoreSnapshot(e)}else{if(this.showPath()&&(e.path=$.trim(this.$("#restorePath").val()),""===e.path))return void this.showHeaderTextError("Please specify the new path for restoring.");e.vmNamePrefix=$.trim(this.$("#vmNamePrefix").val()),e.vgNamePrefix=$.trim(this.$("#vgNamePrefix").val());var a=this._validateRestoreParams({vmNamePrefix:e.vmNamePrefix,vgNamePrefix:e.vgNamePrefix,vms:e.vms,vgs:e.vgs});if(a)return void this.showHeaderTextError(a);this._restoreSnapshot(e)}},_getReplacedVMNames:function(e){var n=e||this._getSnapshotVMNames(),i=this.subModelHelper.get("VMS"),s=_.filter(i.models,function(e){return _.contains(n,e.get(t.VM_NAME))});return s.length?_.map(s,function(e){return e.get(t.VM_NAME)}):[]},_getReplacedVGNames:function(e){var n=e||_.pluck(this.model.get(t.SNAP_VGS),t.VG_UUID),i=[];return n.length&&_.each(this.model.get(t.SNAP_VGS),function(e){_.contains(n,e[t.VG_UUID])&&i.push(e[t.NAME])}),i},_getSnapshotVMNames:function(){var e=this.model?this.model.get(t.SNAP_VMS):[];return _.pluck(e,t.VM_NAME)},_validateRestoreParams:function(e){var t=e.vmNamePrefix,n=e.vgNamePrefix,i=e.vms,s=e.vgs;return _.isEmpty(i)||!_.isEmpty(t)&&m.validate(t,"entityName").valid?_.isEmpty(s)||!_.isEmpty(n)&&m.validate(n,"entityName").valid?void 0:this.i18n("invalid_vg_name"):this.i18n("invalid_vm_name")},_restoreSnapshot:function(e){this.$(".btnUpdate").button("loading");var t=this;this.model.restoreSnapshot({vms:e.vms,vgs:e.vgs,replace:e.replaceChecked,pathPrefix:e.path,vmNamePrefix:e.vmNamePrefix,vgNamePrefix:e.vgNamePrefix,successCB:function(){t.hide()},errorCB:function(e){t.showHeaderErrorWithDescription(e,"Error restoring snapshot."),t.$(".btnUpdate").button("reset")}})},_initSnapshotCollection:function(){var e=_.template(n.LOCAL_SNAPSHOT,{pdName:this.pdName}),a=i.extend({model:s,url:e}),o=new a;return o.setFilterCriteria(t.SNAP_ID+"=="+this.snapshotId),o},onSelectEntityChecked:function(e){if(e[S.IS_CHECKED]=!0,!e[t.VM_ID])return!1;var n=!1;_.each(this.allEntities,function(i){i[S.IS_DEPENDENT]=!1;var s=i[t.VM_ID]||i[t.VG_UUID];_.contains(e[t.RELATED_ENTITY_UUIDS],s)&&(i[S.IS_AUTO_ADDED]=!0,i[S.IS_CHECKED]=!0,i[S.IS_CHECKED]=!0,n=!0)}),n&&this.showHeaderSuccess(this.i18n("auto_marked")),this.entityTable.updateDataSource(this.allEntities),this.applyNutanixInput(),this.$el.find(".auto-added").tooltip({title:this.i18n("auto_added_tooltip"),placement:"right",container:"body"})},onSelectEntityUnChecked:function(e){if(e[S.IS_CHECKED]=!1,!e[t.VM_ID])return!1;var n=[];if(e[t.RELATED_ENTITY_UUIDS]&&e[t.RELATED_ENTITY_UUIDS].length>0){n.push(e);var i=!1;_.each(this.allEntities,function(s){s[S.IS_AUTO_ADDED]=!1;var a=s[t.VM_ID]||s[t.VG_UUID];_.contains(e[t.RELATED_ENTITY_UUIDS],a)&&(s[S.IS_DEPENDENT]=!0,i=!0,n.push(s))});-1===_.pluck(n,S.IS_CHECKED).indexOf(!0)?this.clearAllRelatedEntities():i&&this.showHeaderWarning(this.i18n("related_entities")),this.entityTable.updateDataSource(this.allEntities),this.applyNutanixInput(),this.$el.find(".related-msg").tooltip({title:this.i18n("related_tooltip"),placement:"right",container:"body"})}},onSelectEntityClick:function(e){var n=this.$(e.currentTarget);if(!n.is(":checked")){this.$(".checkboxSelectAll").is(":checked")&&this.$(".checkboxSelectAll").attr("checked",!1)}var i=n.val(),s=_.find(this.allEntities,function(e){return e[t.VM_NAME]===i||e[t.VG_UUID]===i});n.is(":checked")?this.onSelectEntityChecked(s):this.onSelectEntityUnChecked(s)},clearAllRelatedEntities:function(e){this.clearHeader(),_.each(this.allEntities,function(t){t[S.IS_DEPENDENT]=!1,t[S.IS_AUTO_ADDED]=!1,t[S.IS_CHECKED]=!!e})},onSelectAllClick:function(e){var t=this.$(e.currentTarget).is(":checked");this.clearAllRelatedEntities(t),this.entityTable.updateDataSource(this.allEntities),this.applyNutanixInput(),this.$(".n-datatable-checkbox").prop("checked",t)},_isInPlaceRestore:function(){return this.$(".replace").is(":checked")},onReplaceOptionClick:function(e){var t="true"===$(e.currentTarget).val().toLowerCase();t?this.$(".restore-path").hide():this.$(".restore-path").show(),this._toggleHyperVWarning(t)},onEntityNamePrefixKeyUp:function(e){var t=$(e.currentTarget),n=t.val();if(""!==n){this.sampleEntity&&$(t).next().html("Example: "+n+this.sampleEntity);this.$(".newPath").is(":checked")||this.$(".newPath").attr("checked",!0)}else t.next().html("")},onEntityNamePrefixFocus:function(e){$(e.currentTarget).select()},_getLocalVmrecoverabilityData:function(e){return _.find(e,function(e){return""===e[t.VM_REMORE_SITE]})},populateEntities:function(e){var n=this,i=function(e,t){return e===S.IS_DEPENDENT?"<span>"+t+'  <span class="related-msg">'+f.icon("Circular_Exclamation","-inline -small")+"</span></span>":"<span>"+t+'  <span class="auto-added">'+f.icon("Link_Twisted","-inline -small")+"</span></span>"};this.entityTable=new r({el:this.$(".table-snapshotVMs"),scrollHeight:"174px",minimumRows:6,columns:[{sTitle:l.DETAILS_TABLE_CHECKBOX_SELECT_ALL,mData:t.RESTORE_ENTITY_TYPE,sWidth:"5%",bSortable:!1,mRender:function(e,i,s){if(s[t.RESTORE_ENTITY_TYPE]===d.RESTORE_ENTITY_TYPES.VG)return C({data:c.createDataRowCheckbox(s[t.VG_UUID],s[S.IS_CHECKED]||!1),className:d.RESTORE_ENTITY_TYPES.VG});var a=n._getLocalVmrecoverabilityData(s[t.VM_RECOVERABILITY]);return _.isEmpty(s[t.VM_RECOVERABILITY])||!a||a[t.VM_ERROR_CODE]===d.ERROR_NGT_NOT_INSTALLED?C({data:c.createDataRowCheckbox(s[t.VM_NAME],s[S.IS_CHECKED]||!1),className:d.RESTORE_ENTITY_TYPES.VM}):(n.hasNonRecoverableVMs=!0,"")}},{sTitle:"Entity Name",mData:t.NAME,sWidth:"70%",mRender:function(e,s,a){if(a[t.RESTORE_ENTITY_TYPE]===d.RESTORE_ENTITY_TYPES.VG)return a[S.IS_DEPENDENT]?i(S.IS_DEPENDENT,e):a[S.IS_AUTO_ADDED]?i(S.IS_AUTO_ADDED,e):e;var o=n._getLocalVmrecoverabilityData(a[t.VM_RECOVERABILITY])
;return s===d.TABLE_COL_TYPE_DISPLAY?_.isEmpty(a[t.VM_RECOVERABILITY])||!o?a[S.IS_DEPENDENT]?i(S.IS_DEPENDENT,e):a[S.IS_AUTO_ADDED]?i(S.IS_AUTO_ADDED,e):_.escape(e):o[t.VM_ERROR_CODE]===d.ERROR_NGT_NOT_INSTALLED?_.escape(e)+E({reason:o[t.VM_ERROR_REASON]}):T({data:e})+E({reason:o[t.VM_ERROR_REASON]}):e}},{sTitle:"Entity Type",mData:t.RESTORE_ENTITY_TYPE,sWidth:"25%",mRender:function(e,t,n){return d.RESTORE_ENTITY_DISPLAY_NAMES[e]}}]}),this.entityTable.render(),this.entityTable.updateDataSource(e),this.entityTable.onResize()}})}),define("text!templates/popups/welcomebanner/WelcomeBannerPopupView.html",[],function(){return'\x3c!-- The parent div modal is #popupWelcomeBanner --\x3e\n<div class="modal-header">\n  <button type="button" class="close xClose">\n    <i data-icon="K" aria-hidden="true"></i>\n  </button>\n  <h4 class="n-title">\n    Edit Welcome Banner\n    <span class="nutanixMoreInfo"\n          data-tooltip-classes="-nudge-up"\n          data-tooltip-container="body"\n          data-tooltip-placement="right"\n          data-tooltip-title="<%- tmplHelpMessage %>"></span>\n  </h4>\n  <div class="help-icon"><i aria-hidden="true" data-icon="O"></i></div>\n</div>\n\n<div class="n-modal-wrapper">\n  <div class="n-modal-body">\n    <div class="n-modal-content-wrapper">\n      \x3c!-- Header --\x3e\n      <div class="n-modal-alert-header">\n        \x3c!-- @view: alert goes here... --\x3e\n      </div>\n\n      <div class="n-modal-content">\n      <% if (!initialized) { %>\n\n        <div class="n-message">\n            Loading...\n        </div>\n\n      <% } else { %>\n        \x3c!-- Editor (Left) --\x3e\n        <div class="n-html-editor">\n          <textarea spellcheck="false" class="textareaHTMLContent\n            formControl textarea-html-content"\n            ><%= content || placeholder %></textarea>\n        </div>\n\n        \x3c!-- Editor (Right) --\x3e\n        <div class="n-html-output">\n          <%= content || \'\' %>\n        </div>\n      <% } %>\n\n      </div>\n    </div>\n  </div>\n\n  <% if (initialized) { %>\n  \x3c!-- Footer control --\x3e\n    <div class="n-modal-footer  n-modal-footer-welcome-banner">\n      <div class="n-checkbox-status-container">\n        <input\n          type="checkbox"\n          id="checkboxEnableBanner"\n          class="checkboxStatus  formControl"\n          <%= status === \'true\' ? \'checked\' : \'\' %>\n          <%= canModify ? \'\' : \'disabled\' %>\n        />\n        Enable Banner\n        <div class="n-inline-loading-container">\n          <div class="n-inline-loading" />\n        </div>\n      </div>\n\n      <% if (canModify) { %>\n        <button\n          class="btnSave btnForm btn btn-primary n-btn-form"\n          data-loading-text="Save"\n        >\n          Save\n        </button>\n        <button\n          class="btnPreview btnForm btn n-secondary-btn n-btn-form"\n          data-loading-text="Preview"\n          <%= getQaDataTestId(\'btn_preview\') %>\n        >\n          Preview\n        </button>\n      <% } %>\n    </div>\n  <% } %>\n\n</div>'}),define("views/popups/welcomebanner/WelcomeBannerPopupView",["views/basecomponents/popups/BasePopupView","models/systemdata/SystemDataModel","data/DataProperties","utils/AppConstants","utils/AppUtil","text!templates/popups/welcomebanner/WelcomeBannerPopupView.html"],function(e,t,n,i,s,a){"use strict";var o=_.template(a),r=_.escape("Only safe HTML tags are allowed (e.g. <ul>, <li>, <div>, <img>, <h1>-<h6>, etc). Inline event handlers and scripts are not allowed.");return e.extend({el:"#popupWelcomeBanner",initialized:!1,previewButtonDisabled:!0,events:{"click  .modal-header .close":"hide","click  .btnSave":"onClickSave","click  .btnPreview":"onClickPreview","change .checkboxStatus":"onChangeStatus","input  .textareaHTMLContent":"onChangeContent"},modelEvents:{"change  model":"onModelChange","error   model":"onModelError"},initialize:function(){this.model=new t({type:n.SYSTEM_DATA_TYPE_WELCOME_BANNER})},render:function(){this.$el.html(o(this.vtOptions({canModify:this.canModifyByEntityType(i.ENTITY_SYSTEM_DATA),status:this.model.getValue(n.SYSTEM_DATA_TYPE_WELCOME_BANNER_STATUS),content:s.stripInvalidTagsAndAttributes(this.model.getValue(n.SYSTEM_DATA_TYPE_WELCOME_BANNER_CONTENT)),placeholder:"Write HTML code here",initialized:this.initialized,dataProp:n,tmplHelpMessage:r}))),this.applyNutanixInput(),this.$(".nutanixMoreInfo").nutanixMoreInfo({parseDataAttrs:!0})},show:function(t){this.initialized=!1,e.prototype.show.apply(this,arguments),this.fetchWelcomeBanner()},confirmHide:function(e){var t=this.getDirtyContent(),i="Write HTML code here"!==t&&t!==this.model.getValue(n.SYSTEM_DATA_TYPE_WELCOME_BANNER_CONTENT),s=this.model.isValueSaved(n.SYSTEM_DATA_TYPE_WELCOME_BANNER_CONTENT);i||!1===s?$.nutanixConfirm({msg:"Welcome banner content has not been saved. Are you sure you want to exit?",yes:e,yesText:"Yes",noText:"No"}):e()},destroy:function(){s.debug("WelcomeBannerPopupView  | destroy | ",this.cid),this.$(".nutanixMoreInfo").nutanixMoreInfo("destroy"),e.prototype.destroy.apply(this,arguments)},onModelChange:function(e,t,n){this.hideCover(),this.enableSaveControls(),this.enableFormControls(),this.initialized=!0,this.render(),this.disablePreviewButton(!0),this.createHelpIcon()},onModelError:function(e,t,n){this.hideCover(),this.enableSaveControls(),this.enableFormControls(),this.showHeaderError(_.isObject(e)?e.responseText:e)},enableFormControls:function(){this.$(".formControl").removeAttr("disabled")},disableFormControls:function(){this.$(".formControl").attr("disabled","disabled")},showCover:function(){this.$(".n-cover").show()},hideCover:function(){this.$(".n-cover").hide()},enableSaveControls:function(){this.$(".btnSave").button("reset"),this.$(".btnPreview").button("reset")},disableSaveControls:function(){this.$(".btnSave").button("loading"),this.$(".btnPreview").button("loading")},disablePreviewButton:function(e){this.previewButtonDisabled=e,this.$(".btnPreview ").attr("disabled",e)},fetchWelcomeBanner:function(){this.model.fetch({alwaysTriggerChange:!0})},getDirtyContent:function(){return this.$(".textareaHTMLContent").val()},onChangeContent:function(){!0===this.previewButtonDisabled&&this.disablePreviewButton(!1)},onChangeStatus:function(e){var t=$(e.currentTarget);this.model.setValue(n.SYSTEM_DATA_TYPE_WELCOME_BANNER_STATUS,t.is(":checked"),{silent:!0})},onClickSave:function(){this.disableSaveControls(),this.disableFormControls(),this.model.saveWelcomeBannerStatus(this.model.getValue(n.SYSTEM_DATA_TYPE_WELCOME_BANNER_STATUS)),this.model.saveWelcomeBannerContent(this.getDirtyContent())},onClickPreview:function(){this.disableSaveControls(),this.disableFormControls(),this.model.previewWelcomeBannerContent(this.getDirtyContent()),this.createHelpIcon()}})}),define("text!templates/popups/systemdata/UISettingsPopupView.html",[],function(){return'\x3c!-- The parent div modal is #popupUiSettings --\x3e\n<div class="modal-header">\n  <button type="button" class="close xClose">\n    <i data-icon="K" aria-hidden="true"></i>\n  </button>\n  <h4 class="n-title\n    <% if (isCustomSettingsEnabled) { %> hidden-menu-open <% } %>">\n    <%= i18n(\'uiSettingsTitle\') %>\n  </h4>\n</div>\n<div class="n-modal-wrapper">\n  <div class="n-modal-body loading">\n    <div class="ui-preview-wrapper">\n      <div class="previewContainer preview-container">\n        <div class="background-preview">\n          <div class="particles-preview">\n            <%= SVG.loadSVG(SVG.PARTICLES) %>\n          </div>\n          <div class="top-preview active"></div>\n          <div class="bottom-preview"></div>\n        </div>\n        <div class="preview-content">\n          <div class="logo">\n            <span>P</span>\n            <span>r</span>\n            <span>i</span>\n            <span>s</span>\n            <span>m</span>\n          </div>\n          <div id="loginUsername2" class="login-input-container">\n            <input disabled id="inputUsername" type="text"\n              placeholder="username" autocomplete="off" class="">\n          </div>\n          <div id="loginPassword"\n            class="login-input-container login-password-submit">\n            <input disabled d="inputPassword" type="password" autocomplete="off"\n              placeholder="password" class="password-submit">\n            <label class="submit-button-wrapper">\n              <input id="btnLogin" value="Submit" class="submit"\n                autocomplete="off">\n              <div class="login-submit">\n                <%= SVG.loginSubmitArrow %>\n              </div>\n            </label>\n          </div>\n          <div class="previewName title"></div>\n        </div>\n      </div>\n    </div>\n    <div class="n-modal-content-wrapper">\n      <div class="donut-loader-blue-large"></div>\n      <div class="n-modal-content">\n        <div class="n-modal-alert-header">\n          \x3c!-- @view: alert goes here... --\x3e\n        </div>\n        <div class="customizableSettings customizable-settings group-container">\n          <span class="section-title"><%= i18n(\'loginCustomization\') %></span>\n          <div class="systemSettings system-settings section-group">\n            <div class="input-row">\n              <input id="loginVideoEnable" type="checkbox">\n              <label for="loginVideoEnable" class="input-label">\n                <%= i18n(\'lblEnableAnimation\') %>\n              </label>\n            </div>\n          </div>\n          <%= showCustomSettings %>\n        </div>\n        <div class="form-divider"></div>\n        <div class="user-settings-container group-container">\n          <span class="section-title">\n            <%= i18n(\'securitySettings\') %>\n          </span>\n          <div class="userSettings user-settings section-group">\n            \x3c!-- All the UI user settings go here --\x3e\n          </div>\n          <div class="systemSettings system-settings section-group">\n            <% if (isAdmin) { %>\n              <div class="control-group">\n                <label class="control-label" for="sessionTimeoutGlobal">\n                  <%= i18n(\'sessionTimeoutGlobal\') %>\n                </label>\n                <div class="controls" id="sessionTimeoutGlobalContainer">\n                </div>\n              </div>\n              <div class="control-group">\n                <label class="control-label" for="sessionTimeoutOverride">\n                  <%= i18n(\'sessionTimeoutOverride\') %>\n                </label>\n                <div class="controls" id="sessionTimeoutOverrideContainer">\n                </div>\n              </div>\n            <% } %>\n            <div class="input-row">\n              <%= Components.checkbox({id: \'game2048Disabled\'}) %>\n              <label for="game2048Disabled" class="input-label">\n                <%= i18n(\'disable2048\') %>\n              </label>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n  <div class="n-modal-footer">\n    <button class="btnSave btn btn-primary"\n            data-loading-text="<%= i18n(\'saving\') %>" >\n      <%= i18n(\'save\') %>\n    </button>\n  </div>\n</div>'}),define("text!templates/popups/systemdata/UISettingsPopupViewLoginCustomization.html",[],function(){return'<% if (isCustomSettingsEnabled) { %>\n  <div class="group-container section-group">\n    <div class="theme-container">\n      <span class="title">Theme</span>\n      <div class="colors-container">\n        \x3c!-- colors here --\x3e\n      </div>\n    </div>\n    <div class="edit-container">\n      <div class="editor">\n        <div class="leftPreview input-container">\n          <div class="preview"></div>\n          <input type="text" class="leftColor text-input" maxlength="7"\n            value="#3F3251" placeholder="#3F3251">\n        </div>\n      </div>\n      <div class="editor">\n        <div class="rightPreview input-container">\n          <div class="preview"></div>\n          <input type="text" class="rightColor text-input" maxlength="7"\n            value="#002025" placeholder="#002025">\n        </div>\n      </div>\n    </div>\n  </div>\n  <div class="group-container section-group">\n    <span class="title">Title Text</span>\n    <input type="text" class="productTitle" maxLength="15"\n      value="" placeholder="e.g. Prism">\n  </div>\n  <div class="group-container section-group">\n    <span class="title">Blurb Text</span>\n    <div class="input-wrapper">\n      <input type="text" class="companyName logout-time" maxLength="75"\n        value="" placeholder="e.g. Pro Edition">\n    </div>\n  </div>\n<% } %>'}),define("views/popups/systemdata/UISettingsPopupView",["views/basecomponents/popups/BasePopupView","models/systemdata/SystemDataModel","models/userdata/UserDataModel","models/userdata/UserDataCollection","data/DataProperties","managers/IdleManager","managers/AccessManager","utils/AppUtil","utils/AppConstants","utils/StyleDescriptor","events/AppEvents","text!templates/popups/systemdata/UISettingsPopupView.html","text!templates/popups/systemdata/UISettingsPopupViewLoginCustomization.html"],function(e,t,n,i,s,a,o,r,l,c,d,p,u){"use strict";var h=c.LOGIN_THEME_COLORS[0][s.STYLE_DESC_LOGIN_LEFT_COLOR],m=c.LOGIN_THEME_COLORS[0][s.STYLE_DESC_LOGIN_RIGHT_COLOR],f={leftColor:s.SYSTEM_DATA_CUST_LOGIN_COLOR_IN_KEY,rightColor:s.SYSTEM_DATA_CUST_LOGIN_COLOR_OUT_KEY,productName:s.SYSTEM_DATA_CUST_LOGIN_PRODUCT_TITLE_KEY,blurbText:s.SYSTEM_DATA_CUST_LOGIN_TITLE_KEY},v=_.template(p),g=_.template(u),E=_.template('<div class="control-group"><label class="control-label" for="sessionTimeoutUser"><%= i18n(sessionTimeoutAdmin ? "sessionTimeoutAdmin" : "sessionTimeoutUser") %></label><% if (sessionTimeoutAdmin) { %><span id="sessionTimeoutAdminTooltip"></span><% } %><div class="controls" id="sessionTimeoutUserContainer"><%= Components.select({id: "sessionTimeoutUser",disabled: sessionTimeoutFixed,options: sessionTimeoutUserOptions,useBrowserSelect: true}) %></div></div>'),T=_.template("<%= Components.select({id: id,options: options,useBrowserSelect: true}) %>"),C=_.template('<%= i18n("warningTimeoutTooLarge") %>'),S=_.template('<div class="color <%= active %>" title="<%= title %>" leftColor="<%= leftColor %>" rightColor="<%= rightColor %>" style="background-color: <%= leftColor %>;  background-image: linear-gradient(-134deg, <%= rightColor %> 0%, <%= leftColor %> 98%);"></div>'),A=_.template('<div specialColor="rainbow" class="color special <%= active %> <%= animate %>" title="Rainbow!" leftColor="rainbow" rightColor="rainbow" style="background-color: #f4a6fd;  background-image: <%= gradient %>"></div>');return e.extend({name:"UISettingsPopupView",el:"#popupUiSettings",initialized:!1,model:null,userDataCollection:null,uiSettingsModel:null,isCustomSettingsEnabled:null,isCustomSettingsUIEnabled:null,customSettings:null,lastValidSettings:{},enableSecretGradient:null,events:{"click      .modal-header .close":"hide","click      .modal-header .n-title":"onShowLoginCustomizationSettings","click      .colors-container .color":"onChangeTheme","click      .btnSave":"save","click      #loginVideoEnable":"onChangeParticles","change     #sessionTimeoutUser":"onChangeUserTimeout","change     #sessionTimeoutGlobal":"onChangeGlobalTimeout","input      .leftColor":"onChangeLeftColor","input      .rightColor":"onChangeRightColor","input      .productTitle":"onChangeProductTitle","input      .companyName":"onChangeCompanyName","keyup      .companyName":"onChangeCompanyName"},modelEvents:{"error   customLoginModel":"onModelError","error   welcomeBannerModel":"onModelError","error   uiSettingsModel":"onModelError","error   userDataCollection":"onModelError"},initialize:function(){this.welcomeBannerModel=new t({type:s.SYSTEM_DATA_TYPE_WELCOME_BANNER},{enableNotifications:!1}),this.customLoginModel=new t({type:s.SYSTEM_DATA_CUST_LOGIN_TYPE},{enableNotifications:!1}),this.uiSettingsModel=new t({type:s.SYSTEM_DATA_TYPE_UI_CONFIG},{enableNotifications:!1}),this.userDataCollection=new i({type:s.USER_DATA_TYPE_UI_CONFIG},{enableNotifications:!1})},render:function(){this.$el.html(v(this.vtOptions({isCustomSettingsEnabled:this.isCustomSettingsEnabled,showCustomSettings:g({isCustomSettingsEnabled:this.isCustomSettingsEnabled}),isAdmin:o.isClusterAdmin()}))),this.renderLoginScreenPreview(),this.isCustomSettingsEnabled&&this.renderThemeColors(),this.applyNutanixInput()},renderLoginScreenPreview:function(e){var t,n;this.isCustomSettingsEnabled?(t=this.lastValidSettings[s.STYLE_DESC_LOGIN_LEFT_COLOR],n=this.lastValidSettings[s.STYLE_DESC_LOGIN_RIGHT_COLOR],this.isCurrentThemeColor(t,n,l.ACTION_UPDATE)):(t=c.LOGIN_THEME_COLORS[0][s.STYLE_DESC_LOGIN_LEFT_COLOR],n=c.LOGIN_THEME_COLORS[0][s.STYLE_DESC_LOGIN_RIGHT_COLOR]),this._updateGradientPreview(t,n,e)},_updateGradientPreview:function(e,t,n){var i="",a="";if(i=this.$(".top-preview.active").length?this.$(".top-preview").css("background-image"):this.$(".bottom-preview").css("background-image"),this.isCustomSettingsEnabled&&n&&this.enableSecretGradient&&n===this.enableSecretGradient||this.isCustomSettingsEnabled&&"rainbow"===this.customSettings[s.SYSTEM_DATA_CUST_LOGIN_COLOR_IN_KEY]&&"rainbow"===e&&"rainbow"===t)if(a=c.RAINBOW_GRADIENT,0===this.$(".colors-container .special").length){var o=A({gradient:a,active:"active",animate:"animate"});this.$(".colors-container .color").removeClass("active"),this.$(".colors-container").append(o),this.$(".input-wrapper").addClass("animate");var l=this.$(".leftPreview");l.find(".text-input").val(""),this.validateColorInput(l,this.enableSecretGradient,s.STYLE_DESC_LOGIN_LEFT_COLOR);var d=this.$(".rightPreview");d.find(".text-input").val(""),this.validateColorInput(d,this.enableSecretGradient,s.STYLE_DESC_LOGIN_RIGHT_COLOR),r.onAnimationEnd(this.$(".input-wrapper"),function(e){e.removeClass("animate")})}else this.$(".colors-container .color.special").addClass("active");else a="linear-gradient(-134deg, "+t+" 0%, "+e+" 98%)";this.updateLogoStyle(),this.$(".top-preview.active").length?(this.$(".top-preview").css({"background-image":i}).toggleClass("active"),this.$(".bottom-preview").css({"background-image":a})):(this.$(".top-preview").css({"background-image":a}).toggleClass("active"),this.$(".bottom-preview").css({"background-image":i}))},isLogoDefault:function(){var e=this.lastValidSettings.leftColor===h&&this.lastValidSettings.rightColor===m,t=""===this.$(".productTitle").val();return!this.isCustomSettingsEnabled||e&&t},_renderCustomLoginSettings:function(){this.$(".customizableSettings").append(g({isCustomSettingsEnabled:this.isCustomSettingsEnabled})),this.renderThemeColors()},renderThemeColors:function(){var e=c.LOGIN_THEME_COLORS,t="",n="";if(this.enableSecretGradient)n="Rainbow!";else if(this.customSettings&&this.customSettings[s.SYSTEM_DATA_CUST_LOGIN_COLOR_IN_KEY]&&this.customSettings[s.SYSTEM_DATA_CUST_LOGIN_COLOR_OUT_KEY]){var i=this.isCurrentThemeColor(this.customSettings[s.SYSTEM_DATA_CUST_LOGIN_COLOR_IN_KEY],this.customSettings[s.SYSTEM_DATA_CUST_LOGIN_COLOR_OUT_KEY]);i&&(n=i)}else n=c.LOGIN_THEME_COLORS[0][s.STYLE_DESC_LOGIN_NAME];_.each(e,function(e){var i="";e[s.STYLE_DESC_LOGIN_NAME]===n&&(i="active"),t+=S({title:e[s.STYLE_DESC_LOGIN_NAME],leftColor:e[s.STYLE_DESC_LOGIN_LEFT_COLOR],rightColor:e[s.STYLE_DESC_LOGIN_RIGHT_COLOR],active:i})}),this.enableSecretGradient&&(t+=A({gradient:c.RAINBOW_GRADIENT,active:"active",animate:""})),this.$(".colors-container").html(t),this.changeTheme(this.$('.colors-container .color[title="'+n+'"]'))},changeTheme:function(e){var t=e.attr("leftcolor"),n=e.attr("rightcolor"),i=e.attr("specialcolor"),a=null;i===this.enableSecretGradient?(a=i,this.$(".leftColor").val(""),this.$(".rightColor").val("")):(this.$(".leftColor").val(t),this.$(".rightColor").val(n)),this.validateColorInput(this.$(".leftPreview"),a,s.STYLE_DESC_LOGIN_LEFT_COLOR),this.validateColorInput(this.$(".rightPreview"),a,s.STYLE_DESC_LOGIN_RIGHT_COLOR),this.renderLoginScreenPreview(a)},show:function(t){this.initialized=!1,e.prototype.show.apply(this,arguments);var n=[this.customLoginModel.fetch({alwaysTriggerChange:!0,error:function(){r.log("Custom Login : no data")}}),this.welcomeBannerModel.fetch({alwaysTriggerChange:!0}),this.uiSettingsModel.fetch({alwaysTriggerChange:!0}),this.userDataCollection.fetch({alwaysTriggerChange:!0})],i=this;$.whenAll.apply($,n).done(function(){i.renderDataChange()})},save:function(){var e=this,t=[];if(this.isCustomSettingsUIEnabled&&this.isCustomSettingsEnabled){var n=this.lastValidSettings[s.STYLE_DESC_LOGIN_LEFT_COLOR],i=this.lastValidSettings[s.STYLE_DESC_LOGIN_RIGHT_COLOR],a=this.$(".companyName").val(),l=this.$(".productTitle").val(),p=this.customLoginModel.getCustomizedLoginSettings(),u=p[f.leftColor]?n!==p[f.leftColor]:n!==h,v=p[f.rightColor]?i!==p[f.rightColor]:i!==m,g=p[f.productName]?l.trim()!==p[f.productName].trim():""!==l.trim(),E=p[f.blurbText]?a.trim()!==p[f.blurbText].trim():""!==a.trim();(u||v||g||E)&&(""===l&&(l=" "),""===a&&(a=" "),"rainbow"===n&&"rainbow"!==i?n=c.LOGIN_THEME_COLORS[0][s.STYLE_DESC_LOGIN_LEFT_COLOR]:"rainbow"!==n&&"rainbow"===i&&(i=c.LOGIN_THEME_COLORS[0][s.STYLE_DESC_LOGIN_RIGHT_COLOR]),l=_.escape(l),a=_.escape(a),t.push(this.customLoginModel.saveCustomizeLogin(n,i,l,a)))}this.$("#loginVideoEnable").prop("checked")===this.welcomeBannerModel.isVideoDisabled()&&t.push(this._saveVideoStatus()),this.$("#game2048Disabled").prop("checked")!==this.uiSettingsModel.is2048Disabled()&&t.push(this._save2048Status());var T=r.getEffectiveSessionTimeoutSettings({userTimeout:this.userDataCollection.getAutoLogoutTime(),globalTimeout:this.uiSettingsModel.getGlobalSessionTimeout(),overrideTimeout:this.uiSettingsModel.getOverrideSessionTimeout()},o.isClusterAdmin()),C=this.$("#sessionTimeoutUser").val();C!==T.userTimeout&&t.push(this._saveUserTimeout(r.minutesToMilliseconds(C),this.userDataCollection.getAutoLogoutTime()));var S=this.$("#sessionTimeoutGlobal").val();o.isClusterAdmin()&&S!==T.globalTimeout&&t.push(this._saveGlobalTimeout());var A=this.$("#sessionTimeoutOverride").val();o.isClusterAdmin()&&A!==T.overrideTimeout&&t.push(this._saveOverrideTimeout()),t.length>0&&$.when.apply($,t).done(function(){d.triggerAppEvent(d.REFRESH_USER_MENU),e.showHeaderSuccess(e.i18n("saveSuccessMsg"))})},_saveVideoStatus:function(){return this.welcomeBannerModel.saveDisableVideoStatus(!this.$("#loginVideoEnable").prop("checked"))},_save2048Status:function(){return this.uiSettingsModel.saveDisable2048Status(this.$("#game2048Disabled").prop("checked"))},_saveUserTimeout:function(e,t){var i=this.userDataCollection.getAutoLogoutTimeModel();i?i.isNew(!1):i=new n({type:s.USER_DATA_TYPE_UI_CONFIG,key:s.UI_CONFIG_AUTO_LOGOUT_TIME});var o=this;return i.save({value:e},{success:function(t){a.setAutoLogoutTime(Number(e)),o.userDataCollection.fetch()},error:function(e,n,i){e.set(s.USER_DATA_VALUE,t),e.trigger("error",e,n,i)}})},_saveGlobalTimeout:function(){var e=Number(this.$("#sessionTimeoutGlobal").val());return this.uiSettingsModel.saveGlobalSessionTimeout(r.minutesToMilliseconds(e))},_saveOverrideTimeout:function(){var e=Number(this.$("#sessionTimeoutOverride").val());return this.uiSettingsModel.saveOverrideSessionTimeout(-1===e?-1:r.minutesToMilliseconds(e))},destroy:function(){r.debug("UISettingsPopupView  | destroy | ",this.cid),e.prototype.destroy.apply(this,arguments)},_getSessionTimeoutUserOptions:function(){var e,t=r.getEffectiveSessionTimeoutSettings({userTimeout:this.userDataCollection.getAutoLogoutTime(),globalTimeout:this.uiSettingsModel.getGlobalSessionTimeout(),overrideTimeout:this.uiSettingsModel.getOverrideSessionTimeout()},o.isClusterAdmin()),n=t.userTimeout;o.isClusterAdmin()?e=_.map(_.filter(r.getTimeoutOptions(),function(e){return e<=l.ADMIN_MAX_LOGOUT_TIME_MINUTES}),function(e){return{name:this._getTimeoutReadableValue(e),value:e,selected:e===n}},this):-1===t.overrideTimeout?e=[{name:this._getTimeoutReadableValue(n),value:n,selected:!0}]:(e=_.map(_.filter(r.getTimeoutOptions(),function(e){return e<=t.overrideTimeout||0===t.overrideTimeout}),function(e){return{name:this._getTimeoutReadableValue(e),value:e,selected:e===n}},this),0===t.overrideTimeout&&e.push({name:this.i18n("sessionTimeoutNever"),value:"0",selected:0===n}));var i=!o.isClusterAdmin()&&-1===t.overrideTimeout;return{sessionTimeoutAdmin:o.isClusterAdmin(),sessionTimeoutFixed:i,sessionTimeoutUserOptions:e}},_getSessionTimeoutGlobalOptions:function(){var e=r.getEffectiveSessionTimeoutSettings({userTimeout:this.userDataCollection.getAutoLogoutTime(),globalTimeout:this.uiSettingsModel.getGlobalSessionTimeout(),overrideTimeout:this.uiSettingsModel.getOverrideSessionTimeout()},o.isClusterAdmin()),t=e.globalTimeout,n=_.map(r.getTimeoutOptions(),function(e){return{name:this._getTimeoutReadableValue(e),value:e,selected:e===t}},this);return n.push({name:this.i18n("sessionTimeoutNever"),value:"0",selected:0===t}),{id:"sessionTimeoutGlobal",options:n}},_getSessionTimeoutOverrideOptions:function(e){var t=r.getEffectiveSessionTimeoutSettings({userTimeout:this.userDataCollection.getAutoLogoutTime(),globalTimeout:r.minutesToMilliseconds(this.$("#sessionTimeoutGlobal").val()),overrideTimeout:void 0===e?this.uiSettingsModel.getOverrideSessionTimeout():e<=0?e:r.minutesToMilliseconds(e)},o.isClusterAdmin()),n=t.overrideTimeout,i=t.globalTimeout,s=[{name:this.i18n("sessionTimeoutDenyOverride"),value:"-1",selected:-1===n}];if(0===i)s.push({name:this.i18n("sessionTimeoutAllowOverride"),value:"0",selected:0===n});else{var a=r.getTimeoutOptions();s=s.concat(_.map(_.filter(a,function(e){return e!==_.min(a)&&i<=e}),function(e){return{name:this.i18n("sessionTimeoutMax")+" "+this._getTimeoutReadableValue(e),value:e,selected:e===n}},this)),s.push({name:this.i18n("sessionTimeoutAllowUnlimited"),value:"0",selected:0===n})}return{id:"sessionTimeoutOverride",options:s}},_renderSessionTimeoutUserField:function(){var e=this._getSessionTimeoutUserOptions();this.$(".userSettings").html(E(this.vtOptions(e))),this.$("#sessionTimeoutAdminTooltip").nutanixMoreInfo({title:this.i18n("sessionTimeoutAdminTooltip"),iconTmpl:'<svg viewBox="0 792 2048 2048"  class="svg-icon -text <%= className %> -id-<%= icon %>"  <%= attributes %>>  <use xmlns:xlink="http://www.w3.org/1999/xlink"      xlink:href="#<%= icon %>">  </use></svg>',placement:"top",container:"body"}),e.sessionTimeoutFixed&&this.$("#sessionTimeoutUserContainer").tooltip({title:this.i18n("sessionTimeoutUserFixed"),placement:"bottom",container:"body"})},_renderSessionTimeoutGlobalField:function(){if(o.isClusterAdmin()){var e=this._getSessionTimeoutGlobalOptions();this.$("#sessionTimeoutGlobalContainer").html(T(this.vtOptions(e)))}},_renderSessionTimeoutOverrideField:function(e){if(o.isClusterAdmin()){var t=this._getSessionTimeoutOverrideOptions(e);this.$("#sessionTimeoutOverrideContainer").html(T(this.vtOptions(t)))}},_getTimeoutReadableValue:function(e){if((e=Number(e))<60)return r.pluralize(this.name,"sessionTimeoutInMinutes","Never","1 minute","%d minutes",e);return r.pluralize(this.name,"sessionTimeoutInHours","0 hour","1 hour","%d hours",Math.floor(e/60))},renderDataChange:function(){this.$("#loginVideoEnable").prop("checked",!this.welcomeBannerModel.isVideoDisabled()),this.$("#game2048Disabled").prop("checked",this.uiSettingsModel.is2048Disabled()),o.isClusterAdmin()||(this.$("#loginVideoEnable").prop("disabled",!0),this.$("#game2048Disabled").prop("disabled",!0)),this.$("#loginVideoEnable").prop("checked")?this.$(".particles-preview").addClass("particles-enabled"):this.$(".particles-preview").removeClass("particles-enabled"),this._renderSessionTimeoutUserField(),o.isClusterAdmin()&&(this._renderSessionTimeoutGlobalField(),this._renderSessionTimeoutOverrideField()),this.customSettings=this.customLoginModel.getCustomizedLoginSettings();var e=null;if(!_.isEmpty(this.customSettings)&&!0!==this.isCustomSettingsEnabled){var t=!this.customSettings[f.leftColor]||this.customSettings[f.leftColor]===h,n=!this.customSettings[f.rightColor]||this.customSettings[f.rightColor]===m,i=!this.customSettings[f.productName]||0===this.customSettings[f.productName].trim().length,a=!this.customSettings[f.blurbText]||0===this.customSettings[f.blurbText].trim().length;t&&n&&i&&a||(this.isCustomSettingsEnabled=!0,"rainbow"===this.customSettings[s.SYSTEM_DATA_CUST_LOGIN_COLOR_IN_KEY]&&(this.enableSecretGradient="rainbow"),this.enableSecretGradient&&(e=this.enableSecretGradient),this.isCustomSettingsUIEnabled&&this._renderCustomLoginSettings())}this.isCustomSettingsEnabled&&this.customSettings&&this._renderCustomLoginUI(e),this.$(".n-modal-body").removeClass("loading")},_renderCustomLoginUI:function(e){e=e||null;var t="",n="";e&&this.enableSecretGradient&&e===this.enableSecretGradient||"rainbow"===this.customSettings[s.SYSTEM_DATA_CUST_LOGIN_COLOR_IN_KEY]||(t=this.customSettings[s.SYSTEM_DATA_CUST_LOGIN_COLOR_IN_KEY],n=this.customSettings[s.SYSTEM_DATA_CUST_LOGIN_COLOR_OUT_KEY]);var i=this.$(".leftPreview"),a=this.$(".rightPreview");"rainbow"===this.lastValidSettings[s.STYLE_DESC_LOGIN_LEFT_COLOR]&&this.lastValidSettings[s.STYLE_DESC_LOGIN_RIGHT_COLOR]&&(e="rainbow"),this.$(".leftColor").val(t),this.$(".rightColor").val(n),this.lastValidSettings[s.STYLE_DESC_LOGIN_LEFT_COLOR]=t,this.lastValidSettings[s.STYLE_DESC_LOGIN_RIGHT_COLOR]=n;var o=this.customSettings[f.productName]||"",r=this.customSettings[f.blurbText]||"";this.$(".previewName").text(r.trim()),this.$(".companyName").val(r.trim()),this.$(".productTitle").val(o.trim());var l=this.renderLogo(o.trim());this.$(".previewContainer .preview-content > .logo").html(l),this.validateColorInput(i,e,s.STYLE_DESC_LOGIN_LEFT_COLOR),this.validateColorInput(a,e,s.STYLE_DESC_LOGIN_RIGHT_COLOR),this.renderLoginScreenPreview(e),this.isCurrentThemeColor(t,n)},onModelError:function(e,t){e.get?this.showHeaderError(this.i18ns("errorServerMsg",e.name,t.responseText)):this.showHeaderError(e)},onChangeGlobalTimeout:function(e){this._renderSessionTimeoutOverrideField(Number(this.$("#sessionTimeoutOverride").val())),Number(this.$("#sessionTimeoutGlobal").val())>15&&this.showHeaderWarning(C(this.vtOptions()))},onChangeUserTimeout:function(e){Number(this.$("#sessionTimeoutUser").val())>15&&this.showHeaderWarning(C(this.vtOptions()))},onChangeParticles:function(e){this.$(".particles-preview").toggleClass("particles-enabled")},onShowLoginCustomizationSettings:function(e){!this.isCustomSettingsUIEnabled&&e.altKey&&(this.isCustomSettingsUIEnabled=!0,this.isCustomSettingsEnabled=!0,this._renderCustomLoginSettings(),_.isEmpty(this.customSettings)||this._renderCustomLoginUI())},onChangeTheme:function(e){this.changeTheme($(e.target))},onChangeLeftColor:function(){this._changeColor(this.$(".leftPreview"),null,s.STYLE_DESC_LOGIN_LEFT_COLOR)},onChangeRightColor:function(){this._changeColor(this.$(".rightPreview"),null,s.STYLE_DESC_LOGIN_RIGHT_COLOR)},_changeColor:function(e,t,n){this.validateColorInput(e,t,n)&&this.renderLoginScreenPreview()},onChangeProductTitle:function(e){var t=this.$(".productTitle").val().trim();t=_.escape(t);var n=this.renderLogo(t),i=this.$(".previewContainer .preview-content > .logo");t.length>12?i.addClass("small"):i.removeClass("small"),i.html(n)},onChangeCompanyName:function(e){var t=this.$(".companyName").val();t=_.escape(t),this._checkEasterEgg(e,t),this.$(".previewName").text(t)},_checkEasterEgg:function(e,t){t.toUpperCase().indexOf("I LOVE UNICORNS!")>-1&&13===e.keyCode&&0===this.$(".colors-container .special").length&&(this.enableSecretGradient="rainbow",this._updateGradientPreview(null,null,this.enableSecretGradient))},updateLogoStyle:function(){this.isLogoDefault()?this.$(".previewContainer .logo").removeClass("custom"):this.$(".previewContainer .logo").addClass("custom")},renderLogo:function(e){return this.updateLogoStyle(),r.renderAppLogo(e)},isCurrentThemeColor:function(e,t,n){var i=c.LOGIN_THEME_COLORS
;if(!0!==this.isCustomSettingsEnabled)return n===l.ACTION_UPDATE&&(this.$(".colors-container .color").removeClass("active"),this.$('.color[leftColor="'+c.LOGIN_THEME_COLORS[0][s.STYLE_DESC_LOGIN_LEFT_COLOR]+'"][rightColor="'+c.LOGIN_THEME_COLORS[0][s.STYLE_DESC_LOGIN_RIGHT_COLOR]+'"]').addClass("active")),!0;if(this.isCustomSettingsEnabled&&this.enableSecretGradient&&"rainbow"===e&&"rainbow"===t)return n===l.ACTION_UPDATE&&(this.$(".colors-container .color").removeClass("active"),this.$('.color[leftColor="rainbow"][rightColor="rainbow"]').addClass("active")),!0;if(this.isCustomSettingsEnabled){var a=_.filter(i,function(t){return t.leftColor===e});if(a&&a.length){var o=_.filter(a,function(e){return e.rightColor===t});return o&&1===o.length?(n===l.ACTION_UPDATE&&(this.$(".colors-container .color").removeClass("active"),this.$('.color[leftColor="'+o[0].leftColor+'"][rightColor="'+o[0].rightColor+'"]').addClass("active")),o[0][s.STYLE_DESC_LOGIN_NAME]):this._isCurrentThemeFail(n)}return this._isCurrentThemeFail(n)}return this._isCurrentThemeFail(n)},_isCurrentThemeFail:function(e){return e===l.ACTION_UPDATE&&this.$(".colors-container .color").removeClass("active"),!1},validateColorInput:function(e,t,n){var i=e.find(".text-input"),s=e.find(".preview"),a=i.val(),o="";if(!t||!this.enableSecretGradient||t!==this.enableSecretGradient){if(a){var r=this.validateColor(a,{el:i,action:"updateInput"});return r?("#FFF"!==r.toUpperCase()&&"#FFFFFF"!==r.toUpperCase()&&(o=r),e.removeClass("error"),this.lastValidSettings[n]=r,s.css({"background-color":r,"border-color":o}),!0):(s.css({"background-color":"","border-color":""}),e.addClass("error"),!1)}return!1}a="#ffffff",o="#ffffff",e.removeClass("error"),this.lastValidSettings[n]="rainbow",s.css({"background-color":a,"border-color":o})},validateColor:function(e,t){return"#"!==e.substring(0,1)&&(e="#"+e,e=e.substring(0,7),t&&t.el&&"updateInput"===t.action&&t.el.val(e)),!!/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(e)&&e}})}),define("text!templates/popups/language_settings/UILanguageSettingsContentView.html",[],function(){return"\x3c!-- The parent div modal is #popupLanguageSettings --\x3e\n<div data-ntnx-content-inner>\n  <form>\n    <section data-ntnx-section class=\"languageListContainer\">\n      <label data-ntnx-label for=\"languageList\"><%= i18n('language') %></label>\n      <%= Components.select({\n        id: 'languageListSelect',\n        jsClasses : 'languageList',\n        classes : 'fancy-select-top-anchor',\n        options : locales,\n        disabled : disabled\n      }) %>\n    </section>\n    <section data-ntnx-section>\n      <label data-ntnx-label for=\"regionList\"><%= i18n('region') %></label>\n      <%= Components.select({\n        id: 'regionListSelect',\n        jsClasses : 'regionList',\n        classes : 'fancy-select-top-anchor regionListContainer',\n        options : regions,\n        disabled : disabled\n      }) %>\n    </section>\n    <section data-ntnx-section>\n      <table class=\"table readonly-table\">\n        <tr>\n          <th><%= i18n('long_time') %></th>\n          <td class=\"sample long-time\"><%= long_time %></td>\n        </tr>\n        <tr>\n          <th><%= i18n('short_time') %></th>\n          <td class=\"sample short-time\"><%= short_time %></td>\n        </tr>\n        <tr>\n          <th><%= i18n('number') %></th>\n          <td class=\"sample sample-number\"><%= number %></td>\n        </tr>\n      </table>\n    </section>\n  </form>\n</div>"}),define("views/popups/language_settings/LanguageSettingsPopupView",["views/basecomponents/popups/BasePopupView","models/UpdateProfileModel","managers/NamespaceManager","managers/I18nManager","managers/PrismElementManager","utils/TimeUtil","utils/I18NUtil","utils/AppConstants","text!templates/popups/language_settings/UILanguageSettingsContentView.html"],function(e,t,n,i,s,a,o,r,l){"use strict";l=_.template(l);var c=new Date("2015-12-23");return e.extend({el:"#popupLanguageSettings",name:"LanguageSettingsPopupView",model:null,events:{"click  .btnCancel":"discardChanges","click  .btnSave":"onSaveClick","change .languageList":"onLanguageChange","change .regionList":"onRegionChange","click  .trigger":"onLanguageSelectOpen"},initialize:function(){this.model=new t,this.profile=n.get(n.USER_DETAILS_V1).profile,e.prototype.initialize.apply(this,arguments)},render:function(){var e=[],t=r.I18N_LOCALES,n=this.profile[this.model.DP.LOCALE]||i.DEFAULT_LOCALE,d=r.I18N_LOCALE_DESCRIPTIONS,p=[],u=r.I18N_REGION_MAPPING,h=this.profile[this.model.DP.REGION]||i.DEFAULT_REGION;t["ps-QA"]="ps-QA";for(var m in t)d.hasOwnProperty(m)&&e.push({value:m,name:d[m],selected:m===n,disabled:"ps-QA"===m});for(var f in u)p.push({value:f,name:u[f],selected:f===h});var v=s.isLoadedFromPrismCentral(),g=[{text:this.i18n("discard_changes"),extraClasses:"btnCancel"}];v||g.push({isPrimary:!0,text:this.i18n("save"),extraClasses:"btnSave"}),this.$el.html(this.defaultTemplate({title:this.i18n("languageSettings"),antiscroll:!1,bodyContent:l(this.vtOptions({locales:e,user_locale:this.profile[this.model.DP.LOCALE]||i.DEFAULT_LOCALE,regions:p,time:a.formatFullDateTime(Date.now()),long_time:a.formatFullDateTime(c),short_time:a.formatDateTime(c),number:o.formatNumber(1234567.89),disabled:v})),footerButtons:this.defaultFooter(g)})),v&&this.$(".languageListContainer").tooltip({title:this.i18n("language_change_tooltip"),trigger:"hover",placement:"top",container:"body"})},showConfirmDialog:function(){$.nutanixConfirm({msg:this.i18n("change_warning"),yes:function(){location.reload()},no:function(){},yesText:this.i18n("yes"),noText:this.i18n("no"),context:this})},onLanguageChange:function(){var e=this.$(".languageList").val();this.$(".regionList").val(e).trigger("change")},onRegionChange:function(){var e=this.$(".regionList").val();_.contains(r.I18N_REGION_WRITE_FROM_RIGHT,e)?this.$(".sample").addClass("right"):this.$(".sample").removeClass("right"),this.$(".long-time").html(a.formatFullDateTime(c,null,e)),this.$(".short-time").html(a.formatDateTime(c,null,e)),this.$(".sample-number").html(o.formatNumber(1234567.89,e))},onLanguageSelectOpen:function(e){e.shiftKey?$('.languageList.fancified option[value="ps-QA"]').removeAttr("disabled"):$('.languageList.fancified option[value="ps-QA"]').attr("disabled","disabled"),$(".languageList.fancified").trigger("update")},onSaveClick:function(){var e=this,t=this.model.DP;this.profile[t.FIRSTNAME]=this.profile[t.FIRSTNAME]||null,this.profile[t.LASTNAME]=this.profile[t.LASTNAME]||null,this.profile[t.MIDDLEINITIAL]=this.profile[t.MIDDLEINITIAL]||null,this.profile[t.EMAILID]=this.profile[t.EMAILID]||null,this.model.set(this.profile),this.model.set(t.LOCALE,this.$(".languageList").val()),this.model.set(t.REGION,this.$(".regionList").val()),this.$(".btnSave").button("loading"),this.model.save(null,{success:function(n,i){e.$(".btnSave").button("reset"),e.profile[t.LOCALE]=e.model.get(t.LOCALE),e.showConfirmDialog()},error:function(t,n){e.$(".btnSave").button("reset"),e.showHeaderError(e.i18n("preference_error"))}})}})}),define("text!templates/popups/asup/AutoSupportContentView.html",[],function(){return'\x3c!-- The parent div modal is #popupAutoSupport --\x3e\n<div data-ntnx-content-inner class="autoSupportFormContainer">\n  <section data-ntnx-section="type-text">\n    <%= i18n(\'pulse_intro\') %>\n    <a class="learn-more"><%= i18n(\'learn_more\') %> </a>\n  </section>\n  <form id="autoSupportForm"></form>\n</div>\n'}),define("text!templates/popups/asup/AutoSupportFormView.html",[],function(){return'<% var sDisabled = canModify ? \'\' : \'disabled\' ; %>\n\n<section data-ntnx-section="type-separator" class="n-enable">\n  <div data-ntnx-form-inline>\n    <%= Components.checkbox({\n      id: \'auto-support-enable\',\n      jsClasses: \'enable\',\n      disabled: sDisabled,\n      value: model.enable,\n      labelText: i18n(\'enable\')\n    }) %>\n  </div>\n   <div data-ntnx-form-inline class="info-checkbox">\n    <%= Components.checkbox({\n      jsClasses: \'infoScrubbing\',\n      disabled: sDisabled,\n      value: scrubbingEnabled,\n      labelText: i18n(\'info_scrubbing\')\n    }) %>\n  </div>\n  <p class="info-scrubbing-desc"><%= i18n(\'info_scrubbing_desc\') %></p>\n</section>\n<% if (connectionStatus) { %>\n<section data-ntnx-section>\n  <table class="table">\n    <thead>\n      <tr>\n        <th><%= i18n(\'pulse_conn_status\') %></th>\n        <th><%= i18n(\'state\') %></th>\n      </tr>\n    </thead>\n    <tbody class="n-connection">\n      <tr>\n        <td><%= i18n(\'status_text\') %></td>\n        <td>\n          <%= connectionStatus %>\n          <span class="nutanixMoreInfo"\n            data-tooltip-classes="-nudge-down"\n            data-tooltip-container="body"\n            data-tooltip-title="<%= failureReason %>">\n          </span>\n        </td>\n      </tr>\n      <tr>\n        <td><%= i18n(\'last_checked_time\') %></td>\n        <td>\n          <%= lastCheckedTime %>\n        </td>\n      </tr>\n    </tbody>\n  </table>\n</section>\n<% } %>\n<section class="additionalInfoContent hide">\n  \x3c!-- Holder for displaying connection status --\x3e\n  <section data-ntnx-section class="connectionGroup\n    <%= showEmailStatus ? \'\' : \'hidden\' %>">\n    <table class="table">\n      <thead>\n        <tr>\n          <th><%= i18n(\'email_status\') %></th>\n          <th><%= i18n(\'state\') %></th>\n        </tr>\n      </thead>\n      \x3c!-- Container of view rendered from ConfigurationServicesView --\x3e\n      <tbody class="n-connection">\n      </tbody>\n    </table>\n  </section>\n  <section data-ntnx-section="type-separator">\n    <label data-ntnx-label>\n      <%= i18n(\'email_recipients\') %>\n    </label>\n    <div data-ntnx-form-inline class="n-checkbox-label">\n      <%= Components.checkbox({\n        id: \'auto-support-default-email\',\n        jsClasses: \'defaultEmail\',\n        disabled: sDisabled,\n        value: model.enableDefaultNutanixEmail\n      }) %>\n      <label data-ntnx-inline-label for="auto-support-default-email">\n        <%= i18ns(\'nutanix_support\', model.defaultNutanixEmail) %>\n      </label>\n    </div>\n  </section>\n  <section data-ntnx-section>\n    <label data-ntnx-label>\n      <%= i18n(\'email_list\') %>\n    </label>\n    <input model-validate="email" type="text" class="emailContacts"\n      placeholder="Additional email recipients" <%= sDisabled %>\n      value="<%=model.emailContacts%>"/>\n  </section>\n</section>\n'}),define("views/popups/asup/AutoSupportPopupView",["backbone","views/basecomponents/popups/BasePopupView","views/utils/ConfigurationServicesView","components/Components","models/BaseModel","data/DataProperties","data/DataURLConstants","data/DataManager","managers/ActionManager","managers/NavigationManager","utils/AppConstants","utils/AppUtil","utils/TimeUtil","utils/ValidationUtil","text!templates/popups/asup/AutoSupportContentView.html","text!templates/popups/asup/AutoSupportFormView.html"],function(e,t,n,i,s,a,o,r,l,c,d,p,u,h,m,f){"use strict";m=_.template(m),f=_.template(f);var v={ALL:"ALL",PARTIAL:"PARTIAL"},g=s.extend({idAttribute:a.ASUP_METADATA_ID,urlRoot:o.AUTOSUPPORT,entityType:d.ENTITY_ENABLE_PULSE,defaults:{emailContactList:[],enable:!1,identificationInfoScrubbingLevel:v.ALL,verbosityType:"",enableDefaultNutanixEmail:!1,defaultNutanixEmail:""},sync:function(t,n,i){return i=this.parseOptions(t,n,i),i.url="read"===t?r.getDataSourceURL()+o.AUTOSUPPORT:r.getFormattedURL(o.AUTOSUPPORT),p.log("AutoSupportModel : \n\t method: "+t+"\n\t data  : "+i.url),e.sync(t,n,i)}});return t.extend({name:"AutoSupportPopupView",model:null,configuration:null,devMode:!1,isAdditionalInfoShown:!1,initialRendering:!0,el:"#popupAutoSupport",events:{"click  .modal-header .close":"hide","click  .btnSave":"onSave","keypress input":"onKeyPress","click .enable":"onClickEnable","click .additional-info":"onClickAdditionalInfo","click .learn-more":"onClickLearnMore","click .linkAuth":"onClickShowSMTP","dblclick .verbosity":"onDoubleClickVerbosityLabel"},initialize:function(){var e=this;t.prototype.initialize.apply(this,arguments),this.model=new g,this.model.on("error",function(t,n){e.$(".btnSave").button("reset"),e.triggerAction(d.MODAL.ACT.ALERT_SHOW,{type:d.MODAL.ALERT.TYPE_ERROR,message:n})})},render:function(){var e=this;this.canModify=this.canModifyByEntityType(d.ENTITY_REMOTE_SUPPORT);var t=void 0;t=this.canModify?[{text:this.i18n("additional_info"),extraClasses:"additional-info",leftAligned:!0},{isPrimary:!0,text:this.i18n("save"),extraClasses:"btnSave",extraAttr:[{key:"title",value:"Click to Save"},{key:"data-loading-text",value:"Saving..."}]}]:[{text:this.i18n("close"),extraClasses:"btnCancel"}],this.$el.html(this.defaultTemplate({title:this.i18n("pulse"),antiscroll:!1,bodyContent:m(this.vtOptions()),footerButtons:this.defaultFooter(t)})),this.triggerActions([[d.MODAL.ACT.ALERT_SHOW,{type:d.MODAL.ALERT.TYPE_LOADING}],d.MODAL.ACT.COVER_SHOW]),this.model.fetch({silent:!0,success:function(){e.triggerAction(d.MODAL.ACT.COVER_HIDE),e._renderOnDataChanged()},error:function(t,n){e.triggerActions([d.MODAL.ACT.COVER_HIDE,[d.MODAL.ACT.ALERT_SHOW,{type:d.MODAL.ALERT.TYPE_ERROR,message:n.responseText}]])}})},_renderOnDataChanged:function(){var e=[{value:"BASIC",name:"Basic"},{value:"BASIC_COREDUMP",name:"Basic With Coredump"}];(this.devMode||"NOTHING"===this.model.get(a.ASUP_VERBOSITY_TYPE))&&e.push({value:"NOTHING",name:"Basic but Send Nothing"});var t=this.model.get(a.ASUP_CONNECTION_STATUS)||{},s=void 0;t&&(s=u.formatDateTime(t.lastCheckedTimeStampUsecs/d.MICROS_PER_MILLI));var o=!this.clusterManager.isMulticlusterUI();this.$("#autoSupportForm").html(f(this.vtOptions({model:this.model.toJSON(),scrubbingEnabled:this.model.get(a.ASUP_SCRUB_LEVEL),Components:i,verbosityOptions:e,canModify:this.canModify,connectionStatus:t.status,lastCheckedTime:s,failureReason:t.message&&t.message.message,showVerbosity:o,showEmailStatus:o}))),this.model.get(a.ASUP_VERBOSITY_TYPE)&&this.$(".verbosity").val(this.model.get(a.ASUP_VERBOSITY_TYPE).toUpperCase()).attr("selected",!0),this.model.get(a.ASUP_EMAIL_CONTACT_LIST)&&this.$(".emailContacts").val(this.model.get(a.ASUP_EMAIL_CONTACT_LIST)),this.model.get(a.ASUP_SCRUB_LEVEL)===v.PARTIAL&&this.$(".infoScrubbing").prop("checked",!0),this.model.get(a.ASUP_METADATA_ID)?(this.$(".enable").prop("checked",!0),this.$(".infoScrubbing").prop("disabled",!1)):this.$(".infoScrubbing").prop("disabled",!0),this.model.get(a.ASUP_DEFAULT_EMAIL)&&this.$(".defaultEmail").prop("checked",!0),this.configuration&&this.configuration.destroy(),this.configuration=new n({el:this.$(".connectionGroup")}),this.configuration.fillConnectionStatusInfo(d.CONN_TYPE.PULSE,this.model),"FAILED"===t.status&&this.initialRendering?(this.$(".nutanixMoreInfo").nutanixMoreInfo({parseDataAttrs:!0}),this.triggerAction(d.MODAL.ACT.ALERT_SHOW,{type:d.MODAL.ALERT.TYPE_ERROR,message:t.message.message})):this.triggerAction(d.MODAL.ACT.ALERT_HIDE),this._initialRendering=!1},reset:function(){this.triggerAction(d.MODAL.ACT.ALERT_HIDE),this.undelegateEvents()},onEnterKeyPress:function(){this.onSave()},onSave:function(){if(this.triggerAction(d.MODAL.ACT.ALERT_HIDE),!this.model)return void p.debug("AutoSupportPopupView: onSave: Unable to save Pulse configuration");var e=""===this.$(".emailContacts").val().trim()?[]:this.$(".emailContacts").val().split(",");e=_.map(e,function(e){return e.trim()});var t=this.$(".infoScrubbing").is(":checked"),n={enable:this.$(".enable").is(":checked"),identificationInfoScrubbingLevel:t?v.PARTIAL:v.ALL,enableDefaultNutanixEmail:this.$(".defaultEmail").is(":checked"),emailContactList:e,verbosityType:this.$("#verbosity").val()};if(n.enable&&!n.enableDefaultNutanixEmail){var i=h.validateFormCommaEmail(n.emailContactList);if(_.isEmpty(n.emailContactList))return void this.showHeaderError(this.i18n("empty_email"));if(0!==i.length)return this.showHeaderError("Error saving Pulse Configuration - Invalid Email(s): "+i),void this.$(".btnSave").button("reset")}this.model.set(n),this.saveAutoSupport()},onClickEnable:function(e){var t=$(e.currentTarget),n=t.prop("checked");this.$(".defaultEmail").prop("checked",n),this.$(".infoScrubbing").prop("disabled",!n)},onClickShowSMTP:function(e){this.clearHeader(),l.executeActionElement(e.currentTarget)},onDoubleClickVerbosityLabel:function(e){e.shiftKey&&(this.devMode=!0,this._renderOnDataChanged())},onClickAdditionalInfo:function(){this.isAdditionalInfoShown=!this.isAdditionalInfoShown,this.isAdditionalInfoShown?(this.$(".additionalInfoContent").show(),this.$(".additionalInfoContent")[0].scrollIntoView()):this.$(".additionalInfoContent").hide()},onClickLearnMore:function(){c.navigateToURL(o.PULSE_URL,!0)},saveAutoSupport:function(){if(this.model){this.$(".btnSave").button("saving");var e=this;this.model.save(null,{success:function(t,n){e.$(".btnSave").button("reset")},error:function(t,n){e.showHeaderError("Error saving Pulse Configuration. "+p.processAjaxError(n.responseText)),e.$(".btnSave").button("reset")}})}},destroy:function(){this.model&&this.model.off(),this.configuration&&this.configuration.destroy(),t.prototype.destroy.apply(this,arguments)}})}),define("text!templates/popups/resiliency/ResiliencyStatusPopupViewRAView.html",[],function(){return'\x3c!-- The parent div modal is #popupResiliencyStatus --\x3e\n<div class="modal-header">\n  <button type="button" class="close" data-dismiss="modal">\n      <i data-icon="K" aria-hidden="true"></i>\n  </button>\n  <h4 class="n-title"><%= i18n(\'titleStatus\') %></h4>\n</div>\n<div class="n-modal-wrapper">\n    <div class="n-modal-body">\n      <div class="n-modal-content-wrapper">\n        <div class="n-modal-alert-header">\n            \x3c!-- @view: alert goes here... --\x3e\n        </div>\n        <div class="n-modal-content">\n          <% if (!initialized) { %>\n            <span class="n-message">\n              <%= i18n(\'loading\') %>\n            </span>\n          <% } else { %>\n            \x3c!-- Message for mixed RF --\x3e\n            <div id="msgMixedRF" class="n-popup-description"\n                style="display:none">\n              <%= i18n(\'mixedRfMessage\') %>\n              <a id="linkGoToStoragePage">\n                <%= i18n(\'clickHere\') %>\n              </a>.\n            </div>\n            <div id="msgUnderReplicationSize" class="n-popup-description"\n                 style="display:none">\n              <%= i18ns(\'clusterUnderReplicated\', underReplicatedSize) %>\n            </div>\n            <% _.each(summaries, function(summary, index){ %>\n              <% if (index > 0) { %>\n                \x3c!-- Separator --\x3e\n                <div class="n-separator">&nbsp;</div>\n              <% } %>\n              \x3c!-- Disk List --\x3e\n              <div class="n-resiliency-title">\n                <%= i18n(\'faultDomainType\' + summary.name) %>\n              </div>\n              <table id="resiliencyStatus<%= summary.name %>List"\n                     class="resiliency-table table table-hover">\n                <thead>\n                <tr>\n                  <th class="name-cell"><%= i18n(\'component\') %></th>\n                  <th class="ft-cell"><%= i18n(\'failuresTolerable\') %></th>\n                  <th><%= i18n(\'message\') %></th>\n                </tr>\n                </thead>\n                <tbody>\n                <% _.each( summary.rows, function(status)  { %>\n                <tr>\n                  <td class="name-cell"><%= status.componentType %></td>\n                  <td class="ft-cell">\n                    <%= status.numberOfFailuresTolerable %>\n                  </td>\n                  <td><%= status.message || "" %></td>\n                </tr>\n                <% }); %>\n                </tbody>\n              </table>\n            <% }); %>\n          <% } %>\n        </div>\n      </div>\n    </div>\n    <div class="n-modal-footer">\n      <button class="btnClose btn btn-primary"\n        data-loading-text="Saving...">\n        <%= i18n(\'close\') %>\n      </button>\n    </div>\n</div>'}),define("text!templates/popups/resiliency/ResiliencyStatusPopupView.html",[],function(){return'\x3c!-- The parent div modal is #popupResiliencyStatus --\x3e\n<div class="modal-header">\n  <button type="button" class="close" data-dismiss="modal">\n      <i data-icon="K" aria-hidden="true"></i>\n  </button>\n  <h4 class="n-title"><%= i18n(\'titleStatus\') %></h4>\n</div>\n<div class="n-modal-wrapper">\n    <div class="n-modal-body">\n      <div class="n-modal-content-wrapper">\n        <div class="n-modal-alert-header">\n            \x3c!-- @view: alert goes here... --\x3e\n        </div>\n        <div class="n-modal-content">\n\n          <% if (!initialized) { %>\n\n            <span class="n-message">\n              <%= i18n(\'loading\') %>\n            </span>\n\n          <% } else { %>\n\n            \x3c!-- Message for mixed RF --\x3e\n            <div id="msgMixedRF" class="n-popup-description"\n                style="display:none">\n              <%= i18n(\'mixedRfMessage\') %>\n              <a id="linkGoToStoragePage">\n                <%= i18n(\'clickHere\') %>\n              </a>.\n            </div>\n\n            <div id="msgUnderReplicationSize" class="n-popup-description"\n                 style="display:none">\n              <%= i18ns(\'clusterUnderReplicated\', underReplicatedSize) %>\n            </div>\n\n            <% if (showSummaryDisk) { %>\n              \x3c!-- Disk List --\x3e\n              <div class="n-resiliency-title">\n                <%= i18n(\'faultDomainTypeDisk\') %>\n              </div>\n              <table id="resiliencyStatusDiskList"\n                  class="resiliency-table table table-hover">\n                <thead>\n                  <tr>\n                    <th class="name-cell">\n                      <%= i18n(\'component\') %>\n                    </th>\n                    <th class="ft-cell">\n                      <%= i18n(\'failuresTolerable\') %>\n                    </th>\n                    <th>\n                      <%= i18n(\'message\') %>\n                    </th>\n                  </tr>\n                </thead>\n                <tbody>\n                  <% _.each( summaryRowsDisk, function(status)  { %>\n                    <tr>\n                      <td class="name-cell">\n                        <%= status.componentType %>\n                      </td>\n                      <td class="ft-cell">\n                        <%= status.numberOfFailuresTolerable %>\n                      </td>\n                      <td>\n                        <%= status.message || "" %>\n                      </td>\n                    </tr>\n                  <% }); %>\n                </tbody>\n              </table>\n\n              \x3c!-- Separator --\x3e\n              <div id="blockSeparator" class="n-separator">&nbsp;</div>\n            <% } %>\n\n            \x3c!-- Host List --\x3e\n            <div class="n-resiliency-title">\n              <%= i18n(\'faultDomainTypeHost\') %>\n            </div>\n            <table id="resiliencyStatusHostList"\n                class="resiliency-table table table-hover">\n              <thead>\n                <tr>\n                  <th class="name-cell">\n                    <%= i18n(\'component\') %>\n                  </th>\n                  <th class="ft-cell">\n                    <%= i18n(\'failuresTolerable\') %>\n                  </th>\n                  <th>\n                    <%= i18n(\'message\') %>\n                  </th>\n                </tr>\n              </thead>\n              <tbody>\n                <% _.each( summaryRowsNode, function(status)  { %>\n                  <tr>\n                    <td class="name-cell">\n                      <%= status.componentType %>\n                    </td>\n                    <td class="ft-cell">\n                      <%= status.numberOfFailuresTolerable %>\n                    </td>\n                    <td>\n                      <%= status.message || "" %>\n                    </td>\n                  </tr>\n                <% }); %>\n              </tbody>\n            </table>\n\n            <% if (showSummaryBlock) { %>\n              \x3c!-- Separator --\x3e\n              <div id="blockSeparator" class="n-separator">&nbsp;</div>\n\n              \x3c!-- Block List --\x3e\n              <div id="blockTitle" class="n-resiliency-title">\n                <%= i18n(\'faultDomainTypeBlock\') %>\n              </div>\n              <table id="resiliencyStatusBlockList"\n                  class="resiliency-table table table-hover">\n                <thead>\n                  <tr>\n                    <th class="name-cell">\n                      <%= i18n(\'component\') %>\n                    </th>\n                    <th class="ft-cell">\n                      <%= i18n(\'failuresTolerable\') %>\n                    </th>\n                    <th>\n                      <%= i18n(\'message\') %>\n                    </th>\n                  </tr>\n                </thead>\n                <tbody>\n                  <% _.each( summaryRowsBlock, function(status)  { %>\n                    <tr>\n                      <td class="name-cell">\n                        <%= status.componentType %>\n                      </td>\n                      <td class="ft-cell">\n                        <%= status.numberOfFailuresTolerable %>\n                      </td>\n                      <td>\n                        <%= status.message || "" %>\n                      </td>\n                    </tr>\n                  <% }); %>\n                </tbody>\n              </table>\n            <% } %>\n\n          <% } %>\n\n        </div>\n      </div>\n    </div>\n    <div class="n-modal-footer">\n      <button class="btnClose btn btn-primary"\n        data-loading-text="Saving...">\n        <%= i18n(\'close\') %>\n      </button>\n    </div>\n</div>'}),define("views/popups/resiliency/ResiliencyStatusPopupView",["views/basecomponents/popups/BasePopupView","data/DataProperties","models/resiliency/ResiliencyCollection","models/storage/ContainerCollection","utils/AppConstants","utils/AppUtil","utils/StatsUtil","managers/NavigationManager","text!templates/popups/resiliency/ResiliencyStatusPopupViewRAView.html","text!templates/popups/resiliency/ResiliencyStatusPopupView.html"],function(e,t,n,i,s,a,o,r,l,c){"use strict";var d=_.template(c),p=_.template(l);return e.extend({el:"#popupResiliencyStatus",initialized:!1,resiliencyCollection:null,containerCollection:null,selectedFaultDomain:null,name:"ResiliencyStatusPopupView",events:{"click .modal-header .close":"hide","click .btnClose":"hide","click #linkGoToStoragePage":"onClickGoToStoragePage"},modelEvents:{"reset resiliencyCollection":"onResetResiliency","error resiliencyCollection":"onErrorResiliency","reset containerCollection":"onResetContainers"},enableRA:!1,initialize:function(){e.prototype.initialize.apply(this,arguments),this.resiliencyCollection=new n,this.containerCollection=new i;var t=this.getCurrentClusterModel();this.enableRA=t&&t.isFFEnabled(s.FFLAGS.RA_DOMAIN_AWARENESS)},renderRA:function(){var e,t=this,n=this.selectedFaultDomain,i=Object.keys(s.RESILIENCY_DOMAIN_TYPE).map(function(e){return s.RESILIENCY_DOMAIN_TYPE[e]}),a=i.indexOf(n);if(a<i.length-1&&i.splice(a+1,i.length-a),n===s.RESILIENCY_DOMAIN_TYPE.RACK){var r=i.indexOf(s.RESILIENCY_DOMAIN_TYPE.BLOCK);i.splice(r,1)}var l=(e={},_defineProperty(e,s.RESILIENCY_DOMAIN_TYPE.RACK,"Rack"),_defineProperty(e,s.RESILIENCY_DOMAIN_TYPE.BLOCK,"Block"),_defineProperty(e,s.RESILIENCY_DOMAIN_TYPE.NODE,"Host"),_defineProperty(e,s.RESILIENCY_DOMAIN_TYPE.DISK,"Disk"),e),c=i.map(function(e){return{name:l[e],rows:t.resiliencyCollection.getSummaryRows(e)}}),d=this.resiliencyCollection.getUnderReplicatedBytes();this.$el.html(p(this.vtOptions({initialized:this.initialized,summaries:c,underReplicatedSize:o.storageFormat(d)})))},render:function(){if(this.enableRA)return this.renderRA();var e=this.resiliencyCollection.getUnderReplicatedBytes(),n=this.resiliencyCollection.getSummaryRows(s.RESILIENCY_DOMAIN_TYPE.DISK),i=this.resiliencyCollection.getSummaryRows(s.RESILIENCY_DOMAIN_TYPE.NODE),a=this.resiliencyCollection.getSummaryRows(s.RESILIENCY_DOMAIN_TYPE.BLOCK),r=this.getCurrentClusterModel()||null,l=!n||n.length>0,c=r&&r.get(t.CLUSTER_NUM_NODES)>1;this.$el.html(d(this.vtOptions({initialized:this.initialized,summaryRowsDisk:n,summaryRowsNode:i,summaryRowsBlock:a,showSummaryDisk:l,showSummaryBlock:c,underReplicatedSize:o.storageFormat(e)}))),this._showUnderReplicatedData(e);var p=this.$(".n-modal-body");if(this.selectedFaultDomain===s.RESILIENCY_DOMAIN_TYPE.BLOCK){var u=this.$("#blockTitle");p.scrollTop(u.position().top)}else p.scrollTop(0)},show:function(t){e.prototype.show.apply(this,arguments),t&&(this.selectedFaultDomain=t[s.NAV_ACTION_TARGET_ID]),this.fetchResiliencyStatus()},fetchResiliencyStatus:function(){this.resiliencyCollection.fetch()},onResetResiliency:function(){this.initialized=!0,this.render(),this.containerCollection.fetch()},onErrorResiliency:function(e,t){this.showHeaderError(_.isObject(t)?a.processAjaxError(t.responseText):t)},onResetContainers:function(){var e,n,i=0;this.containerCollection.each(function(a){void 0===e&&(e=a.get(t.RF)),void 0===n&&(n=a.get(t.RF)),e=Math.min(a.get(t.RF),e),n=Math.max(a.get(t.RF),n),a.get(t.RF)===s.DEFAULT_REDUNDANCY_FACTOR&&(i=Math.max(0,a.getTotalUsedPhysical()))},this),n>e&&i>0?this.$("#msgMixedRF").show():this.$("#msgMixedRF").hide()},onClickGoToStoragePage:function(){this.hide(),r.navigateToPage(s.PAGE_STORAGE,s.SUBPAGE_TABLE)},_showUnderReplicatedData:function(e){e>0?this.$("#msgUnderReplicationSize").show():this.$("#msgUnderReplicationSize").hide()}})}),define("text!templates/popups/dr/SchedulePopupView.html",[],function(){return'\x3c!-- The parent div modal is #popupSchedule --\x3e\n<div class="modal-header">\n  <button type="button" class="close" data-dismiss="modal">\n    <i data-icon="K" aria-hidden="true"></i>\n  </button>\n  <h4 class="n-title">Update Schedule for \'<%= pdName %>\'</h4>\n</div>\n\n<div class="n-modal-wrapper">\n  <div class="n-modal-body">\n    <div class="n-modal-content-wrapper">\n      <div class="n-modal-alert-header">\n        \x3c!-- @view: update message goes here --\x3e\n      </div>\n\n      \x3c!-- Schedule Form --\x3e\n      <form id="scheduleForm" class="form-horizontal n-form-rows">\n        <% if ( ! initialized ) { %>\n          <div class=\'no-data page-loading-message\'>\n            <img src=\'app/assets/images/spinners/loading.gif\'\n                 width=16px height=16px/>&nbsp;Loading...\n          </div>\n        <% } else if (model) { %>\n          <div id="pd-schedule">\n            <div class="schedule-container" id="scheduleEditorContainer">\n              \x3c!-- Schedule editor goes here... --\x3e\n            </div>\n          </div>\n        <% } %>\n      </form>\n    </div>\n  </div>\n\n  <div class="n-modal-footer">\n    \x3c!-- Back button --\x3e\n    <button class="btnCancel btn n-btn-list">\n      Cancel\n    </button>\n    <button class="btnUpdate btn btn-primary n-btn-list"\n    <%= model ? \'\' : \'disabled\'%> >\n    Save\n    </button>\n  </div>\n</div>\n'}),define("views/popups/dr/SchedulePopupView",["views/basecomponents/popups/BasePopupView","data/DataProperties","models/dataprotection/PDScheduleCollection","models/dataprotection/ProtectionDomainModel","models/dataprotection/RemoteSiteCollection","views/wizards/pd/ScheduleDetailView","utils/SubViewHelper","utils/AppConstants","text!templates/popups/dr/SchedulePopupView.html"],function(e,t,n,i,s,a,o,r,l){"use strict";return e.extend({el:"#popupSchedule",initialized:!1,model:null,remoteSiteCollection:null,pdModel:null,scheduleId:null,actionSuccessCallback:null,subViewHelper:null,name:"SchedulePopupView",events:{"click  .btnUpdate":"onUpdateClick","click  .btnCancel":"hide",
"click  .modal-header .close":"hide","keypress input":"onKeyPress","click    input":"clearHeader"},initialize:function(e){this.subViewHelper=new o,this.remoteSiteCollection=new s,this.pdModel=new i,this.scheduleCollection=new n},render:function(){if(this.initialized&&this.pdModel.isActive()&&(this.model=this.scheduleCollection.findModelById(this.scheduleId),this.model.setMetroAvail(this.pdModel.isMetroAvailPD())),this.template=_.template(l,{initialized:this.initialized,pdName:this.pdModel.get(t.PD_NAME),model:this.model}),this.$el.html(this.template),this.applyNutanixInput(),this.initialized)if(this.addHelpLink(),this.model){var e=new a({el:"#scheduleEditorContainer",model:this.model,protectionDomain:this.pdModel,remoteSiteCollection:this.remoteSiteCollection,scheduleCollection:this.scheduleCollection});e.setParentView(this),this.subViewHelper.register("scheduleView",e),this.subViewHelper.render("scheduleView")}else this.pdModel.isActive()?this.showHeaderTextError("Unable to update schedule - schedule no longer exists."):this.showHeaderTextError("Unable to update schedule, protection domain is inactive.")},show:function(t){this.actionRoute=t,this.scheduleId=t.actionTargetId,this.initialized=!1,this.actionSuccessCallback=t.actionSuccessCallback,this.pdModel.set(this.pdModel.idAttribute,t.actionTargetName,{silent:!0}),this.scheduleCollection.setPDName(t.actionTargetName),e.prototype.show.apply(this,arguments);var n=this;$.when.apply($,[this.pdModel.fetch(),this.remoteSiteCollection.fetch(),this.scheduleCollection.fetch()]).done(function(){n.initialized=!0,n.render()}).fail(function(e,t,i){n.initialized=!0,n.render(),n.showHeaderErrorWithDescription(e,"Error editing schedule.")})},destroy:function(){this.subViewHelper.destroy(),e.prototype.destroy.apply(this,arguments)},addHelpLink:function(){var e={actionTarget:this.pdModel.isMetroAvailPD()?r.ENTITY_METRO_AVAILABILITY_PD:r.ENTITY_ASYNC_PD,action:this.actionRoute[r.NAV_ACTION]};this.createHelpIcon(e)},onUpdateClick:function(){var e=this;if(this.model){var t=this.subViewHelper.get("scheduleView"),n=t.skipStartDateTime(),i=this.model.isInputDataValid({skipStartDateTimeValidation:n,isTransitioningFromAsyncToNearSync:t.isTransitioningFromAsyncToNearSync()});if(null!==i)return void this.showError(i);this.remoteSiteCollection.length&&!this.model.hasRemoteRetention()?$.nutanixConfirm({msg:this.i18nStatic("SchedulePage","no_remote_retention_confirmation_text"),yesText:this.i18n("continue"),yes:function(){e.updateSchedule(n)}}):this.updateSchedule(n)}},updateSchedule:function(e){var t=this;this.model.updateSchedule(function(e){t.hide(),t.actionSuccessCallback&&t.actionSuccessCallback()},function(e){var n=t.i18nStatic("SchedulePage","schedule_error");t.showError(n+": "+e)},e)},isModelInitialized:function(){return this.initialized},onClickLinkAction:function(e){},showError:function(e){this.showHeaderTextError(e)},_deleteAction:function(e){var t=this;e.deleteSchedule(function(e){e&&t.refreshData()},function(e){t.showHeaderTextError("Error deleting schedule. "+e)})}})}),define("text!templates/popups/network/AcropolisNetworkFormView.html",[],function(){return'\x3c!-- Acropolis Network Creation Form --\x3e\n<section data-ntnx-section class="nameGroup">\n  <label data-ntnx-label><%= i18n(\'name\') %></label>\n  <input model-validate="required" model-attribute="name"\n    model-attribute-name="<%= i18n(\'name\') %>"\n    type="text" class="name" data-test="networkNameInput">\n</section>\n<section data-ntnx-section class="uuidGroup">\n  <label data-ntnx-label><%= i18n(\'uuid\') %></label>\n  <span class="uuid" data-test="networkUuid"></span>\n</section>\n<section data-ntnx-section>\n  <label  data-ntnx-label><%= i18n(\'vlan_id\') %>\n    <span class="n-tooltip-vlan"></span>\n  </label>\n  <input type="text" class="vlanID"\n    data-test="networkVlanIdInput">\n</section>\n\x3c!-- ENG-47334 Hide vswitch input util a UX re-design --\x3e\n\x3c!--<div class="control-group vswitchNameGroup">--\x3e\n\x3c!--<label  data-ntnx-label class="vswitch">VSWITCH NAME</label>--\x3e\n\x3c!--<div class="controls">--\x3e\n\x3c!--<input type="text" class="vswitchName" data-test="networkVSwitchNameInput"--\x3e\n\x3c!--placeholder="Optional">--\x3e\n\x3c!--</div>--\x3e\n\x3c!--</div>--\x3e\n<section data-ntnx-section>\n  <div data-ntnx-form-inline>\n    <%= Components.checkbox({\n      jsClasses: \'chkManagedNetwork\',\n      name: \'chkManagedNetwork\',\n      value: true,\n      labelText : i18n(\'ip_management\'),\n      dataTestAttribute: \'networkManagedChk\'\n    }) %>\n  </div>\n  <p data-ntnx-section="type-subtitle">\n    <%= i18n(\'acropolis_ip_assignment\') %>\n  </p>\n</section>\n\x3c!-- Managed network settings: Using inline styles because of slideToggle --\x3e\n<div id="managedNetworkSettingsContainer"\n  class="n-form-advanced-settings n-inactive" style="display: none;">\n  <section data-ntnx-section>\n    <label data-ntnx-label><%= i18n(\'network_ip\') %></label>\n    <input type="text" class="networkAddress"\n      data-test="networkAddressInput">\n  </section>\n  <section data-ntnx-section>\n    <label data-ntnx-label><%= i18n(\'gateway_ip\') %></label>\n    <input type="text" class="defaultGateway"\n      data-test="networkDefaultGatewayInput">\n  </section>\n  <section data-ntnx-section="type-separator">\n    <div data-ntnx-form-inline>\n      <%= Components.checkbox({\n        jsClasses: \'chkDomainSettings\',\n        name: \'chkDomainSettings\',\n        value: true,\n        labelText : i18n(\'domain_settings\'),\n        dataTestAttribute: \'networkDomainSettingsChk\'\n      }) %>\n    </div>\n    \x3c!-- Domain Settings --\x3e\n    <div id="domainSettingsContainer"\n      class="n-form-advanced-settings">\n      <section data-ntnx-section>\n        <label data-ntnx-label><%= i18n(\'domain_name_servers\') %></label>\n        <input type="text" class="domainNameServers"\n          data-test="acropolisnetworkformview_input_dns">\n      </section>\n      <section data-ntnx-section>\n        <label data-ntnx-label><%= i18n(\'domain_search\') %></label>\n        <input type="text" class="domainSearch"\n          data-test="networkDomainSearchInput">\n      </section>\n      <section data-ntnx-section>\n        <label data-ntnx-label><%= i18n(\'domain_name\') %></label>\n        <input type="text" class="domainName"\n          data-test="networkDomainNameInput">\n      </section>\n      <section data-ntnx-section>\n        <label data-ntnx-label><%= i18n(\'tftp_server_name\') %></label>\n        <input type="text" class="tftpServerName"\n          data-test="networkTFTPServerNameInput">\n      </section>\n      <section data-ntnx-section>\n        <label data-ntnx-label><%= i18n(\'boot_file_name\') %></label>\n        <input type="text" class="bootFileName"\n          data-test="networkBootFileNameInput">\n      </section>\n    </div>\n  </section>\n  <section data-ntnx-section="type-separator"\n    class="ip-addr-pool-controls">\n    <label data-ntnx-label>\n      <%= i18n(\'ip_address_pools\') %>\n      <span class="n-tooltip-ip-pools"></span>\n    </label>\n    <%= Components.button({\n      extraClasses: \'btnCreateIpAddrPool\',\n      text: i18n(\'create_pool\'),\n      iconLeft: \'plus\',\n      dataTestAttribute: \'networkCreateIpPoolBtn\'\n    }) %>\n    <p class="no-ip-pool" data-ntnx-section="type-subtitle">\n      <%= i18n(\'none_defined\') %>.\n    </p>\n    <section data-ntnx-section class="hide">\n      <table id="ipPoolList" class="table table-hover"\n        data-test="networkIpPoolTable">\n        <thead>\n          <tr>\n            <th><%= i18n(\'start_address\') %></th>\n            <th><%= i18n(\'end_address\') %></th>\n          </tr>\n        </thead>\n        <tbody>\n          \x3c!-- @view: IP Pools go here... --\x3e\n        </tbody>\n      </table>\n    </section>\n  </section>\n  <section data-ntnx-section="type-separator">\n    <div data-ntnx-form-inline class="chkDhcpServerGroup">\n      <%= Components.checkbox({\n        jsClasses: \'chkDhcpServer\',\n        name: \'chkDhcpServer\',\n        value: true,\n        labelText : i18n(\'override_dhcp_server\'),\n        dataTestAttribute: \'networkDhcpServerChk\'\n      }) %>\n      <span class="n-tooltip-dhcp"></span>\n    </div>\n    \x3c!-- DHCP server: Using inline styles because of slideToggle --\x3e\n    <div id="dhcpServerContainer"\n      class="n-form-advanced-settings" style="display: none;">\n      <section data-ntnx-section>\n        <label data-ntnx-label><%= i18n(\'dhcp_server_ip\') %></label>\n        <input type="text" class="dhcpServerAddress"\n          data-test="networkDhcpAddressInput">\n      </section>\n    </div>\n  </section>\n</div>\n'}),define("text!templates/popups/network/AcropolisNetworkItemView.html",[],function(){return'<tr class="n-table-row">\n  <td  class="name-cell">\n    <%= name %>\n  </td>\n  <td class="vlan-cell">\n    <%= vLanID %>\n    <% if (canModify) { %>\n      <div class="cell-actions pull-right"\n        data-network-id="<%= id %>" data-vlan-id="<%- vLanID %>">\n        <i class="btnEdit" data-icon="F" aria-hidden="true"></i>\n        <span class="action-separator">&middot;</span>\n        <i class="btnDelete" data-icon="v" aria-hidden="true" ></i>\n      </div>\n    <% } %>\n  </td>\n</tr>'}),define("text!templates/popups/network/AcropolisNetworkConfigurationView.html",[],function(){return'\x3c!-- The parent div modal is #popupNetworkConfig --\x3e\n<div id="acropolisNetworkList" style="display:none;" data-ntnx-section\n    class="network-config-content section-content listContainer">\n  \x3c!-- Network list rendered here --\x3e\n</div>\n\x3c!-- Acropolis Network Settings Form --\x3e\n<div class="network-config-content formContainer network-form-wrapper">\n  <div id="acropolisNetworkForm">\n    \x3c!-- @view: form goes here... --\x3e\n  </div>\n</div>\n\x3c!-- Acropolis IP Pool Form --\x3e\n<div class="network-config-content formContainer pool-form-wrapper">\n  <div id="ipPoolForm">\n    \x3c!-- @view: form goes here... --\x3e\n  </div>\n</div>'}),define("text!templates/popups/network/AcropolisIpPoolFormView.html",[],function(){return'\x3c!-- IP Pool Form --\x3e\n<section data-ntnx-section class="operation-wrapper">\n  <label data-ntnx-label><%= i18n(\'start_address\') %></label>\n  <input type="text" class="startAddressInput">\n</section>\n<section data-ntnx-section>\n  <label data-ntnx-label><%= i18n(\'end_address\') %></label>\n  <input type="text" class="endAddressInput">\n</section>\n'}),define("text!templates/popups/network/AcropolisIpPoolItemView.html",[],function(){return'<tr class="n-table-row">\n  <td class="startAddressItem">\n    <%= startAddress %>\n  </td>\n  <td class="endAddressItem">\n    <%= endAddress %>\n  </td>\n  <td class="cell-actions" startAddress="<%= startAddress %>"\n      endAddress="<%= endAddress %>" index="<%= index %>">\n      <i class="btnEdit" data-icon="F" aria-hidden="true"></i>\n      <span class="action-separator">&middot;</span>\n      <i class="btnDelete" data-icon="v" aria-hidden="true"></i>\n  </td>\n</tr>'}),define("views/popups/network/AcropolisNetworkConfigurationView",["views/basecomponents/popups/BasePopupSubView","data/DataProperties","models/network/AcropolisNetworkCollection","models/network/AcropolisNetworkModel","events/AppEvents","utils/AppConstants","utils/AppUtil","utils/ValidationUtil","text!templates/basecomponents/pagepopups/PopupListView.html","text!templates/popups/network/AcropolisNetworkFormView.html","text!templates/popups/network/AcropolisNetworkItemView.html","text!templates/popups/network/AcropolisNetworkConfigurationView.html","text!templates/popups/network/AcropolisIpPoolFormView.html","text!templates/popups/network/AcropolisIpPoolItemView.html"],function(e,t,n,i,s,a,o,r,l,c,d,p,u,h){"use strict";l=_.template(l),p=_.template(p),d=_.template(d),c=_.template(c),u=_.template(u),h=_.template(h);var m=_.template("The <%= label %> IP address <%= ip %> does not lie within the network: <%= cidr %>"),f=_.template("<%= networkAddress %> is not a valid network address for this prefix.");return e.extend({ERROR_VLANID_REQUIRED:"VLAN ID is a required field.",ERROR_VLANID_INVALID:"VLAN ID must be a Non negative integer",ERROR_INVALID_NETWORK_ADDRESS:'Invalid format for field "NETWORK IP ADDRESS / PREFIX LENGTH"<br>Please provide the value in the format xxx.xxx.xxx.xxx/# <br> where "#" is the prefix length.',ERROR_DOMAIN_NAME_INVALID:"Please provide a valid domain name.",ERROR_EMPTY_ADDRESS:"Please provide values for both the start and end address.",ERROR_INVALID_START_ADDRESS:"Invalid IP format for start address.",ERROR_INVALID_END_ADDRESS:"Invalid IP format for end address.",ERROR_END_VS_START:"End address must be greater than start address.",TOOLTIP_VLAN_0:"Specify VLAN ID 0 for the native VLAN.",TOOLTIP_DHCP_LOGIC:"If unspecified, the DHCP server IP will be the highest unallocated unicast address in the subnet.",TOOLTIP_IP_POOLS:"These are user defined address pools from which IPs are automatically allocated. If no pool is provided, the user must assign IP addresses to VMs manually.",GATEWAY:"gateway",DHCP:"DHCP",POOL:"pool",name:"AcropolisNetworkPopupView",el:"#popupNetworkConfig",networks:null,ipPools:null,ipPoolMode:null,currentIpPoolIndex:null,callbackShowNetworkForm:null,callbackShowIpPoolForm:null,callbackCreateOrUpdateNetworkSuccess:null,proxyClusterUuid:null,events:{"click .network-controls .btnDelete":"onDeleteNetwork","click .network-controls .btnEdit":"onEditNetwork","click .ip-addr-pool-controls .btnDelete":"onDeleteIpPool","click .ip-addr-pool-controls .btnEdit":"onEditIpPool","click .btnCreate":"onCreateClick","click .chkManagedNetwork":"onManagedNetworkClick","click .chkDomainSettings":"onDomainSettingsClick","click .chkDhcpServer":"onDhcpServerClick","click .btnCreateIpAddrPool":"onCreateIpAddrPoolClick"},initialize:function(t){e.prototype.initialize.apply(this,arguments),this.callbackShowNetworkForm=t.callbackShowNetworkForm||function(){},this.callbackShowIpPoolForm=t.callbackShowIpPoolForm||function(){},this.callbackCreateOrUpdateNetworkSuccess=t.callbackCreateOrUpdateNetworkSuccess||function(){},this.proxyClusterUuid=t.proxyClusterUuid,this.createMode=this.canModifyByEntityType(a.ENTITY_ACROPOLIS_NETWORK)&&t&&t.createMode},render:function(){this.isViewRendered||(this.createMode||(this.showNetworkList(),this.setCheckboxes()),this.$el.html(p(this.vtOptions({canModify:this.canModifyByEntityType(a.ENTITY_ACROPOLIS_NETWORK)}))),this.createMode&&(this.ipPools=[],this.showNetworkForm(a.ACTION_CREATE,!0,!0)),this.isViewRendered=!0)},showView:function(){this.$(".listContainer").show(),e.prototype.showView.apply(this,arguments)},destroy:function(){this.resetCheckboxes(),this.showNetworkList(),this.undelegateEvents(),e.prototype.destroy.apply(this,arguments)},reset:function(){this.resetCheckboxes(),this.showNetworkList(),this.undelegateEvents()},clearForm:function(){this.$('input[type="text"]').val(""),this.$("#ipPoolList > tbody").html("")},confirmHide:function(e){e()},listNetwork:function(){var e=this;this.networks=new n,this.networks.setProxyClusterUuid(this.proxyClusterUuid),this.parentView.showSubview(".n-modal-loading"),this.networks.fetch({success:function(){e.parentView.showSubview("#acropolisNetworkList",null,!0),e._networksDataTable&&e.networks.length&&e._networksDataTable.fnDestroy(),e.$("#acropolisNetworkList").html(e._renderNetworkList(e.networks)),e.networks.length&&(e._networksDataTable=e.$("#acropolisNetworkTable").DataTable({bPaginate:!1,bInfo:!1,bSort:!0})),e.triggerAction(a.MODAL.ACT.AS_REBUILD)},error:function(t,n){e.triggerActions([a.MODAL.ACT.AS_REBUILD,[a.MODAL.ACT.ALERT_SHOW,{type:a.MODAL.ALERT.TYPE_ERROR,message:n.responseText}]])}})},_renderNetworkList:function(e){var t=this.canModifyByEntityType(a.ENTITY_ACROPOLIS_NETWORK),n=e&&e.models?e.models:[];return l({className:"network-controls",title:"",titleClass:"section-header",tableId:"acropolisNetworkTable",btnClass:"btnCreate",dataTest:"networkCreateBtn",dataTableTest:"networkListTable",streamAction:"create",streamTarget:"uvmNetworks",btnText:this.i18n("create_network"),emptyText:this.i18n("no_networks"),tableHeaders:[{title:this.i18n("network_name")},{title:this.i18n("vlan_id")}],tableRows:_.map(n,function(e){return d({id:e.getId(),name:e.getDisplayName(),vLanID:e.getDisplayVlanId(),canModify:t})})})},showNetworkList:function(){this.triggerAction(a.MODAL.ACT.ALERT_HIDE),this.currentNetworkModel=null,this.ipPools=[],this.triggerAction(a.MODAL.ACT.SET_TITLE,this.i18n("title_network_configuration")),this.listNetwork(),this.parentView.$(".n-btn-form").hide(),this.parentView.$(".n-btn-list").show()},showNetworkForm:function(e,t,n){var s=this;if(this.mode=e||this.mode,this.triggerAction(a.MODAL.ACT.ALERT_HIDE),this.triggerAction(a.MODAL.ACT.SET_TITLE,a.ACTION_NAMES[this.mode]+" "+a.ENTITY_NAMES[a.ENTITY_ACROPOLIS_NETWORK]),n){this.$("#acropolisNetworkForm").html(c(this.vtOptions({model:{}})));var o=i.DP,r=o[o.IP_CONFIG],l=r[o.DHCP_OPTIONS];this.currentNetworkModel?(this.$(".name").val(this.currentNetworkModel.get(o.NAME)),this.$(".uuid").text(this.currentNetworkModel.getId()),this.$(".vlanID").val(this.currentNetworkModel.get(o.VLAN_ID)),this.$(".dhcpServerAddress").val(this.currentNetworkModel.getIpConfigAttr(r.DHCP_ADDY)),this.$(".networkAddress").val(this.currentNetworkModel.getNetworkAddressWithPrefix()),this.$(".domainNameServers").val(this.currentNetworkModel.getDhcpOptionsAttr(l.DNS_SERVERS)),this.$(".domainSearch").val(this.currentNetworkModel.getDhcpOptionsAttr(l.DOMAIN_SEARCH)),this.$(".domainName").val(this.currentNetworkModel.getDhcpOptionsAttr(l.DOMAIN_NAME)),this.$(".tftpServerName").val(this.currentNetworkModel.getDhcpOptionsAttr(l.TFTP_SERVER_NAME)),this.$(".bootFileName").val(this.currentNetworkModel.getDhcpOptionsAttr(l.BOOT_FILE_NAME)),this.$(".defaultGateway").val(this.currentNetworkModel.getIpConfigAttr(r.DEFAULT_GATEWAY)),_.each(this.currentNetworkModel.getIpConfigAttr(this.currentNetworkModel.DP.POOL),function(e){s.addIpPool(e.range)})):this.$(".uuidGroup").hide(),this.setCheckboxes()}this.showConfiguredIpPools(),this.applyNutanixInput({types:["checkbox"]}),this.updateInputsDisabling(),this.$(".n-tooltip-vlan").nutanixMoreInfo({container:"body",title:this.i18n("tooltip_vlan_0",this.TOOLTIP_VLAN_0)}),this.$(".n-tooltip-dhcp").nutanixMoreInfo({title:this.i18n("tooltip_dhcp_logic",this.TOOLTIP_DHCP_LOGIC)}),this.$(".n-tooltip-ip-pools").nutanixMoreInfo({title:this.i18n("tooltip_ip_pools",this.TOOLTIP_IP_POOLS)}),this.callbackShowNetworkForm(this.mode)},updateInputsDisabling:function(){if(this.mode===a.ACTION_UPDATE){var e=this.$("#acropolisNetworkForm"),t=e.find(".chkManagedNetwork"),n=e.find("#managedNetworkSettingsContainer");t.prop("disabled",!0),t.is(":checked")&&(n.show(),n.find("#dhcpServerContainer").show())}},showConfiguredIpPools:function(){if(this.ipPools.length>0){var e=this.$("#ipPoolList > tbody");e.html(""),_.each(this.ipPools,function(t,n){var i=t[0],s=t[1],a=h({startAddress:i,endAddress:s,index:n});e.append(a)}),this.$(".no-ip-pool").hide(),this.$("#ipPoolList").parent("section").removeClass("hide")}else this.$("#ipPoolList").parent("section").addClass("hide"),this.$(".no-ip-pool").show()},showIpPoolForm:function(e){this.triggerAction(a.MODAL.ACT.ALERT_HIDE);var t=this.ipPoolMode===a.ACTION_UPDATE;this.callbackShowIpPoolForm(t),this.$("#ipPoolForm").html(u(this.vtOptions())),t?(this.$(".startAddressInput").val($(e.currentTarget).closest("td").attr("startAddress")),this.$(".endAddressInput").val($(e.currentTarget).closest("td").attr("endAddress")),this.currentIpPoolIndex=$(e.currentTarget).closest("td").attr("index"),this.triggerAction(a.MODAL.ACT.SET_TITLE,this.i18n("edit_ip_pool"))):this.triggerAction(a.MODAL.ACT.SET_TITLE,this.i18n("add_ip_pool"))},generateModelFromForm:function(){var e=this,t=new i;if(t.setProxyClusterUuid(this.proxyClusterUuid),this.$("#acropolisNetworkForm").is(":visible")){t.set(t.DP.NAME,this.$(".name").val().trim()),t.set(t.DP.VLAN_ID,this.$(".vlanID").val().trim());var n={},s=i.DP,l=s[s.IP_CONFIG];if(this.$(".chkManagedNetwork").is(":checked")){var c=void 0;n[s.DHCP_OPTIONS]={};for(var d in l)if(l.hasOwnProperty(d)){var p=l[d];if("string"!=typeof p||p===l.PREFIX_LENGTH)continue;if(c=this.$("."+p),""!==c.val().trim()){if(p===l.DHCP_ADDY&&!this.$(".chkDhcpServer").prop("checked"))continue;if(p!==l.NETWORK_ADDY)n[p]=c.val().trim();else{var u=c.val().trim().split("/"),h=u[0];if(!r.isValidIP(h))return void this.triggerAction(a.MODAL.ACT.ALERT_SHOW,{type:a.MODAL.ALERT.TYPE_ERROR,message:this.i18n("error_invalid_network_address",this.ERROR_INVALID_NETWORK_ADDRESS)});if(n[l.NETWORK_ADDY]=h,!u[1])return void this.triggerAction(a.MODAL.ACT.ALERT_SHOW,{type:a.MODAL.ALERT.TYPE_ERROR,message:this.i18n("error_invalid_network_address",this.ERROR_INVALID_NETWORK_ADDRESS)});n[l.PREFIX_LENGTH]=u[1];var v=parseInt(u[1],10);if(isNaN(v))return void this.triggerAction(a.MODAL.ACT.ALERT_SHOW,{type:a.MODAL.ALERT.TYPE_ERROR,message:this.i18n("error_invalid_network_address",this.ERROR_INVALID_NETWORK_ADDRESS)});if(!o.isValidPrefix(u[0],v))return void this.triggerAction(a.MODAL.ACT.ALERT_SHOW,{type:a.MODAL.ALERT.TYPE_ERROR,message:f({networkAddress:c.val().trim()})})}}}if(this.$(".chkDhcpServer").prop("checked")&&n[l.DHCP_ADDY]&&!this.validateIpInBlock(n[l.DHCP_ADDY],n[l.NETWORK_ADDY],n[l.PREFIX_LENGTH]))return void this.triggerAction(a.MODAL.ACT.ALERT_SHOW,{type:a.MODAL.ALERT.TYPE_ERROR,message:m({label:this.DHCP,ip:n[l.DHCP_ADDY],cidr:n[l.NETWORK_ADDY]+"/"+n[l.PREFIX_LENGTH]})});if(n[l.DEFAULT_GATEWAY]&&!this.validateIpInBlock(n[l.DEFAULT_GATEWAY],n[l.NETWORK_ADDY],n[l.PREFIX_LENGTH]))return void this.triggerAction(a.MODAL.ACT.ALERT_SHOW,{type:a.MODAL.ALERT.TYPE_ERROR,message:m({label:this.GATEWAY,ip:n[l.DEFAULT_GATEWAY],cidr:n[l.NETWORK_ADDY]+"/"+n[l.PREFIX_LENGTH]})});if(this.$(".chkDomainSettings").is(":checked")){var g=this.$(".domainSearch").val().trim(),E=this.$(".domainName").val().trim(),T=void 0;if(!_.isEmpty(g)){T=g.split(",");for(var C=0;C<T.length;C++)if(!o.validDomainHostName(T[C].trim()))return void this.triggerAction(a.MODAL.ACT.ALERT_SHOW,{type:a.MODAL.ALERT.TYPE_ERROR,message:this.i18n("error_domain_name_invalid",this.ERROR_DOMAIN_NAME_INVALID)})}if(!_.isEmpty(E)&&!o.validDomainHostName(E))return void this.triggerAction(a.MODAL.ACT.ALERT_SHOW,{type:a.MODAL.ALERT.TYPE_ERROR,message:this.i18n("error_domain_name_invalid",this.ERROR_DOMAIN_NAME_INVALID)});_.each(s[s.IP_CONFIG][s.DHCP_OPTIONS],function(t){"string"==typeof t&&(c=e.$("."+t),""!==c.val().trim()&&(n[s.DHCP_OPTIONS][t]=c.val()))})}}if(this.ipPools.length>0){n.pool=[];var S=null;if(_.each(this.ipPools,function(t){var i=null;if(e.validateIpInBlock(t[0],n[l.NETWORK_ADDY],n[l.PREFIX_LENGTH])?e.validateIpInBlock(t[1],n[l.NETWORK_ADDY],n[l.PREFIX_LENGTH])||(i=t[1]):i=t[0],!S&&i&&(S=m({label:e.POOL,ip:i,cidr:n[l.NETWORK_ADDY]+"/"+n[l.PREFIX_LENGTH]})),n[s.POOL].push({range:t[0]+" "+t[1]}),!S&&n[l.DEFAULT_GATEWAY]){var a=o.strToLongIP(t[0]),r=o.strToLongIP(t[1]),c=o.strToLongIP(n[l.DEFAULT_GATEWAY]);c>=a&&c<=r&&(S="Default gateway address cannot lie within an IP address pool.")}}),S)return void this.triggerAction(a.MODAL.ACT.ALERT_SHOW,{type:a.MODAL.ALERT.TYPE_ERROR,message:S})}t.set(t.DP.IP_CONFIG,n)}return t},createOrUpdateNetwork:function(){var e=this,n=this.generateModelFromForm();n&&(n.actionMode=this.mode,this.mode===a.ACTION_UPDATE&&(n.set(t.UUID,this.currentNetworkModel.get(t.UUID)),n.set(i.DP.LOGICAL_TIMESTAMP,this.currentNetworkModel.get(i.DP.LOGICAL_TIMESTAMP))),n.save(null,{success:function(t,i){e.createMode?s.triggerAppEvent(s.ENTITIES_CREATED,{entityType:a.ENTITY_ACROPOLIS_NETWORK,entity:n}):e.showNetworkList(),e.callbackCreateOrUpdateNetworkSuccess(i)},error:function(t,n){e.triggerAction(a.MODAL.ACT.ALERT_SHOW,{type:a.MODAL.ALERT.TYPE_ERROR,message:"Error creating network: ",details:n.responseText||n})}}))},addIpPool:function(e){var t=void 0,n=void 0;if(e){var i=e.split(" ");if(2!==i.length)return void o.log("AcropolisNetworkConfigurationView: addIpPool: InvalidipPool format: "+e);t=i[0],n=i[1]}else t=this.$(".startAddressInput").val().trim(),n=this.$(".endAddressInput").val().trim();this.ipPools.push([t,n])},editIpPool:function(){var e=this.$(".startAddressInput").val().trim(),t=this.$(".endAddressInput").val().trim();this.ipPools[this.currentIpPoolIndex]=[e,t]},deleteAcropolisNetwork:function(e){var t=this;if(!this.networks||!this.networks.models||!this.networks.get(e))return void o.log("AcropolisNetworkConfigurationView : Network id "+e+" is not valid");var n=this.networks.get(e);n.setProxyClusterUuid(this.proxyClusterUuid),n.destroy({success:function(e,n){t.listNetwork()},error:function(e,n){t.triggerAction(a.MODAL.ACT.ALERT_SHOW,{type:a.MODAL.ALERT.TYPE_ERROR,message:n.responseText})}})},deleteIpPool:function(e,t){for(var n=[],i=0;i<this.ipPools.length;++i)this.ipPools[i][0]===e&&this.ipPools[i][1]===t||n.push([this.ipPools[i][0],this.ipPools[i][1]]);this.ipPools=n,this.showConfiguredIpPools()},validateForm:function(){var e=this.$("#acropolisNetworkForm"),t=r.validateFormValues(e);if(t.length){return r.defaultErrorHandler(e,t)}var n=this.$(".vlanID").val().trim();return n?o.isNonNegativeInt(Number(n))?this._validateDomainFields([{name:"domainSearch",selector:".domainSearch"},{name:"domainNameServers",selector:".domainNameServers"}])||!1:this.i18n("error_vlanid_invalid",this.ERROR_VLANID_INVALID):this.i18n("error_vlanid_required",this.ERROR_VLANID_REQUIRED)},_validateDomainFields:function(e){for(var t=e.length;t--;){var n=e[t],i=this.$(n.selector).val().trim();if(i)for(var s=i.split(","),a=s.length;a--;){var r=s[a].trim();if(o.isASCII(r)){if(!o.isValidIP(r)&&!o.isValidDomainName(r))return this.i18n("error_"+n.name.toLowerCase()+"_invalid")}else if(r.indexOf(" ")>-1||r.split(".")<2)return this.i18n("error_"+n.name.toLowerCase()+"_invalid")}}return null},validateIpInputs:function(){var e=this.$(".startAddressInput").val().trim(),t=this.$(".endAddressInput").val().trim(),n=o.strToLongIP(e),i=o.strToLongIP(t),s="";return _.isEmpty(e)||_.isEmpty(t)?s=this.i18n("error_empty_address",this.ERROR_EMPTY_ADDRESS):isNaN(n)?s=this.i18n("error_invalid_start_address",this.ERROR_INVALID_START_ADDRESS):isNaN(i)?s=this.i18n("error_invalid_end_address",this.ERROR_INVALID_END_ADDRESS):i<=n&&(s=this.i18n("error_end_vs_start",this.ERROR_END_VS_START)),!s||(this.triggerAction(a.MODAL.ACT.ALERT_SHOW,{type:a.MODAL.ALERT.TYPE_ERROR,message:s}),!1)},validateIpInBlock:function(e,t,n){if(e&&e.length&&t&&t.length&&n&&n.length){var i=parseInt(n,10);return o.isIpInRange(e,t,i)}return!0},ipPoolFormSaveClick:function(){this.validateIpInputs()&&(this.ipPoolMode===a.ACTION_CREATE?this.addIpPool():this.editIpPool(),this.ipPoolMode=null,this.currentIpPoolIndex=null,this.showNetworkForm(this.mode,!0,!1),this.parentView.scrollToBottom())},toggleManagedNetworkSettings:function(){var e=this,t=this.$("#managedNetworkSettingsContainer");this.$(t).slideToggle("fast",function(){e.triggerAction(a.MODAL.ACT.AS_REBUILD)})},toggleDomainSettings:function(){var e=this,t=this.$("#domainSettingsContainer");this.$(t).slideToggle("fast",function(){e.triggerAction(a.MODAL.ACT.AS_REBUILD)})},toggleDhcpServerSettings:function(){var e=this,t=this.$("#dhcpServerContainer");this.$(t).slideToggle("fast",function(){e.$(t).is(":visible")&&e.parentView.scrollToElement(t,".n-modal-content-wrapper")})},setCheckboxes:function(){var e=i.DP,t=e[e.IP_CONFIG];this.$(".chkDomainSettings").prop("checked",!0),this.$("#domainSettingsContainer").show(),this.mode===a.ACTION_UPDATE&&this.currentNetworkModel.getIpConfigAttr(t.DHCP_ADDY)&&(this.$(".chkManagedNetwork").prop("checked",!0),this.$("#managedNetworkSettingsContainer").removeClass("hide"),this.$(".chkDhcpServer").prop("checked",!0),this.$("#dhcpServerContainer").removeClass("hide"))},resetCheckboxes:function(){this.$(".chkManagedNetwork").is(":checked")&&this.$(".chkManagedNetwork").click(),this.$(".chkDomainSettings").is(":checked")||this.$(".chkDomainSettings").click(),this.$(".chkDhcpServer").is(":checked")&&this.$(".chkDhcpServer").click()},isCurrentFormDirty:function(){var e=this.generateModelFromForm();return!e||(this.mode===a.ACTION_UPDATE?!this.currentNetworkModel.isEqual(e):!(new i).isEqual(e))},onSaveClick:function(){if(this.triggerAction(a.MODAL.ACT.ALERT_HIDE),this.$("#ipPoolForm").is(":visible"))this.ipPoolFormSaveClick();else{var e=this.validateForm();e?this.triggerAction(a.MODAL.ACT.ALERT_SHOW,{type:a.MODAL.ALERT.TYPE_ERROR,message:e}):this.createOrUpdateNetwork()}},onEnterKeyPress:function(){this.onSaveClick()},onMouseOverErrorDetails:function(e){var t=$(e.currentTarget),n=t.attr("tooltip"),i=void 0;$.trim(n).length&&(i=t.tooltip({title:n,placement:"bottom",trigger:"manual",html:"true",container:$("body")}),i.tooltip("show"))},onMouseOutErrorDetails:function(e){$(e.currentTarget).tooltip("destroy")},onCloseClick:function(){this.hide()},onBackClick:function(){if(!$("#ipPoolForm").is(":visible"))return this.createMode||(this.showNetworkList(),this.triggerAction(a.MODAL.ACT.SET_TITLE,"Network Interfaces"),this.triggerAction(a.MODAL.ACT.TABS_SHOW)),this.createMode;this.currentIpPoolIndex=null,this.showNetworkForm(null,!0,!1)},onCreateClick:function(){this.showNetworkForm(a.ACTION_CREATE,!0,!0),this.triggerAction(a.MODAL.ACT.TABS_HIDE)},onDeleteNetwork:function(e){var t=$(e.currentTarget).closest(".cell-actions").data(),n=t.networkId,i=t.vlanId;this.triggerAction(a.MODAL.ACT.ALERT_HIDE),$.nutanixConfirm({msg:"Are you sure you want to delete<br>network "+i+"?",yes:function(){this.deleteAcropolisNetwork(n)},context:this})},onEditNetwork:function(e){var t=this;this.triggerAction(a.MODAL.ACT.ALERT_HIDE);var n=$(e.currentTarget).closest(".cell-actions").data("network-id");this.parentView.showSubview(".n-modal-loading",null,!1),this.currentNetworkModel=new i,this.currentNetworkModel.setProxyClusterUuid(this.proxyClusterUuid),this.currentNetworkModel.set(this.currentNetworkModel.idAttribute,n),this.currentNetworkModel.fetch({success:function(){t.showNetworkForm(a.ACTION_UPDATE,!0,!0),t.triggerAction(a.MODAL.ACT.TABS_HIDE),t.parentView.scrollToTop(!0)}})},onDeleteIpPool:function(e){var t=$(e.currentTarget).closest("td"),n=t.attr("startAddress"),i=t.attr("endAddress");$.nutanixConfirm({msg:"Are you sure you want to delete the IP pool starting at "+n+" and ending at "+i+"?",yes:function(){this.deleteIpPool(n,i)},context:this})},onEditIpPool:function(e){this.triggerAction(a.MODAL.ACT.ALERT_HIDE);$(e.currentTarget).attr("startAddress");this.ipPoolMode=a.ACTION_UPDATE,this.showIpPoolForm(e)},onCreateIpAddrPoolClick:function(){this.ipPoolMode=a.ACTION_CREATE,this.showIpPoolForm(),this.parentView.scrollToTop(!0)},onManagedNetworkClick:function(){this.toggleManagedNetworkSettings()},onDomainSettingsClick:function(){this.toggleDomainSettings()},onDhcpServerClick:function(){this.toggleDhcpServerSettings()}})}),define("models/network/CVMNetworkInterfaceModel",["models/BaseModel","data/DataProperties","utils/AppConstants"],function(e,t,n){"use strict";var i,s=[n.SEGM.NW.SERVICE_NAME.DR,n.SEGM.NW.SERVICE_NAME.ABS];return e.extend({defaults:(i={},_defineProperty(i,t.CVMNI.NAME,null),_defineProperty(i,t.CVMNI.INTERFACE_TYPE,null),_defineProperty(i,t.CVMNI.SUBNET_MASK,null),_defineProperty(i,t.CVMNI.VLAN_ID,null),_defineProperty(i,t.CVMNI.PFC,null),_defineProperty(i,t.CVMNI.SUBNET_IP,null),_defineProperty(i,t.CVMNI.HOST_NW_INFOS,null),i),idAttribute:t.CVMNI.INTERFACE_TYPE,DP:t.CVMNI,getDisplayVlanId:function(){return this.get(t.CVMNI.VLAN_ID)},getPFC:function(){return this.get(t.CVMNI.PFC)},getDisplayName:function(){return this.escape(t.CVMNI.NAME)},getDisplayIPPool:function(){return this.escape(t.CVMNI.IP_POOL)},getDisplaySubnetMask:function(){return this.get(t.CVMNI.SUBNET_MASK)},getDisplayFeatures:function(){var e=this.get(t.CVMNI.SERVICE_ID),i=Object.keys(n.SEGM.NW.SERVICE_NAME);return e.map(function(e){
return i[e]})},getServiceIds:function(){return this.get(t.CVMNI.SERVICE_ID).map(function(e){return s[e]})},getDisplayVirtualIP:function(){return this.get(t.CVMNI.VIRTUAL_IP)},getDisplayHostPhysicalNetwork:function(){return this.get(t.CVMNI.HOST_PHYSICAL_NETWORK)},getSubnetMask:function(){return this.escape(t.CVMNI.SUBNET_MASK)},getSubnetIp:function(){return this.escape(t.CVMNI.SUBNET_IP)},getInterfaceType:function(){return this.escape(t.CVMNI.INTERFACE_TYPE)},getHostNetworkInfos:function(){return this.get(t.CVMNI.HOST_NW_INFOS)},getNetworkSegmentationHostInfos:function(){return this.get(t.CVMNI.SEGM_HOST_NW_INFOS)},isEqual:function(e){return!!this.isPropertiesEqual(this.get(t.CVMNI.VLAN_ID),e.get(t.CVMNI.VLAN_ID))&&(!!this.isPropertiesEqual(this.get(t.CVMNI.SUBNET_IP),e.get(t.CVMNI.SUBNET_IP))&&!!this.isPropertiesEqual(this.get(t.CVMNI.SUBNET_MASK),e.get(t.CVMNI.SUBNET_MASK)))},isPropertiesEqual:function(e,t){return 0!==e&&0!==t&&!e&&!t||e===t},showSuccessNotification:function(e,t,n){},showErrorNotification:function(e,t,n){},showLatencyNotification:function(e,t){}})}),define("models/network/NetworkSeparationModel",["models/genesis/GenesisBaseModel","utils/AppConstants"],function(e,t){"use strict";var n={NW_PARAM:"nw_param",NW_CONFIG:"network_config",NW_TYPE:"nw_type",TIMEOUT_SECS:"timeout_secs",POOL_NAME:"pool_name",IP_RANGE:"ip_range",IP_RANGES:"ip_ranges",NETMASK:"netmask",HOST_PHYSICAL_NETWORK:"host_physical_network",VLAN:"vlan",GATEWAY:"gateway",VIRTUAL_IP:"vip",CLIENT_SUBNET:"client_subnet",PARAMS:"params",SERVICE_NAME:"service_name",INTERFACE_NAME:"interface_name",IP_POOL:"ip_pool",DESC_NAME:"descriptive_name"};return e.extend({name:"NWSeparationModel",managerName:t.GENESIS.NETWORK_SEGMENTATION,initialize:function(t,n){if(e.prototype.initialize.apply(this,arguments),this.methodName=t.methodName,!this.methodName)throw new Error("Method name must be provided.")},setRPCParams:function(e){var i=e||{},s=i.networkInterface,a=i.nwType,o=i.timeoutSecs,r=i.poolName,l=i.ipRange,c=i.ipRanges,d=i.netmask,p=i.service,u=i.hostPhysicalNetwork,h=i.ipPool,m=i.vlanId,f=i.name,v=i.virtualIP,g=i.gateway,E=i.clientSubnet,T=i.interfaceName,C={};if(a)if(s){var S;C[n.NW_PARAM]=(S={},_defineProperty(S,n.NW_TYPE,a),_defineProperty(S,n.NW_CONFIG,{subnet:s.getSubnetIp(),netmask:s.getSubnetMask()}),S);var A=parseInt(s.getDisplayVlanId(),10);if(A&&(C[n.NW_PARAM][n.NW_CONFIG].vlan=A),a===t.SEGM.NW.TYPES.RDMA){var b=parseInt(s.getPFC(),10);C[n.NW_PARAM][n.NW_CONFIG].pfc=b}}else if(this.methodName===t.SEGM.NW.ACTIONS.ENABLE&&a===t.SEGM.NW.TYPES.SERVICE){var y,I,w=(y={},_defineProperty(y,n.SERVICE_NAME,p),_defineProperty(y,n.HOST_PHYSICAL_NETWORK,u),_defineProperty(y,n.IP_POOL,h),_defineProperty(y,n.DESC_NAME,f),y);null!==m&&(w[n.VLAN]=m),v&&(w[n.VIRTUAL_IP]=v),E&&(w[n.CLIENT_SUBNET]=E),g&&(w[n.GATEWAY]=g),C[n.NW_PARAM]=(I={},_defineProperty(I,n.NW_TYPE,a),_defineProperty(I,n.NW_CONFIG,w),I)}else C[n.NW_TYPE]=a;r&&(C[n.POOL_NAME]=r),c&&(C[n.IP_RANGES]=c),l&&(C[n.IP_RANGE]=l),d&&(C[n.NETMASK]=d),o&&(C[n.TIMEOUT_SECS]=o),T&&(C[n.PARAMS]=_defineProperty({},n.INTERFACE_NAME,T)),!f&&p&&(C[n.PARAMS]=_defineProperty({},n.SERVICE_NAME,p)),_.extend(this.kwargs,C)}})}),define("models/network/CVMNetworkInterfaceCollection",["models/BaseCollection","models/hardware/HostCollection","models/network/CVMNetworkInterfaceModel","models/network/NetworkSeparationModel","data/DataURLConstants","data/DataProperties","utils/AppConstants","utils/AppUtil"],function(e,t,n,i,s,a,o,r){"use strict";var l={RDMA:"RDMA",MANAGEMENT_LAN:"Management LAN",HYPERVISOR_LAN:"Hypervisor LAN",BACKPLANE_LAN:"Backplane LAN"};return e.extend({model:n,url:s.MGMT_NETWORK_INTERFACE,name:"CVMNetworkInterfaceCollection",comparator:function(e,t){return e.get(e.DP.INTERFACE_TYPE)>t.get(t.DP.INTERFACE_TYPE)?-1:1},getHypervisorLanInfo:function(){var e,t,i=[];return i.push((e={},_defineProperty(e,a.CVMNI.HOST_IP,o.ETHERNET_1.HOST_IP),_defineProperty(e,a.CVMNI.CVM_IP,o.ETHERNET_1.CVM_IP),e)),new n((t={},_defineProperty(t,a.CVMNI.NAME,l.HYPERVISOR_LAN),_defineProperty(t,a.CVMNI.INTERFACE_TYPE,o.INTERFACE_TYPES.ETH1),_defineProperty(t,a.CVMNI.HOST_NW_INFOS,i),t))},_getHostNetworkInfos:function(e,t){var n=this,i=[];return e.each(function(e){var s,o=n.model.prototype.DP,r=(s={},_defineProperty(s,o.CVM_IP,e.get(a.SERVICE_VM_IP)),_defineProperty(s,o.HOST_IP,e.get(a.HYPERVISOR_IP)),_defineProperty(s,o.HOST_NAME,e.get(a.NAME)),s);t&&(r[n.model.prototype.DP.VNIC_IP]=n._getVNicIP(e.get(a.SERVICE_VM_ID),t)),i.push(r)}),i},_getVNicIP:function(e,t){var n=parseInt(r.getDisplayableId(e),10),i=_.find(t,function(e){return e.service_vm_id===n});return i?i.ip:o.DATA_NOT_AVAILABLE},_getSegmentationHostNWInfos:function(e){var t=this,n=[];return e.each(function(e){var i;n.push((i={},_defineProperty(i,t.model.prototype.DP.RDMA_IP,e.get(a.RDMA_IP)),_defineProperty(i,t.model.prototype.DP.CVM_BACKPLANE_IP,e.get(a.CVM_BACKPLANE_IP)),_defineProperty(i,t.model.prototype.DP.BACKPLANE_IP,e.get(a.BACKPLANE_IP)),_defineProperty(i,t.model.prototype.DP.HOST_NAME,e.get(a.NAME)),i))},this),n},_getVlanId:function(e){return e.vlan_id},_getServiceIds:function(e){return _.pluck(e.services,a.NAME)},getManagementLanInfo:function(e){var t;return new n((t={},_defineProperty(t,a.CVMNI.NAME,l.MANAGEMENT_LAN),_defineProperty(t,a.CVMNI.INTERFACE_TYPE,o.INTERFACE_TYPES.ETH0),_defineProperty(t,a.CVMNI.VLAN_ID,""),_defineProperty(t,a.CVMNI.HOST_NW_INFOS,this._getHostNetworkInfos(e)),t))},getNWSegmentationInfo:function(e,t,i){var s;if(!e||!_.first(e))return null;var r=(s={},_defineProperty(s,a.CVMNI.NAME,l[i?"RDMA":"BACKPLANE_LAN"]),_defineProperty(s,a.CVMNI.INTERFACE_TYPE,o.INTERFACE_TYPES[i?"ETHR":"ETH2"]),_defineProperty(s,a.CVMNI.SEGM_HOST_NW_INFOS,this._getSegmentationHostNWInfos(t)),_defineProperty(s,a.CVMNI.SUBNET_IP,e[0]),_defineProperty(s,a.CVMNI.SUBNET_MASK,e[1]),_defineProperty(s,a.CVMNI.VLAN_ID,e[2]),s);return i&&(r[a.CVMNI.PFC]=e[3]),new n(r)},getServiceInterfaceModel:function(e,t){var i,s=(i={},_defineProperty(i,a.CVMNI.NAME,e.descriptive_name),_defineProperty(i,a.CVMNI.INTERFACE_TYPE,e.name),_defineProperty(i,a.CVMNI.VLAN_ID,this._getVlanId(e)),_defineProperty(i,a.CVMNI.IP_POOL,e.ip_pool),_defineProperty(i,a.CVMNI.SUBNET_MASK,e.netmask),_defineProperty(i,a.CVMNI.SERVICE_ID,this._getServiceIds(e)),_defineProperty(i,a.CVMNI.VIRTUAL_IP,e.vip),_defineProperty(i,a.CVMNI.HOST_PHYSICAL_NETWORK,e.host_physical_network),_defineProperty(i,a.CVMNI.HOST_NW_INFOS,this._getHostNetworkInfos(t,e.vnicinfo)),i);return new n(s)},fetch:function(){var e=this,n=$.Deferred(),s=new i({methodName:o.SEGM.NW.ACTIONS.CONFIG});s.setRPCParams({nwType:o.SEGM.NW.TYPES.BP});var a=new i({methodName:o.SEGM.NW.ACTIONS.CONFIG});a.setRPCParams({nwType:o.SEGM.NW.TYPES.RDMA});var r=new i({methodName:o.SEGM.NW.ACTIONS.CONFIG});r.setRPCParams({nwType:o.SEGM.NW.TYPES.SERVICE});var l=new t;return $.whenAll.apply($,[s.save(),a.save(),r.save(),l.fetch()]).done(function(){var t=e.getHypervisorLanInfo(),i=e.getManagementLanInfo(l);if(!s.hasErrorResponse()){var o=e.getNWSegmentationInfo(s.getReturnResponse(),l);null!==o&&e.add(o)}if(!a.hasErrorResponse()){var c=e.getNWSegmentationInfo(a.getReturnResponse(),l,!0);null!==c&&e.add(c)}if(!r.hasErrorResponse()){((r.getReturnResponse()||{}).interface_list||[]).map(function(t){return e.getServiceInterfaceModel(t,l)}).forEach(function(t){e.add(t)})}e.add(t),e.add(i),n.resolve(e,"")}),n.promise()}})}),define("text!templates/popups/network/CVMNetworkInterfaceItemView.html",[],function(){return'<tr class="n-table-row <%= hasViewLink ? \'\' : \'not-enabled\' %>" data-id="<%= interfaceType %>">\n  <td class="name-cell">\n    <% if (hasViewLink) { %>\n      <a class="viewLink"\n        data-test="view_<%= interfaceType %>"\n        action="<%= isServiceInterface ? AppConstants.ACTION_EDIT : AppConstants.ACTION_VIEW %>"\n        actionTarget="<%= AppConstants.ENTITY_CVM_INTERFACE %>"\n        actionTargetId="<%= interfaceType %>">\n    <% } %>\n    <%- name %>\n    <% if (hasViewLink) { %>\n      </a>\n    <% } %>\n\n    <% if (interfaceType !== appConstants.INTERFACE_TYPES.ETH1) { %>\n    <span class="interface-info-tooltip <%= interfaceType %>"></span>\n    <% } %>\n  </td>\n  <td class="interface-cell">\n    <%= interfaceType %>\n  </td>\n  <td class="cell-actions">\n    <%= rowAction %>\n  </td>\n</tr>'}),define("text!templates/popups/network/CVMNetworkInterfaceView.html",[],function(){return"<div class=\"network-config-content section-content listContainer\"\n  style=\"display:none;\">\n  <section data-ntnx-section=\"type-text\" class=\"nonStandardSeg hide\">\n    <%= i18n('non_standard_nw_seg_banner') %>\n  </section>\n  <% if (nsEnabled) { %>\n    <section data-ntnx-section>\n      <%= Components.button({\n        text: i18n('new_interface'),\n        extraAttr: [\n          {\n            key: 'action',\n            value: AppConstants.ACTION_CREATE\n          },\n          {\n            key: 'actionTarget',\n            value: AppConstants.ENTITY_CVM_INTERFACE\n          }\n        ],\n        isPrimary: true,\n        extraClasses: 'btnCreate pull-right',\n        dataTestAttribute: 'btnCreateCvmInterface'\n      }) %>\n    </section>\n  <% } %>\n  <section data-ntnx-section class=\"network-controls\">\n    <table id=\"cvmNetworkInterfaceList\" class=\"table table-hover\"\n      data-test=\"interfaceListTable\">\n      <thead>\n      <tr>\n        <th><%= i18n('interface_name') %></th>\n        <th><%= i18n('interface_type') %></th>\n      </tr>\n      </thead>\n      <tbody>\n        \x3c!-- @view: CVM networks go here... --\x3e\n      </tbody>\n    </table>\n  </section>\n</div>\n"}),define("views/popups/network/CVMNetworkInterfaceView",["views/basecomponents/popups/BasePopupSubView","models/network/CVMNetworkInterfaceCollection","models/network/CVMNetworkInterfaceModel","models/network/NetworkSeparationModel","models/task/TaskCollection","utils/AppConstants","utils/VisualizationUtil","utils/HypervisorUtil","utils/ManagerMixin","managers/ActionManager","events/AppEvents","text!templates/popups/network/CVMNetworkInterfaceItemView.html","text!templates/popups/network/CVMNetworkInterfaceView.html"],function(e,t,n,i,s,a,o,r,l,c,d,p,u){"use strict";var h=_.template(u),m=_.template(p),f=_.template('<a\n      class="<%= disabled ? \'disabled hoverTooltipContainer\' : action %>"\n      title="<%= disabled ? tooltipText : \'\'%>"\n      data-test="<%= action %>_<%= actionTargetId %>"\n      action="<%= action %>"\n      actionTarget="'+a.ENTITY_CVM_INTERFACE+'"\n      actionTargetId="<%= actionTargetId %>">\n      <%= actionName %>\n    </a>'),v=_.template('<a class="disableRDMA"><%= actionName %></a>');return e.extend({name:"CVMNetworkInterfaceView",events:{"click .enable":"onPopupClick","click .delete":"onDeleteInterface","click .disable":"onDisableInterface","click .btnCreate":"onPopupClick","click .viewLink":"onPopupClick","click .disableRDMA":"onRDMADisable","mouseenter .hoverTooltipContainer":"onHoverTooltipContainer","mouseleave .hoverTooltipContainer":"offHoverTooltipContainer"},render:function(){this.$el.html(h(this.vtOptions({nsEnabled:this.isNetworkSegmentationEnabled(),canModify:this.canModifyByEntityType(a.ENTITY_CVM_NETWORK_INTERFACE)}))),this._showSegmentationStatus()},destroy:function(){this.$(".interface-info-tooltip").nutanixMoreInfo("destroy"),e.prototype.destroy.apply(this,arguments)},showView:function(){this.$(".listContainer").show(),e.prototype.showView.apply(this,arguments)},hideView:function(){this.isBackplaneEnabled||this.triggerAction(a.MODAL.ACT.ALERT_HIDE),e.prototype.hideView.apply(this,arguments)},isNetworkSegmentationEnabled:function(){if(this.clusterManager.isOneNodeCluster()||this.clusterManager.isTwoNodeCluster()||this.clusterManager.isMulticlusterNavMode())return!1;var e=this.clusterManager.getCurrentClusterModel();return e&&e.isFFEnabled(a.FFLAGS.NETWORK_SEGMENTATION)&&!r.hasHyperV()},populateInterfaceListTable:function(){var e=this;this.networks=new t,this.parentView.showSubview(".n-modal-loading"),this.networks.fetch().done(function(){e.triggerAction(a.MODAL.ACT.ALERT_HIDE),e.parentView.showSubview("#cvmInterfaceContainer .listContainer",null,!0);var t=e.$("#cvmNetworkInterfaceList > tbody");t.empty();var i=$(),s=e.canModifyByEntityType(a.ENTITY_CVM_NETWORK_INTERFACE);if(!e.networks.filter(function(e){return e.id===a.INTERFACE_TYPES.ETH2}).length){var o=new n;o.set(o.idAttribute,a.INTERFACE_TYPES.ETH2),o.set("name",e.i18n("backplane_lan")),e.networks.add(o)}if(e.isRdmaCapable&&(!e.isRdmaEnabled||e.isRdmaProgress)&&!e.networks.filter(function(e){return e.id===a.INTERFACE_TYPES.ETHR}).length){var r=new n;r.set(r.idAttribute,a.INTERFACE_TYPES.ETHR),r.set("name",e.i18n("rdma")),e.networks.add(r)}e.$(".nonStandardSeg").addClass("hide"),e.networks.each(function(t){var n=$(e.getRow(t,s));e.addToolTip(n,t.id),i=i.add(n)}),t.append(i),e.parentView.$(".n-btn-form").hide(),e.parentView.$(".n-btn-list").show(),e.triggerAction(a.MODAL.ACT.SET_TITLE,e.i18n("network_configuration")),e.triggerAction(a.MODAL.ACT.TABS_SHOW),e.triggerAction(a.MODAL.ACT.COVER_HIDE),e.triggerAction(a.MODAL.ACT.AS_REBUILD)})},getRow:function(e,t){var n=e.getInterfaceType(),i=n===a.INTERFACE_TYPES.ETHR,s=!0,r="",c=!1;n===a.INTERFACE_TYPES.ETH2&&(this.isBackplaneEnabled?this.isBackplaneProgress&&(s=!1,r=this.i18n("enabling")):(s=!1,this.isBackplaneNonStandardConfig[0]?this.isBackplaneNonStandardConfig[1]?this.$(".nonStandardSeg").removeClass("hide"):l.getClusterManager().isOneNodeCluster()?(c=!0,r=f({action:a.ACTION_ENABLE,actionTargetId:n,actionName:this.i18n("configure"),disabled:c,tooltipText:this.i18n("disabled_by_platform")})):t&&(r=f({action:a.ACTION_ENABLE,actionTargetId:n,actionName:this.i18n("configure"),disabled:c})):this.triggerAction(a.MODAL.ACT.ALERT_SHOW,{type:a.MODAL.ALERT.TYPE_ERROR,message:this.isBackplaneNonStandardConfig[1]}))),i&&(this.isRdmaEnabled?r=v({actionName:this.i18n("disable")}):this.isRdmaProgress?(s=!1,this.pollTask(),r=o.renderProgressBar({widgetClass:"rdma-progress-bar"})):(s=!1,r=f({action:a.ACTION_ENABLE,actionTargetId:n,actionName:this.i18n("configure"),disabled:c})));var d=!_.find(a.INTERFACE_TYPES,function(e){return e===n});if(d){var p=e.getServiceIds().join("");r=f({action:a.ACTION_DISABLE,actionTargetId:p,actionName:this.i18n("disable"),disabled:!1})}return m(this.vtOptions({name:e.getDisplayName(),interfaceType:n,isServiceInterface:d,hasViewLink:s,appConstants:a,rowAction:r}))},pollTask:function(){var e=this;this.taskCollection||(this.taskCollection=new s,this.taskCollection.intervalTimeInMilliSec=1e3),this.taskCollection.on("reset",function(){var t=e.taskCollection.getTask(e.task_uuid);if(t){var n=t.isStatusComplete(),i=t.isStatusFailed();e.$(".n-progress-bar").width(t.getPercentageDisplay()),(n||i)&&(e.taskCollection.stopPolling(),e.triggerAction(a.MODAL.ACT.ALERT_SHOW,{type:a.MODAL.ALERT["TYPE_"+(i?"ERROR":"SUCCESS")],message:i?t.getErrorMessage():e.i18n("configuration_complete")}),e._showSegmentationStatus())}}),this.taskCollection.startPolling()},getToolTipInfo:function(){var e=this;return[["ETHR","tooltip_ethr"],["ETH0","tooltip_eth0"],["ETH2","tooltip_eth2"]].reduce(function(t,n){return t[a.INTERFACE_TYPES[n[0]]]=e.i18n(n[1]),t},{})},addToolTip:function(e,t){var n=this.getToolTipInfo();n[t]&&e.find("."+t).nutanixMoreInfo({placement:"right",title:n[t],trigger:"hover"})},onHoverTooltipContainer:function(e){var t=$(e.currentTarget);t.tooltip({container:$("body")}),t.tooltip("show")},offHoverTooltipContainer:function(e){$(e.currentTarget).tooltip("destroy")},confirmHide:function(e){this.$("#cvmNetworkInterfaceForm").is(":visible")&&this.mode===a.ACTION_ENABLE&&this.isCurrentBackplaneLanFormDirty()?$.nutanixConfirm({msg:this.i18n("unsaved_changes","You have unsaved changes. Are you sure you want to exit ?"),yes:e,yesText:this.i18n("yes"),noText:this.i18n("no")}):e()},onRDMADisable:function(e){e.preventDefault(),$.nutanixConfirm({msg:this.i18n("rdma_disable_confirm"),yes:this.disableRDMA.bind(this),yesText:this.i18n("yes"),noText:this.i18n("no")})},disableRDMA:function(){var e=new i({methodName:a.SEGM.NW.ACTIONS.DISABLE});e.setRPCParams({nwType:a.SEGM.NW.TYPES.RDMA}),this.triggerAction(a.MODAL.ACT.ALERT_SHOW,{type:a.MODAL.ALERT.TYPE_INFO,message:this.i18n("verification_in_progress")}),this.saveNWSeparationModel(e,!0)},saveNWSeparationModel:function(e,t){var n=this;this.triggerAction(a.MODAL.ACT.COVER_SHOW),e.save({success:function(){n.triggerActions([a.MODAL.ACT.ALERT_HIDE,a.MODAL.ACT.COVER_HIDE]);var t=e.getReturnResponse();t[0]?(n.triggerAction(a.MODAL.ACT.ALERT_SHOW,{type:a.MODAL.ALERT.TYPE_SUCCESS,message:n.i18n("verification_success")}),n.task_uuid=t[1]):n.triggerAction(a.MODAL.ACT.ALERT_SHOW,{type:a.MODAL.ALERT.TYPE_ERROR,message:n.i18n("verification_failed")+" "+t[1]}),n._showSegmentationStatus()},error:function(e,t){n.triggerAction(a.MODAL.ACT.COVER_HIDE),n.triggerAction(a.MODAL.ACT.ALERT_SHOW,{type:a.MODAL.ALERT.TYPE_ERROR,message:n.i18n("update_error")+t})}})},onPopupClick:function(e){var t=$(e.currentTarget).attr(a.NAV_ACTION),n=$(e.currentTarget).attr(a.NAV_ACTION_TARGET_ID),i=n===a.INTERFACE_TYPES.ETHR,s=null;t===a.ACTION_ENABLE?s=this.networks.get(a.INTERFACE_TYPES[i?"ETHR":"ETH2"]):t!==a.ACTION_VIEW&&t!==a.ACTION_EDIT||(s=this.networks.get(n)),t!==a.ACTION_CREATE&&d.onAppEventOnce(d.ASK_DATA,function(){d.triggerAppEvent(d.SEND_DATA,{model:s})}),c.executeActionElement(e.currentTarget)},onEnableSegmentation:function(e){var t=$(e.target).closest("tr").data("id"),n=t===a.INTERFACE_TYPES.ETHR,i=t?a.ACTION_ENABLE:a.ACTION_CREATE;this.currentNetworkInterfaceModel=this.networks.get(a.INTERFACE_TYPES[n?"ETHR":"ETH2"]),this.triggerAction(a.MODAL.ACT.ALERT_HIDE),this.triggerAction(a.MODAL.ACT.TABS_HIDE),this.showNetworkInterfaceForm(i),this.parentView.scrollToTop(!0),this.triggerAction(a.MODAL.ACT.AS_REBUILD)},onDeleteInterface:function(e){var t=this;$.nutanixConfirm({msg:this.i18n("delete_confirm"),yes:function(){var n=$(e.currentTarget).attr(a.NAV_ACTION_TARGET_ID),s=new i({methodName:a.SEGM.NW.ACTIONS.DELETE});s.setRPCParams({interfaceName:n}),t.triggerAction(a.MODAL.ACT.ALERT_SHOW,{type:a.MODAL.ALERT.TYPE_INFO,message:t.i18n("processing")}),t.saveNWSeparationModel(s)},class:"-compact -red-confirm",yesText:this.i18n("yes"),noText:this.i18n("no")})},onDisableInterface:function(e){var t=this;$.nutanixConfirm({msg:this.i18n("disable_confirm"),yes:function(){var n=$(e.currentTarget).attr(a.NAV_ACTION_TARGET_ID),s=new i({methodName:a.SEGM.NW.ACTIONS.DISABLE});s.setRPCParams({nwType:a.SEGM.NW.TYPES.SERVICE,service:n}),t.triggerAction(a.MODAL.ACT.ALERT_SHOW,{type:a.MODAL.ALERT.TYPE_INFO,message:t.i18n("processing")}),t.saveNWSeparationModel(s)},yesText:this.i18n("yes"),noText:this.i18n("no")})},_showSegmentationStatus:function(){var e=this;this.triggerAction(a.MODAL.ACT.COVER_SHOW);var t=[{name:"isBackplaneNonStandardConfig",method:a.SEGM.NW.ACTIONS.BP_NON_STANDARD_CONFIG,timeout:a.SEGM.NW.BP_TIME_OUT},{name:"isBackplaneEnabled",method:a.SEGM.NW.ACTIONS.CONFIG,type:a.SEGM.NW.TYPES.BP},{name:"isRdmaEnabled",method:a.SEGM.NW.ACTIONS.CONFIG,type:a.SEGM.NW.TYPES.RDMA},{name:"isBackplaneProgress",method:a.SEGM.NW.ACTIONS.CONFIG_IN_PROGRESS,type:a.SEGM.NW.TYPES.BP,statusIndex:0},{name:"isRdmaProgress",method:a.SEGM.NW.ACTIONS.CONFIG_IN_PROGRESS,type:a.SEGM.NW.TYPES.RDMA,statusIndex:0},{name:"isRdmaCapable",method:a.SEGM.NW.ACTIONS.RDMA_CAPABLE}].map(function(e){var t={},n=new i({methodName:e.method});return e.type&&(t.nwType=e.type),e.timeout&&(t.timeoutSecs=e.timeout),n.setRPCParams(t),{name:e.name,statusIndex:e.statusIndex,model:n}});$.whenAll.apply($,t.map(function(e){return e.model.save()})).done(function(){t.forEach(function(t){if(t.model.hasErrorResponse())e.triggerAction(a.MODAL.ACT.ALERT_SHOW,{type:a.MODAL.ALERT.TYPE_ERROR,message:t.model.responseText});else{var n=t.model.getReturnResponse(),i=t.statusIndex;e[t.name]=_.isNumber(i)?n[i]:n}}),e.populateInterfaceListTable()})}})}),define("text!templates/popups/network/NetworkConfigurationContentView.html",[],function(){return'\x3c!-- The parent div modal is #popupNetworkConfig --\x3e\n<div data-ntnx-content-inner>\n  <div class="n-modal-loading loading-msg-wrapper" data-ntnx-section>\n    <div class="donut-loader-blue"></div>\n    <span class="loading-msg"><%= i18n(\'loading\') %></span>\n  </div>\n  <% if (showTab) { %>\n    <div class="n-modal-tab-content-holder nw-popup-content">\n  <% } %>\n    <div id="cvmInterfaceContainer">\n      \x3c!---@view: cvm interface view goes here --\x3e\n    </div>\n  <% if (showTab) { %>\n    <div id="uvmInterfaceContainer">\n      \x3c!---@view: uvm interface view goes here --\x3e\n    </div>\n  <% } %>\n  <% if (showTab) { %>\n  </div>\n  <% } %>\n</div>\n'}),define("views/popups/network/NetworkConfigurationPopupView",["views/basecomponents/popups/BasePopupView","views/popups/network/AcropolisNetworkConfigurationView","views/popups/network/CVMNetworkInterfaceView","utils/AppConstants","utils/HypervisorUtil","utils/SubViewHelper","managers/AccessManager","managers/ClusterManager","managers/ActionManager","text!templates/popups/network/NetworkConfigurationContentView.html"],function(e,t,n,i,s,a,o,r,l,c){"use strict";c=_.template(c);return e.extend({name:"NetworkConfigurationPopupView",events:{"click .btnSave":"onSaveClick","click .btnBack":"onBackClick","click .btnCancel":"onBackClick","click .btnClose":"onCloseClick","click .modal-header .close":"hide","keypress input":"onKeyPress","click input":"clearHeader","mouseover .n-error-details":"onMouseOverErrorDetails","mouseout .n-error-details":"onMouseOutErrorDetails","click .n-modal-tab-header li button":"onSelectTab"},acropolisNetworkConfig:null,cvmNetworkInterfaceConfig:null,el:"#popupNetworkConfig",subViewHelper:null,fullPagePopup:!0,initialize:function(){e.prototype.initialize.apply(this,arguments),this.subViewHelper=new a},render:function(){var e=this.actionRoute&&this.actionRoute[i.NAV_ACTION]===i.ACTION_CREATE_NETWORK&&this.canModifyByEntityType(i.ENTITY_ACROPOLIS_NETWORK);this.showTabs=this.isTabView(),this.activeTab=this.showTabs?"uvm-interface":"cvm-interface";var t=this._getTabs(),n=this.canModifyByEntityType(i.ENTITY_NAME_SERVER),s=[{text:this.i18n("cancel"),extraClasses:"btnCancel btn n-btn-form hide"},{leftAligned:!1,text:this.i18n("back"),extraClasses:"btnBack btn n-btn-form hide"}];n&&s.push({isPrimary:!0,text:this.i18n("save"),extraClasses:"btnSave n-btn-form",extraAttr:[{key:"data-test",value:"networkBtnSave"},{key:"style",value:"display:none;"},{key:"data-loading-text",value:"Saving..."}]}),this.$el.html(this.defaultTemplate({title:this.i18n("network_configuration"),tabs:this.showTabs&&!e,tabsList:this.defaultTabs(t),antiscroll:!1,bodyContent:c(this.vtOptions({canModify:n,showTab:this.showTabs,selectedTab:this.activeTab})),footerButtons:this.defaultFooter(s)})),this.$el.closest(".main-body-wrapper").addClass("full-page-popup"),this.createTabViews(this.activeTab,{createMode:e}).showView()},reset:function(){this.clearHeader(),this.undelegateEvents()},destroy:function(){this.$el.closest(".main-body-wrapper").removeClass("full-page-popup"),this.subViewHelper.destroy(),e.prototype.destroy.apply(this,arguments)},showSubview:function(t,n,i){if(".n-modal-loading"===t){var s=this.$(".n-modal-content-wrapper").height();this.$(".n-modal-content-wrapper").css("height",s+"px")}else this.$(".n-modal-content-wrapper").css("height","auto"),this.$(".n-modal-loading").hide();this.$(".network-config-content").hide(),e.prototype.showSubview.apply(this,arguments)},createTabViews:function(e,s){if("uvm-interface"===e){var a=this,o=s&&s.createMode,l=r.isMulticlusterNavMode()?this.actionRoute[i.NAV_ACTION_PARENT_ID]:null,c=new t({el:this.$("#uvmInterfaceContainer"),callbackShowNetworkForm:function(e){a.showSubview("#uvmInterfaceContainer .network-form-wrapper","left",o),a.triggerAction(i.MODAL.ACT.SET_TITLE,i.ACTION_NAMES[e]+" "+i.ENTITY_NAMES[i.ENTITY_ACROPOLIS_NETWORK]),a.$(".n-btn-form").show(),a.$(".n-btn-list").hide(),a.$(".btnBack").hide(),a.$(".btnSave").html(a.i18n("save"))},callbackShowIpPoolForm:function(e){a.showSubview(".pool-form-wrapper","left",!1),a.triggerAction(i.MODAL.ACT.SET_TITLE,this.i18n(e?"edit_ip_pool":"add_ip_pool")),a.$(".btnSave").text(this.i18n("submit"))},callbackCreateOrUpdateNetworkSuccess:function(){o?a.hide():a.triggerAction(i.MODAL.ACT.TABS_SHOW)},createMode:o,proxyClusterUuid:l});return c.setParentView(this),this.subViewHelper.register("uvm-interface",c),c.render(),c}var d=new n({el:this.$("#cvmInterfaceContainer")});return this.cvmNetworkInterfaceConfig=d,d.setParentView(this),this.subViewHelper.register("cvm-interface",d),d.render(),d},isTabView:function(){var e=null;return e=r.isMulticlusterNavMode()?this.actionRoute[i.NAV_ACTION_PARENT_ID]:r.getCurrentClusterId(),!_.isNull(e)&&s.isAcropolisEnabledOnCluster(e)&&o.isFFEnabled(i.FFLAGS.UI_ACROPOLIS)},canChangeTab:function(){return"cvm-interface"===this.activeTab?!$("#cvmNetworkInterfaceForm").is(":visible"):!$("#ipPoolForm").is(":visible")&&!$("#acropolisNetworkForm").is(":visible")},confirmHide:function(e){var t=this.subViewHelper.get(this.activeTab);t&&t.confirmHide(e)},clearForm:function(){this.$('input[type="text"]').val(""),this.$("#ipPoolList > tbody").html("")},onSaveClick:function(e){var t=this.subViewHelper.get(this.activeTab);t&&t.onSaveClick(e)},onBackClick:function(e){var t=$(e.currentTarget),n=this.subViewHelper.get(this.activeTab);n&&n.onBackClick()&&t.hasClass("btnCancel")&&this.hide()},onCloseClick:function(){this.hide()},onEnterKeyPress:function(){var e=this.subViewHelper.get(this.activeTab);e&&e.onEnterKeyPress()},onMouseOverErrorDetails:function(e){var t=this.subViewHelper.get(this.activeTab);t&&t.onMouseOverErrorDetails(e)},onMouseOutErrorDetails:function(e){var t=this.subViewHelper.get(this.activeTab);t&&t.onMouseOverErrorDetails(e)},onSelectTab:function(e){if(this.canChangeTab()){var t=$(e.currentTarget).attr("data-target");if(t&&t!==this.activeTab){var n=this.subViewHelper.get(this.activeTab),s=this.subViewHelper.get(t);s||(s=this.createTabViews(t)),n.hideView(),s.showView(),this.activeTab=t,this.$(".n-modal-tab-header li").removeClass("active").filter(":has(.tab-"+t+")").addClass("active")}this.triggerAction(i.MODAL.ACT.AS_REBUILD)}},_getTabs:function(){return this.showTabs?[{isActive:!0,text:this.i18n("user_vm_interfaces"),extraClasses:"tab-uvm-interface",extraAttr:[{key:"data-target",value:"uvm-interface"},{key:"stream-action",value:"select"},{key:"stream-target",value:"uvm-interface list"},{key:"data-test",value:"tab_uvm_interface"}]},{text:this.i18n("controller_vm_interfaces"),extraClasses:"tab-cvm-interface",extraAttr:[{key:"data-target",value:"cvm-interface"},{key:"stream-action",value:"select"},{key:"stream-target",value:"cvm-interface list"},{key:"data-test",value:"tab_cvm_interface"}]}]:[]},hide:function(){e.prototype.hide.apply(this,arguments),this.actionRoute.fsPrecheckFlow&&l.executeAction({action:i.ACTION_CREATE,actionTarget:i.ENTITY_FILE_SERVER})}})}),define("text!templates/popups/network/CVMNetworkInterfaceEnableFormView.html",[],function(){return'<section data-ntnx-section class="segmentationForm" data-type="<%= type %>">\n  <p class="configBackPlane" style="display: none;">\n    <%= i18n(\'enable_backplane_msg\') %>\n  </p>\n  <table class="table readonly-table">\n    <tr>\n      <th><%= i18n(\'interface_name\') %></th>\n      <td class="cvm-interface-name"><%= name %></td>\n    </tr>\n    <tr>\n      <th><%= i18n(\'interface_type\') %></th>\n      <td class="interface-type"><%= type %></td>\n    </tr>\n  </table>\n  <section data-ntnx-section="type-separator">\n    <label data-ntnx-label><%= i18n(\'subnet_ip\') %></label>\n    <input type="text" placeholder="172.16.0.0"\n      class="subnet-ip" data-test="subnetIp">\n  </section>\n  <section data-ntnx-section>\n    <label data-ntnx-label><%= i18n(\'netmask\') %></label>\n    <input type="text" placeholder="255.255.252.0"\n      class="subnet-mask" data-test="subnetMask">\n  </section>\n  <section data-ntnx-section>\n    <label data-ntnx-label><%= i18n(\'vlan_id\') %></label>\n    <input type="text" class="vlan-id" data-test="vlanId">\n    <section data-ntnx-hint>\n      <%= i18n(\'enable_vlan\') %>\n    </section>\n  </section>\n  <% if (isRDMA) { %>\n    <section data-ntnx-section>\n      <label data-ntnx-label><%= i18n(\'pfc\') %></label>\n      <%= Components.select({\n        options: pfcValues,\n        jsClasses: \'pfc\',\n        variants: \'bottom-anchor\',\n        dataTestAttribute: \'pfc\'\n      }) %>\n    </section>\n  <% } %>\n</section>\n'}),define("text!templates/popups/network/CVMNetworkInterfaceContentView.html",[],function(){return'\x3c!-- The parent div modal is #popupCvmInterface --\x3e\n<div data-ntnx-content-inner>\n  <div class="n-modal-loading loading-msg-wrapper subview" data-ntnx-section>\n    <div class="donut-loader-blue"></div>\n    <span class="loading-msg"><%= i18n(\'loading\') %></span>\n  </div>\n  <div id="cvmNetworkInterfaceForm" class="form-horizontal subview"></div>\n  <div id="backplaneLanForm" class="form-horizontal subview"></div>\n  <div id="ipPoolForm" class="subview"></div>\n  <div id="ipRangeForm" class="subview"></div>\n  <div id="featureForm" class="subview"></div>\n</div>\n'}),define("text!templates/popups/network/CVMNetworkSegmentationForm.html",[],function(){return'<% if (isRDMA) { %>\n  <section data-ntnx-section="type-text">\n    <%= i18n(\'note\') %>\n    <%= i18ns(\n      \'rdma_modify\',\n      \'<a href="" class="disableRDMA">\' + i18n(\'rdma_disable\') + \'</a>\'\n    ) %>\n  </section>\n<% } %>\n<section data-ntnx-section\n  data-test="backplane_table_details">\n  <table class="table">\n    <tr>\n      <th><%= i18n(\'interface_name\') %></th>\n      <td class="cvm-interface-name"><%= name %></td>\n    </tr>\n    <tr>\n      <th><%= i18n(\'interface_type\') %></th>\n      <td class="interface-type"><%= type %></td>\n    </tr>\n    <tr>\n      <th><%= i18n(\'subnet_ip\') %></th>\n      <td class="subnet-id"><%= subnetIp %></td>\n    </tr>\n    <tr>\n      <th><%= i18n(\'netmask\') %></th>\n      <td class="netmask"><%= subnetMask %></td>\n    </tr>\n    <tr>\n      <th><%= i18n(\'vlan_id\') %></th>\n      <td class="vlan-id"><%= vlanId %></td>\n    </tr>\n    <% if (isRDMA) { %>\n    <tr>\n      <th><%= i18n(\'pfc\') %></th>\n      <td class="pfc"><%= pfc %></td>\n    </tr>\n    <% } %>\n  </table>\n</section>\n\n<section data-ntnx-section="type-separator">\n  <div class="table-items table -interface" id="hostInfosTable"\n    data-test="interface_host_table">\n    \x3c!-- @view: Table Contents --\x3e\n  </div>\n</section>\n'}),define("text!templates/popups/network/CVMNetworkInterfaceForm.html",[],function(){return'<section data-ntnx-section>\n  <label data-ntnx-label>\n    <%= i18n(\'interface_name\') %>\n  </label>\n  <input type="text" class="interfaceName"\n    model-attribute="<%= i18n(\'interface_name\') %>"\n    model-validate="required"\n    data-test="interface_name">\n</section>\n<section data-ntnx-section>\n  <label data-ntnx-label>\n    <%= i18n(\'vlan_id\') %>\n  </label>\n  <input type="text" class="vlanId" data-test="vlan_id">\n  <div data-ntnx-hint>\n    <%= i18n(\'vlan_hint\') %>\n  </div>\n</section>\n<section data-ntnx-section>\n  <label data-ntnx-label>\n    <%= i18n(isEsx ? \'cvm_port_group\' : \'host_port_group\') %>\n  </label>\n  <%= Components.select({\n    jsClasses: \'hostPortGroup\',\n    options: portGroupOptions,\n    useBrowserSelect: true,\n    dataTestAttribute: \'port_group\'\n  }) %>\n</section>\n<section data-ntnx-section class="ipPoolCtr">\n</section>\n'}),define("text!templates/popups/network/IPPoolList.html",[],function(){
return"<h5 data-ntnx-title>\n  <%= i18n('ip_pool') %>\n</h5>\n<div data-ntnx-form-inline>\n  <div data-ntnx-hint>\n    <%= i18n('ip_pool_hint') %>\n  </div>\n  <% if (ipPools.length) { %>\n    <a class=\"btnAddIpPool\"\n       data-test=\"ippoollist_button_add_ip_pool\">\n      <%= Components.icon('plus-small') %>\n      <%= i18n('create_ip_pool') %>\n    </a>\n  <% } %>\n</div>\n<section class=\"ipPoolList\" data-ntnx-section>\n  <% if (ipPools.length) { %>\n    <table class=\"table table-hover\"\n      data-test=\"ip_pool_table\">\n      <thead>\n        <th class=\"cell-name\"><%= i18n('pool_name') %></th>\n        <th><%= i18n('actions') %></th>\n      </thead>\n      <tbody>\n        <% _.each(ipPools, function (ipPool) { %>\n          <tr>\n            <td>\n              <%= Components.radio({\n                name: 'ipPool',\n                value: ipPool,\n                labelText: ipPool,\n                dataTestAttribute: 'select_ip_pool_' + ipPool\n              }) %>\n            </td>\n            <td class=\"cell-actions\">\n              <a actionTargetId=\"<%= ipPool %>\" class=\"editIpPool\"\n                data-test=\"edit_ip_pool_<%= ipPool %>\">\n                <%= i18n('edit') %>\n              </a>\n              <span class=\"n-separator\">\n              <a actionTargetId=\"<%= ipPool %>\" class=\"deleteIpPool\"\n                data-test=\"delete_ip_pool<%= ipPool %>\">\n                <%= i18n('delete') %>\n              </a>\n            </td>\n          </tr>\n        <% }) %>\n      </tbody>\n    </table>\n  <% } else { %>\n    <div data-ntnx-empty-list>\n      <section data-ntnx-section=\"type-text\">\n        <%= i18n('no_ip_pool') %>\n      </section>\n      <section data-ntnx-section>\n        <%= Components.button({\n          isPrimary: true,\n          iconLeft: 'plus',\n          extraClasses: 'btnAddIpPool',\n          text: i18n('create_ip_pool'),\n          dataTestAttribute: 'ippoollist_button_add_ip_pool'\n        }) %>\n      </section>\n    </div>\n  <% } %>\n  </section>\n"}),define("text!templates/popups/network/FeatureSelectionView.html",[],function(){return'<section data-ntnx-section>\n  <h5 data-ntnx-title data-test="feature_form">\n    <%= i18n(\'feature_select\') %>\n  </h5>\n</section>\n<section data-ntnx-section="type-subtitle">\n  <%= i18n(\'feature_select_hint\') %>\n</section>\n<section data-ntnx-section>\n  <div data-ntnx-form-inline class="feature">\n    <label><%= i18n(\'abs\') %></label>\n    <%= Components.switchInput({\n      id: \'featABS\',\n      value: false,\n      classes: \'featSwitch\',\n      variants: \'-blue\',\n      dataTestAttribute: \'feat_abs\'\n    }) %>\n  </div>\n  <% if (isDREnabled) { %>\n    <div data-ntnx-form-inline class="feature">\n      <label><%= i18n(\'dr\') %></label>\n      <%= Components.switchInput({\n        id: \'featDR\',\n        value: false,\n        classes: \'featSwitch\',\n        variants: \'-blue\',\n        dataTestAttribute: \'feat_dr\'\n      }) %>\n    </div>\n  <% } %>\n</section>\n<section data-ntnx-section class="feature-option hide">\n  <label data-ntnx-label>\n    <%= i18n(\'virtual_ip\') %>\n  </label>\n  <input type="text" class="virtualIp" data-test="feat_virtual_ip"\n    model-attribute="<%= i18n(\'virtual_ip\') %>"\n    model-validate="<%= AppConstants.VALIDATION_NAMES.IP_ADDRESS %>">\n  <div data-ntnx-form-inline>\n    <div data-ntnx-hint class="vipHint"></div>\n  </div>\n</section>\n<div class="n-clearfix feature-option hide">\n  <section data-ntnx-section="type-half">\n    <label data-ntnx-label>\n      <%= i18n(\'subnet_label\') %>\n    </label>\n    <input type="text" class="clientSubnet" data-test="feat_subnet">\n  </section>\n  <section data-ntnx-section="type-half">\n    <label data-ntnx-label>\n      <%= i18n(\'gateway\') %>\n    </label>\n    <input type="text" class="gateway" data-test="feat_gateway"\n      model-attribute="<%= i18n(\'gateway\') %>"\n      model-validate="<%= AppConstants.VALIDATION_NAMES.IP_ADDRESS %>">\n    <div data-ntnx-form-inline>\n      <div data-ntnx-hint class="gatewayHint">\n        <%= i18n(\'gw_hint\') %>\n      </div>\n    </div>\n  </section>\n</div>\n'}),define("text!templates/popups/network/IPPoolForm.html",[],function(){return'<section data-ntnx-section>\n  <label data-ntnx-label>\n    <%= i18n(\'pool_name\') %>\n  </label>\n  <input type="text" class="ipPoolName" value="<%= poolName || \'\' %>"\n    <%= editMode ? \'disabled\' : \'\' %>\n    model-attribute="<%= i18n(\'pool_name\') %>"\n    model-validate="required;entityName"\n    model-validate-args=";"\n    data-test="ip_pool_name">\n</section>\n<section data-ntnx-section>\n  <label data-ntnx-label>\n    <%= i18n(\'netmask\') %>\n  </label>\n  <input type="text" class="ipPoolNetmask" value="<%= netmask || \'\' %>"\n    <%= editMode ? \'disabled\' : \'\' %>\n    model-attribute="<%= i18n(\'netmask\') %>"\n    model-validate="required;<%= AppConstants.VALIDATION_NAMES.IP_ADDRESS %>"\n    model-validate-args=";"\n    data-test="ip_pool_netmask">\n</section>\n<section data-ntnx-section class="ipRangeCtr">\n  \x3c!-- IP Range section contents --\x3e\n</section>\n'}),define("text!templates/popups/network/IPRangeList.html",[],function(){return"<h5 data-ntnx-title>\n  <%= i18n('ip_ranges') %>\n  <% if (ipRanges.length) { %>\n    <a data-ntnx-title-link class=\"add_ip_range btnAddIpRange\">\n      <%= Components.icon('plus-small') %>\n      <%= i18n('add_ip_range') %>\n    </a>\n  <% } %>\n</h5>\n<section class=\"ipRangeList\" data-ntnx-section>\n  <% if (ipRanges.length) { %>\n    <table class=\"table table-hover\"\n      data-test=\"ip_range_table\">\n      <thead>\n        <th><%= i18n('start_ip') %></th>\n        <th><%= i18n('end_ip') %></th>\n        <th><%= i18n('actions') %></th>\n      </thead>\n      <tbody>\n        <% _.each(ipRanges, function (ipRange, index) { %>\n          <tr>\n            <td>\n              <%= ipRange.start %>\n            </td>\n            <td>\n              <%= ipRange.end %>\n            </td>\n            <td>\n              <a actionTargetId=\"<%= index %>\" class=\"deleteIpRange\"\n                data-test=\"delete_ip_range_<%= index %>\">\n                <%= i18n('delete') %>\n              </a>\n            </td>\n          </tr>\n        <% }) %>\n      </tbody>\n    </table>\n  <% } else { %>\n    <div data-ntnx-empty-list>\n      <section data-ntnx-section=\"type-text\">\n        <%= i18n('no_ip_range') %>\n      </section>\n      <section data-ntnx-section>\n        <%= Components.button({\n          isPrimary: true,\n          iconLeft: 'plus',\n          extraClasses: 'btnAddIpRange',\n          text: i18n('add_ip_range'),\n          dataTestAttribute: 'add_ip_range'\n        }) %>\n      </section>\n    </div>\n  <% } %>\n</section>\n"}),define("text!templates/popups/network/HypervisorLanForm.html",[],function(){return'<section data-ntnx-section>\n  <table class="table readonly-table">\n    <tr>\n      <th><%= i18n(\'interface_name\') %></th>\n      <td class="cvm-interface-name"></td>\n    </tr>\n    <tr>\n      <th><%= i18n(\'interface_type\') %></th>\n      <td class="interface-type"></td>\n    </tr>\n    <tr>\n      <th><%= i18n(\'host_ip\') %></th>\n      <td class="host-ip"></td>\n    </tr>\n    <tr>\n      <th><%= i18n(\'cvm_ip\') %></th>\n      <td class="cvm-ip"></td>\n    </tr>\n  </table>\n</section>'}),define("text!templates/popups/network/ManagementLanForm.html",[],function(){return'<section data-ntnx-section>\n  <table class="table readonly-table">\n    <tr>\n      <th><%= i18n(\'interface_name\') %></th>\n      <td class="cvm-interface-name"></td>\n    </tr>\n    <tr>\n      <th><%= i18n(\'interface_type\') %></th>\n      <td class="interface-type"></td>\n    </tr>\n    <tr>\n      <th><%= i18n(\'vlan_id\') %></th>\n      <td class="vlan-id"></td>\n    </tr>\n  </table>\n</section>\n\n<section data-ntnx-section="type-separator">\n  <div class="table-items table -interface" id="hostInfosTable">\n    \x3c!-- @view: Table Contents --\x3e\n  </div>\n</section>'}),define("text!templates/popups/network/CVMServiceInterfaceEditForm.html",[],function(){return'<section data-ntnx-section>\n  <table class="table readonly-table" data-test="interface_info_table">\n    <tr>\n      <td><%= i18n(\'interface_name\') %></td>\n      <td class="cvm-interface-name">\n        <%- interfaceName %>\n      </td>\n    </tr>\n    <tr>\n      <td><%= i18n(\'interface_type\') %></td>\n      <td class="interface-type">\n        <%= interfaceType %>\n      </td>\n    </tr>\n    <tr>\n      <td><%= i18n(\'vlan_id\') %></td>\n      <td class="vlan-id">\n        <%= vlanId %>\n      </td>\n    </tr>\n    <tr>\n      <td><%= i18n(\'ip_pool\') %></td>\n      <td class="ip-pool">\n        <% if (ipPool) { %>\n          <a actionTargetId="<%= ipPool %>" class="editIpPool">\n            <%= ipPool %>\n          </a>\n        <% } %>\n      </td>\n    </tr>\n    <tr>\n      <td><%= i18n(\'netmask\') %></td>\n      <td class="netmask">\n        <%= netmask %>\n      </td>\n    </tr>\n    <tr>\n      <td><%= i18n(\'ip_ranges\') %></td>\n      <td class="ip-range">\n        <%= ipRange %>\n      </td>\n    </tr>\n    <tr>\n      <td><%= i18n(\'features\') %></td>\n      <td class="features">\n        <%= features ? features.join(\',\') : \'\' %>\n      </td>\n    </tr>\n    <tr>\n      <td><%= i18n(\'virtual_ip\') %></td>\n      <td class="vip">\n        <%= virtualIP %>\n      </td>\n    </tr>\n  </table>\n</section>\n\n<section data-ntnx-section="type-separator">\n  <div class="table-items table -interface" id="hostInfosTable"\n    data-test="interface_vnic_table">\n    \x3c!-- @view: Table Contents --\x3e\n  </div>\n</section>\n'}),define("views/popups/network/CVMNetworkInterfacePopupView",["views/basecomponents/popups/BasePopupView","views/basecomponents/datatables/DetailsTableView","models/network/NetworkSeparationModel","models/network/CVMNetworkInterfaceModel","utils/AppConstants","utils/HypervisorUtil","utils/ValidationUtil","utils/AppUtil","events/AppEvents","managers/TaskManager","data/DataProperties","text!templates/popups/network/CVMNetworkInterfaceEnableFormView.html","text!templates/popups/network/CVMNetworkInterfaceContentView.html","text!templates/popups/network/CVMNetworkSegmentationForm.html","text!templates/popups/network/CVMNetworkInterfaceForm.html","text!templates/popups/network/IPPoolList.html","text!templates/popups/network/FeatureSelectionView.html","text!templates/popups/network/IPPoolForm.html","text!templates/popups/network/IPRangeList.html","text!templates/popups/network/HypervisorLanForm.html","text!templates/popups/network/ManagementLanForm.html","text!templates/popups/network/CVMServiceInterfaceEditForm.html"],function(e,t,n,i,s,a,o,r,l,c,d,p,u,h,m,f,v,g,E,T,C,S){"use strict";var A=_.template(p),b=_.template(m),y=_.template(f),I=_.template(v),w=_.template(g),P=_.template(E),N=_.template(u),R=_.template(T),D=_.template(C),M=_.template(h),O=_.template(S),L=_.template('<section data-ntnx-section>\n      <label data-ntnx-label>\n        <%= i18n(\'start_ip\') %>\n      </label>\n      <input type="text" class="ipRangeStart"\n        model-attribute="<%= i18n(\'start_ip\') %>"\n        model-validate="required;'+s.VALIDATION_NAMES.IP_ADDRESS+'"\n        model-validate-args=";"\n        data-test="ip_range_start">\n    </section>\n    <section data-ntnx-section>\n      <label data-ntnx-label>\n        <%= i18n(\'end_ip\') %>\n      </label>\n      <input type="text" class="ipRangeEnd"\n        model-attribute="<%= i18n(\'end_ip\') %>"\n        model-validate="required;'+s.VALIDATION_NAMES.IP_ADDRESS+'"\n        model-validate-args=";"\n        data-test="ip_range_end">\n    </section>'),x={INTERFACE_FORM:"#cvmNetworkInterfaceForm",BACKPLANE_FORM:"#backplaneLanForm",IP_POOL_FORM:"#ipPoolForm",IP_RANGE_FORM:"#ipRangeForm",FEATURE_SELECTION:"#featureForm"};return e.extend({name:"CVMNetworkInterfaceView",events:{"click .modal-header .close":"onCloseClick","click .btnCancel":"onCloseClick","click .btnSave":"onSaveClick","click .btnBack":"onBackClick","click .btnAddIpPool":"showIPPoolForm","click .editIpPool":"onEditIPPool","click .deleteIpPool":"onDeleteIPPool","click .btnAddIpRange":"showIPRangeForm","click .deleteIpRange":"onDeleteIpRange","change input.n-switch":"onChangeFeature"},el:"#popupCvmInterface",cleanedPopup:!0,ipPools:null,ipRanges:null,hostPhysicalNetworks:null,currentInterface:null,currentIpPool:null,currentSubView:null,featSelectRendered:!1,pfcAllowedValues:Array.apply(null,Array(8)).map(function(e,t){return t}),render:function(){this.showTabs=!0;var e=this._getTabs(),t=this.canModifyByEntityType(s.ENTITY_NAME_SERVER),n=[{text:this.i18n("cancel"),extraClasses:"btnCancel n-btn-form hide",extraAttr:[{key:"data-test",value:"btn_cancel"}]},{leftAligned:!0,text:this.i18n("back"),extraClasses:"btnBack n-btn-form hide",extraAttr:[{key:"data-test",value:"btn_back"}]}];t&&n.push({isPrimary:!0,text:this.i18n("save"),extraClasses:"btnSave n-btn-form hide",extraAttr:[{key:"data-test",value:"btn_save"},{key:"data-loading-text",value:this.i18n("saving")}]}),this.$el.html(this.defaultTemplate(this.vtOptions({title:this.i18n("loading"),tabs:!0,stepTabs:!0,tabsList:this.defaultTabs(e),bodyContent:N(this.vtOptions({canModify:t})),footerButtons:this.defaultFooter(n)}))),this.fetchDataAndRender(this.actionRoute[s.NAV_ACTION])},hide:function(t){!0===t&&e.prototype.hide.apply(this)},showSubview:function(t,n,i,a){this.currentSubView=t,this.hideSubview(".subview"),this.triggerAction(s.MODAL.ACT.ALERT_HIDE),e.prototype.showSubview.apply(this,[t,"left",!1,a])},onCloseClick:function(){this.hide(!0)},onEnterKeyPress:function(){this.onSaveClick()},_getTabs:function(){return this.showTabs?[{isActive:!0,text:this.i18n("interface_details"),extraClasses:"tab-interface-details",extraAttr:[{key:"data-target",value:"interface-details"},{key:"stream-action",value:"select"},{key:"stream-target",value:"cvm-interface-details"}]},{text:this.i18n("feature_select"),extraClasses:"tab-feature-select",extraAttr:[{key:"data-target",value:"feature-select"},{key:"stream-action",value:"select"},{key:"stream-target",value:"cvm-interface-feature"}]}]:[]},showError:function(e){this.triggerAction(s.MODAL.ACT.ALERT_SHOW,{type:s.MODAL.ALERT.TYPE_ERROR,message:e})},onModelError:function(e,t,n){this.showError(e.getErrorResponse()),this.$(".btnSave").prop("disabled",!1)},fetchDataAndRender:function(e){var t=this;this.mode=e||this.mode;var n=[];this.mode===s.ACTION_CREATE?(n.push(this.fetchHostPhysicalNetworks()),n.push(this.fetchIpPools())):this.mode===s.ACTION_EDIT?(n.push(this.fetchIpPools()),n.push(this.fetchNetworkInterfaceModel())):n.push(this.fetchNetworkInterfaceModel()),$.when.apply(this,n).done(function(){t.renderForm()})},fetchNetworkInterfaceModel:function(){var e=this,t=$.Deferred();return l.onAppEventOnce(l.SEND_DATA,function(n,i){e.currentNetworkInterfaceModel=i.model,t.resolve()}),l.triggerAppEvent(l.ASK_DATA),t},renderForm:function(){this.$(".n-modal-loading").hide();var e=this.actionRoute[s.NAV_ACTION_TARGET_ID],t=e===s.INTERFACE_TYPES.ETHR;switch(this.mode){case s.ACTION_CREATE:this.currentNetworkInterfaceModel=null,this.showInterfaceEditForm();break;case s.ACTION_VIEW:switch(e){case s.INTERFACE_TYPES.ETH1:this.generateHypervisorLanFormView();break;case s.INTERFACE_TYPES.ETH0:this.generateManagementLanFormView();break;case s.INTERFACE_TYPES.ETH2:case s.INTERFACE_TYPES.ETHR:this.generateCVMNetworkSegmentationFormView(t)}break;case s.ACTION_EDIT:this.generateCVMInterfaceEditForm();break;default:this.generateBackplaneLanFormView(e,t)}this.initFooterButtonState()},initFooterButtonState:function(){var e=this.mode===s.ACTION_VIEW,t=this.mode===s.ACTION_CREATE;this.$(".btnCancel").toggleClass("hide",e||t),this.$(".btnBack").toggleClass("hide",!e),this.$(".btnSave").html(this.i18n(t?"next":"verify_and_save")).toggleClass("hide",e)},createNWSegmentationInterface:function(e){var t=this.generateNWSegmentationModelFromForm(e);if(t){var i=new n({methodName:s.SEGM.NW.ACTIONS.ENABLE});i.setRPCParams({networkInterface:t,nwType:s.SEGM.NW.TYPES[e?"RDMA":"BP"]}),this.triggerAction(s.MODAL.ACT.ALERT_SHOW,{type:s.MODAL.ALERT.TYPE_INFO,message:this.i18n("verification_in_progress")}),this.saveNWSeparationModel(i,e)}},saveNWSeparationModel:function(e){var t=this;this.triggerAction(s.MODAL.ACT.COVER_SHOW),e.save({success:function(){t.triggerActions([s.MODAL.ACT.ALERT_HIDE,s.MODAL.ACT.COVER_HIDE]);var n=e.getReturnResponse();if(!e.hasErrorResponse()&&n[0])t.$(".btnSave").prop("disabled",!1),$.nutanixConfirm({msg:t.i18n("create_interface"),hideNo:!0,hideYes:!1,yes:function(){t.hide(!0)},yesText:t.i18n("ok"),suppressScale:!0,context:t});else if(2===n.length){var i=n[1];t.triggerAction(s.MODAL.ACT.ALERT_SHOW,{type:s.MODAL.ALERT.TYPE_ERROR,message:t.i18ns("create_backplane_error",i)})}},error:function(e,n){t.triggerAction(s.MODAL.ACT.COVER_HIDE),t.triggerAction(s.MODAL.ACT.ALERT_SHOW,{type:s.MODAL.ALERT.TYPE_ERROR,message:t.i18n("update_error")+n})}})},showInterfaceEditForm:function(e){this.showSubview(x.INTERFACE_FORM);var t=this.hostPhysicalNetworks.map(function(e){return{name:e,value:e}}),n=this.$(this.currentSubView);if(!e){var i=this.clusterManager.getCurrentClusterUuid(),o=a.getDominantHypervisor(i)===s.HYPERVISOR_TYPE.ESXI;n.html(b(this.vtOptions({portGroupOptions:t,isEsx:o})))}this.renderIpPools(),this.triggerAction(s.MODAL.ACT.SET_TITLE,this.i18n("new_interface")),this.triggerAction(s.MODAL.ACT.TABS_SHOW),this.$(".btnBack").hide(),this.$(".btnCancel").show(),this.$(".btnSave").html(this.i18n("next")),this.triggerAction(s.MODAL.ACT.AS_REBUILD),this.triggerAction(s.MODAL.ACT.SET_STEP,0)},renderIpPools:function(){this.$(".ipPoolCtr").html(y(this.vtOptions({ipPools:_.map(this.ipPools,function(e,t){return t})}))).show(),this.$(".btnSave").prop("disabled",_.isEmpty(this.ipPools)),this.triggerAction(s.MODAL.ACT.AS_REBUILD)},renderIpRanges:function(){this.$(".ipRangeCtr").html(P(this.vtOptions({ipRanges:this.ipRanges})));var e=_.isEmpty(this.ipRanges)||this.currentIpPool;this.$(".btnSave").html(this.i18n("save")).prop("disabled",e),this.triggerAction(s.MODAL.ACT.AS_REBUILD)},showIPPoolForm:function(e,t){this.showSubview(x.IP_POOL_FORM),e&&(this.currentIpPool=null,this.ipRanges=[]);var n=void 0,i=void 0;this.currentIpPool?(n=this.currentIpPool.name,i=this.currentIpPool.netmask,this.ipRanges=(this.currentIpPool.ranges||[]).map(function(e){return{start:e[0],end:e[1]}})):this.ipRanges=this.ipRanges||[];var a=this.$(this.currentSubView);t||a.html(w(this.vtOptions({editMode:!!this.currentIpPool,poolName:n,netmask:i}))),this.renderIpRanges(),this.triggerAction(s.MODAL.ACT.SET_TITLE,this.i18n("ip_pool")),this.triggerAction(s.MODAL.ACT.TABS_HIDE),this.$(".btnBack").show(),this.$(".btnCancel").hide()},showFeatureSelection:function(){this.showSubview(x.FEATURE_SELECTION),this.featSelectRendered||(this.$(this.currentSubView).html(I(this.vtOptions({isDREnabled:this.isDRSegmentationEnabled()}))),this.featSelectRendered=!0);var e=this.$('input[name="ipPool"]:checked').val()||"";this.$(".vipHint").html(this.i18ns("vip_hint",e)),this.triggerAction(s.MODAL.ACT.SET_TITLE,s.ACTION_NAMES[this.mode]+" "+s.ENTITY_NAMES[s.ENTITY_CVM_NETWORK_INTERFACE]),this.triggerAction(s.MODAL.ACT.TABS_SHOW),this.triggerAction(s.MODAL.ACT.SET_STEP,1),this.$(".btnSave").html(this.i18n("save")).prop("disabled",!1),this.$(".btnBack").show(),this.$(".btnCancel").hide()},showIPRangeForm:function(){this.showSubview(x.IP_RANGE_FORM),this.$(this.currentSubView).html(L(this.vtOptions({}))),this.triggerAction(s.MODAL.ACT.SET_TITLE,this.i18n("ip_range")),this.triggerAction(s.MODAL.ACT.TABS_HIDE),this.$(".btnSave").html(this.i18n("save")).prop("disabled",!1).show(),this.$(".btnBack").show(),this.$(".btnCancel").hide()},createIpPool:function(e,t){var i=new n({methodName:s.SEGM.NW.ACTIONS.CREATE_IP_POOL});return i.setRPCParams({poolName:e.poolName,ipRanges:e.ipRanges,netmask:e.netmask}),this.invokeRPC(i,t)},deleteIpPool:function(e,t){var i=new n({methodName:s.SEGM.NW.ACTIONS.DELETE_IP_POOL});return i.setRPCParams({poolName:e.poolName}),this.invokeRPC(i,t)},addIpRange:function(e,t){var i=new n({methodName:s.SEGM.NW.ACTIONS.ADD_IP_RANGE});return i.setRPCParams({poolName:e.poolName,ipRange:[e.startIP,e.endIP]}),this.invokeRPC(i,t)},removeIpRange:function(e,t){var i=new n({methodName:s.SEGM.NW.ACTIONS.DELETE_IP_RANGE});return i.setRPCParams({poolName:e.poolName,ipRange:e.ipRange}),this.invokeRPC(i,t)},deleteEntity:function(e,t,n){switch(e){case s.ENTITY_IP_POOL:this.deleteIpPool(t.config,t.options);break;case s.ENTITY_IP_RANGE:this.removeIpRange(t.config,t.options)}},fetchHostPhysicalNetworks:function(e){var t=this,i=new n({methodName:s.SEGM.NW.ACTIONS.PHYSICAL_NETWORKS});return i.managerName=s.GENESIS.NODE_MANAGER,i.save(e).done(function(){t.hostPhysicalNetworks=i.getReturnResponse()[1]||[]})},fetchIpPools:function(e){var t=this,i=new n({methodName:s.SEGM.NW.ACTIONS.IP_POOLS});return i.save(e).done(function(){t.ipPools={};var e=i.getReturnResponse()[1]||{};_.each(e,function(e,n){t.ipPools[n]=e,t.ipPools[n].name=n})})},invokeRPC:function(e,t){var n=this;this.$(".btnSave").prop("disabled",!0),this.triggerAction(s.MODAL.ACT.ALERT_SHOW,{type:s.MODAL.ALERT.TYPE_INFO,message:this.i18n("saving")}),e.save({success:function(){var i=e.getReturnResponse();i[0]?("function"==typeof t.success&&t.success(e),n.triggerAction(s.MODAL.ACT.ALERT_HIDE)):n.showError(i[1]||n.i18n("serverError")),n.$(".btnSave").prop("disabled",!1)},error:this.onModelError.bind(this)})},onSaveClick:function(){switch(this.currentSubView){case x.INTERFACE_FORM:this.savePartialInterfaceForm();break;case x.IP_POOL_FORM:this.saveIpPoolForm();break;case x.IP_RANGE_FORM:this.saveIpRangeForm();break;case x.FEATURE_SELECTION:this.saveServiceInterfaceForm();break;case x.BACKPLANE_FORM:this.saveBackplaneInterfaceForm()}},onEditIPPool:function(e){var t=$(e.currentTarget).attr(s.NAV_ACTION_TARGET_ID);this.currentIpPool=this.ipPools[t],this.showIPPoolForm()},onDeleteIPPool:function(e){var t,n=this,i=$(e.currentTarget).attr(s.NAV_ACTION_TARGET_ID);this.confirmDelete((t={},_defineProperty(t,s.NAV_ACTION_TARGET,s.ENTITY_IP_POOL),_defineProperty(t,s.NAV_ACTION_TARGET_ID,{config:{poolName:i},options:{success:function(){n.fetchIpPools().done(function(){n.renderIpPools()})}}}),_defineProperty(t,s.NAV_ACTION_TARGET_NAME,i),t))},onDeleteIpRange:function(e){var t=this,n=parseInt($(e.currentTarget).attr(s.NAV_ACTION_TARGET_ID),10);if(this.currentIpPool){var i,a=this.currentIpPool.ranges[n];this.confirmDelete((i={},_defineProperty(i,s.NAV_ACTION_TARGET,s.ENTITY_IP_RANGE),_defineProperty(i,s.NAV_ACTION_TARGET_ID,{config:{poolName:this.currentIpPool.name,ipRange:a},options:{success:function(){t.fetchIpPools().done(function(){var e=t.currentIpPool.name;t.currentIpPool=t.ipPools[e],t.showIPPoolForm()})}}}),_defineProperty(i,s.NAV_ACTION_TARGET_NAME,this.i18ns("ip_range_name",a[0],a[1])),i))}else this.ipRanges.splice(n,1),this.renderIpRanges()},onChangeFeature:function(e){var t=$(e.currentTarget);t.is(":checked")&&this.$("input.n-switch").each(function(){this!==t[0]&&$(this).prop("checked",!1)}),this.$(".feature-option").toggleClass("hide",!this.$("input.n-switch:checked").length),this.triggerAction(s.MODAL.ACT.AS_REBUILD)},validateForm:function(e){var t=this.$(e),n=o.validateFormValues(t);if(n.length){var i=o.defaultErrorHandler(t,n);return this.showError(i),!1}return!0},saveServiceInterfaceForm:function(){var e=this;if(this.validateForm(x.FEATURE_SELECTION)){var t=this.$(".interfaceName").val(),i=this.$(".hostPortGroup").val(),a=this.$('input[name="ipPool"]:checked').val(),r=this.$("#featDR").is(":checked"),l=this.$("#featABS").is(":checked"),d=this.$(".virtualIp").val(),p=this.$(".gateway").val(),u=this.$(".clientSubnet").val(),h=parseInt(this.$(".vlanId").val(),10)||null,m=o.isValidIPRangeCIDR(u),f=[];if(u&&!m.valid){var v=u.split("/");o.isValidIPAddress(v[0]).valid&&v[1]&&o.isValidSubnetMask(v[1])||f.push(this.i18n("invalid_subnet"))}if(u&&!p&&f.push(this.i18n("subnet_gateway_error")),!_.isEmpty(f))return void this.showError(f.join(" "));this.$(".btnSave").prop("disabled",!0);var g=void 0;r?g=s.SEGM.NW.SERVICE_NAME.DR:l&&(g=s.SEGM.NW.SERVICE_NAME.ABS);var E=new n({methodName:s.SEGM.NW.ACTIONS.ENABLE});return E.setRPCParams({networkInterface:null,nwType:s.SEGM.NW.TYPES.SERVICE,service:g,hostPhysicalNetwork:i,ipPool:a,vlanId:h,name:t,virtualIP:d,gateway:p,clientSubnet:u}),this.invokeRPC(E,{success:function(t){var n=E.getReturnResponse()||[];2===n.length&&!1===n[0]?(e.showError(n[1]),e.$(".btnSave").prop("disabled",!1)):(e.hide(!0),c.fetchOnDemand({force:!0}))}})}},savePartialInterfaceForm:function(){if(this.validateForm(x.INTERFACE_FORM)){var e=[];this.$('input[name="ipPool"]:checked').length||e.push(this.i18n("no_pool_select"));var t=this.$(".vlanId").val(),n=o.inRange(t,"0,4095");if(t&&!n.valid&&e.push(this.i18n("error_vlanid_invalid")),!_.isEmpty(e))return void this.showError(e.join(" "));this.showFeatureSelection()}},saveBackplaneInterfaceForm:function(){var e=this.$(".segmentationForm").data("type"),t=e===s.INTERFACE_TYPES.ETHR;this.isNWSegmentationInterfaceFormValid(t)&&(this.triggerAction(s.MODAL.ACT.ALERT_HIDE),this.$(":focus").blur(),this.createNWSegmentationInterface(t))},saveIpPoolForm:function(){var e=this;if(this.validateForm(x.IP_POOL_FORM)){var t=this.$(".ipPoolName").val(),n=this.$(".ipPoolNetmask").val(),i=this.ipRanges.map(function(e){return[e.start,e.end]});this.currentIpPool||this.createIpPool({poolName:t,netmask:n,ipRanges:i},{success:function(t){var n=t.getErrorResponse();n?e.showError(n):e.fetchIpPools().done(function(){e.showInterfaceEditForm(!0)})},error:this.onModelError.bind(this)})}},saveIpRangeForm:function(){var e=this;if(this.validateForm(x.IP_RANGE_FORM)){var t=this.$(".ipRangeStart").val(),n=this.$(".ipRangeEnd").val();this.currentIpPool?this.addIpRange({poolName:this.currentIpPool.name,startIP:t,endIP:n},{success:function(){e.fetchIpPools().done(function(){var t=e.currentIpPool.name;e.currentIpPool=e.ipPools[t],e.showIPPoolForm()})}}):(this.ipRanges.push({start:t,end:n}),this.showIPPoolForm(null,!0))}},onBackClick:function(){var e=this;switch(this.currentSubView){case x.IP_RANGE_FORM:this.showIPPoolForm();break;case x.FEATURE_SELECTION:case x.IP_POOL_FORM:this.mode===s.ACTION_EDIT?this.generateCVMInterfaceEditForm():this.showInterfaceEditForm(!0);break;case x.INTERFACE_FORM:this.confirmHide(function(){e.hide(!0)});break;default:this.hide(!0)}},generateHypervisorLanFormView:function(){this.showSubview(x.INTERFACE_FORM);var e=this.currentNetworkInterfaceModel.getDisplayName();this.$(this.currentSubView).html(R(this.vtOptions())),this.$(".cvm-interface-name").text(e),this.$(".interface-type").text(this.currentNetworkInterfaceModel.getInterfaceType());var t=this.currentNetworkInterfaceModel.getHostNetworkInfos()[0];this.$(".host-ip").text(t[this.currentNetworkInterfaceModel.DP.HOST_IP]),this.$(".cvm-ip").text(t[this.currentNetworkInterfaceModel.DP.CVM_IP]),this.triggerAction(s.MODAL.ACT.SET_TITLE,e),this.triggerAction(s.MODAL.ACT.TABS_HIDE),this.triggerAction(s.MODAL.ACT.AS_REBUILD)},generateManagementLanFormView:function(){this.showSubview(x.INTERFACE_FORM);var e=this.currentNetworkInterfaceModel.getDisplayName();this.$(this.currentSubView).html(D(this.vtOptions())),this.$(".cvm-interface-name").text(e),this.$(".interface-type").text(this.currentNetworkInterfaceModel.getInterfaceType()),this.$(".vlan-id").text(this.currentNetworkInterfaceModel.getDisplayVlanId());var t={HOST_NAME:this.currentNetworkInterfaceModel.DP.HOST_NAME,HOST_IP:this.currentNetworkInterfaceModel.DP.HOST_IP,CVM_IP:this.currentNetworkInterfaceModel.DP.CVM_IP};this.populateFormViewTable("#hostInfosTable",this.currentNetworkInterfaceModel.getHostNetworkInfos(),t),this.triggerAction(s.MODAL.ACT.SET_TITLE,e),this.triggerAction(s.MODAL.ACT.TABS_HIDE),this.triggerAction(s.MODAL.ACT.AS_REBUILD)},generateCVMNetworkSegmentationFormView:function(e){this.showSubview(x.INTERFACE_FORM);var t=this.currentNetworkInterfaceModel.getDisplayName(),n={name:t,type:this.currentNetworkInterfaceModel.getInterfaceType(),subnetIp:this.currentNetworkInterfaceModel.getSubnetIp(),subnetMask:this.currentNetworkInterfaceModel.getSubnetMask(),vlanId:this.currentNetworkInterfaceModel.getDisplayVlanId(),isRDMA:e};e&&(n.pfc=this.currentNetworkInterfaceModel.getPFC()),this.$(this.currentSubView).html(M(this.vtOptions(n)));var i={HOST_NAME:this.currentNetworkInterfaceModel.DP.HOST_NAME,HOST_IP:this.currentNetworkInterfaceModel.DP.BACKPLANE_IP,CVM_IP:this.currentNetworkInterfaceModel.DP.CVM_BACKPLANE_IP,RDMA_IP:this.currentNetworkInterfaceModel.DP.RDMA_IP};this.populateFormViewTable("#hostInfosTable",this.currentNetworkInterfaceModel.getNetworkSegmentationHostInfos(),i,e),this.triggerAction(s.MODAL.ACT.SET_TITLE,t),this.triggerAction(s.MODAL.ACT.TABS_HIDE),this.triggerAction(s.MODAL.ACT.AS_REBUILD)},generateBackplaneLanFormView:function(e,t){this.showSubview(x.BACKPLANE_FORM);var n=this.currentNetworkInterfaceModel.getDisplayName();this.$(this.currentSubView).html(A(this.vtOptions({name:n,type:e,isRDMA:t,pfcValues:this.pfcAllowedValues.map(function(e){return{name:e,value:e}})}))),this.triggerAction(s.MODAL.ACT.SET_TITLE,n),this.triggerAction(s.MODAL.ACT.TABS_HIDE),this.triggerAction(s.MODAL.ACT.AS_REBUILD)},populateFormViewTable:function(e,n,i,s,a){var o=[{sTitle:this.i18n("host"),mData:function(e){return e[i.HOST_NAME]}},{sTitle:this.i18n(s?"rdma_ip":"cvm_ip"),mData:function(e,t,n){var a=e[i.RDMA_IP];return s?a&&a.join(", "):e[i.CVM_IP]}}];s||a||o.splice(1,0,{sTitle:this.i18n("host_ip"),mData:function(e,t,n){return e[i.HOST_IP]}}),a&&o.push({sTitle:this.i18n("vnic_ip"),mData:function(e,t,n){return e[i.VNIC_IP]}});var r=new t(this.vtOptions({el:this.$(e),scrollHeight:"120px",minimumRows:5,columns:o}));r.render(),r.updateDataSource(n)},isNWSegmentationInterfaceFormValid:function(e){var t=void 0,n=this.$(".subnet-ip").val().trim(),i=this.$(".subnet-mask").val().trim(),a=this.$(".vlan-id").val().trim();if(_.isEmpty(n))t=this.i18n("error_subnet_ip_required");else if(_.isEmpty(i))t=this.i18n("error_subnet_required");else if(isNaN(r.strToLongIP(i)))t=this.i18n("error_invalid_subnet_mask");else if(isNaN(r.strToLongIP(n)))t=this.i18n("error_invalid_subnet_mask");else if(a&&!r.isNonNegativeInt(Number(a)))t=this.i18n("error_vlanid_invalid");else if(e){var o=this.$(".pfc").val().trim();o?~this.pfcAllowedValues.indexOf(Number(o))||(t=this.i18n("error_invalid_pfc")):t=this.i18n("error_pfc_required")}return t&&this.triggerAction(s.MODAL.ACT.ALERT_SHOW,{type:s.MODAL.ALERT.TYPE_ERROR,message:t}),!t},isCurrentBackplaneLanFormDirty:function(){if(this.mode===s.ACTION_VIEW)return!1;var e=this.generateNWSegmentationModelFromForm();return!e||!(new i).isEqual(e)},generateNWSegmentationModelFromForm:function(e){var t=new i;return this.$("#cvmNetworkInterfaceForm").is(":visible")&&(t.set(t.DP.NAME,this.$(".cvm-interface-name").text().trim()),t.set(t.DP.INTERFACE_TYPE,this.$(".interface-type").text().trim()),t.set(t.DP.SUBNET_MASK,this.$(".subnet-mask").val().trim()),t.set(t.DP.SUBNET_IP,this.$(".subnet-ip").val().trim()),t.set(t.DP.VLAN_ID,this.$(".vlan-id").val().trim()),e&&t.set(t.DP.PFC,this.$(".pfc").val().trim())),this.triggerAction(s.MODAL.ACT.AS_REFRESH),t},generateCVMInterfaceEditForm:function(){this.showSubview(x.INTERFACE_FORM);var e=this.currentNetworkInterfaceModel.getDisplayName();this.$(this.currentSubView).html(O(this.vtOptions({interfaceName:e,interfaceType:this.currentNetworkInterfaceModel.getInterfaceType(),vlanId:this.currentNetworkInterfaceModel.getDisplayVlanId(),ipPool:this.currentNetworkInterfaceModel.getDisplayIPPool(),netmask:this.currentNetworkInterfaceModel.getDisplaySubnetMask(),ipRange:this.getDisplayIPRanges(this.currentNetworkInterfaceModel.get(d.CVMNI.IP_POOL)),features:this.currentNetworkInterfaceModel.getDisplayFeatures(),
virtualIP:this.currentNetworkInterfaceModel.getDisplayVirtualIP(),hostPhysicalNetwork:this.currentNetworkInterfaceModel.getDisplayHostPhysicalNetwork()})));var t={HOST_NAME:this.currentNetworkInterfaceModel.DP.HOST_NAME,HOST_IP:this.currentNetworkInterfaceModel.DP.HOST_IP,CVM_IP:this.currentNetworkInterfaceModel.DP.CVM_IP,VNIC_IP:this.currentNetworkInterfaceModel.DP.VNIC_IP};this.populateFormViewTable("#hostInfosTable",this.currentNetworkInterfaceModel.getHostNetworkInfos(),t,!1,!0),this.triggerAction(s.MODAL.ACT.SET_TITLE,e),this.triggerAction(s.MODAL.ACT.TABS_HIDE),this.triggerAction(s.MODAL.ACT.AS_REBUILD),this.$(".btnSave, .btnBack").hide()},getDisplayIPRanges:function(e){var t=this.ipPools[e],n=t.ranges,i=[];return _.each(n,function(e){i.push(e[0]+"-"+e[1])}),i.join(", ")},isDRSegmentationEnabled:function(){return this.clusterManager.getCurrentClusterModel().isFFEnabled(s.FFLAGS.NETWORK_SEGMENTATION_DR)}})}),define("text!templates/popups/dashboards/vantagepoint-aspects/BaseVantagePointAspectsView.html",[],function(){return'<div class="control-group vpName">\n  <label class="control-label">\n    <%= widgetName %>\n  </label>\n  <div class="controls">\n    <input type="text" class="aspect aspectRequired vantagePointName" value="">\n  </div>\n</div>\n<div class="control-group selectCluster">\n  <label class="control-label">\n    <%= selectCluster %>\n  </label>\n  <div class="controls clusterListContainer"\n       stream-action="Dashboards: ChangeAspect"\n       stream-target="Cluster List">\n    <% // Cluster list select box goes here %>\n  </div>\n</div>\n<div class="control-group groupSize">\n  <label class="control-label">\n    <%= chooseSize %>\n  </label>\n  <div class="controls sizeListContainer"\n       stream-action="Dashboards: ChangeAspect"\n       stream-target="Size List">\n    <% // Size list select box goes here %>\n  </div>\n</div>\n'}),define("views/popups/dashboards/aspects/BaseVantagePointAspectsView",["views/basecomponents/BaseView","views/basecomponents/vantagepoints/VantagePointLayoutDescriptor","data/DataProperties","utils/AppConstants","managers/ClusterManager","text!templates/popups/dashboards/vantagepoint-aspects/BaseVantagePointAspectsView.html"],function(e,t,n,i,s,a){"use strict";var o=(_.template('<option value="<%=value%>"><%=name%></option>'),_.template(a));return e.extend({DEFAULT_TITLE:"New Widget",name:"BaseVantagePointAspectsView",render:function(e,t){this.$el.html(o({widgetName:this.i18n("widget_name"),selectCluster:this.i18n("select_cluster"),chooseSize:this.i18n("choose_size")})),this.$(".vantagePointName").val(this.i18n("new_widget",this.DEFAULT_TITLE)),this.populateClusters(t),this.populateSizes(t),this.applyNutanixInput(),t[i.ADD_VP_CONFIG_FILE.IS_SHOW_ASPECTS]?this.$el.show():this.$el.hide()},populateVantagePointModelAspects:function(e){var t=this.$(".size");t.is(":visible")&&e.set(n.VP_SIZE,t.val()),e.set(n.NAME,this.$(".vantagePointName").val().trim());var s=this.$(".clusterList").val();s!==i.MULTICLUSTER_CLUSTER_ID?e.set(n.CLUSTER_UUID,s):e.set(n.CLUSTER_UUID,null)},onChangeAspects:function(){},populateClusters:function(e){if(s.isMulticlusterUI()){var t=[],a=s.getClusterCollection();if(e[i.ADD_VP_CONFIG_FILE.IS_AVAILABLE_PC]){var o={name:this.i18n("all_clusters",i.ALL_CLUSTERS),value:i.MULTICLUSTER_CLUSTER_ID};t.push(o)}e[i.ADD_VP_CONFIG_FILE.IS_AVAILABLE_PE]&&_.each(a.models,function(e){var i=e.get(n.NAME),s=e.getClusterUuid(),a={name:i,value:s};t.push(a)}),this.$(".clusterListContainer").html(this.getComponent("select",{options:t,jsClasses:"aspect clusterList"}))}else this.$(".selectCluster").hide()},populateSizes:function(e){var n=[],s=e[i.ADD_VP_CONFIG_FILE.AVAILABLE_SIZES];_.each(s,function(e){var i=t.VP_SIZE_DISPLAY_NAMES[e],s={name:i,value:e};n.push(s)}),this.$(".sizeListContainer").html(this.getComponent("select",{options:n,jsClasses:"aspect size sizeList"}))}})}),define("views/popups/dashboards/aspects/PreDefinedVantagePointAspectsView",["views/popups/dashboards/aspects/BaseVantagePointAspectsView","utils/AppConstants"],function(e,t){"use strict";var n=_.template("<% if (clusterName) { %> <%= vantagePointName  %> on <%= clusterName %><% } else { %><%= vantagePointName  %> <% } %>");return e.extend({name:"PreDefinedVantagePointAspectsView",template:null,render:function(i,s){e.prototype.render.apply(this,arguments);var a=i.text().trim(),o=this.$(".clusterList option:selected").text();s[t.ADD_VP_CONFIG_FILE.IS_SHOW_ASPECTS]&&(a=n({clusterName:o,vantagePointName:a})),this.$(".vantagePointName").val(a),this.$(".aspects").empty()},onChangeAspects:function(e){if(!e){var t=this.$(".clusterList option:selected").text(),i=this.getPreDefinedVPTemplate().name,s=n({clusterName:t,vantagePointName:i});this.$(".vantagePointName").val(s)}},setPreDefinedVPTemplate:function(e){this.template=e},getPreDefinedVPTemplate:function(){return this.template}})}),define("text!templates/popups/dashboards/vantagepoint-aspects/AlertVantagePointAspectsView.html",[],function(){return'<div class="aspects">\n  <div class="control-group">\n    <label class="control-label">\n      <%= i18n(\'Terms.severity\') %>\n    </label>\n    <div class="controls severitySelectContainer"\n         stream-action="Dashboards: ChangeAspect"\n         stream-target="Alerts Severity">\n      <%= Components.select({\n        jsClasses : "aspect aspectRequired  severity",\n        id : "severity",\n        options: [\n            {\n              value : "kCritical",\n              name: i18n(\'status.critical\', \'Critical\')\n            },\n            {\n              value : "kWarning",\n              name: i18n(\'status.warning\', \'Warning\')\n            },\n            {\n              value : "kInfo",\n              name: i18n(\'status.info\', \'Info\')\n            }\n          ]\n      }) %>\n    </div>\n  </div>\n  <div class="control-group">\n    <label class="control-label">\n      <%= i18n(\'Terms.entity\') %>\n    </label>\n    <div class="controls entitySelectContainer"\n        stream-action="Dashboards: ChangeAspect"\n         stream-target="Alerts Entity">\n      <%= Components.select({\n        jsClasses : "aspect aspectRequired  entity",\n        id : "entity",\n        options: [\n            {\n              value : "cluster",\n              name: i18n(\'CommonEntities.cluster\', \'Cluster\')\n            },\n            {\n              value : "storage",\n              name: i18n(\'CommonEntities.storage\', \'Storage\')\n            },\n            {\n              value : "vm",\n              name: i18n(\'CommonEntities.vm\', \'VM\')\n            },\n            {\n              value : "hardware",\n              name: i18n(\'CommonEntities.hardware\', \'Hardware\')\n            },\n            {\n              value : "dr",\n              name: i18n(\'CommonEntities.dr\', \'DR\')\n            }\n          ]\n      }) %>\n    </div>\n  </div>\n</div>'}),define("views/popups/dashboards/aspects/CustomAlertVantagePointAspectsView",["views/popups/dashboards/aspects/BaseVantagePointAspectsView","data/DataProperties","utils/AppConstants","text!templates/popups/dashboards/vantagepoint-aspects/AlertVantagePointAspectsView.html"],function(e,t,n,i){"use strict";var s=_.template("<%= i18ns('VantagePointNameAlert',severity, entity, cluster) %>");return e.extend({DEFAULT_TITLE:"New Alert Widget",render:function(){e.prototype.render.apply(this,arguments),this.$el.append(_.template(i)(this.vtOptions())),this.applyNutanixInput(),this.onChangeAspects()},populateVantagePointModelAspects:function(i){e.prototype.populateVantagePointModelAspects.apply(this,arguments),i.set(t.VP_TYPE,n.VP_TYPE.ALERT);var s=i.get(t.VP_ASPECTS);s[t.ALERT_SEVERITY]=this.$(".severity").val(),s[t.ALERT_PERSPECTIVE]=this.$(".entity").val()},onChangeAspects:function(e){if(!e){var t=this.$(".clusterList option:selected").text().trim(),n=this.$(".severity option:selected").text().trim(),i=this.$(".entity option:selected").text().trim(),a=s(this.vtOptions({severity:n,entity:i,cluster:t}));this.$(".vantagePointName").val(a)}}})}),define("text!templates/popups/dashboards/vantagepoint-aspects/TopMetricVantagePointAspectsView.html",[],function(){return'<div class="aspects">\n  <div class="control-group">\n    <label class="control-label">\n      <%= i18n("Terms.entity", "Entity") %>\n    </label>\n    <div class="controls" stream-action="Dashboards: ChangeAspect"\n         stream-target="Top Lists Entity">\n      <%= Components.select({\n        jsClasses : "aspectRequired aspectEntity aspect",\n        id : "entity",\n        options: [\n            {\n              value : "host",\n              name: i18n(\'CommonEntities.host\', \'Host\')\n            },\n            {\n              value : "vm",\n              name: i18n(\'CommonEntities.vm\', \'VM\')\n            }\n          ]\n      }) %>\n    </div>\n  </div>\n  <div class="control-group">\n    <label class="control-label">\n      <%= i18n("Terms.metric", "Metric") %>\n    </label>\n    <div class="controls"\n         stream-action="Dashboards: ChangeAspect"\n         stream-target="Top Lists Metric">\n      <%= Components.select({\n        jsClasses : "aspect aspectMetric",\n        id : "metric",\n        options: [\n          {\n            value : "iops",\n            name: i18n(\'Metrics.iops\', \'IOPS\')\n          },\n          {\n            value : "memoryUsage",\n            name: i18n(\'Metrics.memory_usage\', \'Memory Usage\')\n          },\n          {\n            value : "cpuUsage",\n            name: i18n(\'Metrics.cpu_usage\', \'CPU Usage\')\n          },\n          {\n            value : "bandwidth",\n            name: i18n(\'Metrics.bandwidth\', \'Bandwidth\')\n          },\n          {\n            value : "latency",\n            name: i18n(\'Metrics.latency\', \'Latency\')\n          }\n        ]\n      }) %>\n    </div>\n  </div>\n</div>'}),define("views/popups/dashboards/aspects/CustomTopMetricVantagePointAspectsView",["views/popups/dashboards/aspects/BaseVantagePointAspectsView","data/DataProperties","utils/AppConstants","text!templates/popups/dashboards/vantagepoint-aspects/TopMetricVantagePointAspectsView.html"],function(e,t,n,i){"use strict";var s=_.template("<%= i18ns('VantagePointNameTopMetric',metric, entity, cluster) %>");return e.extend({DEFAULT_TITLE:"New List Widget",DEFAULT_COUNT:10,render:function(){e.prototype.render.apply(this,arguments),this.$el.append(_.template(i,this.vtOptions())),this.applyNutanixInput(),this.onChangeAspects()},populateVantagePointModelAspects:function(i){e.prototype.populateVantagePointModelAspects.apply(this,arguments),i.set(t.VP_TYPE,n.VP_TYPE.TOP_METRIC);var s=i.get(t.VP_ASPECTS);s[n.VP_ASPECT_METRIC]=this.$(".aspectMetric").val(),s[n.VP_ASPECT_COUNT]=this.DEFAULT_COUNT,s[n.VP_ASPECT_ENTITY]=this.$(".aspectEntity").val()},onChangeAspects:function(e){if(!e){var t=this.$(".clusterList option:selected").text().trim(),n=this.$(".aspectMetric option:selected").text().trim(),i=this.$(".aspectEntity option:selected").text().trim(),a=s(this.vtOptions({metric:n,entity:i,cluster:t}));this.$(".vantagePointName").val(a)}}})}),define("text!templates/popups/dashboards/vantagepoint-aspects/PerformanceVantagePointAspectsView.html",[],function(){return'<div class="aspects">\n  <div class="control-group">\n    <label class="control-label" for="inputEntityType">\n      <%= i18n("entity_type", "Entity type") %>\n    </label>\n    <div class="controls entityTypesSelectContainer"\n         stream-action="Dashboards: ChangeAspect"\n         stream-target="Charts Entity type">\n      <%= entityTypesSelect %>\n    </div>\n  </div>\n  <div class="control-group">\n    <label class="control-label" >\n      <%= i18n("Terms.entity", "Entity") %>\n    </label>\n    <label hidden class="error-msg-entity-type error-msg"></label>\n    <div class="controls"\n         stream-action="Dashboards: ChangeAspect"\n         stream-target="Charts Entity">\n      <div class="n-spotlight aspect">\n      </div>\n    </div>\n  </div>\n  <div class="control-group">\n    <label class="control-label" for="inputMetric">\n    <%= i18n("Terms.metric", "Metric") %>\n    </label>\n    <label hidden class="error-msg-metric error-msg"></label>\n    <div class="controls aspect"\n         stream-action="Dashboards: ChangeAspect"\n         stream-target="Charts Metric">\n      <select id=\'inputMetric\' class=\'n-preserve-style\'>\n        <% _.each(metrics, function(m) { %>\n        <option value=\'<%=m.id%>\'><%= m.title %></option>\n        <% }) %>\n      </select>\n      <div class="metric-description">\n      </div>\n    </div>\n  </div>\n</div>'}),define("views/popups/dashboards/aspects/CustomChartVantagePointAspectsView",["views/popups/dashboards/aspects/BaseVantagePointAspectsView","models/timeline/AnalysisChartModel","data/DataProperties","utils/AppConstants","utils/AppUtil","events/AppEvents","utils/ComboBox","views/basecomponents/vantagepoints/VantagePointLayoutDescriptor","views/basecomponents/spotlight/SpotlightView","text!templates/popups/dashboards/vantagepoint-aspects/PerformanceVantagePointAspectsView.html"],function(e,t,n,i,s,a,o,r,l,c){"use strict";var d=(_.template('<div class="control-label">Selected Metrics</div><div class="controls"><%_.each(metrics, function (metric) { %><div class="selected-metric"><div class="selected-metric-text"><%=metric.title%></div><i class="btnDelete" aria-hidden="true" data-icon="v" data-id="<%= metric.id %>"></i></div><% }) %></div>'),{TITLE:"title",ACTIONS:"actions",POSITION:"position"}),p=[i.ENTITY_VIRTUAL_DISK];return e.extend({SELECT_METRIC_PROMPT:"Select a metric",ENTITY_ERROR:"Entity should not be empty.",DROPDOWN_ERROR:"Select option from dropdown.",AUTOCOMPLETE_CUSTOM_CLASS:"add-widget-popup",DEFAULT_TITLE:"New Chart Widget",name:"CustomChartVantagePointAspects",DP:d,events:{"select #inputMetric":"onMetricChange","change #inputEntityType":"onEntityTypeSelect","focus  #searchText":"onSearchTextFocus","blur   #searchText":"onSearchTextBlur","keypress #searchText":"onSearchTextKeyPress","mousedown .n-spotlight-list":"onListSelect","keypress .ui-autocomplete-input":"onMetricKeyPress"},initialize:function(n){e.prototype.initialize.apply(this,arguments),this.model=new t,this.model.set({type:this.model.CHART_TYPE_ENTITY})},render:function(){e.prototype.render.apply(this,arguments),this.setSelectedEntity(null);var t=this._getFilteredEntityTypes(this.model.getMultiClusterEntityTypes()),i=[];_.each(t,function(e){i.push({name:this.i18n("CommonEntities."+e.title.toLowerCase().replace(/ /,"_"),e.title).toLowerCase(),value:e.id})},this);var s=this.getComponent("select",{options:i,id:"inputEntityType"}),a=$.extend(this.vtOptions({metrics:_.sortBy(this.model.METRICS,this.DP.TITLE),entityTypesSelect:s})),o=_.template(c,a);this.$el.append(o),this.$("#inputMetric").combobox({initalSelectPrompt:this.SELECT_METRIC_PROMPT,customClass:this.AUTOCOMPLETE_CUSTOM_CLASS});var r=this,d=function(e,t){var i=t[n.ENTITY_UUID]?t[n.ENTITY_UUID]:t[n.ENTITY_ID],s=t.entityName?t.entityName:i,a={id:i,title:t.entityType+" "+s,type:t.entityType,enabled:!0,clusterUuid:t.clusterUuid};return r.setSelectedEntity(a),r._adjustMetricSelectedEntity(a),r.$("#searchText").val(s),!1};this.spotlight=new l({el:this.$(".n-spotlight")},{selectHandler:d,entityType:this.$("#inputEntityType").val(),wrapperEl:this.$(".n-spotlight"),containerEl:this.$el,cssPosition:"absolute"});var p=this.model.ENTITY_TYPES[0].id;this.model.getPrimaryObject()&&(p=this.model.getPrimaryObject().type.toLowerCase(),this.$("#inputEntityType").val(p)),this._adjustSpotlight(p),this._adjustMetricSelector(p),this.$(".groupSize").hide(),this.$(".selectCluster").hide()},populateVantagePointModelAspects:function(t){e.prototype.populateVantagePointModelAspects.apply(this,arguments),t.set(n.CLUSTER_UUID,null),t.set(n.VP_SIZE,r.SIZE_MEDIUM),t.set(n.VP_TYPE,i.VP_TYPE.PERFORMANCE);var s,a,o=t.get(n.VP_ASPECTS);this.model.getPrimaryObject()&&(s=this.model.getPrimaryObject().id,a=this.model.getPrimaryObject().type,t.set(n.CLUSTER_UUID,this.model.getPrimaryObject().clusterUuid));var l=this.$("#inputMetric").val();if(s&&a&&l){o[i.VP_ASPECT_METRIC]=l,o[i.VP_ASPECT_ENTITY]=a,o[i.VP_ASPECT_ENTITY_ID]=s;var c=["cpuUsage","memoryUsage"],d=[];-1!==c.indexOf(l)?d.push(i.ACTION_MENU.METRIC_REDIRECT):d.push(i.ACTION_MENU.CHART_REDIRECT),t.set(n.VP_ACTIONS,d)}},onChangeAspects:function(e){if(!e&&this.model.getPrimaryObject()){var t=this.$("#inputMetric option:selected").text().trim(),n=this.model.getDefaultTitle().trim(),i=s.sprintf(this.i18n("metric_of_entity","%s of %s"),t,n);this.$(".vantagePointName").val(i)}},onMetricChange:function(){this.$(".error-msg-metric").hide(),this.$("#searchText").val().trim()?this.model.getPrimaryObject()&&a.triggerAppEvent(a.REFRESH_VANTAGEPOINT_PREVIEW):(this.$(".error-msg-entity-type").show().text(this.ENTITY_ERROR),this.$(".linkAddVantagePoint").addClass("disabled"))},onMetricKeyPress:function(){this.$(".error-msg-metric").show().text(this.DROPDOWN_ERROR)},onSearchTextKeyPress:function(){this.$(".error-msg-entity-type").show().text(this.DROPDOWN_ERROR)},onEntityTypeSelect:function(){var e=this.$("#inputEntityType").val();this._adjustMetricSelector(e),this._adjustSelectedMetrics(e),this._adjustSpotlight(e)},onSearchTextFocus:function(e){this.spotlight&&this.spotlight.search(this.$(".n-spotlight #searchText").val(),e)},onListSelect:function(e){this.$(".error-msg-entity-type").hide()},onSearchTextBlur:function(){this.spotlight&&this.spotlight.stopSearch(),this.$("#searchText").val()&&this.model.getPrimaryObject()&&a.triggerAppEvent(a.REFRESH_VANTAGEPOINT_PREVIEW)},_adjustSpotlight:function(e){this.$("#searchText").val(""),this.spotlight.setEntityType(e),this.spotlight.setFieldNameByEntityType(e)},_adjustMetricSelector:function(e){var t=this.model.getMetricsForEntityType(e);this._renderMetrics(t)},_adjustMetricSelectedEntity:function(e){if(e.type===i.ENTITY_CLUSTER){var t=this.model.getMetricsForClusterUuid(e.id);this._renderMetrics(t)}},_renderMetrics:function(e){var t=this.$("#inputMetric");t.combobox("destroy");var n=[];_.each(e,function(e){var t=this.model.getMetricById(e);t?n.push({name:this.i18n(e,t.title),value:e}):s.logDebug("CustomChartVantagePointAspects|_adjustMetricSelector| Unable to find metric for metricId:"+e)},this),s.populateDropdown(t,_.sortBy(n,function(e){return e.name}));var i;i=this.$("#inputMetric option:selected")?this.$("#inputMetric option:selected").text():this.SELECT_METRIC_PROMPT,t.combobox({initalSelectPrompt:i,customClass:this.AUTOCOMPLETE_CUSTOM_CLASS})},_getFilteredEntityTypes:function(e){return _.filter(e,function(e){if(-1===_.indexOf(p,e[n.ID]))return!0})},_adjustSelectedMetrics:function(e){var t=this.model.getMetricsForEntityType(e),n=_.filter(this.model.getSecondaryObjects(),function(e){return t.indexOf(e.id)<0},this);n.length>0&&_.each(n,function(e){this.model.removeSecondaryObject(e.id)},this)},setSelectedEntity:function(e){this.model.setPrimaryObject(e)}})}),define("views/popups/dashboards/aspects/CustomClusterInfoVantagePointAspectsView",["views/popups/dashboards/aspects/BaseVantagePointAspectsView","views/basecomponents/vantagepoints/VantagePointLayoutDescriptor","data/DataProperties","utils/AppConstants"],function(e,t,n,i){"use strict";return e.extend({DEFAULT_TITLE:"Cluster stats",populateVantagePointModelAspects:function(s){e.prototype.populateVantagePointModelAspects.apply(this,arguments),s.set(n.VP_SIZE,t.SIZE_LARGE),this.$(".groupSize").hide(),s.set(n.VP_TYPE,i.VP_TYPE.TABLE);var a=s.get(n.VP_ASPECTS)||{};a[i.VP_ASPECT_TYPE]=i.VP_TABLE_TYPE.MC_CLUSTER_STATS,a[i.VP_ASPECT_ENTITY_ID]=s.get(n.CLUSTER_UUID),s.set(n.VP_ASPECTS,a)},onChangeAspects:function(e){if(!e){var t=this.i18n("VantagePointNameClusterInfo");this.$(".vantagePointName").val(t)}}})}),define("text!extras/dashboard/add-vantagepoint-config.json",[],function(){return'{\n  "version"       : "1.0",\n  "aspectsConfig" : {\n    "availableSizes"            : ["s", "m", "l", "xl", "xxl"],\n    "isAvaliableOnPrismCentral" : true,\n    "isAvaliableOnPrismElement" : true,\n    "isShowAspects"             : true\n  },\n  "groups" : [\n    {\n      "id"    : "custom_widgets",\n      "title" : "Custom Widgets",\n      "styleClass" : "customVantagePoints",\n      "vantagePoints" : [\n        {\n          "id"         : "custom_alerts",\n          "styleClass" : "alerts",\n          "name"       : "custom_alerts_widget"\n        },\n        {\n          "id"         : "custom_lists",\n          "styleClass" : "topmetric",\n          "name"       : "top_lists_widget",\n          "aspectsConfig" : {\n            "availableSizes" : ["m", "l", "xl"]\n          }\n        },\n        {\n          "id"         : "custom_alerts",\n          "styleClass" : "performance",\n          "name"       : "custom_chart_widget"\n        },\n        {\n          "id"         : "ClusterInfo",\n          "styleClass" : "cluster_info",\n          "name"       : "cluster_info_widget",\n          "aspectsConfig" : {\n            "availableSizes" : ["l"],\n            "isAvaliableOnPrismCentral" : false\n          }\n        }\n      ]\n    },\n    {\n      "id"    : "virtual_widgets",\n      "title" : "Virtual Infrastructure Widgets",\n      "aspectsConfig" : {\n        "isShowAspects" : false\n      },\n      "vantagePoints" : [\n        { "id" : "vm_efficiency" }\n      ]\n    },\n    {\n      "id"    : "cluster_widgets",\n      "title" : "Hardware Widgets",\n      "aspectsConfig" : {\n        "isShowAspects" : false\n      },\n      "vantagePoints" : [\n        { "id" : "clusterCPUUsage" },\n        { "id" : "clusterLatency" },\n        { "id" : "clusterMemoryUsage" },\n        { "id" : "clusterQuickAccess" },\n        { "id" : "clusterRunway" },\n        { "id" : "clusterStorage" },\n        { "id" : "controllerIOPS" },\n        { "id" : "ImpactedCluster" },\n        { "id" : "Performance" }\n      ]\n    },\n    {\n      "id"    : "activity_widgets",\n      "title" : "Activity Widgets",\n      "aspectsConfig" : {\n        "isShowAspects" : false\n      },\n      "vantagePoints" : [\n        { "id" : "Tasks" }\n      ]\n    },\n    {\n      "id"    : "operation_widgets",\n      "title" : "Operations Widgets",\n      "aspectsConfig" : {\n        "isShowAspects" : false\n      },\n      "vantagePoints" : [\n        { "id" : "xplay_summary" },\n        { "id" : "reports"}\n      ]\n    },\n    {\n      "id": "app_widgets",\n      "title": "App Widgets",\n      "aspectsConfig" : {\n        "isShowAspects" : false\n      },\n      "vantagePoints" : [\n        { "id" : "launchApps" }\n      ]\n    }\n  ]\n}\n'}),define("text!templates/popups/dashboards/AddVantagePointPopupView.html",[],function(){return'\x3c!-- The parent div modal is #popupAddVantagePoint --\x3e\n<div class="modal-header">\n  <button type="button" class="close xClose" data-dismiss="modal">\n    <%= Components.icon("K") %>\n  </button>\n  <h4 class="n-title"><%= i18n(\'add_widgets\',\'Add Widgets\') %></h4>\n</div>\n<div class="n-modal-wrapper">\n  <div class="n-modal-body">\n    <div class="n-modal-content-wrapper">\n      <div class="n-modal-alert-header">\n        \x3c!-- @view: alert goes here... --\x3e\n      </div>\n      \x3c!-- Form to add vantagePoints --\x3e\n      <form class="form-horizontal" onsubmit="return false;">\n        <div class="left-panel">\n          <div class="search-box">\n            <div class="filterBox filter-box">\n              <div class="searchIcon icon -search">\n                <%= Components.icon("B", "-inline") %>\n              </div>\n              <input\n                class="input vantagePointFilter vantagePointFilterChange"\n                type="text"\n                placeholder="<%= i18n(\'search_for_widget\') %>"\n              >\n            </div>\n          </div>\n\n          <div id="addVantagePointList" class="widget-list">\n          </div>\n        </div>\n\n        <div class="rightPanel right-panel">\n          <div class="vantagePointAttributes widget-settings">\n            \x3c!-- The right nav bar for vantage point aspects will go here  --\x3e\n          </div>\n\n          \x3c!-- No attribute message --\x3e\n          <div class="vantagePointNoAttributes no-attributes">\n            \x3c!-- The message will go here. --\x3e\n          </div>\n\n          <div class="control-group actions add-widget">\n            <button\n              class="btnAddVantagePoint btn btn-primary"\n              type="button"\n              stream-action="Dashboards: AddWidget"\n              stream-target="Dashboard"\n              <%= getQaDataTestId(\'btn_add\') %>\n            >\n              <%= i18n("add_to_dashboard") %>\n            </button>\n            <a\n              class="linkAddVantagePoint link-add-widget-close"\n              stream-action="Dashboards: AddWidgetAndStay"\n              stream-target="Dashboard"\n              <%= getQaDataTestId(\'btn_add_and_return\') %>\n            >\n              <%= i18n("add_and_return") %>\n            </a>\n          </div>\n        </div>\n\n        <div class="preview-pane">\n          <div class="vantagePointPreview preview">\n            <div class="instructions">\n              <%= i18n("select_widget","Select a widget from the \\\n              left sidebar to preview and customize the content.") %>\n            </div>\n            <ul class="n-vantage-grid" <%= getQaDataTestId(\'preview\') %> >\n              \x3c!-- @view: vantage point goes here... --\x3e\n            </ul>\n          </div>\n        </div>\n      </form>\n    </div>\n  </div>\n</div>\n'}),define("views/popups/dashboards/AddVantagePointPopupView",["views/basecomponents/popups/BasePopupView","models/dashboard/VantagePointModel","views/basecomponents/vantagepoints/VantagePointLayoutDescriptor","views/basecomponents/vantagepoints/VantagePointTemplates","data/DataProperties","utils/AppConstants","utils/AppUtil","utils/VantagePointFactory","utils/SubViewHelper","managers/DashboardManager","managers/NotificationManager","events/AppEvents","views/popups/dashboards/aspects/PreDefinedVantagePointAspectsView","views/popups/dashboards/aspects/CustomAlertVantagePointAspectsView","views/popups/dashboards/aspects/CustomTopMetricVantagePointAspectsView","views/popups/dashboards/aspects/CustomChartVantagePointAspectsView","views/popups/dashboards/aspects/CustomClusterInfoVantagePointAspectsView","text!extras/dashboard/add-vantagepoint-config.json","text!extras/dashboard/vantagepoints.json","text!templates/popups/dashboards/AddVantagePointPopupView.html"],function(e,t,n,i,s,a,o,r,l,c,d,p,u,h,m,f,v,g,E,T){"use strict";var C={CLUSTER:"cluster",STORAGE:"storage",VM:"vm",HARDWARE:"hardware",DR:"dr",VP_PREDEFINED:"vp_predefined",VP_CATEGORY:{APP_WIDGETS:"app_widgets",CLUSTER_WIDGETS:"cluster_widgets",OPERATION_WIDGETS:"operation_widgets",VIRTUAL_WIDGETS:"virtual_widgets",ACTIVITY_WIDGETS:"activity_widgets"}},S={SELECT_METRIC_PROMPT:"Select a metric",INVALID_INPUT:"One or more invalid input(s).",REQUIRED_FIELD:"This is a required field"},A=_.template('Successfully added the widget "<%- name %>" to the dashboard.'),b=_.template('<div data-id="<%=category.id%>" class="categoryList widget-category"> <div class="title"> <%= i18n(category.id) %> </div> <ul class="category nav nav-pills nav-stacked <%=category.styleClass || "" %>"> <% _.each(category.vantagePoints, function(vantagePoint) { %><li data-vp-category="<%=category.id%>" data-vp-id="<%= vantagePoint.id %>"stream-action="Dashboards: SelectWidget" stream-target="<%= vantagePoint.name %>"class="n-li-item-checkbox vantagePoint widget <%= vantagePoint.styleClass || "" %>"> <%= vantagePoint.title %> </li><% }) %></ul> </div>'),y={MULTICLUSTER:"This is a predefined widget. There are no customizations available."};return e.extend({NOTIFICATION_VIEW_CUSTOM_CLASS:"n-popup-notification",name:"AddVantagePointPopupView",el:"#popupAddVantagePoint",categoriesMap:null,template:_.template(T),rowTemplate:_.template('<li class="n-li-item-checkbox vantagePoint widget"> <%=model%> </li>'),previewVantagePoint:null,vantagePointEl:null,vantagePointModel:null,addVantagePointGrid:null,targetVantagePointGrid:null,type:null,subViewHelper:null,addVantagePointConfigJSON:null,isCustomVPName:!1,isChanging:!1,events:{"click .btnCancel":"hide","click .btnAddVantagePoint":"onClickAddAndStayBtn","click .linkAddVantagePoint":"onClickAddVantagePoint","click .modal-header .close":"hide","click #addVantagePointList .vantagePoint":"onClickVantagePoint","keyup .vantagePointFilter":"onVantagePointFilter","keyup .vantagePointFilterChange":"onVantagePointFilterChange","click .filterBox > .searchIcon":"onClearClicked","change .aspect":"onChangeAspect","input .vantagePointName":"onChangeVantagePointName"},initialize:function(){this.addVantagePointConfigJSON=this._loadAddVantagePointConfigJSON(),this.categoriesMap={},_.each(this.addVantagePointConfigJSON[a.ADD_VP_CONFIG_FILE.GROUPS],function(e){this.categoriesMap[e[a.ADD_VP_CONFIG_FILE.ID]]=e},this),this.subViewHelper=new l,this.subViewHelper.register(a.VP_TYPE.PERFORMANCE,new f),this.subViewHelper.register(a.VP_TYPE.ALERT,new h),this.subViewHelper.register(a.VP_TYPE.CLUSTER_INFO,new v),this.subViewHelper.register(a.VP_TYPE.TOP_METRIC,new m),this.subViewHelper.register(C.VP_PREDEFINED,new u),this.subViewHelper.iterate("initialize"),_.bindAll(this,"onChangeAspect")},render:function(){$("body").addClass("zoom-out"),this.$el.html(this.template(this.vtOptions({canModify:this.canModifyByEntityType(a.ENTITY_DASHBOARD)})));var e=n.getAddVantagePointLayout(this.$(".vantagePointPreview"));this.addVantagePointGrid=this.$(".vantagePointPreview > ul").gridster({widget_margins:[e.margin_horizontal,e.margin_vertical],widget_base_dimensions:[e.block_width,e.block_height],min_rows:e.min_rows,min_cols:e.min_cols,max_size_x:e.max_size_x,max_size_y:e.max_size_y,autogenerate_stylesheet:!1}).data("gridster").disable(),this.targetVantagePointGrid=$(".n-dashboard.gridster ul.n-vantage-grid").gridster().data("gridster")},show:function(t){e.prototype.show.apply(this,arguments),this._displayVantagePoints(),c.registerDashboardListener(c.EVENTS.ERROR,this._showErrorNotification,this),c.registerDashboardListener(c.EVENTS.SUCCESS,this._showSuccessNotification,this),c.registerDashboardListener(c.EVENTS.ADD_VANTAGEPOINT,this.onAddVantagePointSuccess,this),p.onAppEvent(p.REFRESH_VANTAGEPOINT_PREVIEW,this.onChangeAspect),$("#n-ctr-notification").addClass(this.NOTIFICATION_VIEW_CUSTOM_CLASS)},reset:function(){this.clearHeader(),this.undelegateEvents()},hide:function(e){e=e||!0,e&&$("#n-ctr-notification.n-popup-notification .n-notification-msg").removeClass("n-show").addClass("n-hide"),$("body").addClass("zoom-in").removeClass("zoom-out"),this.$el.addClass("deactivate"),$("#n-ctr-notification").removeClass(this.NOTIFICATION_VIEW_CUSTOM_CLASS);var t=this,n=function(e){e.removeClass("zoom-in");var n=function(){t.$el.nutanixPopup({show:!1,cleanUp:_.bind(t.destroy,t)}),t.resetVerticalPosition(),t.actionRoute?p.triggerAppEvent(p.POPUP_CLOSE,[t.actionRoute]):p.triggerAppEvent(p.POPUP_CLOSE,null),$(window).trigger("resize.app")};t.canHide()&&t.confirmHide(n)};o.onAnimationEnd(this.$el,n,null,$("body"))},destroy:function(){this.previewVantagePoint&&(this.previewVantagePoint.stopServices(),this.previewVantagePoint=null),this.addVantagePointGrid&&(this.addVantagePointGrid.remove_all_widgets(),this.addVantagePointGrid=null),this.vantagePointEl=null,c.unregisterDashboardListener(c.EVENTS.ERROR),c.unregisterDashboardListener(c.EVENTS.SUCCESS),c.unregisterDashboardListener(c.EVENTS.ADD_VANTAGEPOINT,this.onAddVantagePointSuccess,this),p.offAppEvent(p.REFRESH_VANTAGEPOINT_PREVIEW,this.onChangeAspect),this.subViewHelper.destroy(),e.prototype.destroy.apply(this,arguments)},resetActiveVantagePoint:function(e){var t=$.Deferred();if(e=e||this.$("#addVantagePointList .vantagePoint.active"),e.length){this.vantagePointModel=null,this.isCustomVPName=!1,
this.$("#addVantagePointList .vantagePoint").removeClass("active"),e.addClass("active"),this.$(".rightPanel").addClass("show"),this.$(".vantagePointPreview > .instructions").addClass("hide");var n=this.subViewHelper.get(this.type);n&&n.destroy(),e.closest(".category").hasClass("customVantagePoints")?($(e).hasClass("alerts")&&(this.type=a.VP_TYPE.ALERT),$(e).hasClass("topmetric")&&(this.type=a.VP_TYPE.TOP_METRIC),$(e).hasClass("performance")&&(this.type=a.VP_TYPE.PERFORMANCE),$(e).hasClass("cluster_info")&&(this.type=a.VP_TYPE.CLUSTER_INFO)):this.type=C.VP_PREDEFINED,this._renderVantagePoint(e).always(function(){t.resolve()})}else t.resolve();return t.promise()},onClickVantagePoint:function(e){this.resetActiveVantagePoint($(e.currentTarget))},onChangeAspect:function(){var e=this.vantagePointModel;if(e){this.isChanging=!0;var t=this.subViewHelper.get(this.type);t&&t.onChangeAspects(this.isCustomVPName),t.populateVantagePointModelAspects(e),this._cleanupAndCreateNewVantagePoint(e)}},onChangeVantagePointName:_.debounce(function(){this.isCustomVPName=!0},300),onClickAddVantagePoint:function(e,t){this.validateFields()?(this.$(".btnAddVantagePoint").addClass("disabled"),this.$(".linkAddVantagePoint").addClass("disabled"),this.trackAspectAddition(t)):d.showClientNotification(a.NOTIFY_ERROR,S.INVALID_INPUT,{temporary:!0})},trackAspectAddition:function(e){var t=this.showHeaderSaving(),n=this.vantagePointModel,i=this,s=this.targetVantagePointGrid.next_position();n.set(n.DP.POSITION,s);var a=function(){c.getCurrentDashboard().disableVantagePointAutoAdd(n),c.addVantagePoint(n,{success:function(){i.resetActiveVantagePoint().always(function(){e||i.hide(!1),i._clearSaveState(t)})},error:function(){i._clearSaveState(t)}})};o.setIntervalWithTimeout({timeoutPeriod:1e4,intervalPeriod:250,timeoutHandler:function(){o.log("AddVantagePointPopupView: _addCurrentVantagePoint: ERROR: Add operation timed out waiting for the vantage point to update")},intervalHandler:function(){return!i.isChanging&&(a(),!0)}})},onClickAddAndStayBtn:function(){if(this.validateFields()){if(this.$(".btnAddVantagePoint").hasClass("disabled"))return;this.$(".linkAddVantagePoint").trigger("click",[!0])}else d.showClientNotification(a.NOTIFY_ERROR,S.INVALID_INPUT,{temporary:!0})},onClearClicked:function(e){this.$(".vantagePointFilter").val(""),this.$(".vantagePointFilter").keyup()},onVantagePointFilterChange:function(e){var t=$(e.currentTarget).val(),n=this.$(".filterBox > .searchIcon");""===t?(n.find("use").attr("xlink:href","#B"),o.removeSVGClass(n,"-clear")):(n.find("use").attr("xlink:href","#v"),o.addSVGClass(n,"-clear"))},onVantagePointFilter:function(e){var t=$(e.currentTarget).val();this._displayVantagePoints(t.trim())},onAddVantagePointSuccess:function(e){var t=e?e.get(e.nameAttribute):"",n=A({name:t});this._showSuccessNotification(null,n)},showHeaderSaving:function(e){var t=e||"Saving";return d.showLatencyMessage(t)},_loadAddVantagePointConfigJSON:function(){var e,t;try{e=JSON.parse(g),t=JSON.parse(E),_.each(e.groups,function(e){var n=e.vantagePoints;n&&n.length&&_.each(n,function(e,i){var a=e[s.ID];if(a){var o=t[a];o&&(n[i]=$.extend({},o,e))}},this)},this)}catch(t){o.log("AddVantagePointPopupView: Failed to read config json files"+t),e={}}return e},_createVantagePointView:function(e){var t=$.Deferred();if(this.addVantagePointGrid){var a=n.getVantagePointLayout(e);this.vantagePointEl=this.addVantagePointGrid.add_widget(i.VANTAGE_POINT_WIDGET,a.size_x,a.size_y,1,1,e.get(s.ID));var o=this;return r.getVantagePointView(e,null,function(n){o.previewVantagePoint=n,o.previewVantagePoint.setPreviewMode(!0),o.vantagePointModel=e,o.previewVantagePoint&&(o.vantagePointEl.html(o.previewVantagePoint.render().$el),o.applyNutanixInput(),o.previewVantagePoint.startServices(),o.isChanging=!1),t.resolve()}),t.promise()}},_renderVantagePoint:function(e){var n,i=null,s=e.data("vp-category"),a=e.data("vp-id");this.type===C.VP_PREDEFINED?(i=this._retrieveSelectedVantagePointJSON(s,a),n=new t(i)):n=new t,n.set(n.DP.IS_CUSTOM_VP,!0),n.setId(o.randomId("vpid"));var r=this._retrieveVantagePointAspectsConfig(s,a),l=this.subViewHelper.get(this.type);l&&(l.setElement(this.$(".vantagePointAttributes")),i&&l.setPreDefinedVPTemplate(i),l.render(e,r),l.delegateEvents(),l.populateVantagePointModelAspects(n));var c=this.$(".vantagePointNoAttributes");return c.removeClass("show").empty(),this.$(".vantagePointAttributes").is(":visible")||(c.addClass("show"),s!==C.VP_CATEGORY.CLUSTER_WIDGETS&&s!==C.VP_CATEGORY.APP_WIDGETS&&s!==C.VP_CATEGORY.OPERATION_WIDGETS&&s!==C.VP_CATEGORY.ACTIVITY_WIDGETS&&s!==C.VP_CATEGORY.VIRTUAL_WIDGETS||c.html(this.i18n("no_customizations",y.MULTICLUSTER))),this._cleanupAndCreateNewVantagePoint(n)},_displayVantagePoints:function(e){var t=this.$("#addVantagePointList");t.empty();var n=this.categoriesMap;e&&e.trim().length&&(n=$.extend(!0,{},this.categoriesMap),_.each(n,function(t,i){var o=t[a.ADD_VP_CONFIG_FILE.VANTAGE_POINTS];o=_.filter(o,function(t){var n=t[s.VP_TITLE]||t[s.NAME];if(n){var i=e.trim().toLowerCase();return-1!==n.trim().toLowerCase().indexOf(i)}}),0===o.length?delete n[i]:t[a.ADD_VP_CONFIG_FILE.VANTAGE_POINTS]=o})),_.each(n,function(e){_.each(e.vantagePoints,function(t,n){e.vantagePoints[n].title=this.i18n(t.name,t.name)},this);var n=b(this.vtOptions({category:e}));t.append(n)},this)},_cleanupAndCreateNewVantagePoint:function(e){var t=$.Deferred(),n=this;this.previewVantagePoint&&(this.previewVantagePoint.stopServices(),this.previewVantagePoint=null);var i=function(){var i=n._createVantagePointView(e);if(!i)return void t.resolve();i.always(function(){t.resolve()})};return this.vantagePointEl?this.addVantagePointGrid.remove_widget(this.vantagePointEl,!1,i):i(),t.promise()},_retrieveSelectedVantagePointJSON:function(e,t){var n=this.categoriesMap[e],i=_.find(n.vantagePoints,function(e){return e.id===t});return i&&(i=$.extend(!0,{},i),delete i[a.ADD_VP_CONFIG_FILE.ASPECTS_CONFIG],delete i[a.ADD_VP_CONFIG_FILE.STYLE_CLASS]),i},_retrieveVantagePointAspectsConfig:function(e,t){var n,i=this.categoriesMap[e],s={},o=this.addVantagePointConfigJSON[a.ADD_VP_CONFIG_FILE.ASPECTS_CONFIG],r=i[a.ADD_VP_CONFIG_FILE.ASPECTS_CONFIG];if(i.vantagePoints){n=_.find(i.vantagePoints,function(e){return e[a.ADD_VP_CONFIG_FILE.ID]===t})[a.ADD_VP_CONFIG_FILE.ASPECTS_CONFIG]}return s=_.extend(s,o,r,n)},_showSuccessNotification:function(e,t){d.showClientNotification(a.NOTIFY_SUCCESS,t)},_showErrorNotification:function(e,t){d.showClientNotification(a.NOTIFY_ERROR,t)},_clearSaveState:function(e){this.$(".btnAddVantagePoint").removeClass("disabled"),this.$(".linkAddVantagePoint").removeClass("disabled"),d.hideLatencyMessage(e)},validateFields:function(){var e=this.$(".vantagePointAttributes  #searchText"),t=this.$(".vantagePointAttributes .ui-autocomplete-input"),n=this.$(".vantagePointAttributes .error-msg-entity-type"),i=this.$(".vantagePointAttributes .error-msg-metric");return e.length&&!e.val().trim()?(n.show(),n.text(S.REQUIRED_FIELD),!1):!t.length||t.val().trim()!==S.SELECT_METRIC_PROMPT&&""!==t.val().trim()?!(n.length&&n.is(":visible")||i.length&&i.is(":visible")):(i.show(),i.text(S.REQUIRED_FIELD),!1)}})}),define("text!templates/popups/imageservice/AcropolisImageContentView.html",[],function(){return'\x3c!-- The parent div modal is #popupImageConfig --\x3e\n<div data-ntnx-content-inner class="listContainer" style="display:none;">\n  <% if (canModify) { %>\n\n    <section data-ntnx-section="type-text">\n      <%= i18n(\'descManageImages\') %>\n    </section>\n\n    <section data-ntnx-section>\n      <div class="btn-create-ctr">\n        <button class="btnCreate btn btn-small n-btn-list\n          <% if (readOnly) { %> disabled <% } %>"\n            data-test="imageCreateBtn"\n            data-loading-text="<%= i18n(\'saving\') %>">\n          <i data-icon="H" aria-hidden="true"></i>\n          <span class="btn-content"><%= i18n(\'btnUploadImage\') %></span>\n        </button>\n      </div>\n    </section>\n\n  <% } %>\n\n  <section data-ntnx-section class="control-group image-controls">\n    <table id="acropolisImageList" class="table table-hover"\n        data-test="imageListTable">\n      <thead>\n        <tr>\n          <th class="name-cell"><%= i18n(\'name\') %></th>\n          <th class="image-annotation-cell"><%= i18n(\'colAnnotation\') %></th>\n          <th><%= i18n(\'colType\') %></th>\n          <th><%= i18n(\'colState\') %></th>\n          <th><%= i18n(\'colSize\') %></th>\n        </tr>\n      </thead>\n      <tbody>\n      \x3c!-- @view: Acropolis images go here... --\x3e\n      </tbody>\n    </table>\n  </section>\n\n</div>\n\n\x3c!-- Acropolis Image Settings Form --\x3e\n<div data-ntnx-content-inner class="image-form-wrapper formContainer">\n  <div id="acropolisImageForm" class="form-horizontal">\n    \x3c!-- @view: form goes here... --\x3e\n  </div>\n</div>\n'}),define("text!templates/popups/imageservice/AcropolisImageFormView.html",[],function(){return'\x3c!-- Edit Acropolis Image Form --\x3e\n<form id="uploadPemKeyForm" class="form-horizontal"\n    target="upload_target" method="post" enctype="multipart/form-data">\n\n    <section data-ntnx-section>\n      <label data-ntnx-label for="image-name">Name</label>\n      <input type="text" class="image-name" />\n    </section>\n\n    <section data-ntnx-section class="annotation-wrapper">\n      <label data-ntnx-label>Annotation</label>\n      <input type="text" class="image-annotation" data-test="imageAnnotation">\n    </section>\n\n    <section data-ntnx-section class="image-type-wrapper">\n      <label data-ntnx-label for="image-type">\n        Image Type\n      </label>\n      <select class="image-type">\n        <option value="" class=\'blank\'>Not Selected</option>\n        <option value="ISO_IMAGE">ISO</option>\n        <option value="DISK_IMAGE">DISK</option>\n      </select>\n    </section>\n\n    <section data-ntnx-section class="container-wrapper">\n      <label data-ntnx-label>Storage Container</label>\n      <select class="image-container" data-class="fancy-select-top-anchor"\n              data-test="imageContainerSelect">\n      </select>\n    </section>\n\n    <section data-ntnx-section class="source-wrapper">\n      <label data-ntnx-label>Image Source\n        <div class="source-icon">\n          <%= SVG.SVGIcon(\'information-tooltip\') %>\n        </div>\n      </label>\n      <div data-ntnx-form-inline="form-full-width" class="image-option">\n        <div class="n-radio-container">\n          <input type="radio" id="from-url"\n                 data-test="radioImageURL" name="source" value="url" checked>\n          <label data-ntnx-inline-label for="from-url">\n            From URL\n          </label>\n        </div>\n        <input type="text" class="image-url"\n               data-test="imageURL">\n      </div>\n      <div data-ntnx-form-inline="form-full-width" class="image-option">\n        <div class="n-radio-container">\n          <input type="radio" id="upload"\n                 data-test="raidoImageUpload" name="source" value="upload">\n          <label data-ntnx-inline-label for="upload">\n            Upload a file\n            <span class="n-help-display-tooltip"></span>\n          </label>\n        </div>\n        <input type="file" class="image-binary"\n               data-test="acropolisimageformview_fileinput_imagebinary"\n               name="image-binary" disabled/>\n      </div>\n    </section>\n\n</form>'}),define("text!templates/popups/imageservice/AcropolisImageItemView.html",[],function(){return'<tr class="n-table-row">\n  <td  class="name-cell" title="<%= model.get(model.nameAttribute) %>">\n    <%= model.get(model.nameAttribute) %>\n  </td>\n  <td class="image-annotation-cell" title= "<%=\n      model.get(model.DP.ANNOTATION) || \'\' %>">\n    <%= model.get(model.DP.ANNOTATION) || \'\' %>\n  </td>\n  <td class="image-type-cell">\n    <%= model.get(model.DP.IMAGE_TYPE) ?\n        model.get(model.DP.IMAGE_TYPE).split(\'_\')[0] : \'\'%>\n  </td>\n  <td class="image-state-cell">\n    <%= model.get(model.DP.IMAGE_STATE) %>\n  </td>\n  <td class="image-size-cell">\n    <%= imageSize %>\n  </td>\n  <td class="cell-actions <% if (!imageOwnedByPE) { %> imageOwnedByPC <% } %>"\n    dataId="<%= model.get(model.idAttribute) %>">\n    <% if (canModify) { %>\n      <i class="btnEdit <% if (!canEdit) { %> disabled  <% } %>"\n        data-icon="F" aria-hidden="true"></i>\n      <span class="action-separator">&middot;</span>\n      <i class="btnDelete <% if (!imageOwnedByPE) { %> disabled <% } %>"\n        data-icon="v" aria-hidden="true" ></i>\n    <% } %>\n  </td>\n</tr>\n'}),define("views/popups/imageservice/AcropolisImagePopupView",["views/basecomponents/popups/BasePopupView","data/DataProperties","models/imageservice/AcropolisImageCollection","models/imageservice/AcropolisImageModel","models/storage/ContainerCollection","models/capacityplanning/CPQueryModel","models/cluster/ClusterExternalStateModel","utils/AppConstants","utils/AppUtil","utils/VisualizationUtil","utils/SVG","utils/DataExportUtil","utils/StatsUtil","managers/ActionManager","managers/IdleManager","managers/ClusterManager","text!templates/popups/imageservice/AcropolisImageContentView.html","text!templates/popups/imageservice/AcropolisImageFormView.html","text!templates/popups/imageservice/AcropolisImageItemView.html"],function(e,t,n,i,s,a,o,r,l,c,d,p,u,h,m,f,v,g,E){"use strict";v=_.template(v),E=_.template(E),g=_.template(g);return e.extend({name:"AcropolisImagePopupView",el:"#popupImageConfig",collection:null,containerCollection:null,imagesGroupsQueryModel:null,ipPools:null,ipPoolMode:null,currentIpPoolIndex:null,disableChecksumCalculation:!0,FILE_EXT:{ISO:".iso"},events:{"click .image-controls .btnDelete":"onDeleteImage","click .image-controls .btnEdit":"onEditImage","click .btnUpdate":"onSaveClick","click .btnBack":"onBackClick","click .btnCancel":"discardChanges","click .btnCreate":"onCreateClick","click .modal-header .close":"hide","change .image-option input[type=radio]":"disableInputs","keypress input":"onKeyPress","click input":"hideAlert","mouseover .n-error-details":"onMouseOverErrorDetails","mouseout .n-error-details":"onMouseOutErrorDetails","click   .create-container-link":"openCreateContainerPopup","open .fancy-select .trigger":"refreshAntiscroll","close .fancy-select .trigger":"refreshAntiscroll","keyup .image-url":"setImageType","change .image-binary":"setImageType"},initialize:function(){this.collection=new n,this.containerCollection=new s,this.imagesGroupsQueryModel=new a({entity_type:r.ENTITY_IMAGE,group_member_attributes:[t.OWNER_CLUSTER_UUID,t.UUID]}),this.clusterExternalStateModel=new o,e.prototype.initialize.apply(this,arguments),_.bindAll(this,"onBeforeUnload")},render:function(){var e=this,t=this.canModifyByEntityType(r.ENTITY_ACROPOLIS_IMAGE),n=[{leftAligned:!0,text:this.i18n("back"),extraClasses:"btnBack n-btn-form hide",iconLeft:"caret-left"},{text:this.i18n("cancel"),extraClasses:"btnCancel n-btn-form hide"}];t&&n.push({isPrimary:!0,text:this.i18n("save"),extraClasses:"btnUpdate n-btn-form hide",extraAttr:[{key:"data-loading-text",value:this.i18n("saving")},{key:"data-test",value:"imageBtnSave"}]}),this.$el.html(this.defaultTemplate({title:this.i18n("titleImageManagement"),antiscroll:!1,bodyContent:v(this.vtOptions({canModify:t,readOnly:!1})),footerButtons:this.defaultFooter(n)})),this.clusterExternalStateModel.fetch({success:function(){e.showImageList(!0)},error:function(t,n){e.$(".n-modal-footer").hide(),e.showHeaderError(n.responseText||e.i18n("serverError"))}})},show:function(t){e.prototype.show.apply(this,arguments)},reset:function(){this.showImageList(),this.undelegateEvents()},listImage:function(e){var n=this,i=[];this.triggerAction(r.MODAL.ACT.ALERT_SHOW,{type:r.MODAL.ALERT.TYPE_LOADING}),i.push(this.collection.fetch()),i.push(this.containerCollection.fetch()),i.push(this.imagesGroupsQueryModel.save()),$.when.apply($,i).done(function(){n.hideSubview(".formContainer"),n.showSubview(".listContainer",null,e);var i=n.$("#acropolisImageList > tbody");i.html("");var s=void 0;if(n.collection.size()>0){s=n.canModifyByEntityType(r.ENTITY_ACROPOLIS_IMAGE);var a=n.imagesGroupsQueryModel.getQueryResultAttributes();n.collection.each(function(e){var n=void 0,o=!1;(n=_.find(a,function(n){return n.uuid===e.get(t.UUID)}))&&(o=n[t.OWNER_CLUSTER_UUID]===f.getCurrentClusterUuid());var r=E({model:e,canModify:s,canEdit:o&&e.isActive(),imageOwnedByPE:o,imageSize:u.storageFormat(e.get(t.VM_DISK_SIZE))});i.append(r)}),s&&n.$(".imageOwnedByPC").tooltip({title:n.i18n("imageOwnedByPC"),placement:r.TOOLTIP_POSITION.TOP,container:$("body"),trigger:r.TOOLTIP_HOVER,html:!1})}else n.$(".n-modal-content-group").show(),i.html("<tr><td colspan=4>No images have been created.</tr></td>");n.triggerAction(r.MODAL.ACT.ALERT_HIDE),n.triggerAction(r.MODAL.ACT.AS_REBUILD)}).fail(function(e){n.triggerAction(r.MODAL.ACT.ALERT_SHOW,{type:r.MODAL.ALERT.TYPE_ERROR,message:e})}).always(function(){n.triggerAction(r.MODAL.ACT.AS_REBUILD)})},showImageList:function(e){this.currentImageModel=null,this.$(".n-title").text("Image Configuration"),this.listImage(e),this.$(".n-btn-form").hide(),this.$(".n-btn-list").show()},showImageForm:function(e,n){this.mode=e||this.mode,this.clearHeader(),this.hideSubview(".listContainer"),this.showSubview(".formContainer","left"),this.$(".n-title").text(r.ACTION_NAMES[this.mode]+" "+r.ENTITY_NAMES[r.ENTITY_ACROPOLIS_IMAGE]),n&&(this.renderFormTemplate(),this.containerCollection.models.length?this.containerCollection.each(function(e){if(!e.isSystemContainer()){var n=e.get(t.CONTAINER_UUID);this.$("#acropolisImageForm .image-container").append('\n                  <option value="'+n+'">\n                    '+e.get(t.NAME)+"\n                  </option>")}},this):(this.$(".image-container").remove(),this.$(".container-wrapper .controls").append('<a action="create" actiontarget="container"class="create-container-link"data-test="settings_menu_create_container"tabindex="-1" class="">Create Storage Container</a>')),this.$(".source-icon").hide(),this.currentImageModel&&(this.$(".image-name").val(this.currentImageModel.get(this.currentImageModel.nameAttribute)),this.$(".image-annotation").val(this.currentImageModel.get(this.currentImageModel.DP.ANNOTATION)),this.$(".image-container").val(this.currentImageModel.get(this.currentImageModel.DP.imageImportSpec.CONTAINER_UUID)),this.$(".image-type").val(this.currentImageModel.get(this.currentImageModel.DP.IMAGE_TYPE)),this.currentImageModel.get(this.currentImageModel.DP.IMAGE_TYPE)&&this.$("option.blank").remove(),this.currentImageModel.isActive()&&(this.$(".source-wrapper").addClass("disable"),this.$(".source-wrapper input").prop("disabled",!0),this.$(".source-icon").show().tooltip("destroy").tooltip({title:"Image source cannot be modified because this image is active.",placement:"right",container:"body",trigger:r.TOOLTIP_HOVER,html:!1})))),this.applyNutanixInput({types:["select","radio"]}),this.$(".n-btn-form").show(),this.$(".n-btn-list").hide(),e===r.ACTION_UPDATE&&this.currentImageModel.isActive()&&this.$("select.image-container").trigger("disable")},renderFormTemplate:function(){this.$("#acropolisImageForm").html(g({SVG:d})),this.$(".n-help-display-tooltip").nutanixMoreInfo({title:this.i18n("imageSizeTooltipMessage"),placement:r.TOOLTIP_POSITION.RIGHT,container:"body"})},getImageModelInstance:function(){return new i},setImageType:function(e){$(e.currentTarget).val().endsWith(this.FILE_EXT.ISO)?this.$(".image-type").val("ISO_IMAGE").trigger("update"):this.$(".image-type").val("DISK_IMAGE").trigger("update")},hideAlert:function(){this.triggerAction(r.MODAL.ACT.ALERT_HIDE)},refreshAntiscroll:function(){this.triggerAction(r.MODAL.ACT.AS_REFRESH)},generateModelFromFormOrDisplayError:function(){var e=this.getImageModelInstance(),t=e.DP,n=t[t.IMAGE_IMPORT_SPEC],i={},s=this.$(".image-container").val();e.containerId=s,e.set(e.nameAttribute,p.stripTags(this.$(".image-name").val().trim())),e.set(t.ANNOTATION,p.stripTags(this.$(".image-annotation").val().trim()));var a=this.$(".image-type").val();if(a&&e.set(t.IMAGE_TYPE,e.IMAGE_TYPES[a]),!(this.currentImageModel&&this.currentImageModel.isActive()))if(this.$("#from-url").prop("checked")){i[n.CONTAINER_UUID]=s;var o=this.$(".image-url").val().trim();if(!o)return void this.triggerAction(r.MODAL.ACT.ALERT_SHOW,{type:r.MODAL.ALERT.TYPE_ERROR,message:"Please enter a URL."});i[n.URL]=o,e.set(t.IMAGE_IMPORT_SPEC,i)}else{var l=this.$("input.image-binary")[0].files[0];if(!l)return void this.triggerAction(r.MODAL.ACT.ALERT_SHOW,{type:r.MODAL.ALERT.TYPE_ERROR,message:"Please choose a file to upload."});e.imageBinary=l}return e},onBeforeUnload:function(){return(this.mode===r.ACTION_UPDATE?"Updating":"Creating")+" image."},createOrUpdateImage:function(){var e=this,n=this.generateModelFromFormOrDisplayError();if(!n)return void this.enableImageForm();e.abortRequest=!1,n.actionMode=this.mode,this.mode===r.ACTION_UPDATE&&(n.set(t.UUID,this.currentImageModel.get(t.UUID)),n.set(i.DP.LOGICAL_TIMESTAMP,this.currentImageModel.get(i.DP.LOGICAL_TIMESTAMP))),n.imageBinary?(this.showImageCreationProgress(n),e.disableChecksumCalculation?this.saveImage(n):l.calculateFileMD5Async(n.imageBinary,{},function(t){n.set(i.DP.imageImportSpec.CHECKSUM,t),n.set(i.DP.imageImportSpec.CHECKSUM_TYPE,"MD5"),e.saveImage(n),e.$(".donut-loader-blue").show()},function(t){e.triggerAction(r.MODAL.ACT.ALERT_SHOW,{type:r.MODAL.ALERT.TYPE_INFO,message:"Calculating MD5 checksum: "+t.toFixed(0)+"%"}),e.$(".donut-loader-blue").hide()})):(this.saveImage(n),this.showImageCreationProgress(n))},saveImage:function(e){var t=this;e.save(null,{success:function(){t.showImageList(),t.applyImageSaveSuccess();var n=e.imageBinary?"Successfully created image ":"Received operation to create image ",i=t.mode===r.ACTION_UPDATE?"Successfully updated image ":n;t.triggerAction(r.MODAL.ACT.ALERT_SHOW,{type:r.MODAL.ALERT.TYPE_SUCCESS,message:i+e.get(e.nameAttribute)+"."})},error:function(e){t.showImageList(),t.applyImageSaveError();var n=t.abortRequest?null:"Error creating image:",i=t.mode===r.ACTION_UPDATE?"Error updating image:":n;t.triggerAction(r.MODAL.ACT.ALERT_SHOW,{type:r.MODAL.ALERT.TYPE_ERROR,message:i,details:e})},always:function(){t.triggerAction(r.MODAL.ACT.ALERT_SHOW,{type:r.MODAL.ALERT.TYPE_INFO,message:"Loading data... "}),t.$(".btnUpdate").button("reset"),t.$(".btnBack").prop("disabled",!1),t.isSavingImage=!1,t.$(".n-upload-progress").hide(),$(window).off("beforeunload",t.onBeforeUnload),t.applyImageSaveAlways()},progress:function(e,n){t.triggerAction(r.MODAL.ACT.ALERT_SHOW,{type:r.MODAL.ALERT.TYPE_INFO,message:e}),"number"==typeof n&&t.$(".n-upload-progress").html(c.renderProgressBar({barClass:"n-progress-bar bar-good",percentUsed:n})).show(),m.reset()}})},showImageCreationProgress:function(e){this.$(".btnUpdate").button("loading"),this.activeImageModel=e,this.isSavingImage=!0,$(window).on("beforeunload",this.onBeforeUnload)},deleteAcropolisImage:function(e){var t=this;if(!this.collection||!this.collection.models||!this.collection.get(e))return void l.log("AcropolisImagePopupView : Image id "+e+" is not valid");this.collection.get(e).destroy({success:function(e,n){t.listImage()},error:function(e,n){t.triggerAction(r.MODAL.ACT.ALERT_SHOW,{type:r.MODAL.ALERT.TYPE_ERROR,message:n.responseText})}})},applyImageSaveError:function(){},applyImageSaveSuccess:function(){},applyImageSaveAlways:function(){},validateForm:function(){var e=this.$("input.image-name").val();if(!e||0===e.trim().length)return this.triggerAction(r.MODAL.ACT.ALERT_SHOW,{type:r.MODAL.ALERT.TYPE_ERROR,message:this.i18n("noName","Please provide a name.")}),!1;var t=this.$(".image-type").val();return!(!t||0===t.trim().length)||(this.triggerAction(r.MODAL.ACT.ALERT_SHOW,{type:r.MODAL.ALERT.TYPE_ERROR,message:this.i18n("noType","Please select an image type.")}),!1)},onSaveClick:function(){this.clearHeader(),this.validateForm()&&(this.disableImageForm(),this.createOrUpdateImage())},onEnterKeyPress:function(){this.onSaveClick()},disableInputs:function(e){$(".image-option").each(function(e,t){var n=$(t).find(".n-radio-container"),i=$(t).find("input[type=radio]");n.siblings("input").prop("disabled",!i.prop("checked"))})},disableImageForm:function(){this.$(".image-name").attr("disabled","disabled"),this.$(".image-annotation").attr("disabled","disabled"),this.$(".image-url").attr("disabled","disabled"),this.$(".image-binary").attr("disabled","disabled"),this.$(".image-type").attr("disabled","disabled"),this.$(".image-container").attr("disabled","disabled"),this.$("input[type=radio]").attr("disabled","disabled"),this.$(".image-type").trigger("update"),this.$(".image-container").trigger("update")},enableImageForm:function(){this.$(".image-name").removeAttr("disabled"),this.$(".image-annotation").removeAttr("disabled"),this.$(".image-url").removeAttr("disabled"),this.$(".image-binary").removeAttr("disabled"),this.$(".image-type").removeAttr("disabled"),this.$(".image-container").removeAttr("disabled"),this.$("input[type=radio]").removeAttr("disabled"),this.$(".image-type").trigger("update"),this.$(".image-container").trigger("update")},onMouseOverErrorDetails:function(e){var t=$(e.currentTarget),n=t.attr("tooltip"),i=void 0;$.trim(n).length&&(i=t.tooltip({title:n,placement:"bottom",trigger:"manual",html:"true",container:$("body")}),i.tooltip("show"))},onMouseOutErrorDetails:function(e){$(e.currentTarget).tooltip("destroy")},onBackClick:function(){this.isSavingImage&&this.activeImageModel&&this.activeImageModel.imageBinary?this.abortImageUpload(this.showImageList.bind(this)):$("#ipPoolForm").is(":visible")?(this.currentIpPoolIndex=null,this.showImageForm(null,!1)):this.showImageList()},abortImageUpload:function(e){var t=this,n=void 0;this.abortRequest=!0,this.activeImageModel.abort(),this.isSavingImage=!1,n=new i,n.id=this.activeImageModel.imageUuid,n.isNew()&&_.isFunction(e)&&e(),n.destroy({success:function(){_.isFunction(e)&&e()},error:function(e,n){t.triggerAction(r.MODAL.ACT.ALERT_SHOW,{type:r.MODAL.ALERT.TYPE_ERROR,message:"Image Deletion Failed."})}})},onCreateClick:function(){this.showImageForm(r.ACTION_CREATE,!0)},onDeleteImage:function(e){var t=$(e.currentTarget).closest("tr").find(".name-cell").html(),n=$(e.currentTarget).closest("td").attr("dataId");this.clearHeader(),$.nutanixConfirm({msg:"Are you sure you want to delete<br>image"+t+"?",yes:function(){this.deleteAcropolisImage(n)},context:this})},onEditImage:function(e){this.clearHeader();var t=$(e.currentTarget).closest("td").attr("dataId");this.currentImageModel=this.collection.findModelById(t),this.showImageForm(r.ACTION_UPDATE,!0),this.scrollToTop(!0)},destroy:function(){this.$(".source-icon").tooltip("destroy"),this.$(".btn-create-ctr").tooltip("destroy"),this.$(".nutanixMoreInfo").nutanixMoreInfo("destroy"),this.$(".imageOwnedByPC").tooltip("destroy"),e.prototype.destroy.apply(this,arguments)},hide:function(){this.isSavingImage&&this.activeImageModel&&this.activeImageModel.imageBinary?$.nutanixConfirm({msg:this.i18n("uploadPopupCloseWarning"),yes:function(){this.abortImageUpload(),e.prototype.hide.apply(this,arguments)},context:this}):e.prototype.hide.apply(this,arguments)},openCreateContainerPopup:function(){this.$(".close").trigger("click");var e={};e[r.NAV_ACTION]=this.$(".create-container-link").attr(r.NAV_ACTION),e[r.NAV_ACTION_TARGET]=this.$(".create-container-link").attr(r.NAV_ACTION_TARGET),setTimeout(function(){h.executeAction(e)},1e3)}})}),define("text!templates/popups/ha/HighAvailabilityPopupView.html",[],function(){return'<div data-ntnx-content-inner>\n  <div class="n-modal-loading" data-ntnx-section>\n    <div class="donut-loader-blue"></div>\n    <span class="n-loading-text"><%= i18n(\'loading\') %></span>\n  </div>\n  <section class="form-content" data-ntnx-section>\n    <div class="ha-options" data-ntnx-form-inline>\n      <%= Components.checkbox({\n        id: \'reserveSpace\',\n        name: \'haEffort\',\n        disabled: !canModify,\n        labelText: i18n(\'reserve_space\')\n      }) %>\n    </div>\n    <div data-ntnx-section="type-text">\n      <%= i18n(\'ha_description\') %>\n    </div>\n    <div class="disabledTip" data-ntnx-section="type-text">\n      <%= i18n(\'ha_disabled\') %>\n    </div>\n    <div class="bestEffortTip" data-ntnx-section="type-text">\n      <%= i18n(\'ha_best_effort_tip\') %>\n    </div>\n    <div class="reservedSpaceTip" data-ntnx-section="type-text"></div>\n  </section>\n</div>'}),define("views/popups/ha/HighAvailabilityPopupView",["views/basecomponents/popups/BasePopupView","data/DataProperties","models/ha/AcropolisHAModel","models/storage/ContainerCollection","models/hardware/HostCollection","utils/AppConstants","utils/AppUtil","utils/StatsUtil","text!templates/popups/ha/HighAvailabilityPopupView.html"],function(e,t,n,i,s,a,o,r,l){"use strict";return l=_.template(l),e.extend({name:"HighAvailabilityPopupView",el:"#popupHighAvailability",model:null,previousHostFailuresToTolerate:null,containerCollection:null,hostCollection:null,events:{"click .btnUpdate":"onSaveClick","click .btnBack":"hide","click .modal-header .close":"hide","change #reserveSpace":"onHAEffortChange","keypress input":"onKeyPress","click input":"clearHeader","mouseover .n-error-details":"onMouseOverErrorDetails","mouseout .n-error-details":"onMouseOutErrorDetails"},modelEvents:{"error model":"onModelError"},initialize:function(){this.model=new n,this.containerCollection=new i,this.hostCollection=new s,_.bindAll(this,"_render","hide"),e.prototype.initialize.apply(this,arguments)},render:function(){var e=this,t=this.canModifyByEntityType(a.ENTITY_HA),n=[];t&&n.push({text:this.i18n("save"),isPrimary:!0,extraClasses:"btnUpdate",extraAttr:[{key:"data-test",value:"networkBtnSave"},{key:"data-loading-text",value:this.i18n("saving")}]}),this.$el.html(this.defaultTemplate({title:this.i18n("title_high_availability"),antiscroll:!1,bodyContent:l(this.vtOptions({canModify:t})),footerButtons:this.defaultFooter(n)})),this.triggerAction(a.MODAL.ACT.AS_REBUILD);var i=[this.model.fetch(),this.containerCollection.fetch(),this.hostCollection.fetch()];$.when.apply($,i).done(function(){e.previousHostFailuresToTolerate=e.model.getHostFailuresToTolerate(),e._render()}).fail(function(t){e.$(".n-modal-loading").hide(),e.showHeaderError(_.isObject(t)?o.processAjaxError(t.responseText):t)})},_render:function(){this._renderCheckboxes(),this._renderAvailabilitySection(),this._disableInputs(),this.$(".form-content").show(),this.$(".n-modal-loading").hide(),this.triggerAction(a.MODAL.ACT.AS_REBUILD)},_renderCheckboxes:function(){this.model.getHostFailuresToTolerate()>0&&this.$("#reserveSpace").prop("checked",!0)},_renderAvailabilitySection:function(){var e=this,t=[".disabledTip",".bestEffortTip",".reservedSpaceTip"],n=[],i=this.model.getHostFailuresToTolerate();if(this.model.getEnable())if(0===i)n=[".bestEffortTip"];else{var s="<strong>"+this.getReservedSpace()+" GiB</strong>",a=1===i?this.i18n("single_host"):this.i18n("multi_host");this.$(".reservedSpaceTip").html(this.i18ns("ha_reserved_space_tip",s,a)),n=[".reservedSpaceTip"]}else n=[".disabledTip"];t.forEach(function(t){_.contains(n,t)?e.$(t).show():e.$(t).hide()})},_disableInputs:function(){this.canModifyByEntityType(a.ENTITY_HA)?this.model.getEnable()?(this.$(".ha-options").removeClass("disabled"),this.$(".ha-options input").prop("disabled",!1)):(this.$(".ha-options").addClass("disabled"),this.$(".ha-options input").prop("disabled",!0)):(this.$(".ha-options").removeClass("disabled"),this.$(".ha-options input").prop("disabled",!0))},getRFValue:function(){return this.containerCollection.isEmpty()?2:this.containerCollection.chain().map(function(e){return e.get(t.RF)}).max().value()},onHAEffortChange:function(e){$(e.currentTarget).prop("checked")?2===this.getRFValue()?this.model.setHostFailuresToTolerate(1):this.model.setHostFailuresToTolerate(2):this.model.setHostFailuresToTolerate(0),this._render()},
onSaveClick:function(){var e=this;return this.previousHostFailuresToTolerate===this.model.getHostFailuresToTolerate()?void this.render():this.model.getHostFailuresToTolerate()>this.previousHostFailuresToTolerate?void $.nutanixConfirm({msg:this.i18n("ha_save_confirm"),yes:function(){e.model.save({},{type:"put",success:function(){e.render()}})},context:this}):void this.model.save({},{type:"put",success:function(){e.hide()}})},onEnterKeyPress:function(){this.onSaveClick()},onMouseOverErrorDetails:function(e){var t,n=$(e.currentTarget),i=n.attr("tooltip");$.trim(i).length&&(t=n.tooltip({title:i,placement:"bottom",trigger:"manual",html:!0,container:$("body")}),t.tooltip("show"))},onMouseOutErrorDetails:function(e){$(e.currentTarget).tooltip("destroy")},onModelError:function(e,t){this.showHeaderErrorWithDetails("Error saving settings: ",t.responseText||t)},getReservedSpace:function(){return r.convertBytesToGiB(this.hostCollection.getMaxHostMemory()*this.model.getHostFailuresToTolerate())}})}),define("models/fileserver/FileServerAdminModel",["models/MinervaModel","data/DataURLConstants","utils/AppConstants"],function(e,t,n){"use strict";var i={ADMIN_USER_UUID:"adminUserUuid",FS_UUID:"fileServerUuid",UUID:"uuid"};return e.extend({urlRoot:t.FILE_SERVER_ADMIN,entityType:n.ENTITY_FS_ADMINS,name:"FileServerAdminModel",DP:i,defaults:{uuid:null,fileServerUuid:null},setEntityName:function(e){this.entityName=e},getValue:function(t){return t===this.nameAttribute?this.get(this.nameAttribute)||this.entityName:e.prototype.getValue.apply(this,arguments)},getURL:function(){return this.actionMode===n.ACTION_DELETE?_.template(this.urlRoot,{uuid:this.get(this.DP.FS_UUID),adminUserUuid:this.get(this.DP.ADMIN_USER_UUID)}):_.template(t.FILE_SERVER_ADMINS,{uuid:this.get(this.DP.FS_UUID)})}},{DP:i})}),define("text!templates/popups/fileserver/FileServerAdminTableTemplate.html",[],function(){return'<section data-ntnx-section>\n  <span class="title secondary"><%= i18n(\'add_admin\') %>\n    <span class="nutanixMoreInfo"\n      data-tooltip-classes="-nudge-up"\n      data-tooltip-container="body"\n      data-tooltip-title="<p><%= i18n(\'add_backup_admin_tooltip\') %></p>\n      <%= i18n(\'add_fs_admin_tooltip\') %>"\n    </span>\n  </span>\n  <a class="link-table-input pull-right">\n    <%= Components.icon(\'plus-small\') %><%= i18n(\'new_user\') %></a>\n</section>\n\n<table class="table table-data-items table-input <%= ebClass %>">\n  <thead>\n    <tr>\n      <% _.each(columns, function(column) { %>\n        <th><%= column.columnName %></th>\n      <% }); %>\n      <th><%= i18n(\'action\') %></th>\n    </tr>\n  </thead>\n  <tbody></tbody>\n</table>\n'}),define("text!templates/popups/fileserver/FileServerAdminTableRowTemplate.html",[],function(){return'<tr data-id="<%= dataId %>" <%=isNew ? \'new\' : \'\'%> class="n-table-row"\n  \'model-attribute="user-row" model-validate="isRowSaved"\n  \'data-value="<%= data ? data.role : "ADMIN" %>" >\n  <% _.each(columns, function(column) { %>\n    <td class="data-cell">\n      <% if (column.className === \'role\') {  %>\n        <%= Components.select({\n          jsClasses : \'roleFancySelect\',\n          options   : [{\n            name    : i18n("file_server_admin"),\n            value   : "ADMIN",\n            selected: data && data.role === "ADMIN" ? true : false\n          },\n          {\n            name    : i18n("backup_admin"),\n            value   : "BACKUP_OPERATOR",\n            selected: data && data.role === "BACKUP_OPERATOR" ? true : false\n          }],\n          variants  :"fancy-select-bottom-anchor -no-border"\n        }) %>\n      <% } else { %>\n        <input type="<%= column.type || \'text\' %>"\n          class="input-data <%= column.className || \'\' %>"\n          readonly value="<%= column.renderer(data) %>">\n      <% } %>\n    </td>\n  <% }); %>\n  <%= this.actionTemplate %>\n</tr>\n'}),define("views/popups/fileserver/FileServerAdminTableInputView",["views/basecomponents/tableinput/TableInputView","managers/NotificationManager","models/fileserver/FileServerAdminModel","text!templates/popups/fileserver/FileServerAdminTableTemplate.html","text!templates/popups/fileserver/FileServerAdminTableRowTemplate.html","utils/AppUtil","utils/AppConstants"],function(e,t,n,i,s,a,o){"use strict";var r=_.template(i),l=_.template(s);return e.extend({name:"FileServerAdminTableInputView",className:"component-table-input",idAttribute:"uuid",fileServerUuid:null,tmplTable:null,initialize:function(t){t.columns=this.getResourceTableColumns(),e.prototype.initialize.call(this,t),this.dataItems=t.dataItems||[],this.tmplDataRow=l,this.actionTemplate=_.template(e.EDIT_COLUMN_TEMPLATE)(this.vtOptions({isActionEnabled:!0})),this.tmplTable=r,this.parent=t.parent,this.fileServerUuid=t.fileServerUuid,this.addExtraEvents({"click .fs-role-dropdown .fs-role":"onClickRole"})},render:function(){return e.prototype.render.call(this,arguments),this.$(".nutanixMoreInfo").nutanixMoreInfo({parseDataAttrs:!0,placement:"right"}),this.applyNutanixInput({types:["select"]}),this.$(".fancy-select").addClass("disable-dropdown"),this},getResourceTableColumns:function(){var e=this;return[{columnName:this.i18n("user"),className:"user-name",renderer:function(e){return e&&e.user?e.user:""}},{columnName:this.i18n("role"),className:"role",renderer:function(t){return t?"BACKUP_OPERATOR"===t.role?e.i18n("backup_admin"):e.i18n("file_server_admin"):""}}]},onClickSaveLink:function(e){if(this.$el.find("td").removeClass("error"),this.parent.isValidInputProvided(0,e)){this.saveRow(e);$(e.currentTarget).closest("tr").find(".fancy-select").addClass("disable-dropdown")}},saveRow:function(e){var t=$(e.currentTarget),n=t.closest("tr"),i=this.getRowData(n);i&&i.user?this.saveRoleData(n,i):n.remove()},getRowData:function(e){return{user:e.find(".user-name").val(),role:e.find("select").val(),uuid:e.attr("data-id")}},addRow:function(){e.prototype.addRow.call(this,arguments),this.parent.triggerAction(o.MODAL.ACT.AS_REBUILD),this.applyNutanixInput({types:["select"]})},onClickEditLink:function(t){var n=$(t.currentTarget).closest("tr");this.$(".fancy-select").addClass("disable-dropdown"),n.find(".fancy-select").removeClass("disable-dropdown"),e.prototype.onClickEditLink.call(this,t)},onClickCancelLink:function(e){var t=$(e.currentTarget).closest("tr");if(t.find("input").val().trim()){var n=this.getOriginalDataForSelectedRow(t);n&&n[0]&&(t.find(".user-name").val(n[0].get(o.SSP_INTENT_KINDS.USER)),t.find(".roleFancySelect").val(n[0].get(o.SSP_INTENT_KINDS.ROLE)).trigger("change"))}this.resetTable(),this.parent.triggerAction(o.MODAL.ACT.AS_REBUILD),t.find(".fancy-select").addClass("disable-dropdown")},getOriginalDataForSelectedRow:function(e){var t=this,n=e.closest("tr").attr("data-id");return this.dataItems.map(function(e){if(e.get(t.idAttribute)===n)return e})},onClickDeleteLink:function(e){var t=this,n=$(e.currentTarget),i=n.closest("tr"),s=this.getRowData(i);$.nutanixConfirm({msg:this.i18ns("delete_confirm",s.user),yes:function(){t.confirmedDeleteRow(e,s)},context:t})},onClickRole:function(e){var t=$(e.currentTarget);t.closest("tr").attr("data-value",t.attr("data-value"))},confirmedDeleteRow:function(e,i){var s=this,r=new n;r.set(r.DP.FS_UUID,this.fileServerUuid),r.set(r.DP.ADMIN_USER_UUID,i.uuid),r.actionMode=o.ACTION_DELETE,r.setEntityName(i.user),r.isNew(!1),r.destroy({success:function(t,n){s.deleteRow(e),s.parent.triggerAction(o.MODAL.ACT.AS_REBUILD)},error:function(e,n){t.showClientNotification(o.NOTIFY_ERROR,a.processAjaxError(n.responseText))}})},saveRoleData:function(e,t){var i=this,s=new n;t.uuid!==o.ID_TO_BE_ADDED?(s.isNew(!1),s.actionMode=o.ACTION_UPDATE):(s.isNew(!0),s.actionMode=o.ACTION_CREATE,t.uuid=""),s.set(s.DP.FS_UUID,this.fileServerUuid),s.setEntityName(t.user),s.save(t,{success:function(n,s){var a=i.i18ns(n.isNew()?"add_msg":"update_msg",t.user);i.parent.showHeaderSuccess(a),i.dataItems.unshift(n);var o=n.get(n.DP.UUID);e.attr("data-id",o),e.removeAttr("new"),e.find(".fs-role-dropdown").addClass("disable-dropdown"),i.resetTable()},error:function(e,t){a.log("Error :"+a.processAjaxError(t.responseText));var n=i.i18n(e.isNew()?"creating":"updating");i.parent.showHeaderError(a.processAjaxError(t.responseText)+n)}})}})}),define("models/fileserver/FileServerUserModel",["models/MinervaModel","data/DataURLConstants","utils/AppConstants"],function(e,t,n){"use strict";var i={FS_UUID:"fileServerUuid",USERNAME:"username",PASSWORD:"password"};return e.extend({urlRoot:t.FILE_SERVER_USERS,entityType:n.ENTITY_FS_USERS,name:"FileServerUserModel",DP:i,nameAttribute:"username",defaults:{fileServerUuid:null},setEntityName:function(e){this.entityName=e},getURL:function(){return this.actionMode===n.ACTION_DELETE?_.template(t.FILE_SERVER_USER_DELETE,{uuid:this.get(this.DP.FS_UUID),username:this.get(this.DP.USERNAME)}):_.template(t.FILE_SERVER_USERS,{uuid:this.get(this.DP.FS_UUID)})}},{DP:i})}),define("views/popups/fileserver/FileServerUserTableInputView",["views/basecomponents/tableinput/TableInputView","managers/NotificationManager","models/fileserver/FileServerUserModel","utils/AppUtil","utils/AppConstants"],function(e,t,n,i,s){"use strict";var a=_.template('<section data-ntnx-section><span data-ntnx-section="type-subtitle"><%= i18n("manage_user_msg") %> <span class="restApiMoreInfo"data-tooltip-classes="-nudge-up"data-tooltip-container="body"data-tooltip-title="<%= i18n("manage_user_msg") %>"</span></span><a class="link-table-input pull-right"><%= Components.icon("plus-small") %><%= i18n("new_user") %></a></section><table class="table table-data-items table-input conditional-edit <%= ebClass %>"><thead><tr><% _.each(columns, function(column) { %><th><%= column.columnName %></th><% }); %><th><%= i18n("actions") %></th></tr></thead><tbody></tbody></table>');return e.extend({name:"FileServerUserTableInputView",className:"component-table-input",idAttribute:"username",fileServerUuid:null,initialize:function(t){t.columns=this.getResourceTableColumns(),e.prototype.initialize.call(this,t),this.dataItems=t.dataItems||[],this.tmplTable=a,this.parent=t.parent,this.fileServerUuid=t.fileServerUuid},render:function(){return e.prototype.render.apply(this,arguments),this.dataItems.length||this.addRow(),this.$(".restApiMoreInfo").nutanixMoreInfo({parseDataAttrs:!0,placement:"right"}),this},getResourceTableColumns:function(){var e=this;return[{columnName:e.i18n("username"),className:"username",renderer:function(e){return e&&e.username?decodeURI(e.username):""}},{columnName:e.i18n("password"),className:"password",type:"password",renderer:function(e){return e&&e.password?e.password:"nutanix/4u"}}]},onClickSaveLink:function(e){this.$el.find("td").removeClass("error"),this.parent.isValidInputProvided(1,e)&&this.saveRow(e)},saveRow:function(e){var t=$(e.currentTarget).closest("tr"),n=this.getRowData(t);n&&n.username?this.saveRoleData(t,n):t.remove()},onClickEditLink:function(e){var t=$(e.currentTarget),n=t.closest("tr").attr("data-id"),i=this.$('tr[data-id="'+n+'"]');if(this.trigger(this.ACTION_EVENTS.EDIT,n),!this.disableInlineEdit)if(this.$("tr").removeClass("edit"),i.addClass("edit"),n===s.ID_TO_BE_ADDED)i.find("input:first-child").focus(),i.find("input.input-data").removeAttr("readonly");else{i.find("input.username").parent().addClass("not-editable");var a=i.find("input.password");a.focus(),a.removeAttr("readonly")}},onClickCancelLink:function(t){var n=$(t.currentTarget).closest("tr");n.find("input").val().trim()&&n.find(".password").val("nutanix/4u"),e.prototype.onClickCancelLink.call(this,t)},getRowData:function(e){return{username:encodeURI(e.find(".username").val()),password:e.find(".password").val(),uuid:e.attr("data-id")}},onClickDeleteLink:function(e){var t=$(e.currentTarget),n=t.closest("tr"),i=this.getRowData(n);$.nutanixConfirm({msg:this.i18ns("delete_confirm",decodeURI(i.username)),yes:function(){this.confirmedDeleteRow(e,i)},context:this})},confirmedDeleteRow:function(e,a){var o=this,r=new n;r.set(r.DP.FS_UUID,this.fileServerUuid),r.set(r.DP.USERNAME,a.username),r.actionMode=s.ACTION_DELETE,r.setEntityName(a.username),r.isNew(!1),r.destroy({success:function(t,n){o.parent.showHeaderSuccess(o.i18ns("delete_msg",decodeURI(a.username))),o.deleteRow(e)},error:function(e,n){t.showClientNotification(s.NOTIFY_ERROR,i.processAjaxError(n.responseText))}})},saveRoleData:function(e,t){var a=this,o=new n;t.uuid!==s.ID_TO_BE_ADDED?(o.isNew(!1),o.actionMode=s.ACTION_UPDATE):(o.isNew(!0),o.actionMode=s.ACTION_CREATE,t.uuid=""),o.set(o.DP.FS_UUID,this.fileServerUuid),o.set(o.DP.USERNAME,t.username),o.set(o.DP.PASSWORD,t.password),o.setEntityName(t.username),o.save(t,{success:function(n,i){var s=a.i18ns(n.isNew()?"add_msg":"update_msg",decodeURI(t.username));a.parent.showHeaderSuccess(s),e.attr("data-id",t.username),e.removeAttr("new"),a.resetTable()},error:function(e,t){i.log("Error :"+i.processAjaxError(t.responseText));var n=e.isNew()?a.i18n("creating"):a.i18n("updating");a.parent.showHeaderError(i.processAjaxError(t.responseText)+" "+n)}})}})}),define("models/fileserver/FileServerAdminCollection",["models/BaseCollection","models/fileserver/FileServerAdminModel","data/DataURLConstants"],function(e,t,n){"use strict";return e.extend({url:null,model:t,name:"FileServerAdminCollection",setFSId:function(e){this.url=_.template(n.FILE_SERVER_ADMINS,{uuid:e})}})}),define("models/fileserver/FileServerUserCollection",["models/BaseCollection","models/fileserver/FileServerUserModel","data/DataURLConstants"],function(e,t,n){"use strict";return e.extend({url:null,model:t,name:"FileServerUserCollection",setFsUuid:function(e){this.url=_.template(n.FILE_SERVER_USERS,{uuid:e})}})}),define("text!templates/wizards/fileserver/FileServerAdminsContent.html",[],function(){return'<div data-ntnx-content-inner>\n  <% if (!checkProtocolAndSmbOnly) { %>\n    <section data-ntnx-section>\n      <h5 data-ntnx-title><%= i18n("add_admins") %></h5>\n      <div class="table-wrapper">\n      </div>\n    </section>\n  <% } %>\n  \x3c!-- File Server REST API user access is supported for AFS 3.0.1 and above --\x3e\n  <% if (isFsUserSupported) { %>\n    <section data-ntnx-section="type-separator">\n      <h5 data-ntnx-title><%= i18n("api_access_heading") %></h5>\n      <section data-ntnx-section class="restApiTooltip hidden">\n        <span data-ntnx-section="type-subtitle">\n          <%= restApiMsg %>\n          <span class="nutanixMoreInfo"\n            data-tooltip-classes="-nudge-up"\n            data-tooltip-container="body"\n            data-tooltip-title="<%= restApiTooltip %>"\n          </span>\n        </span>\n      </section>\n      \x3c!-- API table wrapper --\x3e\n      <div class="apiListWrapper api-wrapper"></div>\n      \x3c!-- Empty list wrapper --\x3e\n      <section data-ntnx-section class="emptyListWrapper hidden">\n        <div data-ntnx-empty-list>\n          <section data-ntnx-section="type-text">\n            <%= i18n("no_user_created") %>\n          </section>\n          <section data-ntnx-section>\n            <%= Components.button({\n              isPrimary   : true,\n              iconLeft    : \'plus\',\n              text        : i18n("add_api_user"),\n              extraClasses: \'addNewUser\'\n            }) %>\n          </section>\n        </div>\n      </section>\n    </section>\n  <% } %>\n</div>'}),define("views/popups/fileserver/FileServerAddAdminsPopupView",["views/basecomponents/popups/BasePopupView","views/popups/fileserver/FileServerAdminTableInputView","views/popups/fileserver/FileServerUserTableInputView","managers/I18nManager","models/fileserver/FileServerAdminCollection","models/fileserver/FileServerUserCollection","models/fileserver/FileServerModel","text!templates/wizards/fileserver/FileServerAdminsContent.html","utils/CommonTemplates","utils/AppUtil","utils/AppConstants","utils/FileServerUtil"],function(e,t,n,i,s,a,o,r,l,c,d,p){"use strict";var u=_.template(r);return e.extend({name:"FileServerAddAdminsPopupView",el:"#popupAddAdmins",events:{"click   .modal-header .close":"hide","click   .btnClose":"hide","click   .addNewUser":"onAddNewUserClick"},render:function(){this.fetchFileServer()},fetchFileServer:function(){var e=this,t=new o;t.set(t.idAttribute,this.actionRoute.actionTargetId,{silent:!0}),t.fetch({success:function(t,n){e.renderForm(t)},error:function(t,n){e.showHeaderError(e.i18n("fs_fetch_error")+" "+c.processAjaxError(n.responseText))}})},renderForm:function(e){var t=this.isFsUserSupported(e),n=this.checkProtocolAndSmbOnly(e),s=[{text:this.i18n("close"),extraClasses:"btnClose n-btn-form  btn-primary"}],a=u(this.vtOptions({isFsUserSupported:t,restApiMsg:i.t("FileServerUserTableInputView","manage_user_msg"),restApiTooltip:i.t("FileServerUserTableInputView","manage_user_tooltip"),checkProtocolAndSmbOnly:n}));this.$el.html(this.defaultTemplate({title:this.i18ns("manage_roles"),bodyContent:a,antiscroll:!1,footerButtons:this.defaultFooter(s)})),this.$(".nutanixMoreInfo").nutanixMoreInfo({parseDataAttrs:!0,placement:"right"}),p.setHelpLinkAfsVersion(this,this.actionRoute,e),this.fetchFileServerAdmin(),t&&this.fetchRestApiAccessUsers()},isFsUserSupported:function(e){var t=void 0,n=e.get(e.DP.VERSION)||e.get(e.DP.OBJECT_VERSION);return n&&(t=c.compareVersions(n,d.FILE_SERVER_VERSIONS.THREE_ZERO_ONE)),t>=0},fetchFileServerAdmin:function(){var e=this,t=new s;t.setFSId(this.actionRoute&&this.actionRoute.actionTargetId),this.$(".table-wrapper").html(l.LOADING_MSG(this.vtOptions({msg:this.i18n("loading")}))),t.fetch({silent:!0,success:function(t){e.addAddAdminTable(t.models)},error:function(t,n){e.showHeaderError(c.processAjaxError(n.responseText)||e.i18n("message")),e.addAddAdminTable([])}})},fetchRestApiAccessUsers:function(){var e=this,t=new a;t.setFsUuid(this.actionRoute&&this.actionRoute.actionTargetId),this.$(".apiListWrapper").html(l.LOADING_MSG(this.vtOptions({msg:this.i18n("loading")}))),t.fetch({success:function(t){e.addUserTable(t.models)},error:function(t,n){e.showHeaderError(c.processAjaxError(n.responseText)||e.i18n("api_fetch_error")),e.addUserTable([])}})},addUserTable:function(e){var t=new n({fileServerUuid:this.actionRoute&&this.actionRoute.actionTargetId,entityType:d.ENTITY_FS_USERS,addCaption:this.i18n("add_api_user"),disableInlineEdit:!1,ebTableStyle:!0,dataItems:e,parent:this,columns:[]});this.$(".apiListWrapper").html(t.render().el),e.length||this.onAddNewUserClick(),this.triggerAction(d.MODAL.ACT.AS_REBUILD)},addAddAdminTable:function(e){var n=new t({idAttribute:"uuid",fileServerUuid:this.actionRoute&&this.actionRoute.actionTargetId,entityType:d.ENTITY_FS_ADMINS,disableInlineEdit:!1,ebTableStyle:!0,dataItems:e,parent:this,columns:[]});this.$(".table-wrapper").html(n.render().el),this.triggerAction(d.MODAL.ACT.AS_REBUILD)},isValidInputProvided:function(e,t){var n=$(t.currentTarget).closest("tr"),i=void 0,s=void 0;switch(e){case 0:n.find(".user-name").val().trim()||(i=this.i18n("user_group_msg"),s=n.find("td").eq(0));break;case 1:n.find(".password").val().trim()||(i=this.i18n("missing_password"),s=n.find("td").eq(1)),n.find(".username").val().trim()||(i=this.i18n("missing_username"),s=n.find("td").eq(0))}return!i||(this.showHeaderError(i),s.addClass("error"),s.find("input").focus(),!1)},onAddNewUserClick:function(){this.$(".emptyListWrapper").toggleClass("hidden"),this.$(".apiListWrapper").toggleClass("hidden"),this.$(".restApiTooltip").toggleClass("hidden")},destroy:function(){this.$(".nutanixMoreInfo").nutanixMoreInfo("destroy"),this.$(".restApiTooltip").nutanixMoreInfo("destroy"),e.prototype.destroy.apply(this,arguments)},checkProtocolAndSmbOnly:function(e){var t=e.getDomainConfig(e.DP[e.DP.DOMAIN_CONFIG].REALM),n=e.getProtocolType();if(this.isFsUserSupported(e))return!t||p.isNfsOnly(e)||n===d.FS_PROTOCOLS.NFS||!n}})}),define("views/popups/fileserver/FileServerUserManagementPopupView",["views/basecomponents/popups/BasePopupView","views/popups/fileserver/FileServerUserManagementView","models/fileserver/FileServerModel","models/fileserver/UserMappingModel","managers/NotificationManager","data/DataURLConstants","utils/FileServerUtil","utils/AppUtil","utils/SubViewHelper","utils/AppConstants"],function(e,t,n,i,s,a,o,r,l,c){"use strict";var d={REALM:"windowsAdDomainName",USERNAME:"windowsAdUsername",PASSWORD:"windowsAdPassword",NUM_CALCULATED_NVMS:"numCalculatedNvms",DOMAIN_CONFIG:"domainDirectoryDTO",OVERWRITE_USER_ACCOUNT:"overwriteUserAccount",domainDirectoryDTO:{REALM:"windowsAdDomainName"}},p=n.extend({urlRoot:a.FILE_SERVER_CONFIG_NAME_SERVICES,entityType:c.ENTITY_FILE_SERVER,name:"FileServerUIModel",enableNotifications:!1,fileServerUuid:null,DP:d,setFileServerUuid:function(e){this.fileServerUuid=e},getURL:function(){var e=_.template(this.urlRoot,{uuid:this.fileServerUuid});return this.actionMode===c.ACTION_UNJOIN_DOMAIN?e=_.template(a.FILE_SERVER_UNJOIN_DOMAIN,{uuid:this.fileServerUuid}):this.actionMode===c.ACTION_JOIN_DOMAIN&&(e=_.template(a.FILE_SERVER_JOIN_DOMAIN,{uuid:this.fileServerUuid})),e}},{DP:d});return e.extend({name:"FileServerUserManagementPopupView",el:"#popupUserManagement",events:{"click   .btnCancel, .close":"hide","click   .n-save":"onSave"},initialize:function(t){e.prototype.initialize.apply(this,arguments),this.subViewHelper=new l,this.fileServerUIModel=new p},render:function(){var e=this,t=[{text:this.i18n("cancel"),extraClasses:"btnCancel n-cancel"},{isPrimary:!0,text:this.i18n("update"),extraClasses:"n-save disabled"}];this.$el.html(this.defaultTemplate({title:this.i18n("directory_services"),nestedAlert:!0,bodyContent:'<div data-ntnx-content-inner><div class="userManagementContainer"></div></div>',footerButtons:this.defaultFooter(t)})),this.triggerAction(c.MODAL.ACT.COVER_SHOW),this.fileServerUIModel.setFileServerUuid(this.actionRoute.actionTargetId);var i=new n;i.set(i.idAttribute,this.actionRoute.actionTargetId,{silent:!0}),r.showLoader(),i.fetch({success:function(t,n){r.hideLoader(),e.triggerAction(c.MODAL.ACT.COVER_HIDE),o.compareAFSversion(t,c.FILE_SERVER_VERSIONS.THREE_DOT_FIVE)>=0?e.fetchUserMapping(t):e.renderForm(t)},error:function(t,n){r.hideLoader(),e.triggerAction(c.MODAL.ACT.COVER_HIDE),e.showHeaderError(e.i18ns("server_error_message_template",e.i18ns("fetching_file_server"))+r.processAjaxError(n.responseText))}})},fetchUserMapping:function(e){var t=this,n=new i;n.set(n.DP.FILE_SERVER_UUID,this.actionRoute.actionTargetId,{silent:!0}),r.showLoader(),n.fetch({success:function(i,s){r.hideLoader();var a=n&&o.isUserMappingConfigured(n);t.renderForm(e,a)},error:function(n,i){r.hideLoader(),s.showClientNotification(c.NOTIFY_ERROR,t.i18n("user_mapping_fetch_failure")),t.renderForm(e)}})},renderForm:function(e,n){this.model=e,e.set(c.NAV_ACTION_TARGET_ID,this.actionRoute.actionTargetId);var i=this.model.getUnescapedValue(this.model.DP.NAME_SERVICE_CONFIG+"."+this.model.DP.LDAP_DETAILS),s=i&&i[this.model.DP.SERVER_IP],a=this.model.getUnescapedValue(this.model.DP.NAME_SERVICE_CONFIG+"."+this.model.DP.AD_DETAILS),r=a&&a[this.model.DP.PROTOCOL_TYPE],l=this.model.getUnescapedValue(this.model.DP.NAME_SERVICE_CONFIG+"."+this.model.DP.LOCAL_DETAILS),d=l&&l[this.model.DP.PROTOCOL_TYPE];s||r||d&&d!==c.FS_PROTOCOLS.NONE||(e.isNew(!0),this.$(".n-save").removeClass("disabled")),this.subView=new t({el:".userManagementContainer",model:e,updateDomain:!0,isUserMappingConfigured:n}),this.subView.setParentView(this),this.subViewHelper.register("userManagementView",this.subView),this.subViewHelper.render("userManagementView"),this.isViewRendered=!0,this.triggerAction(c.MODAL.ACT.AS_REBUILD),o.setHelpLinkAfsVersion(this,this.actionRoute,e)},onSave:function(){var e=this;if(this.$(".n-save").addClass("disabled"),this.$(".btnCancel").addClass("disabled"),this.model&&this.model.isNew()){var t=function(t,n){var i={errorMessage:t,settings:n};e.subView.finalizeJoindata(i)};this.subView.onSave(t)}else this.subView.joinOrleaveDomain()},hide:function(t){if(t){if("alert"===$(t.currentTarget).attr("data-dismiss"))return}this.$(".adRealNameTooltip .addTooltip").tooltip("destroy"),this.$(".nutanixMoreInfo").nutanixMoreInfo("destroy"),this.subViewHelper.destroy(),e.prototype.hide.apply(this,arguments)}})}),define("text!templates/popups/fileserver/FileServerDNSServerEntryView.html",[],function(){return'<tr class="n-table-row <% if (!verified) { %> inactive <% } %>">\n  <td class="name-cell copyItem <% if (!verified) { %> inactive <% } %>">\n    <%= dnsName %>\n  </td>\n  <td class="ip-cell copyItem <% if (!verified) { %> inactive <% } %>">\n    <%= dnsIp %>\n  </td>\n  <td class="cell-actions <% if (!verified) { %> inactive <% } %>" data-id="<%= dnsIp %>">\n    <% if (verified) { %>\n      <span class="check-color">\n        <%= Components.icon("check-thick", "pass-icon -small -inline") %>\n      </span>\n    <% } %>\n  </td>\n</tr>'}),define("text!templates/popups/fileserver/FileServerDNSServerFormView.html",[],function(){return'\x3c!-- Load Balance form --\x3e\n<div class="header-container">\n  <div>\n    <%= i18n(\'add_entries\') %>\n  </div>\n  <div class="copy-container">\n    <div>\n      <a class="copyAllAction"><%= i18n(\'copy_all\') %></a>\n    </div>\n    <div class="select-wrapper pull-right">\n      <select class="btnExport">\n        <option value="csv"><%= i18n(\'export_csv\') %></option>\n        <option value="json"><%= i18n(\'export_json\') %></option>\n      </select>\n    </div>\n  </div>\n</div>\n<section data-ntnx-section>\n  <table class="table table-hover dnsServerList dns-server-list"\n         data-test="dnsServerEntiresTable">\n    <thead>\n    <tr>\n      <th class="name-cell-dns"><%= i18n(\'dns_host_name\') %></th>\n      <th class="ip_address-cell">\n        <%= i18n(\'ip_ptr\') %>\n        <span class="nutanixMoreInfo"\n          data-tooltip-classes="-nudge-up"\n          data-tooltip-container="body"\n          data-tooltip-title="<%= i18n(\'ip_ptr_info\') %>">\n        </span>\n      </th>\n      <th class="action-copy-cell"><%= i18n(\'is_verified\') %></th>\n    </tr>\n    </thead>\n    <tbody id="all-entries">\n    \x3c!-- @view: DNS server entries go here... --\x3e\n    </tbody>\n  </table>\n</section>\n'}),define("views/popups/fileserver/FileServerDNSServerTableView",["views/basecomponents/BaseView","managers/NotificationManager","utils/AppConstants","utils/FileServerUtil","utils/DataExportUtil","text!templates/popups/fileserver/FileServerDNSServerEntryView.html","text!templates/popups/fileserver/FileServerDNSServerFormView.html"],function(e,t,n,i,s,a,o){"use strict";var r=_.template(o),l=_.template(a),c=_.template('<a class="copyEntry"><%= i18n("copy_entry") %></a>');return e.extend({name:"FileServerDNSServerTableView",entries:null,events:{"click    .copyAllAction":"onCopyAll","click    tr.n-table-row":"onClickRow","click    a.copyEntry":"onCopyEntry","change    .btnExport":"onExport"},initialize:function(t){e.prototype.initialize.apply(this,arguments),this.entries=t.entries||[]},render:function(){return this.$el.html(r(this.vtOptions())),this.addRows(),this.$(".nutanixMoreInfo").nutanixMoreInfo({parseDataAttrs:!0}),this},addRows:function(){var e=this,t=this.$(".dnsServerList > tbody");_.each(this.entries,function(n){t.append(l(e.vtOptions({dnsName:n.dnsName,dnsIp:n.dnsIpAddress,verified:n.verified})))})},onExport:function(e){var t=this.$(".btnExport").val(),n=this.covertToJSON(this.$(".copyItem").text().replace(/\s+/g," ").split(" ")),i=[{sTitle:this.i18n("dns_host_name"),mData:"0"},{sTitle:this.i18n("ip_address"),mData:"1"}];"csv"===t?s.exportTableCSV(n,i):"json"===t&&s.exportTableJSON(n,i)},covertToJSON:function(e){""===e[0]&&e.shift();var t=[],n={};return _.each(e,function(e,i){n[i%2]=e,i%2&&(t.push(n),n={})}),t},onClickRow:function(e){var t=$(e.currentTarget);t.hasClass("inactive")&&(this.$(".n-table-row.inactive").removeClass("row-highlighted"),this.$(".cell-actions.inactive").html(""),t.find(".cell-actions").html(c(this.vtOptions())),t.addClass("row-highlighted"))},onCopyAll:function(){var e=this.$(".copyItem").text().replace(/\s+/g," ").split(" "),s=[];""===e[0]&&e.shift(),_.each(e,function(e,t){s.push(e),t%2&&s.push("<br>")});var a=s.join(" ");i.copyToClipboard(a),t.showClientNotification(n.NOTIFY_SUCCESS,this.i18n("entries_copied"))},onCopyEntry:function(e){var s=$(e.currentTarget),a=s.closest("tr").find(".copyItem").text();i.copyToClipboard(a),t.showClientNotification(n.NOTIFY_SUCCESS,this.i18n("entry_copied"))}})}),define("models/fileserver/FileServerDNSModel",["models/BaseModel","data/DataURLConstants","utils/AppConstants"],function(e,t,n){"use strict";var i={DNS_OPERATIONS:"FileServerDnsOperations",VERIFIED:"verified"};return e.extend({urlRoot:t.FILE_SERVER,name:"FileServerDNSModel",enableNotifications:!1,fileServerUuid:null,DP:i,setFileServerUuid:function(e){this.fileServerUuid=e},getURL:function(){var e=this.urlRoot,i=void 0;return i=this.actionMode===n.ACTION_VERIFY_DNS?t.FILE_SERVER_VERIFY_DNS:this.actionMode===n.ACTION_ADD_DNS?t.FILE_SERVER_ADD_DNS:this.actionMode===n.ACTION_REMOVE_DNS?t.FILE_SERVER_REMOVE_DNS:t.FILE_SERVER_DNS_ALL_ENTRIES,i&&(e=_.template(i,{uuid:this.fileServerUuid})),e}},{DP:i})}),define("text!templates/wizards/fileserver/FileServerAddDNSContent.html",[],function(){
return'<div data-ntnx-content-inner>\n  <form class="fs-dns-form">\n    <section data-ntnx-section>\n      <h5 data-ntnx-title><%= i18n(\'dns_entries\') %></h5>\n      \x3c!-- Windows AD Credential --\x3e\n      <section data-ntnx-section="type-text">\n        <%= i18n(\'dns_credentials_text\') %>\n      </section>\n    </section>\n\n    <section class="dnsCredentialContainer">\n      <section data-ntnx-section>\n        <div data-ntnx-form-inline>\n          <%= Components.radio({\n            jsClasses: \'addDnsAuto\',\n            labelText: i18n(\'add_dns_auto\')\n          }) %>\n        </div>\n        <div data-ntnx-form-inline>\n          <%= Components.radio({\n            jsClasses: \'addDnsManual\',\n            labelText: i18n(\'add_dns_manual\')\n          }) %>\n        </div>\n      </section>\n    </section>\n\n    <section data-ntnx-section class="serverVerifiedContainer hide">\n      <div class="alert alert-info notSelectedMsg">\n        <%= i18n(\'verified_message\') %>\n      </div>\n      <div class="alert alert-info addSelectedMsg">\n        <%= i18n(\'verified_message_add\') %>\n      </div>\n      <div class="alert alert-info delSelectedMsg">\n        <%= i18n(\'verified_message_delete\') %>\n      </div>\n    </section>\n\n    <section data-ntnx-section class="serverUnverifiedContainer hide">\n      <div class="alert alert-error">\n        <%= i18n(\'unverified_message\') %>\n      </div>\n    </section>\n\n    <section data-ntnx-section class="addRemoveDnsContainer">\n      <%= Components.select({\n        jsClasses: \'comboaddRemoveDns\',\n        variants: \'bottom-anchor\',\n        options: addRemoveDnsOptions\n      }) %>\n    </section>\n\n    <div class="serverNameContainer">\n      <section data-ntnx-section class="dnsIpContainer">\n        <label data-ntnx-label for="dnsIp"><%= i18n(\'dns_server_name\') %>\n          <span class="nutanixMoreInfo"\n            data-tooltip-classes="-nudge-up"\n            data-tooltip-container="body"\n            data-tooltip-title="<%= i18n(\'dns_name_tooltip\') %>">\n          </span>\n          <span data-ntnx-label-flag><%= i18n(\'optional\') %></span>\n        </label>\n        <input type="text" id="dnsIp" class="dnsIp"\n          placeholder="like: server_name.dom.companyname.com">\n      </section>\n\n      <div class="addDnsAutoContainer">\n        \x3c!-- Windows AD username --\x3e\n        <section data-ntnx-section="type-half">\n          <label data-ntnx-label for="dnsUsername"><%= i18n(\'username\') %></label>\n          <input type="text" id="dnsUsername" class="dnsUsername">\n        </section>\n\n        \x3c!-- Windows AD password --\x3e\n        <section data-ntnx-section="type-half">\n          <label data-ntnx-label for="dnsPassword"><%= i18n(\'password\') %></label>\n          <input type="password" id="dnsPassword" class="dnsPassword">\n        </section>\n      </div>\n    </div>\n    <section data-ntnx-section class="addDnsManualContainer hide">\n      <div class="DNSTableWrapper">\n        \x3c!-- DNS table goes here --\x3e\n      </div>\n    </section>\n  </form>\n</div>'}),define("views/popups/fileserver/FileServerAddDNSPopupView",["views/basecomponents/popups/BasePopupView","views/popups/fileserver/FileServerDNSServerTableView","models/fileserver/FileServerDNSModel","models/fileserver/FileServerModel","managers/NotificationManager","managers/I18nManager","text!templates/wizards/fileserver/FileServerAddDNSContent.html","utils/FileServerUtil","utils/AppUtil","utils/AppConstants"],function(e,t,n,i,s,a,o,r,l,c){"use strict";var d=_.template(o),p=[{value:c.ACTION_SELECT,name:a.t("FileServerAddDNSPopupView","select_an_action")},{value:c.ACTION_ADD,name:a.t("FileServerAddDNSPopupView","add_entries")},{value:c.ACTION_DELETE,name:a.t("FileServerAddDNSPopupView","remove_entries")}];return e.extend({name:"FileServerAddDNSPopupView",el:"#popupAddDNS",events:{"click button.close, .btnCancel":"hide","click .addDnsAuto, .addDnsManual":"onClickRadio","click .btnSave":"onClickSave","click .btnVerify":"onClickVerify","change .comboaddRemoveDns":"onChangeAddRemoveEntries","keydown input.dnsUsername":"onKeyDown"},render:function(){var e=this,t=[{text:this.i18n("cancel"),extraClasses:"btnCancel n-btn-form n-cancel"},{isPrimary:!0,text:this.i18n("verify"),extraClasses:"btnVerify"},{isPrimary:!0,text:this.i18n("submit"),extraClasses:"btnSave"}],a=d(this.vtOptions({addRemoveDnsOptions:p}));this.$el.html(this.defaultTemplate({title:this.i18ns("dns"),bodyContent:a,footerButtons:this.defaultFooter(t)})),this.$(".addDnsAuto").click(),this.$(".btnVerify").addClass("hide"),this.$(".nutanixMoreInfo").nutanixMoreInfo({parseDataAttrs:!0}),this.triggerAction(c.MODAL.ACT.AS_REBUILD);var o=new n;o.setFileServerUuid(this.actionRoute.actionTargetId);var u=o.fetch({silent:!0}),h=new i;h.set(h.idAttribute,this.actionRoute.actionTargetId);var m=h.fetch({silent:!0});l.showLoader();var f=function(t,n){l.hideLoader(),e.getDnsEntries(o),r.setHelpLinkAfsVersion(e,e.actionRoute,h)},v=function(t,n){l.hideLoader(),e.triggerAction(c.MODAL.ACT.COVER_HIDE),t===c.STATE_ERROR?(s.showClientNotification(c.NOTIFY_ERROR,e.i18n("dns_entries_fetch_failure")),e.addDNSTable([])):(s.showClientNotification(c.NOTIFY_ERROR,e.i18n("file_server_fetch_failure")),e.getDnsEntries(o))};l.showLoader(),$.when(u,m).then(f,v)},getDnsEntries:function(e){var t=e.toJSON();t=_.sortBy(_.filter(t,function(e){return e.dnsIpAddress.split(".").length<=4}),"dnsName").concat(_.sortBy(_.filter(t,function(e){return e.dnsIpAddress.split(".").length>4}),"dnsName")),this.addDNSTable(t)},onKeyDown:_.debounce(function(e){$(e.currentTarget).val().length>0?this.$(".btnSave").removeClass("disabled"):this.$(".btnSave").addClass("disabled")},100),onClickSave:function(){var e=this;this.clearHeader();var t=this.$(".comboaddRemoveDns").val()===c.ACTION_ADD,i=$.trim(this.$(".dnsIp").val()),s=$.trim(this.$(".dnsUsername").val()),a=$.trim(this.$(".dnsPassword").val()),o={dnsOpType:c.DNS_OP_TYPE.AUTO,dnsServer:i,dnsUserName:s,dnsPassword:a},r=this.validateInputs(o);if(r)this.showHeaderError(r);else{var d=new n;d.actionMode=t?c.ACTION_ADD_DNS:c.ACTION_REMOVE_DNS,d.set(o),d.setFileServerUuid(this.actionRoute.actionTargetId),this.$(".btnSave").addClass("disabled"),d.save(null,{success:function(t,n){e.hide()},error:function(t,n){e.showHeaderError(l.processAjaxError(n.responseText)),e.$(".btnSave").removeClass("disabled")}})}},onClickVerify:function(){var e=this,t=new n;t.actionMode=c.ACTION_VERIFY_DNS,t.setFileServerUuid(this.actionRoute.actionTargetId),this.$(".btnVerify").addClass("disabled"),t.save(null,{success:function(t,n){n.taskUuid?(e.hide(),s.showClientNotification(c.NOTIFY_SUCCESS,e.i18n("verify_message"))):e.$(".btnVerify").removeClass("disabled")},error:function(t,n){e.showHeaderError(l.processAjaxError(n.responseText)),e.$(".btnVerify").removeClass("disabled")}})},validateInputs:function(e){var t=this.i18n("invalid_input_msg");return this.$(".error-class").removeClass("error-class"),e.dnsServer&&-1===e.dnsServer.indexOf(".")&&(this.$(".dnsIp").addClass("error-class"),t+=this.i18n("invalid_server_name")),e.dnsUserName||(this.$(".dnsUsername").addClass("error-class"),t+=this.i18n("missing_username")),e.dnsPassword||(this.$(".dnsPassword").addClass("error-class"),t+=this.i18n("missing_password")),t!==this.i18n("invalid_input_msg")&&t},addDNSTable:function(e){this.dnsServerEntriesView=new t({entries:e}),this.$(".DNSTableWrapper").html(this.dnsServerEntriesView.render().el),this.$(".serverVerifiedContainer, .serverUnverifiedContainer").addClass("hide"),this.verified=0===_.filter(e,function(e){return!e.verified}).length&&e.length>0,this.selectAction(this.verified)},selectAction:function(e){e?(this.$(".serverVerifiedContainer").removeClass("hide"),this.$(".comboaddRemoveDns").val(c.ACTION_SELECT).change()):(this.$(".serverUnverifiedContainer").removeClass("hide"),this.$(".comboaddRemoveDns").val(c.ACTION_ADD).change()),this.triggerAction(c.MODAL.ACT.AS_REBUILD)},onClickRadio:function(e){$(e.target).hasClass("addDnsAuto")?(this.verified?this.$(".serverVerifiedContainer").removeClass("hide"):this.$(".serverUnverifiedContainer").removeClass("hide"),this.$(".addDnsAutoContainer, .addRemoveDnsContainer").removeClass("hide"),this.$(".addDnsManualContainer, .btnVerify").addClass("hide"),this.$(".addDnsManual").prop("checked",!1),this.$(".btnSave, .dnsIpContainer").removeClass("hide")):(this.$(".addDnsAutoContainer, .serverVerifiedContainer,.serverUnverifiedContainer, .addRemoveDnsContainer").addClass("hide"),this.$(".addDnsManualContainer, .btnVerify").removeClass("hide"),this.$(".addDnsAuto").prop("checked",!1),this.$(".btnSave, .dnsIpContainer").addClass("hide")),this.triggerAction(c.MODAL.ACT.AS_REBUILD)},onChangeAddRemoveEntries:function(){var e=this.$(".comboaddRemoveDns").val();switch(this.$(".alert-info").addClass("hide"),e){case c.ACTION_SELECT:this.$(".serverNameContainer").hasClass("hide")||this.$(".serverNameContainer").addClass("hide"),this.$(".notSelectedMsg").removeClass("hide"),this.$(".btnSave").prop("disabled",!0);break;case c.ACTION_ADD:this.$(".serverNameContainer").removeClass("hide"),this.$(".btnSave").prop("disabled",!1),this.$(".addSelectedMsg").removeClass("hide");break;case c.ACTION_DELETE:this.deleteDnsEntreis(),this.$(".delSelectedMsg").removeClass("hide")}this.triggerAction(c.MODAL.ACT.AS_REBUILD)},deleteDnsEntreis:function(){var e=this;$.nutanixConfirm({title:this.i18n("confirm_delete_title"),msg:this.i18ns("confirm_delete_msg",this.actionRoute.actionTargetName),yesText:this.i18n("delete_entries"),class:"-red-confirm",yes:function(){e.$(".serverNameContainer").removeClass("hide"),e.$(".btnSave").prop("disabled",!1),e.triggerAction(c.MODAL.ACT.AS_REBUILD)},no:function(){e.selectAction(e.verified)},context:this})},hide:function(){this.$(".nutanixMoreInfo").nutanixMoreInfo("destroy"),this.dnsServerEntriesView.$(".nutanixMoreInfo").nutanixMoreInfo("destroy"),e.prototype.hide.apply(this,arguments)}})}),define("text!templates/popups/fileserver/FileServerEnableFileInsightContent.html",[],function(){return'<div data-ntnx-content-inner>\n  <form class="fsFileInsightForm">\n    <section data-ntnx-section="type-text">\n      <%= insightText %>\n    </section>\n    \x3c!-- Windows AD username --\x3e\n    <section data-ntnx-section>\n      <label data-ntnx-label for="adUsername">\n        <%=i18n(\'username\')%>\n        <span class="nutanixMoreInfo"\n          data-tooltip-classes="-nudge-up"\n          data-tooltip-container="body"\n          data-tooltip-title="<%= i18n(\'file_insights_ad_username_tooltip\') %>">\n        </span>\n      </label>\n      <input type="text" id="adUsername" class="adUsername">\n    </section>\n\n    \x3c!-- Windows AD password --\x3e\n    <section data-ntnx-section>\n      <label data-ntnx-label for="adPassword"><%= i18n(\'password\') %></label>\n      <input type="password" id="adPassword" class="adPassword">\n    </section>\n\n    \x3c!-- Data Retention Interval --\x3e\n    <section data-ntnx-section>\n      <label data-ntnx-label for="dataRetention">\n        <%= i18n(\'data_retention\') %>\n        <span class="nutanixMoreInfo"\n          data-tooltip-classes="-nudge-up"\n          data-tooltip-container="body"\n          data-tooltip-title="<%= i18n(\'data_retention_tooltip\') %>">\n        </span>\n      </label>\n      <%= dataRetentionTempl %>\n    </section>\n  </form>\n</div>'}),define("views/popups/fileserver/FileServerInsightPopupView",["views/basecomponents/popups/BasePopupView","models/fileserver/FileInsightsModel","models/fileserver/FileServerModel","models/fileserver/FileInsightsCollection","text!templates/popups/fileserver/FileServerEnableFileInsightContent.html","components/Components","utils/AppConstants","utils/AppUtil"],function(e,t,n,i,s,a,o,r){"use strict";var l=_.template(s);return e.extend({name:"FileServerInsightPopupView",el:"#popupEnableFileInsights",events:{"click .modal-header button.close, .btnCancel":"hide","click .btnSave":"onClickSave"},initialize:function(t){e.prototype.initialize.apply(this,arguments),this.fileServerModel=new n},show:function(t){e.prototype.show.apply(this,arguments,!0),this.fetchFileServer(t)},render:function(){var e=[{text:this.i18n("cancel"),extraClasses:"btnCancel"},{isPrimary:!0,text:this.i18n("submit"),extraClasses:"btnSave"}],t=this.options.actionRoute.actionTargetName,n=this.i18ns("enable_file_insights_desc",t),i=this.getDataRetentionOptions(),s=a.select({id:"dataRetention",jsClasses:"dataRetention",variants:"bottom-anchor",options:i}),o=l(this.vtOptions({insightText:n,dataRetentionTempl:s}));this.$el.html(this.defaultTemplate({title:this.i18n("enable_file_insights"),bodyContent:o,footerButtons:this.defaultFooter(e)})),this.$(".nutanixMoreInfo").nutanixMoreInfo({parseDataAttrs:!0})},getDataRetentionOptions:function(){for(var e=[],t="",n=1;n<=12;n++)t=r.pluralize("FileServerInsightPopupView","month","","1 Month","%d Months",n),e.push({name:t,value:n,selected:12===n?"selected":""});return e},onClickSave:function(){this.clearHeader(),this.validateUserInput()},validateUserInput:function(){var e=this.$("#adUsername").val(),t=this.$("#adPassword").val(),n=this.options.actionRoute[o.NAV_ACTION_PARENT_ID];if(e&&t)n?this.enableFileInsights():this.fetchFileInsightsInfo();else{var i=this.i18n("all_fields_required");this.showHeaderError(i)}},enableFileInsights:function(){var e=[],n=this,i=this.options.actionRoute[o.NAV_ACTION_PARENT_ID]||this.fileInsightsIp,s=this.$("#adUsername").val(),a=this.$("#adPassword").val(),l=this.$(".dataRetention").val(),c=this.fileServerModel.get(this.fileServerModel.DP.DNS_DOMAIN_NAME);if(c){e.push({uuid:this.options.actionRoute[o.NAV_ACTION_TARGET_ID],is_active:!0});var d=new t;d.set("ip",i),d.set("fs_list",e),d.set("ad_user",s),d.set("ad_password",a),d.set("data_retention_interval",l),d.set("ad_domain",c);var p=o.ENTITY_NAMES[o.ENTITY_FILE_INSIGHTS_SERVER];d.setEntityName(p),this.$(".btnSave").attr("disabled","disabled"),d.getURL("update"),d.save(null,{success:function(e,t){r.log("File Server is subscribed to File Insights."),n.hide();var i=$(".btnDetailsAction[action = "+o.ACTION_ENABLE_FILE_INSIGHTS+"]"),s=i.parent("li");i.text("Disable").attr("action",o.ACTION_DISABLE_FILE_INSIGHTS),i.clone().appendTo(s),i.text(n.i18n("view")).attr("action",o.ACTION_VIEW_FILE_INSIGHTS)},error:function(e,t){n.$(".btnSave").attr("disabled",!1).removeClass("disabled");var i=r.processAjaxError(t.responseText);n.showHeaderError(i)}})}},fetchFileInsightsInfo:function(){var e=this;(new i).fetch({success:function(t){var n=t.models[0];n&&n.get(n.DP.IP)&&(e.fileInsightsIp=n.get(n.DP.IP)),e.enableFileInsights()},error:function(){r.log("Error: fetching File Insights vms.")}})},fetchFileServer:function(e){var t=this;this.fileServerModel.set(this.fileServerModel.idAttribute,e.actionTargetId,{silent:!0}),this.fileServerModel.fetch({error:function(e,n){t.showHeaderError(t.i18ns("server_error_message_template",t.i18ns("fetching_file_server"))+r.processAjaxError(n.responseText))}})}})}),define("text!templates/popups/fileserver/FileInsightDeployOptionView.html",[],function(){return"<section data-ntnx-section class=\"subviewContent contentOptions\">\n  <div data-ntnx-empty-list>\n    <section data-ntnx-section>\n      <h5 data-ntnx-title> <%= i18n('opt_new_file_insights') %></h5>\n      <section data-ntnx-section=\"type-text\">\n        <%= i18n('desc_new_file_insights') %>\n      </section>\n      <section data-ntnx-section>\n        <%= Components.button({\n          isPrimary: true,\n          extraClasses: 'btnDeploy',\n          extraAttr: [\n            {\n              key: 'action',\n              value: 'deploy_file_analytics'\n            },\n            {\n              key: 'actionTarget',\n              value: 'install_file_insights_image'\n            },\n            {\n              key: 'actionId',\n              value: 'install_file_insights_image'\n            }\n          ],\n          text: i18n('btn_deploy')\n        }) %>\n      </section>\n    </section>\n  </div>\n</section>"}),define("views/popups/fileserver/FileInsightDeployOptionView",["views/basecomponents/popups/BasePopupSubView","utils/AppConstants","text!templates/popups/fileserver/FileInsightDeployOptionView.html"],function(e,t,n){"use strict";var i=_.template(n);return e.extend({el:"#subviewOptions",events:{"click .btnConnect":"onClickLinkAction","click .btnDeploy":"onClickLinkAction"},setParentView:function(t){e.prototype.setParentView.apply(this,arguments),this.name=t.name},render:function(){this.$el.html(i(this.vtOptions())),this.triggerAction(t.MODAL.ACT.AS_REBUILD)}})}),define("models/multicluster/UploadMulticlusterModel",["models/BaseModel","data/DataURLConstants","data/DataManager","utils/AppUtil","utils/AppConstants"],function(e,t,n,i,s){"use strict";var a={METADATA:"metadataFile",BINARY:"binaryFile",NAME:"name",FILE:"file",MD5:"md5",SIZE:"size",VERSION:"version",OFFSET:"offset"};return e.extend({name:"UploadMulticlusterModel",metadata:null,callbackFetchList:null,xhrUpload:null,uploadPrismCentralRelease:function(e,t){var n=this._validateUploadData(e,!0);if($.trim(n).length)return void this.trigger("error",n);this.callbackFetchList=t.callbackFetchList||function(){},i.log("UploadMulticlusterModel : Start uploading the files...\n Metadata: "+e[a.METADATA][a.NAME]+"\n Prism Central binary: "+e[a.BINARY][a.NAME]),this._validateMetadata(e[a.METADATA][a.FILE],t).done(function(){this._populateMetadata(e).done(function(e){this._uploadBinary(e).done(function(){this.trigger("success")}.bind(this))}.bind(this))}.bind(this))},abortUpload:function(){this.xhrUpload&&this.xhrUpload.abort&&200!==this.xhrUpload.status&&4!==this.xhrUpload.readyState&&(this.xhrUpload.abort(),this.xhrUpload=null)},_validateMetadata:function(e,a){var o=this,r=s.ONECLICK_PC_DEPLOY_SOFTWARE_TYPE;a.entityType&&(r=a.entityType);var l=n.getFormattedURL(_.template(t.UPGRADE_VALIDATE_METADATA,{type:r})),c={type:"POST",url:l,data:e,cache:!1,contentType:"application/octet-stream",processData:!1},d=function(){i.log("UploadMulticlusterModel : Valid metadata file.")},p=function(e,t,n){i.log("UploadMulticlusterModel : Invalid metadata file"),e&&e.responseText&&e.responseText.length>0?o.trigger("error",i.processAjaxError(e.responseText)):o.trigger("error","UploadMulticlusterModel : "+o.i18n("invalid_metadata_file"))};return i.uploadBinaryFile(c,d,p)},_populateMetadata:function(e){var t=new FileReader,n=$.Deferred();return t.onload=function(t){var i=t.target.result;try{this.metadata=JSON.parse(i)}catch(e){return void n.reject(this.i18n("error_metadata_parsing"))}var s={};s[a.MD5]=this.metadata.hex_md5,s[a.SIZE]=this.metadata.size,s[a.VERSION]=this.metadata.version_id,n.resolve(_.extend(s,e))}.bind(this),t.onerror=function(e){n.reject(this.i18n("error_metadata_reading"))}.bind(this),n.fail(function(e){this.trigger("error",e)}.bind(this)),t.readAsText(e[a.METADATA][a.FILE]),n.promise()},_uploadBinary:function(e){var o,r=this._validateUploadData(e,!1);if($.trim(r).length)o=$.Deferred().fail(function(){this.trigger("error",r)}.bind(this)).reject().promise();else{var l={fileSize:e[a.SIZE],md5Sum:e[a.MD5],fileName:e[a.VERSION],version:e[a.VERSION]},c=e[a.BINARY][a.FILE];_.isUndefined(e[a.OFFSET])||(l.offset=e[a.OFFSET],c=c.slice(e[a.OFFSET],c.size)),l=i.formatObjectToQuery(l);var d=n.getFormattedURL(_.template(t.UPGRADE_UPLOAD,{type:s.ONECLICK_PC_DEPLOY_SOFTWARE_TYPE,id:encodeURI(e[a.VERSION]),params:l})),p={type:"POST",url:d,data:c,cache:!1,contentType:"application/octet-stream",processData:!1},u=function(){i.log("UploadMulticlusterModel : Uploaded binary file.")},h=function(e,t,n){"abort"===n?(i.log("UploadMulticlusterModel : Upload was aborted by user."),this.trigger("success",{paused:!0})):(i.log("UploadMulticlusterModel : Unable to upload binary file"),this.trigger("error","Unable to upload binary file"))}.bind(this);o=i.uploadBinaryFile(p,u,h),this.callbackFetchList(),this.xhrUpload=o}return o},_validateUploadData:function(e,t){var n=[];return t||(e[a.MD5]&&0!==e[a.MD5].length||n.push(this.i18n("error_invalid_md5")),e[a.VERSION]&&0!==e[a.VERSION].length||n.push(this.i18n("error_invalid_version")),e[a.SIZE]?e[a.BINARY][a.FILE].size!==e[a.SIZE]&&n.push(this.i18n("error_size_not_correspond")):n.push(this.i18n("error_invalid_filesize"))),n.join(" ")}},{DP:a})}),define("text!templates/popups/fileserver/FileInsightDeploymentVersionsView.html",[],function(){return'<section class="subviewContent contentVersions">\n  <section data-ntnx-section>\n    <h5 data-ntnx-title> <%= i18n(\'install_image\') %></h5>\n    <section data-ntnx-section="type-text">\n      <%= i18n(\'install_image_desc\') %>\n    </section>\n  </section>\n  <section data-ntnx-section>\n    <h5 data-ntnx-title> <%= i18n(\'available_versions\') %></h5>\n    <section data-ntnx-section>\n      <div data-ntnx-empty-list id="fileAnalyticsReleaseList" class="text-left">\n        <section data-ntnx-section style="display: flex;justify-content: space-between;">\n          <div class="n-message loadingSpinner">\n            \x3c!-- @view: inline spinner goes here... --\x3e\n          </div>\n        </section>\n      </div>\n    </section>\n  </section>\n  <section data-ntnx-section>\n    <section data-ntnx-section="type-title">\n      <h5 data-ntnx-title> <%= i18n(\'upload_binary\') %></h5>\n    </section>\n    <section data-ntnx-section="type-text" class="uploadInitialLink">\n      <%= i18n(\'upload_desc_1\') %>\n      <a class="linkUpload"><%= i18n(\'upload_desc_2\') %></a>\n      <%= i18n(\'upload_desc_3\') %>\n    </section>\n    <section data-ntnx-section>\n      <div data-ntnx-empty-list class="uploadForm">\n        <form class="formUpload text-left" target="upload_target"\n          method="post" enctype="multipart/form-data">\n          <section data-ntnx-section>\n            <label data-ntnx-label for="inputMetadataFile">\n              <%= i18n(\'metadata_file\') %>\n            </label>\n            <div data-ntnx-form-inline="form-full-width">\n              <input type="file" id="inputMetadataFile"\n                class="inputMetadataFile" name="metadataFile" />\n            </div>\n          </section>\n\n          <section data-ntnx-section>\n            <label data-ntnx-label for="inputTarFile">\n              <%= i18n(\'binary_file\') %>\n            </label>\n            <div data-ntnx-form-inline="form-full-width">\n              <input type="file" id="inputTarFile" class="inputTarFile"\n                name="inputTarFile" />\n            </div>\n          </section>\n\n          <section data-ntnx-section class="text-right">\n            <a class="btn btn-control btnCancelUpload">\n              <%= i18n(\'cancel\') %>\n            </a>\n            <a class="btn btn-primary btn-control btnConfirmUpload">\n              <%= i18n(\'upload_now\') %>\n            </a>\n          </section>\n        </form>\n      </div>\n      <div data-ntnx-empty-list class="uploadSpinner">\n        <section data-ntnx-section>\n          <div class="n-upload-processing">\n            <div class="n-inline-loading-container">\n              <div class="n-inline-loading"></div>\n                <%= i18n(\'uploading_file\') %>\n            </div>\n          </div>\n        </section>\n      </div>\n    </section>\n  </section>\n</section>'}),define("text!templates/popups/fileserver/FileInsightsDeploymentVersionRowsView.html",[],function(){return'\x3c!-- The content will replace the inline spinner --\x3e\n<% if (fileAnalyticsCollection && fileAnalyticsCollection.length) { %>\n  <% _.each(fileAnalyticsCollection, function(release) { %>\n  <% var isDownload = release.transferType === transferTypeMap.DOWNLOAD,\n         isUpload = release.transferType === transferTypeMap.UPLOAD,\n         isAvailable = release.status === statusMap.AVAILABLE,\n         isProgress = release.status === statusMap.QUEUED ||\n                      release.status === statusMap.INPROGRESS,\n         isPaused = release.status === statusMap.PAUSED,\n         isCompleted = release.status === statusMap.COMPLETED,\n         isFailed = release.status === statusMap.FAILED,\n         isCorrupted = release.status === statusMap.CORRUPTED,\n         isMD5Missmatch = release.status === statusMap.MD5SUMMISMATCH; %>\n    <section data-ntnx-section class="software-container">\n      <div class="version">\n        <%= release.name || release.version %>\n      </div>\n      <div class="software-download-container">\n        <% if (isDownload && isAvailable) { %>\n          <div>\n            <%= Components.button({\n              extraClasses: \'btnDownload\',\n              extraAttr: [\n                { key: \'actionTargetId\', value: release.version },\n                { key: \'action\', value: \'create_option\' }\n              ],\n              text: i18n(\'download\')\n            }) %>\n          </div>\n        <% } else if (isProgress) {\n          var percent = release.totalSizeInBytes > 0 ? Math.max(0, Math.floor(\n              100 * release.currentSizeInBytes / release.totalSizeInBytes)) : 0;\n        %>\n          <div class="progress-container">\n            <div class="progress -compact">\n              <div class="progress-bar" role="progressbar"\n                   aria-valuenow="<%= percent %>" aria-valuemin="0"\n                   aria-valuemax="100" style="width: <%= percent %>%">\n                <span class="sr-only"><%= percent %>% Complete</span>\n              </div>\n            </div>\n\n            <div class="progress-value">\n              <%= isDownload ? \'Downloading\' : \'Uploading\' %>\n              ... <%= percent %>%\n            </div>\n\n            <a data-id="<%= release.name %>"\n              class="btn-stop btn-control btnStop" title="Stop">\n              <%= i18n(\'cancel\') %>\n            </a>\n          </div>\n        <% } else if (isPaused) { %>\n          <div>\n            <button class="btn -default btn-control btnResume"\n                 data-id="<%= release.name %>">\n              <%= i18n(\'resume\') %>\n            </button>\n          </div>\n        <% } else if (isCompleted) { %>\n          <div>\n            <i data-id="<%= release.name %>"\n               class="btnDelete btn-control success-delete install"\n               data-icon="v" aria-hidden="true" title="Delete">\n            </i>\n            <button class="btn btn-primary btn-control btnInstall"\n                 actionTargetId="<%= release.version %>"\n                 action="create_option">\n              <%= i18n(\'install\') %>\n            </button>\n          </div>\n        <% } else if (isFailed || isMD5Missmatch) { %>\n          <div>\n          <% if (isMD5Missmatch) { %>\n            <span title="<%= i18n(\'md5summismatch\') %>" class="status">\n              <%= i18n(\'failed\') %>\n            </span>\n          <% } else { %>\n            <span class="status"><%= i18n(\'failed\') %></span>\n          <% } %>\n            <button class="btn btn-danger btn-control btnDelete"\n                 data-id="<%= release.name %>">\n              <%= i18n(\'delete\') %>\n            </button>\n          </div>\n        <% } else if (isCorrupted) { %>\n          <div>\n            <span class="status"><%= i18n(\'corrupted\') %></span>\n            <button class="btn btn-danger btn-control btnDelete"\n              data-id="<%= release.name %>">\n              <%= i18n(\'delete\') %>\n            </button>\n          </div>\n        <% } %>\n      </div>\n    </section>\n  <% }); %>\n<% } else { %>\n  <div>\n    <%= i18n(\'no_available_versions\') %>\n  </div>\n<% } %>'}),define("views/popups/fileserver/FileInsightDeploymentVersionsView",["views/basecomponents/popups/BasePopupSubView","models/softwareupgrade/SoftwareReleaseCollection","models/multicluster/UploadMulticlusterModel","utils/AppConstants","utils/AppUtil","managers/IdleManager","data/DataProperties","components/Components","text!templates/popups/fileserver/FileInsightDeploymentVersionsView.html","text!templates/popups/fileserver/FileInsightsDeploymentVersionRowsView.html"],function(e,t,n,i,s,a,o,r,l,c){"use strict";var d=_.template(l),p=_.template(c);return e.extend({el:"#subviewVersions",fileAnalyticsSoftwares:null,uploadModel:null,events:{"click .btnInstall":"onClickLinkAction","click .btnDownload":"onClickLinkAction","click .btnStop":"onStopClick","click .btnResume":"onResumeClick","click .linkUpload":"onLinkUploadClick","click .btnDelete":"onDeleteClick","click .btnCancelUpload":"onBtnCancelUploadClick","click .btnConfirmUpload":"onBtnConfirmUploadClick"},modelEvents:{"reset fileAnalyticsSoftwares":"onFileAnalyticsSoftwaresReset"},initialize:function(n){e.prototype.initialize.apply(this,arguments),this.fileAnalyticsSoftwares=new t(null,{softwareType:i.ENTITY_FILE_ANALYTICS}),this.delegateModelEvents()},setParentView:function(t){e.prototype.setParentView.apply(this,arguments),this.name=t.name},destroy:function(){this.fileAnalyticsSoftwares.stopPolling({force:!0}),e.prototype.destroy.apply(this,arguments)},render:function(){this.$el.html(d(this.vtOptions({}))),this.triggerAction(i.MODAL.ACT.AS_REBUILD),s.addInLineDonutLoader(this.$(".loadingSpinner")),this.$(".uploadSpinner, .uploadForm").addClass("hide")},onStartServices:function(){this.fileAnalyticsSoftwares.startPolling({force:!0})},onStopServices:function(){this.fileAnalyticsSoftwares.stopPolling()},confirmExit:function(e){e()},onStopClick:function(e){var t=this,n=$(e.currentTarget).attr("data-id"),i=this.fileAnalyticsSoftwares.find(function(e){return e.get(o.NAME)===n});i&&(this.fileAnalyticsSoftwares.stopPolling(),this.uploadModel&&this.uploadModel.abortUpload(),i.cancelTransfer({success:function(e,n,i){t.fileAnalyticsSoftwares.startPolling({force:!0})},error:function(e,n,i){t.showHeaderError(t.i18n("error_cannot_cancel_transfer")),t.fileAnalyticsSoftwares.startPolling({force:!0})}}))},onResumeClick:function(e){var t=$(e.currentTarget).attr("data-id"),n=this.fileAnalyticsSoftwares.find(function(e){return e.get(o.NAME)===t});if(n){var i=n.get(o.UPGRADE_CURRENT_SIZE_IN_BYTES);this.startUpload(i)}},onDeleteClick:function(e){var t=this,n=$(e.currentTarget).attr("data-id"),i=this.fileAnalyticsSoftwares.find(function(e){return e.get(o.NAME)===n});i&&(this.fileAnalyticsSoftwares.stopPolling(),i.destroy({success:function(e,n,i){t.fileAnalyticsSoftwares.startPolling({force:!0})},error:function(e,n,i){t.showHeaderError(t.i18n("error_cannot_delete_release")),t.fileAnalyticsSoftwares.startPolling({force:!0})}}))},resetUploadForm:function(){this.$(".formUpload")[0].reset(),this.$(".file-input > .filename").removeAttr("title").html(this.i18nStatic(r.name,"fileInput.defaultFilenameText"))},onFileAnalyticsSoftwaresReset:function(){this.$("#fileAnalyticsReleaseList").html(p(this.vtOptions({fileAnalyticsCollection:this.fileAnalyticsSoftwares.toJSON(),statusMap:i.UPGRADE_SOFTWARE_RELEASE_STATUS,transferTypeMap:i.UPGRADE_TRANSFER_TYPE}))),this.triggerAction(i.MODAL.ACT.AS_REBUILD)},onLinkUploadClick:function(){this.$(".uploadInitialLink").addClass("hide"),this.$(".uploadForm").removeClass("hide"),this.triggerAction(i.MODAL.ACT.AS_REBUILD)},onBtnCancelUploadClick:function(){this.$(".uploadInitialLink").removeClass("hide"),this.$(".uploadForm").addClass("hide"),this.resetUploadForm(),this.triggerAction(i.MODAL.ACT.AS_REBUILD)},onBtnConfirmUploadClick:function(){this.startUpload()},startUpload:function(e){var t=this;this.$(".uploadInitialLink").addClass("hide"),this.$(".uploadForm").addClass("hide"),this.$(".uploadSpinner").removeClass("hide"),a.skipAutoLogout=!0;var s=this.$(".formUpload"),o=s.find("#inputMetadataFile"),r=s.find("#inputTarFile"),l={metadataFile:{name:o.val(),file:o[0].files[0]},binaryFile:{name:r.val(),file:r[0].files[0]}};if(l.binaryFile.name.indexOf(i.TAR_GZ_SUFFIX)>0)return this.$(".uploadInitialLink").addClass("hide"),this.$(".uploadForm").removeClass("hide"),this.$(".uploadSpinner").addClass("hide"),
void this.showHeaderError(this.i18n("binary_file_error"));_.isUndefined(e)||(l.offset=e);var c=this.checkMetadataRequired(l,e);if(c.length)return this.showHeaderError(c.join(" ")),this.$(".uploadInitialLink").addClass("hide"),this.$(".uploadForm").removeClass("hide"),void this.$(".uploadSpinner").addClass("hide");this.uploadModel=new n,this.uploadModel.on("error",function(e){t.showHeaderError(e),t.$(".uploadForm").removeClass("hide"),t.$(".uploadSpinner").addClass("hide"),a.skipAutoLogout=!1,t.fileAnalyticsSoftwares.startPolling({force:!0}),t.uploadModel=null}),this.uploadModel.on("success",function(e){t.$(".uploadSpinner").addClass("hide"),e&&e.paused?t.$(".uploadForm").removeClass("hide"):(t.$(".uploadInitialLink").removeClass("hide"),t.resetUploadForm()),a.skipAutoLogout=!1,t.uploadModel=null,t.fileAnalyticsSoftwares.stopPolling(),t.fileAnalyticsSoftwares.startPolling({force:!0})}),this.fileAnalyticsSoftwares.stopPolling(),this.uploadModel.uploadPrismCentralRelease(l,{callbackFetchList:function(){t.fileAnalyticsSoftwares.startPolling({force:!0})},entityType:i.ENTITY_FILE_ANALYTICS})},checkMetadataRequired:function(e,t){var i=[],a=s.getObjectPathValue(e,n.DP.METADATA),o=s.getObjectPathValue(a,n.DP.NAME),r=s.getObjectPathValue(a,n.DP.FILE);if(a&&o&&r&&0!==o.length||i.push(t?this.i18n("error_reupload_metadata"):this.i18n("error_select_metadata")),r){"json"!==r.name.substring(r.name.lastIndexOf(".")+1).toLowerCase()&&i.push(this.i18n("error_metadata_file_type"))}var l=s.getObjectPathValue(e,n.DP.BINARY),c=s.getObjectPathValue(l,n.DP.NAME),d=s.getObjectPathValue(l,n.DP.FILE);if(l&&c&&d&&0!==c.length||i.push(t?this.i18n("error_reupload_binary"):this.i18n("error_select_binary")),d){"qcow2"!==d.name.substring(d.name.lastIndexOf(".")+1).toLowerCase()&&i.push(this.i18n("error_binary_file_type"))}return i}})}),define("text!extras/file_insights_vm_config.json",[],function(){return'{\n  "minimum": {\n    "memory": 12,\n    "num_vcpus": 2,\n    "cores": 2,\n    "disk_size": 2\n  },\n  "default_val": {\n    "memory": 24,\n    "num_vcpus": 4,\n    "cores": 2,\n    "disk_size": 3\n  }\n}'}),define("text!templates/popups/fileserver/FileInsightDeploymentCreateView.html",[],function(){return'<div class="subviewContent contentCreate">\n  <section data-ntnx-section="type-text">\n    <h5 data-ntnx-title><%= i18n(\'header_text\') %></h5>\n  </section>\n  <form role="form" id="afsAnalyticsDeployPopupForm">\n    \x3c!-- Name --\x3e\n    <section data-ntnx-section>\n      <label data-ntnx-label for="name">\n        <%= i18n(\'formTxt.name_text\') %>\n      </label>\n      <input type="text" id="name" class="name" value="<%= name %>">\n    </section>\n\n    \x3c!-- Storage Container list --\x3e\n    <section data-ntnx-section class="storageContainerWrapper">\n      <label data-ntnx-label for="storageContainer">\n        <%= i18n(\'formTxt.storage_container\') %>\n      </label>\n      <div class="dropDownContainer">\n        <span class="n-message loadingSpinner">\n          \x3c!-- @view: inline spinner goes here... --\x3e\n        </span>\n      </div>\n    </section>\n\n    \x3c!-- Size --\x3e\n    <section data-ntnx-section class="sectionWrapper sizeWrapper">\n      <label data-ntnx-label><%= i18n(\'formTxt.sizeTB\') %></label>\n      <input type="number" class="diskSize" value="<%= defaultDiskSize %>"\n        min="<%= diskSize %>"\n        data-test="fileinsightdeploymentcreateview_input_disk_size">\n    </section>\n\n    \x3c!-- Network list --\x3e\n    <section data-ntnx-section class="networkListWrapper">\n      <label data-ntnx-label for="networkList">\n        <%= i18n(\'formTxt.network_list\') %>\n      </label>\n      <div class="dropDownContainer">\n        <span class="n-message loadingSpinner">\n          \x3c!-- @view: inline spinner goes here... --\x3e\n        </span>\n      </div>\n    </section>\n\n    <div class="fsNetworkDetail hidden">\n      <section data-ntnx-section="type-text">\n        <table id="managedNetworkDetail" class="table readonly-table">\n          <tbody>\n          \x3c!-- @view: managed network details goes here...--\x3e\n          </tbody>\n        </table>\n      </section>\n    </div>\n\n    <div class="fsNetworkConfig">\n      \x3c!-- Netmask.  --\x3e\n      <section data-ntnx-section>\n        <label data-ntnx-label>\n          <%= i18n(\'formTxt.subnet_mask\') %>\n        </label>\n        <input type="text" class="netmask"/>\n      </section>\n      \x3c!-- Gateway.  --\x3e\n      <section data-ntnx-section>\n        <label data-ntnx-label>\n          <%= i18n(\'formTxt.gateway\') %>\n        </label>\n        <input type="text" class="gateway"/>\n      </section>\n    </div>\n\n    <section data-ntnx-section class="ipWrapper">\n      \x3c!-- IP Address --\x3e\n      <label data-ntnx-label for="ipAddress">\n        <%= i18n(\'formTxt.ip_address\') %>\n      </label>\n      <input type="text" class="ipAddress" value="<%= ip_address %>">\n    </section>\n\n    \x3c!-- Configuration --\x3e\n    <section data-ntnx-section="type-separator">\n      <h5 data-ntnx-title>\n        <%= i18n(\'formTxt.vm_resource_txt\') %>\n      </h5>\n      <section data-ntnx-section="type-text">\n        <%= i18n(\'formTxt.memory_sizing_txt\') %>\n      </section>\n    </section>\n    <div class="clearfix">\n      \x3c!-- Memory --\x3e\n      <section data-ntnx-section="type-third">\n        <label data-ntnx-label for="memory">\n          <%= i18n(\'formTxt.memory_text\') %>\n        </label>\n        <input type="number" class="memory input-mini"\n          value="<%= defaultMemory %>" min="<%= memory %>"\n            data-test="fileinsightdeploymentcreateview_input_memory">\n      </section>\n\n      \x3c!-- Number of vCPUs per VM --\x3e\n      <section data-ntnx-section="type-third">\n        <label data-ntnx-label for="vcpu">\n          <%= i18n(\'formTxt.vcpu_text\') %>\n        </label>\n        <input type="number" class="vcpu" value="<%= defaultVcpu %>"\n          min="<%= vcpu %>"\n            data-test="fileinsightdeploymentcreateview_input_vcpu">\n      </section>\n\n      \x3c!-- Number of Core --\x3e\n      <section data-ntnx-section="type-third">\n        <label data-ntnx-label for="cores">\n          <%= i18n(\'formTxt.core_text\') %>\n        </label>\n        <input type="number" class="cores" value="<%= defaultCores %>"\n          min="<%= cores %>"\n            data-test="fileinsightdeploymentcreateview_input_cores">\n      </section>\n    </div>\n\n    \x3c!-- Advanced options--\x3e\n    <section data-ntnx-section="type-separator">\n      <%= Components.checkbox({\n        jsClasses: \'advancedSettings\',\n        labelText: i18n(\'formTxt.advanced_settings\'),\n        checked: false\n      }) %>\n      <section class="advancedSettingsContainer hidden">\n        \x3c!-- DNS Name Servers.  --\x3e\n        <section data-ntnx-section>\n          <label data-ntnx-label for="domainNameServers">\n            <%= i18n(\'formTxt.dns_ip\') %>\n          </label>\n          <input type="text" class="domainNameServers">\n        </section>\n\n        \x3c!-- NTP Servers --\x3e\n        <section data-ntnx-section>\n          <label data-ntnx-label for="ntpServers">\n            <%= i18n(\'formTxt.ntp_serevers\') %>\n          </label>\n          <input type="text" class="ntpServers">\n        </section>\n      </section>\n    </section>\n\n    \x3c!-- File Insights enable hint --\x3e\n    <section data-ntnx-section="type-text" class="fileInsightsEnableHint">\n      <div class="alert alert-info">\n        <%= i18n("file_insights_enable_hint") %>\n      </div>\n    </section>\n  </form>\n</div>'}),define("views/popups/fileserver/FileInsightDeploymentCreateView",["views/basecomponents/popups/BasePopupSubView","models/storage/ContainerCollection","models/network/AcropolisNetworkCollection","models/fileserver/FileInsightsModel","models/fileserver/FileInsightsCollection","models/fileserver/FileServerCollection","models/network/AcropolisNetworkAddressCollection","data/DataProperties","components/Components","utils/AppConstants","utils/AppUtil","utils/HypervisorUtil","utils/VMUtil","utils/StatsUtil","managers/ClusterManager","text!extras/file_insights_vm_config.json","text!templates/popups/fileserver/FileInsightDeploymentCreateView.html","text!templates/wizards/fileserver/ManagedNetworkDetailsView.html"],function(e,t,n,i,s,a,o,r,l,c,d,p,u,h,m,f,v,g){"use strict";return v=_.template(v),g=_.template(g),e.extend({name:"FileInsightDeploymentCreateView",el:"#subviewCreate",model:null,fileInsightsModel:null,ipPoolsExists:!1,isManagedNetwork:null,events:{"keydown .memory, .vcpu, .cores, .diskSize":"onConfigKeyDown","change  .advancedSettings":"onToggleAdvancedSettings","change  .networkList":"onNetworkChange","change  .storageContainer, .diskSize":"validateStorageCapacity"},initialize:function(t){e.prototype.initialize.apply(this,arguments),this.model=new s,this.fileInsightsModel=new i},setParentView:function(t){e.prototype.setParentView.apply(this,arguments),this.name=t.name},render:function(){this.fetchFileServers(),this.fetchNetworkList(),this.clusterModel=m.getCurrentClusterModel(),this.fetchCurrentClusterDetails(),this.fetchFileInsightsVm();var e=this.getConfigValues(),t=v(this.vtOptions({Components:l,vcpu:e.minimum.num_vcpus,cores:e.minimum.cores,memory:e.minimum.memory,diskSize:e.minimum.disk_size,defaultVcpu:e.default_val.num_vcpus,defaultCores:e.default_val.cores,defaultMemory:e.default_val.memory,defaultDiskSize:e.default_val.disk_size,ip_address:""}));this.$el.html(t),d.addInLineDonutLoader(this.$(".loadingSpinner")),this.triggerAction(c.MODAL.ACT.AS_REBUILD)},getConfigValues:function(){var e={};try{e=JSON.parse(f)}catch(t){d.log("Error: "+t),e.minimum="",e.default_val="",e.minimum.num_vcpus="",e.minimum.cores="",e.minimum.memory="",e.minimum.disk_size="",e.default_val.num_vcpus="",e.default_val.cores="",e.default_val.memory="",e.default_val.disk_size=""}return e},fetchFileInsightsVm:function(){var e=this;this.model.fetch({success:function(t){e.isFileInsightsVmDeployed()},error:function(){var t=e.i18n("file_insights_vm_fetch");e.showHeaderError(t)}})},fetchFileServers:function(){var e=this;this.fileServerCollection=new a,this.fileServerCollection.fetch({alwaysTriggerChange:!0}).success(function(t){e.fetchStorageContainers()}).error(function(t){d.debug(t.responseText),e.showFetchError(t)})},fetchStorageContainers:function(){var e=this;this.storageContainer=new t,this.storageContainer.fetch({alwaysTriggerChange:!0}).success(function(t){e.renderStorageContainers()}).error(function(t){d.debug(t.responseText),e.showFetchError(t)})},fetchNetworkList:function(){var e=this;this.networkList=new n,this.networkList.useUhura(!0),this.networkList.fetch().success(function(t){e.renderNetworkList()}).error(function(t){d.debug(t.responseText),e.showFetchError(t)})},fetchCurrentClusterDetails:function(){var e=this;this.clusterModel.fetch({success:function(){e.renderNtpServers(),e.renderNetworkDnsConfig()},error:function(t){d.debug(t.responseText),e.showFetchError(t)}})},renderNtpServers:function(e){if(e)this.$(".ntpServers").val(e||"");else{var t="";this.clusterModel&&(t=this.clusterModel.get("ntpServers")),this.$(".ntpServers").val(t)}},renderNetworkDnsConfig:function(e){var t=[],n=[];this.clusterModel&&(t=this.clusterModel.get(r.CLUSTER_NAME_SERVERS)||[]),n=e&&e.length>0?e:t,this.$(".domainNameServers").val(n)},renderStorageContainers:function(){if(this.storageContainer.models.length){var e=this.buildSelectOption(this.storageContainer.models[0].get(r.NAME),this.storageContainer.models,c.ENTITY_CONTAINER),t=l.select({id:"storageContainer",jsClasses:"storageContainer",variants:"bottom-anchor",options:e});this.$(".storageContainerWrapper .dropDownContainer").html(t)}this.validateStorageCapacity(),this.isFileInsightsVmDeployed()},renderNetworkList:function(){if(this.networkList.models.length){var e=this.buildSelectOption(this.networkList.models[0].get(r.NAME),this.networkList.models,c.ENTITY_NETWORK),t=l.select({id:"networkList",jsClasses:"networkList",variants:"bottom-anchor",options:e});this.$(".networkListWrapper .dropDownContainer").html(t)}var n=this.$(".networkList").val();this.renderNetworkConfig(n),this.isFileInsightsVmDeployed()},isFileInsightsVmDeployed:function(){var e=this.model.models[0];if(e&&e.get(e.DP.IP)){var t=e.get(e.DP.IP),n=this.i18ns("file_insights_vm_deployed",t);if(e.get(e.DP.IS_DEPLOYED)){var i=e.get(e.DP.FS_LIST),s=i.filter(function(e){return e.is_active}),a=s.length;if(a){var o=d.pluralizeEntity(c.ENTITY_FILE_SERVER,a);n+=" <br>"+this.i18ns("file_insights_enabled",a,o)}else n+=" <br>"+this.i18n("file_insights_enable_hint"),this.$(".fileInsightsEnableHint").hide()}else n=this.i18n("file_insights_vm_progress");this.showInfo(n),this.$("input, select").attr("disabled","disabled")}},isFileServerContainer:function(e){var t=!1;return _.some(this.fileServerCollection.models,function(n){return t=n.get(r.CONTAINER_UUID)===e.get(r.CONTAINER_UUID)}),t},buildSelectOption:function(e,t,n){var i=void 0;return i=n===c.ENTITY_CONTAINER?r.CONTAINER_UUID:n===c.ENTITY_NETWORK?r.UUID:r.NAME,this.getSelectOptions(t,i,e,n)},getSelectOptions:function(e,t,n,i){var s=[],a="",o=this,r="";return _.each(e,function(e){a="",i===c.ENTITY_CONTAINER?o.isFileServerContainer(e)&&(a=o.getSelectOptionTemplate(e,t,n,i)):i===c.ENTITY_NETWORK?e.isInternal()||(a=o.getSelectOptionTemplate(e,t,n),r=o.getManagedUnmanagedFlag(e),a.name+=r):a=o.getSelectOptionTemplate(e,t,n),a&&s.push(a)}),s},getSelectOptionTemplate:function(e,t,n,i){var s="";return i===c.ENTITY_CONTAINER&&(s=e.get(r.NAME)+" ("+h.storageFormat(e.getTotalAvailableLogical())+" free)"),{name:s||e.get(r.NAME),value:e.get(t),selected:n===e.get(r.NAME)?"selected":""}},validateSaveForm:function(){var e=this.parentView.getFormValues(),t=!1,n=!1,i=this.validateAndHandleError(this.prepareFormInputElement(e.dnsNameServers,e.ntpServers)),s=this.validateFormValues(e);return i||s||(t=this.validateAvmName(e.vmName)),i||s||t||(n=this.validateNetworkIp(e)),i||s||n||t},validateFormValues:function(e){var t=!0,n=this.getConfigValues(),i="",s=null;return e&&e.vmName&&e.containerUuid&&e.networkUuid&&e.memory>=n.minimum.memory&&e.vcpu>=n.minimum.num_vcpus&&e.cores>=n.minimum.cores&&e.diskSize>=n.minimum.disk_size&&(e.networkIp&&e.netmask&&e.gateway||this.checkManagedNetwork())?t=!1:e.memory<n.minimum.memory||e.vcpu<n.minimum.num_vcpus||e.cores<n.minimum.cores||e.diskSize<n.minimum.disk_size?(e.memory<n.minimum.memory&&(s=this.i18n("formTxt.memory"),i+=this.i18ns("formTxt.minimum_fields_value",s,n.minimum.memory)),e.vcpu<n.minimum.num_vcpus&&(s=this.i18n("formTxt.vcpu_text"),i+=this.i18ns("formTxt.minimum_fields_value",s,n.minimum.num_vcpus)),e.cores<n.minimum.cores&&(s=this.i18n("formTxt.core_text"),i+=this.i18ns("formTxt.minimum_fields_value",s,n.minimum.cores)),e.diskSize<n.minimum.disk_size&&(s=this.i18n("formTxt.size"),i+=this.i18ns("formTxt.minimum_fields_value",s,n.minimum.disk_size)),this.showHeaderError(i)):(i=this.i18n("formTxt.fields_mandatory"),this.showHeaderError(i)),t},validateStorageCapacity:function(){var e=this.getSelectedContainer();if(e){var t=this.$(".diskSize").val(),n=h.convertToBytes(t,h.UOM_TIB).toFixed(2);e.getTotalAvailableLogical()>=n?this.parentView.clearHeader():this.showHeaderWarning(this.i18n("disk_size_warning"))}},getSelectedContainerName:function(e){var t="",n=this.getSelectedContainer(e);return n&&(t=n.get(r.NAME)),t},getSelectedContainer:function(e){var t=e||this.$(".storageContainer").val(),n="";return t&&(n=_.find(this.storageContainer.models,function(e){return e.get(r.CONTAINER_UUID)===t})),n},validateAvmName:function(e){var t=!1,n=this.getHypervisorType();return u.isValidVmName(e,n)||(this.showHeaderError(this.i18n("invalid_vm_name")),t=!0),t},validateNetworkIp:function(e){var t=!1;if(this.checkManagedNetwork())this.checkManagedNetwork()&&!this.ipPoolsExists&&(this.showHeaderError(this.i18n("formTxt.not_enough_address")),t=!0);else{var n="";d.isValidIP(e.networkIp)?d.isValidIP(e.netmask)?d.isValidIP(e.gateway)||(n=this.i18n("invalid_gateway")):n=this.i18n("invalid_netmask"):n=this.i18n("invalid_ip"),n&&(this.showHeaderError(n),t=!0)}return t},validateAndHandleError:function(e){var t=this,n=[],i=!1;return _.each(e,function(e){var i=t.fileInsightsModel.isValidInputs(e.value,e.description);i?(t.$("."+e.fieldName).addClass("error-class"),-1===n.indexOf(i)&&n.push(i)):t.$("."+e.fieldName).removeClass("error-class")}),n.length>0&&(this.showHeaderError(n.join("<br/>")),i=!0),i},prepareFormInputElement:function(e,t){return{dnsNameServers:this.fileInsightsModel.getFormField(e,"domain name server IP","domainNameServers"),ntpServers:this.fileInsightsModel.getFormField(t,"ntp server","ntpServers")}},onConfigKeyDown:function(e){187!==e.which&&189!==e.which&&109!==e.which&&190!==e.which||e.preventDefault()},showFetchError:function(e){var t=d.processAjaxError(e.responseText);this.showHeaderError(t)},getHypervisorType:function(){var e=null,t=m.getCurrentClusterUuid();return t&&(p.hasESX(t)?e=c.HYPERVISOR_TYPE.ESXI:p.hasKVMOnly(t)?e=c.HYPERVISOR_TYPE.KVM:p.hasNull(t)?e=c.HYPERVISOR_TYPE.NULL:p.hasHyperV(t)&&(e=c.HYPERVISOR_TYPE.HYPERV)),e},getManagedUnmanagedFlag:function(e){var t="";return p.hasKVMOnly()&&e.isManagedNetwork()?t=" - "+this.i18n("managed_text"):p.hasKVMOnly()&&!e.isManagedNetwork()&&(t=" - "+this.i18n("unmanaged_text")),t},onToggleAdvancedSettings:function(e){this.$(".advancedSettingsContainer").toggleClass("hidden"),this.triggerAction(c.MODAL.ACT.AS_REBUILD)},onNetworkChange:function(e){this.parentView.clearHeader(),this.renderNetworkConfig(e.target.value)},renderNetworkConfig:function(e){var t="";this.networkList.forEach(function(n){n.get(r.UUID)===e&&(t=n)}),this.renderNetworkInfoPerNetworkType(t)},renderNetworkInfoPerNetworkType:function(e){!p.hasESX()&&e&&e.isManagedNetwork()?(this.$(".fsNetworkDetail").removeClass("hidden").show(),this.$(".fsNetworkConfig").hide(),this.$(".ipWrapper").hide(),this.isManagedNetwork=!0,this.fetchManagedNetworkAddress(e)):(this.$(".fsNetworkConfig").show(),this.$(".ipWrapper").show(),this.$(".fsNetworkDetail").hide(),this.$(".netmask, .gateway, .ipAddress").val(""),this.isManagedNetwork=!1,this.triggerAction(c.MODAL.ACT.AS_REBUILD))},checkManagedNetwork:function(){return this.isManagedNetwork},fetchManagedNetworkAddress:function(e){var t=this;this.addressCollection=new o(null,{networkAddressId:e.get(r.UUID)}),this.addressCollection.fetch({success:function(){t.renderManagedNetworkDetails(e,t.addressCollection)},error:function(e){this.showHeaderError(this.i18n("formTxt.network_address_error")+e.responseText)}})},renderManagedNetworkDetails:function(e,t){var n=this,i=e.getIpPool();if(!i.length)return this.showHeaderError(this.i18n("formTxt.not_enough_address")),void(this.ipPoolsExists=!1);this.ipPoolsExists=!0;var s=void 0,a=_.map(i,function(e){return s=e.range.split(" "),n.i18ns("formTxt.ip_range",s[0],s[1])}),o=g({selectedVlan:e.getDisplayName(),networkPrefix:e.getNetworkAddressWithPrefix(),firstIpPool:a.join().replace(",",", "),numberOfPools:i.length-1,availableIps:"",requiredIps:1,subnetMask:"",defaultGateway:"",subnetMaskLabel:this.i18n("formTxt.subnet_mask"),gatewayLabel:this.i18n("formTxt.gateway_text"),vlanLabel:this.i18n("formTxt.vlan_id_label"),ipRangeLabel:this.i18n("formTxt.ip_range_label"),morePoolLabel:this.i18n("formTxt.more_pool_label"),NoOfIpsLabel:this.i18n("formTxt.no_of_ips_label"),usedIpLabel:this.i18ns("formTxt.used_ips",1)});this.$("#managedNetworkDetail tbody").empty(),this.$("#managedNetworkDetail tbody").append(o),this.triggerAction(c.MODAL.ACT.AS_REBUILD)}})}),define("text!templates/popups/fileserver/FileInsightsDeployFormContentView.html",[],function(){return'\x3c!-- The parent div modal is #popupDeployFileInsights --\x3e\n<div data-ntnx-content-inner>\n  <div id="subviewOptions">\n    \x3c!-- @view: FileInsightDeployOptionView goes here --\x3e\n  </div>\n\n\n  <div id="subviewVersions">\n    \x3c!-- @view: FileInsightDeploymentVersionsView goes here --\x3e\n  </div>\n\n  <div id="subviewCreate">\n    \x3c!-- @view: FileInsightDeploymentCreateView goes here --\x3e\n  </div>\n\n  <div class="fileInsightsDeploymentLoader">\n    <section data-ntnx-section>\n      <%=  CommonTemplates.LOADING_MSG({msg: i18n(\'loading\')})%>\n    </section>\n  </div>\n\n  <div class="fileInsightsDeploymentInfo" style="display:none">\n    <section data-ntnx-section="type-text"\n      class="fileInsightsDeploymentInfoSection">\n    </section>\n  </div>\n</div>\n'}),define("views/popups/fileserver/FileInsightDeployPopupView",["views/basecomponents/popups/BasePopupView","views/popups/fileserver/FileInsightDeployOptionView","views/popups/fileserver/FileInsightDeploymentVersionsView","views/popups/fileserver/FileInsightDeploymentCreateView","models/fileserver/FileInsightsModel","models/fileserver/FileInsightsCollection","models/softwareupgrade/FileServerSoftwareUpgradeModel","models/fileserver/FileServerModel","utils/AppConstants","utils/AppUtil","utils/SubViewHelper","utils/CommonTemplates","utils/FileServerUtil","data/DataProperties","text!templates/popups/fileserver/FileInsightsDeployFormContentView.html"],function(e,t,n,i,s,a,o,r,l,c,d,p,u,h,m){"use strict";m=_.template(m);var f={DEPOLY:"deploy_file_analytics",CREATE_OPTION:"create_option",DEPLOY_SINGLE:"deploy_single"};_.template('<option value="<%= value %>" <%= selected === "selected" ? "selected" : "" %> > <%= displayValue %> </option>');return e.extend({SUBVIEW_OPTIONS:"Options",SUBVIEW_VERSIONS:"Versions",SUBVIEW_CREATE:"Create",name:"FileInsightDeployPopupView",el:"#popupDeployFileInsights",model:null,fileInsightsModel:null,subViewHelper:null,activeSubView:null,previousSubview:"Options",events:{"click   .modal-header .close":"hide","click   .btnNext":"onNext","click   .n-save":"onSave","click   .btnCancel":"hide","click   .btnClose":"hide","click   .btnBack":"onBackClick"},initialize:function(t){this.subViewHelper=new d,this.model=new a,this.fileInsightsModel=new s,e.prototype.initialize.apply(this,arguments)},render:function(){var e=[{text:this.i18n("back"),extraClasses:"btnBack hide",leftAligned:!0},{text:this.i18n("cancel"),extraClasses:"btnCancel"},{text:this.i18n("close"),extraClasses:"btnClose pull-right hide",rightAligned:!0},{text:this.i18n("next"),extraClasses:"btnNext hide",rightAligned:!0,isPrimary:!0},{text:this.i18n("deploy"),extraClasses:"n-save hide",isPrimary:!0}];this.$el.html(this.defaultTemplate({title:this.i18n("deploy_file_insights"),bodyContent:m(this.vtOptions({CommonTemplates:p})),footerButtons:this.defaultFooter(e)}))},show:function(e){this.fetchFileInsightsVm(e)},getHelpLinkFAVesion:function(e){return(e=e&&e.split("-")&&e.split("-")[0])&&e.split(".").slice(0,2).join(".")},destroy:function(){this.subViewHelper.iterate("stopServices"),this.subViewHelper.destroy(),this.timeout&&(clearTimeout(this.timeout),this.timeout=null),e.prototype.destroy.apply(this,arguments)},showSubviews:function(e){var t=this.isFileInsightsVmDeployed();t?(this.showDeploymentInProgress(t),this.$(".n-save, .btnBack").hide()):this.setActiveSubView(this.SUBVIEW_OPTIONS)},setHelpLinkFaVersion:function(t){var n=new o,i=this;n.fetchSoftwareReleases().then(function(){var s=n.get(h.UPGRADE_SOFTWARE_RELEASES),a=new r,o=a.clusterManager.getCurrentClusterModel(),d=o.get(h.VERSION),p=void 0,m=s&&s.find(function(e){var t=e.get(h.UPGRADE_COMPATIBLE_NOS_VERSIONS),n=e.get(h.UPGRADE_COMPATIBLE_VERSIONS),i=e.get(h.TASK_STATUS)===l.UPGRADE_SOFTWARE_RELEASE_STATUS.COMPLETED,s=void 0;return i&&(p=e.get(h.VERSION),s=_.some(n,function(e){return 0===c.compareVersions(e,p)})),(_.some(t,function(e){return 0===c.compareVersions(e,d)})||s)&&i}),f=m&&m.get(l.FILE_SERVER_VERSION);t[l.NAV_ACTION_CONTEXT_ID]=l.DOCS_HELP_SOFTWARE_TYPE_AFS,t[l.NAV_ACTION_TARGET_VERSION]=u.getHelpLinkAfsVesion(f),e.prototype.show.call(i,t),i.showSubviews()})},showDeploymentInProgress:function(e){var t=this;this.showCloseButtonOnly(),this.$(".fileInsightsDeploymentInfo").show(),this.$(".fileInsightsDeploymentInfoSection").html(e),_.debounce(function(){t.triggerAction(l.MODAL.ACT.AS_REBUILD)},0)()},showCloseButtonOnly:function(){this.$(".btnCancel").hide(),this.$(".btnBack").hide(),this.$(".n-save").hide(),this.$(".btnClose").show()},onClickLinkAction:function(e){var t=$(e.currentTarget),n=t.attr(l.NAV_ACTION),i={};if(i[l.NAV_ACTION]=n,i[l.NAV_ACTION_TARGET_ID]=t.attr(l.NAV_ACTION_TARGET_ID),n===f.DEPOLY)this.setActiveSubView(this.SUBVIEW_VERSIONS,i);else if(n===f.CREATE_OPTION){var s=i[l.NAV_ACTION_TARGET_ID];this.fileInsightsModel.set("image_version",s),this.deployOption=l.DEPLOY_OPTION.SINGLE_NODE,this.setActiveSubView(this.SUBVIEW_CREATE,i)}else n===f.DEPLOY_SINGLE&&(this.deployOption=l.DEPLOY_OPTION.SINGLE_NODE,this.setActiveSubView(this.SUBVIEW_CREATE,i))},showSubview:function(){this.$(".subviewContent").hide(),e.prototype.showSubview.apply(this,arguments)},confirmHide:function(e){var t=this.subViewHelper.get(this.activeSubView);t&&t.confirmExit?t.confirmExit(function(){t.stopServices(),e()}):e()},setActiveSubView:function(e,t){this.previousSubview=this.subViewHelper.get(this.activeSubView),this.previousSubview&&this.previousSubview.stopServices(),this.clearHeader();var n=this.subViewHelper.get(e);n?n.refreshView(t):n=this.createSubView(e,t);var i=null,s=null,a=null;switch(e){case this.SUBVIEW_OPTIONS:_.isNull(this.activeSubView)||(i="right"),a=this.i18n("close"),this.$(".btnBack").hide(),this.$(".n-save").hide(),this.$(".btnNext").hide();break;case this.SUBVIEW_VERSIONS:i="left",this.$(".antiscroll-inner").scrollTop(0),a=this.i18n("cancel"),this.$(".btnBack").show(),this.$(".n-save").hide();break;case this.SUBVIEW_CREATE:s=this.i18n("btn_deploy"),a=this.i18n("close"),this.$(".n-save").show(),this.$(".btnBack").show();break;default:return}n.refreshView(t);var o=this.$(".n-modal-body");this.activeSubView&&o.removeClass("body-"+this.activeSubView.toLowerCase()),o.addClass("body-"+e.toLowerCase()),_.isNull(s)||this.$(".n-save").text(s),_.isNull(a)||this.$(".btnCancel").text(a),this.activeSubView=e,this.showSubview(".content"+e,i,!1),n.startServices()},createSubView:function(e,s){var a=null;switch(e){case this.SUBVIEW_OPTIONS:a=new t;break;case this.SUBVIEW_VERSIONS:a=new n;break;case this.SUBVIEW_CREATE:a=new i(s);break;default:return null}return a.setParentView(this),this.subViewHelper.register(e,a),a.render(),a},fetchFileInsightsVm:function(t){var n=this;this.model.fetch({success:function(i){var s=i.models[0];if(s){if(s.get(n.fileInsightsModel.DP.VERSION)){var a=s.get(n.fileInsightsModel.DP.VERSION);t[l.NAV_ACTION_TARGET_VERSION]=n.getHelpLinkFAVesion(a),t[l.NAV_ACTION_CONTEXT_ID]=encodeURIComponent(l.DOCS_HELP_SOFTWARE_TYPE_FA)}e.prototype.show.call(n,t),n.showSubviews()}else n.setHelpLinkFaVersion(t)},error:function(){e.prototype.show.call(n,t);var i=n.i18n("file_insights_vm_fetch");n.showHeaderError(i)}})},isFileInsightsVmDeployed:function(){this.$(".fileInsightsDeploymentLoader").hide();var e=this.model.models[0],t=null;if(e&&e.get(e.DP.IP)){var n=e.get(e.DP.IP);if(t=this.i18ns("file_insights_vm_deployed",n),e.get(e.DP.IS_DEPLOYED)){var i=e.get(e.DP.FS_LIST),s=i.filter(function(e){return e.is_active}),a=s.length;if(a){var o=c.pluralizeEntity(l.ENTITY_FILE_SERVER,a);t+=" <br>"+this.i18ns("file_insights_enabled",a,o)}else t+=" <br>"+this.i18n("file_insights_enable_hint")}else t=this.i18n("file_insights_vm_progress")}return t},onBackClick:function(){var e=null,t={};switch(this.activeSubView){case this.SUBVIEW_VERSIONS:e=this.SUBVIEW_OPTIONS;break;case this.SUBVIEW_CREATE:e=this.SUBVIEW_VERSIONS;break;default:e=this.SUBVIEW_OPTIONS}if(!_.isNull(e)){var n=this;this.confirmHide(function(){n.setActiveSubView(e,t)})}},onNext:function(){this.clearHeader(),this.setActiveSubView(this.SUBVIEW_VERSIONS)},onSave:function(){this.clearHeader();var e=this.getFormValues(),t=this.subViewHelper.get("Create");if(!t.validateSaveForm()){var n={uuid:e.networkUuid,ip:e.networkIp,netmask:e.netmask,gateway:e.gateway},i={memory:e.memory,cores:e.cores,vcpu:e.vcpu},s=t.getSelectedContainerName(e.containerUuid);this.fileInsightsModel.set("vm_name",e.vmName),this.fileInsightsModel.set("container_uuid",e.containerUuid),this.fileInsightsModel.set("container_name",s),this.fileInsightsModel.set("network",n),this.fileInsightsModel.set("resource",i),this.fileInsightsModel.set("dns_servers",e.dnsNameServers),this.fileInsightsModel.set("ntp_servers",e.ntpServers),this.fileInsightsModel.set("disk_size",e.diskSize);var a=this,o=l.ENTITY_NAMES[l.ENTITY_FILE_INSIGHTS_SERVER];this.fileInsightsModel.setEntityName(o),this.fileInsightsModel.save().success(function(e){a.hide()}).error(function(e){var t=JSON.parse(e.responseText).message;a.showHeaderError(t),a.$(".n-save").attr("disabled",!1)})}},getFormValues:function(){var e=[];e.vmName=this.$(".name").val(),e.containerUuid=this.$(".storageContainer").val(),e.networkUuid=this.$(".networkList").val(),e.networkIp=this.$(".ipAddress").val(),e.gateway=this.$(".gateway").val(),e.netmask=this.$(".netmask").val(),e.memory=this.$(".memory").val(),e.vcpu=this.$(".vcpu").val(),e.cores=this.$(".cores").val(),e.diskSize=this.$(".diskSize").val(),this.subViewHelper.get("Create").checkManagedNetwork()&&(e.networkIp="",e.gateway="",e.netmask="");var t=this.$(".domainNameServers").val().trim(),n=this.$(".ntpServers").val().trim();return t&&(t=t.split(","),t=$.map(t,$.trim)),n&&(n=n.replace(/,\s*$/,""),n=n.split(","),n=$.map(n,$.trim)),e.dnsNameServers=t,e.ntpServers=n,e}})}),define("views/popups/fileserver/FileServerSharePopupViewHelper",["views/basecomponents/BaseView","managers/NavigationManager","components/Components","utils/AppConstants"],function(e,t,n,i){"use strict";var s=_.template('<p class="deleteMsg text-left"><%= confirmForceDeleteMsg %></p><div class="n-popup-description"><%= confirmDeleteCheckbox %></div>');return e.extend({name:"FileServerSharePopupViewHelper",renderDeleteView:function(e,t,a){var o=i.ENTITY_NAMES[a];if(t.actionMode===i.ACTION_FORCE_DELETE){var r=n.checkbox({id:"confirmDelete-checkbox",labelText:this.i18ns("delete_checkbox_msg",o)}),l=s(this.vtOptions({confirmForceDeleteMsg:e,confirmDeleteCheckbox:r}));this.renderDeleteConfirmPopup("",l,t),$(".confirmDeletePopup .btnYes").addClass("disabled"),$("#confirmDelete-checkbox").on("click",function(){$(this).prop("checked")?$(".confirmDeletePopup .btnYes").removeClass("disabled"):$(".confirmDeletePopup .btnYes").addClass("disabled")})}else t.actionMode===i.ACTION_PARENT_NESTED_SHARE_DELETE?this.renderParentNestedShareDeletePopup(e,"",t):this.renderDeleteConfirmPopup(e,"",t)},renderDeleteConfirmPopup:function(e,n,s){var a=s.get(s.DP.NAME),o="";s.actionMode===i.ACTION_FORCE_DELETE?o=this.i18n("open_connections_share_delete_title"):s.isNestedShare&&(o=this.i18ns("nested_share_delete_title",'"'+a+'"')),$.nutanixConfirm({title:o,msg:e,extHTML:n,yes:function(){s.destroy({success:function(e,n){t.showDetailsSummary()}})},class:"confirmDeletePopup -compact -red-confirm",yesText:"Delete",noText:"Cancel"})},renderParentNestedShareDeletePopup:function(e,t,n){var i=n.get(n.DP.NAME),s=this.i18ns("parent_nested_share_delete_title",'"'+i+'"');$.nutanixConfirm({title:s,msg:e,extHTML:t,class:"confirmDeletePopup -compact",yesText:"Close",hideNo:!0})}})}),define("text!templates/popups/fileserver/FileServerContentView.html",[],function(){
return'<div data-ntnx-content-inner>\n  <div class="update-form-wrapper">\n    <div id="fsUpdateFormWrapper">\n      \x3c!-- @view: update form goes here... --\x3e\n    </div>\n  </div>\n\n  <div class="expand-form-wrapper">\n    <div id="fsExpandFormWrapper">\n      \x3c!-- @view: expand form goes here... --\x3e\n    </div>\n  </div>\n\n  <div class="domain-form-wrapper">\n    <div id="fsDomainFormWrapper">\n      \x3c!-- @view: domain form goes here... --\x3e\n    </div>\n  </div>\n\n  <div class="protect-form-wrapper">\n    <div id="fsPDFormWrapper">\n      \x3c!-- @view: protect domain form goes here ... --\x3e\n    </div>\n  </div>\n\n  <div class="loadbalance-form-wrapper">\n    <div id="fsLoadBalanceFormWrapper">\n      \x3c!-- @view: load balance form goes here ... --\x3e\n    </div>\n  </div>\n\n  <div class="loadbalance-form-wrapper">\n    <div id="fsDnsServerFormWrapper">\n      \x3c!-- @view: load balance form goes here ... --\x3e\n    </div>\n  </div>\n\n  <div class="scaleup-form-wrapper">\n    <div id="fsScaleUpFormWrapper">\n      \x3c!-- @view: scale up form goes here ... --\x3e\n    </div>\n  </div>\n\n  <div class="size-form-wrapper">\n    <div id="fsSizeFormWrapper">\n      \x3c!-- @view: file server form goes here ... --\x3e\n    </div>\n  </div>\n\n  <div class="size-form-wrapper">\n    <div id="fsFileBlockingFormWrapper">\n      \x3c!-- @view: file server form goes here ... --\x3e\n    </div>\n  </div>\n\n  <div class="size-form-wrapper">\n    <div id="fsDeleteWrapper">\n      \x3c!-- @view: file server delete goes here ... --\x3e\n    </div>\n  </div>\n</div>\n'}),define("text!templates/popups/fileserver/FileServerDomainFormView.html",[],function(){return'\x3c!-- FS Domain Form --\x3e\n<form class="fs-domain-form">\n  <section data-ntnx-section>\n    <h5 data-ntnx-title><%= i18n(\'ad_details\') %></h5>\n    <div data-ntnx-section="type-text">\n      <p><%= i18n(\'user_account_descrition\') %></p>\n      <p><%= i18n(\'user_account_descrition_2\') %></p>\n    </div>\n    \x3c!-- Name of realm --\x3e\n    <section data-ntnx-section>\n      <label data-ntnx-label for="realmName">\n        <%= i18n(\'domain_name\') %>\n        <span data-ntnx-label-flag><%= i18n(\'user_account_location\') %></span>\n      </label>\n      <input type="text" class="realm-name" id="realmName" value="<%=windowsAdDomainName%>"\n        placeholder="like: dom.companyname.com">\n    </section>\n  </section>\n\n  \x3c!-- Windows AD Credential --\x3e\n  <section data-ntnx-section>\n    <h5 data-ntnx-title><%= i18n(\'credentials\') %></h5>\n    <section data-ntnx-section="type-text">\n      <%= i18n(\'username_requirement_ea\') %>\n    </section>\n  </section>\n\n  \x3c!-- Windows AD username --\x3e\n  <section data-ntnx-section="type-half">\n    <label data-ntnx-label for="username"><%= i18n(\'username\') %></label>\n    <input type="text" id="username" class="username" value="<%=windowsAdUsername%>">\n  </section>\n\n  \x3c!-- Windows AD password --\x3e\n  <section data-ntnx-section="type-half">\n    <label data-ntnx-label for="password"><%= i18n(\'password\') %></label>\n    <input type="password" id="password" class="password">\n  </section>\n\n  \x3c!-- Un-join disconnect users container description --\x3e\n  <div class="unjoin-disconnect-user-description">\n  </div>\n\n  <section data-ntnx-section class="addAdmin-options-container">\n    <%= Components.checkbox({\n      jsClasses: \'addAdmin-checkbox\',\n      checked: true,\n      labelText: i18n(\'make_file_server_admin\')\n    }) %>\n    <span class="nutanixMoreInfo"\n      data-tooltip-classes="-nudge-up"\n      data-tooltip-container="body"\n      data-tooltip-title="<%= i18n(\'file_server_admin_tooltip\') %>"></span>\n  </section>\n\n  \x3c!-- Advanced Options --\x3e\n  <section data-ntnx-section class="fs-advanced-options-container">\n    <%= Components.checkbox({\n      id: \'advancedOptions\',\n      jsClasses: \'advancedOptions\'\n    }) %>\n    <label data-ntnx-inline-label for="advancedOptions">\n      <%= i18n(\'show_advanced_options\') %>\n    </label>\n\n    <div id="advanced-options-content" style="display: none;">\n      \x3c!-- Preferred Domain Controller --\x3e\n      <section data-ntnx-section>\n        <label data-ntnx-label for="preferredDomainController"><%= i18n(\'preferred_domain_controller\') %>\n          <span class="nutanixMoreInfo"\n            data-tooltip-classes="-nudge-up"\n            data-tooltip-container="body"\n            data-tooltip-title="<%= domainControlTitle %>"></span>\n        </label>\n          <input type="text" id="preferredDomainController"\n            class="preferredDomainController"\n            placeholder="like: dcname.dom.mycompanyname.com">\n      </section>\n\n      \x3c!-- Organizational Unit --\x3e\n      <section data-ntnx-section>\n        <label data-ntnx-label for="organizationalUnit"><%= i18n(\'organizational_unit\') %>\n          <span class="nutanixMoreInfo"\n            data-tooltip-classes="-nudge-up"\n            data-tooltip-container="body"\n            data-tooltip-title="<%= organizationalUnitTitle %>"></span>\n        </label>\n          <input type="text" class="organizationalUnit" id="organizationalUnit"\n            placeholder="like: CompanyOU or CompanyOU/Finance">\n      </section>\n\n      \x3c!-- Enable overwrite flag --\x3e\n      <section data-ntnx-section>\n        <label data-ntnx-label for="checkboxOverwriteAd">\n          <%= Components.checkbox({\n            id: \'checkboxOverwriteAd\',\n            jsClasses: \'checkboxOverwriteAd\'\n          }) %>\n          <%= i18n(\'overwrite_existing_afs\') %>\n          <span class="nutanixMoreInfo"\n            data-tooltip-classes="-nudge-up"\n            data-tooltip-container="body"\n            data-tooltip-title="<%= fileServerOverwriteTitle %>"></span>\n        </label>\n      </section>\n    </div>\n  </section>\n</form>'}),define("text!templates/popups/fileserver/FileServerLoadBalanceFormView.html",[],function(){return"\x3c!-- Load Balance form --\x3e\n<form id=\"fsLoadBalanceForm\" class=\"form-horizontal\">\n  \x3c!-- Load Balance Settings --\x3e\n  <section data-ntnx-section>\n    <h5 data-ntnx-title><%= i18n('performance_problems_observed') %></h5>\n  </section>\n  <section data-ntnx-section=\"type-text\">\n    <%= i18ns('extensive_load_msg', name) %>\n  </section>\n  <section data-ntnx-section=\"type-text\">\n      <%= i18n('note') %>\n  </section>\n  <section data-ntnx-section>\n    <h5 data-ntnx-title><%= i18n('available_actions') %></h5>\n  </section>\n  <% if (action === 'SCALEUP') { %>\n    <section data-ntnx-section>\n      <div data-ntnx-form-inline>\n        <%= Components.radio({\n          name     : 'action',\n          value    : 'scaleup',\n          classes  : 'action',\n          disabled : isNvmConfigAtMax,\n          checked  : true\n        })\n        %>\n        <label data-ntnx-inline-label class=\"<%= isNvmConfigAtMax ?\n          'disabled-action' : 'action-label' %>\">\n          <%= i18n('scale_up_recommendation') %>\n        </label>\n      </div>\n      <div data-ntnx-hint class=\"action-message fs-scaleup\">\n        <%= i18n('scale_up_msg') %>\n      </div>\n    </section>\n    <section data-ntnx-section>\n      <div data-ntnx-form-inline>\n        <%= Components.radio({\n          name     : 'action',\n          value    : 'rebalance',\n          classes  : 'action',\n          disabled : true\n        })\n        %>\n        <label data-ntnx-inline-label class=\"disabled-action\">\n          <%= i18n('rebalance') %>\n        </label>\n      </div>\n      <div data-ntnx-hint class=\"fs-rebalance disabled-text\">\n        <%= i18n('rebalance_msg') %>\n      </div>\n    </section>\n    <section data-ntnx-section>\n      <div data-ntnx-form-inline>\n        <%= Components.radio({\n          name     : 'action',\n          value    : 'scaleout',\n          classes  : 'action',\n          disabled : true\n        })\n        %>\n        <label data-ntnx-inline-label class=\"disabled-action\">\n          <%= i18n('scale_out') %>\n        </label>\n      </div>\n      <div data-ntnx-hint class=\"fs-scaleout disabled-text\">\n        <%= i18n('scale_out_msg') %>\n      </div>\n    </section>\n  <% } else if (action === 'SCALEOUT') { %>\n    <section data-ntnx-section>\n      <div data-ntnx-form-inline>\n        <%= Components.radio({\n          name     : 'action',\n          value    : 'scaleup',\n          classes  : 'action',\n          labelText: i18n('scale_up')\n        })\n        %>\n      </div>\n      <div data-ntnx-hint class=\"action-message\">\n        <%= i18n('scale_up_msg') %>\n      </div>\n    </section>\n    <section data-ntnx-section>\n      <div data-ntnx-form-inline>\n        <%= Components.radio({\n          name     : 'action',\n          value    : 'rebalance',\n          classes  : 'action',\n          disabled : true\n        })\n        %>\n        <label data-ntnx-inline-label class=\"disabled-action\">\n          <%= i18n('rebalance') %>\n        </label>\n      </div>\n      <div data-ntnx-hint class=\"fs-rebalance disabled-text\">\n        <%= i18n('rebalance_msg') %>\n      </div>\n    </section>\n    <section data-ntnx-section>\n      <div data-ntnx-form-inline>\n        <%= Components.radio({\n          name    : 'action',\n          value   : 'scaleout',\n          classes : 'action',\n          checked : true\n        })\n        %>\n        <label data-ntnx-inline-label>\n        <%= i18ns('scale_out_num', recommendation) %>\n        </label>\n      </div>\n      <div data-ntnx-hint class=\"action-message\">\n        <%= i18n('scale_out_msg') %>\n      </div>\n    </section>\n  <% } else if (action === 'REBALANCE') { %>\n    <section data-ntnx-section>\n      <div data-ntnx-form-inline>\n        <%= Components.radio({\n          name     : 'action',\n          value    : 'scaleup',\n          classes  : 'action',\n          labelText: i18n('scale_up')\n        })\n        %>\n      </div>\n      <div data-ntnx-hint class=\"action-message\">\n        <%= i18n('scale_up_msg') %>\n      </div>\n    </section>\n    <section data-ntnx-section>\n      <div data-ntnx-form-inline>\n        <%= Components.radio({\n          name     : 'action',\n          value    : 'rebalance',\n          classes  : 'action',\n          checked  : true,\n          labelText: i18n('rebalance_recommendation')\n        })\n        %>\n      </div>\n      <div data-ntnx-hint class=\"action-message fs-rebalance\">\n        <%= i18n('rebalance_msg') %>\n      </div>\n    </section>\n    <section data-ntnx-section>\n      <div data-ntnx-form-inline>\n        <%= Components.radio({\n          name     : 'action',\n          value    : 'scaleout',\n          classes  : 'action',\n          disabled : true\n        })\n        %>\n        <label data-ntnx-inline-label class=\"disabled-action\">\n          <%= i18n('scale_out') %>\n        </label>\n      </div>\n      <div data-ntnx-hint class=\"fs-scaleout disabled-text\">\n        <%= i18n('scale_out_msg') %>\n      </div>\n    </section>\n  <% } %>\n  <input type=\"hidden\" class=\"file-server-uuid\" value=\"<%= uuid %>\"/>\n  <input type=\"hidden\" class=\"file-server-name\" value=\"<%= name %>\"/>\n</form>"}),define("text!templates/popups/fileserver/FileServerScaleUpFormView.html",[],function(){return'<form id="fileServerScaleUp" class="form-horizontal fs-fileServerScaleUpForm">\n  <input type="hidden" class="file-server-uuid" value="<%= uuid %>"/>\n  <input type="hidden" class="file-server-name" value="<%= name %>"/>\n  <input type="hidden" class="action" value="<%= action %>"/>\n  \x3c!-- Number of vCPUs per VM --\x3e\n  <section data-ntnx-section>\n    <label class="fsNumVcpuLabel" data-ntnx-label>\n      <span class="fsVcpuConf">\n        <%= i18ns(\'number_of_vcpus\', currentCpuConf) %>\n      </span>\n      <span class="nutanixMoreInfo"\n        data-tooltip-classes="-nudge-up"\n        data-tooltip-container="body"\n        data-tooltip-title="\n        <%= currentCpuConf + \' \' + i18n(\'fs_heterogenous_state\') %>">\n      </span>\n    </label>\n      <%= Components.select({\n          jsClasses: \'fs-num-vcpu\',\n          useBrowserSelect: true,\n          type: \'default\',\n          options: vcpuNum\n        })\n      %>\n  </section>\n\n  \x3c!-- Memory per VM --\x3e\n  <section data-ntnx-section>\n    <label class="fsNumMemoryLabel" data-ntnx-label>\n      <span class="fsMemoryConf">\n        <%= i18ns(\'memory_per_fs\', currentMemoryConf) %>\n      </span>\n      <span class="nutanixMoreInfo"\n        data-tooltip-classes="-nudge-up"\n        data-tooltip-container="body"\n        data-tooltip-title="\n        <%= currentMemoryConf + \' \' + i18n(\'fs_heterogenous_state\') %>">\n      </span>\n    </label>\n    <%= Components.select({\n        jsClasses: \'fs-num-memory\',\n        useBrowserSelect: true,\n        type: \'default\',\n        options: memoryNum\n      })\n    %>\n    <div class="unit"><span class="memory-unit"><%= i18n(\'gb\') %></span></div>\n  </section>\n</form>'}),define("text!templates/popups/fileserver/FileServerUpdateView.html",[],function(){return"\x3c!-- File Server Update View --\x3e\n<form id=\"fileServerUpdate\" class=\"fs-fileServerDefineForm\">\n  <section data-ntnx-section>\n    <h5 data-ntnx-title><%= i18ns('fs_name', name) %></h5>\n  </section>\n  <section data-ntnx-section=\"type-text\">\n    \x3c!-- Name of the File Server --\x3e\n    <%= i18ns('option', name) %>\n  </section>\n  \x3c!-- File Server Size update option --\x3e\n  <section data-ntnx-section>\n    <div data-ntnx-form-inline>\n      <%= Components.radio({\n        id      :'fs-size-update',\n        name    :'updateOption',\n        classes :'fs-size-update',\n        checked : true\n      })\n      %>\n      <label data-ntnx-inline-label><%= i18n('file_server_basics') %></label>\n    </div>\n    <div data-ntnx-hint class=\"action-message\">\n      <%= i18ns('change_size', size, usedSpace) %>\n    </div>\n  </section>\n\n  \x3c!-- Number of NVMS update option --\x3e\n  <section data-ntnx-section>\n    <div data-ntnx-form-inline>\n      <%= Components.radio({\n        id      :'nvm-change',\n        name    :'updateOption',\n        classes :'action nvm-change'\n      })\n      %>\n      <label data-ntnx-inline-label>\n        <%= i18n('number_of_vms') %>\n        <% if (rebalanceNeeded && recommendation > 0) { %>\n        <%= i18ns('recommendation_no', recommendation) %>\n        <% } %>\n      </label>\n    </div>\n    <div data-ntnx-hint class=\"action-message\">\n      <%= i18n('change_the_number_of_vms') %><br/>\n      <%= i18ns('current_no', numNvms) %>\n    </div>\n  </section>\n  <section data-ntnx-section>\n    <div data-ntnx-form-inline>\n      <%= Components.radio({\n        id      :'nvm-config',\n        name    :'updateOption',\n        classes :'action nvm-config',\n        labelText: i18n('fs_vm_configuration')\n      })\n      %>\n    </div>\n    <div data-ntnx-hint class=\"action-message\">\n      <div>\n        <%= i18n('change_the_number_of_vcpus_and_memory') %>\n      </div>\n      <div>\n        <%= i18ns('current_vcpu_mem_no', vcpus, memory) %>\n      </div>\n    </div>\n  </section>\n  <section data-ntnx-section>\n    <div data-ntnx-form-inline>\n      <%= Components.radio({\n        id      :'network-config',\n        name    :'updateOption',\n        classes :'action network-config',\n        labelText: i18n('network_configuration')\n      })\n      %>\n    </div>\n    <div data-ntnx-hint class=\"action-message\">\n      <%= i18n('edit_network_configuration') %>\n    </div>\n  </section>\n</form>"}),define("text!templates/popups/fileserver/FileServerSizeFormView.html",[],function(){return'\x3c!-- File Server Name, Domain and Size Form --\x3e\n<form id="fileServerSize" class="form-horizontal fs-fileServerSizeForm">\n  <section data-ntnx-section>\n    <h5 data-ntnx-title><%= i18n(\'update_basics_title\') %><h5>\n  </section>\n\n  \x3c!-- Domain change message --\x3e\n  <% if (isSupportSpectre) { %>\n  <section data-ntnx-section="type-text">\n      <% if (domain || DNSEntries) { %>\n        <div class="alert alert-warning">\n          <% if (domain && DNSEntries) { %>\n            <%= i18n(\'leave_domain_dns_msg\') %>\n          <% } else if (domain) { %>\n            <%= i18n(\'leave_domain_msg\') %>\n          <% } else if (DNSEntries) { %>\n            <%= i18n(\'leave_dns_msg\') %>\n          <% } %>\n        </div>\n      <% } else {%>\n        <div><%= i18n(\'leave_domain_msg2\') %></div>\n      <% } %>\n    </section>\n  <% } else {%>\n    <section data-ntnx-section="type-text">\n      <% if (domain) { %>\n        <div><%= i18n(\'leave_domain_msg3\') %>\n          <a class="unjoinDomain">\n            <%= i18n(\'leave_domain\') %>\n          </a>\n        </div>\n      <% } %>\n    </section>\n  <% } %>\n  \x3c!-- File Server Name --\x3e\n  <% if (isSupportSpectre) { %>\n    <section data-ntnx-section="type-half">\n  <% } else {%>\n    <section data-ntnx-section="type-text">\n  <% } %>\n    <label data-ntnx-label>\n      <%= i18n(\'name\') %>\n    </label>\n    \x3c!-- Name to which File Server is to be updated --\x3e\n    <div class="controls">\n      <input type="text" class="file-server-name" value="<%= name %>"\n        <%= domain ? "disabled" : "" %>>\n    </div>\n  </section>\n\n  \x3c!-- File Server Domain --\x3e\n  <section data-ntnx-section="type-half" class="domainConatainer">\n    <label data-ntnx-label>\n      <%= i18n(\'domain\') %>\n    </label>\n    \x3c!-- Domain to which File Server is to be updated --\x3e\n    <div class="controls">\n      <input type="text" class="realm-name" value="<%= domain ? domain : \'\' %>"\n        <%= domain ? "disabled" : "" %>>\n    </div>\n  </section>\n\n  <section data-ntnx-section="type-text" class="domainConatainer">\n    <div><%= i18n(\'fqdn\') %> <span class="fqdn">\n      <%= name %>.<%= domain ? domain : "" %></span>\n    <div>\n  </section>\n\n  <section data-ntnx-section>\n    <label data-ntnx-label>\n      <%= i18ns(\'file_server_size\', size) %>\n    </label>\n    \x3c!-- Size to which File Server is to be updated --\x3e\n    <div class="controls">\n      <input type="text" class="file-server-size" value="<%= size %>">\n      <div class="unit"><span class="memory-unit"><%= i18n(\'tb\') %></span></div>\n    </div>\n  </section>\n</form>\n'}),define("text!templates/popups/fileserver/FileServerFileBlockingFormView.html",[],function(){return'\x3c!-- File Server File Blocking Form --\x3e\n<form id="fileServerSize" class="fs-fileServerFileBlockingForm">\n  <section data-ntnx-section="type-text">\n    <%= i18n(\'blocked_file_types_description\') %>\n  </section>\n  \x3c!-- Size to which File Server is to be updated --\x3e\n  <section data-ntnx-section>\n    <label data-ntnx-label>\n      <%= i18n(\'blocked_file_types\') %>\n    </label>\n    <input type="text" class="blockingFileTypes" value="<%= types %>"\n        data-test="fileserverfileblockingformview_input_file_blocking">\n  </section>\n  <div data-ntnx-hint>\n    <%= i18n(\'blocked_file_types_comment\') %>\n  </div>\n</form>\n'}),define("text!templates/popups/fileserver/LeaveDomainForm.html",[],function(){return'<div><%= confirmMessage %></div>\n<div class="n-popup-description"><%= desc %></div>\n\n<section data-ntnx-section="type-half">\n  <div class="controls">\n    <label data-ntnx-label>\n      <%= usernameLbl %>\n    </label>\n    <input type="text" class="username dnsDetails" value="<%= adUsername %>">\n  </div>\n</section>\n\n<section data-ntnx-section="type-half">\n  <div class="controls n-popup-description">\n    <label data-ntnx-label>\n      <%= passwordLbl %>\n    </label>\n    <input type="password" class="password dnsDetails" value="">\n  </div>\n</section>\n\n<section data-ntnx-section class="advancedOptionsContainer">\n  <%= Components.checkbox({\n    id: \'advancedOptions\',\n    jsClasses: \'toggleOptions advancedOptions\',\n    labelText: i18n(\'show_advanced_options\')\n  }) %>\n  <div class="advancedOptionsToggle" style="display: none;">\n    \x3c!-- Preferred Domain Controller --\x3e\n    <section data-ntnx-section>\n      <label data-ntnx-label for="PreferredDomainController">\n        <%= i18n(\'preferred_domain_controller\') %>\n        <span class="nutanixMoreInfo"\n          data-tooltip-classes="-nudge-up"\n          data-tooltip-container="body"\n          data-tooltip-title="\n            <%= i18n(\'preferred_domain_controller_info\') %>">\n        </span>\n      </label>\n      <input type="text" id="PreferredDomainController"\n        class="PreferredDomainController"\n        placeholder="<%= i18n(\'placeholder_domain_ctrl\') %>">\n    </section>\n  </div>\n</section>\n<section data-ntnx-section>\n  <p><%= info %></p>\n</section>'}),define("text!templates/popups/fileserver/FileServerDeleteView.html",[],function(){return"<form class=\"form-horizontal fs-fileServerDelete\">\n  <div class=\"deleteDomainContainer\">\n    <section data-ntnx-section>\n      <h5 data-ntnx-title class=\"heading\">\n        <%= i18n('del_domain_title') %>\n      </h5>\n    </section>\n    <section data-ntnx-section=\"type-text\">\n      <%= i18ns('del_domain_msg', fsName) %>\n    </section>\n    <section data-ntnx-section>\n      <%= Components.radio({\n        jsClasses: 'deleteOrRetainPd',\n        id: 'deletePd',\n        labelText: i18n('delete_pd_text')\n      }) %>\n      <%= Components.radio({\n        jsClasses: 'deleteOrRetainPd',\n        id: 'retainPd',\n        labelText: i18n('retain_pd_text')\n      }) %>\n      <span class=\"nutanixMoreInfo\"\n        data-tooltip-classes=\"-nudge-up\"\n        data-tooltip-container=\"body\"\n        data-tooltip-title=\"<%= i18n('retain_pd_tooltip') %>\"></span>\n    </section>\n  </div>\n\n  <% if (isPostSpectre || containerName) { %>\n    <section data-ntnx-section>\n      <h5 data-ntnx-title class=\"heading\">\n        <%= i18ns('fs_delete', fsName) %>\n      </h5>\n    </section>\n  <% } %>\n  \x3c!-- DNS settings --\x3e\n  <% if (isPostSpectre) { %>\n    <section data-ntnx-section=\"type-text\">\n      <%= i18n('dns_delete_msg') %> <%= dnsSettings %>\n    </section>\n  <% } %>\n  \x3c!-- Show the container name with message --\x3e\n  <% if (containerName) { %>\n    <section data-ntnx-section=\"type-text\">\n      <% if (isPostSpectre) { %>\n        <%= i18ns('confirm_delete_content_name', containerName) %>\n      <% } else { %>\n        <%= i18ns('confirm_delete_content_name_prespectre', containerName) %>\n      <% } %>\n    </section>\n  <% } %>\n</form>"}),define("views/popups/fileserver/FileServerPopupView",["views/basecomponents/BaseView","views/basecomponents/popups/BasePopupView","views/popups/fileserver/FileServerSharePopupViewHelper","managers/NotificationManager","managers/ActionManager","models/fileserver/FileServerDNSModel","models/fileserver/FileServerModel","models/fileserver/FileServerSnapshotCollection","models/storage/ContainerCollection","utils/AppConstants","utils/AppUtil","utils/StatsUtil","utils/ValidationUtil","utils/FileServerUtil","utils/CommonTemplates","components/Components","data/DataURLConstants","data/DataProperties","text!templates/popups/fileserver/FileServerContentView.html","text!templates/popups/fileserver/FileServerDomainFormView.html","text!templates/popups/fileserver/FileServerLoadBalanceFormView.html","text!templates/popups/fileserver/FileServerScaleUpFormView.html","text!templates/popups/fileserver/FileServerUpdateView.html","text!templates/popups/fileserver/FileServerSizeFormView.html","text!templates/popups/fileserver/FileServerFileBlockingFormView.html","text!templates/popups/fileserver/LeaveDomainForm.html","text!templates/popups/fileserver/FileServerDeleteView.html"],function(e,t,n,i,s,a,o,r,l,c,d,p,u,h,m,f,v,g,E,T,C,S,A,b,y,I,w){"use strict";var P=_.template('<a class="<%= className %>" <%= actionAttributes %>><%= title %></a>'),N=[4,6,8,10,12],R=[12,16,24,32,40,48,64,96],D={REALM:"windowsAdDomainName",USERNAME:"windowsAdUsername",PASSWORD:"windowsAdPassword",NUM_CALCULATED_NVMS:"numCalculatedNvms",DOMAIN_CONFIG:"domainDirectoryDTO",domainDirectoryDTO:{REALM:"windowsAdDomainName"},AD_DETAILS:"adDetails",LDAP_DETAILS:"ldapDetails",NAME_SERVICE_CONFIG:"nameServicesDTO",URI:"uri"},M={NONE:"0",NFS:"2"},O=o.extend({urlRoot:v.FILE_SERVER,entityType:c.ENTITY_FILE_SERVER,name:"FileServerUIModel",fileServerUuid:null,setFileServerUuid:function(e){this.fileServerUuid=e},getURL:function(){var e=this.url();if(this.actionMode===c.ACTION_UNJOIN_DOMAIN)e=_.template(v.FILE_SERVER_CONFIG_NAME_SERVICES,{uuid:this.fileServerUuid});else if(this.actionMode===c.ACTION_UNJOIN_DOMAIN_PRESPECTRE)e=_.template(v.FILE_SERVER_UNJOIN_DOMAIN,{uuid:this.fileServerUuid});else if(this.actionMode===c.ACTION_JOIN_DOMAIN)e=_.template(v.FILE_SERVER_JOIN_DOMAIN,{uuid:this.fileServerUuid});else if(this.actionMode===c.ACTION_UPGRADE_FILE_SERVER)e=_.template(v.FILE_SERVER_UPGRADE,{uuid:this.fileServerUuid});else if(this.actionMode===c.ACTION_REBALANCE)e=_.template(v.FILE_SERVER_REBALANCE,{uuid:this.fileServerUuid});else{if(this.actionMode===c.ACTION_FORCE_DELETE)return this.url()+"?"+g.SP_FORCE+"=true";if(this.actionMode===c.ACTION_FORCE_DELETE_DELETE_PD)return this.url()+"?"+g.SP_FORCE+"=true&"+g.DELETE_PD_AND_SNAPSHOTS+"=true";if(this.actionMode===c.ACTION_FORCE_DELETE_RETAIN_PD)return this.url()+"?"+g.SP_FORCE+"=false&"+g.DELETE_PD_AND_SNAPSHOTS+"=false"}return e}},{DP:D});return C=_.template(C),T=_.template(T),S=_.template(S),A=_.template(A),b=_.template(b),y=_.template(y),I=_.template(I),w=_.template(w),t.extend({el:"#popupFileServer",name:"FileServerPopupView",fileServerModel:null,events:{"click    .btnCancel":"hide","click    .btnClose":"hide","click    .modal-header .close":"hide","click    .userManagement, .deleteDns":"onActionPopupClick","click    .btnUnjoinDomain":"onJoinUnjoinDomain","click    .btnJoinDomain":"onJoinUnjoinDomain","click    .btnCreatePD":"onCreatePD","click    .fs-num-nvms":"onNumNvmClick","keydown  .fs-num-nvms":"onKeyDown","click    .btnLoadBalance":"onLoadBalance","click    .btnScaleUp":"onScaleUp","click    .btnContinue":"onContinue","click    .btnSaveSize":"onSaveSize","click    .btnSaveFileBlocking":"onSaveFileBlocking","click    .btnUpdateConfig":"onBtnUpdateConfig","click    .unjoinDomain":"onBtnUnjoinDomainClick","keydown  .file-server-size":"onFileServerSizeKeyDown","change   .advancedOptions":"onToggleAdvancedOptions","click    .alert .close":"onCloseInfo","blur     .file-server-name":"onBlurName","blur     .realm-name":"onBlurName","click    .deleteOrRetainPd":"onDeleteOrRetainPd"},initialize:function(e){t.prototype.initialize.apply(this,arguments),this.fileServerModel=new o},onToggleAdvancedOptions:function(e){var t=this,n=this.$("#advanced-options-content");n.slideToggle("fast",function(){t.triggerAction(c.MODAL.ACT.AS_REBUILD),n.is(":visible")&&t.scrollToElement(n,".antiscroll-inner")})},onKeyDown:function(e){e.preventDefault()},onNumNvmClick:function(e){$.trim(this.$(".fs-num-nvms").val())>this.fileServerModel.get(this.fileServerModel.DP.NVMS).length?this.$(".btnUpdate").prop("disabled",!1):this.$(".btnUpdate").prop("disabled",!0)},show:function(e){this.onAppEventOnce=!0,t.prototype.show.apply(this,arguments,!0);var n=this.actionRoute[c.NAV_ACTION];n===c.ACTION_JOIN_DOMAIN||n===c.ACTION_LOAD_BALANCE||n===c.ACTION_SCALE_UP||n===c.ACTION_UPDATE||n===c.ACTION_UPDATE_NVM_CONFIG||n===c.ACTION_UPDATE_SIZE||n===c.ACTION_UPDATE_FILE_BLOCKING?this.fetchFileServer(this.actionRoute):n===c.ACTION_DELETE||n===c.ACTION_FORCE_DELETE?this.onFileServerDelete(e):n===c.ACTION_UPGRADE_FILE_SERVER?this.onFileServerUpgrade(e):n===c.ACTION_UNJOIN_DOMAIN&&this.onFileServerUnJoin(e)},render:function(){var e,t=this.actionRoute[c.NAV_ACTION],n=[{text:this.i18n("cancel"),extraClasses:"btnCancel n-btn-form n-cancel"}];switch(t){case c.ACTION_UNJOIN_DOMAIN:e=this.i18n("leave_domain"),n.push({isPrimary:!0,text:this.i18n("leave_domain"),extraClasses:"btnUnjoinDomain"});break;case c.ACTION_JOIN_DOMAIN:e=this.i18n("join_domain"),n.push({isPrimary:!0,text:this.i18n("join_domain"),extraClasses:"btnJoinDomain"});break;case c.ACTION_LOAD_BALANCE:e=this.i18n("performance_optimization"),n.push({isPrimary:!0,text:this.i18n("continue"),extraClasses:"btnLoadBalance"});break;case c.ACTION_SCALE_UP:e=this.i18n("fs_cap_config"),n.push({isPrimary:!0,text:this.i18n("save"),extraClasses:"btnScaleUp"});break;case c.ACTION_UPDATE:e=this.i18n("update_file_server"),n.push({isPrimary:!0,text:this.i18n("continue"),extraClasses:"btnContinue"});break;case c.ACTION_UPDATE_SIZE:e=this.i18n("file_server_basics"),n.push({isPrimary:!0,text:this.i18n("save"),extraClasses:"btnSaveSize"});break;case c.ACTION_UPDATE_FILE_BLOCKING:e=this.i18n("block_file_types"),n.push({isPrimary:!0,text:this.i18n("save"),extraClasses:"btnSaveFileBlocking"});break;case c.ACTION_UPDATE_NVM_CONFIG:e=this.i18n("update_fs_cap_config"),n.push({isPrimary:!0,text:this.i18n("save"),extraClasses:"btnUpdateConfig"});break;case c.ACTION_DELETE:case c.ACTION_FORCE_DELETE:e=this.i18n("delete_file_server"),n.push({isPrimary:!0,disabled:!0,text:this.i18n("continue"),extraClasses:"btnContinue"});break;default:e="",n=[]}this.$el.html(this.defaultTemplate({title:e,bodyContent:E,footerButtons:this.defaultFooter(n)}))},fetchFileServer:function(e){var t=this;this.fileServerModel.set(this.fileServerModel.idAttribute,e.actionTargetId,{silent:!0}),this.fileServerModel.fetch({success:function(n,i){t.renderForm(n,e)},error:function(e,n){t.showHeaderError(t.i18ns("server_error_message_template",t.i18ns("fetching_file_server"))+d.processAjaxError(n.responseText))}})},renderForm:function(e,t){var n=this,i=0,s=this.fileServerModel.get(this.fileServerModel.DP.VERSION);switch(s&&(i=d.compareVersions(s,c.FILE_SERVER_VERSIONS.SPECTRE)),this.isFSSupportNFS=i>=0,t[c.NAV_ACTION]){case c.ACTION_UNJOIN_DOMAIN:this.renderUnjoinDomainForm(e);break;case c.ACTION_JOIN_DOMAIN:this.renderJoinDomainForm(e);break;case c.ACTION_LOAD_BALANCE:this.renderLoadBalanceForm(e);break;case c.ACTION_SCALE_UP:this.renderFileServerScaleUpForm(e);break;case c.ACTION_UPDATE:this.renderFileServerUpdateForm(e);break;case c.ACTION_UPDATE_SIZE:this.isFSSupportNFS?this.fetchDNSEntries(e):this.renderFileServerSizeForm(e);break;case c.ACTION_UPDATE_FILE_BLOCKING:this.renderFileServerFileBlockingForm(e);break;case c.ACTION_UPDATE_NVM_CONFIG:this.renderFileServerUpdateConfigForm(e)}_.debounce(function(){n.triggerAction(c.MODAL.ACT.AS_REBUILD),h.setHelpLinkAfsVersion(n,t,e)},0)()},fetchDNSEntries:function(e){var t=this,n=new a;n.setFileServerUuid(this.actionRoute.actionTargetId),d.showLoader(),n.fetch({success:function(n){d.hideLoader(),t.DNSEntriesNotDeleted=_.find(n.toJSON(),function(e){return e.verified}),t.renderFileServerSizeForm(e)},error:function(n,i){d.hideLoader(),t.showHeaderError(d.processAjaxError(i.responseText)),t.renderFileServerSizeForm(e)}})},renderFileServerSizeForm:function(e){var t;e.get(e.DP.DOMAIN_CONFIG)&&(t=e.get(e.DP.DOMAIN_CONFIG).windowsAdDomainName);var n=b(this.vtOptions({name:e.get(e.DP.NAME),domain:t,DNSEntries:this.DNSEntriesNotDeleted,isSupportSpectre:this.isFSSupportNFS,size:+d.formatFloat(p.convertBytesToUnit(e.get(g.USAGE_STATS)[e.DP.SIZE],p.UOM_TIB,!1))}));this.$("#fsSizeFormWrapper").html(n),this.isFSSupportNFS&&this.triggerAction(c.MODAL.ACT.AS_REBUILD),this.isFSSupportNFS?t||(this.$(".realm-name").val(e.get(e.DP.DNS_DOMAIN_NAME)),this.$(".fqdn").html(e.get(e.DP.NAME)+"."+e.get(e.DP.DNS_DOMAIN_NAME))):this.$(".domainConatainer, .update-instruction").hide()},renderFileServerFileBlockingForm:function(e){var t=e.get(e.DP.FILE_BLOCKING_EXTENSIONS),n=y(this.vtOptions({types:t&&t.join(", ")||""}));this.$("#fsFileBlockingFormWrapper").html(n)},onBtnUnjoinDomainClick:function(){
var e=this.fileServerModel,t=e.get(e.DP.DOMAIN_CONFIG).windowsAdDomainName,n=e.get(e.DP.DOMAIN_CONFIG).windowsAdUsername,i=I(this.vtOptions({confirmMessage:this.i18ns("unjoin_domain_confirm",t),desc:this.i18n("unjoin_domain_msg"),info:this.i18n("info"),usernameLbl:this.i18n("username"),passwordLbl:this.i18n("password"),adUsername:n}));$.nutanixConfirm({title:this.i18n("leave_domain"),msg:i,context:this,yes:function(){this.unjoinDomain()},no:function(){this.hide()},class:"confirmLeaveDomain -compact -red-confirm",yesText:this.i18n("leave_domain")}),this.isFSSupportNFS||$(".confirmLeaveDomain .advancedOptionsContainer").hide(),$(".confirmLeaveDomain .btnYes").addClass("disabled"),$(".confirmLeaveDomain .dnsDetails").on("keyup",this.onKeyUpInput),$(".confirmLeaveDomain .advancedOptions").on("change",this.onToggleOptions)},onToggleOptions:function(e){var t=$(e.currentTarget).is(":checked"),n=$(e.currentTarget).attr("id"),i=$(".confirmLeaveDomain ."+n+"Toggle");t?i.slideDown():i.slideUp()},onKeyUpInput:function(e){var t=$(".confirmLeaveDomain .username").val().trim(),n=$(".confirmLeaveDomain .password").val().trim();t&&n?$(".confirmLeaveDomain .btnYes").removeClass("disabled"):$(".confirmLeaveDomain .btnYes").addClass("disabled")},unjoinDomain:function(){var e=this,t=new O;if(t.setFileServerUuid(this.actionRoute.actionTargetId),t.actionMode=c.ACTION_UNJOIN_DOMAIN,t.setEntityName(this.actionRoute.actionTargetName),this.isFSSupportNFS){var n=this.fileServerModel.getUnescapedValue(this.fileServerModel.DP.NAME_SERVICE_CONFIG+"."+this.fileServerModel.DP.AD_DETAILS),i=n&&n[this.fileServerModel.DP.PROTOCOL_TYPE],s=M.NONE;i===c.FS_PROTOCOLS.NFS_SMB&&(s=M.NFS);var a=_.extend({},{windowsAdUsername:$.trim($(".confirmLeaveDomain .username").val()),windowsAdPassword:$.trim($(".confirmLeaveDomain .password").val()),protocolType:s}),o=$.trim($(".confirmLeaveDomain .PreferredDomainController").val());o&&(a.preferredDomainController=o),t.set(t.DP.AD_DETAILS,a)}else t.actionMode=c.ACTION_UNJOIN_DOMAIN_PRESPECTRE,t.set({windowsAdUsername:$.trim($(".confirmLeaveDomain .username").val()),windowsAdPassword:$.trim($(".confirmLeaveDomain .password").val())});t.save(null,{success:function(t,n){d.processSerializedObject(n)[g.TASK_UUID]&&e.hide()},error:function(t,n){e.showHeaderError(e.i18ns("server_error_message_template",e.i18ns("joining_to_domain"))+d.processAjaxError(n.responseText))}})},renderFileServerUpdateForm:function(e){var t=0;e.get(e.DP.RECOMMENDATION)&&(t=e.get(e.DP.RECOMMENDATION)[e.DP.recommendation.NUM_NVMS]+(e.get(e.DP.NVMS)?e.get(e.DP.NVMS).length:0));var n=A(this.vtOptions({name:e.get(e.DP.NAME),size:+d.formatFloat(p.convertBytesToUnit(e.get(g.USAGE_STATS)[e.DP.SIZE],p.UOM_GIB,!1)),usedSpace:+d.formatFloat(p.convertBytesToUnit(e.get(g.USAGE_STATS)[e.DP.TOTAL_SPACE_USED],p.UOM_GIB,!1)),numNvms:e.get(e.DP.NVMS)?e.get(e.DP.NVMS).length:0,model:e,noOfHosts:e.getNumberOfHost(),recommendation:t,vcpus:e.getNvmDetails(e.DP[e.DP.NVMS].NUM_VCPUS_PER_VM),memory:e.getNvmDetails(e.DP[e.DP.NVMS].MEM_PER_VM),Components:f,rebalanceNeeded:e.get(e.DP.REBALANCE_NEEDED)}));this.$("#fsUpdateFormWrapper").html(n),this.applyNutanixInput({types:["radio"]}),!e.get(e.DP.UPGRADE_IN_PROGRESS)&&e.get(e.DP.DOMAIN_CONFIG)&&e.get(e.DP.DNS_SERVER_IP_ADDRESSES)&&e.get(e.DP.NTP_SERVERS)&&e.get(e.DP.VERSION||!e.get(e.DP.NVMS)||!e.get(e.DP.PD_STATUS))||this.disableOtherUpdateOptions()},disableOtherUpdateOptions:function(){this.$(".n-radio").prop("disabled",!0),this.$("#network-config").prop("disabled",!1),this.$("#network-config").prop("checked",!0)},onContinue:function(){if(this.actionRoute.action===c.ACTION_DELETE||this.actionRoute.action===c.ACTION_FORCE_DELETE)this.showFsDeleteConfirmationPopup();else{var e={actionTarget:c.ENTITY_FILE_SERVER,actionTargetId:this.fileServerModel.get(this.fileServerModel.DP.UUID),actionTargetName:this.fileServerModel.get(this.fileServerModel.DP.NAME)};this.$("#fs-size-update").is(":checked")?e.action=c.ACTION_UPDATE_SIZE:this.$("#nvm-change").is(":checked")?e.action=c.ACTION_UPDATE_NVM:this.$("#nvm-config").is(":checked")?e.action=c.ACTION_UPDATE_NVM_CONFIG:this.$("#network-config").is(":checked")&&(e.action=c.ACTION_UPDATE_NETWORK),this.hide(),s.executeAction(e)}},showFsDeleteConfirmationPopup:function(){this.hide();var e=this.i18ns("confirm_fs_delete"),t=void 0,i=new n;this.fileServerModel.actionMode===c.ACTION_FORCE_DELETE?(t=this.i18ns("confirm_force_delete_msg",this.fileServerModel.get(this.fileServerModel.DP.NAME)),i.renderDeleteView(t,this.fileServerModel,this.actionRoute.actionTarget)):(t=this.i18n("confirm_delete_content"),i.renderDeleteConfirmPopup("",t,this.fileServerModel)),$(".confirmDeletePopup .n-title").text(e)},renderJoinDomainForm:function(e){this.renderDomainForm(e),this.$(".realm-name").prop("disabled",!1),this.applyNutanixInput({types:["checkbox"]})},renderUnjoinDomainForm:function(e){this.$el.show();var t=e.get(e.DP.NUM_CONNECTED_USERS);this.renderDomainForm(e),t>0&&this.$(".unjoin-disconnect-user-description").append(this.i18ns("unjoin_warning_msg",t)),this.$(".fs-advanced-options-container").hide(),this.$(".addAdmin-options-container").hide(),this.$(".realm-name").prop("disabled",!0)},renderDomainForm:function(e){var t=T(this.vtOptions({windowsAdDomainName:e.getDomainConfig(e.DP[e.DP.DOMAIN_CONFIG].REALM)||"",windowsAdUsername:e.getDomainConfig(e.DP[e.DP.DOMAIN_CONFIG].USERNAME)||"",domainControlTitle:this.i18n("preferred_domain_controller_info"),organizationalUnitTitle:this.i18n("organizational_unit_info"),fileServerOverwriteTitle:this.i18n("file_server_overwrite_info"),Components:f}));this.$("#fsDomainFormWrapper").html(t);var n=this.fileServerModel.get(this.fileServerModel.DP.VERSION);if(n){d.compareVersions(n,c.FILE_SERVER_VERSIONS.ASTERIX_DOT_TWO)<0&&this.$(".addAdmin-options-container").hide()}this.$(".nutanixMoreInfo").nutanixMoreInfo({parseDataAttrs:!0}),this.$(".n-tooltip-ad-credential").tooltip({title:this.i18n("ad_domain_info"),placement:"bottom",trigger:"hover",html:!0,animation:!1})},createActionLink:function(e,t,n){return this.canModifyByEntityType(t)?P({title:e,className:n,actionAttributes:d.createActionAttr(t,c.ACTION_SHOW)}):""},onActionPopupClick:function(e){var t=$(e.target),n=c.ACTION_USER_MANAGEMENT;t.hasClass("deleteDns")&&(n=c.ACTION_ADD_DNS),this.hide(),this.actionRoute.action!==c.ACTION_DELETE&&this.actionRoute.action!==c.ACTION_UPDATE_SIZE||this.renderPopupAction(n,c.ENTITY_FILE_SERVER,this.actionRoute.actionTargetId,this.actionRoute.actionTargetName)},renderPopupAction:function(e,t,n,i){var a={action:e,actionTarget:t,actionTargetId:n,actionTargetName:i};s.executeAction(a)},onSaveSize:function(){var e,t=this;if(this.fileServerModel.get(this.fileServerModel.DP.DOMAIN_CONFIG)&&(e=this.fileServerModel.get(this.fileServerModel.DP.DOMAIN_CONFIG).windowsAdDomainName),!e){var n=$.trim(this.$(".file-server-name").val()),i=$.trim(this.$(".realm-name").val()),s=this.fileServerModel.validateName(n);if(s)return void this.showHeaderError(s);if(this.fileServerModel.get(this.fileServerModel.DP.NAME)===n&&(n=null),this.$(".realm-name").removeClass("error-class"),i&&-1===i.indexOf("."))return this.$(".realm-name").addClass("error-class"),void this.showHeaderError(this.i18n("invalid_dns_msg"));this.fileServerModel.set({name:n,dnsDomainName:i})}var a=Number($.trim(this.$(".file-server-size").val())),o=p.convertBytesToGiB(this.fileServerModel.get(g.USAGE_STATS)[this.fileServerModel.DP.SIZE]);if(isNaN(a)||!u.isNumber(a))return this.$(".file-server-size").addClass("error-class"),void this.showHeaderError(this.i18n("invalid_update_fs_size_msg"));var r=p.convertBytesToUnit(p.convertToBytes(a,p.UOM_TIB,!1),p.UOM_GIB,!1);return e&&r<=o?(this.$(".file-server-size").addClass("error-class"),void this.showHeaderError(this.i18n("invalid_update_fs_size_msg"))):!e&&r<o?(this.$(".file-server-size").addClass("error-class"),void this.showHeaderError(this.i18n("invalid_update_fs_size_msg"))):(r>o&&this.fileServerModel.set(this.fileServerModel.DP.FILE_SERVER_SIZE,r),void this.fileServerModel.save(null,{success:function(e,n){d.processSerializedObject(n)[g.TASK_UUID]&&t.hide()},error:function(e,n){t.i18ns("saving_file_server_size");t.showHeaderError(t.i18ns("server_error_message_template",t.i18ns("saving_file_server_size"))+d.processAjaxError(n.responseText))}}))},onSaveFileBlocking:function(){var e=this;this.clearHeader();var t=$.trim(this.$(".blockingFileTypes").val());if(h.checkSpaceInString(t))return void this.showHeaderError(this.i18n("spaces_in_middle_msg"));if(t.indexOf(".")>-1||t.indexOf("*")>-1)return void this.showHeaderError(this.i18n("not_allowed_msg"));var n=t&&t.replace(/ /g,"").split(","),i=this.fileServerModel.get(this.fileServerModel.DP.FILE_BLOCKING_EXTENSIONS);if(!(n.length||i&&i.length))return void this.showHeaderError(this.i18n("missing_input_msg"));this.fileServerModel.set(this.fileServerModel.DP.FILE_BLOCKING_EXTENSIONS,n||[]),this.$(".btnSaveFileBlocking").prop("disabled",!0),this.fileServerModel.save(null,{success:function(t,n){d.processSerializedObject(n)[g.TASK_UUID]&&e.hide()},error:function(t,n){e.$(".btnSaveFileBlocking").prop("disabled",!1),e.showHeaderError(e.i18ns("server_error_message_template",e.i18ns("saving_file_blocking_types"))+d.processAjaxError(n.responseText))}})},onCreatePD:function(){var e=this,t=new O;t.setFileServerUuid(this.fileServerModel.get(this.fileServerModel.idAttribute)),t.setEntityName(this.fileServerModel.get(this.fileServerModel.DP.NAME)),t.actionMode=c.ACTION_CREATE_PD,t.save(null,{success:function(t,n){d.processSerializedObject(n)[g.TASK_UUID]&&e.hide()},error:function(t,n){e.showHeaderError(e.i18ns("server_error_message_template",e.i18ns("creating_pd"))+d.processAjaxError(n.responseText))}})},onJoinUnjoinDomain:function(){var e=this,t=new O,n=!1;t.setFileServerUuid(this.actionRoute.actionTargetId),t.actionMode=this.actionRoute.action,t.setEntityName(this.actionRoute.actionTargetName),this.fileServerModel.getDomainConfig(this.fileServerModel.DP[this.fileServerModel.DP.DOMAIN_CONFIG].REALM)?(t.set({windowsAdUsername:$.trim(this.$(".username").val()),windowsAdPassword:$.trim(this.$(".password").val())}),n=!0):t.set({windowsAdDomainName:$.trim(this.$(".realm-name").val()),windowsAdUsername:$.trim(this.$(".username").val()),windowsAdPassword:$.trim(this.$(".password").val()),addUserAsFsAdmin:this.$(".addAdmin-checkbox").is(":checked"),preferredDomainController:$.trim(this.$(".preferredDomainController").val()),organizationalUnit:$.trim(this.$(".organizationalUnit").val()),overwriteUserAccount:this.$(".checkboxOverwriteAd").is(":checked")});var i=this.validateAndHandleError(t,n);i?e.showHeaderError(i.errorMsg):(e.clearHeader(),t.save(null,{success:function(t,n){d.processSerializedObject(n)[g.TASK_UUID]&&e.hide()},error:function(t,n){e.actionRoute.action===c.ACTION_JOIN_DOMAIN?e.showHeaderError(e.i18ns("server_error_message_template",e.i18ns("joining_to_domain"))+d.processAjaxError(n.responseText)):e.showHeaderError(e.i18ns("server_error_message_template",e.i18ns("leaving_from_domain"))+d.processAjaxError(n.responseText))}}))},validateAndHandleError:function(e,t){var n=e.validateDomainConfig(e,t);return n?(-1!==n.errorEntity.indexOf(e.DP.REALM)?this.$(".realm-name").addClass("error-class"):this.$(".realm-name").removeClass("error-class"),-1!==n.errorEntity.indexOf(e.DP.USERNAME)?this.$(".username").addClass("error-class"):this.$(".username").removeClass("error-class"),-1!==n.errorEntity.indexOf(e.DP.PASSWORD)?this.$(".password").addClass("error-class"):this.$(".password").removeClass("error-class")):this.$(".realm-name, .username, .password").removeClass("error-class"),n},onFileServerDelete:function(e){var t=this;this.fileServerModel=new O,this.fileServerModel.set(this.fileServerModel.idAttribute,e.actionTargetId,{silent:!0}),this.$("#fsDeleteWrapper").html(m.LOADING_MSG(this.vtOptions({msg:this.i18n("loading")}))),this.fileServerModel.fetch({success:function(n,i){t.confirmDelete(n,e)},error:function(e,t){d.processAjaxError(t.responseText)}},this)},confirmDelete:function(e,t){var s=this,a=new l,o=(new n,new r);o.setPdName(e.get(e.DP.PD_NAME));var p=a.fetch({silent:!0}),u="";e.get(e.DP.PD_NAME)&&(u=o.fetch({silent:!0})),t.action===c.ACTION_FORCE_DELETE&&(e.actionMode=c.ACTION_FORCE_DELETE);var h=function(n,i){d.hideLoader();var o=a.find(function(t){return t.get(g.CONTAINER_UUID)===e.get(g.CONTAINER_UUID)}),r=o&&o.get(g.NAME),l=e.get(e.DP.NAME),p=s.createActionLink(s.i18n("dns_setting"),c.ENTITY_FILE_SERVER,"deleteDns"),u=e.getDomainConfig(e.DP[e.DP.DOMAIN_CONFIG].REALM),h=e.getValue(e.DP.NAME_SERVICE_CONFIG+"."+e.DP.LDAP_DETAILS),m=w(s.vtOptions({containerName:r,dnsSettings:p,fsName:l,isPostSpectre:s.isFSSupportNFS}));s.$("#fsDeleteWrapper").html(m),e.actionMode===c.ACTION_FORCE_DELETE?s.$(".btnContinue").prop("disabled",!1):u||h&&h[e.DP.URI]?(s.showHeaderError(s.i18n("leave_domain_del_msg")+" "+s.createActionLink(s.i18n("leave_domain"),c.ENTITY_FILE_SERVER,"userManagement")),s.$(".deleteDomainContainer").hide()):(s.$(".btnContinue").prop("disabled",!1),s.$("#retainPd").click(),i&&i[0].entities.length?(s.$(".deleteDomainContainer").show(),s.$(".nutanixMoreInfo").nutanixMoreInfo({parseDataAttrs:!0})):s.$(".deleteDomainContainer").hide()),s.renderForm(e,t)},m=function(e,t){d.hideLoader(),e===c.STATE_ERROR&&i.showClientNotification(c.NOTIFY_ERROR,s.i18n("container_fetch_failure")),t===c.STATE_ERROR&&i.showClientNotification(c.NOTIFY_ERROR,s.i18n("snapshots_fetch_failure"))};d.showLoader(),$.when(p,u).then(h,m)},onDeleteOrRetainPd:function(e){"deletePd"===$(e.currentTarget).attr("id")?(this.$("#retainPd").prop("checked",!1),this.fileServerModel.actionMode=c.ACTION_FORCE_DELETE_DELETE_PD):(this.$("#deletePd").prop("checked",!1),this.fileServerModel.actionMode=c.ACTION_FORCE_DELETE_RETAIN_PD)},onFileServerUpgrade:function(e){this.hide();var t=this,n={name:e.actionTargetName},i=this.i18ns("upgrade_warning_msg",n.name);$.nutanixConfirm({msg:i,yes:function(){var n=new O;n.actionMode=e.action,n.setFileServerUuid(e.actionTargetId),n.setEntityName(e.actionTargetName),n.save(null,{success:function(e,n){d.processSerializedObject(n)[g.TASK_UUID]&&t.hide()},error:function(e,n){var i=t.i18ns("server_error_message_template",t.i18ns("upgrading"));e.showClientNotification(c.NOTIFY_ERROR,i+d.processAjaxError(n.responseText))}})},yesText:"OK",noText:"Cancel"})},isValidInput:function(e,t){var n=!0,i=this.fileServerModel.get(this.fileServerModel.DP.DNS_SERVER_IP_ADDRESSES),s=this.fileServerModel.get(this.fileServerModel.DP.NTP_SERVERS);return _.isEmpty(e)&&_.isEmpty(t)&&(n=!1),_.isEmpty(e)||(n=this.fileServerModel.isValidIpAddressList(e,i)),_.isEmpty(t)||_.isEqual(t,s)||_.contains(t,"")||(n=!0),n},onFileServerUnJoin:function(e){this.$el.hide();var t="<p>"+this.i18n("unjoin_domain_confirm_msg_ea")+"</p><p>"+this.i18n("unjoin_domain_confirm_msg_ea_2")+"</p>";$.nutanixConfirm({msg:t,context:this,yes:function(){this.fetchFileServer(e)},no:function(){this.hide()},class:"-compact -red-confirm",yesText:"Leave Domain",noText:"Cancel"})},renderLoadBalanceForm:function(e){var t=e.get(e.DP.RECOMMENDATION)[e.DP.recommendation.NUM_NVMS]+(e.get(e.DP.NVMS)?e.get(e.DP.NVMS).length:0),n=e.getNvmDetails(e.DP[e.DP.NVMS].NUM_VCPUS_PER_VM)>=_.max(N),i=e.getNvmDetails(e.DP[e.DP.NVMS].MEM_PER_VM)>=_.max(R),s=n&&i;this.$("#fsLoadBalanceFormWrapper").html(C(this.vtOptions({name:e.get(e.DP.NAME),action:e.getRecommendationDetails(e.DP[e.DP.RECOMMENDATION].RECOMMENDATION_TYPE),uuid:e.get(e.DP.UUID),isNvmConfigAtMax:s,recommendation:t,Components:f}))),this.applyNutanixInput({types:["radio"]}),this.$(".fs-rebalance").hasClass("disabled-text")?this.$(".fs-scaleout").hasClass("disabled-text")&&this.$(".fs-scaleout").tooltip({title:this.i18n("scaleout_disabled_tooltip"),placement:"top",trigger:"hover",html:!0}):this.$(".fs-scaleout").tooltip({title:this.i18n("scaleout_2nd_choice_tooltip"),placement:"top",trigger:"hover",html:!0}),this.$(".fs-rebalance.disabled-text").tooltip({title:this.i18n("rebalance_disabled_tooltip"),placement:"top",trigger:"hover",html:!0}),this.$(".fs-scaleup.disabled-text").tooltip({title:this.i18n("scaleup_disabled_tooltip"),placement:"top",trigger:"hover",html:!0}),this.$(".fs-scaleup").hasClass("disabled-text")&&this.$(".fs-scaleout").hasClass("disabled-text")&&this.$(".fs-rebalance").hasClass("disabled-text")&&this.$(".btnSave").prop("disabled",!0)},onLoadBalance:function(){var e=$("input[name=action]:checked").val(),t=this.$(".file-server-uuid").val(),n=this.$(".file-server-name").val();if(e===c.ACTION_REBALANCE){var i=new o;i.set({uuid:t,recommendedAction:e}),i.actionMode=c.ACTION_REBALANCE,i.setEntityName(n),this.confirmRebalance(i,this.i18n("rebalance_file_server_warning_msg"),!0)}else if(e===c.ACTION_SCALE_UP){this.hide();var a={action:c.ACTION_SCALE_UP,actionTarget:c.ENTITY_FILE_SERVER,actionTargetId:this.fileServerModel.get(this.fileServerModel.DP.UUID),actionTargetName:this.fileServerModel.get(this.fileServerModel.DP.NAME)};s.executeAction(a)}else if(e===c.ACTION_SCALE_OUT){this.hide();var r={action:c.ACTION_SCALE_OUT,actionTarget:c.ENTITY_FILE_SERVER,actionTargetId:this.fileServerModel.get(this.fileServerModel.DP.UUID),actionTargetName:this.fileServerModel.get(this.fileServerModel.DP.NAME)};s.executeAction(r)}},renderFileServerScaleUpForm:function(e){this.$("#fsScaleUpFormWrapper").html(S(this.vtOptions({name:e.get(e.DP.NAME),action:e.getRecommendationDetails(e.DP[e.DP.RECOMMENDATION].RECOMMENDATION_TYPE),uuid:e.get(e.DP.UUID),currentCpuConf:e.getNvmDetails(e.DP[e.DP.NVMS].NUM_VCPUS_PER_VM),currentMemoryConf:e.getNvmDetails(e.DP[e.DP.NVMS].MEM_PER_VM),vcpuNum:this.buildSelectOption(e.getNvmDetails(e.DP[e.DP.NVMS].NUM_VCPUS_PER_VM),N,c.ACTION_SCALE_UP),memoryNum:this.buildSelectOption(e.getNvmDetails(e.DP[e.DP.NVMS].MEM_PER_VM),R,c.ACTION_SCALE_UP)})))},renderFileServerUpdateConfigForm:function(e){var t=e.getNvmDetailsForAll(e.DP[e.DP.NVMS].MEM_PER_VM),n=e.getNvmDetailsForAll(e.DP[e.DP.NVMS].NUM_VCPUS_PER_VM),i=this.getCurrentConf(t,e.DP[e.DP.NVMS].MEM_PER_VM),s=this.getCurrentConf(n,e.DP[e.DP.NVMS].NUM_VCPUS_PER_VM);if(this.$("#fsScaleUpFormWrapper").html(S(this.vtOptions({name:e.get(e.DP.NAME),action:"",uuid:e.get(e.DP.UUID),currentCpuConf:s,currentMemoryConf:i,vcpuNum:this.buildSelectOption(e.getNvmDetails(e.DP[e.DP.NVMS].NUM_VCPUS_PER_VM),N,c.ACTION_SCALE_UP),memoryNum:this.buildSelectOption(e.getNvmDetails(e.DP[e.DP.NVMS].MEM_PER_VM),R,c.ACTION_SCALE_UP)}))),n.length>1){var a=this.i18n("number_of_vcpus_heterogenous_state");this.$(".fsNumVcpuLabel .fsVcpuConf").text(a),this.$(".fsNumVcpuLabel .nutanixMoreInfo").nutanixMoreInfo({parseDataAttrs:!0,placement:"top"})}if(t.length>1){var o=this.i18n("memory_per_fs_heterogenous_state");this.$(".fsNumMemoryLabel .fsMemoryConf").text(o),this.$(".fsNumMemoryLabel .nutanixMoreInfo").nutanixMoreInfo({parseDataAttrs:!0,placement:"top"})}},getCurrentConf:function(e,t){var n="",i="",s="",a="",o="";return e.length&&(t===c.MEMORY_GIB&&(s=this.i18n("gb"),a=this.i18n("memory")),_.each(e,function(r,l){t!==c.MEMORY_GIB&&(a=d.pluralizeEntity(c.VCPU,r.val)),o=d.pluralizeEntity(c.FSVM,r.count),n=this.i18ns("fs_heterogenous_conf",r.count,o,r.val,s,a),l>0&&e.length>1&&l===e.length-1?i+=" and "+n:l>0&&e.length>1&&l!==e.length-1?i+=", "+n:1!==e.length&&0!==l||(i=n)},this)),i+="."},confirmRebalance:function(e,t,n){this.$el.hide(),$.nutanixConfirm({msg:t,yes:function(){n&&this.hide(),this.updateFileServerConfig(e)},no:function(){this.$el.show()},class:"-compact",yesText:"Continue",noText:"Cancel",context:this})},updateFileServerConfig:function(e){var t=this;e.save(null,{success:function(e,n){d.processSerializedObject(n)[g.TASK_UUID]&&t.hide()},error:function(e,n){t.$el.show();var i=t.i18ns("server_error_message_template",e.actionMode);t.showHeaderError(i+""+d.processAjaxError(n.responseText))}})},onScaleUp:function(){var e=this.$(".file-server-uuid").val(),t=this.$(".file-server-name").val(),n=parseInt(this.$(".fs-num-vcpu").val().trim(),10),i=parseInt(this.$(".fs-num-memory").val().trim(),10),s=new o;s.set({uuid:e,recommendedAction:c.ACTION_SCALE_UP,numVcpus:n,memoryGiB:i}),s.actionMode=c.ACTION_REBALANCE,s.setEntityName(t),this.confirmRebalance(s,this.i18n("rebalance_file_server_warning_msg"))},onBtnUpdateConfig:function(){var e=this.$(".file-server-uuid").val(),t=this.$(".file-server-name").val(),n=parseInt(this.$(".fs-num-vcpu").val().trim(),10),i=parseInt(this.$(".fs-num-memory").val().trim(),10),s=this.fileServerModel.getNvmDetails(this.fileServerModel.DP[this.fileServerModel.DP.NVMS].NUM_VCPUS_PER_VM),a=this.fileServerModel.getNvmDetails(this.fileServerModel.DP[this.fileServerModel.DP.NVMS].MEM_PER_VM),o=d.compareVersions(this.fileServerModel.get(this.fileServerModel.DP.VERSION),c.FILE_SERVER_VERSIONS.ASTERIX_DOT_ONE);this.fileServerModel.set({uuid:e,numVcpus:n,memoryGiB:i}),this.fileServerModel.actionMode=c.ACTION_UPDATE,this.fileServerModel.setEntityName(t),o<0||o>=0&&(i<a||n<s)?this.confirmRebalance(this.fileServerModel,this.i18n("rebalance_file_server_warning_msg")):this.updateFileServerConfig(this.fileServerModel)},buildSelectOption:function(e,t,n){var i,s=[];if(n===c.ACTION_UPDATE_NVM_CONFIG)i=e;else{var a=t.indexOf(e)+1;i=a<t.length?t[a]:e}return _.each(t,function(e){s.push({value:e,name:e,selected:e===i?"selected":""})}),s},onFileServerSizeKeyDown:function(e){187!==e.which&&189!==e.which&&109!==e.which||e.preventDefault()},destroy:function(){this.$(".fs-rebalance, .fs-scaleout, .fs-scaleup,.n-tooltip-ad-credential, .n-error-details").tooltip("destroy"),this.$(".nutanixMoreInfo").nutanixMoreInfo("destroy"),e.prototype.destroy.apply(this,arguments)},onCloseInfo:function(){var e=this;_.debounce(function(){e.triggerAction(c.MODAL.ACT.AS_REBUILD)},0)()},onBlurName:function(){var e=$.trim(this.$(".file-server-name").val()),t=$.trim(this.$(".realm-name").val());e&&t&&this.$(".fqdn").html(e+"."+t)},hide:function(e){this.$(".nutanixMoreInfo").nutanixMoreInfo("destroy"),t.prototype.hide.apply(this,arguments)}})}),define("models/fileserver/WPVScheduleModel",["models/fileserver/FileServerModel","data/DataURLConstants","utils/AppConstants"],function(e,t,n){"use strict";var i={UUID:"uuid",FS_UUID:"fsUuid"};return e.extend({urlRoot:t.WPV_SCHEDULES,entityType:n.ENTITY_WPV_SCHEDULE,name:"WPVScheduleModel",DP:i,defaults:{uuid:null,fsUuid:null},setEntityName:function(e){this.entityName=e},getURL:function(){return this.actionMode===n.ACTION_UPDATE||this.actionMode===n.ACTION_CREATE||this.actionMode===n.ACTION_FETCH?_.template(t.WPV_SCHEDULES,{fsUuid:this.get(this.DP.FS_UUID)}):this.actionMode===n.ACTION_DELETE?_.template(t.WPV_SCHEDULE,{fsUuid:this.get(this.DP.FS_UUID),scheduleId:this.get(this.DP.UUID)}):void 0}})}),define("views/popups/fileserver/WPVScheduleView",["components/Components","views/basecomponents/tableinput/TableInputView","models/fileserver/WPVScheduleModel","managers/I18nManager","utils/AppConstants","utils/AppUtil","utils/SVG"],function(e,t,n,i,s,a,o){"use strict";var r={HOURLY:"HOURLY",DAILY:"DAILY",WEEKLY:"WEEKLY",MONTHLY:"MONTHLY"},l=_.template('&nbsp;<div class="dropdown days-dropdown"><button class="day-dropdown-toggle dropdown-toggle"><span class="text"><%= selectMsg %></span>&nbsp;'+o.SVGIcon("z","-down-arrow")+'</button><ul class="dropdown-menu days-dropdown-menu" role="menu"><%= daysList %><div class="button-wrapper"><a href="#" class="btnDropdownCancel btn"><%= cancelBtnTxt %></a><a href="#" class="btnDropdownOk btn-primary btn"><%= okBtnTxt %></a></div></ul></div>'),c=_.template('<div class="header"><ul class="snapshot-stats-wrapper header-table-input"><li class="snapshot-stats-item closest-schedule"><%= i18ns("default_RPO", 0) %></li><li class="snapshot-stats-item"><%= i18n("total") %> : <span class="total-snapshots">0 <%= AppUtil.getSingularEntityName("snapshot") %></span></li></ul><% if (isNewActionEnabled) { %><div class="header-table-input"><a class="link-table-input"><%= Components.icon("plus-small") %> <%= i18n("add_schedule") %></a></div><% } %></div><table class="table table-data-items table-input <%= ebClass %>"><thead><tr><% _.each(columns, function(column) { %><th><%= column.columnName %></th><% }); %><% if (isActionEnabled) { %><th><%= i18n("column_actions") %></th><% } %></tr></thead><tbody></tbody></table>'),d='<% if (isActionEnabled) { %><td class="data-cell"><div class="action-links cell-actions"><i class="edit not-active" data-icon="F" aria-hidden="true"></i><a class="save active"><%= i18n("save") %></a><span class="action-separator"></span><i class="delete not-active" data-icon="v" aria-hidden="true"></i><a class="cancel active"><%= i18n("cancel") %></a></div></td><% } %>',p=_.template('<tr data-id="<%=data ? data.uuid : ""%>" class="scheduleRow n-table-row <%=isNew ? "edit":""%>"model-attribute="user-row" model-validate="isRowSaved"><% _.each(columns, function(column, i) { %><% if(i === 1) { %><td class="data-cell"><span class="column-data frequency-text" contenteditable="false"><%= column.renderer(data).frequencyText %></span>&nbsp;<span id="<%= column.renderer(data).daysOfWeek ? column.renderer(data).daysOfWeek : "" %>"class="column-data schedule-count" contenteditable="<%= isNew ? "true":"false"%>"><% if(column.renderer(data).snapshotPolicyType ===column.renderer(data).scheduleType.MONTHLY) { %><%= column.renderer(data).daysOfMonth %> <% } else if(column.renderer(data).snapshotPolicyType === column.renderer(data).scheduleType.WEEKLY) { %><%= column.renderer(data).weekDays %> <% } else { %><%= column.renderer(data).snapshotPolicyFrequency %> <% } %></span>&nbsp;<span class="column-data frequency-type"><%= column.renderer(data).scheduleUnit %></span></td><% } else { %><td class="data-cell"><% if(i === 0) { %><span id="<%= isNew ? "" :column.renderer(data) %>" class="column-data schedule-item"  placeholder="<%= (placeholderText) ? placeholderText : column.columnName %>"contenteditable="<%=isNew ? "true":"false"%>"><% if(!isNew) { %><%= i18n("schedule_types." + column.renderer(data) + "_TYPE") %><% } %></span><%= isNew ? scheduleTypesDropdown : "" %><% } else {%><span class="column-data snapshot-count" placeholder="<%= (placeholderText) ? placeholderText : column.columnName %>"contenteditable="<%=isNew ? "true":"false"%>"><%= isNew ? "" : column.renderer(data) %></span><% } %></td><% } %><% }); %>'+d+"</tr>"),u=_.template('<%= I18nManager.t("Common", "status.error") %> <%= action %> : ');return t.extend({name:"WPVScheduleView",idAttribute:"id",parentView:null,existingVal:null,initialize:function(e){e=_.defaults({tmplDataRow:p,tmplTable:c,ebTableStyle:!1,columns:this.getResourceTableColumns()},e),t.prototype.initialize.call(this,e),this.addExtraEvents({"click  .schedule-type":"handleScheduleTypeChange","click  .day-dropdown-toggle":"toggleDaysDropdown","click  .btnDropdownCancel":"toggleDaysDropdown","click  .btnDropdownOk":"handleDropDownOkClick"})},getScheduleTypesDropdown:function(){var t=_.map(r,function(e,t){return{attributes:'data-value="'+e+'"',name:this.getScheduleTypeName(e),class:"schedule-type"}},this);return e.dropdown({classes:"schedule-dropdown",text:this.i18n("type"),options:t,rightAlign:!1})},getWeekDaysData:function(){var e=[],t=i.t("TimeUtil","dates.days"),n=i.t("TimeUtil","dates.daysShort");return _.each(t,function(t,i){e.push({id:t,value:n[i],name:t})}),e},getDaysDropdown:function(){var t=this.getWeekDaysData(),n="";return _.each(t,function(t,i){n+=e.checkbox({id:t.id,checked:!1,jsClasses:"daysCheckbox"}),n+='<label id="'+t.value+'" for="'+t.id+'" >'+t.name+"</label>"}),l({daysList:n,selectMsg:this.i18n("select_dropdown_msg"),okBtnTxt:i.t("Common","ok"),cancelBtnTxt:i.t("Common","cancel")})},getResourceTableColumns:function(){var e=this;return[{columnName:this.i18n("type"),renderer:function(e){return e.snapshotPolicyType}},{columnName:this.i18n("column_frequency"),renderer:function(t){return e.getColumnData(t)}},{columnName:a.getPluralEntityName("snapshot"),renderer:function(e){return e.localMaxSnapshots}}]},getColumnData:function(e){var t,n={},i=[],s=this.i18n("every");if(e){switch(n=e,t=this.getScheduleTypeUnit(e.snapshotPolicyType),e.snapshotPolicyType){case r.WEEKLY:s=this.i18n("every_week_msg"),t="",i=this.getDaysByIds(e.daysOfWeek);break;case r.MONTHLY:s=this.i18n("every_month_msg"),t=""}t.length>0&&(t=a.getEntityNameFromCount(t,e.snapshotPolicyFrequency)),n.scheduleUnit=t,n.frequencyText=s,n.weekDays=i}else n.snapshotPolicyFrequency="",n.scheduleUnit="",n.frequencyText=s;return n.scheduleType=r,n},onClickEditLink:function(e){if(!this.$("tr.newSchedule").length){var n=this.$("tr.edit");n.length&&n.html(this.existingVal),t.prototype.onClickEditLink.call(this,e),this.makeRowDataEditable(e)}},onClickAddRow:function(){if(this.$(".table-data-items tbody tr:last").attr("data-id")){var e=this.$("tr.edit");e.length&&e.html(this.existingVal),this.addRow(),this.$("tr.edit").addClass("newSchedule")}else t.prototype.onClickAddRow.call(this)},updateDaysDropdown:function(e){var t=this,n=this.$(".n-checkbox-container > input");_.each(n,function(n,i){var s=$(n).attr("id");-1!==e.indexOf(t.convertDay(s))&&$(n).prop("checked",!0)});var i=this.getDaysByIds(e).toString();this.$(".day-dropdown-toggle span").text(i)},makeRowDataEditable:function(e){this.$(".table-data-items").addClass("edit");var t=$(e.currentTarget).closest("tr"),n=t.find(".schedule-count"),i=t.find("td:first"),s=i.find("span"),a=s[0].id;this.existingVal=t.html();var o=this.$(".dropdown");if(o&&o.remove(),s.after(this.getScheduleTypesDropdown()),i.find(".dropdown-toggle span").text(this.getScheduleTypeName(a)).attr("id",a),n.attr("contenteditable",!0),t.find(".snapshot-count").attr("contenteditable",!0),this.scheduleType=a,a===r.WEEKLY){t.find(".frequency-type").after(this.getDaysDropdown()),n.hide();var l=n.attr("id");this.updateDaysDropdown(l)}},handleScheduleTypeChange:function(e){var t=$(e.currentTarget),n=t.closest("tr"),i=n.find(".schedule-count"),s=n.find(".frequency-type"),a=n.find(".frequency-text"),o=t.attr("data-value").trim();n.find(".schedule-dropdown span").attr("id",o),a.text(this.i18n("every")),n.find(".snapshot-count").text(""),i.text(""),i.show();var l=this.$(".days-dropdown");switch(l&&l.remove(),s.text(this.getScheduleTypeUnit(o)),o){case r.WEEKLY:a.text(this.i18n("every_week_msg")),s.text(""),i.hide(),s.after(this.getDaysDropdown());break;case r.MONTHLY:a.text(this.i18n("every_month_msg")),s.text("")}},insertTableRow:function(e,t){e instanceof Backbone.Model&&(e=e.attributes);var n=t?this.ID_TO_BE_ADDED:e[this.idAttribute];this.$(".table-data-items tbody").append(this.tmplDataRow(this.vtOptions({isNew:t,dataId:n,data:e,scheduleTypesDropdown:this.getScheduleTypesDropdown(),columns:this.columns,isActionEnabled:this.isActionEnabled,modelAttribute:this.modelAttribute,placeholderText:this.placeholderText}))),this.removeNoDataRow()},onClickSaveLink:function(e){var t=this.validateSaveAction(e);if(t)return void this.parentView.showHeaderErrorMessage(t);var n=this.getCurrentScheduleData(e);this.saveScheduleData(n);var i=this.$("tr.newSchedule");i.length&&i.removeClass("newSchedule")},onClickDeleteLink:function(e){var t=this,n=$(e.currentTarget).closest("tr").find(".schedule-item"),i=n.text(),s="<p>"+this.i18ns("delete_confirm",i)+"</p>";$.nutanixConfirm({msg:s,yes:function(){t.deleteRow(e)},context:this})},deleteRow:function(e){var t=$(e.currentTarget).closest("tr"),n={uuid:t.attr("data-id"),scheduleType:t.find(".schedule-item").attr("id")};this.deleteSelectedSchedule(n)},saveScheduleData:function(e){var t=this,i=new n;e.uuid?(i.isNew(!1),i.actionMode=s.ACTION_UPDATE):(i.isNew(!0),i.actionMode=s.ACTION_CREATE),i.setEntityName(e.snapshotPolicyType),e.fsUuid=this.idAttribute,i.save(e,{success:function(e,n){t.parentView.fetchWpvScheduleData()},error:function(e,n){a.log("WPVExceptionPopup: Error :"+n);var i="";i=e.isNew()?t.i18n("creating"):t.i18n("updating"),t.showHeaderError(u({action:i})+a.processAjaxError(n.responseText))}})},deleteSelectedSchedule:function(e){var t=this,i=new n
;i.setEntityName(e.scheduleType),i.set(i.DP.FS_UUID,this.idAttribute),i.set(i.DP.UUID,e.uuid),i.actionMode=s.ACTION_DELETE,i.destroy({success:function(e,n){t.parentView.fetchWpvScheduleData()},error:function(e,n){t.showHeaderError(u({action:t.i18n("delete_schedule")})+a.processAjaxError(n.responseText))}})},getCurrentScheduleData:function(e){var t=$(e.currentTarget).closest("tr"),n=t.attr("data-id"),i=this.$(".schedule-dropdown span").attr("id"),s=parseInt(t.find(".schedule-count").text(),10),a=parseInt(t.find(".snapshot-count").text(),10),o=[],l=[];return i===r.WEEKLY&&(o=this.getWeekDayIds(),s=1),i===r.MONTHLY&&(l.push(s),s=1),{uuid:n,snapshotPolicyType:i,snapshotPolicyFrequency:s,localMaxSnapshots:a,daysOfWeek:o,daysOfMonth:l}},convertDay:function(e){return{Sunday:1,Monday:2,Tuesday:3,Wednesday:4,Thursday:5,Friday:6,Saturday:7}[e]},getWeekDayIds:function(){var e=this,t=[],n=this.$(".n-checkbox-container > input");return _.each(n,function(n,i){$(n).prop("checked")&&t.push(e.convertDay($(n).attr("id")))}),t},getDaysByIds:function(e){var t=this,n=e.toString(),i=[],s=this.getWeekDaysData();return _.each(s,function(e){-1!==n.indexOf(t.convertDay(e.id))&&i.push(e.value)}),i},onClickCancelLink:function(e){this.$(".table-data-items").removeClass("edit"),t.prototype.onClickCancelLink.call(this,e);var n=$(e.currentTarget).closest("tr");n.length&&this.existingVal&&n.html(this.existingVal),n.attr("data-id")||n.remove()},handleDropDownOkClick:function(e){var t=this;e.preventDefault();var n=[],i=this.$(".days-dropdown").removeClass("open"),s=i.find(".daysCheckbox");_.each(s,function(e,i){$(e).prop("checked")&&n.push(t.convertDay($(e).attr("id")))}),n.length&&this.$(".day-dropdown-toggle span").text(this.getDaysByIds(n).toString())},toggleDaysDropdown:function(e){e.preventDefault(),this.$(".days-dropdown").hasClass("open")?this.$(".days-dropdown").removeClass("open"):this.$(".days-dropdown").addClass("open")},validateSaveAction:function(e){var t=$(e.currentTarget).closest("tr"),n=t.find(".schedule-count"),i=t.find(".snapshot-count"),s=this.$(".schedule-dropdown .dropdown-toggle span"),o=t.attr("data-id"),l=n.text().trim(),c=i.text().trim(),d=s.attr("id"),p=a.toTitleCase(d);if(!d)return this.i18n("schedule_type_validation_msg");if(d===r.HOURLY||d===r.DAILY){if(isNaN(l)||0===l.length)return this.i18n("snapshots_validation_msg");if(parseInt(l,10)<1)return this.i18n("snapshots_validation_msg")}if(d===r.WEEKLY){var u=t.find(".day-dropdown-toggle span").text().trim();if(l=u,u===this.i18n("select_dropdown_msg"))return this.i18n("weekly_schedule_type_validation_msg")}if(d===r.MONTHLY){if(isNaN(l)||0===l.length)return this.i18n("monthly_snapshots_frequency_msg");if(parseInt(l,10)<1||parseInt(l)>31)return this.i18n("monthly_snapshots_frequency_msg")}return isNaN(c)||0===c.length?this.i18n("local_snapshot_validation_msg"):parseInt(c,10)<1?this.i18n("local_snapshot_validation_msg"):this.getTotalSnapshots()>50?this.i18n("snapshots_limit_msg"):this.isUniqueWpvSchedule(d,o,l)?void 0:this.i18ns("unique_schedule_type_validation_msg",p)},isUniqueWpvSchedule:function(e,t,n){return t?this.scheduleType===e||this.getScheduleStatus(e,n):this.getScheduleStatus(e,n)},getScheduleStatus:function(e,t){var n=!0,i=this.$(".scheduleRow"),s=null,a=null;return _.each(i,function(t,i){s=$(t).find(".schedule-item").attr("id"),a=$(t).find(".schedule-count").html().trim(),s&&s.indexOf(e)>-1&&(n=!1)}),n},getTotalSnapshots:function(){var e=0;return this.$(".table-data-items").find(".n-table-row").each(function(){e+=parseInt($(this).find(".snapshot-count").text().trim(),10)}),e},getRpo:function(){var e=this.$(".table-data-items");if(!(e.find(".n-table-row").length<1)){var t,n=e.find(".n-table-row:first"),i=n.find(".schedule-count").text(),s=n.find(".schedule-item").attr("id");return t=this.getScheduleTypeUnit(s),s!==r.WEEKLY&&s!==r.MONTHLY||(i=1),t=a.getEntityNameFromCount(t,parseInt(i,10)),t=i+" "+t+" "+this.i18n("rpo")}},getScheduleTypeUnit:function(e){return this.i18n("schedule_types."+e+"_UNIT")},getScheduleTypeName:function(e){return this.i18n("schedule_types."+e+"_TYPE")},arrangeScheduleInOrder:function(){var e=[],t=[],n=[],i=[],s=this.$(".table-data-items").find(".n-table-row");if(!(s.length<1)){_.each(s,function(s,a){switch($(s).find(".schedule-item").attr("id")){case r.HOURLY:t.push(s);break;case r.DAILY:e.push(s);break;case r.WEEKLY:n.push(s);break;case r.MONTHLY:i.push(s)}},this);var a=t.concat(e).concat(n).concat(i);this.$(".table-data-items").find("tbody").html(a),this.updateScheduleStats()}},updateScheduleStats:function(){var e=a.getSingularEntityName("snapshot"),t=this.getTotalSnapshots(),n=this.getRpo();e=a.getEntityNameFromCount(e,t);var i=t.toString()+" "+e;this.$(".total-snapshots").text(i),this.$(".closest-schedule").text(n),this.setMessageForMultipleScheduleType()||this.parentView.showHeaderErrorMessage(this.i18n("multiple_schedule_msg"))},setParentView:function(e){this.parentView=e},setMessageForMultipleScheduleType:function(){var e=this.$(".table-data-items").find(".n-table-row"),t=!0,n=[];if(!(e.length<1))return _.each(e,function(e,i){var s=$(e).find(".schedule-item").attr("id");-1===$.inArray(s,n)?n.push(s):t=!1},this),t}},{EDIT_COLUMN_TEMPLATE:d})}),define("models/fileserver/WPVScheduleCollection",["models/PollingCollection","models/fileserver/WPVScheduleModel","data/DataURLConstants"],function(e,t,n){"use strict";return e.extend({model:t,url:n.WPV_SCHEDULES,name:"WPVScheduleCollection",scheduleId:null,setUuid:function(e){this.fsUuid=e,this.url=_.template(n.WPV_SCHEDULES,{fsUuid:this.fsUuid})}})}),define("text!templates/popups/fileserver/FileServerProtectPopupView.html",[],function(){return'\x3c!-- The parent div modal is #popupFileServer --\x3e\n<div data-ntnx-content-inner>\n  \x3c!-- Self Service Restore --\x3e\n  <section data-ntnx-section>\n    <h5 data-ntnx-title>\n      <%= i18n(\'self_service_restore_title\') %>\n    </h5>\n    <section data-ntnx-section="type-text">\n      <%= wpvSnapshotDescription %>\n    </section>\n    <% if (shareData) { %>\n      <section data-ntnx-section>\n        <h5 data-ntnx-title>\n          <%= i18n(\'share_enabled_msg\') %>\n        </h5>\n      </section>\n      <section data-ntnx-section="type-text">\n        <%= shareData %>\n      </section>\n    <% } %>\n    <section data-ntnx-section class="wpvTableWrapper">\n      \x3c!-- WPV Schedule table view --\x3e\n    </section>\n    <section data-ntnx-section="type-text">\n      <%= i18n(\'disable_schedule_share_msg\') %>\n    </section>\n  </section>\n\n  \x3c!-- Disaster Recovery --\x3e\n  <section data-ntnx-section="type-separator">\n    <h5 data-ntnx-title>\n      <%= i18n(\'disaster_recovery_title\') %>\n    </h5>\n    <section data-ntnx-section="type-text">\n      <%= i18n(\'disaster_recovery_msg\') %>\n    </section>\n    <% if (pdName) { %>\n      <section data-ntnx-section="type-text">\n        <%= i18ns(\'create_edit_schedule_msg\', pdName) %>\n        <a class="pdName" ><%= pdName %></a>\n      </section>\n    <% } %>\n    \x3c!-- Protection Domain --\x3e\n    <section data-ntnx-section>\n      <% if (pdName) { %>\n        <div><%= i18n(\'protection_status\') %>\n          <span class="active-schedules">\n            <%= activeSchedules %>\n          </span>\n        </div>\n      <% } else { %>\n        <section data-ntnx-empty-list class="notProtected">\n          <section data-ntnx-section>\n            <h5 data-ntnx-title class="text-left">\n              <%= i18n(\'file_server_not_protected\') %>\n            </h5>\n          </section>\n          <section class="text-left" data-ntnx-section="type-text">\n            <%= i18n(\'create_pd_desc\') %>\n            <a class="learn-more">\n              <%= i18n(\'learn_more\') %>\n            </a>\n          </section>\n          \x3c!-- Create Protection Domain section --\x3e\n          <section class="pd-action-wrapper">\n            <section data-ntnx-section="type-two-third">\n              <label data-ntnx-label>\n                <%= i18n("pd_create_lbl") %>\n              </label>\n              <input type="text" class="fsPdName" value="<%= newPdName %>">\n            </section>\n            <section data-ntnx-section="type-third">\n              <%= Components.button({\n                  isPrimary   : true,\n                  text        : i18n(\'protect_fs\'),\n                  extraClasses: \'btnCreatePD\'\n                })\n              %>\n            </section>\n          </section>\n        </section>\n      <% } %>\n    </section>\n  </section>\n</div>'}),define("views/popups/fileserver/FileServerProtectPopupView",["components/Components","views/basecomponents/popups/BasePopupView","views/popups/fileserver/WPVScheduleView","managers/NavigationManager","models/fileserver/WPVScheduleCollection","models/dataprotection/PDScheduleCollection","models/fileserver/WPVScheduleModel","models/fileserver/FileServerModel","models/fileserver/ShareCollection","utils/CommonTemplates","utils/SubViewHelper","utils/AppConstants","utils/AppUtil","utils/FileServerUtil","data/DataProperties","data/DataURLConstants","text!templates/popups/fileserver/FileServerProtectPopupView.html"],function(e,t,n,i,s,a,o,r,l,c,d,p,u,h,m,f,v){"use strict";var g={TABLE_VIEW:"SnapshotTableView"},E={PD_NAME:"protectionDomainName"},T=r.extend({urlRoot:f.FILE_SERVER,entityType:p.ENTITY_FILE_SERVER,name:"FileServerUIModel",fileServerUuid:null,DP:E,setFileServerUuid:function(e){this.fileServerUuid=e},getURL:function(){return _.template(f.FILE_SERVER_PROTECT,{uuid:this.fileServerUuid,pdName:this.get(E.PD_NAME)})}},{DP:E});return v=_.template(v),t.extend({el:"#popupFileServerProtect",name:"FileServerProtectPopupView",fileServerModel:null,events:{"click    .btnClose":"hide","click    .modal-header .close":"hide","click    .btnCreatePD":"onCreatePD","click    .pdName":"navigateToProtectionDomainPage"},initialize:function(e){t.prototype.initialize.apply(this,arguments),this.fileServerModel=new r,this.subViewHelper=new d},show:function(e){u.showLoader(),t.prototype.show.call(this,e),this.fetchProtectionDomainData(e)},fetchProtectionDomainData:function(e){var t=this;this.fileServerModel.set(this.fileServerModel.idAttribute,e.actionTargetId,{silent:!0}),this.fileServerModel.fetch({success:function(e,n){t.showProtectionConfigurationView(e)},error:function(e,n){t.showHeaderError(t.i18ns("server_error_message_template",t.i18ns("fetch_fileserver_msg"))+u.processAjaxError(n.responseText))}})},showProtectionConfigurationView:function(e){var t=this,n=new a,i=e.get(e.DP.PD_NAME);n.setPDName(i),i?n.fetch({success:function(e){t.fetchShareData(e.models)},error:function(e,n){t.showHeaderError(t.i18ns("server_error_message_template",t.i18ns("fetch_pd_schedules_msg"))+u.processAjaxError(n.responseText))}}):this.fetchShareData()},fetchShareData:function(e){var t=this;u.hideLoader();var n=new l;n.setFSId(this.fileServerModel.get(this.fileServerModel.DP.UUID)),n.fetch({success:function(n,i){t.renderPopupView(e,n)},error:function(e,n){t.showHeaderError(t.i18ns("server_error_message_template",t.i18ns("fetch_share"))+u.processAjaxError(n.responseText))}})},renderPopupView:function(t,n){var i=this.fileServerModel.get(this.fileServerModel.DP.NAME),s=this.fileServerModel.get(this.fileServerModel.DP.PD_NAME),a=this.filterSharesByRestoreEnabled(n),o=void 0;t&&t.length?(o=this.i18n("active_schedule"),t.length>1&&(o=u.getPluralEntityName(this.i18n("active_schedule"))),o=t.length+" "+o+" "+e.icon("check-thick","pass-icon -small -inline")):o=this.i18n("no_schedules");var r=v(this.vtOptions({shareData:a,activeSchedules:o,wpvSnapshotDescription:this.i18n("description"),pdName:s,newPdName:""+p.PD_NAME_PREFIX+i})),l=[{text:this.i18n("close"),isPrimary:!0,extraClasses:"btnClose"}];this.$el.html(this.defaultTemplate({title:this.i18ns("protect_popup_title",i),bodyContent:r,antiscroll:!1,footerButtons:this.defaultFooter(l)})),h.setHelpLinkAfsVersion(this,this.actionRoute,this.fileServerModel),this.fetchWpvScheduleData()},filterSharesByRestoreEnabled:function(e){var t=[],n=0,i=this.fileServerModel.get(this.fileServerModel.DP.UUID);return _.each(e.models,function(e){e.get(e.DP.FILE_SERVER_UUID)===i&&(e.get(e.DP.WINDOWS_PREVIOUS_VERSION)?t.push(e.get(e.DP.NAME)):n++)}),this.renderEnabledShares(t,n)},renderEnabledShares:function(t,n){var i="";return t.length>0?n>0?i=this.renderRestoreEnabledShareMsg(t):(i=this.i18ns("all_share_self_service"),i+=e.icon("check-thick","pass-icon -small -inline icon-check")):(i=e.icon("exclamation_badge","icon-exclamation -small"),i+=this.i18n("self_service_not_enabled")),i},renderRestoreEnabledShareMsg:function(e){var t;if(e.length>3){var n=e.length-3;n>1?(t=this.i18ns("other_shares_plural",n),e.splice(3,e.length)):t=this.i18ns("other_shares_singular",n)}var i=this.i18ns("self_service_enabled",e.join(", ").toString());return t&&(i+=t),i},onCreatePD:function(){var e=this,t=this.$(".fsPdName").val().trim(),n=new T,i=this.fileServerModel.get(this.fileServerModel.DP.NAME);n.setFileServerUuid(this.fileServerModel.get(this.fileServerModel.DP.UUID)),n.set(this.fileServerModel.DP.PD_NAME,t),n.setEntityName(i),n.actionMode=p.ACTION_CREATE_PD,n.save(null,{success:function(t,n){if(u.processSerializedObject(n)[m.TASK_UUID]){var s=e.i18n("pd_creation_success_msg")+" "+i+" "+e.i18n("created_pd");e.showHeaderSuccess(s)}e.updateProtectionDomainStatus()},error:function(t,n){e.showHeaderError(e.i18ns("server_error_message_template",e.i18ns("creation_pd_msg"))+u.processAjaxError(n.responseText))}})},updateProtectionDomainStatus:function(){this.$(".notProtected").hide()},fetchWpvScheduleData:function(){var e=this;this.$(".wpvTableWrapper").html(c.LOADING_MSG(this.vtOptions({msg:this.i18n("loading")}))),this.$(".table-data-items").removeClass("edit");var t=new s,n=new o;t.setUuid(this.actionRoute.actionTargetId),n.set(n.DP.FS_UUID,this.actionRoute.actionTargetId),n.actionMode=p.ACTION_FETCH,t.fetch({success:function(t,n){e.addWpvScheduleTable(t)},error:function(t,n){e.showHeaderError(e.i18ns("server_error_message_template",e.i18ns("fetch_schedule_msg"))+u.processAjaxError(n.responseText))}})},addWpvScheduleTable:function(e){this.subViewHelper.get(g.TABLE_VIEW)&&this.subViewHelper.get(g.TABLE_VIEW).destroy();var t=new n({idAttribute:this.actionRoute.actionTargetId,entityType:p.ENTITY_WPV_SCHEDULE,disableInlineEdit:!1,ebTableStyle:!0,data:e.models,noDataText:this.i18ns("no_resource"),columns:[]});t.setParentView(this),this.subViewHelper.register(g.TABLE_VIEW,t),this.$(".wpvTableWrapper").html(t.render().el),t.arrangeScheduleInOrder()},navigateToProtectionDomainPage:function(e){this.hide();var t=$(e.currentTarget).text(),n=p.PAGE_DR,s=p.SUBPAGE_TABLE;this.actionRoute.action=p.ACTION_DETAILS,this.actionRoute.actionTargetId=t,this.actionRoute.actionTargetName=t,this.actionRoute.actionParentEntityType=p.PAGE_CLUSTER,this.actionRoute.actionTarget=p.ENTITY_ASYNC_PD,i.navigateToPage(n,s,this.actionRoute)},showHeaderErrorMessage:function(e){this.showHeaderError(e)}})}),define("text!templates/popups/fileserver/FileServerSizingContentView.html",[],function(){return'\x3c!-- The parent div modal is #popupSizingFileServer --\x3e\n<div data-ntnx-content-inner class="listContainer list-Container">\n  <form role="form" id="fsEditConfigurationPopupForm" class="form-horizontal">\n    <section data-ntnx-section="type-text" class="fsCapacity">\n      <div class="section-content">\n        <div class="fs-config-container">\n          \x3c!-- Capacity of the file server --\x3e\n          <p class="description"></p>\n          <div class="custom-configuration-default-head">\n            <%= i18n("formTxt.default_recommendation_message") %>\n          </div>\n        </div>\n\n        <div id="workloadBased"\n             class="edit-configurations workload-based">\n          <section data-ntnx-section class="configInput config-Input-container">\n            \x3c!-- Number of NVMs --\x3e\n            <div data-ntnx-section="type-half" class="half-input">\n              <label data-ntnx-label for="fs-num-connections">\n                <% if (isSupportNFS) { %>\n                  <%= i18n("formTxt.connection_txt_smb") %>\n                <% } else {%>\n                  <%= i18n("formTxt.connection_txt") %>\n                <% } %>\n              </label>\n              <div class="controls">\n                <input type="number" class="fs-num-connections"\n                  id="fs-num-connections" value="<%= connections %>">\n              </div>\n            </div>\n\n            \x3c!-- Number of vCPUs per VM --\x3e\n            <div data-ntnx-section="type-half" class="half-input">\n              <label data-ntnx-label for="fs-num-throughput">\n                <% if (isSupportNFS) { %>\n                  <%= i18n("formTxt.throughput_txt_nfs") %>\n                <% } else {%>\n                  <%= i18n("formTxt.throughput_txt") %>\n                <% } %>\n              </label>\n              <div class="controls">\n                <input type="number" class="fs-num-throughput"\n                  id="fs-num-throughput" value="<%= throughput %>">\n                <div class="unit">\n                  <span class="memory-unit">Mbps</span>\n                </div>\n              </div>\n            </div>\n          </section>\n\n          \x3c!-- Configuration list table --\x3e\n          <section data-ntnx-section class="custom-configuration-section">\n            <div class="section-text performance-factor">\n              <%= i18n("formTxt.performance_factors_message") %>\n            </div>\n            <div class="custom-configuration-recommendation"\n                 style="display: none;">\n              <div class="section-text custom-configuration-section-head">\n                <span class="managed-config">\n                  <%= i18n("formTxt.configuration") %>\n                </span>\n              </div>\n              <table class="table table-hover fs-configurationDetail">\n                <thead>\n                <tr>\n                  <th><%= i18n("formTxt.selection") %></th>\n                  <th><%= i18n("formTxt.file_server_vms") %></th>\n                  <th><%= i18n("formTxt.vcpu_per_vm") %></th>\n                  <th><%= i18n("formTxt.memory_per_vm") %></th>\n                </tr>\n                </thead>\n                <tbody>\n                \x3c!-- @view: Configuration go here... --\x3e\n                </tbody>\n              </table>\n            </div>\n          </section>\n        </div>\n\n        <div id="manualConf" class="edit-configurations edit-configurations-bottom"\n             style="display: none;">\n          \x3c!-- Number of NVMs --\x3e\n          <div class="control-group">\n            <label class="control-label">\n              <%= i18n("formTxt.num_file_server_vms") %>\n            </label>\n            <div class="controls">\n              <input type="number" class="fs-num-nvms"\n                value="<%= numNvms %>" min="<%=fsSupportThreeDotOne ? 1 : noOfHosts %>"\n                max="<%=noOfHosts%>">\n            </div>\n          </div>\n\n          <div class="config-input">\n            \x3c!-- Number of vCPUs per VM --\x3e\n            <div class="control-group">\n              <label class="control-label">\n                <%= i18n("formTxt.vcpu_per_vm") %>\n              </label>\n              <div class="controls">\n                <select class="fs-num-vcpu"\n                  data-class="fancy-select-bottom-anchor"\n                  data-test="fsNumVcpuSelect">\n                  \x3c!-- @option goes here... --\x3e\n                </select>\n              </div>\n            </div>\n            \x3c!-- Memory per VM --\x3e\n            <div class="control-group">\n              <label class="control-label">\n                <%= i18n("formTxt.memory_per_vm") %>\n              </label>\n              <div class="controls">\n                <select class="fs-num-memory"\n                  data-test="fsNumMemorySelect"\n                  data-class="fancy-select-bottom-anchor">\n                  \x3c!-- @option goes here... --\x3e\n                </select>\n                <div class="unit">\n                  <span class="memory-unit">GiB</span>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </section>\n  </form>\n</div>'}),define("views/popups/fileserver/FileServerSizingPopupView",["views/basecomponents/popups/BasePopupView","models/fileserver/FileServerModel","models/BaseModel","views/wizards/fileserver/FileServerDefinePage","data/DataProperties","utils/AppUtil","utils/AppConstants","components/Components","text!templates/popups/fileserver/FileServerSizingContentView.html","text!extras/file_server_config.json"],function(e,t,n,i,s,a,o,r,l,c){"use strict";var d=_.template('<option value= <%= value %> <%= selected === "selected" ? "selected" : "" %> > <%= displayValue %> </option>'),p=_.template("<h5 data-ntnx-title><%=config_type%></h5>"),u=_.template('<tr class="n-table-row"> <td><%= Components.radio({name    :"configOption",classes :"action",checked : checked}) %><label class="action-label"><%=selection%></label></td><td class="fs-workload-numVms"><%= numVms %></td><td class="fs-workload-numVcpus"><%= numVcpus %></td><td class="fs-workload-numMemory"><%= numMemory %> GB</td></tr>'),h=n.extend({entityType:o.ENTITY_FILE_SERVER,name:"FileServerConfigurationModel"});return l=_.template(l),e.extend({fileServerConfigURLs:null,el:"#popupSizingFileServer",name:"FileServerSizingPopupView",model:null,className:"n-fileserver-sizing-container",events:{"keydown   .fs-num-nvms":"onKeyDown","click     .n-save":"onClickSave","click     .n-cancel":"hide","click     .modal-header .close":"hide","click     .btnConfiguration":"showConfigOption","change    .config-input input":"showConfigurationList","change    .configInput input":"showConfigurationList"},initialize:function(e){this.el=e.el,this.model=new t},onKeyDown:function(e){e.preventDefault()},render:function(){var e,t,n,i,o=[{text:this.i18n("customConfiguration.config_text"),extraClasses:"pull-left btnConfiguration custom-config"},{text:this.i18n("cancel"),extraClasses:"btnCancel n-btn-form n-cancel"},{isPrimary:!0,text:this.i18n("save"),extraClasses:"n-save n-btn-form disabled"}],d=null,u=p({config_type:this.i18n("customConfiguration.config_type")});try{this.fileServerConfigURLs=JSON.parse(c)}catch(e){a.log(this.i18n("fileServerJsonParsingError")+e),this.fileServerConfigURLs=[]}var h=!1,m=this.model.clusterManager.getCurrentClusterModel().get(s.CLUSTER_NUM_NODES);this.actionRoute.fsSupportThreeDotOne&&m<3&&(h=!0);var f=[];f=h?this.fileServerConfigURLs.default.single_node:this.fileServerConfigURLs.default.multi_node,_.each(f,function(s){e=s.connections,t=s.throughput,n=s.numNvm,i=s.numCpu,d=s.memory});var v=0;v=m<=3?3:m,h&&(v=1);var g=l(this.vtOptions({isOneOrTwoNodes:h,numNvms:h?1:3,connections:e,throughput:t,numVms:n,numVcpus:i,numMemory:d,model:this.model,isSupportNFS:this.actionRoute.actionSupportNFS,noOfHosts:v,Components:r,fsSupportThreeDotOne:this.actionRoute.fsSupportThreeDotOne}));this.$el.html(this.defaultTemplate({title:this.i18n("formTxt.file_server_capacity_config"),bodyContent:g,footerButtons:this.defaultFooter(o)}));var E=this.fileServerConfigURLs.allowedValuesCpu,T=this.fileServerConfigURLs.allowedValuesMemory;this.$(".fs-num-vcpu").html(this.buildSelectOption(E[0],E)),this.$(".fs-num-memory").html(this.buildSelectOption(T[0],T)),this.applyNutanixInput({types:["select"]}),this.$(".description").html(u)},buildSelectOption:function(e,t){var n="";return _.each(t,function(t){n+=d({value:t,displayValue:t,selected:e===t?"selected":""})}),n},onClickSave:function(){this.$(".btnConfiguration").attr("class").search("custom-config")>-1?this.customConfigurationSave():this.manualConfigurationSave()},customConfigurationSave:function(){var e,t,n,s,a=[],o=$("input.n-radio:checked"),r=o.closest("tr").find("td");if(r.length){r.each(function(){a.push($(this).text().trim())});var l=a&&a[3].split(" ");s={connections:Number(this.$(".fs-num-connections").val().trim()),throughput:Number(this.$(".fs-num-throughput").val().trim())},e=a&&a[1],t=a&&a[2],n=l&&l[0]}else{var c=this.i18n("fileServerRecommendationError");this.showHeaderError(c)}if(e&&t&&n&&r.length){var d=new h;d.set({customConfiguration:s,numCalculatedNvms:e,numVcpus:t,memoryGiB:n}),this.hide();(new i).onSaveConfiguration(d)}},manualConfigurationSave:function(){var e,t,n=null;if(e=Number(this.$(".fs-num-nvms").val().trim()),t=Number(this.$(".fs-num-vcpu").val().trim()),n=Number(this.$(".fs-num-memory").val().trim()),2===e)return void this.showHeaderError(this.i18n("vm_error_msg"));if(e&&t&&n){var s=new h;s.set({customConfiguration:"",numCalculatedNvms:e,numVcpus:t,memoryGiB:n}),this.hide();(new i).onSaveConfiguration(s)}},hide:function(){e.prototype.hide.call(this),$("#wizardPopup").show()},showConfigOption:function(e){var t=$(e.currentTarget),n=t.attr("class"),i=null;if(n.search("custom-config")>-1){i=p({config_type:this.i18n("manualConfiguration.config_type")});var s=this.$(".btnConfiguration");s.html(this.i18n("manualConfiguration.config_text")),s.addClass("manual-config").removeClass("custom-config"),this.$(".description").html(i),$(".edit-configurations").hide(),$(".n-modal-alert-header").hide(),$("#manualConf").show(),$(".n-save").removeClass("disabled")}else{i=p({config_type:this.i18n("customConfiguration.config_type")});var a=this.$(".btnConfiguration");a.html(this.i18n("customConfiguration.config_text")),a.addClass("custom-config").removeClass("manual-config"),this.$(".description").html(i),$(".edit-configurations").hide(),$("#workloadBased").show();$("input.n-radio:checked").closest("tr").find("td").length?$(".n-save").removeClass("disabled"):$(".n-save").hasClass("disabled")||$(".n-save").addClass("disabled")}},showConfigurationList:function(){a.showLoader();var e,t;e=Number(this.$(".fs-num-connections").val().trim()),t=Number(this.$(".fs-num-throughput").val().trim());var n=this.$(".fs-configurationDetail > tbody");n.html("");var i=this.calculateCustomConfig(e,t);if(i.length){var s,o,l=this,c=null;_.each(i,function(e,t){0===t?(s=l.i18n("recommended"),o=!0):(s=l.i18n("alternative")+(t+1),o=!1),c=u({selection:s,numVms:e.nvm,numVcpus:e.cpu,numMemory:e.memory,checked:o,Components:r},this),n.append(c)}),$(".n-modal-alert-header").hide(),$(".custom-configuration-recommendation").show(),$(".n-save").removeClass("disabled")}else{$(".custom-configuration-recommendation").hide();var d=this.i18n("fileServerRecommendationError");this.showHeaderError(d),$(".n-save").hasClass("disabled")||$(".n-save").addClass("disabled")}$(".custom-configuration-default-head").hide(),a.hideLoader()},calculateCustomConfig:function(e,t){var n=null,i=[];return n=this.calculateConfigVal(e,t,"connections"),0===n.length&&(n=this.calculateConfigVal(e,t,"throughput")),n.sort(function(e,t){return t.nvm-e.nvm||t.cpu-e.cpu||t.memory-e.memory}),n.length&&(i.push(n.slice(0,1)[0]),n.length>2?(i.push(n.slice(-1)[0]),i.push(n.slice(0,2)[1])):2===n.length&&i.push(n.slice(0,2)[1])),i},calculateConfigVal:function(e,t,n){var i,a,o,r,l,c=[],d=this,p=null;l=this.fileServerConfigURLs.allowedValuesCpu,p=this.fileServerConfigURLs.allowedValuesMemory,i=l.slice(-1)[0],a=l.slice(0)[0],o=p.slice(-1)[0],r=p.slice(0)[0];var u=2,h=this.fileServerConfigURLs.default.multi_node,m=this.model.clusterManager.getCurrentClusterModel().get(s.CLUSTER_NUM_NODES),f=!1;return this.actionRoute.fsSupportThreeDotOne&&m<3&&(h=this.fileServerConfigURLs.default.single_node,u=0,f=!0),_.each(h,function(n){e<n.connections&&(e=n.connections),t<n.throughput&&(t=n.throughput)}),_.each(this.fileServerConfigURLs.configurations,function(s){var l,p,h,m,v=null;"connections"===n?(l=Math.round(e/s.connections),p=e/s.connections):(l=Math.round(t/s.throughput),p=t/s.throughput),h=s.numCpu,m=s.memory,l<=d.model.getNumberOfHost()&&l>u&&p*s.connections>=e&&p*s.throughput>=t&&h<i+1&&h>a-1&&m<o+1&&m>r-1&&(v={nvm:f?1:l,cpu:h,memory:m},c.push(v))}),c}})}),define("views/popups/fileserver/SharePopupView",["views/basecomponents/popups/BasePopupView","views/popups/fileserver/FileServerSharePopupViewHelper","models/fileserver/ShareModel","managers/ActionManager","utils/AppConstants","utils/AppUtil","utils/FileServerUtil"],function(e,t,n,i,s,a,o){"use strict";return e.extend({el:"#popupShare",name:"SharePopupView",show:function(t){e.prototype.show.apply(this,arguments),t[s.NAV_ACTION]===s.ACTION_DELETE||t[s.NAV_ACTION]===s.ACTION_FORCE_DELETE||t[s.NAV_ACTION]===s.ACTION_NESTED_SHARE_DELETE||t[s.NAV_ACTION]===s.ACTION_PARENT_NESTED_SHARE_DELETE?this.onShareDelete(t):t[s.NAV_ACTION]===s.ACTION_ADD_QUOTA_POLICY&&(this.hide(),i.executeAction({actionTarget:s.ENTITY_SHARE_QUOTAS,action:s.ACTION_CREATE,actionTargetId:t.actionTargetId}))},render:function(){return!0},onShareDelete:function(e){this.hide();var t=new n;t.set(t.idAttribute,e.actionTargetId,{silent:!0});var i=o.getFileServerAndShareUuidsFromPageRoute();i&&t.setUuid(i),this.confirmDelete(t,e)},confirmDelete:function(e,n){var i=n.actionTargetName,a=void 0;switch(n.action){case s.ACTION_FORCE_DELETE:a=this.i18ns("force_delete_share_msg",i);break;case s.ACTION_NESTED_SHARE_DELETE:a=this.i18ns("delete_nested_share",i);break;default:a=this.i18ns("delete_share_msg",i)}var o=n.actionTarget;if(n.action===s.ACTION_FORCE_DELETE||n.action===s.ACTION_DELETE||n.action===s.ACTION_NESTED_SHARE_DELETE){e.actionMode=n.action===s.ACTION_FORCE_DELETE?s.ACTION_FORCE_DELETE:s.ACTION_DELETE;(new t).renderDeleteView(a,e,o)}else n.action===s.ACTION_PARENT_NESTED_SHARE_DELETE&&this.getShareInfo(e,n)},getShareInfo:function(e,t){var n=this;e.fetch({success:function(e,i){t.action===s.ACTION_PARENT_NESTED_SHARE_DELETE?n.renderParentNestedShareDelete(e,t):t.action===s.ACTION_NESTED_SHARE_DELETE&&n.renderNestedShareDelete(e,t)}})},renderNestedShareDelete:function(e,n){var i=n.actionTarget,a=n.actionTargetName,o=this.i18ns("delete_nested_share",a);e.actionMode=s.ACTION_DELETE,e.isNestedShare=!0,(new t).renderDeleteView(o,e,i)},renderParentNestedShareDelete:function(e,n){var i=n.actionTarget,o=e.get(e.DP.NESTED_SHARES);e.actionMode=s.ACTION_PARENT_NESTED_SHARE_DELETE;var r=1;o&&Object.keys(o).length&&(r=Object.keys(o).length);var l=this.i18n("is");r>1&&(l=this.i18n("are"));var c=a.pluralize("SharePopupView","","","path","paths",r),d=a.pluralize("SharePopupView","","","directory","directories",r),p=a.pluralize("SharePopupView","","","share","shares",r),u=this.i18ns("delete_parent_nested_share_msg",r,c,l,d,p,c);(new t).renderDeleteView(u,e,i)}})}),define("views/popups/fileserver/FileServerAntivirusPopupView",["views/basecomponents/popups/BasePopupView","managers/NotificationManager","managers/NavigationManager","models/fileserver/ScanSettingModel","models/fileserver/ShareScanSettingModel","models/fileserver/ShareModel","components/Components","utils/AppUtil","utils/ValidationUtil","utils/CommonTemplates","utils/AppConstants","utils/FileServerUtil","text!templates/wizards/fileserver/FileServerAntivirusContent.html"],function(e,t,n,i,s,a,o,r,l,c,d,p,u){"use strict";var h=_.template(u);return e.extend({name:"FileServerAntivirusPopupView",el:"#popupAntivirus",model:null,hasOwnPolicy:!1,term:null,scanSettingModel:null,defaultScanSettingModel:null,events:{"keydown input":"onKeyDown","click   .readCheckBox":"onClickRead","click   input":"checkInput","click   .btnCancel":"hide","click   .btnClose":"hide","click   .modal-header .close":"hide","click   .btnSave":"onSave","change  .enable-checkbox":"onToggledEnableAVScanOptions","change  #advancedOptions":"onToggleAdvancedOptions"},render:function(){if(!this.isViewRendered){var e=[{text:this.i18n("cancel"),extraClasses:"btnCancel pull-left n-btn-form n-cancel"},{isPrimary:!0,text:this.i18n("save"),extraClasses:"btnSave n-btn-form"}],t=h(this.vtOptions({isAll:!1,Components:o,timeoutTitle:this.i18n("timeout_message"),
scantypeTitle:this.i18n("scan_type_message"),blockAccessTitle:this.i18n("block_access_message")}));this.$el.html(this.defaultTemplate({title:this.i18ns("title",this.actionRoute.actionTargetName),bodyContent:t,footerButtons:this.defaultFooter(e)})),this.$(".nutanixMoreInfo").nutanixMoreInfo({parseDataAttrs:!0,placement:"right"}),this.$(".btnSave").prop("disabled",!0),this.getfsUuid();var n=c.INFO({msg:this.i18n("multiprotocol_warning")});this.$(".multiprotocolInfo").html(n);var i=c.WARNING({msg:this.i18n("scan_read_warning")});this.$(".scanReadWarning").html(i),this.$(".learnWhy").addClass("addTooltip").attr("title",this.i18n("learn_why_msg")).tooltip({placement:"right"})}},getfsUuid:function(){var e=n.getCurrentPageRoute().options,t=r.parseQueryToObject(e);this.fetchScanPolicy(t.actionParentId)},fetchScanPolicy:function(e){var n=this,o=new i;o.setuuid(e),o.actionMode=d.ACTION_FETCH;var l=o.fetch({silent:!0}),c=new s,u=p.getFileServerAndShareUuidsFromPageRoute();u&&c.setUuid(u);var h=c.fetch({silent:!0}),m=new a;u&&m.setUuid(u);var f=m.fetch({silent:!0}),v=function(e,i,s){r.hideLoader(),n.defaultScanSettingModel=o;var a=o.get(o.DP.FILE_SIZE_EXCLUSION);if(a&&o.set(o.DP.FILE_SIZE_EXCLUSION,a*Math.pow(2,-20)),n.isMultiprotocol=m.get(m.DP.SECONDARY_PROTOCOL_TYPE),_.isEmpty(i[0])&&_.isEmpty(e[0]))t.showClientNotification(d.NOTIFY_ERROR,n.i18n("scan_policy_missing"));else if(_.isEmpty(i[0]))n.scanSettingModel=o,n.fillScanSettings(n.defaultScanSettingModel);else{n.scanSettingModel=c;var l=c.get(c.DP.FILE_SIZE_EXCLUSION);l&&c.set(m.DP.FILE_SIZE_EXCLUSION,l*Math.pow(2,-20)),n.hasOwnPolicy=!0,n.fillScanSettings(n.scanSettingModel)}},g=function(e,i,s){r.hideLoader(),e===d.STATE_ERROR&&t.showClientNotification(d.NOTIFY_ERROR,n.i18n("all_share_fetch_failure")),i===d.STATE_ERROR&&t.showClientNotification(d.NOTIFY_ERROR,n.i18n("share_scan_fetch_failure")),s===d.STATE_ERROR&&t.showClientNotification(d.NOTIFY_ERROR,n.i18n("share_fetch_failure")),n.hide()};r.showLoader(),$.when(l,h,f).then(v,g)},hide:function(){this.$(".learnWhy").tooltip("destroy"),this.$(".nutanixMoreInfo").nutanixMoreInfo("destroy"),e.prototype.hide.apply(this,arguments)},fillScanSettings:function(e,t){this.$(".btnSave").prop("disabled",!0);var n=!t&&e.get(e.DP.ENABLE_ANTIVIRUS),i=e.get(e.DP.SCAN_ON_READ);n||this.showEnableCover(),this.$(".enable-checkbox").prop("checked",n),this.$(".read-checkbox").prop("checked",i),this.$(".write-checkbox").prop("checked",e.get(e.DP.SCAN_ON_WRITE)),e.fileTypeExclusions?this.$(".exclude-types").val(e.get(e.DP.FILE_TYPE_EXCLUSIONS).join()):this.$(".exclude-types").val(e.get(e.DP.FILE_TYPE_EXCLUSIONS));var s=e.get(e.DP.FILE_SIZE_EXCLUSION);0!==s&&this.$(".exclude-size").val(s),n&&this.isMultiprotocol&&(this.$(".multiprotocolInfoContainer").removeClass("hidden"),i||this.$(".scanReadWarningContainer").removeClass("hidden")),this.$(".scan-timeout").val(e.get(e.DP.SCAN_TIMEOUT_INTERVAL_IN_SECS)),this.$(".blockaccess-checkbox").prop("checked",e.get(e.DP.BLOCK_ACCESS_FILE)),this.isViewRendered=!0},onClickRead:function(e){!$(e.currentTarget).is(":checked")&&this.isMultiprotocol?this.$(".scanReadWarningContainer").removeClass("hidden"):this.$(".scanReadWarningContainer").hasClass("hidden")||this.$(".scanReadWarningContainer").addClass("hidden")},onToggledEnableAVScanOptions:function(e){$(e.currentTarget).is(":checked")?(this.hideEnableCover(),this.isMultiprotocol&&(this.$(".multiprotocolInfoContainer").removeClass("hidden"),this.$(".read-checkbox").prop("checked")?this.$(".scanReadWarningContainer").hasClass("hidden")||this.$(".scanReadWarningContainer").addClass("hidden"):this.$(".scanReadWarningContainer").removeClass("hidden"))):(this.fillScanSettings(this.scanSettingModel,!0),this.checkSettings(),this.$(".multiprotocolInfoContainer").hasClass("hidden")||this.$(".multiprotocolInfoContainer").addClass("hidden"),this.$(".scanReadWarningContainer").hasClass("hidden")||this.$(".scanReadWarningContainer").addClass("hidden"))},checkInput:function(e){var t=$(e.currentTarget);this.term=t.val();var n=["enable-checkbox","write-checkbox","read-checkbox","blockaccess-checkbox"],i=$(e.currentTarget).attr("class");_.difference(n,i.split(" ")).length<n.length&&this.checkSettings()},onSave:function(){var e=this,n=this.getScanSettings(),i=new s,a=p.getFileServerAndShareUuidsFromPageRoute();a&&i.setUuid(a),i.setEntityName(this.actionRoute.actionTargetName),this.hasOwnPolicy?(i.isNew(!1),i.actionMode=d.ACTION_UPDATE):(i.isNew(!0),i.actionMode=d.ACTION_CREATE);var o=this.validateInputs(n);o?t.showClientNotification(d.NOTIFY_ERROR,o):i.save(n,{success:function(t,n){e.hide()},error:function(n,i){r.log("Error :"+r.processAjaxError(i.responseText));var s="";s=n.isNew()?e.i18n("creating"):e.i18n("updating"),t.showClientNotification(d.NOTIFY_ERROR,r.processAjaxError(i.responseText)+s)}})},getTargetId:function(){return this.actionRoute&&this.actionRoute.actionTargetId&&this.actionRoute.actionTargetId.split(":")[1]},getScanSettings:function(){var e={};e.enableAntiVirus=this.$(".enable-checkbox").is(":checked"),e.scanOnRead=this.$(".read-checkbox").is(":checked"),e.scanOnWrite=this.$(".write-checkbox").is(":checked");var t=this.$(".exclude-types").val();return t?(t=t.replace(/\s+/g,""),e.fileTypeExclusions=t.split(",")):e.fileTypeExclusions=[],e.fileSizeExclusion=this.$(".exclude-size").val(),e.scanTimeoutIntervalInSecs=this.$(".scan-timeout").val(),e.blockAccessFile=this.$(".blockaccess-checkbox").is(":checked"),e.shareUuid=this.getTargetId(),e},compareScanSettings:function(e,t){for(var n=[t.DP.ENABLE_ANTIVIRUS,t.DP.SCAN_ON_READ,t.DP.SCAN_ON_WRITE,t.DP.FILE_TYPE_EXCLUSIONS,t.DP.FILE_SIZE_EXCLUSION,t.DP.SCAN_TIMEOUT_INTERVAL_IN_SECS,t.DP.BLOCK_ACCESS_FILE],i=void 0,s=0;s<n.length;s++)if(i=t.get(n[s]),"fileTypeExclusions"===n[s]){var a=null,o=null;if(e[n[s]]&&(a=e[n[s]].sort().join()),i&&(o=i.sort().join()),(a||o)&&a!==o)return!1}else if((e[n[s]]||i)&&(i=i&&i.toString(),e[n[s]].toString()!==i))return!1;return!0},validateInputs:function(e){var t=this.i18n("invalid_input_msg");this.$(".exclude-size, .scan-timeout, .exclude-types").removeClass("input_error"),!l.isNumber(e.fileSizeExclusion,"type=integer").valid||parseInt(e.fileSizeExclusion,10)<0?(t+=this.i18n("exclude_size"),this.$(".exclude-size").addClass("input_error")):parseInt(e.fileSizeExclusion,10)>1024?(t+=this.i18n("exclude_size_limit"),this.$(".exclude-size").addClass("input_error")):e.fileSizeExclusion=parseInt(e.fileSizeExclusion,10)*Math.pow(2,20),!l.isNumber(e.scanTimeoutIntervalInSecs,"type=integer").valid||parseInt(e.scanTimeoutIntervalInSecs,10)<1||parseInt(e.scanTimeoutIntervalInSecs,10)>240?(t+=this.i18n("scan_timeout"),this.$(".scan-timeout").addClass("input_error")):e.scanTimeoutIntervalInSecs=parseInt(e.scanTimeoutIntervalInSecs,10);var n=!1;return _.each(e.fileTypeExclusions,function(e){var t=e.slice(1);!e||"."===e[0]&&/^[a-zA-Z]+$/.test(t)||(n=!0)}),n&&(t+=this.i18n("exclude_file_types"),this.$(".exclude-types").addClass("input_error")),e.scanOnRead||e.scanOnWrite||(t+=this.i18n("scan_type_msg")),t!==this.i18n("invalid_input_msg")&&t},checkSettings:function(){var e=this.getScanSettings();this.compareScanSettings(e,this.scanSettingModel)?this.$(".btnSave").prop("disabled",!0):this.$(".btnSave").prop("disabled",!1)},showEnableCover:function(){this.$(".enable-cover").show()},hideEnableCover:function(){this.$(".enable-cover").hide()},onToggleAdvancedOptions:function(e){var t=this,n=this.$(".section-content.advancedOptions");n.slideToggle("fast",function(){t.triggerAction(d.MODAL.ACT.AS_REBUILD),n.is(":visible")&&t.scrollToElement(n,".antiscroll-inner")})},onKeyDown:_.debounce(function(e){var t=$.ui.keyCode;switch(e.keyCode){case t.LEFT:case t.RIGHT:0!==$(e.currentTarget).val().length&&e.stopPropagation();break;case t.PAGE_UP:case t.PAGE_DOWN:case t.UP:case t.DOWN:case t.ENTER:case t.NUMPAD_ENTER:case t.TAB:break;case t.ESCAPE:$(e.currentTarget).val(this.term);break;default:clearTimeout(this.changing);var n=this;this.changing=setTimeout(function(){var t=$(e.currentTarget),i=t.val();n.term!==i&&(n.checkSettings(),n.term=i)},200)}},100)})}),define("text!templates/popups/fileserver/QuotaPopupView.html",[],function(){return'\x3c!-- The parent div modal is #popupFileServer --\x3e\n<div class="modal-header">\n  <button type="button" class="close" data-dismiss="modal">\n    <i data-icon="K" aria-hidden="true"></i>\n  </button>\n  <h4 class="n-title"></h4>\n</div>\n\n\x3c!-- File Server Form --\x3e\n<div class="n-modal-wrapper">\n  <div class="n-modal-body">\n    <div class="n-modal-content-wrapper">\n      <div class="n-modal-alert-header">\n      </div>\n\n      <div class="n-modal-content default-quota-form-wrapper">\n        <div id="fsDefaultQuotaFormWrapper">\n          \x3c!-- @view: update form goes here... --\x3e\n        </div>\n      </div>\n\n      <div class="n-modal-content quota-exception-form-wrapper">\n        <div id="fsQuotaExceptionFormWrapper">\n          \x3c!-- @view: expand form goes here... --\x3e\n        </div>\n      </div>\n    </div>\n  </div>\n  <div class="n-modal-footer">\n    <button class="btnCancel btn n-btn-form">\n      Cancel\n    </button>\n    <button class="btnSave btn n-btn-form" style="display:none;">\n    </button>\n    <button class="btnClose btn n-btn-form" style="display:none;">\n      Close\n    </button>\n  </div>\n</div>'}),define("text!templates/popups/fileserver/DefaultQuotaPopupView.html",[],function(){return'<form id="quotaException" class="form-horizontal fs-QuotaPolicyForm">\n  <section class="quotaDetails-config">\n    <div class="section-header">Default Quota Policy</div>\n    <div class="section-content">\n\n      <div class="fs-quota-description-container">\n        \x3c!-- Capacity of the file server --\x3e\n        <div class="control-group">\n          <div class="n-inline-description">\n            Set a default quota policy for all users.\n          </div>\n        </div>\n      </div>\n\n      <div id="quota-size-container">\n        <div class="control-group">\n          <label class="control-label">Quota</label>\n          <div class="controls">\n            <input type="number" class="quota-size" value="<%= quotaSize %>"\n              placeholder="No quota limit"/>\n            <div class="unit">\n              <span class="quota-unit">GiB</span>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      \x3c!-- Enforcement type container --\x3e\n      <div id="hard-quota-enforcement-type-container">\n        <div class="control-group">\n          <label class="control-label">Enforcement Type</label>\n          <div class="controls">\n            <div class="enforcement-type">\n              <input type=\'radio\' name=\'enforcementType\'\n                class=\'hard-limit\' value=\'Hard\'>\n              <div class="radio-label">Hard Limit</div>\n            </div>\n            <div class="n-inline-description description">\n              User will be put in read only mode and will receive email\n              notification daily until remediation.\n            </div>\n          </div>\n        </div>\n      </div>\n\n      \x3c!-- Soft quota enforcement description--\x3e\n      <div id="soft-quota-enforcement-type-container">\n        <div class="control-group">\n          <div class="controls">\n            <div class="enforcement-type">\n              <input type=\'radio\' name=\'enforcementType\'\n                class=\'soft-limit\' value=\'Soft\'>\n              <div class="radio-label">Soft Limit</div>\n            </div>\n            <div class="n-inline-description description">\n              User will receive daily email notification but will not be put\n              in read only mode.\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  </section>\n\n  <section class="quotaEmailDetails-config">\n    <div class="section-header">Alert Emails</div>\n    <div class="section-content">\n\n      <div class="alert-email-container">\n        \x3c!-- Quota alerts description --\x3e\n        <div class="control-group">\n          <div class="n-inline-description">\n            Quota alert emails are sent at 90% and 100% of quota limit.\n          </div>\n        </div>\n      </div>\n\n      \x3c!-- Quota email --\x3e\n      <div id="quota-email-recipients-container">\n        \x3c!-- Quota email notification checkbox --\x3e\n        <div class="control-group">\n          <div class="controls">\n            <input class="notification-checkbox" type="checkbox">\n            <div class="checkbox-label n-inline-description">\n              Send email notification to user\n            </div>\n          </div>\n        </div>\n\n        \x3c!-- Additional email notification --\x3e\n        <div class="control-group">\n          <label class="control-label">Additional Email Recipients</label>\n          <div class="controls">\n            <input type="text" class="notification-recipients"\n              value="<%= recipients %>"\n              placeholder="Comma separated email addresses of any additional recipients such as admins"/>\n          </div>\n        </div>\n      </div>\n    </div>\n  </section>\n</form>'}),define("text!templates/popups/fileserver/QuotaExceptionPopupView.html",[],function(){return'<form id="quotaException" class="form-horizontal fs-QuotaPolicyForm">\n  <section class="quotaDetails-config">\n    <div class="section-header"><%=i18n("add_quota_policy")%></div>\n    <div class="section-content">\n\n      <div class="fs-quota-description-container">\n        \x3c!-- Quota policy description --\x3e\n        <div class="control-group">\n          <div class="n-inline-description">\n            <%=i18n("add_quota_desc")%>\n          </div>\n        </div>\n      </div>\n\n      \x3c!-- User or group container --\x3e\n      <div id="principal_type-container">\n        <div class="control-group">\n          <div class="controls">\n            <%=Components.radio({\n              jsClasses:"principal_type_radio",\n              id: "principalTypeUser",\n              name: "choose_principal_type",\n              checked: true,\n              value: "user"})\n            %>\n            <label class="radio-label principal-type-label"\n              for="principalTypeUser"><%=i18n("user")%>\n            </label>\n          </div>\n          <div class="controls">\n            <%=Components.radio({\n              jsClasses:"principal_type_radio",\n              id: "principalTypeGroup",\n              name: "choose_principal_type",\n              value: "group"})\n            %>\n            <label class="radio-label principal-type-label"\n              for="principalTypeGroup">\n              <%=i18n("group")%>\n              <span class="n-inline-description group-desc">\n                <%= i18n("group_desc") %>\n              </span>\n            </label>\n          </div>\n          <label class="control-label"><%= i18n("user_or_group") %></label>\n          <div class="controls">\n            <input type="text" class="principal-value"\n              value="<%=principalValue%>"\n              placeholder="<%=i18n(\'placeholder_group\') %>"/>\n          </div>\n        </div>\n      </div>\n\n      \x3c!-- Quota size container --\x3e\n      <div id="quota-size-container">\n        <div class="control-group">\n          <label class="control-label"><%= i18n("quota") %></label>\n          <div class="controls">\n            <input type="number" class="quota-size" value="<%=quotaSize%>"\n              min="0" placeholder="<%= i18n(\'placeholder_no_limit\') %>" />\n            <div class="unit">\n              <span class="quota-unit"><%= i18n("gb") %></span>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      \x3c!-- Enforcement type container --\x3e\n      <div id="hard-quota-enforcement-type-container">\n        <div class="control-group">\n          <label class="control-label"><%= i18n("enforcement_type") %></label>\n          <div class="controls">\n            <div class="enforcement-type">\n              <input type=\'radio\' name=\'enforcementType\'\n                class=\'hard-limit\' value=\'Hard\'>\n              <div class="radio-label"><%= i18n("hard_limit") %></div>\n            </div>\n            <div class="n-inline-description description">\n              <%= i18n("read_only_mode") %>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      <div id="soft-quota-enforcement-type-container">\n        <div class="control-group">\n          <div class="controls">\n            <div class="enforcement-type">\n              <input type=\'radio\' name=\'enforcementType\'\n                class=\'soft-limit\' value=\'Soft\'>\n              <div class="radio-label"><%= i18n("soft_limit") %></div>\n            </div>\n            <div class="n-inline-description description">\n              <%= i18n("daily_email") %>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  </section>\n\n  <section class="quotaEmailDetails-config">\n    <div class="section-header"><%= i18n("alert_emails") %></div>\n    <div class="section-content">\n\n      <div class="alert-email-container">\n        \x3c!-- Quota alerts description --\x3e\n        <div class="control-group">\n          <div class="n-inline-description">\n            <%= i18n("quota_alert") %>\n          </div>\n        </div>\n      </div>\n\n      \x3c!-- Quota email --\x3e\n      <div id="quota-email-recipients-container">\n        \x3c!-- Quota email notification checkbox --\x3e\n        <div class="control-group">\n          <div class="controls">\n            <input class="notification-checkbox" type="checkbox">\n            <div class="checkbox-label n-inline-description">\n              <%= i18n("send_email") %>\n            </div>\n          </div>\n        </div>\n\n        \x3c!-- Additional email notification --\x3e\n        <div class="control-group">\n          <label class="control-label">\n            <%= i18n("additional_recipients") %>\n          </label>\n          <div class="controls">\n            <input type="text" class="notification-recipients"\n              value="<%= recipients %>"\n              placeholder="<%= i18n(\'placeholder_recipient\') %>"/>\n          </div>\n        </div>\n      </div>\n    </div>\n    <input type="hidden" class="principal-type-populated"/>\n    <input type="hidden" class="share-uuid" />\n  </section>\n</form>'}),define("views/popups/fileserver/FileServerShareQuotaPopupView",["views/basecomponents/popups/BasePopupView","models/fileserver/QuotaPolicyModel","models/fileserver/ShareModel","managers/NavigationManager","utils/AppUtil","utils/AppConstants","utils/CommonTemplates","utils/FileServerUtil","data/DataProperties","data/DataManager","data/DataURLConstants","text!templates/popups/fileserver/QuotaPopupView.html","text!templates/popups/fileserver/DefaultQuotaPopupView.html","text!templates/popups/fileserver/QuotaExceptionPopupView.html"],function(e,t,n,i,s,a,o,r,l,c,d,p,u,h){"use strict";var m=_.template("<%= principalValue %> not found in configured Directory Services."),f=_.template("<%= principalValue %> found in configured Directory Services.");return u=_.template(u),h=_.template(h),e.extend({el:"#popupQuotaException",model:null,shareUuid:null,shareModel:null,events:{"click   .btnCancel":"hide","click   .btnClose":"hide","click   .modal-header .close":"hide","click   .btnDefaultQuota":"onSave","click   .btnQuotaException":"onSave","keydown .quota-size":"onKeyDown","change  .principal-value":"onChangePrincipalType","change  .principal_type_radio":"onChangePrincipalType"},errorPrincipal:null,name:"FileServerShareQuotaPopupView",initialize:function(){e.prototype.initialize.apply(this,arguments),this.model=new t;var n=this;this.model.on("error",function(e,t){n.showHeaderError(t)})},show:function(t){e.prototype.show.apply(this,arguments),t[a.NAV_ACTION]===a.ACTION_UPDATE&&(this.$el.html(p),this.fetchQuotaPolicy(t))},render:function(){var e=this,t=i.getCurrentPageRoute().options,l=s.parseQueryToObject(t);this.actionRoute.action===a.ACTION_CREATE?(this.shareUuid=this.actionRoute.actionTargetId.split(":")[1],this.fileServerUuid=l.actionParentId,this.shareModel=new n,this.shareModel.setUuid({fsUuid:this.fileServerUuid,shareId:this.shareUuid}),this.$("#popupQuotaException").html(o.LOADING_MSG({msg:this.i18n("loading")})),this.shareModel.fetch({success:function(t,n){e.$el.html(p),e.$(".n-title").html(e.i18n("quota_policy_header")),e.$(".btnSave").show().addClass("btnQuotaException").text("Save");var i=h(e.vtOptions({recipients:"",quotaSize:"",principalValue:""}));e.$(".btnSave").prop("disabled",!0),e.$("#fsQuotaExceptionFormWrapper").html(i),e.$(".soft-limit").attr("checked","checked"),e.$(".notification-checkbox").attr("checked","checked"),e.model.isNew(!0),e.applyNutanixInput({types:["radio","checkbox"]}),r.setHelpLinkAfsVersion(e,e.actionRoute,e.shareModel)},error:function(t,n){e.showHeaderError(n.responseText),e.$(".btnSave").prop("disabled",!0)}})):this.applyNutanixInput({types:["radio","checkbox"]})},fetchQuotaPolicy:function(e){this.model.actionMode=a.ACTION_FETCH,this.model.setShareId(e.actionTargetName),this.shareUuid=e.actionTargetName,this.model.set(this.model.idAttribute,e.actionTargetId),this.model.isNew(!1);var t=this;this.model.fetch({success:function(e,n){t.renderQuotaForm(e)},error:function(e,n){t.showHeaderError("Issue fetching quota exception: "+s.processAjaxError(n.responseText))}})},renderQuotaForm:function(e){if("_default"===e.get(e.DP.PRINCIPAL_VALUE)){this.$(".n-title").html("Default Quota"),this.$(".btnSave").show().addClass("btnDefaultQuota").text("Save");var t=u({recipients:e.get(e.DP.NOTIFICATION_RECIPIENTS),quotaSize:0===e.get(e.DP.QUOTA_SIZE_GIB)?"":e.get(e.DP.QUOTA_SIZE_GIB)});this.$("#fsDefaultQuotaFormWrapper").html(t)}else{this.$(".n-title").html("Quota Exception"),this.$(".btnSave").show().addClass("btnQuotaException").text("Save");var n=h(this.vtOptions({recipients:e.get(e.DP.NOTIFICATION_RECIPIENTS),quotaSize:0===e.get(e.DP.QUOTA_SIZE_GIB)?"":e.get(e.DP.QUOTA_SIZE_GIB),principalValue:e.get(e.DP.PRINCIPAL_VALUE)}));this.$("#fsQuotaExceptionFormWrapper").html(n),this.$(".principal-value").prop("disabled",!0),this.$(".principal-type-populated").val(e.get(e.DP.PRINCIPAL_TYPE)),"GROUP"===e.get(e.DP.PRINCIPAL_TYPE)?this.$("#principalTypeGroup").prop("checked",!0):this.$("#principalTypeUser").prop("checked",!0),this.$("#principalTypeGroup, #principalTypeUser").prop("disabled",!0).off("click")}"SOFT"===e.get(e.DP.QUOTA_ENFORCEMENT_TYPE)&&this.$(".soft-limit").attr("checked","checked"),"HARD"===e.get(e.DP.QUOTA_ENFORCEMENT_TYPE)&&this.$(".hard-limit").attr("checked","checked"),e.get(e.DP.USER_NOTIFICATION)&&this.$(".notification-checkbox").attr("checked","checked"),this.applyNutanixInput({types:["radio","checkbox"]})},onSave:function(){var e=parseInt($.trim(this.$(".quota-size").val()),10)||0,t=this.$("input[name='enforcementType']:checked").val(),n=this.$(".notification-checkbox").is(":checked"),i=$.trim(this.$(".notification-recipients").val()),s=$.trim(this.$(".principal-type-populated").val())||this.model.get(this.model.DP.PRINCIPAL_TYPE),a=$.trim(this.$(".principal-value").val())||this.model.get(this.model.DP.PRINCIPAL_VALUE);"_default"===this.model.get(this.model.DP.PRINCIPAL_VALUE)&&(s=this.model.get(this.model.DP.PRINCIPAL_TYPE),a=this.model.get(this.model.DP.PRINCIPAL_VALUE)),this.validateForm(s,i,e,n,t,a)},validateForm:function(e,t,n,i,s,o){var r=[];t&&(r=t.split(",")),this.validateAndHandleError(e,o,r)||(this.model.setShareId(this.shareUuid),this.model.get(this.model.DP.UUID)?this.model.actionMode=a.ACTION_UPDATE:this.model.actionMode=a.ACTION_CREATE,this.model.setEntityName(a.ENTITY_NAMES[a.ENTITY_SHARE_QUOTAS]),this.model.set({principalType:e,principalValue:o,quotaSizeGiB:n,quotaEnforcementType:s,sendQuotaNotificationsToUser:i,notificationRecipients:r,name:""}),this.saveQuotaPolicy(this.model))},saveQuotaPolicy:function(e){var t=this;e.save(null,{success:function(e,n){s.processSerializedObject(n)[l.TASK_UUID]&&t.hide()},error:function(e,n){s.log("QuotaExceptionPopup: Error :"+n);var i="";i=e.isNew()?"creating":"updating",t.showHeaderError("Error "+i+" quota policy: "+s.processAjaxError(n.responseText))}})},validateAndHandleError:function(e,t,n){var i="",a=!0;return _.isEmpty(n)||_.some(n,function(e){s.validEmail(e)||(a=!1)}),0===e.length&&(i=this.errorPrincipal,this.showHeaderError(i)),0===t.length&&(i="User or group is required.",this.$(".principal-value").addClass("error-class"),this.showHeaderError(i)),a||(i="Invalid email address defined.",this.showHeaderError(i),this.$(".notification-recipients").addClass("error-class")),i||this.$(".notification-recipients, .principal-value").removeClass("error-class"),i},onChangePrincipalType:function(){var e=this,t=$("input:radio[name=choose_principal_type]:checked"),i=t[0].value,a=$.trim(this.$(".principal-value").val()),o=this.shareModel.get(n.DP.PROTOCOL_TYPE);if(a){var r=c.getFormattedURL(_.template(d.GET_PRINCIPAL_TYPE,{shareId:this.shareUuid,uuid:this.fileServerUuid}));this.$(".btnSave").prop("disabled",!0),$.ajax({type:"POST",url:r,contentType:"application/json; charset=UTF-8",data:JSON.stringify({principalName:a,principalType:i,protocolType:o}),statusCode:this.model.getStatusCode(),success:function(t,n,o){s.log("Response form get principal type ::"+t.value),t.value&&i===t.value?(e.$(".principal-type-populated").val(t.value),e.showHeaderInfo(f({principalValue:a})),e.$(".btnSave").prop("disabled",!1)):(!t.value||t.value&&i!==t.value)&&(e.errorPrincipal=m({principalValue:a}),e.populatePrincipalType(a))},error:function(t,n,i){e.errorPrincipal=s.processAjaxError(t.responseText),e.populatePrincipalType(a)}})}},populatePrincipalType:function(e){this.$(".principal-type-populated").val(""),this.showHeaderError(this.errorPrincipal)},onKeyDown:function(e){187!==e.which&&189!==e.which&&190!==e.which||e.preventDefault()}})}),define("text!templates/popups/dr/NonRecoverableVMPopupView.html",[],function(){return'\x3c!-- The parent div modal is #popupRemoteSite --\x3e\n<div class="modal-header">\n  <button type="button" class="close" data-dismiss="modal">\n    <i data-icon="K" aria-hidden="true"></i>\n  </button>\n  <h4 class="n-title text-capitalize"><%= i18n(\'details\') %></h4>\n</div>\n<div class="n-modal-wrapper">\n  <div class="n-modal-body">\n    <div class="n-modal-content-wrapper">\n      <div class="n-modal-alert-header">\n        \x3c!-- @view: update message goes here --\x3e\n      </div>\n\n      <div id="nonRecoverableTemplate">\n        \x3c!-- @view --\x3e\n      </div>\n    </div>\n  </div>\n\n  <div class="n-modal-footer">\n    \x3c!-- Back button --\x3e\n    <div class="pull-left">\n    </div>\n    <button class="btnCancel btn btn-primary n-btn-list">\n      <%= i18n(\'close\') %>\n    </button>\n  </div>\n</div>\n'}),define("views/popups/dr/NonRecoverableVMPopupView",["views/basecomponents/popups/BasePopupView","data/DataProperties","models/dataprotection/SnapshotCollection","models/dataprotection/ProtectionDomainModel","utils/AppConstants","text!templates/popups/dr/NonRecoverableVMPopupView.html","text!templates/popups/dr/NonRecoverableVMDataView.html"],function(e,t,n,i,s,a,o){"use strict";var r=_.template(a),l=_.template(o);return e.extend({name:"NonRecoverableVMPopupView",allRemoteSites:null,el:"#nonRecoverableVMPopupView",initialized:!1,hasError:!1,protectionDomain:null,snapshotType:null,pageSize:20,currentPage:1,endEntity:1,startEntity:1,totalPages:-1,totalEntities:-1,sortKey:"name",sortOrder:"",events:{"click  .modal-header .close":"hide","click  .btnCancel":"hide","click  .btnPrevious":"loadPreviousPage","click  .btnNext":"loadNextPage","click  .sorting":"sortData","mouseover .missing-snapshots-info":"onToolTipMouseOver","mouseleave .missing-snapshots-info":"onToolTipMouseLeave"},render:function(){this.$el.html(r(this.vtOptions({initialized:this.initialized}))),this.$("#nonRecoverableTemplate").html(l(this.vtOptions({initialized:this.initialized,hasError:this.hasError,snapshotEntities:this._getSnapshotEntities(),startEntity:this.startEntity,endEntity:this.endEntity,totalEntities:this.totalEntities,clusterName:this.clusterManager.getCurrentClusterName(),isLocalSnapshot:this.snapshotType===s.SNAPSHOT_TYPE.LOCAL}))),this.showSortIndicator(),this.updatePaginationIndicator(),this.applyNutanixInput(),this.errorMsg&&this.showHeaderTextError(this.errorMsg)},_getSnapshotEntities:function(){var e=[];if(this.entities){var t=(this.currentPage-1)*this.pageSize,n=t+this.pageSize;e=_.sortBy(this.entities,this.sortKey),this.sortOrder===s.SORT_DESC&&(e=e.reverse()),e=e.slice(t,n)}return e},onToolTipMouseOver:function(e){var t=$(e.currentTarget),n=e.target.dataset.index,i=this._getSnapshotEntities(),s=_.template("\n          "+i[n].recoveryErrors.join("\n")+"\n        ");t.tooltip({title:s,placement:"left",trigger:"manual",html:!0}),t.tooltip("show")},onToolTipMouseLeave:function(e){$(e.currentTarget).tooltip("destroy")},loadPreviousPage:function(e){this.currentPage>1&&(this.currentPage--,this.setDisplayEntityRange(),this.render())},loadNextPage:function(e){this.currentPage<this.totalPages&&(this.currentPage++,this.setDisplayEntityRange(),this.render())},setDisplayEntityRange:function(){var e=(this.currentPage-1)*this.pageSize;this.startEntity=e+1;var t=this.startEntity+this.pageSize-1;this.endEntity=this.totalEntities>t?t:this.totalEntities},sortData:function(e){var t=e.target.dataset.key;t===this.sortKey?this.sortOrder=this.sortOrder===s.SORT_ASC?s.SORT_DESC:s.SORT_ASC:this.sortOrder=s.SORT_ASC,this.sortKey=t,this.render()},showSortIndicator:function(){this.$("#nonRecoverableTemplate .sorting").removeClass("sorting_asc"),this.$("#nonRecoverableTemplate .sorting").removeClass("sorting_desc");var e=this.$("#nonRecoverableTemplate .sorting[data-key='"+this.sortKey+"']");this.sortOrder===s.SORT_ASC?e.addClass("sorting_asc"):this.sortOrder===s.SORT_DESC&&e.addClass("sorting_desc")},updatePaginationIndicator:function(){var e=this.$("#nonRecoverableTemplate .btnPrevious"),t=this.$("#nonRecoverableTemplate .btnNext");1!==this.currentPage||e.hasClass("n-disabled")||e.addClass("n-disabled"),this.currentPage>1&&e.hasClass("n-disabled")&&e.removeClass("n-disabled"),this.currentPage<this.totalPages&&t.hasClass("n-disabled")&&t.removeClass("n-disabled"),this.currentPage!==this.totalPages||t.hasClass("n-disabled")||t.addClass("n-disabled")},getVMRecoveryStatus:function(e,n){var i=void 0,s=[];return n?(i=this.i18n("recovery_status_non_recoverable"),s=[this.i18n("vm_missing_deleted")]):e[t.VM_RECOVERABILITY]&&!_.isEmpty(e[t.VM_RECOVERABILITY])?(i=this.i18n("recovery_status_non_recoverable"),s=e[t.VM_RECOVERABILITY].pluck("reason")):i=this.i18n("recovery_status_recoverable"),{status:i,recoveryErrors:s}},getVGRecoveryStatus:function(e,t){var n=void 0,i=[];return t?(n=this.i18n("recovery_status_non_recoverable"),i=[this.i18n("vg_missing_deleted")]):n=this.i18n("recovery_status_recoverable"),{status:n,recoveryErrors:i}},getMissingEntities:function(e){var n=this;return _.flatten(e.pluck(t.SNAP_MISSING_ENTITIES)).filter(function(e){return e.entityType===s.PD_ENTITY_TYPES.VM||e.entityType===s.PD_ENTITY_TYPES.VG}).map(function(e){var t=n.getVMRecoveryStatus({},!0);return{name:e.entityName,type:e.entityType===s.PD_ENTITY_TYPES.VM?n.i18n("type_vm"):n.i18n("type_vg"),consistencyGroup:e.cgName,recoveryStatus:t.status,recoveryErrors:t.recoveryErrors}})},getVMs:function(e){var n=this;return _.flatten(e.pluck(t.SNAP_VMS)).map(function(e){var t=n.getVMRecoveryStatus(e,!1);return _.extend(e,{name:e.vmName,type:n.i18n("type_vm"),recoveryStatus:t.status,recoveryErrors:t.recoveryErrors})})},getVGs:function(e){var n=this;return _.flatten(e.pluck(t.SNAP_VGS)).map(function(e){var t=n.getVGRecoveryStatus(e,!1);return _.extend(e,{type:n.i18n("type_vg"),recoveryStatus:t.status,recoveryErrors:t.recoveryErrors})})},
show:function(a){var o=this,r=a.actionTargetId.split(" ");this.snapshotType=parseInt(r[0],10),this.pdName=a.actionTargetName,this.collection=new n,this.collection.enableFullDetails(),this.collection.setCollectionFilterId(this.pdName),this.collection.setCollectionFilterIdType(s.ENTITY_PROTECTION_DOMAIN),this.collection.setSnapshotType(this.snapshotType),this.collection.setSnapshotFilterId(r[1]);var l=new i;l.set(l.idAttribute,this.pdName,{silent:!0}),this.initialized=!1,e.prototype.show.apply(this,arguments),$.when(this.collection.fetch(),l.fetch()).done(function(){if(null!==l.get(t.PD_VSTORE_ID))return o.errorMsg=o.i18n("vstores_snapshot_details"),void(o.hasError=!0);o.entities=[];var e=o.getMissingEntities(o.collection),n=o.getVMs(o.collection),i=o.getVGs(o.collection);o.entities=o.entities.concat(e,n,i),o.totalEntities=o.entities.length,o.totalPages=Math.ceil(o.totalEntities/o.pageSize),o.startEntity=1,o.endEntity=o.totalEntities>o.pageSize?o.pageSize:o.totalEntities}).fail(function(){o.errorMsg=o.i18n("error.data_fetch"),o.hasError=!0}).always(function(){o.initialized=!0,o.render()})},destroy:function(){this.$(".missing-snapshots-info").tooltip("destroy"),e.prototype.destroy.apply(this,arguments)}})}),define("models/volumegroup/IscsiClientModel",["models/BaseModel","data/DataURLConstants","data/DataManager","utils/AppConstants"],function(e,t,n,i){"use strict";var s={CLIENT_ID:"uuid",CLIENT_ADDRESS:"client_address",ENABLED_AUTH:"enabled_authentications",AUTH_TYPE:"auth_type",PASSWORD:"password"},a={CHAP:"CHAP",NONE:"NONE"};return e.extend({DP:s,AUTH_TYPE:a,idAttribute:s.CLIENT_ID,nameAttribute:s.CLIENT_ADDRESS,urlRoot:t.ISCSI_CLIENT,name:"IscsiClientModel",enableNotifications:!1,getDataSourceURL:function(){return n.getV2DataSourceURL()},getURL:function(){return this.actionMode===i.ACTION_CREATE?this.urlRoot:this.actionMode===i.ACTION_UPDATE?this.urlRoot+"/"+this.getId():void 0},toJSON:function(t){var n={};return this.isNew()||this.actionMode===i.ACTION_UPDATE?e.prototype.toJSON.apply(this,arguments):(n[s.CLIENT_ADDRESS]=this.get(s.CLIENT_ADDRESS),n[s.CLIENT_ID]=this.get(s.CLIENT_ID),n)},isChapEnabled:function(){var e=this.get(s.ENABLED_AUTH);return!(!e||!e.length)&&e[0][s.AUTH_TYPE].toLowerCase()===a.CHAP.toLowerCase()},getChapSecret:function(){var e=this.get(s.ENABLED_AUTH);return e&&e.length?e[0][s.PASSWORD]:""}},{DP:s,AUTH_TYPE:a})}),define("models/volumegroup/IscsiClientCollection",["models/BaseCollection","models/volumegroup/IscsiClientModel","data/DataURLConstants","data/DataManager"],function(e,t,n,i){"use strict";return e.extend({model:t,url:n.ISCSI_CLIENT,name:"IscsiClientCollection",getDataSourceURL:function(){return i.getV2DataSourceURL()}})}),define("text!templates/popups/volumegroup/IscsiClientContentView.html",[],function(){return'\x3c!-- The parent div modal is #popupInitiator --\x3e\n<div data-ntnx-content-inner class="client-list-wrapper">\n  <div id="client-popup-form">\n    <% if (initialized) { %>\n      <section data-ntnx-section="type-text">\n        <%= i18n(\'description\') %>\n      </section>\n      <section data-ntnx-section class="client-config">\n        \x3c!-- List of IQNs goes here --\x3e\n      </section>\n    <% } else { %>\n      <section data-ntnx-section class="n-modal-loading">\n        <span class="n-loading-icon"></span>\n        <span class="n-loading-text"><%= i18n(\'loading\') %></span>\n      </section>\n    <% } %>\n  </div>\n</div>\n\n<div data-ntnx-content-inner class="client-form-wrapper" style="display:none">\n  <div id="client-form-wrapper">\n    \x3c!-- @view: iSCSCI client form goes here... --\x3e\n  </div>\n</div>\n'}),define("text!templates/popups/volumegroup/ClientRowView.html",[],function(){return'<tr class="n-table-row">\n  <td class="address-cell">\n    <input type="checkbox" class="client-cb"\n           actionTargetId="<%= id || \'\' %>"\n           actionTargetName="<%= name %>"\n           <%= selected ? "checked" : "" %>>\n      <%- name %>\n  </td>\n  <td class="cell-actions">\n    <% if (canModify) { %>\n      <i class="btn-edit" data-icon="F"\n         actionTargetId="<%= id || \'\' %>"\n         actionTargetName="<%= name %>"\n         aria-hidden="true"></i>\n    <% } %>\n  </td>\n</tr>'}),define("text!templates/popups/volumegroup/ClientFormView.html",[],function(){return'\x3c!-- iSCSI Client Form --\x3e\n<form id="iscsi-client-form"\n  <% if (clientId) { %>\n      actionTargetId="<%= clientId %>"\n  <% } else { %>\n      actionTargetName="<%= clientAddress %>"\n  <% } %>\n>\n\n  <section data-ntnx-section>\n    <label data-ntnx-label for="clientAddress"><%= i18n(\'clientAddressIP\') %></label>\n    <input\n      type="text"\n      class="client-addr"\n      id="clientAddress"\n      data-test="clientAddress"\n      value="<%= clientAddress %>"\n      <%= readOnlyClient ? \'readOnly\' : \'\'%>\n    >\n  </section>\n\n  <% if (enableAuth) { %>\n    <section data-ntnx-section>\n       <div data-ntnx-form-inline>\n         <%= Components.checkbox({\n           checked: isChapEnabled,\n           id: \'client-chap-auth\',\n           jsClasses: \'chap-auth\'\n         }) %>\n         <label data-ntnx-inline-label for="client-chap-auth">\n           <%= i18n(\'chapAuthentication\') %>\n         </label>\n       </div>\n    </section>\n\n    <section data-ntnx-section>\n      <label data-ntnx-label for="inputClientPassword"><%= i18n(\'clientPassword\') %></label>\n      <input\n        type="password"\n        class="input-target-password input-client-password"\n        id="inputClientPassword"\n        value="<%= password %>"\n        <%= isChapEnabled ? \'\' : \'disabled\' %>\n      >\n    </section>\n  <% } %>\n\n</form>'}),define("views/popups/volumegroup/IscsiClientPopupView",["views/basecomponents/popups/BasePopupView","models/volumegroup/IscsiClientCollection","models/volumegroup/IscsiClientModel","utils/AppConstants","utils/AppUtil","text!templates/popups/volumegroup/IscsiClientContentView.html","text!templates/basecomponents/pagepopups/PopupListView.html","text!templates/popups/volumegroup/ClientRowView.html","text!templates/popups/volumegroup/ClientFormView.html"],function(e,t,n,i,s,a,o,r,l){"use strict";return a=_.template(a),l=_.template(l),r=_.template(r),o=_.template(o),e.extend({name:"IscsiClientPopupView",el:"#popupInitiator",dataLoaded:!1,clientCollection:null,clientPasswordDirty:!1,events:{"click  .btnSave":"onSaveClick","click  .btnCancel":"onCancelClick","click  .btnClose":"hide","click  .modal-header .close":"hide","click  .btn-edit:not(.disabled)":"onEditClient","change .chap-auth":"onToggleChapAuth","change .input-client-password":"onClientPasswordChange"},initialize:function(){this.clientCollection=new t,this.CLIENT_LIST_TITLE=this.i18n("manageiSCSIClients"),this.CLIENT_FORM_TITLE=this.i18n("editiSCSIClient"),e.prototype.initialize.apply(this,arguments)},render:function(){var e=this,t=[{text:this.i18n("back"),leftAligned:!0,extraClasses:"btnBack n-btn-form hide",iconLeft:"caret-left"},{text:this.i18n("cancel"),extraClasses:"btnCancel n-btn-list hide",extraAttr:[{key:"data-test",value:"clientCancelBtn"}]},{text:this.i18n("close"),isPrimary:!0,extraClasses:"btnClose n-btn-list",extraAttr:[{key:"data-test",value:"clientCloseBtn"}]},{text:this.i18n("save"),isPrimary:!0,extraClasses:"btnSave n-btn-list hide",extraAttr:[{key:"data-loading-text",value:this.i18n("saving")},{key:"data-test",value:"clientUpdateBtn"}]}];this.$el.html(this.defaultTemplate({title:this.CLIENT_LIST_TITLE,antiscroll:!1,bodyContent:a(this.vtOptions({initialized:this.dataLoaded})),footerButtons:this.defaultFooter(t)})),this.dataLoaded?this.renderClients():(s.addInLineDonutLoader(this.$el.find(".n-loading-icon")),this.clientCollection.fetch({success:function(){e.dataLoaded=!0,e.render()},error:function(t){e.triggerAction(i.MODAL.ACT.ALERT_SHOW,{type:i.MODAL.ALERT.TYPE_ERROR,message:_.isObject(t)?s.processAjaxError(t.responseText):t}),e.$(".n-modal-loading").hide()}}))},saveClient:function(e){var t=this;this.actionRoute[i.NAV_ACTION_PARENT_ID]&&e.setProxyClusterUuid(this.clusterUuid),e.actionMode=i.ACTION_UPDATE,e.on("error",function(e,n){t.triggerAction(i.MODAL.ACT.ALERT_SHOW,{type:i.MODAL.ALERT.TYPE_ERROR,message:t.i18n("failedToSaveiSCSI"),details:_.escape(n.responseText)})}),e.save(null,{success:function(){t.dataLoaded=!1,t.render()},error:function(e){t.triggerAction(i.MODAL.ACT.ALERT_SHOW,{type:i.MODAL.ALERT.TYPE_ERROR,message:_.isObject(e)?s.processAjaxError(e.responseText):e}),t.$(".n-modal-loading").hide()}})},onSaveClick:function(){var e=this.$("#iscsi-client-form"),t=e.attr(i.NAV_ACTION_TARGET_ID),a={},o=n.DP,r=null;t&&(r=this.clientCollection.findModelByUuid(t)),r||(r=new n);var l=e.find(".chap-auth").is(":checked"),c="",d={};if(l){if(this.clientPasswordDirty){if(c=e.find(".input-client-password").val(),!s.isValidChapSecret(c))return void this.triggerAction(i.MODAL.ACT.ALERT_SHOW,{type:i.MODAL.ALERT.TYPE_ERROR,message:this.i18n("invalidChapSecret")});d[o.AUTH_TYPE]=n.AUTH_TYPE.CHAP,d[o.PASSWORD]=c,a[o.ENABLED_AUTH]=[d]}}else d[o.AUTH_TYPE]=n.AUTH_TYPE.NONE,d[o.PASSWORD]=null,a[o.ENABLED_AUTH]=[d];t&&r.set(o.CLIENT_ID,t);var p=e.find(".client-addr").val().trim();if(!this.validateClientAddress(p))return void this.triggerAction(i.MODAL.ACT.ALERT_SHOW,{type:i.MODAL.ALERT.TYPE_ERROR,message:this.i18n("invalidClientAddress")});r.set(o.CLIENT_ADDRESS,p),r.set(o.ENABLED_AUTH,a[o.ENABLED_AUTH]),this.saveClient(r),this.dataLoaded=!1,this.render()},renderClients:function(){var e=[];this.clientCollection.each(function(t){var s=t.get(n.DP.CLIENT_ADDRESS);e.push(r({id:t.get(n.DP.CLIENT_ID),name:s,selected:!1,canModify:this.canModifyByEntityType(i.ENTITY_ACROPOLIS_VOLUME_GROUP)}))},this);var t=[{className:"address-cell",title:this.i18n("clientIQNAddress")},{className:"cell-actions",title:this.i18n("actions")}],s=o({className:"iqn-controls",btnClass:"btn-add-iqn",dataTest:"clientAddIqnBtn",streamAction:"create",streamTarget:"disk",tableId:"iqn-table",dataTableTest:"clientIqnTable",emptyText:this.i18n("noClientsMsg"),btnText:"",title:"&nbsp;",titleClass:"section-header",tableHeaders:t,tableRows:e});this.$("section.client-config").html(s)},validate:function(){if(this.$(".iqn-clients .chap-auth").is(":checked")){var e=this.$(".iqn-clients .input-target-password").val();if(this.targetPasswordDirty&&!s.isValidChapSecret(e))return this.triggerAction(i.MODAL.ACT.ALERT_SHOW,{type:i.MODAL.ALERT.TYPE_ERROR,message:this.i18n("invalidChapSecret")}),!1}return!0},validateClientAddress:function(e){return!(!e||!e.length)&&(s.isValidIP(e)||s.isValidISCSITargetName(e))},onEditClient:function(e){var t=$(e.currentTarget).attr(i.NAV_ACTION_TARGET_ID),s=this.clientCollection.find(function(e){return e.get(n.DP.CLIENT_ID)===t}),a=s.isChapEnabled(),o=a?i.DEFAULT_DUMMY_VALUES.CHAP_PASSWORD:"",r=s.get(n.DP.CLIENT_ADDRESS);this.$("#client-form-wrapper").html(l(this.vtOptions({enableAuth:!0,isChapEnabled:a,clientId:t,clientAddress:r,password:o,readOnlyClient:!0}))),this.showClientForm(i.ACTION_EDIT,!0),this.$(".btnUpdate").text(this.i18n("save"))},showClientForm:function(e,t){this.clientPasswordDirty=!1,this.triggerAction(i.MODAL.ACT.SET_TITLE,this.CLIENT_FORM_TITLE),this.hideSubview(".client-list-wrapper"),this.showSubview(".client-form-wrapper","left"),this.$(".btnSave").show(),this.$(".btnCancel").show(),this.$(".btnClose").hide()},showClientList:function(e,t){this.triggerAction(i.MODAL.ACT.SET_TITLE,this.CLIENT_LIST_TITLE),this.hideSubview(".client-form-wrapper"),this.showSubview(".client-list-wrapper","left"),this.$(".btnSave").hide(),this.$(".btnCancel").hide(),this.$(".btnClose").show()},onCancelClick:function(){this.$(".client-form-wrapper").is(":visible")?this.showClientList(this.actionRoute[i.NAV_ACTION],!0):this.hide()},onClientPasswordChange:function(){this.clientPasswordDirty=!0},onToggleClientSelect:function(e){var t=this.$(e.currentTarget),n=t.attr(i.NAV_ACTION_TARGET_NAME);t.is(":checked")&&_.indexOf(this.selectedClients)<0?this.selectedClients.push(n):this.selectedClients=_.without(this.selectedClients,n)},onToggleChapAuth:function(e){this.$(".input-client-password").prop("disabled",!this.$(".chap-auth").is(":checked"))}})}),define("text!templates/popups/volumegroup/VolumeGroupContentView.html",[],function(){return'\x3c!-- The parent div modal is #popupVolumeGroup --\x3e\n\x3c!-- Using visibility hidden so that the popup is dynamically sized\n     properly upon initial rendering. --\x3e\n<div data-ntnx-content-inner class="vg-form-wrapper" style="visibility:hidden;">\n  <% var sDisabled = canModify ? \'\' : \'disabled\' ; %>\n  \x3c!-- VG Settings --\x3e\n  <section data-ntnx-section>\n    <label data-ntnx-label for="inputName"><%= i18n(\'name\') %></label>\n    <input type="text"\n           id="inputName"\n           class="inputName"\n           data-test="volumegroupcontentview_input_name" <%=sDisabled%>>\n  </section>\n\n  <section data-ntnx-section>\n    <label data-ntnx-label for="inputIscsiTargetName">\n      <%= i18n(\'iscsiTargetPrefix\') %>\n    </label>\n    <input type="text"\n           id="inputIscsiTargetName"\n           class="inputIscsiTargetName"\n           data-test="vgIscsiTargetInput" <%=sDisabled%>>\n  </section>\n\n  <section data-ntnx-section>\n\n    <label data-ntnx-label for="inputDesc"><%= i18n(\'description\') %></label>\n    <input type="text"\n           id="inputDesc"\n           class="inputDesc"\n           data-test="vmDescriptionInput" <%=sDisabled%>>\n  </section>\n\n  <section data-ntnx-section class="disk-config">\n    \x3c!-- Disk section goes here --\x3e\n  </section>\n\n  <section data-ntnx-section class="vm-config">\n    \x3c!-- Attached VMs section goes here --\x3e\n  </section>\n\n  <section data-ntnx-section>\n    <h5 data-ntnx-title>\n      <%= i18n(\'accessSettings\') %>\n    </h5>\n  </section>\n\n  <section data-ntnx-section>\n    <div data-ntnx-form-inline>\n      <%= Components.checkbox({\n        checked: externalAccessEnabled,\n        id: \'external-access\',\n        jsClasses: \'external-access\'\n      }) %>\n      <label data-ntnx-inline-label for="external-access">\n        <%= i18n(\'enableExternalClient\') %>\n      </label>\n    </div>\n  </section>\n\n  <section data-ntnx-section="type-text">\n    <%= i18n(\'grantAccess\') %>\n  </section>\n\n  <section data-ntnx-section class="abs-external hide">\n    <div class="alert alert-warning">\n      <%= absExternalWarningMsg %>\n    </div>\n  </section>\n\n  <div class="iqn-clients">\n\n    <section data-ntnx-section>\n      <div data-ntnx-form-inline>\n        <%= Components.checkbox({\n          checked: isChapEnabled,\n          id: \'chap-auth\',\n          jsClasses: \'chap-auth\'\n        }) %>\n        <label data-ntnx-inline-label for="chap-auth">\n          <%= i18n(\'chapAuthentication\') %>\n        </label>\n      </div>\n    </section>\n\n    <section data-ntnx-section>\n      <label data-ntnx-label for="input-target-password"><%= i18n(\'targetPassword\') %></label>\n      <input type="password"\n             id="input-target-password"\n             class="form-control input-target-password"\n             value="<%= password %>"\n             <%= isChapEnabled ? \'\' : \'disabled\' %>>\n      <div data-ntnx-hint class="n-input-validation-msg"></div>\n    </section>\n\n    <section data-ntnx-section id="iqn-list" class="access-control-group">\n      \x3c!-- List of IQNs goes here --\x3e\n    </section>\n\n  </div>\n\n  <div class="advanced-config">\n\n    <section data-ntnx-section>\n      <h5 data-ntnx-title>\n        <%= i18n(\'advancedSettings\') %>\n      </h5>\n    </section>\n\n    <section data-ntnx-section>\n       <div data-ntnx-form-inline>\n         <%= Components.checkbox({\n           id: \'flash-mode\',\n           jsClasses: \'flash-mode\'\n         }) %>\n         <label data-ntnx-inline-label for="flash-mode">\n           <%= i18n(\'enableFlash\') %> <span class="vg-flash-help"></span>\n         </label>\n       </div>\n    </section>\n\n  </div>\n\n</div>\n\n<div data-ntnx-content-inner class="storage-form-wrapper hide">\n  <div id="vgStorageFormWrapper">\n    \x3c!-- @view: storage form goes here... --\x3e\n  </div>\n</div>\n\n<div data-ntnx-content-inner class="vm-form-wrapper hide">\n  <div id="vgVmFormWrapper">\n    \x3c!-- @view: VM form goes here... --\x3e\n  </div>\n</div>\n\n<div data-ntnx-content-inner class="client-form-wrapper hide">\n  <div id="vg-client-form-wrapper">\n    \x3c!-- @view: iSCSCI client form goes here... --\x3e\n  </div>\n</div>\n'}),define("text!templates/popups/volumegroup/StorageFormView.html",[],function(){return'\x3c!-- VG Storage Form --\x3e\n<form id="vgStorageForm">\n  <div class="container-wrapper">\n\n    <section data-ntnx-section>\n      <label data-ntnx-label for="storageContainer"><%= i18n(\'storageContainer\') %></label>\n      <%= Components.select({\n        jsClasses: \'container\',\n        id:\'storageContainer\',\n        useBrowserSelect: true,\n        dataTestAttribute: \'vgContainerSelect\'\n      }) %>\n    </section>\n\n    <div class="size-wrapper">\n\n      <section data-ntnx-section>\n        <label data-ntnx-label for="diskSize"><%= i18n(\'sizeGIB\') %></label>\n        <input\n          type="text"\n          id="diskSize"\n          class="diskSize isNumber"\n          data-test="vgDiskSizeInput"\n        >\n        <div data-ntnx-hint class="size-message hide">\n          <%= i18n(\'sizeMessage\') %>\n        </div>\n      </section>\n\n    </div>\n  </div>\n</form>'}),define("text!templates/popups/volumegroup/StorageItemView.html",[],function(){return'<tr class="n-table-row">\n  <td  class="address-cell">\n    <%= index %>\n  </td>\n  <td class="size">\n    <%= size %>\n  </td>\n  <% if (canModify) { %>\n    <td diskuuid="<%= diskUuid %>" class="cell-actions">\n      <i class="btnEdit" data-icon="F" aria-hidden="true"></i>\n      <span class="action-separator">&middot;</span>\n      <i class="btnDelete" data-icon="v" aria-hidden="true" ></i>\n    </td>\n  <% } %>\n</tr>'}),define("text!templates/popups/volumegroup/VmFormView.html",[],function(){return'\x3c!-- VM Select Form --\x3e\n<form id="vmVolumeGroupForm">\n\n  <section data-ntnx-section="type-text" class="no-vm-wrapper">\n    <%= i18n(\'noVMs\') %>\n  </section>\n\n  <section data-ntnx-section class="vm-select-wrapper">\n    <label data-ntnx-label for="availableVms"><%= i18n(\'availableVMs\') %></label>\n    <div class="combobox-wrapper">\n      <select\n        class="vm-select"\n        id="availableVms"\n        data-class="fancy-select-top-anchor"\n      >\n      </select>\n    </div>\n    <div class="vm-select-result"></div>\n  </section>\n\n</form>\n'}),define("views/popups/volumegroup/VolumeGroupPopupView",["views/basecomponents/popups/BasePopupView","components/Components","data/DataProperties","models/volumegroup/AcropolisVolumeGroupModel","models/storage/ContainerCollection","models/imageservice/AcropolisImageCollection","models/storage/AcropolisDiskCollection","models/storage/AcropolisDiskModel","models/storage/AcropolisVdiskCollection","models/vm/VMCollection","models/volumegroup/IscsiClientCollection","models/volumegroup/IscsiClientModel","models/cluster/ClusterUpdateModel","managers/AccessManager","managers/NavigationManager","managers/ClusterManager","managers/LicenseManager","utils/HypervisorUtil","utils/AppConstants","utils/AppUtil","utils/StatsUtil","utils/ComboBox","text!templates/popups/volumegroup/VolumeGroupContentView.html","text!templates/popups/volumegroup/StorageFormView.html","text!templates/popups/volumegroup/StorageItemView.html","text!templates/popups/volumegroup/VmFormView.html","text!templates/basecomponents/pagepopups/PopupListView.html","text!templates/popups/volumegroup/ClientFormView.html","text!templates/popups/volumegroup/ClientRowView.html"],function(e,t,n,i,s,a,o,r,l,c,d,p,u,h,m,f,v,g,E,T,C,S,A,b,y,I,w,P,N){"use strict";var R={diskSizeMax:858994591,diskSizeMin:0};A=_.template(A),b=_.template(b),y=_.template(y),I=_.template(I),w=_.template(w),P=_.template(P),N=_.template(N);var D=_.template('<tr class="n-table-row"><td  class="name-cell"><%= name %></td><% if (canModify) { %><td class="cell-actions"><i class="btnDelete" data-icon="v" data-uuid="<%= uuid %>"aria-hidden="true" ></i></td><% } %></tr>');return e.extend({name:"VolumeGroupPopupView",el:"#popupVolumeGroup",model:null,containerCollection:null,initialized:!1,vgDiskCollection:null,clientCollection:null,currentDiskModel:null,clusterUuid:null,hasIScsiTargetNameChangedByUser:!1,targetPasswordDirty:!1,clientPasswordDirty:!1,flashModeDirty:!1,localClientCollection:null,selectedClients:[],isValid:!0,errorMessages:[],validatedFields:[],isShareWarningDisplayed:!1,events:{"click  .btnUpdate":"onSaveClick","click  .btnCancel":"onCancelClick","click  .btnBack":"onBackClick","click  .modal-header .close":"hide","click  .btnAddStorage":"onAddStorage","click  .disk-config .btnDelete":"onRemoveStorage","click  .disk-config .btnEdit":"onUpdateStorage","click  .btnAttachVm":"onAttachVm","click  .vm-config   .btnDelete":"onDetachVm","input  .inputName":"onVgNameInput","input  .inputIscsiTargetName":"onIScsiTargetNameInput","change .iqn-clients .input-target-password":"onTargetPasswordChange","change .inputDiskOperation":"onDiskOperationChange","keypress input":"onKeyPress","keyup  .diskPath":"onDiskPathKeyUp","click input:not(.client-addr)":"alertHide","change .client-select-all":"toggleSelectAllClients","click  .btn-add-iqn:not(.disabled)":"onAddClient","click  #iqn-list .btn-edit:not(.disabled)":"onEditClient","change .chap-auth":"onToggleChapAuth","change .input-client-password":"onClientPasswordChange","change .client-cb":"onToggleClientSelect","change .flash-mode":"onToggleFlashMode","change #external-access":"onToggleExternalAccess"},initialize:function(){this.containerCollection=new s,this.model=new i,this.vgDiskCollection=new o,this.vdiskCollection=new l,this.imageCollection=new a,this.vmCollection=new c,this.clientCollection=new d,this.localClientCollection=new d,this.vmCollection.setProjection([E.PROJECTION.BASIC_INFO]),_.bindAll(this,"onOperationError"),this.setValidatedFields(),e.prototype.initialize.apply(this,arguments)},render:function(){var e=this,t=this.canModifyByEntityType(E.ENTITY_ACROPOLIS_VOLUME_GROUP),n=[{leftAligned:!0,text:this.i18n("back"),extraClasses:"btnBack n-btn-form hide",iconLeft:"caret-left"},{text:this.i18n(t?"cancel":"close"),extraClasses:"btnCancel n-btn-list",dataTestAttribute:"volumegrouppopupview_button_cancelvm"}];t&&n.push({isPrimary:!0,text:this.i18n("save"),extraClasses:"btnUpdate n-btn-list",extraAttr:[{key:"data-loading-text",value:this.i18n("saving")}],dataTestAttribute:"volumegrouppopupview_button_updatevm"}),this.$el.html(this.defaultTemplate({title:"&nbsp;",bodyContent:A(this.vtOptions({canModify:t,techPreviewWarning:E.MSG_TECH_PREVIEW,questionIcon:"",shareLabel:this.i18ns("shareLabelTemplate",g.hasKVMOnly(this.clusterUuid)?" "+this.i18n("multipleVms"):""),isChapEnabled:!1,password:"",externalAccessEnabled:!1,absExternalWarningMsg:v.getPopupMessageTemplate(v.FEATURE_MAP.LICENSE_ABS_EXTERNAL)})),footerButtons:this.defaultFooter(n)})),this.$(".vg-flash-help").nutanixMoreInfo({title:this.i18n("flashModeTooltip",this.i18n("flashModeHelp"))}),this.triggerAction(E.MODAL.ACT.COVER_SHOW);var i=[],s=this.actionRoute[E.NAV_ACTION];switch(s){case E.ACTION_SHOW:case E.ACTION_UPDATE:case E.ACTION_CLONE:this.model.set(this.model.idAttribute,this.actionRoute[E.NAV_ACTION_TARGET_ID],{silent:!0}),i.push(this.model.fetch()),i.push(this.vmCollection.fetch());break;case E.ACTION_CREATE:}i.push(this.containerCollection.fetch()),i.push(f.fetchOnDemand()),i.push(this.clientCollection.fetch()),g.isAcropolisEnabled(this.clusterUuid)&&h.isFFEnabled(E.FFLAGS.UI_ACROPOLIS)&&i.push(this.imageCollection.fetch()),$.when.apply($,i).done(function(){switch(s){case E.ACTION_SHOW:e.renderSnapshotDetails(s);break;default:e.initSelectedClients(),e.showVgForm(s,!1)}}).fail(function(t){e.triggerAction(E.MODAL.ACT.ALERT_SHOW,{type:E.MODAL.ALERT.TYPE_ERROR,message:e._processError(t)})}).always(function(){e.triggerAction(E.MODAL.ACT.COVER_HIDE)})},_processError:function(e){return _.isObject(e)?T.processAjaxError(e.responseText):e},show:function(t){this.actionRoute=t,this.actionRoute[E.NAV_ACTION_PARENT_ID]?(this.clusterUuid=this.actionRoute[E.NAV_ACTION_PARENT_ID],this.containerCollection.setProxyClusterUuid(this.clusterUuid),this.model.setProxyClusterUuid(this.clusterUuid),this.vgDiskCollection.setProxyClusterUuid(this.clusterUuid),this.vdiskCollection.setProxyClusterUuid(this.clusterUuid),this.clientCollection.setProxyClusterUuid(this.clusterUuid)):this.clusterUuid=f.getCurrentClusterId(),t[E.NAV_ACTION]===E.ACTION_DELETE?this.renderDelete(t):e.prototype.show.apply(this,arguments)},reset:function(){this.clearForm(),this.triggerAction(E.MODAL.ACT.ALERT_HIDE),this.undelegateEvents()},clearForm:function(){this.$("input,textarea").val("")},destroy:function(){this.$(".nutanixMoreInfo").nutanixMoreInfo("destroy"),e.prototype.destroy.apply(this,arguments)},disableElement:function(e,t){this.$(e).is("svg")?(this.$(e+"+ .action-seperator").remove(),this.$(e).remove()):t?this.$(e).removeAttr("disabled"):this.$(e).attr("disabled","disabled")},isActionUpdate:function(){return this.actionRoute[E.NAV_ACTION]===E.ACTION_UPDATE},isActionClone:function(){return this.actionRoute[E.NAV_ACTION]===E.ACTION_CLONE},isActionCreate:function(){return this.actionRoute[E.NAV_ACTION]===E.ACTION_CREATE},isActionShow:function(){return this.actionRoute[E.NAV_ACTION]===E.ACTION_SHOW},getIQNs:function(){var e=this.model.DP,t=this.model.get(e.INITIATOR_NAME_LIST)||[],n=this.model.get(e.INITIATOR_IP_LIST)||[];if(t.length||n.length)return _.union(t,n);var i=this.model.get(e.ATTACHMENT_LIST)||[];return t=_.pluck(_.filter(i,function(t){return t[e.INITIATOR_NAME]}),e.INITIATOR_NAME),n=_.pluck(_.filter(i,function(t){return t[e.INITIATOR_IP]}),e.INITIATOR_IP),t.length||n.length?_.union(t,n):void 0},getDisk:function(e){return this.vgDiskCollection.find(function(t){return t.get(t.DP.DISK_UUID)===e||t.get(n.ID)===e},this)},getAttachedVMs:function(){var e=this.model.DP,t=this.model.get(e.ATTACHMENT_LIST);return _.filter(t,function(t){return t[e.VM_UUID]})},getClientModel:function(e){function t(t){return t.get(t.DP.CLIENT_ADDRESS)===e}return this.localClientCollection.find(t,this)||this.clientCollection.find(t,this)},setValidatedFields:function(){this.validatedFields={inputName:{selector:".inputName",validate:T.isValidVgName,errorMessage:this.i18n("invalidVgName"),isValid:!0},inputIscsiTargetName:{selector:".inputIscsiTargetName",validate:T.isValidISCSITargetName,errorMessage:this.i18n("invalidIscsiPrefix"),isValid:!0},inputTargetPassword:{selector:".iqn-clients .input-target-password",validate:this.isValidChapSecret.bind(this),errorMessage:this.i18n("invalidChapSecret"),isValid:!0}}},updateExternalClientAccess:function(e){if(this.isExternalClientAccessEnabled()!==e){var t=f.getCurrentClusterModel(),i=new u;i.set(t.attributes);var s=t.get(n.CLUSTER_ISCSI_CONFIG)||{};return s[n.CLUSTER_EXTERNAL_ISCSI_CLIENT_ENABLED]=e,f.isMulticlusterNavMode()&&i.setProxyClusterUuid(t.getClusterUuid()),i.set(n.CLUSTER_ISCSI_CONFIG,s),i.save()}},saveData:function(e,t){var i=this,s=[this.updateExternalClientAccess(t[n.CLUSTER_EXTERNAL_ISCSI_CLIENT_ENABLED]),e.save(null)];$.when.apply($,s).done(function(){i.hide()}).fail(function(e){i.triggerAction(E.MODAL.ACT.ALERT_SHOW,{type:E.MODAL.ALERT.TYPE_ERROR,message:i._processError(e)})})},createVg:function(e){var t=new i(e),s=this.model.DP,a=this.$(".inputIscsiTargetName").val();t.set(s.IS_SHARED,!0),t.set(s.ISCSI_TARGET_NAME_PREFIX,a),t.set(s.INITIATOR_NAME_LIST,e[s.INITIATOR_NAME_LIST]),t.set(s.ENABLED_AUTHENTICATIONS,e[s.ENABLED_AUTHENTICATIONS]),t.set(s.FLASH_MODE_ENABLED,e[s.FLASH_MODE_ENABLED]),t.set(n.CLUSTER_EXTERNAL_ISCSI_CLIENT_ENABLED),this.vgDiskCollection.length&&t.set(i.DP.DISK_LIST,this.vgDiskCollection.map(function(e,t){return e.toVolumeDiskJSON(E.ACTION_CREATE)})),this.actionRoute[E.NAV_ACTION_PARENT_ID]&&t.setProxyClusterUuid(this.clusterUuid),this.saveData(t,e)},updateVg:function(e){var t=new i(e),n=this.model.DP;t.setId(this.model.getId()),t.set(n.IS_SHARED,!0),t.set(n.ENABLED_AUTHENTICATIONS,e[n.ENABLED_AUTHENTICATIONS]),t.set(n.FLASH_MODE_ENABLED,e[n.FLASH_MODE_ENABLED]),!this.$(".inputIscsiTargetName").prop("disabled")&&this.hasIScsiTargetNameChangedByUser&&t.set(n.ISCSI_TARGET_NAME_PREFIX,this.$(".inputIscsiTargetName").val().trim()),this.actionRoute[E.NAV_ACTION_PARENT_ID]&&t.setProxyClusterUuid(this.clusterUuid),this.saveData(t,e)},cloneVg:function(e){var t=new i(e),n=this.model.DP,s=this.$(".inputIscsiTargetName").val();t.set(n.ISCSI_TARGET_NAME_PREFIX,s),t.set(n.SOURCE_UUID,this.model.getId()),t.set(n.IS_SHARED,!0),t.set(n.ENABLED_AUTHENTICATIONS,e[n.ENABLED_AUTHENTICATIONS]),t.actionMode=E.ACTION_CLONE,this.actionRoute[E.NAV_ACTION_PARENT_ID]&&t.setProxyClusterUuid(this.clusterUuid),this.saveData(t,e)},deleteDisk:function(e){var t=this.model;e.isNewDisk?(this.vgDiskCollection.remove(e),this.renderDisksTable(this.vgDiskCollection)):(t.actionMode=E.ACTION_DELETE,this.inlineSync(t,{action:function(){t.removeDisk(e)},latencyMsg:this.i18n("removeDiskLatencyMsg"),notificationMsg:this.i18n("removeDiskNotifMsg")}))},addDisk:function(e){var t=this,n=new r;this.model.actionMode=E.ACTION_CREATE,n.on("error",this.onOperationError),n.set(e)&&this.inlineSync(this.model,{action:function(){t.model.addDisk(n)},latencyMsg:this.i18n("addDiskLatencyMsg"),notificationMsg:this.i18n("addDiskNotifMsg")})},updateDisk:function(e){var t=this;this.model.actionMode=E.ACTION_UPDATE_DISK,this.inlineSync(this.model,{action:function(){t.model.updateDisk(e)},latencyMsg:this.i18n("updateDiskLatencyMsg"),notificationMsg:this.i18n("updateDiskNotifMsg")})},inlineSync:function(e,t){var i=this;t=t||{};var s=t.action||function(){e.save(null)},a=e.actionMode,o=t.latencyMsg||e.getLatencyMessage(a),r=t.notificationMsg||e.getPopupNotificationMessage(a);$.nutanixConfirm({msg:o,yes:function(){},yesText:E.LABEL_YES,hideNo:!0,hideYes:!0,context:this}),e.onTaskFailed=function(e){$("#nutanixConfirmModal .btnYes").click(),i.triggerAction(E.MODAL.ACT.ALERT_SHOW,{type:E.MODAL.ALERT.TYPE_ERROR,message:"Operation failed:",details:e.get(n.TASK_DISPLAY_ERROR)})},e.onTaskSucceeded=function(e){i.model.actionMode=null,i.model.fetch({success:function(e,t){t[i.model.DP.ATTACHMENT_LIST]||i.model.set(i.model.DP.ATTACHMENT_LIST,[]),t[i.model.DP.DISK_LIST]||i.model.set(i.model.DP.DISK_LIST,[]),i.initialized=!1,i.showVgForm(i.actionRoute[E.NAV_ACTION],!1),i.scrollToTop(),i.triggerAction(E.MODAL.ACT.ALERT_SHOW,{type:E.MODAL.ALERT.TYPE_SUCCESS,message:r}),$("#nutanixConfirmModal .btnYes").click()},error:function(e,t){$("#nutanixConfirmModal .btnYes").click(),i.triggerAction(E.MODAL.ACT.ALERT_SHOW,{type:E.MODAL.ALERT.TYPE_ERROR,message:i._processError(t)})}})};var l=function(e,t){$("#nutanixConfirmModal .btnYes").click(),i.triggerAction(E.MODAL.ACT.ALERT_SHOW,{type:E.MODAL.ALERT.TYPE_ERROR,message:T.processAjaxError(t.responseText)}),e.off("error",l)};e.on("error",l),this.actionRoute[E.NAV_ACTION_PARENT_ID]&&e.setProxyClusterUuid(this.clusterUuid),this.triggerAction(E.MODAL.ACT.ALERT_HIDE),s()},addStorageModel:function(e,t){if(e=e||{},!t){t=new r,t.isNewDisk=e.isNewDisk,t.on("error",this.onOperationError),e.isNewDisk&&(e[n.ID]=T.generateClientUUID()),delete e.isNewDisk;if(!t.set(e))return!1}return this.vgDiskCollection.add(t),!0},saveClient:function(e){var t=this;this.actionRoute[E.NAV_ACTION_PARENT_ID]&&e.setProxyClusterUuid(this.clusterUuid),e.actionMode=E.ACTION_UPDATE,e.on("error",function(e,n){t.triggerAction(E.MODAL.ACT.ALERT_SHOW,{type:E.MODAL.ALERT.TYPE_ERROR,message:t.i18n("failSaveIscsi"),details:_.escape(n.responseText)})}),e.save(null,{success:function(){t.refreshVgForm(),t.triggerAction(E.MODAL.ACT.ALERT_SHOW,{type:E.MODAL.ALERT.TYPE_SUCCESS,
message:t.i18n("clientUpdateSuccess")}),T.addInLineDonutLoader(t.$("#iqn-list")),t.clientCollection.fetch({success:function(e,n){t.renderClients(),t.$(".inputName").focus()},error:function(e,n){t.triggerAction(E.MODAL.ACT.ALERT_SHOW,{type:E.MODAL.ALERT.TYPE_ERROR,message:t._processError(n)})}})}})},initSelectedClients:function(){this.selectedClients=[];var e=this.getIQNs();_.each(e,function(e){this.selectedClients.push(e)},this)},refreshVgForm:function(){this.initialized=!1,this.showVgForm(this.actionRoute[E.NAV_ACTION],!1),this.scrollToTop()},vmFormSaveClick:function(){var e=this,t=this.$(".vm-select").val(),s=this.vmCollection.findModelByUuid(t),a={},o=s.get(n.VM_NAME),r=new i;a[this.model.DP.VM_UUID]=t,r.on("error",this.onOperationError),r.set(a)&&this.inlineSync(this.model,{action:function(){e.model.attachToVM(t)},latencyMsg:this.i18ns("attachVmLatencyMsgTemplate",o),notificationMsg:this.i18ns("attachVmNotifMsgTemplate",o)})},clientFormSaveClick:function(){var e=this.$("#iscsi-client-form"),t=e.attr(E.NAV_ACTION_TARGET_ID),n=e.attr(E.NAV_ACTION_TARGET_NAME),i={},s=p.DP,a=null;t&&(a=this.clientCollection.findModelByUuid(t)),a||(a=new p);var o=e.find(".chap-auth").is(":checked"),r="",l={};if(o){if(this.clientPasswordDirty){if(r=e.find(".input-client-password").val(),!T.isValidChapSecret(r))return void this.triggerAction(E.MODAL.ACT.ALERT_SHOW,{type:E.MODAL.ALERT.TYPE_ERROR,message:this.i18n("invalidChapSecret")});l[s.AUTH_TYPE]=p.AUTH_TYPE.CHAP,l[s.PASSWORD]=r,i[s.ENABLED_AUTH]=[l]}}else l[s.AUTH_TYPE]=p.AUTH_TYPE.NONE,l[s.PASSWORD]=null,i[s.ENABLED_AUTH]=[l];t&&a.set(s.CLIENT_ID,t);var c=e.find(".client-addr").val().trim();if(!this.validateClientAddress(c))return void this.triggerAction(E.MODAL.ACT.ALERT_SHOW,{type:E.MODAL.ALERT.TYPE_ERROR,message:this.i18n("invalidClientAddress")});if(a.set(s.CLIENT_ADDRESS,c),a.set(s.ENABLED_AUTH,i[s.ENABLED_AUTH]),t)return void this.saveClient(a);if(n){var d=[];this.localClientCollection.each(function(e){e.get(p.DP.CLIENT_ADDRESS)===n&&(e.set(p.DP.CLIENT_ADDRESS,c),e.set(p.DP.ENABLED_AUTH,l)),d.push(e)},this),this.localClientCollection.reset(d)}else a.isNew(!0),this.localClientCollection.add(a);this.selectedClients.push(c),this.refreshVgForm()},storageFormSaveClick:function(){var e=this.$("#vgStorageForm").data("diskId"),t={},i=void 0;t[n.ID]=e,t[r.DP.DISK_ADDRESS]={},t[r.DP.DISK_ADDRESS][r.DP.BUS_TYPE]=this.$(".busType").val();var s=this.$(".container").val().trim();t[r.DP.CONTAINER_ID]=s;var a=this.containerCollection.findModelByUuid(s),o=C.convertBytesToGiB(a.getTotalAvailableLogical()),l=parseInt(this.$(".diskSize").val().trim(),10)||0;if(l>R.diskSizeMax?i=this.i18n("diskSizeLarge"):l===R.diskSizeMin?i=this.i18n("diskSizeZero"):l<R.diskSizeMin&&(i=this.i18n("diskSizeNegative")),i)return void this.triggerAction(E.MODAL.ACT.ALERT_SHOW,{type:E.MODAL.ALERT.TYPE_ERROR,message:i+" "+this.i18n("diskSizeRange")});t[r.DP.DISK_SIZE]=isNaN(this.$(".diskSize").val().trim())?this.$(".diskSize").val().trim():Number(this.$(".diskSize").val().trim())*C.STORAGE_BINARY_UOM.GiB/C.STORAGE_BINARY_UOM.MiB,l>o?$.nutanixConfirm({msg:this.i18n("diskSizeWarning"),yes:function(){this.proceedToSaveStorageForm(t)},yesText:E.LABEL_YES,noText:E.LABEL_CANCEL,context:this}):this.proceedToSaveStorageForm(t)},proceedToSaveStorageForm:function(e){if(this.currentDiskModel){if(this.currentDiskModel.actionMode=E.ACTION_UPDATE,!this.currentDiskModel.set(e))return;this.currentDiskModel.isNewDisk?this.showVgForm(this.actionRoute[E.NAV_ACTION],!0):(this.currentDiskModel.vgId=this.model.get(this.model.idAttribute),this.updateDisk(this.currentDiskModel))}else this.isActionUpdate()?this.addDisk(e):(e.isNewDisk=!0,this.addStorageModel(e)&&this.showVgForm(this.actionRoute[E.NAV_ACTION],!0));this.currentDiskModel=null},renderDelete:function(e){this.confirmDelete(e)},populateBasicInfo:function(){var e=this.model.DP;if(this.vgDiskCollection.clearCollection(),this.mode===E.ACTION_UPDATE&&this.$(".n-popup-description").html(this.DESCRIPTION_UPDATE),this.isActionClone()||(this.$(".inputName").val(this.model.get(e.NAME)),this.$(".inputIscsiTargetName").val(this.model.get(e.ISCSI_TARGET_NAME))),this.mode===E.ACTION_UPDATE){var t=this.model.get(this.model.DP.DISK_LIST)&&this.model.get(this.model.DP.DISK_LIST).length>0,n=this.model.get(e.ATTACHMENT_LIST)&&this.model.get(e.ATTACHMENT_LIST).length>0,i=this.$(".inputIscsiTargetName");t||n?i.prop("disabled",!0).attr("title",this.i18n("iscsiTargetNameError")):i.prop("disabled",!1).attr("title","")}if(this.$(".inputDesc").val(this.model.get(e.DESCRIPTION)),this.isActionClone())this.$(".access-control-group").hide();else{this.model.isChapEnabled()?(this.$(".iqn-clients .chap-auth").prop("checked",!0),this.$(".iqn-clients .input-target-password").val(E.DEFAULT_DUMMY_VALUES.CHAP_PASSWORD)):this.$(".iqn-clients .input-target-password").val("")}this.onToggleChapAuth(),this.model.get(e.FLASH_MODE_ENABLED)&&this.$(".flash-mode").prop("checked",!0);var s=this.model.get(this.model.DP.DISK_LIST);_.each(s,function(t){var n={};n[r.DP.CONTAINER_ID]=t[e.CONTAINER_UUID],n[r.DP.DISK_SIZE]=t[e.DISK_SIZE],n[r.DP.DISK_UUID]=t[e.DISK_UUID],n[e.INDEX]=t[e.INDEX],n[r.DP.DISK_TYPE]=r.DISK_TYPES.DISK,this.addStorageModel(n)},this)},hideVMSection:function(){this.$(".vm-config").hide()},renderAttachments:function(){this.renderVMSection(),this.renderClients()},enableAttachVM:function(){this.disableElement(".btnAttachVm",!0),this.$(".btnAttachVm").parent().attr("title","")},enableAddIQN:function(){this.disableElement(".btn-add-iqn",!0),this.$(".btn-add-iqn").parent().attr("title",""),this.$("#iqn-input").removeAttr("readonly")},renderVMSection:function(){g.hasKVMOnly(this.clusterUuid)||this.hideVMSection();var e=this.$(".vm-config"),t=this.isActionUpdate()&&this.vmCollection.length>0,i=[{className:"name-cell",title:this.i18n("name")},{className:"cell-actions",title:this.i18n("actions")}],s=[],a=this.model.DP,o=this.model.get(a.ATTACHMENT_LIST)||[],r=_.filter(o,function(e){return e[a.VM_UUID]});_.each(r,function(e){var t=e[a.VM_UUID],i=this.vmCollection.findModelByUuid(t);s.push(D({name:i.get(n.VM_NAME),uuid:i.get(n.UUID),canModify:this.canModifyByEntityType(E.ENTITY_ACROPOLIS_VOLUME_GROUP)}))},this);var l=this.i18n(t?"volumeNotAttached":"noVmAttach"),c=w(this.vtOptions({isCleanPopup:!0,btnClass:"btnAttachVm",dataTest:"vmAttachVmBtn",streamAction:"attach",streamTarget:"vm",tableId:"vmList",dataTableTest:"vmTable",emptyText:l,btnText:this.i18n("attachToAVM"),title:this.i18n("vms"),titleClass:"section-header",tableHeaders:i,tableRows:s}));e.html(c),this.$(".btnAttachVm").prop("disabled",!t)},renderClients:function(){var e=this.getIQNs(),n=[],i=[],s=[];this.clientCollection.each(function(e){var t=e.get(p.DP.CLIENT_ADDRESS);i.push({id:e.get(p.DP.CLIENT_ID),name:t,selected:_.indexOf(this.selectedClients,t)>=0}),s.push(t)},this),_.each(e,function(e){e&&_.indexOf(s,e)<0&&(i.push({name:e,selected:!0}),s.push(e))},this),this.localClientCollection.each(function(e){var t=e.get(p.DP.CLIENT_ADDRESS);_.indexOf(s,t)<0&&(i.push({id:null,name:t,selected:_.indexOf(this.selectedClients,t)>=0}),s.push(t))},this),_.each(i,function(e){n.push(N({name:e.name,id:e.id,selected:_.indexOf(this.selectedClients,e.name)>=0,canModify:this.canModifyByEntityType(E.ENTITY_ACROPOLIS_VOLUME_GROUP)}))},this);var a=[{className:"address-cell",title:this.i18n("clientAddress")},{className:"cell-actions",title:this.i18n("actions")}],o=w(this.vtOptions({isCleanPopup:!0,btnClass:"btn-add-iqn",dataTest:"vgAddIqnBtn",streamAction:"create",streamTarget:"disk",tableId:"iqn-table",dataTableTest:"vgIqnTable",emptyText:this.i18n("noClient"),btnText:this.i18n("addNewClient"),title:this.i18n("client"),titleClass:"section-header",tableHeaders:a,tableRows:n})),r=this.$("#iqn-list");r.html(o),r.find("table th.address-cell").prepend(t.checkbox({jsClasses:"client-select-all"})),r.find("table th.address-cell").first().nutanixMoreInfo({renderMethod:"append",title:this.i18n("installNGT"),classes:["-nudge-up"]})},alertHide:function(){this.triggerAction(E.MODAL.ACT.ALERT_HIDE)},showStorageForm:function(e,t,i){var s=!1;this.mode=e,this.triggerActions([E.MODAL.ACT.ALERT_HIDE,[E.MODAL.ACT.SET_TITLE,E.ACTION_NAMES[e]+" "+this.i18n("disk")]]),this.$(".btnCancel").html("Cancel"),this.containerCollection.each(function(e){var t=e.get(n.CONTAINER_UUID),i=e.get(n.NAME)+" ("+C.storageFormat(e.getTotalAvailableLogical())+" free)";e.isSystemContainer()||this.$("#vgStorageForm .container").append('<option value="'+t+'">'+i+"</option>")},this),g.isAcropolisEnabled(this.clusterUuid)&&h.isFFEnabled(E.FFLAGS.UI_ACROPOLIS)?this.imageCollection.each(function(e){this.$("#vgStorageForm .image-select").append('<option value="'+e.get(e.DP.VMDISK_ID)+'">'+e.get(n.NAME)+"</option>")},this):this.$('option[value="CLONE_IMAGE"]').remove(),this.hideSubview(".vg-form-wrapper"),this.showSubview(".storage-form-wrapper","left"),this.$(".n-btn-form").hide(),this.$(".btnUpdate").show().text("Add"),this.currentDiskModel=i?this.getDisk(i):null,this.currentDiskModel?(this.$(".btnUpdate").text("Update"),this.$("#vgStorageForm").data("diskId",i),this.$(".container").val(this.currentDiskModel.get(this.currentDiskModel.DP.CONTAINER_ID)),this.$(".diskSize").val(C.convertBytesToGiB(C.convertToBytes(this.currentDiskModel.get(this.currentDiskModel.DP.DISK_SIZE),C.UOM_MIB),4)),e!==E.ACTION_UPDATE||this.currentDiskModel.isNewDisk||(s=!0,this.$(".size-message").show()),this.applyNutanixInput({types:["checkbox"]})):T.log("VolumeGroupPopupView: Issue finding disk model for id "+i),s&&this.$(".select-wrapper").addClass("disabled").find(".browser-select").prop("disabled",!0)},showVmForm:function(){this.triggerActions([E.MODAL.ACT.ALERT_HIDE,[E.MODAL.ACT.SET_TITLE,this.i18n("attachVM")]]),this.$(".btnCancel").html("Cancel");var e=this.getAttachedVMs(),t=_.pluck(e,this.model.DP.VM_UUID);this.vmCollection.length?(this.vmCollection.each(function(e){!e.get(n.VM_CONTROLLER_VM)&&_.indexOf(t,e.get(n.UUID))<0&&this.$("#vmVolumeGroupForm .vm-select").append('<option value="'+e.get(n.UUID)+'">'+e.get(n.VM_NAME)+"</option>")},this),this.$("#vmVolumeGroupForm .vm-select").combobox({initalSelectPrompt:this.i18n("selectVM")}),$(".ui-autocomplete").addClass("modal-autocomplete"),this.$("#vmVolumeGroupForm .no-vm-wrapper").hide()):this.$("#vmVolumeGroupForm .vm-select-wrapper").hide(),this.hideSubview(".vg-form-wrapper"),this.showSubview(".vm-form-wrapper","left"),this.$(".n-btn-form").hide(),this.$(".btnUpdate").show().text("Attach")},showClientForm:function(e,t){this.clientPasswordDirty=!1,this.triggerAction(E.MODAL.ACT.SET_TITLE,T.toTitleCase(e)+" "+T.getSingularEntityName(E.ENTITY_ISCSI_CLIENT)),this.hideSubview(".vg-form-wrapper"),this.showSubview(".client-form-wrapper","left"),this.$(".n-btn-form").hide(),this.$(".btnUpdate").show().text("Add"),this.$(".btnCancel").html("Cancel")},showVgForm:function(e,t){this.mode=e;var n=E.ENTITY_NAMES[this.actionRoute[E.NAV_ACTION_TARGET]];this.triggerActions([E.MODAL.ACT.ALERT_HIDE,[E.MODAL.ACT.SET_TITLE,E.ACTION_NAMES[e]+" "+n]]),this.initialized||(this.initialized=!0,(this.isActionUpdate()||this.isActionShow()||this.isActionClone())&&this.populateBasicInfo()),this.$(".external-access").prop("checked",this.isExternalClientAccessEnabled()),this.onToggleExternalAccess(),this.renderDisksTable(this.vgDiskCollection),this.isActionUpdate()&&this.$(".btnCancel").html("Close"),this.isActionClone()?(this.$(".iqn-config,.vm-config").hide(),this.$(".btnAddStorage").prop("disabled",!0),this.$(".inputDesc").prop("disabled",!0),this.$(".cell-actions .btnDelete").addClass("btnDisabled"),this.$(".advanced-config").hide()):this.renderAttachments(),this.$(".vg-form-wrapper").css("visibility","visible"),this.$(".inputName").focus(),this.hideSubview(".storage-form-wrapper"),this.hideSubview(".vm-form-wrapper"),this.hideSubview(".client-form-wrapper"),this.showSubview(".vg-form-wrapper","left"),this.$(".n-btn-form").show(),this.$(".btnBack").hide(),this.$(".btnUpdate").show().text("Save"),this.applyNutanixInput()},renderDisksTable:function(e,t){var s=[];e.length&&e.chain().sortBy(function(e){return e.get("index")}).each(function(e){var t=E.INVALID_STRING;T.isDisplayableNumber(e.get(e.DP.DISK_SIZE))&&(t=e.get(e.DP.DISK_SIZE)*C.STORAGE_BINARY_UOM.MiB/C.STORAGE_BINARY_UOM.GiB+" GiB");var a=e.get(i.DP.INDEX);void 0===a&&(a=E.INVALID_STRING);var o=e.get(e.DP.DISK_UUID)||e.get(n.ID);s.push(y({action:this.mode,index:a,diskUuid:o,size:t,canModify:this.canModifyByEntityType(E.ENTITY_ACROPOLIS_DISK)}))},this);var a=[{className:"address-cell",title:this.i18n("index")},{className:"size",title:this.i18n("size")},{className:"cell-actions",title:""}],o=w(this.vtOptions({isCleanPopup:!0,btnClass:"btnAddStorage",dataTest:"vmAddStorageBtn",streamAction:"create",streamTarget:"disk",tableId:"storageList",dataTableTest:"vmStorageTable",emptyText:this.i18n("noDisk"),btnText:this.i18n("addNewDisk"),title:this.i18n("storage"),titleClass:"section-header",tableHeaders:a,tableRows:s}));this.$(".disk-config").html(o)},showPathDropDown:function(){var e=this,t=this.$(".diskPath"),n=this.vdiskCollection.getFiles(),i=n.sort();t.autocomplete({source:i,delay:0,autoFocus:!0,open:function(t,n){e.$("#inputUsername").addClass("noBottomBorder")},close:function(t,n){e.$("#inputUsername").removeClass("noBottomBorder")}}).data("autocomplete").menu.element.addClass("modal-autocomplete"),t.autocomplete("search",t.val()).focus()},isValidChapSecret:function(e){return!(this.$(".iqn-clients .chap-auth").is(":checked")&&this.targetPasswordDirty&&!T.isValidChapSecret(e))},validateInputs:function(){var e=this,t=0,n=[];_.each(this.validatedFields,function(i,s,a){var o=e.$(i.selector),r=o.val().trim();i.isValid=i.validate(r),i.isValid||(t++,n.push(i.errorMessage))}),0===t?(this.isValid=!0,this.errorMessages=[]):(this.isValid=!1,this.errorMessages=n)},validateClientAddress:function(e){return!(!e||!e.length)&&(T.isValidIP(e)||T.isValidISCSITargetName(e))},clearValidationError:function(e){this.validatedFields[e].isValid=!0,this.isValid=!0,this.errorMessages=""},onSaveClick:function(){var e=this,t={};if(this.triggerAction(E.MODAL.ACT.ALERT_HIDE),this.$(".storage-form-wrapper").is(":visible"))this.storageFormSaveClick();else if(this.$(".vm-form-wrapper").is(":visible"))this.vmFormSaveClick();else if(this.$(".client-form-wrapper").is(":visible"))this.clientFormSaveClick();else{var s=i.DP;t[s.NAME]=this.$(".inputName").val(),t[s.DESCRIPTION]=this.$(".inputDesc").val();var a=null;this.$(".iqn-clients .chap-auth").is(":checked")?this.targetPasswordDirty&&(a={},a[s.AUTH_TYPE]=i.AUTH_TYPE.CHAP,a[s.PASSWORD]=this.$(".iqn-clients .input-target-password").val()):(a={},a[s.AUTH_TYPE]=i.AUTH_TYPE.NONE,a[s.PASSWORD]=""),a&&(t[s.ENABLED_AUTHENTICATIONS]=[a]),(this.actionRoute[E.NAV_ACTION]!==E.ACTION_UPDATE||this.flashModeDirty)&&(t[s.FLASH_MODE_ENABLED]=this.$(".flash-mode").is(":checked"));var o=[];if(this.$("#iqn-table .client-cb:checked").each(function(){var t=$(this).attr(E.NAV_ACTION_TARGET_NAME),n=e.getClientModel(t);o.push(n.toJSON())}),t[s.ATTACHED_CLIENTS]=o,t[n.CLUSTER_EXTERNAL_ISCSI_CLIENT_ENABLED]=this.$(".external-access").is(":checked"),this.validateInputs(),!this.isValid)return void this.triggerAction(E.MODAL.ACT.ALERT_SHOW,{type:E.MODAL.ALERT.TYPE_ERROR,message:this.errorMessages.join("<br>")});this.isActionCreate()?this.createVg(t):this.isActionUpdate()?this.updateVg(t):this.isActionClone()&&this.cloneVg(t)}},onBackClick:function(){this.triggerAction(E.MODAL.ACT.ALERT_HIDE)},onEnterKeyPress:function(){this.onSaveClick()},onVgNameInput:function(){if(!this.hasIScsiTargetNameChangedByUser){for(var e,t="",n=this.$(".inputName").val().trim(),i=0;i<n.length;i++)e=n.charAt(i),T.isValidISCSITargetName(e)&&(t+=e);this.$(".inputIscsiTargetName").val(t)}},onIScsiTargetNameInput:function(){this.hasIScsiTargetNameChangedByUser=!0},onTargetPasswordChange:function(){this.targetPasswordDirty=!0},onDiskOperationChange:function(){this.$("#vgStorageForm .control-group").each(function(){$(this).hide()}),this.$(".operation-wrapper").show(),this.$(".size-wrapper").show();var e=this.$(".inputDiskOperation");e.val()===r.OPERATION_TYPES.CLONE?this.$(".path-wrapper").show():e.val()===r.OPERATION_TYPES.CLONE_IMAGE?this.$(".image-wrapper").show():this.$(".container-wrapper").show()},onAddStorage:function(e){$(e.currentTarget).is(":disabled")||(this.$("#vgStorageFormWrapper").html(b(this.vtOptions({model:{}}))),this.showStorageForm(E.ACTION_ADD,!0))},onAddClient:function(e){var t=(this.model.get(i.DP.ATTACHMENT_LIST)||[]).length>1,n=this.getAttachedVMs()||[],s=n.length+this.$("#iqn-table .client-cb:checked").length;this.isShareWarningDisplayed||t||1!==s?this.showAddClient():($.nutanixConfirm({msg:this.i18n("shareWarning"),yes:function(){this.showAddClient()},yesText:this.i18n("allow"),noText:E.LABEL_NO,context:this}),this.isShareWarningDisplayed=!0)},showAddClient:function(){this.$("#vg-client-form-wrapper").html(P(this.vtOptions({enableAuth:!0,isChapEnabled:!1,clientId:"",clientAddress:"",password:"",readOnlyClient:!1}))),this.triggerAction(E.MODAL.ACT.ALERT_SHOW,{type:E.MODAL.ALERT.TYPE_INFO,message:this.i18n("installNGT"),closeTiming:E.MODAL.ALERT.CLOSE_TYPE_PERMANENT}),this.showClientForm(E.ACTION_ADD,!0)},onEditClient:function(e){var t=$(e.currentTarget).attr(E.NAV_ACTION_TARGET_ID),n=this.clientCollection.find(function(e){return e.get(p.DP.CLIENT_ID)===t});if(t&&!n)this.triggerAction(E.MODAL.ACT.ALERT_SHOW,{type:E.MODAL.ALERT.TYPE_ERROR,message:this.i18n("clientNotFoundMsg")});else{var i=!1,s="",a="",o=!!n;n?a=n.get(p.DP.CLIENT_ADDRESS):(a=$(e.currentTarget).attr(E.NAV_ACTION_TARGET_NAME),n=this.localClientCollection.find(function(e){return e.get(p.DP.CLIENT_ADDRESS)===a},this)),i=n.isChapEnabled(),s=i?E.DEFAULT_DUMMY_VALUES.CHAP_PASSWORD:"",this.$("#vg-client-form-wrapper").html(P(this.vtOptions({enableAuth:!0,isChapEnabled:i,clientId:t,clientAddress:a,password:s,readOnlyClient:o}))),this.showClientForm(E.ACTION_EDIT,!0),this.$(".btnUpdate").text("Save")}},onToggleChapAuth:function(){var e=this.$(".chap-auth").is(":checked");this.$(".input-target-password").prop("disabled",!e),e||this.clearValidationError("inputTargetPassword")},onAttachVm:function(){var e=(this.model.get(i.DP.ATTACHMENT_LIST)||[]).length>1,t=this.getAttachedVMs()||[],n=t.length+this.$("#iqn-table .client-cb:checked").length;e||this.isShareWarningDisplayed||1!==n?(this.$("#vgVmFormWrapper").html(I(this.vtOptions())),this.showVmForm()):($.nutanixConfirm({msg:this.i18n("shareWarning"),yes:function(){this.$("#vgVmFormWrapper").html(I(this.vtOptions())),this.showVmForm()},yesText:this.i18n("allow"),noText:E.LABEL_NO,context:this}),this.isShareWarningDisplayed=!0)},onDetachVm:function(e){var t=$(e.currentTarget).attr("data-uuid"),s=this.vmCollection.findModelByUuid(t),a=s.get(n.VM_NAME);$.nutanixConfirm({msg:this.i18ns("detachVmConfirmMsgTemplate",a),yes:function(){var e={},n=this,s=new i;e[this.model.DP.VM_UUID]=t,s.on("error",this.onOperationError),s.set(e)&&this.inlineSync(this.model,{action:function(){n.model.detachFromVM(t)},latencyMsg:this.i18ns("detachVmLatencyMsgTemplate",a),notificationMsg:this.i18ns("detachVmNotifMsgTemplate",a)})},yesText:E.LABEL_YES,noText:E.LABEL_NO,context:this})},onRemoveStorage:function(e){$(e.currentTarget).hasClass("btnDisabled")||$.nutanixConfirm({msg:this.i18n("diskDeleteConfirmation"),yes:function(){var t=$(e.currentTarget).closest("td").attr("diskUuid"),i=this.getDisk(t);i||(i=this.vgDiskCollection.find(function(e){return e.get(n.ID)===t})),this.deleteDisk(i)},yesText:E.LABEL_YES,noText:E.LABEL_CANCEL,context:this})},onUpdateStorage:function(e){$(e.currentTarget).hasClass("btnDisabled")||(this.$("#vgStorageFormWrapper").html(b(this.vtOptions({model:{}}))),this.showStorageForm(E.ACTION_UPDATE,!0,$(e.currentTarget).closest("td").attr("diskuuid")))},onCancelClick:function(){this.$(".storage-form-wrapper").is(":visible")||this.$(".vm-form-wrapper").is(":visible")||this.$(".client-form-wrapper").is(":visible")?(this.triggerAction(E.MODAL.ACT.ALERT_HIDE),this.showVgForm(this.actionRoute[E.NAV_ACTION],!0)):this.hide()},onDiskPathKeyUp:function(e){if(191===e.keyCode){var t=this,n={};n.data={path:this.$(".diskPath").val()},n.force=!0,n.success=function(e){t.showPathDropDown()},this.vdiskCollection.fetch(n)}},onOperationError:function(e,t){var n=this.i18n("operationErrorMessage");E.ACTION_NAMES[e.actionMode]&&(n=this.i18ns("performingErrorMessage",E.ACTION_NAMES[e.actionMode].toLowerCase())),n+=_.isObject(t)?T.processAjaxError(t.responseText):"",this.triggerAction(E.MODAL.ACT.ALERT_SHOW,{type:E.MODAL.ALERT.TYPE_ERROR,message:n,details:t.responseText||t})},deleteEntity:function(e,t,n){var s=new i;s.actionMode=E.ACTION_DELETE,s.set(s.idAttribute,t),s.set(s.nameAttribute,n),s.destroy({success:function(e,t){m.showDetailsSummary()}})},onClientPasswordChange:function(){this.clientPasswordDirty=!0},onToggleClientSelect:function(e){var t=(this.model.get(i.DP.ATTACHMENT_LIST)||[]).length>1,n=this.getAttachedVMs()||[],s=n.length+this.selectedClients.length,a=this.$(e.currentTarget),o=a.attr(E.NAV_ACTION_TARGET_NAME);t||this.isShareWarningDisplayed||!a.is(":checked")||1!==s||($.nutanixConfirm({msg:this.i18n("shareWarning"),no:function(){a.attr("checked",!1)},yesText:this.i18n("allow"),noText:E.LABEL_NO,context:this}),this.isShareWarningDisplayed=!0),a.is(":checked")&&_.indexOf(this.selectedClients)<0?this.selectedClients.push(o):this.selectedClients=_.without(this.selectedClients,o)},onToggleFlashMode:function(){this.flashModeDirty=!0},onToggleExternalAccess:function(){this.$("#external-access").is(":checked")&&v.violatedFeatureLicense(v.FEATURE_MAP.LICENSE_ABS_EXTERNAL)?this.$(".abs-external").slideDown():this.$(".abs-external").slideUp()},toggleSelectAllClients:function(e){var t=this.$(".client-select-all"),n=t.is(":checked"),s=this.getAttachedVMs()||[],a=(this.model.get(i.DP.ATTACHMENT_LIST)||[]).length>1,o=s.length+this.$("#iqn-list tbody tr").length;!a&&!this.isShareWarningDisplayed&&n&&o>1?($.nutanixConfirm({msg:this.i18n("shareWarning"),yes:function(){this._toggleSelectAll(n)},no:function(){t.attr("checked",!1)},yesText:this.i18n("allow"),noText:E.LABEL_NO,context:this}),this.isShareWarningDisplayed=!0):this._toggleSelectAll(n)},_toggleSelectAll:function(e){var t=this;e?this.$("#iqn-table .client-cb:checked").each(function(){var e=$(this).attr(E.NAV_ACTION_TARGET_NAME);t.selectedClients.push(e)}):this.selectedClients=[],this.$("#iqn-list tbody .client-cb").prop("checked",e)},isExternalClientAccessEnabled:function(){var e=f.getCurrentClusterModel();return!!e&&e.isExternalIscsiClientEnabled()}})}),define("models/genesis/StartAzureOnboardingModel",["models/genesis/LajollaGenesisBaseModel","utils/AppConstants"],function(e,t){"use strict";return e.extend({ERROR_MSG:"Failed to start Azure Onboarding",name:"StartAzureOnboardingModel",methodName:t.CLUSTER_MANAGER_METHODS.START_AZURE_ONBOARDING,getReturnResponse:function(){return this.get(e.DP.GENESIS_RETURN)||[]},setRPCParams:function(e){_.extend(this.kwargs,{param_dict:e})}})}),define("text!templates/popups/cluster/HypervPostDeploymentAzureOnboarding.html",[],function(){return'<div class="modal-header">\n  <button type="button" class="close" data-dismiss="modal">\n    <i data-icon="K" aria-hidden="true"></i>\n  </button>\n  <h4 class="n-title">Azure Onboarding</h4>\n  <div class="help-icon"><i aria-hidden="true" data-icon="O"></i></div>\n</div>\n\n<div class="n-modal-wrapper">\n  <div class="n-modal-content-wrapper">\n    <div class="n-modal-alert-header">\n      \x3c!-- alert goes here --\x3e\n    </div>\n\n    <div class="n-modal-content">\n      \x3c!-- Content goes here --\x3e\n      <form role="form" class="azureinfo-form form-horizontal">\n\n        <div class="group">\n          <label class="group-label control-label">\n            Azure Deployment</label>\n          <div class="control-group outer-table">\n            <table class="table">\n              <tbody>\n              <tr class="n-table-row">\n                <td class="colored-font">\n                  <span class="semi-bold">Step 1:</span>\n                  Login into your Console VM with domain credentials.\n                  <table class="table inner-table">\n                    <tbody>\n                    <tr class="n-table-row">\n                      <td class="">IP Address</td>\n                      <td class="dvmIpAddress">\x3c!-- DVM IP here --\x3e</td>\n                    </tr>\n                    </tbody>\n                  </table>\n                </td>\n              </tr>\n              <tr class="n-table-row">\n                <td class="colored-font"> <span class="semi-bold"> Step 2:\n                </span>Launch Azure\n                  Onboarding shortcut on\n                  your desktop.\n                </td>\n              </tr>\n              <tr class="n-table-row">\n                <td class="colored-font no-bottom-padding">\n                  <span class="semi-bold"> Step 3: </span> After\n                  completion come back and\n                  <a class="verification"> click here </a> to continue.\n                </td>\n              </tr>\n              </tbody>\n            </table>\n          </div>\n        </div>\n      </form>\n    </div>\n  </div>\n  <div class="n-modal-footer">\n    <button class="btnBack btn n-btn-form pull-left">\n      Back\n    </button>\n    <button class="btnCancel btn">\n      Cancel\n    </button>\n    <button class="btnDeploy btnSave btn -blue disabled"\n            title="Click to Save" data-loading-text="Saving...">\n      Deploy\n    </button>\n  </div>\n</div>'}),define("views/popups/cluster/HyperVAzureOnboardingView",["views/popups/cluster/HypervSetupPopupView","views/popups/cluster/HypervCpsDeploymentPopupView","models/genesis/StartAzureOnboardingModel","models/genesis/LajollaGetDvmDeploymentStatus","models/genesis/LajollaSubscriptionDetailsModel","models/genesis/AzureOnboardingStatusModel","text!templates/popups/cluster/HypervPostDeploymentAzureOnboarding.html","text!templates/popups/cluster/HypervSubscriptionDetails.html"],function(e,t,n,i,s,a,o,r){"use strict";var l=_.template(r);return t.extend({azureTemplate:_.template(o),render:function(){this.showAzureDeployment(),this.checkDvmDeploymentStatus(),this.checkAzureDeploymentStatus()},show:function(t){e.prototype.show.apply(this,arguments),this.applyNutanixInput()},onClickDeploy:function(){this.populateDictionaryWithSubscriptionDetails(),this.callAzureOnboardingGenesisRpc()},onClickConfirm:function(){this.populateDictionaryWitAuthDetails(),this.showAzureDeployment(),this.$(".outer-table").html(l()),this.showHeaderLoading(),this.$(".btnDeploy").prop("disabled",!0),this.populateDetails(),this.$(".btnDeploy").removeClass("disabled"),this.$(".btnBack").show(),this.$(".btnBack").toggleClass("backToAzureDeployment"),this.applyNutanixInput()},onClickVerification:function(){this.getAuthenticationDetails(),this.$(".admin-pwd-group").hide(),this.$(".adminPassword").removeClass("inputRequired"),this.$(".modal-header .n-title").text("Azure Onboarding"),this.applyNutanixInput()},checkDvmDeploymentStatus:function(){var e=this,t=new i;t.fetch({success:function(n,i){"Completed"!==t.getReturnResponse()&&(e.showHeaderError("CPS Deployment is not completed yet.Start Azure Onboarding once that is complete."),$(".verification").bind("click",!1))}})},checkAzureDeploymentStatus:function(){var e=this,t=new a;t.fetch({success:function(n,i){"Completed"===t.getReturnResponse()?(e.showHeaderError("Post onboarding Azure Deployment has been completed already."),$(".verification").bind("click",!1)):"Running"===t.getReturnResponse()&&(e.showHeaderError("Post onboarding Azure Deployment is in progress."),$(".verification").bind("click",!1))}})},populateDetails:function(){var e=new s;e.setRPCParams(this.dictionary[this.DICTIONARY_DETAILS.USERNAME],this.dictionary[this.DICTIONARY_DETAILS.PASSWORD]),this.fetchDetailsAndFillPopup(e)},callAzureOnboardingGenesisRpc:function(){var e=this,t=new n;t.setRPCParams(this.dictionary),t.fetch({success:function(t,n){e.$(".btnCancel").trigger("click")},error:function(t,n){e.showHeaderError(n)}})},populateDictionaryWitAuthDetails:function(){this.dictionary[this.DICTIONARY_DETAILS.USERNAME]=this.$(".userName").val(),this.dictionary[this.DICTIONARY_DETAILS.PASSWORD]=this.$(".password").val()}})}),define("text!templates/popups/pcdeployment/MultipleNodePCDeploymentOptionsView.html",[],function(){return"<div class=\"subview-content contentOptions\">\n  <section data-ntnx-section=\"type-text\" class=\"choose-option\">\n    <%= i18n('title_choose_option') %>\n  </section>\n\n  <section data-ntnx-section class=\"option optionDeploy text-center\">\n    <div class=\"content-wrapper\">\n      <h5 data-ntnx-title> <%= i18n('opt_new_pc') %></h5>\n      <section data-ntnx-section=\"type-text\"><%= i18n('desc_new_pc') %></section>\n      <div class='option-btn-container'>\n        <%= Components.button({\n          isPrimary: true,\n          extraClasses: 'btnDeploy',\n          extraAttr: [\n            {\n              key: 'action',\n              value: '_deploy_'\n            },\n            {\n              key: 'actionTarget',\n              value: 'install_image'\n            },\n            {\n              key: 'actionId',\n              value: 'install_image'\n            }\n          ],\n          text: i18n('btn_deploy')\n        }) %>\n      </div>\n    </div>\n    <div class=\"error-wrapper\">\n    </div>\n  </section>\n\n  <section data-ntnx-section class=\"option optionRegister text-center\">\n    <div class=\"content-wrapper\">\n      <h5 data-ntnx-title><%= i18n('opt_already_deployed') %></h5>\n      <section data-ntnx-section=\"type-text\">\n        <%= i18n('recommend_connect_pc') %>\n      </section>\n      <div class='option-btn-container'>\n        <%= Components.button({\n          isPrimary: true,\n          extraClasses: 'btnConnect',\n          extraAttr: [\n            {\n              key: 'action',\n              value: '_connect_'\n            }\n          ],\n          text: i18n('btn_connect')\n        }) %>\n      </div>\n    </div>\n    <div class=\"error-wrapper\">\n    </div>\n  </section>\n</div>\n"}),define("views/popups/pcdeployment/MultipleNodePCDeploymentOptionsView",["views/basecomponents/popups/BasePopupSubView","models/query/QueryResultCollection","utils/AppConstants","utils/HypervisorUtil","utils/CommonTemplates","utils/FilterUtil","utils/AppUtil","data/DataProperties","managers/ClusterManager","managers/AccessManager","managers/ActionManager","text!templates/popups/pcdeployment/MultipleNodePCDeploymentOptionsView.html"],function(e,t,n,i,s,a,o,r,l,c,d,p){"use strict";var u=_.template(p);return e.extend({el:"#subviewOptions",events:{"click .btnConnect":"onClickLinkAction","click .btnDeploy":"onClickLinkAction","click .alert a":"onAlertsLinkClicked"},setParentView:function(t){e.prototype.setParentView.apply(this,arguments),this.name=t.name},render:function(){var e=l.getCurrentClusterUuid(),t=i.hasHyperVOnly(e),s=i.hasXenOnly(e),a=i.isMixedHypervisorCluster(),o=void 0,r=void 0;i.hasESXOnly(e)?this.checkVCenter():(this.$el.html(u(this.vtOptions())),this.triggerAction(n.MODAL.ACT.AS_REBUILD));var d=c.hasAccessToV3();!d||t||s||a?(o=a?n.HYPERVISOR_LABEL.kMixed:s?n.HYPERVISOR_LABEL.kXen:n.HYPERVISOR_LABEL.kHyperv,r=d?this.getTooltipContent(o):this.i18n("AccessDeniedReasons.noAccessToV3"),this.$el.off("click",".btnDeploy"),this.$(".optionDeploy").tooltip({title:r,placement:"right",trigger:"hover",html:!0,container:$("body")}),this.$(".optionDeploy").addClass("not-active")):this.$(".optionDeploy").addClass("active")},getTooltipContent:function(e){return"<p>"+this.i18ns("tooltip_msg",e)+"</p>"},checkVCenter:function(){var e={}
;e=a.addFilterCondition(e,r.MGMT_SERVER_ATTR.MANAGEMENT_SERVER_TYPE,a.createFilterCondition(n.ENTITY_ALERT,r.MGMT_SERVER_ATTR.MANAGEMENT_SERVER_TYPE,n.FILTER_OPERATORS.EQUALS,n.ENTITY_VCENTER));var i=new t(null,{entity_type:n.ENTITY_MANAGEMENT_SERVER_INFO,group_member_attributes:[r.MGMT_SERVER_ATTR.EXTENSION_KEY,r.MGMT_SERVER_ATTR.MANAGEMENT_SERVER_TYPE,r.MGMT_SERVER_ATTR.CLUSTER_UUID],filter_expression:e});i.fetch().done(function(){var e=i.models,t=_.some(e,function(e){var t=e.get(r.MGMT_SERVER_ATTR.CLUSTER_UUID);if(l.getClusterModelByClusterUuid(t)&&e.get(r.MGMT_SERVER_ATTR.EXTENSION_KEY))return!0});if(this.$el.html(u(this.vtOptions())),!t){var a=s.ERROR_WITH_ACTION({error:this.i18n("register_vcenter"),routeObj:{action:n.ACTION_NAVIGATE_PAGE,actionTarget:n.ENTITY_MANAGEMENT_SERVER,actionTargetName:this.i18n("register_vcenter_link"),options:{}}});this.$(".optionDeploy .error-wrapper").html(a),this.$(".btnDeploy").addClass("disabled")}this.triggerAction(n.MODAL.ACT.AS_REBUILD)}.bind(this)).fail(function(e,t){this.showHeaderError(o.processAjaxError(t))}.bind(this))},onAlertsLinkClicked:function(e){var t=$(e.currentTarget),i=t.attr(n.NAV_ACTION),s=n.PAGE_SETTINGS,a=t.attr(n.NAV_ACTION_TARGET);d.executeAction({action:i,pageId:s,subPageId:a}),this.getParentView().destroy()}})}),define("text!templates/popups/pcdeployment/MultipleNodePCDeploymentCreateOptionsView.html",[],function(){return"\x3c!-- option page to choose deploy 3 nodes or single node --\x3e\n<div class=\"subview-content contentCreate_Options\">\n    <div class=\"option_scale pull-left\">\n      <div class=\"option_title\">\n        <p><%= i18n('option_scale_title') %></p>\n      </div>\n      <div class=\"option_desc\">\n        <div>\n          <span class=\"small-title\"><%= i18n('option_capacity_label') %></span>\n          <span class=\"small-description\"><%= i18n('scale_num_vm_range') %></span>\n        </div>\n        <div>\n          <span class=\"small-title\"><%= i18n('option_scale_resiliency_label') %></span>\n          <span class=\"small-description\"><%= i18n('option_scale_resiliency_desc') %></span>\n        </div>\n        <div>\n          <span class=\"small-title\"><%= i18n('option_scale_label3') %></span>\n          <span class=\"small-description\"><%= i18ns('option_memory_desc', 3 * minVMSize) %></span>\n        </div>\n      </div>\n      <%= Components.button({\n        isPrimary: true,\n        extraClasses: 'option_scale_btn',\n        extraAttr: [\n          { key: 'action', value: 'create_pc' },\n          { key: 'actionTarget', value: 'prism_central_vm' },\n          { key: 'actionTargetId', value: pcReleaseId }\n        ],\n        text: i18n('option_scale_btn')\n      }) %>\n    </div>\n\n    <div class=\"option_single pull-right\">\n      <div class=\"option_title\">\n        <p><%= i18n('option_single_title') %></p>\n      </div>\n      <div class=\"option_desc\">\n        <div>\n          <span class=\"small-title\"><%= i18n('option_capacity_label') %></span>\n          <span class=\"small-description\"><%= i18n('single_num_vm_range')%></span>\n        </div>\n        <div>\n          <span class=\"small-title\"><%= i18n('option_single_resiliency_label') %></span>\n        </div>\n        <div>\n          <span class=\"small-title\"><%= i18n('option_scale_label3') %></span>\n          <span class=\"small-description\"><%= i18ns('option_memory_desc', minVMSize)%></span>\n        </div>\n      </div>\n      <%= Components.button({\n        isPrimary: true,\n        extraClasses: 'option_single_btn',\n        extraAttr: [\n          { key: 'action', value: 'deploy_single' },\n          { key: 'actionTargetId', value: pcReleaseId }\n        ],\n        text: i18n('option_single_btn')\n      }) %>\n    </div>\n    <section data-ntnx-section class=\"warning-wrapper\">\n    </section>\n</div>\n"}),define("views/popups/pcdeployment/MultipleNodePCDeploymentCreateOptionsView",["views/basecomponents/popups/BasePopupSubView","models/query/QueryResultCollection","models/softwareupgrade/SoftwareReleaseCollection","utils/AppConstants","utils/HypervisorUtil","utils/CommonTemplates","utils/AppUtil","data/DataProperties","text!templates/popups/pcdeployment/MultipleNodePCDeploymentCreateOptionsView.html"],function(e,t,n,i,s,a,o,r,l){"use strict";var c=_.template(l);return e.extend({el:"#subviewCreate_Options",pcReleaseId:null,pcSizes:[],events:{"click .option_scale_btn":"onClickLinkAction","click .option_single_btn":"onClickLinkAction"},initialize:function(t){t&&t[i.NAV_ACTION_TARGET_ID]&&(this.pcReleaseId=t[i.NAV_ACTION_TARGET_ID],this.pcSizes=n.getPCSizeFromSharedInstance(this.pcReleaseId)),e.prototype.initialize.apply(this,arguments)},refreshView:function(e){e&&e.actionTargetId&&(this.pcReleaseId=e.actionTargetId,this.pcSizes=n.getPCSizeFromSharedInstance(this.pcReleaseId),this.renderViewContent(),this.checkSoftwareVersion())},setParentView:function(t){e.prototype.setParentView.apply(this,arguments),this.name=t.name},render:function(){var e=this.clusterManager.getCurrentClusterUuid();s.hasESXOnly(e)?(this.$el.html(a.LOADING_MSG({msg:this.i18n("loading")})),this.checkDRS()):this.renderViewContent()},checkDRS:function(){var e=this,n=new t(null,{entity_type:i.ENTITY_MANAGEMENT_SERVER_INFO,group_member_attributes:[r.MGMT_SERVER_ATTR.IN_USE,r.MGMT_SERVER_ATTR.DRS_ENABLED]});n.fetch().done(function(){var t=n.models,i=_.filter(t,function(e){return"true"===e.get(r.MGMT_SERVER_ATTR.DRS_ENABLED)&&"true"===e.get(r.MGMT_SERVER_ATTR.IN_USE)});if(e.renderViewContent(),_.isEmpty(i)){e.$(".warning-wrapper").show();var s=a.WARNING({msg:e.i18n("drs_not_enabled")});e.$(".warning-wrapper").html(s),e.$(".option_scale_btn").addClass("disabled")}e.checkSoftwareVersion()}).fail(function(t,n){e.$el.empty(),e.showHeaderError(o.processAjaxError(n))})},checkSoftwareVersion:function(){var e=!0;if(o.compareVersions(this.pcReleaseId,i.PC_SCALE_OUT_VERSION_GA,2)>=0&&(e=!1),e){this.$(".warning-wrapper").show();var t=a.WARNING({msg:this.i18n("version_warning")});this.$(".warning-wrapper").html(t),this.$(".option_scale_btn").addClass("disabled")}},renderViewContent:function(){var e=void 0;this.pcSizes&&(e=o.getPCSize(i.PCVM_TSHIRT_SIZE.SMALL,this.pcSizes)[r.MEMORY_SIZE_IN_GIB]),this.$el.html(c(this.vtOptions({pcReleaseId:this.pcReleaseId,minVMSize:e||i.PC_VM_MEMORY_SMALL_DEFAULT}))),this.triggerAction(i.MODAL.ACT.AS_REBUILD)}})}),define("text!templates/popups/pcdeployment/PCDeploymentVersionsView.html",[],function(){return'<div class="subview-content contentVersions">\n  <% if (!isMulticlusterUI) { %>\n    <section data-ntnx-section="type-title">\n      <h5 data-ntnx-title><%= i18n(\'install_image\') %></h5>\n    </section>\n    <section data-ntnx-section="type-text">\n      <%= i18n(\'install_image_desc\') %>\n    </section>\n\n\n    <section data-ntnx-section="type-title">\n      <h5 data-ntnx-title>\n        <%= i18n(\'available_versions\') %>\n        <div data-ntnx-title-link>\n          <%=\n            Components.checkbox({\n              checked: true,\n              id: \'hideIncompatibleRelease\',\n              labelText: i18n("hide_incompatible_versions"),\n              dataTestAttribute: \'test_hide_incompatible_pc_release\'\n            })\n          %>\n          <span id="incompatibleReleaseInfo"\n                data-toogle="tooltip"\n                data-original-title="<%= i18n(\'hide_incompatible_versions_explanation\') %>">\n            <%= Components.icon(\'Circular_Exclamation\', \'-info\') %>\n          </span>\n        </div>\n      </h5>\n    </section>\n    <section data-ntnx-section>\n      <table id="pcReleaseList" class="table table-hover n-table-versions">\n        <tbody>\n          <tr>\n            <td class="n-message loadingSpinner">\n              \x3c!-- @view: inline spinner goes here... --\x3e\n            </td>\n          </tr>\n        </tbody>\n      </table>\n    </section>\n\n    <section data-ntnx-section="type-title">\n      <h5 data-ntnx-title><%= i18n(\'upload_binary\') %></h5>\n    </section>\n\n    <section data-ntnx-section="type-text"\n      class="n-upload-description uploadInitialLink">\n      <%= i18n(\'upload_desc_1\') %>\n       <a class="linkUpload"><%= i18n(\'upload_desc_2\') %></a>\n       <%= i18n(\'upload_desc_3\') %>\n    </section>\n\n    <div class="n-upload-form-container uploadForm">\n      <form class="form-horizontal formUpload" target="upload_target"\n            method="post" enctype="multipart/form-data">\n        <section data-ntnx-section class="control-group">\n          <label data-ntnx-label for="inputMetadataFile">\n            <%= i18n(\'metadata_file\') %>\n          </label>\n          <%= Components.fileInput({id: \'inputMetadataFile\'}) %>\n        </section>\n\n        <section data-ntnx-section class="control-group">\n          <label data-ntnx-label for="inputTarFile">\n            <%= i18n(\'binary_file\') %>\n          </label>\n          <%= Components.fileInput({id: \'inputTarFile\'}) %>\n        </section>\n\n        <div class="n-upload-form-footer">\n          <a class="btn btn-primary btn-control pull-right btnConfirmUpload">\n            <%= i18n(\'upload_now\') %>\n          </a>\n          <a class="btn btn-control pull-right btnCancelUpload">\n            <%= i18n(\'cancel\') %>\n          </a>\n        </div>\n      </form>\n    </div>\n    <div class="n-upload-form-container uploadSpinner">\n      <section data-ntnx-section>\n        <div class="n-upload-processing">\n          <div class="n-inline-loading-container">\n            <div class="n-inline-loading"></div>\n              <%= i18n(\'uploading_file\') %>\n          </div>\n        </div>\n      </section>\n    </div>\n  <% } else { %>\n    <section data-ntnx-section>\n      <h5 data-ntnx-title>\n        <%= i18ns(\'download_image_failed_title\', hostClusterName) %>\n      </h5>\n    </section>\n    <section data-ntnx-section="type-text">\n      <%= i18ns(\'download_image_failed_desc\', hostClusterName) %>\n    </section>\n    <section data-ntnx-section="type-text">\n      <ol>\n        <li>\n          <%= i18ns(\'download_image_failed_suggest_1\', hostClusterName) %>\n        </li>\n        <li>\n          <%= i18n(\'download_image_failed_suggest_2\') %>\n        </li>\n      </ol>\n    </section>\n    <section data-ntnx-section>\n      <h5 data-ntnx-title><%= i18n(\'suggest_upload_image_title\') %></h5>\n    </section>\n    <section data-ntnx-section="type-text">\n      <%= i18ns(\'suggest_upload_image_desc\', hostClusterName,\n      \'<a class="linkDeployHelp">\' + i18n(\'here_link\') + \'</a>\') %>\n    </section>\n  <% } %>\n</div>\n'}),define("text!templates/popups/pcdeployment/PCDeploymentVersionRowsView.html",[],function(){return'\x3c!-- The tbody content will replace the inline spinner from the table\n     pcReleaseList\n--\x3e\n<tbody>\n<% if (pcReleaseCollection && pcReleaseCollection.length) { %>\n  <% _.each(pcReleaseCollection, function(release) { %>\n    <% var isDownload = release.transferType === transferTypeMap.DOWNLOAD,\n           isUpload = release.transferType === transferTypeMap.UPLOAD,\n           isAvailable = release.status === statusMap.AVAILABLE,\n           isProgress = release.status === statusMap.QUEUED ||\n                        release.status === statusMap.INPROGRESS,\n           isPaused = release.status === statusMap.PAUSED,\n           isCompleted = release.status === statusMap.COMPLETED,\n           isFailed = release.status === statusMap.FAILED,\n           isCorrupted = release.status === statusMap.CORRUPTED,\n           isMD5SumMismatch = release.status === statusMap.MD5SUMMISMATCH,\n           isPCCompatible = ClusterManager.getCurrentClusterModel()\n             .isCurrentPECompatibleWithPC(release.compatiblePeNosVersions);\n    %>\n    <tr>\n      <td class="n-col-version">\n        <div>\n          <%= release.name || release.version %>\n          <% if (!isPCCompatible) { %>\n            <%= warningIcon %>\n          <% } %>\n        </div>\n      </td>\n      <td class="n-col-download">\n        <div class="n-col-download-container">\n\n          <% if (isDownload && isAvailable) { %>\n            <%= Components.button({\n              extraClasses: \'btnDownload\',\n              extraAttr: [\n                { key: \'actionTargetId\', value: release.name },\n                { key: \'action\', value: \'create_option\' }\n              ],\n              text: i18n(\'download\')\n            }) %>\n\n          <% } else if (isProgress) {\n            var percent = release.totalSizeInBytes > 0 ? Math.max(0, Math.floor(\n                100 * release.currentSizeInBytes / release.totalSizeInBytes)) : 0;\n          %>\n            <div class="progress-container n-clearfix">\n              <div class="progress -compact">\n                <div class="progress-bar" role="progressbar"\n                     aria-valuenow="<%= percent %>" aria-valuemin="0"\n                     aria-valuemax="100" style="width: <%= percent %>%">\n                  <span class="sr-only"><%= percent %>% Complete</span>\n                </div>\n              </div>\n\n              <a data-id="<%= release.name %>"\n                class="btn-stop btn-control btnStop" title="Stop">\n                <%= i18n(\'cancel\') %>\n              </a>\n            </div>\n\n            <div class="progress-value">\n              <%= isDownload ? \'Downloading\' : \'Uploading\' %>\n              ... <%= percent %>%\n            </div>\n\n          <% } else if (isPaused) { %>\n            <button class="btn -default btn-control btnResume"\n                 data-id="<%= release.name %>">\n              <%= i18n(\'resume\') %>\n            </button>\n\n          <% } else if (isCompleted) { %>\n            <i data-id="<%= release.name %>"\n               class="btnDelete  btn-control success-delete install"\n               data-icon="v" aria-hidden="true" title="Delete">\n            </i>\n            <button class="btn btn-primary btn-control btnInstall"\n                 actionTargetId="<%= release.name %>"\n                 action="create_option">\n              <%= i18n(\'install\') %>\n            </button>\n          <% } else if (isMD5SumMismatch) { %>\n            <span class="status"><%= i18n(\'md5_sum_mismatch\') %></span>\n            <button class="btn btn-danger btn-control btnDelete"\n                 data-id="<%= release.name %>">\n              <%= i18n(\'delete\') %>\n            </button>\n          <% } else if (isFailed) { %>\n            <span class="status"><%= i18n(\'failed\') %></span>\n            <button class="btn btn-danger btn-control btnDelete"\n                 data-id="<%= release.name %>">\n              <%= i18n(\'delete\') %>\n            </button>\n\n          <% } else if (isCorrupted) { %>\n            <span class="status"><%= i18n(\'corrupted\') %></span>\n            <button class="btn btn-danger btn-control btnDelete"\n                 data-id="<%= release.name %>">\n              <%= i18n(\'delete\') %>\n            </button>\n          <% } %>\n\n        </div>\n      </td>\n    </tr>\n  <% }); %>\n<% } else { %>\n  <tr>\n    <td class="n-message">\n      <%= hideIncompatibleRelease ? i18n(\'no_compatible_versions\') : i18n(\'no_available_versions\') %>\n    </td>\n  </tr>\n<% } %>\n</tbody>\n'}),define("views/popups/pcdeployment/PCDeploymentVersionsView",["views/basecomponents/popups/BasePopupSubView","models/softwareupgrade/SoftwareReleaseCollection","models/multicluster/UploadMulticlusterModel","utils/AppConstants","utils/AppUtil","utils/SVG","utils/CommonTemplates","managers/IdleManager","managers/ClusterManager","components/Components","data/DataProperties","text!templates/popups/pcdeployment/PCDeploymentVersionsView.html","text!templates/popups/pcdeployment/PCDeploymentVersionRowsView.html"],function(e,t,n,i,s,a,o,r,l,c,d,p,u){"use strict";var h=_.template(p),m=_.template(u);return e.extend({el:"#subviewVersions",pcReleases:null,uploadModel:null,events:{"click .btnInstall":"onClickLinkAction","click .btnDownload":"onClickLinkAction","click .btnStop":"onStopClick","click .btnResume":"onResumeClick","click .btnDelete":"onDeleteClick","click .linkUpload":"onLinkUploadClick","click .btnCancelUpload":"onBtnCancelUploadClick","click .btnConfirmUpload":"onBtnConfirmUploadClick","click #hideIncompatibleRelease":"renderReleaseList"},modelEvents:{"reset pcReleases":"onPcReleasesReset"},initialize:function(n){e.prototype.initialize.apply(this,arguments),this.pcReleases=t.getSharedPCDeploySoftwareCollection(),this.delegateModelEvents()},setParentView:function(t){e.prototype.setParentView.apply(this,arguments),this.name=t.name},destroy:function(){t.releaseSharedPCDeployInstance(),this.$("#incompatibleReleaseInfo").tooltip("destroy"),e.prototype.destroy.apply(this,arguments)},render:function(){var e=this.clusterManager.isMulticlusterUI(),t=void 0;e&&(t=this.parentView.actionRoute.actionTargetId),this.$("#incompatibleReleaseInfo").tooltip("destroy"),this.$el.html(h(this.vtOptions({isMulticlusterUI:e,hostClusterName:t}))),this.$("#incompatibleReleaseInfo").tooltip({placement:"left"}),this.triggerAction(i.MODAL.ACT.AS_REBUILD),s.addInLineDonutLoader(this.$(".loadingSpinner")),this.$(".uploadSpinner",".uploadFrom").addClass("hide")},onStartServices:function(){this.pcReleases.startPolling({force:!0})},onStopServices:function(){this.pcReleases.stopPolling()},confirmExit:function(e){_.isNull(this.uploadModel)?e():$.nutanixConfirm({msg:this.i18n("cancel_upload_confirm"),yes:function(){this.uploadModel.abortUpload(),e()}.bind(this),yesText:this.i18n("yes"),noText:this.i18n("no")})},refreshView:function(){this.clusterManager.isMulticlusterUI()||this.reset()},reset:function(){this.$(".uploadInitialLink").removeClass("hide"),this.$(".uploadForm").addClass("hide"),this.$(".uploadSpinner").addClass("hide"),this.triggerAction(i.MODAL.ACT.AS_REBUILD),this.resetUploadForm()},resetUploadForm:function(){this.$(".formUpload")[0].reset(),this.$(".file-input > .filename").removeAttr("title").html(this.i18nStatic(c.name,"fileInput.defaultFilenameText"))},startUpload:function(e){var t=this;this.$(".uploadInitialLink").addClass("hide"),this.$(".uploadForm").addClass("hide"),this.$(".uploadSpinner").removeClass("hide"),r.skipAutoLogout=!0;var s=this.$(".formUpload"),a=s.find("#inputMetadataFile"),o=s.find("#inputTarFile"),l={metadataFile:{name:a.val(),file:a[0].files[0]},binaryFile:{name:o.val(),file:o[0].files[0]}};if(l.binaryFile.name.indexOf(i.TAR_GZ_SUFFIX)>0)return this.$(".uploadInitialLink").removeClass("hide"),this.$(".uploadForm").removeClass("hide"),this.$(".uploadSpinner").addClass("hide"),void this.showHeaderError(this.i18n("binary_file_error"));_.isUndefined(e)||(l.offset=e);var c=this.checkMetadataRequired(l,e);if(c.length)return this.showHeaderError(c.join(" ")),this.$(".uploadInitialLink").removeClass("hide"),this.$(".uploadForm").removeClass("hide"),void this.$(".uploadSpinner").addClass("hide");this.uploadModel=new n,this.uploadModel.on("error",function(e){t.showHeaderError(e),t.$(".uploadForm").removeClass("hide"),t.$(".uploadSpinner").addClass("hide"),r.skipAutoLogout=!1,t.pcReleases.startPolling({force:!0}),t.uploadModel=null}),this.uploadModel.on("success",function(e){t.$(".uploadSpinner").addClass("hide"),e&&e.paused?t.$(".uploadForm").removeClass("hide"):(t.$(".uploadInitialLink").removeClass("hide"),t.resetUploadForm()),r.skipAutoLogout=!1,t.uploadModel=null,t.pcReleases.stopPolling(),t.pcReleases.startPolling({force:!0})}),this.pcReleases.stopPolling(),this.uploadModel.uploadPrismCentralRelease(l,{callbackFetchList:function(){t.pcReleases.startPolling({force:!0})}})},checkMetadataRequired:function(e,t){var i=[];return e[n.DP.METADATA]&&e[n.DP.METADATA][n.DP.NAME]&&e[n.DP.METADATA][n.DP.FILE]&&0!==e[n.DP.METADATA][n.DP.NAME].length||i.push(t?this.i18n("error_reupload_metadata"):this.i18n("error_select_metadata")),e[n.DP.BINARY]&&e[n.DP.BINARY][n.DP.NAME]&&e[n.DP.BINARY][n.DP.FILE]&&0!==e[n.DP.BINARY][n.DP.NAME].length||i.push(t?this.i18n("error_reupload_binary"):this.i18n("error_select_binary")),i},onPcReleasesReset:function(){this.renderReleaseList(),this.triggerAction(i.MODAL.ACT.AS_REBUILD)},renderReleaseList:function(){var e=this.$("#hideIncompatibleRelease").prop("checked"),t=this.pcReleases.toJSON();e&&(t=t.filter(function(e){return l.getCurrentClusterModel().isCurrentPECompatibleWithPC(e.compatiblePeNosVersions)})),this.$("#pcReleaseList").html(m(this.vtOptions({ClusterManager:l,warningIcon:o.WARNING_ICON_SMALL_CUSTOM({SVG:a,reason:this.i18n("pc_incompatible_warning"),className:"non-compat-pc-warn"}),hideIncompatibleRelease:e,pcReleaseCollection:t,statusMap:i.UPGRADE_SOFTWARE_RELEASE_STATUS,transferTypeMap:i.UPGRADE_TRANSFER_TYPE})))},onStopClick:function(e){var t=this,n=$(e.currentTarget).attr("data-id"),i=this.pcReleases.find(function(e){return e.get(d.NAME)===n});i&&(this.pcReleases.stopPolling(),this.uploadModel&&this.uploadModel.abortUpload(),i.cancelTransfer({success:function(e,n,i){t.pcReleases.startPolling({force:!0})},error:function(e,n,i){t.showHeaderError(t.i18n("error_cannot_cancel_transfer")),t.pcReleases.startPolling({force:!0})}}))},onResumeClick:function(e){var t=$(e.currentTarget).attr("data-id"),n=this.pcReleases.find(function(e){return e.get(d.NAME)===t});if(n){var i=n.get(d.UPGRADE_CURRENT_SIZE_IN_BYTES);this.startUpload(i)}},onDeleteClick:function(e){var t=this,n=$(e.currentTarget).attr("data-id"),i=this.pcReleases.find(function(e){return e.get(d.NAME)===n});i&&(this.pcReleases.stopPolling(),i.destroy({success:function(e,n,i){t.pcReleases.startPolling({force:!0})},error:function(e,n,i){t.showHeaderError(t.i18n("error_cannot_delete_release")),t.pcReleases.startPolling({force:!0})}}))},onLinkUploadClick:function(){this.$(".uploadInitialLink").addClass("hide"),this.$(".uploadForm").removeClass("hide"),this.triggerAction(i.MODAL.ACT.AS_REBUILD)},onBtnCancelUploadClick:function(){this.$(".uploadInitialLink").removeClass("hide"),this.$(".uploadForm").addClass("hide"),this.resetUploadForm(),this.triggerAction(i.MODAL.ACT.AS_REBUILD)},onBtnConfirmUploadClick:function(){this.startUpload()}})}),define("models/multicluster/RegisterMulticlusterModel",["models/BaseModel","data/DataURLConstants","utils/AppConstants"],function(e,t,n){"use strict";return e.extend({urlRoot:t.MULTICLUSTER_REGISTER,entityType:n.ENTITY_CLUSTER,actionMode:n.ACTION_UPDATE,enableNotifications:!1,defaults:{username:null,password:null},name:"RegisterMulticlusterModel"})}),define("text!templates/popups/clusterregister/MulticlusterRegisterFormView.html",[],function(){return'<form name="formMulticlusterRegisterView">\n\n  <% var sDisabled = canModify ? \'\' : \'disabled\'; %>\n\n  <section data-ntnx-section>\n    <label data-ntnx-label for="ipAddresses">\n      <%= isFQDNEnabled ? i18n(\'form_pc_ip_or_fqdn\') : i18n(\'form_pc_ip\') %>\n    </label>\n    <input  type="text" class="inputIpAddress" id="ipAddresses"\n      name="ipAddresses"\n      model-validate="required" model-attribute="ip-address" <%= sDisabled %>\n    >\n    <div data-ntnx-hint class="ipAddressError input-error-msg"></div>\n  </section>\n\n  <section data-ntnx-section>\n    <label data-ntnx-label for="port">\n      <%= i18n(\'form_port\') %>\n      <span data-ntnx-label-flag><%= i18n(\'optional\') %></span>\n    </label>\n    <input  type="text" class="inputPort" id="ipPort"\n      name="port"\n      model-attribute="port" <%= sDisabled %>\n    >\n    <div data-ntnx-hint class="portError input-error-msg"></div>\n  </section>\n\n  <section data-ntnx-section>\n    <label data-ntnx-label for="username">\n      <%= i18n(\'form_pc_username\') %>\n    </label>\n    <input type="text" id="username" name="username"\n      model-validate="required" model-attribute="username" <%= sDisabled %>\n    >\n  </section>\n\n  <section data-ntnx-section>\n    <label data-ntnx-label for="password">\n      <%= i18n(\'form_pc_password\') %>\n    </label>\n    <input type="password" id="password" name="password"\n      model-validate="required" model-attribute="password" <%= sDisabled %>\n    >\n  </section>\n\n</form>'}),define("views/popups/clusterregister/MulticlusterRegisterFormView",["views/basecomponents/BaseSubView","models/multicluster/RegisterMulticlusterModel","models/cluster/ClusterExternalStateModel","managers/ClusterManager","managers/TaskManager","managers/NotificationManager","utils/ValidationUtil","utils/AppConstants","utils/CommonTemplates","data/DataProperties","events/AppEvents","text!templates/popups/clusterregister/MulticlusterRegisterFormView.html"],function(e,t,n,i,s,a,o,r,l,c,d,p){"use strict";var u=_.template(p);return e.extend({el:"#multiclusterRegisterFormView",name:"MulticlusterRegisterFormView",clusterExternalStateModel:null,initialize:function(t){e.prototype.initialize.apply(this,arguments),this.clusterExternalStateModel=t&&t.clusterExternalStateModel,this.isFQDNEnabled=this.isFFEnabled(r.FFLAGS.FQDN_REGISTRATION)},render:function(){if(this.clusterExternalStateModel){var e=s.getGlobalTasks().getLatestPcDeploymentTask(),t=this.canModifyByEntityType(r.ENTITY_MULTICLUSTER_MANAGEMENT)&&(e&&e.isTaskCompleted()||!e);this.$el.html(u(this.vtOptions({canModify:t,isFQDNEnabled:this.isFQDNEnabled})))}else this.$el.html(l.LOADING_MSG({msg:this.i18n("loading")})),this.loadData()},loadData:function(){this.clusterExternalStateModel=new n;var e=this;this.clusterExternalStateModel.fetch().always(function(){e.initialized=!0,e.render()})},reset:function(){this.clearForm(),this.showFormUnregistered()},showFormUnregistered:function(){this.$(".inputIpAddress").removeAttr("readonly").removeAttr("tabindex").focus()},clearForm:function(){this.$("input").val("")},parseForm:function(){var e=this.$("form[name=formMulticlusterRegisterView]"),t=e.get(0).elements,n=o.validateFormValues(e);if(n.length)return o.defaultErrorHandler(e,n),null;var i=e.find(".inputIpAddress"),s=t.port.value.trim();this.$(".ipAddressError").empty();var a=o.isValidIP(i.val()),r=!1;if(!a){if(!this.isFQDNEnabled)return this.$(".ipAddressError").html(this.i18n("enter_valid_ip")),null;if(!(r=o.isValidDomainName(i.val())))return this.$(".ipAddressError").html(this.i18n("invalid_ip_or_fqdn")),null}if(this.$(".portError").empty(),s&&!o.isValidPort(s))return this.$(".portError").html(this.i18n("enter_valid_port")),null;var l={port:parseInt(s,10),username:t.username.value.trim(),password:t.password.value.trim()};return r?l[c.CLUSTER_FQDN]=t.ipAddresses.value.trim():l.ipAddresses=[t.ipAddresses.value.trim()],l},registerMulticluster:function(e){var n=this.parseForm();if(this.clusterExternalStateModel&&this.clusterExternalStateModel.isRegisteredToPC()||_.isNull(n))return void(e.error&&e.error());var i=new t;this._changeMulticlusterRegistration(i,n,this.i18n("error_registering"),e)},_changeMulticlusterRegistration:function(e,t,n,s){var o=e.set(t),l=this,p=i.getCurrentClusterModel();p&&(e[c.NAME]=p.get(c.NAME)),o&&e.save(null,{success:function(e,t){s.success&&s.success();var n=a.showLatencyMessage(l.i18n("registration_triggered"));d.triggerAppEvent(r.CHANGE_EVENTS.PC_REGISTRATION_TRIGGERED,_.extend({},t,{latencyId:n}))},error:function(e,t){t?s.error(null,t):s.error()}})}})}),define("text!templates/popups/pcdeployment/PCDeploymentRegisterView.html",[],function(){return'<div class="subview-content contentRegister">\n  <section data-ntnx-section="type-subtitle" class="register-title">\n    <h5 data-ntnx-title><%= i18n(\'title_connect_to_existing\') %></h5>\n  </section>\n  <section data-ntnx-section="type-text" class="register-desc">\n    <p><%= i18n(\'desc_fill_info\') %></p>\n  </section>\n\n  <div id="subviewForm">\n    \x3c!-- @view: MulticlusterRegisterFormView goes here --\x3e\n  </div>\n</div>\n'}),define("views/popups/pcdeployment/PCDeploymentRegisterView",["views/basecomponents/popups/BasePopupSubView","views/popups/clusterregister/MulticlusterRegisterFormView","utils/SubViewHelper","utils/AppConstants","data/DataProperties","managers/LicenseManager","text!templates/popups/pcdeployment/PCDeploymentRegisterView.html"],function(e,t,n,i,s,a,o){"use strict";var r=_.template(o);return e.extend({el:"#subviewRegister",subViewHelper:null,clusterExternalStateModel:null,initialize:function(t){if(e.prototype.initialize.apply(this,arguments),this.subViewHelper=new n,this.clusterExternalStateModel=t.clusterExternalStateModel,!this.clusterExternalStateModel)throw new Error("Can not fetch the cluster states.")},refreshView:function(){0===this.clusterExternalStateModel.get(s.CLUSTER_EXTERNAL_STATE).length&&this.subViewHelper.get("subview_form").reset()},setParentView:function(t){e.prototype.setParentView.apply(this,arguments),this.name=t.name},render:function(){this.$el.html(r(this.vtOptions()));var e=new t({el:this.$("#subviewForm"),multiclusterName:i.MULTICLUSTER_NAME,clusterExternalStateModel:this.clusterExternalStateModel});e.setParentView(this),this.subViewHelper.register("subview_form",e),e.render(),this.showForm();var n=a.FEATURE_MAP.LICENSE_PRISM_CENTRAL;a.violatedFeatureLicense(n)&&this.showHeaderWarning(a.getPopupMessageTemplate(n)),this.triggerAction(i.MODAL.ACT.AS_REBUILD)},showForm:function(){this.clearForm()},clearForm:function(){this.subViewHelper.get("subview_form").clearForm()},reset:function(){this.subViewHelper.get("subview_form").reset()},destroy:function(){this.subViewHelper.destroy(),e.prototype.destroy.apply(this,arguments)},saveViewData:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.clusterExternalStateModel.isRegisteredToPC()?_.isFunction(e.cancel)&&e.cancel():this.onRegisterClick(e)},onRegisterClick:function(e){this.subViewHelper.get("subview_form").registerMulticluster(e)}})}),define("text!templates/popups/pcdeployment/SingleNodePCDeploymentCreateView.html",[],function(){
return'<div class="subview-content contentCreate">\n  <form name="newVM" class="n-form-rows">\n    <section data-ntnx-section="type-subtitle">\n      <h5 data-ntnx-title><%= i18n(\'title_general_config\') %></h5>\n    </section>\n    <section data-ntnx-section>\n      <label data-ntnx-label><%= i18n(\'form_vm_name\') %></label>\n      <input type="text" model-validate="required"\n          name="vmName" model-attribute="vmName" class="vmName">\n      <div class="n-input-validation-msg"></div>\n    </section>\n\n    <section data-ntnx-section class="containers">\n    </section>\n\n    <section data-ntnx-section="type-separator" class="group">\n      <section data-ntnx-section="type-subtitle">\n        <h5 data-ntnx-title><%= i18n(\'form_vm_sizing\') %></h5>\n      </section>\n      <section data-ntnx-section="type-text">\n        <%= i18n(\'desc_vm_sizing_1\') %>\n      </section>\n      <section data-ntnx-section class="vm-sizing-table">\n          \x3c!-- Table with t-shirt sizing for VM attributes comes here --\x3e\n      </section>\n    </section>\n\n    <section data-ntnx-section="type-separator" class="group">\n      <section data-ntnx-section="type-subtitle">\n        <h5 data-ntnx-title><%= i18n(\'form_network_config\') %></h5>\n      </section>\n\n        <% if (isKvm) { %>\n          <section data-ntnx-section>\n            <label data-ntnx-label class="acropolis-network-label">\n              <%= i18n(\'form_network_acropolis\') %>\n            </label>\n\n            <% if (canCreateNetwork) { %>\n              <a class="btnCreateNetwork pull-right"\n                 action="create_network"\n                 actionTarget="acropolis_network">\n                <i data-icon="H" aria-hidden="true"></i>\n                <%= i18n(\'form_network_create\') %>\n              </a>\n            <% } %>\n          </section>\n        <% } %>\n\n        <% if (isKvm || isEsx) { %>\n          <section data-ntnx-section class="networkListContainer">\n            \x3c!-- Select box will be dynamically created and populated --\x3e\n          </section>\n\n          <section data-ntnx-section>\n            <label data-ntnx-label><%= i18n(\'form_ip_address\') %></label>\n            <input type="text" name="ipAddress" model-validate="required"\n                    model-attribute="ipAddress" placeholder="0.0.0.0"\n                    class="ipAddress">\n          </section>\n\n          <section data-ntnx-section>\n            <label data-ntnx-label><%= i18n(\'form_subnet_mask\') %></label>\n            <input type="text" name="subnetMask" model-validate="required"\n                    model-attribute="subnetMask" placeholder="0.0.0.0"\n                    class="ipAddress">\n          </section>\n\n          <section data-ntnx-section>\n            <label data-ntnx-label><%= i18n(\'form_default_gateway\') %></label>\n            <input type="text" name="gateway" model-validate="required"\n                    model-attribute="gateway" placeholder="0.0.0.0"\n                    class="ipAddress">\n          </section>\n\n          <section data-ntnx-section>\n            <label data-ntnx-label><%= i18n(\'form_dns_addresses\') %>\n              <span data-ntnx-label-flag><%= i18n(\'optional\') %></span>\n            </label>\n            <input type="text" name="nameservers" class="nameservers"\n                   model-attribute="nameservers" placeholder="0.0.0.0">\n          </section>\n        <% } %>\n    </section>\n  </form>\n</div>\n'}),define("views/popups/pcdeployment/SingleNodePCDeploymentCreateView",["views/basecomponents/popups/BasePopupSubView","views/basecomponents/datatables/DetailsTableView","views/basecomponents/datatables/DataTableTemplates","models/network/AcropolisNetworkCollection","models/multicluster/PCVMModel","models/storage/ContainerCollection","models/storage/DatastoreCollection","models/hardware/HostCollection","models/softwareupgrade/SoftwareReleaseCollection","events/AppEvents","utils/HypervisorUtil","utils/AppUtil","utils/AppConstants","utils/ValidationUtil","data/DataProperties","components/Components","managers/ClusterManager","managers/AccessManager","managers/IntentManager","text!templates/popups/pcdeployment/SingleNodePCDeploymentCreateView.html"],function(e,t,n,i,s,a,o,r,l,c,d,p,u,h,m,f,v,g,E,T){"use strict";var C=_.template(T),S=_.template('<div align="right" class="<%= className %>"><%= data %></div>'),A=_.template("<label data-ntnx-label><%=label%></label>");return e.extend({el:"#subviewCreate",networksCollection:null,containersCollection:null,pcSizeSmall:{},pcSizeLarge:{},pcReleaseId:null,events:{"click .btnCreateNetwork":"onClickLinkAction","change #networkUuid":"onSelectNetwork"},initialize:function(t){e.prototype.initialize.apply(this,arguments),_.bindAll(this,"onNetworkCreated"),this.pcReleaseId=t[u.NAV_ACTION_TARGET_ID]},onStartServices:function(){c.onAppEvent(c.ENTITIES_CREATED,this.onNetworkCreated),e.prototype.onStartServices.apply(this,arguments)},onStopServices:function(){c.offAppEvent(c.ENTITIES_CREATED,this.onNetworkCreated),e.prototype.onStopServices.apply(this,arguments)},setParentView:function(t){e.prototype.setParentView.apply(this,arguments),this.name=t.name},render:function(){var e=v.getCurrentClusterUuid(),t=d.isAcropolisEnabled(e)&&g.isFFEnabled(u.FFLAGS.UI_ACROPOLIS);this.$el.html(C(this.vtOptions({isEsx:d.hasESX(e),isKvm:d.hasKVMOnly(e),canCreateNetwork:t,clusterName:this.clusterManager.getCurrentClusterName()}))),this.listStorageContainer(),this.renderSizingTable(),this.triggerAction(u.MODAL.ACT.AS_REBUILD)},refreshView:function(e){e&&(this.pcReleaseId=e[u.NAV_ACTION_TARGET_ID],this.setVersionId(e[u.NAV_ACTION_TARGET_ID]),this.updatePCSize(),this.renderSizingTable(),e[u.NAV_ACTION_TARGET]||this.reset())},updatePCSize:function(){var e=l.getPCSizeFromSharedInstance(this.pcReleaseId);e&&(this.pcSizeSmall=p.getPCSize(u.PCVM_TSHIRT_SIZE.SMALL,e),this.pcSizeLarge=p.getPCSize(u.PCVM_TSHIRT_SIZE.LARGE,e))},reset:function(){this.clearForm(),this.listNetworks()},setVersionId:function(e){this.$("form[name=newVM]").attr("data-id",e)},clearForm:function(){this.$("input").val("")},listStorageContainer:function(){var e=this;this.containersCollection=new a,this.containersCollection.setProxyClusterUuid(this.proxyClusterUuid);var t=function(t){e.$(".containers").html(A({label:"Select a container"})+f.select({id:"containerSelect",name:"containerName",jsClasses:"container-list",options:t}))};t([]);var n=this.clusterManager.getCurrentClusterUuid(),i=d.hasESX(n),s=[],l=[],c=[];s.push(this.containersCollection.fetch()),i&&(this.datastoreCollection=new o,this.hostCollection=new r,s.push(this.datastoreCollection.fetch()),s.push(this.hostCollection.fetch())),$.when.apply($,s).done(function(){if(i){var n=_.groupBy(e.datastoreCollection.models,function(e){return e.get(m.CONTAINER_UUID)}),s=e.hostCollection.models.length;e.containersCollection.each(function(e){var t=n[e.get(m.CONTAINER_UUID)];t&&t.length===s?l.push({name:e.get(m.NAME),value:e.get(m.CONTAINER_UUID)}):c.push({name:e.get(m.NAME),value:e.get(m.CONTAINER_UUID)})})}else e.containersCollection.each(function(e){l.push({name:e.get(m.NAME),value:e.get(m.CONTAINER_UUID)})});l.length?t(l):(c.length?e.showHeaderError(e.i18n("no_mounted_container")):e.showHeaderError(e.i18n("no_container")),$(".btnUpdate").addClass("disabled"))}).fail(function(e,t){this.showHeaderError(t.responseText)})},listNetworks:function(e){var t=this;_.isNull(this.networksCollection)&&(this.networksCollection=new i(null,{useUhuraAPI:!0}));var n=function(e){t.$(".networkListContainer").html(f.select({id:"networkUuid",jsClasses:"networkList",options:e})),t.onSelectNetwork()};n([]),this.networksCollection.fetch({success:function(i){var s=[];t.networksCollection.each(function(t){t.isInternal()||s.push({name:t.getDisplayName(),value:t.getUuid(),selected:t.getUuid()===e})}),n(s)},error:function(e,n){t.parentView.showHeaderError(n.responseText)}})},renderSizingTable:function(){var e=this,i=new t({el:this.$(".vm-sizing-table"),scrollHeight:"130px",minimumRows:2,columns:[{sTitle:this.i18n("title_size"),mData:"size",mRender:function(e,t,i){return n.RADIO_ROW_LABEL({groupName:"vm-size-radio-group",value:e,label:e,checked:i.checked,Components:f})}},{sTitle:this.i18n("title_vcpus"),mData:"vcpu",mRender:function(e,t,n){return S({className:"vcpus",data:e})}},{sTitle:this.i18n("title_memory"),mData:"mem",mRender:function(e,t,n){return S({className:"mem",data:e})}},{sTitle:this.i18n("title_storage"),mData:"storage",mRender:function(e,t,n){return S({className:"storage",data:e})}}]});i.render(),i.updateDataSource([{size:this.i18n("size_small"),vcpu:this.pcSizeSmall[m.VCPUS]||u.PC_VM_VCPU_SMALL_DEFAULT,mem:this.pcSizeSmall[m.MEMORY_SIZE_IN_GIB]||u.PC_VM_MEMORY_SMALL_DEFAULT,storage:this.pcSizeSmall[m.DISK_SIZE_IN_GIB]||u.PC_VM_DISK_SIZE_SMALL_DEFAULT,checked:!0},{size:this.i18n("size_large"),vcpu:this.pcSizeLarge[m.VCPUS]||u.PC_VM_VCPU_LARGE_DEFAULT,mem:this.pcSizeLarge[m.MEMORY_SIZE_IN_GIB]||u.PC_VM_MEMORY_LARGE_DEFAULT,storage:this.pcSizeLarge[m.DISK_SIZE_IN_GIB]||u.PC_VM_DISK_SIZE_LARGE_DEFAULT,checked:!1}]),setTimeout(function(){e.$("input[name=vm-size-radio-group]").first().trigger("click")},250)},parseForm:function(){var e=void 0,t=this.$("form[name=newVM]"),n=t.get(0).elements,i=h.validateFormValues(t);if(i.length)return e=h.defaultErrorHandler(t,i),e&&this.showHeaderError(e),null;var s=this,a=!0;t.find(".ipAddress").each(function(){var t=$(this);p.isValidIP(t.val())||(e=s.i18n("invalid_ip"),a=!1)});var o=""!==n.nameservers.value.trim();o&&t.find(".nameservers").each(function(){var t=$(this),n=t.val().split(",");_.each(n,function(t){p.isValidIP(t.trim())||(e=s.i18n("invalid_dns_ip"),a=!1)})});var r=t.find("input[name=vm-size-radio-group]:checked").closest("tr").find("td"),l=[];if(_.each(n.nameservers.value.split(","),function(e){l.push(e.trim())}),a){var c={vm_name:n.vmName.value.trim(),container_uuid:n.containerSelect.value.trim(),num_sockets:parseInt(r.find(".vcpus").text()||0),data_disk_size_bytes:parseInt(r.find(".storage").text()||0,10)*Math.pow(u.UNITS_PER_K,3),memory_size_bytes:parseInt(r.find(".mem").text()||0,10)*Math.pow(u.UNITS_PER_K,3),dns_server_ip_list:l,nic_list:[{ip_list:[n.ipAddress.value.trim()],network_configuration:{network_uuid:n.networkUuid.value.trim(),subnet_mask:n.subnetMask.value.trim(),default_gateway:n.gateway.value.trim()}}]};return o||delete c.dns_server_ip_list,{version:t.attr("data-id"),should_auto_register:!1,pc_vm_list:[c]}}return this.showHeaderError(e),null},onSelectNetwork:function(){this.$("input[name=ipAddress],input[name=subnetMask],input[name=gateway],input[name=nameservers]").attr("readonly",!0).val("").removeClass("form-control-error").siblings(".validation-error").remove();var e=this.$("#networkUuid").val();if(e&&!_.isNull(this.networksCollection)){var t=this.networksCollection.find(function(t){return t.getUuid()===e});if(t&&t.isManagedNetwork()){var n=t.V2_DP[t.V2_DP.IP_CONFIG],i=n[t.DP.DHCP_OPTIONS],s=p.convertPrefixLengthToSubnetMask(t.getIpConfigAttr(n.PREFIX_LENGTH)),a=t.getIpConfigAttr(n.DEFAULT_GATEWAY),o=t.getDhcpOptionsAttr(i.DNS_SERVERS);this.$("input[name=ipAddress]").removeAttr("readonly"),_.isUndefined(s)||_.isNull(s)?this.$("input[name=subnetMask]").removeAttr("readonly"):this.$("input[name=subnetMask]").val(s),_.isUndefined(a)?this.$("input[name=gateway]").removeAttr("readonly"):this.$("input[name=gateway]").val(a),_.isUndefined(o)?this.$("input[name=nameservers]").removeAttr("readonly"):this.$("input[name=nameservers]").val(o)}else this.$("input[name=ipAddress],input[name=subnetMask],input[name=gateway],input[name=nameservers]").removeAttr("readonly",!0)}},onNetworkCreated:function(e,t){e.type===c.ENTITIES_CREATED&&t.entityType===u.ENTITY_ACROPOLIS_NETWORK&&this.listNetworks(t.entity.get("networkUuid"))},saveViewData:function(e){var t=this,n=this.parseForm();if(_.isNull(n))e.error();else{new s({resources:n}).save(null,{success:function(t,n,i){var s=t.get(m.TASK_UUID_V3);c.triggerAppEvent(c.ENTITIES_CREATED,{entityType:u.ENTITY_TASK,entity:null,taskUuid:s,operationType:u.TASK_OPERATION_PC_DEPLOYMENT}),e.success()},error:function(e,n,i){t.parentView.showHeaderErrorWithDetails(t.i18n("serverError"),E.interpretIntentServerError(n))}})}}})});define("text!templates/popups/clusterregister/ClusterRegistrationNotificationView.html",[],function(){return'<div class="subview-content registration-notification contentRegister_Notification">\n  <section data-ntnx-section>\n    <table class="table table-hover">\n      <thead>\n      <tr class="n-table-row">\n        <th class="col-feature">\n          <%= i18n(\'feature_service\') %>\n        </th>\n        <th class="align-center">\n          <%= i18n(\'pe\') %>\n        </th>\n        <th class="align-center ">\n          <%= i18n(\'pc\') %>\n        </th>\n      </tr>\n      </thead>\n      <tbody>\n      <tr class="n-table-row">\n        <td >\n          <%= i18n(\'cluster_unregistration\') %>\n        </td>\n        <td class="align-center">\n          <p class="no-margin">\n            <%= Components.icon("check", "-small") %>\n          </p>\n          <%= i18n(\'available_by_scripts_only\') %>\n        </td>\n        <td class="align-center">\n          <p class="no-margin">\n            <%= Components.icon("check", "-small") %>\n          </p>\n          <%= i18n(\'available_by_scripts_only\') %>\n        </td>\n      </tr>\n      <tr class="n-table-row">\n        <td>\n          <%= i18n(\'ssp\') %>\n        </td>\n        <td class="align-center">\n          <%= Components.icon("x-square", "-small") %>\n        </td>\n        <td class="align-center">\n          <%= Components.icon("check", "-small") %>\n        </td>\n      </tr>\n      </tbody>\n    </table>\n  </section>\n</div>\n'}),define("views/popups/clusterregister/ClusterRegistrationNotificationView",["views/basecomponents/popups/BasePopupSubView","utils/AppConstants","text!templates/popups/clusterregister/ClusterRegistrationNotificationView.html"],function(e,t,n){"use strict";var i=_.template(n);return e.extend({render:function(){var e=i(this.vtOptions({}));return this.$el.html(e),this.triggerAction(t.MODAL.ACT.AS_REBUILD),this},setParentView:function(t){e.prototype.setParentView.apply(this,arguments),this.name=t.name}})}),define("text!templates/popups/pcdeployment/MultipleNodePCDeploymentContentView.html",[],function(){return'\x3c!-- The parent div modal is #popupPCScaleDeployment --\x3e\n<div data-ntnx-content-inner>\n  <div id="subviewOptions">\n    \x3c!-- @view: MultipleNodePCDeploymentOptionsView goes here --\x3e\n  </div>\n\n  <div id="subviewCreate">\n    \x3c!-- @view: SingleNodePCDeploymentCreateView goes here --\x3e\n  </div>\n\n  <div id = "subviewRegister_Notification">\n    \x3c!-- @view: ClusterRegistrationNotificationView goes here --\x3e\n  </div>\n\n  <div id="subviewRegister">\n    \x3c!-- @view: PCDeploymentRegisterView goes here --\x3e\n  </div>\n\n  <div id="subviewVersions">\n    \x3c!-- @view: PCDeploymentVersionsView goes here --\x3e\n  </div>\n\n  <div id = "subviewCreate_Options">\n    \x3c!-- @view: MultipleNodePCDeploymentCreateOptionsView goes here --\x3e\n  </div>\n  <div class="pc-deployment-loader">\n    <section data-ntnx-section>\n      <%=  CommonTemplates.LOADING_MSG({msg: i18n(\'loading\')})%>\n    </section>\n  </div>\n\n  <div class="pc-deployment-info" style="display:none">\n    <section data-ntnx-section class="pc-deployment-info-section">\n    </section>\n  </div>\n</div>\n'}),define("views/popups/pcdeployment/PCDeploymentPopupView",["views/basecomponents/popups/BasePopupView","views/popups/pcdeployment/MultipleNodePCDeploymentOptionsView","views/popups/pcdeployment/MultipleNodePCDeploymentCreateOptionsView","views/popups/pcdeployment/PCDeploymentVersionsView","views/popups/pcdeployment/PCDeploymentRegisterView","views/popups/pcdeployment/SingleNodePCDeploymentCreateView","views/popups/clusterregister/ClusterRegistrationNotificationView","models/cluster/ClusterExternalStateModel","events/AppEvents","managers/ActionManager","managers/NavigationManager","managers/TaskManager","utils/AppConstants","utils/SubViewHelper","utils/AppUtil","utils/CommonTemplates","text!templates/popups/pcdeployment/MultipleNodePCDeploymentContentView.html"],function(e,t,n,i,s,a,o,r,l,c,d,p,u,h,m,f,v){"use strict";var g=_.template(v),E={DEPOLY:"_deploy_",CONNECT:"_connect_",CREATE_OPTION:"create_option",DEPLOY_SINGLE:"deploy_single"};return e.extend({SUBVIEW_OPTIONS:"Options",SUBVIEW_CREATE_OPTIONS:"Create_Options",SUBVIEW_REGISTER:"Register",SUBVIEW_VERSIONS:"Versions",SUBVIEW_CREATE:"Create",SUBVIEW_NOTIFICATION:"Register_Notification",el:"#popupPCScaleDeployment",name:"PCDeploymentPopupView",subViewHelper:null,activeSubView:null,isDeploySinglePC:!1,previousSubview:"Options",initialized:!1,clusterExternalStateModel:null,deployOption:null,events:{"click .modal-header .close":"hide","click .btnCancel":"hide","click .btnClose":"hide","click .btnBack":"onBackClick","click .btnUpdate":"onSave","click .btnSave":"onSave","click .btnNext":"onNext","keypress input":"onKeyPress","click input":"clearHeader","click .docLink":"onDocLinkClick","click .linkDeployHelp":"onClickDeployHelp"},initialize:function(){e.prototype.initialize.apply(this,arguments),this.subViewHelper=new h,this.clusterExternalStateModel=r.getSharedInstance(),_.bindAll(this,"onTaskCreated","externalPopupClosed"),l.onAppEvent(l.ENTITIES_CREATED,this.onTaskCreated)},loadData:function(){var e=this;this.clusterExternalStateModel.fetch({success:function(){e.$(".pc-deployment-loader").hide(),e.showSubviews()},error:function(t,n){e.$(".n-modal-footer").addClass("hide"),e.$(".pc-deployment-loader").hide(),e.showHeaderError(n.responseText||e.i18n("serverError"))}})},render:function(){var e=[{text:this.i18n("back"),extraClasses:"btnBack hide",leftAligned:!0},{text:this.i18n("btn_unregister"),extraClasses:"btnSave hide",leftAligned:!0,isPrimary:!0},{text:this.i18n("cancel"),extraClasses:"btnCancel"},{text:this.i18n("close"),extraClasses:"btnClose pull-right hide",rightAligned:!0},{text:this.i18n("next"),extraClasses:"btnNext hide",rightAligned:!0,isPrimary:!0},{text:this.i18n("update"),extraClasses:"btnUpdate hide",isPrimary:!0}];this.$el.html(this.defaultTemplate({bodyContent:g(this.vtOptions({CommonTemplates:f})),antiscroll:!1,footerButtons:this.defaultFooter(e)})),this.clusterManager.isMulticlusterUI()?this.$(".n-title").text(this.i18n("image_download_error")):this.$(".n-title").text(this.i18n("prism_central")),this.clusterExternalStateModel.getState()===u.STATE_SUCCESS&&this.clusterExternalStateModel.isDataLoaded()?(this.$(".pc-deployment-loader").hide(),this.showSubviews()):this.loadData()},destroy:function(){this.subViewHelper.iterate("stopServices"),this.subViewHelper.destroy(),this.timeout&&(clearTimeout(this.timeout),this.timeout=null),l.offAppEvent(l.ENTITIES_CREATED,this.onTaskCreated),e.prototype.destroy.apply(this,arguments)},showSubviews:function(e){var t=p.getGlobalTasks(),n=t.getLatestPcDeploymentTask(),i=t.getLatestTaskForType(u.TASK_OPERATION_PC_REGISTRATION);this.clusterManager.isMulticlusterUI()?(this.setActiveSubView(this.SUBVIEW_VERSIONS),this.$(".btnCancel").hide(),this.$(".btnClose").removeClass("hide n-secondary-btn").addClass("show btn-primary"),this.$(".btnBack").hide()):this.clusterExternalStateModel.isRegisteredToPC()||i&&!i.isTaskCompleted()?this.clusterExternalStateModel.remoteConnectionExists()?this.showRegisteredPCInfo(this.clusterExternalStateModel):this.showRegisteringLoader(this.clusterExternalStateModel):n&&!n.isTaskCompleted()?(this.showDeploymentInProgress(),this.$(".btnUpdate").hide(),this.$(".btnBack").hide()):this.setActiveSubView(this.SUBVIEW_OPTIONS)},showRegisteringLoader:function(e){var t=this;this.showCloseButtonOnly();var n=e.getMulticlusterIpAddresses()||[];this.$(".pc-deployment-info").show(),this.$(".pc-deployment-info-section").html(f.LOADING_MSG({msg:this.i18ns("registering",_.first(n)||"")})),this.timeout&&clearTimeout(this.timeout),this.timeout=setTimeout(function(){t.loadData(),t.timeout=null},3e3)},showRegisteredPCInfo:function(e){this.$(".n-title").html(this.i18nStatic("common","unregisterPE.unregister_title")),this.createHelpIcon({actionTarget:u.ENTITY_CLUSTER,action:u.ACTION_UNREGISTER}),this.showCloseButtonOnly();var t=e.getMulticlusterIpAddresses()||[],n=this.clusterManager.getCurrentClusterModel(),i=this.i18nsStatic("common","unregisterPE.msg_registered",n.getName(),_.first(t)||""),s=f.DOCUMENT_LINK({here:this.i18nStatic("common","unregisterPE.here"),action:u.ACTION_UNREGISTER,actionTarget:u.ENTITY_CLUSTER}),a=this.i18nsStatic("common","unregisterPE.unregister_instruction",s);this.$(".pc-deployment-info").show();var o=f.PE_UNREGISTER_TEMPLATE(this.vtOptions({registrationInfo:i,unregisterInstruction:a}));this.$(".pc-deployment-info-section").html(o),this.triggerAction(u.MODAL.ACT.AS_REBUILD)},showDeploymentInProgress:function(){this.showCloseButtonOnly(),this.$(".pc-deployment-info").show(),this.$(".pc-deployment-info-section").html(this.i18ns("msg_deployment",u.MULTICLUSTER_NAME)),this.triggerAction(u.MODAL.ACT.AS_REBUILD)},showCloseButtonOnly:function(){this.$(".btnCancel").hide(),this.$(".btnSave").hide(),this.$(".btnBack").hide(),this.$(".btnUpdate").hide(),this.$(".btnClose").show()},onClickLinkAction:function(e){var t=$(e.currentTarget),n=t.attr(u.NAV_ACTION),i={};i[u.NAV_ACTION]=n,i[u.NAV_ACTION_TARGET_ID]=t.attr(u.NAV_ACTION_TARGET_ID),n===E.DEPOLY?this.setActiveSubView(this.SUBVIEW_VERSIONS,i):n===E.CONNECT?this.setActiveSubView(this.SUBVIEW_NOTIFICATION,i):n===u.ACTION_CREATE_NETWORK?(this.$el.hide(),l.onAppEvent(l.POPUP_CLOSE,this.externalPopupClosed),c.executeActionElement(e.currentTarget)):n===E.CREATE_OPTION?this.setActiveSubView(this.SUBVIEW_CREATE_OPTIONS,i):n===u.ACTION_CREATE_PC?(this.deployOption=u.DEPLOY_OPTION.MULTI_NODE,this.$el.hide(),l.onAppEvent(l.POPUP_CLOSE,this.externalPopupClosed),c.executeActionElement(e.currentTarget)):n===E.DEPLOY_SINGLE&&(this.deployOption=u.DEPLOY_OPTION.SINGLE_NODE,this.setActiveSubView(this.SUBVIEW_CREATE,i))},onDocLinkClick:function(e){var t=$(e.currentTarget);this.navigateToHelpPage({action:t.attr(u.NAV_ACTION),actionTarget:t.attr(u.NAV_ACTION_TARGET)})},onClickDeployHelp:function(){this.navigateToHelpPage(this.actionRoute)},showSubview:function(){this.$(".subview-content").hide(),e.prototype.showSubview.apply(this,arguments)},confirmHide:function(e){var t=this.subViewHelper.get(this.activeSubView);t&&t.confirmExit?t.confirmExit(function(){t.stopServices(),e()}):e()},setActiveSubView:function(e,t){this.previousSubview=this.subViewHelper.get(this.activeSubView),this.previousSubview&&this.previousSubview.stopServices(),this.clearHeader();var n=this.subViewHelper.get(e);n?n.refreshView(t):n=this.createSubView(e,t);var i=null,s=null,a=null;switch(e){case this.SUBVIEW_OPTIONS:_.isNull(this.activeSubView)||(i="right"),a=this.i18n("close"),this.$(".btnBack").hide(),this.$(".btnUpdate").hide(),this.$(".btnNext").hide();break;case this.SUBVIEW_NOTIFICATION:i="left",a=this.i18n("cancel"),this.$(".btnBack").show(),this.$(".btnUpdate").hide(),this.$(".btnNext").show();break;case this.SUBVIEW_REGISTER:s=this.i18n("btn_connect"),i="left",a=this.i18n("cancel"),this.$(".btnNext").hide(),this.$(".btnBack").show(),this.$(".btnUpdate").show();break;case this.SUBVIEW_VERSIONS:i="left",this.$(".antiscroll-inner").scrollTop(0),a=this.i18n("cancel"),this.$(".btnBack").show();break;case this.SUBVIEW_CREATE_OPTIONS:a=this.i18n("cancel"),this.$(".btnUpdate").hide(),this.$(".btnBack").show();break;case this.SUBVIEW_CREATE:s=this.i18n("btn_deploy"),a=this.i18n("close"),this.$(".btnUpdate").show(),this.$(".btnBack").show();break;default:return}n.refreshView(t);var o=this.$(".n-modal-body");this.activeSubView&&o.removeClass("body-"+this.activeSubView.toLowerCase()),o.addClass("body-"+e.toLowerCase()),_.isNull(s)||this.$(".btnUpdate").text(s),_.isNull(a)||this.$(".btnCancel").text(a),this.activeSubView=e,this.showSubview(".content"+e,i,!1),n.startServices(),e===this.SUBVIEW_CREATE_OPTIONS?this.showHeaderInfo(this.i18n("deploy_desc")):e===this.SUBVIEW_NOTIFICATION&&this.showHeaderInfo(this.i18n("registration_notification"))},createSubView:function(e,r){var l=null;switch(e){case this.SUBVIEW_OPTIONS:l=new t;break;case this.SUBVIEW_NOTIFICATION:l=new o({el:"#subviewRegister_Notification"});break;case this.SUBVIEW_REGISTER:l=new s({clusterExternalStateModel:this.clusterExternalStateModel});break;case this.SUBVIEW_VERSIONS:l=new i;break;case this.SUBVIEW_CREATE_OPTIONS:l=new n(r);break;case this.SUBVIEW_CREATE:l=new a(r);break;default:return null}return l.setParentView(this),this.subViewHelper.register(e,l),l.render(),l},onBackClick:function(){var e=null,t={};switch(this.activeSubView){case this.SUBVIEW_VERSIONS:case this.SUBVIEW_REGISTER:case this.SUBVIEW_NOTIFICATION:e=this.SUBVIEW_OPTIONS;break;case this.SUBVIEW_CREATE_OPTIONS:e=this.SUBVIEW_VERSIONS;break;case this.SUBVIEW_CREATE:e=this.SUBVIEW_CREATE_OPTIONS;break;default:e=this.SUBVIEW_OPTIONS}if(!_.isNull(e)){var n=this;this.confirmHide(function(){n.setActiveSubView(e,t)})}},onNext:function(){this.clearHeader(),this.setActiveSubView(this.SUBVIEW_REGISTER)},onSave:function(e){var t=e&&$(e.currentTarget),n=this;t||(t=this.activeSubView===this.SUBVIEW_REGISTER&&this.clusterExternalStateModel.isRegisteredToPC()?this.$(".btnSave"):this.$(".btnUpdate"));var i=this.subViewHelper.get(this.activeSubView);i&&(t.hasClass("btnSave")&&t.button("loading"),i.saveViewData({success:function(){d.isCurrentPage(u.PAGE_SETTINGS)?(n.$(".subview-content").hide(),n.showRegisteringLoader(n.clusterExternalStateModel)):n.hide()},error:function(e,i){t.button("reset"),e&&i?n.showHeaderErrorWithDetails(e,i):i&&n.showHeaderError(m.processAjaxError(i.responseText))},cancel:function(){t.button("reset")}}))},onEnterKeyPress:function(e){this.onSave()},onTaskCreated:function(e,t){e.type===l.ENTITIES_CREATED&&t.entityType===u.ENTITY_TASK&&t.operationType===u.TASK_OPERATION_PC_DEPLOYMENT&&this.hide()},externalPopupClosed:function(e,t){t&&(t.action===u.ACTION_CREATE_PC||t.action===u.ACTION_CREATE_NETWORK&&this.deployOption===u.DEPLOY_OPTION.SINGLE_NODE)&&(this.$el.show(),l.offAppEvent(l.POPUP_CLOSE,this.externalPopupClosed))}})}),define("text!templates/popups/pcdeployment/MultipleNodePCDeploymentCreateContentView.html",[],function(){return'<div data-ntnx-content-inner class="content-create">\n  <form name="newVM">\n    <% if (!isMulticlusterUI) { %>\n      <section data-ntnx-section>\n        <div class="alert-container-1"></div>\n        <h5 data-ntnx-title><%= i18n("title_vm_nums") %></h5>\n      </section>\n      <section data-ntnx-section>\n        <%=Components.radio({\n          class:"vm_size_radio",\n          name: "choose_vm_size",\n          checked: true,\n          value: "small" })%>\n        <label data-ntnx-inline-label><%= i18n("up_to_5k") %></label>\n        <p data-ntnx-hint class="vm_size_desc">\n          <%= i18ns("recommend_small_vms", vcpuSmall, memorySizeSmall)%>\n        </p>\n      </section>\n      <section data-ntnx-section>\n        <%=Components.radio({\n          class:"vm_size_radio",\n          name: "choose_vm_size",\n          value: "large"})%>\n        <label data-ntnx-inline-label><%= i18n("up_to_25k")%></label>\n        <p data-ntnx-hint class="vm_size_desc">\n          <%= i18ns("recommend_large_vms", vcpuLarge, memorySizeLarge) %>\n        </p>\n      </section>\n    <% } %>\n    <section data-ntnx-section="type-separator" class="group">\n      <div class="alert-container-2">\n      </div>\n      <% if (!isMulticlusterUI) { %>\n        <h5 data-ntnx-title><%= i18n(\'pc_config\') %></h5>\n      <% } %>\n    </section>\n    <section class="group network-config">\n      <section data-ntnx-section="type-third" class="network">\n      </section>\n\n      <section data-ntnx-section="type-third" class="subnet-mask">\n        <label data-ntnx-label><%= i18n(\'subnet_mask\') %></label>\n        <input type="text" name="subnetMask" class="subnetMask ipAddress">\n      </section>\n\n      <section data-ntnx-section="type-third" class="gateway">\n        <label data-ntnx-label><%= i18n(\'gateway\') %></label>\n        <input type="text" name="gateway" class="gateway ipAddress" >\n      </section>\n\n      <section data-ntnx-section class="ip-config">\n        <div class="html-svg-wrapper">\n          \x3c!-- here is the SVG layer --\x3e\n          <div class="viz-main-container">\n          </div>\n\n          \x3c!-- here is the HTML layer --\x3e\n          <div class="ip-address-group">\n            <div class="virtual-ip">\n              <% if (isMulticlusterUI){ %>\n                <div class="has-virtual-ip"></div>\n                <div class="no-virtual-ip"></div>\n              <% } else { %>\n                <label data-ntnx-label>\n                  <%= i18n(\'virtual_ip\') %>\n                  <span class="tooltip-virtual-ip"></span>\n                  <span data-ntnx-label-flag class="vip-optional">\n                    <%= i18n(\'optional\') %>\n                  </span>\n                </label>\n                <input class="form-control virtualIp" name = "virtualIp"\n                       type="text"\n                       data-id="virtual-ip">\n              <% } %>\n            </div>\n            <div class="pcvm-ip-address-group">\n              <% if (isMulticlusterUI){ %>\n                <div class="cluster-name"></div>\n                <div class="vm-num"></div>\n                <div class="new-vm-num"></div>\n              <% } %>\n              <section data-ntnx-section class="containers">\n              </section>\n            </div>\n          </div>\n        </div>\n      </section>\n\n      <% if (!isMulticlusterUI){ %>\n        <section data-ntnx-section class="dns-address">\n          <label data-ntnx-label>\n            <%= i18n(\'dns_address\') %>\n            <span data-ntnx-label-flag><%= i18n(\'optional\') %></span>\n          </label>\n          <input type="text" name="nameservers" class="nameservers" >\n        </section>\n      <% } %>\n    </section>\n  </form>\n\n  <div class="n-modal-footer n-clearfix">\n    <%= Components.button({\n      extraClasses: \'btnCancel\',\n      text: i18n(\'close\')\n    }) %>\n    <%= Components.button({\n      extraClasses: \'btnUpdate\',\n      isPrimary: true,\n      text: isMulticlusterUI ? i18n(\'btn_expand\') : i18n(\'btn_deploy\')\n    }) %>\n  </div>\n</div>\n'}),define("text!templates/popups/pcdeployment/MultipleNodePCDeploymentVMNameConfigView.html",[],function(){return'<div class="tile-wrapper active" data-id="<%= dataId %>" index="<%= vmIndex %>">\n  <div class="ip-addresses">\n    <div class="vm-name-wrapper">\n      <div class="vm-name">\n        <input type="text"\n               class="input-data pc-vm-name"\n               value="<%= vmName %> "\n               index="<%= vmIndex %>"\n               placeholder=\'PC-NameOption-<%= vmIndex %>\'\n               readonly>\n      </div>\n      <div class=\'ip-info\'>\n        <input type="text"\n               class="input-data ipAddress pc-vm-ip"\n               value="<%= pcVmIp %>"\n               index="<%= vmIndex %>"\n               placeholder=\'0.0.0.0\' readonly>\n      </div>\n    </div>\n    <div class="info">\n      <span class="cpu-info"><%=vcpu%> <%=i18n("vcpus")%></span>\n      <span class="storage-info"><%=memorySize%> <%=i18n("memory")%></span>\n    </div>\n  </div>\n  <div class="edit-link">\n    <i class="btnEdit" data-icon="F" aria-hidden="true" index="<%= vmIndex %>">\n    </i>\n    <span class="save-button" style="display:none" index="<%= vmIndex %>">\n      <%= Components.icon("check-thick", "pass-icon -small -inline")%>\n    </span>\n    <span class="cancel-button" style="display:none" index="<%= vmIndex %>">\n      <%= Components.icon("x-square", "fail-icon -small -inline")%>\n    </span>\n  </div>\n</div>\n'}),
define("views/popups/pcdeployment/MultipleNodePCDeploymentCreatePopupView",["components/Components","events/AppEvents","backbone","views/basecomponents/popups/BasePopupView","views/viz/VizView","views/popups/multicluster/clustermanagement/PCVirtualIPDetailsPopupView","models/storage/ContainerCollection","models/network/AcropolisNetworkCollection","models/query/QueryResultCollection","models/multicluster/PCVMModel","models/storage/DatastoreCollection","models/hardware/HostCollection","models/softwareupgrade/SoftwareReleaseCollection","data/DataProperties","utils/HypervisorUtil","utils/AppConstants","utils/AppUtil","utils/ValidationUtil","utils/CommonTemplates","utils/FilterUtil","utils/SubViewHelper","utils/PCScaleOutMixin","utils/StatsUtil","managers/ActionManager","managers/AccessManager","managers/IntentManager","views/basecomponents/vantagepoints/elements/PrismCentralVantagePointTemplates","text!templates/popups/pcdeployment/MultipleNodePCDeploymentCreateContentView.html","text!templates/popups/pcdeployment/MultipleNodePCDeploymentVMNameConfigView.html"],function(e,t,n,i,s,a,o,r,l,c,d,p,u,h,m,f,v,g,E,T,C,S,A,b,y,I,w,P,N){"use strict";var R=_.template(P),D=_.template(N),M=_.template("<label data-ntnx-label><%=label%></label>");return i.extend(_.extend({},S,{SUBVIEW_CONNECTORS:"subview_connectors",el:"#popupPCScaleDeploymentCreate",containersCollection:null,datastoreCollection:null,hostCollection:null,networks:null,pcVmIps:null,vmNames:null,name:"MultipleNodePCDeploymentCreatePopupView",overlayPopup:!0,pcReleaseId:null,pcVMModel:null,networksCollection:null,subViewHelper:null,hostLeftMemoryList:[],pcSizeSmall:{},pcSizeLarge:{},events:{"keypress input":"onKeyPress","click  .btnEdit":"onClickEdit","click  .modal-header .close":"hide","click  .btnCancel":"hide","click  .btnUpdate":"onUpdateClick","click  .save-button":"onEditActionClick","click  .cancel-button":"onEditActionClick","change #networkUuid":"onSelectNetwork","change .virtualIp":"onVirtualIpChanged","click  input:not(.input-data)":"clearError","click  input:radio":"onVMSizeSelect","click .edit-virtual-ip":"onEditVirtualIpClick"},initialize:function(e){this.pcVmIps=[],this.vmNames=[];for(var t=0;t<f.INITIAL_PC_VM_NO;t++)this.pcVmIps[t]="";this.pcVMModel=new c,this.subViewHelper=new C,i.prototype.initialize.apply(this,arguments),_.bindAll(this,"externalPopupClosed","onNetworkCreated")},show:function(e){this.pcReleaseId=e.actionTargetId,i.prototype.show.apply(this,arguments)},render:function(){if(this.clusterManager.isMulticlusterUI())this.$el.html(this.defaultTemplate({title:this.i18n("add_pc_vms"),antiscroll:!1,bodyContent:R(this.vtOptions({isMulticlusterUI:!0})),footer:!1})),this.loadData(),this.$(".no-virtual-ip").hide(),this.$(".has-virtual-ip").hide(),this.showHeaderInfo(this.i18n("scale_desc"));else{var e=u.getPCSizeFromSharedInstance(this.pcReleaseId);e&&(this.pcSizeSmall=v.getPCSize(f.PCVM_TSHIRT_SIZE.SMALL,e),this.pcSizeLarge=v.getPCSize(f.PCVM_TSHIRT_SIZE.LARGE,e));var t=this.clusterManager.getCurrentClusterUuid(),n=m.hasESX(t),i=m.hasKVMOnly(t),s=this.pcSizeSmall[h.MEMORY_SIZE_IN_GIB]||f.PC_VM_MEMORY_SMALL_DEFAULT,a=this.pcSizeLarge[h.MEMORY_SIZE_IN_GIB]||f.PC_VM_MEMORY_LARGE_DEFAULT,o=this.pcSizeSmall[h.VCPUS]||f.PC_VM_VCPU_SMALL_DEFAULT,r=this.pcSizeLarge[h.VCPUS]||f.PC_VM_VCPU_LARGE_DEFAULT;this.$el.html(this.defaultTemplate({title:this.i18n("deploy_prism_central"),antiscroll:!1,bodyContent:R(this.vtOptions({isEsx:n,isKvm:i,pcReleaseId:this.pcReleaseId,isMulticlusterUI:!1,memorySizeSmall:s,memorySizeLarge:a,vcpuSmall:o,vcpuLarge:r})),footer:!1}));var l="<p>"+this.i18n("tooltip_virtual_ip")+"</p>";this.$(".tooltip-virtual-ip").nutanixMoreInfo({title:l,placement:"top",trigger:"hover",html:!0,container:"body"}),this.listStorageContainer(),this.listNetworks(),this.showHeaderInfo(this.i18n("deploy_desc"))}},loadData:function(){var e=this,t=this.clusterManager.getPrismCentralClusterUuid();this.pcVMModel.setProxyClusterUuid(t),this.pcVMModel.fetch({success:function(){var t=e.pcVMModel.getNetworkConfiguration()[e.pcVMModel.DP.NETWORK_UUID],n=e.pcVMModel.getContainerUuid();e.loadNetworkAndContainer(t,n)},error:function(t,n){e.showHeaderError(n.responseText)}})},loadNetworkAndContianerSuccess:function(e,t){this.showForm(e,t)},loadNetworkAndContainerError:function(e,t){this.showHeaderError(t.responseText)},showForm:function(t,n){var i=this.pcVMModel.DP,s=this.pcVMModel.getNetworkConfiguration(),a=s[i.DEFAULT_GATEWAY],o=s[i.SUBNET_MASK],r=this.pcVMModel.getHostedClusterUuid(),l=this.clusterManager.getNameById(r),c=(this.pcVMModel.getNumOfSockets(),this.pcVMModel.getMemorySize(),this.pcVMModel.getVirtualIP()),d=this.pcVMModel.getContainerUuid();this.pcVmIps=this.pcVMModel.getVMIPList(),this.vmNames=this.pcVMModel.getVMNameList(),this.$(".cluster-name").html(l),this.$(".containers").html(e.select({id:"containerSelect",name:"containerName",jsClasses:"container-list",options:[{name:n,value:d}]})),this.$(".container-list").attr("disabled","disabled"),this.$(".network").html(M({label:"network"})+e.select({id:"networkUuid",jsClasses:"networkList",options:[{name:t}]})),this.$(".networkList").prop("disabled",!0),this.$(".subnetMask").val(o).prop("disabled",!0),this.$(".gateway").val(a).prop("disabled",!0),this.$(".vm-num").html(this.pcVmIps.length+" "+v.getEntityNameFromCount(f.ENTITY_VM,this.pcVmIps.length)),1===this.pcVmIps.length?(this.$(".n-title").html(this.i18n("scale_out_pc")),this.$(".new-vm-num").html(this.i18n("two_new"))):this.$(".new-vm-num").html(this.i18n("one_new")),this.renderVirtualIp(c),this.renderIpAddressesView()},renderVirtualIp:function(e){e?(this.$(".no-virtual-ip").hide(),this.$(".has-virtual-ip").show(),this.$(".has-virtual-ip").html(w.HAS_VIRTUAL_IP_TEMPLATE(this.vtOptions({virtualIP:e})))):(this.$(".has-virtual-ip").hide(),this.$(".no-virtual-ip").show(),this.$(".no-virtual-ip").html(w.NO_VIRTUAL_IP_TEMPLATE(this.vtOptions())))},updateStorageInfo:function(e,t){this.$(".cpu-info").html(e+" "+this.i18n("vcpus")),this.$(".storage-info").html(t+" "+this.i18n("memory"))},destroy:function(){t.offAppEvent(t.ENTITIES_CREATED,this.onNetworkCreated),this.$(".tooltip-virtual-ip").nutanixMoreInfo("destroy"),this.subViewHelper.destroy(),this.subViewHelper=null,i.prototype.destroy.apply(this,arguments)},listStorageContainer:function(){this.containersCollection=new o,this.containersCollection.setProxyClusterUuid(this.proxyClusterUuid);var t=this,n=function(n){t.$(".containers").html(M({label:"Select a container"})+e.select({id:"containerSelect",name:"containerName",jsClasses:"container-list",options:n}))};n([]);var i=this.clusterManager.getCurrentClusterUuid(),s=m.hasESX(i),a=[],r=[],l=[];a.push(this.containersCollection.fetch()),s&&(this.datastoreCollection=new d,this.hostCollection=new p,a.push(this.datastoreCollection.fetch()),a.push(this.hostCollection.fetch())),$.when.apply($,a).done(function(){if(s){var e=_.groupBy(t.datastoreCollection.models,function(e){return e.get(h.CONTAINER_UUID)}),i=t.hostCollection.models.length;t.containersCollection.each(function(t){var n=e[t.get(h.CONTAINER_UUID)];n&&n.length===i?r.push({name:t.get(h.NAME),value:t.get(h.CONTAINER_UUID)}):l.push({name:t.get(h.NAME),value:t.get(h.CONTAINER_UUID)})})}else t.containersCollection.each(function(e){r.push({name:e.get(h.NAME),value:e.get(h.CONTAINER_UUID)})});r.length?(n(r),t.renderIpAddressesView()):(l.length?t.showHeaderError(t.i18n("no_mounted_container")):t.showHeaderError(t.i18n("no_container")),$(".btnUpdate").addClass("disabled"))}).fail(function(e,n){t.showHeaderError(n.responseText)})},listNetworks:function(t){_.isNull(this.networksCollection)&&(this.networksCollection=new r(null,{useUhuraAPI:!0}));var n=this,i=function(t){n.$(".network").html(M({label:"network"})+e.select({id:"networkUuid",jsClasses:"networkList",options:t,attributes:'actionTarget="'+f.ENTITY_ACROPOLIS_NETWORK+'" action="'+f.ACTION_CREATE_NETWORK+'"'})),n.onSelectNetwork()};i([]),this.networksCollection.fetch({success:function(e){var s=[];s.push({value:"",name:n.i18n("select_or_create_network"),class:"selectANetwork"}),n.networksCollection.each(function(e){e.isInternal()||s.push({name:e.getDisplayName(),value:e.getUuid(),selected:e.getUuid()===t})});var a=n.clusterManager.getCurrentClusterUuid(),o=m.hasKVMOnly(a);m.isAcropolisEnabled(a)&&y.isFFEnabled(f.FFLAGS.UI_ACROPOLIS)&&o&&s.push({class:"network_link",value:n.i18n("create_network"),name:n.i18n("create_network")}),i(s),n.applyNutanixInput({types:["select"]})},error:function(e,t){n.showHeaderError(v.processAjaxError(t.responseText))}})},onSelectNetwork:function(e){this.$("input[name=ipAddress],input[name=subnetMask],input[name=gateway],input[name=nameservers]").attr("readonly",!0).val("");this.$("#networkUuid option:selected").text().trim();if(this.$("#networkUuid option:selected").hasClass("network_link"))t.onAppEvent(t.ENTITIES_CREATED,this.onNetworkCreated),t.onAppEvent(t.POPUP_CLOSE,this.externalPopupClosed),b.executeActionElement(e.currentTarget),this.unLockNetworkFields();else{var n=this.$("#networkUuid").val();if(n&&!_.isNull(this.networksCollection)){var i=this.networksCollection.find(function(e){return e.getUuid()===n});if(i&&i.isManagedNetwork()){var s=i.V2_DP[i.V2_DP.IP_CONFIG],a=s[i.DP.DHCP_OPTIONS],o=v.convertPrefixLengthToSubnetMask(i.getIpConfigAttr(s.PREFIX_LENGTH)),r=i.getIpConfigAttr(s.DEFAULT_GATEWAY),l=i.getDhcpOptionsAttr(a.DNS_SERVERS);this.$("input[name=ipAddress]").removeAttr("readonly"),_.isUndefined(o)||_.isNull(o)?this.$("input[name=subnetMask]").removeAttr("readonly"):this.$("input[name=subnetMask]").val(o),_.isUndefined(r)?this.$("input[name=gateway]").removeAttr("readonly"):this.$("input[name=gateway]").val(r),_.isUndefined(l)?this.$("input[name=nameservers]").removeAttr("readonly"):this.$("input[name=nameservers]").val(l)}else this.unLockNetworkFields()}else this.unLockNetworkFields()}},unLockNetworkFields:function(){this.$("input[name=ipAddress],input[name=subnetMask],input[name=gateway],input[name=nameservers]").removeAttr("readonly")},onVMSizeSelect:function(){var e,t,n=$("input:radio[name=choose_vm_size]:checked"),i=f.PCVM_TSHIRT_SIZE[n[0].value.toUpperCase()];i===f.PCVM_TSHIRT_SIZE.SMALL?(e=this.pcSizeSmall[h.VCPUS]||f.PC_VM_VCPU_SMALL_DEFAULT,t=this.pcSizeSmall[h.MEMORY_SIZE_IN_GIB]||f.PC_VM_MEMORY_SMALL_DEFAULT):(e=this.pcSizeLarge[h.VCPUS]||f.PC_VM_VCPU_LARGE_DEFAULT,t=this.pcSizeLarge[h.MEMORY_SIZE_IN_GIB]||f.PC_VM_MEMORY_LARGE_DEFAULT),this.updateStorageInfo(e,t)},onVirtualIpChanged:function(e){var t=$.trim($(e.currentTarget).val());if(t&&v.isValidIP(t)){var n=t.split("."),i=parseInt(n[3],10),s=n.slice(0,-1).join(".");_.each(this.pcVmIps,function(e,t){if(!e){var n=s+"."+(i+(t+1));this.$(".pc-vm-ip[index="+t+"]").val(n),this.pcVmIps[t]=n}},this)}},renderIpAddressesView:function(){var e=void 0,t=void 0,n=void 0,i=void 0;this.clusterManager.isMulticlusterUI()?(t=this.pcVMModel.getPCVMSpec().length,e=1===t?f.INITIAL_PC_VM_NO:t+1,n=this.pcVMModel.getNumOfSockets(),i=A.convertBytesToUnit(this.pcVMModel.getMemorySize(),A.UOM_GIB,!1)):(e=f.INITIAL_PC_VM_NO,n=this.pcSizeSmall[h.VCPUS]||f.PC_VM_VCPU_SMALL_DEFAULT,i=this.pcSizeSmall[h.MEMORY_SIZE_IN_GIB]||f.PC_VM_MEMORY_SMALL_DEFAULT);var a={};a[s.DP.LAYOUT_SYSTEM]=s.DP.LAYOUT_PERCENTAGE,a[s.DP.CONNECTORS]=[];for(var o=0;o<e;o++){var r=f.DEFAULT_VM_NAME_PREFIX+(o+1);this.vmNames[o]=this.vmNames[o]||f.DEFAULT_VM_NAME_PREFIX+(o+1),this.pcVmIps[o]||(this.pcVmIps[o]=""),this.$(".pcvm-ip-address-group").append(D(this.vtOptions({vmName:this.vmNames[o],dataId:r,pcVmIp:this.pcVmIps[o],vmIndex:o,vcpu:n,memorySize:i}))),this.clusterManager.isMulticlusterUI()&&this.pcVmIps[o]&&(this.$(".tile-wrapper").removeClass("active").addClass("in-active"),this.$(".edit-link").hide()),a[s.DP.CONNECTORS].push(this.constructNewConnector(o))}this.subViewHelper.get(this.SUBVIEW_CONNECTORS)&&this.subViewHelper.remove(this.SUBVIEW_CONNECTORS);var l=new s({el:this.$(".viz-main-container"),viewDefinition:a,parentContainer:this.$(".html-svg-wrapper")});this.subViewHelper.register(this.SUBVIEW_CONNECTORS,l),l.render()},constructNewConnector:function(e){return{source:{face:"R",id:"virtual-ip"},target:{face:"L",id:f.DEFAULT_VM_NAME_PREFIX+(e+1)},type:"elbow"}},parseForm:function(){var e=this.$("form[name=newVM]"),t=e.get(0).elements,n=this,i=g.validateFormValues(e);if(i&&i.length)return g.defaultErrorHandler(e,i),null;var s,a=!0;e.find(".ipAddress").each(function(){var e=$(this);v.isValidIP(e.val())||(e.addClass("alert-danger"),s=n.i18n("invalid_ip"),""===$.trim(e.val())&&(s=n.i18n("enter_required_data")),a=!1)});var o=!(!t||!t.virtualIp)&&""!==$.trim(t.virtualIp.value);if(o){var r=$(e.find(".virtualIp"));v.isValidIP(r.val())||(r.addClass("alert-danger"),s=n.i18n("invalid_virtual_ip"),a=!1)}var l=!(!t||!t.nameservers)&&""!==t.nameservers.value.trim();if(l&&e.find(".nameservers").each(function(){var e=$(this),t=e.val().split(","),i=!0;_.each(t,function(t){!v.isValidIP(t.trim())&&i&&(e.addClass("alert-danger"),s=n.i18n("invalid_dns_ip"),a=!1,i=!1)})}),!a)return this.showFormError(s),null;var c=this.constructSpec(e,t,l);return c?(o&&(c.virtual_ip=$.trim(t.virtualIp.value)),c):null},constructSpec:function(e,t,n){var i,s,a,o,r,l,c=$("input:radio[name=choose_vm_size]:checked");c.length&&(i=f.PCVM_TSHIRT_SIZE[c[0].value.toUpperCase()]),this.clusterManager.isMulticlusterUI()?(r=this.pcVMModel.getMemorySize(),o=this.pcVMModel.getNumOfSockets(),l=this.pcVMModel.getDiskSize(),s=this.pcVMModel.getNetworkConfiguration()[this.pcVMModel.DP.NETWORK_UUID]):(s=t.networkUuid.value.trim(),i===f.PCVM_TSHIRT_SIZE.SMALL?(o=parseInt(this.pcSizeSmall[h.VCPUS],10)||f.PC_VM_VCPU_SMALL_DEFAULT,r=A.convertToBytes(parseInt(this.pcSizeSmall[h.MEMORY_SIZE_IN_GIB],10)||f.PC_VM_MEMORY_SMALL_DEFAULT,A.UOM_GIB,!1),l=A.convertToBytes(parseInt(this.pcSizeSmall[h.DISK_SIZE_IN_GIB],10)||f.PC_VM_DISK_SIZE_SMALL_DEFAULT,A.UOM_GIB,!1)):(o=parseInt(this.pcSizeLarge[h.VCPUS],10)||f.PC_VM_VCPU_LARGE_DEFAULT,r=A.convertToBytes(parseInt(this.pcSizeLarge[h.MEMORY_SIZE_IN_GIB],10)||f.PC_VM_MEMORY_LARGE_DEFAULT,A.UOM_GIB,!1),l=A.convertToBytes(parseInt(this.pcSizeLarge[h.DISK_SIZE_IN_GIB],10)||f.PC_VM_DISK_SIZE_LARGE_DEFAULT,A.UOM_GIB,!1)));var d=[],p=!0;n&&_.each(t.nameservers.value.split(","),function(e){d.push(e.trim())}),this.$("#networkUuid option:selected").text().trim()===this.i18n("select_or_create_network")&&(p=!1,a=this.i18n("select_or_create_network_error"));var u=[],m=[],v=this.$(".pc-vm-ip")[0].value,E=this.$(".subnetMask")[0].value,T=e.find(".tile-wrapper").filter(".active");return _.each(T,function(e){var i=$(e),c=i.attr("index"),h=this.$(".pc-vm-name[index="+c+"]").val().trim(),_=this.$(".pc-vm-ip[index="+c+"]").val().trim();if(this.clusterManager.isMulticlusterUI()){g.isIPInSameNetwork(v,_,E)||(p=!1,a=this.i18ns("subnet_error",_,v))}m.push(_),h&&_||(p=!1,a=this.i18n("enter_required_data"));var T={vm_name:h.trim(),container_uuid:t.containerSelect.value.trim(),num_sockets:o,data_disk_size_bytes:l,memory_size_bytes:r,dns_server_ip_list:d,nic_list:[{ip_list:[_.trim()],network_configuration:{network_uuid:s,subnet_mask:t.subnetMask.value.trim(),default_gateway:t.gateway.value.trim()}}]};n||delete T.dns_server_ip_list,this.clusterManager.isMulticlusterUI()&&(T[this.pcVMModel.DP.CLUSTER_REFERENCE]={kind:f.ENTITY_CLUSTER,uuid:this.pcVMModel.getHostedClusterUuid()}),u.push(T)},this),p?this.clusterManager.isMulticlusterUI()?{pc_vm_list:u}:{pc_vm_list:u,version:this.pcReleaseId,should_auto_register:!1}:(this.showFormError(a),null)},showFormError:function(e,t){var n=E.ERROR({error:e});if(t){var i=this.clusterManager.getCurrentClusterUuid();m.hasESX(i)&&(n=E.WARNING({msg:e})),this.$(".alert-container-1").html(n)}else this.$(".alert-container-2").html(n);this.$(".n-modal-content-wrapper").scrollTop(0)},onEditActionClick:function(e){var t=$(e.currentTarget),n=t.attr("index");if(t.hasClass("save-button")){var i=this.$(".pc-vm-name[index="+n+"]").val().trim(),s=this.$(".pc-vm-ip[index="+n+"]").val().trim();this.vmNames[n]=i,this.pcVmIps[n]=s}this.resetWrapper(n)},resetWrapper:function(e){var t=this.$('div[index="'+e+'"]');t.removeClass("editable"),_.each(t.find("input.input-data"),function(e){$(e).prop("readonly",!0),$(e).removeClass("edit")}),t.find(".btnEdit").show(),t.find(".save-button").hide(),t.find(".cancel-button").hide(),this.$(".pc-vm-name[index="+e+"]").val(this.vmNames[e]),this.$(".pc-vm-ip[index="+e+"]").val(this.pcVmIps[e])},onClickEdit:function(e){var t=$(e.currentTarget),n=t.closest(".tile-wrapper");n.addClass("editable"),_.each(n.find("input.input-data"),function(e){$(e).focus(),$(e).hasClass("alert-danger")&&$(e).removeClass("alert-danger"),$(e).prop("readonly",!1),$(e).addClass("edit")}),n.find(".btnEdit").hide(),n.find(".save-button").show(),n.find(".cancel-button").show()},onUpdateClick:function(e){e.preventDefault();var t=this.parseForm();_.isNull(t)||this.validatePCVMinputs(t)},validatePCVMinputs:function(e){var t=this,n=e.pc_vm_list,i={},s="",a=!0,o=_.map(n,function(e){return e.vm_name});T.addFilterConditions(i,f.ENTITY_VM,h.EB.VM.VM_NAME,o);for(var r=new l(null,{entity_type:f.ENTITY_VM,group_member_attributes:[h.EB.VM.VM_NAME],filter_expression:i}),c=0;c<this.pcVmIps.length;c++){if(this.pcVmIps.indexOf(this.pcVmIps[c])!==c&&this.pcVmIps[c]){a=!1;this.$(".pc-vm-ip[index="+c+"]").addClass("alert-danger"),s=this.i18ns("ip_duplicate",this.pcVmIps[c]);break}}if(!a)return void this.showFormError(s);r.fetch().done(function(n){if(t.$("input.pc-vm-name").removeClass("alert-danger"),0===n.length){for(var i=!1,a=0;a<o.length;a++)if(o.indexOf(o[a])>=0&&o.indexOf(o[a])!==a){i=!0;var l=a+1,c=f.DEFAULT_VM_NAME_PREFIX+l,d=t.$(".tile-wrapper[data-id='"+c+"']");d.find("input.pc-vm-name").addClass("alert-danger"),s=t.i18ns("vm_name_duplicate",o[a])}i?t.showFormError(s):t.startDeploy(e)}else{for(a=0;a<r.models.length;a++){var p=r.models[a];l=t.clusterManager.isMulticlusterUI()?t.vmNames.length+a:_.indexOf(o,p.get(h.EB.VM.VM_NAME))+1,c=f.DEFAULT_VM_NAME_PREFIX+l,d=t.$(".tile-wrapper[data-id='"+c+"']"),d.find("input.pc-vm-name").addClass("alert-danger"),s+=t.i18ns("vm_name_in_use",p.get(h.EB.VM.VM_NAME))}t.showFormError(s)}}).fail(function(e){t.showHeaderError(e.responseText)})},startDeploy:function(e){var n=this,i=!0;if(_.each(this.$(".tile-wrapper"),function(e){$(e).hasClass("editable")&&(i=!1)}),!i)return void this.showFormError(this.i18n("confirm_configuration"));var s,a=new c({resources:e});this.clusterManager.isMulticlusterUI()?(a.actionMode=f.ACTION_ADD,s=f.TASK_OPERATION_PC_ADD_NODE):(a.actionMode=f.ACTION_DEPLOY,s=f.TASK_OPERATION_PC_DEPLOYMENT),this.$(".btnUpdate").button("loading"),a.save(null,{success:function(e,i,a){var o=e.get(h.TASK_UUID_V3);t.triggerAppEvent(t.ENTITIES_CREATED,{entityType:f.ENTITY_TASK,entity:null,taskUuid:o,operationType:s}),n.$(".btnUpdate").button("reset"),n.hide()},error:function(e,t,i){n.showHeaderErrorWithDetails(n.i18n("serverError"),I.interpretIntentServerError(t)),n.$(".btnUpdate").button("reset")}})},clearError:function(e){var t=$(e.currentTarget);t.hasClass("alert-danger")&&(t.removeClass("alert-danger"),t.val(""))},externalPopupClosed:function(e,n){n&&n[f.NAV_ACTION]===f.ACTION_CREATE_NETWORK&&(t.offAppEvent(t.POPUP_CLOSE,this.externalPopupClosed),this.$(".networkList option").removeAttr("selected"),this.$(".selectANetwork").attr("selected"),this.$(".networkList").trigger("update"),this.onSelectNetwork())},onNetworkCreated:function(e,n){e.type===t.ENTITIES_CREATED&&n.entityType===f.ENTITY_ACROPOLIS_NETWORK&&(t.offAppEvent(t.ENTITIES_CREATED,this.onNetworkCreated),t.offAppEvent(t.POPUP_CLOSE,this.externalPopupClosed),this.listNetworks(n.entity.get("networkUuid")))},onEditVirtualIpClick:function(e){var t=this;new a({el:v.createPopupContainer("popupPCVirtualIPDetails"),virtualIp:this.pcVMModel.getVirtualIP(),onSuccess:function(e){t.renderVirtualIp(e)}}).show()}}))}),define("text!templates/popups/lcm/LCMConfigPopupView.html",[],function(){return'\x3c!-- The parent div modal is #popuplcmConfigPopupView  --\x3e\n<div class="modal-header">\n  <button type="button" class="close" data-dismiss="modal">\n    <i data-icon="K" aria-hidden="true"></i>\n  </button>\n  <h4 class="n-title"><%= i18n(\'lcmAdvSettings\') %></h4>\n</div>\n<div class="n-modal-wrapper">\n  <div class="n-modal-body">\n    <div class="n-modal-content-wrapper">\n      <div class="n-modal-alert-header">\n        \x3c!-- @view: update message goes here --\x3e\n      </div>\n      <div class="control-group">\n        <label class="control-label"><%= i18n (\'fetchUpdateFrom\') %></label>\n        <div class="controls">\n          <input type="text" class="portalURL" value="<%= url || \'\' %>"\n                 data-test="portalURL">\n        </div>\n      </div>\n    </div>\n    <% if (auto_update_enabled !== null) { %>\n      <div class="control-group">\n        <%= Components.checkbox({\n        jsClasses :\'auto-update--enabled-cb\',\n        id: \'auto-update-enabled\',\n        checked: auto_update_enabled || false,\n        dataTestAttribute: \'auto-update-enabled\'\n        })%>\n        <label for="auto-update-enabled">\n          <%= i18n(\'enableLCMAutoUpdate\') %>\n        </label>\n      </div>\n    <% } %>\n  </div>\n\n  <div class="n-modal-footer">\n    \x3c!-- Back button --\x3e\n    <div class="pull-left">\n    </div>\n    <button class="btnCancel btn n-btn-list" data-test="lcmconfigpopupview_button_cancel">\n      <%= i18n(\'cancel\') %>\n    </button>\n    <button class="btnSave btn-edit btn btn-primary -btn-list"\n            data-loading-text="<%= i18n(\'saving\') %>" data-test="lcmconfigpopupview_button_save">\n      <%= i18n(\'save\') %>\n    </button>\n  </div>\n</div>'}),define("views/popups/lcm/LCMConfigPopupView",["datepicker","timepicker","views/basecomponents/popups/BasePopupView","models/genesis/LCMActionModel","utils/AppUtil","utils/AppConstants","utils/CommonTemplates","events/AppEvents","text!templates/popups/lcm/LCMConfigPopupView.html"],function(e,t,n,i,s,a,o,r,l){"use strict";var c=_.template(l),d=i.DP;return n.extend({name:"LCMConfigPopupView",el:"#popuplcmConfigPopupView",events:{"click  .btnCancel":"hide","click  .modal-header .close":"hide","click .btnSave":"onSave","keypress input":"onKeyPress"},initialized:!1,config:null,portalURL:null,overlayPopup:!0,initialize:function(e){n.prototype.initialize.apply(this,arguments),this.portalURL=e.portalURL},render:function(){if(this.initialized){var e=this.config||{};_.isUndefined(e[d.AUTO_UPDATE_ENABLED])&&(e[d.AUTO_UPDATE_ENABLED]=null),e[d.URL]||(e[d.URL]=this.portalURL);var t=c(this.vtOptions(e));this.$el.html(t),this.applyNutanixInput()}else this.$el.html(o.LOADING_MSG({msg:this.i18n("loading")})),this.loadData();return this},loadData:function(){var e=this,t=new i;return t.setRPCParams(i.LCM_ACTIONS.GET_CONFIG),t.save().done(function(){t.hasErrorResponse()||(e.config=t.getReturnResponse())}).always(function(){e.initialized=!0,e.render(),t.hasErrorResponse()&&e.showHeaderError(t.getParsedErrorResponse())})},onSave:function(){var e=this,t=this._getConfigInputs();if(_.some(t,function(e){return!e}))return void this.showHeaderError(this.i18n("missingValueError"));var n={};this.$(".auto-update--enabled-cb").is(":visible")&&(n.autoUpdateEnabled=this.$(".auto-update--enabled-cb").is(":checked"));var o=new i;o.setRPCParams(i.LCM_ACTIONS.CONFIGURE,t.portalURL,n),this.$(".btnSave").button("loading"),o.save().done(function(){if(o.hasErrorResponse()){var i=o.getParsedErrorResponse();e.showHeaderError(e.i18ns("savingError",i))}else o.getReturnResponse()?(r.triggerAppEvent(r.ENTITIES_UPDATED,{entityType:a.ENTITY_LCM,entity:o,portalURL:t.portalURL,configValue:n}),e.hide()):e.showHeaderError(e.i18n("invalidConfigError"))}).fail(function(t){e.showHeaderError(s.processAjaxError(t))}).always(function(){e.$(".btnSave").button("reset")})},_getConfigInputs:function(){return{portalURL:this.$(".portalURL").val()}}})}),define("text!templates/popups/lcm/LCMAvailableVersionPopupView.html",[],function(){return'\x3c!-- The parent div modal is #popup  --\x3e\n<div class="modal-header">\n  <button type="button" class="close" data-dismiss="modal">\n    <i data-icon="K" aria-hidden="true"></i>\n  </button>\n  <h4 class="n-title">Define Version</h4>\n</div>\n<div class="n-modal-wrapper">\n  <div class="n-modal-body">\n    <div class="n-modal-content-wrapper">\n      <div class="n-modal-alert-header">\n        \x3c!-- @view: update message goes here --\x3e\n      </div>\n      <div>\n        <table id="lcmVersions"\n               class="table table-hover lcm-versions-table ">\n          <thead>\n          <tr>\n           <th>Version</th>\n          </tr>\n          </thead>\n          <tbody>\n          <% _.each (versions, function(version) { %>\n          <tr class="<%= version.get(version.DP.VERSION) === selectedVersion ? \'selected\' : \'\' %>">\n            <td>\n              <%= Components.radio({\n              name    : \'lcm-version\',\n              value   : version.get(version.DP.UUID),\n              checked : version.get(version.DP.VERSION) === selectedVersion,\n              dataTestAttribute: \'lcm-version-\' + version.get(version.DP.UUID)\n              }) %>\n              <%= version.get(version.DP.VERSION)  + \' (\' + version.get(version.DP.STATUS) + \')\' %>\n            </td>\n          </tr>\n          <% }) %>\n          </tbody>\n        </table>\n      </div>\n    </div>\n  </div>\n\n  <div class="n-modal-footer">\n    \x3c!-- Back button --\x3e\n    <div class="pull-left">\n    </div>\n    <button class="btnCancel btn n-btn-list" data-test="lcmavailableversionpopupview_button_cancel">\n      <%= i18n(\'cancel\') %>\n    </button>\n    <button class="btnSave btn-edit btn btn-primary -btn-list"\n            data-test="lcmavailableversionpopupview_button_save"\n            stream-action="LCM:select"\n            stream-target="Change Version">\n      <%= i18n(\'save\') %>\n    </button>\n  </div>\n</div>'}),define("views/popups/lcm/LCMAvailableVersionPopupView",["views/basecomponents/popups/BasePopupView","models/lcm/LCMVersionModel","models/query/QueryResultCollection","events/AppEvents","utils/AppConstants","utils/AppUtil","utils/FilterUtil","utils/CommonTemplates","text!templates/popups/lcm/LCMAvailableVersionPopupView.html"],function(e,t,n,i,s,a,o,r,l){"use strict";var c=_.template(l);return e.extend({el:"#lcmVersionPopupView",events:{"click .btnCancel":"hide","click .modal-header .close":"hide","click .btnSave":"onSave"},overlayPopup:!0,initialized:!1,name:"LCMAvailableVersionPopupView",render:function(){if(this.initialized){var e=_.sortBy(this.model.models,function(e){return e.get(e.DP.ORDER)}).reverse(),t=this.actionRoute[s.NAV_ACTION_TARGET_NAME],n=c(this.vtOptions({versions:e,selectedVersion:t}));this.$el.html(n)}else this.$el.html(r.LOADING_MSG({msg:this.i18n("loading","Loading")})),this.loadVersionData();return this},show:function(i){var a=i[s.NAV_ACTION_TARGET_ID],r={};o.addFilterCondition(r,t.DP.ENTITY_UUID,o.createFilterCondition(s.ENTITY_LCM,t.DP.ENTITY_UUID,s.FILTER_OPERATORS.EQUALS,a)),this.model=new n(null,{entityType:t.ENTITY_TYPE,entityModel:t,filter_expression:r}),e.prototype.show.apply(this,arguments)},loadVersionData:function(){var e=this;return this.model.fetch().done(function(){e.initialized=!0,e.render()}).fail(function(t,n){e.showHeaderError(a.processAjaxError(n)),e.render()})},onSave:function(){var e=this.$('input[name="lcm-version"]:checked').val();if(e){var t=this.model.findModelById(e);i.triggerAppEvent(i.ENTITIES_UPDATED,{entityType:s.ENTITY_LCM_VERSION,entity:t}),this.hide()}else this.showHeaderError(this.i18n("select-a-version"))}})}),define("text!templates/popups/clusterhealth/NccTaskSuceededPopupView.html",[],function(){return'\n<div class="modal-header">\n  <button type="button" class="close" data-dismiss="modal">\n    <i data-icon="K" aria-hidden="true"></i>\n  </button>\n  <h4 class="n-title">View Summary</h4>\n</div>\n<div class="n-modal-wrapper">\n  <div class="n-modal-body ncc-task-status-popup">\n    <% if (! initialized) { %>\n      <div id="ncc-status-popup-loader">\n        <div class="n-modal-content-wrapper">\n          <div class="n-modal-loader">\n            <div class="donut-loader-blue"></div>\n            <span class="n-loading-text">Loading data...&nbsp;</span>\n          </div>\n        </div>\n      </div>\n    <% } else if (taskError) { %>\n      <div id="nccstatuspopuploader">\n        <div class="n-modal-content-wrapper">\n          <div class="n-modal-alert-header"></div>\n        </div>\n      </div>\n    <% } else  { %>\n      <div class="n-modal-content-wrapper">\n        <div class="n-modal-alert-header">\n          \x3c!-- @view: update message goes here --\x3e\n        </div>\n        <div id="ncc-status-popup">\n          <div class="n-popup-description">\n            <form id="NccTaskStatus Form" class="form-horizontal">\n              <div class="control-group change-type-wrapper" >\n              <br>\n              <div class="section-header">Summary of Cluster Check Executed\n                   on <%= time %> </div>\n              </div>\n              <a class="download-output" class="persisted-link">\n                <%= i18n(\'download_output\', \'Download Output\')%></a><br>\n              <table class="table table-hover" id=ncc-popup-table>\n                <tr>\n                  <th><%= i18n(\'check_status\', \'CHECK STATUS\')%></th>\n                  <th class="ncc-task-status ncc-popup-table-header">\n                    <%= i18n(\'no_of_checks\', \'NUMBER OF CHECKS\')%></th>\n                </tr>\n                <tr>\n                  <td><%= i18n(\'passed\', \'Passed\') %></td>\n                  <td class="ncc-task-status"><%= passed %></td>\n                </tr>\n                <tr>\n                  <td><%= i18n(\'info\', \'Info\')%></td>\n                  <td class="ncc-task-status"><%= info %></td>\n                </tr>\n                <tr>\n                  <td><%= i18n(\'warn\', \'Warn\')%></td>\n                  <td class="ncc-task-status"><%= warn %></td>\n                </tr>\n                <tr>\n                  <td ><%= i18n(\'error\', \'Error\')%></td>\n                  <td class="ncc-task-status"><%= error %></td>\n                </tr>\n                <tr>\n                  <td ><%= i18n(\'failed\', \'Failed\')%></td>\n                  <td class="ncc-task-status"><%= failed %></td>\n                </tr>\n                <tr>\n                  <td><%= i18n(\'total\', \'Total\')%></td>\n                  <td class="ncc-task-status"><%= total %></td>\n                </tr>\n              </table>\n            </form>\n          </div>\n        </div>\n      </div>\n    <% } %>\n  </div>\n  <div class="n-modal-footer">\n    <button class="btnCancel btn btn-primary n-btn-list">\n      Close\n    </button>\n  </div>\n</div>\n'}),define("views/popups/clusterhealth/NCCTaskSuceededPopupView",["views/basecomponents/popups/BasePopupView","data/DataProperties","models/ncc/NCCTaskModel","utils/AppConstants","utils/AppUtil","utils/TimeUtil","utils/DataExportUtil","text!templates/popups/clusterhealth/NccTaskSuceededPopupView.html"],function(e,t,n,i,s,a,o,r){"use strict";return r=_.template(r),e.extend({name:"NCCTaskStatusPopupView",el:"#popup-ncc-task-status",model:null,initialized:!1,taskId:null,taskerror:!1,dataOutput:null,events:{"click  .btnCancel":"onCancelClick","click  .modal-header .close":"hide","click  .download-output":"downloadOutput"},render:function(){var e=this;this.model=new n({id:e.taskId}),this.model.fetch({success:function(){e.initialized=!0,e._render()},error:function(t){e.initialized=!0,e.taskerror=!0,e._render(),e.showHeaderError(_.isObject(t)?s.processAjaxError(t.responseText):t)}}),e._render()},_render:function(){var e;if(this.initialized){if(!this.taskerror){var n=this.model.get(t.NCC_CHECKS_START_TIME);e=a.formatDateTime(n/i.MICROS_PER_MILLI),this.dataOutput=this.model.get("runSummary")}
this.$el.html(r(this.vtOptions({initialized:this.initialized,time:e,taskError:this.taskerror,total:this.model.get(t.NCC_CHECKS_TOTAL),passed:this.model.get(t.NCC_CHECKS_PASSED),failed:this.model.get(t.NCC_CHECKS_FAILED),error:this.model.get(t.NCC_CHECKS_ERROR),info:this.model.get(t.NCC_CHECKS_INFO),warn:this.model.get(t.NCC_CHECKS_WARN)})))}else this.$el.html(r(this.vtOptions({initialized:this.initialized,taskError:this.taskerror})))},downloadOutput:function(){var e=null;s.getBrowser()===i.BROWSER_AGENT.SAFARI&&(e=o.openExportWindow());var n=Math.floor(this.model.get(t.NCC_CHECKS_START_TIME)/1e3);o._export({type:"txt",data:this.dataOutput,filename:"ncc-output-"+a.formatDate(n,"yyyy-MM-dd")+"-"+Math.floor(n/1e3)},e)},show:function(t){this.taskId=t.actionTargetId,e.prototype.show.call(this)},onCancelClick:function(){this.hide()}})}),define("models/eula/FileServerEulaAgreementModel",["models/BaseModel","data/DataURLConstants"],function(e,t){"use strict";var n={USERNAME:"username",COMPANY_NAME:"companyName",JOB_TITLE:"jobTitle",CONTENT:"content"};return e.extend({name:"FileServerEulaAgreementModel",urlRoot:t.EULA,DP:n},{DP:n})}),define("text!templates/popups/fileserver/FileServerEulaPopupView.html",[],function(){return'<div class="modal-header">\n  <button type="button" class="close" data-dismiss="modal">\n    <i data-icon="K" aria-hidden="true"></i>\n  </button>\n  <h4 class="n-title">File Server EULA</h4>\n</div>\n\x3c!-- Link to configure network page --\x3e\n<div class="n-modal-wrapper">\n  <div class="n-modal-body">\n    <div class="modal-content-container n-modal-content-wrapper n-eula-input-container">\n      <div class="n-message-header">\n        \x3c!-- Error goes here --\x3e\n      </div>\n      <div class="n-modal-content">\n        <form id="fsEulaPopupForm" class="form-horizontal">\n          <section class="fs-eula-config">\n            <div class="section-content">\n              <div class="fs-eula-container">\n                <div class="control-group n-eula-agreement">\n                  <div class="antiscroll-wrap">\n                    <div class="box-wrap">\n                      <div class="antiscroll-inner">\n                        <div class="box-inner">\n                          <%= eulaAgreement %>\n                        </div>\n                      </div>\n                    </div>\n                  </div>\n                </div>\n              </div>\n            </div>\n          </section>\n        </form>\n      </div>\n    </div>\n  </div>\n  \x3c!-- File server prerequisite cancel and continue button --\x3e\n  <div class="n-modal-footer">\n    <span class="n-terms-conditions-container">\n      By clicking continue I agree and accept this EULA\n    </span>\n    <button class="btnCancel btn n-btn-form n-decline">\n      Cancel\n    </button>\n    <button class="btnSave btn n-btn-form n-accept">\n      Continue\n    </button>\n  </div>\n</div>'}),define("views/popups/fileserver/FileServerEulaPopupView",["views/basecomponents/popups/BasePopupView","models/eula/FileServerEulaAgreementModel","events/AppEvents","utils/AppUtil","utils/AppConstants","utils/SVG","text!templates/popups/fileserver/FileServerEulaPopupView.html"],function(e,t,n,i,s,a,o){"use strict";return o=_.template(o),e.extend({el:"#popupEulaFileServer",model:null,className:"n-eula-agreement-container",events:{"click .n-accept":"onClickAccept","click .n-decline":"hide","click  .modal-header .close":"hide"},EULA_ACCEPT:"eulaAccept",EULA_DECLINE:"eulaDecline",initialize:function(e){this.model=e.model,this.el=e.el},render:function(){var e=this;this.model=new t;var n="";this.model.fetch({success:function(e,t){n=t.entities[0].content}}).complete(function(){return e.$el.html(o({eulaAgreement:i.unescapeHTMLString(n),SVG:a})),this})},onClickAccept:function(){this.hide();var e={action:s.ACTION_CREATE,actionTarget:s.ENTITY_FILE_SERVER};n.triggerAppEvent(n.SHOW_PRE_CHECK_NOTIFICATION,{entityType:s.ENTITY_FILE_SERVER,actionRoute:e})}})}),define("text!templates/popups/broker/BrokerPopupView.html",[],function(){return'<div class="modal-header">\n  <h4 class="n-title"><%= headerText %></h4>\n  \x3c!-- Help icon automatically inserted here if help is available --\x3e\n  <button type="button" class="close" data-dismiss="modal">\n    <i data-icon="K" aria-hidden="true"></i>\n  </button>\n</div>\n\n<div class="n-modal-wrapper">\n  <div class="n-modal-body">\n    <div class="n-modal-alert-header"></div>\n    <div class="n-modal-content-wrapper">\n      <div class="n-modal-content listContainer summary-wrapper">\n        <div id="subappContainer"></div>\n      </div>\n    </div>\n  </div>\n</div>\n'}),define("views/popups/broker/BrokerPopupView",["utils/AppConstants","views/basecomponents/popups/BasePopupView","broker/managers/BrokerManager","utils/LogUtil","text!templates/popups/broker/BrokerPopupView.html"],function(e,t,n,i,s){"use strict";var a=_.template(s);return t.extend({el:"#brokerPopup",name:"BrokerPopupView",initialized:!1,componentId:null,component:null,componentProps:null,events:{"click  .btnClose":"hide","click  .modal-header .close:not(.disabled)":"hide"},initialize:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t.prototype.initialize.apply(this,arguments),this.componentProps=e.componentProps||{},_.bindAll(this,"onLoadSuccess","onLoadError")},hide:function(){t.prototype.hide.apply(this,arguments),n.goBack()},destroy:function(){t.prototype.destroy.apply(this,arguments),this.componentId&&n.unloadComponent(this.componentId)},render:function(){var t=this.actionRoute[e.NAV_OPTIONS]||{},i=t.subApp,s=t.componentName;if(this.$el.html(a({headerText:this.getHeaderText()})),t.popup=this,i){var o=this.$("#subappContainer");s?this.componentId=n.loadComponent(i,o,{componentName:s},{success:this.onLoadSuccess,error:this.onLoadError}):n.loadSubApp(i,o,t,!0)}},renderComponent:function(e){this.component&&(this.componentProps=_.extend({},this.componentProps,e),this.component.render(this.componentProps))},show:function(e){this.actionRoute=e,t.prototype.show.apply(this,arguments)},getHeaderText:function(){var t=this.actionRoute[e.NAV_OPTIONS]||{},n=t[e.NAV_ACTION_TARGET]||this.actionRoute[e.NAV_ACTION_TARGET],i=t.header?t.header:"",s=this.actionRoute[e.NAV_ACTION_ID]||t[e.NAV_ACTION_ID];return this.i18n("PopupTitle."+s+"_"+n,i)},onLoadSuccess:function(e){this.component=e,this.renderComponent({actionRoute:$.extend(!0,{},this.actionRoute)})},onLoadError:function(e){this.showHeaderError(this.i18n("error_component_load")),i.logDebug("BrokerManager: "+e)}})}),define("text!templates/popups/cluster/FeatureDisabledPopupView.html",[],function(){return'<div class="modal-header">\n  <button type="button" class="close" data-dismiss="modal">\n    <i data-icon="K" aria-hidden="true"></i>\n  </button>\n  <h4 class="n-title"><%= title %></h4>\n</div>\n<div class="n-modal-wrapper">\n  <div class="n-modal-body">\n    <div class="n-modal-alert-header">\n      \x3c!-- @view: popup alert goes here... --\x3e\n    </div>\n    <div class="n-modal-content-wrapper n-feature-disable-container">\n      <div class="n-modal-content">\n        <div class="n-popup-description">\n          <%= content %>\n        </div>\n      </div>\n    </div>\n  </div>\n  <div class="n-modal-footer">\n    <button class="btnClose btn btn-primary n-btn-form btn-close"\n            data-loading-text="<%= i18n(\'close\') %>">\n      <%= i18n(\'close\') %>\n    </button>\n  </div>\n</div>'}),define("views/popups/cluster/FeatureDisabledPopupView",["views/basecomponents/popups/BasePopupView","utils/AppConstants","text!templates/popups/cluster/FeatureDisabledPopupView.html"],function(e,t,n){"use strict";n=_.template(n);var i={TITLE:"title",CONTENT:"content",DEFAULT:"default"};return e.extend({name:"FeatureDisabledPopupView",el:"#popupFeatureDisabledPopup",className:"n-feature-disable-container",title:null,content:null,events:{"click  .btn-close":"hide","click  .modal-header .close":"hide"},show:function(n){if(e.prototype.show.apply(this,arguments),n[t.NAV_ACTION_TARGET_ID]){var s=n[t.NAV_ACTION_TARGET_ID],a=this.i18n(s);if(a&&a[i.TITLE]&&a[i.CONTENT])return this.title=a[i.TITLE],this.content=a[i.CONTENT],void this.render()}var o=this.i18n(i.DEFAULT);this.title=o[i.TITLE]||"",this.content=o[i.CONTENT]||"",this.render()},render:function(){var e=this;this.$el.html(n(this.vtOptions({title:e.title,content:e.content})))}})}),define("models/intent/customrequests/BaseIntentCustomRequestModel",["models/BaseModel"],function(e){"use strict";return e.extend({name:"BaseIntentCustomRequestModel",responsePostProcessor:null,initialize:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_.isFunction(e.responsePostProcessor)&&(this.responsePostProcessor=e.responsePostProcessor)},getRequestName:function(){return this.get("reqName")},postProcessResponse:function(e){return _.isFunction(this.responsePostProcessor)?this.responsePostProcessor(e):e},getBatchBody:function(){},processResponse:function(e){}})}),define("models/intent/customrequests/GroupsIntentCustomRequestModel",["managers/BatchManager","models/intent/customrequests/BaseIntentCustomRequestModel","models/ebrowser/EBQueryModel","data/DataProperties","utils/AppConstants","utils/AppUtil","utils/FilterUtil"],function(e,t,n,i,s,a,o){"use strict";return t.extend({name:"GroupsIntentCustomRequestModel",queryModel:null,initialize:function(e){t.prototype.initialize.call(this,e),this.queryModel=this.createQueryModel()},getBatchBody:function(){var t,n=e.DP.REQUEST;return t={},_defineProperty(t,n.OPERATION,s.HTTP_METHOD.POST),_defineProperty(t,n.PATH_AND_PARAMS,this.getGroupsUrlForBatchCall()),_defineProperty(t,n.BODY,this.queryModel.toJSON()),t},processResponse:function(e){return this.queryModel.set(this.queryModel.parse(e)),this.postProcessResponse(this.queryModel.getResultEntities())},getGroupsUrlForBatchCall:function(){return a.removeDomainFromUrl(this.queryModel.getDataSourceURL()+this.queryModel.url())},createQueryModel:function(){var e,t={};return this.applyFilter(t),this.queryModel=new n((e={},_defineProperty(e,n.DP.ENTITY_TYPE,this.get("entityType")),_defineProperty(e,n.DP.FILTER_EXPR,t),e)),this.queryModel.setGroupMemberAttributesList(this.get("attributes")),this.queryModel},applyFilter:function(e){var t=this.get("filter"),n=this.get("entityType");_.isObject(t)&&t.uuid&&n&&o.addFilterConditions(e,n,i.UUID,[t.uuid])}})}),define("managers/IntentCustomFetchManager",["managers/BatchManager","models/intent/customrequests/GroupsIntentCustomRequestModel","data/DataProperties","utils/AppConstants"],function(e,t,n,i){"use strict";return{CUSTOM_FETCH:{PROJECT_GROUP_INFO:"project_group_info"},getRequest:function(e){var s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};switch(e){case this.CUSTOM_FETCH.PROJECT_GROUP_INFO:if(!_.isString(s.uuid))return;return new t({reqName:this.CUSTOM_FETCH.PROJECT_GROUP_INFO,entityType:i.ENTITY_PROJECT,filter:{uuid:s.uuid},attributes:[n.EB.PROJECT.VCPUS_COUNT,n.EB.PROJECT.MEMORY_BYTES,n.EB.PROJECT.STORAGE_BYTES],responsePostProcessor:function(e){return _.isArray(e)&&e[0]?e[0]:e}});default:throw new Error("There is no custom request model for "+e)}},fetch:function(t){var n=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=this.getDefinitionRequests(t,i);if(!s.length)return void i.success({});var a=e.createBatchRequestObj();a[e.DP.API_REQUEST_LIST]=this.getBatchRequestList(s),e.performBatch({requestBody:a,success:function(e){n.onBatchSuccess(e,s,i)},error:function(){i.error()}})},onBatchSuccess:function(t,n,i){var s=t[e.DP.API_RESPONSE_LIST],a={};_.each(s,function(t,i){var s=n[i],o=s.getRequestName();a[o]=s.processResponse(t[e.DP.RESPONSE.API_RESPONSE])}),i.success(a)},getBatchRequestList:function(e){var t=[];return _.each(e,function(e){t.push(e.getBatchBody())}),t},getDefinitionRequests:function(e,t){var n=this,i=e.split(","),s=[];return _.each(i,function(e){if(e){var i=n.getRequest(e,t);i&&s.push(i)}}),s}}}),define("views/intent/IntentDynamicView",["views/basecomponents/BaseView","managers/IntentManager","managers/AccessManager","managers/NotificationManager","managers/EntityStateTracker","managers/ActionManager","managers/AppManager","managers/ExpressionManager","managers/IntentCustomFetchManager","data/DataProperties","data/DataURLConstants","utils/AppConstants","utils/AppUtil","utils/FormRendererUtil","utils/HypervisorUtil","utils/ValidationUtil","utils/SubViewHelper","events/AppEvents"],function(e,t,n,i,s,a,o,r,l,c,d,p,u,h,m,f,v,g){"use strict";var E=_.template('<div id="<%= formId %>" class="form"  ntnx-ui-generation-date="<%= (new Date()).toUTCString() %>"  ntnx-ui-meta-page-popup="false"></div>'),T=(_.template('<div class="section section-default" id="<%= section.id %>"><div class="header-section"><%= section.title %></div></div>'),{DATA_MODEL_ATTR:"model-attribute",CLASS_MODAL_CONTENT:"n-modal-content"}),C={FORM_VIEW:"form-view",FORM_CONTROL_VIEW:"form-control"},S={NAME:t.SWAGGER_PROPERTIES.PROP_NAME,DESC:t.SWAGGER_PROPERTIES.PROP_DESC,SPEC:t.SWAGGER_PROPERTIES.PROP_SPEC,STATUS:t.SWAGGER_PROPERTIES.PROP_STATUS,RESOURCES:t.SWAGGER_PROPERTIES.PROP_RESOURCES,PROPS:t.SWAGGER_PROPERTIES};return e.extend({actionRoute:null,viewType:t.VIEW_TYPE.POPUP,entityType:null,definition:null,template:null,dataObject:null,intentModel:null,subViewHelper:null,formViewId:null,eventBus:null,isPartialUpdate:!1,DP:S,initialize:function(t){e.prototype.initialize.apply(this,arguments),this.subViewHelper=new v,this.eventBus=_.extend({},Backbone.Events),t&&(this.intentElView=t.intentElView||null),this.saveCallback=t&&t.saveCallback,_.bindAll(this,"fillAndSaveIntentModel","saveEntity","filterElementBasedOnAccess"),this.eventBus.on(p.SSP_EVENTS.FILTER_ELEMENTS_BY_ACCESS,this.filterElementBasedOnAccess)},destroy:function(){this.intentModel&&this.intentModel.off(),this.$el.off(),this.subViewHelper&&(this.subViewHelper.destroy(),this.subViewHelper=null),this.formViewId=null,this.eventBus.off(p.SSP_EVENTS.FILTER_ELEMENTS_BY_ACCESS,this.filterElementBasedOnAccess),e.prototype.destroy.apply(this,arguments)},show:function(e){this.viewOptions=e.viewOptions,this.actionRoute=e.actionRoute,this.viewType=e.viewType||this.viewType,this.entityType=this.getEntityTypeIntent(this.actionRoute),this.actionRoute[p.NAV_ACTION_TARGET]=this.entityType,this.$el.addClass("intent-dynamic-view");var n=this;t.loadIntentAPIObject(function(){n.loadEntityAPIDefinition(),e.renderCallback&&e.renderCallback(),n.loadDataFromDefinition(e.dataOptions)},this.actionRoute,this.viewType)},getEntityTypeIntent:function(e){var t=u.getEntityTypeIntent(e[p.NAV_ACTION_TARGET]);return t===p.ENTITY_VM&&e[p.NAV_ACTION]===p.ACTION_MANAGE_CATEGORIES&&n.hasPermission(p.ENTITY_MH_VM,p.ACTION_VIEW)&&(t=p.ENTITY_MH_VM),t},loadEntityAPIDefinition:function(){this.definition=t.getEntityDefinition(this.entityType,this.actionRoute[p.NAV_ACTION]),this.actionRoute.generateTemplate||(this.template=t.getTemplate(this.actionRoute,this.viewType))},loadDataFromDefinition:function(e){var i=this,s=this.getTemplateViewAttribute(h.DP.TMPL_ATTRS.FETCH_DEFINITION)||"";_.isArray(s)&&(s=s.join(","));var a;s&&(a=s.split(","));var o=[];a=_.filter(a,function(e){var t=r.removeFilterName(e);return!!n.hasPermission(t,p.ACTION_VIEW)||(u.log("IntentDynamicView: No view access for entity: "+t),o.push(t),!1)},this);var c=[];c.push(new Promise(function(n){t.loadEntityAndIntentData(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e&&_.each(o,function(t){e[t]={}}),n(e)},a,i.actionRoute,e)}));var d=this.getTemplateViewAttribute(h.DP.TMPL_ATTRS.CUSTOM_FETCH_DEFINITION)||"";_.isString(d)&&d&&c.push(new Promise(function(e){l.fetch(d,{uuid:i.actionRoute.actionTargetId,success:function(t){e(t)},error:function(){e({})}})})),Promise.all(c).then(function(e){var t={};_.isArray(e)&&_.each(e,function(e){_.isObject(e)&&(t=_.extend({},t,e))}),i.onAllIntentDataFetched(t)})},onAllIntentDataFetched:function(e){if(!_.isEmpty(this.subViewHelper)){_.isEmpty(e)||this.setDataObject(e),this.setIntentModel(),this.$(".data-loader").remove(),this.renderForm(),this.filterElementBasedOnAccess();var t=this.getIntentModel().getFormDataObj();this.setFormWithData(t),this.invokeCustomFormPostRender(),this.setFormControlsWithData(t)}},setFormControlsWithData:function(e){if(e&&!_.isEmpty(e)){var t=this.subViewHelper.getIds();_.each(t,function(t){if(0===t.indexOf(C.FORM_CONTROL_VIEW)){this.subViewHelper.get(t).setFormControlWithData(e)}},this)}},isEntityAPIDefinitionLoaded:function(){return this.definition},getDataObject:function(){return this.dataObject||(this.dataObject=t.initializeDataObject()),this.dataObject},setDataObject:function(e){this.dataObject=e},getTemplate:function(){return this.template},getTemplateString:function(){return this.getTemplate()?this.getTemplate()(this.vtOptions({data:this.getDataObject(),actionRoute:this.actionRoute,HypervisorUtil:m,AccessManager:n,ClusterManager:this.clusterManager,DataURLConstants:d})):null},getTemplateViewAttribute:function(e){var t=this.getTemplateString()||"",n=t.match(new RegExp("("+e+")=[\"']?((?:.(?![\"']?\\s+(?:\\S+)=|[>\"']))+.)[\"']?","g")),i=[];return _.each(n,function(t){var n=t.replace(new RegExp(e+"=","g"),"").replace(new RegExp('"',"g"),"");i.push(n)}),1===i.length?i=i[0]:0===i.length&&(i=null),i},getTemplateConfiguration:function(){return{isPagePopup:"true"===this.getTemplateViewAttribute(h.DP.TMPL_ATTRS.META_PAGE_POPUP),isHideSave:"false"!==this.getTemplateViewAttribute(h.DP.TMPL_ATTRS.META_HIDE_SAVE),hideCancel:"true"===this.getTemplateViewAttribute(h.DP.TMPL_ATTRS.META_HIDE_CANCEL),hideSaveAction:"true"===this.getTemplateViewAttribute(h.DP.TMPL_ATTRS.META_HIDE_SAVE_ACTION),mainClass:this.getTemplateViewAttribute(h.DP.TMPL_ATTRS.META_MAIN_CLASS),saveText:this.getTemplateViewAttribute(h.DP.TMPL_ATTRS.META_SAVE_TEXT),title:this.getTemplateViewAttribute(h.DP.TMPL_ATTRS.META_POPUP_TITLE),preventDefaultSave:"true"===this.getTemplateViewAttribute(h.DP.TMPL_ATTRS.META_PREVENT_DEFAULT_SAVE)}},getDefinition:function(){return this.definition},formAttrDescriptor:function(e,t){var n={};return n.attribute=t?t+"."+e:e,n.basicAttribute=e,n.entityType=this.entityType,n.definition=this.getDefinitionAttributeObject(e),n},getFormView:function(){if(this.subViewHelper)return this.subViewHelper.get(this.formViewId)},getFormViewId:function(){return this.formViewId},contentEl:function(e){switch(this.viewType){case t.VIEW_TYPE.PAGE:case t.VIEW_TYPE.LIST:return this.$el;case t.VIEW_TYPE.POPUP:default:return this.$("."+T.CLASS_MODAL_CONTENT+(e?" "+e:""))}},renderForm:function(){this.template?this.renderFormTemplate():this.renderFormFromRawSwagger(),this.trigger(g.INTENT_VIEW_RENDER)},renderFormTemplate:function(){var e=this.getTemplateString();this.contentEl().html(e),this.applyNutanixInput(),this.renderCustomFormView(),this.renderCustomFormControlsView(),this.$("input[autofocus=true]").focus()},renderCustomFormView:function(){var e,t=this.$("["+h.DP.TMPL_ATTRS.VIEW_FORM+"]"),n=this.$("["+h.DP.TMPL_ATTRS.PARTIAL_UPDATE+"]");if(n.length){"true"===n.attr(h.DP.TMPL_ATTRS.PARTIAL_UPDATE)&&(this.isPartialUpdate=!0)}if(1===t.length){e=t.attr(h.DP.TMPL_ATTRS.VIEW_FORM),this.formViewId=u.randomId(C.FORM_VIEW),this.viewOptions=this.viewOptions||{},this.viewOptions.viewId=this.formViewId;var i=h.getFormView(e,{el:t,popupEl:this.$el,dataObject:this.dataObject,intentElView:this.intentElView,parentViewName:this.name,viewOptions:this.viewOptions,template:this.getTemplate(),intentModel:this.getIntentModel(),templateConfig:this.getTemplateConfiguration(),eventBus:this.eventBus,actionRoute:this.actionRoute,saveCallback:this.saveCallback,formViewId:this.formViewId});this.subViewHelper.register(this.formViewId,i)}else if(t.length>1)throw new Error("There can only be 1 "+h.DP.TMPL_ATTRS.VIEW_FORM)},filterElementBasedOnAccess:function(){var e,t=h.DP.TMPL_ATTRS.HAS_ACCESS,i=h.DP.TMPL_ATTRS.ENV,s=this.getTemplateViewAttribute(t)||"";e=_.isArray(s)?s:[s],e=_.uniq(e),_.each(e,function(e){n.hasPermission(e,p.ACTION_VIEW)||this.$("["+t+"="+e+"]").remove()},this);var a=this.getTemplateViewAttribute(i),r=void 0;_.isArray(a)?(r=a,r=_.uniq(r)):r=[a];var l=o.getEnvironmentMode();_.each(r,function(e){l!==e&&this.$("["+i+"="+e+"]").remove()},this)},invokeCustomFormPostRender:function(){if(this.subViewHelper){var e=this.subViewHelper.get(this.formViewId);e&&_.isFunction(e.postRender)&&e.postRender()}},renderCustomFormControlsView:function(){var e=this.$("["+h.DP.TMPL_ATTRS.VIEW_FORM_CONTROL+"]");_.each(e,function(e){var t=$(e),n=t.attr(h.DP.TMPL_ATTRS.VIEW_FORM_CONTROL),i=t.attr(h.DP.TMPL_ATTRS.VIEW_ATTRIBUTE),s={};if(!i)throw new Error("Need an attribute for "+n);s.attribute=i;var a=t.attr(h.DP.TMPL_ATTRS.VIEW_DATA_LIST);a&&(s.dataList=a),s.formatter=n;var o=h.getFormControlView(s,{el:t,parentViewName:this.name,dataObject:this.dataObject,eventBus:this.eventBus,actionRoute:this.actionRoute,formViewId:this.formViewId}),r=u.randomId(C.FORM_CONTROL_VIEW);this.subViewHelper.register(r,o),this.registerEventTriggersAndListeners(r,o,s)},this)},renderFormFromRawSwagger:function(){this.contentEl().html(E({formId:"defaultForm"}));var e=t.getDefinitionAttributes(this.definition);this.renderFormDefinition(e)},renderFormDefinition:function(e,t){_.each(_.keys(e.properties),function(e){this.renderFormItem(e,t)},this)},renderFormItem:function(e,n){var i=this.formAttrDescriptor(e,n);if(i&&i.definition&&i.definition.$ref){var s=t.getEntityDefinition(i.definition.$ref);this.renderFormDefinition(s,e)}else{if(!i)throw new Error("Invalid attrDescriptor for "+e);var a=h.getFormControlView(i,{parentViewName:this.name});this.subViewHelper.register(u.randomId(i.attribute),a),this.contentEl("#defaultForm").append(a.el)}},setIntentModel:function(){var e=this.getTemplateViewAttribute(h.DP.TMPL_ATTRS.INTENT_MODEL)||"";this.intentModel=h.getIntentModel(e),this.intentModel&&(this.intentModel.entityType=this.entityType,this.intentModel.actionRoute=this.actionRoute),this.updateDataModel()},getIntentModel:function(){return this.intentModel},updateDataModel:function(){this.intentModel.setDataObject(this.getDataObject());var e=t.getUrlObjectUsingActionRoute(this.actionRoute);e&&e.url&&this.intentModel.setRootUrl(e.url),e&&e.method&&e.method===t.SWAGGER_REST.PUT&&this.intentModel.isNew(!1),this.setSpecVersion()},setSpecVersion:function(){var e=this.getDataObject(),t=e.entity;if(t){var n=t[S.PROPS.PROP_METADATA]||{},i=n[S.PROPS.PROP_SPEC_VERSION];_.isNumber(i)&&(this.intentModel.specVersion=i)}},getDefinitionAttributeObject:function(e){return t.getDefinitionAttribute(this.definition,e)},getRequiredAttributes:function(){return this.definition.required},setFormControlViewProperties:function(e){return _.each(this.subViewHelper.subViews,function(t){if(_.isFunction(t.isEnabled)&&t.isEnabled()&&_.isFunction(t.isValueProcessedInView)&&t.isValueProcessedInView()&&t.getAttributeKey()){var n=t.getAttributeKey(),i=t.getValue(e);if(n)for(var s=n.split("."),a=s.length,o=e,r=0;r<a;r++){var l=s[r];void 0===o[l]&&r+1!==a&&(o[l]={}),r+1===a?(delete o[l],_.isObject(i)&&!_.isArray(i)||_.isString(i)?(i instanceof File||i instanceof Blob||!_.isEmpty(i))&&(o[l]=i):o[l]=i):o=o[l]}}},this),e},saveForm:function(e){if(this.intentModel){var t=this.subViewHelper.get(this.formViewId),n=this.getDataModel();if(t&&_.isFunction(t.getWizardState)&&(n[p.INTENT_WIZARD_STATE]=t.getWizardState()),t&&_.isFunction(t.updateViewOptions)&&(e=t.updateViewOptions(e)),this.actionRoute&&this.actionRoute.options&&this.actionRoute.options[p.NAV_ACTION_ROUTE_OPTION_BATCH]){if(a.hasCreateAction(u.getEntityTypeEB(this.entityType),this.actionRoute.actionId)&&(n=this.getDataModelForBatchCreate()),this.validateForm(!1)){if(_.isArray(n)){var i=[];_.each(n,function(e){var t=this.setFormControlViewProperties(e);i.push(t)},this),n=i}else n=this.setFormControlViewProperties(n);this.batchSaveEntities(n,e)}}else n=this.setFormControlViewProperties(n),_.isFunction(this.intentModel.mapModelToSwagger)?(n=this.intentModel.mapModelToSwagger(n,this.actionRoute,this.fillAndSaveIntentModel,e))&&this.fillAndSaveIntentModel(n,e):this.fillAndSaveIntentModel(n,e)}},fillAndSaveIntentModel:function(e,n){if(arguments.length>2&&void 0!==arguments[2]&&arguments[2]||(e=t.mapModelToSwagger(this.entityType,e,this.actionRoute)),_.isNumber(this.intentModel.specVersion)){var i=this.intentModel.specVersion,s=e[S.PROPS.PROP_METADATA]||{};s[S.PROPS.PROP_SPEC_VERSION]=i,e[S.PROPS.PROP_METADATA]=s}if(this.isPartialUpdate){var a=this.getDataObject(),o=a.entity;e=t.mergeEntityWithViewModel(o,e)}this.intentModel.set(e),this.saveEntity(n)},deleteEntity:function(e){if(this.model&&this.model.models&&this.model.get(e)){this.intentModel=this.model.get(e);var t=this;this.intentModel.destroy({success:function(e,t){},error:function(e,n){t.trigger(g.INTENT_SAVE_ERROR,e,n)}})}},batchSaveEntities:function(e,t){var n=require("managers/BatchManager");this.intentModel&&(a.hasCreateAction(u.getEntityTypeEB(this.entityType),this.actionRoute.actionId)?this.prepareDataAndExecuteBatchCreate(e,t,n):this.prepareDataAndExecuteBatchUpdate(e,t,n))},prepareDataAndExecuteBatchCreate:function(e,n,a){var o=t.getURLObject(this.entityType,t.SWAGGER_REST.POST,{includeUuid:!1}),r=o.url;t.initializeDataObject().batch_entities=[];var l=e;if(!n.hideLatencyNotification)var c=i.showIntentActionNotification(p.ACTION_CREATE,this.entityType,l);var d=a.createBatchRequestObj();_.each(l,function(e){var n;_.isFunction(this.intentModel.mapModelToSwagger)&&(n=this.intentModel.mapModelToSwagger(e)),n=t.mapModelToSwagger(this.entityType,n,this.actionRoute);var i=a.createRequest(t.SWAGGER_REST.POST,r,n);d[a.DP.API_REQUEST_LIST].push(i)},this);var h=this,m=p.ACTION_CREATE;a.performBatch({requestBody:d,success:function(e,t){n.hideLatencyNotification||i.showIntentSuccessNotification(m,h.entityType,l,c);var o=h.getCreatedEntityIdsForBatchCreate(e,a);h.eventBus&&h.eventBus.trigger(p.SSP_EVENTS.BATCH_ENTITIES_CREATED,o);var r=h.getESTOptionsForBatchCreate(e,o,a);s.addIntentSpecEntities(o,u.getEntityTypeEB(h.entityType),r),g.triggerAppEvent(g.REFRESH_PENDING_ENTITIES),n.success&&n.success(e,t)},error:function(e,t){n.hideLatencyNotification||i.hideLatencyMessage(c),h.trigger(g.INTENT_SAVE_ERROR,e,t),n.error&&n.error(e,t)}},this)},getCreatedEntityIdsForBatchCreate:function(e,t){var n=[];return _.each(e[t.DP.API_RESPONSE_LIST],function(e){var i=e&&e[t.DP.RESPONSE.API_RESPONSE],s=i&&i[c.INTENT_METADATA],a=s&&s[c.UUID];n.push(a)}),n},getESTOptionsForBatchCreate:function(e,t,n){var i={};return _.each(e[n.DP.API_RESPONSE_LIST],function(e){var t=e&&e[n.DP.RESPONSE.API_RESPONSE],s=t&&t[c.INTENT_METADATA],a=s&&s[c.UUID],o=t&&t[c.INTENT_SPEC],r=o&&o[c.NAME];i[a]={name:r,isBatchCreate:!0,ignoreESTQueryModelMap:!0}}),i},prepareDataAndExecuteBatchUpdate:function(e,n,a){var o=t.getURLObject(this.entityType,t.SWAGGER_REST.PUT,{includeUuid:!0}),r=o.url;if(!r)return void u.log("IntentDynamicView: batch entity URL not specified");var l=this.getDataObject(),d=_.map(l.batch_entities,function(e){var n=e[t.SWAGGER_PROPERTIES.PROP_METADATA];return n&&n[c.UUID]});d=_.filter(d,function(e){return e});var h=i.showIntentActionNotification(p.ACTION_UPDATE,this.entityType,d),m=a.createBatchRequestObj();_.each(l.batch_entities,function(n){var i=n[t.SWAGGER_PROPERTIES.PROP_METADATA],s=i&&i[c.UUID];if(s){var o=r.replace(t.SWAGGER_PROPERTIES.UUID,s),l=this.intentModel.populateBatchEntity(this.actionRoute.actionId,n,e),d=a.createRequest(t.SWAGGER_REST.PUT,o,l);m[a.DP.API_REQUEST_LIST].push(d)}},this);var f=this,v=p.ACTION_UPDATE;a.performBatch({requestBody:m,success:function(e,t){if(a.hasErrorInBatchResponse(e)){var o=a.extractErrorsInBatchResponse(e),r=o.length?o.join(","):"";i.showClientNotification(p.NOTIFY_ERROR,f.i18ns("batch_error",r))}else i.showIntentSuccessNotification(v,f.entityType,d,h);s.addEntities(d,u.getEntityTypeEB(f.entityType)),g.triggerAppEvent(g.REFRESH_PENDING_ENTITIES),n.success&&n.success(e,t)},error:function(e,t){h&&i.hideLatencyMessage(h),f.trigger(g.INTENT_SAVE_ERROR,e,t),n.error&&n.error(e,t)}})},saveEntity:function(e){if(this.intentModel){var t=this.intentModel.isSwaggerValidationNeeded();if(this.validateForm(t)){if(this.actionRoute&&this.actionRoute.actionRouteOverlay&&this.subViewHelper){var n=this.subViewHelper.get(this.formViewId);if(n){var i=n.saveEntity(this.intentModel);if(e.success&&i)return e.success(this.intentModel,i),void g.triggerAppEvent(g.INTENT_LOCAL_SAVE_SUCCESS,i)}}this.mode===p.ACTION_CREATE&&(this.intentModel.id=null);var s=this;this.intentModel.save(null,{success:function(t,n){e.success&&e.success(t,n)},error:function(t,n){s.trigger(g.INTENT_SAVE_ERROR,t,n),e.error&&e.error(t,n)}})}}},registerEventTriggersAndListeners:function(e,t,n){var i=this,s=t.$el,a=s.attr(h.DP.TMPL_ATTRS.TRIGGER_EVENT);if(a){var o,r,l=a.split(":");2===l.length&&(o=l[0],r=l[1]),1===l.length&&(o="click",r=l[0]),s.on(o,function(e){i.$el.trigger(r,$(e.target).val()),e.stopPropagation()})}var c=s.attr(h.DP.TMPL_ATTRS.LISTENER_EVENT);if(c){var d,p,m=c.split(":");2===m.length&&(d=m[0],p=m[1]),1===m.length&&(d=m[0],p="render"),i.$el.on(d,function(t,s){var a=i.subViewHelper.get(e);_.isFunction(a[p])?a[p](n,s,t):u.debug("IntentDynamicView | Invalid function name specified for listener event",c)})}},validateForm:function(e){var n=!0;e=!_.isBoolean(e)||e;var i=[];_.each(this.subViewHelper.subViews,function(e){_.isFunction(e.validate)&&i.push(e.validate())},this),i=_.flatten(i);var s=f.validateFormValues(this.$el),a=[];e&&(a=t.validateIntentDataModel(this.intentModel,this.actionRoute));var o=_.union(i,s,a);if(o&&o.length){n=!1;var r=f.defaultErrorHandler(this.$el,o),l=this.subViewHelper.get(this.formViewId),c=null;l&&l.sectionNavigator&&(c=l.sectionNavigator),c&&c.$el&&c.runErrorHandler(this.$el,o),this.trigger(g.INTENT_SAVE_ERROR,this.intentModel,r)}else f.removeAllErrors(this.$el);return n}})}),define("text!templates/popups/intent/IntentDynamicPopupView.html",[],function(){return'<div class="modal-header">\n  <button type="button" class="btnHeaderClose close" data-dismiss="modal">\n    <i data-icon="K" aria-hidden="true"></i>\n  </button>\n  <h4 class="n-title"><%- title %> <%=betaBadge%></h4>\n  <% if (fullPagePopup) { %>\n  <div class="full-page-loader-elt data-loader"></div>\n  <% } %>\n</div>\n<div class="n-modal-wrapper">\n  <div class="n-modal-body">\n    <div class="n-modal-alert-header">\n      \x3c!-- @view: popup alert goes here... --\x3e\n    </div>\n    <div class="n-modal-content-wrapper">\n      <div class="n-modal-content">\n        <% if (!fullPagePopup) { %>\n        <div class="data-loader">\n          <div class="donut-loader-blue"></div>\n          <span class="loader-msg">\n            <%= i18n(\'loading\') %>\n          </span>\n        </div>\n        <% } %>\n        \x3c!-- @view: form items go here... --\x3e\n      </div>\n    </div>\n  </div>\n  <div class="n-modal-footer">\n    \x3c!-- In form mode, we call it cancel, in list mode, its called close--\x3e\n    <% if (!hideCancel) { %>\n    <button class="btnCancel btn"\n            data-test="intent-cancel"\n            data-loading-text="<%= i18n(\'cancel\', \'Cancel\') %>">\n      <%= i18n(\'cancel\', \'Cancel\') %>\n    </button>\n    <% } %>\n    <% if (canModify && !hideSaveAction) { %>\n      <button class="btn btnSave btn-primary"\n              data-test="intent-save"\n              data-loading-text="<%= i18n(\'saving\', \'Saving...\') %>">\n        <%= saveText %>\n      </button>\n    <% } %>\n  </div>\n</div>\n'}),define("views/popups/intent/IntentDynamicPopupView",["views/basecomponents/popups/BasePopupView","views/intent/IntentDynamicView","managers/IntentManager","managers/AccessManager","utils/CommonTemplates","utils/AppConstants","utils/AppUtil","utils/ValidationUtil","utils/EntityUtil","events/AppEvents","text!templates/popups/intent/IntentDynamicPopupView.html"],function(e,t,n,i,s,a,o,r,l,c,d){"use strict";var p=_.template(d);return e.extend({
name:"IntentDynamicPopupView",entityType:null,actionId:null,action:null,config:null,el:"#popupDynamicPopup",intentDynamicView:null,events:{"click  .btnSave":"save","click  .btnCancel":"hide","click  .btnHeaderClose":"hide","keypress input":"onKeyPress"},initialize:function(){e.prototype.initialize.apply(this,arguments),_.bindAll(this,"handleError","handleRender","handleIntentFetchError","handleHideEvent","handleNotification")},destroy:function(){c.offAppEvent(c.INTENT_FETCH_ERROR,this.handleIntentFetchError),c.offAppEvent(c.INTENT_POPUP_CLOSE,this.handleHideEvent),c.offAppEvent(c.INTENT_POPUP_NOTIFY,this.handleNotification),this.intentDynamicView&&(this.intentDynamicView.off(c.INTENT_SAVE_ERROR),this.intentDynamicView.off(c.INTENT_VIEW_RENDER),this.intentDynamicView.destroy()),e.prototype.destroy.apply(this,arguments)},hide:function(e,t){var n=this;if(!0===t)return void this._hidePopup();e&&this.$el.hasClass("full-page-popup")?$.nutanixConfirm({msg:this.i18n("common.confirm_exit"),yes:function(){n._hidePopup()},yesText:this.i18n("yes"),noText:this.i18n("no"),context:this}):this._hidePopup()},show:function(i){e.prototype.show.apply(this,arguments);var s=this;this.intentDynamicView=new t({el:this.$el,saveCallback:this.save.bind(s),intentElView:this}),this._listenToEvents(),this.intentDynamicView.name=this.name;var o=this.actionRoute.actionTarget;this.entityType=o.replace(a.INTENT_ANTEROS_ENTITIES_PREFIX,""),this.actionId=i[a.NAV_ACTION_ID],this.action=i[a.NAV_ACTION],this.intentDynamicView.show({actionRoute:i,viewType:n.VIEW_TYPE.POPUP,renderCallback:function(){s.render()}})},onKeyPress:function(e){if(13===e.keyCode)this.onEnterKeyPress(),e.preventDefault();else{var t=$(e.currentTarget);r.removeError(t)}},handleHideEvent:function(e,t){t.viewId===this.intentDynamicView.getFormViewId()&&this.hide()},handleNotification:function(e,t){if(t.viewId===this.intentDynamicView.getFormViewId())switch(t.close&&this.clearHeader(),t.type){case a.NOTIFY_INFO:this.showHeaderInfo(t.msg);break;case a.NOTIFY_SUCCESS:this.showHeaderSuccess(t.msg);break;case a.NOTIFY_WARNING:this.showHeaderWarning(t.msg);break;case a.NOTIFY_ERROR:this.showHeaderError(t.msg,!1)}},handleError:function(e,t){this.getFooterButtonsEl().button("reset"),this.enableAllFormElements(),this.showHeaderError(t||this.i18n("generic_model_error"),!1),this.scrollToElement(null,this.$el.find(".n-modal-content-wrapper"),{scrollToTop:!0})},handleIntentFetchError:function(e,t){setTimeout(function(){this.showHeaderError(t,!1),this.scrollToElement(null,this.$el.find(".n-modal-content-wrapper"),{scrollToTop:!0})}.bind(this),0)},handleRender:function(){this.getFooterButtonsEl().prop("disabled",!1);var e=this.intentDynamicView.dataObject||{},t=e.entity&&e.entity.status&&e.entity.status.state;if(t&&o.isIntentStateError(this.entityType,t)){var i=n.getIntentErrorMsg(e.entity);i&&this.showHeaderError(i,!1)}},render:function(){if(this.intentDynamicView&&this.intentDynamicView.isEntityAPIDefinitionLoaded()){o.hideLoader();var e=this.intentDynamicView.getTemplateConfiguration();this.config=e;var t=e.isPagePopup,n=this._getPopupTitle(e.title),a=p(this.vtOptions({title:n,betaBadge:this._isBetaFeature()?s.BETA_FEATURE_TEMPLATE(this.vtOptions({})):"",canModify:this.canModifyByEntityType(this.entityType,this.action),fullPagePopup:t,hideCancel:e.hideCancel,saveText:e.saveText||this.i18n("save"),hideSaveAction:e.hideSaveAction}));this.$el.addClass("intent-dynamic-popup"),this.$el.addClass(t?"full-page-popup":"standard-popup"),e.mainClass&&this.$el.addClass(e.mainClass),this.$el.html(a),i.hasAccessToSubmitActions()||this.$(".n-modal-footer").addClass("hidden"),this.getFooterButtonsEl().prop("disabled",!0)}else o.showLoader()},getFooterButtonsEl:function(){return this.$(".n-modal-footer button")},getFormElements:function(){var e=[];return e.push(this.$("input").toArray()),e.push(this.$("textarea").toArray()),e.push(this.$("select").toArray()),e.push(this.$("a").toArray()),e.push(this.$("div.action-remove").toArray()),e.push(this.$("div.action-add").toArray()),_.flatten(e)},enableAllFormElements:function(){var e=a.FORM_CLASSES.DO_NOT_MODIFY;_.each(this.getFormElements(),function(t){var n=$(t);n.hasClass(e)||(n.prop("disabled",!1),("a"===n.selector||n.hasClass("action-add")||n.hasClass("action-remove"))&&n.removeClass("disabled"))}),this.$(".fancy-select:not(."+e+")").removeClass("disabled")},disableAllFormElements:function(){_.each(this.getFormElements(),function(e){var t=$(e);t.prop("disabled",!0),("a"===t.selector||t.hasClass("action-add")||t.hasClass("action-remove"))&&t.addClass("disabled")}),this.$(".fancy-select").addClass("disabled")},save:function(e){if(!(this.config.preventDefaultSave||e&&$(e.currentTarget).hasClass("disabled"))){var t=this.getFooterButtonsEl();t.button("loading"),this.disableAllFormElements();var n=this;this.intentDynamicView.saveForm({success:function(e,i){t.button("reset"),n.enableAllFormElements(),n.intentDynamicView.getTemplateConfiguration().isHideSave&&n.hide(),c.triggerAppEvent(c.INTENT_SAVE_SUCCESS,i),c.triggerAppEvent(c.REFRESH_PENDING_ENTITIES)},error:function(e,i){t.button("reset"),n.enableAllFormElements(),c.triggerAppEvent(c.INTENT_SAVE_ERROR,i)}})}},_listenToEvents:function(){this.intentDynamicView.on(c.INTENT_SAVE_ERROR,this.handleError),c.onAppEvent(c.INTENT_FETCH_ERROR,this.handleIntentFetchError),this.intentDynamicView.on(c.INTENT_VIEW_RENDER,this.handleRender),c.onAppEvent(c.INTENT_POPUP_CLOSE,this.handleHideEvent),c.onAppEvent(c.INTENT_POPUP_NOTIFY,this.handleNotification)},_isBetaFeature:function(){return l.isBetaEntityType(this.entityType)||l.isBetaEntityForm(this.config.mainClass)},_getPopupTitle:function(e){if(e)return this.i18n("title."+e,e);e=this.entityType;var t=this.i18n(this.entityType+"."+this.actionId);return e=t&&t.title?t.title:this.i18n(this.entityType+".title")||e},_hidePopup:function(){this.$(".addTooltip").tooltip("destroy"),e.prototype.hide.apply(this,arguments)},showErrorMessage:function(e,t){var i=void 0;(i=_.isString(e)?e:n.interpretIntentServerError(e))&&(t&&_.isString(t)&&(i+=" "+t),this.showAlert(a.MODAL.ALERT.TYPE_ERROR,i))},showAlert:function(e,t,n){this.intentElView&&this.intentElView.triggerAction&&this.intentElView.triggerAction(a.MODAL.ACT.ALERT_SHOW,{type:e,message:t,closeTiming:n||a.MODAL.ALERT.CLOSE_TYPE_PERMANENT})},hideAlerts:function(){this.intentElView&&this.intentElView.triggerAction&&this.intentElView.triggerAction(a.MODAL.ACT.ALERT_HIDE)}})}),define("views/popups/intent/IntentDynamicOverlayPopupView",["views/popups/intent/IntentDynamicPopupView"],function(e){"use strict";return e.extend({name:"IntentDynamicOverlayPopupView",entityType:null,actionId:null,action:null,config:null,overlay:!0,el:"#popupDynamicOverlayPopup",events:{"click  .btnSave":"save","click  .btnCancel":"hide","click  .btnHeaderClose":"hide","keypress input":"onKeyPress"}})}),define("models/supportcase/SupportCaseModel",["models/BaseModel","managers/NotificationManager","managers/UserBehaviorManager","utils/AppConstants","data/DataProperties","broker/api/AppAPI"],function(e,t,n,i,s,a){"use strict";return e.extend({name:"SupportCaseModel",entityType:i.ENTITY_SUPPORT_CASE,idAttribute:s.SUPPORT_CASE.CASE_ID,showSuccessNotification:function(e,n,s){this.hideLatencyNotification(e,n);var a="ticket_created_message";this.attachingFilesToCaseFailed(s)&&(a="file_attachment_failed_message"),t.showClientNotification(i.NOTIFY_SUCCESS,this.i18ns(a,s.spec.resources.case_number))},showErrorNotification:function(e,n){this.hideLatencyNotification(e,n),t.showClientNotification(i.NOTIFY_ERROR,this.i18n("support_case_create_error"))},save:function(e,t){var s=this,o={};o.$body=this.getRequestSpecFromModel(),o.$isAsync=!1;var r=a.getAppAPI().intentService.create(i.SUPPORT_CASE,o),l="";return r.then(function(e){l=e,s.getModelFromApiResponse(e),s.showSuccessNotification(s,"create",e),t.success(s,e)}).catch(function(e){l=e.message,t.error(s)}).finally(function(){n.recordUserActivities({action:s.entityType,actionTarget:JSON.stringify(l)})})},fetch:function(e){var t=this,n={};return n[s.SUPPORT_CASE.CASE_ID]=this.get(this.idAttribute),a.getAppAPI().intentService.get(i.SUPPORT_CASE,n).then(function(n){var i=n[s.INTENT_STATUS];_.extend(i,i[s.INTENT_RESOURCES]),delete i[s.INTENT_RESOURCES],t.set(i),e.success(t)}).catch(function(n){var i=null;n&&n[1]&&n[1].responseText&&(i=JSON.parse(n[1].responseText)),e.error(t,i)})},getRequestSpecFromModel:function(){var e={};e[s.SUPPORT_CASE.SUBJECT]=this.get([s.SUPPORT_CASE.SUBJECT]),e[s.SUPPORT_CASE.DESCRIPTION]=this.get([s.SUPPORT_CASE.DESCRIPTION]);var t=this.toJSON();return delete t[s.SUPPORT_CASE.SUBJECT],delete t[s.SUPPORT_CASE.DESCRIPTION],e[s.INTENT_RESOURCES]=t,e},attachingFilesToCaseFailed:function(e){if(!(e&&e.spec&&e.spec.message_list))return!1;var t=e.spec.message_list;return _.any(t,this.hasFileAttachmentError)},hasFileAttachmentError:function(e){return e.reason===i.FILE_ATTACHMENT_FAILURE_REASON},getModelFromApiResponse:function(e){var t=e[s.INTENT_SPEC],n=t[s.INTENT_RESOURCES];n[s.SUPPORT_CASE.SUBJECT]=t[s.SUPPORT_CASE.SUBJECT],n[s.SUPPORT_CASE.DESCRIPTION]=t[s.SUPPORT_CASE.DESCRIPTION],this.set(n)}})}),define("models/supportcase/SupportCaseCollection",["models/BaseCollection","models/supportcase/SupportCaseModel","data/DataProperties","broker/api/AppAPI","utils/AppConstants"],function(e,t,n,i,s){"use strict";return e.extend({name:"SupportCaseCollection",model:t,fetch:function(e){var t=this;e=e||{};var n=JSON.stringify(e.hosts),a={};return a.$body={filter:"serial_number=="+n,kind:s.SUPPORT_CASE},i.getAppAPI().intentService.all(s.SUPPORT_CASE,a).then(function(n){e.success(t.reset(t.getModelListFromResponse(n)))}).catch(function(n){var i=null;n&&n.responseText&&(i=JSON.parse(n.responseText)),e.error(t,i)})},getModelListFromResponse:function(e){var t=this,n=e.entities;return n=n.map(function(e){return t.parseModelFromResponse(e)})},parseModelFromResponse:function(e){var i=e[n.INTENT_STATUS],s={};return s.description=i[n.SUPPORT_CASE.DESCRIPTION],s.subject=i[n.SUPPORT_CASE.SUBJECT],_.extend(s,i[n.INTENT_RESOURCES]),new t(s)}})}),define("text!templates/popups/supportcase/ListSupportCaseView.html",[],function(){return'<div class="cases-list-container">\n  <h4 class="cases-count"><%= i18n(\'open_cases\') %>\n    <span data-test="open_cases_count_number">(<%= cases.length%>)</span>\n  </h4>\n  <ul class="cases-list" data-test="open-cases-list">\n    <% _.each(cases, function (supportCase) { %>\n      <li class="case" id="<%= supportCase.case_id %>">\n        <p class="case-list-subject"><%= supportCase.subject %></p>\n        <p class="case-list-number"><%= i18n(\'case_number\') %>\n         <span class="case-number"><%= supportCase.case_number %></span>\n        </p>\n      </li>\n    <% }) %>\n  </ul>\n</div>\n<div class="case-description"></div>\n<div class="case-detail"></div>\n'}),define("text!templates/popups/supportcase/SupportCaseDetails.html",[],function(){return"<h4><%= i18n('key_insights') %></h4>\n<table>\n  <tr>\n    <td><%= i18n('status') %></td>\n    <td data-test=\"open_cases_status\"><%= supportCase.status %></td>\n  </tr>\n  <tr>\n    <td><%= i18n('created_by') %></td>\n    <td data-test=\"open_cases_created_by_value\">\n      <%= supportCase.creator_name%>\n    </td>\n  </tr>\n  <tr>\n    <td><%= i18n('type') %></td>\n    <td data-test=\"open_cases_type_value\"><%= supportCase.case_type%></td>\n  </tr>\n  <tr>\n    <td><%= i18n('case_number') %></td>\n    <td data-test=\"open_cases_case_number_value\">\n      <%= supportCase.case_number%>\n    </td>\n  </tr>\n  <tr>\n    <td><%= i18n('serial_number') %></td>\n    <td data-test=\"open_cases_serial_number_value\">\n      <%= supportCase.serial_number%>\n    </td>\n  </tr>\n  <tr>\n    <td><%= i18n('access_portal') %></td>\n    <td>\n      <a\n        class=\"case-detail-portal-link\"\n        href=\"<%= caseUrl + case_id %>\"\n        target=\"_blank\">\n        <%= i18n('view_details_in_portal') %>\n      </a>\n    </td>\n</table>\n"}),define("text!templates/popups/supportcase/SupportCaseNoCaseTemplate.html",[],function(){return'<div class="no-case-container">\n  <h2><%= i18n("support_cases") %></h2>\n  <%= SVG.loadSVG(SVG.NO_SUPPORT_CASE) %>\n  <p><%= i18n("no_case_message") %></p>\n  <% if (isAdminUser) { %>\n    <button class="btn -blue createCaseNoCaseTmpl"\n      data-test="create_new_support_case_btn_no_case">\n      <%= i18n("open_support_case") %>\n    </button>\n  <% } %>\n</div>'}),define("text!templates/popups/supportcase/SupportCaseDescription.html",[],function(){return'<div class="case-description-created-on">\n  <%= i18n(\'created_on\') %>\n  <span class="case-creation-date"\n    data-test="open_cases_created_on_value">\n    <%= supportCase.creation_date %>\n  </span>\n</div>\n\n<h2 class="case-description-subject"\n  data-test="open_cases_title_value">\n  <%= supportCase.subject %>\n</h2>\n\n<span class="case-description-priority <%= priorityClass %>"\n  data-test="open_cases_desc_priority">\n  <%= supportCase.priority %>\n</span>\n\n<% if(attachments && attachments.length) { %>\n  <div class="case-attachment-heading"><%= i18n(\'attachments\') %></div>\n  <% _.each(attachments, function (attachment) { %>\n    <span class = "case-description-attachment"\n      data-test="open_case_attachment">\n      <%= attachment.fileName %>\n    </span>\n  <% }) %>\n<% } %>\n\n<div class="case-description-heading"><%= i18n(\'description\') %></div>\n<p class="case-description-text"\n   data-test="open_cases_desc_value">\n  <%= supportCase.description %>\n</p>'}),define("views/popups/supportcase/ListSupportCaseView",["bluebird","managers/AccessManager","views/basecomponents/BaseView","models/portal/PortalProxyConfigModel","models/supportcase/SupportCaseCollection","models/cluster/ClusterCollection","data/DataURLConstants","data/DataProperties","utils/AppConstants","text!templates/popups/supportcase/ListSupportCaseView.html","text!templates/popups/supportcase/SupportCaseDetails.html","text!templates/popups/supportcase/SupportCaseNoCaseTemplate.html","text!templates/popups/supportcase/SupportCaseDescription.html"],function(e,t,n,i,s,a,o,r,l,c,d,p,u){"use strict";var h=_.template(c),m=_.template(d),f=_.template(u),v='<div class="text-center"><div class="donut-loader-blue-large case-loading"></div></div>',g=_.template(p);return n.extend({name:"ListSupportCaseView",eventBus:null,events:{"click .case":"onCaseClick","click .createCaseNoCaseTmpl":"createCaseFromNoCaseTemplate"},initialize:function(e){this.supportCaseCollection=new s,this.clusterCollection=new a,this.activeModelId=null,this.eventBus=e.eventBus,this.parentView=e.parentView,this.proxyConfigModel=new i,n.prototype.initialize.apply(this,arguments),this.eventBus.bind(l.SHOW_LIST_ACTION,this.showListViewProxy.bind(this))},onCaseClick:function(e){var t=this,n=$(e.currentTarget),i=e.currentTarget.id;$(".case.active").removeClass("active"),n.addClass("active");var s=this.findCaseWithId(this.supportCaseCollection,i);this.renderCaseDetails(s).then(function(){return t.showCaseDetails(t.activeModel.toJSON())}).catch(function(){t.eventBus.trigger(l.SUPPORT_CASE_HEADER_ERROR)}),this.$(".case-detail").html(v),this.$(".case-description").html(v)},findCaseWithId:function(e,t){if(e&&0!==e.length){if(!t)return e.at(0);var n=e.model.prototype.idAttribute,i={};i[n]=t;var s=e.where(i);if(0!==s.length)return s[0]}},showCaseDetails:function(e){var t=e.priority.split(" ")[0].toLowerCase(),n=null;e.custom_key_values.attachments&&(n=JSON.parse(e.custom_key_values.attachments)),this.$(".case-detail").html(m(this.vtOptions({supportCase:e,caseUrl:o.SUPPORT_PORTAL_CASE_LINK_TEMPLATE,case_id:e.case_id}))),this.$(".case-description").html(f(this.vtOptions({supportCase:e,priorityClass:t,attachments:n})))},createCaseFromNoCaseTemplate:function(){this.eventBus.trigger(l.CREATE_SUPPORT_CASE_FROM_NO_CASE_TEMPLATE)},showListViewProxy:function(e){this.showListView(e.id)},showListView:function(e){var t=this;this.clusterCollection.fetch({success:function(n){if(!n.length)return void t.eventBus.trigger(l.SHOW_NO_PE_SCREEN);var i=[];n.each(function(e){i=i.concat(e.get([r.CLUSTER_BLOCK_SERIALS]))}),t.supportCaseCollection.fetch({hosts:i,force:!0,success:function(n,i){if(n.length){var s=t.findCaseWithId(n,e);t.renderCaseDetails(s).then(t.render.bind(t)).catch(function(){t.eventBus.trigger(l.SUPPORT_CASE_HEADER_ERROR)})}else t.parentView.$(".loader-view").hide(),t.render()},error:function(e,n){t.parentView.showV3HeaderError(n)}})},error:function(){t.eventBus.trigger(l.SUPPORT_CASE_HEADER_ERROR)}})},renderCaseDetails:function(t){var n=this;return new e(function(e,i){t.fetch({success:function(t){n.activeModel=t,n.parentView.$(".loader-view").hide(),e()},error:i})})},render:function(){var e=this.supportCaseCollection.toJSON();return e.length?(this.$el.html(h(this.vtOptions({cases:e}))),this.showCaseDetails(this.activeModel.toJSON()),this.$(".cases-list li#"+this.activeModel.get(this.activeModel.idAttribute)).addClass("active"),this.parentView.$(".modal-header .createCase").show()):this.$el.html(g(this.vtOptions({isAdminUser:t.isAdminUser()}))),this.$el.show(),this}})}),define("text!templates/popups/supportcase/OpenSupportCaseView.html",[],function(){return'<div class="createCaseForm create-case-form">\n  <h4 class="case-create-section-heading"><%= i18n(\'support_case_details\') %></h4>\n  <form class="form-horizontal">\n    <div class="control-group">\n      <label class="control-label" for="supportCaseSubject">\n      <%= i18n(\'subject\') %>*\n      </label>\n      <div class="controls">\n        <input\n          class="support-case-subject" id="supportCaseSubject"\n          placeholder="<%= i18n(\'name_of_the_issue\') %>"\n          data-test="create_support_cases_subj_input">\n      </div>\n    </div>\n    <div class="control-groups-inline">\n      <div class="control-group container-wrapper">\n        <label>\n        <%= i18n(\'issue_category\') %>\n        </label>\n        <div class="controls">\n          <%= Components.select({\n            jsClasses : \'issueCategory\',\n            options : issueCategory,\n            dataTestAttribute: \'create_support_cases_issue_cat_drpdwn\'\n          }) %>\n        </div>\n      </div>\n      <div class="control-group container-wrapper">\n        <label>\n        <%= i18n(\'priority\') %>\n        </label>\n        <div class="controls">\n          <%= Components.select({\n            jsClasses : \'priority\',\n            options : priorityOptions,\n            dataTestAttribute: \'create_support_cases_priority_drpdwn\'\n          }) %>\n        </div>\n      </div>\n    </div>\n    <div class="control-groups-inline">\n      <div class="control-group container-wrapper">\n        <label>\n          <%= i18n(\'cluster\') %>\n        </label>\n        <div class="controls">\n          <%= Components.select({\n            jsClasses : \'cluster\',\n            id: \'supportCaseClusterSelect\',\n            options : clusters,\n            dataTestAttribute: \'create_support_cases_cluster_drpdwn\'\n          }) %>\n        </div>\n      </div>\n      <div class="control-group container-wrapper">\n        <label>\n          <%= i18n(\'block_serial_number\') %>\n        </label>\n        <span class="serial-number-tooltip"\n          data-toggle="tooltip"\n          data-original-title =\n            "<%= i18n(\'not_supported_block_tooltip_message\') %>" >\n          <%= Components.icon("question-tooltip","-regular -inline") %>\n        </span>\n        <div class="controls">\n          <%= Components.select({\n            jsClasses : \'blockSerial\',\n            id: \'supportCaseSerialSelect\',\n            options : serials,\n            dataTestAttribute: \'create_support_cases_serial_no_drpdwn\'\n          }) %>\n        </div>\n      </div>\n    </div>\n    <div class="control-group">\n      <label class="control-label">\n        <%= i18n(\'problem_description\') %>*\n      </label>\n      <div class="controls">\n        <textarea\n          class="description"\n          data-test="create_support_cases_tellusmore_input"></textarea>\n      </div>\n    </div>\n    <h4 class="case-create-section-heading"><%= i18n(\'attachments\') %></h4>\n    <div class="control-groups-inline choose-log-attachement">\n      <div class="control-group container-wrapper">\n        <label class="log-title-label">\n          <%= i18n(\'attach_log_bundle\') %>\n          <span class="time-period">(<%= i18n(\'for_last_four_hours\') %>)</span>\n        </label>\n        <div class="control-group container-wrapper">\n          <div class="label-to-choose">\n            <%= Components.checkbox({\n              id: \'logForPc\',\n              dataTestAttribute: \'create_support_cases_attach_log_pc_checkbox\'\n            }) %>\n            <label for="logForPc">\n               <%= i18n(\'for_pc\') %>\n            </label>\n            <div class="anonymize-log anonymise-log-bundle-pc">\n              <%= Components.checkbox({\n                id: \'pclogBundle\',\n                dataTestAttribute: \'create_support_cases_anonymise_log_pc_checkbox\'\n              }) %>\n              <label for="pclogBundle">\n                 <%= i18n(\'anonymise_log_bundle\') %>\n              </label>\n            </div>\n          </div>\n          <div class="label-to-choose">\n            <%= Components.checkbox({\n              id: \'logForPe\',\n              dataTestAttribute: \'create_support_cases_attach_log_pe_checkbox\'\n            }) %>\n            <label for="logForPe">\n               <%= i18n(\'for_pe\') %>\n            </label>\n            <div class="anonymize-log anonymise-log-bundle-pe">\n              <%= Components.checkbox({\n                id: \'pelogBundle\',\n                dataTestAttribute: \'create_support_cases_anonymise_log_pe_checkbox\'\n              }) %>\n              <label for="pelogBundle">\n                 <%= i18n(\'anonymise_log_bundle\') %>\n              </label>\n            </div>\n          </div>\n        </div>\n      </div>\n      <div class="control-group container-wrapper">\n        <label class="log-title-label">\n          <%= i18n(\'attach_ncc_summary\') %>\n        </label>\n        <div class="control-group container-wrapper">\n          <div class="label-to-choose">\n            <%= Components.checkbox({\n              id: \'nccForPc\',\n              dataTestAttribute: \'create_support_cases_attach_ncc_pc_checkbox\'\n            }) %>\n            <label for="nccForPc">\n               <%= i18n(\'for_pc\') %>\n            </label>\n          </div>\n          <div class="label-to-choose">\n            <%= Components.checkbox({\n              id: \'nccForPe\',\n              dataTestAttribute: \'create_support_cases_attach_ncc_pe_checkbox\'\n            }) %>\n            <label for="nccForPe">\n               <%= i18n(\'for_pe\') %>\n            </label>\n          </div>\n        </div>\n      </div>\n    </div>\n    <h4 class="case-create-section-heading"><%= i18n(\'contact_details\') %></h4>\n    <div class="control-group">\n      <div class="controls inputs-inline">\n        <input\n          value="<%= profile.name || \'\' %>"\n          data-test="create_support_cases_contact_name_input"\n          class="support-case-contact-name" id="contactName"\n          placeholder="<%= i18n(\'name\') %>">\n        <input\n          data-test="create_support_cases_contact_phone_input"\n          class="support-case-contact-phone" id="contactPhone"\n          placeholder="<%= i18n(\'phone_number\') %>">\n      </div>\n      <div class="controls">\n        <input\n          value="<%= profile.emailId || \'\' %>"\n          data-test="create_support_cases_contact_email"\n          class="support-case-contact-email" id="contactEmail"\n          placeholder="<%= i18n(\'email\') %>">\n      </div>\n    </div>\n    <div class="control-group">\n      <label class="control-label" for="supportCaseSubject">\n        <%= i18n(\'additional_user_notifications\') %>\n      </label>\n      <div class="controls">\n        <input\n          data-test="support-case-contact-extra-email"\n          class="support-case-contact-extra-email" id="emails"\n          placeholder="<%= i18n(\'upto_two_email\') %>">\n      </div>\n    </div>\n  </form>\n</div>\n'}),define("views/popups/supportcase/OpenSupportCaseView",["managers/ClusterManager","views/basecomponents/BaseView","models/supportcase/SupportCaseModel","models/UpdateProfileModel","models/cluster/ClusterCollection","data/DataProperties","utils/AppConstants","utils/ValidationUtil","utils/HypervisorUtil","text!templates/popups/supportcase/OpenSupportCaseView.html"],function(e,t,n,i,s,a,o,r,l,c){"use strict";var d=[{value:"P1",name:"P1 - Emergency",selected:!1},{value:"P2",name:"P2 - Critical",selected:!1},{value:"P3",name:"P3 - Normal",selected:!0},{value:"P4",name:"P4 - Low",selected:!1},{value:"RFE",name:"RFE - Request for Enhancement",selected:!1}],p=[{name:"Technical Problem",value:"Technical Problem",selected:!1},{name:"Question",value:"Question",selected:!1},{name:"Comment/Feedback",value:"Comment/Feedback",selected:!1},{name:"Scheduled Upgrade/Maintenance",value:"Scheduled Upgrade/Maintenance",selected:!1},{name:"RFE",value:"RFE",selected:!1},{name:"Licensing",value:"Licensing",selected:!1},{name:"Non Technical issue",value:"Non Technical issue",selected:!1},{name:"Technical Problem - Foundation",value:"Technical Problem - Foundation",selected:!1}];return t.extend({name:"OpenSupportCaseView",model:null,clusterHostMap:null,events:{"change #supportCaseClusterSelect":"updateBlockSerials","change #logForPc":"onPcLogBundleUploadChange","change #logForPe":"onPeLogBundleUploadChange"},initialize:function(e){this.profileModel=new i,this.el=e.el,this.eventBus=e.eventBus,this.parentView=e.parentView,this.eventBus.bind(o.CREATE_CASE_ACTION,this.onSaveClick.bind(this)),t.prototype.initialize.apply(this,arguments)},render:function(){var e=this,t=_.template(c);return(new s).fetch({success:function(n,i){var s={};n.each(function(e){var t=e.get(a.UUID);s[t]||(s[t]={},s[t].name=e.get(a.CLUSTER_NAME),s[t].blocks=e.get(a.CLUSTER_RACKABLE_UNITS))}),e.clusterHostMap=s;var o=n.map(function(e){return{name:e.get(a.CLUSTER_NAME),value:e.get(a.UUID)}}),r=[];o.length&&(r=n.at(0).get(a.CLUSTER_RACKABLE_UNITS).map(function(t){return{name:t[a.SERIAL],value:t[a.SERIAL],disabled:e.isSupportCaseCreationEnabledOnBlock(t)}})),e.profileModel.fetch().always(function(){e.parentView.$(".loader-view").hide(),e.parentView.$(".n-modal-footer").show(),e.$el.html(t(e.vtOptions({profile:e.getProfileDetails(),priorityOptions:d,issueCategory:p,clusters:o,serials:r}))),e.$(".serial-number-tooltip").tooltip({trigger:"hover"})})},error:function(){e.eventBus.trigger(o.SUPPORT_CASE_HEADER_ERROR)}}),this},updateBlockSerials:function(e){var t=$(e.currentTarget).val(),n=this.clusterHostMap[t].blocks,i=this.arrayToOptions(n);$("#supportCaseSerialSelect").html(i),$("#supportCaseSerialSelect").trigger("update")},onPcLogBundleUploadChange:function(){this.isPcLogBundleToBeAttached()?this.$(".anonymise-log-bundle-pc").slideDown():this.$(".anonymise-log-bundle-pc").slideUp()},onPeLogBundleUploadChange:function(){this.isPeLogBundleToBeAttached()?this.$(".anonymise-log-bundle-pe").slideDown():this.$(".anonymise-log-bundle-pe").slideUp()},arrayToOptions:function(e){var t=this;return e.map(function(e){var n="";return t.isSupportCaseCreationEnabledOnBlock(e)&&(n="disabled"),"<option "+n+" value="+e.serial+">"+e.serial+"</option>"}).join("")},destroy:function(){this.eventBus.unbind(o.CREATE_CASE_ACTION),this.$(".serial-number-tooltip").tooltip("destroy"),t.prototype.destroy.apply(this,arguments)},onSaveClick:function(){var e=this,t=this.validateForm();if(t.length)return this.parentView.$(".n-modal-content-wrapper").animate({scrollTop:0}),void this.eventBus.trigger(o.SUPPORT_CASE_HEADER_ERROR,t);this.parentView.$(".btnSave").prop("disabled",!0);var i=this.getSpecForCaseCreation(),s=new n;s.set(i),s.save(null,{success:function(t,n,i){var s=t.get(t.idAttribute);e.eventBus.trigger(o.SHOW_LIST_ACTION,{id:s}),e.destroy(),e.parentView.$(".n-modal-footer").hide(),e.parentView.$(".loader-view").show()},error:function(e,t){e.showErrorNotification(e,o.ACTION_CREATE)}}).finally(function(){e.parentView.$(".btnSave").prop("disabled",!1)})},isSupportCaseCreationEnabledOnBlock:function(e){return e[a.CLUSTER_RACK_UNITS.MODEL_NAME].substr(0,2)!==o.SUPPORT_CASE_SUPPORTED_SERIES_PREFIX},getProfileDetails:function(){var e=this.profileModel.toJSON(),t=((e.firstName||"")+" "+(e.lastName||"")).trim();return{emailId:e.emailId,name:t}},getSpecForCaseCreation:function(){var t=this.getSpecFromForm();return t[a.SUPPORT_CASE.HYPERVISOR_VERSION]=l.getDominantHypervisor(this.getSelectedClusterUuidFromUI()),t[a.SUPPORT_CASE.NOS_VERSION]=e.getClusterModelByClusterUuid(this.getSelectedClusterUuidFromUI()).get(a.CLUSTER_NOS_VERSION),t},getSpecFromForm:function(){var e,t={};t[a.SUPPORT_CASE.CONTACT_DETAILS]={},t[a.SUPPORT_CASE.SUBJECT]=this.getCaseSubjectFromUI(),t[a.SUPPORT_CASE.CASE_TYPE]=this.getCaseCategoryFromUI(),t[a.SUPPORT_CASE.PRIORITY]=this.getCasePriorityFromUI(),t[a.SUPPORT_CASE.SERIAL_NUMBER]=this.getSelectedBlockSerialFromUI(),t[a.SUPPORT_CASE.DESCRIPTION]=this.getCaseDescriptionFromUI();var n=this.getSelectedClusterUuidFromUI();t[a.SUPPORT_CASE.CLUSTER_REFERENCE]=(e={},_defineProperty(e,a.INTENT_KIND,o.ENTITY_CLUSTER),_defineProperty(e,a.UUID,n),e);var i=(new Date).getTime(),s=new Date(i).toISOString(),r=i-o.LOG_COLLECTION_DEFAULT_DURATION*o.MILLIS_PER_HOUR,l=new Date(r).toISOString();if(this.isPcLogBundleToBeAttached()){var c;t[a.SUPPORT_CASE.LOG_COLLECTOR_PC]=(c={},_defineProperty(c,a.SUPPORT_CASE.START_TIME,l),_defineProperty(c,a.SUPPORT_CASE.END_TIME,s),_defineProperty(c,a.SUPPORT_CASE.ANONYMIZE_OUTPUT,this.isPcLogBundleToBeAnonymised()),c)}if(this.isPeLogBundleToBeAttached()){var d;t[a.SUPPORT_CASE.LOG_COLLECTOR]=(d={},_defineProperty(d,a.SUPPORT_CASE.START_TIME,l),_defineProperty(d,a.SUPPORT_CASE.END_TIME,s),_defineProperty(d,a.SUPPORT_CASE.ANONYMIZE_OUTPUT,this.isPeLogBundleToBeAnonymised()),d)}this.isAttachPCHealthCheck()&&(t[a.SUPPORT_CASE.NCC_CHECKS_PC]=_defineProperty({},a.SUPPORT_CASE.SHOULD_SEND_EMAIL,!1)),this.isAttachPEHealthCheck()&&(t[a.SUPPORT_CASE.NCC_CHECKS]=_defineProperty({},a.SUPPORT_CASE.SHOULD_SEND_EMAIL,!1));var p=this.getNameFromUI();p&&(t[a.SUPPORT_CASE.CONTACT_DETAILS][a.SUPPORT_CASE.NAME]=p);var u=this.getPhoneNumberFromUI();u&&(t[a.SUPPORT_CASE.CONTACT_DETAILS][a.SUPPORT_CASE.PHONE_NUMBER]=u);var h=this.getEmailAddressFromUI();h&&(t[a.SUPPORT_CASE.CONTACT_DETAILS][a.SUPPORT_CASE.EMAIL_ADDRESS]=h);var m=this.getAdditionalContactsFromUI();return m.length&&(t[a.SUPPORT_CASE.ADDITIONAL_NOTIFICATION_LIST]=m.split(",").map(function(e){return _defineProperty({},a.SUPPORT_CASE.EMAIL_ADDRESS,e.trim())})),t},validateForm:function(){var e=[],t=this.getCaseSubjectFromUI();t.length?t.length>o.SUPPORT_CASE_SUBJECT_MAX_LENGTH&&e.push(this.i18n("subject_maxlength_error_message")):e.push(this.i18n("subject_required_error_message")),this.getSelectedBlockSerialFromUI()||e.push(this.i18n("serial_number_required_message"));var n=this.getCaseDescriptionFromUI();n.length?n.length>o.SUPPORT_CASE_DESCRIPTION_MAX_LENGTH&&e.push(this.i18n("description_maxlength_error_message")):e.push(this.i18n("description_required_error_message"));var i=this.getNameFromUI();i&&-1!=="!@#$%^&*()+=-_[]';,./{}|\":<>?0123456789\\".indexOf(i.charAt(0))&&e.push(this.i18n("invalid_name_error_message"));var s=this.getEmailAddressFromUI();if(s.length){var a=r.isEmail(s);a.valid||e.push(a.message)}else e.push(this.i18n("contact_email_required_message"));var l=this.getAdditionalContactsFromUI();if(l.length){var c=l.split(",").map(function(e){return e.trim()}),d=r.validateFormCommaEmail(c);d.length&&e.push(this.i18ns("invalid_email_list_message",d.join(", "))),c.length>2&&e.push(this.i18n("more_additional_contacts_message"))}
return e.join("<br>")},getCaseSubjectFromUI:function(){return this.$("#supportCaseSubject").val().trim()},getCaseCategoryFromUI:function(){return this.$(".issueCategory").val()},getCasePriorityFromUI:function(){return this.$(".priority").val()},getSelectedClusterUuidFromUI:function(){return this.$("#supportCaseClusterSelect").val()},getSelectedBlockSerialFromUI:function(){return this.$("#supportCaseSerialSelect").val()},getCaseDescriptionFromUI:function(){return this.$(".description").val().trim()},isPcLogBundleToBeAttached:function(){return this.$("#logForPc").prop("checked")},isPeLogBundleToBeAttached:function(){return this.$("#logForPe").prop("checked")},isPcLogBundleToBeAnonymised:function(){return this.$("#pclogBundle").prop("checked")},isPeLogBundleToBeAnonymised:function(){return this.$("#pelogBundle").prop("checked")},isAttachPCHealthCheck:function(){return this.$("#nccForPc").prop("checked")},isAttachPEHealthCheck:function(){return this.$("#nccForPe").prop("checked")},getNameFromUI:function(){return this.$("#contactName").val().trim()},getPhoneNumberFromUI:function(){return this.$("#contactPhone").val().trim()},getEmailAddressFromUI:function(){return this.$("#contactEmail").val().trim()},getAdditionalContactsFromUI:function(){return this.$(".support-case-contact-extra-email").val().trim()}})}),define("text!templates/popups/supportcase/SupportCasePopupView.html",[],function(){return'<div class="modal-header">\n  <button type="button" class="close" data-test="support-case-popup-close">\n    <i data-icon="K" aria-hidden="true"></i>\n  </button>\n  <h4 class="n-title" data-test="support_cases_page"  >\n    <%= i18n(\'open_support_case\') %>\n  </h4>\n  <% if (isAdminUser) { %>\n    <button class="btn createCase create-case"\n      data-test="support_cases_create_btn">\n      <span class="n-icon">+</span>\n      <span><%= i18n(\'open_support_case\') %></span>\n    </button>\n  <% } %>\n</div>\n\n<div class="n-modal-wrapper">\n  <div class="n-modal-body">\n    <div class="n-modal-content-wrapper">\n      \x3c!-- Header --\x3e\n      <div class="n-modal-alert-header">\n        \x3c!-- @view: alert goes here... --\x3e\n      </div>\n      <div class="n-modal-content">\n        <div class="text-center">\n          <div class="loader-view support-case-subview"></div>\n        </div>\n        <div class="portal-configuration support-case-subview">\n        </div>\n        <div class="no-pe-registered-view support-case-subview"></div>\n        <div class="case-list-view support-case-subview"></div>\n        <div class="create-case-view support-case-subview"></div>\n      </div>\n    </div>\n  </div>\n\n  <div class="n-modal-footer">\n    <button class="btnCancel btn" data-test="create_support_cases_cancel_btn">\n      Cancel\n    </button>\n    <button class="btnSave btn btn-primary"\n      data-test="create_support_cases_submit_btn">\n      Submit\n    </button>\n  </div>\n</div>'}),define("views/popups/supportcase/SupportCasePopupView",["managers/AccessManager","managers/PopupManager","views/basecomponents/popups/BasePopupView","views/popups/supportcase/ListSupportCaseView","views/popups/supportcase/OpenSupportCaseView","views/popups/portal/PortalProxyConfigPopupView","models/portal/PortalProxyConfigModel","utils/SubViewHelper","utils/AppConstants","text!templates/popups/supportcase/SupportCasePopupView.html"],function(e,t,n,i,s,a,o,r,l,c){"use strict";var d=_.template(c),p=_.template('<div class="portal-not-configured-container"><p><%= i18n("portal_not_configured") %></p><p><%= i18n("configure_portal_message") %></p><button class="btn -blue enablePortal"><%= i18n("configure_portal_connection") %></button></div>'),u=_.template('<div class="no-pe-message-container"><p><%= i18n("no_pe_registered_message") %></p><p><%= i18n("register_pe_message") %> <a href="mailto:<%= AppConstants.NUTANIX_SUPPORT_EMAIL %>"><%= AppConstants.NUTANIX_SUPPORT_EMAIL %></a></p></div>');return n.extend({el:"#popup-support-case",name:"SupportCasePopupView",eventBus:null,events:{"click .modal-header .close":"hide","click .enablePortal":"onClickConfigureProxy","click .btnSave":"onSaveClick","click .btnCancel":"onCancelClick","click .createCase":"showCreateCaseView"},initialize:function(){this.subViewHelper=new r,this.eventBus=_.extend({},Backbone.Events),this.proxyConfigModel=new o,this.eventBus.bind(l.CREATE_SUPPORT_CASE_FROM_NO_CASE_TEMPLATE,this.showCreateCaseView.bind(this)),this.eventBus.bind(l.SUPPORT_CASE_HEADER_ERROR,this.headerErrorHandler.bind(this)),this.eventBus.bind(l.SHOW_NO_PE_SCREEN,this.showNoPERegisteredScreen.bind(this)),n.prototype.initialize.apply(this,arguments)},render:function(){return this.$el.html(d(this.vtOptions({isAdminUser:e.isAdminUser()}))),this},onClickConfigureProxy:function(e){var n,i=this;t.renderPopupView(a,(n={},_defineProperty(n,l.NAV_ACTION_ROUTE,_defineProperty({},l.NAV_ACTION_TARGET,l.PORTAL_CONFIGURATION)),_defineProperty(n,"onSave",function(){i.$(".support-case-subview").hide(),i.$(".loader-view").show(),i.showInitialScreen()}),n))},show:function(e){n.prototype.show.apply(this,arguments),this.showInitialScreen()},showInitialScreen:function(){var e=this;this.proxyConfigModel.fetch({success:function(){e.proxyConfigModel.isConfigured()&&e.proxyConfigModel.isActive()||!e.canModifyByEntityType(l.ENTITY_LICENSING)?(e.subViewHelper.register(l.LIST_CASE_VIEW,new i({el:$(".n-modal-content .case-list-view"),eventBus:e.eventBus,parentView:e})),e.subViewHelper.get(l.LIST_CASE_VIEW).showListView()):(e.$(".support-case-subview").hide(),e.$(".loader-view").hide(),e.$(".portal-configuration").html(p(e.vtOptions())).show())},error:function(){e.eventBus.trigger(l.SUPPORT_CASE_HEADER_ERROR)}})},onCancelClick:function(){this.$(".support-case-subview").hide(),this.$(".case-list-view").show(),this.$(".modal-header .createCase").show(),this.$(".n-modal-footer").hide()},showCreateCaseView:function(){if(this.$(".n-modal-content .create-case-view ").children().length)return this.$(".support-case-subview").hide(),this.$(".n-modal-content .create-case-view ").show(),this.$(".n-modal-footer").show(),void this.$(".modal-header .createCase").hide();this.subViewHelper.register(l.OPEN_SUPPORT_CASE_VIEW,new s({el:$(".n-modal-content .create-case-view "),eventBus:this.eventBus,parentView:this})),this.$(".support-case-subview").hide(),this.$(".loader-view").show(),this.subViewHelper.get(l.OPEN_SUPPORT_CASE_VIEW).render().$el.show(),this.$(".modal-header .createCase").hide()},headerErrorHandler:function(e){e=e||this.i18nStatic("Common","error.data_fetch"),this.showHeaderError(e)},showNoPERegisteredScreen:function(){this.$(".support-case-subview").hide(),this.$(".loader-view").hide(),this.$(".no-pe-registered-view").html(u(this.vtOptions())).show()},getV3ErrorMessageList:function(e){var t=[];return e&&e.message_list&&(t=e.message_list.map(function(e){return e.message})),t},showV3HeaderError:function(e){var t=this.getV3ErrorMessageList(e),n="";t&&(n=t.join("<br>")),this.headerErrorHandler(n)},onSaveClick:function(){this.eventBus.trigger(l.CREATE_CASE_ACTION)}})}),define("text!templates/popups/multicluster/clustermanagement/MulticlusterSelfMonitorContentView.html",[],function(){return'<div data-ntnx-content-inner class="monitor-body">\n  <section data-ntnx-section class="monitor-container">\n  </section>\n</div>\n'}),define("views/popups/multicluster/clustermanagement/MulticlusterSelfMonitorPopupView",["views/basecomponents/popups/BasePopupView","views/basecomponents/vantagepoints/DashboardView","views/basecomponents/vantagepoints/elements/summary/SummaryVantagePointView","models/multicluster/PCVMModel","models/dashboard/VantagePointModel","utils/SubViewHelper","utils/AppConstants","utils/CommonTemplates","utils/SVG","utils/HypervisorUtil","utils/AppUtil","utils/PCScaleOutMixin","managers/ActionManager","managers/IntentManager","managers/I18nManager","text!templates/popups/multicluster/clustermanagement/MulticlusterSelfMonitorContentView.html"],function(e,t,n,i,s,a,o,r,l,c,d,p,u,h,m,f){"use strict";var v=_.template(f),g=_.template('<div class="add-pcvm-btn-wrapper"><% if (!isOldVersionPE) { %><button class="btn add-pcvm-btn" action="create_pc"actionTarget="prism_central_vm"> <%= i18n("add_pc_vm_btn") %></button><% } %></div>'),E=_.template('<h5 data-ntnx-title><%= i18n("suggest_register_title")%></h5><section data-ntnx-section="type-text">        <%= i18n("suggest_register_desc_1") %></section><section data-ntnx-section="type-text">        <%= i18n("suggest_register_desc_2")%></section><section data-ntnx-section="type-text">        <%= i18n("suggest_register_desc_3")%></section><h5 data-ntnx-title class="entities-not-loaded-title"><%= i18n("entities_not_loaded_title")%></h5><section data-ntnx-section="type-text">        <%= i18n("entities_not_loaded_desc_1") %></section><section data-ntnx-section="type-text">        <%= i18n("entities_not_loaded_desc_2") %></section>'),T=_.template('<div class="widget-wrapper"><div class="n-vantage-point-holder pcCluster"></div><div class="n-vantage-point-holder pcCapacity pc-capacity"></div></div><div class="content-wrapper"><div class="glass-icon-wrapper"><%= glassIcon %></div><div class="error-wrapper"><section data-ntnx-section class="register-warning"></section><section data-ntnx-section class="register-text"></section></div></div>');return e.extend(_.extend({},p,{el:"#popupMulticlusterSelfMonitor",name:"MulticlusterSelfMonitorPopupView",events:{"click    .modal-header .close":"hide","click    .add-pcvm-btn":"showScaleOutConfirmDialog","click    .btnEdit":"onBtnEditClick","click    .btnAddVirtualIP":"onBtnEditClick"},modelEvents:{"deploymentStatusChange model":"onDeploymentStatusChange","change                 model":"onDataUpdate"},overlayPopup:!0,model:null,addPCVMDisabled:!1,initialize:function(){e.prototype.initialize.apply(this,arguments),this.subViewHelper=new a,this.model=i.getSharedPCVMModel(),this.model.setIntervalTime(o.PRISM_CENTRAL_POLLING_INTERVAL)},render:function(e){var t=this;this.$el.html(this.defaultTemplate({title:this.i18n("manage_prism_central"),antiscroll:!1,bodyContent:v(this.vtOptions()),footer:!1})),this.$(".monitor-container").html(r.LOADING_MSG({msg:this.i18n("loading")})),this.model.startPolling({success:this.onDataUpdate.bind(this),error:function(e,n){t.subViewHelper.get("pc-selfmonitor-dashboard")&&t.subViewHelper.remove("pc-selfmonitor-dashboard"),t.handleFetchError(n)}})},onDataUpdate:function(){var e=this.model.getHostedClusterUuid(),t=this.clusterManager.getClusterVersionByClusterUuid(e),n=this.clusterManager.getNameById(e),i=!0;t&&d.compareVersions(t,o.PC_SCALE_OUT_VERSION_GA,2)>=0&&(i=!1),this.$(".glass-icon-wrapper").hide(),this.model.getPCVMSpec().length>=o.INITIAL_PC_VM_NO&&this.$("h4.n-title").append(g(this.vtOptions({isOldVersionPE:i,hostClusterName:n}))),this.checkForAddPCVM(),this.subViewHelper.get("pc-selfmonitor-dashboard")||this.createDashboard()},checkForAddPCVM:function(){!this.addPCVMDisabled&&c.hasHyperV(this.model.getHostedClusterUuid())&&(this.addPCVMDisabled=!0,this.$(".add-pcvm-btn-wrapper").tooltip({title:this.i18n("add_pcvm_disabled"),placement:"left",trigger:"hover"}),this.$(".add-pcvm-btn").prop("disabled",!0))},destroy:function(){this.model.stopPolling(),i.releaseSharedPCVMModel(),this.subViewHelper.iterate("stopServices"),this.subViewHelper.destroy(),this.$(".add-pcvm-btn-wrapper").tooltip("destroy"),e.prototype.destroy.apply(this,arguments)},onDeploymentStatusChange:function(e){this.addPCVMDisabled||this.$(".add-pcvm-btn").prop("disabled",e)},onClickAddPCVM:function(e){u.executeActionElement(e.currentTarget)},showScaleOutConfirmDialog:function(e){var t=this;$(e.currentTarget).hasClass("gray-out")||$.nutanixConfirm({msg:this.i18n("add_pc_vm_confirmation_1")+"</br>"+this.i18n("add_pc_vm_confirmation_2"),yes:function(){t.loadSoftwareRelease(e)},yesText:this.i18n("continue"),noText:this.i18n("no")})},createDashboard:function(){var e=new t({el:".monitor-container",dashboard:o.PERSPECTIVE_PC});this.subViewHelper.register("pc-selfmonitor-dashboard",e),e.show(),this.triggerAction(o.MODAL.ACT.AS_REBUILD),this.$(".monitor-container").closest(".box-wrap").addClass("outer-box-wrap")},handleFetchError:function(e){var t=h.interpretIntentServerError(e);404===e.status&&t&&t.indexOf("Failed to retrieve the prism central information")>=0?(this.$(".monitor-container").html(T({glassIcon:l.loadSVG(l.PRISM_GLASS_ICON)})),this.addDefaultVantagePoints(),this.$(".register-warning").html(r.WARNING({msg:this.i18n("register_pc_warning")})),this.$(".register-text").html(E(this.vtOptions({suggest_register_title:this.i18n("suggest_register_title"),suggest_register_desc_1:this.i18n("suggest_register_desc_1"),suggest_register_desc_2:this.i18n("suggest_register_desc_2"),suggest_register_desc_3:this.i18n("suggest_register_desc_3")})))):this.triggerAction(o.MODAL.ACT.ALERT_SHOW,{type:o.MODAL.ALERT.TYPE_ERROR,message:t||this.i18n("serverError")})},addDefaultVantagePoints:function(){var e=this.createDefaultVantagePoint("prism_central_cluster",o.VP_SUMMARY_TYPE.PC_CLUSTER);this.$(".pcCluster").html(e.render().$el),e.startServices();var t=this.createDefaultVantagePoint("prism_central_capacity",o.VP_SUMMARY_TYPE.PC_CAPACITY_MINI);this.$(".pcCapacity").html(t.render().$el),t.startServices()},createDefaultVantagePoint:function(e,t){var i=new s({name:e,aspects:{type:t}});return new n({model:i,title:m.t(o.I18N_NAMES.base_vantage_point_view,e),customizable:!1})},onBtnEditClick:function(e){u.executeActionElement(e.currentTarget)}}))}),define("text!templates/popups/degradednode/DegradedNodePopupView.html",[],function(){return'\x3c!-- The parent div modal is #popupDegradedNodeSettings --\x3e\n<div data-ntnx-content-inner>\n  <section data-ntnx-section>\n    <div data-ntnx-form-inline>\n      <%= Components.checkbox({\n        id: "degraded-node-feature-flag",\n        jsClasses: "enable",\n        checked: degradedNodeFeatureEnabled,\n        allowHtmlLabel: true,\n        labelText: i18n(\'checkboxLabel\')\n          + \'<span class="tooltip-wrapper"></span>\'\n      }) %>\n    </div>\n  </section>\n</div>\n'}),define("views/popups/degradednode/DegradedNodePopupView",["views/basecomponents/popups/BasePopupView","models/cluster/ClusterModel","models/cluster/ClusterUpdateModel","managers/ClusterManager","data/DataProperties","text!templates/popups/degradednode/DegradedNodePopupView.html"],function(e,t,n,i,s,a){"use strict";return a=_.template(a),e.extend({el:"#popupDegradedNodeSettings",name:"DegradedNodePopupView",model:null,events:{"click  .btnSave":"onSaveClick"},initialize:function(){this.model=new t,e.prototype.initialize.apply(this,arguments)},render:function(){var e=i.getClusterModelByClusterUuid(),t=!e.get(s.CLUSTER_DISABLE_DEGRADED_NODE_MONITORING),n=[{isPrimary:!0,text:this.i18n("save"),extraClasses:"btnSave"}];this.$el.html(this.defaultTemplate({title:this.i18n("degradedNodeSettings"),bodyContent:a(this.vtOptions({degradedNodeFeatureEnabled:t})),footerButtons:this.defaultFooter(n)})),this.$(".tooltip-wrapper").nutanixMoreInfo({title:this.i18n("featureDescription"),placement:"top",trigger:"hover",container:"body"})},onSaveClick:function(){var e=this;this.$(".btnSave").button("loading");var t=i.getClusterModelByClusterUuid(),a=new n;a.set(t.attributes);var o=!this.$("#degraded-node-feature-flag").prop("checked");a.set(s.CLUSTER_DISABLE_DEGRADED_NODE_MONITORING,o),a.save(null,{success:function(t,n){e.$(".btnSave").button("reset")},error:function(t,n){e.$(".btnSave").button("reset"),e.showHeaderError(n.responseText)}})}})}),define("text!templates/popups/citrix/Sysprep.html",[],function(){return'<?xml version="1.0" ?>\n<unattend xmlns="urn:schemas-microsoft-com:unattend">\n<settings pass="oobeSystem">\n<component name="Microsoft-Windows-International-Core" processorArchitecture="amd64" publicKeyToken="31bf3856ad364e35" language="neutral" versionScope="nonSxS" xmlns:wcm="http://schemas.microsoft.com/WMIConfig/2002/State" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">\n<InputLocale>en-us</InputLocale>\n<SystemLocale>en-us</SystemLocale>\n<UILanguage>en-us</UILanguage>\n<UserLocale>en-us</UserLocale>\n</component>\n<component name="Microsoft-Windows-Shell-Setup" processorArchitecture="amd64" publicKeyToken="31bf3856ad364e35" language="neutral" versionScope="nonSxS" xmlns:wcm="http://schemas.microsoft.com/WMIConfig/2002/State" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">\n<UserAccounts>\n<AdministratorPassword>\n<Value><%=password%></Value>\n<PlainText>true</PlainText>\n</AdministratorPassword>\n</UserAccounts>\n<AutoLogon>\n<Password>\n<Value><%=password%></Value>\n</Password>\n<Enabled>true</Enabled>\n<LogonCount>2</LogonCount>\n<Username><%=vmName%>\\Administrator</Username>\n</AutoLogon>\n<OOBE>\n<HideEULAPage>true</HideEULAPage>\n</OOBE>\n<FirstLogonCommands>\n<SynchronousCommand wcm:action="add">\n<Description>create cloud connector</Description>\n<Order>1</Order>\n<CommandLine>powershell -executionpolicy bypass -command "mkdir c:\\cc;(New-Object System.Net.WebClient).DownloadFile(\'http://download.nutanix.com/firmware/citrix/cwcconnector.exe\', \'c:\\cc\\cwcconnector.exe\')" > c:\\cc\\cwc_download_console.out</CommandLine>\n</SynchronousCommand>\n<SynchronousCommand wcm:action="add">\n<Description>Download MCS plugin</Description>\n<Order>2</Order>\n<CommandLine>powershell -executionpolicy bypass -command "mkdir c:\\mcs;(New-Object System.Net.WebClient).DownloadFile(\'http://download.nutanix.com/firmware/citrix/cwa/Citrix+CWA+v1.0.0.0/Nutanix+AHV+MCS+Plug-in+for+Citrix+Cloud+Connector.msi\', \'c:\\mcs\\Connector.msi\')"</CommandLine>\n</SynchronousCommand>\n<SynchronousCommand wcm:action="add">\n<CommandLine>net start W32Time</CommandLine>\n<Description>Start windows time service</Description>\n<Order>3</Order>\n</SynchronousCommand>\n<SynchronousCommand wcm:action="add">\n<CommandLine>w32tm /config /manualpeerlist:time.windows.com /syncfromflags:manual /reliable:yes /update</CommandLine>\n<Description>Register time server</Description>\n<Order>4</Order>\n</SynchronousCommand>\n<SynchronousCommand wcm:action="add">\n<CommandLine>w32tm /resync /rediscover</CommandLine>\n<Description>Sync time</Description>\n<Order>5</Order>\n</SynchronousCommand>\n<SynchronousCommand wcm:action="add">\n<CommandLine>C:\\cc\\cwcconnector.exe /q /CustomerName:<%=customerName%> /ClientId:<%=clientId%> /ClientSecret:<%=clientSecret%> /Location:<%=resourceLocation%> /AcceptTermsOfService:true . -Wait</CommandLine>\n<Description>Register cloud connector</Description>\n<Order>6</Order>\n</SynchronousCommand>\n<SynchronousCommand wcm:action="add">\n<CommandLine>timeout /t 400</CommandLine>\n<Description>delay</Description>\n<Order>7</Order>\n</SynchronousCommand>\n<SynchronousCommand wcm:action="add">\n<CommandLine>msiexec /i C:\\mcs\\Connector.msi INSTALLFOLDER="C:\\Program Files\\Common Files\\Citrix\\HCLPlugins\\CitrixMachineCreation\\v1.0.0.0\\NutanixAcropolis" /qn /log C:\\mcs\\install.log</CommandLine>\n<Description>MCS Plugin Installation</Description>\n<Order>8</Order>\n</SynchronousCommand>\n<SynchronousCommand wcm:action="add">\n<CommandLine>logoff</CommandLine>\n<Description>log off</Description>\n<Order>9</Order>\n</SynchronousCommand>\n</FirstLogonCommands>\n</component>\n</settings>\n<settings pass="specialize">\n<component name="Microsoft-Windows-Shell-Setup" processorArchitecture="amd64" publicKeyToken="31bf3856ad364e35" language="neutral" versionScope="nonSxS" xmlns:wcm="http://schemas.microsoft.com/WMIConfig/2002/State" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">\n<ComputerName><%=vmName%></ComputerName>\n</component>\n<component name="Microsoft-Windows-Deployment" processorArchitecture="amd64" publicKeyToken="31bf3856ad364e35" language="neutral" versionScope="nonSxS" xmlns:wcm="http://schemas.microsoft.com/WMIConfig/2002/State" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">\n<RunSynchronous>\n<RunSynchronousCommand wcm:action="add">\n<Description>add domain to registry</Description>\n<Order>1</Order>\n<Path>reg add HKLM\\System\\currentcontrolset\\services\\tcpip\\parameters /v "NV Domain" /d "<%=machineDomain%>" /f</Path>\n</RunSynchronousCommand>\n<RunSynchronousCommand wcm:action="add">\n<Description>add searchlist to registry</Description>\n<Order>2</Order>\n<Path>reg add HKLM\\System\\currentcontrolset\\services\\tcpip\\parameters /v "SearchList" /d "<%=machineDomain%>" /f</Path>\n</RunSynchronousCommand>\n<RunSynchronousCommand wcm:action="add">\n<Description>add dns server</Description>\n<Order>3</Order>\n<Path>netsh interface ip set dns name="Ethernet" <% if(dnsGateway){ %> static <%=dnsGateway%> <%}else{%> dhcp <%}%>  </Path>\n</RunSynchronousCommand>\n<RunSynchronousCommand wcm:action="add">\n<Description>flush dns</Description>\n<Order>4</Order>\n<Path>ipconfig /flushdns</Path>\n</RunSynchronousCommand>\n</RunSynchronous>\n</component>\n<component name="Microsoft-Windows-UnattendedJoin" processorArchitecture="amd64" publicKeyToken="31bf3856ad364e35" language="neutral" versionScope="nonSxS" xmlns:wcm="http://schemas.microsoft.com/WMIConfig/2002/State" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">\n<Identification>\n<Credentials>\n<Domain><%=domain%></Domain>\n<Password><%=domainPassword%></Password>\n<Username><%=domainUserName%></Username>\n</Credentials>\n<JoinDomain><%=machineDomain%></JoinDomain>\n</Identification>\n</component>\n</settings>\n</unattend>'}),define("text!templates/popups/citrix/CitrixConnectorContentView.html",[],function(){return'<div data-ntnx-content-inner class="detailsContainer" style="display: none;">\n  <div id="citrixDetails">\n    \x3c!-- @view: goes here... --\x3e\n  </div>\n</div>\n\n\n<div data-ntnx-content-inner class="formConnectContainer" style="display: none;">\n  <div id="citrixConnect">\n    \x3c!-- @view: goes here... --\x3e\n  </div>\n</div>\n\n\n<div data-ntnx-content-inner class="formSaveContainer" style="display: none;">\n  <div id="citrixSave">\n    \x3c!-- @view: goes here... --\x3e\n  </div>\n</div>\n'}),define("text!templates/popups/citrix/CitrixConnectForm.html",[],function(){return'<section data-ntnx-section="type-text">\n  <%= i18n(\'connect_header_text\') %>\n</section>\n<form class="connect-form" data-test="form_connect">\n  <section data-ntnx-section>\n    <section data-ntnx-form-inline class="key-type">\n      <%= Components.radio({\n        id: \'fromManual\',\n        name: \'inputType\',\n        jsClasses: \'input-type\',\n        checked: true,\n        dataTestAttribute: \'radio_manual\'\n      }) %>\n      <label for=\'fromManual\' data-ntnx-inline-label>\n        <%= i18n(\'manual_enter\') %>\n      </label>\n    </section>\n  </section>\n  <section class="inputTypeWrapper" data-id="fromManual">\n    <section data-ntnx-section>\n      <label data-ntnx-label for="customerId">\n        <%= i18n(\'customer_id\') %>\n      </label>\n      <input type="text" autocomplete="off" data-test="tb_customer_id"\n        class="customerId" value="">\n    </section>\n    <section data-ntnx-section>\n      <label data-ntnx-label for="clientId">\n         <%= i18n(\'client_id\') %>\n      </label>\n      <input type="text" autocomplete="off" data-test="tb_client_id"\n        class="clientId" value="">\n    </section>\n    <section data-ntnx-section>\n      <label data-ntnx-label for="clientSecret">\n         <%= i18n(\'secret_key\') %>\n      </label>\n      <input type="password" autocomplete="off" data-test="tb_client_secret"\n        class="clientSecret" value="">\n    </section>\n  </section>\n  <section data-ntnx-section>\n    <section data-ntnx-form-inline class="key-type">\n      <%= Components.radio({\n        id: \'fromFileUpload\',\n        name: \'inputType\',\n        jsClasses: \'input-type\',\n        dataTestAttribute: \'radio_file_upload\'\n      }) %>\n      <label for=\'fromFileUpload\' data-ntnx-inline-label>\n        <%= i18n(\'upload_credential\') %>\n      </label>\n    </section>\n  </section>\n  <section class="inputTypeWrapper hide" data-id="fromFileUpload">\n    <section data-ntnx-section>\n      <%= Components.fileInput({\n        btnText: i18n(\'upload_text\'),\n        id: "csvFile",\n        classes: \'uploadItem\',\n        variants: \'-inline-flex\'\n      }) %>\n    </section>\n    <section data-ntnx-section>\n      <label data-ntnx-label for="csvCustomerId">\n        <%= i18n(\'customer_id\') %>\n      </label>\n      <input type="text" autocomplete="off" data-test="tb_csv_customer_id"\n        class="csvCustomerId" value="">\n    </section>\n  </section>\n</form>'}),define("text!templates/popups/citrix/CitrixSaveForm.html",[],function(){return'<section data-ntnx-section="type-text">\n  <%= i18n(\'save_header_text\') %>\n</section>\n<section data-ntnx-section>\n  <h5 data-ntnx-title>\n    <%= i18n(\'cc_details\') %>\n    <a href="#" class="change-connect" data-test="change_connect">\n      <%= i18n(\'change\') %>\n    </a>\n  </h5>\n  <section data-ntnx-section>\n    <table class="table" data-test="cc_details">\n      <tr>\n        <th><%= i18n(\'client_id\') %></th>\n        <td><%= client_id %></td>\n      </tr>\n      <tr>\n        <th><%= i18n(\'customer_id\') %></th>\n        <td><%= customer_id %></td>\n      </tr>\n    </table>\n  </section>\n</section>\n<form class="form-horizontal save-form" onsubmit="return false;">\n  <section data-ntnx-section>\n    <section data-ntnx-form-inline class="availability-contain clearfix">\n      <%= Components.checkbox({\n        checked: true,\n        jsClasses: \'highAvailability\',\n        dataTestAttribute: \'checkbox_ha\'\n      }) %>\n      <label data-ntnx-inline-label><%= i18n(\'ensure_ha\') %></label>\n    </section>\n    <div data-ntnx-hint>\n      <%= i18n(\'ensure_ha_hint\') %>\n    </div>\n  </section>\n  <section data-ntnx-section="type-separator">\n    <% if(resources.length){ %>\n      <div class="n-resource-location-type">\n        <%= Components.radio({\n          id        :\'existingResource\',\n          name      :\'resourceLocationRadio\',\n          checked   : true,\n          value     : i18n(\'use_existing_resource\'),\n          labelText : i18n(\'use_existing_resource\')\n        })%>\n      </div>\n      <div class="n-resource-location-type">\n        <%= Components.radio({\n          id        :\'newResource\',\n          name      :\'resourceLocationRadio\',\n          checked   : false,\n          value     : i18n(\'create_new_resource\'),\n          labelText : i18n(\'create_new_resource\')\n        })%>\n      </div>\n    <% } %>\n    <label data-ntnx-label>\n      <%= i18n(\'resource_location\') %>\n    </label>\n    <div class="n-radio-resource-content <%= resources.length ? \'\' : \'hide\' %>" data-id="existingResource">\n      <%= Components.select({\n        attributes: \'data-test="select_resource_location"\',\n        options: resources,\n        jsClasses: \'resourceLocation\',\n      }) %>\n    </div>\n    <div class="n-radio-resource-content <%= resources.length ? \'hide\' : \'\' %>" data-id="newResource">\n        <input type="text" autocomplete="off"\n        class="resourceLocation n-new-resource-location" data-test="tb_resource_location">\n    </div>\n  </section>\n  <section data-ntnx-section>\n    <label data-ntnx-label for="vmImage">\n      <%= i18n(\'vm_image\') %>\n    </label>\n    <div class="vm-image-wrapper">\n      <i aria-hidden="true" id="autoManage"\n        data-icon="B" class="n-icon-search"></i>\n      <input type="text" autocomplete="off" id="vmImage"\n        class="vmImage" data-test="tb_vm_image">\n    </div>\n  <section data-ntnx-section>\n    <label data-ntnx-label for="vmName">\n      <%= i18n(\'vm_name\') %>\n    </label>\n    <input type="text" autocomplete="off"\n      class="vmName" data-test="tb_vm_name">\n  </section>\n  <section data-ntnx-section>\n    <label data-ntnx-label for="vmNameSecondary">\n      <%= i18n(\'secondary_vm_name\') %>\n    </label>\n    <input type="text" autocomplete="off"\n      class="vmNameSecondary" data-test="tb_secondary_vm_name">\n  </section>\n  <section data-ntnx-section>\n    <label data-ntnx-label for="password">\n      <%= i18n(\'connector_vm_password\') %>\n    </label>\n    <div class="password-wrapper">\n      <a class="show-hide-password"><%= i18n(\'show\') %></a>\n      <input type="password" autocomplete="off"\n        class="password" data-test="tb_password">\n    </div>\n  </section>\n  <section data-ntnx-section>\n    <h5 data-ntnx-title>\n      <%= i18n(\'domain_credentials\') %>\n    </h5>\n    <section data-ntnx-section="type-subtitle">\n      <%= i18n(\'domain_credentials_hint\') %>\n    </section>\n  </section>\n  <section data-ntnx-section>\n    <label data-ntnx-label for="domainUsername">\n      <%= i18n(\'domain_username\') %>\n      <span data-toggle="tooltip" class="n-tooltip-circle"\n      title="<%= i18n(\'domain_user_eg\') %>">?</span>\n    </label>\n    <input type="text" placeholder="<%= i18n(\'domain_user_pl\') %>" autocomplete="off"\n      class="domainUsername" data-test="tb_domain_username">\n  </section>\n  <section data-ntnx-section>\n    <label data-ntnx-label for="domainPassword">\n     <%= i18n(\'domain_password\') %>\n    </label>\n    <div class="password-wrapper">\n      <a class="show-hide-password"><%= i18n(\'show\') %></a>\n      <input type="password" autocomplete="off"\n        class="domainPassword" data-test="tb_domain_password">\n    </div>\n  </section>\n  <section data-ntnx-section>\n    <label data-ntnx-label for="machineDomain">\n      <%= i18n(\'machine_domain\') %>\n    </label>\n    <input type="text" autocomplete="off"\n      class="machineDomain" data-test="tb_dns_gateway">\n  </section>\n  <section data-ntnx-section>\n    <label data-ntnx-label for="dnsGateway">\n      <%= i18n(\'dns_gateway\') %>\n      <span data-toggle="tooltip" class="n-tooltip-circle"\n        title="<%= i18n(\'dns_gateway_help\') %>">?</span>\n      <span data-ntnx-label-flag>*<%= i18n("optional")%></span>\n    </label>\n    <input type="text" autocomplete="off"\n      placeholder="<%= i18n(\'dhcp_default\') %>"\n      class="dnsGateway" data-test="tb_dns_ip">\n  </section>\n</form>'}),define("text!templates/popups/citrix/CitrixDetailsView.html",[],function(){return'<section data-ntnx-section>\n  <h5 data-ntnx-title><%= i18n(\'cc_details\') %></h5>\n  <section data-ntnx-section>\n    <table class="table" data-test="tbl_cc_details">\n      <tr>\n        <th><%= i18n(\'client_id\') %></th>\n        <td><%= data.client_id %></td>\n      </tr>\n      <tr>\n        <th><%= i18n(\'customer_id\') %></th>\n        <td><%= data.customer_id %></td>\n      </tr>\n      <tr>\n        <th><%= i18n(\'resource_location\') %></th>\n        <td><%= data.resource_location.name %></td>\n      </tr>\n    </table>\n  </section>\n</section>\n\n<% if(vmAvailable && vmCompleted) { %>\n<section data-ntnx-section>\n  <h5 data-ntnx-title><%= i18n(\'connector_vms\') %></h5>\n  <section data-ntnx-section>\n    <table class="table" data-test="cc_vm_details">\n      <tr>\n        <th class="text-uppercase"><%= i18n(\'vm_name\') %></th>\n        <th class="text-uppercase"><%= i18n(\'connection_status\') %></th>\n      </tr>\n      <% _.each(vmList, function(vms) {\n        var power = AppUtil\n          .get(vms, \'api_response.spec.resources.power_state\') || \'\';\n        var name = AppUtil.get(vms, \'api_response.spec.name\');\n      %>\n      <tr>\n        <td>\n          <a title="<%= power %>"\n            class="n-vm-state-icon\n              n-<%= power.toLowerCase()%>"></a>\n          <span class="n-vm-name"><%=name%></span>\n        </td>\n        <td>\n          <div class="ccvm-status" data-ccvm="<%=name%>">\n            <div class="n-precheck-status-icon\n              donut-loader-blue" state="loading"></div>\n          </div>\n        </td>\n      </tr>\n      <% }); %>\n    </table>\n  </section>\n</section>\n<% } %>\n'}),
define("views/popups/citrix/CitrixConnectorPopupView",["views/basecomponents/popups/BasePopupView","models/BaseModel","models/PollingModel","broker/api/AppAPI","data/DataURLConstants","data/DataProperties","data/DataManager","managers/NotificationManager","managers/ClusterManager","managers/AccessManager","utils/AppConstants","utils/ValidationUtil","utils/HypervisorUtil","text!templates/popups/citrix/Sysprep.html","text!templates/popups/citrix/CitrixConnectorContentView.html","text!templates/popups/citrix/CitrixConnectForm.html","text!templates/popups/citrix/CitrixSaveForm.html","text!templates/popups/citrix/CitrixDetailsView.html"],function(e,t,n,i,s,a,o,r,l,c,d,p,u,h,m,f,v,g){"use strict";m=_.template(m),f=_.template(f),v=_.template(v),g=_.template(g),h=_.template(h);var E=t.extend({getURL:function(e,t){return _.template(s.CITRIX_RESOURCE_CONNECTOR,{client_name:this.clientName})},setClientName:function(e){this.clientName=e},getDataSourceURL:function(){return o.getV3DataSourceURL()},showLatencyNotification:function(e,t){},getNotificationMessage:function(){},showSuccessNotification:function(){}}),T=n.extend({getURL:function(e,t){return _.template(s.CITRIX_EDGESERVERS_CONNECTOR,{client_name:this.clientName})},setClientName:function(e){this.clientName=e},destroy:function(e){return $.ajax({type:"DELETE",url:this.getDataSourceURL()+this.getURL(),contentType:"application/json",data:e.data,success:function(t,n,i){e.success(t)},error:function(t,n,i){e.error(t,i)}})},getDataSourceURL:function(){return o.getV3DataSourceURL()},showLatencyNotification:function(e,t){},getNotificationMessage:function(){},showSuccessNotification:function(){}});return e.extend({name:"CitrixConnectorPopupView",el:"#popupCitrixConnector",initialized:!1,vmCollection:null,resources:[],citrixEdgeserversModel:null,DP:{SAVE:"save",CONNECT:"connect",NOACCESS:"noaccess",INPROGRESS:"inprogress",DETAILS:"details",TEXT:"text",PASSWORD:"password"},events:{"click  .btnUpdate":"onConnect","click  .btnSave":"ifResourceLocationAvailable","click .btnDelete":"deleteConnectionConfirm","click .input-type":"toggleInputOption","click .change-connect":"renderConnectTemplate","click .highAvailability":"highAvailabilityCheck","click .show-hide-password":"showHidePassword","click .n-icon-clear":"clearAutoSelected",'click input[name="resourceLocationRadio"]':"radioResourceChange"},initialize:function(t){this.step=this.DP.INPROGRESS,c.hasAccessToV3()?(this.clusterUUID=l.getCurrentClusterUuid(),this.service=i.getAppAPI(),this.citrixEdgeserversModel=new T):this.step=this.DP.NOACCESS,e.prototype.initialize.apply(this,arguments)},setClusterSpecAndSpecVersion:function(e,t){this.clusterSpec=e,this.specVersion=t},getClusterSpec:function(){return this.clusterSpec},getEdgeServerDetails:function(e){var t=this,n={data:{client_id:e.client_id,client_secret:e.client_secret,resource_location_id:e.resource_location.id},success:function(e,n){for(var i=0,s=0;s<t.edgeServer.length;s++){var a=t.isEdgeServerPresent(t.edgeServer[s].name,n),o=t.$('.ccvm-status[data-ccvm="'+t.edgeServer[s].name+'"]');a?a.inMaintenance?o.html('<div class="in-progress">\n                    '+t.i18n("in_progress")+"</div>"):a.inMaintenance||t.edgeServer[s].power!==d.VM_POWER_STATE.OFF?(i+=1,o.html('<div class="connected">\n                    '+t.i18n("connected")+"</div>")):(i+=1,o.html("-")):o.html('<div class="not-connected">\n                  '+t.i18n("not_connected")+"</div>")}t.edgeServer.length===i&&t.citrixEdgeserversModel.stopPolling()},error:function(e,n){t.triggerAction(d.MODAL.ACT.ALERT_SHOW,{type:d.MODAL.ALERT.TYPE_ERROR,message:t.i18n("error_ccvm_info")}),t.citrixEdgeserversModel.stopPolling()}};this.citrixEdgeserversModel.setClientName(e.customer_id),this.citrixEdgeserversModel.isPolling()||this.citrixEdgeserversModel.startPolling(n)},isEdgeServerPresent:function(e,t){for(var n=0;n<t.length;n++)if(!t[n].fqdn.indexOf(e.toLowerCase()))return t[n];return!1},fetchClusterData:function(){var e=this,t=this.service.intentService.getIntentService(d.ENTITY_CLUSTER),n={};n[a.UUID]=this.clusterUUID,t.then(function(e){return e.get(n)}).then(function(t){e.setClusterSpecAndSpecVersion(t.spec,t.metadata.spec_version);var n=t.spec.resources.config;n.external_configurations||(n.external_configurations={});var i=n.external_configurations.citrix_connector_config||{};if(!_.isEmpty(i)){var s=i.citrix_vm_reference_list.map(function(e){return e.uuid});return e.getVMList(s).then(function(t){e.getEdgeServerDetails(i);for(var n=!0,s=!0,a=t.api_response_list,o=0;o<a.length;o++)n&&"200"===a[o].status&&a[o].api_response.status.state!==d.INTENT_API_RESPONSE_STATUS.COMPLETE&&(n=!1),s&&"404"===a[o].status&&(s=!1);e.edgeServer=_.map(a,function(e){return{name:e.api_response.spec.name,power:e.api_response.spec.resources.power_state}}),e.triggerAction(d.MODAL.ACT.ALERT_HIDE),e.initialized=!0,e.step=e.DP.DETAILS,e.$("#citrixDetails").html(g(e.vtOptions({data:i,vmList:a,vmAvailable:s,vmCompleted:n}))),e.showSubview(".detailsContainer","left"),e.hideSubview(".formSaveContainer, .formConnectContainer"),e.showFooterButtons(e.step),n||e.triggerAction(d.MODAL.ACT.ALERT_SHOW,{type:d.MODAL.ALERT.TYPE_WARNING,message:e.i18n("vm_creation_inprogress")}),s||e.triggerAction(d.MODAL.ACT.ALERT_SHOW,{type:d.MODAL.ALERT.TYPE_ERROR,message:e.i18n("vm_creation_failed")})})}return e.renderConnectTemplate()}).catch(function(t){return e.renderConnectTemplate()})},getVMList:function(e){var t=this,n=this.service.intentService.getBatchService(),i=e.map(function(e){var i=d.ENTITY_VM,s=t.service.intentService.getIntentService(i);return s.then(function(t){n.addFromService(t,d.ACTION_GET,{uuid:e})}),s});return Promise.all(i).then(function(){return n.execute()})},render:function(e){var t=[{text:this.i18n("delete_connection"),extraClasses:"btnDelete",leftAligned:!0,extraAttr:[{key:"data-test",value:"btn_delete_connection"}]},{text:this.i18n("connect"),isPrimary:!0,extraClasses:"btnUpdate",extraAttr:[{key:"data-test",value:"btn_update"}]},{text:this.i18n("save_complete"),isPrimary:!0,extraClasses:"btnSave",extraAttr:[{key:"data-test",value:"btn_save"}]}],n="";if(this.step!==this.DP.NOACCESS&&(n=m(this.vtOptions({}))),this.$el.html(this.defaultTemplate({title:this.i18n("connect_cc_cloud"),bodyContent:n,footerButtons:this.defaultFooter(t)})),this.showFooterButtons(this.step),this.step===this.DP.NOACCESS)return this.triggerAction(d.MODAL.ACT.ALERT_SHOW,{type:d.MODAL.ALERT.TYPE_ERROR,message:this.i18n("AccessDeniedReasons.noAccessToV3"),closeButton:!1}),!1;this.triggerAction(d.MODAL.ACT.ALERT_SHOW,{type:d.MODAL.ALERT.TYPE_LOADING}),this.initialized||this.fetchClusterData()},showFooterButtons:function(e){this.$(".n-modal-footer .btn").hide(),e===this.DP.NOACCESS?this.$(".btnClose").show():e===this.DP.DETAILS?this.$(".btnDelete, .btnClose").show():(this.$(".btnCancel").show(),e===this.DP.CONNECT?this.$(".btnUpdate").show():e===this.DP.SAVE&&this.$(".btnSave").show())},validateSaveForm:function(){var e=[],t=this.$(".domainUsername").val(),n=this.$(".dnsGateway").val().trim();return n&&!p.isValidIP(n)?(this.triggerAction(d.MODAL.ACT.ALERT_SHOW,{type:d.MODAL.ALERT.TYPE_ERROR,message:this.i18n("invalid_dns_ip")}),!1):this.validateDomainUser(t)?($(".save-form").find("input").not(".highAvailability").not(".dnsGateway").not(".vmNameSecondary").not(".resourceLocation").each(function(t,n){$(".save-form").find(n).val().trim()||e.push(n)}),this.$el.find("#newResource").is(":checked")&&!this.$el.find(".n-new-resource-location").val().trim()&&e.push(this.$el.find(".n-new-resource-location")),this.$el.find(".highAvailability").is(":checked")&&!this.$el.find(".vmNameSecondary").val().trim()&&e.push(this.$el.find(".vmNameSecondary")),!e.length||(this.triggerAction(d.MODAL.ACT.ALERT_SHOW,{type:d.MODAL.ALERT.TYPE_ERROR,message:this.i18n("fields_mandatory")}),!1)):(this.triggerAction(d.MODAL.ACT.ALERT_SHOW,{type:d.MODAL.ALERT.TYPE_ERROR,message:this.i18n("domain_user_validate")}),!1)},validateDomainUser:function(e){return/^[a-zA-Z0-9\-.@_]+(\\){1}[a-zA-Z0-9\-.@_]+$/.test(e)},ifResourceLocationAvailable:function(){var e=this;if(this.validateSaveForm()){this.$(".btnSave").addClass("disabled");var t=this.$(".resourceLocation").val(),n=this.$("#existingResource").is(":checked");if(this.resources.length&&n)this.resourceLocation=t,this.resourceLocationName=this.$(".resourceLocation :selected").text().trim(),this.fetchSelectedVMDetails();else{var i=this.$(".n-new-resource-location").val();this.createResourceLocation(i).done(function(t){e.resourceLocation=t.id,e.resourceLocationName=t.name,e.fetchSelectedVMDetails()}).fail(function(){e.$(".btnSave").removeClass("disabled"),e.triggerAction(d.MODAL.ACT.ALERT_SHOW,{type:d.MODAL.ALERT.TYPE_ERROR,message:e.i18n("error_resource_location")})})}}},fetchSelectedVMDetails:function(){var e=this,t=this.service.intentService.getIntentService(d.ENTITY_VM),n={};n[a.UUID]=this.vmImageId,t.then(function(e){return e.get(n)}).then(function(t){var n=t.spec.resources;return e.vm_memory=n.memory_size_mib,e.num_vcpus=n.num_vcpus_per_socket,e.num_sockets=n.num_sockets,e.onSave()}).catch(function(t){e.$(".btnSave").removeClass("disabled"),e.triggerAction(d.MODAL.ACT.ALERT_SHOW,{type:d.MODAL.ALERT.TYPE_ERROR,message:e.i18n("error_vm_fetch")})})},onSave:function(){var e=this,t=this.vmImageId,n=this.$(".vmName").val(),i=this.$(".highAvailability").is(":checked"),s=this.$(".domainUsername").val().split("\\"),o=this.$(".password").val(),l=this.$(".domainPassword").val(),c=this.$(".dnsGateway").val(),p=this.$(".machineDomain").val(),u=this.$(".vmNameSecondary").val(),h=[],m=this.getSyspepStr({vmName:n,resourceLocation:this.resourceLocation,clientId:this.clientId,clientSecret:this.clientSecret,customerName:this.customerId,password:o,domainPassword:l,dnsGateway:c,machineDomain:p,domain:s[0],domainUserName:s[1]});if(this.triggerAction(d.MODAL.ACT.ALERT_SHOW,{type:d.MODAL.ALERT.TYPE_SAVING}),h.push(this.createVM(n,m,t)),i){var f=this.getSyspepStr({vmName:u,resourceLocation:this.resourceLocation,clientId:this.clientId,clientSecret:this.clientSecret,customerName:this.customerId,password:o,domainPassword:l,dnsGateway:c,machineDomain:p,domain:s[0],domainUserName:s[1]});h.push(this.createVM(u,f,t))}return Promise.all(h).then(function(t){var n=e.service.intentService.getIntentService(d.ENTITY_CLUSTER),i={};i[a.UUID]=e.clusterUUID,n.then(function(e){return e.get(i)}).then(function(n){e.setClusterSpecAndSpecVersion(n.spec,n.metadata.spec_version);var i=e.clusterSpec.resources.config;i.external_configurations||(i.external_configurations={}),i.external_configurations.citrix_connector_config={client_id:e.clientId,customer_id:e.customerId,client_secret:e.clientSecret,resource_location:{id:e.resourceLocation,name:e.resourceLocationName},citrix_vm_reference_list:_.map(t,function(e){return{kind:d.ENTITY_VM,uuid:e.metadata.uuid}})};var s={$body:e.clusterSpec,$isAsync:!1,$metadata:{kind:d.ENTITY_CLUSTER,uuid:e.clusterUUID,spec_version:e.specVersion}},o=e.service.intentService.getIntentService(d.ENTITY_CLUSTER);s[a.UUID]=e.clusterUUID,e.setClusterSpecAndSpecVersion(e.clusterSpec,e.specVersion),o.then(function(e){return e.put(s)}).then(function(){return e.$(".btnSave").removeClass("disabled"),e.fetchClusterData()}),r.showClientNotification(d.NOTIFY_SUCCESS,e.i18n("connection_saved"))}).catch(function(t){e.$(".btnSave").removeClass("disabled"),e.triggerAction(d.MODAL.ACT.ALERT_SHOW,{type:d.MODAL.ALERT.TYPE_ERROR,message:e.i18n(t.message)})})}).catch(function(t){e.$(".btnSave").removeClass("disabled"),e.triggerAction(d.MODAL.ACT.ALERT_SHOW,{type:d.MODAL.ALERT.TYPE_ERROR,message:e.i18n("error_vm_creation")})})},getVMSpec:function(){return{name:"",resources:{power_state:"ON",num_vcpus_per_socket:this.num_vcpus,num_sockets:this.num_sockets,memory_size_mib:this.vm_memory,parent_reference:{kind:d.ENTITY_VM,uuid:""},guest_customization:{sysprep:{install_type:d.GUEST_CUSTOMIZATION.INSTALLED_PREPARED,unattend_xml:""}}}}},getSyspepStr:function(e){return h(e)},deleteVM:function(e){var t=this.service.intentService.getIntentService(d.ENTITY_VM),n={};return n[a.UUID]=e,t.then(function(e){return e.delete(n)})},createVM:function(e,t,n){var i=this.service.intentService.getIntentService(d.ENTITY_VM),s=this.getVMSpec();return s[a.NAME]=e,s[a.INTENT_RESOURCES].parent_reference[a.UUID]=n,s[a.INTENT_RESOURCES].guest_customization.sysprep.unattend_xml=btoa(t),i.then(function(e){return e.post({$isAsync:!1,$body:s,$metadata:{kind:d.ENTITY_VM}})})},toggleInputOption:function(e){var t=$(e.target),n=t.attr("id");this.$(".inputTypeWrapper").hide(),this.$('.inputTypeWrapper[data-id="'+n+'"]').show()},deleteConnectionConfirm:function(){var e=this;$.nutanixConfirm({msg:this.i18n("vm_delete_confirmed"),yes:function(){e.deleteConnection()},context:this})},deleteConnection:function(){this.$(".btnDelete").addClass("disabled"),this.triggerAction(d.MODAL.ACT.ALERT_SHOW,{type:d.MODAL.ALERT.TYPE_LOADING}),this.deleteEdgeServerDetails()},updateClusterInfo:function(){var e=this;this.clusterSpec.resources.config.external_configurations.citrix_connector_config={};var t=this.service.intentService.getIntentService(d.ENTITY_CLUSTER),n={$isAsync:!1,$body:this.clusterSpec,$metadata:{kind:d.ENTITY_CLUSTER,uuid:this.clusterUUID,spec_version:this.specVersion}};return n[a.UUID]=this.clusterUUID,this.setClusterSpecAndSpecVersion(this.clusterSpec,this.specVersion),t.then(function(e){return e.put(n)}).then(function(t){e.setClusterSpecAndSpecVersion(t.spec,t.metadata.spec_version),e.renderConnectTemplate()}).catch(function(t){e.triggerAction(d.MODAL.ACT.ALERT_SHOW,{type:d.MODAL.ALERT.TYPE_ERROR,message:t.message})})},deleteEdgeServerDetails:function(){var e=this,t=this.getClusterSpec(),n=t.resources.config;n.external_configurations||(n.external_configurations={},n.external_configurations.citrix_connector_config={});var i=n.external_configurations.citrix_connector_config,s=JSON.stringify({client_id:i.client_id,client_secret:i.client_secret,resource_location_id:i.resource_location.id,edgeserver_names:_.map(this.edgeServer,function(e){return e.name})});this.citrixEdgeserversModel.setClientName(i.customer_id),this.citrixEdgeserversModel.isNew(!1),this.citrixEdgeserversModel.destroy({data:s,success:function(t,n){e.citrixEdgeserversModel.stopPolling(),e.deleteOnpremConnectorVMs()},error:function(t,n){e.$(".btnDelete").removeClass("disabled"),e.triggerAction(d.MODAL.ACT.ALERT_SHOW,{type:d.MODAL.ALERT.TYPE_ERROR,message:e.i18n("vm_delete_error")})}})},deleteOnpremConnectorVMs:function(){var e=this,t=this.getClusterSpec(),n=t.resources.config;n.external_configurations||(n.external_configurations={},n.external_configurations.citrix_connector_config={});var i=n.external_configurations,s=i.citrix_connector_config.citrix_vm_reference_list||[],a=[];return u.hasXen(this.clusterUUID)?r.showClientNotification(d.NOTIFY_WARNING,this.i18n("vm_delete_not_supported")):_.each(s,function(t){a.push(e.deleteVM(t.uuid))}),Promise.all(a).then(function(t){return e.updateClusterInfo()}).then(function(){e.$(".btnDelete").removeClass("disabled")}).catch(function(t){e.$(".btnDelete").removeClass("disabled"),e.triggerAction(d.MODAL.ACT.ALERT_SHOW,{type:d.MODAL.ALERT.TYPE_ERROR,message:e.i18n("vm_delete_error")})})},renderConnectTemplate:function(){this.triggerAction(d.MODAL.ACT.ALERT_HIDE),this.step=this.DP.CONNECT,this.$("#citrixConnect").html(f(this.vtOptions({}))),this.hideSubview(".detailsContainer, .formSaveContainer"),this.showSubview(".formConnectContainer","left"),this.showFooterButtons(this.step)},reset:function(){this.triggerAction(d.MODAL.ACT.ALERT_HIDE),this.clearForm()},onStopServices:function(){this.citrixEdgeserversModel&&this.citrixEdgeserversModel.stopPolling()},onCancel:function(){this.hide(),this.citrixEdgeserversModel&&this.citrixEdgeserversModel.stopPolling()},onConnect:function(){this.setClientCredential()},showHidePassword:function(e){e.preventDefault();var t=this.$(e.target),n=t.next();n.prop("type")===this.DP.TEXT?(n.prop("type",this.DP.PASSWORD),t.text(this.i18n("show"))):(n.prop("type",this.DP.TEXT),t.text(this.i18n("hide")))},highAvailabilityCheck:function(e){this.$(".highAvailability").is(":checked")?(this.$(".vmNameSecondary").prop("disabled",!1),this.triggerAction(d.MODAL.ACT.ALERT_HIDE)):(this.$(".vmNameSecondary").prop("disabled",!0),this.triggerAction(d.MODAL.ACT.ALERT_SHOW,{type:d.MODAL.ALERT.TYPE_WARNING,message:this.i18n("ha_warning"),closeTiming:d.MODAL.ALERT.CLOSE_TYPE_PERMANENT}))},parseCSV:function(){var e=this.$("#csvFile")[0].files[0],t=new FileReader;t.onload=function(e){try{var t=e.target.result.split(/\r\n|\n/),n=(t[0].split(","),t[1].split(","));this.customerId=this.$(".csvCustomerId").val(),this.clientId=n[1],this.clientSecret=n[2],this.validateCredential()}catch(e){this.triggerAction(d.MODAL.ACT.ALERT_SHOW,{type:d.MODAL.ALERT.TYPE_ERROR,message:this.i18n("valid_csv")})}}.bind(this),t.readAsText(e)},setClientCredential:function(){if(!this.validateConnectForm())return!1;this.$("#fromManual").is(":checked")?(this.customerId=this.$(".customerId").val(),this.clientId=this.$(".clientId").val(),this.clientSecret=this.$(".clientSecret").val(),this.validateCredential()):this.parseCSV()},createResourceLocation:function(e){var t=new E;return t.setClientName(this.customerId),t.set({client_id:this.clientId,client_secret:this.clientSecret,resource_location_name:e}),t.save()},validateConnectForm:function(){var e=this;if(this.$("#fromManual").is(":checked")){var t=[];if(this.$('.inputTypeWrapper[data-id="fromManual"]').find("input").each(function(n,i){e.$el.find(i).val().trim()||t.push(i)}),t.length)return this.triggerAction(d.MODAL.ACT.ALERT_SHOW,{type:d.MODAL.ALERT.TYPE_ERROR,message:this.i18n("fields_mandatory")}),!1}else{if(!this.$el.find(".csvCustomerId").val().trim())return this.triggerAction(d.MODAL.ACT.ALERT_SHOW,{type:d.MODAL.ALERT.TYPE_ERROR,message:this.i18n("fields_mandatory")}),!1;if(!this.$("#csvFile").val())return this.triggerAction(d.MODAL.ACT.ALERT_SHOW,{type:d.MODAL.ALERT.TYPE_ERROR,message:this.i18n("upload_csv")}),!1}return!0},initChecksAutoComplete:function(e){var t=this;this.$("#vmImage").autocomplete("destroy").autocomplete({source:e,minLength:2,delay:0,autoFocus:!0,select:function(e,n){t.$("#autoManage").addClass("n-icon-clear").attr("data-icon","v"),t.vmImageId=n.item.id}}).data("autocomplete").menu.element.addClass("modal-autocomplete")},clearAutoSelected:function(){this.$("#autoManage").removeClass("n-icon-clear").attr("data-icon","B"),this.$("#vmImage").val("")},validateCredential:function(){var e=new E;e.setClientName(this.customerId),this.triggerAction(d.MODAL.ACT.ALERT_SHOW,{type:d.MODAL.ALERT.TYPE_INFO,message:this.i18n("connecting_cc"),closeTiming:d.MODAL.ALERT.CLOSE_TYPE_PERMANENT}),e.fetch({data:{client_id:this.clientId,client_secret:this.clientSecret},success:function(e,t){this.resources=t,this.fetchVMs({power_state:[{op:d.FILTER_OPERATORS.EQUALS,value1:d.VM_POWER_STATE.OFF}]}).then(function(e){this.vmList=_.map(e.results,function(e){return{value:e.vm_name,id:e.id}}),this.step=this.DP.SAVE;var t=v(this.vtOptions({resources:_.map(this.resources,function(e){return{name:e.name,value:e.id}}),client_id:this.clientId,customer_id:this.customerId}));this.triggerAction(d.MODAL.ACT.ALERT_HIDE),this.$("#citrixSave").html(t),this.showSubview(".formSaveContainer","left"),this.hideSubview(".detailsContainer, .formConnectContainer"),this.initChecksAutoComplete(this.vmList),this.showFooterButtons(this.step),this.$(".n-tooltip-circle").tooltip("destroy").tooltip({placement:"right",trigger:"hover",html:!1})}.bind(this))}.bind(this),error:function(t,n){var i=void 0;try{i=JSON.parse(n.responseText).message_list[0].message}catch(e){i=n.responseText}this.triggerAction(d.MODAL.ACT.ALERT_SHOW,{type:d.MODAL.ALERT.TYPE_ERROR,message:i}),e.isPolling()||e.startPolling({alwaysTriggerChange:!0})}.bind(this)})},fetchVMs:function(e){e=e||{};var t=this.service.groupsAPI.getCollection;return t(d.ENTITY_VM).then(function(e){return e.totalEntityCount}).then(function(n){return t(d.ENTITY_VM,"",[a.EB.VM.VM_NAME,a.EB.VM.POWER_STATE],e,n,0).then(function(e){return e})})},destroy:function(){this.$(".n-tooltip-circle").tooltip("destroy"),this.$("#vmImage").autocomplete("destroy"),this.stopServices(),e.prototype.destroy.apply(this,arguments)},radioResourceChange:function(e){var t=$(e.target).attr("id");this.$(".n-radio-resource-content").hide(),this.$('.n-radio-resource-content[data-id="'+t+'"]').show()}})}),define("text!templates/popups/hardwareadministration/NVMeGuideContentView.html",[],function(){return'<div data-ntnx-content-inner>\n  <div class="nvme_selection_page">\n    <section data-ntnx-section="type-text">\n      <%= i18n(\'guide_title\') %>\n    </section>\n    <section data-ntnx-section>\n      <%=Components.radio({\n        id:"inserted_nvme",\n        name:"choose_nvme_scenarios",\n        checked:true,\n        })%>\n      <label data-ntnx-inline-label><%= i18n("inserted_nvme") %></label>\n      <p data-ntnx-section="type-text" class="nvme_desc">\n        <%= i18n("inserted_nvme_desc")%>\n      </p>\n    </section>\n    <section data-ntnx-section>\n      <%=Components.radio({\n        id:"existing_nvme",\n        name:"choose_nvme_scenarios"\n      })%>\n      <label data-ntnx-inline-label><%= i18n("existing_nvme")%></label>\n      <p data-ntnx-section="type-text" class="nvme_desc">\n        <%= i18n("existing_nvme_desc") %>\n      </p>\n    </section>\n  </div>\n  <div class="missing_instered_nvm hide">\n    <section data-ntnx-section="type-text">\n      <%= i18n(\'missing_inserted_guide_desc\') %>\n    </section>\n    <section data-ntnx-section="type-text">\n      <a href="<%=portal_replace_url%>" target="_blank">\n        <%= i18n(\'launch_replace_portal\') %>\n      </a>\n    </section>\n  </div>\n  <div class="missing_existing_nvm hide">\n    <section data-ntnx-section="type-text">\n      <p data-ntnx-section="type-text"><%= i18n(\'missing_existing_guide_desc\') %></p>\n      <p data-ntnx-section="type-text"><%= i18n(\'refer_alerts\')%></p>\n      <p data-ntnx-section="type-text"><%= i18n(\'follow_desc\')%></p>\n    </section>\n    <section data-ntnx-section="type-text">\n      <a href="<%=portal_replace_url%>" target="_blank">\n        <%= i18n(\'launch_replace_portal\') %>\n      </a>\n    </section>\n  </div>\n</div>'}),define("views/popups/hardwareadmin/NVMeGuidePopupView",["views/basecomponents/popups/BasePopupView","utils/AppConstants","data/DataURLConstants","text!templates/popups/hardwareadministration/NVMeGuideContentView.html"],function(e,t,n,i){"use strict";var s=_.template(i);return e.extend({el:"#popupNVMeGuide",name:"NVMeGuidePopupView",events:{"click .close":"hide","click .btnClose":"hide","click .btnNext":"onNext","click .btnBack":"onBack"},render:function(){var e=[{text:this.i18n("back"),extraClasses:"btnBack hide",leftAligned:!0},{text:this.i18n("next"),extraClasses:"btnNext",rightAligned:!0,isPrimary:!0},{text:this.i18n("close"),extraClasses:"btnClose hide"}];this.$el.html(this.defaultTemplate({title:this.i18n("title"),bodyContent:s(this.vtOptions({portal_replace_url:this.clusterManager.getCurrentClusterVersion()===t.PRISM_REPLACE_NVMEVERSION?n.PRISM_REPLACE_NVME55:n.PRISM_REPLACE_NVME59})),footerButtons:this.defaultFooter(e)}))},onNext:function(){this.$(".nvme_selection_page").addClass("hide"),$("input:radio[name=choose_nvme_scenarios]:checked").is("#inserted_nvme")?(this.$(".n-title").text(this.i18n("missing_inserted_guide_title")),this.$(".missing_instered_nvm").removeClass("hide")):(this.$(".n-title").text(this.i18n("missing_existing_guide_title")),this.$(".missing_existing_nvm").removeClass("hide")),this.$(".btnNext").addClass("hide"),this.$(".btnBack").removeClass("hide"),this.$(".btnClose").removeClass("hide"),this.triggerAction(t.MODAL.ACT.AS_REBUILD)},onBack:function(){this.$(".missing_instered_nvm").is(":visible")?this.$(".missing_instered_nvm").addClass("hide"):this.$(".missing_existing_nvm").addClass("hide"),this.$(".nvme_selection_page").removeClass("hide"),this.$(".btnBack").addClass("hide"),this.$(".btnClose").addClass("hide"),this.$(".btnNext").removeClass("hide"),this.triggerAction(t.MODAL.ACT.AS_REBUILD)}})}),define("app/scripts/popups",function(){});