function _defineProperty(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,i=Array(e.length);t<e.length;t++)i[t]=e[t];return i}return Array.from(e)}function _defineProperty(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function _defineProperty(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function _defineProperty(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function _defineProperty(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function _defineProperty(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}define("text!templates/pages/vms/details/VMTabDetailsView.html",[],function(){return'\x3c!-- Wrap --\x3e\n<div class="n-unit-wrap">\n  \x3c!-- Fixed unit --\x3e\n  <div class="n-unit-fixed">\n    \x3c!-- Column 1: Summary --\x3e\n    <div class="n-details-unit">\n      <div class="title">VM SUMMARY</div>\n      <ul class="n-list-info">\n        \x3c!-- Total VMs and Power State --\x3e\n        <li>\n          <div class="n-info-block">\n            <span class="n-label">Total VMs</span>\n            <span class="lblCountVMs n-value"\n                data-test="vm_summary_total_vms">\n              \x3c!-- @value: value goes here... --\x3e\n            </span>\n          </div>\n        </li>\n        <li>\n          <div class="n-info-block">\n            <span class="n-label">VM State</span>\n            <table class="n-value">\n              <tr class="n-row">\n                <td class="n-label-inline">\n                  <a title="on" class="n-vm-state-icon n-on"></a>\n                  Powered On\n                </td>\n                <td class="lblCountPoweredOn n-value-inline"\n                    data-test="vm_summary_vm_state_on">\n                  \x3c!-- @value: value goes here... --\x3e\n                </td>\n              </tr>\n              <tr class="n-row">\n                <td class="n-label-inline">\n                  <a title="off" class="n-vm-state-icon n-off"></a>\n                  Powered Off\n                </td>\n                <td class="lblCountPoweredOff n-value-inline"\n                    data-test="vm_summary_vm_state_off">\n                  \x3c!-- @value: value goes here... --\x3e\n                </td>\n              </tr>\n              <tr class="n-row">\n                <td class="n-label-inline">\n                  <a title="suspended" class="n-vm-state-icon n-suspended"></a>\n                  Suspended\n                </td>\n                <td class="lblCountSuspended n-value-inline"\n                    data-test="vm_summary_vm_state_suspended">\n                  \x3c!-- @value: value goes here... --\x3e\n                </td>\n              </tr>\n              <tr class="n-row  rowUnknownState" style="display:none">\n                <td class="n-label-inline">\n                  <a title="unknown" class="n-vm-state-icon n-unknown"></a>\n                  Unknown\n                </td>\n                <td class="lblCountUnknown n-value-inline">\n                  \x3c!-- @value: value goes here... --\x3e\n                </td>\n              </tr>\n            </table>\n          </div>\n        </li>\n        \x3c!-- CPU --\x3e\n        <li>\n          <div class="n-info-block">\n            <span class="n-label">Total Provisioned vCPU</span>\n            <span class="lblCountProvisionedVcpu n-value"\n                data-test="vm_summary_total_provisioned_vcpu">\n              \x3c!-- @value: value goes here... --\x3e\n            </span>\n          </div>\n        </li>\n        <li class="row-reserved-cpu">\n          <div class="n-info-block">\n            <span class="n-label">Total Reserved CPU</span>\n            <span class="lblReservedCPU n-value"\n                data-test="vm_summary_total_reserved_cpu">\n              \x3c!-- @value: value goes here... --\x3e\n            </span>\n          </div>\n        </li>\n        \x3c!-- Memory --\x3e\n        <li>\n          <div class="n-info-block">\n            <span class="n-label">Total Provisioned Memory</span>\n            <span class="lblMemoryProvisioned n-value"\n                data-test="vm_summary_total_provisioned_memory">\n              \x3c!-- @value: value goes here... --\x3e\n            </span>\n          </div>\n        </li>\n        <li>\n          <div class="n-info-block">\n            <span class="n-label">Total Reserved Memory</span>\n            <span class="lblMemoryReserved n-value"\n                data-test="vm_summary_total_reserved_memory">\n              \x3c!-- @value: value goes here... --\x3e\n            </span>\n          </div>\n        </li>\n      </ul>\n    </div>\n  </div>\n  \x3c!-- Fluid unit --\x3e\n  <div class="n-unit-fluid  n-tab-details-unit">\n    \x3c!-- @view: Tab details view goes here... --\x3e\n  </div>\n</div>'}),define("models/fileserver/FileInsightsModel",["views/notification/NotificationTemplates","models/MinervaModel","data/DataURLConstants","data/DataManager","managers/I18nManager","utils/AppConstants","utils/AppUtil"],function(e,t,i,n,s,a,r){"use strict";var o={IP:"ip",FS_LIST:"fs_list",IS_DEPLOYED:"is_deployed",VERSION:"version"};return t.extend({urlRoot:i.AFS_ANALYTICS_VM_CREATE,entityType:a.ENTITY_FILE_INSIGHTS_SERVER,idAttribute:o.IP,name:"FileInsightsModel",actionMode:null,entityName:null,nameAttribute:o.IP,DP:o,getURL:function(e,t){var n="";return"update"===e?n=i.AFS_ANALYTICS_VM_UPDATE:"delete"===e?this.actionMode&&this.actionMode===a.ACTION_DISABLE?n=_.template(i.AFS_ANALYTICS_VM_DISABLE,{fsUuid:t.fsUuid}):t.vmUuid&&(n=_.template(i.AFS_ANALYTICS_VM_DELETE,{vmUuid:t.vmUuid})):n=i.AFS_ANALYTICS_VM_CREATE,n},getDataSourceURL:function(){return n.getV2DataSourceURL()},setEntityName:function(e){this.entityName=e},setActionMode:function(e){this.actionMode=e},getFormField:function(e,t,i){return{value:e,fieldName:i,description:t}},isValidInputs:function(e,t){var i="";if(_.isEmpty(e))i+=s.t("FileInsightsModel","required_field_msg");else if("ntp server"!==t){var n=this.isValidIpAddressList(e,null);n||(i+=s.ts("FileInsightsModel","invalid_field_msg",t))}return i},isValidIpAddressList:function(e,t){var i=!0;if(_.isEmpty(e)&&(i=!1),t&&_.isEqual(e,t))i=!1;else{i=!_.some(e,function(e){return!r.isValidIP(e.trim())})}return i},getMessageTemplateValue:function(e){var t={};return e=e||this.actionMode,t.action=a.ACTION_NAMES[e].toLowerCase(),this.actionMode===a.ACTION_DISABLE&&(t.action=a.ACTION_NAMES[this.actionMode].toLowerCase()),t.entityType=a.ENTITY_NAMES[this.entityType],t.entityName=this.getValue(this.nameAttribute),t},getNotificationMessage:function(t,i){var n="";if(!this.entityName){var o=a.ENTITY_NAMES[this.entityType];this.setEntityName(o)}if(t===a.ACTION_UPDATE)n=e.MSG_ENTITY_SUBSCRIPTION({entityName:this.entityName});else if(t===a.ACTION_DISABLE&&this.actionMode===a.ACTION_DISABLE)n=e.MSG_ENTITY_UNSUBSCRIPTION({entityName:this.entityName});else if(i===a.NOTIFY_ERROR){var l=r.processSerializedObject(this._jqXHR.responseText),c=t;l&&l.message&&(c=l.message),n=s.ts("MinervaModel","failed_message",c)}else n=e.MSG_ENTITY_TASK_SUCCESS({entityName:this.entityName,actionName:t});return n}},{DP:o})}),define("models/fileserver/FileInsightsCollection",["models/PollingCollection","models/fileserver/FileInsightsModel","data/DataManager","data/DataURLConstants"],function(e,t,i,n){"use strict";return e.extend({model:t,url:n.AFS_ANALYTICS_VM_CREATE,name:"FileInsightsCollection",getDataSourceURL:function(){return i.getV2DataSourceURL()}})}),define("text!templates/pages/vms/details/VMTabDetailsEntityView.html",[],function(){return'\x3c!-- Wrap --\x3e\n<div class="n-unit-wrap">\n  \x3c!-- Fixed unit --\x3e\n  <div class="n-unit-fixed">\n    \x3c!-- Column 1: Summary --\x3e\n    <div class="n-details-unit">\n      <div class="title">VM DETAILS</div>\n      <ul class="n-list-info">\n        <li>\n          <div class="n-info-block">\n            <span class="n-label">Name</span>\n            <span class="n-value">\n              <span class="iconPowerState n-resettable">\n                \x3c!-- @value: icon power --\x3e\n              </span>\n              <span class="lblName  n-resettable"\n                  data-test="vm_details_vm_name">\n                \x3c!-- @value: name used goes here... --\x3e\n              </span>\n            </span>\n          </div>\n        </li>\n        <li>\n          <div class="n-info-block">\n            <span class="n-label">Description</span>\n            <span class="lblDesc n-value n-resettable"\n                data-test="vm_details_desc">\n              \x3c!-- @value: description goes here... --\x3e\n            </span>\n          </div>\n        </li>\n        <li style="display:none;">\n          <div class="n-info-block">\n            <span class="n-label">ID</span>\n             <span class="lblId n-value  n-resettable"\n                 data-test="vm_details_vm_id">\n               \x3c!-- @value: name used goes here... --\x3e\n             </span>\n          </div>\n        </li>\n        <li>\n          <div class="n-info-block">\n            <span class="n-label">Host</span>\n            <span class="lblHost n-value n-resettable"\n                data-test="vm_details_host">\n              \x3c!-- @value: value goes here... --\x3e\n            </span>\n          </div>\n        </li>\n        <li>\n          <div class="n-info-block">\n            <span class="n-label">Host IP</span>\n            <span class="lblHostIP n-value n-resettable"\n                data-test="vm_details_host_ip">\n              \x3c!-- @value: value goes here... --\x3e\n            </span>\n          </div>\n        </li>\n        <li class="mixed-hypervisor">\n          <div class="n-info-block">\n            <span class="n-label">Hypervisor</span>\n            <span class="lblHypervisor n-value n-resettable"\n                data-test="vm_details_hypervisor">\n              \x3c!-- @value: value goes here... --\x3e\n            </span>\n          </div>\n        </li>\n        <li class="row-guest-os">\n          <div class="n-info-block">\n            <span class="n-label">Guest OS</span>\n            <span class="lblGuestOS n-value n-resettable"\n                data-test="vm_details_guest_os">\n              \x3c!-- @value: value goes here... --\x3e\n            </span>\n          </div>\n        </li>\n        <li>\n          <div class="n-info-block">\n            <span class="n-label">Memory</span>\n            <span class="lblMemory n-value n-resettable"\n                data-test="vm_details_memory">\n              \x3c!-- @value: value goes here... --\x3e\n            </span>\n          </div>\n        </li>\n        <li class="row-reserved-memory">\n          <div class="n-info-block">\n            <span class="n-label">Reserved Memory</span>\n            <span class="lblReservedMemory n-value n-resettable"\n                data-test="vm_details_reserved_memory">\n              \x3c!-- @value: value goes here... --\x3e\n            </span>\n          </div>\n        </li>\n        <li class="row-assigned-memory">\n          <div class="n-info-block">\n            <span class="n-label">Assigned Memory</span>\n            <span class="lblAssignedMemory n-value n-resettable"\n                  data-test="vm_details_assigned_memory">\n              \x3c!-- @value: value goes here... --\x3e\n            </span>\n          </div>\n        </li>\n        <li>\n          <div class="n-info-block">\n            <span class="n-label">Cores</span>\n            <span class="lblVcpu n-value n-resettable"\n                data-test="vm_details_vcpu">\n                \x3c!-- @value: value goes here... --\x3e\n            </span>\n          </div>\n        </li>\n        <li class="row-reserved-cpu">\n          <div class="n-info-block">\n            <span class="n-label">Reserved CPU</span>\n            <span class="lblReservedCpu n-value n-resettable"\n                data-test="vm_details_reserved_cpu">\n              \x3c!-- @value: value goes here... --\x3e\n            </span>\n          </div>\n        </li>\n        <li class="row-disk-capacity">\n          <div class="n-info-block">\n            <span class="n-label">Disk Capacity</span>\n            <span class="lblDiskCapacity n-value n-resettable"\n                data-test="vm_details_disk_capacity">\n              \x3c!-- @value: value goes here... --\x3e\n            </span>\n          </div>\n        </li>\n        <li>\n          <div class="n-info-block">\n            <span class="n-label">Network Adapters</span>\n            <span class="lblNetworkAdapters n-value n-resettable"\n                data-test="vm_details_network_adapters">\n              \x3c!-- @value: value goes here... --\x3e\n            </span>\n          </div>\n        </li>\n        <li>\n          <div class="n-info-block">\n            <span class="n-label">IP Addresses</span>\n            <span class="lblIPAddress n-value n-resettable"\n                data-test="vm_details_ip_address">\n              \x3c!-- @value: value goes here... --\x3e\n            </span>\n          </div>\n        </li>\n        <li>\n          <div class="n-info-block">\n            <span class="n-label">\n              Storage Container</span>\n            <span id="containerNameDetail"\n              class="lblContainer n-value n-resettable"\n                  data-test="vm_details_container">\n              \x3c!-- @value: value goes here... --\x3e\n            </span>\n          </div>\n        </li>\n        <li>\n          <div class="n-info-block">\n            <span class="n-label">\n              Virtual Disks\n            </span>\n            <span class="lblVMDKCount n-value n-resettable">\n              \x3c!-- @value: value goes here... --\x3e\n            </span>\n          </div>\n        </li>\n        <li>\n          <div class="n-info-block">\n            <span class="n-label">\n              NGT Enabled\n            </span>\n            <span class="lblNGTEnabled n-value n-resettable">\n              \x3c!-- @value: value goes here... --\x3e\n            </span>\n          </div>\n        </li>\n        <li>\n          <div class="n-info-block">\n            <span class="n-label">\n              NGT Mounted\n            </span>\n            <span class="lblNGTMounted n-value n-resettable">\n              \x3c!-- @value: value goes here... --\x3e\n            </span>\n          </div>\n        </li>\n        <li class="hide">\n          <div class="n-info-block">\n            <span class="n-label">\n              VMware Guest Tools Mounted\n            </span>\n            <span class="lblVmgtMounted vmgt-info n-value n-resettable">\n              \x3c!-- @value: value goes here... --\x3e\n            </span>\n          </div>\n        </li>\n        <li class="hide">\n          <div class="n-info-block">\n            <span class="n-label">\n              VMware Guest Tools Running Status\n            </span>\n            <span class="lblVmgtRunStatus vmgt-info n-value n-resettable">\n              \x3c!-- @value: value goes here... --\x3e\n            </span>\n          </div>\n        </li>\n        <li class="hide">\n          <div class="n-info-block">\n            <span class="n-label">\n              GPU Configuration\n            </span>\n            <span class="lblGpuConfig gpu-info n-value n-resettable">\n              \x3c!-- @value: value goes here... --\x3e\n            </span>\n          </div>\n        </li>\n        <li class="hide">\n          <div class="n-info-block">\n            <span class="n-label">\n              Virtual Slice\n              <span class="virtual-slice-tooltip">\n                <%= Components.icon(\'question-tooltip\', \'-inline -regular\') %>\n              </span>\n            </span>\n            <span class="lblGpuFraction gpu-info n-value n-resettable">\n              \x3c!-- @value: value goes here... --\x3e\n            </span>\n          </div>\n        </li>\n        <li class="hide">\n          <div class="n-info-block">\n            <span class="n-label">\n              Framebuffer\n            </span>\n            <span class="lblGpuFramebuffer gpu-info n-value n-resettable">\n              \x3c!-- @value: value goes here... --\x3e\n            </span>\n          </div>\n        </li>\n        <li class="hide">\n          <div class="n-info-block">\n            <span class="n-label">\n              GPU Type\n            </span>\n            <span class="lblGpuType gpu-info n-value n-resettable">\n              \x3c!-- @value: value goes here... --\x3e\n            </span>\n          </div>\n        </li>\n        <li class="hide">\n          <div class="n-info-block">\n            <span class="n-label">\n              vGPU Guest Driver Version\n            </span>\n            <span class="lblGpuGuestDriverVersion gpu-info n-value n-resettable">\n              \x3c!-- @value: value goes here... --\x3e\n            </span>\n          </div>\n        </li>\n        <li class="item-dr" style="display:none">\n          <div class="n-info-block">\n            <span class="n-label">Consistency Group</span>\n            <span class="lblConsistencyGroup n-value n-resettable">\n              \x3c!-- @value: value goes here... --\x3e\n            </span>\n          </div>\n        </li>\n        <li>\n          <div class="n-info-block">\n            <span class="n-label">\n              <%= i18n(\'protection_status\') %>\n            </span>\n            <span class="lblProtectionStatus n-value n-resettable">\n              \x3c!-- @value: value goes here... --\x3e\n            </span>\n          </div>\n        </li>\n        \x3c!-- Optional if protection domain is present --\x3e\n        \x3c!-- or Entity protected via Protection policies in PC --\x3e\n        <li class="item-dr item-pd" style="display:none">\n          <div class="n-info-block">\n            <span class="n-label">Protection Domain</span>\n            <span class="lblProtectionDomain n-value n-resettable">\n              \x3c!-- @value: value goes here... --\x3e\n            </span>\n          </div>\n        </li>\n      </ul>\n    </div>\n  </div>\n  \x3c!-- Fluid unit --\x3e\n  <div class="n-unit-fluid  n-tab-details-unit">\n    \x3c!-- @view: Tab details view goes here... --\x3e\n  </div>\n</div>'}),define("views/pages/vms/details/VMTabDetailsEntityView",["views/basecomponents/details/BaseDetailsEntityView","text!templates/pages/vms/details/VMTabDetailsEntityView.html","models/vm/VMModel","models/vm/AcropolisVMModel","models/hardware/HostCollection","models/storage/ContainerCollection","models/gpu/GpuCollection","models/gpu/GpuModel","managers/NavigationManager","managers/ClusterManager","managers/AccessManager","data/DataProperties","data/DataURLConstants","utils/AppConstants","utils/AppUtil","utils/StatsUtil","utils/VMUtil","utils/HypervisorUtil","utils/VisualizationUtil","utils/GpuUtil","utils/FilterUtil","components/Components"],function(e,t,i,n,s,a,r,o,l,c,d,u,h,p,T,E,g,S,m,v,f,A){"use strict";var y=(_.template('<span alt="<%= vDiskName %>" title="<%= _.escape(vDiskName) %>"><%= _.escape(vDiskName) %></span><br>'),_.template('<span><%=i18n("notApplicable") %><span class="protection-info n-tooltip-circle" title="<%=i18n("ecProtectionInfo") %>">?</span></span>')),C=_.template('\n      <span class="missingGpuName">\n        <%= gpuName %>\n        <span class="moreInfo"></span>\n      </span>\n    '),I=_.template(t);return e.extend({name:"VMTabDetailsEntityView",entityType:p.ENTITY_VM,containerCollection:null,hostCollection:null,pGpuCollection:null,vGpuCollection:null,acropolisVmModel:null,modelEvents:{"change   model":"renderDetails","error    model":"renderError","pending  model":"reset","reset    containerCollection":"renderContainerName","error    containerCollection":"renderContainerError","pending  containerCollection":"renderContainerPending","reset    hostCollection":"renderHostInfo","error    hostCollection":"renderHostError","pending  hostCollection":"renderHostPending","reset    pGpuCollection":"renderPGpuInfo","error    pGpuCollection":"renderPGpuError","pending  pGpuCollection":"renderPGpuPending","reset    vGpuCollection":"renderVGpuInfo","error    vGpuCollection":"renderVGpuError","pending  vGpuCollection":"renderVGpuPending","change   acropolisVmModel":"renderInfo","pending  acropolisVmModel":"renderInfoPending"},events:{"click    a.pageLink":"onPageLinkClick"},initializeProperties:function(){this.model=new i,this.acropolisVmModel=new n,this.containerCollection=new a,this.hostCollection=new s,this.pGpuCollection=new r,this.vGpuCollection=new r,this.render()},render:function(){this.$el.html(I(this.vtOptions({Components:A}))),this.pdNotApplicableTmpl=y(this.vtOptions({}));var e={};e[p.TAB_DETAILS.METRICS]="VM Performance",e[p.TAB_DETAILS.VIRTUAL_DISKS_WRAP]="Virtual Disks",this.clusterManager.isMulticlusterNavMode()||(e[p.TAB_DETAILS.VIRTUAL_NICS]="VM NICs"),S.isAcropolisEnabled()&&this.isFFEnabled(p.FFLAGS.UI_ACROPOLIS)&&(this.clusterManager.isMulticlusterNavMode()&&(e[p.TAB_DETAILS.NICS]="VM NICs"),e[p.TAB_DETAILS.SNAPSHOTS]="VM Snapshots",e[p.TAB_DETAILS.TASKS]="VM Tasks"),S.isAcropolisEnabled()&&this.isFFEnabled(p.FFLAGS.UI_ACROPOLIS)||(e[p.TAB_DETAILS.ALERTS]="VM Alerts",this.clusterManager.isMulticlusterNavMode()||(e[p.TAB_DETAILS.EVENTS]="VM Events")),e[p.TAB_DETAILS.USAGE_BREAKDOWN]="I/O Metrics",this.clusterManager.isMulticlusterNavMode()||d.isClusterViewerOnly()||S.hasHyperV(this.clusterManager.getCurrentClusterId())||(e[p.TAB_DETAILS.VNC_CONSOLE]="Console"),this.tabDetailsView=m.renderTabDetailsView(this.$(".n-tab-details-unit"),e,this.entityType,p.PAGE_VMS)},renderDetails:function(){e.prototype.renderDetails.apply(this,arguments),this.clusterManager.isMulticlusterNavMode()||this.tabDetailsView.showTab(p.TAB_DETAILS.VIRTUAL_NICS),this.clusterManager.doesClusterHaveStats415(this.model)?this.tabDetailsView.showTab(p.TAB_DETAILS.VIRTUAL_DISKS_PERF):this.tabDetailsView.hideTab(p.TAB_DETAILS.VIRTUAL_DISKS_PERF),this.$(".lblName").html(this.model.escape(u.VM_NAME)).attr("title",this.model.escape(u.VM_NAME)),this.$(".lblDesc").html(this.model.escape(u.VM_DESC)).attr("title",this.model.escape(u.VM_DESC));var t=this.model.get(u.UUID);if(this.model.getReservedMemory()?(this.$(".row-reserved-memory").show(),this.$(".lblReservedMemory").html(this.model.getReservedMemory())):this.$(".row-reserved-memory").hide(),S.isAcropolisEnabled(c.getCurrentClusterId())&&d.isFFEnabled(p.FFLAGS.UI_ACROPOLIS)&&(this.$(".lblId").html(t).attr("title",t).closest("li").show(),this.$(".row-reserved-memory").hide()),this.$(".lblVcpu").html(this.model.getNumVCpus()),this.$(".lblMemory").html(E.storageFormat(this.model.getMemoryCapacity())),this.$(".lblNetworkAdapters").html(this.model.get(u.VM_NETWORK_ADTRS)||0),this.$(".lblIPAddress").html(this.model.get(u.VM_IP_ADDRESSES).join("<br />")),this.$(".iconPowerState").html(g.getPowerState(this.model.get(u.VM_POWER_STATE))),this.$(".lblState").html(this.model.get(u.VM_POWER_STATE)),this.$(".lblVMDKCount").html(this.model.get(u.VM_NTNX_VDISKS)?this.model.get(u.VM_NTNX_VDISKS).length:0),this.model.isKVM()||this.model.isESX()){var i=this.model.get(u.VM_NGT);this.$(".lblNGTEnabled").html(i[u.VM_NGT_ENABLED]?"Yes":"No"),this.$(".lblNGTMounted").html(i[u.VM_NGT_MOUNTED]?"Yes":"No")}else this.$(".lblNGTEnabled").closest("li").hide(),this.$(".lblNGTMounted").closest("li").hide();if(S.hasHyperV(this.model.getClusterUuid())?(this.$(".row-assigned-memory").show(),this.$(".lblAssignedMemory").html(this.model.getAssignedMemory())):this.$(".row-assigned-memory").hide(),this.model.getReservedCPU()&&!S.hasHyperV(this.model.getClusterUuid())?(this.$(".row-reserved-cpu").show(),this.$(".lblReservedCpu").html(this.model.getReservedCPU()),this.$(".row-disk-capacity").show(),this.$(".lblDiskCapacity").html(E.storageFormat(this.model.get(u.VM_DISK_CAPACITY)))):(this.$(".row-reserved-cpu").hide(),this.$(".row-disk-capacity").hide()),this.model.get(u.VM_GUEST_OS)?(this.$(".row-guest-os").show(),this.$(".lblGuestOS").html(this.model.get(u.VM_GUEST_OS))):this.$(".row-guest-os").hide(),this.model.get(u.VM_PD_NAME)){this.$(".item-dr").show();var n=T.createPageLink(this.model.get(u.VM_PD_NAME),p.ENTITY_PROTECTION_DOMAIN,this.model.get(u.VM_PD_NAME));if(this.$(".lblProtectionDomain").html(n),this.$(".lblProtectionDomain").attr("title",this.model.get(u.VM_PD_NAME)),c.isMulticlusterNavMode()){var s=this.model.getClusterUuid();this.$(".lblProtectionDomain a").attr({clusterUuid:s})}this.$(".lblConsistencyGroup").html(this.model.get(u.VM_CONSISTENCY_GROUP_NAME)),this.$(".lblConsistencyGroup").attr("title",this.model.get(u.VM_CONSISTENCY_GROUP_NAME))}else this.model.get(u.VM_PROTECTION_TYPE)===p.VM_PROTECTION_TYPE.ENTITY_CENTRIC?(this.$(".item-pd").show(),this.$(".lblProtectionDomain").html(this.pdNotApplicableTmpl),this.$(".protection-info").tooltip("destroy"),this.$(".protection-info").tooltip({placement:"right",trigger:"hover",container:"body",html:!1})):this.$(".item-dr").hide();var a=this.model.get("protectionType").toLowerCase().replace(/[^\w]/,"_");if(-1!==["entity_centric","legacy","unprotected"].indexOf(a)?this.$(".lblProtectionStatus").html(this.i18n(a)):this.$(".lblProtectionStatus").html(this.i18n("unprotected")),this.tabDetailsView){var r=this.tabDetailsView.getTabContent(p.TAB_DETAILS.METRICS);r&&r.showResource(this.model)}0===this.containerCollection.length?this.containerCollection.fetch():this.renderContainerName(),0===this.hostCollection.length?this.hostCollection.fetch():this.renderHostInfo(),this.model.isESX()&&this.$(".vmgt-info").closest("li").removeClass("hide");var o=this.acropolisVmModel.get(this.acropolisVmModel.idAttribute)===this.model.get(u.UUID);this.acropolisVmModel.clear({silent:o}),this.acropolisVmModel.set(this.acropolisVmModel.idAttribute,this.model.get(u.UUID),{silent:!0}),this.acropolisVmModel.fetch()},renderInfo:function(){if(this.$(".lblVmgtMounted").html(this.acropolisVmModel.isToolsInstallerMounted()?p.LABEL_YES:p.LABEL_NO),this.$(".lblVmgtRunStatus").html(this.acropolisVmModel.getToolsInstallerRunningStatus()),this.assignedVmGpus=this.acropolisVmModel.getAssignedGpus(),this.assignedVmGpus){this.$(".gpu-info").closest("li").removeClass("hide");this.acropolisVmModel.getGpuMode()===o.GPU_MODE.VIRTUAL?this.getVGpus():(this.getPGpus(),this.$(".lblGpuFraction, .lblGpuFramebuffer").closest("li").addClass("hide"),this.$(".lblGpuGuestDriverVersion").closest("li").addClass("hide"))}else this.$(".gpu-info").closest("li").addClass("hide")},getVGpus:function(){this.vGpuCollection.length?this.renderVGpuInfo():(this.vGpuCollection.setvGpuProfileUrl(),this.vGpuCollection.fetch())},getPGpus:function(){if(this.pGpuCollection.length)this.renderPGpuInfo();else{var e=f.filterConditionToFIQL(o.DP.GPU_TYPE,{op:p.FILTER_OPERATORS.NOT_EQUALS,value1:o.GPU_TYPE_KSTRING.VIRTUAL});this.pGpuCollection.setFilterCriteria(e),this.pGpuCollection.fetch()}},renderInfoPending:function(){T.addInLineDonutLoader(this.$(".vmgt-info"))},renderContainerName:function(){var e=[],t=this.model.get(u.VM_CONTAINER_IDS);_.each(t,function(t){var i=this.containerCollection.findModelById(t);if(i){var n=T.createPageLink(i.get(u.NAME),p.ENTITY_CONTAINER,i.get(i.idAttribute));e.push(n[0].outerHTML)}},this),e.length>0?this.$(".lblContainer").html(e.join("<br>")):this.$(".lblContainer").empty()},renderContainerError:function(){this.$(".lblContainer").empty()},renderContainerPending:function(){T.addInLineDonutLoader(this.$(".lblContainer"))},renderHostInfo:function(){var e=this.model.get(u.HOST_ID);if(null!==e&&this.hostCollection.length>0){var t=this.hostCollection.findModelById(e);if(t){var i=t.get(u.NAME);this.$(".lblHost").text(i);var n=t.get(u.HYPERVISOR_IP);this.$(".lblHostIP").text(n);var s;c.isMulticlusterNavMode()&&(s=this.model.getClusterUuid()),S.getClusterHypervisors(s).length>1||c.isMulticlusterNavMode()?(this.$(".mixed-hypervisor").show(),this.$(".lblHypervisor").text(p.HYPERVISOR_LABEL[t.get(u.HYPERVISOR_TYPE)])):this.$(".mixed-hypervisor").hide()}}else this.renderHostError()},renderHostError:function(){this.$(".lblHostIP, .lblHost").empty()},renderHostPending:function(){T.addInlineSpinner(this.$(".lblHostIP, .lblHost"))},renderVGpuInfo:function(){this.$(".virtual-slice-tooltip").tooltip("destroy"),this.$(".missingGpuName > .moreInfo").nutanixMoreInfo("destroy");var e=_.first(this.assignedVmGpus),t=v.getGpuIdentifier(e,o.DP),i=this.vGpuCollection.findModelByIdentifier(t),n=i?i.get(o.DP.GPU_CONFIG):null,s=n?n[o.DP.DEVICE_NAME]:C(this.vtOptions({gpuName:e[u.GPU_VENDOR]})),a=this.i18n(this.acropolisVmModel.getGpuMode().toLowerCase()),r=n?v.getFractionDisplayStr(n[o.DP.FRACTION]):p.DATA_NOT_AVAILABLE,l=n?E.statsFormat(u.STATS_GPU_FRAMEBUFFER_BYTES,n[o.DP.FRAMEBUFFER],!0):p.DATA_NOT_AVAILABLE,c=this.acropolisVmModel.getGuestDriverVersion()||p.DATA_NOT_AVAILABLE;this.$(".lblGpuConfig").html(s),this.$(".lblGpuFraction").html(r),this.$(".lblGpuFramebuffer").html(l),this.$(".lblGpuType").html(a),this.$(".lblGpuGuestDriverVersion").html(c),this.$(".virtual-slice-tooltip").tooltip({title:this.i18n("fractionTooltip"),placement:"top",html:!0,trigger:"hover",container:"body"}),this.$(".missingGpuName > .moreInfo").nutanixMoreInfo({title:this.i18n("missing_gpu_hardware"),container:"body"})},renderPGpuInfo:function(){this.$(".missingGpuName > .moreInfo").nutanixMoreInfo("destroy");var e=_.map(this.assignedVmGpus,function(e){var t=v.getGpuIdentifier(e,o.DP),i=this.pGpuCollection.findModelByIdentifier(t);return i?i.getGpuName():C(this.vtOptions({gpuName:e[u.GPU_VENDOR]}))},this);e=v.groupGpuList(e);var t=this.i18n(this.acropolisVmModel.getGpuMode().toLowerCase());this.$(".lblGpuConfig").html(e.join("<br>")),this.$(".lblGpuType").html(t),this.$(".missingGpuName > .moreInfo").nutanixMoreInfo({title:this.i18n("missing_gpu_hardware"),container:"body"})},renderPGpuPending:function(){this.$(".missingGpuName > .moreInfo").nutanixMoreInfo("destroy"),T.addInLineDonutLoader(this.$(".vmgt-info, .gpu-info"))},renderPGpuError:function(){this.$(".lblGpuType, .lblGpuGuestDriverVersion").empty()},renderVGpuPending:function(){this.$(".missingGpuName > .moreInfo").nutanixMoreInfo("destroy"),T.addInLineDonutLoader(this.$(".vmgt-info, .gpu-info"))},renderVGpuError:function(){this.$(".lblGpuConfig, .lblGpuFraction, .lblGpuFramebuffer").empty()},destroy:function(){this.$(".virtual-slice-tooltip").tooltip("destroy"),this.$(".protection-info").tooltip("destroy"),this.$(".missingGpuName > .moreInfo").nutanixMoreInfo("destroy"),e.prototype.destroy.apply(this,arguments)},onPageLinkClick:function(e){var t=$(e.currentTarget);if(t.attr(u.CLUSTER_UUID)){var i=t.attr(p.NAV_PAGE_ID),n=t.attr(p.NAV_SUBPAGE_ID),s=l.formOptionsFromElement(t);s+=t.attr(u.CLUSTER_UUID)?"&"+h.CLUSTER_ID+"="+t.attr(u.CLUSTER_UUID):"",l.navigateToPage(i,n,s,!0)}else l.navigateToPageByPageLink(t)}})}),
define("views/pages/vms/details/VMTabDetailsView",["views/basecomponents/details/BaseDetailsView","text!templates/pages/vms/details/VMTabDetailsView.html","views/basecomponents/details/detailsaction/DetailsActionTemplates","models/vm/VMCollection","models/hardware/HostCollection","models/filtercount/VMPowerStateCountModel","models/EntityProjectionModel","models/fileserver/FileInsightsCollection","managers/NavigationManager","managers/ClusterManager","managers/PrismElementManager","managers/ActionManager","managers/TaskManager","views/pages/vms/details/VMTabDetailsEntityView","utils/AppUtil","utils/AppConstants","utils/StatsUtil","utils/HypervisorUtil","utils/VisualizationUtil","utils/VMUtil","data/DataProperties"],function(e,t,i,n,s,a,r,o,l,c,d,u,h,p,T,E,g,S,m,v,f){"use strict";return e.extend({POWER_OFF_ACTIONS:"Power Off Actions",pageId:E.PAGE_VMS,summaryTemplate:_.template(t),name:"VMTabDetailsView",vmCollection:null,vmPowerStateCountModel:null,entityProjectionModel:null,hostCollection:null,fileInsightsIp:null,previousVmUuid:null,events:{"click  .linkRowItem":"onClickLinkRowItem"},modelEvents:{"reset  vmCollection":"renderVMViewsOld","change vmPowerStateCountModel":"renderVMViews","change entityProjectionModel":"renderVMViews","reset  hostCollection":"renderHostViews"},pcvmEnabledActionsKey:["updateTemplate","consoleTemplate","powerTemplate","pauseTemplate","migrateTemplate"],initializeProperties:function(){this.vmCollection=new n,this.hostCollection=new s,this.vmPowerStateCountModel=new a;var e=r.DP.VM_ENTITY;this.entityProjectionModel=new r({entityType:"vm",projection:[e.CPU_RESERVATION_HZ,e.MEMORY_RESERVED_BYTES,e.NUM_VCPUS,e.MEMORY_SIZE_BYTES]})},customDetailsEventHandler:function(e,t){if(t){var i=this.getDetailsEntityView(E.ENTITY_VM);switch(t.action){case E.ACTION_MIGRATE:i.migrate(e,t[E.NAV_ACTION_TARGET_ID],t[E.NAV_ACTION_TARGET_NAME]);break;case E.ACTION_LAUNCH_CONSOLE:d.isLoadedFromPrismCentral()&&(t[E.NAV_ACTION_PARENT_ID]=c.getCurrentClusterUuid()),u.executeAction(t);break;default:i.setPowerState(e,t)}}},render:function(){var e={};e[E.TAB_DETAILS.METRICS]="Performance Summary",S.isAcropolisEnabled()&&this.isFFEnabled(E.FFLAGS.UI_ACROPOLIS)&&(e[E.TAB_DETAILS.TASKS]="All VM Tasks"),S.isAcropolisEnabled()&&this.isFFEnabled(E.FFLAGS.UI_ACROPOLIS)||(e[E.TAB_DETAILS.ALERTS]="All VM Alerts",this.clusterManager.isMulticlusterNavMode()||(e[E.TAB_DETAILS.EVENTS]="All VM Events")),this.tabDetailsView=m.renderTabDetailsView(this.$(".n-tab-details-unit"),e,E.ENTITY_CLUSTER,E.PAGE_VMS),this.storeToDetailsEntityMap(E.ENTITY_VM,new p({el:this.getDetailsEntityElement(E.ENTITY_VM)}))},getDataAndRender:function(){this.clusterManager.isClusterFFEnabled(E.FFLAGS.SUPPORT_PAGINATION)?(this.vmPowerStateCountModel.startPolling(),this.entityProjectionModel.startPolling()):this.vmCollection.startPolling(),this.tabDetailsView.refreshCurrentTab(),this.hostCollection.length||this.hostCollection.startPolling()},refreshView:function(){e.prototype.refreshView.apply(this,arguments),this.hostCollection.fetch()},onStopServices:function(){e.prototype.onStopServices.apply(this,arguments),this.hostCollection.stopPolling(),this.vmCollection.stopPolling(),this.vmPowerStateCountModel.stopPolling(),this.entityProjectionModel.stopPolling()},renderVMViewsOld:function(){var e={countVMs:this.vmCollection.getMetaData()?this.vmCollection.getMetaData()[f.META_TOTAL_ENTITIES]:this.vmCollection.length,countPoweredOn:0,countPoweredOff:0,countSuspended:0,countUnknownState:0,countProvisionedVcpu:0,reservedCPU:0,memoryProvisioned:0,memoryReserved:0};_.each(this.vmCollection.models,function(t){switch(t.get(f.VM_POWER_STATE)){case E.VM_POWER_STATE.ON:e.countPoweredOn++;break;case E.VM_POWER_STATE.OFF:e.countPoweredOff++;break;case E.VM_POWER_STATE.SUSPEND:e.countSuspended++}e.countUnknownState=e.countVMs-(e.countPoweredOn+e.countPoweredOff+e.countSuspended),e.countProvisionedVcpu+=t.get(f.VM_NUM_VCPUS)||0,e.reservedCPU+=t.get(f.VM_CPU_RESERVED)||0,e.memoryProvisioned+=t.get(f.VM_MEM_CAPACITY)||0,e.memoryReserved+=t.get(f.VM_MEM_RESERVED)||0}),this.renderCommon(e)},renderVMViews:function(){var e={countVMs:0,countPoweredOn:0,countPoweredOff:0,countSuspended:0,countUnknownState:0,countProvisionedVcpu:0,reservedCPU:0,memoryProvisioned:0,memoryReserved:0},t=this.vmPowerStateCountModel.getCountObjects();_.each(t,function(t){switch(t.label.toLowerCase()){case E.VM_POWER_STATE.ON:e.countPoweredOn=t.count;break;case E.VM_POWER_STATE.OFF:e.countPoweredOff=t.count;break;case E.VM_POWER_STATE.SUSPENDED:e.countSuspended=t.count}}),e.countUnknownState=e.countVMs-(e.countPoweredOn+e.countPoweredOff+e.countSuspended),_.each(this.entityProjectionModel.get(this.entityProjectionModel.DP.ENTITIES),function(t){e.countProvisionedVcpu+=parseInt(t.num_vcpus,10)||0,e.reservedCPU+=parseInt(t.cpu_reservation_hz,10)||0,e.memoryProvisioned+=parseInt(t.memory_size_bytes,10)||0,e.memoryReserved+=parseInt(t.memory_reserved_bytes,10)||0,e.countVMs++}),this.renderCommon(e)},renderCommon:function(e){e.reservedCPU=g.prefixFormat(e.reservedCPU,g.SYMBOL_HERTZ),e.memoryProvisioned=g.storageFormat(e.memoryProvisioned),e.memoryReserved=g.storageFormat(e.memoryReserved),this.$(".lblCountProvisionedVcpu").html(e.countProvisionedVcpu),this.$(".lblMemoryProvisioned").html(e.memoryProvisioned),this.$(".lblMemoryReserved").html(e.memoryReserved),S.hasHyperV()?this.$(".row-reserved-cpu").hide():(this.$(".row-reserved-cpu").show(),this.$(".lblReservedCPU").html(e.reservedCPU)),this.$(".lblCountVMs").html(e.countVMs),this.$(".lblCountPoweredOn").html(e.countPoweredOn),this.$(".lblCountPoweredOff").html(e.countPoweredOff),this.$(".lblCountSuspended").html(e.countSuspended),this.$(".lblCountUnknown").html(e.countUnknownState),e.countUnknownState>0?this.$(".rowUnknownState").show():this.$(".rowUnknownState").hide()},renderHostViews:function(){var e=this.tabDetailsView.getTabContent(E.TAB_DETAILS.METRICS);e&&e.showResource(this.hostCollection)},getDetailsAction:function(e,t){var n={},s=$.extend({},e),a={},r=t.get(f.VM_TYPE)===E.VM_TYPES.AFS;a[E.NAV_ACTION_TARGET_ID]=t.get(f.UUID),$.extend(s,a),n.consoleTemplate={model:s,action:E.ACTION_LAUNCH_CONSOLE,content:i.LAUNCH_CONSOLE,custom:!0},n.updateTemplate={model:s,action:E.ACTION_UPDATE,content:i.UPDATE},n.cloneTemplate={model:s,action:E.ACTION_CLONE,content:i.CLONE},n.migrateTemplate={model:e,action:E.ACTION_MIGRATE,content:i.MIGRATE},n.deleteTemplate={model:s,action:E.ACTION_DELETE,content:i.DELETE},n.snapshotTemplate={model:e,action:E.ACTION_SNAPSHOT,content:i.SNAPSHOT};var o=E.ACTION_POWER_OFF,l=this.POWER_OFF_ACTIONS;n.ngtTemplate={model:e,action:E.ACTION_MANAGE_NGT,content:i.MANAGE_NGT},t.get(f.POWER_STATE)===E.VM_POWER_STATE.OFF&&(o=E.ACTION_POWER_ON,l=E.ACTION_NAMES[o]),n.powerTemplate={model:s,action:o,content:_.template(i.TOGGLE_POWER,{actionText:l})},o=E.ACTION_PAUSE,(t.isESX()||t.isHyperV())&&(o=E.ACTION_SUSPEND),t.get(f.POWER_STATE)===E.VM_POWER_STATE.SUSPENDED&&(o=E.ACTION_RESUME),n.pauseTemplate={model:s,action:o,content:_.template(i.TOGGLE_PAUSE,{actionText:E.ACTION_NAMES[o]})},o=E.ACTION_SAVE,l=E.ACTION_NAMES[o],n.saveTemplate={model:s,action:E.ACTION_SAVE,content:_.template(i.SAVE,{actionText:l})},n=this.disableVMButtons(n,t);var c=[];t.getClusterUuid();c.push(n.consoleTemplate),this.canModifyByEntityType(E.ENTITY_VM)&&(r?c=_.union(c,[n.powerTemplate]):(c.unshift(n.ngtTemplate),c=_.union(c,[n.powerTemplate,n.saveTemplate,n.snapshotTemplate,n.migrateTemplate,n.pauseTemplate,n.cloneTemplate,n.updateTemplate,n.deleteTemplate])));var d=[];return _.each(c,function(e){v.isVmActionSupported(e.action,t)&&d.push(e)}),d},disableVMButtons:function(e,t){var i=h.getGlobalTasks().hasActiveClusterConvertTask(),n=t.get(f.POWER_STATE)===E.VM_POWER_STATE.UNKNOWN;if(t.get(f.POWER_STATE)===E.VM_POWER_STATE.OFF&&(e.pauseTemplate=this._disableButton(e.pauseTemplate,this.i18n("vmPoweredOff")),e.migrateTemplate=this._disableButton(e.migrateTemplate,this.i18n("vmPoweredOffNoMigrate"))),t.get(f.POWER_STATE)!==E.VM_POWER_STATE.SUSPENDED&&t.get(f.POWER_STATE)!==E.VM_POWER_STATE.PAUSED||(e.consoleTemplate=this._disableButton(e.consoleTemplate,this.i18n("vmPausedNoConsole"))),c.isTwoNodeCluster()){if(c.getCurrentClusterModel().get(f.CLUSTER_OPERATION_MODE)!==E.CLUSTER_MODE_V2_API.NORMAL){var s=this.i18n("node_disabled");e.migrateTemplate=this._disableButton(e.migrateTemplate,s)}}t.get(f.POWER_STATE)===E.VM_POWER_STATE.ON&&t.get(f.VM_GPUS_IN_USE)&&(e.pauseTemplate=this._disableButton(e.pauseTemplate,this.i18n("gpuNoPause")),e.migrateTemplate=this._disableButton(e.migrateTemplate,this.i18n("gpuNoMigrate"))),!1===t.get(f.VM_DISPLAYABLE)&&(e.consoleTemplate=this._disableButton(e.consoleTemplate,this.i18n("vmPoweredOffNoLaunchConsole")));var a;if(t.get(f.VM_CONTROLLER_VM))for(a in e)"consoleTemplate"!==a&&(e[a]=this._disableButton(e[a],this.i18n("cvm")));else if(t.get(f.VM_DESCRIPTION)===E.NUTANIX_PRISM_CENTRAL)for(a in e)-1===this.pcvmEnabledActionsKey.indexOf(a)&&(e[a]=this._disableButton(e[a],this.i18n("prism_central_vm")));else if(n){var r=[f.VM_ACTION_TEMPLATES.NGT_TEMPLATE];for(a in e)a===f.VM_ACTION_TEMPLATES.CONSOLE_TEMPLATE||!n&&-1!==_.indexOf(r,a)||(e[a]=this._disableButton(e[a],this.i18n("unknownPowerState")))}else for(a in e)t.isESX()&&!v.isVmActionSupportedOnCurrentCluster(e[a].action,t)&&(e[a]=this._disableButton(e[a],this.i18n("noMgmtServerVcenter")));if(i)for(a in e)a!==f.VM_ACTION_TEMPLATES.POWER_TEMPLATE&&a!==f.VM_ACTION_TEMPLATES.CONSOLE_TEMPLATE&&(e[a]=this._disableButton(e[a],this.i18n("convertClusterProgress")));return(this.fileInsightsIp&&t.get(f.VM_IP_ADDRESSES).indexOf(this.fileInsightsIp)>-1||this.fileInsightsUuid&&t.get(f.UUID)===this.fileInsightsUuid)&&(e.cloneTemplate=this._disableButton(e.cloneTemplate,this.i18n("file_insights_vm_action_disable")),e.deleteTemplate.action=E.ACTION_DELETE_FILE_INSIGHTS,e.deleteTemplate[E.NAV_ACTION_ID]=this.fileInsightsIp),e},checkFileInsightsVm:function(e){if(e.get(f.UUID)!==this.previousVmUuid){this.previousVmUuid=e.get(f.UUID);var t=this;(new o).fetch({success:function(i){var n=i.models[0];n&&n.get(n.DP.IP)&&n.get(f.UUID)?(t.fileInsightsIp=n.get(n.DP.IP),t.fileInsightsUuid=n.get(f.UUID),t.disableVMActions(e)):(t.fileInsightsIp="",t.fileInsightsUuid="")},error:function(){T.log("Error: fetching File Insights vms.")}})}},disableVMActions:function(e){if(this.fileInsightsIp&&e.get(f.VM_IP_ADDRESSES).indexOf(this.fileInsightsIp)>-1||this.fileInsightsUuid&&e.get(f.UUID)===this.fileInsightsUuid){var t=this.$(".btnDetailsAction[action = "+E.ACTION_CLONE+"]"),i=this.i18n("file_insights_vm_action_disable");t.addClass("btnDisabled").attr("title",i);var n=this.$(".btnDetailsAction[action = "+E.ACTION_DELETE+"]");n.attr("action",E.ACTION_DELETE_FILE_INSIGHTS),n.attr(E.NAV_ACTION_ID,this.fileInsightsIp)}},_disableButton:function(e,t){return e.disabled=!0,e.custom=!1,e.tooltip=t,e},onClickLinkRowItem:function(e){l.updateRouteOption(e.currentTarget)}})}),define("views/basecomponents/datatables/vm/VMTableView",["views/basecomponents/datatables/BasePaginateTableView","views/basecomponents/datatables/DataTableColumnProvider","data/DataProperties","models/vm/VMCollection","models/hardware/HostCollection","utils/AppUtil","utils/AppConstants","utils/VMUtil","utils/StatsUtil","utils/HypervisorUtil","managers/ActionManager","managers/ClusterManager"],function(e,t,i,n,s,a,r,o,l,c,d,u){"use strict";var h=_.template("<div>    This VM is not capable of backup and recovery.     Possible reason:</div><p><%= rowData.nonNdfsDetails %></p>"),p=_.template("<% _.each(rowData.ipAddresses, function(ip) { %>  <p>    <%= ip %>  </p><% }) %>"),T=r.LABEL_NO+'<span class="n-tooltip-circle">?</span>';_.template('<span title="<%= ipAddress %>"><%= ipAddress %></span>');return e.extend({CONTROLLER_LABEL:"Controller",NOT_SUPPORTED_MESSAGE:"N/A indicates that the stat is not supported for the VM's hypervisor.",preFetchPageCount:5,hostCollection:null,initialize:function(t){e.prototype.initialize.apply(this,arguments),this.idSearch.config[this.idSearch.CONFIG_PROP.FILTER_ON_SINGLE_PAGE]=!0;var i=u.getCurrentClusterModel();i&&i.isAmfOverEsxBasicSupported()&&_.extend(this.events,{"dblclick .baseDataTable tbody tr":"onDblClickDataRow"}),this.enablePopoverOnHover()},initializeTableModel:function(e){this.model=new n,this.hostCollection=new s;var t=this;this.hostCollection.on("reset",function(){t.model.stateMonitor.getState()===r.STATE_SUCCESS&&t.onDataChange()}),this.hostCollection.fetch(),this.model.setProjection([r.PROJECTION.STATS,r.PROJECTION.BASIC_INFO,r.PROJECTION.ALERTS])},renderSubviews:function(){if(e.prototype.renderSubviews.apply(this,arguments),a.hasLocalStorage()){var t=localStorage[r.LOCAL_STORAGE.SHOW_CVM];t="true"===t,this.$("input[data-filter=controllerVm]").prop("checked",t),this.onFilterChange(t)}},getDefaultColumns:function(e,n){var s=u.isMulticlusterNavMode(),a=_.template('<span class="n-vm-name"><%= name %></span>'),d=this,E=[{sTitle:"VM Name",mData:i.VM_NAME,sWidth:"14%",sClass:r.STYLE_ALERT_TABLE_INDICATOR,sortKey:"vm_name",searchId:"vm_name",mRender:function(e,t,n){return t===r.TABLE_COL_TYPE_DISPLAY?o.getPowerState(n[i.VM_POWER_STATE])+a({name:_.escape(e)}):e}},{sTitle:"Host",mData:i.VM_HOST_ID,sortKey:"node_name",searchId:"node_name",sWidth:"8%",mRender:function(e,t,n){if(null!==e&&d.hostCollection.length>0){var s=d.hostCollection.findModelById(e),a=s?s.get(i.NAME):"",o=n[i.HYPERVISOR_TYPE],l=a;return!o&&n[i.VM_ACROPOLIS_VM]&&c.hasKVM(u.getCurrentClusterUuid())&&(o=r.HYPERVISOR_TYPE.KVM),o&&(l+="/"+r.HYPERVISOR_LABEL[o]),l}return""}},{sTitle:"IP Addresses",mData:i.VM_IP_ADDRESSES,sortKey:i.VM_ARITHMOS_IP_ADDRESSES,searchId:i.VM_ARITHMOS_IP_ADDRESSES,sWidth:"5%",sClass:"vm-ip-address",tmplHover:p,mRender:function(e,t,i){if(e&&e.length){if(t===r.TABLE_COL_TYPE_DISPLAY){return d.renderHoverCell(e[0])}return _.map(e,function(e){return e}).join(" | ")}return""}},{sTitle:"Cores",sWidth:"4%",mData:i.VM_NUM_VCPUS,searchId:"num_vcpus",sClass:"right",sortKey:"num_vcpus"},{sTitle:"Memory Capacity",mData:i.VM_MEM_CAPACITY,sWidth:"8%",sClass:"right",bSearchable:!1,sortKey:"memory_size_bytes",mRender:t.renderStorageBinaryStats},{sTitle:"Storage",sWidth:"9%",mData:function(e,t,n){if(t===r.TABLE_COL_TYPE_DISPLAY||t===r.TABLE_COL_TYPE_EXPORT){var s=e[i.STATS][i.STATS_CONTROLLER_USER_BYTES];return(s=parseInt(s,10)===r.STATS_NO_VALUE?r.STATS_NOT_AVAILABLE:l.storageFormat(s))+" / "+l.storageFormat(e[i.VM_DISK_CAPACITY])}return r.STATS_NOT_AVAILABLE},sortKey:i.STATS_CONTROLLER_USER_BYTES,bSearchable:!1,sClass:"right"},{sTitle:"CPU Usage",mData:i.STATS+"."+i.STATS_HYP_CPU_USAGE,sWidth:"5%",sClass:"right",bSearchable:!1,sortKey:i.STATS_HYP_CPU_USAGE,mRender:function(e,n,s){return t.renderStatsValue(i.STATS_HYP_CPU_USAGE,e,n,s)}}],g=i.STATS_MEMORY_USAGE,S=u.getCurrentClusterUuid();return!u.isMulticlusterNavMode()&&!l.isVMMemoryMetricSupported(g,S)||E.push({sTitle:s?'Memory Usage <span style="display:none" class="n-info-icon controller-info">i</span>':"Memory Usage",mData:i.STATS+"."+g,sWidth:"5%",sClass:"right",bSearchable:!1,sortKey:g,mRender:function(e,n,s){var a=s&&s[i.HYPERVISOR_TYPE];return l.isVMMemoryMetricSupported(g,s.clusterUuid,a)?t.renderStatsValue(g,e,n,s):d.i18nStatic("Common","n_a")}}),E.push({sTitle:this.getVMStatTitle("Read IOPS"),mData:i.STATS+"."+i.STATS_CONTROLLER_NUM_READ_IOPS,sWidth:"7%",sClass:"right",sType:"numeric",bSearchable:!1,sortKey:i.STATS_CONTROLLER_NUM_READ_IOPS,mRender:function(e,t,n){var s=i.STATS_CONTROLLER_NUM_READ_IOPS;return d.renderVMStatsValue(s,e,t,n,!1)}},{sTitle:this.getVMStatTitle("Write IOPS"),mData:i.STATS+"."+i.STATS_CONTROLLER_NUM_WRITE_IOPS,sWidth:"7%",sClass:"right",sType:"numeric",bSearchable:!1,sortKey:i.STATS_CONTROLLER_NUM_WRITE_IOPS,mRender:function(e,t,n){var s=i.STATS_CONTROLLER_NUM_WRITE_IOPS;return d.renderVMStatsValue(s,e,t,n,!1)}},{sTitle:this.getVMStatTitle("IO Bandwidth"),mData:i.STATS+"."+i.STATS_CONTROLLER_BANDWIDTH,sWidth:"9%",sClass:"right",sType:"numeric",bSearchable:!1,sortKey:i.STATS_CONTROLLER_BANDWIDTH,mRender:function(e,t,n){var s=i.STATS_CONTROLLER_BANDWIDTH;return d.renderVMStatsValue(s,e,t,n)}},{sTitle:this.getVMStatTitle("Avg IO Latency"),mData:i.STATS+"."+i.STATS_CONTROLLER_AVG_IO_LATENCY,sWidth:"9%",sClass:"right",sType:"numeric",bSearchable:!1,sortKey:i.STATS_CONTROLLER_AVG_IO_LATENCY,mRender:function(e,t,n){var s=i.STATS_CONTROLLER_AVG_IO_LATENCY;return d.renderVMStatsValue(s,e,t,n)}},{sTitle:t.renderEllipsedText("Backup and Recovery Capable"),mData:function(e,t,n){return!0===e[i.VM_RUNNING_ON_NDFS]?r.LABEL_YES:!1===e[i.VM_RUNNING_ON_NDFS]?r.LABEL_NO:""},sWidth:"5%",bSearchable:!1,sortKey:i.VM_IS_CBR_CAPABLE,tmplHover:h,mRender:function(e,t,n){return t===r.TABLE_COL_TYPE_DISPLAY&&e===r.LABEL_NO?n[i.VM_NON_NDFS_DETAILS]?d.renderHoverCell(T,n[i.ID]):r.LABEL_NO:e}},{sTitle:"Flash Mode",sWidth:"5%",bSortable:!1,mData:function(e,t,n){return(e[i.VM_FEATURES]||{})[i.VM_FLASH_MODE]?r.LABEL_YES:r.LABEL_NO},sClass:"left",bSearchable:!1}),E},getOptions:function(){return{data:this.getFilter(),traditional:!0}},onFilterChange:function(t){a.hasLocalStorage()&&(localStorage[r.LOCAL_STORAGE.SHOW_CVM]=t),this.pageOptionsObject&&"true"===this.pageOptionsObject[r.NAV_ACTION_SPOTLIGHT]?this.onClearClicked(t):e.prototype.onFilterChange.apply(this,arguments)},onDataChange:function(){var t=this;this.$(".controller-info").is(":visible")||(this.$(".controller-info").show(),this.$(".controller-info").tooltip({title:function(){return t.NOT_SUPPORTED_MESSAGE},placement:"bottom",trigger:"hover",html:!1})),e.prototype.onDataChange.apply(this,arguments)},destroy:function(){e.prototype.destroy.apply(this,arguments),this.$(".controller-info").tooltip("destroy"),this.hostCollection.off("all")},displayFilterForEntity:function(){return!0},renderVMStatsValue:function(e,i,n,s,a){return n===r.TABLE_COL_TYPE_SORT?parseInt(i,10):this.clusterManager.isMulticlusterNavMode()?r.STATS_NOT_APPLICABLE:t.renderStatsValue(e,i,n,s,a)},getVMStatTitle:function(e){return this.CONTROLLER_LABEL+" "+e},getSearchAttributeList:function(){var t=e.prototype.getSearchAttributeList.apply(this,arguments)||[];return t.push(r.SPOTLIGHT_FN_VM_UUID),t},processLocalFilter:function(e){var t=["is_control_domain!=1"];return!1===e[i.VM_CONTROLLER_VM]&&(t.push(i.VM_IS_CVM+"=="+r.FILTER_NOT_INCLUDE_CVM),delete e[i.VM_CONTROLLER_VM]),t.length?this.model.setFilterCriteria(t.join(";")):this.model.setFilterCriteria(null),e},getHoverPlacement:function(t){return t.tmplHover===h?"left":t.tmplHover===p?"right":e.prototype.getHoverPlacement.apply(this,arguments)},onDblClickDataRow:function(e){var t=$(e.currentTarget).attr(r.NAV_ACTION_TARGET_ID);if(t){var n=this.model.findModelById(t);if(n&&(!n||o.isVmActionSupportedOnCurrentCluster(r.ACTION_UPDATE,n))){var s={};s[r.NAV_ACTION]=r.ACTION_UPDATE,s[r.NAV_ACTION_TARGET]=r.ENTITY_VM,s[r.NAV_ACTION_TARGET_ID]=n.get(i.UUID),d.executeAction(s)}}},updateSelection:function(t){t&&t[r.NAV_ACTION_TARGET_ID]&&"true"===t[r.NAV_ACTION_SPOTLIGHT]&&(this.$('input[data-filter="controllerVm"]').prop("checked",!0),a.hasLocalStorage()&&(localStorage[r.LOCAL_STORAGE.SHOW_CVM]=!0)),e.prototype.updateSelection.call(this,t)}})}),define("models/encryption/EncryptionStateModel",["models/BaseModel","data/DataURLConstants","utils/AppConstants"],function(e,t,i){"use strict";return e.extend({urlRoot:t.CURRENT_ENCRYPT_STATUS,entityType:i.ENTITY_ENCRYPTION,name:"EncryptionStateModel",state:null,initialize:function(t){e.prototype.initialize.apply(this,arguments),this.state={isEncryptionOn:null,isSEDProtectionOn:null,isSoftwareEncryptionOn:null,softwareEncryptionScope:null,isReadyForPasswordProtection:null,isReadyForSoftwareEncryption:null}},updateEncryptionState:function(e){e&&e.softwareEncryptionScope&&(e.softwareEncryptionScope===i.ENCRYPTION_PROP.SE_SCOPE_STORAGE_CONTAINER||e.softwareEncryptionScope===i.ENCRYPTION_PROP.SE_SCOPE_CLUSTER)?(this.state.isEncryptionOn=!0,this.state.isSoftwareEncryptionOn=!0,this.state.softwareEncryptionScope=e.softwareEncryptionScope):e.desiredPasswordProtection&&(this.state.isEncryptionOn=!0,this.state.isSEDProtectionOn=!0)},getSoftwareEncryptionScope:function(){return this.state.softwareEncryptionScope},isSoftwareEncryptionOn:function(){return this.state.isSoftwareEncryptionOn},parse:function(e,t){this.currentEncryptionState=e.desiredPasswordProtection,this.diskEncryptionStatus=e.diskEncryptionStatus,this.isReadyForPasswordProtection=e.isReadyForPasswordProtection,this.isReadyForSoftwareEncryption=e.isReadyForSoftwareEncryption,this.state.diskEncryptionStatus=e.diskEncryptionStatus,this.state.isReadyForPasswordProtection=e.isReadyForPasswordProtection,this.state.isReadyForSoftwareEncryption=e.isReadyForSoftwareEncryption,this.updateEncryptionState(e)}})}),define("views/basecomponents/datatables/storage/StorageTableView",["views/basecomponents/datatables/BaseTableView","views/basecomponents/datatables/BasePaginateTableView","views/basecomponents/datatables/DataTableColumnProvider","data/DataProperties","models/encryption/EncryptionStateModel","utils/AppConstants","utils/HypervisorUtil","utils/TooltipContent","utils/ManagerMixin","managers/ActionManager","managers/ClusterManager"],function(e,t,i,n,s,a,r,o,l,c,d){"use strict";var u=_.template('<%= title %> <span style="display:none" ntnxTooltip="<%= tooltipId %>" class="storage-info"></span>'),h=_.template('<a ntnxTooltip="<%= tooltipId %>" class="n-storage-stats-link"><%= value %></a>'),p=_.template('<span class="donut-loader-blue n-encryption-in-progress <%= extra %>"></span><%= progress %>'),T=function(){},E={name:"StorageTableView",encryptionStateModel:null,initialize:function(e){this.isEncryptionFetchEnabled()&&(this.encryptionStateModel=new s),_.bindAll(this,"onDataChange"),T.prototype.initialize.apply(this,arguments),this.addExtraEvents({"mouseover a.n-storage-stats-link":"onStorageStatsMouseOver","mouseout  a.n-storage-stats-link":"onStorageStatsMouseOut","dblclick .baseDataTable tbody tr":"onDblClickDataRow"})},onStartServices:function(){T.prototype.onStartServices.apply(this,arguments),this.isEncryptionFetchEnabled()&&l.getTaskManager().registerHandlerForChangedTasks(this.onDataChange)},onStopServices:function(){T.prototype.onStopServices.apply(this,arguments),this.isEncryptionFetchEnabled()&&l.getTaskManager().unregisterHandlerForChangedTasks(this.onDataChange)},isEncryptionFetchEnabled:function(){return!r.hasKVMOnly()&&this.options.entityType===a.ENTITY_CONTAINER},_renderDataTable:function(){var e=this,t=arguments;this.isEncryptionFetchEnabled()?this.encryptionStateModel.fetch({alwaysTriggerChange:!0}).always(function(i){e.initializeDataTableSettings(),T.prototype._renderDataTable.apply(e,t),e.model.getState()===a.STATE_SUCCESS&&e.onDataChange()}):T.prototype._renderDataTable.apply(this,arguments)},getDefaultColumns:function(e,t){var s=this,a=i.getDataColumns(e,t);return this.encryptionStateModel&&this.encryptionStateModel.isSoftwareEncryptionOn()&&(a=i.appendColumn(a,{sTitle:this.i18n("encrypted"),mData:n.ENCRYPTION_STATUS,sortKey:n.CTR_ENCRYPTED,sWidth:"6%",mRender:function(e,t,i){return s.renderEncryptionStatus(e,t,i)}},6,!1,1)),_.each(a,function(e){var t=this,i=e.ntnxTooltip;if(i&&(e.sTitle=u({tooltipId:i,title:e.sTitle}),_.isFunction(e.mData))){var n=e.mData;e.mData=function(e,s,a){var r=n(e,s,a);return t.getStorageStatsCellWrapper(r,i,s)}}},this),a},onDataChange:function(){this.dataTable&&(this.$(".storage-info").is(":visible")||(this.$(".storage-info").show(),this.$(".storage-info").each(function(){var e=$(this),t=e.attr("ntnxTooltip");e.nutanixMoreInfo({classes:["-nudge-up"],title:o.getStorageStatsInfo(t)})})),this.$(".n-storage-stats-link").tooltip("destroy"),T.prototype.onDataChange.apply(this,arguments),this.$(".load-encryption-status").length&&l.getTaskManager().fetchOnDemand())},destroy:function(){this.$(".storage-info").nutanixMoreInfo("destroy"),this.$(".n-storage-stats-link").tooltip("destroy"),T.prototype.destroy.apply(this,arguments)},getStorageStatsCellWrapper:function(e,t,i){return e===a.STATS_NOT_AVAILABLE?e:i===a.TABLE_COL_TYPE_DISPLAY?h({tooltipId:t,value:e}):e},onStorageStatsMouseOver:function(e){var t=$(e.currentTarget),i=t.attr("ntnxTooltip"),n=t.closest("tr").attr(a.NAV_ACTION_TARGET_ID),s=this.model.get(n),r=o.getStorageStatsBreakdown(i,s);t.tooltip({title:r,placement:"top",trigger:"manual",html:!0,container:$("body")}),t.tooltip("show")},onStorageStatsMouseOut:function(e){$(e.currentTarget).tooltip("destroy")},onDblClickDataRow:function(e){var t=$(e.currentTarget).attr(a.NAV_ACTION_TARGET),i=$(e.currentTarget).attr(a.NAV_ACTION_TARGET_ID),n={};n[a.NAV_ACTION]=a.ACTION_UPDATE,n[a.NAV_ACTION_TARGET]=t,n[a.NAV_ACTION_TARGET_ID]=i,c.executeAction(n)},renderEncryptionStatus:function(e,t,i){var s=e,r=i[n.ENCRYPTION_PROGRESS];if(r){var o="";if(r===a.DATA_NOT_AVAILABLE?o="load-encryption-status":s=e+" ("+r+")",t===a.TABLE_COL_TYPE_DISPLAY)return p({progress:s,extra:o})}return s}};return T=d.isClusterFFEnabled(a.FFLAGS.SUPPORT_PAGINATION)?_.extend(t):_.extend(e),T.extend(E)}),define("views/basecomponents/datatables/fileserver/FileServerTableView",["views/basecomponents/datatables/BaseTableView","views/basecomponents/datatables/DataTableColumnProvider","utils/TooltipContent","utils/AppConstants","utils/FileServerUtil","managers/ActionManager"],function(e,t,i,n,s,a){"use strict";var r=_.template('<%= title %> <span style="display:none" ntnxTooltip="<%= tooltipId %>" class="fs-info">i</span>');return e.extend({initialize:function(t){e.prototype.initialize.apply(this,arguments),this.addExtraEvents({"click .fs-recommendation a":"onClickRecommendation"})},getDefaultColumns:function(e,i){var n=t.getDataColumns(e,i);return _.each(n,function(e){var t=e.ntnxTooltip;t&&(e.sTitle=r({tooltipId:t,title:e.sTitle}))},this),n},onDataChange:function(){var t=this.$(".fs-info");if(!t.is(":visible")){t.show();t.each(function(){var e=$(this),t=e.attr("ntnxTooltip");e.nutanixMoreInfo({classes:["-nudge-up"],title:i.getStorageStatsInfo(t)})})}e.prototype.onDataChange.apply(this,arguments),this.$(".home-tooltip").tooltip({placement:"right",trigger:"hover",html:!1}),this.updatePageActions()},updatePageActions:function(){var e=$('.btnPageAction[action = "'+n.DEPLOY_FILE_INSIGHTS+'"]');if(this.model&&this.model.models.length){var t=!1;this.model.models.find(function(e){return t=s.compareAFSversion(e,n.FILE_SERVER_VERSIONS.THREE_DOT_FIVE)>=0}),t?e.show():e.hide()}else e.hide()},destroy:function(){this.$(".fs-info").nutanixMoreInfo("destroy"),this.$(".home-tooltip").tooltip("destroy"),e.prototype.destroy.apply(this,arguments)},onClickRecommendation:function(e){e.stopPropagation(),a.executeActionElement(e.currentTarget)},_dataTableRowCallback:function(t,i,s){e.prototype._dataTableRowCallback.apply(this,arguments),this.getActionTarget()===n.ENTITY_SHARE&&$(t).attr(n.NAV_ACTION_PARENT_ENTITY_TYPE,n.ENTITY_FILE_SERVER).attr(n.NAV_ACTION_PARENT_ID,i.fileServerUuid)}})}),define("views/basecomponents/datatables/hardware/HardwareBaseTableViewMixin",["utils/AppConstants"],function(e){"use strict";return{tBody:null,onDataChange:function(e){this._baseView.onDataChange.apply(this,arguments);var t=this.model.models;t.length>0&&this.disableDetachabledModels(t)},disableDetachabledModels:function(e){var t=this.getTableEntityIdsHash();_.each(e,function(e){var i=e.get(e.idAttribute);t.hasOwnProperty(i)&&e.isDetachable()&&this.disableTableRow(t[i])},this)},getTableEntityIdsHash:function(){var t={};return this.$getTableBody().find("tr").each(function(){var i=$(this);t[i.attr(e.NAV_ACTION_TARGET_ID)]=i}),t},disableTableRow:function(e){e.length>0&&e.removeClass("row_selected").removeAttr("action").removeAttr("actionTargetName").removeAttr("actiontargetid").removeAttr("actiontarget").addClass("row-disabled")},$getTableBody:function(){return _.isNull(this.tBody)&&(this.tBody=this.$(".baseDataTable > tbody")),this.tBody},$getModelRow:function(t){return this.$("tr["+e.NAV_ACTION_TARGET_ID+'="'+t.get(t.idAttribute)+'"]',this.$getTableBody())}}}),define("views/basecomponents/datatables/hardware/HostTab/HardwareHostTableViewMixin",["views/basecomponents/datatables/hardware/HardwareBaseTableViewMixin","data/DataProperties"],function(e,t){"use strict";var i={getTableRowByTargetId:function(e){var t=this._baseView.getTableRowByTargetId.call(this,e);if(t.length>0)return t;var i=this.getServiceVMIdByUUID(e);return this._baseView.getTableRowByTargetId.call(this,i)},getServiceVMIdByUUID:function(e){var i=this.model.toJSON();for(var n in i)if(i[n][t.UUID]===e)return i[n][t.SERVICE_VM_ID]}};return _.extend({},e,i)}),define("views/basecomponents/datatables/hardware/HostTab/HardwareHostPaginateTableView",["views/basecomponents/datatables/BasePaginateTableView","views/basecomponents/datatables/hardware/HostTab/HardwareHostTableViewMixin"],function(e,t){"use strict";var i=_.extend({},t,{_baseView:e.prototype});return e.extend(i)}),define("views/basecomponents/datatables/hardware/HostTab/HardwareHostTableView",["views/basecomponents/datatables/BaseTableView","views/basecomponents/datatables/hardware/HostTab/HardwareHostTableViewMixin"],function(e,t){"use strict";var i=_.extend({},t,{_baseView:e.prototype});return e.extend(i)}),define("views/basecomponents/datatables/hardware/DiskTab/HardwareDiskTableViewMixin",["views/basecomponents/datatables/hardware/HardwareBaseTableViewMixin"],function(e){"use strict";return _.extend({},e)}),define("views/basecomponents/datatables/hardware/DiskTab/HardwareDiskPaginateTableView",["views/basecomponents/datatables/BasePaginateTableView","views/basecomponents/datatables/hardware/DiskTab/HardwareDiskTableViewMixin","managers/ActionManager"],function(e,t,i){"use strict";var n=_.extend({},t,{_baseView:e.prototype}),s=_.template('\n      <tr class="empty-row row_blank">\n        <td class="link-warpper text-center" colspan="<%= numberColumns %>">\n          <a class="missingLink" actionTarget="nvme_drive">\n            <%= i18n("missing_nvme_drive")%></a>\n        </td>\n      </tr>\n    ');return e.extend(_.extend({},n,{name:"HardwareDiskPaginateTableView",initialize:function(t){e.prototype.initialize.apply(this,arguments),this.addExtraEvents({"click .missingLink":"_onClickLinkAction"})},fnAddRows:function(t,i,n){if(e.prototype.fnAddRows.apply(this,arguments),this.model.hasNVMeDisk()){t.find("tbody tr").last().after(s(this.vtOptions({numberColumns:i})))}},_onClickLinkAction:function(e){i.executeActionElement(e.currentTarget)}}))}),define("views/basecomponents/datatables/hardware/DiskTab/HardwareDiskTableView",["views/basecomponents/datatables/BaseTableView","views/basecomponents/datatables/hardware/DiskTab/HardwareDiskTableViewMixin"],function(e,t){"use strict";var i=_.extend({},t,{_baseView:e.prototype});return e.extend(i)}),define("views/basecomponents/datatables/DataTableGroupView",["datatables","views/basecomponents/BaseView","views/basecomponents/datatables/DataTableTemplates","views/basecomponents/datatables/BasePaginateTableView","views/basecomponents/datatables/BaseTableView","views/basecomponents/datatables/vm/VMTableView","views/basecomponents/datatables/storage/StorageTableView","views/basecomponents/datatables/fileserver/FileServerTableView","views/basecomponents/datatables/hardware/HostTab/HardwareHostPaginateTableView","views/basecomponents/datatables/hardware/HostTab/HardwareHostTableView","views/basecomponents/datatables/hardware/DiskTab/HardwareDiskPaginateTableView","views/basecomponents/datatables/hardware/DiskTab/HardwareDiskTableView","managers/NavigationManager","managers/NamespaceManager","managers/LicenseManager","managers/ClusterManager","utils/AppConstants","utils/AppUtil","utils/HypervisorUtil","utils/SubViewHelper"],function(e,t,i,n,s,a,r,o,l,c,d,u,h,p,T,E,g,S,m,v){"use strict";var f={};return f[g.PAGE_STORAGE]=[g.ENTITY_CONTAINER,g.ENTITY_ACROPOLIS_VOLUME_GROUP,g.ENTITY_STORAGE_POOL],f[g.PAGE_VMS]=[g.ENTITY_VM],f[g.PAGE_HARDWARE]=[g.ENTITY_HOST,g.ENTITY_DISK],f[g.PAGE_ALERTS]=[g.ENTITY_ALERT,g.ENTITY_EVENT],
f.backup=[g.ENTITY_PROTECTION_DOMAIN,g.ENTITY_SNAPSHOT],f[g.PAGE_DR]=[g.ENTITY_ASYNC_PD,g.ENTITY_METRO_AVAILABILITY_PD,g.ENTITY_REMOTE_SITE],f[g.PAGE_MC_DASHBOARD]=[g.ENTITY_CLUSTER],f[g.PAGE_MC_HEALTH]=[g.ENTITY_MULTICLUSTER_HEALTH],f[g.PAGE_FILE_SERVER]=[g.ENTITY_FILE_SERVER,g.ENTITY_SHARE],t.extend({MAP_TABS:null,selectedEntity:null,_uid:null,subViewHelper:null,eventBus:null,isStoragePage:null,events:{"click  .tableGrpHeader  .buttonTab":"onClickTab"},initialize:function(e){t.prototype.initialize.apply(this,arguments),this._uid="datatable"+this.cid+(new Date).getTime(),this.eventBus=e.eventBus,this.isStoragePage=e&&e.pageId===g.PAGE_STORAGE,this.subViewHelper=new v,this.MAP_TABS=$.extend(!0,{},f),this.clusterManager.isMulticlusterNavMode()?this.MAP_TABS.alerts=[g.ENTITY_ALERT]:this.MAP_TABS.hardware.push(g.ENTITY_SWITCH),e.pageId===g.PAGE_DR&&(m.hasKVMOnly()||E.isOneOrTwoNodeCluster())&&(this.MAP_TABS.dr=_.without(this.MAP_TABS.dr,g.ENTITY_METRO_AVAILABILITY_PD)),T.canUseFeat("abs_internal")||(this.MAP_TABS[g.PAGE_STORAGE]=_.without(this.MAP_TABS[g.PAGE_STORAGE],g.ENTITY_ACROPOLIS_VOLUME_GROUP)),e&&e.pageId&&this.MAP_TABS[e.pageId]&&this.render()},render:function(){this.$el.empty();var e,t=this.options.pageId,n=this.MAP_TABS[t];this.$el.append(i.TABLE_GRP_HEADER),this.getDOM(".tableGrpHeader").show(),this.$el.append(i.TABLE_GRP_BODY);for(var s,a,r=0;r<n.length;r++)if(e=n[r],a=n[r],s=e+this._uid,e===g.ENTITY_SHARE&&(a=g.ENTITY_SHARE_EXPORT),this.canViewByEntityType(e)){var o=i.ENTITY_TAB({domID:s,entity:e,entityName:g.ENTITY_NAMES[a]});this.getDOM(".tableGrpHeader").append(o),this.subViewHelper.register(e,this.createBaseTableView(s,e,t)),this.getDOM(".tableGrpBody").append(this.subViewHelper.get(e).render().el)}},getHostEntityTableView:function(e){return this.clusterManager.isClusterFFEnabled(g.FFLAGS.SUPPORT_PAGINATION)?new l(e):new c(e)},getDiskEntityTableView:function(e){return this.clusterManager.isClusterFFEnabled(g.FFLAGS.SUPPORT_PAGINATION)?new d(e):new u(e)},createBaseTableView:function(e,t,i){var l={id:e,entityType:t,eventBus:this.eventBus,pageId:i,enableDefaultTableFilter:!0};switch(t){case g.ENTITY_VM:return new a(l);case g.ENTITY_SWITCH:return new s(l);case g.ENTITY_DISK:return this.getDiskEntityTableView(l);case g.ENTITY_HOST:return this.getHostEntityTableView(l);case g.ENTITY_ALERT:case g.ENTITY_EVENT:return this.clusterManager.isClusterFFEnabled(g.FFLAGS.SUPPORT_PAGINATION)?(l.enableDefaultTableFilter=!1,new n(l)):new s(l);case g.ENTITY_CONTAINER:case g.ENTITY_STORAGE_POOL:case g.ENTITY_ACROPOLIS_VOLUME_GROUP:return new r(l);case g.ENTITY_FILE_SERVER:case g.ENTITY_SHARE:return new o(l);default:return new s(l)}},show:function(e){var t,i,n,s;if(!this.isValidForUpdate(e))return void(this.subViewHelper.get(this.currentEntityType())&&this.subViewHelper.get(this.currentEntityType()).updateSelection(this.getOptionsObject()));if(this.parseOptions(e),t=this.getOptionsObject(),this.isStoragePage&&(n=p.get(p.USER_SETTINGS),i=n.getUserSetting(g.LOCAL_STORAGE.STORAGE_TABLE_TAB)),s=t&&t.actionTarget||i||this.selectedEntity||this.$(".tableGrpHeader  a:first").attr(g.NAV_ACTION_TARGET),this.isStoragePage)switch(s){case g.ENTITY_ACROPOLIS_VOLUME_GROUP:case g.ENTITY_CONTAINER:n.setUserSetting(g.LOCAL_STORAGE.STORAGE_TABLE_TAB,s)}this.showTab(s)},showTab:function(e){if(_.each(this.subViewHelper.getIds(),function(t){t===e?(this.$('.tableGrpHeader a[data-target="#'+t+this._uid+'"]').tab("show"),this.subViewHelper.get(t).startServices(),this.subViewHelper.get(t).updateSelection(this.getOptionsObject()),this.selectedEntity=e):this.subViewHelper.get(t).stopServices()},this),this.updateTabAttributes(),this.eventBus){var t={};t[g.NAV_ACTION_TARGET]=e,t[g.NAV_ACTION_TARGET_ID]=g.ACTION_SUMMARY,this.eventBus.trigger("showTab",t)}},updateTabAttributes:function(){var e=g.ACTION_DETAILS,t=this.selectedEntity,i=this.currentEntityId(),n=this.currentEntityName(),s=this.$('.tableGrpHeader a[data-target="#'+t+this._uid+'"]');i?(s.attr(g.NAV_ACTION_TARGET_ID,i),s.attr(g.NAV_ACTION,e)):(s.removeAttr(g.NAV_ACTION),s.removeAttr(g.NAV_ACTION_TARGET_ID)),n&&s.attr(g.NAV_ACTION_TARGET_NAME,n),i===g.ACTION_SUMMARY&&s.removeAttr(g.NAV_ACTION_TARGET_NAME)},destroy:function(){S.debug("DataTableGroupView : destroy: "," | viewid     : "+this.cid),this.subViewHelper.removeAll(),this.subViewHelper=null,t.prototype.destroy.apply(this,arguments)},onClickTab:function(e){h.updateRouteOption(e.currentTarget)},refreshView:function(){this.subViewHelper.get(this.selectedEntity)&&this.subViewHelper.get(this.selectedEntity).refreshData(this.getOptionsObject())},onStartServices:function(){this.delegateEvents(),this.subViewHelper.get(this.selectedEntity)&&this.subViewHelper.get(this.selectedEntity).startServices()},onStopServices:function(){this.undelegateEvents(),this.subViewHelper.iterate("stopServices")}})}),define("views/pages/vms/VMsPageView",["views/basecomponents/pages/BasePageView","views/pages/vms/details/VMTabDetailsView","views/basecomponents/vantagepoints/DashboardView","views/basecomponents/datatables/DataTableGroupView","managers/acropolis/AcropolisNetworkManager","managers/TaskManager","events/AppEvents","data/DataProperties","utils/AppConstants"],function(e,t,i,n,s,a,r,o,l){"use strict";return e.extend({pageId:l.PAGE_VMS,defaultSubPageId:l.SUBPAGE_PERSPECTIVE,eventBus:null,initialize:function(t){e.prototype.initialize.apply(this,arguments),this.eventBus=t.eventBus||_.extend({},Backbone.Events),this.isMulticlusterPageUuid()&&(this.defaultSubPageId=l.SUBPAGE_TABLE)},onStartServices:function(){s.startServices(),this.eventBus.on(r.TABLE_FILTER_RESET,this.onTableFilterReset,this),a.registerHandlerForChangedTasks(this.onVmTaskComplete,this),e.prototype.onStartServices.apply(this,arguments)},onStopServices:function(){s.stopServices(),this.eventBus.off(r.TABLE_FILTER_RESET,this.onTableFilterReset,this),a.unregisterHandlerForChangedTasks(this.onVmTaskComplete,this),e.prototype.onStopServices.apply(this,arguments)},onTableFilterReset:function(){this.subViewHelper.iterate("setOptionsObject",null),this.subViewHelper.iterate("refreshView")},onShowSubPage:function(e,t){var s=this.getSubView(e);switch(e){case l.SUBPAGE_PERSPECTIVE:s||(s=this.registerSubView(e,new i({el:this.getSubPageElement(e),dashboard:l.PERSPECTIVE_VM})));break;case l.SUBPAGE_TABLE:s||(s=this.registerSubView(e,new n({el:this.getSubPageElement(e),eventBus:this.eventBus,pageId:l.PAGE_VMS})))}s&&s.show(t)},onChangeDetailsPane:function(e){var i=this.getSubView(l.SUBPAGE_COMPONENT_DETAILS);i?i.stopServices():i=this.registerSubView(l.SUBPAGE_COMPONENT_DETAILS,new t({el:this.getDetailsElement()})),i.show(e)},onVmTaskComplete:function(e){if(e.find(function(e){return(e.get(o.TASK_ENTITY_TYPE)||[])[0]===l.ENTITY_VM&&e.isStatusComplete()},this)){var t=this.subViewHelper.get(l.SUBPAGE_COMPONENT_DETAILS),i=this.subViewHelper.get(l.SUBPAGE_TABLE);t&&t.refreshView(),i&&i.refreshView()}}})}),define("views/basecomponents/diagrams/BaseDiagramView",["backbone","views/basecomponents/BaseView","utils/AppUtil"],function(e,t,i){"use strict";return t.extend({events:{},initialize:function(e){t.prototype.initialize.apply(this,arguments)},show:function(e){},applySelection:function(){},destroy:function(){i.debug("BaseDiagramView  | destroy | ",this.cid),t.prototype.destroy.apply(this,arguments)}})}),define("views/pages/storage/common/StorageCommon",["utils/AppUtil"],function(e){"use strict";return{minUsagePercent:1,slideDuration:150,maxPercentWidth:98.7,uniqueColors:4,maxStoragePoolPopoverRows:4,maxContainerPopoverRows:10,templatePopoverStoragePoolBody:_.template('<div>Storage Pool: <span class="n-popover-value n-popover-details-top  <%= nameLongClass %>" title="<%= name %>" alt="<%= name %>"><%= name %></span></div><div>Real usage: <span class="n-popover-value"><%= realUsed %></span></div><div>Thick provisioned (not used): <span class="n-popover-value"><%= thickButNotUsed %></span></div><div>Reserved (not used): <span class="n-popover-value"><%= reservedButNotUsed %></span></div><hr noshade><div>Physical usage: <span class="n-popover-value"><%= size %></span></div>'),templatePopoverContainerBody:_.template('<div>Storage Container: <span class="n-popover-value n-popover-details-top" title="<%= name %>" alt="<%= name %>"><%= name %></span></div><div>Real usage: <span class="n-popover-value"><%= realUsed %></span></div><div>Thick provisioned (not used): <span class="n-popover-value"><%= freeReserved %></span></div><hr noshade><div>Phyiscal usage: <span class="n-popover-value"><%= size %></span></div>'),templateUnused:_.template('This <%= entityType %> has <span class="n-unused-link"><%= count %> <%= sectionEntityType %>(s) using no space.</span><a><i aria-hidden="true" data-icon="B"></i></a>'),templateUnusedTitle:_.template("Unused <%= sectionEntityType %>(s):"),templateUnusedBody:_.template("<div><%= name %></div>"),templateUnallocatedDisks:_.template('<div id="stDiagramPopoverArrow" class="arrow"></div><div id="stDiagramPopoverContent" class="popover-content">There are disks that are not yet part of the cluster. Would you like to \x3c!-- Option 1) Add disk to new storage pool  --\x3e<a id="stDiagramBtnAllocateDisk" class="btnAllocateDisk"action="create" actionTarget="storage_pool">create a new storage pool</a><% if (hasStoragePools) { %>\x3c!-- Option 2) Add disks to existing storage pool(s) --\x3e<div>or add them to an existing storage pool:&nbsp;<ul id="stDiagramGrpAllocateSP"class="grpAllocateSP">\x3c!-- @view: storage pool names go here... --\x3e</ul></div><% } %></div>'),getModelByEntityId:function(e,t){return _.find(t.models,function(t){return t.get(t.idAttribute)==e})},popover:function(t){var i=($(t.el).position(),_.template('<div class="n-popover" style="display:none;"><% if (typeof title !== "undefined") { %><div class="n-popover-title"><%= title %></div><% } %><div class="n-popover-body"><%= body %></div><div class="n-popover-caret"></div></div>')),n=function(){$(t.el).append(i(t));var n=$(t.el).find(".n-popover"),s=$(t.el).find(".n-popover-caret"),a=$(t.el).closest(".n-chart-bar-horizontal"),r=e.getHiddenElementDimensions(n),o=(n.width()-s.outerWidth())/2,l=($(t.el).width()-n.width())/2,c=l;$(t.el).offset().left+l<a.offset().left?(l=-1*($(t.el).offset().left-a.offset().left),o-=l-c):$(t.el).offset().left+l+n.width()>a.offset().left+a.outerWidth()&&(l=a.offset().left+a.outerWidth()-n.width()-$(t.el).offset().left,o-=l-c),n.css("left",l+"px").css("bottom","-"+(r.height+22)+"px"),s.css("left",o+"px").css("bottom",r.height+10+"px"),n.show()},s=function(){$(t.el).find(".n-popover").remove()};t.trigger&&"hover"!==t.trigger?"click"===t.trigger&&($(t.el).off("click"),t.el&&$(t.el).on("click",function(e){$(t.el).find(".n-popover").length?s():n()})):($(t.el).off("mouseenter").off("mouseleave"),t.el&&$(t.el).hover(function(){n()},function(){s()})),$(t.el).find(".n-popover").length&&n()}}}),define("text!templates/pages/storage/diagram/StorageDiagramView.html",[],function(){return'<div id="stDiagramBarHorizontal" class="n-chart-bar-horizontal">\n  \x3c!-- style="margin:0 auto; padding:0"> --\x3e\n  <span class="n-loading" style="">\n    <span class="n-loading-text">Loading data...&nbsp;</span>\n    <div class="donut-loader-blue"></div>\n  </span>\n\n  \x3c!-- Cluster Bar View --\x3e\n  <div id="stDiagramColGroup"\n    class="btnStorageOptionAction n-cluster-col-group n-bar-highlight"\n    action="details" actionTargetId="summary">\n  </div>\n\n  \x3c!-- Storage Pool Bar View --\x3e\n  <div id="stDiagramGroupStorageEntityHolder"\n    class="grpEntityHolder n-group-storage-entity-holder">\n    \x3c!-- Storage Pools Row --\x3e\n    <div class="grpStorageEntities  n-storage-entities-group bar-wrapper"\n      style="display:none;">\n    </div>\n  </div>\n\n  \x3c!-- Container Bar View --\x3e\n  <div class="grpContainer  n-container-group bar-wrapper"\n    style="display:none;">\n  </div>\n</div>'}),define("text!templates/pages/storage/diagram/StorageDiagramBarView.html",[],function(){return'\x3c!-- Individual Bar Views --\x3e\n<div>\n  <div class="n-title" style="padding-bottom: 15px;">\n    <span class="n-title-entity"><%= displayEntityType %></span>\n    <% if (navAttrs) { %>\n      <a <%= navAttrs %>><%= entityName %></a>\n    <% } %>\n    <span style="padding: 0 3px;">\n      <strong id="n-physical-used"><%= physicalUsed %></strong>\n      used of\n      <strong id="n-max-capacity"><%= maxCapacity %></strong>\n      <% if (entityType === appConstants.ENTITY_CONTAINER) { %>\n        capacity (<span id="n-ctr-state">Physical</span>)\n      <% } else { %>\n        provisioned.\n      <% } %>\n      <% if (entityType === appConstants.ENTITY_CLUSTER) { %>\n        <span id="stDiagramUnallocated"\n            class="n-cluster-unallocated" style="margin-left:50px;\n            display:none;">\n            There are unallocated disks.\n            <i id="stDiagramBtnAllocateIcon"\n              class="btnAllocateIcon  icon-hdd"></i>\n                      <a id="stDiagramPopMarkerUnallocated" rel="popover"\n                 class="popMarkerUnallocated\n                        n-round-bg-link  n-info">?</a>\n        </span>\n      <% } %>\n    </span>\n\n    \x3c!-- Action buttons --\x3e\n    <% if (entityType !== appConstants.ENTITY_CLUSTER) { %>\n    <div class="titlebar-inline-action-buttons">\n      <% if (canModify) { %>\n        \x3c!-- Button update --\x3e\n        <a class="btnEntityAction"\n          action="update"\n          actionTarget="<%= entityType %>"\n          actionTargetId="<%= entityId %>"\n          actionTargetName="<%= entityName %>"\n          title="Update <%= entityName %>">\n          <i aria-hidden="true" data-icon="F"></i>\n        </a>\n        <span class="n-sep">&middot;</span>\n        \x3c!-- Button delete --\x3e\n        <a class="btnEntityAction"\n          action="delete"\n          actionTarget="<%= entityType %>"\n          actionTargetId="<%= entityId %>"\n          actionTargetName="<%= entityName %>"\n          title="Delete <%= entityName %>">\n          <i aria-hidden="true" data-icon="v"></i>\n        </a>\n      <% } %>\n    </div>\n    <% } %>\n    <div class="n-lbl-right">\n      <% if (entityType !== appConstants.ENTITY_CONTAINER) { %>\n        <span id="stDiagramLblRawUsable"\n          class="lblRawUsable n-bar-value"></span>\n        <span id="stDiagramBarLabel"\n           class="n-bar-label">Available (Physical)</span>\n      <% } %>\n      <% if (entityType === appConstants.ENTITY_CONTAINER) { %>\n        <a class="linkHideContainer n-btn-expand-hide">close</a>\n      <% } else if (entityType === appConstants.ENTITY_STORAGE_POOL) { %>\n        <a class="linkHideStoragePool n-btn-expand-hide">close</a>\n      <% } %>\n    </div>\n\n    \x3c!-- The container bar physical/logical toggle button. --\x3e\n    <% if (entityType === appConstants.ENTITY_CONTAINER) { %>\n      <div class="n-container-state" data-toggle="buttons-radio">\n        <a class="n-container-btn-physical active">\n          Physical\n        </a>\n        <a class="n-container-btn-logical">\n          Logical\n        </a>\n      </div>\n    <% } %>\n  </div>\n\n  \x3c!-- Progress bar wrapper. --\x3e\n  <div id="stDiagramBarMax"\n    class="barMax progress progress-info n-progress"\n    style="width:<%= maxPercentWidth %>%;">\n  </div>\n\n  \x3c!-- Wrapper for unused entities link. --\x3e\n  <% if (entityType !== appConstants.ENTITY_CONTAINER) { %>\n    <div id="stDiagramBarGrp" class="n-bar-grp">\n      <div class="n-unused"></div>\n    </div>\n  <% } %>\n</div>'}),define("views/pages/storage/diagram/StorageDiagramBarView",["views/basecomponents/BaseView","views/pages/storage/common/StorageCommon","text!templates/pages/storage/diagram/StorageDiagramBarView.html","utils/AppConstants","utils/AppUtil","utils/StatsUtil","data/DataProperties","events/AppEvents"],function(e,t,i,n,s,a,r,o){"use strict";var l=_.template(i),c=_.template('<div class="n-bar-entity-name"><%= name %></div>');return e.extend({subModelHelper:null,visibleSectionId:null,templateOptions:null,containerBarSpecs:null,initialize:function(){this.templateOptions={entityType:this.entityType,displayEntityType:n.ENTITY_NAMES[this.entityType]+":",navAttrs:null,canModify:!0,appConstants:n,physicalUsed:"",maxCapacity:"",entityId:"",entityName:"",maxPercentWidth:""},this.render(this.options.subModelHelper,this.options.visibleSectionId,this.options.model)},render:function(e,t,i){if(!e)throw new Error("StorageDiagramBarView: invalid subModelHelper value passed. Aborting Storage Diagram");this.subModelHelper=e,this.visibleSectionId=t,this.model=i,0===this.$el.children().length?(this.entityType!==n.ENTITY_CLUSTER&&this.updateInfo(),this.$el.html(l(this.templateOptions)),this.update(),this.showBar()):(this.subModelHelper.get(n.ENTITY_STORAGE_POOL)&&(this.entityType!==n.ENTITY_CLUSTER&&this.updateInfo(),this.$el.html(l(this.templateOptions))),this.update())},update:function(){var e=this.$(".barMax"),t=(this.$(".n-barUsage"),this.$(".barUnallocated"));this.barMaxWidth=$(e).width()-($(t).is(":visible")?$(t).width():0);var i=this.getModelsToRender();for(var n in i){var s=i[n];this._getSectionElementByModel(s)?this.updateSection(s):this.renderSection(s)}this.$(".lblClusterPhysicalUsedPercent").html("("+this.percentPhysicalUsed+")"),this.$(".lblClusterPhysicalUsed").html(a.storageFormat(this.totalPhysicalUsed)),this.$(".lblClusterProvisioned").html(a.storageFormat(this.availMaxCapacity)),this.$(".lblRawUsable").html(a.storageFormat(Math.max(0,this.availMaxCapacity-this.totalPhysicalUsed)))},updateInfo:function(){_.extend(this.templateOptions,{entityName:this.model.get(this.model.nameAttribute),entityId:this.model.get(this.model.idAttribute),navAttrs:s.convertNavModelToHTMLAttr(s.convertModelToNavItemModel(this.model,this.entityType,n.ACTION_DETAILS))})},destroy:function(){s.debug("StorageDiagramBarView  | destroy | ",this.cid),this.$(".bar").popover("destroy"),e.prototype.destroy.apply(this,arguments)},renderSection:function(e){var t=$("<div>").addClass("bar "+this.getColorClass(e)),i="";this.entityType===n.ENTITY_CLUSTER?i=n.ENTITY_STORAGE_POOL:this.entityType===n.ENTITY_STORAGE_POOL&&(i=n.ENTITY_CONTAINER),$(t).attr(n.NAV_ACTION_TARGET_ID,e.get(e.idAttribute)).attr(n.NAV_ACTION,n.ACTION_DETAILS).attr(n.NAV_ACTION_TARGET,i).attr(n.NAV_ACTION_TARGET_NAME,e.get(r.NAME)),this.$("#stDiagramBarMax").append(t),this.updateSection(e,t,i)},updateSection:function(e,i,s){i=i||this._getSectionElementByModel(e);var a=this.getSectionWidth(e);a<t.minUsagePercent?$(i).css("width",t.minUsagePercent+"%"):$(i).css("width",a+"%"),s===n.ENTITY_CONTAINER&&setTimeout(function(){var t=e.get(r.NAME)||"";i.html(c({name:t}));var n=i.find(".n-bar-entity-name"),s=i.width(),a=n.width();0!==a&&s>a&&n.show()},1e3),this._createDetailsPopover(i,e)},_getContainerBarSpecs:function(e,i){var n=$("#stDiagramColGroup .barMax"),a=$("#stDiagramColGroup .barUnallocated"),o=i.getTotalCapacity(),l=$(n).width()-($(a).is(":visible")?$(a).width():0),c=$.extend({},{logical:{}},{physical:{}}),d=Math.floor(10*t.maxPercentWidth*o/this.collection.getTotalMaxCapacity())/10;return this.spMaxBarWidth=Math.min(l,Math.max(0,this.spMaxBarWidth)),c.ctrRF=e.get(r.RF),(0===c.ctrRF||isNaN(c.ctrRF)||null===c.ctrRF)&&s.log("StorageDiagramBarView: Storage container replication factor not set to an invalid value ("+c.ctrRF+") for storage container "+e.get(e.nameAttribute)),c.physical.ctrFreeReserved=e.getFreeReservedPhysical(),isNaN(c.physical.ctrFreeReserved)&&(s.log("BarStoragePoolView: Issue obtaining storage container free reserved value for storage container id"+e.get(e.idAttribute)),c.physical.ctrFreeReserved=0),c.physical.ctrSize=e.getPhysicalSize(),c.physical.ctrMaxCapacity=e.getMaxCapacityPhysical(),c.logical.ctrMaxCapacity=e.getMaxCapacityLogical(),c.physical.ctrAvailCapacity=e.getTotalAvailablePhysical(),c.logical.ctrAvailCapacity=e.getTotalAvailableLogical(),c.physical.ctrUsed=e.getUsageByThisContainerOnly(!0),c.logical.ctrUsed=e.getUsageByThisContainerOnly(!1),c.physical.ctrReservedCapacity=e.getReservedCapacity(),c.logical.ctrReservedCapacity=e.getReservedCapacityLogical(),c.physical.ctrMaxBarWidth=Math.round(10*d*(c.physical.ctrAvailCapacity/t.getModelByEntityId(e.get(r.SP_ID),this.collection).getTotalCapacity()))/10,c.logical.ctrMaxBarWidth=c.physical.ctrMaxBarWidth/c.ctrRF,c.physical.ctrReservedWidth=Math.round(10*d*(c.physical.ctrReservedCapacity/c.physical.ctrAvailCapacity))/10,c.physical.ctrReservedWidth=isNaN(c.physical.ctrReservedWidth)?0:c.physical.ctrReservedWidth,c.logical.ctrReservedWidth=c.physical.ctrReservedWidth,c.physical.ctrUsageBarWidth=Math.round(10*d*(c.physical.ctrUsed/c.physical.ctrAvailCapacity))/10,c.physical.ctrUsageBarWidth=isNaN(c.physical.ctrUsageBarWidth)?0:c.physical.ctrUsageBarWidth,c.physical.ctrUsageBarWidth=c.physical.ctrUsageBarWidth>1?c.physical.ctrUsageBarWidth:2,c.logical.ctrUsageBarWidth=c.physical.ctrUsageBarWidth,c},hideBar:function(e){var i=this,n=function(){"function"==typeof e&&e(),i.$el.trigger(o.STORAGE_DIAGRAM_ADJUST_VIEW)};setTimeout(function(){i.$el.slideUp(t.slideDuration,function(){n()})},t.slideDuration)},showBar:function(e){var i=this,n=function(){"function"==typeof e&&e(),i.$el.trigger(o.STORAGE_DIAGRAM_ADJUST_VIEW)};setTimeout(function(){i.$el.slideDown(t.slideDuration,function(){n()})},t.slideDuration)},_renderUnusedPopover:function(e){var i=this.sectionCollection.getUnusedModels();if(i.length>0){var s=n.ENTITY_NAMES[e],a=n.ENTITY_NAMES[this.entityType];this.$("#stDiagramBarGrp .n-unused").empty();for(var o="",l=0;l<i.length&&l<t.maxStoragePoolPopoverRows;l++)o+=t.templateUnusedBody({name:i[l].get(r.NAME)});if(l<i.length){var c=i.length-l;o+=t.templateUnusedBody({name:c+" more "+s.toLowerCase()+"(s)"})}var d=t.templateUnused({entityType:a.toLowerCase(),sectionEntityType:s.toLowerCase(),count:i.length});this.$("#stDiagramBarGrp .n-unused").append(d),t.popover({el:this.$(".n-unused a"),title:t.templateUnusedTitle({sectionEntityType:s}),body:o,trigger:"hover"})}},_getSectionElementByModel:function(e){var t=e.get(e.idAttribute),i=this.$(".progress ["+n.NAV_ACTION_TARGET_ID+'="'+t+'"]');return i.length?i:null},_createDetailsPopover:function(e,t){}})}),define("views/pages/storage/diagram/ClusterBarView",["views/pages/storage/diagram/StorageDiagramBarView","views/pages/storage/common/StorageCommon","utils/AppConstants","utils/StatsUtil","data/DataProperties"],function(e,t,i,n,s){"use strict";return e.extend({entityType:i.ENTITY_CLUSTER,clusterModel:null,render:function(t){this.collection=t.get(i.ENTITY_DISK),this.clusterModel=t.get(i.ENTITY_CLUSTER),this.sectionCollection=t.get(i.ENTITY_STORAGE_POOL),e.prototype.render.apply(this,arguments)},update:function(){this.availMaxCapacity=this.sectionCollection.getTotalMaxCapacity(),this.totalPhysicalUsed=this.sectionCollection.getTotalUsedPhysical(),this.percentPhysicalUsed=n.roundPercent(this.totalPhysicalUsed/this.availMaxCapacity),this.$("#stDiagramBarMax").width(t.maxPercentWidth+"%"),e.prototype.update.apply(this,arguments),this.$("#n-physical-used").html(n.storageFormat(this.totalPhysicalUsed)+"&nbsp;("+this.percentPhysicalUsed+")"),this.$("#n-max-capacity").html(n.storageFormat(this.availMaxCapacity)),this.$(".lblRawUsable").html(n.storageFormat(Math.max(0,this.availMaxCapacity-this.totalPhysicalUsed))),this._renderUnusedPopover(i.ENTITY_STORAGE_POOL),this._renderUnallocatedDisksLink()},getSectionWidth:function(e){this.availMaxCapacity>0&&Math.round(e.getUsedPhysical()*this.barMaxWidth/this.availMaxCapacity);return this.availMaxCapacity>0?100*e.getUsedPhysical()/this.availMaxCapacity:0},_renderUnallocatedDisksLink:function(){this.clusterTotalPhysCapacity=this.clusterModel.getTotalMaxCapacity();var e=this.collection.getUnAllocatedDisks(),t=this.collection.getTotalCapacityOfUnAllocatedDisks();if(e&&e.length&&t>0){this.$(".lblUnallocatedSize").html(n.storageFormat(t));var i=Math.max(120,this.$(".barMax").width()*t/this.clusterTotalPhysCapacity);this.initialWidth||(this.initialWidth=i),this.adjustedWidth||(this.adjustedWidth=this.initialWidth),this.$(".barUnallocated").css("width",i),this.$(".barUnallocated").css("left",this.$(".barMax").width()-i),this.$(".n-cluster-unallocated").show()}else this.$(".n-cluster-unallocated").hide()},_createDetailsPopover:function(e,i){var a={};a.name=i.get(s.NAME),a.size=n.storageFormat(i.getUsedPhysical()),a.realUsed=n.storageFormat(i.getRealUsed()),a.thickButNotUsed=n.storageFormat(i.getImplicitReservedButNotUsed()),a.reservedButNotUsed=n.storageFormat(i.getReservedButNotUsed()),a.nameLongClass=a.name.length>30?"n-popover-details-top-long":"";var r=t.templatePopoverStoragePoolBody(a);t.popover({el:e,body:r,trigger:"hover"})},getModelsToRender:function(){return this.sectionCollection.getUsedModels()},getColorClass:function(e){return"n-section-color"+(t.uniqueColors-1-this.sectionCollection.models.indexOf(e)%t.uniqueColors)}})}),define("views/pages/storage/diagram/StoragePoolBarView",["views/pages/storage/diagram/StorageDiagramBarView","views/pages/storage/common/StorageCommon","utils/AppConstants","utils/StatsUtil","data/DataProperties"],function(e,t,i,n,s){"use strict";return e.extend({entityType:i.ENTITY_STORAGE_POOL,render:function(t,n){this.collection=t.get(i.ENTITY_STORAGE_POOL),this.sectionCollection=t.get(i.ENTITY_CONTAINER).filterCollection(function(e){return e.get(s.SP_ID)==n}),this.sectionCollection.comparator=function(e){return _.isNumber(e.getPhysicalSize())?-e.getPhysicalSize():null},this.sectionCollection.sort(),e.prototype.render.apply(this,arguments)},update:function(s){e.prototype.update.apply(this,arguments);var a=this.$el.closest("#stDiagramBarHorizontal").find("#stDiagramColGroup .barMax"),r=this.$el.closest("#stDiagramBarHorizontal").find("#stDiagramColGroup .barUnallocated"),o=this.model.getTotalCapacity(),l=$(a).width()-($(r).is(":visible")?$(r).width():0);this.spMaxBarWidth=Math.floor(10*t.maxPercentWidth*o/this.collection.getTotalMaxCapacity())/10,this.spMaxBarWidth=Math.min(l,Math.max(0,this.spMaxBarWidth)),this.$("#stDiagramBarMax").width(this.spMaxBarWidth+"%"),this.$("#n-physical-used").html(n.storageFormat(this.model.getUsedPhysical())),this.$("#n-max-capacity").html(n.storageFormat(this.model.getTotalCapacity())),this.$("#stDiagramLblRawUsable").html(n.storageFormat(this.model.getFreeCapacity())),this._renderUnusedPopover(i.ENTITY_CONTAINER)},getSectionWidth:function(e){var t=this._getContainerBarSpecs(e,this.model);return 0!==this.collection.getTotalMaxCapacity()?100*t.physical.ctrSize/this.collection.getTotalMaxCapacity():0},_createDetailsPopover:function(e,i){var a=(this._getContainerBarSpecs(i,this.model),{});a.name=i.get(s.NAME),a.size=n.storageFormat(i.getTotalUsedPhysical()),a.realUsed=n.storageFormat(i.getRealUsed(!0)),a.freeReserved=n.storageFormat(i.getReservedButNotUsed(!0));var r=t.templatePopoverContainerBody(a);t.popover({el:e,body:r,trigger:"hover"})},getModelsToRender:function(){return this.sectionCollection.getUsedModels()},getColorClass:function(e){return"n-section-color"+this.sectionCollection.models.indexOf(e)%t.uniqueColors}})}),define("views/pages/storage/diagram/ContainerBarView",["views/pages/storage/diagram/StorageDiagramBarView","views/pages/storage/common/StorageCommon","utils/AppConstants","utils/StatsUtil","data/DataProperties"],function(e,t,i,n,s){"use strict";var a=_.template('<div class="barUnallocated  n-bar-reserved" <% if (ctrReservedWidth) { %>style="width: <%= ctrReservedWidth %>%;"><% } else { %>style="display:none;"><% } %></div>');return e.extend({entityType:i.ENTITY_CONTAINER,render:function(n,a,r){this.collection=n.get(i.ENTITY_STORAGE_POOL);var o=r.get(s.SP_ID);this.sectionCollection=n.get(i.ENTITY_CONTAINER).filterCollection(function(e){return e.get(s.SP_ID)==o});var l=t.getModelByEntityId(r.get(s.SP_ID),this.collection);this.containerBarSpecs=this._getContainerBarSpecs(r,l),e.prototype.render.apply(this,arguments)},update:function(){e.prototype.update.apply(this,arguments),this.$(".n-container-state a").removeClass("active"),this.model.isPhysical()?(this.$("#n-ctr-state").html("Physical"),this.$(".n-container-btn-physical").addClass("active")):(this.$("#n-ctr-state").html("Logical"),this.$(".n-container-btn-logical").addClass("active"));t.getModelByEntityId(this.model.get(s.SP_ID),this.collection);this.$("#stDiagramBarMax").width(this.containerBarSpecs[this.getViewState()].ctrMaxBarWidth+"%"),this.$("#n-physical-used").html(n.storageFormat(this.containerBarSpecs[this.getViewState()].ctrUsed)),this.$("#n-max-capacity").html(n.storageFormat(this.containerBarSpecs[this.getViewState()].ctrMaxCapacity))},updateSection:function(t){e.prototype.updateSection.apply(this,arguments);var i={ctrReservedWidth:this.containerBarSpecs[this.getViewState()].ctrReservedWidth};this.$("#stDiagramBarMax .n-bar-reserved").remove(),this.$("#stDiagramBarMax").append(a(i))},getSectionWidth:function(){t.getModelByEntityId(this.model.get("storagePoolId"),this.collection);return this.containerBarSpecs[this.getViewState()].ctrUsageBarWidth},getViewState:function(){return this.model.isPhysical()?"physical":"logical"},getModelsToRender:function(){var e=[];return e.push(this.model),e},getColorClass:function(){var e="#stDiagramGroupStorageEntityHolder .bar["+i.NAV_ACTION_TARGET_ID+'="'+this.model.get(this.model.idAttribute)+'"]',t=$(e),n=$(t).attr("class").split(/\s+/);return _.find(n,function(e){return-1!==e.indexOf("n-section-color")})}})}),define("views/pages/storage/diagram/StorageDiagramView",["views/basecomponents/diagrams/BaseDiagramView","views/pages/storage/common/StorageCommon","text!templates/pages/storage/diagram/StorageDiagramView.html","views/pages/storage/diagram/ClusterBarView","views/pages/storage/diagram/StoragePoolBarView","views/pages/storage/diagram/ContainerBarView","managers/NavigationManager","managers/ActionManager","models/storage/StoragePoolCollection","models/hardware/DiskCollection","models/storage/ContainerCollection","utils/AppConstants","utils/AppUtil","utils/CommonTemplates","utils/SubModelHelper","utils/SubViewHelper","events/AppEvents"],function(e,t,i,n,s,a,r,o,l,c,d,u,h,p,T,E,g){"use strict";return e.extend({subViewHelper:null,subModelHelper:null,isPopupVisible:!1,isPopupClickedAway:!1,intervalId:null,selectedStoragePoolId:null,selectedContainerId:null,handlerInProgress:!1,events:{"click  .btnEntityAction":"onClickEntityActionButton","click     .popMarkerUnallocated":"onClickBarAllocateAction","click .n-cluster-col-group .bar":"onSectionClick","click .n-group-storage-entity-holder .bar":"onSectionClick","click      .linkHideStoragePool":"onClickStoragePoolHideButton","click      .linkHideContainer":"onClickContainerHideButton","click      .n-container-state a":"onClickContainerState",'click      a[action="details"]':"onClickLinkNav"},initialize:function(){e.prototype.initialize.apply(this,arguments),_.bindAll(this,"_toggleStoragePoolBar","render","adjustRoundedCorners","onClickToClear"),this.subModelHelper=new T,this.subViewHelper=new E;var t={};t[u.PARAM_PROJECTION]=[u.PROJECTION.USAGE_STATS],this.subModelHelper.register(u.ENTITY_CLUSTER,this.clusterManager.getCurrentClusterModel()),this.subModelHelper.register(u.ENTITY_DISK,new c(null,t)),this.subModelHelper.register(u.ENTITY_STORAGE_POOL,new l(null,t)),this.subModelHelper.register(u.ENTITY_CONTAINER,new d(null,t)),this.$el.on(g.STORAGE_DIAGRAM_DATA_CHANGE,this.render),this.$el.html(i),this.$(".bar-wrapper").on(g.STORAGE_DIAGRAM_ADJUST_VIEW,this.adjustRoundedCorners)},render:function(){this.$(".n-loading").hide(),this.getClusterBarView()?this.getClusterBarView().render(this.subModelHelper,this.selectedStoragePoolId):this.subViewHelper.register(u.ENTITY_CLUSTER,new n({subModelHelper:this.subModelHelper,el:this.$("#stDiagramColGroup")})),this.selectedStoragePoolId&&this.renderStoragePoolBarView(!1),this.selectedContainerId&&this.renderContainerBarView(!1)},renderStoragePoolBarView:function(e){
var i=t.getModelByEntityId(this.selectedStoragePoolId,this.subModelHelper.get(u.ENTITY_STORAGE_POOL));this.getStoragePoolBarView()?this.getStoragePoolBarView().render(this.subModelHelper,this.selectedStoragePoolId,i):(this.subViewHelper.register(u.ENTITY_STORAGE_POOL,new s({subModelHelper:this.subModelHelper,visibleSectionId:this.selectedStoragePoolId,model:i,el:this.$(".grpStorageEntities")})),e&&this.getStoragePoolBarView().showBar())},renderContainerBarView:function(e){var i=t.getModelByEntityId(this.selectedContainerId,this.subModelHelper.get(u.ENTITY_CONTAINER));this.getContainerBarView()?this.getContainerBarView().render(this.subModelHelper,this.selectedContainerId,i):(this.subViewHelper.register(u.ENTITY_CONTAINER,new a({subModelHelper:this.subModelHelper,visibleSectionId:this.selectedContainerId,model:i,el:this.$(".n-container-group")})),e&&this.getContainerBarView().showBar())},startPollingCombinedFetch:function(){if(!this.intervalId){this.combinedFetch();var e=this;this.intervalId=setInterval(function(){h.isLocalStorageProperty("nutanix_nopoll")||e.combinedFetch()},u.DEFAULT_POLLING_INTERVAL)}},stopPollingCombinedFetch:function(){clearInterval(this.intervalId),this.intervalId=null,this.subModelHelper.iterate("stopFetch")},combinedFetch:function(){var e=this;$.when.apply($,this.subModelHelper.iterate("fetch")).done(function(){e.$el.trigger(g.STORAGE_DIAGRAM_DATA_CHANGE)})},destroy:function(){h.debug("StorageDiagramView  | destroy | ",this.cid),this.stopPollingCombinedFetch(),this.$(".popMarkerUnallocated").popover("destroy"),this.$(".btnAllocateDisk").off(),$(document).off("click",this.onClickToClear),this.$(".bar-wrapper").off(),this.subViewHelper.removeAll(),this.subViewHelper=null,e.prototype.destroy.apply(this,arguments)},adjustRoundedCorners:function(){this.$(".n-container-group").is(":visible")?(this.$(".n-storage-entities-group").css("border-radius","0"),this.$(".n-cluster-col-group").css("border-radius","5px 5px 0 0")):this.$(".n-storage-entities-group").is(":visible")?(this.$(".n-storage-entities-group").css("border-radius","0 0 5px 5px"),this.$(".n-cluster-col-group").css("border-radius","5px 5px 0 0")):this.$(".n-cluster-col-group").css("border-radius","5px")},setHandlerInProgress:function(e){var t=this.handlerInProgress;return this.handlerInProgress=e,t},allocateDisks:function(e){o.executeActionElement(e.currentTarget)},getClusterBarView:function(){return this.subViewHelper.get(u.ENTITY_CLUSTER)},getStoragePoolBarView:function(){return this.subViewHelper.get(u.ENTITY_STORAGE_POOL)},getContainerBarView:function(){return this.subViewHelper.get(u.ENTITY_CONTAINER)},refreshView:function(){this.combinedFetch()},_toggleStoragePoolBar:function(e){var t=this,i=this.selectedStoragePoolId,n=this.selectedStoragePoolId=$(e.currentTarget).attr(u.NAV_ACTION_TARGET_ID),s=function(){t.selectedStoragePoolId=n,t.renderStoragePoolBarView(!0),t.$('.barMax div[actiontargetid="'+t.selectedStoragePoolId+'"]').addClass("n-selected-storagepool"),t.setHandlerInProgress(!1)};i?this.onClickStoragePoolHideButton(null,s):s()},_toggleContainerBar:function(e){var t=this,i=this.selectedContainerId,n=$(e.currentTarget).attr(u.NAV_ACTION_TARGET_ID),s=function(){t.selectedContainerId=n,t.renderContainerBarView(!0),t.getStoragePoolBarView().$('.barMax div[actiontargetid="'+t.selectedContainerId+'"]').addClass("n-selected-container"),t.setHandlerInProgress(!1)};i?this.onClickContainerHideButton(null,s):s()},onStartServices:function(){this.startPollingCombinedFetch()},onStopServices:function(){this.stopPollingCombinedFetch()},onSectionClick:function(e){if(!this.setHandlerInProgress(!0)){var t=this,i=function(){t.setHandlerInProgress(!1)};1===e.which&&($(e.currentTarget).is("["+u.NAV_ACTION_TARGET+'="'+u.ENTITY_STORAGE_POOL+'"]')?$(e.currentTarget).is(".n-selected-storagepool")?this.selectedStoragePoolId&&this.getStoragePoolBarView()&&this.onClickStoragePoolHideButton(null,i):(this._toggleStoragePoolBar(e),r.updateRouteOption(e.currentTarget)):$(e.currentTarget).is("["+u.NAV_ACTION_TARGET+'="'+u.ENTITY_CONTAINER+'"]')&&($(e.currentTarget).is(".n-selected-container")?this.selectedContainerId&&this.getContainerBarView()&&this.onClickContainerHideButton(null,i):(this._toggleContainerBar(e),r.updateRouteOption(e.currentTarget))))}},onClickStoragePoolHideButton:function(e,t){var i,n,s=this;this.selectedContainerId?(i=function(){n=function(){s.subViewHelper.remove(u.ENTITY_STORAGE_POOL),s.$(".n-selected-storagepool").removeClass("n-selected-storagepool"),"function"==typeof t&&t()},s.getStoragePoolBarView().hideBar(n)},this.onClickContainerHideButton(null,i)):(n=function(){s.subViewHelper.remove(u.ENTITY_STORAGE_POOL),s.$(".n-selected-storagepool").removeClass("n-selected-storagepool"),"function"==typeof t&&t()},this.getStoragePoolBarView().hideBar(n)),this.selectedStoragePoolId=null,this.trigger(g.STORAGE_DIAGRAM_SHOW_SUMMARY,null)},onClickContainerHideButton:function(e,t){var i=this,n=function(){i.subViewHelper.remove(u.ENTITY_CONTAINER),i.$(".n-selected-container").removeClass("n-selected-container"),"function"==typeof t&&t()};this.getContainerBarView().hideBar(n),this.selectedContainerId=null,this.trigger(g.STORAGE_DIAGRAM_SHOW_DETAILS,this.selectedStoragePoolId)},onClickLinkNav:function(e){r.updateRouteOption(e.currentTarget)},onClickEntityActionButton:function(e){o.executeActionElement(e.currentTarget)},onClickBarAllocateAction:function(e){if(this.$("#stDiagramUnallocated .popover:visible").length)return this.$(".popMarkerUnallocated").popover("destroy"),this.$(".btnAllocateDisk").off(),void $(document).off("click",this.onClickToClear);var i=this.subModelHelper.get(u.ENTITY_STORAGE_POOL),n="";i.models.length?(n=$("<div>").html(t.templateUnallocatedDisks({hasStoragePools:!0})),_.each(i.models,function(e){var t=h.convertModelToNavItemModel(e,u.ENTITY_STORAGE_POOL,u.ACTION_UPDATE),i=_.template(p.NAV_LINK_UPDATE,{model:t,className:"btnAllocateDisk"});$(n).find(".grpAllocateSP").append($(i))}),n=$(n).contents().unwrap()):n=t.templateUnallocatedDisks({hasStoragePools:!1}),this.$(".popMarkerUnallocated").popover({title:"Allocate Disks",content:n,placement:"right",html:!0,animation:!1,trigger:"manual"}),this.$(".popMarkerUnallocated").popover("show"),this.isPopupClickedAway=!1,this.isPopupVisible=!0;var s=this;this.$(".btnAllocateDisk").off("click").on("click",function(e){s.allocateDisks(e),s.$(".popMarkerUnallocated").popover("hide")}),$(document).on("click",this.onClickToClear)},onClickToClear:function(e){this.isPopupVisible&&this.isPopupClickedAway?($(document).off("click",this.onClickToClear),this.$(".popMarkerUnallocated").popover("destroy"),this.isPopupVisible=this.isPopupClickedAway=!1):this.isPopupClickedAway=!0},onClickContainerState:function(e){$(e.currentTarget).is(".n-container-btn-physical")!==this.getContainerBarView().model.isPhysical()&&(this.getContainerBarView().model.togglePhysical(),this.getContainerBarView().update())}})}),define("text!templates/pages/storage/details/StorageTabDetailsView.html",[],function(){return'\x3c!-- Wrap --\x3e\n<div class="n-unit-wrap">\n  \x3c!-- Fixed unit --\x3e\n  <div class="n-unit-fixed">\n    \x3c!-- Column 1: Summary --\x3e\n    <div class="n-details-unit">\n      <div class="title">STORAGE SUMMARY</div>\n      <ul class="n-list-info">\n        \x3c!-- Available --\x3e\n        <li>\n          <div class="n-info-block">\n            <span class="n-label">Free (Physical)</span>\n            <span class="n-value">\n              <span class="lblAvailPhysical">\n                \x3c!-- @value: available physical goes here... --\x3e\n              </span>\n            </span>\n          </div>\n        </li>\n        \x3c!-- Used --\x3e\n        <li>\n          <div class="n-info-block">\n            <span class="n-label">Used (Physical)</span>\n            <span class="n-value">\n              <span class="lblUsedPhysical">\n                \x3c!-- @value: physical used % goes here... --\x3e\n              </span>\n              (<span class="lblPercentUsed">\n                \x3c!-- @value: physical used % goes here... --\x3e\n              </span>)\n            </span>\n          </div>\n        </li>\n        \x3c!-- Capacity --\x3e\n        <li>\n          <div class="n-info-block">\n            <span class="n-label">Capacity (Physical)</span>\n            <span class="n-value">\n              <span class="lblCapacityPhysical">\n                \x3c!-- @value: max raw capacity used goes here... --\x3e\n              </span>\n            </span>\n          </div>\n        </li>\n        \x3c!-- Storage Pool List Info --\x3e\n        <li>\n          <div class="n-info-block">\n            <span class="n-label">Storage Pool(s)</span>\n            <ul class="listStoragePool  n-ul">\n              \x3c!-- @view: Storage pools li links go here... --\x3e\n            </ul>\n          </div>\n        </li>\n        \x3c!-- Container List Info --\x3e\n        <li>\n          <div class="n-info-block">\n            <span class="n-label">Storage Container(s)</span>\n            <ul class="listContainer  n-ul">\n              \x3c!-- @view: Container li links go here... --\x3e\n            </ul>\n          </div>\n        </li>\n      </ul>\n    </div>\n  </div>\n  \x3c!-- Fluid unit --\x3e\n  <div class="n-unit-fluid  n-tab-details-unit">\n    \x3c!-- @view: Tab details view goes here... --\x3e\n  </div>\n</div>'}),define("text!templates/pages/storage/details/StoragePoolTabDetailsEntityView.html",[],function(){return'\x3c!-- Wrap --\x3e\n<div class="n-unit-wrap">\n  \x3c!-- Fixed unit --\x3e\n  <div class="n-unit-fixed">\n    \x3c!-- Column 1: Summary --\x3e\n    <div class="n-details-unit">\n      <div class="title">STORAGE POOL DETAILS</div>\n      <ul class="n-list-info">\n        <li>\n          <div class="n-info-block">\n            <span class="n-label">Name</span>\n            <span class="lblName n-value n-resettable">\n              \x3c!-- @value: name used goes here... --\x3e\n            </span>\n          </div>\n        </li>\n        <li>\n          <div class="n-info-block">\n            <span class="n-label">Free (Physical)</span>\n            <a class="lblPhysicalFree n-value n-resettable\n                      n-storage-stats-link">\n              \x3c!-- @value: physical free goes here... --\x3e\n            </a>\n          </div>\n        </li>\n        <li>\n          <div class="n-info-block">\n            <span class="n-label">Used (Physical)</span>\n            <a class="lblPhysicalUsed n-value n-resettable\n                      n-storage-stats-link">\n              \x3c!-- @value: physical used goes here... --\x3e\n            </a>\n          </div>\n        </li>\n        <li>\n          <div class="n-info-block">\n            <span class="n-label">Capacity (Physical)</span>\n            <a class="lblMaxRawCapacity n-value n-resettable\n                      n-storage-stats-link">\n              \x3c!-- @value: max raw capacity goes here... --\x3e\n            </a>\n          </div>\n        </li>\n        <li>\n          <div class="n-info-block">\n            <span class="n-label">Disk Count</span>\n            <span class="lblDiskCount n-value n-resettable">\n              \x3c!-- @value: max raw capacity goes here... --\x3e\n            </span>\n          </div>\n        </li>\n      </ul>\n\n    </div>\n  </div>\n  \x3c!-- Fluid unit --\x3e\n  <div class="n-unit-fluid  n-tab-details-unit">\n    \x3c!-- @view: Tab details view goes here... --\x3e\n  </div>\n</div>'}),define("views/pages/storage/details/StoragePoolTabDetailsEntityView",["views/basecomponents/details/BaseDetailsEntityView","models/storage/StoragePoolModel","text!templates/pages/storage/details/StoragePoolTabDetailsEntityView.html","data/DataProperties","utils/AppConstants","utils/StatsUtil","utils/TooltipContent","utils/VisualizationUtil"],function(e,t,i,n,s,a,r,o){"use strict";return e.extend({entityType:s.ENTITY_STORAGE_POOL,modelEvents:{"change   model":"renderDetails","error    model":"renderError","pending  model":"reset"},events:{"mouseover  a.n-storage-stats-link":"onStorageStatsMouseOver","mouseout   a.n-storage-stats-link":"onStorageStatsMouseOut"},onStorageStatsMouseOver:function(e){var t=$(e.currentTarget),i=t.attr("ntnxTooltip"),n=r.getStorageStatsBreakdown(i,this.model);t.tooltip({title:n,placement:"right",trigger:"manual",html:!0,container:$("body")}),t.tooltip("show")},onStorageStatsMouseOut:function(e){$(e.currentTarget).tooltip("destroy")},initializeProperties:function(){this.model=new t,this.model.setProjection([s.PROJECTION.USAGE_STATS]),this.render()},render:function(){this.$el.html(i);var e={};e[s.TAB_DETAILS.USAGE]="Storage Pool Usage",e[s.TAB_DETAILS.METRICS]="Storage Pool Performance",e[s.TAB_DETAILS.ALERTS]="Storage Pool Alerts",this.clusterManager.isMulticlusterNavMode()||(e[s.TAB_DETAILS.EVENTS]="Storage Pool Events"),this.tabDetailsView=o.renderTabDetailsView(this.$(".n-tab-details-unit"),e,this.entityType,s.PAGE_STORAGE)},renderDetails:function(){e.prototype.renderDetails.apply(this,arguments),this.$(".lblName").html(this.model.get(n.NAME)).attr("title",this.model.get(n.NAME)),this.$(".lblDiskCount").html(this.model.getDiskCount()),this.$(".lblMaxRawCapacity").html(a.storageFormat(this.model.get(n.CAPACITY))).attr("ntnxTooltip",r.STORAGE_STATS.STORAGE_POOL_MAX.ID),this.$(".lblPhysicalUsed").html(a.storageFormat(this.model.getUsedPhysical())).attr("ntnxTooltip",r.STORAGE_STATS.STORAGE_POOL_USED.ID),this.$(".lblPhysicalFree").html(a.storageFormat(this.model.getFreeCapacity())).attr("ntnxTooltip",r.STORAGE_STATS.STORAGE_POOL_FREE.ID)}})}),define("text!templates/pages/storage/details/ContainerTabDetailsEntityView.html",[],function(){return'\x3c!-- Wrap --\x3e\n<div id="detailsContainerWrap" class="n-unit-wrap">\n  \x3c!-- Fixed unit --\x3e\n  <div id="detailsContainerUnitFixed"class="n-unit-fixed">\n    \x3c!-- Column 1: Summary --\x3e\n    <div id="detailsContainerUnit" class="n-details-unit">\n      <div id="detailsContainerTitle1" class="title">STORAGE CONTAINER DETAILS</div>\n      <ul id="detailsContainerListInfo" class="n-list-info">\n        <li>\n          <div class="n-info-block">\n            <span class="n-label">Name</span>\n            <span id="detailsContainerLabelName"\n                class="lblName n-value n-resettable"\n                data-test="storage_container_details_name">\n                \x3c!-- @value: name used goes here... --\x3e\n            </span>\n          </div>\n        </li>\n        <li class="lblEncrypted hide">\n          \x3c!-- @value: encrypted info block goes here... --\x3e\n        </li>\n        <li class="seperator">\n          <div class="n-info-block">\n            <span class="n-label">\n              Replication Factor</span>\n            <span id="detailsContainerLabelRF"\n              class="lblRF n-value n-resettable"\n              data-test="storage_container_details_replication_factor">\n              \x3c!-- @value: value goes here... --\x3e\n            </span>\n          </div>\n        </li>\n        <li>\n          <div class="n-info-block">\n            <span class="n-label">\n              Protection Domain</span>\n            <span id="vstoreProtectionDomainDetails"\n              class="lblProtectionDomain n-value n-resettable"\n              data-test="storage_container_details_protection_domain">\n              \x3c!-- @value: value goes here... --\x3e\n            </span>\n          </div>\n        </li>\n        <li class="n-hypervisor-elem-esx">\n          <div class="n-info-block">\n            <span class="n-label">\n              Datastore</span>\n            <span id="detailsContainerLabelDatastoreName"\n              class="lblDatastoreName n-value n-resettable"\n              data-test="storage_container_details_datastore">\n              \x3c!-- @value: value goes here... --\x3e\n            </span>\n          </div>\n        </li>\n        <li class="n-hypervisor-elem-esx">\n          <div class="n-info-block">\n            <span class="n-label">VMs</span>\n            <span id="detailsContainerLabelVMs"\n              class="lblVMs n-value n-resettable"\n              data-test="storage_container_details_vms">\n              \x3c!-- @value: value goes here... --\x3e\n            </span>\n          </div>\n        </li>\n        <li>\n          <div class="n-info-block">\n            <span class="n-label">\n              Free Space (Logical)</span>\n            <a id="detailsContainerLabelFreeSpaceLogical"\n              class="lblFreeLogical n-value n-resettable\n                n-storage-stats-link"\n              data-test="storage_container_details_free_space_logical">\n              \x3c!-- @value: value goes here... --\x3e\n            </a>\n          </div>\n        </li>\n        <li>\n          <div class="n-info-block">\n            <span class="n-label">\n              Used</span>\n            <a id="detailsContainerLabelUsedLogical"\n              class="lblUsedLogical n-value n-resettable\n                n-storage-stats-link"\n              data-test="storage_container_details_used_logical">\n              \x3c!-- @value: value goes here... --\x3e\n            </a>\n          </div>\n        </li>\n        <li>\n          <div class="n-info-block">\n            <span class="n-label">\n              Max Capacity</span>\n            <a id="detailsContainerLabelMaxCapacityLogical"\n              class="lblMaxLogical n-value n-resettable\n                n-storage-stats-link"\n              data-test="storage_container_details_max_capacity_logical">\n              \x3c!-- @value: value goes here... --\x3e\n            </a>\n          </div>\n        </li>\n        <li class="seperator">\n          <div class="n-info-block">\n            <span class="n-label">\n              Reserved</span>\n            <span id="detailsContainerLabelExplicitReservedCapacity"\n              class="lblExplicitReservedCapacity n-value n-resettable"\n              data-test="storage_container_details_explicit_reserved_capacity">\n              \x3c!-- @value: value goes here... --\x3e\n            </span>\n          </div>\n        </li>\n        <li>\n          <div class="n-info-block">\n            <span class="n-label">\n              Data Reduction Ratio</span>\n            <a class="lblDataReductionRatio n-value n-resettable n-storage-stats-link">\n              \x3c!-- @value: value goes here... --\x3e\n            </a>\n          </div>\n        </li>\n        <li>\n          <div class="n-info-block">\n            <span class="n-label">\n              Data Reduction Savings</span>\n            <span class="lblDataReductionSaving n-value n-resettable">\n              \x3c!-- @value: value goes here... --\x3e\n            </span>\n          </div>\n        </li>\n        <li>\n          <div class="n-info-block">\n            <span class="n-label">\n              Effective Free</span>\n            <a class="lblEffectiveFree n-value n-resettable n-storage-stats-link">\n              \x3c!-- @value: value goes here... --\x3e\n            </a>\n          </div>\n        </li>\n        <li class="seperator">\n          <div class="n-info-block">\n            <span class="n-label">\n              Overall Efficiency</span>\n            <a class="lblOverallEfficieny n-value n-resettable n-storage-stats-link"\n              data-test="storage_overall_efficiency">\n              \x3c!-- @value: value goes here... --\x3e\n            </a>\n          </div>\n        </li>\n        <li>\n          <div class="n-info-block">\n            <span class="n-label">\n              Compression</span>\n            <a id="detailsContainerLabelCompression"\n              class="lblCompression n-value n-resettable n-storage-stats-link disabled"\n              data-test="storage_container_details_compression">\n              \x3c!-- @value: value goes here... --\x3e\n            </a>\n          </div>\n        </li>\n        <li>\n          <div class="n-info-block">\n            <span class="n-label">\n              Capacity Deduplication</span>\n            <a id="detailsContainerLabelOnDiskDedup"\n              class="lblOnDiskDedup n-value n-resettable capitalize n-storage-stats-link disabled"\n              data-test="storage_container_details_on_disk_dedup">\n              \x3c!-- @value: value goes here... --\x3e\n            </a>\n          </div>\n        </li>\n        <li>\n          <div class="n-info-block">\n            <span class="n-label">\n              Cache Deduplication</span>\n            <a id="detailsContainerLabelPerfDedup"\n              class="lblPerfDedup n-value n-resettable capitalize n-storage-stats-link disabled"\n              data-test="storage_container_details_perf_tier_dedup">\n              \x3c!-- @value: value goes here... --\x3e\n            </a>\n          </div>\n        </li>\n        <li>\n          <div class="n-info-block">\n            <span class="n-label">\n              Erasure Coding\n            </span>\n            <a id="detailsContainerLabelErasureCoding"\n                  class="lblErasureCoding n-value n-resettable capitalize n-storage-stats-link disabled"\n                  data-test="storage_container_details_erasure_code">\n              \x3c!-- @value: value goes here... --\x3e\n            </a>\n          </div>\n        </li>\n        <li>\n          <div class="n-info-block">\n            <span class="n-label">\n              Filesystem Whitelists</span>\n            <a id="detailsContainerLabelFilesystemWhitelists"\n              class="lblFilesystemWhitelists n-value n-resettable"\n              data-test="storage_container_details_filesystem_whitelists">\n              \x3c!-- @value: value goes here... --\x3e\n            </a>\n          </div>\n        </li>\n      </ul>\n    </div>\n  </div>\n  \x3c!-- Fluid unit --\x3e\n  <div id="detailsContainerUnitFluid" class="n-unit-fluid  n-tab-details-unit">\n    \x3c!-- @view: Tab details view goes here... --\x3e\n  </div>\n</div>'}),define("views/pages/storage/details/ContainerTabDetailsEntityView",["views/basecomponents/details/BaseDetailsEntityView","text!templates/pages/storage/details/ContainerTabDetailsEntityView.html","models/storage/ContainerModel","models/storage/DatastoreCollection","models/encryption/EncryptionStateModel","models/storage/VStoreCollection","managers/NavigationManager","managers/ClusterManager","data/DataProperties","utils/AppConstants","utils/AppUtil","utils/CommonTemplates","utils/I18nMixin","utils/ManagerMixin","utils/StatsUtil","utils/TooltipContent","utils/HypervisorUtil","utils/VisualizationUtil"],function(e,t,i,n,s,a,r,o,l,c,d,u,h,p,T,E,g,S){"use strict";var m=_.template('\n      <div class="n-info-block">\n        <span class="n-label"><%= i18n(\'encrypted\') %></span>\n        <span id="detailsContainerLabelEncrypted"\n            class="lblEncrypted n-value n-resettable"\n            data-test="storage_container_details_encrypted">\n            <%= value %>\n        </span>\n      ');return e.extend(_.extend({},h,p,{viewTemplate:_.template(t),name:"ContainerTabDetailsEntityView",datastoreCollection:null,encryptionStateModel:null,vstoreCollection:null,entityType:c.ENTITY_CONTAINER,modelEvents:{"change   model":"renderDetails","error    model":"renderError","pending  model":"reset","reset    vstoreCollection":"renderVstoreDetails","reset    datastoreCollection":"renderDatastoreDetails"},events:{"click      a.pageLink":"onPageLinkClick","mouseover  a[ntnxTooltip]":"onToolTipMouseOver","mouseout   a[ntnxTooltip]":"onTooltipMouseOut"},onToolTipMouseOver:function(e){var t=$(e.currentTarget),i=t.attr("ntnxTooltip"),n="";n=t.hasClass("n-storage-stats-link")?E.getStorageStatsBreakdown(i,this.model):E.CONTAINER_INFO[i].INFO(this.model.toJSON()),t.tooltip({title:n,placement:"right",trigger:"manual",html:!0,container:"body"}),t.tooltip("show")},onTooltipMouseOut:function(e){$(e.currentTarget).tooltip("destroy")},onPageLinkClick:function(e){r.navigateToPageByPageLink(e.currentTarget)},initialize:function(){e.prototype.initialize.apply(this,arguments),_.bindAll(this,"onEncryptionTaskChange")},initializeProperties:function(){this.model=new i,this.model.setProjection([c.PROJECTION.USAGE_STATS]),this.encryptionStateModel=new s,this.datastoreCollection=new n,this.vstoreCollection=new a,this.render()},render:function(){this.$el.html(this.viewTemplate(this.vtOptions()));var e={};e[c.TAB_DETAILS.USAGE]="Storage Container Usage",e[c.TAB_DETAILS.METRICS]="Storage Container Performance",e[c.TAB_DETAILS.ALERTS]="Storage Container Alerts",this.clusterManager.isMulticlusterNavMode()||(e[c.TAB_DETAILS.EVENTS]="Storage Container Events"),this.tabDetailsView=S.renderTabDetailsView(this.$(".n-tab-details-unit"),e,this.entityType,c.PAGE_STORAGE)},onStartServices:function(){e.prototype.onStartServices.apply(this,arguments),this.getTaskManager().registerHandlerForChangedTasks(this.onEncryptionTaskChange)},onStopServices:function(){e.prototype.onStopServices.apply(this,arguments),this.getTaskManager().unregisterHandlerForChangedTasks(this.onEncryptionTaskChange)},getHypervisorSpecificData:function(e){var t=e.getClusterUuid();g.updateElementVisibility(this.$el,t),g.hasESX(t)&&!o.isMulticlusterNavMode()?this.datastoreCollection.length||this.vstoreCollection.length?(this.renderDatastoreDetails(),this.renderVstoreDetails()):(this.datastoreCollection.fetch(),this.vstoreCollection.fetch(),d.addInLineDonutLoader(this.$(".lblDatastoreName")),d.addInLineDonutLoader(this.$(".lblVMs")),this.$(".lblDatastoreName, .lblVMs, .lblProtectionDomain").closest("li").show()):this.$(".lblDatastoreName, .lblVMs, .lblProtectionDomain").closest("li").hide()},getEncryptionSpecificData:function(e){var t=this,i=e.getClusterUuid();g.hasKVMOnly(i)||(this.encryptionStateModel.getState()===c.STATE_SUCCESS?this._renderEncryptionDetails(this.encryptionStateModel,e):this.encryptionStateModel.fetch({success:function(i){t._renderEncryptionDetails(i,e)},error:this.showModelError}))},onEncryptionTaskChange:function(){this.encryptionStateModel&&this._renderEncryptionDetails(this.encryptionStateModel,this.model)},_renderEncryptionDetails:function(e,t){if(e.isSoftwareEncryptionOn()){var i=t.getEncryptionStatus(),n=t.getEncryptionProgress();n&&(n!==c.DATA_NOT_AVAILABLE?i=u.LOADING_MSG({msg:i+" ("+n+")"}):(i=u.LOADING_MSG({msg:i}),this.getTaskManager().fetchOnDemand())),this.$(".lblEncrypted").html(m(this.vtOptions({value:i}))).removeClass("hide")}},renderDetails:function(){e.prototype.renderDetails.apply(this,arguments),this.getHypervisorSpecificData(this.model),this.getEncryptionSpecificData(this.model),this.$(".lblName").html(this.model.get(l.NAME)).attr("title",this.model.get(l.NAME)),this.$(".lblRF").html(this.model.get(l.RF)),this.renderStatValue(".lblCompression",this.model.get(l.COMPRESSION_ENABLED)?"On":"Off",E.STORAGE_STATS.COMPRESSION_SAVINGS.ID),this.renderStatValue(".lblErasureCoding",this.model.getErasureCodeLabel(),E.STORAGE_STATS.ERASURE_CODING_SAVINGS.ID),this.$(".lblPerfDedup").html(this.model.getPerfDedupLabel()),this.renderStatValue(".lblOnDiskDedup",this.model.getOnDiskDedupLabel(),E.STORAGE_STATS.DEDUP_SAVINGS.ID);var t=this.model.getFileSystemWhiteListsLabel(),i=this.$(".lblFilesystemWhitelists").html(t);_.isNumber(t)?i.attr("ntnxTooltip",E.CONTAINER_INFO.CONTAINER_FILESYSTEM_WHITELISTS.ID).addClass("n-generic-info-link"):i.removeClass("n-generic-info-link").removeAttr("ntnxTooltip"),this.renderStatValue(".lblOverallEfficieny",this.model.getOverallEfficiencyRatio(),E.STORAGE_STATS.OVERALL_EFFICIENCY.ID),this.renderStatValue(".lblDataReductionRatio",this.model.getDataReductionRatio(),E.STORAGE_STATS.DATAREDUCTION_RATIO.ID),this.renderStatValue(".lblEffectiveFree",T.storageFormat(this.model.getEffectiveFree()),E.STORAGE_STATS.EFFECTIVE_FREE.ID),this.$(".lblDataReductionSaving").html(T.storageFormat(this.model.getDataReductionSaving())),this.$(".lblFreeLogical").html(T.storageFormat(this.model.getTotalAvailableLogical())).attr("ntnxTooltip",E.STORAGE_STATS.CONTAINER_FREE.ID),this.$(".lblUsedLogical").html(T.storageFormat(this.model.getUsageByThisContainerOnly())).attr("ntnxTooltip",E.STORAGE_STATS.CONTAINER_USED.ID),this.$(".lblMaxLogical").html(T.storageFormat(this.model.getMaxCapacityLogical())).attr("ntnxTooltip",E.STORAGE_STATS.CONTAINER_MAX.ID),this.$(".lblExplicitReservedCapacity").html(T.storageFormat(this.model.getExcplicitReservedCapacity())),this.$(".lblImplicitReservedCapacity").html(T.storageFormat(this.model.getImplicitReservationCapacity()))},renderStatValue:function(e,t,i){this.$(e).html(t),t&&t!==this.model.featureState.OFF&&t!==c.STATS_NOT_AVAILABLE?this.$(e).removeClass("disabled").attr("ntnxTooltip",i):(this.$(e).addClass("disabled"),this.$(e).removeAttr("ntnxTooltip"))},renderDatastoreDetails:function(){var e=this.datastoreCollection;this.$(".lblDatastoreName").html(e.getDatastoreNameByContainer(this.model.get(this.model.idAttribute))),this.$(".lblDatastoreName").attr("title",e.getDatastoreNameByContainer(this.model.get(this.model.idAttribute))),this.$(".lblVMs").html(e.getVMsByContainer(this.model.get(this.model.idAttribute)).length)},renderVstoreDetails:function(){var e=this.vstoreCollection,t=e.getProtectionDomainForContainer(this.model.get(this.model.idAttribute));if(t){this.$(".lblProtectionDomain").closest("li").show();var i=d.createPageLink(t,c.ENTITY_PROTECTION_DOMAIN,t);this.$(".lblProtectionDomain").html(i)}else this.$(".lblProtectionDomain").html(c.STATS_NOT_AVAILABLE)}}))}),define("text!templates/pages/storage/details/VolumeGroupTabDetailsEntityView.html",[],function(){return'\x3c!-- Wrap --\x3e\n<div class="n-unit-wrap">\n  \x3c!-- Fixed unit --\x3e\n  <div class="n-unit-fixed">\n    \x3c!-- Column 1: Summary --\x3e\n    <div class="n-details-unit">\n      <div class="title">VOLUME GROUP DETAILS</div>\n      <ul class="n-list-info">\n        <li>\n          <div class="n-info-block">\n            <span class="n-label">Name</span>\n            <span class="lblName n-value n-resettable">\n                \x3c!-- @value: name goes here... --\x3e\n            </span>\n          </div>\n        </li>\n        <li>\n          <div class="n-info-block">\n            <span class="n-label">Number of Virtual Disks</span>\n            <span class="lblDisks n-value n-resettable">\n                \x3c!-- @value: disks goes here... --\x3e\n            </span>\n          </div>\n        </li>\n        <li>\n          <div class="n-info-block">\n            <span class="n-label">Total Size</span>\n            <span class="lblCapacity n-value n-resettable">\n                \x3c!-- @value: total size goes here... --\x3e\n            </span>\n          </div>\n        </li>\n        <li>\n          <div class="n-info-block">\n            <span class="n-label">Flash Mode</span>\n            <span class="lblFlashMode n-value n-resettable">\n                \x3c!-- @value: flash mode value goes here... --\x3e\n            </span>\n          </div>\n        </li>\n        <li>\n          <div class="n-info-block">\n            <span class="n-label">Initiators</span>\n            <span class="lblInitiators n-value n-resettable">\n                \x3c!-- @value: IQNs go here... --\x3e\n            </span>\n          </div>\n        </li>\n        <li>\n          <div class="n-info-block block-iqn">\n            <span class="n-label">Target IQN Prefix</span>\n            <span class="lblName-prefix n-value n-resettable">\n                \x3c!-- @value: target IQN prefix goes here... --\x3e\n            </span>\n            <span class="n-info-icon">\n              <%= Components.icon(\'information-tooltip\', \'-inline\') %>\n            </span>\n          </div>\n        </li>\n      </ul>\n    </div>\n  </div>\n  \x3c!-- Fluid unit --\x3e\n  <div class="n-unit-fluid  n-tab-details-unit">\n    \x3c!-- @view: Tab details view goes here... --\x3e\n  </div>\n</div>\n'}),
define("models/volumegroup/AcropolisVolumeGroupModel",["models/AcropolisModel","data/DataURLConstants","data/DataManager","utils/AppConstants","utils/AppUtil"],function(e,t,i,n,s){"use strict";var a={NAME:"name",UUID:"uuid",DESCRIPTION:"description",ISCSI_TARGET_NAME:"iscsi_target",ISCSI_TARGET_NAME_PREFIX:"iscsi_target_prefix",HOST_UUID:"host_uuid",DISK_LIST:"disk_list",SOURCE_UUID:"source_uuid",CONTAINER_ID:"container_id",CONTAINER_UUID:"container_uuid",INDEX:"index",DISK_UUID:"vmdisk_uuid",DISK_SIZE:"vmdisk_size_mb",ATTACHED_CLIENTS:"attached_clients",ATTACHMENT_LIST:"attachment_list",VM_UUID:"vm_uuid",INITIATOR_NAME:"iscsi_initiator_name",INITIATOR_IP:"initiator_ip_address",INITIATOR_NAME_LIST:"iscsi_initiator_name_list",INITIATOR_IP_LIST:"iscsi_initiator_ip_list",IS_SHARED:"is_shared",ENABLED_AUTHENTICATIONS:"enabled_authentications",AUTH_TYPE:"auth_type",PASSWORD:"password",FLASH_MODE_ENABLED:"flash_mode_enabled"},r={VM_UUID:"vmUuid"},o={CHAP:"chap",NONE:"none"};return e.extend({DP:a,idAttribute:a.UUID,nameAttribute:a.NAME,urlRoot:t.MGMT_VG,entityType:n.ENTITY_ACROPOLIS_VOLUME_GROUP,name:"AcropolisVolumeGroupModel",useV2DataSource:!0,getDataSourceURL:function(){return this.useV2DataSource?i.getV2DataSourceURL():i.getNutanixApiDataSourceURL()+"/"},toJSON:function(){switch(this.actionMode){case n.ACTION_CLONE:var t={};return t[a.ISCSI_TARGET_NAME_PREFIX]=this.get(a.ISCSI_TARGET_NAME_PREFIX),t[a.NAME]=this.get(a.NAME),t[a.ENABLED_AUTHENTICATIONS]=this.get(a.ENABLED_AUTHENTICATIONS),t;default:return e.prototype.toJSON.apply(this,arguments)}},getURL:function(){var e=this.getId();switch(this.actionMode){case n.ACTION_ATTACH:return _.template(t.MGMT_VG_ATTACH_VM,{id:e});case n.ACTION_DETACH:return _.template(t.MGMT_VG_DETACH_VM,{id:e});case n.ACTION_ADD_DISK:case n.ACTION_UPDATE_DISK:return _.template(t.MGMT_VG_DISK,{id:e});case n.ACTION_REMOVE_DISK:return _.template(t.MGMT_VG_REMOVE_DISK,{id:e,index:this.deviceIndex});case n.ACTION_CLONE:return _.template(t.MGMT_VG_CLONE,{id:this.get(a.SOURCE_UUID)});default:var i=this.url();return i+=s.getQueryStringParamDelimiter(i)+"include_disk_size=true"}},isShared:function(){return this.get(a.IS_SHARED)},attachToVM:function(e){this.getId();this.actionMode=n.ACTION_ATTACH;var t={};return t[this.useV2DataSource?a.VM_UUID:r.VM_UUID]=e,this.sync("create",this,{data:JSON.stringify(t),contentType:"application/json"})},detachFromVM:function(e){this.getId();this.actionMode=n.ACTION_DETACH;var t={};return t[this.useV2DataSource?a.VM_UUID:r.VM_UUID]=e,this.sync("create",this,{data:JSON.stringify(t),contentType:"application/json"})},addDisk:function(e){this.getId();return this.actionMode=n.ACTION_ADD_DISK,this.sync("create",this,{data:JSON.stringify(e.toVolumeDiskJSON(n.ACTION_CREATE)),contentType:"application/json"})},updateDisk:function(e){var t=(this.getId(),this);return this.actionMode=n.ACTION_UPDATE_DISK,this.sync("update",this,{data:JSON.stringify(e.toVolumeDiskJSON(n.ACTION_UPDATE)),contentType:"application/json",error:function(e,i,n){t.trigger("error",e,i,n)}})},removeDisk:function(e){return this.actionMode=n.ACTION_REMOVE_DISK,this.deviceIndex=e.get(e.DP.INDEX),this.sync("delete",this)},setMessage:function(e){e=e||this.actionMode,this.msg.action=n.ACTION_NAMES[e].toLowerCase(),this.msg.entityMsg=this.entityMsg,this.msg.entityType=n.ENTITY_NAMES[n.ENTITY_ACROPOLIS_VOLUME_GROUP],this.msg.entityName=this.get(this.nameAttribute),this.msg.suppressLink=!0},isChapEnabled:function(){var e=this.get(a.ENABLED_AUTHENTICATIONS);return!(!e||!e.length)&&e[0][a.AUTH_TYPE]===o.CHAP},getChapSecret:function(){var e=this.get(a.ENABLED_AUTHENTICATIONS);return e&&e.length?e[0][a.PASSWORD]||"":""}},{DP:a,AUTH_TYPE:o})}),define("views/pages/storage/details/VolumeGroupTabDetailsEntityView",["views/basecomponents/details/BaseDetailsEntityView","text!templates/pages/storage/details/VolumeGroupTabDetailsEntityView.html","models/volumegroup/AcropolisVolumeGroupModel","managers/NavigationManager","utils/AppConstants","utils/AppUtil","utils/StatsUtil","utils/TooltipContent","utils/VisualizationUtil"],function(e,t,i,n,s,a,r,o,l){"use strict";return e.extend({entityType:s.ENTITY_ACROPOLIS_VOLUME_GROUP,modelEvents:{"change   model":"renderDetails","error    model":"renderError","pending  model":"reset"},events:{"click       a.pageLink":"onPageLinkClick","mouseenter  div[ntnxTooltip]":"onToolTipMouseOver","mouseleave  div[ntnxTooltip]":"onTooltipMouseOut"},onToolTipMouseOver:function(e){var t=$(e.currentTarget),i=t.attr("ntnxTooltip"),n=o.getStorageStatsBreakdown(i,this.model);t.tooltip({title:n,placement:"right",trigger:"manual",html:!0,container:$(".block-iqn")}),t.tooltip("show")},onTooltipMouseOut:function(e){$(e.currentTarget).tooltip("destroy")},onPageLinkClick:function(e){n.navigateToPageByPageLink(e.currentTarget)},initializeProperties:function(){this.model=new i,_.bindAll(this,"renderAcropolisVGDetails","renderAcropolisVGDetailsError"),this.render()},render:function(){t=_.template(t),this.$el.html(t(this.vtOptions()));var e={};e[s.TAB_DETAILS.METRICS]="Performance Metrics",e[s.TAB_DETAILS.VIRTUAL_DISKS_WRAP]="Virtual Disks",e[s.TAB_DETAILS.TASKS]="Volume Group Tasks",e[s.TAB_DETAILS.ALERTS]="Volume Group Alerts",this.clusterManager.isMulticlusterNavMode()||(e[s.TAB_DETAILS.EVENTS]="Volume Group Events"),this.tabDetailsView=l.renderTabDetailsView(this.$(".n-tab-details-unit"),e,this.entityType,s.PAGE_STORAGE)},getDataAndRender:function(t){e.prototype.getDataAndRender.apply(this,arguments);var n=new i;n.setId(this.model.getId()),n.fetch({success:this.renderAcropolisVGDetails,error:this.renderAcropolisVGDetailsError}),a.addInLineDonutLoader(this.$(".lblName, .lblDisks, .lblCapacity, .lblFlashMode, .lblInitiators"))},renderDetails:function(){var t=this.model.DP,i=this.model.get(t.NAME),n=this.model.get(t.DISK_LIST)?this.model.get(t.DISK_LIST).length:0;e.prototype.renderDetails.apply(this,arguments),this.$(".lblName").html(i).attr("title",i),this.$(".lblDisks").html(n).attr("title",n)},renderAcropolisVGDetails:function(e){var t=e,i=t.DP,n=0;t.get(i.DISK_LIST)&&t.get(i.DISK_LIST).forEach(function(e){var t=parseInt(e[i.DISK_SIZE],10);t&&(n+=t)}),this.$(".lblFlashMode").html(t.get(i.FLASH_MODE_ENABLED)?"Enabled":"Disabled");var l=[];_.each(t.get(i.ATTACHMENT_LIST),function(e){var t=e[i.INITIATOR_NAME]||e[i.INITIATOR_IP];t&&l.push(t)});var c=l.join(", "),d=_.reduce(l,function(e,t){return e+a.truncateMiddle(t,35)+"<br>"},"");this.$(".lblInitiators").html(d||s.UNDEFINED_ENTITIES_GROUP).attr("title",c),this.$(".lblName-prefix").html(s.NUTANIX_IQN_PREFIX+t.get(i.ISCSI_TARGET_NAME)),this.$(".block-iqn").attr("ntnxTooltip",o.STORAGE_STATS.IQN_PREFIX.ID),n=r.storageFormat(r.convertToBytes(n,r.UOM_MIB)),this.$(".lblCapacity").html(n).attr("title",n)},renderAcropolisVGDetailsError:function(e){this.$(".lblCapacity").html(s.STATS_NOT_AVAILABLE).attr("title","")}})}),define("views/pages/storage/details/StorageTabDetailsView",["views/basecomponents/details/BaseDetailsView","text!templates/pages/storage/details/StorageTabDetailsView.html","models/cluster/ClusterModel","models/storage/StoragePoolCollection","models/storage/ContainerCollection","models/hardware/DiskCollection","managers/NavigationManager","views/pages/storage/details/StoragePoolTabDetailsEntityView","views/pages/storage/details/ContainerTabDetailsEntityView","views/pages/storage/details/VolumeGroupTabDetailsEntityView","utils/AppConstants","utils/AppUtil","utils/StatsUtil","utils/CommonTemplates","utils/VisualizationUtil"],function(e,t,i,n,s,a,r,o,l,c,d,u,h,p,T){"use strict";return e.extend({pageId:d.PAGE_STORAGE,summaryTemplate:_.template(t),spCollection:null,containerCollection:null,model:null,events:{"click  .linkRowItem":"onClickLinkRowItem"},modelEvents:{"reset  spCollection":"renderStoragePoolViews","reset  containerCollection":"renderContainerViews","change model":"renderClusterViews","reset  model":"renderClusterViews"},initializeProperties:function(){this.spCollection=new n,this.containerCollection=new s,this.isClusterFFEnabled(d.FFLAGS.ARITHMOS_USAGE_STATS)?(this.clusterManager.isMulticlusterNavMode()?(this.model=new i,this.model.setProjection([d.PROJECTION.USAGE_STATS])):this.model=this.clusterManager.getCurrentClusterModel(),this.model.alwaysTriggerChange=!0):this.model=new a},render:function(){var e={};e[d.TAB_DETAILS.USAGE]="Usage Summary",e[d.TAB_DETAILS.METRICS]="Performance Summary",e[d.TAB_DETAILS.ALERTS]="Storage Alerts",this.clusterManager.isMulticlusterNavMode()||(e[d.TAB_DETAILS.EVENTS]="Storage Events"),this.tabDetailsView=T.renderTabDetailsView(this.$(".n-tab-details-unit"),e,d.ENTITY_CLUSTER,d.PAGE_STORAGE),this.storeToDetailsEntityMap(d.ENTITY_STORAGE_POOL,new o({el:this.getDetailsEntityElement(d.ENTITY_STORAGE_POOL)})),this.storeToDetailsEntityMap(d.ENTITY_CONTAINER,new l({el:this.getDetailsEntityElement(d.ENTITY_CONTAINER)})),this.storeToDetailsEntityMap(d.ENTITY_ACROPOLIS_VOLUME_GROUP,new c({el:this.getDetailsEntityElement(d.ENTITY_ACROPOLIS_VOLUME_GROUP)}))},getDataAndRender:function(){this.spCollection.fetch(),this.containerCollection.fetch(),this.model.isPolling()||this.model.startPolling()},postActivateSummary:function(){this.model.isPolling()||this.model.startPolling()},postDeactivateSummary:function(){this.model.stopPolling()},renderClusterViews:function(){var e=this.model.getTotalMaxCapacity(),t=this.model.getTotalUsedPhysical(),i=this.model.getTotalUsedPercentagePhysical(),n=this.model.getTotalAvailablePhysical();this.setDOM(".lblAvailPhysical",h.storageFormat(n)),this.setDOM(".lblUsedPhysical",h.storageFormat(t)),this.setDOM(".lblPercentUsed",i),this.setDOM(".lblCapacityPhysical",h.storageFormat(e))},renderStoragePoolViews:function(){var e,t,i=this.spCollection.models,n=this.$el.find(".listStoragePool");$(n).empty();for(var s=0;s<i.length;s++)t=u.convertModelToNavItemModel(i[s],d.ENTITY_STORAGE_POOL,d.ACTION_DETAILS),e=_.template(p.LIST_ITEM_LINK,{model:t}),$(n).append(e)},renderContainerViews:function(){var e,t,i=this.containerCollection.models,n=this.$el.find(".listContainer");$(n).empty();for(var s=0;s<i.length;s++)t=u.convertModelToNavItemModel(i[s],d.ENTITY_CONTAINER,d.ACTION_DETAILS),e=_.template(p.LIST_ITEM_LINK,{model:t}),$(n).append(e)},onClickLinkRowItem:function(e){r.updateRouteOption(e.currentTarget)}})}),define("views/pages/storage/StoragePageView",["views/basecomponents/pages/BasePageView","views/pages/storage/diagram/StorageDiagramView","views/pages/storage/details/StorageTabDetailsView","views/basecomponents/vantagepoints/DashboardView","views/basecomponents/datatables/DataTableGroupView","utils/AppConstants"],function(e,t,i,n,s,a){"use strict";return e.extend({pageId:a.PAGE_STORAGE,defaultSubPageId:a.SUBPAGE_PERSPECTIVE,initialize:function(t){e.prototype.initialize.apply(this,arguments),this.isMulticlusterPageUuid()&&(this.defaultSubPageId=a.SUBPAGE_TABLE)},onShowSubPage:function(e,i){var r,o,l;switch(e){case a.SUBPAGE_PERSPECTIVE:r=this.getSubView(e),r||(r=this.registerSubView(e,new n({el:this.getSubPageElement(e),dashboard:a.PERSPECTIVE_STORAGE}))),r.show(i);break;case a.SUBPAGE_DIAGRAM:o=this.getSubView(e),o||(o=this.registerSubView(e,new t({el:this.getSubPageElement(e)})));break;case a.SUBPAGE_TABLE:l=this.getSubView(e),l||(l=this.registerSubView(e,new s({el:this.getSubPageElement(e),pageId:a.PAGE_STORAGE,eventBus:this.eventBus})))}o=o||this.getSubView(a.SUBPAGE_DIAGRAM),o&&o.show(i),(l=l||this.getSubView(a.SUBPAGE_TABLE))&&l.show(i)},onChangeDetailsPane:function(e){var t=this.getSubView(a.SUBPAGE_COMPONENT_DETAILS);t||(t=this.registerSubView(a.SUBPAGE_COMPONENT_DETAILS,new i({el:this.getDetailsElement(),eventBus:this.eventBus}))),t.show(e)}})}),define("text!templates/pages/hardware/diagram/HardwareDiagramView.html",[],function(){return'\x3c!-- Container for the hardware diagram. Contains the scrollbar as well. --\x3e\n<div class="n-hardware-diagram-container">\n  <div class="antiscroll-wrap">\n    <div class="box-wrap">\n      <div class="antiscroll-inner">\n        <div class="box-inner  diagramHardware">\n          \x3c!-- @view: block views go here... --\x3e\n          <div class="diagramLoading">Loading...</div>\n        </div>\n      </div>\n    </div>\n  </div>\n</div>'}),define("text!templates/basecomponents/diagrams/hardware/Block2U4NodeView.html",[],function(){return'\x3c!-- Header --\x3e\n<div class="n-hardware-block-header">\n  <span class="n-hardware-block-model">\n    <%= model.blockModelName || model.blockModel %>\n  </span>\n  (<h4><%= model.blockSerial %></h4>)\n</div>\n\n\x3c!-- Inner (contains the disk and host/node) --\x3e\n<div class="n-hardware-block-inner-4-node">\n\n  \x3c!-- Disk Group --\x3e\n  <div class="n-hardware-disk-group-4-node">\n\n    \x3c!-- @view: Disk groups go here --\x3e\n    <%= diskTemplateGroup %>\n\n  </div>\n\n  \x3c!-- Hosts --\x3e\n  <div class="n-hardware-host-group-4-node">\n\n    \x3c!-- @view: Host group goes here --\x3e\n    <%= hostTemplateGroup %>\n\n  </div>\n\n</div>'}),define("text!templates/basecomponents/diagrams/hardware/Block2U2NodeView.html",[],function(){return'\x3c!-- Header --\x3e\n<div class="n-hardware-block-header">\n  <span class="n-hardware-block-model">\n    <%= model.blockModelName || model.blockModel %>\n  </span>\n  (<h4><%= model.blockSerial %></h4>)\n</div>\n\n\x3c!-- Inner (contains the disk and host/node) --\x3e\n<div class="n-hardware-block-inner-2-node n-clearfix">\n  \x3c!-- Disk Group --\x3e\n  <div class="n-hardware-disk-group-2-node n-clearfix">\n    \x3c!-- @view: Disk groups go here --\x3e\n    <%= diskTemplateGroup %>\n  </div>\n\n  \x3c!-- Hosts --\x3e\n  <div class="n-hardware-host-group-2-node n-clearfix">\n    \x3c!-- @view: Host group goes here --\x3e\n    <%= hostTemplateGroup %>\n  </div>\n</div>'}),define("text!templates/basecomponents/diagrams/hardware/Block2U1NodeView.html",[],function(){return'\x3c!-- Header --\x3e\n<div class="n-hardware-block-header">\n  <span class="n-hardware-block-model">\n    <%= model.blockModelName || model.blockModel %>\n  </span>\n  (<h4><%= model.blockSerial %></h4>)\n</div>\n\n\x3c!-- Inner (contains the disk and host/node) --\x3e\n<div class="n-hardware-block-inner-1-node">\n\n  \x3c!-- Disk Group --\x3e\n  <div class="n-hardware-disk-group-1-node">\n\n    \x3c!-- @view: Disk groups go here --\x3e\n    <%= diskTemplateGroup %>\n\n  </div>\n\n  \x3c!-- Hosts --\x3e\n  <div class="n-hardware-host-group-1-node">\n\n    \x3c!-- @view: Host group goes here --\x3e\n    <%= hostTemplateGroup %>\n\n  </div>\n\n</div>'}),define("views/basecomponents/diagrams/hardware/BlockView",["views/basecomponents/BaseView","managers/AlertManager","data/DataProperties","text!templates/basecomponents/diagrams/hardware/Block2U4NodeView.html","text!templates/basecomponents/diagrams/hardware/Block2U2NodeView.html","text!templates/basecomponents/diagrams/hardware/Block2U1NodeView.html","events/AppEvents","utils/AppUtil","utils/BlockUtil"],function(e,t,i,n,s,a,r,o,l){"use strict";var c=_.template(n),d=_.template(s),u=_.template(a);return e.extend({className:"n-hardware-block-outer",events:{"click  .n-hardware-selectable":"onClickHarwareComponent"},render:function(){var e,t=this.model.get(i.BLOCK_MODEL),n=l.createDiskTemplateGroup(this.model),s=l.createHostTemplateGroup(this.model);return l.is4Node2U(t)?e=c:l.is2Node2U(t)?e=d:l.is1Node2U(t)&&(e=u),this.$el.html(e({model:this.model.toJSON(),diskTemplateGroup:n,hostTemplateGroup:s})),this},destroy:function(){o.debug("BlockView : destroy:  | viewid     : "+this.cid),t.destroyAllPopOvers(this.$el),e.prototype.destroy.apply(this,arguments)},onClickHarwareComponent:function(e){this.trigger(r.HARDWARE_DIAGRAM_SHOW_DETAILS,e)},updateStatsData:function(e){}})}),define("text!templates/basecomponents/diagrams/hardware/uselayout/BlockLayoutOuterView.html",[],function(){return'\x3c!-- Header --\x3e\n<div class="n-hardware-block-header">\n  <span class="n-hardware-block-model">\n    <%= model.blockModelName || model.blockModel || \'\' %>\n  </span>\n  <% if (model.blockSerial) { %>\n    (<h4><%=model.blockSerial%></h4>)\n  <% } %>\n</div>\n\x3c!-- Inner (contains the disk and host/node) --\x3e\n<div class="n-hardware-block-inner-use-layout\n  <%= chassisSize ? \'unit-size-\'+chassisSize : \'\' %>">\n  <%= layoutEl || \'\' %>\n  <div class="nvme-wrapper hide">\n    <div class="nvme-header"><%=i18n(\'active_nvme_drives\')%></div>\n    <table class="nvme-box nvmeBox">\n    </table>\n  </div>\n</div>'}),define("views/basecomponents/diagrams/hardware/BlockLayoutView",["views/basecomponents/diagrams/hardware/BlockView","text!templates/basecomponents/diagrams/hardware/uselayout/BlockLayoutOuterView.html","utils/AppConstants","utils/AppUtil","utils/TooltipContent","data/DataProperties","managers/ActionManager"],function(e,t,i,n,s,a,r){"use strict";var o=_.template(t),l=_.template(n.trimmedTemplate('\n      <tr>\n        <td class="nvmeDrive<%=dataStatus ? \' -critical\' : \'\'%>"\n          actionTargetName="<%= actionTargetName%>"\n          actionTarget="<%=actionTarget%>"\n          actionTargetId="<%= actionTargetId%>"\n          action="<%=action%>"\n          data-id="<%=dataId%>"\n          data-status="<%=dataStatus%>">\n          <%=i18n("nvme_drive")%><%=dataId%>\n            <%if(dataStatus){ %>\n              <span class="alert-icon">\n                <%=Components.icon("exclamation_badge", "-inline -critical")%>\n              </span>\n            <%}%>\n        </td>\n      </tr>\n    ',!0)),c=_.template('\n      <tr class="link-row">\n        <td><a class="missingLink" actionTarget="nvme_drive">\n          <%=i18n(\'missing_nvme_drives\')%></a>\n        </td>\n      </tr>\n      ');return e.extend({className:"n-hardware-block-outer",name:"BlockLayoutView",initialize:function(e){e=e||{},this.addExtraEvents({"click .missingLink":"_onClickLinkAction","click .nvmeDrive":"onClickNVMeEntry"})},render:function(){var e=this.model.toJSON(),t=2;return this.isLenovoNestedSeries(e)?(4,t="hx-nested"):e.hwConfigs&&e.hwConfigs.length&&e.hwConfigs[0].layoutJSON&&e.hwConfigs[0].layoutJSON.chassis&&e.hwConfigs[0].layoutJSON.chassis.height_u&&void 0!==e.hwConfigs[0].layoutJSON.chassis.height_u&&(e.hwConfigs[0].layoutJSON.chassis.height_u,t=e.hwConfigs[0].layoutJSON.chassis.height_u),this.$el.html(o(this.vtOptions({model:e,layoutEl:this.getHardwareDiagram(),chassisSize:t}))),this.isLenovoSR950(e)&&this.renderNVMeLogicalDiagram(),this.$(".n-info-icon").tooltip({title:s.HARDWARE_DIAGRAM_NONSKEUOMORPHIC,placement:"top",trigger:"hover",html:!0}),this.$(".n-skeuomorphic-layout").hasClass(i.NESTEDDISK)?(this.$(".n-hardware-block-inner-use-layout").addClass(i.NESTEDDISK),this.$(".n-skeuomorphic-layout").removeClass(i.NESTEDDISK)):this.$(".n-skeuomorphic-layout").hasClass(i.VOYAGER)&&(this.$(".n-hardware-block-inner-use-layout").addClass(i.VOYAGER),this.$(".n-skeuomorphic-layout").removeClass(i.VOYAGER)),this},isLenovoNestedSeries:function(e){var t=[i.HW_MODEL_NAMES.MODEL_HX3720,i.HW_MODEL_NAMES.MODEL_HX2720E,i.HW_MODEL_NAMES.MODEL_HX3721];return e&&-1!==t.indexOf(e.blockModelName)},isLenovoSR950:function(e){if(n.getObjectPathValue(e.hwConfigs,"0.layoutJSON.node.nvme")){return e.hwConfigs[0].layoutJSON.node.nvme.class===i.LENOVO_SR950_NVME_CLASS}return!1},getHardwareDiagram:function(){return""},renderNVMeLogicalDiagram:function(){this.$(".n-hardware-block-inner-use-layout").addClass(i.NVMEDISK),this.$("nvme-wrapper").removeClass("hide");var e=this.model.get("disks"),t=_.filter(e,function(e){return e[a.TIER_NAME]===i.DISK_TIER.PCIE}),n=t.length?_.map(t,this.createNVMeItem,this).join(""):'<tr class="no-active-label">\n              <td>'+this.i18n("no_active_nvme")+"</td></tr>";this.$(".nvmeBox").html(n),this.$('.nvmeDrive[data-status="unmounted"]').tooltip({title:this.i18n("unmounted_nvme_drive"),placement:"top",html:"true",trigger:"hover",container:"body"}),this.$('.nvmeDrive[data-status="being-removed"]').tooltip({title:this.i18n("nvme_being_removed"),placement:"top",html:"true",trigger:"hover",container:"body"}),this.$(".nvmeBox").append(c(this.vtOptions()))},createNVMeItem:function(e,t){var n=e[a.NAME],s=e[a.ID],r=e[a.DISK_HW_CONFIG],o=r&&!r[a.DISK_HW_CONFIGS_DISK_MOUNTED],c=e[a.DISK_STATUS]===i.DISK_STATUS.DATA_MIGRATION_INITIATED||e[a.DISK_STATUS]===i.DISK_STATUS.MARKED_FOR_REMOVAL_BUT_NOT_DETACHABLE,d=void 0;return o?d="unmounted":c&&(d="being-removed"),l(this.vtOptions({actionTarget:i.ENTITY_DISK,action:i.ACTION_DETAILS,actionTargetName:n,actionTargetId:s,dataId:t+1,dataStatus:d}))},destroy:function(){n.debug("BlockLayoutView : destroy:  | viewid     : "+this.cid),this.$(".n-info-icon").tooltip("destroy"),e.prototype.destroy.apply(this,arguments)},_onClickLinkAction:function(e){r.executeActionElement(e.currentTarget)},onClickNVMeEntry:function(e){this.$("tr").removeClass("selected"),$(e.currentTarget).closest("tr").addClass("selected"),this.onClickHarwareComponent(e)}})}),define("text!templates/basecomponents/diagrams/hardware/uselayout/BlockNonSkeuomorphicLayoutView.html",[],function(){return'<%\n  var hostIdProp = DataProp.SERVICE_VM_ID,\n      hosts = blockModel.hosts || [],\n      disks = _.sortBy(blockModel.disks, hostIdProp),\n      powerSupplies = [];\n\n  if ( (blockModel.hwConfigs.length > 0) &&\n       (blockModel.hwConfigs[0].layoutJSON) &&\n       (blockModel.hwConfigs[0].layoutJSON.chassis) &&\n       (blockModel.hwConfigs[0].layoutJSON.chassis.power_supplies) ) {\n    powerSupplies = blockModel.hwConfigs[0].layoutJSON.chassis.power_supplies;\n  }\n%>\n<div class="n-non-skeuomorphic-layout">\n  \x3c!-- Upper Row --\x3e\n  <div class="n-upper-row">\n    \x3c!-- Hosts --\x3e\n    <div class="n-host-group">\n      <div class="n-group-label">\n        <%= hosts.length + \' \' + (hosts.length === 1 ? \'Host\' : \'Hosts\') %>\n      </div>\n      <div class="n-host-container">\n        <% _.each(hosts, function(host) { %>\n            <div class="n-host  n-hardware-selectable"\n                actionTargetId="<%= host.id || \'\' %>"\n                actionTargetName="<%= host.name || \'\' %>"\n                actionTarget="<%= AppConstants.ENTITY_HOST %>"\n                action="details">\n\n              \x3c!-- Alert Widget will be placed here by the AlertManager. --\x3e\n              <div class="n-alert-diagram-indicator"\n                  actionTargetId="<%= host.id || \'\' %>"\n                  actionTargetName="<%= host.name || \'\' %>"\n                  actionTarget="<%= AppConstants.ENTITY_HOST %>"\n                  type="<%=AppConstants.ALERT_DIAGRAM_TYPE.NONSKEUOMORPHIC %>">\n              </div>\n\n            </div>\n        <% }); %>\n      </div>\n    </div>\n    \x3c!-- Power Supplies --\x3e\n    <div class="n-power-supply-group">\n      <div class="n-group-label">\n        <%= powerSupplies.length + \' \' + (powerSupplies.length === 1 ?\n            \'Power Supply\' : \'Power Supplies\') %>\n      </div>\n      <div class="n-power-supply-container">\n        <% _.each(powerSupplies, function(powerSupply) { %>\n            <div class="n-power-supply"\n                actionTargetId="<%= blockModel.blockSerial %>"\n                actionTarget="<%= AppConstants.ENTITY_POWER_SUPPLY %>">\n              <i data-icon="N"\n                 aria-hidden="true"\n                 class="power-supply-icon"></i>\n            </div>\n        <% }); %>\n      </div>\n    </div>\n  </div>\n  \x3c!-- Lower Row --\x3e\n  <div class="n-lower-row">\n    \x3c!-- Disks --\x3e\n    <div class="n-disk-group">\n      <div class="n-group-label">\n        <%= disks.length + \' \' + (disks.length === 1 ? \'Disk\' : \'Disks\') %>\n      </div>\n      <div class="n-disk-container">\n        <%  var lastHostId, hddClass = \'\';\n            _.each(disks, function(disk) {\n                hddClass = \'n-disk-\' + disk.storageTierName.toLowerCase();\n        %>\n              <div class="n-disk  n-hardware-selectable\n                          n-alert-highlight-indicator <%= hddClass %>"\n                  actionTargetId="<%= disk.id || \'\' %>"\n                  actionTargetName="<%= disk.name || \'\' %>"\n                  actionTarget="<%= AppConstants.ENTITY_DISK %>"\n                  action="details">\n              </div>\n\n              <%  if (typeof lastHostId !== \'undefined\' &&\n                      lastHostId !== disk[hostIdProp]) {\n              %>\n                    <div class="n-disk-group-separator"></div>\n              <%  } %>\n\n              <% lastHostId = disk[hostIdProp]; %>\n\n        <%  }); %>\n      </div>\n    </div>\n  </div>\n  \x3c!-- Info --\x3e\n  <div class="n-info-icon-container">\n    <div style="position:relative">\n      <div class="n-info-icon">i</div>\n    </div>\n  </div>\n</div>'}),define("views/basecomponents/diagrams/hardware/BlockLayoutNonSkeuomorphicView",["views/basecomponents/diagrams/hardware/BlockLayoutView","data/DataProperties","text!templates/basecomponents/diagrams/hardware/uselayout/BlockNonSkeuomorphicLayoutView.html","utils/AppConstants"],function(e,t,i,n){"use strict";var s=_.template(i);return e.extend({getHardwareDiagram:function(){return s({blockModel:this.model.toJSON(),AppConstants:n,DataProp:t})}})}),define("text!templates/basecomponents/diagrams/hardware/uselayout/BlockSkeuomorphicLayoutView.html",[],function(){return'<% var entityClass, targetId, targetName, fullTargetName,\n       targetLocation, singleNode, isNested; %>\n\n<div class="n-skeuomorphic-layout <%= isNested%>">\n  <div class="n-chassis">\n    <%\n      if(entitiesMap && entitiesMap[DataProp.BLOCK_HOSTS]) {\n        _.each(entitiesMap[DataProp.BLOCK_HOSTS], function(elem) {\n          if (elem.entity && elem.position) {\n            if (elem.entity.entityInfo) {\n              entityClass = \'n-hardware-selectable\';\n              targetId = elem.entity.entityInfo.id || \'\';\n              fullTargetName = elem.entity.entityInfo.name || \'\';\n              targetName =\n                AppUtil.truncateMiddle(elem.entity.entityInfo.name, 8) || \'\';\n              singleNode = (elem.singleHost)? \'single-node\' : \'\';\n            } else {\n              entityClass = \'n-hardware-blank\';\n              targetId = \'\';\n              fullTargetName = \'\';\n              targetName = \'\';\n              singleNode = \'\';\n            }\n    %>\n\n    \x3c!-- Display all the hosts within the block --\x3e\n    <div class="n-wrapper"\n         style="top:<%=elem.position.topPx%>px;\n                left:<%=elem.position.leftPx%>px;\n                width:<%=elem.position.widthPx%>px;\n                height:<%=elem.position.heightPx%>px;">\n\n      <div class="<%= entityClass %> n-hardware-host n-entities <%=singleNode%>"\n           style="width:<%= (elem.position.widthPx - margin)%>px;\n                  height:<%= (elem.position.heightPx - margin)%>px;"\n           actionTargetId="<%= targetId %>"\n           actionTargetName="<%= fullTargetName %>"\n           actionTarget="<%= AppConstants.ENTITY_HOST %>"\n           action="details">\n\n        <div class="n-hardware-host-label"\n             title="<%= fullTargetName %>">\n          <%= targetName %>\n        </div>\n\n        <div class="n-alert-diagram-indicator"\n             actionTargetId="<%= targetId %>"\n             actionTargetName="<%= targetName %>"\n             actionTarget="<%= AppConstants.ENTITY_HOST %>"\n             type="<%= AppConstants.ALERT_DIAGRAM_TYPE.SKEUOMORPHIC %>">\n        </div>\n      </div>\n    </div>\n\n    <% } }); } %>\n\n    <%\n      if(entitiesMap && entitiesMap[DataProp.BLOCK_DISKS]) {\n        _.each(entitiesMap[DataProp.BLOCK_DISKS], function(elem) {\n\n          var diskSize = null;\n          if (elem.entity && elem.position) {\n\n            // The container begins to crop the text under 15px height\n            // so assign a CSS class to adjust its position.\n            if ((elem.position.heightPx - margin) < 15) {\n              diskSize = \'compact\';\n            }\n\n            if (elem.entity.entityInfo) {\n              entityClass = \'n-hardware-selectable\';\n              targetId = elem.entity.entityInfo.id || \'\';\n              targetName = elem.entity.entityInfo.name || \'\';\n              targetLocation = elem.entity.slot_designation || \'\';\n            } else {\n              entityClass = \'n-hardware-blank\';\n              targetId = \'\';\n              targetName = \'\';\n              targetLocation = \'\';\n            }\n    %>\n\n    \x3c!-- Display all the disks within the block --\x3e\n    <div class="n-wrapper"\n         style="top:<%=elem.position.topPx%>px;\n                left:<%=elem.position.leftPx%>px;\n                width:<%=elem.position.widthPx%>px;\n                height:<%=elem.position.heightPx%>px;">\n\n      <div class="<%= entityClass %> n-hardware-disk n-entities\n                  n-alert-highlight-indicator"\n           style="width:<%= (elem.position.widthPx - margin)%>px;\n                  height:<%= (elem.position.heightPx - margin)%>px;"\n           actionTargetId="<%= targetId %>"\n           actionTargetName="<%= targetName %>"\n           actionTarget="<%= AppConstants.ENTITY_DISK %>"\n           action="details"\n           hostId="<%= elem.hostId %>"\n           position="<%= elem.slotPosition %>">\n\n        <div class="n-hardware-disk-label <%= diskSize ? diskSize : \'\' %>"\n             slotDesignation="<%= elem.entity.slot_designation %>">\n          <%= targetLocation %>\n        </div>\n\n      </div>\n    </div>\n    <% } }); } %>\n\n    <%\n      if(entitiesMap && entitiesMap[DataProp.BLOCK_PS]) {\n        _.each(entitiesMap[DataProp.BLOCK_PS], function(elem) {\n          if (elem.position) {\n            targetName = elem.entity.description || \'\';\n    %>\n\n    \x3c!-- Display all the power supplies within the block --\x3e\n    <div class="n-wrapper"\n         style="top:<%=elem.position.topPx%>px;\n                left:<%=elem.position.leftPx%>px;\n                width:<%=elem.position.widthPx%>px;\n                height:<%=elem.position.heightPx%>px;">\n\n      <div class="n-entities n-power-supplies n-alert-highlight-indicator"\n           style="width:<%= (elem.position.widthPx - margin)%>px;\n                  height:<%= (elem.position.heightPx - margin)%>px;"\n           actionTargetId="<%= blockSerial %>"\n           actionTarget="<%= AppConstants.ENTITY_POWER_SUPPLY %>"\n           actionTargetName="<%=targetName%>">\n\n        <i data-icon="N" aria-hidden="true" class="power-supply-icon"></i>\n\n      </div>\n    </div>\n    <% } }); } %>\n    </div>\n</div>'}),define("views/basecomponents/diagrams/hardware/BlockLayoutSkeuomorphicView",["views/basecomponents/diagrams/hardware/BlockLayoutView","data/DataProperties","text!templates/basecomponents/diagrams/hardware/uselayout/BlockSkeuomorphicLayoutView.html","utils/AppConstants","utils/BlockConstants","utils/AppUtil"],function(e,t,i,n,s,a){"use strict";var r=_.template(i);return e.extend({_updateEntities:function(e,t,i,n){_.each(e,function(e){var s=e.entity.location,a=i/2;this.isLenovoNestedSeries(n)||(a=a>1?1:a),s&&(e.position={leftPx:s.cell_x*t[s.access_plane-1].cellWidth,topPx:(s.cell_y*t[s.access_plane-1].cellHeight+t[s.access_plane-1].offsetFTop)*a,widthPx:s.width*t[s.access_plane-1].cellWidth,heightPx:s.height*t[s.access_plane-1].cellHeight*a})}.bind(this))},getHardwareDiagram:function(){var e,i,o,l,c=this.model.toJSON(),d=[],u=0,h=[],p=!1,T=!1,E=!1,g="";if(c.hwConfigs&&c.hwConfigs.length&&c.hwConfigs[0].layoutJSON&&c.hwConfigs[0].layoutJSON.chassis&&c.hwConfigs[0].layoutJSON.chassis.access_planes&&c.hwConfigs[0].layoutJSON.chassis.access_planes.length){o=this.model.getMinHostsForNxModel(),E=o&&o>2,_.each(c.hwConfigs,function(i){if(T||(e=i.layoutJSON.chassis,_.each(e.access_planes,function(t){h[t.id-1]={cellWidth:t.columns>0?s.BLOCK_DIM.WIDTH/t.columns:0,cellHeight:t.rows>0?s.BLOCK_DIM.HEIGHT/t.rows:0,offsetFTop:0},
1!==e.access_planes.length&&(h[t.id-1].cellHeight*=E?1===t.id?s.BLOCK_DIM.FRONT_HEIGHT:s.BLOCK_DIM.REAR_HEIGHT:.5,2===t.id&&(h[t.id-1].offsetFTop=E?s.BLOCK_DIM.HEIGHT*s.BLOCK_DIM.FRONT_HEIGHT:.5*s.BLOCK_DIM.HEIGHT))}),T=!0),l=1===e.num_nodes,i.layoutJSON&&i.layoutJSON.node&&(d[u++]={entity:i.layoutJSON.node,entityType:t.BLOCK_HOSTS,singleHost:l,position:null},i.layoutJSON.node.diskMappings&&i.layoutJSON.node.diskMappings.length&&_.each(i.layoutJSON.node.diskMappings,function(e,n){d[u++]={entity:e,entityType:t.BLOCK_DISKS,position:null,slotPosition:e.slot_id||n+1,hostId:i[t.SERVICE_VM_ID]}}),!this.isLenovoNestedSeries(c))){var a=i.layoutJSON.node.location.height,r=i.layoutJSON.node.diskMappings[0].location.cell_y,o=i.layoutJSON.node.model_string,S=i.layoutJSON.node.location.cell_y;r>0&&r<S+a&&(g=o===n.VOYAGERTDC||o===n.VOYAGERTDC2?n.VOYAGER:n.NESTEDDISK)}!p&&i.layoutJSON&&i.layoutJSON.chassis&&i.layoutJSON.chassis.power_supplies&&(_.each(i.layoutJSON.chassis.power_supplies,function(e){d[u++]={entity:e,entityType:t.BLOCK_PS,position:null}}),p=!0)}.bind(this));var S=2;this.isLenovoNestedSeries(c)?S=4:c.hwConfigs[0].layoutJSON.chassis.height_u&&void 0!==c.hwConfigs[0].layoutJSON.chassis.height_u&&(S=c.hwConfigs[0].layoutJSON.chassis.height_u),this._updateEntities(d,h,S,c)}return d&&d.length&&(i=_.groupBy(d,"entityType")),r({blockSerial:c.blockSerial,entitiesMap:i,DataProp:t,AppConstants:n,AppUtil:a,margin:s.BLOCK_DIM.MARGIN,isNested:g})}})}),define("views/pages/hardware/diagram/BlockGroupView",["views/basecomponents/BaseView","models/hardware/HardwareConfigurationCollection","managers/NavigationManager","data/DataProperties","views/basecomponents/diagrams/hardware/BlockView","views/basecomponents/diagrams/hardware/BlockLayoutNonSkeuomorphicView","views/basecomponents/diagrams/hardware/BlockLayoutSkeuomorphicView","events/AppEvents","utils/AppUtil","utils/BlockUtil","utils/SubViewHelper"],function(e,t,i,n,s,a,r,o,l,c,d){"use strict";return e.extend({className:"n-hardware-block-group",blockCollection:null,hwConfigCollection:null,subViewHelper:null,useSkeuomorphic:!0,initialize:function(){this.subViewHelper=new d,this.hwConfigCollection=new t},render:function(){return this},renderBlocks:function(e,t){this.blockCollection=c.createBlockCollection(e,t),this.subViewHelper.removeAll(),this.$el.empty();var i=this;this.hwConfigCollection.fetch({success:function(){i._renderBlockCollection()},error:function(){l.log("BlockGroupView : Error fetching HardwareConfigurationModel. It means this cluster does not have JSON layout config and we have to render the old models."),i._renderBlockCollection()}})},_updateBlockModelWithHwConfigData:function(e,t){var i,s=_.groupBy(e.get(n.BLOCK_DISKS),n.SERVICE_VM_ID);_.each(_.keys(t),function(a){e.get(n.BLOCK_SERIAL)===a&&(_.each(t[a],function(t){try{t.layoutJSON=t.layoutJSON.replace(/\\"/g,'"').replace(/\\n/g,""),t.layoutJSON=JSON.parse(t.layoutJSON),s&&t.layoutJSON&&t.layoutJSON.node&&(t.layoutJSON.node.diskMappings=this._getDiskMappings(s,t.layoutJSON.node,t.serviceVMId)),i=_.find(e.get(n.BLOCK_HOSTS),function(e){return e.id===t.serviceVMId}),i&&t.layoutJSON&&t.layoutJSON.node&&(t.layoutJSON.node.entityInfo=i)}catch(e){l.log("HardwareConfigurationModel : Error parsing JSON data for block: "+a,e),t.layoutJSON={}}},this),e.set(n.BLOCK_HWCONFIG,t[a]))},this)},_getDiskMappings:function(e,t,i){var n=[],s=!1;return t&&t.storage_controllers&&t.storage_controllers.length&&(t.storage_controllers[0].mapping&&t.storage_controllers[0].mapping.length&&t.storage_controllers[0].mapping[0].slot_id&&(s=!0),_.each(t.storage_controllers,function(e){_.each(e.mapping,function(e){n.push(e)})}),t.nvme&&_.each(t.nvme.mapping,function(e){var t=!1;_.some(n,function(i){if(e.slot_id===i.slot_id)return t=!0,!0}),t||n.push(e)}),_.each(e[i],function(e){var t;(t=s?_.find(n,function(t){return t.slot_id===e.location}):n[e.location-1])&&(t.entityInfo=e,t.slot_id=e.location)})),n},_renderBlockCollection:function(){var e,t,i=this.hwConfigCollection.toJSON();i&&i.length&&(t=_.groupBy(i,n.BLOCK_SERIAL)),_.each(this.blockCollection.models,function(i){t&&t[i.get(n.BLOCK_SERIAL)]?(this._updateBlockModelWithHwConfigData(i,t),e=this.useSkeuomorphic?new r({model:i}):new a({model:i})):e=new s({model:i}),this.$el.append(e.render().el),e.on(o.HARDWARE_DIAGRAM_SHOW_DETAILS,this.onShowHardwareDetails),this.subViewHelper.register(e.cid,e)},this),this.trigger(o.HARDWARE_DIAGRAM_FINISH_RENDER)},destroy:function(){this.subViewHelper.removeAll(),this.subViewHelper=null,e.prototype.destroy.apply(this,arguments)},onShowHardwareDetails:function(e){i.updateRouteOption(e.currentTarget)},updateStatsData:function(e){}})}),define("views/pages/hardware/diagram/HardwareDiagramView",["views/basecomponents/diagrams/BaseDiagramView","text!templates/pages/hardware/diagram/HardwareDiagramView.html","views/pages/hardware/diagram/BlockGroupView","models/alert/AlertCollection","models/hardware/HostCollection","models/hardware/DiskCollection","models/hardware/DiskModel","utils/AppConstants","utils/AppUtil","utils/AntiscrollUtil","utils/AlertUtil","data/DataProperties","events/AppEvents"],function(e,t,i,n,s,a,r,o,l,c,d,u,h){"use strict";return e.extend({hostCollection:null,diskCollection:null,powerSupplyAlertCollection:null,blockGroupView:null,_hostCount:0,_diskCount:0,_hostMap:null,modelEvents:{"reset  diskCollection":"renderDiskEntities","reset  hostCollection":"renderHostEntities"},initialize:function(){this.hostCollection=new s,this.hostCollection.setProjection([o.PROJECTION.ALERTS]),this.diskCollection=new a,this.diskCollection.setProjection([o.PROJECTION.ALERTS]),this.powerSupplyAlertCollection=new n,this._hostMap={},this.render()},render:function(){this.$el.html(t),this.blockGroupView=new i,this.$(".diagramHardware").append(this.blockGroupView.render().el),_.bindAll(this,"onFinishRenderDiagram"),this.blockGroupView.on(h.HARDWARE_DIAGRAM_FINISH_RENDER,this.onFinishRenderDiagram),c.applyAntiScroll(this.$(".antiscroll-wrap"))},show:function(e){this.isValidForUpdate(e)&&(this.parseOptions(e),0===this._hostCount&&this.getDataAndRender(),this.applySelection())},getDataAndRender:function(){this.hostCollection.startPolling()},renderHostEntities:function(){this._isDiagramReadyToRender()?(this.diskCollection.startPolling({force:!0}),this._hostCount=this.hostCollection.length,this._hostMap={},this._diskCount=0,_.each(this.hostCollection.models,function(e){this._hostMap[e.get(u.SERVICE_VM_ID)]={blockModel:e.get(u.BLOCK_MODEL)}},this)):(this.renderHostAlerts(),this.renderPowerSupplyAlerts(),this.renderBreakFixStyles(),this.disableDetachableEntities())},disableDetachableEntities:function(){this.disableDetachableHosts(),this.disableDetachableDisks()},disableDiagramEntity:function(e){e.length>0&&e.removeClass("n-hardware-selectable").removeClass("n-hardware-selected").removeAttr("action").removeAttr("actionTargetName").removeAttr("actiontargetid").removeAttr("actiontarget").addClass("disabled-element")},disableDetachableHosts:function(){_.each(this.hostCollection.models,function(e){if(e.isDetachable()){var t=e.get(e.idAttribute),i=this.$(".n-hardware-host["+o.NAV_ACTION_TARGET_ID+'="'+t+'"]');this.disableDiagramEntity(i)}},this)},disableDetachableDisks:function(){_.each(this.diskCollection.models,function(e){if(e.isDetachable()){var t=e.get(e.idAttribute),i=this.$(".n-hardware-disk["+o.NAV_ACTION_TARGET_ID+'="'+t+'"]');this.disableDiagramEntity(i)}},this)},renderHostAlerts:function(){_.each(this.hostCollection.models,function(e){var t=e.get(e.idAttribute),i=this.$(".n-alert-diagram-indicator["+o.NAV_ACTION_TARGET_ID+'="'+t+'"]');d.renderAlertWidget({targetEl:i,entityId:t,entityType:o.ENTITY_HOST,alertSummary:e.get(u.ALERT_SUMMARY),alertType:o.ALERT_TYPE_DIAGRAM})},this)},renderDiskAlerts:function(){_.each(this.diskCollection.models,function(e){var t=e.get(u.ALERT_SUMMARY),i=e.get(e.idAttribute),n=this.$("."+o.STYLE_ALERT_HIGHLIGHT_INDICATOR+"["+o.NAV_ACTION_TARGET_ID+'="'+i+'"]');d.renderHighlightAlerts(n,t)},this)},renderPowerSupplyAlerts:function(){var e=this;this.powerSupplyAlertCollection.fetch({data:{alertTypeUuid:o.ALERT_UUID_POWER_SUPPLY_DOWN,resolved:!1},success:function(t,i){var n=e.$("."+o.STYLE_ALERT_HIGHLIGHT_INDICATOR+"["+o.NAV_ACTION_TARGET+'="'+o.ENTITY_POWER_SUPPLY+'"]');_.each(n,function(e){var i=$(e),n=i.attr(o.NAV_ACTION_TARGET_ID),s=i.attr("position"),a=i.attr(o.NAV_ACTION_TARGET_NAME),r=t.getPowerSupplyAlerts(n,s,a);d.renderHighlightAlerts(i,r)},e)},error:function(){l.log("Error in fetching the power supply alerts.")}})},renderDiskEntities:function(){0===this._diskCount?(this._diskCount=this.diskCollection.length,this.$(".diagramLoading").remove(),this.blockGroupView.renderBlocks(this.hostCollection,this.diskCollection),this.onResize()):this.renderDiskAlerts()},_isDiagramReadyToRender:function(){var e=!1,t=!0;return _.each(this.hostCollection.models,function(i){var n=i.get(u.SERVICE_VM_ID);this._hostMap[n]||(e=!0),i.get(u.BLOCK_MODEL)||(t=!1)},this),e=e||this._hostCount!==this.hostCollection.length,e&&t},applySelection:function(){if(this.$(".n-hardware-selected").removeClass("n-hardware-selected"),this.currentEntityId()){var e=this.currentEntityId();this.$("div.n-hardware-selectable:["+o.NAV_ACTION_TARGET_ID+"='"+e+"']").addClass("n-hardware-selected")}},destroy:function(){this.$(".n-hardware-disk").tooltip("destroy"),this.$('[alert-popover="true"], .'+o.STYLE_ALERT_HIGHLIGHT_INDICATOR).popover("destroy"),this.blockGroupView&&(this.blockGroupView.off(h.HARDWARE_DIAGRAM_FINISH_RENDER,this.onFinishRenderDiagram),this.blockGroupView.destroy(),this.blockGroupView=null),e.prototype.destroy.apply(this,arguments)},refreshView:function(){this.hostCollection.fetch({force:!0}),this.diskCollection.fetch({force:!0})},onResize:function(){var e=parseFloat(this.$(".n-hardware-diagram-container").css("max-height")),t=parseFloat(this.$(".n-hardware-diagram-container").css("min-height"));this.$(".diagramHardware").height()>t+50&&this.$(".n-hardware-diagram-container").height(e),c.applyAntiScroll(this.$(".antiscroll-wrap"))},onFinishRenderDiagram:function(){this.renderHostAlerts(),this.renderDiskAlerts(),this.renderPowerSupplyAlerts(),this.renderBreakFixStyles(),this.applySelection(),this.disableDetachableEntities(),c.applyAntiScroll(this.$(".antiscroll-wrap"))},renderBreakFixStyles:function(){_.each(this.hostCollection.toJSON(),function(e){var t=e[u.DISK_HW_CONFIGS],i=e[u.SERVICE_VM_ID];_.each(t,function(e,t){var n=this.$('.n-hardware-disk[hostId="'+i+'"][position="'+t+'"]');if(0===n.length)return void l.debug("diskEl does not exist in slot "+t+" in host "+i);if(n.tooltip("destroy"),!e)return l.debug("diskConfig does not exist for slot "+t+" in host "+i),void(n.hasClass("n-hardware-selectable")&&(n.removeClass("n-hardware-selectable  n-bad-disk  n-unmounted-disk  n-offline").addClass("n-hardware-blank"),n.find(".n-hardware-disk-label").hide()));var s=new r;s.setDiskConfig(e),n.removeClass("n-hardware-blank  n-hardware-selectable  n-bad-disk  n-unmounted-disk  n-offline"),n.addClass("n-hardware-selectable");var a=n.find(".n-hardware-disk-label");a.text()&&0===$.trim(a.text()).length&&(a.attr("slotDesignation")&&a.attr("slotDesignation").length?a.text(a.attr("slotDesignation")):e[u.DISK_HW_CONFIGS_DISK_LOC]&&a.text(e[u.DISK_HW_CONFIGS_DISK_LOC])),$.trim(a.text()).length?a.show():a.hide();var c,d;s.isUnmountedDiskStateOffline()&&(d="n-offline",c="Offline");var h=s.isUnmounted();h&&(d="n-unmounted-disk",c="Unmounted disk"),s.isUnmountedDiskStateBad()&&(d="n-bad-disk",c="Bad disk"),s.isBootDiskOnly()&&(c=(c||"")+" Boot disk only"),n.addClass(d);var p=e[u.DISK_HW_CONFIGS_DISK_SERIAL],T=e[u.DISK_HW_CONFIGS_DISK_ID],E=n.attr(o.NAV_ACTION_TARGET_ID)||"";h||0===E.length||"undefined"===E?n.attr(o.NAV_ACTION_TARGET_ID,l.generateEntityWithoutModelId(p)):!h&&T&&n.attr(o.NAV_ACTION_TARGET_ID,T),c&&n.tooltip({title:c,placement:"top",trigger:"hover",html:!0})},this)},this)},onStartServices:function(){this.delegateEvents(),this.delegateModelEvents(),this.hostCollection.length&&this.hostCollection.startPolling(),this.diskCollection.length&&this.diskCollection.startPolling()},onStopServices:function(){this.undelegateEvents(),this.undelegateModelEvents(),this.hostCollection&&this.hostCollection.stopPolling(),this.diskCollection.length&&this.diskCollection.stopPolling()}})}),define("text!templates/pages/hardware/details/HardwareTabDetailsView.html",[],function(){return'\x3c!-- Wrap --\x3e\n<div class="n-unit-wrap">\n  \x3c!-- Fixed unit --\x3e\n  <div class="n-unit-fixed">\n    \x3c!-- Column 1: Summary --\x3e\n    <div class="n-details-unit">\n      <div class="title">HARDWARE SUMMARY</div>\n      <ul class="n-list-info">\n        \x3c!-- Blocks and Hosts --\x3e\n        <li>\n          <div class="n-info-block">\n            <span class="n-label">Blocks</span>\n            <span class="lblNumberBlocks n-value"\n                data-test="hwSummaryNumberBlocksValue">\n              \x3c!-- @value: value goes here... --\x3e\n            </span>\n          </div>\n        </li>\n        <li>\n          <div class="n-info-block">\n            <span class="n-label">Hosts</span>\n            <span class="lblNumberHosts n-value"\n                data-test="hwSummaryNumberHostsValue">\n              \x3c!-- @value: value goes here... --\x3e\n            </span>\n          </div>\n        </li>\n        \x3c!-- Memory and CPU --\x3e\n        <li>\n          <div class="n-info-block">\n            <span class="n-label">Total Memory</span>\n            <span class="lblMemorySummary n-value"\n                data-test="hwSummaryMemoryValue">\n              \x3c!-- @value: value goes here... --\x3e\n            </span>\n          </div>\n        </li>\n        <li>\n          <div class="n-info-block">\n            <span class="n-label">Total CPU Capacity</span>\n            <span class="lblCpuCapacity n-value"\n                data-test="hwSummaryCpuCapacityValue">\n              \x3c!-- @value: value goes here... --\x3e\n            </span>\n          </div>\n        </li>\n        \x3c!-- Disk --\x3e\n        <li>\n          <div class="n-info-block">\n            <span class="n-label">Disks</span>\n            <ul class="listDisks  n-ul"\n                data-test="hwSummaryDisksValue">\n              \x3c!-- @view: Disk w/ Tier li links go here... --\x3e\n            </ul>\n          </div>\n          <div class="n-clearfix"></div>\n        </li>\n        \x3c!-- Switch --\x3e\n        <li>\n          <div class="n-info-block">\n            <span class="n-label">Network Switches</span>\n           <span class="lblSwitchCount n-value"\n                 data-test="hwSummarySwitchCountValue">\n              \x3c!-- @value: value goes here... --\x3e\n            </span>\n          </div>\n          <div class="n-clearfix"></div>\n        </li>\n        <li>\n          <div class="n-info-block">\n            <span class="n-label">GPUs</span>\n            <span class="lblGraphicsCards n-value"\n                  data-test="hwSummaryGraphicsCardsValue">\n              \x3c!-- @value: graphics cards details goes here... --\x3e\n            </span>\n          </div>\n        </li>\n      </ul>\n    </div>\n  </div>\n  \x3c!-- Fluid unit --\x3e\n  <div class="n-unit-fluid  n-tab-details-unit">\n    \x3c!-- @view: Tab details view goes here... --\x3e\n  </div>\n</div>'}),define("views/pages/hardware/common/HardwareTemplates",[],function(){"use strict";return{LIST_ITEM_TIER:'<li>                            <span class="n-value">                              <%= tierName %>: <%= numberDisks %> disks                            </span>                          </li>'}}),define("text!templates/pages/hardware/details/HostTabDetailsEntityView.html",[],function(){return'\x3c!-- Wrap --\x3e\n<div class="n-unit-wrap">\n  \x3c!-- Fixed unit --\x3e\n  <div class="n-unit-fixed">\n    \x3c!-- Column 1: Summary --\x3e\n    <div class="n-details-unit">\n      <div class="title"><%= i18n(\'host_details\') %></div>\n      <ul class="n-list-info">\n        \x3c!-- Show the most important critical alert message here --\x3e\n        <li class="n-alert-very-important-row" style="display:none">\n          <div class="n-info-block">\n            <div class="n-label">\n              <div class="n-alert-very-important-widget n-resettable">\n                \x3c!-- very important alert icon and message goes here... --\x3e\n              </div>\n            </div>\n          </div>\n        </li>\n        <li>\n          <div class="n-info-block">\n            <span class="n-label"><%= i18n(\'labels.name\') %></span>\n            <span class="lblHostName n-value n-resettable"\n                data-test="hwDetailsHostNameValue">\n              \x3c!-- @value: host name goes here... --\x3e\n            </span>\n          </div>\n        </li>\n        <li>\n          <div class="n-info-block">\n            <span class="n-label"><%= i18n(\'labels.hostType\') %></span>\n            <span class="lblHostType n-value n-resettable"\n                data-test="hwDetailsHostTypeValue">\n              \x3c!-- @value: host name goes here... --\x3e\n            </span>\n          </div>\n        </li>\n        <li>\n          <div class="n-info-block">\n            <span class="n-label"><%= i18n(\'labels.hypervisorAddress\') %></span>\n            <span class="lblHypervisorIp n-value n-resettable"\n                data-test="hwDetailsHypervisorIpValue">\n              \x3c!-- @value: hypervisor goes here... --\x3e\n            </span>\n          </div>\n        </li>\n        <li>\n          <div class="n-info-block">\n            <span class="n-label"><%= i18n(\'labels.serviceVMExternalIP\') %></span>\n            <span class="lblCvmIp n-value n-resettable"\n                data-test="hwDetailsCvmIpValue">\n              \x3c!-- @value: cvm ip goes here... --\x3e\n            </span>\n          </div>\n        </li>\n        <li>\n          <div class="n-info-block">\n            <span class="n-label"><%= i18n(\'labels.ipmiAddress\') %></span>\n            <span class="n-value linkIpmi">\n              \x3c!-- @value: ipmi goes here... --\x3e\n            </span>\n          </div>\n        </li>\n        <li>\n          <div class="n-info-block">\n            <span class="n-label"><%= i18n(\'labels.serial\') %></span>\n            <span class="lblNodeSerial n-value n-resettable"\n                data-test="hwDetailsNodeSerialValue">\n              \x3c!-- @value: node serial goes here... --\x3e\n            </span>\n          </div>\n        </li>\n        \x3c!-- Hyperv related settings --\x3e\n        <li>\n          <div class="n-info-block">\n            <span class="n-label"><%= i18n(\'labels.defaultVMLocation\') %></span>\n            <span class="lblDefaultVMLocation n-value n-resettable">\n              \x3c!-- @value: Hyperv Default VM Location goes here... --\x3e\n            </span>\n          </div>\n        </li>\n        <li>\n          <div class="n-info-block">\n            <span class="n-label"><%= i18n(\'labels.defaultVHDLocation\') %></span>\n            <span class="lblDefaultVHDLocation n-value n-resettable">\n              \x3c!-- @value: Hyperv Default VHD Location goes here... --\x3e\n            </span>\n          </div>\n        </li>\n        <li>\n          <div class="n-info-block">\n            <span class="n-label"><%= i18n(\'labels.failoverClusterFqdn\') %></span>\n            <span class="lblFailoverClusterFqdn n-value n-resettable">\n              \x3c!-- @value: Hyperv Failover Cluster FQDN goes here... --\x3e\n            </span>\n          </div>\n        </li>\n        \x3c!-- END of Hyperv related settings --\x3e\n        <li>\n          <div class="n-info-block">\n            <span class="n-label"><%= i18n(\'labels.blockSerial\') %></span>\n            <span class="lblBlockSerial n-value n-resettable"\n                data-test="hwDetailsBlockSerialValue">\n              \x3c!-- @value: block serial goes here... --\x3e\n            </span>\n          </div>\n        </li>\n        <li>\n          <div class="n-info-block">\n            <span class="n-label"><%= i18n(\'labels.blockModelName\') %></span>\n            <span class="lblBlockModel n-value n-resettable"\n                data-test="hwDetailsBlockModelValue">\n              \x3c!-- @value: block model goes here... --\x3e\n            </span>\n          </div>\n        </li>\n        <li>\n          <div class="n-info-block">\n            <span class="n-label"><%= i18n(\'labels.storageCapacity\') %></span>\n            <span class="lblCapacity n-value n-resettable"\n                data-test="hwDetailsCapacityValue">\n              \x3c!-- @value: capacity goes here... --\x3e\n            </span>\n          </div>\n        </li>\n        <li>\n          <div class="n-info-block">\n            <span class="n-label"><%= i18n(\'labels.disks\') %></span>\n            \x3c!-- @value: disks used goes here... --\x3e\n            <ul class="listHostDisks  n-ul  n-resettable"\n                data-test="hwDetailsDisksValue">\n              \x3c!-- @view: Disk w/ Tier li links go here... --\x3e\n            </ul>\n          </div>\n        </li>\n        <li>\n          <div class="n-info-block">\n            <span class="n-label"><%= i18n(\'labels.memoryCapacity\') %></span>\n            <span class="lblMemoryDetails n-value n-resettable"\n                data-test="hwDetailsMemoryValue">\n              \x3c!-- @value: value goes here... --\x3e\n            </span>\n          </div>\n        </li>\n        <li>\n          <div class="n-info-block">\n            <span class="n-label"><%= i18n(\'labels.cpuCapacity\') %></span>\n            <span class="lblCpuCapacity n-value n-resettable"\n                data-test="hwDetailsCpuCapacityValue">\n              \x3c!-- @value: value goes here... --\x3e\n            </span>\n          </div>\n        </li>\n        <li>\n          <div class="n-info-block">\n            <span class="n-label"><%= i18n(\'labels.cpuModel\') %></span>\n            <span class="lblCpuModel n-value n-resettable"\n                  data-test="hwDetailslblHostCpuModelValue">\n              \x3c!-- @value: CPU Model goes here... --\x3e\n            </span>\n          </div>\n        </li>\n        <li>\n          <div class="n-info-block">\n            <span class="n-label"><%= i18n(\'labels.numCpuCores\') %></span>\n            <span class="lblNumberOfCores n-value n-resettable"\n                  data-test="hwDetailsHostNumberOfCores">\n              \x3c!-- @value: No. of Cores goes here... --\x3e\n            </span>\n          </div>\n        </li>\n        <li>\n          <div class="n-info-block">\n            <span class="n-label"><%= i18n(\'labels.numCpuSockets\') %></span>\n            <span class="lblNumberOfSockets n-value n-resettable"\n                  data-test="hwDetailsHostNumberOfSockets">\n              \x3c!-- @value: No. of sockets goes here... --\x3e\n            </span>\n          </div>\n        </li>\n        <li>\n          <div class="n-info-block">\n            <span class="n-label"><%= i18n(\'labels.numVMs\') %></span>\n            <span class="linkVMsCount n-value n-resettable"\n                data-test="hwDetailsVMsCountValue">\n              \x3c!-- @value: vm count goes here... --\x3e\n            </span>\n          </div>\n        </li>\n        <li>\n          <div class="n-info-block">\n            <span class="n-label"><%= i18n(\'labels.oplogDiskPct\') %></span>\n            <span class="lblOplogPercent n-value n-resettable"\n                data-test="hwDetailsOplogPercentValue">\n              \x3c!-- @value: oplog disk % used goes here... --\x3e\n            </span>\n          </div>\n        </li>\n        <li>\n          <div class="n-info-block">\n            <span class="n-label"><%= i18n(\'labels.oplogDiskSize\') %></span>\n            <span class="lblOplogSize n-value n-resettable"\n                data-test="hwDetailsOplogSizeValue">\n              \x3c!-- @value: oplog disk size capacity goes here... --\x3e\n            </span>\n          </div>\n        </li>\n        <li>\n          <div class="n-info-block">\n            <span class="n-label"><%= i18n(\'labels.monitored\') %></span>\n            <span class="lblMonitored n-value n-resettable"\n                data-test="hwDetailsMonitoredValue">\n              \x3c!-- @value: monitored used goes here... --\x3e\n            </span>\n          </div>\n        </li>\n        <li>\n          <div class="n-info-block">\n            <span class="n-label"><%= i18n(\'labels.hypervisorName\') %></span>\n            <span class="lblHypervisorName n-value n-resettable"\n                data-test="hwDetailsHypervisorNameValue">\n              \x3c!-- @value: hypervisor name goes here... --\x3e\n            </span>\n          </div>\n        </li>\n        <li class="n-hypervisor-elem-esx nDataStore">\n          <div class="n-info-block">\n            <span class="n-label"><%= i18n(\'labels.datastores\') %></span>\n            <span class="lblDatastore n-value n-resettable"\n                data-test="hwDetailsDatastoreValue">\n              \x3c!-- @value: datastore goes here... --\x3e\n            </span>\n          </div>\n        </li>\n        <li>\n          <div class="n-info-block">\n            <span class="n-label"><%= i18n(\'labels.gpus\') %></span>\n            <span class="lblGraphicsCards n-value n-resettable"\n                  data-test="hwDetailsGraphicsCardsValue">\n              \x3c!-- @value: graphics cards details goes here... --\x3e\n            </span>\n          </div>\n        </li>\n      </ul>\n    </div>\n  </div>\n  \x3c!-- Fluid unit --\x3e\n  <div class="n-unit-fluid  n-tab-details-unit">\n    \x3c!-- @view: Tab details view goes here... --\x3e\n  </div>\n</div>\n'}),define("views/pages/hardware/details/HostTabDetailsEntityView",["views/basecomponents/details/BaseDetailsEntityView","text!templates/pages/hardware/details/HostTabDetailsEntityView.html","views/pages/hardware/common/HardwareTemplates","models/hardware/HostModel","models/storage/DatastoreCollection","models/hardware/DiskCollection","models/gpu/GpuCollection","models/gpu/GpuModel","managers/NotificationManager","data/DataProperties","data/DataManager","data/DataURLConstants","utils/AppConstants","utils/AppUtil","utils/AlertUtil","utils/StatsUtil","utils/HypervisorUtil","utils/CommonTemplates","utils/VisualizationUtil","utils/FilterUtil"],function(e,t,i,n,s,a,r,o,l,c,d,u,h,p,T,E,g,S,m,v){"use strict";return t=_.template(t),e.extend({MAX_CHARACTERS:38,datastoreCollection:null,diskCollection:null,entityType:h.ENTITY_HOST,name:"HostTabDetailsEntityView",modelEvents:{"change   model":"renderDetails","error    model":"renderError","pending  model":"reset","reset    datastoreCollection":"renderDatastoreDetails","reset    diskCollection":"renderDiskDetails","reset    pGpuCollection":"renderGpuDetails"},initializeProperties:function(){this.model=new n,this.model.setProjection([h.PROJECTION.USAGE_STATS]),this.datastoreCollection=new s,this.diskCollection=new a,this.pGpuCollection=new r,this.render()},render:function(){this.$el.html(t(this.vtOptions()))},destroy:function(){this.model.off("change",this.initializeTabView,this),e.prototype.destroy.apply(this,arguments)},startModelPolling:function(t){this.model.on("change",this.initializeTabView,this),e.prototype.startModelPolling.apply(this,arguments)},initializeTabView:function(){this.tabDetailsView&&this.tabDetailsView.stopServices(),this.model.off("change",this.initializeTabView,this);var e={};e[h.TAB_DETAILS.METRICS]=this.i18ns("host_performance"),e[h.TAB_DETAILS.USAGE]=this.i18ns("host_usage"),this.clusterManager.isMulticlusterNavMode()||(e[h.TAB_DETAILS.HOST_NICS]=this.i18ns("host_nics")),e[h.TAB_DETAILS.ALERTS]=this.i18ns("host_alerts"),this.clusterManager.isMulticlusterNavMode()||(e[h.TAB_DETAILS.EVENTS]=this.i18ns("host_events")),this.tabDetailsView||(this.tabDetailsView=m.renderTabDetailsView(this.$(".n-tab-details-unit"),e,this.entityType,h.PAGE_HARDWARE)),this.updateTabView(this.model),this.stopServices(),this.startServices()},renderDetails:function(){e.prototype.renderDetails.apply(this,arguments),this.clusterManager.isMulticlusterNavMode()||this.tabDetailsView.showTab(h.TAB_DETAILS.HOST_NICS),this.model.getClusterUuid()&&g.updateElementVisibility(this.$el,this.model.getClusterUuid());var t=this.model;this.$(".lblHostName").html(t.escape(c.NAME)),this.$(".lblHostType").html(t.getDisplayableHostType()),this.$(".lblHypervisorIp").html(t.get(c.HYPERVISOR_IP)),this.$(".lblMemoryDetails").html(E.storageFormat(t.getValue(c.MEM_CAPACITY))),this.$(".lblCpuCapacity").html(E.cpuHertzFormat(t.getValue(c.CPU_CAPACITY))),this.$(".lblOplogPercent").html(t.getValue(c.OPLOG_PERCENT)),this.$(".lblOplogSize").html(E.storageFormat(t.get(c.OPLOG_SIZE))),this.$(".lblMonitored").html(String(t.get(c.MONITORED))),this.$(".lblHypervisorName").html(t.escape(c.HYPERVISOR_NAME)),this.$(".linkVMsCount").html(t.get(c.NUM_VMS)||h.DATA_NOT_AVAILABLE),this.$(".lblNodeSerial").html(t.get(c.SERIAL)),this.$(".lblBlockSerial").html(t.get(c.BLOCK_SERIAL)),this.$(".lblBlockModel").html(t.get(c.BLOCK_MODEL_NAME)||t.get(c.BLOCK_MODEL)),this.$(".lblCapacity").html(E.storageFormat(this.model.getStorageCapacity())),this.$(".lblCpuModel").html(t.get(c.CPU_MODEL)||h.DATA_NOT_AVAILABLE),this.$(".lblNumberOfCores").html(t.get(c.CPU_CORES)||h.DATA_NOT_AVAILABLE),this.$(".lblNumberOfSockets").html(t.get(c.CPU_SOCKETS)||h.DATA_NOT_AVAILABLE);var i=t.get(c.IPMI_IP)||"",n=i.match(/0.0.0.0/g);if(i&&!n?(this.$(".linkIpmi").html('<a class="n-resettable"data-test="hwDetailsIpmiValue"href="http://'+i+'" target="_blank">'+i+"</a>"),this.$(".linkIpmi").parents("li").show()):n?this.$(".linkIpmi").html("<span>"+this.i18n("na")+"</span>"):this.$(".linkIpmi").parents("li").hide(),this.updateHypervRelatedDetails(t),this.updateCvmDetails(t),this.updateStorageDetails(t),this.showVeryCriticalAlert(),this.clusterManager.isMulticlusterNavMode()?this.$(".nDataStore").remove():g.hasESX(t.getClusterUuid())&&(this.datastoreCollection.length?this.renderDatastoreDetails():(this.datastoreCollection.fetch(),p.addInLineDonutLoader(this.$(".lblDatastore")))),this.tabDetailsView){var s=this.tabDetailsView.getTabContent(h.TAB_DETAILS.METRICS);s&&s.showResource(this.model)}var a=v.filterConditionToFIQL(o.DP.GPU_TYPE,{op:h.FILTER_OPERATORS.NOT_EQUALS,value1:o.GPU_TYPE_KSTRING.VIRTUAL});this.pGpuCollection.setFilterCriteria(a),this.pGpuCollection.setSingleHostUrl(t.get(c.UUID)),this.pGpuCollection.fetch(),this.$(".lblGraphicsCards").parents("li").hide()},renderDiskDetails:function(){var e=this.diskCollection.getDisksFromHost(this.model.get(this.model.idAttribute)),t=_.groupBy(e,c.TIER_NAME);this.$(".listHostDisks").empty(),_.each(_.keys(t),function(e){this.$(".listHostDisks").append(_.template(i.LIST_ITEM_TIER,{tierName:e,numberDisks:t[e].length}))},this)},renderGpuDetails:function(){var e=this.pGpuCollection.getGPUSummary().join("<br>");e.length&&(this.$(".lblGraphicsCards").html(e),this.$(".lblGraphicsCards").parents("li").show())},renderDatastoreDetails:function(){var e=this.datastoreCollection,t="";_.each(e.getDatastoreNamesByHost(this.model.get(this.model.idAttribute)),function(e,i){t+=(0===i?"":"<br>")+e}),this.$(".lblDatastore").html(t)},showVeryCriticalAlert:function(){T.isHostMetadataDetached(this.model.toJSON())&&_.indexOf(this.model.get(c.REMOVAL_STATUS),h.HOST_REMOVAL_STATUS.NA)>=0?(this.$(".n-alert-very-important-row").show(),this.$(".n-alert-very-important-widget").html(S.IMPORTANT_CRITICAL_ALERT+" "+this.model.get(c.METADATA_STORE_STATUS_MSG))):(this.$(".lblAlertMessage").empty(),this.$(".n-alert-very-important-row").hide())},updateCvmDetails:function(e){var t=this.$(".lblCvmIp");e.isComputeOnly()?t.closest("li").hide():(t.html(e.get(c.SERVICE_VM_IP)),t.closest("li").show())},updateStorageDetails:function(e){
var t=this,i=[".listHostDisks",".lblOplogPercent",".lblOplogSize",".lblCapacity"];e.isComputeOnly()?i.forEach(function(e){return t.$(e).closest("li").hide()}):(i.forEach(function(e){return t.$(e).closest("li").show()}),this.diskCollection.length?this.renderDiskDetails():(this.diskCollection.fetch(),p.addInLineDonutLoader(this.$(".listHostDisks"))))},updateHypervRelatedDetails:function(e){if(e.isHyperv()){var t=e.get(c.DEFAULT_VM_LOCATION)||"",i=e.get(c.DEFAULT_VHD_LOCATION)||"",n=e.get(c.FAILOVER_CLUSTER_FQDN)||"";this.$(".lblDefaultVMLocation").attr("title",t),this.$(".lblDefaultVHDLocation").attr("title",i),this.$(".lblFailoverClusterFqdn").attr("title",n),t=p.truncateMiddle(t,this.MAX_CHARACTERS),i=p.truncateMiddle(i,this.MAX_CHARACTERS),n=n.split(".")[0],this.$(".lblDefaultVMLocation").html(t),this.$(".lblDefaultVHDLocation").html(i),this.$(".lblFailoverClusterFqdn").html(n)}else this.$(".lblDefaultVMLocation").closest("li").hide(),this.$(".lblDefaultVHDLocation").closest("li").hide(),this.$(".lblFailoverClusterFqdn").closest("li").hide()},enableMetadataStore:function(e,t){var i=($(e.currentTarget),this),n=d.getFormattedURL(_.template(u.ENABLE_METADATA_STORE,{id:t}));$.ajax({type:"POST",url:p.cacheBustURL(n),contentType:"application/json; charset=UTF-8",statusCode:i.model.getStatusCode(),success:function(e,t,n){var s="Successfully enabled metadata store on host: "+i.model.get(c.SERVICE_VM_IP);l.showClientNotification(h.NOTIFY_SUCCESS,s)},error:function(e,t,n){var s=i._errorMsg(e,t,n);l.showClientNotification(h.NOTIFY_ERROR,s)}})},flipLED:function(e){this.model&&this.model.flipLED(e)},markNodeAsFixed:function(){if(this.model){var e={};e.isDegraded=!1,this.model.save(e)}},reset:function(){e.prototype.reset.apply(this,arguments),this.$(".n-alert-very-important-row").hide()},_errorMsg:function(e,t,i){var n=i;return e&&e.responseText&&e.responseText.length>0&&(n=p.processAjaxError(e.responseText)),n}})}),define("text!templates/pages/hardware/details/DiskTabDetailsEntityView.html",[],function(){return'\x3c!-- Wrap --\x3e\n<div class="n-unit-wrap">\n  \x3c!-- Fixed unit --\x3e\n  <div class="n-unit-fixed">\n    \x3c!-- Column 1: Summary --\x3e\n    <div class="n-details-unit">\n      <div class="title">DISK DETAILS</div>\n      <ul class="n-list-info">\n        <li>\n          <div class="n-info-block">\n            <span class="n-label">ID</span>\n            <span class="lblDiskID n-value n-resettable">\n              \x3c!-- @value: disk id goes here... --\x3e\n            </span>\n          </div>\n        </li>\n        <li>\n          <div class="n-info-block">\n            <span class="n-label">Serial Number</span>\n            <span class="lblSerialNumber n-value n-resettable">\n              \x3c!-- @value: serial number goes here... --\x3e\n            </span>\n          </div>\n        </li>\n        <li>\n          <div class="n-info-block">\n            <span class="n-label">Model</span>\n            <span class="lblModel n-value n-resettable">\n              \x3c!-- @value: model goes here... --\x3e\n            </span>\n          </div>\n        </li>\n        <li>\n          <div class="n-info-block">\n            <span class="n-label">Storage Tier</span>\n            <span class="lblTier n-value n-resettable">\n              \x3c!-- @value: tier goes here... --\x3e\n            </span>\n          </div>\n        </li>\n        <li>\n          <div class="n-info-block">\n            <span class="n-label">Used (Physical)</span>\n            <span class="lblPhysicalUsed n-value n-resettable">\n              \x3c!-- @value: physical used goes here... --\x3e\n            </span>\n          </div>\n        </li>\n        <li>\n          <div class="n-info-block">\n            <span class="n-label">Capacity (Logical)</span>\n            <span class="lblMaxRawCapacity n-value n-resettable">\n              \x3c!-- @value: max raw capacity goes here... --\x3e\n            </span>\n          </div>\n        </li>\n        <li>\n          <div class="n-info-block">\n            <span class="n-label">Hypervisor</span>\n            <span class="lblHostName n-value n-resettable">\n              \x3c!-- @value: max raw capacity goes here... --\x3e\n            </span>\n          </div>\n        </li>\n        <li>\n          <div class="n-info-block">\n            <span class="n-label">Storage Pool</span>\n            <span class="lblStoragePool n-value n-resettable">\n              \x3c!-- @value: disk\'s storage pool id goes here... --\x3e\n            </span>\n          </div>\n        </li>\n        <li>\n          <div class="n-info-block">\n            <span class="n-label">Status</span>\n            <span class="lblStatus n-value n-resettable">\n              \x3c!-- @value: status goes here... --\x3e\n            </span>\n          </div>\n        </li>\n        <li>\n          <div class="n-info-block">\n            <span class="n-label">Mode</span>\n            <span class="lblMode n-value n-resettable">\n              \x3c!-- @value: online goes here... --\x3e\n            </span>\n          </div>\n        </li>\n        <li>\n          <div class="n-info-block">\n            <span class="n-label">Self Encryption Drive</span>\n            <span class="lblSED n-value n-resettable">\n              \x3c!-- @value: SED value goes here... --\x3e\n            </span>\n          </div>\n        </li>\n      </ul>\n    </div>\n  </div>\n  \x3c!-- Fluid unit --\x3e\n  <div class="n-unit-fluid  n-tab-details-unit">\n    \x3c!-- @view: Tab details view goes here... --\x3e\n  </div>\n</div>'}),define("models/genesis/SingleSSDRepairModel",["models/genesis/GenesisBaseModel","utils/AppConstants"],function(e,t){"use strict";return e.extend({name:"SingleSSDRepairModel",methodName:t.CLUSTER_MANAGER_METHODS.SINGLE_SSD_REPAIR,managerName:t.GENESIS.CLUSTER_MANAGER,setRPCParams:function(e){_.extend(this.kwargs,{svm_ip:e})},getErrorResponse:function(){return this.getParsedErrorResponse("Error performing SSD repair operation.")},getReturnResponse:function(){return this.get(e.DP.GENESIS_RETURN)||[]}})}),define("views/pages/hardware/details/DiskTabDetailsEntityView",["views/basecomponents/details/BaseDetailsEntityView","text!templates/pages/hardware/details/DiskTabDetailsEntityView.html","models/hardware/DiskModel","models/storage/StoragePoolModel","models/hardware/HostCollection","models/genesis/SingleSSDRepairModel","managers/AppManager","managers/NavigationManager","managers/NotificationManager","managers/ClusterManager","data/DataProperties","utils/AppConstants","utils/StatsUtil","utils/VisualizationUtil"],function(e,t,i,n,s,a,r,o,l,c,d,u,h,p){"use strict";var T=_.template("Please make sure you have replaced the bad disk before proceeding. <%= extraInfo %> Do you wish to continue?");return e.extend({storagePoolModel:null,hostCollection:null,unmountedDiskSerial:null,unmountedDiskModel:null,unmountedDiskLabelRows:["lblDiskID","lblSerialNumber","lblStatus"],entityType:u.ENTITY_DISK,modelEvents:{"change   model":"renderDetails","error    model":"renderError","pending  model":"reset"},initializeProperties:function(){this.model=new i,this.model.setProjection([u.PROJECTION.USAGE_STATS]),this.model.alwaysTriggerPending=!0,this.storagePoolModel=new n,_.bindAll(this,"renderStoragePool"),this.render()},render:function(){this.$el.html(t);var e={};e[u.TAB_DETAILS.USAGE]="Disk Usage",e[u.TAB_DETAILS.METRICS]="Disk Performance",e[u.TAB_DETAILS.ALERTS]="Disk Alerts",this.clusterManager.isMulticlusterNavMode()||(e[u.TAB_DETAILS.EVENTS]="Disk Events"),this.tabDetailsView=p.renderTabDetailsView(this.$(".n-tab-details-unit"),e,this.entityType,u.PAGE_HARDWARE)},renderDetails:function(){e.prototype.renderDetails.apply(this,arguments),this.$(".n-list-info li").show();var t=this.model.getDisplayableId(),i=this.model.get(d.DISK_HW_CONFIG);this.$(".lblDiskID").html(t).attr("title",t),this.$(".lblTier").html(this.model.get(d.TIER_NAME)),this.$(".lblPhysicalUsed").html(h.storageFormat(this.model.getUsedPhysical())),this.$(".lblMaxRawCapacity").html(h.storageFormat(this.model.getTotalCapacity())),this.$(".lblSerialNumber").html(this.model.nameParserFunc()),this.$(".lblModel").html(i?i[d.DISK_HW_CONFIGS_DISK_MODEL]:""),this.$(".lblHostName").html(this.model.get(d.HOST_NAME)),this.$(".lblMode").html(this.model.get(d.ONLINE)?"Online":"Offline"),this.$(".lblStatus").html(this.model.getMountedStatus()),this.model.get(d.SED)?(this.$(".lblSED").html("Present"),0===this.$(".protection-info-list-item").length&&this.$(".n-list-info").append('<li class="protection-info-list-item"><div class="n-info-block"><span class="n-label">Password Protection Mode</span><span class="lblPasswordProtectionMode n-value n-resettable"></span></div></li>'),this.$(".lblPasswordProtectionMode").html(this.model.get(d.PASSWORD_PROTECTION)?"Protected":"Not Protected")):(this.$(".lblSED").html("Not Present"),this.$(".protection-info-list-item").length>0&&this.$(".protection-info-list-item").remove()),this.model.get(d.SP_ID)!==u.ENTITY_INVALID_VALUE?(this.storagePoolModel.id=this.model.get(d.SP_ID),this.storagePoolModel.fetch({success:this.renderStoragePool})):this.$(".lblStoragePool").html("None")},renderStoragePool:function(){this.$(".lblStoragePool").html(this.storagePoolModel.get(this.storagePoolModel.nameAttribute)).attr("title",this.storagePoolModel.get(this.storagePoolModel.nameAttribute))},renderEntityWithoutModel:function(t){e.prototype.renderEntityWithoutModel.apply(this,arguments),this.unmountedDiskSerial=t||this.unmountedDiskSerial,this.hostCollection||(this.hostCollection=new s);var i=this;this.hostCollection.fetch({success:function(){i.renderUnmountedDisk()},error:function(e,t,n){i.renderError(e,t,n)}})},renderUnmountedDisk:function(){var e;this.hostCollection&&this.hostCollection.length&&(this.hostCollection.find(function(t){return e=_.find(t.get(d.DISK_HW_CONFIGS),function(e){return e&&e[d.DISK_HW_CONFIGS_DISK_SERIAL]===this.unmountedDiskSerial},this),_.isEmpty(e)||(e[d.HOST_IP]=t.get(d.SERVICE_VM_IP),e[d.METADATA_STORE_STATUS]=t.get(d.METADATA_STORE_STATUS)),void 0!==e},this),this.reset(!0),this.$(".n-list-info li").hide(),_.each(this.unmountedDiskLabelRows,function(e){this.$("."+e).closest("li").show()},this),e?(this.unmountedDiskModel=new i,this.unmountedDiskModel.setDiskConfig(e),this.triggerModelUpdate(this.unmountedDiskModel,{isEntityNoModel:!0,entityType:u.ENTITY_DISK}),this.$(".lblSerialNumber").html(this.unmountedDiskModel.nameParserFunc()),this.$(".lblDiskID").html(this.unmountedDiskModel.getDisplayableId()),this.$(".lblStatus").html(this.unmountedDiskModel.getUnmountedStatus())):l.showClientNotification(u.NOTIFY_WARNING,"The disk with serial number, "+this.unmountedDiskSerial+", cannot be found."))},flipLED:function(e){this.isEntityWithoutModel&&this.unmountedDiskModel?this.unmountedDiskModel.flipLED(e):!this.isEntityWithoutModel&&this.model&&this.model.flipLED(e)},prepareAndAdd:function(){this.unmountedDiskModel&&$.nutanixConfirm({msg:"Are you sure you want to repartition and add the disk to the cluster?",yes:function(){var e=this;this.unmountedDiskModel.prepareAndAdd({success:function(t){r.refreshView(e.unmountedDiskModel),o.showDetailsSummary()}})},yesText:u.LABEL_YES,noText:u.LABEL_NO,context:this})},addBack:function(){this.unmountedDiskModel&&$.nutanixConfirm({msg:"Are you sure you want to add the disk back to this cluster?",yes:function(){var e=this;this.unmountedDiskModel.addBack({success:function(t){r.refreshView(e.unmountedDiskModel),o.showDetailsSummary()}})},yesText:u.LABEL_YES,noText:u.LABEL_NO,context:this})},repairSSD:function(e){var t="",i="",n=c.getCurrentClusterModel();n&&n.isFFEnabled(u.FFLAGS.ENCRYPTION)&&(i+='<br><br><strong>Once the repair operation is complete, you need to perform a few more <a href="https://portal.nutanix.com/#/page/docs/details?targetId=Boot_Metadata_Drive_Replacement_Single_SSD-Acr_v4_6-NX1000_NX6000:bre_boot_sed_drive_repair_cli__ahv_t.html#ntask_pnf_4ff_r5" target="_blank">manual steps</a> for the disk to be fully functional.</strong><br>'),t=T({extraInfo:i}),$.nutanixConfirm({msg:t,yes:function(){var t=new a;t.setRPCParams(e);var i=l.showLatencyMessage("Submitting operation to repair SSD.");t.save({success:function(){l.hideLatencyMessage(i),l.showClientNotification(u.NOTIFY_SUCCESS,"Successfully submitted operation to repair SSD. Please check task details for more info.")},error:function(e,t){l.hideLatencyMessage(i),l.showClientNotification(u.NOTIFY_ERROR,e.getErrorResponse())}})},yesText:u.LABEL_YES,noText:u.LABEL_NO,context:this})}})}),define("text!templates/pages/hardware/details/SwitchTabDetailsEntityView.html",[],function(){return'\x3c!-- Wrap --\x3e\n<div class="n-unit-wrap">\n  \x3c!-- Fixed unit --\x3e\n  <div class="n-unit-fixed">\n    \x3c!-- Column 1: Summary --\x3e\n    <div class="n-details-unit">\n      <div class="title">SWITCH DETAILS</div>\n      <ul class="n-list-info">\n        <li>\n          <div class="n-info-block">\n            <span class="n-label">Name</span>\n            <span class="lblSwitchName n-value n-resettable">\n              \x3c!-- @value: switch name goes here... --\x3e\n            </span>\n          </div>\n        </li>\n        <li>\n          <div class="n-info-block">\n            <span class="n-label">Vendor Name</span>\n            <span class="lblVendorName n-value n-resettable">\n              \x3c!-- @value: vendor name goes here... --\x3e\n            </span>\n          </div>\n        </li>\n        <li>\n          <div class="n-info-block">\n            <span class="n-label">Management Addresses</span>\n            <span class="lblMgmtAddresses n-value n-resettable">\n              \x3c!-- @value: management addresses goes here... --\x3e\n            </span>\n          </div>\n        </li>\n        <li>\n          <div class="n-info-block">\n            <span class="n-label">Services</span>\n            <span class="lblServices n-value n-resettable">\n              \x3c!-- @value: tier goes here... --\x3e\n            </span>\n          </div>\n        </li>\n      </ul>\n    </div>\n  </div>\n  \x3c!-- Fluid unit --\x3e\n  <div class="n-unit-fluid  n-tab-details-unit">\n    \x3c!-- @view: Tab details view goes here... --\x3e\n  </div>\n</div>'}),define("views/pages/hardware/details/SwitchTabDetailsEntityView",["views/basecomponents/details/BaseDetailsEntityView","text!templates/pages/hardware/details/SwitchTabDetailsEntityView.html","models/hardware/SwitchModel","data/DataProperties","utils/AppConstants","utils/VisualizationUtil"],function(e,t,i,n,s,a){"use strict";return e.extend({entityType:s.ENTITY_SWITCH,modelEvents:{"change   model":"renderDetails","error    model":"renderError","pending  model":"reset"},initializeProperties:function(){this.model=new i,this.model.setProjection([s.PROJECTION.USAGE_STATS]),this.model.alwaysTriggerPending=!0,this.render()},render:function(){this.$el.html(t);var e={};e[s.TAB_DETAILS.PHYSICAL_SWITCH_INTERFACE]="Physical Switch Interfaces",this.tabDetailsView=a.renderTabDetailsView(this.$(".n-tab-details-unit"),e,this.entityType,s.PAGE_HARDWARE)},renderDetails:function(){e.prototype.renderDetails.apply(this,arguments),this.$(".n-list-info li").show();var t=this.model.get(n.SWITCH_NAME);this.$(".lblSwitchName").html(t).attr("title",t),this.$(".lblServices").html(this.model.get(n.SWITCH_SERVICES)),this.$(".lblVendorName").html(this.model.get(n.SWITCH_VENDOR_NAME)),this.$(".lblMgmtAddresses").html(this.model.get(n.SWITCH_MGMT_ADDRESSES).join(" "))}})}),define("views/pages/hardware/details/HardwareTabDetailsView",["views/basecomponents/details/BaseDetailsView","text!templates/pages/hardware/details/HardwareTabDetailsView.html","views/pages/hardware/common/HardwareTemplates","models/hardware/HostCollection","models/hardware/DiskCollection","models/hardware/SwitchCollection","models/gpu/GpuCollection","models/gpu/GpuModel","managers/NavigationManager","managers/UserBehaviorManager","views/pages/hardware/details/HostTabDetailsEntityView","views/pages/hardware/details/DiskTabDetailsEntityView","views/pages/hardware/details/SwitchTabDetailsEntityView","data/DataProperties","utils/AppConstants","utils/StatsUtil","utils/VisualizationUtil","utils/FilterUtil"],function(e,t,i,n,s,a,r,o,l,c,d,u,h,p,T,E,g,S){"use strict";return e.extend({pageId:T.PAGE_HARDWARE,summaryTemplate:_.template(t),hostCollection:null,diskCollection:null,pGpuCollection:null,switchCollection:null,events:{"click  .linkRowItem":"onClickLinkRowItem"},modelEvents:{"reset  hostCollection":"renderHostDetails","reset  diskCollection":"renderDiskDetails","reset  pGpuCollection":"renderGpuDetails","reset  switchCollection":"renderSwitchDetails"},initializeProperties:function(){this.hostCollection=new n,this.hostCollection.setProjection([T.PROJECTION.STATS]),this.diskCollection=new s,this.diskCollection.setProjection([T.PROJECTION.STATS]);var e=S.filterConditionToFIQL(o.DP.GPU_TYPE,{op:T.FILTER_OPERATORS.NOT_EQUALS,value1:o.GPU_TYPE_KSTRING.VIRTUAL});this.pGpuCollection=new r,this.pGpuCollection.setFilterCriteria(e),this.shouldShowSwitches()&&(this.switchCollection=new a,this.switchCollection.setProjection([T.PROJECTION.STATS]))},customDetailsEventHandler:function(e,t){var i,n,s,a,r;t=t||{},s=t[T.NAV_ACTION],a=t[T.NAV_ACTION_TARGET],r=t[T.NAV_ACTION_TARGET_ID],a===T.ENTITY_HOST?(i=this.getDetailsEntityView(T.ENTITY_HOST),s===T.ACTION_ENABLE_METADATA_STORE?i.enableMetadataStore(e,r):s===T.ACTION_TURN_ON_LED?(c.recordUserActivities({action:"turn on",actionTarget:"host LED"}),i.flipLED(!0)):s===T.ACTION_TURN_OFF_LED?(c.recordUserActivities({action:"turn off",actionTarget:"host LED"}),i.flipLED(!1)):s===T.ACTION_MARK_AS_FIXED&&i.markNodeAsFixed()):a===T.ENTITY_DISK&&(n=this.getDetailsEntityView(T.ENTITY_DISK),s===T.ACTION_PREPARE_ADD?n.prepareAndAdd():s===T.ACTION_ADD_BACK?n.addBack():s===T.ACTION_TURN_ON_LED?(c.recordUserActivities({action:"turn on",actionTarget:"disk LED"}),n.flipLED(!0)):s===T.ACTION_TURN_OFF_LED?(c.recordUserActivities({action:"turn off",actionTarget:"disk LED"}),n.flipLED(!1)):s===T.ACTION_REPAIR&&(c.recordUserActivities({action:T.ACTION_REPAIR,actionTarget:T.DISK_TIER.SSD}),n.repairSSD(t[T.NAV_ACTION_TARGET_ID])))},_activateDetails:function(){this.subViewHelperEntity.iterate("stopServices"),e.prototype._activateDetails.apply(this,arguments)},refreshView:function(t){e.prototype.refreshView.apply(this,arguments),_.each(this.subViewHelperEntity.getIds(),function(e){e!==this.currentEntityType()&&this.subViewHelperEntity.get(e).stopServices()},this)},render:function(){var e={};e[T.TAB_DETAILS.METRICS]="Performance Summary",e[T.TAB_DETAILS.ALERTS]="Hardware Alerts",this.clusterManager.isMulticlusterNavMode()||(e[T.TAB_DETAILS.EVENTS]="Hardware Events"),this.tabDetailsView=g.renderTabDetailsView(this.$(".n-tab-details-unit"),e,T.ENTITY_CLUSTER,T.PAGE_HARDWARE),this.storeToDetailsEntityMap(T.ENTITY_HOST,new d({el:this.getDetailsEntityElement(T.ENTITY_HOST)})),this.storeToDetailsEntityMap(T.ENTITY_DISK,new u({el:this.getDetailsEntityElement(T.ENTITY_DISK)})),this.shouldShowSwitches()&&this.storeToDetailsEntityMap(T.ENTITY_SWITCH,new h({el:this.getDetailsEntityElement(T.ENTITY_SWITCH)}))},getDataAndRender:function(){this.hostCollection.fetch(),this.diskCollection.fetch(),this.shouldShowSwitches()&&this.switchCollection.fetch()},getHostCollection:function(){return this.hostCollection},shouldShowSwitches:function(){return!this.clusterManager.isMulticlusterNavMode()},renderHostDetails:function(){var e=this.hostCollection.toJSON(),t=_.groupBy(e,function(e){return e[p.BLOCK_SERIAL]}),i=_.keys(t);this.$(".detailsSummaryContainer .lblNumberBlocks").html(i.length),this.$(".detailsSummaryContainer .lblNumberHosts").html(this.hostCollection.getMetaData()?this.hostCollection.getMetaData()[p.META_TOTAL_ENTITIES]:this.hostCollection.length);var n=E.aggregate(this.hostCollection,p.MEM_CAPACITY);this.$(".detailsSummaryContainer .lblMemorySummary").html(n),this.$(".detailsSummaryContainer .lblCpuCapacity").html(E.aggregate(this.hostCollection,p.CPU_CAPACITY,!0,p.CPU_CORES));var s=this.tabDetailsView.getTabContent(T.TAB_DETAILS.METRICS);s&&s.showResource(this.hostCollection),this.pGpuCollection.fetch(),this.$(".lblGraphicsCards").parents("li").hide()},renderDiskDetails:function(){var e=this.diskCollection.toJSON(),t=_.groupBy(e,function(e){return e[p.TIER_NAME]}),n=_.keys(t),s=this;this.$(".detailsSummaryContainer .listDisks").empty(),n.length&&_.each(n,function(e){var n=t[e];s.$(".detailsSummaryContainer .listDisks").append(_.template(i.LIST_ITEM_TIER,{tierName:e,numberDisks:n.length}))})},renderGpuDetails:function(){var e=this.pGpuCollection.getGPUSummary().join("<br>"),t=this.$(".lblGraphicsCards").parents("li");e.length&&(this.$(".detailsSummaryContainer .lblGraphicsCards").html(e),t.show())},renderSwitchDetails:function(){var e=this.switchCollection.getMetaData()?this.switchCollection.getMetaData()[p.META_TOTAL_ENTITIES]:this.switchCollection.length;this.$(".detailsSummaryContainer .lblSwitchCount").html(e)},onClickLinkRowItem:function(e){l.updateRouteOption(e.currentTarget)}})}),define("views/pages/hardware/HardwarePageView",["views/basecomponents/pages/BasePageView","views/pages/hardware/diagram/HardwareDiagramView","views/pages/hardware/details/HardwareTabDetailsView","views/basecomponents/vantagepoints/DashboardView","views/basecomponents/datatables/DataTableGroupView","utils/AppConstants","utils/AppUtil","managers/CommunityEditionManager"],function(e,t,i,n,s,a,r,o){"use strict";return e.extend({pageId:a.PAGE_HARDWARE,defaultSubPageId:a.SUBPAGE_PERSPECTIVE,initialize:function(t){e.prototype.initialize.apply(this,arguments),this.isMulticlusterPageUuid()&&(this.defaultSubPageId=a.SUBPAGE_TABLE)},onShowSubPage:function(e,i){var l,c,d;switch(e){case a.SUBPAGE_PERSPECTIVE:l=this.getSubView(e),l||(l=this.registerSubView(e,new n({el:this.getSubPageElement(e),dashboard:a.PERSPECTIVE_HARDWARE}))),l.show(i);break;case a.SUBPAGE_DIAGRAM:c=this.getSubView(e),c||(c=this.registerSubView(e,new t({el:this.getSubPageElement(e)})));break;case a.SUBPAGE_TABLE:d=this.getSubView(e),d||(d=this.registerSubView(e,new s({el:this.getSubPageElement(e),pageId:a.PAGE_HARDWARE})))}o.isCommunityEditionCluster()?r.log("HardwarePageView : Diagram is not allowed in the community edition."):(c=c||this.getSubView(a.SUBPAGE_DIAGRAM),e===a.SUBPAGE_DIAGRAM&&c&&c.show(i)),d=d||this.getSubView(a.SUBPAGE_TABLE),e===a.SUBPAGE_TABLE&&d&&d.show(i)},onChangeDetailsPane:function(e){var t=this.getSubView(a.SUBPAGE_COMPONENT_DETAILS);t||(t=this.registerSubView(a.SUBPAGE_COMPONENT_DETAILS,new i({el:this.getDetailsElement()}))),t.show(e)}})}),define("models/graph/GraphHelper",["models/hardware/HostCollection","models/ebrowser/EBQueryModel","data/DataProperties","utils/SubModelHelper"],function(e,t,i,n){"use strict";var s=[i.NW_E_TYPES.VM,i.NW_E_TYPES.PNIC,i.NW_E_TYPES.VNIC,i.NW_E_TYPES.SWITCH,i.NW_E_TYPES.SWITCH_INTERFACE,i.NW_E_TYPES.VIRTUAL_NETWORK,i.NW_E_TYPES.BRIDGE,i.NW_E_TYPES.BOND],a={},r=[],o=e.extend({comparator:function(e){return e.get(i.NAME)}});return{entityAttributes:function(e,t){var i=a[e]||[];i=i.concat(t),a[e]=_.uniq(i)},fetchData:function(e){var t=this;this.subModelHelper||(this.subModelHelper=new n,_.each(s,function(e){t.subModelHelper.register(e,t.createEBQueryModel(e))},this),this.subModelHelper.register("host",new o));var i=[];_.each(s,function(e){i.push(t.subModelHelper.get(e).performQuery())},this),i.push(this.subModelHelper.get("host").fetch()),$.whenAll.apply($,i).done(e.success)},graphsAPI:function(e,t,n){var s=t[e.DP.RELATIONSHIP],a=t[e.DP.SOURCE_ATTRIBUTES],r=t[e.DP.TARGET_ATTRIBUTES],o=function(e,t){return e.get?e.get(t):e[t]},l=function(t,l,c){var d={};d[e.DP.RELATIONSHIP]=s;var u={};u[e.DP.SOURCES]=[],u[e.DP.TARGETS]=[],_.each(t,function(t){var n={};n.id=o(t,i.ID)||o(t,i.UUID),_.each(a,function(e){n[e]=o(t,e)}),u[e.DP.SOURCES].push(n)}),_.each(l,function(t){var n={};n.id=o(t,i.ID)||o(t,i.UUID),_.each(r,function(e){n[e]=o(t,e)}),u[e.DP.TARGETS].push(n)}),u[e.DP.EDGES]=c,d[e.DP.GRAPH]=u,n(d)};switch(s){case e.RELATIONSHIPS.VM2HOST:this.graphVM2Host(l);break;case e.RELATIONSHIPS.HOST2SWITCH:this.graphHost2Switch(l);break;case e.RELATIONSHIPS.VLAN2VM:this.graphVlan2Vm(l);break;case e.RELATIONSHIPS.VIRTUALNET2VM:this.graphVirtualNet2Vm(l);break;case e.RELATIONSHIPS.VIRTUALNET2VLAN:this.graphVirtualNet2Vlan(l);break;case e.RELATIONSHIPS.HOST2PNIC:this.graphHost2PNIC(l);break;case e.RELATIONSHIPS.SWITCH2INTERFACE:this.graphSwitch2Interface(l);break;case e.RELATIONSHIPS.HOST2BRIDGE:this.graphHost2Bridge(l);break;case e.RELATIONSHIPS.HOST2BOND:this.graphHost2Bond(l);break;default:l([])}},graphVM2Host:function(e){var t=this;t.getEntities(i.NW_E_TYPES.HOST,function(n){t.getEntities(i.NW_E_TYPES.VM,function(t){var s=[];_.each(t,function(e){var t=e.getId(),n=e.get(i.EB.VM.NODE);n&&s.push([t,n])}),e(t,n,s)})})},graphHost2PNIC:function(e){var t=this;t.getEntities(i.NW_E_TYPES.HOST,function(n){t.getEntities(i.NW_E_TYPES.PNIC,function(t){var s=[];_.each(t,function(e){var t=e.get(i.EB.PNIC.NODE),n=e.getId();s.push([t,n])}),e(n,t,s)})})},graphSwitch2Interface:function(e){var t=this;t.getEntities(i.NW_E_TYPES.SWITCH,function(n){t.getEntities(i.NW_E_TYPES.SWITCH_INTERFACE,function(t){var s=[];_.each(t,function(e){var t=e.get(i.EB.SWITCH_INTERFACE.NETWORK_SWITCH),n=e.getId();s.push([t,n])}),e(n,t,s)})})},graphHost2Switch:function(e){var t=this;t.getEntities(i.NW_E_TYPES.SWITCH_INTERFACE,function(n){t.getEntities(i.NW_E_TYPES.SWITCH,function(s){t.getEntities(i.NW_E_TYPES.HOST,function(t){var a=[];_.each(n,function(e){var t=e.get(i.EB.SWITCH_INTERFACE.NETWORK_SWITCH)+"|"+e.getId(),n=e.get(i.EB.SWITCH_INTERFACE.HOST_NIC_UUIDS)||[];_.each(n,function(n){var s=e.get(i.EB.SWITCH_INTERFACE.NODE)+"|"+n;a.push([s,t])})}),e(t,s,a)})})})},graphVirtualNet2Vlan:function(e){var t=this;t.getEntities(i.NW_E_TYPES.VIRTUAL_NETWORK,function(n){var s=[],a=[];_.each(n,function(e){var n=e.get(i.EB.VIRTUAL_NETWORK.VLAN_ID);if(n){_.find(s,function(e){return e.id===n})||s.push(t._getVLAN(n)),a.push([e.getId(),n])}}),e(n,s,a)})},graphVirtualNet2Vm:function(e){var t=this;t.getEntities(i.NW_E_TYPES.VIRTUAL_NETWORK,function(n){t.getEntities(i.NW_E_TYPES.VNIC,function(s){t.getEntities(i.NW_E_TYPES.VM,function(t){var a=[];_.each(s,function(e){var t=e.get(i.EB.VIRTUAL_NIC.VIRTUAL_NETWORK);if(t){var n=e.get(i.EB.VIRTUAL_NIC.VM);a.push([t,n])}}),e(n,t,a)})})})},graphVlan2Vm:function(e){var t=this;t.getEntities(i.NW_E_TYPES.VNIC,function(n){t.getEntities(i.NW_E_TYPES.VM,function(s){var a=[],r=[];_.each(n,function(e){var t=e.get(i.EB.VIRTUAL_NETWORK.VLAN_ID);if(t){var n=e.get(i.EB.VIRTUAL_NIC.VM);a.push([t,n]),r.push(t)}});var o=[];_.each(_.unique(r),function(e){o.push(t._getVLAN(e))}),e(o,s,a)})})},graphHost2Bridge:function(e){var t=this;t.getEntities(i.NW_E_TYPES.HOST,function(n){t.getEntities(i.NW_E_TYPES.BRIDGE,function(t){var s=[];_.each(t,function(e){var t=e.get(i.EB.VIRTUAL_SWITCH.NODE),n=e.getId();s.push([t,n])}),e(n,t,s)})})},graphHost2Bond:function(e){var t=this;t.getEntities(i.NW_E_TYPES.HOST,function(n){t.getEntities(i.NW_E_TYPES.BOND,function(t){var s=[];_.each(t,function(e){var t=e.get(i.EB.NIC_TEAM.NODE),n=e.getId();s.push([t,n])}),e(n,t,s)})})},getEntities:function(e,t){if(e===i.NW_E_TYPES.HOST)t(this.subModelHelper.get(e).models||[]);else{t(this.subModelHelper.get(e).getQueryResults().models||[])}},_getVLAN:function(e){var t=_.find(r,function(t){return t.id===e});return t||(t={id:e,name:"VLAN "+e},r.push(t)),t},createEBQueryModel:function(e){var i=new t,n={};n[i.DP.ENTITY_TYPE]=e,n[i.DP.GROUP_MEMBER_COUNT]=3500,n[i.DP.GROUP_MEMBER_OFFSET]=0,n[i.DP.GROUP_MEMBER_ATTRIBUTES]=[],_.each(a[e],function(e){n[i.DP.GROUP_MEMBER_ATTRIBUTES].push({attribute:e})});var s=this.getSortByAttribute(e);return s&&(n[i.DP.GROUP_MEMBER_SORT_ATTRIBUTE]=s),n[i.DP.QUERY_NAME]="eb:graphs",i.set(n),i},getSortByAttribute:function(e){switch(e){case i.NW_E_TYPES.VM:return i.EB.VM.VM_NAME;case i.NW_E_TYPES.PNIC:return i.EB.PNIC.LINK_SPEED;case i.NW_E_TYPES.VNIC:return null;case i.NW_E_TYPES.SWITCH:return i.EB.NETWORK_SWITCH.NAME;case i.NW_E_TYPES.SWITCH_INTERFACE:return i.EB.SWITCH_INTERFACE.PORT_NUM;case i.NW_E_TYPES.VIRTUAL_NETWORK:return i.EB.VIRTUAL_NETWORK.NAME;case i.NW_E_TYPES.BRIDGE:return i.EB.VIRTUAL_SWITCH.NAME;case i.NW_E_TYPES.BOND:return i.EB.NIC_TEAM.NAME;default:return null}}}}),define("models/graph/GraphModel",["models/BaseModel","models/graph/GraphHelper","utils/AppConstants"],function(e,t,i){"use strict";var n={VM2HOST:"vm2host",HOST2SWITCH:"host2switch",VLAN2VM:"vlan2vm",VIRTUALNET2VM:"virtualnet2vm",VIRTUALNET2VLAN:"virtualnet2vlan",SWITCH2INTERFACE:"switch2interface",HOST2PNIC:"host2pnic",HOST2BRIDGE:"host2bridge",HOST2BOND:"host2bond"},s={RELATIONSHIP:"relationship",SOURCE_ATTRIBUTES:"source_attributes",TARGET_ATTRIBUTES:"target_attributes",GRAPH:"graph",SOURCES:"sources",TARGETS:"targets",EDGES:"edges"};return e.extend({DP:s,RELATIONSHIPS:n,defaults:{relationship:null,source_attributes:null,target_attributes:null,graph:null},createGraph:function(e){e=e||{};var i=this.toJSON(),n=e.success,s=this;t.graphsAPI(this,i,function(e){s.set(s.DP.GRAPH,e.graph),n&&n(s)})},replaceTargets:function(e){e&&(this.get(s.GRAPH).targets=e)},addSource:function(e){this._getGraphData(this.DP.SOURCES).push(e)},addTarget:function(e){this._getGraphData(this.DP.TARGETS).push(e)},getSourceById:function(e){return _.find(this._getGraphData(this.DP.SOURCES),function(t){return t.id===e})},getTargetById:function(e){return _.find(this._getGraphData(this.DP.TARGETS),function(t){return t.id===e})},addEdge:function(e){this._getGraphData(this.DP.EDGES).push(e)},getSources:function(){return this._getGraphData(this.DP.SOURCES)},getTargets:function(){return this._getGraphData(this.DP.TARGETS)},getEdges:function(){return this._getGraphData(this.DP.EDGES)},getRelatedSourceIds:function(e){var t=[];return _.each(this.getEdges(),function(i){i[1]===e&&t.push(i[0])}),t},getRelatedTargetIds:function(e){var t=[];return _.each(this.getEdges(),function(n){var s=n[0];if(s.indexOf(i.GRAPH_DATA_SEPARATOR)>0&&(s=s.split(i.GRAPH_DATA_SEPARATOR)[0]),s===e){var a=n[1];a.indexOf(i.GRAPH_DATA_SEPARATOR)>0&&(a=a.split(i.GRAPH_DATA_SEPARATOR)[0]),t.push(a)}}),t},getRelatedSources:function(e,t){var i=this.getSources(),n=this.getRelatedSourceIds(t);return n=_.uniq(n),_.filter(i,function(t){return _.contains(n,t[e])})},getRelatedTargets:function(e,t){var i=this.getTargets(),n=this.getRelatedTargetIds(t);return n=_.uniq(n),_.filter(i,function(t){return _.contains(n,t[e])})},_getGraphData:function(e){var t=this.get(s.GRAPH);return t&&t[e]?t[e]:[]},showLatencyNotification:function(e,t){},showSuccessNotification:function(e,t,i){},triggerAppViewRefresh:function(){}},{DP:s,RELATIONSHIPS:n})}),define("models/InactivityPollingModel",["models/BaseModel","utils/AppConstants","utils/AppUtil"],function(e,t,i){"use strict";return e.extend({name:"InactivityPollingModel",queryPoller:null,lastChangeEventTime:null,_queryPollCheckFrequency:1e4,_currentDataState:t.STATE_INIT,_pollDataCallback:null,_inactivityInterval:9e4,initialize:function(e){if(e=e||{},!e.pollDataCallback)throw new Error("Callback for polling data not provided");this._pollDataCallback=e.pollDataCallback,e.inactivityInterval&&(this._inactivityInterval=e.inactivityInterval),e.queryPollCheckFrequency&&(this._queryPollCheckFrequency=e.queryPollCheckFrequency)},setDataState:function(e){this._currentDataState=e},startPolling:function(){var e=this;if(i.isLocalStorageProperty(t.LOCAL_STORAGE.NO_POLLING))return void i.log("InactivityPollingModel. Polling disabled.");this._log("Starting poller: Inactivity Interval:"+e._inactivityInterval),this.queryPoller=setInterval(function(){var i=Date.now()-e.lastChangeEventTime;e._log("Check for poll: Delta from last change:"+i),e._currentDataState!==t.STATE_PENDING&&i>e._inactivityInterval&&(e._log("Polling for new data"),e._pollDataCallback())},this._queryPollCheckFrequency)},stopPolling:function(){
this._log("Stop polling"),this.queryPoller&&(clearInterval(this.queryPoller),this.queryPoller=null)},registerActivity:function(e){this.lastChangeEventTime=e,this._log("activity detected:",e)},_log:function(e){i.debug("InactivityPollingModel: ",e)}})}),define("models/network/viz/NetworkVizBaseModel",["models/BaseModel","models/graph/GraphModel","models/graph/GraphHelper","models/InactivityPollingModel","data/DataProperties","utils/StyleDescriptor","utils/SubModelHelper","utils/AppConstants","utils/AppUtil"],function(e,t,i,n,s,a,r,o,l){"use strict";var c={QUERY_STATE:"change:queryStateTrigger",QUERY_RESULTS:"change:queryResultsTrigger",ENTITY_SELECTION:"change:entitySelection",GROUP_BY:"change:groupBy",SELECTED_GROUP:"change:selectedGroupTrigger",VM_SEARCH:"change:vmSearchTerm",DATA_UPDATED:"change:dataUpdated",REFRESH_DATA:"change:refreshDataTrigger",ERROR_MSG:"change:errorMessageTrigger"},d={VM_GROUPS_BY:"vmsGroupBy",SELECTED_GROUP:"selectedGroup",MAX_VMS:"maxVMs",VM_SEARCH_TERM:"vmSearchTerm",SELECTIONS:"selections",SHOW_UNASSIGNED_VLANS:"showUnassignedVlans",HOST_VIEW_SELECTIONS:"hostSelections"},u=e.extend({MAX_VNET_SELECTIONS:5,ENTITY_TYPES:[s.NW_E_TYPES.VLAN,s.NW_E_TYPES.VM,s.NW_E_TYPES.HOST,s.NW_E_TYPES.SWITCH,s.NW_E_TYPES.VIRTUAL_NETWORK],name:"NetworkVizBaseModel",subModelHelper:null,DP:d,VM_GROUP_BY_TUPLES:[[s.EB.VM.POWER_STATE,"Power State"],[s.EB.VM.NODE_NAME,"Host"],[s.EB.VM.IS_CVM,"VM Type"]],DEFAULT_MAX_VMS:10,CHANGE_EVENTS:c,defaults:{selections:null,showUnassignedVlans:!0,hostSelections:null,vmsGroupBy:null,selectedGroup:null,maxVMs:0,vmSearchTerm:null,errorMessage:null},initialize:function(a){e.prototype.initialize.apply(this,arguments);var l={};_.each(this.ENTITY_TYPES,function(e){l[e]=[]}),this.set(d.SELECTIONS,l),this.set(d.HOST_VIEW_SELECTIONS,{}),this.set(d.VM_GROUPS_BY,this.VM_GROUP_BY_TUPLES[0][0]),this.subModelHelper=new r;var c=this,u=new n({pollDataCallback:function(){c.refreshData(!1)}});this.subModelHelper.register("InactivityPollingModel",u);var h=[s.EB.VM.VM_NAME,s.EB.VM.NODE,s.EB.VM.NODE_NAME,s.EB.VM.IS_CVM,s.EB.VM.VIRTUAL_NIC_IDS];_.each(this.VM_GROUP_BY_TUPLES,function(e){h.push(e[0])});var p=new t({relationship:t.RELATIONSHIPS.VM2HOST,source_attributes:h,target_attributes:[s.UUID,s.NAME,s.VIRTUAL_NIC_HOST_NIC_IDS,s.BLOCK_MODEL,s.SERVICE_VM_ID]});this.subModelHelper.register(t.RELATIONSHIPS.VM2HOST,p),i.entityAttributes(s.NW_E_TYPES.VM,p.get(p.DP.SOURCE_ATTRIBUTES)),i.entityAttributes(s.NW_E_TYPES.HOST,p.get(p.DP.TARGET_ATTRIBUTES)),p=new t({relationship:t.RELATIONSHIPS.VLAN2VM,source_attributes:[s.VLAN_NAME],target_attributes:[s.EB.ENTITY_ID]}),this.subModelHelper.register(t.RELATIONSHIPS.VLAN2VM,p),i.entityAttributes(s.NW_E_TYPES.VLAN,p.get(p.DP.SOURCE_ATTRIBUTES)),i.entityAttributes(s.NW_E_TYPES.VNIC,[s.EB.VIRTUAL_NIC.VM,s.EB.VIRTUAL_NIC.VIRTUAL_NETWORK,s.EB.VIRTUAL_NIC.VLAN_ID]),p=new t({relationship:t.RELATIONSHIPS.VIRTUALNET2VLAN,source_attributes:[s.EB.VIRTUAL_NETWORK.NAME,s.EB.VIRTUAL_NETWORK.VLAN_ID],target_attributes:[s.VLAN_NAME]}),this.subModelHelper.register(t.RELATIONSHIPS.VIRTUALNET2VLAN,p),i.entityAttributes(s.NW_E_TYPES.VIRTUAL_NETWORK,p.get(p.DP.SOURCE_ATTRIBUTES)),i.entityAttributes(s.NW_E_TYPES.VNIC,[s.EB.VIRTUAL_NIC.VIRTUAL_NETWORK]),p=new t({relationship:t.RELATIONSHIPS.VIRTUALNET2VM,source_attributes:[s.EB.VIRTUAL_NETWORK.VIRTUAL_SWITCH_NAME],target_attributes:[s.EB.ENTITY_ID]}),this.subModelHelper.register(t.RELATIONSHIPS.VIRTUALNET2VM,p),i.entityAttributes(s.NW_E_TYPES.VIRTUAL_NETWORK,p.get(p.DP.SOURCE_ATTRIBUTES)),p=new t({relationship:t.RELATIONSHIPS.HOST2SWITCH,source_attributes:[s.UUID,s.NAME,s.VIRTUAL_NIC_HOST_NIC_IDS],target_attributes:[s.EB.NETWORK_SWITCH.NAME,s.EB.NETWORK_SWITCH.VLANS_DISCOVERED,s.EB.NETWORK_SWITCH.VLAN_IDS]}),this.subModelHelper.register(t.RELATIONSHIPS.HOST2SWITCH,p),i.entityAttributes(s.NW_E_TYPES.HOST,p.get(p.DP.SOURCE_ATTRIBUTES)),i.entityAttributes(s.NW_E_TYPES.SWITCH,p.get(p.DP.TARGET_ATTRIBUTES)),p=new t({relationship:t.RELATIONSHIPS.HOST2PNIC,source_attributes:[s.UUID,s.NAME],target_attributes:[s.EB.PNIC.NODE,s.EB.PNIC.PORT_NAME,s.EB.PNIC.LINK_SPEED,s.EB.PNIC.LINK_DETECTED]}),this.subModelHelper.register(t.RELATIONSHIPS.HOST2PNIC,p),i.entityAttributes(s.NW_E_TYPES.HOST,p.get(p.DP.SOURCE_ATTRIBUTES)),i.entityAttributes(s.NW_E_TYPES.PNIC,p.get(p.DP.TARGET_ATTRIBUTES)),p=new t({relationship:t.RELATIONSHIPS.SWITCH2INTERFACE,source_attributes:[s.EB.NETWORK_SWITCH.NAME],target_attributes:[s.EB.SWITCH_INTERFACE.NODE,s.EB.SWITCH_INTERFACE.HOST_NIC_UUIDS,s.EB.SWITCH_INTERFACE.NETWORK_SWITCH,s.EB.SWITCH_INTERFACE.PORT_NAME,s.EB.SWITCH_INTERFACE.PORT_NUM,s.EB.SWITCH_INTERFACE.ALLOWED_VLAN_IDS,s.EB.SWITCH_INTERFACE.ALLOWED_VLANS_DISCOVERED]}),this.subModelHelper.register(t.RELATIONSHIPS.SWITCH2INTERFACE,p),i.entityAttributes(s.NW_E_TYPES.SWITCH,p.get(p.DP.SOURCE_ATTRIBUTES)),i.entityAttributes(s.NW_E_TYPES.SWITCH_INTERFACE,p.get(p.DP.TARGET_ATTRIBUTES)),p=new t({relationship:t.RELATIONSHIPS.HOST2BRIDGE,source_attributes:[s.UUID],target_attributes:[s.EB.VIRTUAL_SWITCH.NAME,s.EB.VIRTUAL_SWITCH.NODE,s.EB.VIRTUAL_SWITCH.NIC_TEAM,s.EB.VIRTUAL_SWITCH.HOST_NICS]}),this.subModelHelper.register(t.RELATIONSHIPS.HOST2BRIDGE,p),i.entityAttributes(s.NW_E_TYPES.HOST,p.get(p.DP.SOURCE_ATTRIBUTES)),i.entityAttributes(s.NW_E_TYPES.BRIDGE,p.get(p.DP.TARGET_ATTRIBUTES)),p=new t({relationship:t.RELATIONSHIPS.HOST2BOND,source_attributes:[s.UUID],target_attributes:[s.EB.NIC_TEAM.NAME,s.EB.NIC_TEAM.NODE,s.EB.NIC_TEAM.HOST_NICS,s.EB.NIC_TEAM.ACTIVE_HOST_NIC]}),this.subModelHelper.register(t.RELATIONSHIPS.HOST2BOND,p),i.entityAttributes(s.NW_E_TYPES.HOST,p.get(p.DP.SOURCE_ATTRIBUTES)),i.entityAttributes(s.NW_E_TYPES.BOND,p.get(p.DP.TARGET_ATTRIBUTES)),this.updateState(o.STATE_INIT)},destroy:function(){this.stopQueryPolling(),this.subModelHelper.removeAll(),this.subModelHelper=null,e.prototype.destroy.apply(this,arguments)},fetchData:function(){this.getState()===o.STATE_INIT&&this.refreshData(!0)},refreshData:function(e){this.updateState(o.STATE_PENDING);var t=this;i.fetchData({success:function(){if(t.subModelHelper.iterate("createGraph"),t._validateSwitches(),e){var i=t.get(d.SELECTIONS);_.each(t.ENTITY_TYPES,function(e){var n=_.pluck(t.getEntities(e),"id");e===s.NW_E_TYPES.VIRTUAL_NETWORK?i[e]=n.slice(0,t.MAX_VNET_SELECTIONS):i[e]=n})}t._updateVLANColors(),t.updateState(o.STATE_SUCCESS),t._triggerChangeEvent(c.REFRESH_DATA)},error:function(){t.updateState(o.STATE_ERROR),t._triggerChangeEvent(c.REFRESH_DATA)}})},startQueryPolling:function(){this.subModelHelper.get("InactivityPollingModel").startPolling()},stopQueryPolling:function(){this.subModelHelper.get("InactivityPollingModel").stopPolling()},updateState:function(t){e.prototype.updateState.apply(this,arguments),this.subModelHelper.get("InactivityPollingModel").setDataState(t)},registerActivity:function(){this.subModelHelper.get("InactivityPollingModel").registerActivity(Date.now())},getEntities:function(e){switch(e){case s.NW_E_TYPES.VLAN:return this.subModelHelper.get(t.RELATIONSHIPS.VIRTUALNET2VLAN).getTargets();case s.NW_E_TYPES.HOST:return this.subModelHelper.get(t.RELATIONSHIPS.VM2HOST).getTargets();case s.NW_E_TYPES.VM:return this.subModelHelper.get(t.RELATIONSHIPS.VM2HOST).getSources();case s.NW_E_TYPES.SWITCH:return this.subModelHelper.get(t.RELATIONSHIPS.HOST2SWITCH).getTargets();case s.NW_E_TYPES.SWITCH_INTERFACE:return this.subModelHelper.get(t.RELATIONSHIPS.SWITCH2INTERFACE).getTargets();case s.NW_E_TYPES.VIRTUAL_NETWORK:return this.subModelHelper.get(t.RELATIONSHIPS.VIRTUALNET2VLAN).getSources();case s.NW_E_TYPES.PNIC:return this.subModelHelper.get(t.RELATIONSHIPS.HOST2PNIC).getTargets();case s.NW_E_TYPES.BRIDGE:return this.subModelHelper.get(t.RELATIONSHIPS.HOST2BRIDGE).getTargets();case s.NW_E_TYPES.BOND:return this.subModelHelper.get(t.RELATIONSHIPS.HOST2BOND).getTargets()}},getEntityById:function(e,t){var i=this.getEntities(e);return _.find(i,function(e){return e.id===t})},getSelectedEntityIds:function(e){return this.get(d.SELECTIONS)[e]},getSelectedEntities:function(e){var t=this.getEntities(e),i=this.getSelectedEntityIds(e);return _.filter(t,function(e){return _.contains(i,e.id)})},toggleEntitySelection:function(e,t){var i=this.get(d.SELECTIONS)[e];_.contains(i,t)?(i=_.without(i,t),this.get(d.SELECTIONS)[e]=i,e===s.NW_E_TYPES.VIRTUAL_NETWORK&&this._clearVirtualNetColor(t)):(i.push(t),this.get(d.SELECTIONS)[e]=i,this._updateVLANColors()),this._triggerChangeEvent(c.ENTITY_SELECTION,{entityType:e})},toggleShowUnassignedVlans:function(){this.set(d.SHOW_UNASSIGNED_VLANS,!this.get(d.SHOW_UNASSIGNED_VLANS)),this._triggerChangeEvent(c.ENTITY_SELECTION,{entityType:s.NW_E_TYPES.VIRTUAL_NETWORK})},selectAllEntities:function(e,t){if(t){var i=this.getEntities(e);this.get(d.SELECTIONS)[e]=_.pluck(i,s.ID)}else this.get(d.SELECTIONS)[e]=[];this._triggerChangeEvent(c.ENTITY_SELECTION,{entityType:e})},getEntitySelection:function(e){return this.get(d.HOST_VIEW_SELECTIONS)[e]},setEntitySelection:function(e,t){this.get(d.HOST_VIEW_SELECTIONS)[e]=t,this._triggerChangeEvent(c.ENTITY_SELECTION,{entityType:e})},getRelatedSourceIds:function(e,t){return this.subModelHelper.get(e).getRelatedSourceIds(t)},getRelatedTargetIds:function(e,t){return this.subModelHelper.get(e).getRelatedTargetIds(t)},getEdges:function(e){return this.subModelHelper.get(e).getEdges()},getRelatedSources:function(e,t){return this.subModelHelper.get(e).getRelatedSources(s.ID,t)},getRelatedTargets:function(e,t){return this.subModelHelper.get(e).getRelatedTargets(s.ID,t)},setVMsGroupBy:function(e){this.set(d.VM_GROUPS_BY,e),this.set(d.SELECTED_GROUP,null),this._triggerChangeEvent(c.GROUP_BY)},getVMsGroupBy:function(){return this.get(d.VM_GROUPS_BY)},setSelectedGroup:function(e){this.set(d.SELECTED_GROUP,e),this.set(d.MAX_VMS,this.DEFAULT_MAX_VMS),this._triggerChangeEvent(c.SELECTED_GROUP)},getSelectedGroup:function(){return this.get(d.SELECTED_GROUP)},getVMGroupMembers:function(e){var t=this.get(d.SELECTED_GROUP);if(t){var i=this.getVMGroups(),n=i[t];return e?this.filterVMs(n):n}return[]},getVMGroups:function(){var e=this.filterVMs(this.getEntities(o.ENTITY_VM)),t=this.get(d.VM_GROUPS_BY);return _.groupBy(e,function(e){return e[t]||"None"})},setVMSearchTeam:function(e){e!==this.get(this.DP.VM_SEARCH_TERM)&&(e&&e.length?this.set(this.DP.VM_SEARCH_TERM,e):this.set(this.DP.VM_SEARCH_TERM,null),this._triggerChangeEvent(c.VM_SEARCH))},loadMoreVMs:function(){var e=this.get(this.DP.MAX_VMS);this.set(this.DP.MAX_VMS,e+this.DEFAULT_MAX_VMS),this._triggerChangeEvent(c.SELECTED_GROUP)},filterVMs:function(e){var i=this.get(this.DP.VM_SEARCH_TERM),n=_.pluck(this.getSelectedEntities(s.NW_E_TYPES.VIRTUAL_NETWORK),s.ID),a=i?new RegExp(i,"i"):null;return _.filter(e,function(e){var i=this.getRelatedSourceIds(t.RELATIONSHIPS.VIRTUALNET2VM,e.id);if(i.length>0){if(!_.intersection(i,n).length)return!1}else if(!this.get(d.SHOW_UNASSIGNED_VLANS))return!1;return!a||a.test(e[s.EB.VM.VM_NAME])},this)},getVMHostsIds:function(e){var i=[];return _.each(e,function(e){i=i.concat(this.getRelatedTargetIds(t.RELATIONSHIPS.VM2HOST,e))},this),_.uniq(i)},getHostNicToSwitchPortEdges:function(){return this.getEdges(t.RELATIONSHIPS.HOST2SWITCH)},isHostPortPassive:function(e,i){var n=this.getRelatedTargets(t.RELATIONSHIPS.HOST2BOND,e),a=!0;return _.each(n,function(e){var t=e[s.EB.NIC_TEAM.ACTIVE_HOST_NIC];_.contains(t,i)&&(a=!1)}),a},isHostPortConnected:function(e,t){var i=this.getHostNicToSwitchPortEdges(),n=e+o.GRAPH_DATA_SEPARATOR+t;return _.find(i,function(e){return e[0]===n})},getVlansToRender:function(){var e=_.pluck(this.getSelectedEntities(s.NW_E_TYPES.VIRTUAL_NETWORK),s.EB.VIRTUAL_NETWORK.VLAN_ID);return _.filter(this.getEntities(s.NW_E_TYPES.VLAN),function(t){return _.contains(e,t.id)})},getVirtualNetColor:function(e){var t=this._getVlanForVirtualNet(e);return t?t.colorHex:"#"+a.NETVIZ.VLAN_UNKNOWN_FILL},_clearVirtualNetColor:function(e){var i=this._getVlanForVirtualNet(e);if(i){var n=this.getRelatedSources(t.RELATIONSHIPS.VIRTUALNET2VLAN,i.id),a=this.getSelectedEntityIds(s.NW_E_TYPES.VIRTUAL_NETWORK);_.some(n,function(e){return _.contains(a,e.id)})||(i.colorHex=null)}},_getVlanForVirtualNet:function(e){var i=this.getRelatedTargets(t.RELATIONSHIPS.VIRTUALNET2VLAN,e);return i&&i.length?_.first(i):null},_validateSwitches:function(){var e=this.getEntities(s.NW_E_TYPES.HOST),i=this.getEdges(t.RELATIONSHIPS.HOST2SWITCH),n=[];if(_.each(e,function(e){var a=this.getRelatedTargets(t.RELATIONSHIPS.HOST2PNIC,e.id);_.each(a,function(t){var a=t.id,r=e.id+"|"+a;_.find(i,function(e){return e[0]===r})||"1"!==t[s.EB.PNIC.LINK_DETECTED]||n.push(r)},this)},this),n.length){var a=this.subModelHelper.get(t.RELATIONSHIPS.HOST2SWITCH),r={id:o.UNKNOWN_NETWORK_SWITCH_ID,name:o.UNKNOWN_NETWORK_SWITCH,vlans_discovered:!1,vlan_ids:[]};a.addTarget(r);var l=o.UNKNOWN_NETWORK_SWITCH_ID+"|-1";_.each(n,function(e){a.addEdge([e,l])}),this._addUnknownSwitchPort(r,!0)}var c=this.getEntities(s.NW_E_TYPES.SWITCH);_.each(c,function(e){0===this.getRelatedTargetIds(t.RELATIONSHIPS.SWITCH2INTERFACE,e.id).length&&this._addUnknownSwitchPort(e,!1),e.name=e.name||"Unnamed"},this)},_addUnknownSwitchPort:function(e,i){var n=this.subModelHelper.get(t.RELATIONSHIPS.SWITCH2INTERFACE);i&&n.addSource(e),n.getTargetById(o.UNKNOWN_NETWORK_SWITCH_PORTNUM)||n.addTarget({id:o.UNKNOWN_NETWORK_SWITCH_PORTNUM,port_num:o.UNKNOWN_NETWORK_SWITCH_PORTNUM}),n.addEdge([e.id,o.UNKNOWN_NETWORK_SWITCH_PORTNUM])},_updateVLANColors:function(){var e=[];_.each(this.getEntities(s.NW_E_TYPES.VLAN),function(t){t.colorHex&&e.push(t.colorHex)});var t=this.getVlansToRender();_.each(t,function(t){if(!t.colorHex)for(var i=0;i<a.NETVIZ.VLAN_COLORS.length;i++){var n=a.NETVIZ.VLAN_COLORS[i];if(!_.contains(e,n)){t.colorHex=n,e.push(n);break}}})},getErrorMsg:function(){return this.get("errorMessage")},resetError:function(){this.set("errorMessage",null)},_setError:function(e){this.set("errorMessage",e),this._triggerChangeEvent(c.ERROR_MSG)},_triggerChangeEvent:function(e,t){l.debug("NetworkVizBaseModel : Trigger Event:",e,t||"no-data"),this.registerActivity(),this.trigger(e,t)}}),h=null;return{getInstance:function(){return null===h&&(h=new u),h},destroyInstance:function(){h&&h.destroy(),h=null}}}),define("text!templates/pages/network/NetworkVizBaseView.html",[],function(){return'<div class="network-container">\n\n  \x3c!-- LEFT PANEL --\x3e\n  <div class="side-panel left-panel">\n\n    \x3c!-- Scrollable inner panel --\x3e\n    <div class="left-panel-container">\n      <div class="antiscroll-wrap">\n        <div class="box-wrap">\n          <div class="antiscroll-inner left-panel-inner">\n            <div class="left-panel-inner-wrapper">\n              <div class="left-panel-inner-bottom"></div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n\n  </div>\n\n  \x3c!-- CENTER PANEL --\x3e\n  <div class="center-panel">\n    <div class="view-wrapper">\n      <div class="viz-options"></div>\n      <div class="viz-container-outer">\n        <div class="viz-container-wrapper">\n          <div class="antiscroll-wrap">\n            <div class="box-wrap viz-container-box-wrap">\n              <div class="antiscroll-inner viz-container-inner">\n                <div class="viz-container"></div>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n\n  \x3c!-- RIGHT PANEL --\x3e\n  <div class="side-panel right-panel">\n    <div class="right-panel-container">\n      <div class="antiscroll-wrap">\n        <div class="box-wrap">\n          <div class="antiscroll-inner right-panel-inner">\n            <div class="right-panel-inner-wrapper">\n              <div class="right-panel-inner-bottom"></div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n</div>\n'}),define("views/pages/network/entities/NetworkVizBaseView",["views/basecomponents/BaseView","utils/SubViewHelper","models/network/viz/NetworkVizBaseModel","text!templates/pages/network/NetworkVizBaseView.html"],function(e,t,i,n){"use strict";var s=_.template(n);return e.extend({subViewHelper:null,scrollers:null,initialize:function(i){e.prototype.initialize.apply(this,arguments),this.subViewHelper||(this.subViewHelper=new t),this.initializeModel(),this.layoutPanels(),this.render()},render:function(){this.$el.html(s),this.initializeSubViews(),this.scrollers=[];var e={x:!1,y:!0,autoHide:!0};_.each(this.$(".antiscroll-wrap"),function(t){var i=$(t).antiscroll(e).data("antiscroll");this.scrollers.push(i)},this)},destroy:function(){this.onStopServices(),i.destroyInstance(),this.model=null,this.subViewHelper.removeAll(),this.subViewHelper=null,e.prototype.destroy.apply(this,arguments)},onStartServices:function(){this.subViewHelper.iterate("onStartServices")},onStopServices:function(){this.subViewHelper.iterate("onStopServices")},layoutPanels:function(){},initializeSubViews:function(){},initializeModel:function(){this.model=i.getInstance(),this.model.fetchData()},onResize:function(){this._refreshScrollers(),this.subViewHelper.iterate("onResize")},show:function(e){$(window).trigger("resize.app")},_refreshScrollers:function(){var e=$(window).height(),t=$("#n-notification-bar").outerHeight(!0),i=$(".navbar").outerHeight(!0),n=this.$(".viz-options").outerHeight(!0),s=this.$(".side-panel").width(),a=$(window).width()-s,r=e-(t+i+0);this.$(".left-panel-inner").height(r).width(s),this.$(".left-panel-inner-wrapper").width(s);var o=e-(t+i+0+n)-15;this.$(".viz-container-inner").height(o).width(a),this.$(".viz-container-box-wrap").width(a);var l=e-(t+i+0);this.$(".right-panel-inner").height(l).width(s+20),this.$(".right-panel-inner-wrapper").width(s),_.each(this.scrollers,function(e){e.refresh()})}})}),define("views/pages/network/VlanSelectorView",["views/basecomponents/BaseView","data/DataProperties","utils/AppConstants"],function(e,t,i){"use strict";var n=_.template('<div class="panel-warning"><%= i18n("vlan_select_warning") %></div><div class="vlan-selector"><div class="panel-header"><%= headerText %></div><ul class="entity-selection-list nav"><% _.each(vnets, function(vnet) { %><%  var isChecked = _.contains(selectedVnetIds, vnet.id); %><li class="selection-item"><div class="checkbox-div"><input class="entity-checkbox" <%= isChecked ? "checked" : "" %> type="checkbox" data-id="<%= vnet.id %>"></div><div class="entity-name" data-id="<%= vnet.id %>"><%= vnet.name %></div><div class="selection-item-inner"><div class="entity-name" data-id="<%= vnet.id %>">VLAN <%= vnet.vlan_id %></div><div class="color-circle" style="background: #<%= colorMap[vnet.id] %>;"></div></div></li><% }) %><li class="selection-item unassigned-vlans"><div class="checkbox-div"><input class="entity-checkbox" <%= unassignedChecked ? "checked" : "" %> type="checkbox" data-id="<%= AppConstants.UNASSIGNED_VLAN_TAGS %>"></div><div class="entity-name" data-id="<%= AppConstants.UNASSIGNED_VLAN_TAGS %>"><%= i18n("vlan_other") %></div><div class="selection-item-inner"><div class="entity-name" data-id="<%= AppConstants.UNASSIGNED_VLAN_TAGS %>"><%= i18n("vlan_unassigned") %></div></div></div></li></ul></div>'),s=_.template('<div class="vlan-selector"><div class="panel-header"><%= i18n("virtual_networks") %></div><div class="panel-info"><%= i18n("vnets_not_available") %></div></div>');return e.extend({name:"VlanSelectorView",events:{"click .entity-checkbox":"onSelectEntity","click .entity-name":"onSelectEntity"},render:function(e){if(this.model.getState()===i.STATE_ERROR||this.model.getState()===i.STATE_PENDING)return void this.$el.html("");var a=this.model.getEntities(t.NW_E_TYPES.VIRTUAL_NETWORK);if(a.length){var r=this.model.getSelectedEntityIds(t.NW_E_TYPES.VIRTUAL_NETWORK),o={};_.each(a,function(e){o[e.id]=this.model.getVirtualNetColor(e.id)},this),this.$el.html(n(this.vtOptions({headerText:this.i18n("virtual_networks"),vnets:a,selectedVnetIds:r,colorMap:o,unassignedChecked:this.model.get(this.model.DP.SHOW_UNASSIGNED_VLANS)}))),this.applyNutanixInput({types:["checkbox"]})}else this.$el.html(s(this.vtOptions({})))},onStartServices:function(){this.model.on(this.model.CHANGE_EVENTS.REFRESH_DATA,this.render,this),this.model.on(this.model.CHANGE_EVENTS.ENTITY_SELECTION,this.render,this)},onStopServices:function(){this.model.off(this.model.CHANGE_EVENTS.REFRESH_DATA,this.render,this),this.model.off(this.model.CHANGE_EVENTS.ENTITY_SELECTION,this.render,this)},onSelectEntity:function(e){var n=$(e.currentTarget).attr("data-id"),s=t.NW_E_TYPES.VIRTUAL_NETWORK;if(n===i.UNASSIGNED_VLAN_TAGS)return void this.model.toggleShowUnassignedVlans();var a=this.model.getSelectedEntityIds(s);if(!_.contains(a,n)&&a.length===this.model.MAX_VNET_SELECTIONS)return this.render(),void this.$(".panel-warning").show();this.$(".panel-warning").hide(),this.model.toggleEntitySelection(s,n)}})}),define("views/pages/network/NetworkVizOptionsView",["views/basecomponents/BaseView","data/DataProperties","utils/EntityUtil","utils/AppConstants"],function(e,t,i,n){"use strict";var s=_.template('<div class="vlan-viz-options"><div class="vm-options"><div class="vm-options-inner"><div class="search-form <%= searchActiveClass %>"><input style="" class="search-query" value="<%= searchTerm %>"spellcheck="false" autocomplete="off" placeholder="Search VMs" type="text"></div><div class="ungroup-vms"><%= vmPrefix1 %></div><div class="prefix"><span class="caret-right"><%= Components.icon("y") %></span><%= vmPrefix2 %></div><%= vmsDropdown %></div></div><div class="host-options"><%= hostsDropdown %></div><div class="switch-options"><%= switchesDropdown %></div></div>'),a=_.template('<div class="<%= id %>-dropdown dropdown"><a data-toggle="dropdown" class="btn btn-default dropdown-toggle"><span><%= title %></span> <%= title.length ? SVG.SVGIcon(\'z\', \'-down-arrow\') : \'\' %></a><ul class="dropdown-menu"><% _.each(options, function(tuple) { %><%  var s = (tuple[0] === selectedValue) ? "selected" : ""; %><li class="<%= s %>"><a class="<%= id %>-link" data-id="<%= tuple[0] %>"><%= tuple[1] %></a></li><% }) %></ul></div>'),r=_.template('<div class="<%= id %>-dropdown dropdown"><a data-toggle="dropdown" class="btn btn-default dropdown-toggle"><%= title %> <%= SVG.SVGIcon(\'z\', \'-down-arrow\') %></a><% if ( options.length ) { %><ul class="dropdown-menu <%= dropdownClass %>"><li class="select-clear-row"> <span class="selAll" data-type="<%= entityType %>"><%= i18n("select_all") %></span>&middot;<span class="clrAll" data-type="<%= entityType %>"><%= i18n("clear_all") %></span></li><% _.each(options, function(tuple) { %><% var ckd = _.contains(selectedIds, tuple[0]) ? "checked" : ""; %><li class="check-box-row"><input class="entity-checkbox" data-type="<%= entityType %>" type="checkbox" <%= ckd %> data-id="<%= tuple[0] %>"><%= tuple[1] %></li><% }) %></ul><% } %></div>'),o=_.template('<div class="<%= id %>-dropdown dropdown disabled-dropdown"><a data-toggle="dropdown" class="btn btn-default dropdown-toggle"><%= title %> '+"<%= SVG.SVGIcon('z', '-down-arrow') %></a></div>");return e.extend({name:"NetworkVizOptionsView",events:{"click .entity-checkbox":"onEntitySelect","click .ungroup-vms":"onRemoveGroupSelection","click .vmsGroupBy-link":"onVmsGroupBy","click .selAll":"onSelectAllEntities","click .clrAll":"onDeselectAllEntities","click .search-form":"onSearchIconClick","blur  .search-query":"onSearchBlur","keyup .search-query":"onSearchKeyUp"},onStartServices:function(){this.model.on(this.model.CHANGE_EVENTS.REFRESH_DATA,this.render,this),this.model.on(this.model.CHANGE_EVENTS.SELECTED_GROUP,this.render,this),this.model.on(this.model.CHANGE_EVENTS.ENTITY_SELECTION,this.render,this),this.model.on(this.model.CHANGE_EVENTS.GROUP_BY,this.render,this)},onStopServices:function(){this.model.off(this.model.CHANGE_EVENTS.REFRESH_DATA,this.render,this),this.model.off(this.model.CHANGE_EVENTS.SELECTED_GROUP,this.render,this),this.model.off(this.model.CHANGE_EVENTS.ENTITY_SELECTION,this.render,this),this.model.off(this.model.CHANGE_EVENTS.GROUP_BY,this.render,this)},render:function(e){var l,c="",d="",u="",h="",p=this.model.get(this.model.DP.SELECTED_GROUP);l=p?this.model.getVMGroupMembers(p).length:this.model.getEntities(n.ENTITY_VM).length;var T,E=null;if(l>0){var g=this.model.getVMsGroupBy();if(p){var S=i.getAttributeDisplayValue(n.ENTITY_VM,this.model.getVMsGroupBy(),p,!1);E=this.model.getVMGroupMembers(!1),c=this.i18n("back"),d=this.i18ns("vms_in_grp",S),u=""}else{c="",d="";var m=_.find(this.model.VM_GROUP_BY_TUPLES,function(e){return e[0]===g});u=this.i18ns("group_by",m[1])}h=a(this.vtOptions({id:"vmsGroupBy",title:u,options:this.model.VM_GROUP_BY_TUPLES,selectedValue:g}))}var v="",f=this.model.getEntities(t.NW_E_TYPES.HOST);if(f.length){var A=this.model.getSelectedEntityIds(t.NW_E_TYPES.HOST),y=[];_.each(f,function(e){y.push([e.id,e.name])}),T=1===y.length?this.i18n("one_host"):A.length>0&&A.length!==f.length?this.i18ns("n_of_m_hosts",A.length,y.length):this.i18ns("n_hosts",y.length);v=(y.length?r:o)(this.vtOptions({id:"selectedHosts",title:T,entityType:t.NW_E_TYPES.HOST,options:y,selectedIds:A,dropdownClass:""}))}var C=this.model.getEntities(t.NW_E_TYPES.SWITCH),I=this.model.getSelectedEntityIds(t.NW_E_TYPES.SWITCH),b=[];_.each(C,function(e){b.push([e.id,e.name])}),T=0===b.length?this.i18n("no_switches"):1===b.length?this.i18n("one_switch"):I.length>0&&I.length!==C.length?this.i18ns("n_of_m_switches",I.length,b.length):this.i18ns("n_switches",b.length);var R=b.length?r:o,N=R(this.vtOptions({id:"selectedSwitches",title:T,entityType:t.NW_E_TYPES.SWITCH,options:b,selectedIds:I,dropdownClass:""})),P=this.model.get(this.model.DP.VM_SEARCH_TERM)||"";this.$el.html(s(this.vtOptions({searchTerm:P,searchActiveClass:P.length?"active":"inactive",vmPrefix1:c,vmPrefix2:d,vmsDropdown:h,hostsDropdown:v,switchesDropdown:N}))),E&&(this.$(".caret-right").addClass("show-caret"),this.$(".vmsGroupBy-dropdown").addClass("remove-separator"),this.$(".vmsGroupBy-dropdown .dropdown-toggle").empty()),this.applyNutanixInput({types:["checkbox"]})},onResize:function(){var e=$(window).width()-$(".left-panel").width(),t=Math.round(e/2)-100;this.$(".host-options").css("left",t)},onEntitySelect:function(e){var t=$(e.currentTarget),i=t.attr("data-id"),n=t.attr("data-type");this.model.toggleEntitySelection(n,i)},onSelectAllEntities:function(e){var t=$(e.currentTarget),i=t.attr("data-type");this.model.selectAllEntities(i,!0)},onDeselectAllEntities:function(e){var t=$(e.currentTarget),i=t.attr("data-type");this.model.selectAllEntities(i,!1)},onSearchKeyUp:_.throttle(function(e){e.stopPropagation();var t=$.ui.keyCode;e.keyCode===t.ESCAPE?this._hideSearch():this.model.setVMSearchTeam(this.$(".search-query").val().trim())}),onSearchBlur:function(e){0===this.$(".search-query").val().trim().length?this._hideSearch():this._showSearch()},onSearchIconClick:function(e){this.$(".search-form").hasClass("inactive")&&(this._showSearch(),this.$(".search-query").focus())},onRemoveGroupSelection:function(e){this.model.setSelectedGroup(null)},onVmsGroupBy:function(e){var t=$(e.currentTarget),i=t.attr("data-id");this.model.setVMsGroupBy(i)},_showSearch:function(){this.$(".search-form").removeClass("inactive").addClass("active")},_hideSearch:function(){this.$(".search-form").removeClass("active").addClass("inactive")}})}),define("views/pages/network/NetworkEntitiesReport",["models/network/viz/NetworkVizBaseModel"],function(e){"use strict";return{generateReport:function(){var t=e.getInstance(),i=_.template("<table><tr><th><%= lName %></th><th><%= rName %></th></tr>"),n=_.template('<tr><td class="<%= lClass %>"><%= lValue %></td><td class="<%= rClass %>"><%= rValue %></td></tr>'),s='<style type="text/css">\n    .log-title {\n      text-align: center;\n    }\n\n    .entity-group {\n      color: teal;\n      margin: 15px;\n    }\n\n    table {\n      font-family: arial, sans-serif;\n      font-size: 10px;\n      border-collapse: collapse;\n      width: 100%;\n    }\n\n    td, th {\n      border: 1px solid #dddddd;\n      text-align: left;\n      padding: 8px;\n    }\n\n    th:first-child,\n      td:first-child {\n      width: 350px;\n    }\n\n    tr:nth-child(even) {\n      background-color: #dddddd;\n    }\n\n    .error {\n      background: red;\n      color: white;\n    }\n    </style>',a=null;if(s+='<h1 class="log-title">Network Visualization Data Report</h1>',!t)return void(s+="<div>The data is not available</div>");var r=t.getEntities("vm"),o=t.getEntities("host");a=t.getEdges("vm2host");var l=[],c=[];s+='<div class="entity-group">VMS</div>',s+=i({lName:"VM Id",rName:"VM Name"}),_.each(r,function(e){s+=n({lClass:"",lValue:e.id,rClass:"",rValue:e.vm_name}),l.push(e.id)}),s+="</table>",s+='<div class="entity-group">HOSTS</div>',s+=i({lName:"Host Id",rName:"Host Name"}),_.each(o,function(e){s+=n({lClass:"",lValue:e.id,rClass:"",rValue:e.name}),c.push(e.id)}),s+="</table>",s+='<div class="entity-group">VM2HOST EDGES</div>',s+=i({lName:"VM Id",rName:"Host Id"}),_.each(a,function(e){var t=void 0,i=void 0;t=_.contains(l,e[0])?"":"error",i=_.contains(c,e[1])?"":"error",s+=n({lClass:t,lValue:e[0],rClass:i,rValue:e[1]})}),s+="</table>";var d=t.getEntities("vlan"),u=[];a=t.getEdges("vlan2vm"),s+='<div class="entity-group">VLANS</div>',s+=i({lName:"VLan Id",rName:"VLan Name"}),_.each(d,function(e){s+=n({lClass:"",lValue:e.id,rClass:"",rValue:e.name}),u.push(e.id)}),s+="</table>",s+='<div class="entity-group">VLAN2VM EDGES</div>',s+=i({lName:"VLan Id",rName:"VM Id"}),_.each(a,function(e){var t=_.contains(u,e[0])?"":"error",i=_.contains(l,e[1])?"":"error";s+=n({lClass:t,lValue:e[0],rClass:i,rValue:e[1]})}),s+="</table>";var h=t.getEntities("virtual_network"),p=[];a=t.getEdges("virtualnet2vlan"),s+='<div class="entity-group">VIRTUAL NETWORKS</div>',s+=i({lName:"VNet Id",rName:"VNet Name"}),_.each(h,function(e){s+=n({lClass:"",lValue:e.id,rClass:"",rValue:e.name}),p.push(e.id)}),s+="</table>",s+='<div class="entity-group">VIRTUALNETWORK2VLAN EDGES</div>',s+=i({lName:"VNet Id",rName:"VLan Id"}),_.each(a,function(e){var t=_.contains(p,e[0])?"":"error",i=_.contains(u,e[1])?"":"error";s+=n({lClass:t,lValue:e[0],rClass:i,rValue:e[1]})}),s+="</table>",a=t.getEdges("virtualnet2vm"),s+='<div class="entity-group">VIRTUALNETWORK2VM EDGES</div>',s+=i({lName:"VNet Id",rName:"VM Id"}),_.each(a,function(e){var t=_.contains(p,e[0])?"":"error",i=_.contains(l,e[1])?"":"error";s+=n({lClass:t,lValue:e[0],rClass:i,rValue:e[1]})}),s+="</table>";var T=t.getEntities("network_switch"),E=[],g=[];a=t.getEdges("switch2interface"),s+='<div class="entity-group">NETWORK SWITCHES</div>',s+=i({lName:"Switch Id",rName:"Switch Name"}),_.each(T,function(e){s+=n({lClass:"",lValue:e.id,rClass:"",rValue:e.name}),E.push(e.id)}),s+="</table>",s+='<div class="entity-group">SWITCH2INTERFACE EDGES</div>',s+=i({lName:"Switch Id",rName:"Switch Interface Id"}),_.each(a,function(e){var t=_.contains(E,e[0])?"":"error";s+=n({lClass:t,lValue:e[0],rClass:"",rValue:e[1]}),g.push(e[1])}),s+="</table>";var S=t.getEntities("host_nic"),m=[];a=t.getEdges("host2pnic"),s+='<div class="entity-group">HOST PNICS</div>',s+=i({lName:"PNIC Id",rName:"PNIC Name"}),_.each(S,function(e){s+=n({lClass:"",lValue:e.id,rClass:"",rValue:e.port_name}),m.push(e.id)}),s+='<div class="entity-group">HOST2PNIC EDGES</div>',s+=i({lName:"Host Id",rName:"PNIC Id"}),_.each(a,function(e){var t=_.contains(c,e[0])?"":"error",i=_.contains(m,e[1])?"":"error";s+=n({lClass:t,lValue:e[0],rClass:i,rValue:e[1]})}),s+="</table>",a=t.getEdges("host2switch"),s+='<div class="entity-group">HOST2SWITCH EDGES</div>',s+=i({lName:"Host Id",rName:"Switch Id"});var v=void 0,f=void 0;_.each(a,function(e){var t=e[0].split("|")[0],i=e[1].split("|")[0];v=_.contains(c,t)?"":"error",f=_.contains(E,i)?"":"error",s+=n({lClass:v,lValue:t,rClass:f,rValue:i})}),s+="</table>",s+=i({lName:"Host PNIC Id",rName:"Switch Interface Id"}),_.each(a,function(e){var t=e[0].split("|")[1],i=e[1].split("|")[1];v=_.contains(m,t)?"":"error",f=_.contains(g,i)?"":"error",s+=n({
lClass:v,lValue:t,rClass:f,rValue:i})}),s+="</table>";var A=t.getEntities("virtual_switch"),y=[];a=t.getEdges("host2bridge"),s+='<div class="entity-group">BRIDGES (VIRTUAL SWITCHES)</div>',s+=i({lName:"Bridge Id",rName:"Bridge Name"}),_.each(A,function(e){s+=n({lClass:"",lValue:e.id,rClass:"",rValue:e.name}),y.push(e.id)}),s+="</table>",s+='<div class="entity-group">HOST2BRIDGE EDGES</div>',s+=i({lName:"Host Id",rName:"Bridge Id"}),_.each(a,function(e){v=_.contains(c,e[0])?"":"error",f=_.contains(y,e[1])?"":"error",s+=n({lClass:v,lValue:e[0],rClass:f,rValue:e[1]})}),s+="</table>";var C=t.getEntities("nic_team"),I=[];return a=t.getEdges("host2bond"),s+='<div class="entity-group">BONDS (NIC TEAMS)</div>',s+=i({lName:"Bond Id",rName:"Bond Name"}),_.each(C,function(e){s+=n({lClass:"",lValue:e.id,rClass:"",rValue:e.name}),I.push(e.id)}),s+="</table>",s+='<div class="entity-group">HOST2BOND EDGES</div>',s+=i({lName:"Host Id",rName:"Bond Id"}),_.each(a,function(e){v=_.contains(c,e[0])?"":"error",f=_.contains(I,e[1])?"":"error",s+=n({lClass:v,lValue:e[0],rClass:f,rValue:e[1]})}),s+="</table>"}}}),define("views/pages/network/NetworkEntitiesVizView",["views/basecomponents/BaseView","d3tip","models/graph/GraphModel","data/DataProperties","managers/PopupManager","views/pages/network/NetworkEntitiesReport","utils/AppUtil","utils/EntityUtil","utils/D3Util","utils/SVG","utils/StyleDescriptor","utils/AppConstants"],function(e,t,i,n,s,a,r,o,l,c,d,u){"use strict";var h=_.template('<div class="vizError"><%= i18n("error_loading_msg") %></div>'),p=_.template('<div class="vizLoading"><span class="donut-loader-blue"></span>&nbsp;<%= i18n("loading_msg") %></div>'),T=_.template('<%= i18n("no_matches") %>'),E=_.template('<div class="name-value-tooltip"><% _.each(nvPairs, function(nvPair) { %><div class="nv-pair"><div class="name"><%= nvPair[0] %></div><div class="value"><%= nvPair[1] %></div></div><% }) %>');return e.extend({name:"NetworkEntitiesVizView",_svg:null,_lines:{},_highlightEntityIds:[],_PORT_ICON_PATH_10G:c.network10GPortIconPath,_PORT_ICON_PATH:c.networkPortIconPath,_PORT_HELP_PATH:c.helpIconPath,_selectedSwitchId:null,_selectedSwitchPort:null,events:{click:"onViewClick",dblclick:"onViewDoubleClick","mouseover g.vm-group":"onVMMouseOver","mouseover g.vm":"onVMMouseOver","mouseover g.host-group":"onHostMouseOver","mouseover .switch-interface-group":"onSwitchInterfaceMouseOver","mouseout  g.vm-group":"onEntityMouseOut","mouseout  g.vm":"onEntityMouseOut","mouseout  g.host-group":"onEntityMouseOut","mouseout  g.switch-interface-group":"onEntityMouseOut","click .vm-group":"onVmGroupClick","click .entity-name-text":"onEntityClick","click .switch-port-label":"onEntityClick","click .switch-name-label":"onEntityClick","click path.switch-port-unavailable":"onSwitchPortHelpClick","click .load-more-label":"onLoadMoreVMs","click .vm-container":"onVMHighlight"},initialize:function(){e.prototype.initialize.apply(this,arguments),l.addSelectionHelpers()},render:function(){if(this.model.getState()===u.STATE_ERROR)return void this.$el.html(h(this.vtOptions({})));if(this.model.getState()===u.STATE_PENDING)return void this.$el.html(p(this.vtOptions({})));this.clearTooltips(),this.$el.html('<div class="vizContent"></div>');var e=this.$el.width();this._tip=d3.tip().attr("class","d3-tip net-viz-tooltip").offset(function(){return[0,10]}).direction("e").html(function(e){return e.attr("tooltipText")}),this._svg=d3.select(this.$(".vizContent")[0]).append("svg").attr("width",e).attr("height",600).attr("class","net-vlan-viz").call(this._tip);var t=this.model.getVlansToRender().length;this.model.get(this.model.DP.SELECTED_GROUP)?this._renderVMs(20):this._renderVMGroupBoxes(20),this._renderHosts(Math.round(e/2)-Math.round(100)),this._renderSwitches(e-this._getSwitchBoxWidth(t)-20),this._renderEdges(),this._highlightVms();var i=this.$("svg.net-vlan-viz")[0].getBBox().height,n=i+30;this._svg.attr("height",n),this.$(".vizContent").height(n+30)},onStartServices:function(){this.model.on(this.model.CHANGE_EVENTS.ENTITY_SELECTION,this.render,this),this.model.on(this.model.CHANGE_EVENTS.SELECTED_GROUP,this.render,this),this.model.on(this.model.CHANGE_EVENTS.VM_SEARCH,this.render,this),this.model.on(this.model.CHANGE_EVENTS.GROUP_BY,this.render,this),this.model.on(this.model.CHANGE_EVENTS.REFRESH_DATA,this.render,this),this.model.startQueryPolling()},onStopServices:function(){this.model.stopQueryPolling(),this.model.off(this.model.CHANGE_EVENTS.ENTITY_SELECTION,this.render,this),this.model.off(this.model.CHANGE_EVENTS.SELECTED_GROUP,this.render,this),this.model.off(this.model.CHANGE_EVENTS.VM_SEARCH,this.render,this),this.model.off(this.model.CHANGE_EVENTS.GROUP_BY,this.render,this),this.model.off(this.model.CHANGE_EVENTS.REFRESH_DATA,this.render,this),this.clearTooltips()},onResize:function(){this.render()},clearTooltips:function(){$(".d3-tip").remove()},onViewClick:function(e){this.model.registerActivity()},onViewDoubleClick:function(e){var t=this;r.isLocalStorageProperty(u.LOCAL_STORAGE.NETVIZ_REPORT)&&event.shiftKey&&$.nutanixConfirm({msg:this.i18n("generate_report"),yes:function(){t._generateReport()},yesText:this.i18n("yes"),noText:this.i18n("no"),context:this})},onVmGroupClick:function(e){var t=$(e.currentTarget).attr("data-id");this.model.setSelectedGroup(t)},onVMMouseOver:function(e){var t=d3.select(e.currentTarget);this.selectVMByClass(t,"selected",!0)},selectVMByClass:function(e,t,i){var s=this,a=e.attr("data-id");e.select("rect.entity-box").classed(t,i),this._svg.selectAll('path[source-id="'+a+'"]').classed(t,i);var r;if(e.classed("vm-group")){var o=this.model.getVMGroups();r=this.model.getVMHostsIds(_.pluck(o[a],n.ID))}else r=this.model.getVMHostsIds([a]);_.each(r,function(e){s._svg.select('g[data-id="'+e+'"] rect.entity-box').classed(t,i)});var l=this.model.getHostNicToSwitchPortEdges();_.each(l,function(e){var n=e[0].split("|"),a=n[0];if(_.contains(r,a)){s._svg.selectAll('path[source-id="'+e[0]+'"]').classed(t,i),n=e[1].split("|");var o=(n[0],n[1]);s._svg.selectAll('g.switch-interface-group[data-id="'+o+'"] .switch-interface').classed(t,i)}})},onHostMouseOver:function(e){var t=this,i=d3.select(e.currentTarget),n=i.attr("data-id");i.select("rect.entity-box").classed("selected",!0),this._svg.selectAll('path[target-id="'+n+'"]').classed("selected",!0).each(function(e){var i=e.source.id;t._svg.select('g[data-id="'+i+'"] > .entity-box').classed("selected",!0)});var s=this.model.getHostNicToSwitchPortEdges();_.each(s,function(e){var i=e[0].split("|");if(i[0]===n){t._svg.selectAll('path[source-id="'+e[0]+'"]').classed("selected",!0),i=e[1].split("|");var s=(i[0],i[1]);s!==u.UNKNOWN_NETWORK_SWITCH_PORTNUM&&t._svg.selectAll('g.switch-interface-group[data-id="'+s+'"] .switch-interface').classed("selected",!0)}})},_getEntityName:function(e,t){var i,s;if(s=this.model.getEntityById(t,e))switch(t){case n.NW_E_TYPES.SWITCH:i=s[n.EB.NETWORK_SWITCH.NAME];break;case n.NW_E_TYPES.VM:i=s[n.EB.VM.VM_NAME];break;case n.NW_E_TYPES.SWITCH_INTERFACE:i=s[n.EB.SWITCH_INTERFACE.PORT_NAME];break;case n.NW_E_TYPES.HOST:i=s[n.NAME];break;default:i=""}return i},onSwitchPortHelpClick:function(e){e.stopPropagation();var t={action:u.ACTION_SHOW_NW_ENTITY_DETAILS,actionTarget:n.NW_E_TYPES.SWITCH_INTERFACE,actionTargetId:"-1",actionTargetName:this.i18n("port_data_unavailable")};s.handleAction(t)},onEntityClick:function(e){var t,i,a,r,o;e.stopPropagation();var l=this.$(e.currentTarget),c=l.attr("entity-type");if(c===n.NW_E_TYPES.SWITCH_INTERFACE?(t=l.parent("g.switch-interface-group").parent("g.switch-group").attr("data-id"),i=l.attr("data-id"),a=l.text()):(i=l.attr("entity-id"),a=l.text()),c===n.NW_E_TYPES.SWITCH||c===n.NW_E_TYPES.VM){r=(this.clusterManager?this.clusterManager.getCurrentClusterUuid():"")+u.FILTER_RANGE_SEPARATOR+i}c===n.NW_E_TYPES.HOST&&(o=this.model.getEntityById(c,i))&&(r=o[n.SERVICE_VM_ID]),a=this._getEntityName(i,c)||a;var d={action:u.ACTION_SHOW_NW_ENTITY_DETAILS,actionTarget:c,actionTargetId:i,actionTargetName:a,actionParentId:t,contextId:r};s.handleAction(d)},onLoadMoreVMs:function(){this.model.loadMoreVMs()},onVMHighlight:function(e){var t=this.$(e.currentTarget).attr("data-id");if(_.contains(this._highlightEntityIds,t)){this._highlightEntityIds=_.without(this._highlightEntityIds,t);var i=d3.select('.vm[data-id="'+t+'"]');this.selectVMByClass(i,"selected",!1)}else this._highlightEntityIds.push(t);this._svg.selectAll(".highlighted").classed("highlighted",!1),this._highlightVms()},onSwitchInterfaceMouseOver:function(e){var t=this,i=this.$(e.currentTarget),n=i.attr("data-id"),s=i.parent("g.switch-group").attr("data-id");this._svg.selectAll(".selected").classed("selected",!1),this._svg.selectAll('g.switch-interface-group[data-id="'+n+'"] .switch-interface').classed("selected",!0),this._svg.selectAll('path[target-id="'+s+"|"+n+'"]').classed("selected",!0).each(function(e){var i=e.source.id.split("|")[0];t._svg.select('g[data-id="'+i+'"] > .entity-box').classed("selected",!0),t._svg.selectAll('path[target-id="'+i+'"]').classed("selected",!0).each(function(e){var i=e.source.id;t._svg.select('g[data-id="'+i+'"] > .entity-box').classed("selected",!0)})})},onEntityMouseOut:function(e){this._svg.selectAll(".selected").classed("selected",!1),this._selectedSwitchId=null,this._selectedSwitchPort=null},_renderEdges:function(){var e=this.model.getSelectedEntityIds(n.NW_E_TYPES.HOST),t=this.model.getSelectedEntityIds(n.NW_E_TYPES.SWITCH),i=this;if(this.model.get(this.model.DP.SELECTED_GROUP)){var s=this._getVMs2Render(),a=[];_.each(s,function(t){var s=t[n.EB.VM.VIRTUAL_NIC_IDS];if(s&&s.length){var r=_.first(i.model.getVMHostsIds([t.id]));if(_.contains(e,r)){var o=i._svg.select('g.vm[data-id="'+t.id+'"]'),c=l.getConnectionPoint(o,"rect","R"),d=i._svg.select('g.host-group[data-id="'+r+'"]'),u=l.getConnectionPoint(d,"rect","L");a.push({source:{id:t.id,connector:c},target:{id:r,connector:u},isDashed:!1})}}},this),this._renderLines("vm2host",a)}else{var r=[],o=this.model.getVMGroups();_.each(o,function(t,s){var a=i.model.getVMHostsIds(_.pluck(t,n.ID)),o=i._svg.select('g.vm-group[data-id="'+s+'"]'),c=l.getConnectionPoint(o,"rect","R");_.each(a,function(t){if(_.contains(e,t)){var n=i._svg.select('g.host-group[data-id="'+t+'"]'),a=l.getConnectionPoint(n,"rect","L");r.push({source:{id:s,connector:c},target:{id:t,connector:a},isDashed:!1})}})}),this._renderLines("vm-group2host",r)}var c=[],d=this.model.getHostNicToSwitchPortEdges();_.each(d,function(n){var s=n[0].split("|"),a=s[0],r=s[1];s=n[1].split("|");var o=s[0],d=s[1];if(o&&d&&a&&r&&_.contains(e,a)&&_.contains(t,o)){var u=this._svg.select('.host-group[data-id="'+a+'"]'),h='.host-pnic[data-id="'+r+'"]',p=l.getConnectionPoint(u,h,"R");p.x+=10;var T=this._svg.select('.switch-group[data-id="'+o+'"]'),E='.switch-interface-group[data-id="'+d+'"] > .switch-port',g=l.getConnectionPoint(T,E,"L"),S=i.model.isHostPortPassive(a,r);c.push({source:{id:n[0],connector:p},target:{id:n[1],connector:g},isDashed:S})}},this),this._renderLines("hostNic2switchPort",c)},_renderVMGroupBoxes:function(e){if(0===this.model.getEntities(n.NW_E_TYPES.VM).length)return void this._renderMsg(u.NOTIFY_ERROR,this.i18n("vms_not_available"),e,30);var t=this.model.getVMGroups(),s=this.model.getVlansToRender(),a=s.length;if(0===_.keys(t).length)return void this._renderMsg(u.NOTIFY_INFO,this.i18n("vms_dont_match"),e,30);_.each(t,function(e){var t=[];_.each(e,function(e){var n=this.model.getRelatedSourceIds(i.RELATIONSHIPS.VLAN2VM,e.id);n&&n.length&&(t=t.concat(n))},this),e.group_vlan_ids=_.unique(t)},this);var r=Math.max(200,100+12*a),l=this._svg.selectAll(".vm-group").data(_.keys(t)),c=function(e,t){return 30+70*t};l.enter().append("g").attr("class","vm-group").attr("data-id",function(e){return e}).attr("gleft",e).attr("gtop",c).attr("transform",function(t,i){return"translate("+e+","+c(0,i)+")"});var d=this,h=o.getAttributeDisplayName(u.ENTITY_VM,this.model.getVMsGroupBy());l.append("svg:text").attr("class","vm-group-name-label").attr("x",0).attr("y",0).each(function(e){var t=d3.select(this),i=o.getAttributeDisplayValue(u.ENTITY_VM,d.model.getVMsGroupBy(),e,!1);t.append("tspan").text(h+" : "+i)});l.append("rect").attr("class","entity-box").attr("x",.5).attr("y",10.5).attr("rx",3.5).attr("ry",3.5).attr("width",r).attr("height",30),l.append("svg:text").attr("class","vm-group-label").attr("x",12).attr("y",30).each(function(e){var i=d3.select(this),n=t[e].length,s=n+" VM";s+=n>1?"s":"",i.append("tspan").text(s)}),l.append("g").attr("class","vlan-group").attr("transform",function(e,i){return"translate("+(r-12*t[e].group_vlan_ids.length)+",25)"}).each(function(e){var i=d3.select(this),a=t[e].group_vlan_ids,r=_.filter(s,function(e){return _.contains(a,e.id)});d._renderVlanCircles(i,r,_.pluck(s,n.ID))})},_renderVMs:function(e){if(0===this.model.getEntities(n.NW_E_TYPES.VM).length)return void this._renderMsg(u.NOTIFY_ERROR,this.i18n("vms_not_available"),e,30);var t=this._getVMs2Render();if(0===t.length){var s=T(this.vtOptions({}));return void this._renderMsg(u.NOTIFY_ERROR,s,e,30)}var a=this.model.getVlansToRender(),r=a.length,o=Math.max(200,100+12*r),l=this._svg.selectAll(".vm").data(t),c=this,d=function(e,t){return 30+50*t};l.enter().append("g").attr("class","vm vm-container").attr("data-id",function(e){return e[n.ID]}).attr("gleft",e).attr("gtop",d).attr("transform",function(t,i){return"translate("+e+","+d(0,i)+")"}).each(function(e){e.vlan_ids=_.unique(c.model.getRelatedSourceIds(i.RELATIONSHIPS.VLAN2VM,e.id))});l.append("rect").attr("class","entity-box").attr("x",.5).attr("y",.5).attr("rx",3.5).attr("ry",3.5).attr("width",o).attr("height",30),l.append("clipPath").attr("id","clip-vm-name").append("rect").attr("x",12).attr("y",.5).attr("width",function(e){return o-12*(e.vlan_ids.length+2)}).attr("height",30),l.append("svg:text").attr("class","vm-name-label").attr("x",12).attr("y",20).attr("clip-path","url(#clip-vm-name)").each(function(e){var t=d3.select(this),i=e[n.EB.VM.VM_NAME];i.length>12&&t.append("title").text(e[n.EB.VM.VM_NAME]),t.append("tspan").text("VM  "),t.append("tspan").attr("class","entity-name-text").attr("entity-type",n.NW_E_TYPES.VM).attr("entity-id",function(e){return e.id}).text(i)}),l.append("g").attr("class","vlan-group").attr("transform",function(e,t){return"translate("+(o-12*e.vlan_ids.length)+",15)"}).each(function(e){var t=d3.select(this),i=e.vlan_ids,s=_.filter(a,function(e){return _.contains(i,e.id)});c._renderVlanCircles(t,s,_.pluck(s,n.ID))}),this.model.getVMGroupMembers(!0).length>t.length&&this._svg.append("svg:text").attr("class","load-more-label").attr("x",e).attr("y",30+50*t.length+10).append("tspan").text(this.i18n("load_more_vms"))},_renderHosts:function(e){if(0===this.model.getEntities(n.NW_E_TYPES.HOST).length)return void this._renderMsg(u.NOTIFY_ERROR,this.i18n("hosts_not_available"),e,30);var t=this.model.getSelectedEntities(n.NW_E_TYPES.HOST);if(0===t.length)return void this._renderMsg(u.NOTIFY_INFO,this.i18n("select_hosts"),e,30);_.each(t,function(e){e.pnics=this.model.getRelatedTargets(i.RELATIONSHIPS.HOST2PNIC,e.id)},this);var s=function(e){return 30*(e.pnics.length||1)},a=this._svg.selectAll(".host").data(t),r=function(e,i){for(var n=30,a=0;a<i;a++)n+=s(t[a])+30;return n},o=this,l=function(){var e=d3.select(this);o._tip.show(e,e[0][0])},c=function(){o._tip.hide()};a.enter().append("g").attr("class","host-group entity-container").attr("data-id",function(e){return e[n.ID]}).attr("gleft",e).attr("gtop",r).attr("transform",function(t,i){return"translate("+e+","+r(0,i)+")"}),a.append("rect").attr("class","entity-box").attr("x",.5).attr("y",.5).attr("rx",3.5).attr("ry",3.5).attr("width",200).attr("height",s),a.append("clipPath").attr("id","clip-host-name").append("rect").attr("x",0).attr("y",0).attr("width",160).attr("height",s),a.append("svg:text").attr("class","host-name-label").attr("x",12).attr("clip-path","url(#clip-host-name)").attr("y",function(e){return e.pnics.length?15*e.pnics.length:19}).each(function(e){var t=d3.select(this),i=e.name;i.length>16&&t.append("title").text(e.name),t.append("tspan").text("Host "),t.append("tspan").attr("class","entity-name-text").attr("entity-type",n.NW_E_TYPES.HOST).attr("entity-id",function(e){return e[n.ID]}).text(i)});a.each(function(e){if(e.pnics.length){var t=d3.select(this);t.append("line").attr("x1",170).attr("y1",0).attr("x2",170).attr("shape-rendering","crispEdges").attr("y2",s),e.pnics=_.sortBy(e.pnics,function(e){return e[n.EB.PNIC.PORT_NAME]});for(var i=0;i<e.pnics.length;i++){var a=e.pnics[i],r=30*i+10,d="10000"===a[n.EB.PNIC.LINK_SPEED],h=d?o._PORT_ICON_PATH_10G:o._PORT_ICON_PATH,p=o.model.isHostPortConnected(e.id,a.id),T=o.i18n("not_connected"),g=a[n.EB.PNIC.LINK_SPEED],S=g?g/1e3:1;if(p){T=o.i18n("connected")+u.NETWORK_VIZ_SEPARATOR;T+=o.model.isHostPortPassive(e.id,a.id)?o.i18n("passive"):o.i18n("active")}var m=E({nvPairs:[[o.i18n("port"),a[n.EB.PNIC.PORT_NAME]],[o.i18n("speed"),S+"G"],[o.i18n("link_status"),T]]});t.append("path").attr("class","host-pnic").attr("data-id",a.id).attr("host-id",e.id).attr("d",h).attr("cleft",180).attr("ctop",30*i+10).attr("shape-rendering","crispEdges").attr("transform","translate(180,"+r+")"),t.append("rect").attr("class","host-pnic-bg").attr("transform","translate(178,"+(r-3)+")").attr("tooltipText",m).attr("width",14).attr("height",14).on("mouseover",l).on("mouseout",c),i>0&&t.append("line").attr("x1",170).attr("y1",30*i).attr("x2",200).attr("shape-rendering","crispEdges").attr("y2",30*i)}}})},_renderSwitches:function(e){if(0===this.model.getEntities(n.NW_E_TYPES.SWITCH).length)return void this._renderMsg(u.NOTIFY_ERROR,this.i18n("switches_not_available"),e,30);var t=this.model.getSelectedEntities(n.NW_E_TYPES.SWITCH);if(0===t.length)return void this._renderMsg(u.NOTIFY_INFO,this.i18n("select_switches"),e,30);_.each(t,function(e){e.interfaces=this.model.getRelatedTargets(i.RELATIONSHIPS.SWITCH2INTERFACE,e.id)},this);var s=this.model.getVlansToRender(),a=s.length,r=this._getSwitchBoxWidth(a),o=function(e){return 30*e.interfaces.length},c=function(e){return e.id===u.UNKNOWN_NETWORK_SWITCH_ID},d=function(e){return e===u.UNKNOWN_NETWORK_SWITCH_ID},h=this._svg.selectAll(".switch").data(t),p=function(e,i){for(var n=30,s=0;s<i;s++)n+=o(t[s])+30+10;return n};h.enter().append("g").attr("class",function(e){return c(e)?"switch-group unknown-switch-group":"switch-group"}).attr("gleft",e).attr("gtop",p).attr("data-id",function(e){return e.id}).attr("transform",function(t,i){var n=p(0,i);return"translate("+e+","+n+")"});var T=this;h.append("svg:text").attr("class","switch-name-label").attr("x",r).attr("y",0).attr("text-anchor","end").attr("entity-id",function(e){return e.id}).attr("entity-type",n.NW_E_TYPES.SWITCH).each(function(e){var t=d3.select(this);c(e)?(t.append("tspan").text(""),t.append("tspan").text(T.i18n("unknown_switch"))):(t.append("tspan").text(T.i18n("switch")+" "),t.append("tspan").text(e[n.NAME]))}),h.filter(function(e){return"1"===e[n.EB.NETWORK_SWITCH.VLANS_DISCOVERED]}).append("g").attr("class","vlan-group").attr("transform",function(e,t){return"translate("+(r-12*s.length)+",10)"}).each(function(e){var t=d3.select(this);T._renderVlanCircles(t,s,e[n.EB.NETWORK_SWITCH.VLAN_IDS]||[])});h.append("rect").attr("class","entity-box switch-box").attr("entity-type",n.NW_E_TYPES.SWITCH_INTERFACE).attr("data-id",function(e){return e[n.ID]}).attr("x",.5).attr("y",16.5).attr("width",r).attr("height",o);h.each(function(e){for(var t=d3.select(this),i=0;i<e.interfaces.length;i++){var a=16+30*i,h=t.append("g").attr("class","switch-interface-group entity-container").attr("entity-type",n.NW_E_TYPES.SWITCH_INTERFACE).attr("data-id",e.interfaces[i].id).attr("transform","translate(0,"+a+")");h.append("path").attr("class","switch-interface").attr("data-id",e.interfaces[i].port_num).attr("d",l.rectToPath(0,0,r,30));var p=30*i+20,E=e.interfaces[i][n.EB.SWITCH_INTERFACE.PORT_NUM],g=e.interfaces[i][n.EB.SWITCH_INTERFACE.PORT_NAME]||T.i18n("unknown");if(c(e)||d(E)){t.append("text").attr("class","switch-port-label").attr("entity-type",n.NW_E_TYPES.SWITCH_INTERFACE).attr("data-id",u.UNKNOWN_NETWORK_SWITCH_ID).attr("x",r-120).attr("y",p+16).append("tspan").text(T.i18n("port_data_unavailable")),h.append("path").attr("class","switch-port switch-port-unavailable").attr("d",T._PORT_HELP_PATH).attr("cleft",0).attr("ctop",20).attr("transform","translate(10,8)");break}h.append("text").attr("class","switch-port-label").attr("entity-type",n.NW_E_TYPES.SWITCH_INTERFACE).attr("data-id",e.interfaces[i].id).attr("x",40).attr("y",20).append("tspan").text(g),h.append("path").attr("class","switch-port").attr("d",T._PORT_ICON_PATH).attr("cleft",0).attr("ctop",a+10).attr("transform","translate(10,10)");var _=e.interfaces[i][n.EB.SWITCH_INTERFACE.ALLOWED_VLANS_DISCOVERED],S=e.interfaces[i][n.EB.SWITCH_INTERFACE.ALLOWED_VLAN_IDS]||[];if("1"===_){var m=r-12*s.length;h.append("g").attr("transform","translate("+m+",14)").each(function(e){var t=d3.select(this);T._renderVlanCircles(t,s,S)})}}t.append("line").attr("x1",30).attr("y1",16).attr("x2",30).attr("y2",function(e){return 16+o(e)})})},_renderVlanCircles:function(e,t,i){_.each(t,function(t,s){var a=_.contains(i,t.id);e.append("circle").attr("data-id",function(){return t[n.ID]}).attr("r",3).attr("cx",function(){return 0+12*s}).attr("cy",0).style("stroke",function(){return"#"+(a?t.colorHex:d.NETVIZ.VLAN_UNSELECTED_STROKE)}).style("fill",function(){return"#"+(a?t.colorHex:d.NETVIZ.VLAN_UNSELECTED_FILL)})})},_renderLines:function(e,t){this._svg.selectAll(e).data(t).enter().append("path").attr("class",function(t){return t.isDashed?e+" dashed":e}).attr("source-id",function(e){return e.source[n.ID]}).attr("target-id",function(e){return e.target[n.ID]}).attr("d",function(e){var t=l.curveXPoints(e.source.connector,e.target.connector,2);return"M"+t[0].x+","+t[0].y+"C"+t[1].x+","+t[1].y+","+t[2].x+","+t[2].y+","+t[3].x+","+t[3].y}),this._lines[e]=t},_getSwitchBoxWidth:function(e){return Math.max(200,100+12*e)},_getVMs2Render:function(){return this.model.getVMGroupMembers(!0).slice(0,this.model.get(this.model.DP.MAX_VMS))},_highlightVms:function(){_.each(this._highlightEntityIds,function(e){var t=d3.select('.vm[data-id="'+e+'"]');this.selectVMByClass(t,"highlighted",!0)},this)},_renderMsg:function(e,t,i,n){this._svg.append("svg:text").attr("class","text-message message-"+e).attr("x",i).attr("y",n).append("tspan").text(t)},_generateReport:function(){var e=a.generateReport(),t=_.template("data:text/html;charset=utf-8,<%= data %>");window.open(t({data:e}),"_blank")}})}),define("views/pages/network/NetworkVlanViz",["views/pages/network/entities/NetworkVizBaseView","views/pages/network/VlanSelectorView","views/pages/network/NetworkVizOptionsView","views/pages/network/NetworkEntitiesVizView"],function(e,t,i,n){"use strict";return e.extend({initializeSubViews:function(){this.$(".network-container").addClass("netviz-container");var e=new t({el:this.$(".left-panel-inner-bottom"),model:this.model});this.subViewHelper.register("vlanSelectorView",e);var s=new i({el:this.$(".viz-options"),model:this.model});this.subViewHelper.register("vizOptionsView",s);var a=new n({el:this.$(".viz-container"),model:this.model});this.subViewHelper.register("netEntitiesVizView",a),this.subViewHelper.renderAll()},layoutPanels:function(){this.$el.addClass("right-panel-hidden")}},null)}),define("views/pages/network/NetworkPageView",["views/basecomponents/pages/BasePageView","views/pages/network/NetworkVlanViz","utils/AppConstants"],function(e,t,i){"use strict";return e.extend({pageId:i.PAGE_NETWORK,defaultSubPageId:i.SUBPAGE_VLAN_VIZ,onShowSubPage:function(e,t){var i=this.getSubView(e);i||(i=this.registerSubView(e,this._createSubPageView(e,t))),$("body").addClass("n-app-noscroll"),i.show(t)},onHideSubPage:function(){this.$(".n-page-nav").show(),$("body").removeClass("n-app-noscroll"),e.prototype.onHideSubPage.apply(this,arguments)},_createSubPageView:function(e,n){switch(e){case i.SUBPAGE_VLAN_VIZ:return new t({el:this.getSubPageElement(e),pageId:i.PAGE_NETWORK})}}})}),define("text!templates/pages/dr/details/DRTabDetailsView.html",[],function(){return'\x3c!-- Wrap --\x3e\n<div class="n-unit-wrap">\n  \x3c!-- Fixed unit --\x3e\n  <div class="n-unit-fixed">\n    \x3c!-- Column 1: Summary --\x3e\n    <div class="n-details-unit">\n      <div class="title">DATA PROTECTION SUMMARY</div>\n      <ul class="n-list-info">\n        <li>\n          <div class="n-info-block">\n            <span class="n-label">Remote Site(s)</span>\n            <span class="lblNoRemoteSite n-value"\n                data-test="dr_summary_remote_site">\n              \x3c!-- @value: value goes here... --\x3e\n            </span>\n          </div>\n        </li>\n        <li>\n          <div class="n-info-block">\n            <span class="n-label">Protection Domain(s)</span>\n            <span class="lblNoPD n-value"\n                data-test="dr_summary_pd">\n              \x3c!-- @value: value goes here... --\x3e\n            </span>\n          </div>\n        </li>\n      </ul>\n    </div>\n  </div>\n  \x3c!-- Fluid unit --\x3e\n  <div class="n-unit-fluid  n-tab-details-unit">\n    \x3c!-- @view: Tab details view goes here... --\x3e\n  </div>\n</div>'}),define("text!templates/pages/dr/details/RemoteSiteDetailsEntityView.html",[],function(){return'\x3c!-- Wrap --\x3e\n<div class="n-unit-wrap">\n  \x3c!-- Fixed unit --\x3e\n  <div class="n-unit-fixed">\n    \x3c!-- Column 1: Summary --\x3e\n    <div class="n-details-unit">\n      <div class="title">REMOTE SITE DETAILS</div>\n      <ul class="n-list-info">\n        <li>\n          <div class="n-info-block">\n            <span class="n-label">Name</span>\n            <span class="lblName n-value n-resettable"\n                data-test="dr_remote_site_details_name">\n              \x3c!-- @value: Name goes here... --\x3e\n            </span>\n          </div>\n        </li>\n        <li>\n          <div class="n-info-block">\n            <span class="n-label">Capabilities</span>\n            <span class="lblCapabilities n-value n-resettable"\n                data-test="dr_remote_site_details_capabilities">\n              \x3c!-- @value: Capabilities goes here... --\x3e\n            </span>\n          </div>\n        </li>\n        <li>\n          <div class="n-info-block">\n            <span class="n-label">Cluster</span>\n            <span class="lblClusterId n-value n-resettable"\n                data-test="dr_remote_site_details_cluster">\n              \x3c!-- @value: ClusterID:ClusterIncarnation goes here... --\x3e\n            </span>\n          </div>\n        </li>\n        <li>\n          <div class="n-info-block">\n            <span class="n-label">Remote Address</span>\n            <span class="lblRemoteAddress n-value n-resettable"\n                data-test="dr_remote_site_details_remote_address">\n              \x3c!-- @value: Remote Address goes here... --\x3e\n            </span>\n          </div>\n        </li>\n        <li>\n          <div class="n-info-block">\n            <span class="n-label">vStore Map</span>\n            <span class="lblVStoreMap n-value n-resettable"\n                data-test="dr_remote_site_details_vstore_map">\n              \x3c!-- @value: VStore Map goes here... --\x3e\n            </span>\n          </div>\n        </li>\n        <li>\n          <div class="n-info-block">\n            <span class="n-label">Max Bandwidth</span>\n            <span class="lblMaxBandwidth n-value n-resettable"\n                data-test="dr_remote_site_details_max_bw">\n              \x3c!-- @value: Max Bandwidth goes here... --\x3e\n            </span>\n          </div>\n        </li>\n        <li>\n          <div class="n-info-block">\n            <span class="n-label">Compress on wire</span>\n            <span class="lblCompression n-value n-resettable\n                data-test="dr_remote_site_details_compress_on_wire">\n              \x3c!-- @value: Compression enabled goes here... --\x3e\n            </span>\n          </div>\n        </li>\n        <li>\n          <div class="n-info-block">\n            <span class="n-label">Proxy Enabled</span>\n            <span class="lblProxyEnabled n-value n-resettable"\n                data-test="dr_remote_site_details_proxy_enabled">\n              \x3c!-- @value: Proxy enabled goes here... --\x3e\n            </span>\n          </div>\n        </li>\n        <li>\n          <div class="n-info-block">\n            <span class="n-label">Use SSH Tunnel</span>\n            <span class="lblSSHEnabled n-value n-resettable"\n                data-test="dr_remote_site_details_use_ssh_tunnel">\n              \x3c!-- @value: Use SSH tunnel goes here... --\x3e\n            </span>\n          </div>\n        </li>\n      </ul>\n    </div>\n  </div>\n  \x3c!-- Fluid unit --\x3e\n  <div class="n-unit-fluid  n-tab-details-unit">\n    \x3c!-- @view: Tab details view goes here... --\x3e\n  </div>\n</div>\n'}),define("views/pages/dr/details/RemoteSiteDetailsEntityView",["views/basecomponents/details/BaseDetailsEntityView","text!templates/pages/dr/details/RemoteSiteDetailsEntityView.html","models/dataprotection/RemoteSiteModel","models/BaseModel","data/DataProperties","data/DataURLConstants","utils/AppConstants","utils/AppUtil","utils/StatsUtil","utils/VisualizationUtil","managers/NotificationManager"],function(e,t,i,n,s,a,r,o,l,c,d){"use strict";var u=_.template("Testing connection to site '<%= name %>' has been initiated successfully. This operation might take a few minutes."),h=n.extend({getURL:function(e,t){return _.template(a.REMOTE_SITE_TEST_CONNECTION,{id:this.getId()})},getNotificationMessage:function(){return u({name:this.getId()})}});return e.extend({TEST_CONNECTION_CONFIRM_MSG:"Testing connection might take a few minutes.",TEST_CONNECTION_COST_SAVINGS_MSG:"The cost savings feature is enabled on this remote site. The cloud instance will be  temporarily powered on to test the connection.",TEST_CONNECTION_LABEL:"Test Connection",entityType:r.ENTITY_REMOTE_SITE,testConnectionModel:null,modelEvents:{"change        model":"renderDetails","error         model":"renderError","pending       model":"reset"},initialize:function(){this.model=new i,this.model.setProjection([r.PROJECTION.STATS]),this.testConnectionModel=new h,this.render()},render:function(){this.$el.html(t);var e=[r.TAB_DETAILS.REPLICATION_TABLE,r.TAB_DETAILS.REMOTE_SNAPSHOT_TABLE,r.TAB_DETAILS.METRICS,r.TAB_DETAILS.ALERTS,r.TAB_DETAILS.EVENTS];this.tabDetailsView=c.renderTabDetailsView(this.$(".n-tab-details-unit"),e,this.entityType,r.PAGE_DR)},renderDetails:function(){if(e.prototype.renderDetails.apply(this,arguments),this.$(".lblName").html(this.model.get(s.NAME)),this.$(".lblName").attr("title",this.model.get(s.NAME)),this.model.get(s.RS_STATUS)!==r.RS_STATUS.DEPLOYING){var t=this.model.get(s.RS_CLUSTER_ID)||"",i=this.model.get(s.RS_CLUSTER_INCARNATION);i&&(t+="&nbsp;:&nbsp;"+i),this.$(".lblClusterId").html(t),this.$(".lblRemoteAddress").html(this.model.getValue(s.RS_IP_ADDRESS));var n="",a=this.model.get(s.RS_VSTORE_NAME_MAP);_.each(_.keys(a),function(e,t,i){n+=e+" : "+a[e]+(t+1<i.length?", ":"")}),this.$(".lblVStoreMap").html(n);var o=this.model.get(s.RS_MAX_BPS),c=o?l.bandwidthFormat(o/1e3):"";this.$(".lblMaxBandwidth").html(c),this.$(".lblCompression").html(this.model.get(s.RS_COMPRESSION_ENABLED)?"On":"Off"),this.$(".lblProxyEnabled").html(this.model.get(s.RS_PROXY_ENABLED)?"Yes":"No"),this.$(".lblSSHEnabled").html(this.model.get(s.RS_SSH_ENABLED)?"Yes":"No"),this.$(".lblCapabilities").html(this.model.getUserCapabilities("<br>"))}},getDataAndRender:function(t){t&&(e.prototype.getDataAndRender.apply(this,arguments),this.model.set(this.model.idAttribute,t,{silent:!0}),this.model.startPolling({alwaysTriggerChange:!0,alwaysTriggerPending:!0}))},testConnection:function(e,t){this.resetTimer&&(clearTimeout(this.resetTimer),this.resetTimer=null);var i=this.TEST_CONNECTION_CONFIRM_MSG
;this.model.get(s.RS_CLOUD_TYPE)&&this.model.get(s.RS_COST_SAVING_ENABLED)&&(i+="<br><br>"+this.TEST_CONNECTION_COST_SAVINGS_MSG),$.nutanixConfirm({msg:i,yes:function(){this._testConnection(e,t)},yesText:this.TEST_CONNECTION_LABEL,noText:r.LABEL_CANCEL,context:this})},_testConnection:function(e,t){var i=$(e.currentTarget),n=i.find(".test-connection-status"),a=i.find(".test-connection-text"),o=this;this._setTestConnectionStatus(n,a,"testing"),this.testConnectionModel.setId(this.model.get(s.RS_NAME),!0),d.showClientNotification(r.NOTIFY_SUCCESS,this.testConnectionModel.getNotificationMessage(),!0),this.testConnectionModel.fetch({success:function(e,t,i){o._setTestConnectionStatus(n,a,t.status?"success":"error",t.message),o._clearTestConnectionStatus(n)},error:function(e,t,i){o._setTestConnectionStatus(n,a,"error"),o._clearTestConnectionStatus(n)}})},_clearTestConnectionStatus:function(e){var t=this;this.resetTimer=setTimeout(function(){e.html("&nbsp;"),t.resetTimer=null},1e4)},_setTestConnectionStatus:function(e,t,i,n){var s="";n&&(s='title="'+n+'"'),"testing"===i?e.html('<div class="donut-loader-blue"></div>'):"success"===i?e.html('<i class="success" data-icon="J" aria-hidden="true"></i>'):"error"===i?e.html("<i "+s+' class="error" aria-hidden="true" data-icon="v" ></i>'):e.html("&nbsp;")},destroy:function(){o.debug("RemoteSiteDetailsEntityView : destroy: | viewid : "+this.cid),e.prototype.destroy.apply(this,arguments)}})}),define("text!templates/pages/dr/details/ProtectionDomainDetailsEntityView.html",[],function(){return'\x3c!-- Wrap --\x3e\n<div class="n-unit-wrap">\n  \x3c!-- Fixed unit --\x3e\n  <div class="n-unit-fixed">\n    \x3c!-- Column 1: Summary --\x3e\n    <div class="n-details-unit">\n      <div class="title">PROTECTION DOMAIN DETAILS</div>\n      <ul class="n-list-info">\n        <li>\n          <div class="n-info-block">\n            <span class="n-label">Name</span>\n            <span class="lblName n-value n-resettable"\n                data-test="protectiondomaindetailsentityview_span_details_name">\n              \x3c!-- @value: Name goes here... --\x3e\n            </span>\n          </div>\n        </li>\n        <li>\n          <div class="n-info-block">\n            <span class="n-label">Mode</span>\n            <span class="lblMode n-value n-resettable"\n                data-test="dr_pd_details_mode">\n              \x3c!-- @value: Mode goes here... --\x3e\n            </span>\n          </div>\n        </li>\n        <li>\n          <div class="n-info-block">\n            <span class="n-label">Next Snapshot Time</span>\n            <span class="lblNextSnapshotTime n-value n-resettable"\n                data-test="dr_pd_details_next_snapshot_time">\n              \x3c!-- @value: Next shapshot time goes here... --\x3e\n            </span>\n          </div>\n        </li>\n\n        \x3c!-- Start: For vStore Enabled --\x3e\n        <li class="n-vstore-enabled" style="display: none">\n          <div class="n-info-block">\n            <span class="n-label">vStore ID</span>\n            <span class="lblVStoreID n-value n-resettable"\n                data-test="dr_pd_details_vstore_id">\n              \x3c!-- @value: vStore Id goes here... --\x3e\n            </span>\n          </div>\n        </li>\n        <li class="n-vstore-enabled" style="display: none">\n          <div class="n-info-block">\n            <span class="n-label">Storage Container Name</span>\n            <span class="lblContainerName n-value n-resettable">\n              \x3c!-- @value: Container name goes here... --\x3e\n            </span>\n          </div>\n        </li>\n        <li class="n-vstore-enabled" style="display: none">\n          <div class="n-info-block">\n            <span class="n-label">Storage Container Used Size</span>\n            <span class="lblContainerSize n-value n-resettable"\n                data-test="dr_pd_details_container_size">\n              \x3c!-- @value: Container Used Size Id goes here... --\x3e\n            </span>\n          </div>\n        </li>\n        \x3c!-- End: For vStore Enabled --\x3e\n\n        \x3c!-- Start: For vStore Disabled --\x3e\n        <li class="n-vstore-disabled">\n          <div class="n-info-block">\n            <span class="n-label">VM Count</span>\n            <span class="lblVmCount n-value n-resettable">\n              \x3c!-- @value: VM count goes here... --\x3e\n            </span>\n          </div>\n        </li>\n        <li class="n-vstore-disabled">\n          <div class="n-info-block">\n            <span class="n-label">Volume Group Count</span>\n            <span class="lblVgCount n-value n-resettable">\n              \x3c!-- @value: VG count goes here... --\x3e\n            </span>\n          </div>\n        </li>\n        <li class="n-vstore-disabled">\n          <div class="n-info-block">\n            <span class="n-label">File Count</span>\n            <span class="lblFileCount n-value n-resettable">\n              \x3c!-- @value: File count goes here... --\x3e\n            </span>\n          </div>\n        </li>\n        \x3c!-- End: For vStore Disabled --\x3e\n\n        <li>\n          <div class="n-info-block">\n            <span class="n-label">Remote Site(s)</span>\n            <div class="n-value">\n              <ul class="n-details-list listRemoteSites n-resettable">\n                \x3c!-- @value: Remote site goes here... --\x3e\n              </ul>\n            </div>\n          </div>\n        </li>\n      </ul>\n    </div>\n  </div>\n  \x3c!-- Fluid unit --\x3e\n  <div class="n-unit-fluid  n-tab-details-unit">\n    \x3c!-- @view: Tab details view goes here... --\x3e\n  </div>\n</div>'}),define("views/pages/dr/details/ProtectionDomainDetailsEntityView",["views/basecomponents/details/BaseDetailsEntityView","text!templates/pages/dr/details/ProtectionDomainDetailsEntityView.html","models/dataprotection/ProtectionDomainModel","models/storage/ContainerModel","managers/NavigationManager","data/DataProperties","utils/AppConstants","utils/AppUtil","utils/StatsUtil","utils/TimeUtil","utils/VisualizationUtil"],function(e,t,i,n,s,a,r,o,l,c,d){"use strict";return e.extend({entityType:r.ENTITY_PROTECTION_DOMAIN,containerModel:null,modelEvents:{"change        model":"renderDetails","error         model":"renderError","pending       model":"reset","change        containerModel":"onChangeContainerModel"},events:{"click    a.pageLink":"onPageLinkClick"},initialize:function(){this.model=new i,this.model.setProjection([r.PROJECTION.STATS]),this.containerModel=new n,this.render()},render:function(){this.$el.html(t);var e=[r.TAB_DETAILS.REPLICATION_TABLE,r.TAB_DETAILS.ENTITY_TABLE,r.TAB_DETAILS.SCHEDULE_TABLE,r.TAB_DETAILS.LOCAL_SNAPSHOT_TABLE,r.TAB_DETAILS.REMOTE_SNAPSHOT_TABLE,r.TAB_DETAILS.METRICS,r.TAB_DETAILS.ALERTS,r.TAB_DETAILS.EVENTS];null!==this.model.get(a.PD_VSTORE_ID)&&delete e[1],this.tabDetailsView=d.renderTabDetailsView(this.$(".n-tab-details-unit"),e,this.entityType,r.PAGE_DR)},renderDetails:function(){e.prototype.renderDetails.apply(this,arguments);var t=d.renderProtectionDomainIcon(this.model.toJSON()),i=this.model.get(a.PD_ACTIVE)?"Active":"Inactive";this.$(".lblName").html(this.model.escape(a.PD_NAME)).attr("title",this.model.escape(a.PD_NAME)),this.$(".lblMode").html(t+" "+i);var n=this.model.get(a.PD_NEXT_SNAPSHOT_TIME);this.$(".lblNextSnapshotTime").html(n?c.formatDateTime(n>0?n/1e3:0):"No Schedule"),this.$(".listRemoteSites").empty();for(var s=this.model.get(a.PD_REMOTE_SITES)||[],l=void 0,u=0;u<s.length;u++)l=$("<li></li>").append(o.createPageLink(s[u],r.ENTITY_REMOTE_SITE,s[u])),l.attr("title",s[u]),this.$(".listRemoteSites").append(l);null!==this.model.get(a.PD_VSTORE_ID)?(this.$(".n-vstore-enabled").show(),this.$(".n-vstore-disabled").hide(),this.$(".lblVStoreID").html(this.model.get(a.PD_VSTORE_ID)),this.containerModel.set(this.containerModel.idAttribute,this.model.get(a.PD_VSTORE_ID),{silent:!0}),this.containerModel.fetch({alwaysTriggerChange:!0})):(this.$(".n-vstore-enabled").hide(),this.$(".n-vstore-disabled").show(),this.$(".lblVmCount").html(this.model.get(a.PD_VMS)?this.model.get(a.PD_VMS).length:0),this.$(".lblVgCount").html(this.model.get(a.PD_VGS)?this.model.get(a.PD_VGS).length:0),this.$(".lblFileCount").html(this.model.get(a.PD_NFS_FILES)?this.model.get(a.PD_NFS_FILES).length:0))},onChangeContainerModel:function(e){this.$(".lblContainerSize").html(l.storageFormat(e.get(a.USED_PHY_SIZE)));var t=o.createPageLink(e.get(e.nameAttribute),r.ENTITY_CONTAINER,e.get(e.idAttribute));this.$(".lblContainerName").html(t)},onPageLinkClick:function(e){s.navigateToPageByPageLink(e.currentTarget)},getDataAndRender:function(t){t&&(e.prototype.getDataAndRender.apply(this,arguments),this.model.set(this.model.idAttribute,t,{silent:!0}),this.model.startPolling({alwaysTriggerChange:!0,alwaysTriggerPending:!0}))},destroy:function(){o.debug("ProtectionDomainDetailsEntityView : destroy: | viewid  : "+this.cid),e.prototype.destroy.apply(this,arguments)}})}),define("text!templates/pages/dr/details/StretchPDDetailsEntityView.html",[],function(){return'\x3c!-- Wrap --\x3e\n<div class="n-unit-wrap">\n  \x3c!-- Fixed unit --\x3e\n  <div class="n-unit-fixed">\n    \x3c!-- Column 1: Summary --\x3e\n    <div class="n-details-unit">\n      <div class="title">PROTECTION DOMAIN DETAILS</div>\n      <ul class="n-list-info">\n        <li>\n          <div class="n-info-block">\n            <span class="n-label">Name</span>\n            <span class="lblName n-value n-resettable">\n              \x3c!-- @value: Name goes here... --\x3e\n            </span>\n          </div>\n        </li>\n        <li>\n          <div class="n-info-block">\n            <span class="n-label">Role</span>\n            <span class="lblStretchRole n-value n-resettable"\n                  data-test="dr_pd_details_stretch_role">\n              \x3c!-- @value: Role goes here... --\x3e\n            </span>\n          </div>\n        </li>\n        <li>\n          <div class="n-info-block">\n            <span class="n-label">Storage Container Name</span>\n            <span class="lblContainerName n-value n-resettable">\n              \x3c!-- @value: Container name goes here... --\x3e\n            </span>\n          </div>\n        </li>\n        <li>\n          <div class="n-info-block">\n            <span class="n-label">Remote Site</span>\n            <span class="lblRemoteSite n-value n-resettable"\n                  data-test="dr_pd_details_remoteSite">\n              \x3c!-- @value: Remote site goes here... --\x3e\n            </span>\n          </div>\n        </li>\n        <li>\n          <div class="n-info-block">\n            <span class="n-label">Status</span>\n            <span class="lblStretchStatus n-value n-resettable"\n                  data-test="dr_pd_details_status">\n              \x3c!-- @value: Status goes here... --\x3e\n            </span>\n          </div>\n        </li>\n        <li>\n          <div class="n-info-block">\n            <span class="n-label">Failure Handling</span>\n            <span class="lblFailureHandling n-value n-resettable"\n                  data-test="dr_pd_failure_handling">\n              \x3c!-- @value: Timeout description goes here... --\x3e\n            </span>\n          </div>\n        </li>\n      </ul>\n    </div>\n  </div>\n  \x3c!-- Fluid unit --\x3e\n  <div class="n-unit-fluid  n-tab-details-unit">\n    \x3c!-- @view: Tab details view goes here... --\x3e\n  </div>\n</div>'}),define("views/pages/dr/details/StretchDetailsEntityView",["views/basecomponents/details/BaseDetailsEntityView","text!templates/pages/dr/details/StretchPDDetailsEntityView.html","models/dataprotection/ProtectionDomainModel","managers/NavigationManager","data/DataProperties","utils/AppConstants","utils/AppUtil","utils/VisualizationUtil"],function(e,t,i,n,s,a,r,o){"use strict";return e.extend({entityType:a.ENTITY_PROTECTION_DOMAIN,modelEvents:{"change  model":"renderDetails","error   model":"renderError","pending model":"reset"},events:{"click a.pageLink":"onPageLinkClick"},initialize:function(){this.model=new i,_.bindAll(this,"onTabCreated"),this.render()},render:function(){this.$el.html(t);var e=[a.TAB_DETAILS.REPLICATION_TABLE,a.TAB_DETAILS.LOCAL_SNAPSHOT_TABLE,a.TAB_DETAILS.REMOTE_SNAPSHOT_TABLE,a.TAB_DETAILS.SCHEDULE_TABLE,a.TAB_DETAILS.METRICS,a.TAB_DETAILS.ALERTS,a.TAB_DETAILS.EVENTS];this.tabDetailsView=o.renderTabDetailsView(this.$(".n-tab-details-unit"),e,this.entityType,a.PAGE_DR),this.tabDetailsView.on(this.tabDetailsView.TAB_CREATE_EVENT,this.onTabCreated)},renderDetails:function(){e.prototype.renderDetails.apply(this,arguments),this.$(".lblName").html(this.model.escape(s.PD_NAME)).attr("title",this.model.escape(s.PD_NAME));var t=this.model.get(s.PD_METRO_AVAIL),i=t[s.PD_METRO_AVAIL_ROLE]||"",n=o.renderProtectionDomainIcon(this.model.toJSON());this.$(".lblStretchRole").html(n+" "+i);var l=t?t[s.PD_METRO_AVAIL_STATUS]:null;this.$(".lblStretchStatus").html(l||"");var c=t?t[s.PD_METRO_AVAIL_VSTORE]:null;this.$(".lblContainerName").html(c||"");var d=t?t[s.PD_METRO_AVAIL_REMOTE_SITE]:null;if(d){var u=r.createPageLink(d,a.ENTITY_REMOTE_SITE,d);this.$(".lblRemoteSite").html(u)}else this.$(".lblRemoteSite").html("");var h=this.model.getFailureHandlingForDisplay();this.$(".lblFailureHandling").html(h)},onPageLinkClick:function(e){n.navigateToPageByPageLink(e.currentTarget)},destroy:function(){r.debug("StretchDetailsEntityView : destroy: | viewid : "+this.cid),this.tabDetailsView.off(this.tabDetailsView.TAB_CREATE_EVENT),e.prototype.destroy.apply(this,arguments)},onTabCreated:function(e){e===a.TAB_DETAILS.LOCAL_SNAPSHOT_TABLE?this.tabDetailsView.getTabContent(e).setTabOptions({entityActions:[a.ACTION_DELETE]}):e===a.TAB_DETAILS.REMOTE_SNAPSHOT_TABLE?this.tabDetailsView.getTabContent(e).setTabOptions({entityActions:[]}):e===a.TAB_DETAILS.SCHEDULE_TABLE&&this.tabDetailsView.getTabContent(e).setTabOptions({metroPD:this.model})}})}),define("views/pages/dr/details/DRTabDetailsView",["views/basecomponents/details/BaseDetailsView","views/basecomponents/details/detailsaction/DetailsActionTemplates","text!templates/pages/dr/details/DRTabDetailsView.html","models/dataprotection/RemoteSiteCollection","models/dataprotection/ProtectionDomainCollection","models/dataprotection/ProtectionDomainModel","models/dataprotection/RemoteSiteModel","views/pages/dr/details/RemoteSiteDetailsEntityView","views/pages/dr/details/ProtectionDomainDetailsEntityView","views/pages/dr/details/StretchDetailsEntityView","data/DataProperties","data/DataURLConstants","managers/ClusterManager","managers/NavigationManager","managers/TaskManager","utils/AppConstants","utils/AppUtil","utils/HypervisorUtil","utils/VisualizationUtil"],function(e,t,i,n,s,a,r,o,l,c,d,u,h,p,T,E,g,S,m){"use strict";var v=_.template("<%= actionName %> <%= pdEntityType %> on '<%= containerName %>' across '<%=primarySite%>' and '<%=secondarySite%>'?"),f=_.template("\n      <p>\n        <%= i18ns('pd_disable_confirmation', {\n          pdEntityType: pdEntityType,\n          containerName: containerName,\n          primarySite: primarySite,\n          secondarySite: secondarySite\n        }) %>\n      </p>\n      <p>\n        <%= i18nf('pd_disable_or_promote_warning', {\n          currentClusterName: currentClusterName,\n          isESX: isESX\n        }) %>\n      </p>\n    "),A=_.template("\n      <p>\n        <%= i18ns('pd_disable_confirmation', {\n          pdEntityType: pdEntityType,\n          containerName: containerName,\n          primarySite: primarySite,\n          secondarySite: secondarySite\n        }) %>\n      </p>\n      <p>\n        <%= i18n('hyperv_pd_disable_warning') %>\n      </p>\n    "),y=_.template("\n      <p>\n        <%= i18ns('pd_disable_confirmation', {\n          pdEntityType: pdEntityType,\n          containerName: containerName,\n          primarySite: primarySite,\n          secondarySite: secondarySite\n        }) %>\n      </p>\n      <p>\n        <%= i18nf('decoupled_pd_disable_warning', {\n          secondarySite: secondarySite,\n          isESX: isESX\n        }) %>\n      </p>\n    "),C=_.template("<%= pdEntityType %> status on '<%= containerName %>' is decoupled.&nbsp;Please suspend or remove schedules before disabling it."),I=_.template("\n      <p>\n        <%= i18ns('pd_promote_confirmation', {\n          pdName: pdName,\n          secondarySite: secondarySite\n        }) %>\n      </p>\n      <p>\n        <%= i18nf('pd_disable_or_promote_warning', {\n          currentClusterName: currentClusterName,\n          isESX: isESX\n        }) %>\n      </p>\n      <p>\n        <%= i18n('pd_promote_note') %>\n      </p>\n    "),b=_.template("\n      <p class=\"n-popup-waring\">\n        <%= i18ns('remote_unreachable_warning', {\n          remoteSite: remoteSite,\n          pdEntityType: pdEntityType,\n          containerName: containerName\n        }) %>\n      </p>\n    "),R=_.template("<p>Are you sure you want to delete <%= pdEntityType %> on '<%= containerName %>' across '<%=primarySite%>' and '<%=secondarySite%>'? &nbsp;This cannot be undone.</p><p class=\"n-popup-waring\">WARNING: &nbsp;This operation eliminates <%= pdEntityType %> on '<%=containerName%>' across '<%=primarySite%>' and '<%=secondarySite%>'.</p>"),N=_.template("<%= actionName %> <%= pdEntityType %> on '<%= containerName %>'?<br><br>This operation will <%= actionName.toLowerCase() %> <%= pdEntityType %> on '<%= containerName %>' across <%=primarySite%> and <%= secondarySite %>.<br><br><p class=\"n-popup-waring\">WARNING: This operation will overwrite existing data on <%= secondarySite %>.</p>Are you sure you want to re-enable <%= pdEntityType %> on '<%= containerName %>'?"),P=r.extend({urlRoot:u.REMOTE_CLOUD_SITE,name:"DestroyCloudRemoteSiteModel"});return e.extend({name:"DRTabDetailsView",pageId:E.PAGE_DR,summaryTemplate:_.template(i),remoteSiteCollection:null,pdCollection:null,remoteSitesFetched:!1,modelEvents:{"reset  remoteSiteCollection":"renderRemoteSiteDetails","reset  pdCollection":"renderProtectionDomainDetails"},initializeProperties:function(){e.prototype.initializeProperties.apply(this,arguments),this.remoteSiteCollection=new n,this.pdCollection=new s},render:function(){var e=[E.TAB_DETAILS.REPLICATION_TABLE,E.TAB_DETAILS.LOCAL_SNAPSHOT_TABLE,E.TAB_DETAILS.REMOTE_SNAPSHOT_TABLE,E.TAB_DETAILS.METRICS,E.TAB_DETAILS.ALERTS,E.TAB_DETAILS.EVENTS];this.tabDetailsView=m.renderTabDetailsView(this.$(".n-tab-details-unit"),e,E.ENTITY_CLUSTER,E.PAGE_DR),this.storeToDetailsEntityMap(E.ENTITY_REMOTE_SITE,new o({el:this.getDetailsEntityElement(E.ENTITY_REMOTE_SITE)})),this.storeToDetailsEntityMap(E.ENTITY_ASYNC_PD,new l({el:this.getDetailsEntityElement(E.ENTITY_ASYNC_PD)})),this.storeToDetailsEntityMap(E.ENTITY_METRO_AVAILABILITY_PD,new c({el:this.getDetailsEntityElement(E.ENTITY_METRO_AVAILABILITY_PD)}))},getDataAndRender:function(){this.remoteSiteCollection.fetch(),this.pdCollection.fetch()},postActivateSummary:function(){this.tabDetailsView&&this.tabDetailsView.startServices()},postDeactivateSummary:function(){this.tabDetailsView&&this.tabDetailsView.stopServices()},refreshView:function(t){t&&t.entityType===E.ENTITY_REMOTE_SITE&&(this.remoteSitesFetched=!1),e.prototype.refreshView.apply(this,arguments)},destroy:function(){g.debug("DRTabDetailsView : destroy: | viewid  : "+this.cid),this.tabDetailsView&&this.tabDetailsView.destroy(),e.prototype.destroy.apply(this,arguments)},customDetailsEventHandler:function(e,t){if(t.action===E.ACTION_CONNECT){this.getDetailsEntityView(E.ENTITY_REMOTE_SITE).testConnection(e,t.actionTargetId)}},renderRemoteSiteDetails:function(e){this.remoteSitesFetched=!0,this.isSummaryView()&&this.$(".lblNoRemoteSite").html(e.length)},renderProtectionDomainDetails:function(e){this.$(".lblNoPD").html(e.length)},reset:function(){this.$(".lblNoRemoteSite").empty(),this.$(".lblNoPD").empty()},getDetailsAction:function(e,i){if(!T.getGlobalTasks().hasActiveClusterConvertTask()){var n=[];if(!e)return n;switch(e[E.NAV_ACTION_TARGET]){case E.ENTITY_REMOTE_SITE:return n.push({custom:!0,action:E.ACTION_CONNECT,content:t.TEST_CONNECTION}),n.push({action:E.ACTION_UPDATE,content:t.UPDATE}),n.push({action:null===i.get(d.RS_CLOUD_TYPE)?E.ACTION_DELETE:E.ACTION_DESTROY,content:t.DELETE}),n;case E.ENTITY_PROTECTION_DOMAIN:case E.ENTITY_ASYNC_PD:if(i)if(i.isCreatedExternal())i.isActive()&&n.push({wizard:!0,action:E.ACTION_UPDATE,content:t.UPDATE});else{if(i.isActive()){n.push({action:E.ACTION_REPLICATE,content:t.SNAPSHOT});var s=this._canMigratePD();n.push({disabled:!s,action:E.ACTION_MIGRATE,content:t.MIGRATE,tooltip:s?"":"No disaster recovery enabled remote site."}),i.isFileServerPD()?n.push({wizard:!0,action:E.ACTION_UPDATE_FS_PD_SCHEDULE,content:t.UPDATE}):n.push({wizard:!0,action:E.ACTION_UPDATE,content:t.UPDATE})}else n.push({wizard:!1,action:E.ACTION_ACTIVATE,content:t.ACTIVATE});n.push({action:E.ACTION_DELETE,content:t.DELETE})}return n;case E.ENTITY_METRO_AVAILABILITY_PD:if(i.isMetroAvailPD()){var a=i.getMetroAvailStatus();i.inActiveRole()?(a!==E.PD_METRO_AVAIL_STATUS.ENABLED&&a!==E.PD_METRO_AVAIL_STATUS.DISABLED||n.push({action:E.ACTION_REPLICATE,content:t.SNAPSHOT}),a!==E.PD_METRO_AVAIL_STATUS.DISABLED&&a!==E.PD_METRO_AVAIL_STATUS.PENDING&&a!==E.PD_METRO_AVAIL_STATUS.ERROR?n.push({action:E.ACTION_DISABLE_METRO_AVAIL,content:t.DISABLE}):a===E.PD_METRO_AVAIL_STATUS.DISABLED&&n.push({action:E.ACTION_RENABLE_METRO_AVAIL,content:t.RE_ENABLE}),n.push({wizard:!0,action:E.ACTION_UPDATE,content:t.UPDATE})):i.inStandbyRole()&&(a!==E.PD_METRO_AVAIL_STATUS.ENABLED&&a!==E.PD_METRO_AVAIL_STATUS.DISABLED&&a!==E.PD_METRO_AVAIL_STATUS.REMOTE_UNREACHABLE||n.push({action:E.ACTION_PROMOTE,content:t.PROMOTE})),i.isMetroAvailDeletable()&&n.push({action:E.ACTION_DELETE,content:t.DELETE})}return n;default:return[]}}},handleDetailsViewAction:function(t,i){switch(i.action){case E.ACTION_CONNECT:return this.getDetailsEntityView(E.ENTITY_REMOTE_SITE).testConnection(t,i.actionTargetId),!0;case E.ACTION_DELETE:case E.ACTION_DESTROY:return this._deleteEntity(i);case E.ACTION_DEMOTE:case E.ACTION_PROMOTE:case E.ACTION_DISABLE_METRO_AVAIL:case E.ACTION_ENABLE_METRO_AVAIL:case E.ACTION_RENABLE_METRO_AVAIL:return this._metroAvailAction(i);default:return e.prototype.handleDetailsViewAction.apply(this,arguments)}},updateActionButtons:function(t,i,n){if(t){var s=t[E.NAV_ACTION_TARGET];if(s!==E.ENTITY_METRO_AVAILABILITY_PD&&s!==E.ENTITY_ASYNC_PD||(s=E.ENTITY_PROTECTION_DOMAIN),!i||s===i.entityType)if(t&&t[E.NAV_ACTION]===E.ACTION_DETAILS&&s===E.ENTITY_PROTECTION_DOMAIN)if(this.remoteSitesFetched)e.prototype.updateActionButtons.apply(this,arguments);else{var a=_.bind(function(t,i,n){this.remoteSitesFetched=!0,e.prototype.updateActionButtons.apply(this,arguments)},this);this.remoteSiteCollection.fetch({success:function(){a(t,i,n)},error:function(){a(t,i,n)}})}else e.prototype.updateActionButtons.apply(this,arguments)}},_deleteEntity:function(e){var t=e.actionTarget;if(this.showActionDeniedMessage(t,E.ACTION_DELETE,E.USER_PRIVILEGE.MODIFY))return!0;if(t===E.ENTITY_PROTECTION_DOMAIN||t===E.ENTITY_ASYNC_PD){var i=new a;return i.set(i.idAttribute,e.actionTargetId,{silent:!0}),this._deletePD(i,E.ENTITY_ASYNC_PD,null)}return t===E.ENTITY_METRO_AVAILABILITY_PD?this._metroAvailAction(e):t===E.ENTITY_REMOTE_SITE&&this._deleteRemoteSite(e)},_deletePD:function(e,t,i){var n=this;if(!i){i=this.i18ns("pd_delete_confimation",e.get(e.idAttribute));var s=E.DELETE_WARNING_MESSAGES[t];s&&t!==E.ENTITY_ASYNC_PD&&(i+="<br><br>"+s)}var a=void 0,r=!1,o=null,l=E.ACTION_NAMES[E.ACTION_DELETE].toUpperCase();return t===E.ENTITY_METRO_AVAILABILITY_PD&&(a=m.renderCaptchaTemplate("If you are sure, type the word DELETE below to confirm, then click the Delete button."),r=!0,o=m.captchaConfirmationTest(l,E.ACTION_DELETE)),$.nutanixConfirm({msg:i,yes:function(){n.stopDetailsEntityViewServices(t),e.destroy({success:function(){p.showDetailsSummary()},error:function(){n.startDetailsEntityViewServices(t)}})},class:"-red-confirm",yesText:"Delete",noText:"Cancel",extHTML:a,captcha:o}),r&&m.initCaptchaTestEvent(l,E.ACTION_DELETE),!0},_deleteRemoteSite:function(e){var t=e.actionTargetId,i=e.action===E.ACTION_DESTROY,n=this.i18ns("remote_site_delete_confimation",t),s="";i&&(s+=this.i18n("cloud_remote_site_delete_warning"));var a=i?new P:new r;return a.set(a.idAttribute,t,{silent:!0}),this._confirmDelete(n,s,a),!0},_confirmDelete:function(e,t,i){var n=this;return $.nutanixConfirm({msg:e,extHTML:t,class:"-compact -red-confirm",yes:function(){n.stopDetailsEntityViewServices(E.ENTITY_REMOTE_SITE),i.destroy({success:function(e,t){p.showDetailsSummary()},error:function(){n.startDetailsEntityViewServices(E.ENTITY_REMOTE_SITE)}})},yesText:"Delete",noText:"Cancel"}),!0},_canMigratePD:function(){return this.remoteSiteCollection.find(function(e){return-1!==(e.get(d.RS_CAPABILITIES)||[]).indexOf(E.RS_CAPABILITIES.DISASTER_RECOVERY)})},_metroAvailAction:function(e){var t=e.actionTarget,i=e.action,n=e.actionTargetId;if(this.showActionDeniedMessage(t,i,E.USER_PRIVILEGE.MODIFY))return!0;if(i===E.ACTION_DEMOTE||i===E.ACTION_PROMOTE||i===E.ACTION_DISABLE_METRO_AVAIL||i===E.ACTION_RENABLE_METRO_AVAIL||i===E.ACTION_DELETE){var s=this,r=new a;r.set(r.nameAttribute,n,{silent:!0}),r.fetch({success:function(e){s._performMetroAvailActionOnPD(e,i)},error:function(e,t){var i=g.processThrownError(t);g.log("Error retrieving protection domain: "+i),e.showClientNotification(E.NOTIFY_ERROR,"Unable to retrieve protection domain. It could have been removed from the system.")}})}else i===E.ACTION_ENABLE_METRO_AVAIL&&g.log("Action not ready.");return!0},_performMetroAvailActionOnPD:function(e,t){var i=e.get(d.PD_METRO_AVAIL);if(i){var n=void 0,s=void 0;e.inActiveRole()?(n=this.getCurrentClusterName()||E.ENTITY_CLUSTER_NAME,s=i[d.PD_METRO_AVAIL_REMOTE_SITE]||"standby site"):(n=i[d.PD_METRO_AVAIL_REMOTE_SITE]||"active site",s=this.getCurrentClusterName()||E.ENTITY_CLUSTER_NAME);var a=void 0,r=h.getCurrentClusterUuid();t===E.ACTION_DELETE?a=R:t===E.ACTION_RENABLE_METRO_AVAIL?a=N:t===E.ACTION_DISABLE_METRO_AVAIL?a=e.getMetroAvailStatus()===E.PD_METRO_AVAIL_STATUS.DECOUPLED?y:S.hasESX(r)?f:A:t===E.ACTION_PROMOTE?(n=this.getCurrentClusterName()||E.ENTITY_CLUSTER_NAME,a=I):a=v;var o=a(this.vtOptions({pdEntityType:E.ENTITY_NAMES[E.ENTITY_METRO_AVAILABILITY_PD],actionName:E.ACTION_NAMES[t],pdName:e.get(d.PD_NAME),primarySite:n,secondarySite:s,currentClusterName:this.getCurrentClusterName()||E.ENTITY_CLUSTER_NAME,containerName:i[d.PD_METRO_AVAIL_VSTORE]||"storage container",isESX:S.hasESX(r)}));if(t===E.ACTION_DELETE)this._deletePD(e,E.ENTITY_METRO_AVAILABILITY_PD,o);else{if(t===E.ACTION_PROMOTE&&e.isRemoteSiteUnreachable()&&(o+=b(this.vtOptions({pdEntityType:E.ENTITY_NAMES[E.ENTITY_METRO_AVAILABILITY_PD],primarySite:n,remoteSite:i[d.PD_METRO_AVAIL_REMOTE_SITE]||"remote site",containerName:i[d.PD_METRO_AVAIL_VSTORE]||"storage container"}))),t===E.ACTION_DISABLE_METRO_AVAIL&&e.getMetroAvailStatus()===E.PD_METRO_AVAIL_STATUS.DECOUPLED){var l=e.get(d.PD_CRON_SCHEDULE);if(!e.get(d.PD_SCHEDULES_SUSPENDED)&&l.length)return o=C({pdEntityType:E.ENTITY_NAMES[E.ENTITY_METRO_AVAILABILITY_PD],containerName:i[d.PD_METRO_AVAIL_VSTORE]||"storage container"}),void e.showClientNotification(E.NOTIFY_ERROR,o)}t===E.ACTION_PROMOTE?this._promotePD(e,o):this._confirmMetroAvailAction(e,t,o)}}else e.showClientNotification(E.NOTIFY_ERROR,"Unable to perform action on this protection domain, missing metro availability details.")},_confirmMetroAvailAction:function(e,t,i){$.nutanixConfirm({msg:i,yes:function(){this._metroAvailModelAction(e,t)},yesText:"Yes",noText:"No",context:this})},_metroAvailModelAction:function(e,t){var i=e.metroAvailAction(t,t===E.ACTION_PROMOTE&&(e.isRemoteSiteUnreachable()||e.getMetroAvailStatus()===E.PD_METRO_AVAIL_STATUS.ENABLED));if(t===E.ACTION_RENABLE_METRO_AVAIL){var n=e.get(d.PD_CRON_SCHEDULE);e.get(d.PD_SCHEDULES_SUSPENDED)&&n.length&&i.done(function(){$.nutanixConfirm({msg:"The protection domain has existing schedules which are suspended. Please re-enable them.",yesText:"OK",hideNo:!0})})}},_promotePD:function(e,t){var i=void 0,n="",s=null,a=e.getMetroAvailStatus()===E.PD_METRO_AVAIL_STATUS.ENABLED;a&&(i=E.ACTION_NAMES[E.ACTION_PROMOTE].toUpperCase(),n=m.renderCaptchaTemplate("WARNING: It is not recommended to perform this action when Metro Availability is in Enabled state.  You should only promote a protection domain for a planned failover. If you want to proceed, please type the word PROMOTE and click the Promote button."),s=m.captchaConfirmationTest(i,E.ACTION_PROMOTE)),$.nutanixConfirm({msg:t,yes:function(){this._metroAvailModelAction(e,E.ACTION_PROMOTE)},yesText:E.ACTION_NAMES[E.ACTION_PROMOTE],noText:"Cancel",extHTML:n,captcha:s,context:this}),a&&m.initCaptchaTestEvent(i,E.ACTION_PROMOTE)}})}),define("views/basecomponents/datatables/dr/DRDataTableGroupView",["views/basecomponents/datatables/BaseTableView","views/basecomponents/datatables/DataTableGroupView","data/DataProperties","utils/AppConstants"],function(e,t,i,n){"use strict";var s=e.extend({getEntityTypeName:function(){return this.entityType===n.ENTITY_ASYNC_PD||this.entityType===n.ENTITY_METRO_AVAILABILITY_PD?n.ENTITY_NAMES[n.ENTITY_PROTECTION_DOMAIN]:e.prototype.getEntityTypeName.apply(this,arguments)},getEntityIdAttribute:function(){return this.entityType===n.ENTITY_REMOTE_SITE?i.RS_NAME:i.PD_NAME},selectRow:function(t){if(this.entityType===n.ENTITY_REMOTE_SITE){var s=this.model.findModelById(t);if(s&&s.get(i.RS_STATUS)===n.RS_STATUS.DEPLOYING)return}e.prototype.selectRow.apply(this,arguments)},onDataChange:function(){e.prototype.onDataChange.apply(this,arguments),this.entityType===n.ENTITY_REMOTE_SITE&&(this.$(".ssh-tunnel-warning-tooltip").tooltip("destroy"),this.$(".ssh-tunnel-warning-tooltip").tooltip({title:function(){return n.RS_SSH_TUNNEL_WARNING_MESSAGE},placement:"top",trigger:"hover",html:!0}))},destroy:function(){this.entityType===n.ENTITY_REMOTE_SITE&&this.$(".ssh-tunnel-warning-tooltip").tooltip("destroy"),e.prototype.destroy.apply(this,arguments)}});return t.extend({createBaseTableView:function(e,t,i){return new s({id:e,entityType:t,pageId:i})}})}),define("views/pages/dr/DRPageView",["views/basecomponents/pages/BasePageView","views/pages/dr/details/DRTabDetailsView","views/basecomponents/vantagepoints/DashboardView","views/basecomponents/datatables/dr/DRDataTableGroupView","models/dataprotection/ProtectionDomainModel","models/userdata/UserDataModel","managers/ActionManager","utils/AppUtil","utils/AppConstants"],function(e,t,i,n,s,a,r,o,l){"use strict";var c="actionTarget="+l.ENTITY_PROTECTION_DOMAIN;return e.extend({pageId:l.PAGE_DR,defaultSubPageId:l.SUBPAGE_PERSPECTIVE,initialize:function(t){e.prototype.initialize.apply(this,arguments),this.isMulticlusterPageUuid()&&(this.defaultSubPageId=l.SUBPAGE_TABLE)},show:function(t){if(t&&t.subPageId===l.SUBPAGE_TABLE&&t.options&&t.options.indexOf(c)>=0){var i=o.parseQueryToObject(t.options);i&&i.actionTargetId?this._showViewByProtectionDomainId(i.actionTargetId,t,i):this._showViewByProtectionDomain(null,t,i)}else e.prototype.show.apply(this,arguments);this.isClusterFFEnabled(l.FFLAGS.BROWNFIELD)&&this.checkIfOneTimePopupShown()},checkIfOneTimePopupShown:function(){var e=new a;e.set({type:l.UI_CONFIG,key:l.DR_POPUP_SHOWN}),e.fetch({error:function(e,t){this.showWarningPopup()}.bind(this)})},showWarningPopup:function(){var e={action:l.ACTION_WARNING,actionTarget:l.ENTITY_PROTECTION_DOMAIN,actionTargetId:l.ENTITY_ASYNC_PD,actionTargetName:l.ENTITY_ASYNC_PD};r.executeAction(e)},refreshView:function(t){t&&t.actionMode===l.ACTION_CREATE&&t.entityType===l.ENTITY_PROTECTION_DOMAIN?setTimeout(function(){e.prototype.refreshView.apply(this,arguments)},5e3):e.prototype.refreshView.apply(this,arguments)},onShowSubPage:function(e,t){var s=void 0,a=void 0,r=void 0;switch(e){case l.SUBPAGE_PERSPECTIVE:s=this.getSubView(e),s||(s=this.registerSubView(e,new i({el:this.getSubPageElement(e),
dashboard:l.PERSPECTIVE_DR}))),s.show(t);break;case l.SUBPAGE_DIAGRAM:break;case l.SUBPAGE_TABLE:r=this.getSubView(e),r||(r=this.registerSubView(e,new n({el:this.getSubPageElement(e),pageId:l.PAGE_DR})))}a=a||this.getSubView(l.SUBPAGE_DIAGRAM),a&&a.show(t),(r=r||this.getSubView(l.SUBPAGE_TABLE))&&r.show(t)},onChangeDetailsPane:function(e){var i=this.getSubView(l.SUBPAGE_COMPONENT_DETAILS);i||(i=this.registerSubView(l.SUBPAGE_COMPONENT_DETAILS,new t({el:this.getDetailsElement()}))),i.show(e)},_showViewByProtectionDomain:function(t,i,n){t&&t.isMetroAvailPD()?n.actionTarget=l.ENTITY_METRO_AVAILABILITY_PD:n.actionTarget=l.ENTITY_ASYNC_PD,i.options=o.formatObjectToQuery(n),e.prototype.show.call(this,i)},_showViewByProtectionDomainId:function(e,t,i){var n=this,a=new s;a.set(a.idAttribute,e,{silent:!0}),a.fetch({success:function(e,s,a){n._showViewByProtectionDomain(e,t,i)},error:function(){n._showViewByProtectionDomain(null,t,i)}})}})}),define("views/pages/alerts/AlertsPageView",["views/basecomponents/pages/BasePageView","managers/NavigationManager","managers/ActionManager","data/DataProperties","views/basecomponents/datatables/DataTableGroupView","utils/AppConstants","utils/AlertUtil"],function(e,t,i,n,s,a,r){"use strict";return e.extend({events:{"mouseover a.n-alert-doc-link":"onAlertDocLinkMouseOver","mouseout  a.n-alert-doc-link":"onAlertDocLinkMouseOut","click     a.pageLink":"onPageLinkClick","click     .btnItemAction":"onAlertPolicyEditClick"},pageId:a.PAGE_ALERTS,defaultSubPageId:a.SUBPAGE_TABLE,onAlertDocLinkMouseOver:function(e){var t=$(e.currentTarget),i=n.ALERT_CAUSES;t.hasClass(n.ALERT_RESOLUTIONS)&&(i=n.ALERT_RESOLUTIONS);var s=t.attr("data-id"),a=t.attr("data-severity"),o=t.attr("data-uuid"),l=r.createTooltip(s,i,a,o);null!==l&&(t.tooltip({title:l,placement:"left",trigger:"manual",html:!0}),t.tooltip("show"))},onAlertDocLinkMouseOut:function(e){$(e.currentTarget).tooltip("destroy")},onShowSubPage:function(e,t){var i=this.getSubView(a.SUBPAGE_TABLE);i||(i=this.registerSubView(a.SUBPAGE_TABLE,new s({el:this.getSubPageElement(a.SUBPAGE_TABLE),pageId:a.PAGE_ALERTS}))),i.show(t)},onPageLinkClick:function(e){t.navigateToPageByPageLink(e.currentTarget)},onAlertPolicyEditClick:function(e){i.executeActionElement(e.currentTarget)}})}),define("models/ebrowser/hooks/EBBaseHookModel",["models/BaseModel"],function(e){"use strict";var t={ENTITY_TYPE:"entityType",NOTIFY_TYPE:"alertType",RESULT_DATA:"resultData",RESULT:"result"};return e.extend({fetch:function(){},parse:function(e,t){},getNotifyType:function(){return this.get(t.NOTIFY_TYPE)},getResult:function(){return this.get(t.RESULT)},isEmpty:function(){return!this.getResult()}},{DP:t})}),define("models/affinity/AffinityLegacyModel",["models/BaseModel","data/DataURLConstants","data/DataManager","utils/AppUtil"],function(e,t,i,n){"use strict";var s={VM_REF:"vm_reference",CLUSTER_REF:"cluster_reference",HOST_REF:"host_reference",HOST_LIST:"hosts",ENTITY_REF_UUID:"uuid",ENTITY_REF_KIND:"kind"};return e.extend({DP:s,urlRoot:t.LEGACY_VM_HOST_AFFINITY,getDataSourceURL:function(){return i.getDataSourceURL(i.API_VERSION.V3)},getVmUuid:function(){return n.get(this,s.VM_REF+"."+s.ENTITY_REF_UUID)},getClusterUuid:function(){return n.get(this,s.CLUSTER_REF+"."+s.ENTITY_REF_UUID)},getHosts:function(){return this.get(s.HOST_LIST)||[]},getHostUuids:function(){return _.map(this.getHosts(),function(e){return n.get(e,s.HOST_REF+"."+s.ENTITY_REF_UUID)})}},{DP:s})}),define("models/affinity/AffinityLegacyCollection",["models/BaseCollection","models/affinity/AffinityLegacyModel","data/DataURLConstants","data/DataManager"],function(e,t,i,n){"use strict";return e.extend({url:i.LEGACY_VM_HOST_AFFINITY,model:t,getDataSourceURL:function(){return n.getDataSourceURL(n.API_VERSION.V3)},getVmUuids:function(){return this.map(function(e){return e.getVmUuid()})},getHostUuids:function(){var e=[];return this.each(function(t){_.each(t.getHostUuids(),function(t){return e.push(t)})}),_.unique(e)}})}),define("models/ebrowser/hooks/AffinityRuleHookModel",["bluebird","models/ebrowser/hooks/EBBaseHookModel","models/affinity/AffinityLegacyCollection","utils/AppConstants","utils/AppUtil","utils/CommonTemplates"],function(e,t,i,n,s,a){"use strict";var r,o=t.DP;return t.extend({name:"AffinityRuleHookModel",defaults:(r={},_defineProperty(r,o.NOTIFY_TYPE,n.MODAL.ALERT.TYPE_INFO),_defineProperty(r,o.ENTITY_TYPE,n.ENTITY_AFFINITY_RULE),r),fetch:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return _.defaults(e,{success:s.noop,error:s.noop}),this.isNew()||e.refresh||this.getState()===n.STATE_ERROR?this._serverFetch(e):this._cacheFetch(e)},parse:function(e,t){var i;return i={},_defineProperty(i,o.RESULT_DATA,e.toJSON()),_defineProperty(i,o.RESULT,this._createLegacyMsg(e.length)),i},_serverFetch:function(e){var t=this;return(new i).fetch({success:function(i){t.isNew(!1),t.set(t.parse(i)),t.updateState(n.STATE_SUCCESS),e.success(t)},error:function(i){t.isNew(!1),t.updateState(n.STATE_ERROR),e.error(t,i)}})},_cacheFetch:function(t){var i=this;return new e(function(e,n){e(i),t.success(i)})},_createLegacyMsg:function(e){var t="";return e&&(t=this.i18ns("legacy_alert",e,s.pluralizeEntity(n.ENTITY_AFFINITY_RULE,e),this._createActionLink())),t},_createActionLink:function(){return a.ALERT_LINK({actionTargetName:this.i18n("legacy_action"),actionTargetId:"",actionTarget:n.ENTITY_AFFINITY_RULE,action:n.ACTION_MANAGE_LEGACY_RULE,actionParentEntityType:"",actionParentId:""})}})}),define("managers/EBHookFactory",["models/ebrowser/hooks/AffinityRuleHookModel","utils/AppConstants"],function(e,t){"use strict";return{createHook:function(e){var t=this.getHookClass(e),i=t.HookModel,n=t.options;return new i(void 0===n?{}:n)},hasHook:function(e){var t=this.getHookClass(e),i=t.HookModel;return Boolean(i)},getHookClass:function(i){switch(i){case t.ENTITY_AFFINITY_RULE:return{HookModel:e};default:return{}}}}}),define("models/ebrowser/EBGraphQLModel",["models/query/BaseQueryModel","models/ebrowser/EBGroupedQueryModel","models/ebrowser/EBGroupModel","models/ebrowser/EBGroupsCollection","data/DataURLConstants","data/DataProperties","utils/EntityUtil","utils/AppConstants","utils/AppUtil"],function(e,t,i,n,s,a,r,o,l){"use strict";var c={ENTITY_ID:"_entity_id_",QUERY_ALIAS:"graphQL_alias",QUERY_PARAMS:"query_params",COL_MAPPING:"column_mapping"},d={TOTAL_RECOVERY_POINTS:"totalRecoveryPointsQuery",LATEST_RECOVERY_POINT:"latestRecoveryPointQuery",OLDEST_RECOVERY_POINT:"oldestRecoveryPointQuery"},u=[0],h=t.extend({GRAPHQL_DP:c,urlRoot:s.GRAPHQL,toJSON:function(){var e=t.prototype.toJSON.apply(this,arguments),i=this.getGraphqlSchema(),n=this.get(this.DP.ENTITY_TYPE);if(this._isCountQuery())e=this.addDefaultCountQueryParams(n,e);else{e=this.addDefaultQueryParams(n,e);var s=this.getEntityQueryConfig(n);if(s)return this.formJointGraphQLQuery(e,s,i)}var a=this.stringifyQuery(e);return e="{"+o.GRAPHQL.GROUPS+"\n          (param_body:"+a+")"+i+"}",{query:e}},stringifyQuery:function(e){return e[this.DP.GROUP_MEMBER_ATTRIBUTES]||(e[this.DP.GROUP_MEMBER_ATTRIBUTES]=[]),e[this.DP.GROUP_MEMBER_ATTRIBUTES].push({attribute:this.GRAPHQL_DP.ENTITY_ID}),JSON.stringify(e).replace(/"([^(")"]+)":/g,"$1:")},getGraphqlSchema:function(){return"{ "+this.DP.ENTITY_TYPE+"\n          "+this.DP.TOTAL_ENTITY_COUNT+"\n          "+this.DP.FILTERED_ENTITY_COUNT+"\n          "+this.DP.TOTAL_GROUP_COUNT+"\n          "+this.DP.FILTERED_GROUP_COUNT+"\n          "+this.DP.GROUP_RESULTS+"\n          { "+this.DP.TOTAL_ENTITY_COUNT+"\n            "+this.DP.GROUP_BY_COLUMN_VALUE+"\n            "+this.DP.ENTITY_RESULTS+"\n              {data\n                {name\n                  values\n                  {values}\n                }\n              }\n            }\n          }"},parse:function(t,s){var l=this,c={};_.each(t.data,function(t,i){c[i]=e.prototype.parse.call(l,t,s)});var d=this.get(this.DP.ENTITY_TYPE);c=this.flattenJointGraphQuery(c,d);var u={};if(c){var h=[this.DP.TOTAL_ENTITY_COUNT,this.DP.FILTERED_ENTITY_COUNT,this.DP.FILTERED_GROUP_COUNT,this.DP.TOTAL_GROUP_COUNT];_.each(h,function(e){u[e]=c[e]});var p=this.get(this.DP.GROUPING_ATTR);u[this.DP.GROUP_RESULTS]=new n,_.each(c[this.DP.GROUP_RESULTS],function(e){var t=this,n={};n[i.DP.ENTITY_TYPE]=d,n[i.DP.GROUPING_ATTR]=p,p===o.ALL_ENTITIES_GROUP?n[i.DP.NAME]=o.ALL_ENTITIES_GROUP:n[i.DP.NAME]=e[this.DP.GROUP_BY_COLUMN_VALUE];var s=this._extractValuefromGroupSummary(e.group_summaries,a.EB.ENTITY_NAME);s&&(n[a.EB.ENTITY_NAME]=s),e[this.DP.GROUP_SUMMARIES]&&(n[i.DP.GROUP_SUMMARIES]={},_.each(e[this.DP.GROUP_SUMMARIES],function(e,t){t.toLowerCase()!==this.BUCKET_SUMMARY_HELPER_KEY&&(n[i.DP.GROUP_SUMMARIES][t]=e)},this));var l=this.parseMemberCollectionResults(e);l=l.map(function(e){return e[a.ID]=e[t.GRAPHQL_DP.ENTITY_ID],e[a.EB.ENTITY_ID]=e[t.GRAPHQL_DP.ENTITY_ID],e}),n[i.DP.MEMBERS_COL]=r.createCollection(d,l),n[i.DP.TOTAL_ENTITY_COUNT]=e[i.DP.TOTAL_ENTITY_COUNT];var c=new i(n);s&&(c.nameAttribute=a.EB.ENTITY_NAME),u[this.DP.GROUP_RESULTS].add(c)},this)}return u},getEBQueryModelInstance:function(e){return new h(e)},formJointGraphQLQuery:function(e,t,i){var n=this,s=e[this.DP.GROUPING_ATTR];e[this.DP.ENTITY_IDS]&&s!==o.ALL_ENTITIES_GROUP&&(e[this.DP.FILTER_CRITERIA]=e[this.DP.ENTITY_IDS].map(function(t){return e[n.DP.FILTER_CRITERIA]+";"+s+"=="+t}).join(),delete e[this.DP.ENTITY_IDS]);var a={};t.forEach(function(t){var i=Object.assign({},e);if(_.contains([d.LATEST_RECOVERY_POINT,d.OLDEST_RECOVERY_POINT],t[c.QUERY_ALIAS])){var s=u[n.getCurrentPageNumber()-1];i=Object.assign({},i,_defineProperty({},n.DP.GROUP_OFFSET,s))}a[t[c.QUERY_ALIAS]]=Object.assign({},i,t[c.QUERY_PARAMS])});var r="";return _.each(a,function(e,t){var n=JSON.stringify(e).replace(/"([^(")"]+)":/g,"$1:"),s=t+" : "+o.GRAPHQL.GROUPS+"\n            (param_body:"+n+")"+i;r+=" "+s}),{query:"{ "+r+" }"}},flattenJointGraphQuery:function(e,t){var i=this,n=this.getEntityQueryConfig(t);if(!n)return e.groups;var s=_.first(n)[c.QUERY_ALIAS],a=[];n.forEach(function(t){var n=t[c.QUERY_ALIAS];e[n][i.DP.GROUP_RESULTS].forEach(function(e){var t;e[i.DP.ENTITY_RESULTS]=i.parseMemberCollectionResults(e),a.push((t={},_defineProperty(t,i.DP.GROUP_BY_COLUMN_VALUE,e[i.DP.GROUP_BY_COLUMN_VALUE]),_defineProperty(t,n,e),t))})}),a=_.groupBy(a,this.DP.GROUP_BY_COLUMN_VALUE);var r=[],o=0;_.each(a,function(e){var t=Object.assign.apply(Object,[{}].concat(_toConsumableArray(e))),a=i.get(i.DP.GROUPING_ATTR),u=_defineProperty({},a,t[i.DP.GROUP_BY_COLUMN_VALUE]);n.forEach(function(e){var n=e[c.QUERY_ALIAS],s=t[n],a=e[c.COL_MAPPING];_.each(a,function(e,t){var n=i.DP.ENTITY_RESULTS+".0."+t;u[e]=s?l.get(s,t)||l.get(s,n):u[e]})});var h=t[s];if(t[d.TOTAL_RECOVERY_POINTS]){var p;r.push((p={},_defineProperty(p,i.DP.GROUP_BY_COLUMN_VALUE,t[i.DP.GROUP_BY_COLUMN_VALUE]),_defineProperty(p,i.DP.TOTAL_ENTITY_COUNT,h&&h[i.DP.TOTAL_ENTITY_COUNT]||0),_defineProperty(p,i.DP.ENTITY_RESULTS,[]),_defineProperty(p,i.DP.FILTERED_ENTITY_COUNT,0),_defineProperty(p,i.DP.GROUP_SUMMARIES,i._createGroupSummaryObject(u)),p)),t[d.LATEST_RECOVERY_POINT]&&(o+=1)}});var h=this.getCurrentPageNumber();u[h]=u[h-1]+o;var p=_defineProperty({},this.DP.GROUP_RESULTS,r),T=[this.DP.ENTITY_TYPE,this.DP.TOTAL_ENTITY_COUNT,this.DP.FILTERED_ENTITY_COUNT,this.DP.TOTAL_GROUP_COUNT,this.DP.FILTERED_GROUP_COUNT];return _.each(T,function(t){p[t]=e[s][t]}),p},getEntityQueryConfig:function(e){var t,i,n,s,r,l,u,h,p,T=void 0;switch(e){case o.ENTITY_VM_RECOVERY_POINT:T=[(n={},_defineProperty(n,c.QUERY_ALIAS,d.TOTAL_RECOVERY_POINTS),_defineProperty(n,c.QUERY_PARAMS,(t={},_defineProperty(t,this.DP.GROUP_MEMBER_SORT_ORDER,o.SORT_DESCENDING),_defineProperty(t,this.DP.AVAILABILITY_ZONE_SCOPE,o.AVAILABILITY_ZONE_SCOPE.GLOBAL),t)),_defineProperty(n,c.COL_MAPPING,(i={},_defineProperty(i,this.DP.TOTAL_ENTITY_COUNT,a.EB.TOTAL_COUNT),_defineProperty(i,a.EB.ENTITY_NAME,a.EB.ENTITY_NAME),i)),n),(l={},_defineProperty(l,c.QUERY_ALIAS,d.LATEST_RECOVERY_POINT),_defineProperty(l,c.QUERY_PARAMS,(s={},_defineProperty(s,this.DP.GROUP_MEMBER_SORT_ORDER,o.SORT_DESCENDING),_defineProperty(s,this.DP.AVAILABILITY_ZONE_SCOPE,o.AVAILABILITY_ZONE_SCOPE.LOCAL),s)),_defineProperty(l,c.COL_MAPPING,(r={},_defineProperty(r,this.DP.TOTAL_ENTITY_COUNT,a.EB.LOCAL_COUNT),_defineProperty(r,a.EB.CREATION_TIME_USECS,a.EB.LATEST_LOCAL_RECOVERY_POINT_TIME),_defineProperty(r,c.ENTITY_ID,a.EB.LATEST_LOCAL_RECOVERY_POINT_ID),_defineProperty(r,a.EB.ENTITY_NAME,a.EB.ENTITY_NAME),r)),l),(p={},_defineProperty(p,c.QUERY_ALIAS,d.OLDEST_RECOVERY_POINT),_defineProperty(p,c.QUERY_PARAMS,(u={},_defineProperty(u,this.DP.GROUP_MEMBER_SORT_ORDER,o.SORT_ASCENDING),_defineProperty(u,this.DP.AVAILABILITY_ZONE_SCOPE,o.AVAILABILITY_ZONE_SCOPE.LOCAL),u)),_defineProperty(p,c.COL_MAPPING,(h={},_defineProperty(h,a.EB.CREATION_TIME_USECS,a.EB.OLDEST_LOCAL_RECOVERY_POINT_TIME),_defineProperty(h,c.ENTITY_ID,a.EB.OLDEST_LOCAL_RECOVERY_POINT_ID),h)),p)]}return T},addDefaultQueryParams:function(e,t){var i=this.getDefaultQueryParams(e),n=i[this.DP.FILTER_CRITERIA];return t[this.DP.FILTER_CRITERIA]&&n&&(t[this.DP.FILTER_CRITERIA]+=";"+n,delete i[this.DP.FILTER_CRITERIA]),Object.assign({},t,i)},getDefaultQueryParams:function(e){var t,i=void 0;switch(e){case o.ENTITY_VM_RECOVERY_POINT:t={},_defineProperty(t,this.DP.GROUP_MEMBER_COUNT,1),_defineProperty(t,this.DP.GROUP_MEMBER_ATTRIBUTES,[{attribute:c.ENTITY_ID},{attribute:a.EB.CREATION_TIME_USECS},{attribute:a.EB.ENTITY_NAME}]),i=t}return i},addDefaultCountQueryParams:function(e,t){return Object.assign({},t,this.getDefaultCountQueryParams(e))},getDefaultCountQueryParams:function(e){var t=void 0;switch(e){case o.ENTITY_VM_RECOVERY_POINT:t=_defineProperty({},this.DP.AVAILABILITY_ZONE_SCOPE,o.AVAILABILITY_ZONE_SCOPE.GLOBAL)}return t},getCurrentPageNumber:function(){var e=this.getPaginationInfo();return Math.ceil(e.end/e.pageSize)},_isCountQuery:function(){return this.get(this.DP.QUERY_NAME).indexOf("entity_counts")>=0},_createGroupSummaryObject:function(e){var t={};return _.each(e,function(e,i){var n={name:i,values:[{values:[e]}]};t[i]=n}),t},_extractValuefromGroupSummary:function(e,t){if(e&&t){var i=_.first(e[t].values);return _.first(i.values)}}});return h}),define("models/ebrowser/EBCustomPerspectiveModel",["models/BaseModel","models/userdata/UserDataModel","models/ebrowser/EBPerspectiveModel","models/categories/CategoriesQueryModel","utils/AppConstants","utils/AppUtil","data/DataProperties"],function(e,t,i,n,s,a,r){"use strict";var o=_.template('<%= msg %> "<%- name %>".'),l=_.extend({},i.DP,{NAME:r.NAME,CREATE:"create",UPDATE:"update",ENTITY_TYPE:"entityType"});return i.extend({DP:l,name:"EBCustomPerspectiveModel",userDataModel:null,_isPopulated:!1,initialize:function(){i.prototype.initialize.apply(this,arguments),this.initModel(),this._isPopulated=!1},initModel:function(){this.userDataModel=new t,this.userDataModel.set({type:r.USER_DATA_TYPE_EB_COLUMNS}),this.getId()?(this.isNew(!1),this.userDataModel.isNew(!1),this.userDataModel.set({key:this.getId()})):(this.setId(a.randomId("id")),this.isNew(!0)),this.categoriesQueryModel=new n},save:function(e){var t=this,i=this.isNew()?l.CREATE:l.UPDATE;i===l.CREATE?(this.userDataModel.isNew(!0),this.set(r.CREATED_TIME,1e3*Date.now())):this.userDataModel.isNew(!1),this.userDataModel.set({key:this.getId(),value:JSON.stringify(this.toJSON())}),e=e||{};var n=e.success,s=e.error;e={success:function(e,s){t.showSuccessNotification(t,i,s),n&&n(e,s)},error:function(e,n,a){t.showErrorNotification(t,i,n),s&&s(e,n,a)}},this.showLatencyNotification(this,i),this.userDataModel.save(null,e)},toJSON:function(){var e={},t=[r.ID,this.DP.NAME,this.DP.ENTITY_TYPE,r.CREATED_TIME];return _.each(t,function(t){e[t]=this.get(t)},this),e[this.DP.ENTITY_ATTRIBUTES]={},e[this.DP.ENTITY_ATTRIBUTES][this.DP.DISPLAY_ATTRIBUTES]=this.getDisplayAttributes(),e[this.DP.ENTITY_ATTRIBUTES][this.DP.HELPER_ATTRIBUTES]=this.get(this.DP.ENTITY_ATTRIBUTES)?this.get(this.DP.ENTITY_ATTRIBUTES)[l.HELPER_ATTRIBUTES]:[],e},destroy:function(e){return this.userDataModel.isNew(!1),this.userDataModel.set({key:this.getId()}),this.userDataModel.destroy(e)},setDisplayAttributes:function(e){if(!_.isArray(e))throw new Error('Value must be of type "array"');var t={};t[l.DISPLAY_ATTRIBUTES]=e;var i=!1;if(_.each(e,function(e){0===e.indexOf(s.ENTITY_CATEGORY_PREFIX)&&(i=!0)}),i){var n=this.get(l.DISPLAY_ATTRIBUTES)?this.get(l.DISPLAY_ATTRIBUTES)[l.HELPER_ATTRIBUTES]:[];n.push(r.EB.CATEGORIES),t[l.HELPER_ATTRIBUTES]=n}this.set(l.ENTITY_ATTRIBUTES,t),this._isPopulated=!1},isPopulated:function(){return this._isPopulated},setPopulated:function(){this._isPopulated=!0},getAvailableCategories:function(){return this.categoriesQueryModel.getCategoryNames()},showSuccessNotification:function(t,i,n){e.prototype.showSuccessNotification.apply(this,arguments)},showErrorNotification:function(t,i,n){e.prototype.showErrorNotification.apply(this,arguments)},showLatencyNotification:function(t,i){e.prototype.showLatencyNotification.apply(this,arguments)},getNotificationMessage:function(e,t){var i;switch(e){case s.ACTION_CREATE:i=t===s.NOTIFY_SUCCESS?this.i18n("createSuccess"):this.i18n("createFailure");break;case s.ACTION_UPDATE:i=t===s.NOTIFY_SUCCESS?this.i18n("saveSuccess"):this.i18n("saveFailure");break;case s.ACTION_DELETE:i=t===s.NOTIFY_SUCCESS?this.i18n("deleteSuccess"):this.i18n("deleteFailure")}return o({msg:i,name:this.getDisplayName()})}})}),define("models/ebrowser/EBCustomPerspectivesCollection",["models/userdata/UserDataCollection","models/ebrowser/EBCustomPerspectiveModel","data/DataProperties","utils/AppUtil"],function(e,t,i,n){"use strict";return e.extend({model:t,name:"EBCustomPerspectivesCollection",type:i.USER_DATA_TYPE_EB_COLUMNS,parse:function(e){var t=[];return e.length&&_.each(e,function(e){try{t.push(JSON.parse(e.value))}catch(e){n.log('Error parsing user data type "'+this.type+'". '+e)}},this),t},comparator:function(e){return e.get(i.CREATED_TIME)},getByEntityType:function(e){return this.filter(function(t){return t.get(t.DP.ENTITY_TYPE)===e})}})}),define("models/ebrowser/EBSelectionsModel",["models/BaseModel","utils/AppConstants"],function(e,t){"use strict";var i={SELECTED_ENTITIES:"change:selectedEntities"};return e.extend({entityType:t.ENTITY_BLOCK,name:"EBSelectionsModel",DP:{SELECTED_ENTITIES:"selectedEntities",IS_SELECT_ALL_ENTITIES_ENABLED:"isSelectAllEntitiesEnabled"},CHANGE_EVENTS:i,defaults:{selectedEntities:null,selectedEntitiesTrigger:!1,isSelectAllEntitiesEnabled:null},initialize:function(){this.set(this.DP.SELECTED_ENTITIES,{}),this.set(this.DP.IS_SELECT_ALL_ENTITIES_ENABLED,{})},getSelectedEntityIds:function(e){return this.get(this.DP.SELECTED_ENTITIES)[e]||[]},setSelectedEntityIds:function(e,t){this.get(this.DP.SELECTED_ENTITIES)[e]=t,this._triggerChangeEvent(i.SELECTED_ENTITIES)},appendSelectedEntityIds:function(e,t){var i=this.get(this.DP.SELECTED_ENTITIES)[e]||[];i=_.uniq(i.concat(t)),this.setSelectedEntityIds(e,i)},removeSelections:function(e,t){var i=this.getSelectedEntityIds(e);if(i.length&&t&&t.length){var n=_.difference(i,t);this.setSelectedEntityIds(e,n)}},areAllSelected:function(e,t){var i=this.getSelectedEntityIds(e);return!_.some(t,function(e){return!_.contains(i,e)})},toggleEntitySelection:function(e,t){var i=_.isArray(t)?t:[t],n=this.get(this.DP.SELECTED_ENTITIES),s=n[e]||[];_.each(i,function(e){var t=String(e);s.indexOf(t)>=0?s=_.without(s,t):s.push(t)}),this.setSelectedEntityIds(e,s)},updateSelectAllEntities:function(e,t){this.get(this.DP.IS_SELECT_ALL_ENTITIES_ENABLED)[e]=t},isSelectAllEntitiesEnabled:function(e){return this.get(this.DP.IS_SELECT_ALL_ENTITIES_ENABLED)[e]||!1},_triggerChangeEvent:function(e,t){this.trigger(e,t)}})}),define("models/ebrowser/favorites/EBFavoriteQueryModel",["models/BaseModel","models/userdata/UserDataModel","utils/AppUtil","utils/FilterUtil","data/DataProperties"],function(e,t,i,n,s){"use strict";var a={UUID:"uuid",CREATE_TIME:"createdTimeUsecs",ENTITY_TYPE:"entityType",FILTER_EXPR:"filterExpression",ENTITY_IDS:"entity_ids",GROUP_BY_ATTR:"groupBy",COLOR_BY_ATTR:"colorBy",SORT_BY_ATTR:"sortBy",SORT_BY_ORDER:"sortOrder",PERSPECTIVE:"perspective"},r=[a.ENTITY_TYPE,a.GROUP_BY_ATTR,a.COLOR_BY_ATTR,a.SORT_BY_ATTR,a.SORT_BY_ORDER,a.PERSPECTIVE];return e.extend({DP:a,idAttribute:a.UUID,nameAttribute:a.uuid,name:"EBFavoriteQueryModel",defaults:{uuid:null,createdTimeUsecs:null,entityType:null,filterExpression:null,groupBy:null,colorBy:null,sortBy:null,sortOrder:null,perspective:null},save:function(e){this.set(this.DP.CREATE_TIME,1e3*Date.now());var i=new t({type:s.USER_DATA_TYPE_EB_SAVED_FILTERS});return i.set({key:this.getId(),value:JSON.stringify(this.toJSON())}),i.save(null,e)},destroy:function(e){var i=new t({type:s.USER_DATA_TYPE_EB_SAVED_FILTERS});return i.isNew(!1),i.set({key:this.getId()}),i.destroy(e)},equals:function(e){var t=!0;return _.each(r,function(i){var n=this.get(i),s=e.get(i);_.isEqual(n,s)||(t=!1)},this),t&&(t=i.compareArrayContents(this.get(a.ENTITY_IDS),e.get(a.ENTITY_IDS))),t&&(t=n.compareFilterExpressions(this.get(a.FILTER_EXPR),e.get(a.FILTER_EXPR))),t}},{DP:a})}),define("models/ebrowser/favorites/EBFavoriteQueriesCollection",["models/userdata/UserDataCollection","data/DataProperties","models/ebrowser/favorites/EBFavoriteQueryModel","utils/AppUtil"],function(e,t,i,n){"use strict";return e.extend({name:"EBFavoriteQueriesCollection",model:i,type:t.USER_DATA_TYPE_EB_SAVED_FILTERS,parse:function(e){var t=[];return e.length&&_.each(e,function(e){try{t.push(JSON.parse(e.value))}catch(e){n.log('Error parsing user data type "'+this.type+'". '+e)}},this),t},getQueries:function(e){return this.filter(function(t){return t.get(t.DP.ENTITY_TYPE)===e})}})}),define("models/ebrowser/filters/EBFiltersCollection",["models/BaseCollection","models/ebrowser/filters/EBFilterModel"],function(e,t){"use strict";return e.extend({model:t,name:"EBFiltersCollection"})}),define("models/ebrowser/filters/EBFiltersManager",["models/BaseModel","models/ebrowser/filters/EBFiltersCollection","models/ebrowser/filters/EBFilterModel","managers/EntityManager","managers/UserBehaviorManager","data/DataProperties","utils/SubModelHelper","utils/AppUtil","utils/AppConstants","utils/EntityUtil"],function(e,t,i,n,s,a,r,o,l,c){"use strict";return e.extend({name:"EBFiltersManager",subModelHelper:null,parentModel:null,filterExpression:null,dynamicRanges:null,userFilters:null,initialize:function(t){e.prototype.initialize.apply(this,arguments),this.parentModel=t.parentModel,this.subModelHelper=new r,this.filterExpression={},this.dynamicRanges={}},destroy:function(){this.parentModel=null,this.subModelHelper.destroy(),this.subModelHelper=null},initUserFilters:function(){this.userFilters=this.parentModel.getFilterableAttributes()},_loadFilterRanges:function(e,t){var i=this.dynamicRanges[e]||[],n=[];_.each(t,function(e){i.indexOf(e.get(e.DP.ATTRIBUTE))<0&&(e.get(e.DP.TYPE)===l.FILTER_TYPES.ENUM&&e.get(e.DP.VALUE)===l.ENUM_DYN_TYPE_PLACEHOLDR?n.push(e):e.get(e.DP.TYPE)===l.FILTER_TYPES.INT&&e.get(e.DP.SUB_TYPE)!==l.FILTER_TYPES.TIME&&n.push(e),i.push(e.get(e.DP.ATTRIBUTE)))},this),n.length&&(this.parentModel.loadDynamicFilters(e,n),this.dynamicRanges[e]=i)},getFiltersByEntityType:function(e){if(!this.userFilters)return[];var t=this.userFilters[e],i=[];if(t&&t.length){var n=this.getAllFiltersByEntityType(e);_.each(t,function(e){_.each(n,function(t){e===t.get(t.DP.ATTRIBUTE)&&i.push(t)},this)})}return i},getAllFiltersByEntityType:function(e){var i="ebFiltersCollection-"+e,n=this.subModelHelper.get(i);if(!n){var s=this._initFilterModels(e);n=new t(s),this.subModelHelper.register(i,n)}return n.models},_initFilterModels:function(e){var t=[];if(c.isExternalEntityType(e))return t;var s=n.getEntitySchema(e),a=s.get(s.DP.ATTRIBUTES);return _.each(a,function(n,a){if(a!==s.get(s.DP.ID_ATTR)){var r,d=null,u=null;switch(n[s.DP.ATTR_TYPE]){case s.TYPES.INT:r=l.FILTER_OPERATORS.RANGE,d=[],n[s.DP.ATTR_SUBTYPE]===l.FILTER_TYPES.TIME?(u=[],_.each(n[s.DP.ATTR_VALUES],function(e,t){u.push(e),d.push(t)}),d.push(l.CUSTOM_SEARCH.NUM_SEARCH),u.push(l.CUSTOM_SEARCH.NUM_SEARCH)):d.push(l.CUSTOM_SEARCH.NUM_SEARCH);break;case s.TYPES.STR:r=l.FILTER_OPERATORS.CONTAINS,d=[l.CUSTOM_SEARCH.STR_SEARCH];break;case s.TYPES.ENUM:var h=c.isListAttribute(e,a);r=h&&n[s.DP.ATTR_VALUES]&&n[s.DP.ATTR_SUBTYPE]===l.FILTER_TYPES.STR?l.FILTER_OPERATORS.CONTAINS:l.FILTER_OPERATORS.EQUALS,u=[],d=[],_.each(n[s.DP.ATTR_VALUES],function(e,t){u.push(e),d.push(t)}),d.length||(d=[l.ENUM_DYN_TYPE_PLACEHOLDR])}_.each(d,function(c,d){if(c.length){var h=u?u[d]:c,p=null,T=null;if((n[s.DP.ATTR_TYPE]===s.TYPES.ENUM&&n[s.DP.ATTR_SUBTYPE]===l.FILTER_TYPES.INT||n[s.DP.ATTR_TYPE]===s.TYPES.INT&&n[s.DP.ATTR_SUBTYPE]===l.FILTER_TYPES.TIME)&&c.indexOf(l.FILTER_RANGE_SEPARATOR)>0){var E=c.split(l.FILTER_RANGE_SEPARATOR);2===E.length&&(r=l.FILTER_OPERATORS.RANGE,p=E[0],T=E[1])}var g=new i({id:o.randomId("filter-"),entityType:e,name:h,value:c,category:n[s.DP.ATTR_DISP_NAME],isApplied:!1,type:n[s.DP.ATTR_TYPE],subType:n[s.DP.ATTR_SUBTYPE],inputType:n[s.DP.ATTR_INPUT_TYPE],inputParams:n[s.DP.ATTR_INPUT_PARAMS],units:n[s.DP.ATTR_UNITS],filterable:!1!==n[s.DP.ATTR_FILTERABLE],attribute:a,operator:r,start:p,end:T,count:null});t.push(g)}},this)}},this),t},_getViewIdentifier:function(e,t){return e+"_FG_"+t},updateDynamicFilters:function(e,t,i){var n,s=t.get(t.DP.TYPE);s===l.FILTER_TYPES.INT?n=this._createNumericRangeFilters(e,t,i):s===l.FILTER_TYPES.ENUM&&(n=this._createEnumFilters(e,t,i));var a="ebFiltersCollection-"+e;this.subModelHelper.get(a).add(n)},_createNumericRangeFilters:function(e,t,i){var n=t.get(t.DP.ATTRIBUTE),s=[];i[i.DP.GROUP_RESULTS].each(function(e,t){var i=e.get(e.DP.NAME).split(e.GROUP_RANGE_SEPARATOR);2===i.length&&s.push({idx:t,start:i[0],end:i[1],count:e.get(e.DP.TOTAL_ENTITY_COUNT)})},this);var a=[];return _.each(s,function(i){var s=this._createIndividualNumericRangeFilter(e,n,i.start,i.end,t.get(t.DP.UNITS),!0),r=s.getFilterCondition(),o=this._findFilterByCondition(e,n,r);o&&(s.set(s.DP.IS_APPLIED,o.get(s.DP.IS_APPLIED)),this.removeFilter(e,o.getId())),a.push(s),(o||s).setMatchCount(i.count)},this),a},_createIndividualNumericRangeFilter:function(e,t,n,s,a,r){var d=c.getAttributeDisplayValue(e,t,n)+l.FILTER_RANGE_SEPARATOR+c.getAttributeDisplayValue(e,t,s),u=new i({id:o.randomId("filter-"),entityType:e,name:d,value:null,isApplied:!1,type:l.FILTER_TYPES.INT,subType:null,inputType:null,units:a,attribute:t,operator:l.FILTER_OPERATORS.RANGE,start:n,end:s});if(!r){var h="ebFiltersCollection-"+e;this.subModelHelper.get(h).add(u)}return u},_createIntFilter:function(e,t,n,s,a,r,d){var u=c.getAttributeDisplayValue(e,t,n),h=n,p=null;a===l.FILTER_OPERATORS.RANGE&&(u+=l.FILTER_RANGE_SEPARATOR,u+=c.getAttributeDisplayValue(e,t,s),p=s);var T=new i({id:o.randomId("filter-"),entityType:e,name:u,value:h,isApplied:!1,type:l.FILTER_TYPES.INT,subType:null,inputType:null,units:r,attribute:t,operator:a,start:h,end:p});if(!d){var E="ebFiltersCollection-"+e;this.subModelHelper.get(E).add(T)}return T},_createEnumFilters:function(e,t,i){var n=i[i.DP.GROUP_RESULTS],s={},a=[];_.each(n.models,function(e){var t=e.get(e.DP.NAME);e.isAllEntitiesGroup()||a.push(t),s[t]=e.get(e.DP.TOTAL_ENTITY_COUNT)});var r=t.get(t.DP.ATTRIBUTE),o=c.isListAttribute(e,r),d=o?l.FILTER_OPERATORS.CONTAINS_V3:l.FILTER_OPERATORS.EQUALS,u=[];return _.each(a,function(i){if("undefined"!==i.toLowerCase()){var n=this._createIndividualEnumFilter(e,r,i,t.get(t.DP.UNITS),t.get(t.DP.SUB_TYPE),d,!0);u.push(n);var a=n.getFilterCondition(),o=this._findFilterByCondition(e,r,a);o&&(n.set(n.DP.IS_APPLIED,o.get(n.DP.IS_APPLIED)),this.removeFilter(e,o.getId())),void 0!==s[i]&&n.setMatchCount(s[i])}},this),u},_createIndividualEnumFilter:function(e,t,n,s,a,r,d){var u=n===l.UNDEFINED_ENTITIES_GROUP?l.FILTER_NULL_VALUE:n,h=new i({id:o.randomId("filter-"),entityType:e,name:c.getAttributeDisplayValue(e,t,n),value:u,isApplied:!1,type:l.FILTER_TYPES.ENUM,subType:a,inputType:null,units:s,attribute:t,operator:r,start:null,end:null,count:null});if(!d){var p="ebFiltersCollection-"+e;this.subModelHelper.get(p).add(h)}return h},_createSelectionsFilter:function(e,t,s){var a=n.getEntitySchema(e),r=a.get(a.DP.ID_ATTR),c=new i({id:o.randomId("filter-"),entityType:e,name:l.CUSTOM_SEARCH.SELECTIONS_SEARCH,value:t,isApplied:!0,type:l.FILTER_TYPES.INT,subType:null,inputType:null,units:null,attribute:r,operator:l.FILTER_OPERATORS.IN,start:null,end:null,count:null});if(!s){var d="ebFiltersCollection-"+e;this.subModelHelper.get(d).add(c)}return c},_groupFilters:function(e){return _.groupBy(e,function(e){return e.get(e.DP.ATTRIBUTE)})},updateFilter:function(e,t,i,n,a,r){var o="ebFiltersCollection-"+r,c=this.subModelHelper.get(o),d=c.findModelById(e);if(!d)return null;d.set(d.DP.IS_APPLIED,a),a&&s.recordUserActivities({action:"EB: filter applied",actionTarget:d.get(d.DP.ENTITY_TYPE)+" "+d.get(d.DP.ATTRIBUTE)});var u=d.get(d.DP.NAME);u===l.CUSTOM_SEARCH.NUM_SEARCH&&(d.set(d.DP.VALUE,null),d.set(d.DP.START,i),d.set(d.DP.END,n)),u!==l.CUSTOM_SEARCH.STR_SEARCH&&u!==l.CUSTOM_SEARCH.CATEGORY_SEARCH&&u!==l.FILTER_DRILLDOWN||(d.set(d.DP.OPERATOR,t),d.set(d.DP.VALUE,i))},clearFilter:function(e,t){var i="ebFiltersCollection-"+e,n=this.subModelHelper.get(i),s=n.findModelById(t);if(!s)return null;s.set(s.DP.IS_APPLIED,!1);var a=s.get(s.DP.NAME);a!==l.CUSTOM_SEARCH.FILTER_SEARCH&&a!==l.CUSTOM_SEARCH.SELECTIONS_SEARCH||n.remove(s)},clearAllFilters:function(e){var t="ebFiltersCollection-"+e,i=this.subModelHelper.get(t),n=[];i.each(function(e){if(e.get(e.DP.IS_APPLIED)){e.set(e.DP.IS_APPLIED,!1);var t=e.get(e.DP.NAME);t===l.CUSTOM_SEARCH.FILTER_SEARCH||t===l.CUSTOM_SEARCH.SELECTIONS_SEARCH?n.push(e):t===l.CUSTOM_SEARCH.NUM_SEARCH?(e.set(e.DP.VALUE,null),e.set(e.DP.START,null),e.set(e.DP.END,null)):t===l.CUSTOM_SEARCH.STR_SEARCH&&(e.set(e.DP.VALUE,null),e.set(e.DP.OPERATOR,null))}},this),n.length&&i.remove(n)},createStringSearchFilter:function(e,t,n,s,a){var r=new i({id:o.randomId("filter-"),entityType:e,name:l.CUSTOM_SEARCH.FILTER_SEARCH,value:n,isApplied:!0,type:l.FILTER_TYPES.STR,subType:null,inputType:null,units:null,attribute:t,operator:s||l.FILTER_OPERATORS.CONTAINS,start:null,end:null,count:null});if(!a){var c="ebFiltersCollection-"+e;this.subModelHelper.get(c).add(r)}return r},createCategoryFilter:function(e,t,n){var s=new i({id:o.randomId("filter-"),entityType:e,name:t,value:t,isApplied:!0,type:l.FILTER_TYPES.STR,subType:null,inputType:null,units:null,attribute:a.EB.CATEGORIES,operator:l.FILTER_OPERATORS.CATEGORY_EQUALS,start:null,end:null,count:null});if(!n){var r="ebFiltersCollection-"+e;this.subModelHelper.get(r).add(s)}return s},createCustomFilter:function(e,t,n){var s=new i({id:t.id||o.randomId("filter-"),entityType:e,name:t.name||null,value:t.value||null,isApplied:t.isApplied||!1,type:t.type||null,subType:t.subType||null,inputType:t.inputType||null,inputParams:t.inputParams||[],units:t.units||null,filterable:t.filterable||!1,attribute:t.attribute||null,operator:t.operator||null,start:t.start||null,end:t.end||null,count:t.count||null});return n||this.addFilter(e,s),s},addFilter:function(e,t){var i="ebFiltersCollection-"+e;this.subModelHelper.get(i).add(t)},removeFilter:function(e,t){var i="ebFiltersCollection-"+e,n=this.subModelHelper.get(i),s=n.findModelById(t);n.remove(s)},isSearchFilter:function(e,t){var i="ebFiltersCollection-"+e,n=this.subModelHelper.get(i),s=n.findModelById(t);return s&&s.get(s.nameAttribute)===l.CUSTOM_SEARCH.FILTER_SEARCH},createShowSelectionsFilter:function(e,t,i){var n="ebFiltersCollection-"+e,s=this.subModelHelper.get(n);if(!i){var a=s.find(function(t){return t.get(t.DP.NAME)===l.CUSTOM_SEARCH.SELECTIONS_SEARCH&&t.get(t.DP.ENTITY_TYPE)===e});if(a)return void a.set({value:t,isApplied:!0})}return this._createSelectionsFilter(e,t,i)},applyFilterExpression:function(e,t){var i=this.getAllFiltersByEntityType(t);_.each(i,function(e){e.set(e.DP.IS_APPLIED,!1)}),_.each(e,function(e,i){for(var n=0;n<e.length;n++){var s=e[n]
;if(i===l.LABEL_CONDITION_ATTRIBUTE){var a=s.value1,r=this.parentModel.getLabelsCollection().findModelById(a);r&&r.setApplied(!0)}else{var o=this._findFilterByCondition(t,i,s);o?o.set(o.DP.IS_APPLIED,!0):(o=this.createFilterModelFromFilterCondition(t,i,s,!1),o.set(o.DP.IS_APPLIED,!0))}}},this)},createFilterModelFromFilterCondition:function(e,t,i,n){var s,r=c.getAttributeSchema(e,t),o=r&&r.units;if(i.name===l.FILTER_DRILLDOWN)s=this.createStringSearchFilter(e,t,i.value1,i.op,n),s.set(s.DP.NAME,l.FILTER_DRILLDOWN);else if(c.isStringAttribute(e,t)||t===a.EB.CATEGORIES)s=this.createStringSearchFilter(e,t,i.value1,i.op,n),i.name&&s.set(s.DP.NAME,i.name),t===a.EB.CATEGORIES&&s.set(s.DP.NAME,i.value1);else if(c.isIntAttribute(e,t))s=this._createIntFilter(e,t,i.value1,i.value2,i.op,o,n);else{var d=i.displayFilterValue?i.displayFilterValue:i.value1;s=this._createIndividualEnumFilter(e,t,d,o,r&&r.subType,i.op,n)}return i.label&&s.set(s.DP.CUSTOM_LABEL,i.label),s},_findFilterByCondition:function(e,t,i){var n=this.getAllFiltersByEntityType(e);return _.find(n,function(e){return e.isFilterForCondition(t,i)})},generateFilterExpression:function(e){var t=this.getAllFiltersByEntityType(e),i=_.filter(t,function(e){return e.get(e.DP.IS_APPLIED)}),n=_.groupBy(i,function(e){return e.get(e.DP.ATTRIBUTE)}),s={};return _.each(n,function(e,t){var i=[];_.each(e,function(e){i.push(e.getFilterCondition())}),s[t]=i}),s},generateLabelsFilterExpression:function(e){var t=[];_.each(e,function(e){t.push({op:l.FILTER_OPERATORS.CONTAINS,name:e,type:l.FILTER_TYPES.STR,value1:e,value2:null})});var i={};return i[l.LABEL_CONDITION_ATTRIBUTE]=t,i}})}),define("models/ebrowser/labels/EBUpdateLabeledEntitiesModel",["models/BaseModel","data/DataURLConstants"],function(e,t){"use strict";var i={ENTITY_TYPE:"entityType",ENTITY_IDS:"entityIds",TAG_ID:"tagUuid",OPERATION:"operation",PARENT_TASK_ID:"taskUuid",SUCCESS_LIST:"successList",ERROR_LIST:"errorList"},n={ADD:"add",REMOVE:"remove"};return e.extend({DP:i,OPERATIONS:n,name:"EBUpdateLabeledEntitiesModel",defaults:{entityType:null,entityIds:null,taskUuid:null,operation:null,successList:null,errorList:null},initialize:function(){e.prototype.initialize.apply(this,arguments),this.set(this.DP.SUCCESS_LIST,[]),this.set(this.DP.ERROR_LIST,[])},url:function(){return this.get(this.DP.OPERATION)===this.OPERATIONS.ADD?t.ADD_TAG_ENTITIES:this.get(this.DP.OPERATION)===this.OPERATIONS.REMOVE?t.REMOVE_TAG_ENTITIES:void 0},getURL:function(e,i){return this.get(this.DP.OPERATION)===this.OPERATIONS.ADD?t.ADD_TAG_ENTITIES:this.get(this.DP.OPERATION)===this.OPERATIONS.REMOVE?t.REMOVE_TAG_ENTITIES:void 0},toJSON:function(){var e=[],t=this.get(this.DP.ENTITY_TYPE);return _.each(this.get(this.DP.ENTITY_IDS),function(i){e.push({entityUuid:i,entityType:t})}),{tagUuid:this.get(this.DP.TAG_ID),entitiesList:e}},showLatencyNotification:function(e,t){},showSuccessNotification:function(e,t,i){},triggerAppViewRefresh:function(){}},{DP:i,OPERATIONS:n})}),define("models/ebrowser/labels/EBLabelModel",["models/BaseModel","models/ebrowser/labels/EBUpdateLabeledEntitiesModel","utils/AppConstants","data/DataURLConstants","data/DataProperties"],function(e,t,i,n,s){"use strict";var a={UUID:"uuid",NAME:"name",DESCRIPTION:"description",CREATE_TIMESTAMP:"createTimestampUsecs",UPDATE_TIMESTAMP:"lastModifiedTimestampUsecs",ENTITY_TYPE:"entityType"},r=e.extend({models:null,DP:t.DP,OPERATIONS:t.OPERATIONS,get:function(t){return t===this.DP.PARENT_TASK_ID?_.map(this.models,function(e){return e.get(e.DP.PARENT_TASK_ID)}):e.prototype.get.apply(this,arguments)},save:function(){var e=this.getModelsByEntity();this.models=e;var t=_.map(e,function(e){return e.save()}),i=$.Deferred();return $.when.apply($,t).done(function(){i.resolve(e,"success")}).fail(function(e,t,n){i.reject(e,t,n)}),i.promise()},getModelsByEntity:function(){var e=this.get(this.DP.ENTITY_IDS),i=this.get(this.DP.ENTITY_TYPE),n=this.get(this.DP.TAG_ID),s=this.get(this.DP.OPERATION);return _.map(e,function(e){var a=new t,r={};return r[a.DP.ENTITY_TYPE]=i,r[a.DP.ENTITY_IDS]=[e],r[a.DP.TAG_ID]=n,r[a.DP.OPERATION]=s,a.set(r),a},this)}});return e.extend({idAttribute:s.UUID,nameAttribute:s.NAME,name:"EBLabelModel",urlRoot:n.TAGS_SERVICE,entityType:i.ENTITY_LABEL,_isApplied:!1,DP:a,TAG_ATTRS:["name","description","entityType"],tagged_uuid_list:[],defaults:{uuid:null,name:null,description:null,entityType:null,createTimestampUsecs:null,lastModifiedTimestampUsecs:null},initialize:function(t){e.prototype.initialize.apply(this,arguments),this._isApplied=!1,this.tagged_uuid_list=[]},destroy:function(){this.actionMode=i.ACTION_DELETE,e.prototype.destroy.apply(this,arguments)},toJSON:function(){var e={};return _.each(this.TAG_ATTRS,function(t){e[t]=this.get(t)},this),e},getURL:function(e,t){return"update"===e?this.urlRoot+"/"+this.getId():null},isApplied:function(){return this._isApplied},setApplied:function(e){this._isApplied=e},getLabeledEntities:function(){return this.tagged_uuid_list},setLabeledEntities:function(e){this.tagged_uuid_list=e},getEntityType:function(){return this.get(a.ENTITY_TYPE)},getLabelEntitiesHelper:function(e,n){var s;s=e===i.ENTITY_CLUSTER&&_.size(n)>1?new r:new t;var a={};return a[s.DP.ENTITY_TYPE]=e,a[s.DP.ENTITY_IDS]=n,a[s.DP.TAG_ID]=this.get(this.DP.UUID),a[s.DP.OPERATION]=s.OPERATIONS.ADD,s.set(a),s},getUnlabelEntitiesHelper:function(e,n){var s;s=e===i.ENTITY_CLUSTER&&_.size(n)>1?new r:new t;var a={};return a[s.DP.ENTITY_TYPE]=e,a[s.DP.ENTITY_IDS]=n,a[s.DP.TAG_ID]=this.get(this.DP.UUID),a[s.DP.OPERATION]=s.OPERATIONS.REMOVE,s.set(a),s},isEntityLabeled:function(e,t){var i=this.getLabeledEntities();return i&&i.indexOf(t)>=0},isLabelForEntityType:function(e){return this.getEntityType()===e},addEntities:function(e){var t=this.getLabeledEntities();_.each(e,function(e){t.push(e)}),this.setLabeledEntities(_.uniq(t))},removeEntities:function(e){var t=[];_.each(this.getLabeledEntities(),function(i){_.contains(e,i)||t.push(i)}),this.setLabeledEntities(t)},showLatencyNotification:function(e,t){},showSuccessNotification:function(e,t,i){},triggerAppViewRefresh:function(){}},{DP:a})}),define("models/ebrowser/labels/EBGetLabeledEntitiesModel",["models/BaseModel","data/DataURLConstants"],function(e,t){"use strict";return e.extend({DP:{TAG_IDS:"tagIds",ENTITIES:"entities",ENTITY_INFO:"entityInfo",ENTITY_UUID:"entityUuid",ENTITY_TYPE:"entityType",TAG_LIST:"tagList"},urlRoot:t.GET_TAG_ENTITIES,defaults:{entityType:null,tagIds:null,entities:null},initialize:function(t){e.prototype.initialize.apply(this,arguments),t=t||{},this.set(this.DP.ENTITY_TYPE,t[this.DP.ENTITY_TYPE]||null),this.set(this.DP.TAG_IDS,t[this.DP.TAG_IDS]||[]),this.set(this.DP.ENTITIES,t[this.DP.ENTITIES]||[])},toJSON:function(){var e={};return e[this.DP.ENTITY_TYPE]=this.get(this.DP.ENTITY_TYPE),e[this.DP.TAG_IDS]=this.get(this.DP.TAG_IDS),e},getTaggedEntityIds:function(e){var t=[];return _.each(this.get(this.DP.ENTITIES),function(i){var n=i[this.DP.TAG_LIST]||[];_.contains(n,e)&&t.push(i[this.DP.ENTITY_INFO][this.DP.ENTITY_UUID])},this),t},showLatencyNotification:function(e,t){},showSuccessNotification:function(e,t,i){},triggerAppViewRefresh:function(){}})}),define("models/ebrowser/labels/EBLabelsCollection",["models/PollingCollection","models/ebrowser/labels/EBLabelModel","models/ebrowser/labels/EBGetLabeledEntitiesModel","data/DataManager","data/DataProperties","data/DataURLConstants","utils/AppConstants","utils/SubModelHelper"],function(e,t,i,n,s,a,r,o){"use strict";return e.extend({model:t,name:"EBLabelsCollection",labelEntityTypes:null,initialize:function(t,n){e.prototype.initialize.apply(this,arguments),this.subModelHelper=new o,this.labelEntityTypes=n&&n.labelEntityTypes,_.each(this.labelEntityTypes,function(e){var t=new i;t.set(t.DP.ENTITY_TYPE,e),this.subModelHelper.register("get-labeled-entities-helper-"+e,t)},this)},parseOptions:function(){var t=e.prototype.parseOptions.apply(this,arguments);return t.url=n.getDataSourceURL()+a.TAGS_SERVICE,t},fetch:function(t){this.stateMonitor.getState()!==r.STATE_PENDING||this.isSameFetchCall(t)||this.stopFetch();var i={};this.each(function(e){if(e.isApplied()){var t=i[e.get(e.DP.ENTITY_TYPE)]||[];i[e.get(e.DP.ENTITY_TYPE)]||(i[e.get(e.DP.ENTITY_TYPE)]=t),t.push(e.get(e.DP.UUID))}});var n=this,s=e.prototype.fetch.apply(this,arguments);return s.done(function(){if(n.size()>0){var e={};n.each(function(t){var i=e[t.get(t.DP.ENTITY_TYPE)]||[];e[t.get(t.DP.ENTITY_TYPE)]||(e[t.get(t.DP.ENTITY_TYPE)]=i),i.push(t.get(t.DP.UUID))});var t=[];_.each(n.labelEntityTypes,function(s){var a=n.subModelHelper.get("get-labeled-entities-helper-"+s);a&&(a.set(a.DP.TAG_IDS,e[s]||[]),t.push(a.save(null,{success:function(){n._syncEntityLabels(s,i[s]||[])}})))},this),t.length&&$.whenAll.apply($,t).done(function(){n.trigger("change")})}}),s},comparator:function(e){return e.get(e.nameAttribute).toLowerCase()},getLabels:function(e){return this.filter(function(t){return t.isLabelForEntityType(e)})||[]},getLabelById:function(e,t){return this.find(function(i){return i.isLabelForEntityType(e)&&i.getId()===t})},getAppliedFilterIds:function(e){var t=[];return this.each(function(i){i.isLabelForEntityType(e)&&i.isApplied()&&t.push(i.get(i.idAttribute))}),t},onLabelTaskChange:function(e,t,i){var n,a,r=i.get(s.TASK_ENTITY_TYPE),o=i.get(s.TASK_ENTITY_ID),l=[];if(_.each(o,function(e,t){"tag"===r[t]?n=e:(l.push(e),a=r[t])}),n&&a&&l&&l.length){var c=this.getLabelById(a,n);c&&(e?c.addEntities(l):t&&c.removeEntities(l))}},_syncEntityLabels:function(e,t){var i=this.subModelHelper.get("get-labeled-entities-helper-"+e);this.each(function(n){if(n.get(n.DP.ENTITY_TYPE)===e){var s=n.get(n.DP.UUID);n.setApplied(_.contains(t,s)),n.setLabeledEntities(i.getTaggedEntityIds(s))}})}})}),define("models/networksecurity/NetworkSecurityGroupedQueryModel",["models/ebrowser/EBGroupedQueryModel","utils/AppConstants"],function(e,t){"use strict";return e.extend({initialize:function(){e.prototype.initialize.apply(this,arguments),this.set(this.DP.GROUP_MEMBER_COUNT,t.SECURITY_POLICY_RULE_LIMIT)}})}),define("models/ebrowser/EntityBrowserModel",["models/BaseModel","data/DataProperties","managers/BatchManager","managers/EntityStateTracker","managers/EBHookFactory","models/ebrowser/EBGraphQLModel","models/ebrowser/EBQueryModel","models/ebrowser/EBGroupedQueryModel","models/ebrowser/EBPerspectivesCollection","models/ebrowser/EBCustomPerspectivesCollection","models/ebrowser/EBSelectionsModel","models/ebrowser/favorites/EBFavoriteQueriesCollection","models/ebrowser/filters/EBFiltersManager","models/ebrowser/labels/EBLabelsCollection","models/task/TaskServiceModel","models/InactivityPollingModel","models/networksecurity/NetworkSecurityGroupedQueryModel","utils/SubModelHelper","utils/EntityUtil","utils/AppConstants","utils/AppUtil","events/AppEvents"],function(e,t,i,n,s,a,r,o,l,c,d,u,h,p,T,E,g,S,m,v,f,A){"use strict";var y="EntityBrowserModel",C={ENTITY_TYPE_GROUPINGS:"entityTypeGroupings",LABEL_ENTITY_TYPES:"labelEntityTypes"},I={SELECTED_ENTITY_TYPE:"change:selectedEntityTypeTrigger",QUERY_STATE:"change:queryStateTrigger",QUERY_RESULTS:"change:queryResultsTrigger",REFRESH_DATA:"change:refreshDataTrigger",ENTITY_COUNTS:"change:entityCountsTrigger",FILTER_COUNTS:"change:filterCountsTrigger",VISUALIZATION:"change:visualizationTrigger",ENTITY_ALERT:"change:visualizationAlertTrigger",FILTERS:"change:filtersTrigger",LABELED_ENTITIES:"change:labeledEntitiesTrigger",TASKS_CHANGED:"change:tasksChangedTrigger",COLOR_BY:"change:colorByTrigger",LEGEND:"change:legendTrigger",FAVORITE_QUERIES:"change:favoriteQueriesTrigger",ERROR_MSG:"change:errorMessageTrigger",INTENT_ENTITIES_STATE_CHANGED:"change:entitiesStateChangedTrigger"},b={LABEL_ID:"labelId",PERSPECTIVE:"perspective",FILTER_JOIN_OPERATORS:"filter_join_operators",SKIP_DEFAULT_FILTERS:"skipDefaultFilters"};return e.extend({name:y,subModelHelper:null,initialFetchRequested:!1,QUERY_TYPES:{FILTERS:"eb:filters",FILTER_COUNTS:"eb:filter_counts",COUNTS:"eb:entity_counts",DATA:"eb:data",GROUPBY:"eb:groupby",POLL:"eb:poll"},NO_FILTERS_COUNT:-1,COUNTS_ERROR:-1,currentQueryModel:null,currentQueryState:v.STATE_INIT,selectedVisualization:null,fetchCustomPerspectives:!0,CHANGE_EVENTS:I,EXTRA_OPTIONS:b,defaults:{entityTypeGroupings:null,entityTypes:null,labelEntityTypes:null,selectedEntityType:null,selectedPerspectiveMap:null,selectedVisualizationMap:null,entityCountsMap:null,colorByMap:null,currentVizCapabilities:null,errorMessage:null},initialize:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.fetchCustomPerspectives=this.supportCustomPerspective(),this.subModelHelper=new S;var i={};_.each(t[C.ENTITY_TYPE_GROUPINGS],function(t,n){var s=e._canViewEntityTypes(t);_.size(s)&&(i[n]=s)}),this.set({entityTypeGroupings:i,entityTypes:[],labelEntityTypes:t[C.LABEL_ENTITY_TYPES]||[],selectedPerspectiveMap:{},selectedVisualizationMap:{},selectedEntities:{},entityCountsMap:{},colorByMap:{}});var n=[];_.each(this.get("entityTypeGroupings"),function(e){n=n.concat(e)}),this.set("entityTypes",n);var s=new d;this.subModelHelper.register("EBSelectionsModel",s);var a=new d;if(this.subModelHelper.register("EBGroupSelectionsModel",a),this.supportFavoriteQueries()){var o=new u;this.subModelHelper.register("EBFavoriteQueriesCollection",o)}var l=new h({parentModel:this});this.subModelHelper.register("EBFiltersManager",l);var T=new p(null,{labelEntityTypes:this.get("labelEntityTypes")});this.subModelHelper.register("EBLabelsCollection",T),T.on("change reset add remove",this.onLabelEntities,this),_.each(this.getEntityTypes(),function(e){var t=this.getEntityPerspectivesCollection(e);this.subModelHelper.register(e+"-perspectives",t);var i={};i[r.DP.ENTITY_TYPE]=e;var n=this.getEBQueryModelInstance(i);this.subModelHelper.register(e+"-query-model",n)},this);var g=this,m=this._getInactivityPollingOptions()||{},v=new E(_.extend({pollDataCallback:function(){g.pollCurrentQuery(g.getSelectedEntityType())}},m));this.subModelHelper.register("InactivityPollingModel",v),this.subModelHelper.register("EBCustomPerspectives",new c)},destroy:function(){this.stopQueryPolling(),this.subModelHelper.get("EBLabelsCollection").off("change reset add remove",this.onLabelEntities,this),this.subModelHelper.destroy(),this.subModelHelper=null},getEntityPerspectivesCollection:function(e){return new l(null,{entityType:e})},getEBQueryModelInstance:function(e){if(e[r.DP.ENTITY_TYPE]===v.ENTITY_NETWORK_SECURITY_RULE)return new g(e);var t=m.isGraphqlEntityType(e[r.DP.ENTITY_TYPE]),i=m.isGroupedEntityType(e[r.DP.ENTITY_TYPE]);return t?new a(e):i?new o(e):new r(e)},getEBFilterCountsQueryModelInstance:function(e){var t=e[r.DP.ENTITY_TYPE];if(m.isGroupedEntityType(t)){var i=new r(e),n=this.getEntityManager().getEntitySchema(t);return i.set(i.DP.GROUPING_ATTR,n.getGroupingAttribute()),i.set(i.DP.GROUP_COUNT,1),i}return this.getEBQueryModelInstance(e)},getOptionsHeader:function(){return this.i18nStatic(y,"optionsHeader")},getEntityTypeGroupings:function(){return this.get("entityTypeGroupings")},getEntityTypes:function(){return this.get("entityTypes")},setSelectedEntityType:function(e){if(f.debug("EntityBrowserModel : setSelectedEntityType: "," | eType     : ",e),this.set({selectedEntityType:e}),e){var t=this.get("selectedPerspectiveMap"),i=t[e];i?this.hasInValidQueryModel(e)&&this.setCurrentPerspective(e,i):this.setCurrentPerspective(e,v.DEFAULT_PERSPECTIVE)}this._triggerChangeEvent(I.SELECTED_ENTITY_TYPE)},getSelectedEntityType:function(){return this.get("selectedEntityType")},canLabelEntityType:function(e){return _.contains(this.get("labelEntityTypes"),e)},getTotalEntityCount:function(e){return this.get("entityCountsMap")[e]},setTotalEntityCount:function(e,t){this.get("entityCountsMap")[e]=t,this._triggerChangeEvent(I.ENTITY_COUNTS)},setEntityCount:function(e,t){var i=null;i=m.isGroupedEntityType(e)?t.get(t.DP.TOTAL_GROUP_COUNT):m.isInnerFilteredEntityType(e)?t.get(t.DP.FILTERED_ENTITY_COUNT):t.get(t.DP.TOTAL_ENTITY_COUNT),this.setTotalEntityCount(e,i)},getColorBy:function(e){return this.get("colorByMap")[e]},getDefaultColorBy:function(e){var t=this.get("selectedPerspectiveMap"),i=t[e]||v.DEFAULT_PERSPECTIVE,n=this._getPerspectiveModel(e,i);return n?n.getDefaultColorByAttribute():null},setColorBy:function(e,t){var i=this;this.get("colorByMap")[e]=t;var n=this.getQueryModel(e),s={},a=n.get(n.DP.GROUP_MEMBER_ATTRIBUTES);if(t){_.find(a,function(e){return e.attribute===t})||(s[n.DP.GROUP_MEMBER_ATTRIBUTES]=[].concat(a),s[n.DP.GROUP_MEMBER_ATTRIBUTES].push({attribute:t}))}return this._logQuery(this.QUERY_TYPES.DATA,s),this._performQuery(e,s,function(){return i._triggerChangeEvent(I.COLOR_BY),i._triggerChangeEvent(I.LEGEND),!0})},fetchData:function(){this.initialFetchRequested||(this.initialFetchRequested=!0,this.refreshData(!0))},refreshData:function(e){var t=[],i=!1;_.each(this.getEntityTypes(),function(e){t.push(this.subModelHelper.get(e+"-perspectives").fetch()),this.canLabelEntityType(e)&&(i=!0),this.subModelHelper.get(e+"-hooks")&&t.push(this.subModelHelper.get(e+"-hooks").fetch({refresh:!0}))},this),this.fetchCustomPerspectives&&t.push(this.subModelHelper.get("EBCustomPerspectives").fetch()),i&&t.push(this.subModelHelper.get("EBLabelsCollection").fetch()),this.supportFavoriteQueries()&&t.push(this.subModelHelper.get("EBFavoriteQueriesCollection").fetch());var n=this;$.whenAll.apply($,t).done(function(){n._triggerChangeEvent(I.REFRESH_DATA)})},fetchEntityCounts:function(){if((!(arguments.length>0&&void 0!==arguments[0])||arguments[0])&&this.getDataManager().isV3PrimaryDataSource())return void this.fetchEntityCountsBatch();_.each(this.getEntityTypes(),function(e){this.fetchEntityCountByType(e)},this)},fetchEntityCountByType:function(e){if(!m.isExternalEntityType(e)){var t=this;this._createEntityCountQueryModel(e).performQuery({success:function(e){var i=e.get(e.DP.ENTITY_TYPE);t.setEntityCount(i,e)},error:function(e){var i=e.get(e.DP.ENTITY_TYPE);t.setTotalEntityCount(i,t.COUNTS_ERROR)}})}},fetchEntityCountsBatch:function(){var e=this,t=i.createBatchRequestObj(),n=this.getEntityTypes();n=_.filter(n,function(e){return!m.isExternalEntityType(e)}),t[i.DP.API_REQUEST_LIST]=_.map(n,this._createBatchEntityRequest,this),i.performBatch({requestBody:t,success:function(t){_.each(t[i.DP.API_RESPONSE_LIST],function(t,s){var a=t[i.DP.RESPONSE.API_RESPONSE],o=t[i.DP.RESPONSE.STATUS],l=n[s];if(i.isStatusError(o))return void e.setTotalEntityCount(l,e.COUNTS_ERROR);var c=void 0;if(m.isGraphqlEntityType(l)){var d=a[v.GRAPHQL.DATA][v.GRAPHQL.GROUPS];c=m.isGroupedEntityType(l)?d[r.DP.TOTAL_GROUP_COUNT]:d[r.DP.TOTAL_ENTITY_COUNT]}else c=m.isGroupedEntityType(l)?a[r.DP.TOTAL_GROUP_COUNT]:m.isInnerFilteredEntityType(l)?a[r.DP.FILTERED_ENTITY_COUNT]:a[r.DP.TOTAL_ENTITY_COUNT];e.setTotalEntityCount(l,c)})},error:function(){e.fetchEntityCounts(!1)}})},_createEntityCountQueryModel:function(e){var t=_defineProperty({},r.DP.ENTITY_TYPE,e),i=this.getEBQueryModelInstance(t),n=this.getEntityManager().getEntitySchema(e);return n&&(m.isGroupedEntityType(e)&&(t=_.extend(t,i.getGroupingOptions()),t[i.DP.GROUP_MEMBER_SORT_ATTRIBUTE]=null,t[i.DP.GROUP_MEMBER_SORT_ORDER]=null),t[i.DP.GROUP_COUNT]=1,t[i.DP.GROUP_MEMBER_COUNT]=1,t[i.DP.GROUP_MEMBER_ATTRIBUTES]=[{attribute:n.get(n.DP.NAME_ATTR)}]),this._logQuery(this.QUERY_TYPES.COUNTS,t,e),i.set(t),i},_createBatchEntityRequest:function(e){var t=this._createEntityCountQueryModel(e);return i.createRequest("post","/"+t.url(),t.toJSON())},_getInactivityPollingOptions:function(){return null},startQueryPolling:function(){this.subModelHelper.get("InactivityPollingModel").startPolling()},stopQueryPolling:function(){this.subModelHelper.get("InactivityPollingModel").stopPolling()},startTaskPolling:function(){_.bindAll(this,"onTasksChange"),this.getTaskManager().registerHandlerForChangedTasks(this.onTasksChange)},stopTaskPolling:function(){this.getTaskManager().unregisterHandlerForChangedTasks(this.onTasksChange)},startMonitorStateChanges:function(){_.bindAll(this,"onIntentEntitiesStateChanged"),A.onAppEvent(A.INTENT_ENTITIES_STATE_CHANGED,this.onIntentEntitiesStateChanged),A.onAppEvent(A.INTENT_ENTITIES_TRACKING_INITIATED,this.onIntentEntitiesStateChanged)},stopMonitorStateChanges:function(){A.offAppEvent(A.INTENT_ENTITIES_STATE_CHANGED,this.onIntentEntitiesStateChanged),A.offAppEvent(A.INTENT_ENTITIES_TRACKING_INITIATED,this.onIntentEntitiesStateChanged)},pollCurrentQuery:function(e){if(!m.isExternalEntityType(e)){var t=this.model&&this.model.getEBQueryState();if(t!==v.STATE_INIT&&t!==v.STATE_PENDING){var i=this.getQueryModel(e);if(i){var n={},s=i.get(i.DP.GROUP_RESULTS),a=i.get(i.DP.GROUP_MEMBER_COUNT)||i.getDefaultMemberLimit();s.each(function(e){var t=i.getPaginationInfo(e);n[e.getName()]=t,a=Math.max(a,t.end)});var r={};this.adjustQueryOptionsForPolling(r,i,a),this._logQuery(this.QUERY_TYPES.POLL,r);var o=this;this._performQuery(e,r,function(e){return o.validateCurrentQueryGroupsResults(e.get(i.DP.GROUP_RESULTS),n)})}}}},adjustQueryOptionsForPolling:function(e,t,i){return e[t.DP.GROUP_MEMBER_COUNT]=Math.min(i,t.getMaxMemberLimit()),e},validateCurrentQueryGroupsResults:function(e,t){return e.each(function(e){var i=e.getName(),n=t[i];if(n&&n.start>0){var s=e.getMembers().length;n.start<s&&e.set(e.DP.PAGE_OFFSET,n.start)}}),!0},clearState:function(e){this.get("colorByMap")[e]=null;var t={},i=v.DEFAULT_PERSPECTIVE;this.get("selectedPerspectiveMap")[e]=i;var n=this._getPerspectiveQueryOptions(e,i);t=_.extend(t,n),this.subModelHelper.get("EBFiltersManager").clearAllFilters(e),t[r.DP.FILTER_EXPR]={},t[r.DP.ENTITY_IDS]=null,_.each(this.getLabelsCollection().getLabels(e),function(e){e.setApplied(!1)},this),this.refreshFilters(),t[r.DP.GROUPING_ATTR]=v.GROUP_BY_NONE,t=this._resetOffset(e,t),this._logQuery(this.QUERY_TYPES.DATA,t),this._performQuery(e,t,function(){return!0})},getLabelsCollection:function(){return this.subModelHelper.get("EBLabelsCollection")},onLabelEntities:function(e,t,i){if(e&&e.actionMode===v.ACTION_DELETE){if(e.isApplied()){var n=this.getSelectedEntityType();this.refreshCurrentQuery(n)}}this._triggerChangeEvent(I.LABELED_ENTITIES)},toggleLabelFilter:function(e,t){var i=this.getLabelsCollection().findModelById(t);if(i){var n=i.isApplied();i.setApplied(!n),this._triggerChangeEvent(I.LABELED_ENTITIES),this.refreshCurrentQuery(e)}},setInitialQuery:function(e,t,i){if(e){this.set({selectedEntityType:e});var n=void 0,s=this.get("selectedPerspectiveMap");if(i[b.PERSPECTIVE]){if(!this._getPerspectiveModel(e,i[b.PERSPECTIVE]))throw new Error("Initial Query: Invalid Perspective:"+i[b.PERSPECTIVE]);n=i[b.PERSPECTIVE]}else(n=s[e])||(n=v.DEFAULT_PERSPECTIVE);var a=this._getPerspectiveQueryOptions(e,n);t=_.extend(a,t),this._triggerChangeEvent(I.SELECTED_ENTITY_TYPE);var o=i[b.LABEL_ID];if(o){var l=this.getLabelsCollection().getLabelById(e,o);if(l){l.setApplied(!0),this._triggerChangeEvent(I.LABELED_ENTITIES);var c=this.subModelHelper.get("EBFiltersManager"),d=c.generateLabelsFilterExpression([l.getId()]);t[r.DP.FILTER_EXPR]=_.extend(t[r.DP.FILTER_EXPR]||{},d)}else f.log("EntityBrowserModel: tag not found. It may have been deleted. TagId:"+o)}if(t[r.DP.FILTER_EXPR]&&(this.subModelHelper.get("EBFiltersManager").applyFilterExpression(t[r.DP.FILTER_EXPR],e),this.refreshFilters()),!m.isExternalEntityType(e)){var u=this.getQueryModel(e);u.set(t);var h=i[b.FILTER_JOIN_OPERATORS];h&&(t[u.DP.FILTER_ATTR_JOIN_OPS]=h),this._logQuery(this.QUERY_TYPES.DATA,t),this._performQuery(e,t,function(){return s[e]=n,!0})}}},getQueryModel:function(e){return this.subModelHelper.get(e+"-query-model")},hasInValidQueryModel:function(e){var t=this.getQueryModel(e);return t&&-1===t.get(t.DP.TOTAL_ENTITY_COUNT)},getQuerySortInfo:function(e){var t=this.getQueryModel(e);return[t.get(t.DP.GROUP_MEMBER_SORT_ATTRIBUTE),t.get(t.DP.GROUP_MEMBER_SORT_ORDER)]},_getDefaultSortInfo:function(e,t){var i=t.getDefaultSortingAttribute();return[i,m.isStringAttribute(e,i)?v.SORT_ASCENDING:v.SORT_DESCENDING]},setQueryGroupby:function(e,t){var i=this.getQueryModel(e),n=i.get(i.DP.GROUPING_ATTR),s=this.getCurrentPerspective(e),a={};a[i.DP.GROUPING_ATTR]=t,a[i.DP.GROUP_SORT_ATTR]=t,a[i.DP.GROUP_ATTRIBUTES]=s.getGroupSummaryAttributes(t),a[i.DP.GROUP_MEMBER_COUNT]=i.getDefaultMemberLimit(t),a[i.DP.GROUP_MEMBER_OFFSET]=0,a[i.DP.GROUP_COUNT]=i.DEFAULT_GROUPS_LIMIT,a[i.DP.GROUP_OFFSET]=0;var r=this._getDefaultSortInfo(e,s);if(a[i.DP.GROUP_MEMBER_SORT_ATTRIBUTE]=r[0],a[i.DP.GROUP_MEMBER_SORT_ORDER]=r[1],a[i.DP.GROUP_MEMBER_SORT_DS_FUNC]=v.SORT_DOWN_SAMPLING_FUNCTIONS.LATEST,n===t){var o=i.get(i.DP.GROUP_SORT_ORDER);a[i.DP.GROUP_SORT_ORDER]=o===v.SORT_ASCENDING?v.SORT_DESCENDING:v.SORT_ASCENDING}else a[i.DP.GROUP_SORT_ORDER]=a[i.DP.GROUP_MEMBER_SORT_ORDER];return this._logQuery(this.QUERY_TYPES.GROUPBY,a,t),this._performQuery(e,a,function(){return!0})},setQuerySortBy:function(e,t){var i=this.getQueryModel(e),n=i.get(i.DP.GROUPING_ATTR),s=i.get(i.DP.GROUP_MEMBER_SORT_ATTRIBUTE),a=this._getDefaultSortInfo(e,this.getCurrentPerspective(e)),r={};if(r[i.DP.GROUP_MEMBER_SORT_ATTRIBUTE]=t,r[i.DP.GROUP_MEMBER_SORT_DS_FUNC]=v.SORT_DOWN_SAMPLING_FUNCTIONS.LATEST,r[i.DP.GROUP_MEMBER_COUNT]=i.getDefaultMemberLimit(n),r[i.DP.GROUP_MEMBER_OFFSET]=0,r[i.DP.GROUP_COUNT]=i.DEFAULT_GROUPS_LIMIT,r[i.DP.GROUP_OFFSET]=0,t)if(s===t){var o=i.get(i.DP.GROUP_MEMBER_SORT_ORDER);r[i.DP.GROUP_MEMBER_SORT_ORDER]=o===v.SORT_ASCENDING?v.SORT_DESCENDING:v.SORT_ASCENDING}else r[i.DP.GROUP_MEMBER_SORT_ORDER]=a[1];else r[i.DP.GROUP_MEMBER_SORT_ATTRIBUTE]=a[0],r[i.DP.GROUP_MEMBER_SORT_ORDER]=a[1];return this._logQuery(this.QUERY_TYPES.DATA,r),this._performQuery(e,r,function(){return!0})},loadGroupMembersForExport:function(e,t,i){var n=this.getQueryModel(e),s=n.get(n.DP.GROUP_RESULTS);if(1===s.length){var a=s.findModelById(t.id),r=a.getMembers(),o=a.getGroupMemberCounts();if(o.total-o.available>0){var l={};l[n.DP.GROUP_MEMBER_OFFSET]=0,l[n.DP.GROUP_MEMBER_COUNT]=n.getMaxMemberLimit(),this._performQuery(e,l,function(e){return i(e.getQueryResults()[e.DP.RESULT_MODELS]),!1})}else i(r)}else i(null)},loadMoreEntities:function(e){var t=this.getQueryModel(e),i=t.get(t.DP.GROUP_MEMBER_COUNT);if(i<t.getMaxMemberLimit()){var n=t.get(t.DP.GROUP_RESULTS),s=0,a=0;n.each(function(e){var t=e.getGroupMemberCounts(),i=t.total-t.available;i>0&&(a++,s+=i)});var r=i*t.DEFAULT_LOAD_MORE_MULTIPLIER;1===a&&(r=i+s),t.set(t.DP.GROUP_MEMBER_COUNT,Math.min(r,t.getMaxMemberLimit())),this.pollCurrentQuery(e)}},_performEntityHook:function(e){var t=this;if(s.hasHook(e)){var i=this.subModelHelper.get(e+"-hooks");i||(i=s.createHook(e),this.subModelHelper.register(e+"-hooks",i)),i.fetch({success:function(e){return t.trigger(I.ENTITY_ALERT,e)},error:function(){f.log(t.name+": Failed to fetch data for "+e+" hook")}})}},_performQuery:function(e,t,i){if(!i)return f.log("EntityBrowserModel : Query Success Handler not provided."),$.when(null);this._performEntityHook(e),this.currentQueryModel&&this.currentQueryModel.getState()===v.STATE_PENDING&&(f.debug("EntityBrowserModel : Cancelling Query:"),this.currentQueryModel.stopFetch(),this.currentQueryModel=null,this._setEBQueryState(v.STATE_CANCELED));var n=this.getQueryModel(e),s={entityType:e};_.each(n.URL_ATTRIBUTES,function(e){s[e]=n.get(e)}),s[n.DP.FILTER_EXPR]=n.get(n.DP.FILTER_EXPR);var a=_.extend(s,t);if(a[n.DP.GROUPING_ATTR]===v.GROUP_BY_NONE){var r=this.getCurrentPerspective(e);a[n.DP.GROUP_ATTRIBUTES]=r.getGroupSummaryAttributes(v.GROUP_BY_NONE),a[n.DP.GROUP_SORT_ATTR]=null}t&&t[n.DP.FILTER_ATTR_JOIN_OPS]&&(a[n.DP.FILTER_ATTR_JOIN_OPS]=t[n.DP.FILTER_ATTR_JOIN_OPS]);var o=this.getEBQueryModelInstance(a);f.debug("EntityBrowserModel : Performing Query:",a),this.currentQueryModel=o,this._setEBQueryState(v.STATE_PENDING);var l=this;return o.performQuery({success:function(){if(l.currentQueryModel=null,l._setEBQueryState(v.STATE_SUCCESS),i(o)){var t=e+"-query-model";if(f.debug("EntityBrowserModel : Query Successful. New query model:"+o.cid),l.subModelHelper.remove(t),l.subModelHelper.register(t,o),l._triggerChangeEvent(I.QUERY_RESULTS),m.isInnerFilteredEntityType(e)){var s=o.get(n.DP.FILTER_EXPR);s&&_.size(s)?l.fetchEntityCountByType(e):l.setEntityCount(e,o)}else l.setEntityCount(e,o)}},error:function(t){if(l.currentQueryModel=null,t.getState()!==v.STATE_CANCELED){l._setEBQueryState(v.STATE_ERROR),f.debug("EntityBrowserModel : Query Failed.");var i="Error querying for  "+f.getPluralEntityName(e)+".";l._setError(i)}else f.debug("EntityBrowserModel : Query Cancelled for "+e)}})},getEBQueryState:function(){return this.currentQueryState},_setEBQueryState:function(e){this.currentQueryState=e,this.subModelHelper.get("InactivityPollingModel").setDataState(e),this._triggerChangeEvent(I.QUERY_STATE,e)},getPerspectives:function(e){return this.subModelHelper.get(e+"-perspectives").getPerspectives()},getCommonPerspective:function(e){return this.subModelHelper.get(e+"-perspectives").getCommonPerspective()},getCustomPerspectives:function(e){return this.getCustomPerspectivesCollection().getByEntityType(e)},getCustomPerspective:function(e,t){var i=_.find(this.getCustomPerspectives(e),function(e){return e.getId()===t});if(i&&!i.isPopulated()){this.subModelHelper.get(e+"-perspectives").copyCommonAttributes(i)}return i},getCustomPerspectivesCollection:function(){return this.subModelHelper.get("EBCustomPerspectives")},getCurrentPerspective:function(e){var i=this.getPerspectives(e),n=this.get("selectedPerspectiveMap"),s=n[e];return s||(s=i[0].get(t.NAME),n[e]=s),this.findPerspectiveModel(e,s)},getCurrentHook:function(){var e=this.getSelectedEntityType();return this.subModelHelper.get(e+"-hooks")},setCurrentPerspective:function(e,t){var i=this._getPerspectiveQueryOptions(e,t);if(i&&!_.isEmpty(i)){var n=this.get("selectedPerspectiveMap");return this._logQuery(this.QUERY_TYPES.DATA,i,t),this._performQuery(e,i,function(){return n[e]=t,!0})}return f.log("EntityBrowserModel : Perspective not available. "+t),$.when(null)},findPerspectiveModel:function(e,i){var n=this.getPerspectives(e),s=void 0,a=void 0;return s=_.find(n,function(e){return e.get(t.NAME)===i}),a=this.getCustomPerspective(e,i),s||a||null},_getPerspectiveModel:function(e,i){var n=this.subModelHelper.get(e+"-perspectives"),s=n.find(function(e){return e.get(t.NAME)===i});return s||(s=this.getCustomPerspective(e,i)),s},_getPerspectiveQueryOptions:function(e,t){var i=this._getPerspectiveModel(e,t),n={};if(m.isExternalEntityType(e))return n;if(i){var s=this.getQueryModel(e);n[s.DP.GROUP_MEMBER_COUNT]=s.getDefaultMemberLimit(null),n[s.DP.GROUP_MEMBER_OFFSET]=0,n[s.DP.GROUP_COUNT]=s.DEFAULT_GROUPS_LIMIT,n[s.DP.GROUP_OFFSET]=0,n[s.DP.GROUP_MEMBER_ATTRIBUTES]=s.convertGroupMemberAttributesList(i.getQueryAttributes());var a=s.get(s.DP.GROUPING_ATTR)||v.GROUP_BY_NONE;n[s.DP.GROUPING_ATTR]=a;var r=this._getDefaultSortInfo(e,i);n[s.DP.GROUP_MEMBER_SORT_ATTRIBUTE]=r[0],n[s.DP.GROUP_MEMBER_SORT_ORDER]=r[1]}return n},getCurrentVisualization:function(e){var i=this.get("selectedVisualizationMap"),n=i[e],s=this.getCurrentPerspective(e);return n||(_.each(s.get(s.DP.VISUALIZATIONS),function(e){e[t.NAME]===this.selectedVisualization&&(n=this.selectedVisualization)},this),n||(n=s.get(s.DP.VISUALIZATIONS)[0][t.NAME]),i[e]=n,this.selectedVisualization=n),n},setCurrentVisualization:function(e,t){this.get("selectedVisualizationMap")[e]=t,this.selectedVisualization=t,this._triggerChangeEvent(I.VISUALIZATION)},setVisualizationCapabilities:function(e){this.set("currentVizCapabilities",e)},getVisualizationCapabilities:function(){return this.get("currentVizCapabilities")||{}},initUserFilters:function(){this.subModelHelper.get("EBFiltersManager").initUserFilters()},loadFilterRanges:function(e,t){this.subModelHelper.get("EBFiltersManager")._loadFilterRanges(e,t)},getFilterableAttributes:function(){var e={};return _.each(this.getEntityTypes(),function(t){var i=[];this.subModelHelper.get(t+"-perspectives").each(function(e){i=i.concat(e.getFilterByAttributes())},this),e[t]=_.uniq(i)},this),e},
getFiltersByEntityType:function(e){return this.subModelHelper.get("EBFiltersManager").getFiltersByEntityType(e)},getAllFiltersByEntityType:function(e){return this.subModelHelper.get("EBFiltersManager").getAllFiltersByEntityType(e)},refreshFilters:function(){this._triggerChangeEvent(I.FILTERS)},loadDynamicFilters:function(e,t){var i=this,n=[];_.each(t,function(t){var s={};s[r.DP.ENTITY_TYPE]=e,s[r.DP.GROUP_MEMBER_COUNT]=1;var a=this.getEBQueryModelInstance(s),o=t.get(t.DP.ATTRIBUTE),l=t.get(t.DP.TYPE);if(l===v.FILTER_TYPES.INT){s[a.DP.GROUPING_ATTR]=o;var c=this.getExcludeNullsFilterExpression(t);c&&(s[a.DP.FILTER_EXPR]=c)}if(l===v.FILTER_TYPES.ENUM){s[a.DP.GROUPING_ATTR]=o,s[a.DP.GROUP_COUNT]=v.NUM_GROUPS_FOR_ENUM;var d=this.getEntityManager().getEntitySchema(e);d&&(s[a.DP.GROUP_MEMBER_COUNT]=1,s[a.DP.GROUP_MEMBER_ATTRIBUTES]=[{attribute:d.get(d.DP.NAME_ATTR)}])}this._logQuery(this.QUERY_TYPES.FILTERS,s),a.set(s),f.debug("EntityBrowserModel:loadDynamicFilters. Query",s),n.push(a.performQuery({success:function(){i.subModelHelper.get("EBFiltersManager").updateDynamicFilters(e,t,a.getQueryResults())}}))},this),$.whenAll.apply($,n).done(function(){i.refreshFilters()})},fetchFiltersCounts:function(e,t){var i=this.getSelectedEntityType();_.each(e,function(e){if(e.getState()!==v.STATE_PENDING)if(null===e.getMatchCount()||t){var n=e.getCountsFilterExpression();if(n){var s=this.getFilterCountOptions()||{};s[r.DP.ENTITY_TYPE]=i,s[r.DP.FILTER_EXPR]=n,s[r.DP.GROUP_MEMBER_COUNT]=1,this._logQuery(this.QUERY_TYPES.COUNTS,s);var a=this.getEBFilterCountsQueryModelInstance(s);a.filterModel=e,e.updateState(v.STATE_PENDING);var o=this;a.performQuery({success:function(t){var n=a.get(a.DP.FILTERED_ENTITY_COUNT)||0;m.isGroupedEntityType(i)&&(n=a.get(a.DP.FILTERED_GROUP_COUNT)||0),t.filterModel.setMatchCount(n),e.updateState(v.STATE_SUCCESS),o._triggerChangeEvent(I.FILTER_COUNTS,{filterId:t.filterModel.getId(),count:n})},error:function(t){f.debug("EntityBrowserModel : Query Failed to fetch entity counts for filters"),t.filterModel.setMatchCount(o.COUNTS_ERROR),e.updateState(v.STATE_ERROR),o._triggerChangeEvent(I.FILTER_COUNTS,{filterId:t.filterModel.getId(),count:o.COUNTS_ERROR})}})}}else this._triggerChangeEvent(I.FILTER_COUNTS,{filterId:e.getId(),count:e.getMatchCount()})},this)},getFilterCountOptions:function(){return{}},getExcludeNullsFilterExpression:function(e){return e.getExcludeNullsFilterExpression()},updateFilter:function(e,t,i,n,s,a,r){var o=this.subModelHelper.get("EBFiltersManager"),l=o.isSearchFilter(a,e);!s&&l?(o.removeFilter(a,e),this.refreshFilters()):o.updateFilter(e,t,i,n,s,a),r||this.refreshOnFilterUpdate(a,t,e)},_resetOffset:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};m.isGroupedEntityType(e)&&(t[this.getQueryModel(e).DP.GROUP_OFFSET]=0);return t},refreshOnFilterUpdate:function(e){this.refreshCurrentQuery(e,!0)},refreshCurrentQuery:function(e,i){if(!m.isExternalEntityType(e)){var n={},s=this.generateCurrentFilterExpression(e),a=this.getQueryModel(e);if(s[t.ENTITY_ID_ATTR]){var r=[];_.each(s[t.ENTITY_ID_ATTR],function(e){r=r.concat(e.value1)}),n[a.DP.ENTITY_IDS]=r,delete s[t.ENTITY_ID_ATTR]}else n[a.DP.ENTITY_IDS]=null;n[a.DP.FILTER_EXPR]=s,i&&(n=this._resetOffset(e,n)),this._logQuery(this.QUERY_TYPES.DATA,n),this._performQuery(e,n,function(){return!0})}},clearFilter:function(e,t){this.subModelHelper.get("EBFiltersManager").clearFilter(e,t),this.refreshFilters(),this.refreshCurrentQuery(e,!0)},createStringSearchFilter:function(e,t,i){this.subModelHelper.get("EBFiltersManager").createStringSearchFilter(e,t,i,!1),this.refreshFilters(),this.refreshCurrentQuery(e,!0)},createCategoryFilter:function(e,t){var i=this.subModelHelper.get("EBFiltersManager"),n=i.createCategoryFilter(e,t,!1);return this.refreshFilters(),this.refreshCurrentQuery(e),n},createCustomFilter:function(e,t,i){return this.subModelHelper.get("EBFiltersManager").createCustomFilter(e,t,i)},createShowSelectionsFilter:function(e,t,i){var n=this.subModelHelper.get("EBFiltersManager"),s=n.createShowSelectionsFilter(e,t,i);return i||(this.refreshFilters(),this.refreshCurrentQuery(e)),s},createTemporaryFilterModelFromFilterCondition:function(e,t,i){return this.subModelHelper.get("EBFiltersManager").createFilterModelFromFilterCondition(e,t,i,!0)},generateCurrentFilterExpression:function(e){var t=this.subModelHelper.get("EBFiltersManager"),i=t.generateFilterExpression(e),n=this.getLabelsCollection(),s=n.getAppliedFilterIds(e);if(s&&s.length){var a=t.generateLabelsFilterExpression(s);i=_.extend(i,a)}return i},supportFavoriteQueries:function(){return this.getAccessManager().hasAccessToAllEBFeatures()},supportCustomPerspective:function(){return!this.getDataManager().isV3PrimaryDataSource()||!this.getAccessManager().isSspOnlyUser()},getFavoriteQueries:function(e){return this.subModelHelper.get("EBFavoriteQueriesCollection").getQueries(e)},newFavoriteQuery:function(e,t){var i=this,n=this.subModelHelper.get("EBFavoriteQueriesCollection");t.save({success:function(e){n.add(t),i._triggerChangeEvent(I.FAVORITE_QUERIES),i.showClientNotification(v.NOTIFY_SUCCESS,i.i18n("savedFavQuery","Saved the current query as a favorite"))},error:function(e){i.showClientNotification(v.NOTIFY_ERROR,i.i18n("errorSaveFavQuery","Error saving the current query as a favorite"))}})},deleteFavoriteQuery:function(e,t){var i=this,n=this.subModelHelper.get("EBFavoriteQueriesCollection"),s=n.findModelById(t);s&&s.destroy({success:function(e){n.remove(s),i._triggerChangeEvent(I.FAVORITE_QUERIES),i.showClientNotification(v.NOTIFY_SUCCESS,i.i18n("removedFavQuery","Removed favorite query."))},error:function(e){i.showClientNotification(v.NOTIFY_SUCCESS,i.i18n("errorRemoveFavQuery","Error removing the selected query."))}})},invokeFavoriteQuery:function(e){var t=this.subModelHelper.get("EBFavoriteQueriesCollection").findModelById(e),i=this.getSelectedEntityType(),n=this.subModelHelper.get("EBFiltersManager");if(t&&t.get(t.DP.ENTITY_TYPE)===i){var s={},a=t.get(t.DP.PERSPECTIVE)||v.DEFAULT_PERSPECTIVE;if(a){this.get("selectedPerspectiveMap")[i]=a;var o=this._getPerspectiveQueryOptions(i,a);s=_.extend(s,o)}var l=t.get(t.DP.FILTER_EXPR);l&&(s[r.DP.FILTER_EXPR]=l,n.applyFilterExpression(l,i),this.refreshFilters());var c=t.get(t.DP.ENTITY_IDS);c&&c.length&&(n.createShowSelectionsFilter(i,c,!1),s[t.DP.ENTITY_IDS]=c),s[r.DP.GROUPING_ATTR]=t.get(t.DP.GROUP_BY_ATTR)||v.GROUP_BY_NONE,s[r.DP.GROUP_MEMBER_SORT_ATTRIBUTE]=t.get(t.DP.SORT_BY_ATTR),s[r.DP.GROUP_MEMBER_SORT_ORDER]=t.get(t.DP.SORT_BY_ORDER);var d=t.get(t.DP.COLOR_BY_ATTR);this.get("colorByMap")[i]=d,d&&this._triggerChangeEvent(I.COLOR_BY),this._logQuery(this.QUERY_TYPES.DATA,s),this._performQuery(i,s,function(){return!0})}},getSelectionsModel:function(){return this.subModelHelper.get("EBSelectionsModel")},getGroupSelectionsModel:function(){return this.subModelHelper.get("EBGroupSelectionsModel")},getVisibleSelectedEntityIds:function(){var e=this.getSelectedEntityType(),t=this.getSelectionsModel().getSelectedEntityIds(e),i=this.getQueryModel(e),n=this.getVisualizationCapabilities();if(n&&!1!==n[v.EB_VIZ_CAPABILITIES.CAN_PAGINATE])return i.getVisibleSelectedEntityIds(t);var s=i.getResultEntityIds();return _.intersect(s,t)},isSelectAllEntitiesEnabled:function(){var e=this.getSelectedEntityType();return this.getSelectionsModel().isSelectAllEntitiesEnabled(e)},getErrorMsg:function(){return this.get("errorMessage")},resetError:function(){this.set("errorMessage",null)},registerActivity:function(){this.subModelHelper.get("InactivityPollingModel").registerActivity(Date.now())},_setError:function(e){this.set("errorMessage",e),this._triggerChangeEvent(I.ERROR_MSG)},_triggerChangeEvent:function(e,t){f.debug("EntityBrowserModel : Trigger Event:",e,t||"no-data"),this.registerActivity(),this.trigger(e,t)},entitiesCreated:function(e,t){this.getSelectedEntityType()===e&&this.pollCurrentQuery(e,t)},entitiesUpdated:function(e,t,i){this.getSelectedEntityType()===e&&(this.pollCurrentQuery(e,t),i&&this.getSelectionsModel().removeSelections(e,[i]))},entitiesDeleted:function(e,t){this.getSelectedEntityType()===e&&this.pollCurrentQuery(e,t),this.getSelectionsModel().removeSelections(e,t)},onTasksError:function(){this._triggerChangeEvent(I.TASKS_CHANGED)},onTasksChange:function(e){try{var i=!1,n=!1,s=!1,a=!1,r=null,o=[],l=!1,c=null,d=[],u=!1,h=null,p=[],E=this.getSelectedEntityType(),g=this.getTaskManager();_.each(e,function(e){if(e.get(t.TASK_COMPONENT)===v.ENTITY_CLUSTER_CONFIG&&E===v.ENTITY_CLUSTER)return a=!0,r=v.ENTITY_CLUSTER,void o.push(e.get(t.TASK_CLUSTER_UUID));if(e.name===T.prototype.name||e.isFanout()||e.hasEntityType(E)){e.isTaskCompleted()&&(n=!0),s=!0;var S=e.getTaskEntityIds(),m=e.getEntitySubTasksMap(),f=this.getLabelChange(e);if(_.isEmpty(m)?e.isTaskCompleted()&&(r=this.getSelectedEntityType(),_.isArray(S[r])&&(a=!0,o=o.concat(S[r]))):_.each(m,function(e){switch(_.isEmpty(S)&&(S=e.getTaskEntityIds()),e.get(t.SUB_TASK_OPERATION)){case g.SUBTASK_OPERATIONS.TAG:var n=this.getLabelChange(e),s=n.isAddTag,T=n.isRemoveTag;(s||T)&&e.isTaskCompleted()&&(e.isStatusComplete()&&this.getLabelsCollection().onLabelTaskChange(s,T,e),i=!0);break;case g.SUBTASK_OPERATIONS.VM.SET_POWER_STATE:case g.SUBTASK_OPERATIONS.VM.MIGRATE:case g.SUBTASK_OPERATIONS.VM.CLONE:e.isTaskCompleted()&&(a=!0,r=v.ENTITY_VM,S[v.ENTITY_VM]&&(o=o.concat(S[v.ENTITY_VM])));break;case g.SUBTASK_OPERATIONS.VM.DELETE:e.isTaskCompleted()&&(l=!0,c=v.ENTITY_VM,S[v.ENTITY_VM]&&(d=d.concat(S[v.ENTITY_VM])));break;case g.SUBTASK_OPERATIONS.VM.CREATE:e.isTaskCompleted()&&(u=!0,h=v.ENTITY_VM,S[v.ENTITY_VM]&&(p=p.concat(S[v.ENTITY_VM])))}},this),f&&-1===_.indexOf(f.entityTypes,v.ENTITY_VM)&&(i=!!f)&&f.taskModel.isStatusComplete()){var A=f.isAddTag,y=f.isRemoveTag,C=f.taskModel,I=f.entityTypes,b=f.entityIds;a=!0,r=_.first(I),o=b,this.getLabelsCollection().onLabelTaskChange(A,y,C)}}},this),a&&o&&o.length&&this.entitiesUpdated(r,o),l&&d&&d.length&&this.entitiesDeleted(c,d),u&&p&&p.length&&this.entitiesCreated(h,p),i&&this._triggerChangeEvent(I.LABELED_ENTITIES),s&&this._triggerChangeEvent(I.TASKS_CHANGED,e),n&&this.onParentTaskCompletion(E)}catch(e){f.logObject("EntityBrowserModel.onTasksChange: Error:",e)}},getLabelChange:function(e){var i=this.getTaskManager();if(e.get(t.SUB_TASK_OPERATION)===i.SUBTASK_OPERATIONS.TAG){var n=e.get(t.SUB_TASK_MESSAGE),s=n===i.SUBTASK_MSGS.LABEL.ADD_ENTITIES,a=n===i.SUBTASK_MSGS.LABEL.REMOVE_ENTITIES;if((s||a)&&e.isTaskCompleted()){var r=e.get(t.TASK_ENTITY_TYPE),o=e.get(t.TASK_ENTITY_ID),l=[],c=[];return _.each(r,function(e,t){e!==v.TASK_ENTITY_TYPE_LABEL&&(l.push(e),c.push(o[t]))}),{isAddTag:s,isRemoveTag:a,taskModel:e,entityTypes:l,entityIds:c}}}return null},onIntentEntitiesStateChanged:function(e,i){var s=this.getSelectedEntityType();if(s){var a=this.getQueryModel(s).getResultEntityIds(),r=_.filter(i,function(e){if(_.contains(a,e[n.DP.ENTITY_ID])&&e[n.DP.ENTITY_TYPE]===s)return e}),o=_.filter(r,function(e){return f.isIntentStateComplete(e[n.DP.ENTITY_TYPE],e[n.DP.RESULT][t.INTENT_TASK.STATE])});if(o.length)return void A.triggerAppEvent(A.ENTITIES_UPDATED,{entityType:o[0][n.DP.ENTITY_TYPE],entityIds:_.pluck(o,n.DP.ENTITY_ID)});r.length&&this._triggerChangeEvent(I.INTENT_ENTITIES_STATE_CHANGED,r)}},onParentTaskCompletion:_.debounce(function(e){this.fetchFiltersCounts(this.getFiltersByEntityType(e),!0)},1e3),_logQuery:function(e,t,i){if(f.isLocalStorageProperty(v.LOCAL_STORAGE.EB_QUERY_DEBUG)){var n=t[r.DP.ENTITY_TYPE]||this.getSelectedEntityType(),s=n+"_"+e;f.logObject("eb: "+s,t)}i&&(e=e+":"+i),t[r.DP.QUERY_NAME]=e+"-"+Date.now()},_canViewEntityTypes:function(e){var t=this.getAccessManager();return _.filter(e,function(e){return t.canViewByEntityType(e)})}},{EB_PROPERTIES:C})}),define("text!templates/pages/ebrowser/EntityBrowserView.html",[],function(){return'<div class="ebrowser-container">\n\n  \x3c!-- LEFT PANEL --\x3e\n  <div class="side-panel left-panel">\n    <div class="left-panel-top">\n      \x3c!-- browse options here --\x3e\n    </div>\n  </div>\n\n  \x3c!-- CENTER PANEL --\x3e\n  <div class="center-panel">\n  </div>\n\n  \x3c!-- RIGHT PANEL --\x3e\n  <div class="side-panel right-panel">\n    \x3c!-- Scrollable inner panel --\x3e\n    <div class="right-panel-container">\n      <div class="antiscroll-wrap">\n        <div class="box-wrap">\n          <div class="antiscroll-inner right-panel-inner">\n            <div class="right-panel-inner-wrapper">\n              <div class="right-panel-inner-bottom">\n                \x3c!-- Filters Here --\x3e\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n\n</div>\n'}),define("views/pages/ebrowser/EBBaseView",["utils/AppUtil","utils/AntiscrollUtil","utils/AppConstants","utils/SubViewHelper","events/AppEvents","managers/NotificationManager","views/basecomponents/BaseView","text!templates/pages/ebrowser/EntityBrowserView.html"],function(e,t,i,n,s,a,r,o){"use strict";var l=_.template(o);return r.extend({subViewHelper:null,scrollers:null,currentCenterViewId:null,events:{toggleRightPanel:"onToggleRightPanel",click:"onViewClick"},render:function(){e.debug("EntityBrowserBaseView : render: "," | viewid     : "+this.cid),this.$el.html(this.getViewHTML()),this.$el.addClass(s.EB_EVENT_HANDLER),this._leftPanelVisible=!0,this._rightPanelVisible=!1,this.subViewHelper||(this.subViewHelper=new n,this._initializeSubViews(),this.subViewHelper.iterate("onStartServices")),this.subViewHelper.renderAll(),this.scrollers=[];var t={x:!1,y:!0,autoHide:!0};_.each(this.$(".antiscroll-wrap"),function(e){var i=$(e).antiscroll(t).data("antiscroll");this.scrollers.push(i)},this),this._layoutPanels()},destroy:function(){this.subViewHelper.removeAll(),this.subViewHelper=null,r.prototype.destroy.apply(this,arguments)},show:function(){this.onResize()},onToggleRightPanel:function(e){this._rightPanelVisible=!this._rightPanelVisible,this._leftPanelVisible=this.showLeftPanel()&&!this._rightPanelVisible,this._layoutPanels()},onViewClick:function(e){this.model.registerActivity()},onResize:function(){this._refreshScrollers(),this.subViewHelper&&this.subViewHelper.iterate("onResize")},onError:function(){var e=this.model.getErrorMsg();e&&e.length&&(a.showClientNotification(i.NOTIFY_ERROR,e),this.model.resetError())},getViewHTML:function(){return l()},_layoutPanels:function(){var e=this.$(".ebrowser-container"),t=this.$("#toggleRightPanel"),i=this.$("#toggleLeftPanel");e.removeClass("right-panel-visible left-panel-visible center-panel-visible all-panels-visible"),t.removeClass("selected"),i.removeClass("selected"),this._leftPanelVisible||this._rightPanelVisible?this._leftPanelVisible?(e.addClass("left-panel-visible"),i.addClass("selected")):this._rightPanelVisible&&(e.addClass("right-panel-visible"),t.addClass("selected")):e.addClass("center-panel-visible"),$(window).trigger("resize.app")},_refreshScrollers:function(){var e=$(window).height(),i=$("#n-notification-bar").outerHeight(!0),n=$(".navbar").outerHeight(!0),a=this.$(".perspective-header"),r=a.hasClass("hidden")?0:a.outerHeight(!0),o=this.$(".perspective-footer"),l=o.is(":visible")?o.outerHeight(!0):0,c=this.$(".center-panel").width(),d=this.$(".side-panel.left-panel").width(),u=this.$(".side-panel.right-panel").width(),h=this.$(".left-panel-top").outerHeight(!0),p=e-(i+n+h);this.$(".left-panel-inner").height(p).width(d+20),this.$(".left-panel-inner-wrapper").width(d);var T=e-(i+n);this.$(".right-panel-inner").height(T).width(u+20),this.$(".right-panel-inner-wrapper").width(u);var E=e-(i+n+r+l);this.$(".perspective-container-inner").height(E).width(c+20),this.$(".perspective-container-wrapper").width(c),this.$(".perspective-container").width(c-40),this.$(".perspective-container-box-wrap").width(c),_.each(this.scrollers,function(e){e.refresh()}),t.applyAntiScroll(this.$(".action-dropdown-menu .antiscroll-wrap")),s.triggerAppEvent(s.EB_SCROLLERS_REFRESHED)},_initializeSubViews:function(){}},null)}),define("views/pages/ebrowser/EBOptionsView",["views/basecomponents/BaseView","managers/ExploreManager","utils/CommonTemplates","utils/AntiscrollUtil","utils/AppUtil","utils/EntityUtil","events/AppEvents"],function(e,t,i,n,s,a,r){"use strict";var o=_.template('<div class="eb-browser-options ebBrowserOptions"><div class="panel-header"><div class="pull-left"><%= header %></div><div class="clearfix"></div></div><div class="selector entity-list"><div class="antiscroll-wrap"><div class="box-wrap"><div class="antiscroll-inner"><div id="entityListPanel" class="box-inner"></div></div></div></div></div></div><div class="entity-info hide"></div>'),l=_.template('<% _.each(entityTypes, function(eTypes, group) { %><% if ( group !== AppConstants.EB_NO_ENTITY_TYPE_GROUP ) { %> <div class="entity-type-group-separator">&nbsp;</div><div class="entity-type-group"><%= i18n(group, group) %></div><% } %> <% _.each(eTypes, function(eType) { %><div data-id="<%= eType %>" class="selectionItem entity-item -small-detail"stream-action="EB: select entity type" stream-target="<%= eType %>"><div class="entityname"><%= AppUtil.getPluralEntityName(eType) %><% if (EntityUtil.isBetaEntityType(eType)) { %><div class="entitybeta"></div><% } %></div><div class="entitydetail"><%= counts[eType] %></div></div><% }) %><% }) %>'),c=_.template('<div class="entity-title"><%= entityTitle %></div><div class="entity-count"><%= entityCount %></div><div class="entity-description"><%= entityDescription %></div>'),d=_.template('<div class="entitybetatip"><%= i18n("beta_tip") %></div>');return e.extend({events:{"click .selectionItem":"onItemSelect","click .entity-title":"onEntityTitleClick"},name:"EBOptionsView",render:function(){var e=this,s=this.model.getSelectedEntityType();if(s){this._clearTooltips();var r={},c=this.model.getEntityTypes()||[],u=c.length,h=0;_.each(c,function(t){var i=e.model.getTotalEntityCount(t),n="";_.isUndefined(i)||_.isNull(i)||(n=-1===i?"Error":Number(i).toLocaleString(),h++),r[t]=n});var p=void 0;0===this.$(".eb-browser-options").length&&(p=o(this.vtOptions({header:this.model.getOptionsHeader()||this.i18n("entities")})),this.$el.html(p)),p=l(this.vtOptions({entityTypes:this.model.getEntityTypeGroupings(),counts:r,EntityUtil:a})),this.$("#entityListPanel").html(p),this.$('.selectionItem[data-id="'+s+'"]').addClass("selected"),this.$(".entitybeta").html(i.BETA_FEATURE_TEMPLATE(this.vtOptions({}))).tooltip({title:d(this.vtOptions({})),placement:"right",trigger:"hover",html:!0,animation:!1,container:"body"}),h!==u||n.isAntiscrollInit(this.$(".antiscroll-wrap"))||this._refreshScroller(),t.isEnableSearchConvergence()&&this._renderEntityInfo(r)}},onStartServices:function(){this.model.on(this.model.CHANGE_EVENTS.SELECTED_ENTITY_TYPE,this.render,this),this.model.on(this.model.CHANGE_EVENTS.ENTITY_COUNTS,this.render,this)},onStopServices:function(){this._clearTooltips(),this.model.off(this.model.CHANGE_EVENTS.SELECTED_ENTITY_TYPE,this.render,this),this.model.off(this.model.CHANGE_EVENTS.ENTITY_COUNTS,this.render,this)},onResize:function(){this._refreshScroller()},onEntityTitleClick:function(){this.model.refreshCurrentQuery(this.model.getSelectedEntityType())},onItemSelect:function(e){var t=$(e.currentTarget).attr("data-id");t!==this.model.getSelectedEntityType()?this.model.setSelectedEntityType(t):this.model.hasInValidQueryModel(t)?this.model.setSelectedEntityType(t):this.model.pollCurrentQuery(t)},onClosePanel:function(e){$(e.currentTarget).parents("."+r.EB_EVENT_HANDLER).trigger(r.EB_EVENTS.TOGGLE_LEFT_PANEL)},_refreshScroller:function(){var e=$(window).height(),t=$("#n-notification-bar").outerHeight(!0),i=$(".navbar").outerHeight(!0),s=this.$(".panel-header").outerHeight(!0),a=e-t-i-s,r={x:!1,y:!0,autoHide:!0},o=this.$(".antiscroll-wrap");n.applyAntiScroll(o,null,a,r)},_getEntitySummaryInfo:function(e){var t=this.model.getSelectedEntityType(),i="",n="",a="";if(t){var r=s.getPluralEntityName(t),o=e[t]||0;"Error"===o&&(o="-"),i=r,n=o+" Total "+r,a=""}return{entityTitle:i,entityCount:n,entityDescription:a}},_renderEntityInfo:function(e){var t=c(this.vtOptions(this._getEntitySummaryInfo(e)));this.$(".entity-info").html(t)},_clearTooltips:function(){this.$(".entitybeta").tooltip("destroy")}})}),define("views/alerts/AlertMessageView",["views/basecomponents/BaseView","managers/ActionManager","utils/AppConstants","utils/CommonTemplates"],function(e,t,i,n){"use strict";var s,a=i.MODAL.ALERT,r=(s={},_defineProperty(s,a.TYPE_INFO,i.MODAL._ALERT.STYLE_INFO),_defineProperty(s,a.TYPE_SUCCESS,i.MODAL._ALERT.STYLE_SUCCESS),_defineProperty(s,a.TYPE_WARNING,i.MODAL._ALERT.STYLE_WARNING),_defineProperty(s,a.TYPE_ERROR,i.MODAL._ALERT.STYLE_ERROR),s),o=a.TYPE_INFO;return e.extend({template:n.DEFAULT_ALERT,type:null,dismissible:!0,content:null,closeHook:null,additionalClasses:"",events:{"click .close":"onClickClose","click a[actionTarget]":"onClickAction"},initialize:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.type=e.type||o,this.dismissible=_.has(e,"dismissible")?e.dismissible:this.dismissible,this.content=e.content||"",this.closeHook=e.closeHook,this.additionalClasses=e.additionalClasses||""},render:function(){return this.isDismissed?this:(this.$el.html(this.template({style:r[this.type],closeButton:this.dismissible,content:this.content})),this.$el.addClass("alert-msg"),this.$(".alert").addClass(this.additionalClasses),this)},setContent:function(e){return this.content=e||"",this},setType:function(e){return this.type=_.contains(_.values(a),e)?e:o,this},dismissAlert:function(){this.undelegateEvents(),this.$el.hide(),this.isDismissed=!0},onClickClose:function(e){var t=this;_.isFunction(this.closeHook)?this.closeHook(function(){t.destroy()}):this.destroy()},onClickAction:function(e){t.executeActionElement(e.currentTarget)}})}),define("views/pages/ebrowser/filters/EBFilterBubbles",["utils/AppUtil","utils/AppConstants","utils/EntityUtil","data/DataProperties","views/basecomponents/BaseView"],function(e,t,i,n,s){"use strict";var a=_.template('<div class="filter-box" title="<%- attribute %> : <%= range %>"><div class="filter-name"><%- attribute %> : <%= range %></div><div class="close-btn" data-id="<%= filterId %>" ><%= Components.icon("K","-inline -micro -animated", "") %></div></div>'),r=_.template('<%= i18ns("rangeMinMax", start, end) %>'),o=_.template('<%= i18ns("rangeMinOnly", start) %>'),l=_.template('<%= i18ns("rangeMaxOnly", end) %>'),c=_.template('<div class="filter-box"title="<%- attribute %> <%= operator %> <%- value %>"><div class="filter-name"><%- attribute %> <%= operator %> <%- value %></div><div class="close-btn" data-id="<%= filterId %>" ><%= Components.icon("K","-inline -micro -animated", "") %></div></div>'),d=_.template('<div class="filter-box" title="<%- labelString %>"><div class="filter-name"><%- labelString %></div><div class="close-btn" data-id="<%= filterId %>" ><%= Components.icon("K","-inline -micro -animated", "") %></div></div>'),u=_.template('<div class="filter-box" title="<%= tooltip %>"><div class="filter-name"><%= labelString %></div><div class="close-btn" data-id="<%= filterId %>" ><%= Components.icon("K","-inline -micro -animated", "") %></div></div>');return s.extend({name:"EBFilterBarView",renderBubbles:function(e,n,s){var a=s[t.EB_BUBBLE_TYPES.FILTER_COLOR_BY],r=s[t.EB_BUBBLE_TYPES.FILTER_GROUP_BY],o=s[t.EB_BUBBLE_TYPES.FILTER_MEMBER_SORT_BY],l=s[t.EB_BUBBLE_TYPES.FILTER_FOCUS_BY],d=s[t.EB_BUBBLE_TYPES.FILTER_MODELS],u=s[t.EB_BUBBLE_TYPES.LABEL_MODELS],h=[];return!i.isGroupedEntityType(e)&&r&&r!==t.GROUP_BY_NONE&&h.push(c(this.vtOptions({filterId:t.EB_BUBBLE_TYPES.FILTER_GROUP_BY,attribute:this.i18n("groupBy"),operator:"",value:i.getAttributeDisplayName(e,r)}))),o&&o!==n.getDefaultSortingAttribute()&&h.push(c(this.vtOptions({filterId:t.EB_BUBBLE_TYPES.FILTER_MEMBER_SORT_BY,attribute:this.i18n("sortBy"),operator:"",value:i.getAttributeDisplayName(e,o)}))),l&&l!==t.DEFAULT_PERSPECTIVE&&h.push(c(this.vtOptions({filterId:t.EB_BUBBLE_TYPES.FILTER_FOCUS_BY,attribute:this.i18n("focusBy"),operator:"",value:l}))),a&&h.push(c(this.vtOptions({filterId:t.EB_BUBBLE_TYPES.FILTER_COLOR_BY,attribute:this.i18n("colorBy"),operator:"",value:i.getAttributeDisplayName(e,a)}))),_.each(d,function(t){t.get(t.DP.IS_APPLIED)&&h.push(this.getFilterBubble(e,t))},this),_.each(u,function(t){h.push(this._getLabelBubble(e,t))},this),h},getFilterBubble:function(s,h,p){var T,E,g=h.get(h.DP.ATTRIBUTE),S=i.getAttributeDisplayName(s,g),m=h.get(h.idAttribute),v=h.get(h.DP.OPERATOR),f=h.get(h.DP.NAME),A=h.get(h.DP.CUSTOM_LABEL),y=e.getShortPluralEntityName(h.get(h.DP.ENTITY_TYPE));switch(p=p||{FILTER_EQUALS_TEMPLATE:c,FILTER_RANGE_TEMPLATE:a,FILTER_SELECTED_ENTITIES_TEMPLATE:u,FILTER_DRILLDOWN_TEMPLATE:d},v){case t.FILTER_OPERATORS.RANGE:if(g===n.EB.HEALTH_SCORE||g===n.EB.CLUSTER.OVERALL_HEALTH_SCORE){var C=h.get(h.DP.END)-1;T=p.FILTER_EQUALS_TEMPLATE(this.vtOptions({filterId:m,attribute:S,operator:":",value:i.getAttributeDisplayValue(s,g,C)}))}else if(h.isTimeRangeFilter()&&f!==t.CUSTOM_SEARCH.NUM_SEARCH)T=p.FILTER_DRILLDOWN_TEMPLATE(this.vtOptions({filterId:m,labelString:f}));else{var I,b,R,N,P;if(f===t.CUSTOM_SEARCH.NUM_SEARCH)I=h.get(h.DP.START),b=h.get(h.DP.END),h.isTimeRangeFilter()&&(I=h.convertTimestampForFiltering(I),b=h.convertTimestampForFiltering(b)),R=i.getAttributeDisplayValue(s,g,I),N=i.getAttributeDisplayValue(s,g,b);else{var w=f.split(t.FILTER_RANGE_SEPARATOR);R=w[0],N=w[1],I=-1===R.indexOf("-")?R:null,b=-1!==N.indexOf("-")||h.isRangeEndFilter()?null:N}P=_.isNull(I)||_.isNull(b)?_.isNull(I)?l(this.vtOptions({end:N})):o(this.vtOptions({start:R})):r(this.vtOptions({start:R,end:N})),T=p.FILTER_RANGE_TEMPLATE(this.vtOptions({filterId:m,attribute:S,range:P}))}break;default:if(t.CUSTOM_SEARCH.SELECTIONS_SEARCH===f){var D=h.get(h.DP.VALUE)||[];E=this.i18ns("selectedlabel",y),T=p.FILTER_SELECTED_ENTITIES_TEMPLATE(this.vtOptions({filterId:m,labelString:E,tooltip:D.length+" "+E}))}else if(t.FILTER_DRILLDOWN===f||A)T=p.FILTER_DRILLDOWN_TEMPLATE(this.vtOptions({filterId:m,labelString:A}));else{var O,M=i.getAttributeSchema(s,g),L=M&&M[h.DP.INPUT_TYPE]||h.get(h.DP.INPUT_TYPE);O=L===t.INPUT_TYPES.SPOTLIGHT?h.get(h.DP.NAME):h.get(h.DP.VALUE)===t.FILTER_NULL_VALUE?t.UNDEFINED_ENTITIES_GROUP:i.getAttributeDisplayValue(s,g,h.get(h.DP.VALUE)),T=p.FILTER_EQUALS_TEMPLATE(this.vtOptions({filterId:m,attribute:S,operator:t.FILTER_OPERATOR_SYMBOLS[v],value:O}))}}return T},_getLabelBubble:function(t,i){return c(this.vtOptions({filterId:i.get(i.idAttribute),attribute:e.getSingularEntityName("label"),operator:"",value:i.get(i.nameAttribute)}))}})}),define("views/pages/ebrowser/filters/EBFilterBarView",["utils/AppUtil","utils/AppConstants","managers/EntityManager","managers/NotificationManager","data/DataProperties","models/ebrowser/favorites/EBFavoriteQueryModel","views/pages/ebrowser/filters/EBFilterBubbles","views/basecomponents/BaseView"],function(e,t,i,n,s,a,r,o){"use strict";var l=_.template('<div class="search-box"><input class="search-input" type="text" placeholder="<%= i18n("searchPlaceHolder") %>"></div>'),c=_.template('<div class="icons-wrapper"><a class="reset-filters"><%= i18n("resetFilters") %></a><div class="favorite-query-icon icon star-icon <%= disabled ? "disabled" : "" %>" ><%= Components.icon("Star", "-icon-star") %><%= Components.icon("Star_Empty", "-icon-star-empty") %></div><div class="favorite-query-icon icon saved-query-arrow-icon"><%= Components.icon("caret-down", "-down-arrow") %></div></div>');return o.extend({name:"EBFilterBarView",MIN_SEARCH_BOX_WIDTH:100,MAX_QUERIES:20,canFilterByEntityName:!0,filterBubbles:null,highlightFavQueryCB:null,events:{"click  .close-btn":"onRemoveFilter","keyup  .search-input":"onSearch","click  .star-icon":"onSaveAsFavorite","click  .reset-filters":"onClearFilters"},initialize:function(e){o.prototype.initialize.apply(this,arguments),e=e||{},this.canFilterByEntityName=e.canFilterByEntityName,this.filterBubbles=new r({model:this.model}),this.highlightFavQueryCB=e.highlightFavQueryCB},render:function(){var e=this.model.getSelectedEntityType(),i=this.model.getQueryModel(e),n=this.model.getCurrentPerspective(e),a=_.filter(this.model.getLabelsCollection().getLabels(e),function(e){return e.isApplied()}),r={};r[t.EB_BUBBLE_TYPES.FILTER_COLOR_BY]=this.model.getColorBy(e),r[t.EB_BUBBLE_TYPES.FILTER_GROUP_BY]=i.get(i.DP.GROUPING_ATTR),r[t.EB_BUBBLE_TYPES.FILTER_MEMBER_SORT_BY]=i.get(i.DP.GROUP_MEMBER_SORT_ATTRIBUTE),r[t.EB_BUBBLE_TYPES.FILTER_FOCUS_BY]=n.get(s.NAME),r[t.EB_BUBBLE_TYPES.FILTER_MODELS]=this.model.getAllFiltersByEntityType(e),r[t.EB_BUBBLE_TYPES.LABEL_MODELS]=a;var o=0,d='<div class="donut-loader-blue query-busy"></div>',u=this.filterBubbles.renderBubbles(e,n,r);_.each(u,function(e){d+=e,o++}),this.canFilterByEntityName&&(d+=l(this.vtOptions({})),o++),d+=c(this.vtOptions({disabled:0===u.length})),o++,this.$el.html(d),o>0?(this.showView(),this.$(".query-busy").hide(),u.length?this.$(".reset-filters").show():this.$(".reset-filters").hide(),this.onResize()):this.hideView()},setCanFilterByEntityName:function(e){this.canFilterByEntityName=e},onLabelChange:function(){this.render()},onRemoveFilter:function(e){var i=$(e.currentTarget).attr("data-id"),n=this.model.getSelectedEntityType();switch(i){case t.EB_BUBBLE_TYPES.FILTER_GROUP_BY:this.model.setQueryGroupby(n,t.GROUP_BY_NONE);break;case t.EB_BUBBLE_TYPES.FILTER_MEMBER_SORT_BY:this.model.setQuerySortBy(n,null);break;case t.EB_BUBBLE_TYPES.FILTER_FOCUS_BY:this.model.setCurrentPerspective(n,t.DEFAULT_PERSPECTIVE);break;case t.EB_BUBBLE_TYPES.FILTER_COLOR_BY:this.model.setColorBy(n,null);break;default:this.model.getLabelsCollection().findModelById(i)?this.model.toggleLabelFilter(n,i):this.model.clearFilter(n,i)}},onClearFilters:function(){var e=this.model.getSelectedEntityType();this.model.clearState(e)},onSaveAsFavorite:function(i){i.stopPropagation();var r=this.model.getSelectedEntityType();if(this.$(".filter-box").length&&!this.model.hasInValidQueryModel(r)){if(this.model.getFavoriteQueries(r).length>=this.MAX_QUERIES)return void n.showClientNotification(t.NOTIFY_ERROR,this.i18n("maxQueries"));var o=new a,l=this.model.getColorBy(r),c=this.model.getQueryModel(r),d=c.get(c.DP.GROUPING_ATTR),u=c.get(c.DP.GROUP_MEMBER_SORT_ATTRIBUTE),h=c.get(c.DP.ENTITY_IDS),p=c.get(c.DP.FILTER_EXPR),T=this.model.getCurrentPerspective(r),E=T.get(s.NAME),g={};g[o.DP.UUID]=e.randomId("ID"),g[o.DP.ENTITY_TYPE]=r,h&&h.length&&(g[o.DP.ENTITY_IDS]=h),p&&(g[o.DP.FILTER_EXPR]=p),d&&d!==t.GROUP_BY_NONE&&(g[o.DP.GROUP_BY_ATTR]=d),u&&u!==T.getDefaultSortingAttribute()&&(g[o.DP.SORT_BY_ATTR]=c.get(c.DP.GROUP_MEMBER_SORT_ATTRIBUTE),g[o.DP.SORT_BY_ORDER]=c.get(c.DP.GROUP_MEMBER_SORT_ORDER)),l&&(g[o.DP.COLOR_BY_ATTR]=this.model.getColorBy(r)),E&&E!==t.DEFAULT_PERSPECTIVE&&(g[o.DP.PERSPECTIVE]=T.getId()||T.getName()),o.set(g);this.findMatchingFavQuery(r,o)?n.showClientNotification(t.NOTIFY_INFO,this.i18n("queryExists")):this.model.newFavoriteQuery(r,o)}},onSearch:function(e){if(e.keyCode===$.ui.keyCode.ENTER){var t=$(e.currentTarget).val().trim();if(t.length){var n=this.model.getSelectedEntityType(),s=i.getEntitySchema(n),a=s.get(s.DP.NAME_ATTR);this.model.createStringSearchFilter(n,a,t)}}},onResize:function(){var e=this.$(".search-box");if(this.canFilterByEntityName){var t,i=e.parent().width(),n=this.$(".filter-box");if(n.length){var s=$(n[n.length-1]);t=i-(s.outerWidth(!0)+s.position().left),t-=this.$(".reset-filters").width()}else t=i;t-=this.$(".star-icon").width(),t-=this.$(".down-arrow-icon").width(),t<this.MIN_SEARCH_BOX_WIDTH&&(t=i),e.width(t-20)}},findMatchingFavQuery:function(e,t){for(var i=null,n=this.model.getFavoriteQueries(e),s=0;s<n.length;s++){var a=n[s];if(a.equals(t)){i=a;break}}return i}})}),define("views/pages/ebrowser/favorites/EBFavoriteQueriesView",["views/basecomponents/BaseView","views/pages/ebrowser/filters/EBFilterBubbles","utils/AppConstants"],function(e,t,i){"use strict"
;var n=_.template('<div class="selector query-list"></div>'),s=_.template('<div class="no-saved-queries"><%= i18n("noSavedQueries") %></div>'),a=_.template('<div class="query-item" data-id="<%= query.getId() %>"><%= queryBubbles %><div class="delete-icon"><%= SVG.SVGIcon("v", "-delete-icon") %></div></div>');return e.extend({events:{"click .delete-icon":"onDeleteQuery","click .query-item":"onItemSelect"},name:"EBFavoriteQueriesView",filterBubbles:null,initialize:function(i){e.prototype.initialize.apply(this,arguments),this.filterBubbles=new t({model:this.model})},render:function(){var e=this.model.getSelectedEntityType();if(e){var t=this.model.getFavoriteQueries(e);if(t.length){var i=n(this.vtOptions({}));this.$el.html(i);var r="";_.each(t,function(e){var t=this._renderQueryBubbles(e);r+=a(this.vtOptions({query:e,queryBubbles:t.join(" ")}))},this),this.$(".query-list").html(r)}else this.$el.html(s(this.vtOptions({})))}},onLabelChange:function(){this.render()},onItemSelect:function(e){var t=$(e.currentTarget).data("id");this.$el.addClass("hidden"),this.model.invokeFavoriteQuery(t)},onDeleteQuery:function(e){e.stopPropagation();var t=this.model.getSelectedEntityType(),i=$(e.currentTarget).parent().data("id"),n=this.i18n("queryDeleteMsg","Remove the selected query ?"),s=this;$.nutanixConfirm({msg:n,yes:function(){s.$el.addClass("hidden"),s.model.deleteFavoriteQuery(t,i)}})},_renderQueryBubbles:function(e){var t=this.model.getSelectedEntityType(),n=this.model.getCurrentPerspective(t),s={};s[i.EB_BUBBLE_TYPES.FILTER_COLOR_BY]=e.get(e.DP.COLOR_BY_ATTR),s[i.EB_BUBBLE_TYPES.FILTER_GROUP_BY]=e.get(e.DP.GROUP_BY_ATTR),s[i.EB_BUBBLE_TYPES.FILTER_MEMBER_SORT_BY]=e.get(e.DP.SORT_BY_ATTR);var a=e.get(e.DP.PERSPECTIVE),r=this.model.findPerspectiveModel(t,a);r&&(s[i.EB_BUBBLE_TYPES.FILTER_FOCUS_BY]=r.getDisplayName());var o=e.get(e.DP.ENTITY_IDS),l=e.get(e.DP.FILTER_EXPR)||{},c=this._createFilterModels(t,o,l);if(s[i.EB_BUBBLE_TYPES.FILTER_MODELS]=c.filterModels,c.labelIds.length){var d=this.model.getLabelsCollection(),u=d.filter(function(e){return _.contains(c.labelIds,e.getId())});s[i.EB_BUBBLE_TYPES.LABEL_MODELS]=u}return this.filterBubbles.renderBubbles(t,n,s)},_createFilterModels:function(e,t,n){var s={filterModels:[],labelIds:[]};if(t&&t.length){var a=this.model.createShowSelectionsFilter(e,t,!0);a.set(a.DP.IS_APPLIED,!0),s.filterModels.push(a)}return _.each(n,function(t,n){for(var a=0;a<t.length;a++){var r=t[a];if(n===i.LABEL_CONDITION_ATTRIBUTE)s.labelIds.push(r.value1);else{var o=this.model.createTemporaryFilterModelFromFilterCondition(e,n,r);o&&(o.set(o.DP.IS_APPLIED,!0),s.filterModels.push(o))}}},this),s}})}),define("views/pages/ebrowser/viz/EBLegendView",["views/basecomponents/BaseView","data/DataProperties","utils/EntityUtil"],function(e,t,i){"use strict";var n=_.template('<div class="colorby-legend"><div class="legend-name"><%= colorBy %></div><% _.each(colorMap, function(colorClass, key) { %><div class="legend-item" data-id="<%= colorClass %>"><div class="css-icon state-icon <%= colorClass %>"></div>&nbsp;<div class="colorby-label"><%= key || "Other" %></div></div><% }) %></div>');return e.extend({currentHighlightedItem:null,events:{"click   .legend-item":"onLegendClick"},initialize:function(t){this.onHighlightCB=t.onHighlightCB,e.prototype.initialize.apply(this,arguments)},render:function(e){var s=this.model.getSelectedEntityType(),a=this.model.getColorBy(s);if(a&&e){var r;a===t.EB.HEALTH_SCORE||a===t.EB.CLUSTER.OVERALL_HEALTH_SCORE?r=e:(r={},_.each(e,function(e,t){var n="null"===t?null:t,o=i.getAttributeDisplayValue(s,a,n,!1);r[o]=e}));var o=n({colorBy:i.getAttributeDisplayName(s,a),colorMap:r});this.$el.html(o),this.showView()}else this.$el.html(""),this.hideView()},onStartServices:function(){this.model.on(this.model.CHANGE_EVENTS.COLOR_BY,this.render,this)},onStopServices:function(){this.model.off(this.model.CHANGE_EVENTS.COLOR_BY,this.render,this)},onLegendClick:function(e){var t=$(e.currentTarget).attr("data-id"),i=this.currentHighlightedItem===t;this.currentHighlightedItem&&(this.onHighlightCB(this.currentHighlightedItem,!1),this.currentHighlightedItem=null),i||(this.currentHighlightedItem=t,this.onHighlightCB(this.currentHighlightedItem,!0))}})}),define("views/pages/ebrowser/EBActionsViewFilterProvider",["managers/AccessManager","utils/AppConstants"],function(e,t){"use strict";var i={VM:{POWER_ON:[".entityActionLink:[data-id=power_on]"],POWER_OFF:[".entityActionLink:[data-id=power_off]"],RESET:[".entityActionLink:[data-id=reset]"],POWER:[".entityActionLink:[data-id=power_on]",".entityActionLink:[data-id=power_off]",".entityActionLink:[data-id=reset]"],ACTION_BTNS:[".actions-dropdown",".entityActionLink"],UPDATE:[".entityActionLink[data-id=edit]"],DELETE:[".entityActionLink[data-id=delete]"],PAUSE:[".entityActionLink[data-id=pause]"],RESUME:[".entityActionLink[data-id=resume]"],NOT_CONSOLE:['.entityActionLink:not("[data-id=launch_console]")'],CONSOLE:[".entityActionLink:[data-id=launch_console]"],CLONE:[".entityActionLink[data-id=clone]"],SNAPSHOT:[".entityActionLink[data-id=snapshot]"],MIGRATE:[".entityActionLink[data-id=migrate]"],AFFINITY:[".entityActionLink[data-id=affinity]"],ENABLE_NGT:[".entityActionLink:[data-id=enable_ngt]"],DISABLE_NGT:[".entityActionLink:[data-id=disable_ngt]"],INSTALL_NGT:[".entityActionLink:[data-id=install_ngt]"],UPGRADE_NGT:[".entityActionLink:[data-id=upgrade_ngt]"],MANAGE_NGT:[".entityActionLink:[data-id=manage_apps]"],QUARANTINE:[".entityActionLink:[data-id=quarantine]"],UNQUARANTINE:[".entityActionLink:[data-id=unquarantine]"],MANAGE_CATEGORIES:[".entityActionLink:[data-id=manage_categories]"]},CLUSTER:{LAUNCH_PE:[".entityActionLink:[data-id=navigate_to_pe]"],UNREGISTER:['.entityActionLink::[data-id="unregister_cluster"]'],UPGRADE:['.entityActionLink:[data-id="update_cluster"]']}};return{NON_ADMIN_FILTER:{targets:{selectors:[".action-btn",".actions-dropdown"]},conditions:{groups:[{type:"canUserModify",data:[!1],operator:t.FILTER_OPERATORS.EQUALS,reasonCode:"common.accessDenied",reason:e.ACCESS_DENIED_MSG}]}},NO_CLUSTERS_FILTER:{targets:{selectors:[".action-btn",".actions-dropdown"]},conditions:{groups:[{type:"hasACluster",data:[!1],operator:t.FILTER_OPERATORS.EQUALS,reasonCode:"common.noClustersRegistered",reason:"Clusters have not yet been registered with Prism Central"}]}},MODIFY_ACTION_FILTER:{targets:{selectors:[".modify-action"]},conditions:{groups:[{type:"canUserModify",data:[!1],operator:t.FILTER_OPERATORS.EQUALS,reasonCode:"common.accessDenied",reason:e.ACCESS_DENIED_MSG}]}},getFilter:function(e,n){switch(n=n||i,e){case t.ENTITY_CLUSTER:return[this.NON_ADMIN_FILTER,this.NO_CLUSTERS_FILTER,{targets:{selectors:[n.CLUSTER.LAUNCH_PE]},conditions:{groups:[{type:"entityCount",data:[1],operator:t.FILTER_OPERATORS.LESS_THAN,reasonCode:"common.singleEntityAction",reason:"This action is not supported on more than one entity concurrently"},{type:"isClusterAvailable",data:[!1],operator:t.FILTER_OPERATORS.EQUALS,reasonCode:"common.unreachableCluster",reason:"This action is not supported on unreachable cluster."},{type:"isIframeSupported",data:[!1],operator:t.FILTER_OPERATORS.EQUALS,reason:"This action is only supported on cluster version 4.5.2 or later."}]}},{targets:{style:t.VIEW_FILTER.STYLE_CLASS.HIDE,selectors:[n.CLUSTER.UNREGISTER]},conditions:{groups:[{type:"entityCount",data:[1],operator:t.FILTER_OPERATORS.LESS_THAN},{type:"isClusterAvailable",data:[!0],operator:t.FILTER_OPERATORS.EQUALS}]}},{targets:{selectors:[n.CLUSTER.UPGRADE]},conditions:{groups:[{type:"isPrismProFeaturesEnabled",operator:t.FILTER_OPERATORS.NOT_EQUALS,reasonCode:"common.prismProFeatureDisabled",reason:"Prism Pro feature has been manually disabled in licensing configuration.",data:[!0]},{type:"isMultiClusterUpgradeSupported",data:[!1],operator:t.FILTER_OPERATORS.EQUALS,reasonCode:"common.unsupportedMultiClusterUpgrade",reason:"This action is only supported on reachable AOS 5.1 or later clusters with no pending upgrades and consisting of nodes running the same processor family."}]}}];case t.ENTITY_HOST:case t.ENTITY_CONTAINER:case t.ENTITY_DISK:case t.ENTITY_STORAGE_POOL:return[this.NON_ADMIN_FILTER,this.NO_CLUSTERS_FILTER,{targets:{selectors:["#actionsDropdown",".entityActionLink"]},conditions:{groups:[{type:"entityCount",data:[1],operator:t.FILTER_OPERATORS.LESS_THAN,reasonCode:"common.singleEntityAction",reason:"This action is not supported on more than one entity concurrently"}]}}];case t.ENTITY_VM:return[this.NON_ADMIN_FILTER,this.NO_CLUSTERS_FILTER,{targets:{selectors:n.VM.NOT_CONSOLE},conditions:{logic:t.VIEW_FILTER.LOGICS.EVERY,groups:[{type:"entityCount",data:[1],operator:t.FILTER_OPERATORS.EQUALS},{type:"cvms",data:["1"],reasonCode:"vm.nonCVM2",reason:"Action is not allowed because one or more of the selected VM(s) is an Acropolis controller VM",operator:t.FILTER_OPERATORS.IN}]}},{targets:{selectors:n.VM.CONSOLE},conditions:{logic:t.VIEW_FILTER.LOGICS.EVERY,groups:[{type:"entityCount",data:[1],operator:t.FILTER_OPERATORS.EQUALS},{type:"cvms",data:["1"],operator:t.FILTER_OPERATORS.IN},{logic:t.VIEW_FILTER.LOGICS.EVERY,type:"hypervisorTypes",data:[t.HYPERVISOR_TYPE.KVM,t.HYPERVISOR_TYPE.ESXI],reasonCode:"vm.nonAhvOrEsx2",reason:"Action is not allowed because one or more of the selected VM(s) are not hosted on an Acropolis hypervisor or ESXi",operator:t.FILTER_OPERATORS.NOT_IN}]}},{targets:{style:t.VIEW_FILTER.STYLE_CLASS.GRAY_OUT,selectors:n.VM.ACTION_BTNS},conditions:{groups:[{logic:t.VIEW_FILTER.LOGICS.EVERY,type:"isClusterReachable",data:[!0],operator:t.FILTER_OPERATORS.NOT_IN,reasonCode:"common.unreachableCluster"}]}},{targets:{selectors:n.VM.CONSOLE},conditions:{logic:t.VIEW_FILTER.LOGICS.EVERY,groups:[{type:"entityCount",data:[1],operator:t.FILTER_OPERATORS.EQUALS},{type:"powerStates",data:[t.VM_POWER_STATE.OFF,t.VM_POWER_STATE.SUSPENDED],reasonCode:"vm.currentlyOff",reason:"Selected vm is currently powered off",operator:t.FILTER_OPERATORS.IN}]}},{targets:{selectors:[n.VM.MIGRATE,n.VM.AFFINITY]},conditions:{logic:t.VIEW_FILTER.LOGICS.EVERY,groups:[{type:"entityCount",data:[1],operator:t.FILTER_OPERATORS.EQUALS},{logic:t.VIEW_FILTER.LOGICS.EVERY,type:"hypervisorTypes",data:[t.HYPERVISOR_TYPE.ESXI],reasonCode:"vm.nonAcropolis2",reason:"Action is not allowed because one or more of the selected VM(s) are not hosted on an Acropolis hypervisor",operator:t.FILTER_OPERATORS.IN}]}},{targets:{selectors:n.VM.NOT_CONSOLE},conditions:{logic:t.VIEW_FILTER.LOGICS.EVERY,groups:[{type:"entityCount",data:[1],operator:t.FILTER_OPERATORS.EQUALS},{type:"cvms",data:["0"],operator:t.FILTER_OPERATORS.IN},{type:"fanoutSupports",data:[!1],reasonCode:"vm.fourSixPlus2",reason:"Actions are not allowed because one or more of the selected VM(s) are hosted on an Acropolis cluster that is not version 4.6 or later.",operator:t.FILTER_OPERATORS.IN}]}},{targets:{selectors:n.VM.CONSOLE},conditions:{logic:t.VIEW_FILTER.LOGICS.EVERY,groups:[{type:"entityCount",data:[1],operator:t.FILTER_OPERATORS.EQUALS},{type:"pcConsoleSupports",data:[!1],reasonCode:"vm.fiveFivePlus",operator:t.FILTER_OPERATORS.IN}]}},{targets:{selectors:n.VM.AFFINITY},conditions:{logic:t.VIEW_FILTER.LOGICS.EVERY,groups:[{type:"entityCount",data:[1],operator:t.FILTER_OPERATORS.EQUALS},{type:"vmHostAffinitySupports",data:[!1],reasonCode:"vm.preAsterix",reason:"Action is not allowed because one or more of the selected VM(s) are hosted on a cluster version that is older than 5.0",operator:t.FILTER_OPERATORS.IN}]}},{targets:{selectors:n.VM.ACTION_BTNS},conditions:{logic:t.VIEW_FILTER.LOGICS.EVERY,groups:[{type:"entityCount",data:[1],operator:t.FILTER_OPERATORS.EQUALS},{logic:t.VIEW_FILTER.LOGICS.EVERY,type:"hypervisorTypes",data:[t.HYPERVISOR_TYPE.ESXI],operator:t.FILTER_OPERATORS.IN},{type:"vmMgmtSupports",data:[!1],reasonCode:"vm.preAsterix",reason:"Action is not allowed because one or more of the selected VM(s) are hosted on a cluster version that is older than Asterix",operator:t.FILTER_OPERATORS.IN}]}},{targets:{selectors:[n.VM.CLONE,n.VM.PAUSE,n.VM.RESUME,n.VM.UPDATE,n.VM.UPDATE]},conditions:{logic:t.VIEW_FILTER.LOGICS.EVERY,groups:[{type:"entityCount",data:[1],operator:t.FILTER_OPERATORS.EQUALS},{logic:t.VIEW_FILTER.LOGICS.EVERY,type:"hypervisorTypes",data:[t.HYPERVISOR_TYPE.ESXI],operator:t.FILTER_OPERATORS.IN},{type:"managementServerSupports",data:[!1],reasonCode:"vm.noMgmtServerVcenter",reason:"Action is not allowed because the selected VM is not registered to a management server",operator:t.FILTER_OPERATORS.IN}]}},{targets:{selectors:n.VM.ACTION_BTNS},conditions:{logic:t.VIEW_FILTER.LOGICS.EVERY,groups:[{type:"entityCount",data:[1],operator:t.FILTER_OPERATORS.EQUALS},{type:"cvms",data:["0"],operator:t.FILTER_OPERATORS.IN},{logic:t.VIEW_FILTER.LOGICS.EVERY,type:"hypervisorTypes",data:[t.HYPERVISOR_TYPE.KVM,t.HYPERVISOR_TYPE.ESXI],reasonCode:"vm.nonAhvOrEsx2",reason:"Actions are not allowed because one or more of the selected VM(s) are not hosted on an Acropolis hypervisor or ESXi",operator:t.FILTER_OPERATORS.NOT_IN}]}},{targets:{style:t.VIEW_FILTER.STYLE_CLASS.HIDE,selectors:n.VM.POWER_OFF},conditions:{logic:t.VIEW_FILTER.LOGICS.EVERY,groups:[{type:"entityCount",data:[1],operator:t.FILTER_OPERATORS.EQUALS},{type:"powerStates",data:["off"],reasonCode:"vm.alreadyOff",reason:"Selected vm is already powered off",operator:t.FILTER_OPERATORS.IN}]}},{targets:{style:t.VIEW_FILTER.STYLE_CLASS.GRAY_OUT,selectors:[n.VM.ENABLE_NGT,n.VM.INSTALL_NGT]},conditions:{logic:t.VIEW_FILTER.LOGICS.EVERY,groups:[{type:"entityCount",data:[1],operator:t.FILTER_OPERATORS.EQUALS},{type:"NGTInstalled",data:[null],reasonCode:"vm.alreadyInstalled",reason:"VM might be on unsupported PE or already have NGT",operator:t.FILTER_OPERATORS.NOT_IN}]}},{targets:{style:t.VIEW_FILTER.STYLE_CLASS.HIDE,selectors:n.VM.DISABLE_NGT},conditions:{logic:t.VIEW_FILTER.LOGICS.EVERY,groups:[{type:"entityCount",data:[1],operator:t.FILTER_OPERATORS.EQUALS},{type:"NGTState",data:["0"],reasonCode:"vm.alreadyDisabled",reason:"Selected VM is already NGT disabled",operator:t.FILTER_OPERATORS.IN}]}},{targets:{style:t.VIEW_FILTER.STYLE_CLASS.HIDE,selectors:[n.VM.PAUSE,n.VM.RESUME]},conditions:{groups:[{logic:t.VIEW_FILTER.LOGICS.SOME,type:"hypervisorTypes",data:[t.HYPERVISOR_TYPE.AHV],reasonCode:"vm.hasAHV",reason:"Action is not allowed because the selected VM(s) are hosted on AHV.",operator:t.FILTER_OPERATORS.IN}]}},{targets:{style:t.VIEW_FILTER.STYLE_CLASS.GRAY_OUT,selectors:[n.VM.PAUSE,n.VM.RESUME,n.VM.MIGRATE,n.VM.INSTALL_NGT,n.VM.UPGRADE_NGT,n.VM.MANAGE_NGT]},conditions:{logic:t.VIEW_FILTER.LOGICS.EVERY,groups:[{type:"entityCount",data:[1],operator:t.FILTER_OPERATORS.EQUALS},{type:"powerStates",data:["off"],reasonCode:"vm.currentlyOff",reason:"Selected vm is currently powered off",operator:t.FILTER_OPERATORS.IN}]}},{targets:{style:t.VIEW_FILTER.STYLE_CLASS.HIDE,selectors:n.VM.POWER_ON},conditions:{logic:t.VIEW_FILTER.LOGICS.EVERY,groups:[{type:"entityCount",data:[1],operator:t.FILTER_OPERATORS.EQUALS},{type:"powerStates",data:["on"],reasonCode:"vm.alreadyOn",reason:"Selected vm is already powered on",operator:t.FILTER_OPERATORS.IN}]}},{targets:{selectors:[n.VM.MIGRATE]},conditions:{logic:t.VIEW_FILTER.LOGICS.EVERY,groups:[{type:"entityCount",data:[1],operator:t.FILTER_OPERATORS.EQUALS},{type:"vmLiveMigrateSupports",data:["0"],reasonCode:"vm.noLiveMigrate",reason:"The selected VM cannot be live migrated",operator:t.FILTER_OPERATORS.IN}]}},{targets:{selectors:[n.VM.PAUSE,n.VM.RESUME]},conditions:{logic:t.VIEW_FILTER.LOGICS.EVERY,groups:[{type:"entityCount",data:[1],operator:t.FILTER_OPERATORS.EQUALS},{type:"powerStates",data:["on"],operator:t.FILTER_OPERATORS.IN},{type:"gpusInUse",data:[!0],reasonCode:"vm.noPauseResume",reason:"The selected VM cannot be paused/resumed",operator:t.FILTER_OPERATORS.IN}]}},{targets:{style:t.VIEW_FILTER.STYLE_CLASS.GRAY_OUT,selectors:n.VM.RESUME},conditions:{logic:t.VIEW_FILTER.LOGICS.EVERY,groups:[{type:"entityCount",data:[1],operator:t.FILTER_OPERATORS.EQUALS},{type:"powerStates",data:["on"],reasonCode:"vm.alreadyOn",reason:"VM is already powered on.",operator:t.FILTER_OPERATORS.IN}]}},{targets:{style:t.VIEW_FILTER.STYLE_CLASS.GRAY_OUT,selectors:[n.VM.PAUSE,n.VM.POWER_ON]},conditions:{logic:t.VIEW_FILTER.LOGICS.EVERY,groups:[{type:"entityCount",data:[1],operator:t.FILTER_OPERATORS.EQUALS},{type:"powerStates",data:["suspended"],reasonCode:"vm.alreadyOnOrSuspended",reason:"VM is already suspended.",operator:t.FILTER_OPERATORS.IN}]}},{targets:{style:t.VIEW_FILTER.STYLE_CLASS.GRAY_OUT,selectors:[n.VM.CLONE,n.VM.CONSOLE,n.VM.SNAPSHOT,n.VM.MIGRATE,n.VM.UPDATE,n.VM.AFFINITY]},conditions:{groups:[{type:"entityCount",data:[1],reasonCode:"singleEntityAction",reason:"This action is not supported on more than one VM concurrently",operator:t.FILTER_OPERATORS.LESS_THAN}]}},{targets:{style:t.VIEW_FILTER.STYLE_CLASS.GRAY_OUT,selectors:n.VM.DELETE},conditions:{logic:t.VIEW_FILTER.LOGICS.EVERY,groups:[{type:"entityCount",data:[1],operator:t.FILTER_OPERATORS.LESS_THAN},{logic:t.VIEW_FILTER.LOGICS.EVERY,type:"hypervisorTypes",data:[t.HYPERVISOR_TYPE.ESXI],operator:t.FILTER_OPERATORS.IN},{type:"managementServerSupports",data:[!1],reasonCode:"vm.noMgmtServerVcenter",reason:"Action is not allowed because one or more of the selected VM(s) are not hosted on a cluster that is not registered with vCenter",operator:t.FILTER_OPERATORS.IN}]}},{targets:{style:t.VIEW_FILTER.STYLE_CLASS.GRAY_OUT,selectors:n.VM.ACTION_BTNS},conditions:{logic:t.VIEW_FILTER.LOGICS.EVERY,groups:[{type:"entityCount",data:[1],operator:t.FILTER_OPERATORS.LESS_THAN},{type:"cvms",data:["1"],reasonCode:"vm.nonCVM2",reason:"Actions are not allowed because one or more of the selected VM(s) is an Acropolis controller VM",operator:t.FILTER_OPERATORS.IN}]}},{targets:{style:t.VIEW_FILTER.STYLE_CLASS.GRAY_OUT,selectors:n.VM.ACTION_BTNS},conditions:{logic:t.VIEW_FILTER.LOGICS.EVERY,groups:[{type:"entityCount",data:[1],operator:t.FILTER_OPERATORS.LESS_THAN},{logic:t.VIEW_FILTER.LOGICS.SOME,type:"hypervisorTypes",data:[t.HYPERVISOR_TYPE.HYPERV],reasonCode:"vm.nonAhvOrEsx2",reason:"Actions are not allowed because one or more of the selected VM(s) are not hosted on an Acropolis hypervisor",operator:t.FILTER_OPERATORS.IN}]}},{targets:{style:t.VIEW_FILTER.STYLE_CLASS.HIDE,selectors:[n.VM.RESUME,n.VM.POWER_ON]},conditions:{logic:t.VIEW_FILTER.LOGICS.EVERY,groups:[{type:"entityCount",data:[1],operator:t.FILTER_OPERATORS.LESS_THAN},{logic:t.VIEW_FILTER.LOGICS.SOME,type:"powerStates",data:["on"],operator:t.FILTER_OPERATORS.IN}]}},{targets:{style:t.VIEW_FILTER.STYLE_CLASS.HIDE,selectors:[n.VM.RESUME,n.VM.POWER_OFF,n.VM.PAUSE]},conditions:{logic:t.VIEW_FILTER.LOGICS.EVERY,groups:[{type:"entityCount",data:[1],operator:t.FILTER_OPERATORS.LESS_THAN},{logic:t.VIEW_FILTER.LOGICS.SOME,type:"powerStates",data:["off"],operator:t.FILTER_OPERATORS.IN}]}},{targets:{style:t.VIEW_FILTER.STYLE_CLASS.HIDE,selectors:[n.VM.POWER_ON,n.VM.POWER_OFF,n.VM.PAUSE]},conditions:{logic:t.VIEW_FILTER.LOGICS.EVERY,groups:[{type:"entityCount",data:[1],operator:t.FILTER_OPERATORS.LESS_THAN},{logic:t.VIEW_FILTER.LOGICS.SOME,type:"powerStates",data:["suspended"],operator:t.FILTER_OPERATORS.IN}]}},{targets:{style:t.VIEW_FILTER.STYLE_CLASS.GRAY_OUT,selectors:[n.VM.MIGRATE]},conditions:{logic:t.VIEW_FILTER.LOGICS.EVERY,groups:[{type:"entityCount",data:[1],operator:t.FILTER_OPERATORS.LESS_THAN},{logic:t.VIEW_FILTER.LOGICS.EVERY,type:"hypervisorTypes",data:[t.HYPERVISOR_TYPE.ESXI],reasonCode:"vm.nonAcropolis2",reason:"Action is not allowed because one or more of the selected VM(s) are not hosted on an Acropolis hypervisor",operator:t.FILTER_OPERATORS.IN}]}},{targets:{style:t.VIEW_FILTER.STYLE_CLASS.GRAY_OUT,selectors:n.VM.ACTION_BTNS},conditions:{logic:t.VIEW_FILTER.LOGICS.EVERY,groups:[{type:"entityCount",data:[1],operator:t.FILTER_OPERATORS.LESS_THAN},{type:"fanoutSupports",data:[!1],reasonCode:"vm.nonAcropolisFourSix",reason:"Actions are not allowed because one or more of the selected VM(s) are hosted on an Acropolis cluster that is not version 4.6 or later.",operator:t.FILTER_OPERATORS.IN}]}},{targets:{style:t.VIEW_FILTER.STYLE_CLASS.GRAY_OUT,selectors:n.VM.ACTION_BTNS},conditions:{logic:t.VIEW_FILTER.LOGICS.EVERY,groups:[{type:"entityCount",data:[1],operator:t.FILTER_OPERATORS.LESS_THAN},{logic:t.VIEW_FILTER.LOGICS.EVERY,type:"hypervisorTypes",data:[t.HYPERVISOR_TYPE.ESXI],operator:t.FILTER_OPERATORS.IN},{type:"vmMgmtSupports",data:[!1],reasonCode:"vm.preAsterix",reason:"Action is not allowed because one or more of the selected VM(s) are hosted on a cluster version that is older than Asterix",operator:t.FILTER_OPERATORS.IN}]}},{targets:{selectors:[n.VM.PAUSE,n.VM.RESUME]},conditions:{logic:t.VIEW_FILTER.LOGICS.EVERY,groups:[{type:"entityCount",data:[1],operator:t.FILTER_OPERATORS.LESS_THAN},{type:"powerStates",data:["on"],operator:t.FILTER_OPERATORS.IN},{type:"gpusInUse",data:[!0],reasonCode:"vm.noPauseResume",reason:"The selected VM cannot be paused/resumed",operator:t.FILTER_OPERATORS.IN}]}},{targets:{style:t.VIEW_FILTER.STYLE_CLASS.GRAY_OUT,selectors:[n.VM.QUARANTINE]},conditions:{logic:t.VIEW_FILTER.LOGICS.EVERY,groups:[{type:"isSomeVMQuarantined",data:[!0],reasonCode:"vm.alreadyQuarantined",reason:"VM is already quarantined.",operator:t.FILTER_OPERATORS.EQUALS}]}},{targets:{style:t.VIEW_FILTER.STYLE_CLASS.GRAY_OUT,selectors:[n.VM.UNQUARANTINE]},conditions:{logic:t.VIEW_FILTER.LOGICS.EVERY,groups:[{type:"isSomeVMUnQuarantined",data:[!0],reasonCode:"vm.notQuarantinedYet",reason:"VM is not quarantined yet.",operator:t.FILTER_OPERATORS.EQUALS}]}}];case t.ENTITY_REPORT_CONFIG:return[{targets:{style:t.VIEW_FILTER.STYLE_CLASS.GRAY_OUT,selectors:[".entityActionLink:[data-id=edit]",".entityActionLink:[data-id=delete]"]},conditions:{logic:t.VIEW_FILTER.LOGICS.EVERY,groups:[{type:"entityCount",data:[1],operator:t.FILTER_OPERATORS.EQUALS},{type:"predefined",data:["true"],reasonCode:"report_config.predefined",operator:t.FILTER_OPERATORS.IN}]}},{targets:{style:t.VIEW_FILTER.STYLE_CLASS.GRAY_OUT,selectors:[".entityActionLink:not([data-id=delete])"]},conditions:{logic:t.VIEW_FILTER.LOGICS.EVERY,groups:[{type:"entityCount",data:[1],reasonCode:"report_config.multiple",operator:t.FILTER_OPERATORS.LESS_THAN}]}}];default:return[this.MODIFY_ACTION_FILTER]}},getSomeFilters:function(e,t,i){return _.filter(this.getFilter(e,t),function(e){return _.every(e.conditions.groups,function(e){return i(e)})})}}}),define("views/pages/ebrowser/util/EBViewFiltersMixin",["bluebird","utils/AppUtil","utils/AppConstants","data/DataProperties","utils/HypervisorUtil","utils/ManagerMixin"],function(e,t,i,n,s,a){"use strict";return _.extend({},a,{getViewFeaturesForActions:function(e,t,i,n){var s=this,a={};return n&&t?(_.each(t.models,function(t){s.getActionFilter(e,t)&&(a["custom_action_"+t.getActionId()]=s.isActionSupported(e,t,i,n))}),a):a},getFanoutSupports:function(e,t){var i=[];return _.each(t,function(t){var s=t.get(n.EB.CLUSTER_UUID),a=this.getClusterManager().getClusterModelByClusterUuid(s);a&&i.push(a.isEntityActionSupportFanout(null,e))},this),i},getConsoleSupports:function(e){var t=[];return _.each(e,function(e){var i=e.get(n.EB.CLUSTER_UUID),s=this.getClusterManager().getClusterModelByClusterUuid(i);s&&!s.hasPCConsoleFeature()?t.push(!1):t.push(!0)},this),t},getVmHypervisorTypes:function(e){var t=[];return _.each(e,function(e){var i=this.getVmHypervisorTypePerVM(e);t.push(i)},this),t},getVmHypervisorTypePerVM:function(e){var t=e.get(n.EB.VM.HYPERVISOR_TYPE);return"1"===e.get(n.EB.VM.IS_ACROPOLIS_VM)&&(t=i.HYPERVISOR_TYPE.KVM),t},getVmMgmtSupports:function(e){var t=[];return _.each(e,function(e){var i=e.get(n.EB.CLUSTER_UUID),a=this.getClusterManager().getClusterModelByClusterUuid(i);i&&a&&t.push(s.hasKVMOnly(i)||a.isAmfOverEsxBasicSupported())},this),t},getVmLiveMigrateSupports:function(e){var t=[];return _.each(e,function(e){t.push(e.get(n.EB.VM.IS_LIVE_MIGRATABLE))},this),t},getVmGPUsInUse:function(e){var t=[];return _.each(e,function(e){var i=parseInt(e.get(n.EB.VM.GPUS_IN_USE),10);t.push("number"==typeof i&&i>0)},this),t},getManagementServerSupports:function(e){var t=[];return _.each(e,function(e){var i=e.get(n.EB.CLUSTER_UUID),s=this.getClusterManager().getClusterModelByClusterUuid(i);s&&t.push(s.isManagementServerRegistered())},this),t},getVmHostAffinitySupports:function(e){var t=[];return _.each(e,function(e){var s=e.get(n.EB.CLUSTER_UUID),a=this.getClusterManager().getClusterModelByClusterUuid(s);a&&t.push(a.isFFEnabled(i.FFLAGS.VM_HOST_AFFINITY))},this),t},isClusterReachable:function(e){var t=this,i=[];return _.each(e,function(e){var s=e.get(n.EB.CLUSTER_UUID),a=t.getClusterManager().getClusterModelByClusterUuid(s);a&&i.push(a.isAvailable())}),i},isMultiClusterUpgradeSupported:function(e){if(!e||_.size(e)<1)return!1;var s=this.getClusterManager();if(e&&e.length>1){if(_.uniq(_.map(e,function(e){var t=s.getClusterModelById(e.getId());return t&&t.getClusterArch()})).length>1)return!1}return!_.some(e,function(e){if(s.isClusterAvailable(e.getId())&&e.get(n.EB.CLUSTER.VERSION)&&t.compareVersions(e.get(n.EB.CLUSTER.VERSION),i.CLUSTER_CONFIG_API_VERSION,2)>=0){var a=e.get(n.EB.CLUSTER.CLUSTER_UPGRAD_STATUS);if(!a)return!1;switch(a){case i.CLUSTER_UPGRADE_STATUS.SUCCEEDED:case i.CLUSTER_UPGRADE_STATUS.FAILED:case i.CLUSTER_UPGRADE_STATUS.CANCELLED:return!1;default:return!0}}return!0},this)},isPreObelix:function(e){return this._isPreVersion(e,i.PC_OBELIX_VERSION)},isPreObelix1:function(e){return this._isPreVersion(e,i.PC_OBELIX_1_VERSION)},containsPCVM:function(e){return _.some(e,function(e){var t=e.get(n.EB.VM.ANNOTATION),s=e.get(n.EB.VM.VM_TYPE);return t===i.NUTANIX_PRISM_CENTRAL||s===i.VM_TYPES.PCVM})},_isPreVersion:function(e,i){var s=this;return _.some(e,function(e){var a=e.get(n.EB.CLUSTER_UUID),r=s.getClusterManager().getClusterModelByClusterUuid(a),o=r?r.getNosVersion():"0.0";return-1===t.compareVersions(o,i)})},isActionSupported:function(e,t,i,n){var s=this.getEntityUICustomizationManager();return s&&s.isActionSupported(e,t,i,n)},getActionFilter:function(e,t){if(t.getActionFilter()){var i=this.getEntityUICustomizationManager();return i&&i.getActionFilter(e,t)}},loadActionHelperEntities:function(t,i){var n=this.getEntityUICustomizationManager();return n?n.loadActionHelperEntities(t,i):e.resolve()}})}),define("views/pages/ebrowser/EBActionsView",["views/basecomponents/BaseView","views/pages/ebrowser/EBActionsViewFilterProvider","managers/ActionManager","managers/ClusterManager","managers/LicenseManager","views/pages/ebrowser/util/EBViewFiltersMixin","utils/EntityUtil","utils/AppConstants","data/DataProperties","utils/AppUtil","utils/AntiscrollUtil"],function(e,t,i,n,s,a,r,o,l,c,d){"use strict";var u=_.template('<button class="create-actions btn -action action-btn actionButton hasTip<%= enabled ? "" : " gray-out" %>" type="button" data-id="<%= actionId %>"><%= icon ? SVG.SVGIcon(icon, "-small") : "" %><span><%= localizedTitle %></span></button>'),h=_.template('<div class="collapsed-actions-dropdown -not-selectable btn-group"><button class="btn -action -default dropdown-btn dropdown-toggle"type="button" id="createActionsDropdown" data-toggle="dropdown"aria-expanded="true"><%= groupName || "" %>&nbsp;<%= SVG.SVGIcon("z", "-down-arrow") %></button><ul class="dropdown-menu"><% _.each(actions, function(action) { %><% if ( ! action.actionId ) { %><li class="separator"></li><% } else { %><li><a  class="action-btn create-actions"  <%= getQaDataTestId(action.actionId) %>  data-id="<%= action.actionId %>"> <%= (!groupName && action.icon) ? SVG.SVGIcon(action.icon, "-text -perceptual-equality") : "" %><%= action.localizedTitle %></a></li><% } %><% }) %></ul></div>'),p=_.template('<div class="btn-group btnBar"><% _.each(actions, function(action) { %><button class="create-actions btn action-btn actionButton hasTip <%= action.btnClass || ""%>" type="button" data-id="<%= action.actionId %>" title="<%= action.localizedTitle %>"><%= action.icon ? SVG.SVGIcon(action.icon, "-small") : "" %><span><%= action.localizedTitle %></span></button><% }) %></div>'),T=_.template('<div class="entity-actions<%= disabled ? " gray-out" : "" %>"> <div class="actions-dropdown -not-selectable btn-group"> <button class="btn -default dropdown-btn dropdown-toggle" type="button" id="actionsDropdown" data-toggle="dropdown" aria-expanded="true"               data-test="ebactionsview_button_actionsdropdown"> <span><%= actionName %></span> <%= SVG.SVGIcon("z", "-down-arrow") %> </button> <div class="overflow-dropdown-menu dropdown-menu"> <div class="antiscroll-wrap"> <div class="box-wrap"> <div class="antiscroll-inner"> <div class="box-inner"> <ul class="overflow-menu"> <% _.each(actionGroups, function(actions, group) { %> <li class="separator" data-test="ebactionsview_li_action_separator"> <hr></li> <% _.each(actions, function(action) { %> <li data-test="ebactionsview_li_action_nav_item"> <a class="entityActionLink <%= action.enabled ? "" : "disabled-link gray-out" %>" <%= getQaDataTestId(action.actionId) %> data-id="<%= action.actionId %>" data-test="ebactionsview_a_action_nav_link"> <%= action.localizedTitle %> </a></li> <% }) %> <% }) %> </ul> </div> </div> </div> </div> </div> </div> </div> '),E=function(e){return!_.contains([o.ENTITY_PROJECT,o.ENTITY_CATEGORY,o.ENTITY_VM_RECOVERY_POINT,o.ENTITY_AVAILABILITY_ZONE,o.SSP_MAPPING_ENTITY_TO_EB[o.ENTITY_FLOATING_IP],o.ENTITY_NETWORK_SECURITY_RULE],e)};return e.extend(_.extend({},a,{name:"EBActionsView",model:null,helperModels:null,events:{'click .entityActionLink:not(".gray-out")':"onEntityAction",'click .action-btn:not(".gray-out")':"onEntityAction"},initialize:function(){e.prototype.initialize.apply(this,arguments),this.model.on(this.model.CHANGE_EVENTS.QUERY_RESULTS,this.onDataChange,this)},render:function(){var e=this,t=this.model.getSelectedEntityType();if(t&&!this.$(".actions-dropdown").hasClass("open")){var n=i.getActions(t);this.loadActionHelperEntities(t,n).then(function(i){e.helperModels=i,e._render(t,n)})}},_render:function(e,t){var i=this,n=this._getTargetEntityIds(),s=this,a=$(),l="";if(t){var c=_.map(t.getCreateEntityActions(),function(t){return s._actionOptions(e,t)});this._clearTooltips();var E=_.groupBy(c,function(e){return e.icon},this),g=function(e){var t=$(u(e));s._addTooltip(t,e.title,300,"actionTitle"),a=a.add(t)};for(var S in E){var m=E[S];if(m.length>1){var v=m[0].group,f=$(h(this.vtOptions({icon:S,groupName:v?r.getEntityActionGroupTitle(e,v):"",actions:m})));a=a.add(f)}else _.each(m,g,this)}if(n.length){var A=t.getModifyEntityActions();if(A.length){var y=n.length>1,C=[],I=[];if(_.each(A,function(t){y?t.set(t.DP.ENABLED,t.get(t.DP.BULK_ACTION)):t.set(t.DP.ENABLED,!0),t.get(t.DP.RENDER_TYPE)===t.RENDER_TYPES.BUTTON?C.push(this._actionOptions(e,t)):I.push(this._actionOptions(e,t))},this),I.length){var b={};_.each(I,function(e){var t=e.groupId||"actions",i=e.group;b[t]?b[t][i]?b[t][i].push(e):b[t][i]=[e]:b[t]=_defineProperty({},i,[e])}),_.each(b,function(e,t){l+=T(i.vtOptions({actionName:i.i18n("action_btn."+t),actionGroups:e,disabled:_.isEmpty(I.filter(function(e){return e.enabled}))}))})}C.length&&(l+=p(this.vtOptions({actions:C})))}}}s.$el.html(l).append(a),this.renderViewFilter(t),d.applyAntiScroll(this.$(".overflow-dropdown-menu .antiscroll-wrap"));var R=!1,N=o.VIEW_FILTER.STYLE_CLASS.FILTER_HIDDEN,P=0;_.each(this.$(".actions-dropdown li"),function(e){var t=$(e);if(t.hasClass("separator"))R&&t.hide(),R=!0;else{var i=t.find("a");i.length&&!i.hasClass(N)&&(R=!1,P++)}});var w=o.VIEW_FILTER.STYLE_CLASS.GRAY_OUT;0!==P||this.$(".dropdown-btn").hasClass(w)||this.$(".entity-actions").addClass("hidden")},destroy:function(){this.model.off(this.model.CHANGE_EVENTS.QUERY_RESULTS,this.onDataChange,this),this._clearTooltips(),e.prototype.destroy.apply(this,arguments)},getViewFeatures:function(e){var t=this.model.getSelectedEntityType(),i=this._getTargetEntityIds(),a=this.model.getQueryModel(t),r=a.getEntitiesByIds(i),d={
canUserModify:this.canModifyByEntityType(t),hasACluster:n.hasACluster()};if(!i.length)return d;var u=this.getViewFeaturesForActions(t,e,i,this.helperModels),h=_.size(u)?_.extend(u,d):d;switch(t){case o.ENTITY_VM:return _.extend(h,{NGTState:c.pluckAttributeFromModels(r,l.EB.VM.NGT_ENABLED),powerStates:c.pluckAttributeFromModels(r,l.EB.VM.POWER_STATE),hypervisorTypes:this.getVmHypervisorTypes(r),cvms:c.pluckAttributeFromModels(r,l.EB.VM.IS_CVM),entityCount:i.length,fanoutSupports:this.getFanoutSupports(t,r),pcConsoleSupports:this.getConsoleSupports(r),vmMgmtSupports:this.getVmMgmtSupports(r),managementServerSupports:this.getManagementServerSupports(r),vmHostAffinitySupports:this.getVmHostAffinitySupports(r),vmLiveMigrateSupports:this.getVmLiveMigrateSupports(r),gpusInUse:this.getVmGPUsInUse(r),isClusterReachable:this.isClusterReachable(r)});case o.ENTITY_CLUSTER:var p=this.clusterManager.getClusterModelByClusterUuid(r[0].get(l.ID));return _.extend(h,{entityCount:i.length,isClusterAvailable:this.clusterManager.isClusterAvailable(r[0].get(l.ID)),isMultiClusterUpgradeSupported:this.isMultiClusterUpgradeSupported(r),isPrismProFeaturesEnabled:s.isPrismProFeaturesEnabled(),isIframeSupported:!!p&&p.isFFEnabled(o.FFLAGS.IFRAME)});case o.ENTITY_HOST:case o.ENTITY_CONTAINER:case o.ENTITY_DISK:case o.ENTITY_STORAGE_POOL:return _.extend(h,{entityCount:i.length});case o.ENTITY_REPORT_CONFIG:return _.extend(h,{entityCount:i.length,predefined:c.pluckAttributeFromModels(r,l.EB.REPORT_CONFIG.OUT_OF_BOX)});default:return h}},viewFilters:function(e){var i=this.model.getSelectedEntityType();return t.getFilter(i)},onEntityAction:function(e){var t=$(e.currentTarget);if(t.hasClass("disabled-link"))return void e.preventDefault();var i=this.model.getSelectedEntityType(),n=t.attr("data-id"),s=this._getTargetEntityIds();this.handleEntityAction(i,n,s)},handleEntityAction:function(e,t,i){var n=void 0;if(i.length)if(e===o.ENTITY_CLUSTER)n=i[0];else if(e!==o.ENTITY_ALERT&&e!==o.ENTITY_PROJECT&&e!==o.ENTITY_REPORT_CONFIG){var s=this.model.getQueryModel(e);if(!(n=s.getEntityById(i[0]).get(l.EB.CLUSTER_UUID)))throw new Error("ERROR: can't perform action on entity without clusterUuid")}this.performEntityAction(e,t,i,n)},confirmEntityDelete:function(e,t,i){var n=this.model.getQueryModel(e),s=r.isGroupedEntityType(e)?n.getGroupsUsingGroupingIds(t):n.getEntitiesByIds(t),a=s.map(function(e){return e.getName()}),o=c.getEntityNameFromCount(e,t.length),l={title:this.i18n("delete")+" "+o+"?",msg:this.i18ns("delete_confirm",o,a[0]),yesText:this.i18n("delete"),class:"-left-align -red-confirm"};t.length>1&&(l=_.extend(l,{msg:this.i18ns("delete_bulk_confirm",t.length,o),expandText:this.i18ns("toggle_show",o),collapseText:this.i18ns("toggle_hide",o),dataItems:a.map(function(e){return{name:e}}),dataColumns:[{title:this.i18n("name"),key:"name"}]})),$.nutanixConfirm(_.defaults({},i,l))},performEntityAction:function(e,t,n,s,a){if(t===o.ACTION_DELETE&&E(e))return this.confirmEntityDelete(e,n,{yes:function(){a=_.extend({},a,{skipConfirm:!0}),i.onEntityAction(e,t,n,s,a)}});i.onEntityAction(e,t,n,s,a)},onDataChange:function(){this.render()},_getTargetEntityIds:function(){return this.model.getVisibleSelectedEntityIds()},_addTooltip:function(e,t,i,n){i||(i=0),n=n||"",e.tooltip({title:t,placement:"bottom",trigger:"hover",html:"true",delay:{show:i,hide:0},template:'<div class="tooltip '+n+'" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>'}),e.addClass("hasTip")},_clearTooltips:function(){this.$(".hasTip").tooltip("destroy"),this.$(".entityActionLink").tooltip("destroy")},_actionOptions:function(e,t){var i=this.vtOptions(t.toJSON());return i.localizedTitle=r.getEntityActionTitle(e,t.getId()),i.btnClass=i.btnClass||"",this.isModifyAction(i.actionId)&&(i.btnClass+="modify-action"),i}}))}),define("text!templates/popups/ebrowser/EBCustomPerspectivePopupView.html",[],function(){return'<div class="modal-header">\n  <button type="button" class="close xClose" data-dismiss="modal">\n    <i data-icon="K" aria-hidden="true"></i>\n  </button>\n  <h4 class="n-title">\n    <%= i18ns(\'title\', entityDisplayName) %>\n  </h4>\n</div>\n\n<div class="n-modal-wrapper n-columns-picker">\n\n  <div class="n-modal-body">\n    <div class="n-modal-content-wrapper">\n      <div class="n-modal-alert-header">\n        \x3c!-- @view: header messages go here... --\x3e\n      </div>\n\n      <section class="description">\n        <div class="form-group column-form">\n          <label class="sr-only" for="nameInput">Name</label>\n          <input type="text" class="form-control" id="nameInput" maxlength="40"\n                 placeholder="<%= i18n(\'enterName\',\n              \'Enter a name for your selections\') %>"\n                 value="<%= name %>">\n        </div>\n        <%= i18ns(\'instructions\', maxAttributes) %>\n      </section>\n\n      <section class="attribute-selector">\n\n        \x3c!-- Available Attributes --\x3e\n        <div class="attribute-wrapper available-attributes">\n          <div class="attribute-filter form-group column-form">\n            <label class="sr-only" for="searchInput">\n              <%= i18n(\'search\') %></label>\n            <input type="text" class="search-input form-control"\n                   id="searchInput"\n                   placeholder="<%= i18n(\'search\') %>">\n            <%= SVG.SVGIcon(\'B\', \'search-icon\') %>\n          </div>\n          <div class="no-results" style="display:none;">\n            <%= i18n(\'noResults\') %>\n          </div>\n          <ul\n            class="list-unstyled attribute-list"\n            <%= getQaDataTestId(\'list_available\') %>\n          >\n            \x3c!-- Available attribute list rendered here --\x3e\n          </ul>\n        </div>\n\n        \x3c!-- Selected Attributes --\x3e\n        <div class="attribute-wrapper selected-attributes">\n          <div class="attribute-list-header">\n            <div class="title">\n              <%= i18n(\'selectedCols\') %>\n            </div>\n            <span class="inverse-label">\n              <%= i18ns(\'maxCols\', maxAttributes) %>\n              </span>\n          </div>\n          <ol\n            class="list-unstyled attribute-list"\n            <%= getQaDataTestId(\'list_selected\') %>\n          >\n            \x3c!-- Selected attribute list rendered here --\x3e\n          </ol>\n        </div>\n      </section>\n    </div>\n  </div>\n  <div class="n-modal-footer">\n    \x3c!-- Back button --\x3e\n    <button class="btnCancel btn n-btn-list">\n      <%= i18n(\'cancel\') %>\n    </button>\n    <button class="btnSave btn btn-primary n-btn-list">\n      <%= i18n(\'save\') %>\n    </button>\n  </div>\n</div>\n'}),define("views/popups/ebrowser/EBCustomPerspectivePopupView",["views/basecomponents/popups/BasePopupView","managers/EntityManager","utils/AppUtil","utils/SVG","utils/AppConstants","data/DataProperties","text!templates/popups/ebrowser/EBCustomPerspectivePopupView.html"],function(e,t,i,n,s,a,r){"use strict";var o=_.template(r),l=_.template('<li class="attribute-list-item"data-id="<%= id %>"data-name="<%= displayName %>"><div class="content-wrapper"><div class="badge -icon -icon-plus -transition-turn-right"></div><div class="value-wrapper"><%= displayName %></div></div></li>'),c=_.template('<li class="attribute-list-item movable-item"data-id="<%= id %>"data-name="<%= displayName %>"><div class="content-wrapper"><div class="badge -icon -icon-minus -transition-spin-left"></div><div class="value-wrapper"><%= displayName %></div></div><div class="action-wrapper"><span class="move-down">'+n.SVGIcon("Arrow_Down","move-down-icon")+'</span><span class="move-up">'+n.SVGIcon("Arrow_Up","move-up-icon")+"</span></div></li>"),d=_.template('<li class="attribute-list-item fixed-item"data-id="<%= id %>"data-name="<%= displayName %>"><div class="content-wrapper"><div class="badge -icon -icon-minus"></div><div class="value-wrapper"><%= displayName %></div></div><div class="action-wrapper">'+n.SVGIcon("Arrow_Down","move-down")+n.SVGIcon("Arrow_Up","move-up")+"</div></li>");return e.extend({name:"EBCustomPerspectivePopupView",entityType:null,model:null,onSuccess:null,events:{"click .btnSave":"onSaveClick","click .btnCancel":"hide","click .modal-header .close":"hide","keyup #searchInput":"applyFilter","click .move-up":"onMoveUpClick","click .move-down":"onMoveDownClick","click .available-attributes .content-wrapper":"onAddAttribute","click .selected-attributes .content-wrapper":"onRemoveAttribute"},initialize:function(e){e=e||{};var i=["model","entityType"],n=_.filter(i,function(t){return!_.has(e,t)});if(n.length)throw new Error("Missing required params: "+JSON.stringify(n));this.entityType=e.entityType,this.schemaModel=t.getEntitySchema(this.entityType),this.onSuccess=e.onSuccess||function(){},this.onValidate=e.onValidate||function(){},this.commonModel=e.commonModel,this.model.on("change:categories",this.render,this)},render:function(){var e=this;this.$el.html(o(this.vtOptions({maxAttributes:10,name:this.model.getDisplayName()||"",entityDisplayName:s.ENTITY_NAMES[this.entityType]||"Entity"}))),this._renderAvailableAttrs(),this._renderSelectedAttrs(),_.defer(function(){e.$("#nameInput").focus()})},destroy:function(){e.prototype.destroy.call(this,arguments),this.model.off("change:categories",this.render,this)},_renderAvailableAttrs:function(){var e=this.getAvailableAttrsContainer(),t=this.getAvailableAttrsSchema(),n=this.getSelectedAttrsSchema(),a=_.sortBy(_.keys(t),function(e){return(t[e][this.schemaModel.DP.ATTR_DISP_NAME]||"").toLocaleLowerCase()},this);e.empty(),_.each(a,function(i){var s=t[i],a=$(l({id:i,displayName:s[this.schemaModel.DP.ATTR_DISP_NAME]}));n.hasOwnProperty(i)&&a.attr("selected","").hide(),e.append(a)},this);var r=this.model.getAvailableCategories();_.each(r,function(t){var a=$(l({id:s.ENTITY_CATEGORY_PREFIX+t,displayName:i.toUpperCaseFirstChar(s.ENTITY_CATEGORY_PREFIX)+t}));n.hasOwnProperty(t)&&a.attr("selected","").hide(),e.append(a)},this)},_renderSelectedAttrs:function(e,t,i){var n=this.getSelectedAttrsContainer(),s=this.getFixedAttrsSchema(),a=this.getSelectedAttrsSchema();n.empty(),_.each(s,function(e,t){n.append(d({id:t,displayName:e[this.schemaModel.DP.ATTR_DISP_NAME]}))},this),_.each(a,function(e,t){n.append(c({id:t,displayName:e[this.schemaModel.DP.ATTR_DISP_NAME]}))},this),this.applyPositionClasses()},getAvailableAttrsContainer:function(){return this.$(".available-attributes .attribute-list")},getSelectedAttrsContainer:function(){return this.$(".selected-attributes .attribute-list")},getSelectedAttrIds:function(){var e=this.getSelectedAttrsContainer(),t=e.find(".attribute-list-item");return _.map(t,function(e){return e.getAttribute("data-id")})},getUserVisibleAttrs:function(){return this.schemaModel.getUserVisibleAttrs()},getFixedAttrs:function(){return[].concat(this.commonModel.getPrimaryAttribute())},getExcludedAttrs:function(){return[].concat(this.commonModel.getIdAttribute(),a.EB.CLUSTER_UUID)},getAvailableAttrsSchema:function(){var e=_.difference(this.getUserVisibleAttrs(),this.getFixedAttrs(),this.getExcludedAttrs());return this.filterSchemaAttrs(e)},getSelectedAttrsSchema:function(){var e=_.difference(this.model.getDisplayAttributes(),this.getFixedAttrs());return this.filterSchemaAttrs(e)},getFixedAttrsSchema:function(){return this.filterSchemaAttrs(this.getFixedAttrs())},filterSchemaAttrs:function(e){var t=this.schemaModel.get(this.schemaModel.DP.ATTRIBUTES),i={};return _.each(e,function(e){i[e]=t[e]}),i},applyFilter:function(){var e=this.$("#searchInput").val().trim(),t=this.getAvailableAttrsContainer(),n=this.$(".no-results"),s=t.find(".attribute-list-item:not([selected])"),a=0;s.show(),n.hide(),e.length&&(e=i.escapeRegexChars(e),_.each(s,function(t){null===t.getAttribute("data-name").match(new RegExp(e,"i"))?this.$(t).hide():a++},this),a||n.show())},applyPositionClasses:function(){var e=this.getSelectedAttrsContainer(),t=e.find(".movable-item");t.removeClass("first-child last-child"),t.first().addClass("first-child"),t.last().addClass("last-child")},onSaveClick:function(){var e=this,t=this.$("#nameInput").val().trim(),i=this.getSelectedAttrIds(),n=this.onValidate(t,i);if(n)return void this.showHeaderError(n);this.clearHeader(),this.model.set(this.model.DP.NAME,t),this.model.set(this.model.DP.ENTITY_TYPE,this.entityType),this.model.setDisplayAttributes(i),this.model.save({success:function(){e.onSuccess(e.model),e.hide()},error:function(t,i,n){e.showHeaderError(e.i18n("saveFailure","An error occurred while saving your settings."))}})},onAddAttribute:function(e){var t=this.getSelectedAttrsContainer(),i=this.$(e.currentTarget).closest(".attribute-list-item");if(t.find(".attribute-list-item").length>=10)return void this.showHeaderError(this.i18n("tooManyColumns","Too many columns selected."));this.clearHeader(),i.attr("selected","").hide(),t.append(c({id:i.attr("data-id"),displayName:i.attr("data-name")})),this.applyFilter(),this.applyPositionClasses()},onRemoveAttribute:function(e){var t=this.getAvailableAttrsContainer(),i=this.$(e.currentTarget).closest(".attribute-list-item"),n=i.attr("data-id");i.hasClass("fixed-item")||(i.remove(),t.find('[data-id="'+n+'"]').removeAttr("selected").show(),this.applyFilter(),this.applyPositionClasses())},onMoveUpClick:function(e){var t=this.$(e.currentTarget),i=t.closest(".attribute-list-item");i.after(i.prev(".movable-item")),this.applyPositionClasses()},onMoveDownClick:function(e){var t=this.$(e.currentTarget),i=t.closest(".attribute-list-item");i.before(i.next()),this.applyPositionClasses()}})}),define("text!templates/pages/ebrowser/EBFocusByView.html",[],function(){return'<div class="focusBy-dropdown dropdown dropdown-menu-right\n            dropdown-multi-action">\n  <a data-toggle="dropdown" class="btn dropdown-toggle"\n    <%= getQaDataTestId(\'focusBy_dropdown\') %>\n  >\n    <%= title %><%= SVG.SVGIcon(\'z\', \'-down-arrow\') %>\n  </a>\n  <ul class="dropdown-menu focusBy-dropdown-menu">\n    <% _.each(perspectives, function(group) { %>\n      <% _.each(group, function(rowHtml) { %>\n        <%= rowHtml %>\n      <% }); %>\n      <li role="presentation" class="divider"></li>\n    <% }); %>\n\n    <% if ( canCreateCustomCols ) { %>\n      <li class="primary-action-row btnCreate">\n        <a class="add-action">\n          <%= SVG.SVGIcon(\'H\') %>\n          <%= i18n(\'addCustom\') %>\n        </a>\n      </li>\n    <% } %>\n  </ul>\n</div>\n'}),define("views/pages/ebrowser/EBFocusByView",["views/basecomponents/BaseView","views/basecomponents/datatables/DataTableColResizeMixin","models/ebrowser/EBCustomPerspectiveModel","views/popups/ebrowser/EBCustomPerspectivePopupView","utils/AppConstants","utils/AppUtil","text!templates/pages/ebrowser/EBFocusByView.html"],function(e,t,i,n,s,a,r){"use strict";var o=_.template(r),l=_.template('<li class="<%= selected %> <%= rowClass %> focusBy-item" <%= getQaDataTestId("perspective_" + id) %>><a class="focusBy-link" stream-action="<%= streamAction %>"stream-target="<%= name %>"data-id="<%= id %>"><%- name %></a><% if (canEdit) { %><div class="action-wrapper"><span class="edit-action btnEdit"><i data-icon="F" aria-hidden="true" ></i></span><span class="delete-action btnDelete"><i data-icon="v" aria-hidden="true"></i></span></div><% } %></li>'),c=_.template('<li class="message-row"><div class="loading-wrapper"><span class="donut-loader-blue"></span></div></li>'),d=_.template('<li class="message-row"><%= i18n("newFocusMsg") %></li>');return e.extend({name:"EBFocusByView",entityType:null,model:null,userData:null,events:{"click .add-action":"onAddPerspective","click .edit-action":"onEditPerspective","click .delete-action":"onDeletePerspective","click .focusBy-link":"onFocusBySelect"},initialize:function(t){e.prototype.initialize.apply(this,arguments),this.entityType=t.entityType,this.menuTitle=t.menuTitle||this.i18n("focusMenuTitle"),this.userData=this.model.getCustomPerspectivesCollection(),this.userData.on("stateChanged",this.onDataChange,this)},render:function(){var e=o(this.vtOptions({canCreateCustomCols:this.canCreateCustomCols(),title:this.menuTitle,perspectives:this.buildPerspectiveGroups()}));return this.$el.html(e),this.canCreateCustomCols()||this.$("li.divider").hide(),this},destroy:function(){this.userData.off("stateChanged",this.onDataChange,this),e.prototype.destroy.apply(this,arguments)},canCreateCustomCols:function(){return this.model.supportCustomPerspective()},buildPerspectiveGroups:function(){var e=[];return e.push(this.buildCannedPerspectiveRows()),this.model.supportCustomPerspective()&&e.push(this.buildCustomPerspectiveRows()),e},buildCannedPerspectiveRows:function(){var e=this,t=this.getCurrentPerspective();return _.map(this.getCannedPerspectives(),function(i){var n=t&&t.get(t.nameAttribute)===i.get(i.nameAttribute);return l(e.vtOptions({id:i.get(i.nameAttribute),name:i.getDisplayName(),selected:n?"selected":"",rowClass:"",streamAction:"EB: focus by",canEdit:!1}))})},buildCustomPerspectiveRows:function(){var e=this.getCustomPerspectives(),t=this.getCurrentPerspective(),i=this.userData.getState();return i===s.STATE_INIT||i===s.STATE_PENDING?[].concat(c()):this.canCreateCustomCols()&&!e.length?[].concat(d(this.vtOptions({}))):_.map(e,function(e){var i=t&&t.getId()===e.getId();return l(this.vtOptions({id:e.getId(),name:e.getDisplayName(),selected:i?"selected":"",rowClass:"action-row",streamAction:"EB: focus by",canEdit:!0}))},this)},refreshUserData:function(){var e=this;this.userData.fetch({success:function(){e.render()}})},setCurrentPerspective:function(e){this.model.setCurrentPerspective(this.entityType,e)},getCurrentPerspective:function(){return this.model.getCurrentPerspective(this.entityType)},getCannedPerspectives:function(){return this.model.getPerspectives(this.entityType)},getCustomPerspectives:function(){return this.userData.getByEntityType(this.entityType)},getPopupOptions:function(){return{el:a.createPopupContainer("popupCustomPerspectives"),entityType:this.entityType}},createPerspective:function(){return new i},onDataChange:function(e){this.render()},onFocusBySelect:function(e){var i=this.model.getSelectedEntityType(),n=$(e.currentTarget).attr("data-id");t.clearAllColResizeStates(),this.model.setCurrentPerspective(i,n)},onAddPerspective:function(e){var t=this,i=this.model.getCommonPerspective(this.entityType);new n(_.extend(this.getPopupOptions(),{model:this.createPerspective(this.entityType),commonModel:i,onValidate:function(e,i){return t._validateCustomCols(e,i,null)},onSuccess:function(e){t.userData.add(e),t.setCurrentPerspective(e.getId()),t.refreshUserData()}})).show()},onEditPerspective:function(e){var t=this,i=this.$(e.currentTarget).closest(".focusBy-item"),s=i.find(".focusBy-link").attr("data-id"),a=this.model.getCommonPerspective(this.entityType);new n(_.extend(this.getPopupOptions(),{model:this.userData.get(s),commonModel:a,onValidate:function(e,i){return t._validateCustomCols(e,i,s)},onSuccess:function(e){t.setCurrentPerspective(e.getId()),t.refreshUserData()}})).show()},onDeletePerspective:function(e){var t=this,i=this.$(e.currentTarget).closest(".focusBy-item"),n=i.find(".focusBy-link").attr("data-id"),r=this.userData.get(n),o=this.getCurrentPerspective().getId()===n,l=this.i18n("focusDeleteMsg",'Are you sure you want to remove "%s" ?'),c=a.sprintf(l,_.escape(r.getDisplayName()));$.nutanixConfirm({msg:c,yes:function(){r.destroy({success:function(){o&&t.setCurrentPerspective(s.DEFAULT_PERSPECTIVE),t.refreshUserData()}})}})},_validateCustomCols:function(e,t,i){if(!e||!e.length)return this.i18n("provideFocusName","Please provide a name for your selections");if(!t.length)return this.i18n("focusNoColumns","Please select one or more columns");var n=null,s=[];return s=s.concat(this.getCannedPerspectives()),s=s.concat(this.getCustomPerspectives()),_.each(s,function(t){t.getName()===e&&t.getId()!==i&&(n=this.i18n("focusNameConflict","Name is already in use. Please use another name."))},this),n}})}),define("text!templates/pages/ebrowser/EBPerspectivesView.html",[],function(){return'<div class="perspective-header hidden">\n  <div class="controls-container">\n    <div class="selections">\n      <div class="selections-dropdown btn-group">\n        <button class="select-btn btn dropdown-btn dropdown-toggle"\n             type="button" id="selectDropdown" data-toggle="dropdown"\n             aria-expanded="true">\n        </button>\n        <ul class="dropdown-menu selections-dropdown-menu -no-check"\n          role="menu" aria-labelledby="dropdownMenu1"\n          data-test="eb-selections-dropdown">\n          <li>\n            <a class="selectByLink" data-id="all"\n              stream-action="EB: select entities"\n              stream-target="select all" >\n              <%= i18n(\'selectAll\') %>\n            </a>\n          </li>\n          <% if (showSelectedEntitiesMenu) { %>\n          <li>\n            <a class="selectByLink" data-id="show"\n              stream-action="EB: select entities"\n              stream-target="show selections" >\n              <%= i18n(\'showSelections\') %>\n            </a>\n          </li>\n          <% } %>\n          <% if (showClearSelectedEntitiesMenu) { %>\n          <li data-test="eb_perspective_clear_selection_li">\n            <a class="selectByLink" data-id="clear"\n              stream-action="EB: clear selections"\n              stream-target="clear selections"\n              data-test="eb_perspective_clear_selection">\n              <%= i18n(\'clearSelectionFilter\') %>\n            </a>\n          </li>\n          <% } %>\n          <li class="divider"></li>\n          <li>\n            <a class="selectByLink" data-id="none"\n               stream-action="EB: select entities"\n               stream-target="clear selections" >\n              <%= i18n(\'clearSelections\') %>\n            </a>\n          </li>\n        </ul>\n      </div>\n    </div>\n    <div class="labels">\n      <div class="labelsDropdown labels-dropdown btn-group">\n        <button class="btn -default dropdown-btn dropdown-toggle" type="button"\n            id="labelsDropdown" aria-expanded="true" data-toggle="dropdown">\n        </button>\n        <div class="dropdown-menu user-defined-dropdown labels-view"\n             data-test="eb-labels-dropdown">\n          \x3c!-- EBLabelsView rendered here.--\x3e\n        </div>\n      </div>\n    </div>\n    <div class="actions"></div>\n    <div class="pull-right">\n      <div class="eb-options"></div>\x3c!--\n        comment for formatting\n   --\x3e<div class="viz-selector"></div>\x3c!--\n        comment for formatting\n   --\x3e<div class="layout-buttons btn-group">\n        <button id="toggleRightPanel" class="btn btn-default only-child"\n            stream-action="EB: layout"\n            stream-target="right panel" >\n          <span class="tooltip-wrapper">\n            <a class="buttonTab">\n              <%= SVG.SVGIcon(\'Filter\',\'-small -inline -default-position\') %>\n              <span class="btn-content"><%= i18n(\'filters\') %></span>\n            </a>\n          </span>\n        </button>\n      </div>\n    </div>\n  </div>\n  <div class="query-bar-wrapper">\n    <div class="query-bar" data-test="eb-query-bar"></div>\n    <div class="favorite-queries hidden"></div>\n  </div>\n\n</div>\n<div class="perspective-notification-wrapper">\n  \x3c!-- Entity notification rendered here if available --\x3e\n</div>\n<div class="perspective-container-wrapper">\n  <div class="antiscroll-wrap">\n    <div class="box-wrap perspective-container-box-wrap">\n      <div class="antiscroll-inner perspective-container-inner">\n        <div class="perspective-container">\n          <div class="loading-data">\n            <div class="donut-loader-blue"></div>\n            <span class="busy-msg"></span>\n          </div>\n          \x3c!-- here is where the table/tile/etc goes --\x3e\n        </div>\n      </div>\n    </div>\n  </div>\n</div>\n<div class="perspective-footer">\n  \x3c!-- Color by legend goes here--\x3e\n</div>\n'}),define("views/pages/ebrowser/EBBasePerspectivesView",["views/basecomponents/BaseView","data/DataProperties","views/alerts/AlertMessageView","views/pages/ebrowser/filters/EBFilterBarView","views/pages/ebrowser/favorites/EBFavoriteQueriesView","views/pages/ebrowser/viz/EBLegendView","views/pages/ebrowser/EBActionsView","views/pages/ebrowser/EBFocusByView","events/AppEvents","utils/AppUtil","utils/AppConstants","utils/SubViewHelper","utils/EntityUtil","utils/SVG","text!templates/pages/ebrowser/EBPerspectivesView.html"],function(e,t,i,n,s,a,r,o,l,c,d,u,h,p,T){"use strict";var E=_.template(T),g='<span class="grid-icon css-icon icon" stream-action="EB: change perspective" stream-target="table" ><span class="bar one"></span><span class="bar two"></span><span class="bar three"></span></span>',S=_.template('<ul class=""><% _.each(visualizations, function(viz) {   var sClass = (viz === currentViz) ? "selected" : ""; %><li data-id="<%= viz %>" class="viz-select-icon <%= viz %>-icon-wrapper <%= sClass %>"><%= vizIcons[viz] %></li><% }) %></ul>'),m=_.template('<div class="viz-container <%= vizName %>-container" id="<%= vizId %>"></div>'),v=_.template('<span id="<%= id %>" class="dropdown-container <%= name %>-container"></span>'),f=_.template('<div class="<%= id %>-dropdown dropdown dropdown-menu-right"><a data-toggle="dropdown" class="btn btn-default dropdown-toggle" <%= getQaDataTestId(id + "_dropdown") %> ><%= title %> '+p.SVGIcon("z","-down-arrow")+'</a><ul class="dropdown-menu"><% _.each(options, function(tuple) { %><%  var s = (tuple[0] === selectedValue) ? "selected" : ""; %><li class="<%= s %>" <%= getQaDataTestId(id + "_" + tuple[0]) %>><a class="<%= id %>-link" stream-action="<%= stream_action %>" stream-target="<%= tuple[1] %>" data-id="<%= tuple[0] %>"><%= tuple[1] %></a></li><% }) %></ul></div>');return e.extend({name:"EBBasePerspectivesView",currentVisualizationId:null,showClearSelectedEntitiesMenu:!1,events:{"click      .sortBy-link":"onSortBySelect","click      .groupBy-link":"onGroupBySelect","click      .colorBy-link":"onColorBySelect","click      .dropdown-btn":"hideOpenDropdowns","click      .dropdown":"hideOpenDropdowns","click      .create-actions":"hideOpenDropdowns","click      #toggleRightPanel":"onToggleRightPanel","click      .saved-query-arrow-icon":"onShowSavedQuery"},initialize:function(){e.prototype.initialize.apply(this,arguments),this.subViewHelper=new u,this.$el.html(E(this.vtOptions({showSelectedEntitiesMenu:this.showSelectedEntitiesMenu(),showClearSelectedEntitiesMenu:this.showClearSelectedEntitiesMenu})))},render:function(){this._clearTooltips(),this.model.getSelectedEntityType()&&(this._renderFilterBar(),this._renderFavQueriesPicker(),this._renderVisualization(),this._renderPerspectiveControls())},destroy:function(){this.subViewHelper.removeAll(),this.subViewHelper=null,this.stopServices(),this._clearTooltips(),e.prototype.destroy.apply(this,arguments)},getVisualizationViewByName:function(e){return _.find(this.subViewHelper.subViews,function(t){return t.vizName===e})},isCurrentSelfContainedViz:function(){var e=this.model.getSelectedEntityType(),t=this.model.getCurrentVisualization(e),i=this.getVisualizationViewByName(t);return!!i&&i.isSelfContainedVisualization()},renderWithContext:function(e){if(!this.isCurrentSelfContainedViz()){this.render();if(this.model.getSelectedEntityType()&&e&&e.length){var t=this.subViewHelper.get(this.currentVisualizationId);t&&t.highlightEntitiesById(e)}}},onStartServices:function(){this.model.on(this.model.CHANGE_EVENTS.VISUALIZATION,this._renderVisualization,this),this.model.on(this.model.CHANGE_EVENTS.ENTITY_ALERT,this._renderVizualizationAlertView,this),this.model.on(this.model.CHANGE_EVENTS.QUERY_RESULTS,this.renderWithContext,this),this.model.on(this.model.CHANGE_EVENTS.LABELED_ENTITIES,this.onLabelChange,this),this.model.on(this.model.CHANGE_EVENTS.TASKS_CHANGED,this.onTaskChange,this),this.model.on(this.model.CHANGE_EVENTS.QUERY_STATE,this.onQueryStateChange,this),this.model.on(this.model.CHANGE_EVENTS.COLOR_BY,this.render,this),this.model.on(this.model.CHANGE_EVENTS.FAVORITE_QUERIES,this._renderFavQueriesPicker,this),this.model.on(this.model.CHANGE_EVENTS.INTENT_ENTITIES_STATE_CHANGED,this.onIntentEntitiesStateChanged,this);var e=this.model.getSelectionsModel();e.on(e.CHANGE_EVENTS.SELECTED_ENTITIES,this._onSelectionChange,this);var t=this.model.getGroupSelectionsModel();t.on(t.CHANGE_EVENTS.SELECTED_ENTITIES,this._onSelectionChange,this)},onStopServices:function(){this.model.off(this.model.CHANGE_EVENTS.VISUALIZATION,this._renderVisualization,this),this.model.off(this.model.CHANGE_EVENTS.ENTITY_ALERT,this._renderVizualizationAlertView,this),this.model.off(this.model.CHANGE_EVENTS.QUERY_RESULTS,this.renderWithContext,this),this.model.off(this.model.CHANGE_EVENTS.LABELED_ENTITIES,this.onLabelChange,this),this.model.off(this.model.CHANGE_EVENTS.TASKS_CHANGED,this.onTaskChange,this),this.model.off(this.model.CHANGE_EVENTS.QUERY_STATE,this.onQueryStateChange,this),this.model.off(this.model.CHANGE_EVENTS.COLOR_BY,this.render,this),this.model.off(this.model.CHANGE_EVENTS.FAVORITE_QUERIES,this._renderFavQueriesPicker,this),this.model.off(this.model.CHANGE_EVENTS.INTENT_ENTITIES_STATE_CHANGED,this.onIntentEntitiesStateChanged,this);var e=this.model.getSelectionsModel();e.off(e.CHANGE_EVENTS.SELECTED_ENTITIES,this._onSelectionChange,this);var t=this.model.getGroupSelectionsModel();t.off(t.CHANGE_EVENTS.SELECTED_ENTITIES,this._onSelectionChange,this)},onResize:function(){this.subViewHelper&&this.subViewHelper.iterate("onResize");var e=this.$(".query-bar").width();this.$(".favorite-queries").width(e)},showSelectedEntitiesMenu:function(){return!h.isGroupedEntityType(this.model.getSelectedEntityType())},onShowSavedQuery:function(){this.$(".query-item").removeClass("highlight"),this.$(".favorite-queries").toggleClass("hidden")},onSortBySelect:function(e){var t=this.model.getSelectedEntityType(),i=$(e.currentTarget).attr("data-id");this.model.setQuerySortBy(t,i)},onGroupBySelect:function(e){var t=this.model.getSelectedEntityType(),i=$(e.currentTarget).attr("data-id");this.model.setQueryGroupby(t,i)},onColorBySelect:function(e){var t=this.model.getSelectedEntityType(),i=$(e.currentTarget).attr("data-id");this.model.setColorBy(t,i)},hideOpenDropdowns:function(e){this.$(".dropdown").removeClass("open"),this.$(".favorite-queries").addClass("hidden"),this.$(".query-item").removeClass("highlight")},onToggleRightPanel:function(e){$(e.currentTarget).parents("."+l.EB_EVENT_HANDLER).trigger(l.EB_EVENTS.TOGGLE_RIGHT_PANEL)},canFilterByEntityName:function(){return this.model.getSelectedEntityType()!==d.ENTITY_AUDIT},_onSelectionChange:function(){this._renderSelectionsDropdown(),this._renderLabelsUI(),this._renderActions(),this.setContainerState();var e=this.subViewHelper.get(this.currentVisualizationId);e&&e.onSelectionChange()},_renderFilterBar:function(){var e=this.subViewHelper.get("filterBarView");if(e)e.setCanFilterByEntityName(this.canFilterByEntityName());else{var t=this;e=new n({el:this.$(".query-bar"),model:this.model,canFilterByEntityName:this.canFilterByEntityName(),highlightFavQueryCB:function(e){t._highlightFavQuery(e)}}),this.subViewHelper.register("filterBarView",e)}e.render()},_renderFavQueriesPicker:function(){var e=this.subViewHelper.get("favQueriesView");e||(e=new s({el:this.$(".favorite-queries"),model:this.model}),this.subViewHelper.register("favQueriesView",e)),e.render()},_highlightFavQuery:function(e){this.$(".favorite-queries").removeClass("hidden");var t=e.getId();this.$('.query-item[data-id="'+t+'"]').addClass("highlight");var i=this;setTimeout(function(){i.$('.query-item[data-id="'+t+'"]').removeClass("highlight")},5e3)},_renderPerspectiveControls:function(){this.setContainerState(),this._showFiltersButton(),this._renderSelectionsDropdown(),this._renderLabelsUI(),this._renderActions(),this._renderQueryOptions(),
this._renderVizSelector()},_renderSelectionsDropdown:function(){},_renderLabelsUI:function(){},_showFiltersButton:function(){this.$("#toggleRightPanel").show()},setContainerState:function(){},_renderQueryOptions:function(){var e=this.model.getSelectedEntityType();if(e){var t=this.model.getCurrentPerspective(e),i=this.model.getQueryModel(e),n=this.model.getCurrentVisualization(e),s="ebFocusBy_"+e,a="";if(h.isGroupedEntityType(e))return void this.$(".eb-options").html(a);if("grid"!==n){var r=[],o=h.getSortableAttributes(e,t.getDisplayAttributes());_.each(o,function(t){var i=[t,h.getAttributeDisplayName(e,t)];r.push(i)}),r.length&&(a+=f(this.vtOptions({id:"sortBy",title:this.i18n("toolbar.sortBy"),options:r,selectedValue:i.get(i.DP.GROUP_MEMBER_SORT_ATTRIBUTE),stream_action:"EB: sort by"})))}a+=v({id:s,name:"ebFocusBy"});var l=this._getColorByTuples(t,e);l.length&&(a+=f(this.vtOptions({id:"colorBy",title:this.i18n("toolbar.colorBy"),options:l,selectedValue:this.model.getColorBy(e),stream_action:"EB: color by"})));var c=this._getGroupByTuples(t,e);c.length&&(a+=f(this.vtOptions({id:"groupBy",title:this.i18n("toolbar.groupBy"),options:c,selectedValue:i.get(i.DP.GROUPING_ATTR),stream_action:"EB: group by"}))),this.$(".eb-options").html(a),this._renderFocusByDropdown(s)}},_getGroupByTuples:function(e,t){return _.map(e.getGroupByAttributes(),function(e){return[e,h.getAttributeDisplayName(t,e)]})},_getColorByTuples:function(e,t){return _.map(e.getColorByAttributes(),function(e){return[e,h.getAttributeDisplayName(t,e)]})},_renderFocusByDropdown:function(e){var t=this.model.getSelectedEntityType(),i=void 0;this.subViewHelper.get(e)&&this.subViewHelper.remove(e),i=new o({el:this.$("#"+e),entityType:t,model:this.model}),this.subViewHelper.register(e,i),i.render()},_renderVizSelector:function(){var e=this.model.getSelectedEntityType(),i=this.model.getCurrentPerspective(e),n=this.model.getCurrentVisualization(e),s=_.filter(i.get(i.DP.VISUALIZATIONS),function(e){return!0!==e.hideInList}),a=_.pluck(s,t.NAME);if(a.length>1){var r={};r.grid=g,r.grouped_grid=g,r.tile='<span class="tile-icon css-icon icon" stream-action="EB: change perspective" stream-target="tiles" ><div class="tilerow one"><span class="tilecell one"></span><span class="tilecell two"></span></div><div class="tilerow two"><span class="tilecell one"></span><span class="tilecell two"></span></div></span>',r.circles='<span class="circles-icon css-icon icon" stream-action="EB: change perspective" stream-target="circles" ><div class="circle-row one"><span class="circle-cell one"></span><span class="circle-cell two"></span><span class="circle-cell three"></span></div><div class="circle-row two"><span class="circle-cell one"></span><span class="circle-cell two"></span><span class="circle-cell three"></span></div></span>';var o=S({visualizations:a,currentViz:n,vizIcons:r});this.$("li.viz-select-icon").tooltip("destroy"),this.$(".viz-selector").html(o),_.each(a,function(e){var t=this.$("li."+e+"-icon-wrapper"),i=this.i18n("visualization."+e);this._addTooltip(t,i)},this)}else this.$(".viz-selector").html("")},_renderActions:function(){var e=this.subViewHelper.get("actionsView");e||(e=this.createActionsView(this.$(".actions"),this.model),this.subViewHelper.register("actionsView",e)),e.render()},createActionsView:function(e,t){return new r({el:e,model:t})},onLabelChange:function(){this.subViewHelper&&this.subViewHelper.iterate("onLabelChange")},onTaskChange:function(){this.subViewHelper&&this.subViewHelper.iterate("onTaskChange")},onQueryStateChange:function(e){this.subViewHelper&&this.subViewHelper.iterate("onQueryStateChange",e)},onIntentEntitiesStateChanged:function(e){this.subViewHelper&&this.subViewHelper.iterate("onIntentEntitiesStateChanged",e)},_renderVizLegend:function(){var e=this.subViewHelper.get("colorByLegendView");if(!e){var t=this;e=new a({el:this.$(".perspective-footer"),model:this.model,onHighlightCB:function(e,i){t._highlightEntitiesByColor(e,i)}}),this.subViewHelper.register("colorByLegendView",e)}var i=this.subViewHelper.get(this.currentVisualizationId),n=i.getCurrentColorMap();e.render(n)},_highlightEntitiesByColor:function(e,t){var i=this.subViewHelper.get(this.currentVisualizationId);i&&i.higlightEntitiesByColor(e,t)},_renderVisualization:function(){this._renderQueryOptions(),this._renderVizualizationAlertView(),this._renderVisualizationView(),this._renderVizLegend()},showHeader:function(){this.$(".perspective-header").removeClass("hidden")},hideHeader:function(){this.$(".perspective-header").addClass("hidden")},_renderVizualizationAlertView:function(){var e=this.model.getSelectedEntityType(),t=this.model.getCurrentHook(),n=this.subViewHelper.get(e+"-alerts");this.$(".perspective-notification-wrapper").empty(),!t||t.isNew()||t.isEmpty()||(n||(n=new i({closeHook:function(){return n.dismissAlert()}}),this.subViewHelper.register(e+"-alerts",n)),n.setElement(this.$(".perspective-notification-wrapper")).setType(t.getNotifyType()).setContent(t.getResult()).render())},_renderVisualizationView:function(){this.$(".viz-container").hide();var e=this.model.getEBQueryState();e!==d.STATE_INIT&&e!==d.STATE_PENDING||this.showLoadingPanel();var i=this.model.getSelectedEntityType(),n=this.model.getCurrentPerspective(i),s=this.model.getCurrentVisualization(i),a=n.get(t.NAME).toLowerCase(),r="viz-"+a+"-"+s;this.currentVisualizationId&&(this.subViewHelper.remove(this.currentVisualizationId),this.currentVisualizationId=null);var o=(i+"_"+s).toLowerCase();if(!this.$("#"+o).length){var l=m({vizName:s,vizId:o});this.$(".perspective-container").append(l)}var u=this._createVisualizationSubview(i,n,s);if(u){this.subViewHelper.register(r,u),this.currentVisualizationId=r;var h=u.getVisualizationCapabilities();this.model.setVisualizationCapabilities(h)}else c.log("Error: Visualization not available.");if(u.showView(),u.render(),e=this.model.getEBQueryState(),!u.isServicePlugin&&e===d.STATE_SUCCESS){var p=this.model.getQueryModel(this.model.getSelectedEntityType());u.updateDataSource(p.getQueryResults()),u.startServices(),this.hideLoadingPanel()}},hideLoadingPanel:function(){this.$(".loading-data").hide()},showLoadingPanel:function(){this.$(".loading-data").show().find(".busy-msg").html(c.randomBusyMessage())},_createVisualizationSubview:function(e,t,i){return null},_addTooltip:function(e,t,i){i||(i=0),e.tooltip({title:t,placement:"bottom",trigger:"hover",html:"true",delay:{show:i,hide:0}}),e.addClass("hasTip")},_clearTooltips:function(){this.$(".hasTip").tooltip("destroy")}})}),define("views/pages/ebrowser/viz/BaseVisualizationView",["views/basecomponents/BaseView","data/DataProperties","managers/NamespaceManager","managers/NavigationManager","managers/TaskManager","managers/EntityStateTracker","managers/I18nManager","utils/AppUtil","utils/AppConstants","utils/EntityUtil","utils/DataRendererUtil","utils/StyleDescriptor","utils/CommonTemplates","utils/renderers/EntityCustomIconsMixin"],function(e,t,i,n,s,a,r,o,l,c,d,u,h,p){"use strict";var T=_.template('<div class="eb-tooltip"><% _.each(tipElements, function(value, name) { %><div class="nvpair"><div class="name"><%= name %></div><div class="value"><%= value %></div></div><% }) %></div>'),E=_.template('<div class="eb-label-tooltip"><% _.each(labels, function(label) { %><div class="label-name"><%- label %></div><% }) %></div>'),g=_.template('<div class="entity-attribute attribute-value <%= rowColorClass %>"><div class="name"><%= displayName %></div><div class="value"><%= displayValue %></div></div>'),S=_.template('<% if ( value ) { %><% if ( nbSelected > 0 ) { %><div class="selection-count"><%= nbSelectedMsg %></div><% } else { %><div class="description"><%= rangeMsg %></div><% } %><% } else { %><div class="description"><%= noneMsg %></div><% } %>'),m=_.template('<div class="no-entities"><%= reason %></div>'),v=_.template('<span class="separator">&middot;</span><div class="donut-loader-blue"></div><span class="busy-msg"><%= message %></span>');return e.extend(_.extend({},p,{name:"EBBaseVisualizationView",entityType:null,entityCollection:null,visualizationAttributes:null,labelsCollection:null,sortBy:null,colorBys:null,colorBy:null,defaultColorBy:null,colorMap:null,queryResults:null,onSelectionCallback:null,sortChangeCB:null,pageChangeCB:null,vizName:null,COLOR_ATTR:{colorClass:"colorClass",colorTip:"colorTip",colorFillPct:"colorFillPct",sectionColorValue:"sectionColorValue"},PAGE_SIZE_OPTIONS:[10,20,30,40,50,60],MAX_PAGE_SIZE:60,UNGROUPED_HEADER_TEMPLATE:S,initialize:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.prototype.initialize.apply(this,arguments),this.entityType=t.entityType,this.entityCollection=c.createCollection(this.entityType),this.sortBy=t.sortBy,this.colorBy=t.colorBy,this.defaultColorBy=t.defaultColorBy,this.sortChangeCB=t.sortChangeCB,this.pageChangeCB=t.pageChangeCB,this.loadMoreEntities=t.loadMoreEntitiesCB,this.loadGroupMembersForExport=t.loadGroupMembersForExport,this.selectionsModel=t.selectionsModel,this.labelsCollection=t.labelsCollection,this.visualizationAttributes=t.visualizationAttributes,this.vizName=t.vizName},isSelectionEnabled:function(){return!0},onQueryStateChange:function(e){e===l.STATE_INIT||e===l.STATE_PENDING?(_.each(this.$(".query-busy"),function(e){$(e).html(v({message:o.randomBusyMessage()}))}),o.showLoader(!0)):(this.$(".query-busy").empty(),o.hideLoader())},getVisualizationCapabilities:function(){return{}},isSelfContainedVisualization:function(){return!1},assignTooltips:function(e){var t=this;c.assignTooltips(this.$el,e,function(e){return t.renderEntityTooltip(e)})},clearTooltips:function(){c.clearTooltips(this.$el,".entityTooltipTarget"),c.clearTooltips(this.$el,".labelTooltipTarget")},checkNoResults:function(e){if(!e)return!1;var t,i=o.getPluralEntityName(this.entityType);return 0===e.total_entity_count?(t=this.i18n("noResults","There are no %s available on this cluster."),this.$el.html(m({reason:o.sprintf(t,i)})),!1):0!==e.filtered_entity_count||(t=this.i18n("noFilteredResults","No %s match your current filters."),this.$el.html(m({reason:o.sprintf(t,i)})),!1)},renderEntityTooltip:function(e){var i={};return _.each(this.visualizationAttributes[t.DISPLAY_ATTRIBUTES],function(t){var n=c.getAttributeDisplayName(this.entityType,t),s=e.getValue?e.getValue(t):o.getJSONValue(e,t);i[n]=c.getAttributeDisplayValue(this.entityType,t,s)},this),T({tipElements:i})},renderEntityAttributes:function(e,i){var n="",s=this.visualizationAttributes[t.PRIMARY_ATTRIBUTE];return _.each(this.visualizationAttributes[t.DISPLAY_ATTRIBUTES],function(t){t!==s&&(n+=this.renderEntityAttribute(e,t,i))},this),n},renderEntityAttribute:function(e,t,i){var n=e.getValue?e.getValue(t):o.getJSONValue(e,t),s=c.getAttributeDisplayName(this.entityType,t),a=this.getAttributeRenderer(t),r=a.getAttributeDisplayTooltip(this.entityType,e),l=a.getAttributeDisplayValue(e,!1,n);return s=o.containsHTML(s)?s:h.TEXT_TITLE_WRAP({text:s}),l=o.containsHTML(l)?l:h.TEXT_TITLE_WRAP({text:l}),g({displayName:s+r,displayValue:l,rowColorClass:i===t?"highlight":""})},getAttributeRenderer:function(e){var i=this.visualizationAttributes[t.CUSTOM_RENDERS],n={name:e};return i&&i[e]&&_.extend(n,i[e]),d.getRenderer(n)},renderEntityLabels:function(){c.clearTooltips(this.$el,".labelTooltipTarget"),c.clearLabelIcons(this.$el);for(var e=this.queryResults.models,t=e?e.length:0,i=0;i<t;i++)c.renderLabelIcon(this.$el,e[i])},renderTaskIcons:function(){var e=this.getVisibleEntityIds();this.$(".task-icon").empty();var i=s.getRunningTaskByEntityId(e);_.each(e,function(e){var n=i[e];if(n){var s,a=this.i18n("processing","Processing"),r=n.getEntitySubTasksMap();if(r&&r[e]){var c=r[e];if(c.isTaskCompleted())return;a=c.get(t.TASK_PERCENT_COMPLETE)+"%"||a,s=c.getTaskOperationType()}else if(!n.isTaskCompleted()){var d=n.get(t.TASK_PERCENT_COMPLETE);d&&(a=d+"%")}var u=this.$('.entityTooltipTarget[data-id="'+e+'"] .task-icon');o.addInLineDonutLoader(u),s=s||n.getTaskOperationType(),n.get("operation")===l.TASK_OPERATION_IMAGE_UPDATE&&(s=this.i18n("imageCreateOperation")),u.attr("title",a+" "+s)}},this)},onSelectPageSize:function(e){var t=this._getGroupFromElement?this._getGroupFromElement(e):null,n=Number($(e.currentTarget).attr("data-id"));if(n){var s=i.get(i.USER_SETTINGS);s.getUserSetting(l.EB_USER_SETTINGS.PAGE_SIZE)!==n&&(s.setUserSetting(l.EB_USER_SETTINGS.PAGE_SIZE,n),this.queryResults[this.queryResults.DP.PAGINATOR].refreshCurrentPage(t,this._onPageData))}},_findTaskIconEl:function(e){return this.$('.entityTooltipTarget[data-id="'+e+'"] .task-icon')},_renderTaskIconsProgress:function(e,t){var i=this._findTaskIconEl(e);o.addInLineDonutLoader(i),i.attr("title",t)},_disableRenderTaskIconsProgress:function(e){this._findTaskIconEl(e).empty()},_renderTaskErrorIcons:function(e,t){this.$('.entityTooltipTarget[data-id="'+e+'"] .icons-wrapper').append(h.WARNING_ICON_TEMPLATE(this.vtOptions({reason:t})))},_removeTaskErrorIcons:function(e){this.$('.entityTooltipTarget[data-id="'+e+'"] .icons-wrapper .warning-icon').remove()},renderHealthIcons:function(){for(var e=this.queryResults.models,t=e?e.length:0,i=0;i<t;i++){var n=e[i],s=this.getHealthIcon(n);if(s){var a='.entityTooltipTarget[data-id="'+n.getId()+'"] .health-icon';this.$(a).html(s)}}},renderCustomPrimaryIcons:function(){this.renderCustomIconsForEntities(this,this.entityType,this.queryResults.models)},renderPrimaryColumnIcons:function(){this.renderHealthIcons(),this.renderTaskIcons(),this.renderCustomPrimaryIcons()},renderLabelTooltip:function(e){return E({labels:e})},toggleEntitySelection:function(e){this.selectionsModel.toggleEntitySelection(this.entityType,e)},appendSelectedEntityIds:function(e){this.selectionsModel.appendSelectedEntityIds(this.entityType,e)},getSelectedEntityIds:function(){return this.selectionsModel.getSelectedEntityIds(this.entityType)},getCurrentColorMap:function(){return this.colorMap},updateDataSource:function(e){this.queryResults=e,this.onLabelChange()},onStartServices:function(){this.render()},highlightEntitiesById:function(e){},higlightEntitiesByColor:function(e,t){},getVisibleEntityIds:function(){return _.pluck(this.getVisibleEntities(),t.ID)},getVisibleEntities:function(){var e=[];if(this.queryResults){var t=this.queryResults[this.queryResults.DP.GROUP_RESULTS],i=this.queryResults[this.queryResults.DP.PAGINATOR];t.each(function(t){var n=i.getCurrentPage(t);e=e.concat(n)},this)}return e},onSelectionChange:function(){var e=this.queryResults[this.queryResults.DP.GROUP_RESULTS];if(1===e.length){var t=e.first();if(t.isAllEntitiesGroup()){var i=this._renderAllGroupHeader(t);this.$(".summary-all-group").html(i)}}},onLabelChange:function(){if(this.queryResults){var e=this.queryResults.models;this.assignLabels(e),this.renderEntityLabels()}},assignLabels:function(e){_.each(e,function(e){var i=e.get(e.idAttribute),n=[];this.labelsCollection.each(function(e){e.isEntityLabeled(this.entityType,i)&&n.push(e.get(e.nameAttribute))},this),e.set(t.LABEL_NAMES,n)},this)},onTaskChange:function(){this.renderTaskIcons()},onIntentEntitiesStateChanged:function(e){_.each(e,function(e){var i=e[a.DP.ENTITY_TYPE],n=e[a.DP.RESULT][t.INTENT_TASK.STATE],s=e[a.DP.RESULT][t.INTENT_TASK.PERCENT_COMPLETE]||"",l=e[a.DP.ENTITY_ID],c=e[a.DP.RESULT][t.INTENT_TASK.MESSAGE]||"";if(this._removeTaskErrorIcons(l),o.isIntentStateComplete(i,n))this._disableRenderTaskIconsProgress(l);else if(o.isIntentStateError(i,n))this._disableRenderTaskIconsProgress(l),this._renderTaskErrorIcons(l,c);else if(o.isIntentStatePending(i,n)){var d="",u=r.t("IntentCommon","state."+n,n);u&&(d=u),s&&(d+=": "+s),this._renderTaskIconsProgress(l,d)}},this)},showEntityDetails:function(e){var t=n.createNavigationContext(this.entityType,{entities:this.getVisibleEntities()});n.navigateToFullScreenDetailsPane(this.entityType,e,t)},assignEntityColors:function(e,i){var n=this;if(i&&i.length){var s={},a=_.groupBy(e,function(e){return n.getGroupingValue(e,i)}),r=[];_.each(a,function(e,n){var a;a=i===t.HEALTH_STATUS||i===t.EB.CLUSTER.OVERALL_HEALTH_SCORE||i===t.EB.HEALTH_SCORE?u.getHealthColorClass(n):i===t.ALERT_SEVERITY?u.getAlertHealthColorClass(n):i===t.ALERT_IMPACT?u.getAlertHealthColorClass(n):i===t.EB.VM.POWER_STATE?u.getPowerStateColorClass(n):u.getUniqueColorClass(r),r.push(a),_.each(e,function(e,t){if(0===t){var n=this._getGroupLabel(e,i);s[n]=a}e[this.COLOR_ATTR.colorClass]=a,e[this.COLOR_ATTR.colorTip]=c.getAttributeDisplayName(this.entityType,i)+" : "+this._getGroupLabel(e,i)},this)},this),this.colorMap=s}else _.each(e,function(e){e[this.COLOR_ATTR.colorClass]=null,e[this.COLOR_ATTR.colorTip]=null},this),this.colorMap=null},assignEntityFills:function(e,t){return!1},getGroupingValue:function(e,i){var n=c.getAttributeSchema(this.entityType,i),s=i?e.getValue(i):null;return n.continuous||i===t.EB.HEALTH_SCORE||i===t.EB.CLUSTER.OVERALL_HEALTH_SCORE?c.getAttributeDisplayValue(this.entityType,i,s,!1):s||1},getColor:function(e){return"#"+(e[this.COLOR_ATTR.colorValue]||e[this.COLOR_ATTR.sectionColorValue])},getHealthIcon:function(e){var i=this.entityType===l.ENTITY_CLUSTER?t.EB.CLUSTER.OVERALL_HEALTH_SCORE:t.EB.HEALTH_SCORE,n=c.getHealthDisplayValue(e.getValue(i));return n===l.HEALTH_STATUS.CRITICAL||n===l.HEALTH_STATUS.WARNING?h.HEALTH_ICON_TEMPLATE({status:n,statusStyle:"n-health-status-"+n.toLowerCase()}):null},_getGroupLabel:function(e,i){if(!i)return"";var n=e.getValue(i);if(i===t.VM_NUM_VCPUS){var s=n;return o.pluralize(this.name,"numVCPUs","No vCPUs","%d vCPU","%d vCPUs",s)}return i===t.EB.HEALTH_SCORE||i===t.EB.CLUSTER.OVERALL_HEALTH_SCORE?c.getHealthDisplayValue(n):n},getSelectedMsg:function(e,t,i,n){var s=Number(t).toLocaleString(),a=o.pluralizeEntity(this.entityType,i),r=o.getPluralEntityName(this.entityType);return i<n?o.sprintf(this.i18n("selectedFilterMsg"),s,i,a):n?o.sprintf(this.i18n("selectedMsgWithTotal"),s,n,r):o.sprintf(this.i18n("selectedMsg"),s)},getRangeMsg:function(e,t){var i=Number(e).toLocaleString(),n=o.pluralizeEntity(this.entityType,e),s=o.getPluralEntityName(this.entityType);return e<t?o.sprintf(this.i18n("filteredRangeMsg"),i,n,t,s):o.sprintf(this.i18n("rangeMsg"),i,s)},renderSelectAllLinks:function(e){return""},_renderAllGroupHeader:function(e){var t=this.getSelectedEntityIds(this.entityType),i=this.queryResults[this.queryResults.DP.PAGINATOR],n=i.getGroupVisibleSelectedIds(e,t),s=e.get(e.DP.TOTAL_ENTITY_COUNT),a=n.length,r=o.getPluralEntityName(this.entityType),l=Number(s).toLocaleString(),c=e.get(e.DP.GRAND_TOTAL_ENTITIES),d=this.getSelectedMsg(e,a,s,c,r),u=this.getRangeMsg(s,c,this.entityType),h=o.sprintf(this.i18n("noneMsg","There are no %s available"),r),p=S({value:l,nbSelectedMsg:d,rangeMsg:u,noneMsg:h,nbSelected:a});return a<s&&(p+=this.renderSelectAllLinks(e)),p}}))}),define("views/pages/ebrowser/viz/EBGroupedSections",["views/pages/ebrowser/viz/BaseVisualizationView","views/basecomponents/charts/ChartTemplates","data/DataProperties","components/Components","managers/NotificationManager","utils/EntityUtil","utils/AppConstants","utils/AppUtil","utils/VisualizationUtil","models/ebrowser/EBPerspectiveModel"],function(e,t,i,n,s,a,r,o,l,c){"use strict";var d={STATS_USAGE_BAR:"statsUsageBar"},u=_.template('<div class="groupedViz"><%= html %></div>'),h=_.template('<div class="group-container" data-id="<%= groupId %>"><div class="header"><div class="header-element"><% if ( !isAllEntitiesGroup ) { %><div class="name"><%= groupName || "Unknown" %></div><% } %><div class="summary-all-group"></div><div class="query-busy"></div></div><div class="header-element"><% if ( isExpanded ) { %><% if (showExport) { %><div class="export" data-id="<%= groupId %>" title="<%= i18n("Export") %>" <%= getQaDataTestId("export") %>><%= SVG.SVGIcon("Export") %></div><div class="export-separator"></div><% } %><div class="paginator"></div><% } else { %><div class="expand-section">Expand&nbsp;&nbsp;+</div><% } %></div></div><div class="summary-group"><%= groupSummaries %></div><div class="members"></div></div>'),p=_.template('<div class="group-container too-many-groups" ><div class="header"><div class="too-many-groups">Too many resulting groups.  Please use filters to reduce the number of groups.</div></div></div>');return e.extend({events:{"change .tile-checkbox":"onGroupSelection","click  li:not(.disabled) > a.pagerNext":"onNextPage","click  li:not(.disabled) > a.pagerPrevious":"onPreviousPage","click  a.page-size-link":"onSelectPageSize","click .export":"onExport"},initialize:function(){e.prototype.initialize.apply(this,arguments),_.bindAll(this,["_onPageData"])},render:function(){if(this.checkNoResults(this.queryResults)){var e="",t=this.queryResults[this.queryResults.DP.RESULT_MODELS];this._assignEntityColors();var i=this.sortBy[0],n=this.assignEntityFills(t,i),s=this.queryResults[this.queryResults.DP.GROUP_RESULTS].filter(function(e){return!e.isEmpty()});_.each(s,function(t){var i,n=t.getGroupMemberCounts();i=h,e+=i(this.vtOptions({isSelected:!1,isExpanded:!0,groupId:t.get(t.idAttribute),isAllEntitiesGroup:t.isAllEntitiesGroup(),groupName:t.getDisplayName(),groupSummaries:this._renderGroupSummaries(t),counts:n,entityType:o.getPluralEntityName(this.entityType),showExport:this.showExport(t)}))},this);var a=s.length,r=this.queryResults.total_group_count;a<r&&(e+=p({nbGroups:a,totalGroups:r})),this.$el.hide(),this.$el.html(u({html:e})),_.each(s,function(e){if(this._renderGroupPaginator(e),this._renderGroupMembers(e,n),e.isAllEntitiesGroup()){var t=this._renderAllGroupHeader(e);this.$(".summary-all-group").html(t)}},this),this.$el.show()}},renderMembers:function(e,t,i,n,s){},showPrimaryAsLink:function(){var e=this.visualizationAttributes[i.PRIMARY_ATTRIBUTE],t=this.getAttributeRenderer(e);return t&&!t.isNoneFormatter()&&t.hasDetailsPage(this.entityType)},onGroupSelection:function(e){var t=$(e.currentTarget).parents(".group-container"),i=t.attr("data-id");this.toggleEntitySelection(i)},onNextPage:function(e){var t=this._getGroupFromElement(e);t&&this.queryResults[this.queryResults.DP.PAGINATOR].loadNextPage(t,this._onPageData)},onPreviousPage:function(e){var t=this._getGroupFromElement(e);t&&this.queryResults[this.queryResults.DP.PAGINATOR].loadPreviousPage(t,this._onPageData)},onExport:function(e){var t=this._getGroupFromElement(e);if(t){var i=this.i18n("EBGroupedSections.exportMsg");$.nutanixConfirm({msg:i,hideNo:!0,hideYes:!0,suppressScale:!0,context:this});var n=this;this.loadGroupMembersForExport(this.entityType,t,function(e){n.exportGroup(t.getId(),e)})}},exportGroup:function(e,t){},showExport:function(e){return!1},_assignEntityColors:function(){this.assignEntityColors(this.getVisibleEntities(),this.colorBy||this.defaultColorBy)},_getGroupFromElement:function(e){var t=$(e.currentTarget).parents(".group-container"),i=t.attr("data-id");return this.queryResults[this.queryResults.DP.GROUP_RESULTS].findModelById(i)},_onPageData:function(e,t){if(t){if(this._assignEntityColors(),this._renderGroupPaginator(e),this._renderGroupMembers(e,!1),e.isAllEntitiesGroup()){var i=this._renderAllGroupHeader(e);this.$(".summary-all-group").html(i)}this.pageChangeCB&&this.pageChangeCB(e)}else s.showClientNotification(r.NOTIFY_ERROR,"There was an error retrieving paged data.")},_renderGroupSummaries:function(e){var i="",n=e.getSummaryAttributes();if(!_.size(n))return i;var s=e.get(e.DP.NAME),r=this.visualizationAttributes[c.DP.SUMMARIES][s]||{};return _.each(r,function(e){var s=e[c.DP.SUMMARY_FORMATTER];if(!s)return void o.log("Group summaries data won't be rendered due to missing formatter");var r=[],u=[];switch(_.each(e[c.DP.SUMMARY_AGGREGATES],function(e){var t=e[0],i=a.getAttributeDisplayValue(this.entityType,t,n[t]);u.push(i),r.push(n[t])},this),s){case d.STATS_USAGE_BAR:if(r[0]&&r[1]&&!isNaN(r[0])&&!isNaN(r[1])){var h=r[0]/r[1]*100,p=e.title,T=u[0]+" of "+u[1];i+=l.renderProgressBar({percentUsed:h,leftTextLabel:p,rightTextLabel:T})}else i+=t.NO_DATA_HTML(this.vtOptions());break;default:o.log("Group summary data won't be rendered due to missing formatter : "+s)}},this),i},_renderGroupPaginator:function(e){var t='.group-container[data-id="'+e.get(e.idAttribute)+'"]  .paginator',i=this.queryResults[this.queryResults.DP.PAGINATOR],s=i.getPaginationInfo(e);s.pageSizeOptions=this._needsPageSizeSelector(e)?this.PAGE_SIZE_OPTIONS:null,this.$(t).html(n.pager(s))},_needsPageSizeSelector:function(e){return e.isAllEntitiesGroup()},_renderGroupMembers:function(e,t){var i=e.get(e.idAttribute),n=this._groupEl(i);n.show();var s=this.queryResults[this.queryResults.DP.PAGINATOR],a=s.getCurrentPage(e),r=null!==this.getCurrentColorMap();this.renderMembers(i,n,a,r,t),this.renderEntityLabels(),this.renderHealthIcons(),this.renderTaskIcons()},_getSummaryDisplayName:function(e,t){var n;switch(e.toLowerCase()){case i.AGGREGATORS.AVERAGE:n="Avg ";break;case i.AGGREGATORS.MAX:n="Max ";break;case i.AGGREGATORS.MIN:n="Min ";break;case i.AGGREGATORS.SUM:n="Total ";break;case i.AGGREGATORS.COUNT:n="Count ";break;default:n=""}return n+a.getAttributeDisplayName(this.entityType,t)},_groupEl:function(e){var t='.group-container[data-id="'+e+'"] .members';return this.$(t)}})}),define("views/pages/ebrowser/viz/BaseTileVisualizationView",["views/pages/ebrowser/viz/EBGroupedSections","data/DataProperties","utils/EntityUtil"],function(e,t,i){"use strict";var n=_.template('<div class="entity-tile-wrapper"><div class="entity-tile entityTooltipTarget" data-id="<%= entityId %>" color-class="<%= colorClass %>" <%= getQaDataTestId(dataTestId) %> ><div class="tile-header clearfix"><input type="checkbox" class="tile-checkbox" <%= isSelected ? "checked" : "" %> data-class="-blue" <%= getQaDataTestId("select-tile-checkbox") %> ><div class="task-icon"></div><div class="label-icon labelTooltipTarget"></div><div class="health-icon"></div><%= customIcon %><div class="<%= entityNameClass %>" title="<%= primaryAttributeValue || "Unnamed" %>"> <% if ( colorClass ) { %><div class="css-icon state-icon <%= colorClass %>" title="<%= colorTip %>"></div> <% } %><%= primaryAttributeValue || "Unnamed" %></div><div class="icons-wrapper"></div></div><div class="tile-content"><div class="entity-info attribute-list -ellipsed"><%= entityAttributesHTML %></div></div></div></div>'),s=10;return e.extend({extraEvents:{"change #slider":"onSliderChange","change .tile-checkbox":"onEntitySelection","click  .tile-icon-small":"onSmallerSize","click  .tile-icon":"onLargerSize","click  .entity-name:not(.disabled)":"onEntityDetails"},initialize:function(){e.prototype.initialize.apply(this,arguments),this.addExtraEvents(this.extraEvents),this.setQaDataTestListPrefix(this.entityType)},renderMembers:function(e,s,a,r,o){this.clearTooltips();var l="",c=this.visualizationAttributes[t.PRIMARY_ATTRIBUTE],d=this.showPrimaryAsLink(),u=this.sortBy[0],h=this.getSelectedEntityIds();_.each(a,function(e){var t=i.getAttributeDisplayValue(this.entityType,c,e.getValue(c)),s=e.getValue(e.idAttribute),a=this.renderEntityAttributes(e,u);l+=n(this.vtOptions({entityId:s,isSelected:h.indexOf(s)>=0,primaryAttributeValue:t,entityAttributesHTML:a,colorClass:e[this.COLOR_ATTR.colorClass],colorTip:e[this.COLOR_ATTR.colorTip],customIcon:this.getCustomIconsPlaceholder(this.entityType,e),entityNameClass:d?"entity-name":"entity-name disabled",dataTestId:this.getQaDataTestListPrefixedId(s)}))},this),s.html(l),this.applyNutanixInput({types:["checkbox"]})},destroy:function(){this.clearTooltips(),e.prototype.destroy.apply(this,arguments)},renderEntityAttributes:function(e,i){var n,a="",r=this.visualizationAttributes[t.PRIMARY_ATTRIBUTE],o=0;return i&&i!==r?(a+=this.renderEntityAttribute(e,i,i),o++,n=_.without(this.visualizationAttributes[t.DISPLAY_ATTRIBUTES],r,i)):n=_.without(this.visualizationAttributes[t.DISPLAY_ATTRIBUTES],r),_.each(n,function(t){o<s&&(a+=this.renderEntityAttribute(e,t,i),o++)},this),a},higlightEntitiesByColor:function(e,t){_.each(this.$(".entity-tile"),function(i){var n=$(i),s=n.attr("color-class"),a=n.find(".state-icon");t&&e!==s?a.removeClass(s):a.addClass(s)},this)},onSliderChange:function(e){s=$(e.currentTarget).val(),this.render()},onLargerSize:function(e){s<5&&s++,this.render()},onSmallerSize:function(e){s>1&&s--,this.render()},onEntitySelection:function(e){var t=$(e.currentTarget).parents(".entity-tile"),i=t.attr("data-id");this.toggleEntitySelection(i)},onEntityDetails:function(e){var t=$(e.currentTarget).parents(".entity-tile"),i=t.attr("data-id");this.showEntityDetails(i)}})}),define("views/pages/ebrowser/viz/BaseTableVisualizationView",["views/pages/ebrowser/viz/EBGroupedSections","views/pages/ebrowser/viz/EBTableView","utils/AppUtil","utils/AppConstants","utils/DataExportUtil","utils/SubViewHelper"],function(e,t,i,n,s,a){"use strict";return e.extend({subViewHelper:null,initialize:function(t){e.prototype.initialize.apply(this,arguments),this.options=t,this.subViewHelper=new a},destroy:function(){this.clearTooltips(),this.subViewHelper.destroy(),this.subViewHelper=null,e.prototype.destroy.call(this,arguments)},createDataTable:function(e,t){var i=this.subViewHelper.get(e);i&&this.removeDataTable(e);var n=this.options;return t&&(n=_.extend(this.options,t)),i=this.getEBTableView(n),i.onStartServices(),this.subViewHelper.register(e,i),i},getEBTableView:function(e){var i=this;return new t(_.extend(e,{onDrawCallback:function(){},onEntityDetails:function(e){i.showEntityDetails(e)},isSelectAllEntitiesEnabled:function(){return i.isSelectAllEntitiesEnabled()}}))},removeDataTable:function(e){var t=this.subViewHelper.get(e);t&&(t.stopServices(),this.subViewHelper.remove(e))},higlightEntitiesByColor:function(e,t){_.each(this.$("tr"),function(i){var n=$(i),s=n.attr("color-class"),a=n.find(".state-icon");t&&e!==s?a.removeClass(s):a.addClass(s)},this)},renderMembers:function(e,t,i,n,s){var a=this.subViewHelper.get(e);a||(a=this.createDataTable(e,{el:t,defaultMinRows:this.MAX_PAGE_SIZE}),a.render()),a.setSelectedEntityIds(_.clone(this.selectionsModel.getSelectedEntityIds(this.entityType))),a.updateDataSource(i)},isSelectAllEntitiesEnabled:function(){return!1},exportGroup:function(e,t){var a=this.subViewHelper.get(e),r=null;i.getBrowser()===n.BROWSER_AGENT.SAFARI&&(r=s.openExportWindow());var o=t;o.length>1e3&&(o=_.first(o,1e3)),s.exportTableCSV(o,a.getColumnsToExport(),{},r),$("#nutanixConfirmModal .btnYes").click()},showExport:function(e){return e.isAllEntitiesGroup()}})}),define("views/pages/ebrowser/viz/BaseCirclesVisualizationView",["views/pages/ebrowser/viz/BaseVisualizationView","d3","nvd3","d3tip","data/DataProperties","utils/AppConstants","utils/AppUtil","utils/EntityUtil","utils/D3Util","utils/StyleDescriptor"],function(e,t,i,n,s,a,r,o,l,c){"use strict";var d=_.template('<div class="nvpair"><div class="value"><%= value %></div></div><% if ( colorTip ) { %> <div class="nvpair"><div class="value"><%= colorTip %></div></div><% } %>');return e.extend({_svg:null,_svgCircles:null,_tip:null,events:{"mousedown g.circleG":"onCircleClick","mouseover g.circleG":"onCircleMouseOver","mouseout  g.circleG":"onCircleMouseOut","mousedown text.load-more-entities":"onLoadMore"},destroy:function(){this._clearView(),e.prototype.destroy.call(this,arguments)},getVisualizationCapabilities:function(){var e={};return e[a.EB_VIZ_CAPABILITIES.CAN_PAGINATE]=!1,e},onCircleClick:function(e){var t=$(e.currentTarget).attr("data-id");this.toggleCircleSelection([t])},onCircleMouseOver:function(e){var t=$(e.currentTarget).attr("data-id");this._onCircleMouseHover(t,!0,!0)},onCircleMouseOut:function(e){var t=$(e.currentTarget).attr("data-id");this._onCircleMouseHover(t,!1,!1)},onLoadMore:function(e){this.loadMoreEntities(this.entityType)},toggleCircleSelection:function(e){_.each(e,function(e){var t=this._findQueryResultsModelById(e);t.selected=!t.selected,this.renderCircleSelection(t,e)},this),this.toggleEntitySelection(e)},selectAllCircles:function(e){_.each(e,function(e){var t=this._findQueryResultsModelById(e);t.selected=!0,this.renderCircleSelection(t,e)},this),this.appendSelectedEntityIds(e)},renderCircleSelection:function(e,t){
var i=this._svg.select('g[data-id="'+t+'"]'),n=e.selected?"visible":"hidden";i.select("rect").style("visibility",n),i.select("polyline").style("visibility",n),this.outlineCircle(e,i,e.selected)},outlineCircle:function(e,t,i){i?t.moveToFront():t.moveToBack();var n=i?c.EB.CIRCLE_HIGHLIGHT_COLOR:null;t.select("circle").style("stroke",n)},initialize:function(){e.prototype.initialize.apply(this,arguments),l.addSelectionHelpers()},render:function(){if(this.checkNoResults(this.queryResults)){this.$el.html('<div class="vizContent"></div>');var e=this,i=(this.sortBy[0],$(".perspective-container").width()),n=$(".perspective-container").height(),s=this.queryResults.models,a=this.getSelectedEntityIds();_.each(s,function(e){e.selected=a.indexOf(e.getValue(e.idAttribute))>=0});this.getSizeByAttr();this.assignEntityColors(s,this.colorBy||this.defaultColorBy),this._tip=t.tip().attr("class","d3-tip eb-circles-tooltip").offset(function(){return e.isSelecting?[-1e4,-1e4]:[-10,0]}).html(function(t){return e.renderEntityTooltip(t)}),this._clearView(),this._svg=t.select(this.$(".vizContent")[0]).append("svg").attr("width",i).attr("height",n).attr("class","d3-entity-circles").call(this._tip);var r=this._svg.selectAll(".node").data(s);_.each(s,function(e){e.r=10}),this._linearLayout(s,i,n);var o=function(t){return t[e.COLOR_ATTR.colorClass]||"eb-circle-default-color"},d=r.enter().append("g").attr("class","circleG").attr("data-idx",function(e,t){return t}).attr("data-id",function(e,t){return e.getValue(e.idAttribute)}).attr("transform",function(e){return"translate("+e.x+","+e.y+")"});d.append("circle").attr("r",function(e){return e.r}).attr("rInit",function(e){return e.r}).attr("class",o).style("stroke-width",1).attr("oClass",o);d.append("polyline").style("stroke",c.EB.CIRCLE_CHECK_COLOR).style("stroke-width",2).style("fill","none").style("visibility",function(e){return e.selected?"visible":"hidden"}).attr("points",function(e){var t=[];return t.push(0-e.r/2),t.push(0),t.push(0-e.r/6.66),t.push(0+e.r/2.89),t.push(0+e.r/2),t.push(0-e.r/2.5),t.join(",")}),l.addDragSelect(this._svg,function(){e.isSelecting=!0},function(e){},function(t){e.isSelecting=!1,e.selectCirclesWithinRect(t)},30,0),this._svgCircles=this._svg.selectAll("circle")}},renderLegend:function(e){},renderEntityLabels:function(){},renderTaskIcons:function(){},renderHealthIcons:function(){},renderCustomPrimaryIcons:function(){},renderPrimaryColumnIcons:function(){},onSelectionChange:function(){var e=this.queryResults[this.queryResults.DP.GROUP_RESULTS];if(1===e.length){var t=e.first();if(t.isAllEntitiesGroup()){var i=this._getAllEntitiesGroupHeader(t);this._svg.select(".section-header > tspan").text(i)}}},renderEntityTooltip:function(e){var t=this.visualizationAttributes[s.PRIMARY_ATTRIBUTE],i=o.getAttributeDisplayName(this.entityType,t),n=e.getValue?e.getValue(t):r.getJSONValue(e,t);n&&n.length||(n=" - ");var a=e[this.COLOR_ATTR.colorTip];return d({name:i,value:n,colorTip:a})},highlightEntitiesById:function(e){this._svgCircles.filter(function(t){return e.indexOf(t.id)>=0}).each(function(){t.select(this).transition().duration(3e3).attr("stroke-width",1).attr("r",15).style("fill","rgb(73, 116, 159)").transition().duration(3e3).attr("stroke-width",1).attr("r",10).style("fill",function(){return t.select(this).attr("oFill")}).ease("sine")})},higlightEntitiesByColor:function(e,i){this._svgCircles.filter(function(i){return t.select(this).attr("class")!==e}).attr("class",function(){return i?"eb-circle-no-color":t.select(this).attr("oClass")})},higlightCirclesWithinRect:function(e){var t=this;this._svgCircles.each(function(i){e&&i.x>=e.x&&i.x<=e.x+e.width&&i.y>=e.y&&i.y<=e.y+e.height?t._onCircleMouseHover(i.id,!0,null):t._onCircleMouseHover(i.id,!1,null)})},selectCirclesWithinRect:function(e){var t=this,i=e.x,n=e.x+e.width,s=e.y,a=e.y+e.height,r=!1,o=[],l=!0,c=!0;this._svgCircles.each(function(e){!r&&e.x>=i&&e.x<=n&&e.y>=s&&e.y<=a?(o.push(e.id),e.selected?c=!1:l=!1):e.y>a&&(r=!0)}),o.length&&(l||c?t.toggleCircleSelection(o):t.selectAllCircles(o))},assignTooltips:function(e){},clearTooltips:function(){$(".d3-tip").remove()},onResize:function(){this.render()},_findQueryResultsModelById:function(e){return _.find(this.queryResults.models,function(t){return t.get(t.idAttribute)===e})},getVisibleEntities:function(){return this.queryResults?this.queryResults.models:[]},getCircleTextAttribute:function(){return this.visualizationAttributes[s.PRIMARY_ATTRIBUTE]},getSizeByAttr:function(){return null},getSizeValue:function(e){return 1},_linearLayout:function(e,i,n){var s=this,o=0,l=0,d=4,u=0,h=[],p={},T=this.$el.width()-30,E=this.queryResults[this.queryResults.DP.GROUP_RESULTS];E.each(function(e){var t=e.get(e.DP.NAME),i=e.getMembers(),n=c.getUniqueChartColor(h);h.push(n),p[t]=d,o=d+60,_.each(i,function(e,t){e[s.COLOR_ATTR.sectionColorValue]=n,0===t&&(l=20-(e.r+5));var i=l+(2*e.r+10),a=o;i+e.r+10>T&&(i=20+(e.r+5),a=o+(2*e.r+10)),e.x=l=i,e.y=o=a,u=l+e.r+20,d=o+e.r+20})},this);var g=0,S=0,m=this.queryResults[this.queryResults.DP.GROUP_RESULTS].filter(function(e){return!e.isEmpty()});if(this._svg.selectAll("text").data(m).enter().append("g").each(function(e){var i=t.select(this);if(i.append("svg:text").attr("text-anchor","left").attr("class","section-header").attr("x",function(e){return 20}).attr("y",function(e){var t=e.get(e.DP.NAME);return p[t]+10}).each(function(e){var i=t.select(this),n=e.getDisplayName();e.isAllEntitiesGroup()&&(n=s._getAllEntitiesGroupHeader(e)),i.append("tspan").text(n);var a=e.getGroupMemberCounts();S+=a.available,a.available<a.total&&(g+=a.total-a.available)}),!e.isAllEntitiesGroup()){var n=i.append("rect").attr("class","count-rect").attr("fill","#ffffff").style("stroke-width",1).style("stroke","#eaeaea"),a=i.append("svg:text").attr("text-anchor","end").attr("class","section-count").attr("x",function(e){return T-4}).attr("y",function(e){var t=e.get(e.DP.NAME);return p[t]+12}).each(function(e){var i,n=t.select(this),a=e.getGroupMemberCounts();i=a.available<a.total?Number(a.available).toLocaleString()+" / "+Number(a.total).toLocaleString():a.available,i+=" "+r.getPluralEntityName(s.entityType)+" ",n.append("tspan").text(i)}),o=a[0][0].getBBox();n.attr({x:o.x-4,y:o.y-2,width:o.width+8,height:o.height+4})}}),g>0){var v=S<a.MAX_ENTITIES;this._svg.append("svg:text").attr("text-anchor","left").attr("class",function(){return v?"load-more-entities":"too-many-entities"}).attr("x",20).attr("y",d+20).text(function(){return(v?"Load more ":"Limit reached. Please use filters to reduce the number of ")+r.getPluralEntityName(s.entityType)+" "}),d+=40}else{E.length<this.queryResults.total_group_count&&(this._svg.append("svg:text").attr("text-anchor","left").attr("class","too-many-groups").attr("x",20).attr("y",d+20).text("Too many resulting groups.  Please use filters to reduce the number of groups."),d+=40)}var f=d+40;this._svg.attr("height",f),this.$(".vizContent").height(f+40)},_onCircleMouseHover:function(e,t,i){var n=this._svg.select('g[data-id="'+e+'"]'),s=this._findQueryResultsModelById(e);if(this.outlineCircle(s,n,t?!s.selected:s.selected),null!==i)if(i){var a=n.select("circle");this._tip.show(s,a[0][0])}else this._tip.hide()},_getAllEntitiesGroupHeader:function(e){var t=r.getPluralEntityName(this.entityType),i=this.getSelectedEntityIds(this.entityType),n=e.get(e.DP.TOTAL_ENTITY_COUNT),s="";if(i.length>0){var a=[];_.each(this.queryResults.models,function(e){a.push(e.getValue(e.idAttribute))});var o=_.intersect(a,i);s=Number(o.length).toLocaleString()+" Selected / "+Number(n).toLocaleString()+" "+t}else s=0===n?"There are no "+t+" available.":Number(n).toLocaleString()+" Total "+t;return s},_clearView:function(){this._svg&&(l.removeDragSelect(this._svg),this._svg.remove(),this._svg=null,this._svgCircles=null,this.clearTooltips())}})}),define("views/pages/ebrowser/viz/EBGroupedTableView",["views/pages/ebrowser/viz/EBTableView","managers/EntityManager","managers/NavigationManager","data/DataProperties","utils/AppConstants"],function(e,t,i,n,s){"use strict";var a=_.template('<a id="<%= id %>" class="expand-row"><%= i18n("showMore") %> <%= SVG.SVGIcon("z", "-down-arrow") %></a>'),r=_.template('<a id="<%= id %>" class="collapse-row"><%= i18n("showLess") %> <%= SVG.SVGIcon("w", "-up-arrow") %></a>');return e.extend({name:"EBGroupedTableView",expandedRows:null,extraEvents:{'click th:not(".select-all")':"onTableHeaderClick","click .pageLink":"onEntityDetailsClick","click .category-link":"onCategoriesLinkClick","click .expand-row":"onExpandRow","click .collapse-row":"onCollapseRow"},initialize:function(t){e.prototype.initialize.apply(this,arguments),this.addExtraEvents(this.extraEvents),this.expandedRows={}},updateDataSource:function(e){var i=[];this.queryResults=e;var s=e[e.DP.PAGINATOR],a=s.getCurrentPage(),r=this.getDefaultColumns();_.each(a,function(e){var s=e.getMembers(),a={};_.each(r,function(e){a[e.mData]=null});var o=e.get("name")||e.get("group_name");a=_.extend(a,{entity_id:o,name:o});var l=t.createGenericEntityModel(this.entityType,{});if(l.set(a),void 0===this.expandedRows[l.id]&&(this.expandedRows[l.id]=!1),l[n.EXPANDED]=this.expandedRows[l.id],l[n.GROUP]=e,i.push(l),this.expandedRows[l.id])for(var c=0;c<s.length;c++){var d=s[c];d[n.EXPANDED]=null,d[n.GROUP]=null,i.push(d)}},this),this.setSelectedEntityIds(_.clone(this.selectionsModel.getSelectedEntityIds(this.entityType))),this.model.reset(i),this._setAnchorEntityId(null)},isSortByAttributeEnabled:function(e){return!1},_getDefaultColumnsWrapper:function(){var t=this,i=e.prototype._getDefaultColumnsWrapper.apply(this,arguments),a=this.visualizationAttributes[n.VIRTUAL_ATTRIBUTES];return _.contains(a,s.GROUPED_GRID_EXPAND_ROW)&&i.push({sTitle:"",mData:n.EXPANDED,ntnxAttr:n.EXPANDED,exportable:!1,sWidth:"100px",sClass:"",bSortable:!1,sType:"html",mRender:function(e,i,n){return i===s.TABLE_COL_TYPE_EXPORT?"":t.renderExpandCollapseLink(e,i,n)}}),i},renderColumnCheckbox:function(t,i,n){return this.isParentRow(n)?e.prototype.renderColumnCheckbox.apply(this,arguments):""},renderPrimaryColumnCell:function(t,i,n,s){return this.isParentRow(n)?e.prototype.renderPrimaryColumnCell.apply(this,arguments):""},renderExpandCollapseLink:function(e,t,i){var s=this.queryResults[this.queryResults.DP.GROUP_RESULTS].find(function(e){return e.get("group_name")===i.get("name")});if(s&&s.getMembers().length>0){var o=i[n.EXPANDED];return null===o?"":o?r(this.vtOptions({id:i.id})):a(this.vtOptions({id:i.id}))}return""},isParentRow:function(e){return null!==e[n.GROUP]},_dataTableRowCallback:function(t,i,s){var a=e.prototype._dataTableRowCallback.apply(this,arguments);return $(t).attr("data-expanded",i[n.EXPANDED]).attr("data-parent",this.isParentRow(i)),a},onExpandRow:function(e){var t=$(e.currentTarget).attr("id");this.expandedRows[t]=!0,this.updateDataSource(this.queryResults)},onCollapseRow:function(e){var t=$(e.currentTarget).attr("id");this.expandedRows[t]=!1,this.updateDataSource(this.queryResults)},onCategoriesLinkClick:function(e){var t=$(e.currentTarget).attr("data-category"),n=$(e.currentTarget).attr("data-etype");i.categoriesSearch(n,t)}})}),define("views/pages/ebrowser/viz/BaseGroupedTableVisualizationView",["components/Components","views/pages/ebrowser/viz/BaseVisualizationView","views/pages/ebrowser/viz/EBGroupedTableView","managers/NotificationManager","utils/EntityUtil","utils/AppUtil","utils/AppConstants","utils/SubViewHelper"],function(e,t,i,n,s,a,r,o){"use strict";var l=_.template('<div class="groupedViz"><div class="group-container"><div class="header"><div class="header-element"><div class="summary-all-group"><%= header %></div><div class="query-busy"></div></div><div class="header-element"><% if (showExport) { %><div class="export" data-id="<%= groupId %>" title="<%= i18n("Export") %>" <%= getQaDataTestId("export") %>><%= SVG.SVGIcon("Export") %></div><div class="export-separator"></div><% } %><div class="paginator"></div></div></div><div class="members expandable-data-table"></div></div></div>');return t.extend({subViewHelper:null,events:{"click  a.page-size-link":"onSelectPageSize","click  li:not(.disabled) > a.pagerNext":"onNextPage","click  li:not(.disabled) > a.pagerPrevious":"onPreviousPage"},initialize:function(e){t.prototype.initialize.apply(this,arguments),this.options=e,this.subViewHelper=new o,_.bindAll(this,["_onPageData"])},destroy:function(){this.clearTooltips(),this.subViewHelper.destroy(),this.subViewHelper=null,t.prototype.destroy.apply(this,arguments)},render:function(){if(this.checkNoResults(this.queryResults)){var e="grouped-table-"+this.entityType,t=this._renderHeader();this.$el.html(l(this.vtOptions({showExport:!1,header:t})));var i=this.createDataTable(e,{el:this.$(".members"),defaultMinRows:this.MAX_PAGE_SIZE});i.render(),i.setSelectedEntityIds(_.clone(this.selectionsModel.getSelectedEntityIds(this.entityType))),this._renderPaginator(),i.updateDataSource(this.queryResults),this.$(".members").show()}},createDataTable:function(e,t){var i=this.subViewHelper.get(e);i&&this.removeDataTable(e);var n=this.options;return t&&(n=_.extend(this.options,t)),i=this.getEBTableView(n),i.onStartServices(),this.subViewHelper.register(e,i),i},getEBTableView:function(e){var t=this;return new i(_.extend(e,{onDrawCallback:function(){},onEntityDetails:function(e){t.showEntityDetails(e)},isSelectAllEntitiesEnabled:function(){return!1}}))},removeDataTable:function(e){var t=this.subViewHelper.get(e);t&&(t.stopServices(),this.subViewHelper.remove(e))},onSelectionChange:function(){var e=this._renderHeader();this.$(".summary-all-group").html(e)},getVisibleEntities:function(){var e=[];if(this.queryResults){var t=this.queryResults[this.queryResults.DP.PAGINATOR];_.each(t.getCurrentPage(),function(t){e=e.concat(t)})}return e},_renderHeader:function(){var e=this.getSelectedEntityIds(this.entityType),t=this.queryResults[this.queryResults.DP.PAGINATOR],i=t.getGroupVisibleSelectedIds(null,e),n=i.length,s=this._getHeaderTemplateOptions(n)||{},a=s.sNbMembers,r=s.nbSelectedMsg,o=s.rangeMsg,l=s.noneMsg,c=s.nbSelected;return this.UNGROUPED_HEADER_TEMPLATE({value:a,nbSelectedMsg:r,rangeMsg:o,noneMsg:l,nbSelected:c})},_getHeaderTemplateOptions:function(e){var t=this.queryResults[this.queryResults.DP.FILTERED_GROUP_COUNT],i=a.getPluralEntityName(this.entityType),n=this.queryResults[this.queryResults.DP.TOTAL_GROUP_COUNT],s=this.getSelectedMsg(null,e,t,n),r=Number(t).toLocaleString();return{sNbMembers:r,nbSelectedMsg:s,rangeMsg:a.sprintf(this.i18n("rangeMsg","%s Total %s"),r,i),noneMsg:a.sprintf(this.i18n("noneMsg","There are no %s available"),i),nbSelected:e}},_renderPaginator:function(){var t=this.queryResults[this.queryResults.DP.PAGINATOR],i=t.getPaginationInfo(this.queryResults);i.pageSizeOptions=this._needsPageSizeSelector()?this.PAGE_SIZE_OPTIONS:null,this.$(".paginator").html(e.pager(i))},_needsPageSizeSelector:function(){return!s.isGroupedEntityType(this.entityType)},onNextPage:function(e){this.queryResults[this.queryResults.DP.PAGINATOR].loadNextPage(null,this._onPageData)},onPreviousPage:function(e){this.queryResults[this.queryResults.DP.PAGINATOR].loadPreviousPage(null,this._onPageData)},_onPageData:function(e,t){if(t){this._renderPaginator();var i="grouped-table-"+this.entityType;this.subViewHelper.get(i).updateDataSource(this.queryResults);var s=this._renderHeader();this.$(".summary-all-group").html(s),this.pageChangeCB&&this.pageChangeCB(e)}else n.showClientNotification(r.NOTIFY_ERROR,this.i18n("BaseGroupedTableVisualization.errorFetchingPagedData"))}})}),define("views/pages/ebrowser/viz/plugins/BaseServicePluginView",["views/pages/ebrowser/viz/BaseVisualizationView","utils/ViewUtil","events/AppEvents","utils/AntiscrollUtil"],function(e,t,i,n){"use strict";return e.extend({name:"BaseServicePluginView",className:"vizContent",tagName:"div",isServicePlugin:!0,perspectivesView:null,vizAttributes:{},isFullSize:!1,isVerticalMiddleContent:!1,initialize:function(t){e.prototype.initialize.apply(this,arguments),_.bindAll(this,"onScrollersRefreshed"),this.perspectivesView=t.perspectivesView,this.vizAttributes=(t.viz||{}).entityAttributes||{},i.onAppEvent(i.EB_SCROLLERS_REFRESHED,this.onScrollersRefreshed)},destroy:function(){this.backToInitialConfig(),e.prototype.destroy.apply(this,arguments)},backToInitialConfig:function(){this.perspectivesView.showHeader(),this.backToDefViewConfigs(),i.offAppEvent(i.EB_SCROLLERS_REFRESHED,this.onScrollersRefreshed)},showView:function(){e.prototype.showView.apply(this,arguments),t.hideLoader(),this.perspectivesView.hideHeader()},getCurrentVisualizationName:function(){return this.perspectivesView.getCurrentVisualizationName()},backToDefViewConfigs:function(){this.setDefContentPaddings(),this.makeVizDefaultAlign()},updateSize:function(){},getAntiscrollInstance:function(){return this.$el.closest(".antiscroll-wrap").data("antiscroll")},triggerVisualization:function(e){this.perspectivesView.selectEntityTypeVisualization(this.entityType,e,!0)},triggerNextVisualization:function(){if(!_.isString(this.vizAttributes.nextViz))throw new Error("Next visualization name isn't specified");this.triggerVisualization(this.vizAttributes.nextViz)},makeVerticalMiddleAlign:function(){this.isVerticalMiddleContent||(this.getPerspContainer().addClass("vertical-middle-content"),this.$el.addClass("vertical-middle"),this.isVerticalMiddleContent=!0,this.stretchContent(),this.removeContentPaddings())},makeVizDefaultAlign:function(){this.isVerticalMiddleContent&&(this.getPerspContainer().removeClass("vertical-middle-content"),this.$el.removeClass("vertical-middle"),this.isVerticalMiddleContent=!1)},getPluginContentMaxHeight:function(){return $(window).height()-$(".navbar").outerHeight(!0)-$("#n-notification-bar").outerHeight(!0)-(this.getPerspContainer().outerHeight(!0)-this.getPerspContainer().height())},getContentMaxWidth:function(){return this.$el.closest(".center-panel").width()},updateAntiscroll:function(){n.refreshAntiscroll(this.getAntiscrollInstance())},stretchContent:function(){this.getPerspContainer().height(this.getPluginContentMaxHeight()).width(this.getContentMaxWidth()),this.$el.height("100%")},removeContentPaddings:function(){this.isFullSize||(this.isFullSize=!0,this.getPerspContainer().addClass("paddingless").width("100%"))},setDefContentPaddings:function(){this.isFullSize&&(this.isFullSize=!1,this.getPerspContainer().removeClass("paddingless"))},hidePerspectiveLoadingPanel:function(){this.perspectivesView.hideLoadingPanel()},showPerspectiveLoadingPanel:function(){this.perspectivesView.showLoadingPanel()},isSelfContainedVisualization:function(){return!0},onScrollersRefreshed:function(){this.onUpdateSize()},onUpdateSize:function(){this.backToDefViewConfigs(),this.updateSize(),this.updateAntiscroll()},onStartServices:function(){},getPerspContainer:function(){return this.$el.closest(".perspective-container")}})}),define("views/entity/onboarding/steps/listtypes/EntityOnboardingStepTableListMixin",[],function(){"use strict";return{className:"step-line",stepTemplate:_.template('\n      <div class="step-badge"><span><%- num %></span></div>\n      <div class="step-caption"><%- caption %></div>\n      <div class="step-actions actionContainer">action</div>')}}),define("views/entity/onboarding/steps/listtypes/EntityOnboardingSingleStepListMixin",[],function(){"use strict";return{className:"single-step",stepTemplate:_.template('\n      <div data-ntnx-empty-list>\n        <section data-ntnx-section="type-text">\n          <%= caption %>\n        </section>\n        <section data-ntnx-section class="actionContainer">action</section>\n      </div>'),hideTitle:function(){this.$("section[data-ntnx-section=type-text]").addClass("hidden")}}}),define("views/entity/onboarding/steps/EntityOnboardingStepView",["sprintf","components/Components","views/basecomponents/BaseView","managers/ActionManager","views/entity/onboarding/steps/listtypes/EntityOnboardingStepTableListMixin","views/entity/onboarding/steps/listtypes/EntityOnboardingSingleStepListMixin"],function(e,t,i,n,s,a){"use strict";var r={TABLE:"table",SINGLE_STEP:"singleStep"},o=_.template(t.button({text:"<%- caption %>",isPrimary:!0})),l=_.template('\n      <div class="donut-loader-blue"><div class="loader-head"></div></div>\n      <span><%- caption %></span>'),c=_.template(t.button({text:"<%- caption %>",disabled:!0})),d=_.template('\n      <div class="done"><%- caption %></div>'),u=_.template('\n      <div class="error"><%- caption %></div>');return i.extend({stepTemplate:null,actionLinkTemplate:o,actionDoneTemplate:d,actionInProgressTemplate:l,actionWaitingTemplate:c,actionErrorTemplate:u,name:"EntityOnboardingStepView",tagName:"li",STEP_STATUSES:{NOT_STARTED:"notStarted",PENDING:"pending",COMPLETED:"completed",ERROR:"error"},LIST_TYPES:r,stepPosition:null,stepName:null,stepType:null,hasAccessToStep:null,stepStatus:null,configLinkNav:null,stepCaption:null,configLinkCaption:null,inProgressCaption:null,doneCaption:null,waitingCaption:null,updateStatus:null,previousStep:null,hideBadge:!1,onPending:null,onConfigClickHandler:null,initialize:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i.prototype.initialize.call(this,e),this.on("onStatusChanged",this.onStatusChanged),this.hasAccessToStep=!_.isBoolean(e.hasAccess)||e.hasAccess,this.hideBadge=!0===e.hideBadge,this.stepPosition=this.getRequiredProp(e,"position"),this.stepName=this.getRequiredProp(e,"name"),this.stepType=this.getRequiredProp(e,"type"),this.configLinkNav=e.configLinkNav,this.onPending=_.isFunction(e.onPending)?e.onPending:null,this.onPending=_.isFunction(e.onPending)?e.onPending:null,this.onConfigClickHandler=_.isFunction(e.onConfigClickHandler)?e.onConfigClickHandler:null,this.initCaptions(this.getRequiredProp(e,"captions")),_.isFunction(this.updateStatus)||(this.updateStatus=this.getRequiredProp(e,"updateStatus").bind(this));var t=e.stepListType||this.LIST_TYPES.TABLE;this._mixWithListTypeObject(t)},_mixWithListTypeObject:function(e){var t=this,i=void 0;switch(e){case this.LIST_TYPES.SINGLE_STEP:i=a;break;default:i=s}_.each(i,function(e,i){t[i]=e})},initCaptions:function(e){this.stepCaption=e.step||this.stepCaption||"",this.configLinkCaption=e.configLink||this.configLinkCaption||this.i18n("config_link_caption"),this.inProgressCaption=e.inProgress||this.inProgressCaption||this.i18n("in_progress_caption"),this.doneCaption=e.done||this.done||this.i18n("done_caption"),this.waitingCaption=e.waiting||this.waitingCaption||this.i18n("waiting_caption")},setPreviousStep:function(e){_.isObject(e)&&(this.previousStep=e,this.previousStep.on("onStatusChanged onPreviousStepStatusChanged",this.onPreviousStepStatusChanged,this))},getStepNumForDisplay:function(){return String(this.stepPosition+1)},getRequiredProp:function(e,t){if(_.isUndefined(e[t]))throw new Error("Property options."+t+" is required.");return e[t]},render:function(){return this.tagName&&(this.$el=$("<"+this.tagName+"/>")),this.className&&this.$el.addClass(this.className),this.$el.html(this.stepTemplate({num:this.getStepNumForDisplay(),caption:this.stepCaption})),this.hideBadge&&this.$(".step-badge").remove(),this.updateActions(),this.$el},getPreviousStep:function(e){for(var t=this.previousStep;_.isObject(t);){if(e(t))return t;t=t.previousStep}},getNotCompletedPreviousStep:function(){return this.getPreviousStep(function(e){return!e.isCompleted()})},setActiveStep:function(e){this.$el.toggleClass("active",e)},updateActions:function(){this.setActiveStep(!1),this.isError()?this.setActionErrorCaption():this.isNotStarted()?_.isObject(this.getNotCompletedPreviousStep())?this.setActionWaitingCaption():this.setActionConfigLink():this.isPending()?this.setActionInProgressCaption():this.setActionDoneCaption()},setActionErrorCaption:function(){this.getActionsContainerEl().html(this.actionErrorTemplate({caption:this.getErrorText()}))},getErrorText:function(){},setActionConfigLink:function(){var e=$(this.actionLinkTemplate({caption:this.configLinkCaption}));e.click(this.onConfigClick.bind(this)),this.getActionsContainerEl().html("").append(e),this.setActiveStep(!0)},setActionDoneCaption:function(){this.getActionsContainerEl().html(this.actionDoneTemplate({caption:this.doneCaption}))},setActionInProgressCaption:function(){this.getActionsContainerEl().html(this.actionInProgressTemplate({caption:this.inProgressCaption})),this.setActiveStep(!0)},setActionWaitingCaption:function(){var t=this.getNotCompletedPreviousStep().getStepNumForDisplay();this.getActionsContainerEl().html(this.actionWaitingTemplate({caption:e.sprintf(this.waitingCaption,t)}))},getStatus:function(){return this.stepStatus},isCompleted:function(){return this.getStatus()===this.STEP_STATUSES.COMPLETED},isPending:function(){return this.getStatus()===this.STEP_STATUSES.PENDING},isNotStarted:function(){return this.getStatus()===this.STEP_STATUSES.NOT_STARTED},isError:function(){return this.getStatus()===this.STEP_STATUSES.ERROR},setStatus:function(e){this.stepStatus=e,this.trigger("onStatusChanged")},onPreviousStepStatusChanged:function(){this.trigger("onPreviousStepStatusChanged",this),this.updateActions()},onStatusChanged:function(){this.updateActions(),this.isPending()&&_.isFunction(this.onPending)&&this.onPending()},onConfigClick:function(){this.onConfigClickHandler?this.onConfigClickHandler():n.executeAction(this.configLinkNav)},getActionsContainerEl:function(){return this.$(".actionContainer")}},{LIST_TYPES:r})}),define("views/entity/onboarding/steps/EntityOnboardingServiceStepView",["views/entity/onboarding/steps/EntityOnboardingStepView","utils/ManagerMixin","events/AppEvents"],function(e,t,i){"use strict";return e.extend({name:"EntityOnboardingServiceStepView",serviceModel:null,serviceName:null,isSimpleEnablement:!1,serviceManager:null,initialize:function(n){var s=this;this.serviceManager=t.getServiceManager(),this.serviceName=this.getRequiredProp(n,"serviceName"),this.serviceModel=this.serviceManager.getServiceModel(this.serviceName),this.isSimpleEnablement=this.serviceManager.isSimpleEnablementService(this.serviceName),this.isSimpleEnablement||(n.configLinkNav=n.configLinkNav||this.serviceManager.getEnablingPopupNavData(this.serviceName)),i.onAppEvent(i.SERVICE_STATE_CHANGED,function(e,t){t.getServiceName()===s.serviceName&&s.updateStatus()}),e.prototype.initialize.call(this,n)},getErrorText:function(){return this.serviceModel.getErrorText()},updateStatus:function(){var e=this;this.serviceManager.collectionFetched(function(){var t=void 0;e.serviceModel.isDisabled()?t=e.STEP_STATUSES.NOT_STARTED:e.serviceModel.isEnabling()?t=e.STEP_STATUSES.PENDING:e.serviceModel.isEnabled()?t=e.STEP_STATUSES.COMPLETED:e.serviceModel.isError()&&(t=e.STEP_STATUSES.ERROR),e.setStatus(t)})},onConfigClick:function(){this.isSimpleEnablement?this.serviceManager.showEnablementConfirmationPopup(this.serviceName):e.prototype.onConfigClick.apply(this,arguments)}})}),define("views/entity/onboarding/BaseEntityOnboardingView",["views/basecomponents/BaseView","views/entity/onboarding/steps/EntityOnboardingStepView","views/entity/onboarding/steps/EntityOnboardingServiceStepView"],function(e,t,i){"use strict";var n=_.template('\n      <% if (title) { %>\n        <h2 class="title"><%= title %></h2>\n      <% } %>\n      <div class="text">\n        <% if (description) { %>\n          <p><%= description %></p>\n        <% } %>\n        <p class="inaccessible"><%= inaccessible_text %></p>\n        <% if (steps_title) { %>\n          <p class="accessible"><%= steps_title %></p>\n        <% } %>\n      </div>\n      <ol data-ntnx-ol data-ntnx-section class="steps accessible"></ol>');return e.extend({name:"BaseEntityOnboardingView",DP:{STEP_TYPES:{SERVICE_ENABLEMENT:"serviceEnablement",CUSTOM:"custom"}},EVENTS:{STATE_CHANGED:"stateChanged"},template:n,customTemplate:null,titleTemplate:null,descriptionTemplate:null,inaccessibleTextTemplate:null,stepsTitleTemplate:null,tagName:"div",className:"entity-onboarding",container:null,onCompleteHander:null,steps:null,isAllStepsUpdated:!1,onStepsCompletedCallback:null,onStepsNotCompletedCallback:null,initialize:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.prototype.initialize.call(this,t),this.container=t.container||null,this._setupSteps()},destroy:function(){this.onStepsCompletedCallback=null,this.onStepsNotCompletedCallback=null,e.prototype.destroy.apply(this,arguments)},_setupSteps:function(){var e=this;this.steps=[];var i=this.getSteps(),n=t.LIST_TYPES,s=n.TABLE;1===i.length&&(s=t.LIST_TYPES.SINGLE_STEP),_.each(i,function(t,n){t.position=n,t.hideBadge=1===i.length,t.stepListType=s;var a=e.stepViewObjectFactory(t);a.on("onStatusChanged",e.onStepStatusChanged,e),a.setPreviousStep(e.steps[n-1]),a.updateStatus(),e.steps.push(a)})},isAllStepsCompleted:function(){return!_.isObject(_.find(this.steps,function(e){return!e.isCompleted()}))},isSomeStepsNotCompleted:function(){return _.isObject(_.find(this.steps,function(e){return!e.isCompleted()}))},isSomeStepsHasNotInitializedStatus:function(){return _.isObject(_.find(this.steps,function(e){return!e.getStatus()}))},stepsCompleted:function(e){return this.isAllStepsUpdated&&this.isAllStepsCompleted()&&e(),this.onStepsCompletedCallback=e,this},stepsNotCompleted:function(e){return this.isAllStepsUpdated&&this.isSomeStepsNotCompleted()&&e(),this.onStepsNotCompletedCallback=e,this},stepViewObjectFactory:function(e){return e.type===this.DP.STEP_TYPES.SERVICE_ENABLEMENT?new i(e):new t(e)},hasAccess:function(){return!0},getTemplate:function(){var e=this,t=function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(t){if(_.isString(t))return t;if(_.isFunction(t))return t(e.vtOptions(i))}},i=t(this.customTemplate);return i||t(this.template,{title:t(this.titleTemplate),description:t(this.descriptionTemplate),steps_title:t(this.stepsTitleTemplate),inaccessible_text:t(this.inaccessibleTextTemplate)})},render:function(){var e=this;this.$el.html(this.getTemplate());var t=this.hasAccess();return t?this.$(".inaccessible").remove():this.$(".accessible").remove(),t&&(this.$(".steps").html(""),_.each(this.steps,function(t){e.$(".steps").append(t.render())})),this.$el},isComplete:function(e){return!1},show:function(e){this.container=e||this.container,this.container.append(this.render())},getSteps:function(){return[]},onAllStepsStatusSet:function(){_.isFunction(this.onStepsCompletedCallback)&&this.isAllStepsCompleted()&&this.onStepsCompletedCallback(),_.isFunction(this.onStepsNotCompletedCallback)&&this.isSomeStepsNotCompleted()&&this.onStepsNotCompletedCallback()},onStepStatusChanged:function(){this.isAllStepsUpdated||this.isSomeStepsHasNotInitializedStatus()||(this.isAllStepsUpdated=!0,this.onAllStepsStatusSet()),this.isAllStepsCompleted()&&_.isFunction(this.onStepsCompletedCallback)&&this.onStepsCompletedCallback(),this.trigger(this.EVENTS.STATE_CHANGED)}})}),define("views/entity/onboarding/MicrosegOnboardingView",["views/entity/onboarding/BaseEntityOnboardingView","utils/ManagerMixin"],function(e,t){"use strict";return e.extend({name:"MicrosegOnboardingView",initialize:function(t){e.prototype.initialize.call(this,t),this.inaccessibleTextTemplate=this.i18n("template.not_enabled_text")},hasAccess:function(){return t.getAccessManager().hasAccessToMicrosegEnabling()},getSteps:function(){return[{name:"MicrosegServiceEnablement",type:this.DP.STEP_TYPES.SERVICE_ENABLEMENT,serviceName:t.getServiceManager().SERVICES.MICROSEG,captions:{step:this.i18n("steps_captions.nucalm_service")}}]}})}),define("views/entity/onboarding/NuCalmOnboardingView",["views/entity/onboarding/BaseEntityOnboardingView","utils/ManagerMixin"],function(e,t){"use strict";return e.extend({name:"NuCalmOnboardingView",initialize:function(t){e.prototype.initialize.call(this,t),this.titleTemplate=this.i18n("template.title"),this.descriptionTemplate=this.i18n("template.description"),this.inaccessibleTextTemplate=this.i18n("template.not_enabled_text")},hasAccess:function(){return t.getAccessManager().hasAccessToAppManagementEnabling()},
getSteps:function(){return[{name:"NuCalmServiceEnablement",type:this.DP.STEP_TYPES.SERVICE_ENABLEMENT,serviceName:t.getServiceManager().SERVICES.NUCALM,captions:{step:this.i18n("steps_captions.nucalm_service")}}]}})}),define("views/entity/onboarding/VulcanOnboardingView",["views/entity/onboarding/BaseEntityOnboardingView","utils/ManagerMixin","utils/AppConstants","utils/AppUtil"],function(e,t,i,n){"use strict";return e.extend({name:"VulcanOnboardingView",dismissWelcomePage:!1,initialize:function(t){this.dismissWelcomePage=n.getLocalStorageProperty("vulcan_welcome_page_dismissed")===i.BOOLEAN_TRUE,e.prototype.initialize.call(this,t)},hasAccess:function(){return!1},onCompleteHandler:function(e){e&&n.setLocalStorageProperty("vulcan_welcome_page_dismissed",!0),this.dismissWelcomePage=!0,this.onStepsCompletedCallback()},stepsCompleted:function(e){return this.dismissWelcomePage&&e(),this.onStepsCompletedCallback=e,this},stepsNotCompleted:function(e){return this.dismissWelcomePage||e(),this},destroy:function(){this.reactId&&(t.getBrokerManager().unloadComponent(this.reactId),this.reactId=null),e.prototype.destroy.apply(this,arguments)},show:function(e){var i=this;this.container=e||this.container;var n=$('<div class="vulcan-onboarding-container"></div>');this.container.append(n),this.reactId&&(t.getBrokerManager().unloadComponent(this.reactId),this.reactId=null),this.reactId=t.getBrokerManager().loadComponent("vulcan",n,{componentName:"WelcomePage"},{success:function(e){i.reactComponent=e,e.render({onGetStarted:i.onCompleteHandler.bind(i)})}})}})}),define("views/entity/onboarding/steps/K8sEntityOnboardingServiceStepView",["components/Components","views/entity/onboarding/steps/EntityOnboardingServiceStepView"],function(e,t){"use strict";var i=_.template(e.button({text:"<%- caption %>",isPrimary:!0})),n=_.template('\n      <div data-ntnx-empty-list>\n        <section data-ntnx-section="type-text" class="k8s-intro-section">\n          <section data-ntnx-section="type-text" class="intro">\n            <%= this.i18n("intro_karbon") %>\n          </section>\n          <section data-ntnx-section="type-text" class="title">\n            <%= this.i18n("managed_k8s_service") %>\n          </section>\n          <section data-ntnx-section="type-text" class="description">\n            <%= this.i18n("description") %>\n          </section>\n          <section data-ntnx-section="type-text" class="description">\n            <%= documentationLink %>\n          </section>\n        </section>\n        <section data-ntnx-section class="actionContainer"></section>\n      </div>');return t.extend({actionLinkTemplate:i,k8sTemplate:n,name:"K8sEntityOnboardingServiceStepView",initialize:function(e){e.helpLink&&(this.helpLink=e.helpLink),t.prototype.initialize.call(this,e)},render:function(){this.tagName&&(this.$el=$("<"+this.tagName+"/>")),this.className&&this.$el.addClass(this.className);var e=this.i18ns("documentation",{start_link:'<a href="'+this.helpLink+'" target="_blank">',end_link:"</a>"});return this.$el.html(this.k8sTemplate(this.vtOptions({num:this.getStepNumForDisplay(),caption:this.stepCaption,documentationLink:e}))),this.hideBadge&&this.$(".step-badge").remove(),this.updateActions(),this.$el}})}),define("views/entity/onboarding/K8sClusterOnboardingView",["views/entity/onboarding/BaseEntityOnboardingView","views/entity/onboarding/steps/EntityOnboardingStepView","views/entity/onboarding/steps/K8sEntityOnboardingServiceStepView","models/genesis/K8sClusterEnableModel","utils/ManagerMixin"],function(e,t,i,n,s){"use strict";var a={CONTAINER_STARTUP_DELAY:7e4,HELP_LINK:"https://portal.nutanix.com/#/page/prismDocs?\nsoftware_type=Karbon&software_version=0.8&prism_id=default"};return e.extend({name:"K8sClusterOnboardingView",initialize:function(t){e.prototype.initialize.call(this,t),this.inaccessibleTextTemplate=this.i18n("template.not_enabled_text")},hasAccess:function(){return s.getAccessManager().hasAccessToK8sClusterEnabling()},enableService:function(){this.enableModel||(this.enableModel=new n);var e=s.getServiceManager();this.enableModel.setRpcEnableServiceParams();var t=e.getServiceModel(e.SERVICES.K8S_CLUSTER);t.set(t.DP.STATUS_ATTRIBUTE_NAME,t.STATUS.ENABLING),this.enableModel.fetch({success:function(){e.fetch(e.SERVICES.K8S_CLUSTER),_.delay(function(){t.set(t.DP.STATUS_ATTRIBUTE_NAME,t.STATUS.ENABLED)},a.CONTAINER_STARTUP_DELAY)},error:function(t,i){var n=e.getServiceCollection().get(e.SERVICES.K8S_CLUSTER);n&&n.setModelError(i)}})},stepViewObjectFactory:function(e){return e.type===this.DP.STEP_TYPES.SERVICE_ENABLEMENT?(e.helpLink=a.HELP_LINK,new i(e)):new t(e)},getSteps:function(){return[{name:"K8sClusterServiceEnablement",type:this.DP.STEP_TYPES.SERVICE_ENABLEMENT,serviceName:s.getServiceManager().SERVICES.K8S_CLUSTER,captions:{configLink:this.i18n("steps_captions.config_link")},onConfigClickHandler:this.enableService}]}})}),define("views/entity/onboarding/ObjectStoreOnboardingView",["views/entity/onboarding/BaseEntityOnboardingView","utils/ManagerMixin"],function(e,t){"use strict";return e.extend({name:"ObjectStoreOnboardingView",initialize:function(t){e.prototype.initialize.call(this,t),this.inaccessibleTextTemplate=this.i18n("template.not_enabled_text")},hasAccess:function(){return t.getAccessManager().hasAccessToObjectStoreEnabling()},getSteps:function(){return[{name:"ObjectStoreServiceEnablement",type:this.DP.STEP_TYPES.SERVICE_ENABLEMENT,serviceName:t.getServiceManager().SERVICES.OBJECT_STORE,captions:{step:this.i18n("steps_captions.object_store_service"),inProgress:this.i18n("steps_captions.object_store_progress")},onPending:function(){this.hideTitle()}}]}})}),define("views/entity/onboarding/EntityOnboardingFactory",["views/entity/onboarding/MicrosegOnboardingView","views/entity/onboarding/NuCalmOnboardingView","views/entity/onboarding/VulcanOnboardingView","views/entity/onboarding/K8sClusterOnboardingView","views/entity/onboarding/ObjectStoreOnboardingView"],function(e,t,i,n,s){"use strict";return{vulcanOnboardingView:null,getView:function(a){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};switch(a){case"NuCalmOnboardingView":return new t(r);case"MicrosegOnboardingView":return new e(r);case"ObjectStoreOnboardingView":return new s(r);case"VulcanOnboardingView":return this.vulcanOnboardingView||(this.vulcanOnboardingView=new i(r)),this.vulcanOnboardingView;case"K8sClusterOnboardingView":return new n(r)}}}}),define("views/pages/ebrowser/viz/plugins/OnboardingPluginView",["views/pages/ebrowser/viz/plugins/BaseServicePluginView","views/entity/onboarding/EntityOnboardingFactory"],function(e,t){"use strict";return e.extend({onboardingView:null,initialized:!1,initialize:function(t){_.bindAll(this,"onOnboardingStateChanged"),e.prototype.initialize.apply(this,arguments),this.initialized||(this.onboardingView=this.getOnboardingView(),this.onboardingView.on(this.onboardingView.EVENTS.STATE_CHANGED,this.onOnboardingStateChanged),this.initialized=!0)},destroy:function(){this.backToInitialConfig()},render:function(){var e=this;this.$el.html(""),this.onboardingView.stepsCompleted(function(){e.onboardingView.destroy(),e.backToDefViewConfigs(),e.triggerNextVisualization()}).stepsNotCompleted(function(){e.hidePerspectiveLoadingPanel(),e.onboardingView.show(e.$el),e.onUpdateSize()})},updateSize:function(){this.makeVerticalMiddleAlign()},getOnboardingView:function(){var e=this.vizAttributes.view;if(_.isEmpty(e))throw new Error("Entity onboarding view class name isn't specified");var i=t.getView(e);if(!_.isObject(i))throw new Error("Entity onboarding view class with name "+e+" doesn't exist.");return i},onOnboardingStateChanged:function(){this.getCurrentVisualizationName()!==this.vizName&&this.triggerVisualization(this.vizName)}})}),define("views/pages/ebrowser/viz/plugins/VMCirclesView",["views/pages/ebrowser/viz/BaseCirclesVisualizationView","data/DataProperties"],function(e,t){"use strict";var i=[t.VM_NUM_VCPUS,t.VM_MEM_CAPACITY,t.VM_DISK_CAPACITY,t.STATS+"."+t.STATS_HYP_NUM_READ_IOPS,t.STATS+"."+t.STATS_HYP_NUM_WRITE_IOPS,t.STATS+"."+t.STATS_HYP_BANDWIDTH,t.STATS+"."+t.STATS_HYP_AVG_IO_LATENCY];return e.extend({getSizeByAttr:function(){var e=this.sortBy[0];return i.indexOf(e)>=0?e:null}})}),define("views/pages/ebrowser/viz/plugins/IFramePluginView",["views/pages/ebrowser/viz/plugins/BaseServicePluginView","views/basecomponents/iframe/IFrameView","utils/AppUtil"],function(e,t,i){"use strict";return e.extend({iFrameView:null,iFrameId:null,isIframeLoaded:!1,initialize:function(t){e.prototype.initialize.apply(this,arguments),this.iFrameId="IFrameEBPlugin-"+Date.now()},destroy:function(){this.iFrameView.destroy(),e.prototype.destroy.apply(this,arguments)},render:function(){this.iFrameView=new t({iFrameId:this.iFrameId,url:this.getIFrameUrl(),width:"100%",height:"100%"}),this.$el.html(this.iFrameView.render().el),this.$("iframe").load(this.onIframeLoaded.bind(this)).addClass("content-iframe").height("100%").hide(),this.iFrameView.$el.height("100%"),this.showPerspectiveLoadingPanel()},updateSize:function(){this.isIframeLoaded&&(this.removeContentPaddings(),this.stretchContent())},getIFrameUrl:function(){return i.getUrl(this.vizAttributes.src)},onIframeLoaded:function(){this.isIframeLoaded=!0,this.hidePerspectiveLoadingPanel(),this.$("iframe").show(),this.onUpdateSize()}})}),define("views/entity/OpenExternalLinkPageView",["views/basecomponents/BaseView"],function(e){"use strict";var t=_.template('\n      <ol data-ntnx-ol data-ntnx-section class="steps accessible">\n        <li class="single-step active">\n          <div data-ntnx-empty-list="">\n            <section data-ntnx-section="type-text">\n              <%= headerMsg %>\n            </section>\n            <section data-ntnx-section="type-text">\n              <%= bodyMsg %>\n            </section>\n          </div>\n        </li>\n      </ol>'),i={EXTERNAL_LOCATION_PORT:"external_location_port",HEADER_MSG:"header_msg",CONSOLE_URL:"console_url",BODY_MSG:"body_msg"};return e.extend({name:"OpenExternalLinkPageView",template:t,tagName:"div",className:"entity-onboarding",container:null,hasAccess:function(){return!0},getExternalUrl:function(e){var t=e||window.location,n=this.vizAttributes[i.EXTERNAL_LOCATION_PORT],s=this.vizAttributes[i.CONSOLE_URL];return t.protocol+"//"+t.hostname+":"+n+"/"+s},getTemplate:function(){var e=this.i18ns(this.vizAttributes[i.BODY_MSG],{start_link:'<a href="'+this.getExternalUrl()+'" target="_blank">',end_link:"</a>"});return this.template(_.extend({url:this.getExternalUrl(),headerMsg:this.i18n(this.vizAttributes[i.HEADER_MSG]),bodyMsg:e},this.vtOptions))},render:function(){return this.$el.html(this.getTemplate()),this.$el},show:function(e,t){this.vizAttributes=t,this.container=e||this.container,this.container.append(this.render())}})}),define("views/pages/ebrowser/viz/plugins/OpenExternalLinkPluginView",["views/pages/ebrowser/viz/plugins/BaseServicePluginView","views/entity/OpenExternalLinkPageView"],function(e,t){"use strict";return e.extend({onboardingView:null,initialize:function(i){e.prototype.initialize.apply(this,arguments),this.openExternalLinkPageView=new t},destroy:function(){this.openExternalLinkPageView.destroy(),e.prototype.destroy.apply(this,arguments)},render:function(){this.hidePerspectiveLoadingPanel(),this.openExternalLinkPageView.show(this.$el,this.vizAttributes)}})}),define("text!templates/entity/onboarding/RecoveryPlanOnboardingView.html",[],function(){return'<div class="recovery-plan-onboarding" <%= getQaDataTestId("test_rp_onboarding_intro") %> >\n  \x3c!-- Introduction to Recovery Plan--\x3e\n  <div class="recovery-plan-onboarding-image" >\n    <img src="app/assets/images/draas/recovery_plan_onboarding.svg">\n  </div>\n  <h1 class="recovery-plan-heading"><%= i18n(\'recovery_plan_heading\') %></h1>\n  <p><%= i18n(\'recovery_plan_subheading\') %></p>\n  \x3c!-- Create Recovery Plan Button--\x3e\n  <button\n    class="create-actions btn -action action-btn actionButton create-rp-button"\n    type="button"\n    data-id="create"\n  >\n    <span><%= i18n(\'create_new_recovery_plan\') %></span>\n  </button>\n  \x3c!-- Recommended Steps--\x3e\n  <p class="recommended-steps-intro"><%= i18n(\'recommended_steps\') %></p>\n  <div class="recommended-steps-container">\n    <div class="recommended-steps">\n      <h4 class="recommended-steps-heading"><%= i18n(\'enable_disaster_recovery_heading\') %></h4>\n      <p><%= i18n(\'enable_disaster_recovery_subheading\') %></p>\n    </div>\n    <div class="recommended-steps">\n      <h4 class="recommended-steps-heading"><%= i18n(\'setup_networks_heading\') %></h4>\n      <p><%= i18n(\'setup_networks_subheading\') %></p>\n    </div>\n    <div class="recommended-steps">\n      <h4 class="recommended-steps-heading"><%= i18n(\'protect_vms_heading\') %></h4>\n      <p><%= i18n(\'protect_vms_subheading\') %></p>\n    </div>\n  </div>\n</div>'}),define("views/entity/onboarding/RecoveryPlanOnboardingView",["managers/ActionManager","utils/AppConstants","views/basecomponents/BaseView","text!templates/entity/onboarding/RecoveryPlanOnboardingView.html"],function(e,t,i,n){"use strict";var s=_.template(n);return i.extend({name:"RecoveryPlanOnboardingView",initialize:function(e){i.prototype.initialize.apply(this,arguments)},show:function(e){this.$("button[data-id=create]").off("click",this.onCreateClick),e.empty(),e.html(this.render()),this.$("button[data-id=create]").on("click",this.onCreateClick)},render:function(){return this.$el.empty(),this.template=s(this.vtOptions()),this.$el.html(this.template),this.$el},onCreateClick:function(){e.onEntityAction(t.ENTITY_RECOVERY_PLAN,t.ACTION_CREATE)},destroy:function(){this.$("button[data-id=create]").off("click",this.onCreateClick),i.prototype.destroy.apply(this,arguments)}})}),define("views/pages/ebrowser/viz/plugins/RecoveryPlanPluginView",["utils/AppConstants","views/pages/ebrowser/viz/plugins/BaseServicePluginView","views/entity/onboarding/RecoveryPlanOnboardingView"],function(e,t,i){"use strict";var n=e.ENTITY_RECOVERY_PLAN;return t.extend({initialize:function(e){t.prototype.initialize.apply(this,arguments),this.recoveryPlanOnboardingView=new i,this.perspViewModel=this.perspectivesView.model,this.perspViewModel.on(this.perspViewModel.CHANGE_EVENTS.ENTITY_COUNTS,this.updateView,this)},render:function(){this.updateSize(),this.updateView()},updateView:function(){this.perspectivesView.model.getSelectedEntityType()===n&&_.isNumber(this.getEntityCount())&&(0===this.getEntityCount()?(this.recoveryPlanOnboardingView.show(this.$el),this.hidePerspectiveLoadingPanel()):(this.backToInitialConfig(),this.triggerVisualization("grid")))},updateSize:function(){this.removeContentPaddings(),this.stretchContent(),this.$(".recovery-plan-onboarding").parent().css("height","100%")},destroy:function(){this.backToInitialConfig(),this.perspViewModel.off(this.perspViewModel.CHANGE_EVENTS.ENTITY_COUNTS,this.updateView),this.recoveryPlanOnboardingView.destroy(),t.prototype.destroy.apply(this,arguments)},getEntityCount:function(){return this.perspViewModel.getTotalEntityCount(n)}})}),define("views/pages/ebrowser/viz/plugins/PluginFactory",["views/pages/ebrowser/viz/plugins/OnboardingPluginView","views/pages/ebrowser/viz/plugins/VMCirclesView","views/pages/ebrowser/viz/plugins/IFramePluginView","views/pages/ebrowser/viz/plugins/OpenExternalLinkPluginView","views/pages/ebrowser/viz/plugins/RecoveryPlanPluginView"],function(e,t,i,n,s){"use strict";return{PLUGINS:{ONBOARDING:"onboarding",IFRAME:"iFrame",OPEN_EXTERNAL_LINK:"open_external_link",VM_CIRCLES_VIZ:"vmCirclesViz",RP_ONBOARDING_VIEW:"rp_onboarding"},getView:function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=a.viz||{},o=r.name||"",l=r.usePlugin||"",c=null;if(!_.isEmpty(o)&&this.isPlugin(o)?c=o:!_.isEmpty(l)&&this.isPlugin(l)&&(c=l),!_.isEmpty(c))switch(l||c){case this.PLUGINS.ONBOARDING:return new e(a);case this.PLUGINS.OPEN_EXTERNAL_LINK:return new n(a);case this.PLUGINS.VM_CIRCLES_VIZ:return new t(a);case this.PLUGINS.IFRAME:return new i(a);case this.PLUGINS.RP_ONBOARDING_VIEW:return new s(a)}},isPlugin:function(e){return!_.isEmpty(e)&&_.map(this.PLUGINS,function(e){return e}).indexOf(e)>=0}}}),define("views/pages/ebrowser/labels/EBLabelsView",["views/basecomponents/BaseView","components/Components","utils/AppConstants","utils/SVG","utils/EntityUtil"],function(e,t,i,n,s){"use strict";var a=_.template('<div class="ebLabels eb-labels"><div class="newLabel new-option-row"><input class="newLabelName new-option-name" type="text" placeholder="<%= i18n("labelAs") %>" maxlength="40"></div><ul class="labels options"></ul><div class="manageLabels manage-row"><%= Components.icon("C", "gearIcon -inline -small") %>&nbsp; <%= i18n("manageLabels") %></div><div class="applyLabels save-row"><%= Components.icon("J", "-inline -small") %>&nbsp; <%= i18n("applyChanges") %></div></div>'),r=_.template('<span class="label-check-icon option-check-icon labelCheckIcon unchecked" data-id="<%= uuid %>"><%= Components.checkbox({}) %></span>'),o=_.template('<span class="label-check-icon option-check-icon labelCheckIcon checked" data-id="<%= uuid %>"><%= Components.checkbox({checked: true}) %></span>'),l=_.template('<span class="label-check-icon option-check-icon labelCheckIcon pchecked" data-id="<%= uuid %>"><%= Components.checkbox({partialCheck: true}) %></span>'),c=_.template('<li data-id="<%= uuid %>" class="<%= highLightClass %> labelItem" ><%= iconHTML %><div class="name selected" title="<%- name %>"><%- name %></div></li>'),d=_.template('<li class="newLabel new-option-button-row"><div class="name"><%= i18n("createLabel") %> <span class="search-name"><%- name %></span></div></li>');return e.extend({name:"EBLabelsView",labelStates:null,events:{"click      li.newLabel":"onNewLabel","click      .labelItem":"onLabelClick","keypress   .newLabelName":"onNameInputKeypress","keyup      .newLabelName":"onNameInputKeydown","click      .manageLabels":"onManageLabels","click      .applyLabels":"onApplyLabels","click      input.newLabelName":"onNewLabelClick"},initialize:function(t){e.prototype.initialize.apply(this,arguments),this.entityType=t.entityType,this.labelsCollection=t.labelsCollection,this.selectedEntities=t.selectedEntities,this.newLabelCB=t.newLabelCB,this.applyLabelsCB=t.applyLabelsCB,this.manageLabelsCB=t.manageLabelsCB,this.closeViewCB=t.closeViewCB,this.labelStates={}},render:function(){this.$el.html(a(this.vtOptions({})))},resetView:function(e){if(this.selectedEntities=e,this.labelStates={},e&&e.length){var t=this.labelsCollection.getLabels(this.entityType);_.each(t,function(t){var n=t.getLabeledEntities(),s=i.LABEL_STATES.UNCHECKED;if(n.length){var a=!0,r=!0;_.each(e,function(e){n.indexOf(e)>=0?r=!1:a=!1}),r?s=i.LABEL_STATES.UNCHECKED:a?s=i.LABEL_STATES.CHECKED:a||(s=i.LABEL_STATES.PARTIALLY_CHECKED)}this.labelStates[t.get(t.idAttribute)]=s},this)}this._renderLabels()},onNewLabel:function(){var e=this.$(".newLabelName").val().trim();e.length&&(this.newLabelCB(this.entityType,e),this.$(".newLabelName").val(""))},onLabelClick:function(e){e.stopPropagation();var t,n=$(e.currentTarget).find(".labelCheckIcon"),s=n.attr("data-id"),a=this.labelsCollection.findModelById(s),c=this.labelStates[s],d=this._getNextState(n);switch(d){case i.LABEL_STATES.CHECKED:t=o;break;case i.LABEL_STATES.UNCHECKED:t=r;break;case i.LABEL_STATES.PARTIALLY_CHECKED:t=l}var u=this._renderLabel(a,t,c!==d);n.parent().replaceWith(u);var h=this._getUpdatedLabels();_.isEmpty(h)?this.$(".applyLabels").hide():this.$(".applyLabels").show()},onLabelChange:function(){this.resetView(this.selectedEntities)},onNameInputKeypress:function(e){var t=$.ui.keyCode;e.keyCode===t.ENTER&&(this.$(".newLabel").length&&this.onNewLabel(),e.preventDefault())},onNameInputKeydown:function(e){var t=$.ui.keyCode;e.keyCode===t.ESCAPE?this.closeViewCB():e.keyCode!==t.ENTER&&this._renderLabels()},onApplyLabels:function(){this.applyLabelsCB&&this.applyLabelsCB(this._getUpdatedLabels())},onManageLabels:function(){this.manageLabelsCB&&this.manageLabelsCB()},onNewLabelClick:function(e){e.stopPropagation()},_getUpdatedLabels:function(){var e={};return _.each(this.$(".label-check-icon"),function(t){var i=$(t),n=String(i.attr("data-id")),s=this._getLabelState(i);s!==this.labelStates[n]&&(e[n]=s)},this),e},_getLabelState:function(e){return e.hasClass(i.LABEL_STATES.PARTIALLY_CHECKED)?i.LABEL_STATES.PARTIALLY_CHECKED:e.hasClass(i.LABEL_STATES.CHECKED)?i.LABEL_STATES.CHECKED:i.LABEL_STATES.UNCHECKED},_getNextState:function(e){if(e.hasClass(i.LABEL_STATES.PARTIALLY_CHECKED))return i.LABEL_STATES.CHECKED;if(e.hasClass(i.LABEL_STATES.CHECKED))return i.LABEL_STATES.UNCHECKED;var t=String(e.attr("data-id"));return this.labelStates[t]===i.LABEL_STATES.PARTIALLY_CHECKED?i.LABEL_STATES.PARTIALLY_CHECKED:i.LABEL_STATES.CHECKED},_renderLabels:function(){this.$(".manageLabels").hide(),this.$(".applyLabels").hide(),this.$(".labels").html("");var e=this.labelsCollection.getLabels(this.entityType),t=!1,n=this.$(".newLabelName").val().trim();n.length>0&&(e=_.filter(e,function(e){var i=e.get(e.nameAttribute);return i===n&&(t=!0),0===i.indexOf(n)}));var s="";if(e.length){var a=[],c=[],u=[];_.each(e,function(e){switch(this.labelStates[e.get(e.idAttribute)]){case i.LABEL_STATES.CHECKED:a.push(e);break;case i.LABEL_STATES.UNCHECKED:c.push(e);break;case i.LABEL_STATES.PARTIALLY_CHECKED:u.push(e)}},this),s+=this._renderSortedLabels(a,o),s+=this._renderSortedLabels(u,l),s+=this._renderSortedLabels(c,r),this.$(".manageLabels").show()}n.length>0&&!t&&(s+=d(this.vtOptions({name:n}))),this.$(".labels").html(s),this.applyNutanixInput();var h=this;setTimeout(function(){h.$(".newLabelName").focus()},100)},_renderSortedLabels:function(e,t){var i="";return _.each(s.sortLabels(e),function(e){i+=this._renderLabel(e,t,!1)},this),i},_renderLabel:function(e,i,s){var a=_.extend(e.toJSON(),{uuid:e.get(e.idAttribute),SVG:n,Components:t}),r=i(a),o=s?"highlight-option":"";return c(_.extend(a,{highLightClass:o,iconHTML:r}))}})}),define("text!templates/pages/ebrowser/labels/EBMangeLabelsPopupView.html",[],function(){return'\x3c!-- The parent div modal is #popupManageLabels --\x3e\n<div class="modal-header">\n  <button type="button" class="close" data-dismiss="modal">\n    <i data-icon="K" aria-hidden="true"></i>\n  </button>\n  <h4 class="n-title">Manage Labels</h4>\n</div>\n\n<div class="n-modal-wrapper">\n  <div class="n-modal-body">\n    <div class="n-modal-content-wrapper">\n      <div class="n-modal-alert-header">\n        \x3c!-- @view: alert goes here... --\x3e\n      </div>\n      <div class="n-modal-content labelsContainer">\n        <% if ( labels === null ) { %>\n          <div class="donut-loader-blue"></div>&nbsp;Loading...\n        <% } else if ( labels.length ) { %>\n          <table id="labelsList" class="table table-hover">\n            <tbody>\n          <% _.each(labels, function(label) { %>\n            <tr class="n-table-row"\n                data-id="<%= label.get(label.idAttribute) %>">\n              <td class="name">\n                <span class="noneditable">\n                  <%- label.get(label.nameAttribute) %>\n                </span>\n                <span class="editable">\n                  <input type="text" value="<%=label.get(label.nameAttribute)%>"\n                    class="editTxt edit-text">\n                </span>\n              </td>\n              <td class="cell-actions">\n                <span class="noneditable">\n                  <i class=\'btnEdit\' data-icon="F" aria-hidden="true" ></i>\n                  <span class="action-separator">&middot;</span>\n                  <i class=\'btnDel\' data-icon="v" aria-hidden="true"></i>\n                </span>\n                <span class="editable">\n                <a class="btnUpdate action">Save</a>\n                <a class="btnCancel action">Cancel</a>\n                </span>\n              </td>\n            </tr>\n          <% }) %>\n            </tbody>\n          </table>\n        <% } %>\n      </div>\n    </div>\n  </div>\n  <div class="n-modal-footer">\n    <button class="btnClose btn n-btn-form -blue">\n      Close\n    </button>\n  </div>\n</div>\n\n</div>'}),define("views/pages/ebrowser/labels/EBManageLabelsPopupView",["views/basecomponents/popups/BasePopupView","utils/AppConstants","utils/AppUtil","models/ebrowser/labels/EBLabelModel","text!templates/pages/ebrowser/labels/EBMangeLabelsPopupView.html"],function(e,t,i,n,s){"use strict";var a=_.template(s);return e.extend({events:{"click .btnNew":"onNewLabel","click .btnEdit":"onEditLabel","click .btnUpdate":"onUpdateLabel","click .btnCancel":"render","click .btnDel":"onDeleteLabel","click .btnClose":"hide","click .close":"hide",keypress:"clearHeader","keypress .editTxt":"onEditNameInputKeypress","keypress .newLabelName":"onAddNameInputKeypress"},initialize:function(t){e.prototype.initialize.apply(this,arguments),this.entityType=t.entityType,this.labelsCollection=t.labelsCollection,this.labelsCollection.on("stateChanged",this.render,this)},render:function(){var e=this.labelsCollection.getState();e===t.STATE_PENDING||e===t.STATE_INIT?this.$el.html(a({labels:null})):(this.labelsCollection.off("stateChanged",this.render,this),this.labelsCollection.sort(),this.$el.html(a({labels:this.labelsCollection.getLabels(this.entityType)})),this.applyNutanixInput())},destroy:function(){this.labelsCollection.off("stateChanged",this.render,this),e.prototype.destroy.apply(this,arguments)},onNewLabel:function(){var e=this.$(".newLabelName").val().trim();if(e.length){if(!this.validateName(e))return;var t=this,i=new n,s={};s[i.DP.NAME]=e,s[i.DP.ENTITY_TYPE]=this.entityType,i.set(s),i.save(null,{success:function(e){t.labelsCollection.add(e),t.$(".newLabelName").val(""),t.render()}})}},onUpdateLabel:function(e){var t=this,n=this.$(e.currentTarget).parents(".n-table-row"),s=n.attr("data-id"),a=n.find(".editTxt").val().trim();if(a.length){if(!this.validateName(a))return;var r=this,o=this.labelsCollection.findModelById(s);o.set(o.DP.NAME,a),o.save(null,{success:function(e){r.render()},error:function(e,n){t.showHeaderError(i.processThrownError(n))}})}},onEditLabel:function(e){var t=this.$("#labelsList .n-table-row");t.removeClass("edit"),t.find(".editable").removeClass("show"),t.find(".noneditable").removeClass("hide");var i=this.$(e.currentTarget).parents(".n-table-row");i.addClass("edit"),i.find(".noneditable").addClass("hide"),i.find(".editable").addClass("show"),i.find(".editTxt").focus(),this.$(".btnNew").addClass("btnDisabled"),this.$(".btnClose").addClass("btnDisabled")},onDeleteLabel:function(e){var t=this.$(e.currentTarget).parents(".n-table-row"),i=t.attr("data-id");$.nutanixConfirm({msg:"Delete selected label ?",yes:function(){var e=this;this.labelsCollection.findModelById(i).destroy({success:function(t,i){e.render(),0===e.labelsCollection.length&&e.hide()},error:function(t,i){e.showHeaderError(i.responseText)}})},yesText:"Yes",noText:"No",context:this})},onEditNameInputKeypress:function(e){13===e.keyCode&&(this.onUpdateLabel(e),e.preventDefault())},onAddNameInputKeypress:function(e){13===e.keyCode&&(this.onNewLabel(),e.preventDefault())},validateName:function(e){if(0===e.trim().length){return this.showHeaderTextError("Please enter a label name."),!1}return!0}})}),define("views/pages/ebrowser/EBPerspectivesView",["data/DataProperties","components/Components","models/ebrowser/labels/EBLabelModel","utils/AppUtil","utils/AppConstants","utils/EntityUtil","utils/ManagerMixin","views/pages/ebrowser/EBBasePerspectivesView","views/pages/ebrowser/viz/BaseTileVisualizationView","views/pages/ebrowser/viz/BaseTableVisualizationView","views/pages/ebrowser/viz/BaseCirclesVisualizationView","views/pages/ebrowser/viz/BaseGroupedTableVisualizationView","views/pages/ebrowser/viz/plugins/PluginFactory","views/pages/ebrowser/labels/EBLabelsView","views/pages/ebrowser/labels/EBManageLabelsPopupView"],function(e,t,i,n,s,a,r,o,l,c,d,u,h,p,T){"use strict";var E=_.template('<%= Components.icon("Label_Single", "labelIcon -inline") %><%= Components.icon("z", "-down-arrow") %>'),g=_.template('<span class="selectionIcon allSelected">'+t.checkbox({id:"selectAllCheckbox",checked:!0,variants:"-default"})+'</span> <%= Components.icon("z", "-down-arrow") %>'),S=_.template('<span class="selectionIcon noneSelected">'+t.checkbox({id:"selectAllCheckbox"})+'</span> <%= Components.icon("z", "-down-arrow") %>'),m=_.template('<span class="selectionIcon someSelected">'+t.checkbox({partialCheck:!0,id:"selectAllCheckbox"})+'</span> <%= Components.icon("z", "-down-arrow") %>');return o.extend(_.extend({},r,{VERSION_START_SUPPORTING_LABELS:"4.6",extraEvents:{"click      .selectionIcon":"onSelectionIconClick","click      .viz-selector li":"onVizSelect","click      .selectByLink":"onSelectByChange","click      #labelsDropdown":"onLabelsDropdownClick"},initialize:function(){o.prototype.initialize.apply(this,arguments),this.addExtraEvents(this.extraEvents),_.bindAll(this,"onDocumentClick"),$(document).on("click",this.onDocumentClick)},destroy:function(){$(document).off("click",this.onDocumentClick),o.prototype.destroy.apply(this,arguments)},_renderQueryOptions:function(){o.prototype._renderQueryOptions.apply(this,arguments),this.getAccessManager().hasAccessToAllEBFeatures()||this.$(".labelsDropdown").hide()},_renderFilterBar:function(){o.prototype._renderFilterBar.apply(this,arguments),this.getAccessManager().hasAccessToAllEBFeatures()||this.$(".favorite-query-icon").hide()},_renderFavQueriesPicker:function(){this.getAccessManager().hasAccessToAllEBFeatures()&&o.prototype._renderFavQueriesPicker.apply(this,arguments)},getCurrentVisualizationName:function(){return this.model.getCurrentVisualization(this.model.getSelectedEntityType())},selectVisualization:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=this.model.getSelectedEntityType();this.selectEntityTypeVisualization(i,e,t)},selectEntityTypeVisualization:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.model.setCurrentVisualization(e,t),i?this.render():(this._renderVizSelector(),this._renderActions())},onVizSelect:function(e){this.selectVisualization($(e.currentTarget).attr("data-id"))},onSelectionIconClick:function(e){e.stopPropagation(),this.hideOpenDropdowns();var t=$(e.currentTarget);t.hasClass("someSelected")?this._selectAll():t.hasClass("noneSelected")?this._selectAll():t.hasClass("allSelected")&&this._selectNone(),this.render()},onSelectByChange:function(e){switch($(e.currentTarget).attr("data-id")){case"all":this._selectTotal();break;case"none":this._selectNone();break;case"show":this._showSelections();break;case"clear":this.selectionFilter&&(this.model.clearFilter(this.model.getSelectedEntityType(),this.selectionFilter.get("id")),this._selectNone(),this.selectionFilter=null)}this.render()},onLabelsDropdownClick:function(e){var t=this.$(".labels-dropdown");if(t.hasClass("disabled"))return void e.stopPropagation();if(!t.hasClass("open")){var i=this.model.getVisibleSelectedEntityIds(),n=this.subViewHelper.get("labelsView");n&&n.resetView(i)}t.toggleClass("open"),e&&(this.$(".btn-group.open:not(.labels-dropdown)").removeClass("open"),e.stopPropagation())},closeLabelsDropdown:function(){var e=this.$(".labels-dropdown");e.hasClass("open")&&e.removeClass("open")},onDocumentClick:function(e){var t=$(e.target);t.hasClass("labels-view")||t.hasClass("ebLabels")||t.parents(".labels-view").length>0||this.closeLabelsDropdown(),t.hasClass("saved-query-arrow-icon")||this.$(".favorite-queries").addClass("hidden")},onManageLabels:function(){this.onLabelsDropdownClick();var e=this.model.getLabelsCollection(),t=new T({el:n.createPopupContainer("popupManageLabels"),entityType:this.model.getSelectedEntityType(),labelsCollection:e});e.fetch(),t.show()},onNewLabel:function(e,t){var n=this,a=this.model.getVisibleSelectedEntityIds(),r=this.model.getLabelsCollection();this.closeLabelsDropdown()
;var o=this,l=this.getTaskManager().TASKS.LABEL_ENTITIES,c=new i;c.set(c.DP.NAME,t),c.set(c.DP.ENTITY_TYPE,e),c.save(null,{success:function(t){n.getNotificationManager().showClientNotification(s.NOTIFY_SUCCESS,n.getTaskManager().TASK_MESSAGES.initiated({operation:l}));var i=c.getLabelEntitiesHelper(e,a);i.save().done(function(){r.add(t);var e=i.get(i.DP.PARENT_TASK_ID);if(e){var a=_.isObject(e)?e:[e];o._fetchTasks(l,a,function(e,t,i){e&&!t||n.getNotificationManager().showClientNotification(s.NOTIFY_ERROR,i)})}else n.getNotificationManager().showClientNotification(s.NOTIFY_ERROR,n.getTaskManager().TASK_MESSAGES.error({operation:l}))})},error:function(){n.getNotificationManager().showClientNotification(s.NOTIFY_ERROR,"Unable to create label.")}})},onApplyLabels:function(e){var t=this;if(this.onLabelsDropdownClick(),!_.isEmpty(e)){var i=this.model.getLabelsCollection(),a=this.model.getSelectedEntityType(),r=this.model.getVisibleSelectedEntityIds();if(r.length){var o=[],l=[];_.each(e,function(e,t){var c=i.findModelById(t);c.get(c.nameAttribute);if(e===s.LABEL_STATES.CHECKED){var d=c.getLabelEntitiesHelper(a,r);l.push(d),o.push(d.save())}else if(e===s.LABEL_STATES.UNCHECKED){var u=c.getUnlabelEntitiesHelper(a,r);l.push(u),o.push(u.save())}else n.log("EBPerspectivesView: onApplyLabels: Invalid label state.",e)});var c=[];_.each(l,function(e){c.push(e.get(e.nameAttribute))});var d=this,u=this.getTaskManager().TASKS.UPDATE_LABELS;$.whenAll.apply($,o).done(function(){t.getNotificationManager().showClientNotification(s.NOTIFY_SUCCESS,t.getTaskManager().TASK_MESSAGES.initiated({operation:u}));var e=[];_.each(l,function(t){e=e.concat(t.get(t.DP.PARENT_TASK_ID))}),e.length&&d._fetchTasks(u,e,function(e,i,n){e&&!i||t.getNotificationManager().showClientNotification(s.NOTIFY_ERROR,n)})})}}},_fetchTasks:function(e,t,i){var n=this;this.getTaskManager().fetchTasksOnDemand(t,{operation:e,success:function(e,t){n.model.onTasksChange(e),i(!0,!1,t)},error:function(e,t){i(!1,!1,t),n.model.onTasksError()},timeout:function(e){i(!1,!0,e),n.model.onTasksError()}})},_renderLabelsUI:function(){var e=this.model.getSelectedEntityType(),i=this.$("#labelsDropdown");i.parent().tooltip("destroy");var n=this.model.getVisibleSelectedEntityIds();if(!this.model.canLabelEntityType(e)||!this.canModifyByEntityType(e)||n.length<=0)return void this.$(".labels").hide();if(this.$(".labels").show(),i.html(E({Components:t})),this.canLabelEntities(e,n)){i.removeClass("disabled");var s=this,a=this.subViewHelper.get("labelsView");a&&a.destroy(),a=new p({el:this.$(".labels-view"),entityType:e,labelsCollection:this.model.getLabelsCollection(),newLabelCB:function(e,t){s.onNewLabel(e,t)},applyLabelsCB:function(e){s.onApplyLabels(e)},manageLabelsCB:function(){s.onManageLabels()},closeViewCB:function(){s.closeLabelsDropdown()}}),this.subViewHelper.register("labelsView",a),a.render()}else i.addClass("disabled"),i.parent().tooltip({title:"Unable to label selected entities. All selections need to be on a cluster with NOS Version 4.6 or later.",placement:"bottom",trigger:"hover",html:!0})},_renderClearSelectionFilter:function(){return null},_renderSelectionsDropdown:function(){var e=this.subViewHelper.get(this.currentVisualizationId),i=e?e.getVisibleEntityIds():[];if(e&&e.isSelectionEnabled()){var n=this.model.getSelectedEntityType(),s=this.model.getSelectionsModel().getSelectedEntityIds(n),a=!1,r=!1;s.length&&(a=!1,r=!0,_.each(i,function(e){s.indexOf(e)<0?r=!1:a=!0}));var o=this.$("#selectDropdown");if(r?(o.html(g({count:s.length,Components:t})),o.addClass("all-selected"),o.removeClass("some-selected"),o.removeClass("none-selected")):a?(o.html(m({count:s.length,Components:t})),o.removeClass("all-selected"),o.addClass("some-selected"),o.removeClass("none-selected")):(o.html(S({Components:t})),o.removeClass("all-selected"),o.removeClass("some-selected"),o.addClass("none-selected")),s.length?this.$('.selectByLink[data-id="none"]').parent().removeClass("disabled"):this.$('.selectByLink[data-id="none"]').parent().addClass("disabled"),this._renderClearSelectionFilter(),this.showSelectedEntitiesMenu())if(this.$('.selectByLink[data-id="show"]').html(this.i18n("showSelections")).parent().show(),1===s.length)this.$('.selectByLink[data-id="show"]').html(this.i18n("showSelectedEntity")).parent().removeClass("disabled");else if(s.length>1){var l=this.i18ns("showSelectedEntities",s.length);this.$('.selectByLink[data-id="show"]').html(l).parent().removeClass("disabled")}else this.$('.selectByLink[data-id="show"]').html(this.i18n("showSelections")).parent().addClass("disabled");else this.$('.selectByLink[data-id="show"]').html(this.i18n("showSelections")).parent().hide()}},setContainerState:function(){var e=!1,t=this.model.getSelectedEntityType(),i=this.model.getSelectionsModel().getSelectedEntityIds(t);if(i.length){var n=this.subViewHelper.get(this.currentVisualizationId),s=n?n.getVisibleEntityIds():[];e=_.some(s,function(e){return i.indexOf(e)>=0})}e?this.$(".controls-container").addClass("selections-made"):this.$(".controls-container").removeClass("selections-made")},_createVisualizationSubview:function(e,t,i){var n=this,s=(e+"_"+i).toLowerCase(),r=a.getSortableAttributes(e,t.getDisplayAttributes()),o=t.getVisualization(i),l={entityType:e,el:this.$("#"+s),sortBy:this.model.getQuerySortInfo(e),colorBy:this.model.getColorBy(e),defaultColorBy:this.model.getDefaultColorBy(e),selectionsModel:this.model.getSelectionsModel(),labelsCollection:this.model.getLabelsCollection(),visualizationAttributes:t.getVisualizationAttributes(i),sortByAttributes:r,vizName:i,viz:o,perspectivesView:this,sortChangeCB:function(t){n.model.setQuerySortBy(e,t[0])},pageChangeCB:function(e){n._renderSelectionsDropdown(),n._renderLabelsUI(),n._renderActions(),n._renderVizLegend()},loadMoreEntitiesCB:function(){n.model.loadMoreEntities(e)},loadGroupMembersForExport:function(e,t,i){n.model.loadGroupMembersForExport(e,t,i)}},c=null;if(!(c=this.getServicePluginView(l)))switch(this.showHeader(),i){case"circles":c=this.getCirclesVisualizationView(l);break;case"tile":c=this.getTileVisualizationView(l);break;case"grid":c=this.getTableVisualizationView(l);break;case"grouped_grid":c=this.getGroupedTableVisualizationView(l)}return c.isSelectionEnabled()?this.$(".controls-container > .selections").show():this.$(".controls-container > .selections").hide(),c},getCirclesVisualizationView:function(e){return new d(e)},getTileVisualizationView:function(e){return new l(e)},getTableVisualizationView:function(e){return new c(e)},getGroupedTableVisualizationView:function(e){return new u(e)},getServicePluginView:function(e){return h.getView(e)},canLabelEntities:function(t,i){var a=this,r=!0,o=this.model.getQueryModel(t),l=o.getEntitiesByIds(i);return _.each(l,function(t){var i;if(t.entityType===s.ENTITY_CLUSTER){if(!(i=t.get(e.EB.CLUSTER.VERSION))){var o=a.getClusterManager().getClusterModelByClusterUuid(t.get(e.EB.ENTITY_ID));i=o&&o.getNosVersion()}}else i=a.getClusterManager().getClusterVersionForEntity(t);i&&-1!==n.compareVersions(i,a.VERSION_START_SUPPORTING_LABELS,2)||(r=!1)}),r},_selectTotal:function(){this._selectAll()},_selectAll:function(){var e=this.model.getSelectedEntityType(),t=this.subViewHelper.get(this.currentVisualizationId);if(t){var i=t.getVisibleEntityIds();this.model.getSelectionsModel().appendSelectedEntityIds(e,i)}},_selectNone:function(){var e=this.model.getSelectedEntityType();this.model.getSelectionsModel().setSelectedEntityIds(e,[])},_showSelections:function(){var e=this.model.getSelectedEntityType(),t=this.model.getSelectionsModel().getSelectedEntityIds(e);t.length&&(this.selectionFilter=this.model.createShowSelectionsFilter(e,t,!1))}}))}),define("models/ebrowser/filters/EBBaseFilterTypeModel",["models/BaseModel","data/DataProperties"],function(e,t){"use strict";return e.extend({idAttribute:t.ID,nameAttribute:t.NAME,name:"EBBaseFilterTypeModel",DP:{FILTERS:"filters",GROUP_NAME:"groupName"},defaults:{filters:null,groupName:""}})}),define("views/pages/ebrowser/filters/EBBaseFilterTypeView",["views/basecomponents/BaseView"],function(e){"use strict";return e.extend({initialize:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.prototype.initialize.apply(this,arguments),this.expanded=t.expanded},setExpanded:function(e){this.expanded=e},isExpanded:function(){return this.expanded}})}),define("text!templates/pages/ebrowser/filters/EBEnumFiltersView.html",[],function(){return'<div\n  class="n-filter-by<%= expanded ? \' expanded\' : \'\' %>"\n  <%= getQaDataTestId(groupName) %>\n>\n  <h2 class="n-filter-header">\n    <%= groupName %>\n    <%= Components.icon("caret-up", "minus-icon css-icon ", "") %>\n    <%= Components.icon("caret-down", "plus-icon css-icon ", "") %>\n  </h2>\n  <div class="n-filter-checkboxes">\n    \x3c!-- The filters for this enum group go here --\x3e\n  <% _.each(filters, function(fltr) {\n    var fltrName = fltr.getDisplayName();\n    var chkBoxId = fltr.get(fltr.idAttribute);\n    var sChecked = fltr.get(fltr.DP.IS_APPLIED) ? "checked" : "";\n\n    // For Enums, we don\'t display custom filters\n    var isCustomFilter =\n      fltr.get(fltr.DP.CUSTOM_LABEL) && fltr.get(fltr.DP.CUSTOM_LABEL).length;\n\n    if (fltrName !== placeholder && !isCustomFilter ) {\n  %>\n    <div class="n-checkbox-item">\n      <input\n        <%= sChecked %>\n        type="checkbox"\n        class="n-checkbox"\n        id="<%= chkBoxId %>"\n        data-class="-blue"\n        <%= getQaDataTestId(AppUtil.convertTitleToName(fltrName)) %>\n      >\n      <label for="<%= chkBoxId %>" class="n-label-text">\n        <span class="n-label-str"><%= fltrName %></span>\n      </label>\n      <span data-id="<%= chkBoxId %>" class="n-count pull-right"></span>\n    </div>\n  <% } });%>\n  </div>\n</div>\n'}),define("views/pages/ebrowser/filters/EBEnumFiltersView",["utils/AppConstants","views/pages/ebrowser/filters/EBBaseFilterTypeView","text!templates/pages/ebrowser/filters/EBEnumFiltersView.html"],function(e,t,i){"use strict";var n=_.template(i);return t.extend({render:function(){var t=this.model.get(this.model.DP.FILTERS),i=this.model.get(this.model.DP.GROUP_NAME);this.$el.html(n(this.vtOptions({filters:t,groupName:i,placeholder:e.ENUM_DYN_TYPE_PLACEHOLDR,expanded:this.isExpanded()}))),this.applyNutanixInput({types:["checkbox"]})}})}),define("text!templates/pages/ebrowser/filters/EBStringFiltersView.html",[],function(){return'<div\n  class="n-filter-by<%= expanded ? \' expanded\' : \'\' %>"\n  <%= getQaDataTestId(groupName) %>\n>\n  <h2 class="n-filter-header">\n    <%= groupName %>\n    <%= Components.icon("caret-up", "minus-icon css-icon ", "") %>\n    <%= Components.icon("caret-down", "plus-icon css-icon ", "") %>\n  </h2>\n  <div class="n-filter-checkboxes string-search">\n    \x3c!-- Reverse order, to show latest filters first --\x3e\n    <% for( var idx=filters.length-1; idx >= 0; idx-- ) {\n      var fltr = filters[idx];\n      var fltrName = fltr.getDisplayName();\n      var chkBoxId = fltr.get(fltr.idAttribute);\n      var sChecked = fltr.get(fltr.DP.IS_APPLIED) ? "checked" : "";\n      // Get selected operator from the individual filter model.\n      // Default to contains\n      var selectedOperator = fltr.get(fltr.DP.OPERATOR) ||\n        AppConstants.FILTER_OPERATORS.CONTAINS;\n      var selectedOperatorName =\n        FilterUtil.getFilterOperatorName(selectedOperator);\n    %>\n      <div class="n-checkbox-item">\n        <input\n          <%= sChecked %>\n          type="checkbox"\n          class="n-checkbox StringSearch"\n          id="<%= chkBoxId %>"\n          data-class="-blue"\n          <%= getQaDataTestId(\'enable_checkbox\') %>\n        >\n        <div class="str-filter-search n-input" data-id="<%= chkBoxId %>">\n          <div class="str-filter-options dropdown">\n            <a\n              data-toggle="dropdown"\n              class="dropdown-toggle"\n              <%= getQaDataTestId(\'options_dropdown\') %>\n            >\n              <div class="operator-name"><%= selectedOperatorName %></div>\n              <%= SVG.SVGIcon(\'z\',\'-down-arrow\') %>\n            </a>\n            <ul class="fancy-filter-drop dropdown-menu" data-id="<%= chkBoxId %>">\n              <%_.each(operators, function(tuple){\n                var selected = false;\n                if (selectedOperator === tuple[0]) {\n                  selected = true;\n                }\n              %>\n              <li class="<%=selected? \'selected\' : \'\'%>"\n                  data-val="<%= tuple[0] %>" data-id="<%= chkBoxId %>">\n                <a><%= tuple[1] %></a>\n              </li>\n              <% });%>\n            </ul>\n          </div>\n          <div class="input-wrapper">\n            <input\n              type="text"\n              class="n-str-input n-input"\n              data-id="<%= chkBoxId %>"\n              <%= getQaDataTestId(\'input\') %>\n            >\n          </div>\n        </div>\n\n      </div>\n    <% } %>\n  </div>\n</div>\n'}),define("views/pages/ebrowser/filters/EBStringFiltersView",["utils/AppConstants","utils/FilterUtil","views/pages/ebrowser/filters/EBBaseFilterTypeView","text!templates/pages/ebrowser/filters/EBStringFiltersView.html"],function(e,t,i,n){"use strict";var s=_.template(n),a=[e.FILTER_OPERATORS.CONTAINS,e.FILTER_OPERATORS.DCONTAINS,e.FILTER_OPERATORS.STARTS,e.FILTER_OPERATORS.ENDS,e.FILTER_OPERATORS.EQUALS];return i.extend({events:{"click .fancy-filter-drop li":"onCustomStringSearch"},render:function(){var i=this.model.get(this.model.DP.FILTERS),n=this.model.get(this.model.DP.GROUP_NAME),r=[];_.each(a,function(e){r.push([e,t.getFilterOperatorName(e)])}),this.$el.html(s(this.vtOptions({filters:i,groupName:n,operators:r,expanded:this.isExpanded(),FilterUtil:t}))),_.each(i,function(t){var i=t.get(t.idAttribute),n=t.get(t.DP.VALUE);n===e.CUSTOM_SEARCH.STR_SEARCH&&(n=""),this.$('.n-str-input[data-id="'+i+'"]').val(n),this._adjustInputElement(i)},this)},onCustomStringSearch:function(e){var i=$(e.currentTarget),n=i.attr("data-id"),s=this.$('.str-filter-search[data-id="'+n+'"]');s.find("li.selected[data-id='"+n+"']").removeClass("selected"),i.addClass("selected");var a=t.getFilterOperatorName(i.attr("data-val"));s.find(".operator-name").html(a),this._adjustInputElement(n)},_adjustInputElement:function(e){var t=this.$('.str-filter-search[data-id="'+e+'"]'),i=t.find(".str-filter-options").width()||60;t.find(".input-wrapper").width(206-i)}})}),define("text!templates/pages/ebrowser/filters/EBIntFiltersView.html",[],function(){return'<div\n  class="n-filter-by<%= expanded ? \' expanded\' : \'\' %>"\n  <%= getQaDataTestId(groupName) %>\n>\n  <h2 class="n-filter-header">\n    <%= groupName %>\n    <%= Components.icon("caret-up", "minus-icon css-icon ", "") %>\n    <%= Components.icon("caret-down", "plus-icon css-icon ", "") %>\n  </h2>\n  <div class="n-filter-checkboxes">\n\n    \x3c!-- Render Range Filters First --\x3e\n    <% _.each(rangeFilters, function(fltr) {\n      var fltrName = fltr.getDisplayName();\n      var chkBoxId = fltr.get(fltr.idAttribute);\n      var sChecked = fltr.get(fltr.DP.IS_APPLIED) ? "checked" : "";\n      var units = fltr.get(fltr.DP.UNITS);\n\n      var rangeParts = fltrName.split(\'::\');\n      if ( rangeParts[0] === AppConstants.STATS_NOT_AVAILABLE ||\n           rangeParts[1] === AppConstants.STATS_NOT_AVAILABLE ) {\n        return;\n      }\n      var fltrDataTestId = AppUtil.convertTitleToName(fltrName);\n    %>\n      <div class="n-checkbox-item">\n        <input\n          <%= sChecked %>\n          type="checkbox"\n          class="n-checkbox"\n          id="<%= chkBoxId %>"\n          data-class="-blue"\n          <%= getQaDataTestId(fltrDataTestId + \'_enable\') %>\n        >\n        <label for="<%= chkBoxId %>" class="n-label-text">\n          <span class="n-label-str">\n            <span class=\'range-part\'><%= rangeParts[0] %></span>\n            <% if ( fltr.isRangeEndFilter() ) { %>\n              <span class=\'range-part-separator\'>\n                <%= i18n(\'range.plus\') %></span>\n            <% } else if (!fltr.isTimeRangeFilter()){ %>\n              <span class=\'range-part-separator\'>\n                <span><%= i18n(\'range.to\') %></span></span>\n              <span class=\'range-part\'><%= rangeParts[1] %></span>\n            <% }%>\n          </span>\n        </label>\n        <span data-id="<%= chkBoxId %>" class="n-count pull-right"></span>\n      </div>\n    <% });%>\n\n    \x3c!-- Render Individual Int Filters Next --\x3e\n    <% _.each(intFilters, function(fltr) {\n      var fltrName = fltr.getDisplayName();\n      var chkBoxId = fltr.get(fltr.idAttribute);\n      var sChecked = fltr.get(fltr.DP.IS_APPLIED) ? "checked" : "";\n      var units = fltr.get(fltr.DP.UNITS);\n      var fitrOperator =\n        AppConstants.FILTER_OPERATOR_NAMES[fltr.get(fltr.DP.OPERATOR)];\n      if ( fltrName === AppConstants.STATS_NOT_AVAILABLE ) {\n        return;\n      }\n      var fltrDataTestId = AppUtil.convertTitleToName(fltrName);\n    %>\n      <div class="n-checkbox-item">\n        <input\n          <%= sChecked %>\n          type="checkbox"\n          class="n-checkbox"\n          id="<%= chkBoxId %>"\n          data-class="-blue"\n          <%= getQaDataTestId(fltrDataTestId + \'_enable\') %>\n        >\n        <label for="<%= chkBoxId %>" class="n-label-text">\n          <span class="n-label-str">\n            <span class=\'range-part\'>\n              <%= fitrOperator %>&nbsp;<%= fltrName %>\n            </span>\n          </span>\n        </label>\n        <span data-id="<%= chkBoxId %>" class="n-count pull-right"></span>\n      </div>\n    <% });%>\n\n    \x3c!-- Finally render the custom filter entry area. --\x3e\n    <% if ( customRangeFilter ) {\n      var fltr = customRangeFilter\n      var fltrName = customRangeFilter.get(customRangeFilter.DP.NAME);\n      var chkBoxId = customRangeFilter.get(customRangeFilter.idAttribute);\n      var sChecked = customRangeFilter.get(customRangeFilter.DP.IS_APPLIED) ?\n          "checked" : "";\n      // The base units for this attribute (eg \'ppm\')\n      var units = customRangeFilter.get(customRangeFilter.DP.UNITS);\n      // The preferred data entry units (eg \'%\' ). If the filter has no units,\n      // then assign "" to dUnits rather than undefined.\n      var dUnits = customRangeFilter.getUnitsForManualEntry() || "";\n      var fltrDataTestId = AppUtil.convertTitleToName(fltrName);\n    %>\n      <div class="n-checkbox-item">\n        <input\n          <%= sChecked %>\n          type="checkbox"\n          class="n-checkbox NumberSearch"\n          id="<%= chkBoxId %>"\n          data-class="-blue"\n          <%= getQaDataTestId(fltrDataTestId + \'_enable\') %>\n        >\n        <label class="n-label-text">\n          <span><span><%= i18n(\'range.from\') %></span></span>\n        </label>\n        <input\n          type="text"\n          class="n-int-input-start n-input"\n          data-id="<%=chkBoxId%>"\n          data-units="<%= units %>"\n          data-default-units="<%= dUnits %>"\n          <%= getQaDataTestId(fltrDataTestId + \'_start\') %>\n        >\n        <label class="n-label-text">\n          <span><%= i18n(\'range.to\') %></span>\n        </label>\n        <input\n          type="text"\n          class="n-int-input-end n-input"\n          data-id="<%=chkBoxId%>"\n          data-units="<%= units %>"\n          data-default-units="<%= dUnits %>"\n          <%= getQaDataTestId(fltrDataTestId + \'_end\') %>\n        >\n        <label class="n-label-text">\n          <span><%= dUnits %></span>\n        </label>\n      </div>\n    <% } %>\n  </div>\n</div>\n'}),define("views/pages/ebrowser/filters/EBIntFiltersView",["datepicker","utils/AppConstants","utils/TimeUtil","views/pages/ebrowser/filters/EBBaseFilterTypeView","text!templates/pages/ebrowser/filters/EBIntFiltersView.html"],function(e,t,i,n,s){"use strict";var a=_.template(s);return n.extend({name:"EBIntFiltersView",render:function(){var e=this.model.get(this.model.DP.FILTERS),i=this.model.get(this.model.DP.GROUP_NAME),n=null,s=[],r=[];_.each(e,function(e){var i=e.get(e.DP.NAME),a=e.get(e.DP.OPERATOR);i===t.CUSTOM_SEARCH.NUM_SEARCH?n=e:a===t.FILTER_OPERATORS.RANGE?s.push(e):r.push(e)}),this.$el.html(a(this.vtOptions({rangeFilters:s,intFilters:r,customRangeFilter:n,groupName:i,expanded:this.isExpanded()}))),n&&n.isTimeRangeFilter()&&this.initDatePicker()},initDatePicker:function(){var e=_.extend(i.getDatePickerOptions(),{endDate:Date.today()});this.$(".n-int-input-start").addClass("datepicker").datepicker(e).on("changeDate",this.onDateChange),this.$(".n-int-input-end").addClass("datepicker").datepicker(e).on("changeDate",this.onDateChange)},onDateChange:function(e){var t=jQuery.Event("keyup");t.keyCode=$.ui.keyCode.ENTER,$(e.currentTarget).trigger(t)}})}),define("text!templates/pages/ebrowser/filters/EBLabelFiltersView.html",[],function(){return'<div class="n-filter-by<%= expanded ? \' expanded\' : \'\' %>">\n  <div class="n-filter-header">\n    <%= AppUtil.getPluralEntityName(\'label\') %>\n    <%= Components.icon("caret-up", "minus-icon css-icon", "") %>\n    <%= Components.icon("caret-down", "plus-icon css-icon", "") %>\n  </div>\n  <% if ( labels.length === 0 ) { %>\n    <div class="no-labels">\n      <%= i18n(\'noLabelsMsg1\',\n        "You can use labels to filter your entities, " +\n        "but it seems you haven\'t created any labels yet.") %>\n      <span class="underline">\n        <%= i18n(\'noLabelsMsg2\') %></span>.\n        <%= i18ns(\'noLabelsMsg3\',\n            Components.icon(\'Label_Single\', \'labelIcon -inline\')) %>\n    </div>\n  <% } else { %>\n    <div class="label-filters-inner">\n      <div class="n-filter-checkboxes">\n      <% var nbLabelsToDisplay = showAllLabels ? labels.length :\n            Math.min(labels.length, MAX_LABELS_TO_SHOW); %>\n      <% for(var i=0; i< nbLabelsToDisplay; i++) {\n          var label = labels[i];\n          var labelCount = label.getLabeledEntities().length;\n          var labelName = label.get(label.nameAttribute);\n          var chkBoxId = label.get(label.idAttribute);\n          var sChecked = label.isApplied() ? "checked" : "";\n        %>\n        <div class="n-checkbox-item">\n          <input <%= sChecked %> type="checkbox" class="n-checkbox label-switch"\n            id="<%= chkBoxId %>" data-class="-blue">\n          <label for="<%= chkBoxId %>" class="n-label-text">\n            <span class="n-label-str" title="<%- labelName %>">\n              <%= AppUtil.truncateMiddle(labelName, 20) %>\n            </span>\n          </label>\n          <span data-id="<%= chkBoxId %>" class="n-count labelCount pull-right">\n            <%= labelCount %>\n          </span>\n        </div>\n        <% } %>\n      </div>\n      <div class="label-links">\n        <% if ( showAllLabels  ) { %>\n          <a class="less-labels">\n            <%= Components.icon(\'w\', \'-up-arrow\') %>\n            <%= i18n(\'showFewer\') %>\n          </a>\n          <br>\n        <% } else if ( labels.length > MAX_LABELS_TO_SHOW ) { %>\n          <a class="more-labels">\n            <%= Components.icon(\'z\', \'-down-arrow\') %>\n            <%= i18ns(\'showMore\',\n                (labels.length - MAX_LABELS_TO_SHOW)) %>\n          </a>\n          <br>\n        <% } %>\n      </div>\n      <% if ( canManage ) { %>\n        <div class="manage-labels">\n          <a>\n            <%= Components.icon(\'C\', \'-text\') %><%= i18n(\'manage\') %>\n          </a>\n        </div>\n      <% } %>\n    </div>\n  <% } %>\n</div>\n'}),define("views/pages/ebrowser/filters/EBLabelFiltersView",["utils/AppUtil","utils/EntityUtil","views/basecomponents/BaseView","views/pages/ebrowser/labels/EBManageLabelsPopupView","text!templates/pages/ebrowser/filters/EBLabelFiltersView.html"],function(e,t,i,n,s){"use strict";var a=_.template(s);return i.extend({name:"EBLabelFiltersView",events:{"click .manage-labels":"onManageLabels","click .more-labels":"onMoreLabels","click .less-labels":"onLessLabels"},showAllLabels:!1,MAX_LABELS_TO_SHOW:8,initialize:function(e){i.prototype.initialize.apply(this,arguments),this.model.on(this.model.CHANGE_EVENTS.LABELED_ENTITIES,this.render,this),this.model.on(this.model.CHANGE_EVENTS.REFRESH_DATA,this.render,this),this.model.on(this.model.CHANGE_EVENTS.SELECTED_ENTITY_TYPE,this.render,this)},render:function(){var e=this.model.getSelectedEntityType();if(!this.model.canLabelEntityType(e))return void this.$el.html("");var i=this.model.getLabelsCollection().getLabels(e);this.$el.html(a(this.vtOptions({entityType:e,labels:t.sortLabels(i),showAllLabels:this.showAllLabels,MAX_LABELS_TO_SHOW:this.MAX_LABELS_TO_SHOW,canManage:this.canModifyByEntityType(e),expanded:this.options.expanded}))).addClass("label-filters"),this.applyNutanixInput({types:["checkbox"]})},destroy:function(){this.model.off(this.model.CHANGE_EVENTS.LABELED_ENTITIES,this.render,this),this.model.off(this.model.CHANGE_EVENTS.REFRESH_DATA,this.render,this),this.model.off(this.model.CHANGE_EVENTS.SELECTED_ENTITY_TYPE,this.render,this),i.prototype.destroy.apply(this,arguments)},onMoreLabels:function(){this.showAllLabels=!0,this.render()},onLessLabels:function(){this.showAllLabels=!1,this.render()},onManageLabels:function(){var t=this.model.getLabelsCollection(),i=new n({el:e.createPopupContainer("popupManageLabels"),entityType:this.model.getSelectedEntityType(),labelsCollection:t});t.fetch(),i.show()}})}),define("text!templates/pages/ebrowser/filters/EBCategoryFiltersView.html",[],function(){return'<div\n  class="n-filter-by<%= expanded ? \' expanded\' : \'\' %>"\n  <%= getQaDataTestId(groupName) %>\n>\n  <h2 class="n-filter-header">\n    <%= groupName %>\n    <%= Components.icon("caret-up", "minus-icon css-icon ", "") %>\n    <%= Components.icon("caret-down", "plus-icon css-icon ", "") %>\n  </h2>\n  <div class="n-filter-checkboxes">\n    \x3c!-- Reversed to show latest first --\x3e\n    <% for( var idx=filters.length-1; idx >= 0; idx-- ) {\n      var fltr = filters[idx];\n      var chkBoxId = fltr.get(fltr.idAttribute);\n      var sChecked = fltr.get(fltr.DP.IS_APPLIED) ? "checked" : "";\n      var isStringSearch = fltr.getName() === \'StringSearch\';\n    %>\n      <div class="n-checkbox-item">\n        <% if (isStringSearch) { %>\n          \x3c!-- Category selector --\x3e\n          <div class="category-selector-outer" data-id="<%= chkBoxId %>"></div>\n        <% } else { %>\n          <input\n            <%= sChecked %>\n            type="checkbox"\n            class="n-checkbox"\n            id="<%= chkBoxId %>"\n            data-class="-blue"\n            <%= getQaDataTestId(\'enable_checkbox\') %>\n          >\n          <label for="<%= chkBoxId %>" class="n-label-text">\n            <span class="n-label-str">\n              <%= fltr.get(\'value\') %>\n            </span>\n          </label>\n          <span data-id="<%= chkBoxId %>" class="n-count pull-right"></span>\n        <% } %>\n      </div>\n    <% } %>\n  </div>\n</div>\n'}),define("views/pages/ebrowser/filters/EBCategoryFiltersView",["utils/SubViewHelper","views/utils/CategorySelector","views/pages/ebrowser/filters/EBBaseFilterTypeView","text!templates/pages/ebrowser/filters/EBCategoryFiltersView.html"],function(e,t,i,n){"use strict";var s=_.template(n);return i.extend({events:{},initialize:function(t){i.prototype.initialize.apply(this,arguments),this.subViewHelper=new e,_.bindAll(this,"onCategorySearch"),this.ebModel=t.ebModel},render:function(){var e=this.model.get(this.model.DP.FILTERS),i=this.model.get(this.model.DP.GROUP_NAME);this.$el.html(s(this.vtOptions({filters:e,groupName:i,expanded:this.isExpanded()})));var n=this.subViewHelper.get("categorySelector");n&&n.destroy(),n=new t({el:this.$(".category-selector-outer"),hideQuarantineCategory:!0,onChangeCB:this.onCategorySearch,clearAfter:!0}),this.subViewHelper.register("categorySelector",n),n.render()},onCategorySearch:function(e){var t=_.find(this.model.get(this.model.DP.FILTERS),function(t){return t.get(t.DP.VALUE)===e});t||(t=this.ebModel.createCategoryFilter(this.ebModel.getSelectedEntityType(),e)),this.$("#"+t.get(t.idAttribute)).prop("checked",!0).trigger("change")},destroy:function(){var e=this.subViewHelper.get("categorySelector");e&&e.destroy(),i.prototype.destroy.apply(this,arguments)}})}),define("views/basecomponents/spotlight/GroupsQuerySpotlightView",["views/basecomponents/spotlight/SpotlightView","models/query/BaseQueryModel","data/DataProperties","utils/FilterUtil","utils/AppConstants","utils/AppUtil","managers/EntityManager"],function(e,t,i,n,s,a,r){"use strict";return e.extend({name:"GroupsQuerySpotlightView",queryModel:null,initialize:function(t,i){e.prototype.initialize.apply(this,arguments),i&&(this.entityType=i.entityType,this.fieldName=i.fieldName||this.fieldName,this.defaultFilter=i.defaultFilter)},initializeDataModel:function(e){var n=e||{},s=void 0;if(this.queryModel=new t({entity_type:this.entityType,group_member_count:10,group_member_sort_attribute:n.sortBy}),!(s=this.fieldName||n.fieldName)){var a=r.getEntitySchema(this.entityType);s=a&&a.get(a.DP.NAME_ATTR)||i.NAME,this.fieldName=s}this.queryModel.setGroupMemberAttributesList([s])},search:function(e,t){var i=this;if(e=null!==e?e:this.$("input").val(),this.term=$.trim(this.$("input").val()),e.length<this.minLength)return void this.stopSearch();this._showSpinner(),this.queryModel&&this.queryModel.getState()===s.STATE_PENDING&&this.queryModel.stopFetch();var r={};this.defaultFilter&&(r=_.clone(this.defaultFilter)),r=n.addFilterCondition(r,this.fieldName,n.createFilterCondition(this.entityType,this.fieldName,s.FILTER_OPERATORS.CONTAINS,this.term)),this.queryModel.set(this.queryModel.DP.FILTER_EXPR,r),this.queryModel.save(null,{success:function(e){var t=i._massageResults();i.spotlightResultsView.suggest(t),i.$(".n-spotlight-search").removeAttr("title"),i._hideSpinner()},error:function(e,t){a.log("GroupsQuerySpotlightView: Error: ",t.statusText),e.getState()!==s.STATE_CANCELED&&(i.spotlightResultsView.suggest([]),i._hideSpinner())}})},setFieldNameByEntityType:function(){},stopSearch:function(){this.queryModel.stopFetch(),this.spotlightResultsView&&this.spotlightResultsView.close(),this._hideSpinner(),this.resetInput()},_massageResults:function(){var e=this,t=this.queryModel.getQueryResultAttributes();return _.each(t,function(t){t.fieldValue=t[e.fieldName],t.entityType=e.entityType,t.entityId=t[i.EB.ENTITY_ID]}),t}})}),define("text!templates/pages/ebrowser/filters/EBSpotlightFiltersView.html",[],function(){return'<div\n  class="n-filter-by<%= expanded ? \' expanded\' : \'\' %>"\n  <%= getQaDataTestId(groupName) %>\n>\n  <h2 class="n-filter-header">\n    <%= groupName %>\n    <%= Components.icon("caret-up", "minus-icon css-icon ", "") %>\n    <%= Components.icon("caret-down", "plus-icon css-icon ", "") %>\n  </h2>\n  <div class="n-filter-checkboxes">\n    <div class="n-spotlight"></div>\n  </div>\n</div>\n'}),define("views/pages/ebrowser/filters/EBSpotlightFiltersView",["views/pages/ebrowser/filters/EBBaseFilterTypeView","views/basecomponents/spotlight/GroupsQuerySpotlightView","data/DataProperties","utils/AppConstants","utils/EntityUtil","text!templates/pages/ebrowser/filters/EBSpotlightFiltersView.html"],function(e,t,i,n,s,a){"use strict";var r=_.template(a),o=_.template('<div class="n-checkbox-item">\n        <input\n          <%= fltr.get(fltr.DP.IS_APPLIED) ? "checked" : "" %> type="checkbox"\n          class="n-checkbox" id="<%= chkBoxId %>" data-class="-blue">\n        <label for="<%= chkBoxId %>" class="n-label-text">\n          <span class="n-label-str"><%= fltr.getDisplayName() %></span>\n        </label>\n        <span data-id="<%= chkBoxId %>" class="n-count pull-right"></span>\n      </div>');return e.extend({initialize:function(t){e.prototype.initialize.apply(this,arguments),_.bindAll(this,"onSpotlightSearch"),this.ebModel=t.ebModel},render:function(){var e=this
;this.$el.html(r(this.vtOptions({groupName:this.model.get(this.model.DP.GROUP_NAME),expanded:this.isExpanded()})));var t=this.model.get(this.model.DP.FILTERS);_.each(t,function(t){t.get(t.DP.NAME)!==n.CUSTOM_SEARCH.STR_SEARCH?e.renderFilter(t):e.searchFilter=t}),this.applyNutanixInput({types:["checkbox"]}),this.initializeSpotlightSearch()},renderFilter:function(e){this.$(".n-filter-checkboxes").prepend(o({fltr:e,chkBoxId:e.get(e.idAttribute)}))},initializeSpotlightSearch:function(){var e=this.searchFilter.get(this.searchFilter.DP.INPUT_PARAMS),a=e&&_.first(e);a===n.ENTITY_NODE&&(a=n.ENTITY_HOST),this.fieldName=s.getNameAttribute(a)||i.NAME;var r=new t({el:this.$(".n-spotlight")},{selectHandler:this.onSpotlightSearch,entityType:a,fieldName:this.fieldName,wrapperEl:this.$(".n-spotlight"),cssPosition:"absolute",resetOnBlur:!0,useInnerWidth:!0});r.setEntityType(a),r.setFieldNameByEntityType(a)},onSpotlightSearch:function(e,t){var n=t[i.ENTITY_UUID]?t[i.ENTITY_UUID]:t[i.ENTITY_ID],s=t[this.fieldName]?t[this.fieldName]:n,a=this.searchFilter.get(this.searchFilter.DP.ENTITY_TYPE),r=_.find(this.model.get(this.model.DP.FILTERS),function(e){return e.get("value")===n});if(!r){var o=this._createFilterOptions(n,s);r=this.ebModel.createCustomFilter(a,o),this.model.get(this.model.DP.FILTERS).push(r),this.renderFilter(r),this.applyNutanixInput({types:["checkbox"]})}this.$("#"+r.get("id")).prop("checked",!0).trigger("change")},_createFilterOptions:function(e,t){return{type:this.searchFilter.get(this.searchFilter.DP.TYPE),subType:this.searchFilter.get(this.searchFilter.DP.SUB_TYPE),inputType:this.searchFilter.get(this.searchFilter.DP.INPUT_TYPE),inputParams:this.searchFilter.get(this.searchFilter.DP.INPUT_PARAMS),filterable:!0,attribute:this.searchFilter.get(this.searchFilter.DP.ATTRIBUTE),operator:n.FILTER_OPERATORS.EQUALS,name:t,value:e,isApplied:!1}}})}),define("text!templates/pages/ebrowser/filters/EBMultiStringFiltersView.html",[],function(){return'<div\n  class="n-filter-by<%= expanded ? \' expanded\' : \'\' %>"\n  <%= getQaDataTestId(groupName) %>\n>\n  <h2 class="n-filter-header">\n    <%= groupName %>\n    <%= Components.icon("caret-up", "minus-icon css-icon ", "") %>\n    <%= Components.icon("caret-down", "plus-icon css-icon ", "") %>\n  </h2>\n  <div class="n-filter-checkboxes">\n    <div class="n-multistring"></div>\n  </div>\n</div>'}),define("views/pages/ebrowser/filters/EBMultiStringFiltersView",["views/pages/ebrowser/filters/EBBaseFilterTypeView","utils/AppConstants","utils/ValidationUtil","text!templates/pages/ebrowser/filters/EBMultiStringFiltersView.html"],function(e,t,i,n){"use strict";var s=_.template(n),a=_.template('<div class="input-with-button"><input type="text" class="input-multistring"<%= getQaDataTestId("multiStringFilter_input") %> ><button class="btn" ><%= i18n("add") %></button></div>'),r=_.template('<div class="n-checkbox-item">\n        <input\n          <%= fltr.get(fltr.DP.IS_APPLIED) ? "checked" : "" %> type="checkbox"\n          class="n-checkbox" id="<%= chkBoxId %>" data-class="-blue">\n        <label for="<%= chkBoxId %>" class="n-label-text">\n          <span class="n-label-str"><%= fltr.getDisplayName() %></span>\n        </label>\n        <span data-id="<%= chkBoxId %>" class="n-count pull-right"></span>\n      </div>'),o=_.template('<div class="n-error-message"><%= errorMsg %> </div>');return e.extend({name:"EBMultiStringFiltersView",events:{"click .input-with-button .btn":"onComplete"},initialize:function(t){e.prototype.initialize.apply(this,arguments),_.bindAll(this,"onComplete","onKeyup"),this.ebModel=t.ebModel},render:function(){var e=this;this.$el.html(s(this.vtOptions({groupName:this.model.get(this.model.DP.GROUP_NAME),expanded:this.isExpanded()})));var i=this.model.get(this.model.DP.FILTERS);_.each(i,function(i){i.get(i.DP.NAME)!==t.CUSTOM_SEARCH.STR_SEARCH?e.renderFilter(i):e.searchFilter=i}),this.applyNutanixInput({types:["checkbox"]}),this.initializeMultiStringSearch()},renderFilter:function(e){this.$(".n-filter-checkboxes").prepend(r({fltr:e,chkBoxId:e.get(e.idAttribute)}))},initializeMultiStringSearch:function(){this.$(".n-multistring").html(a(this.vtOptions())),this.$(".input-multistring").keyup(this.onKeyup)},onComplete:function(e){var t=this.$(".input-multistring").val(),n=this.searchFilter.get(this.searchFilter.DP.SUB_TYPE);if(!i.validate(t,n).valid){this.$(".input-multistring").addClass("error");var s=i.isValidIPAddress(t).message,a=o({errorMsg:s});return void(this.$(".n-error-message").length||this.$(".n-multistring").append(a))}this.$(".n-error-message").length&&(this.$(".input-multistring").removeClass("error"),this.$(".n-error-message").remove());var r=this.searchFilter.get(this.searchFilter.DP.ENTITY_TYPE),l=_.find(this.model.get(this.model.DP.FILTERS),function(e){return e.get(e.DP.VALUE)===t});if(!l){var c=this._createFilterOptions(t);l=this.ebModel.createCustomFilter(r,c),this.model.get(this.model.DP.FILTERS).push(l),this.renderFilter(l),this.applyNutanixInput({types:["checkbox"]})}this.$("#"+l.get("id")).prop("checked",!0).trigger("change"),this.$(".input-multistring").val("")},onKeyup:function(e){e.keyCode===$.ui.keyCode.ENTER&&this.onComplete()},_createFilterOptions:function(e){return{type:this.searchFilter.get(this.searchFilter.DP.TYPE),subType:this.searchFilter.get(this.searchFilter.DP.SUB_TYPE),inputType:this.searchFilter.get(this.searchFilter.DP.INPUT_TYPE),inputParams:this.searchFilter.get(this.searchFilter.DP.INPUT_PARAMS),filterable:!0,attribute:this.searchFilter.get(this.searchFilter.DP.ATTRIBUTE),operator:t.FILTER_OPERATORS.EQUALS,name:e,value:e,isApplied:!1}}})}),define("text!templates/pages/ebrowser/filters/EBFiltersView.html",[],function(){return'<div class="eb-browser-options ebBrowserOptions eb-filter-options">\n  <div class="filters-container">\n    <div class="user-filters">\n      <div class="panel-header">\n        <div class="pull-left"><%= i18n("filters") %></div>\n        <div\n          class="closePanel close-panel pull-right to-right"\n          <%= getQaDataTestId(\'close\') %>\n        >\n          <%= Components.icon("v", "close-icon") %>\n        </div>\n        <div class="clearfix"></div>\n      </div>\n      <div class="label-filters"></div>\n      <div class="n-filters">\n        \x3c!-- Filter group details go here --\x3e\n      </div>\n    </div>\n  </div>\n</div>\n'}),define("views/pages/ebrowser/filters/EBFiltersView",["utils/AppUtil","utils/AppConstants","utils/StatsUtil","data/DataProperties","views/basecomponents/BaseView","models/ebrowser/filters/EBBaseFilterTypeModel","utils/SubViewHelper","utils/EntityUtil","events/AppEvents","managers/NamespaceManager","views/pages/ebrowser/filters/EBEnumFiltersView","views/pages/ebrowser/filters/EBStringFiltersView","views/pages/ebrowser/filters/EBIntFiltersView","views/pages/ebrowser/filters/EBLabelFiltersView","views/pages/ebrowser/filters/EBCategoryFiltersView","views/pages/ebrowser/filters/EBSpotlightFiltersView","views/pages/ebrowser/filters/EBMultiStringFiltersView","text!templates/pages/ebrowser/filters/EBFiltersView.html"],function(e,t,i,n,s,a,r,o,l,c,d,u,h,p,T,E,g,S){"use strict";var m=_.template('<div id="<%= filterId %>"></div>'),v=_.template('<span><%= i18n("serverError") %></span>'),f=_.template(S);return s.extend({name:"EBFiltersView",events:{"change .n-checkbox":"onFilterChange","click  .fancy-filter-drop li":"onCustomStringSearch","keyup  .n-str-input":"onCustomStringSearch","keyup  .n-int-input-start":"onCustomIntegerSearch","keyup  .n-int-input-end":"onCustomIntegerSearch","click  .closePanel":"onClosePanel","click  .n-filter-header":"onToggleFiltersSection"},SUBVIEW_LABEL_FILTERS:"labelFiltersView",NUM_EXPANDED_FILTERS:t.EB_USER_SETTINGS.EXPANDED_FILTERS,render:function(){if(!this.subViewHelper){this.subViewHelper=new r;var e=f(this.vtOptions());this.$el.html(e)}var t=this.model.getSelectedEntityType();t&&(this._renderUserFilters(t),this._renderLabelFilters()),this.applyNutanixInput({types:["checkbox"]})},destroy:function(){this.onStopServices(),this.subViewHelper&&(this.subViewHelper.destroy(),this.subViewHelper=null),s.prototype.destroy.apply(this,arguments)},refreshView:function(){this.subViewHelper&&(this.subViewHelper.destroy(),this.subViewHelper=null),this.render()},onStartServices:function(){this.model.on(this.model.CHANGE_EVENTS.SELECTED_ENTITY_TYPE,this.refreshView,this),this.model.on(this.model.CHANGE_EVENTS.FILTERS,this.render,this),this.model.on(this.model.CHANGE_EVENTS.REFRESH_DATA,this.render,this),this.model.on(this.model.CHANGE_EVENTS.FILTER_COUNTS,this.updateCount,this),this.subViewHelper&&this.subViewHelper.iterate("onStartServices")},onStopServices:function(){this.model.off(this.model.CHANGE_EVENTS.SELECTED_ENTITY_TYPE,this.render,this),this.model.off(this.model.CHANGE_EVENTS.FILTERS,this.render,this),this.model.off(this.model.CHANGE_EVENTS.REFRESH_DATA,this.render,this),this.model.off(this.model.CHANGE_EVENTS.FILTER_COUNTS,this.updateCount,this),this.subViewHelper&&this.subViewHelper.iterate("onStopServices")},updateCount:function(e){var t=e.count,i=e.filterId,n=v(this.vtOptions()),s=t<0?n:t;this.$('.n-count[data-id="'+i+'"]').html(s)},onFilterChange:function(e){var i=$(e.currentTarget),n=i.attr("id"),s=i.is(":checked"),a=t.FILTER_OPERATORS.EQUALS,r=null,o=null,l=this.model.getSelectedEntityType(),c=this._getAllFiltersExcludingPlaceholders(l),d=this._getFilterById(c,n);if(0!==d.length&&this.model.fetchFiltersCounts(d,!0),i.hasClass("label-switch")){var u=this.model.getSelectedEntityType();return void this.model.toggleLabelFilter(u,n)}if(i.hasClass(t.CUSTOM_SEARCH.STR_SEARCH)){a=this.$('li.selected[data-id="'+n+'"]').attr("data-val");var h=this.$('input.n-str-input[data-id="'+n+'"]');if(r=this._validateStringValue(h),s){if(_.isNull(r))return}else h.val("").removeClass("error")}if(i.hasClass(t.CUSTOM_SEARCH.NUM_SEARCH)){a=t.FILTER_OPERATORS.RANGE;var p=this.$('input.n-int-input-start[data-id="'+n+'"]'),T=this.$('input.n-int-input-end[data-id="'+n+'"]');if(s){if(r=this._validateIntRangeValue(p),o=this._validateIntRangeValue(T),_.isNull(r)&&_.isNull(o))return}else p.val("").removeClass("error"),T.val("").removeClass("error")}if(i.hasClass(t.CUSTOM_SEARCH.CATEGORY_SEARCH)){var E=this.$(".input-category").val();E.length&&this.model.createCategoryFilter(l,E)}else this.model.updateFilter(n,a,r,o,s,this.model.getSelectedEntityType())},onCustomStringSearch:function(e){var i=$(e.currentTarget),n=i.attr("data-id"),s=this.$('input[id="'+n+'"]').is(":checked"),a=t.FILTER_OPERATORS.CONTAINS,r=null,o=this.$('input.n-str-input[data-id="'+n+'"]');if(r=this._validateStringValue(o),i.hasClass("n-str-input")){if(!(s=this.applyInput(e.keyCode,n)))return;a=this.$('li.selected[data-id="'+n+'"]').attr("data-val"),_.isNull(r)&&(o.removeClass("error"),this.$('input[id="'+n+'"]').attr("checked",!1),s=!1)}else if(a=i.attr("data-val"),_.isNull(r))return;this.model.updateFilter(n,a,r,null,s,this.model.getSelectedEntityType())},applyInput:function(e,t){var i=!1;return 13===e&&(i=!0,this.$('input[id="'+t+'"]').attr("checked",!0)),i},onCustomIntegerSearch:function(e){var i=$(e.currentTarget),n=i.attr("data-id"),s=$.ui.keyCode,a=this.$('input.n-int-input-start[data-id="'+n+'"]'),r=this.$('input.n-int-input-end[data-id="'+n+'"]'),o=this.$('input[id="'+n+'"]'),l=this._validateIntRangeValue(a),c=this._validateIntRangeValue(r);if(e.keyCode!==s.ENTER)return void(_.isNull(l)&&_.isNull(c)&&(a.addClass("error"),r.addClass("error")));_.isNull(l)&&_.isNull(c)?(o.attr("checked",!1),this.model.updateFilter(n,t.FILTER_OPERATORS.RANGE,null,null,!1,this.model.getSelectedEntityType())):(o.attr("checked",!0),this.model.updateFilter(n,t.FILTER_OPERATORS.RANGE,l,c,!0,this.model.getSelectedEntityType()))},onClosePanel:function(e){$(e.currentTarget).parents("."+l.EB_EVENT_HANDLER).trigger(l.EB_EVENTS.TOGGLE_RIGHT_PANEL)},onToggleFiltersSection:function(e){var i=$(e.currentTarget).closest(".n-filter-by"),n=i.parent().attr("id")||t.EB_USER_SETTINGS.LABEL_FILTERS,s=i.hasClass("expanded"),a=!s,r=c.get(c.USER_SETTINGS),o=r.getUserSetting(t.EB_USER_SETTINGS.OPEN_FILTERS)||{};if(a){var l=this.model.getSelectedEntityType(),d=this.model.getFiltersByEntityType(l),u=this._getFiltersByViewId(l,d,n);0!==u.length&&(this.model.loadFilterRanges(l,u),this.model.fetchFiltersCounts(u,!0))}o[n]=a,r.setUserSetting(t.EB_USER_SETTINGS.OPEN_FILTERS,o),i[a?"addClass":"removeClass"]("expanded")},_getAllFiltersExcludingPlaceholders:function(e){return _.filter(this.model.getFiltersByEntityType(e),function(e){return e.get(e.DP.VALUE)!==t.ENUM_DYN_TYPE_PLACEHOLDR})},_renderLabelFilters:function(){var e=this.subViewHelper.get(this.SUBVIEW_LABEL_FILTERS);if(!e){var i=c.get(c.USER_SETTINGS),n=i.getUserSetting(t.EB_USER_SETTINGS.OPEN_FILTERS),s=!0;n&&void 0!==n[t.EB_USER_SETTINGS.LABEL_FILTERS]&&(s=n[t.EB_USER_SETTINGS.LABEL_FILTERS]),e=new p({el:this.$(".label-filters"),model:this.model,expanded:s}),this.subViewHelper.register(this.SUBVIEW_LABEL_FILTERS,e)}e.render()},_renderUserFilters:function(t){var i=this.$(".n-filters"),n=this.model.getFiltersByEntityType(t);if(0===n.length)i.html("");else{var s=this._expandedGroups(t,n),a=this._groupFilters(n);_.each(a,function(e,n){var a=this._getViewIdentifier(t,n),r=s[n],o=this.subViewHelper.get(a);if(o)o.setExpanded(r),o.model.set("filters",e);else{var l=$(m({filterId:a}));i.append(l),o=this._createFilterGroupView(l,t,n,e,r),this.subViewHelper.register(a,o)}o.render()},this),e.addInLineDonutLoader(this.$("span.n-count:not(.labelCount")),this.refreshFilterCounts(t,!1),this.applyNutanixInput({types:["checkbox"]})}},refreshFilterCounts:function(e,t){var i=this._getAllFiltersExcludingPlaceholders(e);this.model.fetchFiltersCounts(this._expandedFilters(e,i),t)},getExpandedFilters:function(e){var t=this.model.getFiltersByEntityType(e);return this._expandedFilters(e,t)},_createFilterGroupView:function(i,s,r,l,c){var p=new a({filters:l,groupName:o.getAttributeDisplayName(s,r),isChecked:!0}),S={el:i,model:p,expanded:c,entityType:s},m=_.first(l),v=m.get(m.DP.TYPE),f=null;switch(v){case t.FILTER_TYPES.ENUM:f=new d(S);break;case t.FILTER_TYPES.STR:var A=m.get(m.DP.INPUT_TYPE);if(S.ebModel=this.model,r===n.EB.CATEGORIES)f=new T(S);else{if(A===t.INPUT_TYPES.SPOTLIGHT){f=new E(S);break}if(A===t.INPUT_TYPES.MULTISTRING){f=new g(S);break}f=new u(S)}break;case t.FILTER_TYPES.INT:f=new h(S);break;default:e.log("EntityBrowser:Filters Manager- unknown filter type")}return f},_groupFilters:function(e){return _.groupBy(e,function(e){return e.get(e.DP.ATTRIBUTE)})},_expandedGroups:function(e,i){var n=this._groupFilters(i),s=0,a={};return _.each(n,function(i,n){s++;var r=this._getViewIdentifier(e,n),o=c.get(c.USER_SETTINGS),l=o.getUserSetting(t.EB_USER_SETTINGS.OPEN_FILTERS),d=s<=this.NUM_EXPANDED_FILTERS;l&&void 0!==l[r]&&(d=l[r]),a[n]=d},this),a},_expandedFilters:function(e,t){var i=this._expandedGroups(e,t);return _.filter(t,function(e){return i[e.get(e.DP.ATTRIBUTE)]})},_getFiltersByViewId:function(e,t,i){return _.filter(t,function(t){return this._getViewIdentifier(e,t.get(t.DP.ATTRIBUTE))===i},this)},_getFilterById:function(e,t){return _.filter(e,function(e){return e.get(e.idAttribute)===t},this)},_getViewIdentifier:function(e,t){return e+"_"+t},_validateIntRangeValue:function(t){var n=t.attr("data-units"),s=t.attr("data-default-units"),a=i.parseStats(t.val(),n,s);if(t.hasClass("datepicker")){var r=new Date(t.val());t.hasClass("n-int-input-start")?r.setHours(0,0,0,0):t.hasClass("n-int-input-end")&&r.setHours(23,59,59,999),a=r.getTime()}return e.isInt(a)&&!_.isNaN(a)?(t.removeClass("error"),a):_.isNull(a)?(t.removeClass("error"),null):(t.addClass("error"),null)},_validateStringValue:function(e){var t=e.val().trim();return t.length>0?(e.removeClass("error"),t):(e.addClass("error"),null)}})}),define("views/pages/ebrowser/EntityBrowserView",["utils/AppUtil","utils/AppConstants","events/AppEvents","managers/NavigationManager","managers/ActionManager","models/ebrowser/EBQueryModel","views/pages/ebrowser/EBBaseView","views/pages/ebrowser/EBOptionsView","views/pages/ebrowser/EBPerspectivesView","views/pages/ebrowser/filters/EBFiltersView"],function(e,t,i,n,s,a,r,o,l,c){"use strict";return r.extend({centerPanelSubViewIds:null,leftPanelSubViewIds:null,rightPanelSubViewIds:null,SUBVIEW_BROWSE_OPTIONS:"ebBrowseOptions",SUBVIEW_FILTERS:"filters",SUBVIEW_LABEL_FILTERS:"labelFilters",SUBVIEW_EB_GROUPS_VIEW:"groups",SUBVIEW_EB_ENTITIES_VIEW:"entities",entityChangesMap:null,initialize:function(e){r.prototype.initialize.apply(this,arguments),_.bindAll(this,"_onEntitiesCreated","_onEntitiesDeleted","_onEntitiesUpdated"),this.leftPanelSubViewIds=[],this.centerPanelSubViewIds=[],this.rightPanelSubViewIds=[],this.entityChangesMap={}},destroy:function(){this.onStopServices(),r.prototype.destroy.apply(this,arguments)},onStartServices:function(){this.model.on(this.model.CHANGE_EVENTS.ERROR_MSG,this.onError,this),this.model.on(this.model.CHANGE_EVENTS.SELECTED_ENTITY_TYPE,this.onEntityTypeChange,this),this.model.on(this.model.CHANGE_EVENTS.REFRESH_DATA,this._refreshScrollers,this),this.model.on(this.model.CHANGE_EVENTS.QUERY_RESULTS,this._refreshScrollers,this),this.model.on(this.model.CHANGE_EVENTS.VISUALIZATION,this._refreshScrollers,this),this.model.on(this.model.CHANGE_EVENTS.LEGEND,this._refreshScrollers,this),this.subViewHelper&&this.subViewHelper.iterate("onStartServices"),this.model.startQueryPolling(),this.model.startTaskPolling();var e=this.model.getSelectedEntityType();e&&this.entityChangesMap[e]&&(this.entityChangesMap[e]=null,this.model.entitiesUpdated(e))},onStopServices:function(){this.model.stopQueryPolling(),this.model.stopTaskPolling(),this.model.off(this.model.CHANGE_EVENTS.ERROR_MSG,this.onError,this),this.model.off(this.model.CHANGE_EVENTS.SELECTED_ENTITY_TYPE,this.onEntityTypeChange,this),this.model.off(this.model.CHANGE_EVENTS.REFRESH_DATA,this._refreshScrollers,this),this.model.off(this.model.CHANGE_EVENTS.QUERY_RESULTS,this._refreshScrollers,this),this.model.off(this.model.CHANGE_EVENTS.VISUALIZATION,this._refreshScrollers,this),this.model.off(this.model.CHANGE_EVENTS.LEGEND,this._refreshScrollers,this),this.subViewHelper.iterate("onStopServices")},show:function(e){this.currentCenterViewId=this.SUBVIEW_EB_ENTITIES_VIEW;var t=new a,i=this.parseQueryOptionsToObject(e),n=i[t.DP.ENTITY_TYPE],o={};_.each(t.URL_ATTRIBUTES,function(e){i[e]&&(o[e]=i[e])}),n||this.model.getSelectedEntityType()||(n=this.getDefaultEntityType()),i[t.DP.FILTER_EXPR]&&(o[t.DP.FILTER_EXPR]=i[t.DP.FILTER_EXPR]);var l={};_.each(this.model.EXTRA_OPTIONS,function(e){i[e]&&(l[e]=i[e])}),this.model.setInitialQuery(n,o,l),this.isViewRendered?this.onEntityTypeChange():(this.render(),this.isViewRendered=!0),r.prototype.show.apply(this,arguments),this.renderPanels(),i&&i.action&&s.onEntityAction(n,i.action,i.actionTargetId),$(window).trigger("resize.app")},renderPanels:function(){this.showLeftPanel()&&this.renderLeftPanels(),this.renderCenterPanel()},parseQueryOptionsToObject:function(i){var s=e.parseQueryToObject(i)||{};return s.contextId&&(this._extractOptionsFromNavigationContext(s),n.clearNavigationContext(s.contextId)),e.isLocalStorageProperty(t.LOCAL_STORAGE.EB_QUERY_DEBUG)&&e.logObject("eb: Initialize Options",s),s},getDefaultEntityType:function(){return this.model.getEntityTypes()[0]},renderCenterPanel:function(){_.each(this.centerPanelSubViewIds,function(e){this.subViewHelper.get(e).hideView()},this),this.currentCenterViewId&&(this.subViewHelper.get(this.currentCenterViewId).showView(),this.subViewHelper.get(this.currentCenterViewId).render())},renderLeftPanels:function(){_.isEmpty(this.leftPanelSubViewIds)&&(this.initializeTopLeftView(),this.initializeBottomLeftView()),_.each(this.leftPanelSubViewIds,function(e){this.subViewHelper.get(e).render()},this)},_initializeSubViews:function(){this.initializeTopLeftView(),this.initializeBottomLeftView(),this.initializeCenterViews()},initializeTopLeftView:function(){if(this.showLeftPanel()){var e=new o({el:this.$(".left-panel-top"),model:this.model});this.subViewHelper.register(this.SUBVIEW_BROWSE_OPTIONS,e),this.leftPanelSubViewIds.push(this.SUBVIEW_BROWSE_OPTIONS)}else this._leftPanelVisible=!1},showLeftPanel:function(){return!0},initializeBottomLeftView:function(){this.$(".left-panel-bottom").hide()},initializeRightView:function(){var e=this.createFilterView(this.$(".right-panel-inner-bottom"),this.model);this.subViewHelper.register(this.SUBVIEW_FILTERS,e),this.rightPanelSubViewIds.push(this.SUBVIEW_FILTERS)},initializeCenterViews:function(){var e=this.createPerspectivesView(this.$(".center-panel"),this.model);this.subViewHelper.register(this.SUBVIEW_EB_ENTITIES_VIEW,e),this.centerPanelSubViewIds.push(this.SUBVIEW_EB_ENTITIES_VIEW)},createPerspectivesView:function(e,t){return new l({el:e,model:t})},createFilterView:function(e,t){return new c({el:e,model:t})},onToggleRightPanel:function(){var e=this.subViewHelper.get(this.SUBVIEW_FILTERS);if(e||(this.initializeRightView(),e=this.subViewHelper.get(this.SUBVIEW_FILTERS),e.onStartServices()),this.model.initUserFilters(),!this._rightPanelVisible){var t=this.model.getSelectedEntityType(),i=e.getExpandedFilters(t);this.model.loadFilterRanges(t,i),e.render(),e.refreshFilterCounts(t,!0)}r.prototype.onToggleRightPanel.apply(this,arguments)},onEntityTypeChange:function(){if(this.isViewRendered){this.renderCenterPanel();var e=this;setTimeout(function(){e._refreshScrollers()},1e3)}},onEntityEvent:function(e,t){if(this.isVisible())switch(e.type){case i.ENTITIES_CREATED:this._onEntitiesCreated(e,t);break;case i.ENTITIES_UPDATED:this._onEntitiesUpdated(e,t);break;case i.ENTITIES_DELETED:this._onEntitiesDeleted(e,t)}else{var n=e.type,s=this.entityChangesMap[t.entityType]||[];this.entityChangesMap[t.entityType]||(this.entityChangesMap[t.entityType]=s),-1===s.indexOf(n)&&s.push(n)}},_onEntitiesCreated:function(e,t){this.model.entitiesCreated(t.entityType,t.entityIds)},_onEntitiesUpdated:function(e,t){this.model.entitiesUpdated(t.entityType,t.entityIds,t.originalEntityName)},_onEntitiesDeleted:function(e,t){this.model.entitiesDeleted(t.entityType,t.entityIds)},_extractOptionsFromNavigationContext:function(e){var i=n.getNavigationContext(e.contextId);if(i){i.options[a.DP.FILTER_EXPR]&&(e[a.DP.FILTER_EXPR]=i.options[a.DP.FILTER_EXPR]),i.options[a.DP.ENTITY_IDS]&&(e[a.DP.ENTITY_IDS]=i.options[a.DP.ENTITY_IDS]),i.options[t.NAV_ACTION]&&(e[t.NAV_ACTION]=i.options[t.NAV_ACTION],e[t.NAV_ACTION_TARGET_ID]=i.options[t.NAV_ACTION_TARGET_ID]),_.each(this.model.EXTRA_OPTIONS,function(t){i.options[t]&&(e[t]=i.options[t])});var s=i.entityType;s&&(e[a.DP.ENTITY_TYPE]=s)}}},null)}),define("views/pages/ebrowser/EntityBrowserPageView",["views/basecomponents/pages/BasePageView","models/ebrowser/EntityBrowserModel","managers/ClusterManager","views/pages/ebrowser/EntityBrowserView","utils/AppConstants"],function(e,t,i,n,s){"use strict";return e.extend({name:"EntityBrowserPageView",pageId:s.PAGE_ENTITY_BROWSER,defaultSubPageId:s.SUBPAGE_ENTITIES,hasDataLoaded:!1,initialize:function(){this.model=this.createBrowserModel(),this.model.on(this.model.CHANGE_EVENTS.REFRESH_DATA,this.onDataLoaded,this),this.model.fetchData(),e.prototype.initialize.apply(this,arguments)},createBrowserModel:function(){var e={},i={};return i["group.cluster"]=[s.ENTITY_VM,s.ENTITY_CLUSTER,s.ENTITY_CONTAINER],i["group.hardware"]=[s.ENTITY_HOST,s.ENTITY_DISK],this.hideGPU()&&i["group.hardware"].push(s.ENTITY_GPU),e[t.EB_PROPERTIES.ENTITY_TYPE_GROUPINGS]=i,e[t.EB_PROPERTIES.LABEL_ENTITY_TYPES]=[s.ENTITY_VM,s.ENTITY_CLUSTER],new t(e)},onEntityEvent:function(e,t){this.subViewHelper.iterate("onEntityEvent",e,t)},destroy:function(){this.model.off(this.model.CHANGE_EVENTS.REFRESH_DATA,this.onDataLoaded,this),e.prototype.destroy.apply(this,arguments)},onStartServices:function(){$("body").addClass("n-app-noscroll"),this.hasDataLoaded&&e.prototype.onStartServices.apply(this,arguments)},onDataLoaded:function(){this.pendingSubPageId?(this._showSubPage(this.pendingSubPageId,this.pendingPageOptions),this.pendingSubPageId=null,this.pendingPageOptions=null,this.hasDataLoaded=!0,this.onStartServices(),this._fetchEntityCounts()):this.hasDataLoaded=!0},onStopServices:function(){$("body").removeClass("n-app-noscroll"),this.hasDataLoaded&&e.prototype.onStopServices.apply(this,arguments)},onShowSubPage:function(e,t){var i=null;switch(e){case s.SUBPAGE_ENTITIES:i=this.getEntityBrowserViewClass()}this.getSubView(e)||this.registerSubView(e,new i({el:this.getSubPageElement(e),model:this.model,pageId:s.PAGE_ENTITY_BROWSER})),this.hasDataLoaded?this._showSubPage(e,t):(this.pendingSubPageId=e,this.pendingPageOptions=t)},getEntityBrowserViewClass:function(){return n},hideGPU:function(){return i.doesAnyClusterHasGpu()},_showSubPage:function(e,t){this.stopServices();var i=this.getSubView(e);i&&i.show(t),this.startServices()},_fetchEntityCounts:function(){this.model.fetchEntityCounts()}})}),define("views/pages/ebrowser/AlertActionsView",["views/pages/ebrowser/EBActionsView","utils/AppConstants"],function(e,t){"use strict";return e.extend({performEntityAction:function(i,n,s,a,r){if(n===t.ACTION_RESOLVE||n===t.ACTION_ACKNOWLEDGE)if(this.model.isSelectAllEntitiesEnabled()){n=n===t.ACTION_RESOLVE?t.ACTION_RESOLVE_ALL:t.ACTION_ACKNOWLEDGE_ALL;var o=this.model.getQueryModel(i),l=o.get(o.DP.FILTER_EXPR);r=r||{},r.filterExpression=l,e.prototype.performEntityAction.call(this,i,n,null,a,r)}else e.prototype.performEntityAction.apply(this,arguments);else e.prototype.performEntityAction.apply(this,arguments)}})}),define("views/pages/ebrowser/viz/AlertTableVisualizationView",["views/pages/ebrowser/viz/BaseTableVisualizationView","utils/AppConstants","utils/ManagerMixin"],function(e,t,i){"use strict";var n=_.template('<div class="description">&nbsp;|<a class="select-all-link">Select All <%= count %> Alerts</a></div>');return e.extend(_.extend({},i,{extraEvents:{"click .select-all-link":"onClickSelectAllLink"},initialize:function(t){e.prototype.initialize.apply(this,arguments),this.addExtraEvents(this.extraEvents),_.bindAll(this,"onSelectAllCheckboxChangeEvent")},onClickSelectAllLink:function(){this.isSelectAllAllowed()&&this.selectionsModel.updateSelectAllEntities(this.entityType,!0),this.onSelectionChange()},onSelectAllCheckboxChangeEvent:function(e,t){t||this.selectionsModel.updateSelectAllEntities(this.entityType,!1),this.onSelectionChange()},isSelectionEnabled:function(){return this.entityType!==t.ENTITY_EVENT&&this.entityType!==t.ENTITY_AUDIT},getEBTableView:function(i){i.entityType!==t.ENTITY_EVENT&&this.entityType!==t.ENTITY_AUDIT||(i.disableCheckBox=!0);var n=e.prototype.getEBTableView.apply(this,arguments);return n.onSelectAllCheckboxChangeEvent(this.onSelectAllCheckboxChangeEvent),n},getSelectedMsg:function(t,i,n,s){return this.selectionsModel.isSelectAllEntitiesEnabled(this.entityType)&&(i=t.get(t.DP.TOTAL_ENTITY_COUNT)),e.prototype.getSelectedMsg.call(this,t,i,n,s)},renderSelectAllLinks:function(e){if(!this.isSelectAllAllowed())return"";var t=e.get(e.idAttribute),i=this.subViewHelper.get(t);return i&&i.isSelectAllCheckboxChecked()&&!this.selectionsModel.isSelectAllEntitiesEnabled(this.entityType)?n({count:e.get(e.DP.TOTAL_ENTITY_COUNT)}):""},isSelectAllEntitiesEnabled:function(){return this.selectionsModel.isSelectAllEntitiesEnabled(this.entityType)},isSelectAllAllowed:function(){return!this.getDataManager().isV3PrimaryDataSource()||this.getAccessManager().hasV3andV1Role()}}))}),define("views/pages/ebrowser/AlertPerspectivesView",["views/pages/ebrowser/EBPerspectivesView","views/pages/ebrowser/AlertActionsView","views/pages/ebrowser/viz/AlertTableVisualizationView"],function(e,t,i){"use strict";return e.extend({showSelectedEntitiesMenu:function(){return!1},canFilterByEntityName:function(){return!1},_addTooltip:function(){},createActionsView:function(e,i){return new t({el:e,model:i})},getTableVisualizationView:function(e){return new i(e)},_selectNone:function(){this.model.getSelectionsModel().updateSelectAllEntities(this.model.getSelectedEntityType(),!1),e.prototype._selectNone.apply(this,arguments)},_selectTotal:function(){var t=this.subViewHelper.get(this.currentVisualizationId);if(t.isSelectAllAllowed())return void t.onClickSelectAllLink();e.prototype._selectTotal.apply(this,arguments)}})}),define("views/pages/ebrowser/AlertBrowserView",["views/pages/ebrowser/EntityBrowserView","views/pages/ebrowser/AlertPerspectivesView","views/pages/ebrowser/filters/EBFiltersView","utils/AppConstants"],function(e,t,i,n){"use strict";var s=i.extend({NUM_EXPANDED_FILTERS:3});return e.extend({showLeftPanel:function(){if(this.model){var e=this.model.getEntityTypes();if(e&&1===e.length)return!1}return!0},getDefaultEntityType:function(){return n.ENTITY_ALERT},createFilterView:function(e,t){return new s({el:e,model:t})},createPerspectivesView:function(e,i){return new t({el:e,model:i})}})}),define("models/ebrowser/AlertEBQueryModel",["models/ebrowser/EBQueryModel","data/DataProperties","utils/AppConstants","utils/FilterUtil"],function(e,t,i,n){"use strict";var s=e.extend({_filterExpressionToFilterCriteria:function(t){var n={},s=[],a=[],r=[];return _.each(t,function(e,t){"resolved"!==t&&"acknowledged"!==t?n[t]=e:_.each(e,function(e){"acknowledged"===t?r.push(e.value1):e.value1===i.ALERT_RESOLVED.MANUAL?(s.push(!0),a.push(!1)):e.value1===i.ALERT_RESOLVED.AUTO?a.push(!0):s.push(!1)})}),this.addFilterCondition(n,"resolved",s),this.addFilterCondition(n,"acknowledged",r),this.addFilterCondition(n,"auto_resolved",a),n=this._fixTimeFilter(n),e.prototype._filterExpressionToFilterCriteria.call(this,n)},getEBQueryModelInstance:function(e){return new s(e)},_fixTimeFilter:function(e){var n=this,s=e[t.EB.CREATED_TIMESTAMP_USECS];if(s)return _.each(s,function(e){var t=e.value2&&e.value2/i.MICROS_PER_MILLI;n.shouldApplyEndFilter(t)||(e.value2=null)}),e;var a=e[t.ALERT_INTERVAL_START];if(!a)return e;var r=[],o=[];return _.each(a,function(e){var t=_.clone(e);if(t.value2){var s=_.clone(t);s.value1=t.value2,t.value2=null,s.value2=null,t.op=i.FILTER_OPERATORS.EQUALS,s.op=i.FILTER_OPERATORS.EQUALS,n.shouldApplyEndFilter(s.value1)&&o.push(s)}r.push(t)}),r.length&&(e[t.ALERT_INTERVAL_START]=r),o.length&&(e[t.ALERT_INTERVAL_END]=o),e},shouldApplyEndFilter:function(e){return Date.now()>e+i.MILLIS_PER_HOUR},addFilterCondition:function(e,t,s){s=_.uniq(s),s.length<2&&_.each(s,function(s){n.addFilterCondition(e,t,n.createFilterCondition(i.ENTITY_ALERT,t,i.FILTER_OPERATORS.EQUALS,""+s))})}});return s}),define("models/ebrowser/AlertBrowserModel",["models/ebrowser/EntityBrowserModel","models/ebrowser/AlertEBQueryModel","models/query/BaseQueryModel","managers/AlertSummaryManager","managers/ClusterManager","utils/AlertUtil","utils/AppConstants"],function(e,t,i,n,s,a,r){"use strict";return e.extend({name:"AlertBrowserModel",EB_CHANGE_DETECT_INTERVAL:r.LONG_POLLING_INTERVAL,QUERY_POLL_CHECK_FREQUENCY:1e3,getEntityTypes:function(){var e=[r.ENTITY_ALERT];return this.getDataManager().isV3PrimaryDataSource()&&!this.getAccessManager().hasV3andV1Role()||e.push(r.ENTITY_EVENT),s.isMulticlusterNavMode()&&this.getAccessManager().isEntityEnabled(r.ENTITY_AUDIT)&&e.push(r.ENTITY_AUDIT),e},getOptionsHeader:function(){return this.i18n("optionsHeader")},getEntityTypeGroupings:function(){var e=_defineProperty({},r.EB_NO_ENTITY_TYPE_GROUP,[r.ENTITY_ALERT,r.ENTITY_EVENT]);return s.isMulticlusterNavMode()&&this.getAccessManager().isEntityEnabled(r.ENTITY_AUDIT)&&e[r.EB_NO_ENTITY_TYPE_GROUP].push(r.ENTITY_AUDIT),e},_getInactivityPollingOptions:function(){return{inactivityInterval:this.EB_CHANGE_DETECT_INTERVAL,queryPollCheckFrequency:this.QUERY_POLL_CHECK_FREQUENCY}},getExcludeNullsFilterExpression:function(e,t){return null},setInitialQuery:function(t,n){if(!(arguments.length>2&&void 0!==arguments[2]?arguments[2]:{})[this.EXTRA_OPTIONS.SKIP_DEFAULT_FILTERS]&&!n[i.DP.FILTER_EXPR]&&!this.getSelectedEntityType()){var s={};t===r.ENTITY_ALERT?(a.setAlertSeverityFilter(s,this.getHighestSeverity()),
a.setAlertResolvedFilter(s,!1)):t===r.ENTITY_EVENT&&a.setClassificationFilter(s,r.EVENT.TYPE.ANOMALOUS,r.ENTITY_EVENT),n[i.DP.FILTER_EXPR]=s}e.prototype.setInitialQuery.apply(this,arguments)},getHighestSeverity:function(){var e=n.getAlertCollection(),t="critical";return _.some(r.ALERT_SEVERITY_HIERARCHY,function(i,n){if(e.getAlertCountsBySeverity(n)>0)return t=r.ALERT_SEVERITY_NAMES[n],!0},this),t},getEBQueryModelInstance:function(e){return new t(e)},startTaskPolling:function(){},stopTaskPolling:function(){},fetchEntityCounts:function(){e.prototype.fetchEntityCounts.call(this,!1)}})}),define("views/pages/ebrowser/AlertExplorerPageView",["views/pages/ebrowser/EntityBrowserPageView","views/pages/ebrowser/AlertBrowserView","models/ebrowser/AlertBrowserModel","utils/AppConstants"],function(e,t,i,n){"use strict";return e.extend({pageId:n.PAGE_ALERT_EXPLORER,defaultSubPageId:n.SUBPAGE_ENTITIES,createBrowserModel:function(){return new i},getEntityBrowserViewClass:function(){return t}})}),define("utils/ComboBox",["jquery","jqueryui/autocomplete"],function(e,t){"use strict";e.widget("ui.combobox",{options:{initalSelectPrompt:null,initialSelectValue:null,customClass:null,showAllSelectOptions:!0,customSelectFunction:null},_create:function(){var t=this,i=this.element.hide(),n=i.children(":selected"),s=this.options.showAllSelectOptions,a=n.val()?n.text():"";a=this.options.initialSelectValue||this.options.initalSelectPrompt||a;var r="ui-widget ui-widget-content ui-corner-left";!this.options.initialSelectValue&&this.options.initalSelectPrompt&&(r+=" inital-select-prompt");var o=this.options.customClass,l=this.options.customSelectFunction,c=this.input=e('<input type="text">').attr("placeholder",this.options.initalSelectPrompt||"").insertAfter(i).val(a).autocomplete({delay:0,minLength:0,source:function(n,a){var r=[];if(""!==n.term||s){var o=new RegExp(e.ui.autocomplete.escapeRegex(n.term),"i");r=i.children("option").map(function(){var i=e(this).text();if(this.value&&(!n.term||o.test(i))){var s=i;return t.isASCII(i)&&(s=t.getFomatterLabel(i,n.term)),{label:s,value:i,option:this}}})}a(r)},select:function(t,n){var s=void 0;n.item.option&&(s=n.item.option,s.selected=!0),"function"==typeof l&&l(t,n,i),e(i).trigger("select",{item:s})},change:function(t,n){if(!n.item){var s=new RegExp("^"+e.ui.autocomplete.escapeRegex(e(this).val())+"$","i"),a=!1;if(i.children("option").each(function(){if(this.value.match(s))return this.selected=a=!0,e(i).trigger("change",{item:this}),!1}),!a)return e(this).val(""),i.val(""),e(i).trigger("change",{item:null}),!1}},open:function(e,t){c.autocomplete("widget").addClass("active"),c.addClass("active"),i.trigger("open")},close:function(e,t){c.autocomplete("widget").removeClass("active"),c.removeClass("active")}}).addClass(r).keypress(function(t){var n=e.ui.keyCode;t.keyCode===n.ENTER&&e(i).trigger("change",{item:c.val()})}).click(function(e){this.select(),c.val()===t.options.initalSelectPrompt&&c.val(""),c.removeClass("inital-select-prompt"),c.autocomplete("search",""),c.focus()});o&&(c.addClass(o),c.autocomplete("widget").addClass(o)),c.data("autocomplete")._renderItem=function(t,i){return e("<li></li>").data("item.autocomplete",i).append("<a>"+i.label+"</a>").appendTo(t)},this.button=e("<button>&nbsp;</button>").attr("tabIndex",-1).insertAfter(c).button({icons:{primary:"ui-icon-triangle-1-s"},text:!1}).removeClass("ui-corner-all").addClass("ui-corner-right ui-button-icon").click(function(e){if(e.preventDefault(),c.autocomplete("widget").is(":visible"))return void c.autocomplete("close");c.removeClass("inital-select-prompt"),c.autocomplete("search",""),c.focus()})},clear:function(){e(this.input).val("").removeClass("inital-select-prompt").addClass("inital-select-prompt")},getFomatterLabel:function(t,i){return t=t.replace(new RegExp("(?![^&;]+;)(?!<[^<>]*)("+e.ui.autocomplete.escapeRegex(i)+")(?![^<>]*>)(?![^&;]+;)","gi"),"<strong>$1</strong>")},isASCII:function(e){return/^[\x00-\x7F]+$/.test(e)},destroy:function(){this.input.remove(),this.button.remove(),e.Widget.prototype.destroy.call(this)}})}),define("text!templates/timeline/MetricChartContent.html",[],function(){return'<div data-ntnx-content-inner>\n  <form>\n\n    <section data-ntnx-section>\n      <label data-ntnx-label for="chartTitle">\n        <%= i18n(\'chart_title\') %>\n      </label>\n      <input type="text" id="chartTitle" maxlength="40">\n    </section>\n\n    <section data-ntnx-section>\n      <label data-ntnx-label for="chartTitle" for="inputMetric">\n        <%= i18n(\'metric\') %>\n      </label>\n      <select id="inputMetric" class="n-preserve-style">\n        <option value=""><%= i18n(\'select_metric\') %></option>\n      <% _.each(metrics, function(m) { %>\n        <option value="<%=m.id%>"><%= m.title %></option>\n      <% }) %>\n      </select>\n      <div class="metric-results metricResults"></div>\n      <div data-ntnx-hint class="metricDescription"></div>\n    </section>\n\n    <section data-ntnx-section>\n      <label data-ntnx-label for="inputEntityType">\n        <%= i18n(\'entity_type\') %>\n      </label>\n      <div class="entity-type-wrapper">\n        <select id="inputEntityType">\n          <% _.each(entityTypes, function(et) { %>\n          <option value="<%=et.id%>"><%= et.title %></option>\n          <% }) %>\n        </select>\n      </div>\n    </section>\n\n    <section data-ntnx-section>\n      <label data-ntnx-label><%= i18n(\'entity\') %></label>\n      <div class="n-spotlight"></div>\n    </section>\n\n    <section data-ntnx-section class="selection-list selectionList"></section>\n\n  </form>\n</div>'}),define("text!templates/timeline/SelectionList.html",[],function(){return'<h5 data-ntnx-title><%= title %></h5>\n<section data-ntnx-section>\n  <ul data-ntnx-ul>\n    <% _.each(selectedEntities, function(entity) { %>\n      <li>\n        <i\n          class="btn-delete btnDelete"\n          data-icon="K"\n          aria-hidden="true"\n          data-id="<%= entity.id %>"\n        ></i>\n        <%= _.escape(entity.title) %>\n      </li>\n    <% }) %>\n  </ul>\n<section>'}),define("views/timeline/MetricChartPopupView",["jqueryui/autocomplete","views/basecomponents/popups/BasePopupView","data/DataProperties","managers/ClusterManager","views/basecomponents/spotlight/SpotlightView","utils/AppConstants","utils/AppUtil","utils/ComboBox","utils/CommonTemplates","text!templates/timeline/MetricChartContent.html","text!templates/timeline/SelectionList.html"],function(e,t,i,n,s,a,r,o,l,c,d){"use strict";return c=_.template(c),d=_.template(d),t.extend({name:"MetricChartPopupView",spotlight:null,events:{"click  .btnSave":"onSave","click  .btnCancel":"onCancel","click  .modal-header .close":"hide","keypress input":"onKeyPress","click input":"clearHeader","click select":"clearHeader","click .btnDelete":"onRemoveSelectedEntity","select #inputMetric":"onMetricChange","change #inputEntityType":"onEntityTypeSelect","focus  #searchText":"onSearchTextFocus","blur   #searchText":"onSearchTextBlur",keydown:"onKeyDown","change #inputMetric ~ .ui-autocomplete-input":"onChangeMetricInput"},onRemoveSelectedEntity:function(e){var t=$(e.currentTarget).attr("data-id");this.model.removeSecondaryObject(t),this._renderSelectedEntities()},onEntityTypeSelect:function(){var e=this.$("#inputEntityType").val();this._adjustSpotlight(e)},onChangeMetricInput:function(e){if(!$(e.target).val()){var t=this.$("#inputEntityType"),i=[];_.each(_.sortBy(this.model.ENTITY_TYPES,function(e){return e.title}),function(e){i.push({name:e.title,value:e.id})}),r.populateDropdown(t,i)}},onMetricChange:function(){this.clearHeader();var e=this.$("#inputMetric").val(),t=this.model.getMetricById(e);if(t){this.$(".metricDescription").text(t.description);var i=this.model.getEntityTypesForMetric(e),n=this.$("#inputEntityType"),s=[];_.each(i,function(e){var t=this.model.getEntityTypeById(e);s.push({name:t.title,value:t.id})},this),r.populateDropdown(n,s);var a=this.model.getSecondaryObjects();_.each(a,function(e){var t=e.type.toLowerCase();i.indexOf(t)<0&&this.model.removeSecondaryObject(e.id)},this),this._adjustSpotlight(this.$("#inputEntityType").val()),this._renderSelectedEntities()}},initialize:function(e){this.onSuccess=e.onSuccess,this.popupTitle=e.popupTitle||this.i18n("popup_title")},render:function(){var e=function(e){return e.title},t={metrics:_.sortBy(this.model.getCurrentEnvironmentMetrics(),e),entityTypes:_.sortBy(this.model.ENTITY_TYPES,e)},a=[{text:this.i18n("cancel"),extraClasses:"btnCancel"},{isPrimary:!0,text:this.i18n("save"),extraClasses:"btnSave"}];this.$el.html(this.defaultTemplate({title:this.popupTitle,bodyContent:c(this.vtOptions(t)),footerButtons:this.defaultFooter(a)})),this.model.getPrimaryObject()&&(this.$("#chartTitle").val(this.model.get("title")),this.$("#inputMetric").val(this.model.getPrimaryObject().id)),this.$("#inputMetric").combobox({initalSelectPrompt:this.model.getPrimaryObject()?this.model.getPrimaryObject().title:this.i18n("select_metric")}),$(".ui-autocomplete").appendTo(".metricResults");var r=this,o=function(e,t){var n=t[i.ENTITY_UUID]?t[i.ENTITY_UUID]:t[i.ENTITY_ID],s={id:n,title:r._getEntityTitle(t),type:t.entityType,enabled:!0};return r.addSelectedEntity(s),!1};this.spotlight=new s({el:this.$(".n-spotlight")},{selectHandler:o,entityType:this.$("#inputEntityType").val(),wrapperEl:this.$(".n-spotlight"),cssPosition:"absolute",supportedEntityTypes:this.getSupportedEntities(),clearOnSelect:!0}),this.spotlight.setMulticluster(n.isMulticlusterNavMode()),this._renderSelectedEntities(),this.onMetricChange(),this.$(".metricDescription").text(""),this.applyNutanixInput()},show:function(e){t.prototype.show.apply(this,arguments),this.model.isTransient()&&this.showHeaderSuccess(l.TEMP_CHART_CREATED),this.$("#chartTitle").focus()},hide:function(){t.prototype.hide.apply(this,arguments)&&(this.$("#inputMetric").combobox("destroy"),this.spotlight.destroy())},reset:function(){},validateForm:function(){var e="",t=this.$("#chartTitle").val().trim();if(t.length&&r.hasHTMLCharacters(t)?e=this.i18n("error_message_alphanum"):this.model.getPrimaryObject()?0===this.model.getSecondaryObjects().length&&(e=this.i18n("error_message_select_entity")):e=this.i18n("error_message_select_metric"),$.trim(e).length>0)return e},addSelectedEntity:function(e){this.model.addSecondaryObject(e),this._renderSelectedEntities()},_renderSelectedEntities:function(){var e=this.$(".selectionList"),t=this.model.getSecondaryObjects();if(e.empty(),t.length>0){var i=d({title:this.i18n("selected_entities"),selectedEntities:t});e.html(i)}},_adjustSpotlight:function(e){this.spotlight.setEntityType(e),this.spotlight.setFieldNameByEntityType(e)},getSupportedEntities:function(){return n.isMulticlusterNavMode()?this.model.getMultiClusterEntityTypes():this.model.ENTITY_TYPES},clearForm:function(){},onSave:function(){var e=this.$("#inputMetric").val(),t=this.$("#chartTitle").val(),i=this.model.getMetricById(e);this.model.set({enabled:!0,primaryObj:i,title:t});var n=this.validateForm();if($.trim(n).length>0)return void this.showHeaderError(n);this.onSuccess(this.model),this.hide()},onCancel:function(){this.hide()},onSearchTextFocus:function(e){this.spotlight&&this.spotlight.search(this.$(".n-spotlight #searchText").val(),e)},onSearchTextBlur:function(){this.spotlight&&this.spotlight.stopSearch()},onKeyDown:function(e){var t=$.ui.keyCode;e.keyCode===t.ESCAPE&&this.hide()},_getEntityTitle:function(e){var t=a.ENTITY_NAMES[e.entityType]||e.entityType;return t+=" ",t+=e.displayString||e.entityName||e.entityId}})}),define("text!templates/timeline/EntityChartContent.html",[],function(){return'<div data-ntnx-content-inner>\n  <form>\n\n    <section data-ntnx-section>\n      <label data-ntnx-label for="chartTitle">\n        <%= i18n(\'chart_title\') %>\n      </label>\n      <input type="text" id="chartTitle"  maxlength="40">\n    </section>\n\n    <section data-ntnx-section>\n      <label data-ntnx-label for="inputEntityType">\n        <%= i18n(\'entity_type\') %>\n      </label>\n      <select id="inputEntityType">\n        <% _.each(entityTypes, function(et) { %>\n        <option value="<%=et.id%>"><%= et.title %></option>\n        <% }) %>\n      </select>\n    </section>\n\n    <section data-ntnx-section>\n      <label data-ntnx-label>\n        <%= i18n(\'entity\') %>\n      </label>\n      <div class="n-spotlight"></div>\n    </section>\n\n    <section data-ntnx-section>\n      <label data-ntnx-label for="inputMetric">\n        <%= i18n(\'metric\') %>\n      </label>\n      <select id="inputMetric" class="n-preserve-style">\n        <% _.each(metrics, function(m) { %>\n        <option value="<%=m.id%>"><%= m.title %></option>\n        <% }) %>\n      </select>\n      <div class="entity-results"></div>\n      <section data-ntnx-section="type-text" class="metric-description"></section>\n    </section>\n\n    <section data-ntnx-section class="selection-list"></section>\n\n  </form>\n</div>'}),define("views/timeline/EntityChartPopupView",["views/basecomponents/popups/BasePopupView","fancyselect","managers/ClusterManager","views/basecomponents/spotlight/SpotlightView","utils/AppConstants","utils/AppUtil","utils/ComboBox","utils/CommonTemplates","text!templates/timeline/EntityChartContent.html","text!templates/timeline/SelectionList.html"],function(e,t,i,n,s,a,r,o,l,c){"use strict";return l=_.template(l),c=_.template(c),e.extend({name:"EntityChartPopupView",spotlight:null,events:{"click  .btnSave":"onSave","click  .btnCancel":"onCancel","click  .modal-header .close":"hide","keypress input":"onKeyPress","click input":"clearHeader","click select":"clearHeader","change #inputEntityType":"onEntityTypeSelect","click .btnDelete":"onRemoveSelectedMetric","select #inputMetric":"onMetricChange","focus  #searchText":"onSearchTextFocus","blur   #searchText":"onSearchTextBlur",keydown:"onKeyDown"},onRemoveSelectedMetric:function(e){var t=$(e.currentTarget).attr("data-id");if(this.model.removeSecondaryObject(t),this._renderSelectedMetrics(),0===this.model.getSecondaryObjects().length){var i=this.$("#inputEntityType").val();this._adjustMetricSelector(i)}},onMetricChange:function(){this.clearHeader();var e=this.$("#inputMetric").val(),t=this.model.getMetricById(e);this.$(".metric-description").text(t.description),this.model.addSecondaryObject({id:t.id,title:t.title,enabled:!0}),this._renderSelectedMetrics()},onEntityTypeSelect:function(){this.setSelectedEntity(null);var e=this.$("#inputEntityType").val();this._adjustMetricSelector(e),this._adjustSpotlight(e),this._clearSelectedMetrics()},_adjustSpotlight:function(e){this.spotlight.clearInput(),this.spotlight.setEntityType(e),this.spotlight.setFieldNameByEntityType(e)},_renderSelectedMetrics:function(){var e=this.$(".selection-list"),t=this.model.getSecondaryObjects();if(e.empty(),t.length>0){var i=c({title:this.i18n("selected_metrics"),selectedEntities:t});e.html(i)}},initialize:function(e){this.onSuccess=e.onSuccess,this.popupTitle=e.popupTitle||this.i18n("popup_title")},render:function(){var e=$.extend({metrics:_.sortBy(this.model.METRICS,"title"),entityTypes:this.getSupportedEntities()}),t=[{text:this.i18n("cancel"),extraClasses:"btnCancel"},{isPrimary:!0,text:this.i18n("save"),extraClasses:"btnSave"}];this.$el.html(this.defaultTemplate({title:this.popupTitle,antiscroll:!1,bodyContent:l(this.vtOptions(e)),footerButtons:this.defaultFooter(t)})),this.$("#inputMetric").combobox({initalSelectPrompt:this.i18n("select_metric")});var s=this,a=function(e,t){var i=t.entityName?t.entityName:t.entityId,n={id:t.entityId,title:s._getEntityTitle(t),type:t.entityType,entityName:i,enabled:!0};return s.setSelectedEntity(n),s.$("#searchText").val(i),!1};this.spotlight=new n({el:this.$(".n-spotlight")},{selectHandler:a,entityType:this.$("#inputEntityType").val(),wrapperEl:this.$(".n-spotlight"),cssPosition:"absolute",supportedEntityTypes:this.getSupportedEntities()}),this.spotlight.setMulticluster(i.isMulticlusterNavMode()),this.$("#searchForm").css("margin-top",0);var r=this.model.ENTITY_TYPES[0].id;this.$("#chartTitle").val(this.model.get("title"));var o=void 0;this.model.getPrimaryObject()&&(r=this.model.getPrimaryObject().type.toLowerCase(),this.$("#inputEntityType").val(r),o=this.model.getPrimaryObject().entityName||this.model.getPrimaryObject().id),this._adjustSpotlight(r),o&&this.$("#searchText").val(o),this._adjustMetricSelector(r),this._renderSelectedMetrics(),_.each(this.model.getSecondaryObjects(),function(e){this.$("#"+e.id).attr("checked","checked")},this),this.applyNutanixInput()},_adjustMetricSelector:function(e){var t=this.model.getMetricsForEntityType(e),i=this.$("#inputMetric");i.combobox("destroy"),this.$(".metric-description").text("");var n=[];_.each(t,function(e){var t=this.model.getMetricById(e);t&&n.push({name:t.title,value:e})},this),a.populateDropdown(i,_.sortBy(n,function(e){return e.name})),i.combobox({initalSelectPrompt:this.i18n("select_metric")}),$(".ui-autocomplete").addClass("modal-autocomplete").appendTo("body")},_adjustSelectedMetrics:function(e){var t=this.model.getMetricsForEntityType(e),i=_.filter(this.model.getSecondaryObjects(),function(e){return t.indexOf(e.id)<0},this);i.length>0&&(_.each(i,function(e){this.model.removeSecondaryObject(e.id)},this),this._renderSelectedMetrics())},_clearSelectedMetrics:function(){this.model.removeAllSecondaryObjects(),this.$(".selection-list").empty()},show:function(t){e.prototype.show.apply(this,arguments),this.model.isTransient()&&this.showHeaderSuccess(o.TEMP_CHART_CREATED),this.$("#chartTitle").focus()},hide:function(){e.prototype.hide.apply(this,arguments)&&(this.$("#inputMetric").combobox("destroy"),this.spotlight.destroy())},reset:function(){},validateForm:function(){var e="",t=this.$("#chartTitle").val().trim();if(t.length&&a.hasHTMLCharacters(t)?e=this.i18n("error_message_alphanum"):null===this.model.getPrimaryObject()?e=this.i18n("error_message_select_entity"):0===this.model.getSecondaryObjects().length&&(e=this.i18n("error_message_select_metric")),$.trim(e).length>0)return e},setSelectedEntity:function(e){this.model.setPrimaryObject(e)},getSupportedEntities:function(){return i.isMulticlusterNavMode()?this.model.getMultiClusterEntityTypes():this.model.ENTITY_TYPES},clearForm:function(){},onSave:function(){var e=this.$("#chartTitle").val(),t=this.validateForm();if($.trim(t).length>0)return void this.showHeaderError(t);this.model.set({enabled:!0,title:e}),this.onSuccess(this.model),this.hide()},onCancel:function(){this.hide()},onSearchTextFocus:function(e){this.spotlight&&this.spotlight.search(this.$(".n-spotlight #searchText").val(),e)},onSearchTextBlur:function(){this.spotlight&&this.spotlight.stopSearch()},onKeyDown:function(e){var t=$.ui.keyCode;e.keyCode===t.ESCAPE&&this.hide()},_getEntityTitle:function(e){var t=s.ENTITY_NAMES[e.entityType]||e.entityType;return t+=" ",t+=e.displayString||e.entityName||e.entityId}})}),define("models/timeline/AnalysisChartModel",["models/BaseModel","utils/StyleDescriptor","utils/AppConstants","utils/AppUtil","utils/StatsUtil","utils/HypervisorUtil","managers/ClusterManager","data/DataProperties"],function(e,t,i,n,s,a,r,o){"use strict";var l=[i.ENTITY_REMOTE_SITE,i.ENTITY_PROTECTION_DOMAIN,i.ENTITY_STORAGE_POOL,i.ENTITY_REPLICATION_LINK,i.ENTITY_ACROPOLIS_VOLUME_GROUP];return e.extend({name:"AnalysisChartModel",CHART_TYPE_METRIC:"Metric",CHART_TYPE_ENTITY:"Entity",CHART_SIZE_SMALL:"s",CHART_SIZE_MEDIUM:"m",CHART_SIZE_LARGE:"l",CHART_LINK_PREFIX:"def=",METRICS:[{id:o.STATS_HYP_NUM_IOPS,title:"Hypervisor IOPS",description:"Input/Output operations per second from Hypervisor."},{id:o.STATS_HYP_NUM_READ_IOPS,title:"Hypervisor IOPS - Read",description:"Input/Output read operations per second from Hypervisor."},{id:o.STATS_HYP_NUM_WRITE_IOPS,title:"Hypervisor IOPS - Write",description:"Input/Output write operations per second from Hypervisor."},{id:o.STATS_NUM_IOPS,title:"Disk IOPS",description:"Input/Output operations per second from disk."},{id:o.STATS_NUM_READ_IOPS,title:"Disk IOPS - Read",description:"Input/Output read operations per second from disk."},{id:o.STATS_NUM_WRITE_IOPS,title:"Disk IOPS - Write",description:"Input/Output write operations per second from disk."},{id:o.STATS_READ_IO_PPM,title:"Read IOPS (%)",description:"Percent of IOPS that are reads."},{id:o.STATS_WRITE_IO_PPM,title:"Write IOPS (%)",description:"Percent of IOPS that are writes."},{id:o.STATS_HYP_BANDWIDTH,title:"Hypervisor I/O Bandwidth",description:"Data transferred per second in KB/second from Hypervisor."},{id:o.STATS_HYP_READ_BANDWIDTH,title:"Hypervisor I/O Bandwidth - Read",description:"Read data transferred per second in KB/second from Hypervisor."},{id:o.STATS_HYP_WRITE_BANDWIDTH,title:"Hypervisor I/O Bandwidth - Write",description:"Write data transferred per second in KB/second from Hypervisor."},{id:o.STATS_BANDWIDTH,title:"Disk I/O Bandwidth",description:"Data transferred per second in KB/second from disk."},{id:o.STATS_READ_BANDWIDTH,title:"Disk I/O Bandwidth - Read",description:"Read data transferred per second in KB/second from disk."},{id:o.STATS_WRITE_BANDWIDTH,title:"Disk I/O Bandwidth - Write",description:"Write data transferred per second in KB/second from disk."},{id:o.STATS_HYP_NUM_RECEIVED_BYTES,title:"Network Rx Bytes",description:"Network transimitted bytes reported by hypervisor."},{id:o.STATS_HYP_NUM_TRANSMITTED_BYTES,title:"Network Tx Bytes",description:"Write data transferred per second in KB/second."},{id:o.STATS_HYP_AVG_IO_LATENCY,title:"Hypervisor I/O Latency",description:"I/O latency in milliseconds from Hypervisor."},{id:o.STATS_HYP_AVG_READ_IO_LATENCY,title:"Hypervisor I/O Latency - Read",description:"I/O read latency in milliseconds from Hypervisor."},{id:o.STATS_HYP_AVG_WRITE_IO_LATENCY,title:"Hypervisor I/O Latency - Write",description:"I/O write latency in milliseconds from Hypervisor."},{id:o.STATS_NETWORK_RECEIVED_RATE,title:"Virtual NIC bytes received rate.",description:"Virtual NIC bytes received rate in kbps"},{id:o.STATS_NETWORK_TRANSMITTED_RATE,title:"Virtual NIC bytes transimitted rate.",description:"Virtual NIC bytes transimitted rate in kbps"},{id:o.STATS_NETWORK_DROPPED_RECEIVED_PACKETS,title:"Virtual NIC receive packets dropped.",description:"Number of receive packets dropped by the VNIC."},{id:o.STATS_NETWORK_DROPPED_TRANSMITTED_PACKETS,title:"Virtual NIC dropped transmitted packets.",description:"Number of dropped transmitted packets by the VNIC."},{id:o.STATS_NETWORK_ERROR_RECEIVED_PACKETS,title:"Virtual NIC bytes received packets with error.",description:"Virtual NIC bytes received packets with error."},{id:o.STATS_AVG_IO_LATENCY,title:"Disk I/O Latency",description:"I/O latency in milliseconds from disk."},{id:o.STATS_HYP_CPU_USAGE,title:"Hypervisor CPU Usage (%)",description:"Percent of CPU used by the hypervisor."},{id:o.STATS_HYP_MEMORY_USAGE,title:"Hypervisor Memory Usage (%)",description:"Percent of memory used by the hypervisor."},{id:o.STATS_MEMORY_USAGE,title:"Memory Usage (%)",description:"Percent of memory used by the VM."},{id:o.STATS_HYP_CPU_READY_TIME,title:"Hypervisor CPU Ready Time (%)",description:"CPU ready time percentage."},{id:o.STATS_CTRLR_READ_SRC_SSD_BYTES_PER_SEC,title:"Bytes Read per Second (SSD)",description:"Bytes read per second from SSD tier."},r.isClusterFFEnabled(i.FFLAGS.ARITHMOS_USAGE_STATS)?{id:o.NEW_TOT_USED_PHY,title:"Physical Usage",description:"Physical storage usage."}:{id:o.STATS_TRANSFORMED_USAGE,title:"Transformed Usage",description:"Actual usage of storage."},r.isClusterFFEnabled(i.FFLAGS.ARITHMOS_USAGE_STATS)?{id:o.NEW_TOT_USED_LOG,title:"Logical Usage",description:"Logical storage usage."}:{id:o.STATS_UNTRANSFORMED_USAGE,title:"Untransformed Usage",description:"Logical usage of storage (before compression/deduplication)."},{id:o.NEW_CONTAINER_OWN_USAGE_LOGICAL,title:"Storage container own usage",description:"Storage container's own usage + Reserved (not used)."},{id:o.STATS_REP_NUM_TRANSMITTED_BYTES,title:"Replication Bytes - Transmitted",description:"Number of bytes transmitted."},{id:o.STATS_REP_TOT_TRANSMITTED_BYTES,title:"Replication Bytes - Total Transmitted",description:"Total number of bytes transmitted."},{id:o.STATS_REP_NUM_RECEIVED_BYTES,title:"Replication Bytes - Received",description:"Number of bytes received."},{id:o.STATS_REP_TOT_RECEIVED_BYTES,title:"Replication Bytes - Total Received",description:"Total number of bytes received."},{id:o.STATS_REP_BW_TRANSFERRED,title:"Replication Bandwidth - Transmitted ",description:"Replication data transferred per second in  KB/second"},{id:o.STATS_REP_BW_RECEIVED,title:"Replication Bandwidth - Received",description:"Replication data received per second in  KB/second"},{id:o.STATS_CONTROLLER_NUM_IOPS,title:"Storage Controller IOPS",description:"Input/Output operations per second from the Storage Controller"},{id:o.STATS_CONTROLLER_NUM_READ_IOPS,title:"Storage Controller IOPS - Read",description:"Input/Output read operations per second from the Storage Controller"},{id:o.STATS_CONTROLLER_NUM_WRITE_IOPS,title:"Storage Controller IOPS - Write",description:"Input/Output write operations per second from the Storage Controller"},{id:o.STATS_CONTROLLER_BANDWIDTH,title:"Storage Controller Bandwidth",description:"Data transferred in KB/second from the Storage Controller."},{id:o.STATS_CONTROLLER_READ_BANDWIDTH,title:"Storage Controller Bandwidth - Read",description:"Read data transferred in KB/second from the Storage Controller."},{id:o.STATS_CONTROLLER_WRITE_BANDWIDTH,title:"Storage Controller Bandwidth - Write",description:"Write data transferred in KB/second from the Storage Controller."},{id:o.STATS_CONTROLLER_READ_IO_PPM,title:"Storage Controller IOPS - Read (%)",description:"Percent of Storage Controller IOPS that are reads."},{id:o.STATS_CONTROLLER_WRITE_IO_PPM,title:"Storage Controller IOPS - Write (%)",description:"Percent of Storage Controller IOPS that are writes."},{id:o.STATS_CONTROLLER_AVG_IO_LATENCY,title:"Storage Controller Latency",description:"I/O latency in milliseconds from the Storage Controller."},{id:o.STATS_CONTROLLER_AVG_READ_IO_LATENCY,title:"Storage Controller Latency - Read",description:"Storage Controller read latency in milliseconds."},{id:o.STATS_CONTROLLER_AVG_WRITE_IO_LATENCY,title:"Storage Controller Latency - Write",description:"Storage Controller write latency in milliseconds."},{id:o.STATS_HYP_SWAP_IN_RATE,title:"Swap In Rate",description:"Rate of data being swapped in."},{id:o.STATS_HYP_SWAP_OUT_RATE,title:"Swap Out Rate",description:"Rate of data being swapped out."},{id:o.CONTENT_CACHE_NUM_HITS,title:"Content Cache Hits",description:"Number of hits on the content cache."},{id:o.CONTENT_CACHE_NUM_LOOKUPS,title:"Content Cache Lookups",description:"Number of lookups on the content cache."},{id:o.CONTENT_CACHE_HIT_PPM,title:"Content Cache Hit Rate (%)",description:"Content cache hits over all lookups."},{id:o.CONTENT_CACHE_NUM_DEDUP_REF_COUNT_PPH,title:"Content Cache Reference Count",description:"Average number of content cache references."},{id:o.CONTENT_CACHE_PHYSICAL_MEMORY_USAGE_BYTES,title:"Content Cache Physical Memory Usage",description:"Real memory (in bytes) used to cache data by the content cache."},{id:o.CONTENT_CACHE_PHYSICAL_SSD_USAGE_BYTES,title:"Content Cache SSD Usage",description:"Real SSD usage (in bytes) used to cache data by the content cache."},{id:o.CONTENT_CACHE_LOGICAL_MEMORY_USAGE_BYTES,title:"Content Cache Logical Memory Usage",description:"Logical memory (in bytes) used to cache data without deduplication."},{id:o.CONTENT_CACHE_LOGICAL_SSD_USAGE_BYTES,title:"Content Cache Logical SSD Usage",description:"Logical SSD memory (in bytes) used to cache data without deduplication."},{id:o.CONTENT_CACHE_SAVED_MEMORY_USAGE_BYTES,title:"Content Cache Memory Saved",description:"Memory (in bytes) saved due to content cache deduplication."},{id:o.CONTENT_CACHE_SAVED_SSD_USAGE_BYTES,title:"Content Cache SSD Usage Saved",description:"SSD usage (in bytes) saved due to content cache deduplication."},{id:o.DEDUP_FINGERPRINT_CLEARED_BYTES,title:"Deduplication Fingerprints Cleared",description:"Number of written bytes for which fingerprints have been cleared."},{id:o.DEDUP_FINGERPRINT_ADDED_BYTES,title:"Deduplication Fingerprints Written",description:"Number of written bytes for which fingerprints have been added."},{id:o.STATS_GPU_USAGE,title:"GPU Usage",description:"Usage of the GPU"},{id:o.STATS_FRAMEBUFFER_USAGE,title:"GPU Framebuffer Usage",description:"Usage of the GPU's framebuffer"},{id:o.STATS_DECODER_USAGE,title:"GPU video decoder Usage",description:"GPU video decoder usage"},{id:o.STATS_ENCODER_USAGE,title:"GPU video encoder usage",description:"GPU video encoder usage"}],CONDITIONAL_METRICS:{MIXED_HYPERVISORS:[{id:o.STATS_HYP_CPU_USAGE_ESX,title:"Hypervisor ESX CPU Usage (%)",description:"Percent of CPU used by ESX host(s)."},{id:o.STATS_HYP_MEMORY_USAGE_ESX,title:"Hypervisor ESX Memory Usage (%)",description:"Percent of memory used by ESX host(s)."},{id:o.STATS_HYP_CPU_USAGE_KVM,title:"Hypervisor AHV CPU Usage (%)",description:"Percent of CPU used by KVM host(s)."},{id:o.STATS_HYP_MEMORY_USAGE_KVM,title:"Hypervisor AHV Memory Usage (%)",description:"Percent of memory used by KVM host(s)."},{id:o.STATS_HYP_CPU_USAGE_HYPERV,title:"Hypervisor Hyper-V CPU Usage (%)",description:"Percent of CPU used by Hyper-V host(s)."},{id:o.STATS_HYP_MEMORY_USAGE_HYPERV,title:"Hypervisor Hyper-V Memory Usage (%)",description:"Percent of memory used by Hyper-V host(s)."}]},ENTITY_TYPES:[{id:i.ENTITY_HOST,title:"Host",description:""},{id:i.ENTITY_DISK,title:"Disk",description:""},{id:i.ENTITY_STORAGE_POOL,title:"Storage Pool",description:""},{id:i.ENTITY_CONTAINER,title:"Storage Container",description:""},{id:i.ENTITY_VM,title:"Virtual Machine",description:""},{id:i.ENTITY_ACROPOLIS_VOLUME_GROUP,title:"Volume Group",description:""},{id:i.ENTITY_REMOTE_SITE,title:"Remote Site",description:""},{id:i.ENTITY_PROTECTION_DOMAIN,title:"Protection Domain",description:""},{id:i.ENTITY_REPLICATION_LINK,title:"Replication Link",description:""},{id:i.ENTITY_VIRTUAL_DISK,title:"Virtual Disk",description:""},{id:i.ENTITY_CLUSTER,title:"Cluster",description:""}],ENTITY_TYPE_TO_METRIC_MAP:{},PERSISTED_ATTRS:["type","primaryObj","secondaryObjs","title","enabled","size","userChartColors"],MAX_CHART_COLORS:16,defaults:{chartId:null,type:null,primaryObj:null,secondaryObjs:null,title:null,enabled:!1,size:null,transient:!1,overrides:null,parentModel:null,chartColors:null,userChartColors:null},initialize:function(){e.prototype.initialize.apply(this,arguments),this._populateMetricsMap(),this._populateEntityMetricMap(),this.set({size:this.CHART_SIZE_SMALL,overrides:{},chartColors:{},userChartColors:{},secondaryObjs:[]})},destroy:function(){var e=this.getParentModel();e&&(e.off("stats:loaded",this._loadStatsSuccessCallback,this),e.off("stats:error",this._loadStatsErrorCallback,this))},getChartId:function(){return this.get("chartId")},setChartId:function(e){this.set({chartId:e})},isMaximized:function(){return this.getParentModel().isMaximized(this.getChartId())},getChartSize:function(){return this.get("size")},setChartSize:function(e){this.set({size:e})},setTransient:function(e){this.set({transient:e})},isTransient:function(){return this.get("transient")},isEntityChart:function(){return this.get("type")===this.CHART_TYPE_ENTITY},getMetricById:function(e){return _.find(this.METRICS,function(t){return t.id===e})},getEntityTypeById:function(e){return _.find(this.ENTITY_TYPES,function(t){return t.id===e})},getChartMetrics:function(){return this.isEntityChart()?this.getSecondaryObjects():[this.getPrimaryObject()]},isStatDeprecated:function(e){return _.indexOf(r.getCurrentClusterDeprecatedStats(),e)>-1},_populateMetricsMap:function(){var e=this.getMixedHypervisorMetrics()||[];_.each(e,function(e){var t=_.find(this.CONDITIONAL_METRICS.MIXED_HYPERVISORS,function(t){return t.id===e});_.find(this.METRICS,function(e){
return e.id===t.id})||(_.extend({title:this.i18n(t.id,t.title)},t),this.METRICS.push(t))},this)},_populateEntityMetricMap:function(){var e=r.isClusterFFEnabled(i.FFLAGS.ARITHMOS_USAGE_STATS),t=r.getCurrentClusterId();this.ENTITY_TYPE_TO_METRIC_MAP[i.ENTITY_HOST]=[o.STATS_HYP_NUM_IOPS,o.STATS_HYP_NUM_READ_IOPS,o.STATS_HYP_NUM_WRITE_IOPS,o.STATS_NUM_IOPS,o.STATS_NUM_READ_IOPS,o.STATS_NUM_WRITE_IOPS,o.STATS_READ_IO_PPM,o.STATS_WRITE_IO_PPM,o.STATS_HYP_BANDWIDTH,o.STATS_HYP_READ_BANDWIDTH,o.STATS_HYP_WRITE_BANDWIDTH,o.STATS_BANDWIDTH,o.STATS_READ_BANDWIDTH,o.STATS_WRITE_BANDWIDTH,o.STATS_HYP_AVG_IO_LATENCY,o.STATS_HYP_AVG_READ_IO_LATENCY,o.STATS_HYP_AVG_WRITE_IO_LATENCY,o.STATS_AVG_IO_LATENCY,o.STATS_HYP_CPU_USAGE,o.STATS_HYP_MEMORY_USAGE,o.STATS_CONTROLLER_NUM_IOPS,o.STATS_CONTROLLER_NUM_READ_IOPS,o.STATS_CONTROLLER_NUM_WRITE_IOPS,o.CONTENT_CACHE_NUM_HITS,o.CONTENT_CACHE_NUM_LOOKUPS,o.CONTENT_CACHE_HIT_PPM,o.CONTENT_CACHE_NUM_DEDUP_REF_COUNT_PPH,o.CONTENT_CACHE_PHYSICAL_MEMORY_USAGE_BYTES,o.CONTENT_CACHE_PHYSICAL_SSD_USAGE_BYTES,o.CONTENT_CACHE_LOGICAL_MEMORY_USAGE_BYTES,o.CONTENT_CACHE_LOGICAL_SSD_USAGE_BYTES,o.CONTENT_CACHE_SAVED_MEMORY_USAGE_BYTES,o.CONTENT_CACHE_SAVED_SSD_USAGE_BYTES,o.DEDUP_FINGERPRINT_CLEARED_BYTES,o.DEDUP_FINGERPRINT_ADDED_BYTES].concat(e?[o.NEW_TOT_USED_PHY]:[o.STATS_TRANSFORMED_USAGE,o.STATS_UNTRANSFORMED_USAGE]),this.ENTITY_TYPE_TO_METRIC_MAP[i.ENTITY_DISK]=[o.STATS_NUM_IOPS,o.STATS_NUM_READ_IOPS,o.STATS_NUM_WRITE_IOPS,o.STATS_BANDWIDTH,o.STATS_READ_BANDWIDTH,o.STATS_WRITE_BANDWIDTH,o.STATS_READ_IO_PPM,o.STATS_WRITE_IO_PPM,o.STATS_AVG_IO_LATENCY].concat(e?[o.NEW_TOT_USED_PHY]:[o.STATS_TRANSFORMED_USAGE,o.STATS_UNTRANSFORMED_USAGE]),this.ENTITY_TYPE_TO_METRIC_MAP[i.ENTITY_STORAGE_POOL]=[],r.isMulticlusterNavMode()||(this.ENTITY_TYPE_TO_METRIC_MAP[i.ENTITY_STORAGE_POOL]=this.ENTITY_TYPE_TO_METRIC_MAP[i.ENTITY_DISK]),this.ENTITY_TYPE_TO_METRIC_MAP[i.ENTITY_CONTAINER]=[o.STATS_CONTROLLER_NUM_IOPS,o.STATS_CONTROLLER_NUM_READ_IOPS,o.STATS_CONTROLLER_NUM_WRITE_IOPS,o.STATS_CONTROLLER_BANDWIDTH,o.STATS_CONTROLLER_READ_BANDWIDTH,o.STATS_CONTROLLER_WRITE_BANDWIDTH,o.STATS_CONTROLLER_READ_IO_PPM,o.STATS_CONTROLLER_WRITE_IO_PPM,o.STATS_CONTROLLER_AVG_IO_LATENCY,o.STATS_CONTROLLER_AVG_READ_IO_LATENCY,o.STATS_CONTROLLER_AVG_WRITE_IO_LATENCY].concat(e?[o.NEW_TOT_USED_PHY,o.NEW_TOT_USED_LOG,o.NEW_CONTAINER_OWN_USAGE_LOGICAL]:[o.STATS_TRANSFORMED_USAGE,o.STATS_UNTRANSFORMED_USAGE]),this.ENTITY_TYPE_TO_METRIC_MAP[i.ENTITY_VM]=[o.STATS_HYP_NUM_IOPS,o.STATS_HYP_NUM_READ_IOPS,o.STATS_HYP_NUM_WRITE_IOPS,o.STATS_HYP_BANDWIDTH,o.STATS_HYP_READ_BANDWIDTH,o.STATS_HYP_WRITE_BANDWIDTH,o.STATS_HYP_AVG_IO_LATENCY,o.STATS_HYP_MEMORY_USAGE,o.STATS_CONTROLLER_AVG_READ_IO_LATENCY,o.STATS_CONTROLLER_AVG_WRITE_IO_LATENCY,o.STATS_MEMORY_USAGE,o.STATS_NETWORK_RECEIVED_RATE,o.STATS_NETWORK_TRANSMITTED_RATE,o.STATS_NETWORK_DROPPED_RECEIVED_PACKETS,o.STATS_NETWORK_DROPPED_TRANSMITTED_PACKETS,o.STATS_NETWORK_ERROR_RECEIVED_PACKETS,o.STATS_CTRLR_READ_SRC_SSD_BYTES_PER_SEC],r.isMulticlusterNavMode()?this.ENTITY_TYPE_TO_METRIC_MAP[i.ENTITY_VM]=this.getCommonEntityMetrics(i.ENTITY_VM):(a.hasESX(t)&&(this.ENTITY_TYPE_TO_METRIC_MAP[i.ENTITY_VM]=this.ENTITY_TYPE_TO_METRIC_MAP[i.ENTITY_VM].concat([o.STATS_HYP_SWAP_IN_RATE,o.STATS_HYP_SWAP_OUT_RATE,o.STATS_HYP_CPU_READY_TIME])),(a.hasKVM(t)||a.hasHyperV(t))&&(a.hasHyperVOnly(t)&&(this.ENTITY_TYPE_TO_METRIC_MAP[i.ENTITY_VM]=[]),a.hasKVMOnly(t)&&(this.ENTITY_TYPE_TO_METRIC_MAP[i.ENTITY_VM]=[o.STATS_HYP_MEMORY_USAGE]),this.ENTITY_TYPE_TO_METRIC_MAP[i.ENTITY_VM]=this.ENTITY_TYPE_TO_METRIC_MAP[i.ENTITY_VM].concat(this.getCommonEntityMetrics(i.ENTITY_VM)))),this.ENTITY_TYPE_TO_METRIC_MAP[i.ENTITY_REMOTE_SITE]=[o.STATS_REP_BW_TRANSFERRED,o.STATS_REP_BW_RECEIVED,o.STATS_REP_NUM_TRANSMITTED_BYTES,o.STATS_REP_NUM_RECEIVED_BYTES],this.ENTITY_TYPE_TO_METRIC_MAP[i.ENTITY_PROTECTION_DOMAIN]=[o.STATS_REP_BW_TRANSFERRED,o.STATS_REP_BW_RECEIVED,o.STATS_REP_NUM_TRANSMITTED_BYTES,o.STATS_REP_NUM_RECEIVED_BYTES],this.ENTITY_TYPE_TO_METRIC_MAP[i.ENTITY_ACROPOLIS_VOLUME_GROUP]=[o.STATS_CONTROLLER_NUM_IOPS,o.STATS_CONTROLLER_NUM_READ_IOPS,o.STATS_CONTROLLER_NUM_WRITE_IOPS,o.STATS_CONTROLLER_BANDWIDTH,o.STATS_CONTROLLER_READ_BANDWIDTH,o.STATS_CONTROLLER_WRITE_BANDWIDTH,o.STATS_CONTROLLER_AVG_IO_LATENCY,o.STATS_CONTROLLER_AVG_READ_IO_LATENCY,o.STATS_CONTROLLER_AVG_WRITE_IO_LATENCY],this.ENTITY_TYPE_TO_METRIC_MAP[i.ENTITY_REPLICATION_LINK]=[o.STATS_REP_BW_TRANSFERRED,o.STATS_REP_BW_RECEIVED,o.STATS_REP_NUM_TRANSMITTED_BYTES,o.STATS_REP_NUM_RECEIVED_BYTES,o.STATS_REP_TOT_TRANSMITTED_BYTES,o.STATS_REP_TOT_RECEIVED_BYTES],this.ENTITY_TYPE_TO_METRIC_MAP[i.ENTITY_VIRTUAL_DISK]=[o.STATS_CONTROLLER_NUM_IOPS,o.STATS_CONTROLLER_NUM_READ_IOPS,o.STATS_CONTROLLER_NUM_WRITE_IOPS,o.STATS_CONTROLLER_BANDWIDTH,o.STATS_CONTROLLER_READ_BANDWIDTH,o.STATS_CONTROLLER_WRITE_BANDWIDTH,o.STATS_CONTROLLER_READ_IO_PPM,o.STATS_CONTROLLER_WRITE_IO_PPM,o.STATS_CONTROLLER_AVG_IO_LATENCY,o.STATS_CONTROLLER_AVG_READ_IO_LATENCY,o.STATS_CONTROLLER_AVG_WRITE_IO_LATENCY],this.ENTITY_TYPE_TO_METRIC_MAP[i.ENTITY_CLUSTER]=this.getCommonEntityMetrics(i.ENTITY_CLUSTER),r.isMulticlusterNavMode()||a.hasESX(t)&&(this.ENTITY_TYPE_TO_METRIC_MAP[i.ENTITY_CLUSTER]=this.ENTITY_TYPE_TO_METRIC_MAP[i.ENTITY_CLUSTER].concat([o.STATS_HYP_NUM_IOPS,o.STATS_HYP_NUM_READ_IOPS,o.STATS_HYP_NUM_WRITE_IOPS,o.STATS_HYP_BANDWIDTH,o.STATS_HYP_READ_BANDWIDTH,o.STATS_HYP_WRITE_BANDWIDTH,o.STATS_HYP_AVG_IO_LATENCY])),this.ENTITY_TYPE_TO_METRIC_MAP[i.ENTITY_CLUSTER]=this.ENTITY_TYPE_TO_METRIC_MAP[i.ENTITY_CLUSTER].concat([o.NEW_TOT_USED_PHY]),this.ENTITY_TYPE_TO_METRIC_MAP[i.ENTITY_CLUSTER]=this.ENTITY_TYPE_TO_METRIC_MAP[i.ENTITY_CLUSTER].concat(this.getMixedHypervisorMetrics())},getCommonEntityMetrics:function(e){switch(e){case i.ENTITY_VM:return[o.STATS_CONTROLLER_NUM_IOPS,o.STATS_CONTROLLER_NUM_READ_IOPS,o.STATS_CONTROLLER_NUM_WRITE_IOPS,o.STATS_CONTROLLER_BANDWIDTH,o.STATS_CONTROLLER_READ_BANDWIDTH,o.STATS_CONTROLLER_WRITE_BANDWIDTH,o.STATS_CONTROLLER_READ_IO_PPM,o.STATS_CONTROLLER_WRITE_IO_PPM,o.STATS_CONTROLLER_AVG_IO_LATENCY,o.STATS_CONTROLLER_AVG_READ_IO_LATENCY,o.STATS_CONTROLLER_AVG_WRITE_IO_LATENCY,o.STATS_MEMORY_USAGE,o.STATS_HYP_CPU_USAGE,o.STATS_HYP_CPU_READY_TIME,o.STATS_HYP_NUM_RECEIVED_BYTES,o.STATS_HYP_NUM_TRANSMITTED_BYTES,o.STATS_GPU_USAGE,o.STATS_FRAMEBUFFER_USAGE,o.STATS_ENCODER_USAGE,o.STATS_DECODER_USAGE];case i.ENTITY_CLUSTER:return[o.STATS_NUM_IOPS,o.STATS_NUM_READ_IOPS,o.STATS_NUM_WRITE_IOPS,o.STATS_READ_IO_PPM,o.STATS_WRITE_IO_PPM,o.STATS_BANDWIDTH,o.STATS_READ_BANDWIDTH,o.STATS_WRITE_BANDWIDTH,o.STATS_AVG_IO_LATENCY,o.STATS_REP_BW_TRANSFERRED,o.STATS_REP_BW_RECEIVED,o.STATS_CONTROLLER_NUM_IOPS,o.STATS_CONTROLLER_NUM_READ_IOPS,o.STATS_CONTROLLER_NUM_WRITE_IOPS,o.STATS_CONTROLLER_AVG_IO_LATENCY,o.STATS_CONTROLLER_AVG_READ_IO_LATENCY,o.STATS_CONTROLLER_AVG_WRITE_IO_LATENCY,o.STATS_CONTROLLER_BANDWIDTH,o.STATS_CONTROLLER_READ_BANDWIDTH,o.STATS_CONTROLLER_WRITE_BANDWIDTH,o.CONTENT_CACHE_NUM_HITS,o.CONTENT_CACHE_NUM_LOOKUPS,o.CONTENT_CACHE_HIT_PPM,o.CONTENT_CACHE_NUM_DEDUP_REF_COUNT_PPH,o.CONTENT_CACHE_PHYSICAL_MEMORY_USAGE_BYTES,o.CONTENT_CACHE_PHYSICAL_SSD_USAGE_BYTES,o.CONTENT_CACHE_LOGICAL_MEMORY_USAGE_BYTES,o.CONTENT_CACHE_LOGICAL_SSD_USAGE_BYTES,o.CONTENT_CACHE_SAVED_MEMORY_USAGE_BYTES,o.CONTENT_CACHE_SAVED_SSD_USAGE_BYTES,o.DEDUP_FINGERPRINT_CLEARED_BYTES,o.DEDUP_FINGERPRINT_ADDED_BYTES,o.STATS_HYP_CPU_USAGE,o.STATS_HYP_MEMORY_USAGE]}},getAllMetrics:function(){return this.METRICS},getCurrentEnvironmentMetrics:function(){var e=this;return this.CURRENT_ENVIRONMENT_METRICS||(this.CURRENT_ENVIRONMENT_METRICS=_.filter(this.METRICS,function(t){return e.getEntityTypesForMetric(t.id).length})),this.CURRENT_ENVIRONMENT_METRICS},getMixedHypervisorMetrics:function(){var e=[],t=r.isMulticlusterNavMode();if(t||a.getClusterHypervisors().length>1){var i=s.splitMetricByHypervisorTypes([o.STATS_HYP_CPU_USAGE,o.STATS_HYP_MEMORY_USAGE],null,t);e=e.concat(_.values(i)),e=_.flatten(e)}return e},getMetricsForEntityType:function(e){return this.ENTITY_TYPE_TO_METRIC_MAP[e]},getEntityTypesForMetric:function(e){var t=[];return _.each(this.ENTITY_TYPE_TO_METRIC_MAP,function(i,n){i.indexOf(e)>=0&&t.push(n)}),t},getMetricsForClusterUuid:function(e){var t=this.getMetricsForEntityType(i.ENTITY_CLUSTER),n=s.splitMetricByHypervisorTypes([o.STATS_HYP_CPU_USAGE,o.STATS_HYP_MEMORY_USAGE],null,!0);return a.hasKVMOnly(e)||(t=_.difference(t,n[i.HYPERVISOR_TYPE.KVM])),a.hasHyperV(e)||(t=_.difference(t,n[i.HYPERVISOR_TYPE.HYPERV])),a.hasESX(e)||(t=_.difference(t,n[i.HYPERVISOR_TYPE.ESXI])),t},getPrimaryObject:function(){return this.get("primaryObj")},setPrimaryObject:function(e){return this.set({primaryObj:e})},getSecondaryObjects:function(){return this.get("secondaryObjs")},getSecondaryObjectById:function(e){return _.find(this.get("secondaryObjs"),function(t){return t.id===e})},addSecondaryObject:function(e){this.getSecondaryObjectById(e.id)||(this.get("secondaryObjs").push(e),this.assignChartColors())},removeSecondaryObject:function(e){var t=this.getSecondaryObjectById(e);if(t){var i=this.get("secondaryObjs");this.set({secondaryObjs:_.without(i,t)}),this.assignChartColors()}},removeAllSecondaryObjects:function(){this.set("secondaryObjs",[])},isSecondaryObjectHidden:function(e){return this.get("overrides")[e]},hideSecondaryObject:function(e,t){this.get("overrides")[e]=t},hasHiddenSecondaryObjects:function(){return!_.isEmpty(this.get("overrides"))},clearHiddenSecondaryObjects:function(){this.set("overrides",{})},getParentModel:function(){return this.get("parentModel")},setParentModel:function(e){this.set({parentModel:e}),e.on("stats:loaded",this._loadStatsSuccessCallback,this),e.on("stats:error",this._loadStatsErrorCallback,this)},getTitle:function(){return this.get("title")&&this.get("title").length>0?this.get("title"):this.i18n("untitled_chart")},getDefaultTitle:function(){var e="";return this.isEntityChart()?(e=this.getPrimaryObject().type,e=e!==i.ENTITY_CLUSTER||r.isMulticlusterNavMode()?n.sprintf(this.i18n("CommonGrammarConstructions.define_property","%s: %s"),this.i18n("Terms.entity","Entity"),this.getPrimaryObject().title):this.i18n("cluster_wide")):e=n.sprintf(this.i18n("CommonGrammarConstructions.define_property","%s: %s"),this.i18n("Terms.metric","Metric"),this.getPrimaryObject().title),e},getStats:function(e){var t=this.isEntityChart()?this.getPrimaryObject().id:e,i=this.isEntityChart()?e:this.getPrimaryObject().id;return this.getParentModel().getStats(t,i)},getStatsState:function(e){var t=this.isEntityChart()?this.getPrimaryObject().id:e,i=this.isEntityChart()?e:this.getPrimaryObject().id;return this.getParentModel().getStatsState(t,i)},loadStats:function(e){var t,i,n,s,a;this.isEntityChart()?(t=this.getPrimaryObject().id,n=this.getPrimaryObject().type,s=this.getPrimaryObject().parentId,a=this.getPrimaryObject().parentType,i=e):(t=e,n=_.find(this.getSecondaryObjects(),function(t){return t.id===e}).type,i=this.getPrimaryObject().id);var r=this.cid;this.getParentModel().loadStats(t,n,i,r,s,a)},assignChartColors:function(){var e={},i=[],n=[];_.each(this.getSecondaryObjects(),function(s){var a=t.getAnalysisChartColors(this.isEntityChart()?s.id:s.type.toLowerCase()),r=a[0];i.indexOf(r)>=0?n.push(s.id.toLocaleLowerCase()):(e[s.id.toLocaleLowerCase()]=r,i.push(r))},this),n.length>0&&_.each(n,function(n){var s;i.length<this.MAX_CHART_COLORS?(s=t.getUniqueChartColor(i),i.push(s)):s=t.CHART_LIMIT_EXCEEDED_COLOR,e[n]=s},this),this.set({chartColors:e})},getChartColor:function(e){var t=this.get("userChartColors")[e.toLocaleLowerCase()]||this.get("chartColors")[e.toLocaleLowerCase()];return t&&t.replace(/#/g,"")},setUserChartColor:function(e,t){this.get("userChartColors")[e.toLowerCase()]=t},toPersistedObject:function(){var e={};return _.each(this.PERSISTED_ATTRS,function(t){e[t]=this.get(t)},this),e},toURL:function(){var e=this.toPersistedObject();return this.CHART_LINK_PREFIX+encodeURIComponent(JSON.stringify(e))},fromURL:function(e){try{var t=e.indexOf(this.CHART_LINK_PREFIX),i=e.substr(t+this.CHART_LINK_PREFIX.length),s=JSON.parse(decodeURIComponent(i));return this.set(s),this.assignChartColors(),!0}catch(e){return n.log("AnalysisChartModel : fromURL. Error: Unable to parse chart link"),!1}},hasDisparateMetrics:function(){if(this.isEntityChart()){var e=[];return _.each(this.get("secondaryObjs"),function(t){this.isSecondaryObjectHidden(t.id)||e.push(s.getMetricUnits(t.id))},this),_.uniq(e).length>1}return!1},getMultiClusterEntityTypes:function(){return _.filter(this.ENTITY_TYPES,function(e){if(-1===_.indexOf(l,e[o.ID]))return!0})},_loadStatsSuccessCallback:function(e){n.debug("AnalysiChartModel _loadStatsSuccessCallback:",e),this._triggerEvent("stats:loaded",e)},_loadStatsErrorCallback:function(e){n.debug("AnalysiChartModel _loadStatsErrorCallback:",e),this._triggerEvent("stats:error",e)},_triggerEvent:function(e,t){var i,n;(i=t[2]===this.cid)&&(n=this.isEntityChart()?t[1]:t[0],this.trigger(e,n))}})}),define("views/utils/ColorPickerView",["jquery","views/basecomponents/BaseView","utils/StyleDescriptor","utils/AppUtil"],function(e,t,i,n){"use strict";return t.extend({colorTemplate:_.template("<span class='color-box' data='<%= colorHex %>'style='background:#<%= colorHex %>;'>&nbsp;</span>"),events:{"click .color-box":"onColorSelect"},initialize:function(){n.debug("ColorPickerView  | initialize | ",this.cid);var e="<div class='n-color-picker'>";_.each(i.APP_COLORS,function(t){e+="<div>";for(var i=0;i<t.length;i++){var n=this.colorTemplate({colorHex:t[i]});e+=n}e+="</div>"},this),e+="</div>",this.colorPickerHTML=e},render:function(e){this.$el.html(this.colorPickerHTML)},destroy:function(){n.debug("ColorPickerView  | destroy | ",this.cid),t.prototype.destroy.apply(this,arguments)},setContext:function(e){this._context=e},onColorSelect:function(t){t.stopPropagation();var i=e(t.currentTarget),n=e.extend(this._context||{},{color:i.attr("data")});this.trigger("select",n)}})}),define("text!templates/timeline/ChartsListView.html",[],function(){return'<% _.each(charts, function(chart, idx) { %>\n  <div id="<%= chart.getChartId() %>"\n    class="chart-box <%= chart.isTransient() ? \'chart-box-transient\' : \'\' %>">\n    <div class="select-row select-row-outer">\n      <input class="chart-checkbox" id="<%=chart.getChartId()%>" type="checkbox"\n        <%= (chart.get(\'enabled\') ? \'checked\' : \'\') %> >\n      <label for="<%=chart.getChartId()%>">\n        <%- chart.getTitle() %>\n      </label>\n      <span class="chartActionBtns">\n        <i data-id=\'<%= chart.getChartId() %>\' data-icon="F" aria-hidden="true"\n           class="btnEdit">\n        </i>\n        <span class="action-separator">&middot;</span>\n        <span class="glyphicon btnClone" data-id=\'<%= chart.getChartId() %>\'>\n           <%= Components.icon(\'Clone\', \'-inline -small\') %>\n        </span>\n        <span class="action-separator">&middot;</span>\n        <i data-id=\'<%= chart.getChartId() %>\' data-icon="v" aria-hidden="true"\n           class="btnDelete">\n        </i>\n      </span>\n    </div>\n    <% _.each(chart.getSecondaryObjects(), function(sObj, idx) {\n        var color = "#" + chart.getChartColor(sObj.id);\n    %>\n      <div class="select-row select-row-inner" id="<%= sObj.id %>">\n        <span class="metric-box"\n              style="background: <%= color %>;">\n          &nbsp;</span>\n        <label>\n          <% if (chart.isStatDeprecated(sObj.id)) { %>\n            <a class="n-icon-help"\n              data-original-title="Recreate the metric of this chart.">?</a>\n            <span class="n-deprecated">\n              Deprecated\n            </span>\n          <% } %>\n          <%= _.escape(sObj.title) %>\n        </label>\n      </div>\n    <% }) %>\n  </div>\n<% }) %>\n'}),define("views/timeline/ChartsListView",["views/basecomponents/BaseView","views/timeline/MetricChartPopupView","views/timeline/EntityChartPopupView","models/timeline/AnalysisChartModel","models/userdata/UserDataModel","utils/AppUtil","views/utils/ColorPickerView","data/DataProperties","managers/UserBehaviorManager","text!templates/timeline/ChartsListView.html"],function(e,t,i,n,s,a,r,o,l,c){"use strict";return e.extend({ALERTS_CHART_ID:"_alerts_chart_",name:"ChartsListView",events:{"click .chart-checkbox":"onChartSelect","click .newMetricChart":"createNewMetricChart","click .newEntityChart":"createNewEntityChart","click .btnDelete":"onDelete","click .btnEdit":"onEdit","click .btnClone":"onCloneChart","click .metric-box":"onMetricBoxClick"},template:_.template(c),onChartSelect:function(e){var t=e.currentTarget.id,i=$(e.currentTarget).is(":checked");l.recordUserActivities({action:i?"enable":"disable",actionTarget:$(e.currentTarget).next().text().trim()+" chart"}),t===this.ALERTS_CHART_ID?this.model.setShowAlertsAndEvents(i):this.model.enableChart(t,i)},createNewMetricChart:function(e){var t=new n;t.set({type:t.CHART_TYPE_METRIC}),this.showNewChartPopup(t)},createNewEntityChart:function(){var e=new n;e.set({type:e.CHART_TYPE_ENTITY}),this.showNewChartPopup(e)},onCloneChart:function(e){var t=$(e.currentTarget).attr("data-id"),i=this.model.getChartById(t);if(i){var s=i.toJSON(),a=this.i18ns("cloneChart",s.title);s.chartId=null,s.title=null;var r=new n;r.set(s),this.showNewChartPopup(r,a)}},showNewChartPopup:function(e,n){var s,r=this,o={el:a.createPopupContainer("popupNewChart"),model:e,onSuccess:function(e){r.model.addChart(e)}};n&&(o.popupTitle=n),s=e.isEntityChart()?new i(o):new t(o),s.show()},onChartChange:function(){this.render()},onDelete:function(e){var t=$(e.currentTarget).attr("data-id");this.removeChart(t)},removeChart:function(e){var t=this.model.getChartById(e);if(t){var i="Delete chart '"+_.escape(t.getTitle())+"' ?";t.isTransient()&&(i="Remove temporary chart '"+_.escape(t.getTitle())+"' ?");var n=this;$.nutanixConfirm({msg:i,yes:function(){n.model.removeChart(e)}})}},onEdit:function(e){var t=$(e.currentTarget).attr("data-id");this.editChart(t)},editChart:function(e){var t=this,i=this.model.getChartById(e);if(i)if(i.isTransient()){var r=new n;r.set(i.toJSON()),t._editModel(r)}else{var l=new s;l.set({type:o.USER_DATA_TYPE_CHARTS,key:e}),l.fetch({success:function(e,i){var s=new n;s.setChartId(e.get("key")),s.set(JSON.parse(e.get("value"))),t._editModel(s)},error:function(e,t){a.log("ChartsListView : editChart: "+a.processAjaxError(t.responseText))}})}},onMetricBoxClick:function(e){this.$(".metric-box").popover("hide");var t=$(e.currentTarget);this._destroyPopover(),this.colorPicker=new r,this.colorPicker.render(),this.colorPicker.on("select",this.onColorSelect,this);var i=t.closest(".chart-box").attr("id"),n=t.closest(".select-row").attr("id");this.colorPicker.setContext({chartId:i,objectId:n}),t.popover({content:this.colorPicker.el,trigger:"manual",html:"true",animation:!1,delay:0,title:"Select a color",container:$("body")}),t.popover("show"),e.stopPropagation(),$(document).on("click",this.onDocumentClick)},onDocumentClick:function(e){this._destroyPopover(),$(document).off("click",this.onDocumentClick)},onColorSelect:function(e){this._destroyPopover(),this.model.setUserChartColor(e.chartId,e.objectId,e.color)},_editModel:function(e){var n,s=this,r=function(t){t.isTransient()?(s.model.removeChart(t.getChartId()),t.setTransient(!1),s.model.addChart(t)):s.model.updateChart(e.getChartId(),t)},o={el:a.createPopupContainer("popupChartView"),model:e,popupTitle:e.isTransient()?"Save Temporary Chart":e.isEntityChart()?"Edit Entity Chart":"Edit Metric Chart",onSuccess:r};n=e.isEntityChart()?new i(o):new t(o),n.show(),n.applyNutanixInput()},_clearHovers:function(){_.each(this.$(".chart-box"),function(e){$(e).unbind("mouseenter mouseleave")})},_destroyPopover:function(){this.$(".metric-box").popover("destroy"),this.colorPicker&&(this.colorPicker.off("select",this.onColorSelect),this.colorPicker.destroy(),this.colorPicker=null)},initialize:function(e){a.debug("ChartsListView : initialize: "," | viewid     : ",this.cid),_.bindAll(this,"onDocumentClick")},render:function(){a.debug("ChartsListView : render: "," | viewid     : ",this.cid),this._clearHovers();var e=new n({chartId:this.ALERTS_CHART_ID,title:this.i18n("showAlerts"),enabled:this.model.showAlertsAndEvents()}),t=[e].concat(this.model.getAnalysisCharts().models);if(t.length>=0){var i=this.template(this.vtOptions({charts:t}));this.$el.html(i),_.each(this.$(".select-row label"),function(e){var t=$(e);e.clientWidth<e.scrollWidth&&t.attr("title",t.text().trim())}),_.each(this.$(".chart-box:not(#"+this.ALERTS_CHART_ID+")"),function(e){$(e).hover(function(){$(this).find(".chartActionBtns").show()},function(){$(this).find(".chartActionBtns").hide()})}),this.$(".n-icon-help").tooltip({placement:"top",trigger:"hover"})}},destroy:function(){a.debug("ChartsListView : destroy: "," | viewid     : ",this.cid),this._destroyPopover(),$(document).off("click",this.onDocumentClick),this._clearHovers(),this.$(".n-icon-help").tooltip("destroy"),e.prototype.destroy.apply(this,arguments)}})}),define("text!templates/popups/daterangepicker/DateRangePickerPopupView.html",[],function(){return'<div class="modal-header">\n  <button type="button" class="close" data-dismiss="modal">\n    <i data-icon="K" aria-hidden="true"></i>\n  </button>\n  <h4 class="n-title">Select a Time Range</h4>\n</div>\n\n<div class="n-modal-wrapper">\n  <div class="n-modal-body">\n    <div class="n-modal-content-wrapper">\n      <div class="n-modal-alert-header">\n        \x3c!-- @view: alert goes here... --\x3e\n      </div>\n      <div class="n-modal-content">\n        <div class="control-group">\n          <label class="control-label">From</label>\n          <div class="range-start"></div>\n          <label class="control-label">To</label>\n          <div class="range-end"></div>\n        </div>\n      </div>\n    </div>\n  </div>\n\n  <div class="n-modal-footer">\n    <button class="btnCancel btn n-btn-form"> Cancel </button>\n    <button class="btnSave btn btn-primary n-btn-form"> OK </button>\n  </div>\n</div>'}),define("views/popups/datetime/DateRangePickerPopupView",["views/basecomponents/popups/BasePopupView","views/basecomponents/datetimepicker/DateTimePickerView","utils/TimeUtil","utils/SubViewHelper","text!templates/popups/daterangepicker/DateRangePickerPopupView.html"],function(e,t,i,n,s){"use strict";var a=_.template(s);return e.extend({name:"DateRangePickerPopupView",events:{"click .modal-header .close":"hide","click .btnCancel":"hide","click .btnSave":"onSave"},initialize:function(t){e.prototype.initialize.apply(this,arguments),this.selectCB=t.selectCB,this.defaultStart=t.startMillis,this.defaultEnd=t.endMillis,this.subViewHelper=new n},render:function(){this.$el.html(a(this.vtOptions({})));var e=this.subViewHelper.get("startDateTime");if(!e){var n={el:this.$(".range-start")};this.defaultStart&&(n.dateString=i.formatShortDate(this.defaultStart),n.timeString=i.formatShortTime(this.defaultStart)),e=new t(n),e.on("changeDateTime",function(e){this.restrictDateTime(e,!1)},this),this.subViewHelper.register("startDateTime",e)}var s=this.subViewHelper.get("endDateTime");if(!s){var r={el:this.$(".range-end")};this.defaultEnd&&(r.dateString=i.formatShortDate(this.defaultEnd),r.timeString=i.formatShortTime(this.defaultEnd)),s=new t(r),s.on("changeDateTime",function(e){this.restrictDateTime(e,!0)},this),this.subViewHelper.register("endDateTime",s)}e.render(),s.render()},show:function(){e.prototype.show.apply(this,arguments)},destroy:function(){this.subViewHelper.destroy(),this.subViewHelper=null,e.prototype.destroy.apply(this,arguments)},restrictDateTime:function(e,t){if(t){var i=this.subViewHelper.get("startDateTime");i.setMaxDateTime(e),i.setMinDateTime(null)}else{var n=this.subViewHelper.get("endDateTime");n.setMinDateTime(e),n.setMaxDateTime(null)}},onSave:function(){var e=this.subViewHelper.get("startDateTime"),t=this.subViewHelper.get("endDateTime"),i=e.getDateTimeValueInUsecs()/1e3,n=t.getDateTimeValueInUsecs()/1e3;this.selectCB(i,n),this.hide()}})}),define("text!templates/timeline/TimerangeSelectorView.html",[],function(){return'<div class="time-range-slider-wrapper">\n  <div class="time-range-bounds-scale">\n    \x3c!-- the scale is drawn here --\x3e\n  </div>\n\n  <div class="time-range-slider">\n    \x3c!-- Select the time range start and end --\x3e\n  </div>\n\n  <div class="time-range-zoom-level">\n    <div class="dropdown-text-label">Range:</div>\n    \x3c!-- Time Range Selector Dropdown --\x3e\n    <div class="n-control dropdown time-range-dropdown">\n      <a data-toggle="dropdown" href="#" class="dropdown-toggle">\n        <div class="dropdown-value">\n          <span id="selected-range">\n            <%= timeRangeOptions[currentBounds] || \'Custom\' %>\n          </span>\n          <i aria-hidden="true" data-icon="z" class="n-icon"></i>\n        </div>\n      </a>\n      <ul class="dropdown-menu dropdown-menu-right n-square">\n        <% _.each(timeRangeOptions, function(label, value) { %>\n        <li>\n          <a data-id="<%= value %>" class="time-range-btn"><%= label %></a>\n        </li>\n        <% }) %>\n      </ul>\n    </div>\n\n    \x3c!-- Undo Action. --\x3e\n    <div class="actions">\n    <span class="action-undo">\n      <span class="action-text"\n        title="You selected a portion of a chart to view. Click here to reset your selection.">\n        Reset selection</span>\n    </span>\n    </div>\n\n  </div>\n</div>\n'}),define("views/timeline/TimerangeSelectorView",["views/basecomponents/BaseView","datejs","views/popups/datetime/DateRangePickerPopupView","utils/AppUtil","utils/TimeUtil","data/DataProperties","jqueryui/slider","jqrangeslider","text!templates/timeline/TimerangeSelectorView.html"],function(e,t,i,n,s,a,r,o,l){"use strict";var c=_.template(l),d={"0.25d":"3 Hours","1d":"6 Hours","7d":"1 Day","30d":"1 Week","90d":"1 Month","-1d":"Custom"},u={"0.25d":"3 Hours","1d":"6 Hours","7d":"1 Day","30d":"1 Week","90d":"1 Month","180d":"3 Months","365d":"6 Months","-1d":"Custom"};return e.extend({BOUNDS_RANGE_STEPS:5,events:{"valuesChanged .time-range-slider":"onRangeValuesChanged","click .time-range-btn":"onZoomLevelChange","click .action-undo":"onHistoryBack"},dateRangeSlider:null,headerSlotTemplate:_.template("<div class='header-slot'><%= slotText %></div>"),onHistoryBack:function(){this.model.historyGoBack(!0)},onZoomLevelChange:function(e){var t=parseFloat($(e.currentTarget).attr("data-id"));if(-1===t){var s=this,a=this.model.getSelectedTimeRanges();return void new i({el:n.createPopupContainer("popupDateRangePicker"),startMillis:a.timeRangeMin,endMillis:a.timeRangeMax,selectCB:function(e,t){s.model.setCustomBoundsRange(e,t)}}).show()}this.model.setBoundsRange(t,!0)},onZoomChange:function(){var e=this.model.getZoom();this.dateRangeSlider.dateRangeSlider("values",new Date(e[0]),new Date(e[1]))},onResize:function(){this._renderHeaderHtml(),this.dateRangeSlider.dateRangeSlider("resize")},onRangeValuesChanged:function(e,t){var i=t.values.min.getTime(),n=t.values.max.getTime();this.model.setTimeRange(i,n)},onRangeValuesChanging:function(e,t){var i=t.values.min.getTime(),n=t.values.max.getTime();this.model.setTimeRange(i,n),this.$("#selected-range").text(d["-1d"])},onBoundsRangeChange:function(){n.debug("TimerangeSelectorView : onBoundsRangeChange: "," | viewid     : "+this.cid),this.dateRangeSlider&&(this.$(".time-range-slider").off("valuesChanging"),this.dateRangeSlider.dateRangeSlider("destroy"),this.dateRangeSlider=null),this.render()},onTimeRangeChange:function(){n.debug("TimerangeSelectorView : onTimeRangeChange: "," | viewid     : "+this.cid),this._renderHeaderHtml()},_renderHeaderHtml:function(){n.debug("TimerangeSelectorView : _renderHeaderHtml: "," | viewid     : "+this.cid);var e,t=this.model.get(a.BOUNDS_RANGE_MAX),i=this.model.get(a.BOUNDS_RANGE_MIN),r=this.model.getBoundsRangeInDays(),o=t-i,l=Math.round(o/this.BOUNDS_RANGE_STEPS);e=r<=1?s.FORMAT_TYPE.SHORT_TIME:s.FORMAT_TYPE.LONG_DAY_ONLY;for(var c,d,u=this.$(".time-range-bounds-scale").empty(),h=i,p=0;p<this.BOUNDS_RANGE_STEPS;p++)c=this._formattedDate(h,e),d=this.headerSlotTemplate({slotText:c}),u.append(d),h+=l;c=this._formattedDate(t,e),d=this.headerSlotTemplate({slotText:c}),u.append(d),this.model.historyCanGoBack()?this.$(".actions").show():this.$(".actions").hide()},_formattedDate:function(e,t){return s.formatLocaleDateTime(e,t)},initialize:function(t){e.prototype.initialize.apply(this,arguments),this.model=t.model},render:function(){n.debug("TimerangeSelectorView : render: "," | viewid     : "+this.cid);var e=this.model.getBoundsRangeInDays();this.$el.html(c({currentBounds:e+"d",timeRangeOptions:this.clusterManager.isMulticlusterNavMode()?u:d}));var t=this.model.get(a.BOUNDS_RANGE_MIN),i=this.model.get(a.BOUNDS_RANGE_MAX),r=this.model.get(a.TIME_RANGE_MIN),o=this.model.get(a.TIME_RANGE_MAX);if(!this.dateRangeSlider){var l,h=this.model.getBoundsRangeInDays(),p={};h<=2?(p.minutes=5,l={min:{minutes:5},max:{hours:24}}):h<=30?(p.minutes=15,l={min:{minutes:15},max:{days:h}}):(p.minutes=60,l={min:{minutes:60},max:{days:h}}),this.dateRangeSlider=this.$(".time-range-slider").dateRangeSlider({arrows:!1,valueLabels:"show",formatter:function(e){return s.formatLongDateTime(e)},defaultValues:{min:new Date(r),max:new Date(o)},step:p,range:l,bounds:{min:new Date(t),max:new Date(i)}}),_.bindAll(this,"onRangeValuesChanging"),this.$(".time-range-slider").on("valuesChanging",_.throttle(this.onRangeValuesChanging,250))}this._renderHeaderHtml()},destroy:function(){n.debug("TimerangeSelectorView : destroy: "," | viewid     : "+this.cid),this.dateRangeSlider&&(this.$(".time-range-slider").off("valuesChanging"),this.dateRangeSlider.dateRangeSlider("destroy"),this.dateRangeSlider=null),e.prototype.destroy.apply(this,arguments)}})}),define("views/timeline/TimeSelectorView",["views/basecomponents/BaseView","datejs","utils/AppUtil","utils/TimeUtil","data/DataProperties","jqueryui/slider"],function(e,t,i,n,s,a){"use strict";return e.extend({events:{"slide .selected-time-slider":"onSelectedTimeSlide","slidestop .selected-time-slider":"onSelectedTimeSlideStop","updateslider .selected-time-slider":"onUpdateSlider"},timeSelectSlider:null,onResize:function(){this.updateSelectedTimeUI()},onSelectedTimeSlideStop:function(e,t){this._setSelectedTime(t.value,!1)},onCurrentAlertChange:function(){},onCurrentEventChange:function(){},onSelectedTimeSlide:function(e,t){this._setSelectedTime(t.value,!0)},onUpdateSlider:function(e,t){this._setSelectedTime(t,!1)},_setSelectedTime:function(e,t){this.model.setSelectedTime(e,t)},onBoundsRangeChange:function(){i.debug("TimeSelector : onBoundsRangeChange: "," | viewid     : "+this.cid),this.timeSelectSlider&&(this.timeSelectSlider.slider("destroy"),this.timeSelectSlider=null),this.render()},onTimeRangeChange:function(){if(i.debug("TimeSelector : onTimeRangeChange: "," | viewid     : "+this.cid),this.timeSelectSlider){var e=this.model.get(s.TIME_RANGE_MIN),t=this.model.get(s.TIME_RANGE_MAX),n=this.model.get(s.SELECTED_TIME);i.debug("onTimeRangeChange Setting Slider Options: ","\n min: "+new Date(e)+"\n max: "+new Date(t)+"\n val: "+new Date(n)),this.timeSelectSlider.slider("option",{min:e,max:t,value:n}),this.timeSelectSlider.slider("refresh"),this.updateSelectedTimeUI()}},onSelectedTimeChange:function(){this.updateSelectedTimeUI()},updateSelectedTimeUI:function(){i.debug("TimeSelector : updateSelectedTimeUI: "," | viewid     : ",this.cid);var e=this.$(".ui-slider-handle");if(e.length){var t=this.$el.find(".selected-time-line");if(t.length){var a=this.$el.parent().siblings(".charts-container-outer"),r=a.height();t.css({height:r});var o=this.$el.parents(".timeline-container");if(o.hasClass("timeline-container-no-right-panel")){var l=t.offset().left+Math.floor(e.outerWidth()/4),c=o.offset().left+o.outerWidth();l>=c?this.$(".ui-slider-handle").addClass("slider-text-left-align"):this.$(".ui-slider-handle").removeClass("slider-text-left-align")}}
var d=this.model.get(s.SELECTED_TIME),u=n.formatShortFullDateTime(d);e.find(".date").html(u)}},_formattedDate:function(e,t){return new Date(e).toString(t)},initialize:function(e){i.debug("TimeSelector : initialize: "," | viewid     : "+this.cid),this.model=e.model},render:function(){i.debug("TimeSelector : render: "," | viewid     : "+this.cid),this.$el.html('<div class="selected-time-slider">\n      <div class="ui-slider-handle">\n        <span class="date" />\n        <div class="selected-time-line" />\n      </div>\n    </div>');var e=this.model.get(s.TIME_RANGE_MIN),t=this.model.get(s.TIME_RANGE_MAX),n=this.model.get(s.SELECTED_TIME);this.timeSelectSlider||(this.timeSelectSlider=this.$(".selected-time-slider").slider({min:e,max:t,value:n})),this.updateSelectedTimeUI()},destroy:function(){i.debug("TimeSelector : destroy: "," | viewid     : "+this.cid),this.timeSelectSlider&&(this.timeSelectSlider.slider("destroy"),this.timeSelectSlider=null),e.prototype.destroy.apply(this,arguments)}})}),define("views/timeline/AlertsAndEventsView",["views/basecomponents/BaseView","data/DataProperties","utils/AppConstants","utils/AppUtil","utils/TimeUtil"],function(e,t,i,n,s){"use strict";return e.extend({name:"AlertsAndEventsView",events:{"click .slot-bar":"onSlotClick"},chartData:null,maxSlotCount:0,NUMBER_OF_SLOTS:40,severityTypes:[t.ALERT_SEVERITY_CRITICAL,t.ALERT_SEVERITY_WARNING,t.ALERT_SEVERITY_INFO,t.EVENT_SEVERITY_AUDIT],slotBarTemplate:_.template("<div class='slot-bar'  data-bar-idx='<%=barIdx%>'  data-start='<%=start%>'  data-end='<%=end%>'  data-total='<%=totalCount%>'  data-severities='<%=severityCounts.join(',')%>'  style='left:<%=left%>px; width:<%=width%>px;' ><div class='sbCount'>   <%= totalCount > 0 ? totalCount : '' %></div><div class='sbSeverity alert-color-kCritical' style='height:<%=heights[0]%>px;'></div><div class='sbSeverity alert-color-kWarning' style='height:<%=heights[1]%>px;'></div><div class='sbSeverity alert-color-kInfo' style='height:<%=heights[2]%>px;'></div><div class='sbSeverity sbSeverity-kAudit' style='height:<%=heights[3]%>px;'></div></div>"),slotTipInnerTemplate:_.template('<span class="tip-inner"> <%= count %><span class="<%= className %>" >    <i data-icon="D" aria-hidden="true"></i></span></span>'),slotTipTemplate:_.template("<div class='slot-bar-tip'> <%= countDetails %></div>"),footerSlotTemplate:_.template("<div class='footer-slot'      style='<%=positionCSS%>'><%= slotText %></div>"),markerTemplate:_.template("<div class='marker-div' style='left: <%=leftPosition%>px;'></div>"),loadingHTML:"<div class='no-data'><div class='donut-loader-blue'></div>&nbsp;Loading...</div>",errorHTML:"<div class='data-error'><i class='icon-warning-sign'></i>&nbsp;Error loading alerts.</div>",onSlotClick:function(e){var t=$(e.currentTarget);this.$(".slot-bar").removeClass("slot-selected").addClass("slot-not-selected"),t.removeClass("slot-not-selected").addClass("slot-selected");var i=Number(t.attr("data-start")),n=Number(t.attr("data-end"));this.model.setAlertEventFilter(i,n),$(".selected-time-slider").slider("option","value",i).trigger("updateslider",i)},onResize:function(){n.debug("AlertsAndEventsView : onResize: "," | viewid     : ",this.cid),this._renderData()},onTimeRangeChange:function(){n.debug("AlertsAndEventsView : onTimeRangeChange: "," | viewid     : ",this.cid),this.render()},onAlertsChange:function(){n.debug("AlertsAndEventsView : onAlertsChange: "," | viewid     : ",this.cid),this.render()},onEventsChange:function(){n.debug("AlertsAndEventsView : onEventsChange: "," | viewid     : ",this.cid),this.render()},onAlertsEventsFilterChange:function(){this.model.get("alertsEventsFilter")||(this.$(".slot-selected").removeClass("slot-selected"),this.$(".slot-bar").removeClass("slot-not-selected"))},onCurrentAlertChange:function(){var e=this.model.getAlertById(this.model.get("currentAlertId"));if(e){var t=Math.round(e.get("createdTimeStampInUsecs")/1e3),i=e.get("severity");this._highlightSlot(t,i)}},onCurrentEventChange:function(){var e=this.model.getEventById(this.model.get("currentEventId"));if(e){var i=Math.round(e.get("createdTimeStampInUsecs")/1e3);this._highlightSlot(i,t.EVENT_SEVERITY_AUDIT)}},_highlightSlot:function(e,t){this.$(".slot-selected").removeClass("slot-selected"),this.$(".slot-bar").addClass("slot-not-selected");var i=this.$(".alert-color-"+t),n=_.find(i,function(t){var i=$(t),n=Number(i.attr("data-start")),s=Number(i.attr("data-end"));return e>=n&&e<s});n&&($(n).removeClass("slot-not-selected"),$(n).addClass("slot-selected"))},_triageData:function(){n.debug("AlertsAndEventsView : _triageData: "," | viewid     : ",this.cid);var e=this.model.get("timeRangeMin"),t=this.model.get("timeRangeMax"),i=Math.round((t-e)/this.NUMBER_OF_SLOTS),s=this.model.getAlertsWithinTimeRange(!1),a=this.model.getEventsWithinTimeRange(!1);if(0===s.length&&0===a.length)return void(this.chartData=null);this.chartData=[],this.maxSlotCount=0;for(var r=0;r<this.NUMBER_OF_SLOTS;r++){for(var o=e+i*r,l=o+i,c=(Math.round((l-o)/2),{}),d=0;d<this.severityTypes.length;d++)c[this.severityTypes[d]]=0;for(var u=0,h=0;h<s.length;h++){var p=s[h],T=p.getCreatedTimestamp();T>=o&&T<l&&(c[p.get("severity")]++,u++)}for(var E=0;E<a.length;E++){var g=a[E],_=g.getCreatedTimestamp();_>=o&&_<l&&(c.kAudit++,u++)}this.chartData.push({totalCount:u,counts:c,start:o,end:l}),u>this.maxSlotCount&&(this.maxSlotCount=u)}},_clearTooltips:function(){_.each(this.$(".slot-bar"),function(e){this.$(e).tooltip("destroy")},this)},_renderData:function(){n.debug("AlertsAndEventsView : _renderData: "," | viewid     : ",this.cid);var e=(this.model.get("timeRangeMin"),this.model.get("timeRangeMax"),this.$(".alerts-and-events-content"));if(this._clearTooltips(),e.empty(),this._renderMarkings(),this.chartData){var a=this.$(".alerts-and-events-content").width(),r=a/this.NUMBER_OF_SLOTS;_.each(this.chartData,function(t,i){if(t.totalCount>0){var n=i*r+1;n+=20;var s={};s.barIdx=i,s.start=t.start,s.end=t.end,s.totalCount=t.totalCount,s.width=r-4,s.left=n,s.severityCounts=[],s.heights=[],_.each(this.severityTypes,function(e){var i=t.counts[e];s.severityCounts.push(i);var n=0;i>0&&(n=Math.max(i/this.maxSlotCount*50,2)),s.heights.push(n)},this);var a=this.slotBarTemplate(s);e.append(a)}},this);var o=this;_.each(this.$(".slot-bar"),function(e,i){var n=$(e),a=Number(n.attr("data-bar-idx")),r=s.formatShortDateTime(Number(n.attr("data-start"))),l=s.formatShortDateTime(Number(n.attr("data-end"))),c=n.attr("data-severities").split(","),d=Number(n.attr("data-total")),u="",h=!1,p=!1;_.each(this.severityTypes,function(e,i){if(c[i]>0){0!==u.length&&(u+='<span class="slot-separator">&middot;</span>');var n=e===t.EVENT_SEVERITY_AUDIT;n?h=!0:p=!0;var s=n?"sbSeverity-kAudit":"alert-fgcolor-"+e;u+=this.slotTipInnerTemplate({count:c[i],className:s})}},this);var T=void 0;if(h&&p?T=this.i18ns("alertsAndEventsCount",d):h?T=this.i18ns("eventsCount",d):p&&(T=this.i18ns("alertsCount",d)),T){u='<span class="slot-tooltip-text">'+T+"</span><br/>"+u}var E=o.slotTipTemplate({countDetails:u,start:r,end:l});n.tooltip({title:E,placement:a>20?"left":"right",trigger:"hover",html:"true",container:$(".chart-container-bottom")})},this)}else{var l=this.model.getAlertsCollectionStatus();if(l===i.STATE_PENDING)return void e.html(this.loadingHTML);if(l===i.STATE_ERROR)return void e.html(this.errorHTML)}},_renderMarkings:function(){for(var e=this.$(".alerts-and-events-content"),t=this.model.get("timeRangeMin"),s=this.model.get("timeRangeMax"),a=e.width(),r=t,o=s-t,l=Math.round(o/5),c=o>=i.MILLIS_PER_DAY,d=0;d<5;d++){var u=c?n.toNearestTenMinutes(r):r,h=Math.round(a*(u-t)/o);h+=20,d>0&&e.append(this.markerTemplate({leftPosition:h})),r+=l}},_formattedDate:function(e,t){return new Date(e).toString(t)},initialize:function(e){n.debug("AlertsAndEventsView : initialize: "," | viewid     : ",this.cid),this.model=e.model},render:function(){n.debug("AlertsAndEventsView : render: "," | viewid     : ",this.cid),this._triageData(),this._renderData()},destroy:function(){n.debug("AlertsAndEventsView : destroy: "," | viewid     : ",this.cid),this._clearTooltips(),e.prototype.destroy.apply(this,arguments)}})}),define("text!templates/timeline/AlertsListView.html",[],function(){return'<% if  (alerts.length === 0 ) { %>\n\n    <div class="object-no-matches">\n      <img src=\'app/assets/images/icons/icon_no_alerts.png\' />\n      <br><br>\n      There are no alerts within the time range.\n    </div>\n\n<% } else { %>\n\n  <% _.each(alerts, function(a) {\n      var formattedMessage = AlertUtil.formatIssue(\n              a.get("message"), a.attributes);\n      var formattedDate =\n        TimeUtil.formatShortDateTime(a.getCreatedTimestamp());\n      var alertId = a.get("id");\n      var alertTypeUuid = a.get("alertTypeUuid");\n      var clusterUuid = a.get(\'clusterUuid\');\n  %>\n      <div class="object-row" data-id="<%=alertId%>" >\n        <span\n          class="object-severity alert-fgcolor-<%= a.get(\'severity\') %>">\n          <i aria-hidden="true" data-icon="D"></i>\n        </span>\n        <span class="object-severity-text\n                     alert-fgcolor-<%= a.get(\'severity\') %>">\n          <%= a.get(\'severity\').substr(1)%>\n        </span>\n        <div class="object-time">\n          <%= formattedDate %>\n          <i aria-hidden="true" data-icon="E"></i>\n        </div>\n        <div class="object-text">\n          <%= formattedMessage %>\n        </div>\n        <% if ( ! showAlertDetails ) { %>\n          <div class="object-text alert-documentation">\n            <a class=\'alert-link\' data-type="cause"\n               data-id="<%= alertTypeUuid %>"\n               <% if (clusterUuid) {%>\n                 data-uuid="<%= clusterUuid %>"\n               <% } %>\n               data-severity="<%= a.get(\'severity\') %>">\n              Cause and Resolution\n            </a>\n          </div>\n        <% } else { %>\n          <div class="object-text alert-details">\n            <a class=\'alert-link\'\n               data-id="<%= alertId %>">\n              Details\n            </a>\n          </div>\n        <% } %>\n      </div>\n  <% }); %>\n<% } %>'}),define("views/timeline/AlertsListView",["views/basecomponents/BaseView","data/DataProperties","managers/ClusterManager","managers/NavigationManager","utils/AppUtil","utils/AppConstants","utils/AlertUtil","utils/TimeUtil","text!templates/timeline/AlertsListView.html"],function(e,t,i,n,s,a,r,o,l){"use strict";return e.extend({events:{"click .object-row":"onAlertRowClick","click .alert-link":"onAlertDocLinkClick"},loadingHTML:"<div class='no-data'><div class='donut-loader-blue'></div>&nbsp;Loading...</div>",errorHTML:"<div class='data-error'><i class='icon-warning-sign'></i>&nbsp;Error loading alerts.</div>",alertDoc:_.template("<div class='alert-doc'><span class='alert-doc-header'>Cause: </span><%= _.escape(cause) %></div><div class='alert-doc'><span class='alert-doc-header'>Resolution: </span><%= _.escape(resolution) %></div>"),alertDocLoadingError:_.template('<div class="no-metadata-status"><%= errorMsg %></div>'),onAlertRowClick:function(e){var t=$(e.currentTarget),i=t.attr("data-id");$(".object-row-selected").removeClass("object-row-selected"),t.addClass("object-row-selected"),this.model.setCurrentAlertId(i)},onAlertDocLinkClick:function(e){var t=$(e.currentTarget),i=t.attr("data-id"),s=t.attr("data-severity"),o=t.attr("data-uuid");if(this._showAlertDetails())return void n.navigateToFullScreenDetailsPane(a.ENTITY_ALERT,i,null);var l=t.siblings(".alert-doc");if(0!==l.length)l.toggle();else{t.parent(".alert-documentation").find(".no-metadata-status").remove();var c=r.getAlertTypeMetadata(i);if(c){var d=r.formatCauses(c,s,o),u=d&&d.length?d[0]:"Not Available",h=c.resolutions&&c.resolutions.length?c.resolutions[0]:"Not Available",p=this.alertDoc({cause:u,resolution:h});t.parent(".alert-documentation").append(p),t.siblings(".alert-doc").toggle()}else{var T=r.getNoMetaDataErrorStatus(a.ENTITY_NAMES[a.ENTITY_ALERT_CAUSE_RESOLUTION]);t.parent(".alert-documentation").append(this.alertDocLoadingError({errorMsg:T}))}}},onTimeRangeChange:function(){s.debug("AlertsListView : onTimeRangeChange: "," | viewid     : ",this.cid),this.render()},onAlertsChange:function(){s.debug("AlertsListView : onAlertsChange: "," | viewid     : ",this.cid),this.render()},onAlertsEventsFilterChange:function(){s.debug("AlertsListView : onAlertsEventsFilterChange: "," | viewid     : ",this.cid),this.render()},_showAlertDetails:function(){return i.isMulticlusterNavMode()},initialize:function(e){s.debug("AlertsListView : initialize: "," | viewid     : ",this.cid),this.model=e.model},render:function(){s.debug("AlertsListView : render: "," | viewid     : ",this.cid);var e=this.model.getAlertsWithinTimeRange(!0);if(0===e.length){var i=this.model.getAlertsCollectionStatus();if(i===a.STATE_PENDING)return void this.$el.html(this.loadingHTML);if(i===a.STATE_ERROR)return void this.$el.html(this.errorHTML)}this.template=_.template(l,{alerts:e,AlertUtil:r,showAlertDetails:this._showAlertDetails(),TimeUtil:o}),this.$el.html(this.template);var n={};n[t.ALERT_SEVERITY_CRITICAL]=0,n[t.ALERT_SEVERITY_WARNING]=0,n[t.ALERT_SEVERITY_INFO]=0;for(var c=0;c<e.length;c++)n[e[c].get("severity")]++;$(".timeline-container").trigger("alert-counts-update",n)},destroy:function(){s.debug("AlertsListView : destroy: "," | viewid     : ",this.cid),e.prototype.destroy.apply(this,arguments)}})});define("text!templates/timeline/EventsListView.html",[],function(){return'<% if  (events.length === 0 ) { %>\n\n  <div class="object-no-matches">\n    <img src=\'app/assets/images/icons/icon_no_events.png\' />\n    <br><br>\n    There are no events within the time range.\n  </div>\n\n<% } else { %>\n\n<% _.each(events, function(e) {\n    var formattedMessage = EventUtil.formatMessage(\n        e.get("message"), e.attributes);\n    var formattedDate = TimeUtil.formatShortDateTime(e.getCreatedTimestamp());\n    var eventId = e.get("id");\n%>\n    <div class="object-row" data-id="<%=eventId%>">\n        <span\n          class="object-severity alert-fgcolor-<%= e.get(\'severity\') %>">\n          <i aria-hidden="true" data-icon="D"></i>\n        </span>\n        <span class="object-severity-text\n                     alert-fgcolor-<%= e.get(\'severity\') %>">\n          <%= e.get(\'severity\').substr(1)%>\n        </span>\n        <div class="object-time">\n          <%= formattedDate %><i aria-hidden="true" data-icon="E"></i>\n        </div>\n        <div class="object-text">\n          <%= formattedMessage %>\n        </div>\n    </div>\n<% }); %>\n<% } %>\n'}),define("views/timeline/EventsListView",["views/basecomponents/BaseView","data/DataProperties","utils/AppUtil","utils/AppConstants","utils/EventUtil","utils/TimeUtil","text!templates/timeline/EventsListView.html"],function(e,t,i,n,s,a,r){"use strict";return e.extend({events:{"click .object-row":"onEventRowClick"},loadingHTML:"<div class='no-data'><div class='donut-loader-blue'></div>&nbsp;Loading...</div>",errorHTML:"<div class='data-error'><i class='icon-warning-sign'></i>&nbsp;Error loading events.</div>",onEventRowClick:function(e){var t=$(e.currentTarget),i=t.attr("data-id");$(".object-row-selected").removeClass("object-row-selected"),t.addClass("object-row-selected"),this.model.setCurrentEventId(i)},onTimeRangeChange:function(){i.debug("EventsListView : onTimeRangeChange: "," | viewid     : ",this.cid),this.render()},onEventsChange:function(){i.debug("EventsListView : onEventsChange: "," | viewid     : ",this.cid),this.render()},onAlertsEventsFilterChange:function(){i.debug("AlertsListView : onAlertsEventsFilterChange: "," | viewid     : ",this.cid),this.render()},initialize:function(e){i.debug("EventsListView : initialize: "," | viewid     : ",this.cid),this.model=e.model},render:function(){i.debug("EventsListView : render: "," | viewid     : ",this.cid);var e=this.model.getEventsWithinTimeRange(!0);if(0===e.length){var o=this.model.getEventsCollectionStatus();if(o===n.STATE_PENDING)return void this.$el.html(this.loadingHTML);if(o===n.STATE_ERROR)return void this.$el.html(this.errorHTML)}this.template=_.template(r,{events:e,EventUtil:s,TimeUtil:a}),this.$el.html(this.template);var l={};l[t.EVENT_SEVERITY_AUDIT]=e.length,$(".timeline-container").trigger("event-counts-update",l)},destroy:function(){i.debug("EventsListView : destroy: "," | viewid     : ",this.cid),e.prototype.destroy.apply(this,arguments)}})}),define("views/timeline/ChartsFooterView",["views/basecomponents/BaseView","utils/AppConstants","utils/AppUtil","utils/TimeUtil"],function(e,t,i,n){"use strict";return e.extend({events:{},footerSlotTemplate:_.template("<div class='footer-slot'      style='<%=positionCSS%>'><%= slotText %></div>"),markerTemplate:_.template("<div class='marker-div' style='left: <%=leftPosition%>px;'></div>"),onResize:function(){i.debug("ChartsFooterView : onResize: "," | viewid     : ",this.cid),this.render()},onTimeRangeChange:function(){i.debug("ChartsFooterView : onTimeRangeChange: "," | viewid     : ",this.cid),this.render()},render:function(){var e=this.$el;e.empty();var s=this.model.get("timeRangeMin"),a=this.model.get("timeRangeMax"),r=this.model.getCurrentTimeRange(),o=n.getDateTimeFormatByTimeRange(r),l=56;r<t.MILLIS_PER_DAY&&(l=26);for(var c,d,u,h=e.width(),p=s,T=a-s,E=Math.round(T/5),g=0;g<5;g++){var _=T>=t.MILLIS_PER_DAY?i.toNearestTenMinutes(p):i.toNearestTenSeconds(p),S=Math.round(h*(_-s)/T);S+=20,g>0&&(e.append(this.markerTemplate({leftPosition:S})),S-=l/2,c=n.formatLocaleDateTime(_,o),u="left:"+S+"px;",d=this.footerSlotTemplate({positionCSS:u,slotText:c}),e.append(d)),p+=E}},initialize:function(e){i.debug("ChartsFooterView : initialize: "," | viewid     : ",this.cid),this.model=e.model},destroy:function(){i.debug("ChartsFooterView : destroy: "," | viewid     : ",this.cid),e.prototype.destroy.apply(this,arguments)}})}),define("models/HistoryModel",["models/BaseModel"],function(e){"use strict";return e.extend({MAX_HISTORY:10,defaults:{history:null,currentIdx:-1},initialize:function(){this.set({history:[],currentIdx:-1})},addHistoryEntry:function(e){var t=this.get("history");t.push(e),t.length>this.MAX_HISTORY&&(t=t.slice(1));var i=t.length-1;this.set({history:t,currentIdx:i})},getCurrentEntry:function(){return this.get("history")[this.get("currentIdx")]},hasHistory:function(){return this.get("currentIdx")>=0},canGoBack:function(){return this._isLegitIndex(this.get("currentIdx")-1)},canGoForward:function(){return this._isLegitIndex(this.get("currentIdx")+1)},goBack:function(e){var t=this.get("currentIdx"),i=this._goto(t-1);return e&&this.get("history").splice(t,1),i},goForward:function(){return this._goto(this.get("currentIdx")+1)},_isLegitIndex:function(e){var t=this.get("history"),i=t.length;return e>=0&&e<i},_goto:function(e){return this.set({currentIdx:e}),this.get("history")[e]}})}),define("models/timeline/TimelineModel",["models/BaseModel","models/BaseCollection","models/userdata/UserDataModel","models/timeline/AnalysisChartModel","models/alert/AlertCollection","models/event/EventCollection","models/stats/StatsModel","models/HistoryModel","data/DataManager","data/DataURLConstants","utils/AppUtil","utils/StatsUtil","utils/AppConstants","data/DataProperties"],function(e,t,i,n,s,a,r,o,l,c,d,u,h,p){"use strict";var T=r.extend({processStats:function(e){var t=this.get("metricIds")[0];return u.processAnalysisStats(t,e)}}),E=t.extend({model:n,comparator:function(e){return(e.isTransient()?"0":"1")+e.getTitle().toLowerCase()}});return e.extend({MAX_ALERTS:1e3,MAX_EVENTS:1e3,name:"TimelineModel",ATTR_MAXIMIZED_CHART_ID:"maximizedChartId",defaults:{boundsRangeMin:0,boundsRangeMax:0,isBoundsWTD:!1,samplingIntervalSecs:0,timeRangeMin:0,timeRangeMax:0,selectedTime:0,chartCategoryMap:null,charts:null,maximizedChartId:null,showAlertsAndEvents:!0,alerts:null,currentAlertId:null,events:null,currentEventId:null,alertsEventsFilter:null,stats:null,statsStateMap:null,zoomHistory:null,boundsRangeChangeTrigger:!1,timeRangeChangeTrigger:!1,chartChangeTrigger:!1,statsChangeTrigger:!1,zoomChangeTrigger:!1,alertsEventsDisplayTrigger:!1},initialize:function(){d.log("TimelineModel : initialize:  | modelId     : "+this.cid),this.initializeBaseModel(),this.initializeDefaults(),this._fetchEvents(),this._fetchAlerts()},initializeDefaults:function(){var e=this.getDefaultTimeRanges();e=_.extend(e,{chartCategoryMap:{},charts:new E,alerts:new s,events:new a,stats:[],statsStateMap:{},zoomHistory:new o}),this.set(e),this._setSelectedTimeByRatio(.5)},setBoundsRange:function(e,t){var i,n,s,a,r,o=(new Date).getTime(),l=t?o:this.get("timeRangeMax");switch(a=l,n=l,r=!1,e){case 365:s=l-365*h.MILLIS_PER_DAY,i=l-180*h.MILLIS_PER_DAY;break;case 180:s=l-180*h.MILLIS_PER_DAY,i=l-90*h.MILLIS_PER_DAY;break;case 90:s=l-90*h.MILLIS_PER_DAY,i=l-30*h.MILLIS_PER_DAY;break;case 30:s=l-30*h.MILLIS_PER_DAY,i=l-7*h.MILLIS_PER_DAY;break;case 7:s=l-7*h.MILLIS_PER_DAY,i=l-1*h.MILLIS_PER_DAY;break;case 1:s=l-1*h.MILLIS_PER_DAY,i=l-6*h.MILLIS_PER_HOUR;break;case.25:s=l-6*h.MILLIS_PER_HOUR,i=l-3*h.MILLIS_PER_HOUR;break;default:a=o,n=o,s=o-30*h.MILLIS_PER_DAY,i=o-7*h.MILLIS_PER_DAY,r=!0}this.set({boundsRangeMax:a,boundsRangeMin:s,timeRangeMax:n,timeRangeMin:i,samplingIntervalSecs:d.samplingIntervalByDays(e),isBoundsWTD:r}),this._setSelectedTimeByRatio(.5),this._clearStats(),this._fetchEvents(),this._fetchAlerts(),this._triggerBoundsRangeChange()},setCustomBoundsRange:function(e,t){var i=Math.round((t-e)/2),n=e,s=t,a=e-i,r=t,o=Math.ceil((t-e)/h.MILLIS_PER_DAY);this.set({boundsRangeMax:r,boundsRangeMin:a,timeRangeMax:s,timeRangeMin:n,samplingIntervalSecs:d.samplingIntervalByDays(o),isBoundsWTD:!1}),this._setSelectedTimeByRatio(.5),this._clearStats(),this._fetchEvents(),this._fetchAlerts(),this._triggerBoundsRangeChange()},getDefaultTimeRanges:function(){var e=Date.now();return{boundsRangeMax:e,boundsRangeMin:e-7*h.MILLIS_PER_DAY,samplingIntervalSecs:d.samplingIntervalByDays(7),timeRangeMax:e,timeRangeMin:e-h.MILLIS_PER_DAY}},getSelectedTimeRanges:function(){var e={},t=["boundsRangeMax","boundsRangeMin","timeRangeMax","timeRangeMin"];return _.each(t,function(t){e[t]=this.get(t)},this),e},isTimeRangeMaxCloseToBoundsRangeMax:function(){var e=this.getSelectedTimeRanges(),t=e.boundsRangeMax-e.boundsRangeMin,i=20*h.MILLIS_PER_MINUTE;t<1*h.MILLIS_PER_DAY&&(i=5*h.MILLIS_PER_MINUTE);var n=e.timeRangeMax;return e.boundsRangeMax-n<=i},setDrilldownTimerange:function(e,t,i,n){var s=(i-n)/h.MILLIS_PER_DAY,a=d.samplingIntervalByDays(s);this.set({boundsRangeMax:i,boundsRangeMin:n,timeRangeMax:t,timeRangeMin:e,samplingIntervalSecs:a}),this._setSelectedTimeByRatio(.5),this.set({stats:[]}),this._fetchEvents(),this._fetchAlerts(),this._triggerBoundsRangeChange()},getBoundsRangeInDays:function(){return(this.get("boundsRangeMax")-this.get("boundsRangeMin"))/h.MILLIS_PER_DAY},isBoundsRangeWTD:function(){return this.get("isBoundsWTD")},setTimeRange:function(e,t){var i=this._calculateCurrentSelectedTimeRatio();this.set({timeRangeMin:e,timeRangeMax:t}),this._setSelectedTimeByRatio(i),this._triggerTimeRangeChange()},getSelectedTime:function(){return this.get("selectedTime")},setSelectedTime:function(e){var t=this.get("timeRangeMin");e<=this.get("timeRangeMax")&&e>=t?this.set({selectedTime:e}):d.debug("Error: setSelectedTime, invalid time:",new Date(e))},zoomTo:function(e,t){var i=this.get("zoomHistory"),n=this.getBoundsRangeInDays(),s=Math.round((t-e)/h.MILLIS_PER_DAY);if(!i.hasHistory()){var a=this.get("timeRangeMin"),r=this.get("timeRangeMax");i.addHistoryEntry({min:a,max:r,range:n})}s=n>30?s>=30?n:7:n>7?s>=7?n:1:n>1&&s>=1?n:1,i.addHistoryEntry({min:e,max:t,range:s}),this.setDrilldownTimerange(e,t,t,t-s*h.MILLIS_PER_DAY)},getZoom:function(){return this.get("zoomHistory").getCurrentEntry()},historyCanGoBack:function(){return this.get("zoomHistory").canGoBack()},historyCanGoForward:function(){return this.get("zoomHistory").canGoForward()},historyGoForward:function(){var e=this.get("zoomHistory");e.canGoForward()&&(e.goForward(),this._triggerZoom())},historyGoBack:function(e){var t=this.get("zoomHistory");if(t.canGoBack()){t.goBack(e);var i=t.getCurrentEntry(),n=i.min,s=i.max,a=i.range;this.setDrilldownTimerange(n,s,s,s-a*h.MILLIS_PER_DAY)}},getChartById:function(e){return this.get("charts").find(function(t){return t.getChartId()===e})},getChartByTitle:function(e){return this.get("charts").find(function(t){return t.getTitle()===e})},getTransientCharts:function(){return this.get("charts").filter(function(e){return e.isTransient()})},enableChart:function(e,t){var i=this.getChartById(e);i&&(i.set({enabled:t}),e!==this.ALERTS_CHART_ID?this.updateChart(e,i):this._triggerChartChange())},setUserChartColor:function(e,t,i){var n=this.getChartById(e);n.setUserChartColor(t,i),this.updateChart(e,n)},addChart:function(e,t){var n=this;this.restoreMaximizedChart(!0);for(var s=d.randomId(p.USER_DATA_TYPE_CHARTS);this.getChartById(s);)s=d.randomId(p.USER_DATA_TYPE_CHARTS);e.setParentModel(n),e.setChartId(s);var a=e.get("title")||"";if(0===a.length){var r=e.getDefaultTitle();a=r;for(var o=2;this.getChartByTitle(a);)a=r+" - "+o,o++;e.set({title:a})}if(this.get("charts").add(e),e.isTransient())t&&t();else{var l=new i;l.set({type:p.USER_DATA_TYPE_CHARTS,key:s,value:JSON.stringify(e.toPersistedObject())}),l.save(null,{success:function(e,i){n._triggerChartChange(),t&&t()},error:function(e,i){d.log("TimelineModel : addChart: "+d.processAjaxError(i.responseText)),t&&t()}})}},addChartsInSequence:function(e){var t=this,i=e[0],n=e.slice(1);this.addChart(i,function(){if(0===n.length)return void t.get("charts").updateState(h.STATE_SUCCESS);t.addChartsInSequence(n)})},removeChart:function(e){this.restoreMaximizedChart(!0);var t=this.getChartById(e);if(t){var n=this;if(t.isTransient())n.get("charts").remove(t),t.destroy(),n._triggerChartChange();else{var s=new i;s.set({type:p.USER_DATA_TYPE_CHARTS,id:e,key:e}),s.destroy({success:function(){n.get("charts").remove(t),t.destroy(),n._triggerChartChange()},error:function(e,t){d.log("TimelineModel : removeChart: "+d.processAjaxError(t.responseText))}})}}},maximizeChart:function(e){this.set(this.ATTR_MAXIMIZED_CHART_ID,e),this._triggerChartChange()},restoreMaximizedChart:function(e){var t=this.get(this.ATTR_MAXIMIZED_CHART_ID);if(t){var i=this.getChartById(t);i.setChartSize(i.CHART_SIZE_SMALL),this.set(this.ATTR_MAXIMIZED_CHART_ID,null),e||this._triggerChartChange()}},isMaximized:function(e){return this.get(this.ATTR_MAXIMIZED_CHART_ID)===e},updateChart:function(e,t){this.restoreMaximizedChart(!0);var n=this.getChartById(e);if(n.set(t.toJSON()),n.setParentModel(this),n.assignChartColors(),n.isTransient())this._triggerChartChange();else{var s=this,a=new i;a.set({type:p.USER_DATA_TYPE_CHARTS,id:e,key:e,value:JSON.stringify(t.toPersistedObject())}),a.save(null,{success:function(e,t){s.get("charts").sort(),s._triggerChartChange()},error:function(e,t){d.log("TimelineModel : updateChart: "+d.processAjaxError(t.responseText))}})}},getPersistedCharts:function(e){var t=l.getFormattedURL(c.APP_USER_DATA+"?type="+p.USER_DATA_TYPE_CHARTS);$.getJSON(t).done(function(t){e(_.isEmpty(t)?null:t)}).fail(function(){})},getCurrentTimeRange:function(){var e=this.get("timeRangeMin");return this.get("timeRangeMax")-e},getChartTimeFormat:function(){var e=this.getCurrentTimeRange(),t="MM/dd hh:mm";return e<h.MILLIS_PER_DAY&&(t="hh:mm:ss"),t},showAlertsAndEvents:function(){return this.get("showAlertsAndEvents")},setShowAlertsAndEvents:function(e){this.set("showAlertsAndEvents",e),this._triggerAlertsEventsDisplayChange()},getAlertsCollection:function(){return this.get("alerts")},getAlertsCollectionStatus:function(){return this.get("alerts").getState()},getAlertsWithinTimeRange:function(e){var t=this.get("timeRangeMin"),i=this.get("timeRangeMax");if(e){var n=this.get("alertsEventsFilter");if(n)return this.get("alerts").getAlertsInTimeRange(n.start,n.end)}return this.get("alerts").getAlertsInTimeRange(t,i)},getAlertById:function(e){return this.get("alerts").find(function(t){return t.get("id")===e})},setCurrentAlertId:function(e){this.set({currentAlertId:e})},_fetchAlerts:function(){var e=this.getMaxTimeForLoadingStats(),t=this.getMinTimeForLoadingStats();this.getAlertsCollection().fetch({data:{startTimeInUsecs:1e3*t,endTimeInUsecs:1e3*e,count:this.MAX_ALERTS},processData:!0})},getEventsCollection:function(){return this.get("events")},getEventsCollectionStatus:function(){return this.get("events").getState()},getEventsWithinTimeRange:function(e){var t=this.get("timeRangeMin"),i=this.get("timeRangeMax");if(e){var n=this.get("alertsEventsFilter");n&&(t=n.start,i=n.end)}return this.get("events").getEventsInTimeRange(t,i)},getEventById:function(e){return this.get("events").find(function(t){return t.get("id")===e})},setCurrentEventId:function(e){this.set({currentEventId:e})},_fetchEvents:function(){var e=this.get("boundsRangeMax"),t=this.get("boundsRangeMin");this.getEventsCollection().fetch({data:{start:1e3*t,end:1e3*e,count:this.MAX_EVENTS},processData:!0})},setAlertEventFilter:function(e,t){this.set({alertsEventsFilter:{start:e,end:t}})},clearAlertEventFilter:function(){this.set({alertsEventsFilter:null})},getAnalysisCharts:function(){return this.get("charts")},getStats:function(e,t){var i=this._getStatsModel(e,t),n=i?i.getStats():null;return d.debug("TimelineModel : getStats: "," | entityId:",e," metricId:",t," ret:",n),n},getStatsState:function(e,t){var i=this._getStatsModel(e,t);return i?this.get("statsStateMap")[i.cid]:null},loadStats:function(e,t,i,n,s,a){d.debug("TimelineModel : loadStats: "," | entityId:",e," metricId:",i," requestorId:",n);var r=this,o=this._getStatsModel(e,i);if(o){d.debug("TimelineModel : loadStats: stats already loaded:"+[e,i]);var l=this.get("statsStateMap")[o.cid];return void(l===h.STATE_PENDING?o.addRequestor(n):l===h.STATE_ERROR?this.trigger("stats:error",[e,i,n]):this.trigger("stats:loaded",[e,i,n]))}var c=this.getMinTimeForLoadingStats(),u=this.getMaxTimeForLoadingStats(),p=this.get("samplingIntervalSecs");o=this.createStatsModel(),o.setTimeInterval(c,u,p),o.setStatsFor(e,t.toLowerCase(),i,s,a),o.addRequestor(n),this.get("stats").push(o);var T=o.cid;this._setStatsState(T,h.STATE_PENDING);var E=function(e,t,i,n){_.each(e.getRequestors(),function(e){r.trigger(t,[i,n,e])})};return this.requestStats(o,{success:function(t){r._setStatsState(t.cid,h.STATE_SUCCESS),E(t,"stats:loaded",e,i)},error:function(t){r._setStatsState(t.cid,h.STATE_ERROR),E(t,"stats:error",e,i)}})},requestStats:function(e,t){return e.fetch(t)},createStatsModel:function(){return new T},getMinTimeForLoadingStats:function(){return this.get("boundsRangeMin")},getMaxTimeForLoadingStats:function(){return this.get("boundsRangeMax")},loadDefaultCharts:function(){var e=new n,t=e.getMetricById(p.STATS_NUM_IOPS);e.set({type:e.CHART_TYPE_METRIC,primaryObj:{id:t.id,title:t.title,enabled:!0},secondaryObjs:[{id:h.ENTITY_CLUSTER,title:h.ENTITY_CLUSTER_NAME,type:h.ENTITY_CLUSTER,enabled:!0}],title:"Cluster: Disk IOPs",enabled:!0}),e.assignChartColors();var i=new n,s=i.getMetricById(p.STATS_HYP_CPU_USAGE),a=i.getMetricById(p.STATS_HYP_MEMORY_USAGE);i.set({type:e.CHART_TYPE_ENTITY,primaryObj:{id:h.ENTITY_CLUSTER,title:h.ENTITY_CLUSTER_NAME,type:h.ENTITY_CLUSTER,enabled:!0},secondaryObjs:[{id:s.id,title:s.title,enabled:!0},{id:a.id,title:a.title,enabled:!0}],title:"Cluster: CPU/Memory",enabled:!0}),i.assignChartColors(),this.get("charts").updateState(h.STATE_PENDING),this.addChartsInSequence([e,i])},_getStatsModel:function(e,t){return _.find(this.get("stats"),function(i){return i.isStatsFor(e,t)})},_setStatsState:function(e,t){this.get("statsStateMap")[e]=t},_calculateCurrentSelectedTimeRatio:function(){var e=this.getSelectedTime(),t=this.get("timeRangeMin");return(e-t)/(this.get("timeRangeMax")-t)},initializeCharts:function(e){var t=this,i=t.get("charts");if(i.getState()===h.STATE_SUCCESS)return void e();i.updateState(h.STATE_PENDING),
this.getPersistedCharts(function(s){s&&s.length>0?(_.each(s,function(e){var s=new n;try{s.set(JSON.parse(e.value))}catch(t){d.log("Error decoding chart. String:"+e.value),s.setTitle("Error retrieving chart")}s.setChartId(e.key),s.setParentModel(t),s.assignChartColors(),i.add(s)}),t.restoreMaximizedChart(!0),t._triggerChartChange(),i.updateState(h.STATE_SUCCESS),e&&e()):(i.updateState(h.STATE_SUCCESS),e&&e())})},_clearStats:function(){this.set({stats:[],statsStateMap:{}})},_setSelectedTimeByRatio:function(e){var t=this.get("timeRangeMin"),i=this.get("timeRangeMax"),n=t+Math.round(e*(i-t));this.setSelectedTime(n)},_triggerBoundsRangeChange:function(){this.set({boundsRangeChangeTrigger:!this.get("boundsRangeChangeTrigger")})},_triggerTimeRangeChange:function(){this.set({timeRangeChangeTrigger:!this.get("timeRangeChangeTrigger")})},_triggerChartChange:function(){this.set({chartChangeTrigger:!this.get("chartChangeTrigger")})},_triggerZoom:function(){this.set({zoomChangeTrigger:!this.get("zoomChangeTrigger")})},_triggerAlertsEventsDisplayChange:function(){this.set({alertsEventsDisplayTrigger:!this.get("alertsEventsDisplayTrigger")})}})}),define("text!templates/timeline/TimelineView.html",[],function(){return'<div class="timeline-container">\n  <div class="side-bar timeline-left">\n    <div class="panel-header">\n      <%= i18n(\'charts\') %>\n      <div class="chart-button chart-button-help selected">\n        <div class="chart-button-text showChartHelp">\n          ?\n        </div>\n      </div>\n      <div class="new-chart-menu pull-right dropdown">\n        <a class="dropdown-toggle new-chart-menu" href="#"\n           data-toggle="dropdown">\n           <%= i18n(\'new\') %>\n           <i aria-hidden="true" data-icon="z"></i>\n        </a>\n        <ul class="dropdown-menu dropdown-menu-right">\n          <li stream-action="create" stream-target="metric chart">\n              <a class="btnNewChart n-nav-link" data-id="newMetricChart">\n                  <%= i18n(\'new_metric_chart\') %>\n              </a>\n          </li>\n          <li stream-action="create" stream-target="entity chart">\n              <a class="btnNewChart n-nav-link" data-id="newEntityChart">\n                  <%= i18n(\'new_entity_chart\') %>\n              </a>\n          </li>\n        </ul>\n      </div>\n    </div>\n\n    <div class="charts-list-container scrollSizer">\n      <div class="antiscroll-wrap">\n        <div class="box-wrap">\n          <div class="antiscroll-inner charts-list-inner">\n            <div class="charts-help">\n              <div>\n                <span class="helpTitle"> <%= i18n(\'metric\') %></span>\n                <%= i18n(\'metric_help\') %>\n              </div>\n              <br>\n              <div>\n                <span class="helpTitle"><%= i18n(\'entity\') %></span>\n                <%= i18n(\'entity_help\') %>\n              </div>\n              <a class=\'dismissChartHelp\'><%= i18n(\'got_it\') %></a>\n            </div>\n            <div class="selection-panel charts-list"></div>\n            <div class="selection-panel charts-restore-defaults hide">\n              <p class="notification"><%= i18n(\'no_saved_charts\') %></p>\n              <button class="btnRestoreDefaultCharts btn btn-primary btn-block">\n                <%= i18n(\'create_default_chart\') %>\n              </button>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n\n  <div class="timeline-center">\n    <div class="time-range-selector">\n      \x3c!-- TimerangeSelectorView is rendered here --\x3e\n    </div>\n    <div class="charts-container-outer scrollSizer">\n      <div class="antiscroll-wrap">\n        <div class="box-wrap charts-container-box-wrap">\n          <div class="antiscroll-inner charts-container-inner">\n            <div class="charts-container">\n              <div class="alerts-and-events" id="alerts-and-events">\n                <div class=\'alerts-and-events-header\'>\n                  <%= i18n(\'alerts_events\') %>\n                </div>\n                <div class=\'alerts-and-events-content\'>\n                  \x3c!-- Counts rendred here--\x3e\n                </div>\n              </div>\n              \x3c!-- One or more TimlineChartViews are rendered here --\x3e\n            </div>\n          </div>\n        </div>\n        <div>\n        </div>\n      </div>\n    </div>\n\n    <div class="chart-container-bottom">\n      <div class="time-selector-view">\n        \x3c!--Time Selector here--\x3e\n      </div>\n      <div class="charts-timeline-footer">\n        \x3c!--Time Line Footer here--\x3e\n      </div>\n    </div>\n  </div>\n\n  <div class="side-bar timeline-right">\n\n    <div class="side-bar-panel">\n      <div class="panel-header">\n        <span class="alert-filter-count"></span><%= i18n(\'alerts\') %>\n        <span class="clear-filter clear-alerts-filter">\n          <%= i18n(\'show_all\') %>\n        </span>\n        <div class="alert-counts pull-right">\n          \x3c!-- Alert counts go here --\x3e\n        </div>\n      </div>\n\n      <div class="panel-body alerts-list-container scrollSizer">\n        <div class="antiscroll-wrap">\n          <div class="box-wrap">\n            <div class="antiscroll-inner alerts-list-inner">\n              <div class="object-list alerts-list"></div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n\n    <div class="side-bar-panel events-list-wrapper">\n      <div class="panel-header">\n        <span class="event-filter-count"></span><%= i18n(\'events\') %>\n        <span class="clear-filter clear-events-filter">\n          <%= i18n(\'show_all\') %>\n        </span>\n        <div class="event-counts pull-right">\n          \x3c!-- Event counts go here --\x3e\n        </div>\n      </div>\n\n      <div class="panel-body events-list-container scrollSizer">\n        <div class="antiscroll-wrap">\n          <div class="box-wrap">\n            <div class="antiscroll-inner events-list-inner" >\n              <div class="object-list events-list"></div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n\n  </div>\n</div>\n'}),define("views/timeline/TimelineView",["views/basecomponents/BaseView","utils/AppUtil","utils/SubViewHelper","utils/AppConstants","managers/NotificationManager","managers/NamespaceManager","views/timeline/ChartsListView","views/timeline/TimerangeSelectorView","views/timeline/TimeSelectorView","views/timeline/AlertsAndEventsView","views/timeline/AnalysisChartView","views/timeline/AlertsListView","views/timeline/EventsListView","views/timeline/ChartsFooterView","models/timeline/AnalysisChartModel","models/timeline/TimelineModel","managers/NavigationManager","text!templates/timeline/TimelineView.html"],function(e,t,i,n,s,a,r,o,l,c,d,u,h,p,T,E,g,S){"use strict";return e.extend({name:"TimelineView",viewTemplate:_.template(S),CHART_ID_PREFIX:"chart-",USER_SETTING_CHART_HELP_DISMISS:"chartHelpDismiss",CHART_LINK_DD:"def=",CHART_DD:"dd=",subViewHelper:null,scrollers:null,events:{"click .clear-alerts-filter":"onClearFilter","click .clear-events-filter":"onClearFilter","click .btnNewChart":"onNewChart","click .showChartHelp":"toggleChartHelp","click .dismissChartHelp":"dismissChartHelp","click .btnRestoreDefaultCharts":"onRestoreDefaultChartsClick","alert-counts-update":"onAlertsCountUpdate","event-counts-update":"onEventsCountUpdate","edit-chart":"onEditChart","delete-chart":"onDeleteChart"},onAlertsCountUpdate:function(e,t){this._updateAlertsEventsCounts("alert",t)},onEventsCountUpdate:function(e,t){this._updateAlertsEventsCounts("event",t)},onEditChart:function(e,t){this.subViewHelper.get("charts-list").editChart(t.chartId)},onDeleteChart:function(e,t){this.subViewHelper.get("charts-list").removeChart(t.chartId)},toggleChartHelp:function(){this.$(".charts-help").is(":visible")?this._showChartHelp(!1):this._showChartHelp(!0)},dismissChartHelp:function(){a.get(a.USER_SETTINGS).setUserSetting(this.USER_SETTING_CHART_HELP_DISMISS,!0),this._showChartHelp(!1)},onNewChart:function(e){var t=$(e.currentTarget).attr("data-id"),i=this.subViewHelper.get("charts-list");"newEntityChart"===t?i.createNewEntityChart():"newMetricChart"===t&&i.createNewMetricChart()},onClearFilter:function(){this.model.clearAlertEventFilter()},onResize:function(){this._refreshScrollers();var e=this.model.get(this.model.ATTR_MAXIMIZED_CHART_ID);if(e){var t=this.CHART_ID_PREFIX+e;this._maximizeChart(t)}this.subViewHelper.iterate("onResize")},onBoundsRangeChange:function(){t.debug("TimelineView : onBoundsRangeChange: "," | viewid     : ",this.cid);var e=this;this.subViewHelper.iterate("onBoundsRangeChange"),setTimeout(function(){e._refreshScrollers()},250)},onTimeRangeChange:function(){t.debug("TimelineView : onTimeRangeChange: "," | viewid     : ",this.cid);var e=this;this.subViewHelper.iterate("onTimeRangeChange"),setTimeout(function(){e._refreshScrollers()},250)},onSelectedTimeChange:function(){t.debug("TimelineView : onSelectedTimeChange: "," | viewid     : ",this.cid);var e=this;this.subViewHelper.iterate("onSelectedTimeChange"),setTimeout(function(){e._refreshScrollers()},250)},onZoomChange:function(){t.debug("TimelineView : onZoomChange: "," | viewid     : "+this.cid),this.subViewHelper.iterate("onZoomChange")},onCurrentAlertChange:function(){this.subViewHelper.iterate("onCurrentAlertChange")},onCurrentEventChange:function(){this.subViewHelper.iterate("onCurrentEventChange")},onChartChange:function(){t.debug("TimelineView : onChartChange: "," | viewid     : "+this.cid);var e=this;this.subViewHelper.iterate("onChartChange"),this._toggleChartList(),this._recreateCharts(),setTimeout(function(){e._refreshScrollers()},250)},onAlertsChange:function(){t.debug("TimelineView : onAlertsChange: "," | viewid     : "+this.cid);var e=this;this.subViewHelper.iterate("onAlertsChange"),setTimeout(function(){e._refreshScrollers()},250)},onEventsChange:function(){t.debug("TimelineView : onEventsChange: "," | viewid     : "+this.cid);var e=this;this.subViewHelper.iterate("onEventsChange"),setTimeout(function(){e._refreshScrollers()},250)},onAlertsEventsFilterChange:function(){t.debug("TimelineView : onAlertsEventsFilterChange: "," | viewid     : "+this.cid),this.$(".clear-alerts-filter").hide(),this.$(".clear-events-filter").hide(),this.model.get("alertsEventsFilter")&&(this.$(".clear-events-filter").show(),this.$(".clear-alerts-filter").show());var e=this;this.subViewHelper.iterate("onAlertsEventsFilterChange"),setTimeout(function(){e._refreshScrollers()},250)},onAlertsDisplayChange:function(){this.model.showAlertsAndEvents()?this.$(".timeline-container").removeClass("timeline-container-no-right-panel"):this.$(".timeline-container").addClass("timeline-container-no-right-panel"),this._refreshScrollers(),this._recreateCharts(),this.subViewHelper.iterate("onResize")},onRestoreDefaultChartsClick:function(){this.model.loadDefaultCharts()},initialize:function(){e.prototype.initialize.apply(this,arguments),t.debug("TimelineView : initialize: "," | viewid     : "+this.cid),this.model=new E,this.model.on("change:boundsRangeChangeTrigger",this.onBoundsRangeChange,this),this.model.on("change:timeRangeChangeTrigger",this.onTimeRangeChange,this),this.model.on("change:selectedTime",this.onSelectedTimeChange,this),this.model.on("change:chartChangeTrigger",this.onChartChange,this),this.model.on("change:zoomChangeTrigger",this.onZoomChange,this),this.model.on("change:currentAlertId",this.onCurrentAlertChange,this),this.model.on("change:currentEventId",this.onCurrentEventChange,this),this.model.on("change:alertsEventsFilter",this.onAlertsEventsFilterChange,this),this.model.on("change:alertsEventsDisplayTrigger",this.onAlertsDisplayChange,this),this.model.getAlertsCollection().on("stateChanged",this.onAlertsChange,this),this.model.getEventsCollection().on("stateChanged",this.onEventsChange,this),this.render();var i=a.get(a.USER_SETTINGS),n=!i.getUserSetting(this.USER_SETTING_CHART_HELP_DISMISS);this._showChartHelp(n)},render:function(){var e=this;t.debug("TimelineView : render: "," | viewid     : "+this.cid),this.$el.html(this.viewTemplate(this.vtOptions())),this._initializeSubViews(),this.subViewHelper.renderAll(),this.scrollers=[];var i={x:!1,y:!0,autoHide:!0};if(_.each(this.$(".antiscroll-wrap"),function(t){e.scrollers.push($(t).antiscroll(i).data("antiscroll"))}),this._refreshScrollers(),this._toggleChartList(),"object"==typeof window.chrome){var n=this;setTimeout(function(){n._refreshScrollers()},100)}},destroy:function(){t.debug("TimelineView : destroy: "," | viewid     : "+this.cid),this.model.off("change:boundsRangeChangeTrigger",this.onBoundsRangeChange,this),this.model.off("change:timeRangeChangeTrigger",this.onTimeRangeChange,this),this.model.off("change:selectedTime",this.onSelectedTimeChange,this),this.model.off("change:chartChangeTrigger",this.onChartChange,this),this.model.off("change:zoomChangeTrigger",this.onZoomChange,this),this.model.off("change:currentAlertId",this.onCurrentAlertChange,this),this.model.off("change:currentEventId",this.onCurrentEventChange,this),this.model.off("change:alertsEventsFilter",this.onAlertsEventsFilterChange,this),this.model.off("change:alertsEventsDisplayTrigger",this.onAlertsDisplayChange,this),this.model.off("stateChanged",this.onAlertsChange,this),this.model.off("stateChanged",this.onEventsChange,this),this.subViewHelper.removeAll(),this.subViewHelper=null,e.prototype.destroy.apply(this,arguments)},processViewOptions:function(e){var i;if(_.isObject(e)&&(e=t.formatObjectToQuery(e)),e&&0===e.indexOf(this.CHART_LINK_DD))if(i=new T,i.fromURL(e)){var a=i.get("title");this.model.getChartByTitle(a)?s.showClientNotification(n.NOTIFY_ERROR,'Error importing chart.The chart you are importing is named "'+_.escape(a)+'". You already have a chart with that name.'):(this.model.addChart(i),s.showClientNotification(n.NOTIFY_SUCCESS,"Chart  '"+_.escape(i.get("title"))+"'  was imported.")),g.clearQueryStringParams()}else s.showClientNotification(n.NOTIFY_ERROR,"Error importing chart.Possible reason: Invalid or corrupt chart link.");else if(e&&0===e.indexOf(this.CHART_DD)){i=new T;var r=t.parseQueryToObject(e),o=r.entityId.split(","),l=r.metricId.split(",");if(o.length>1&&1===l.length){var c=r.entityName.split(",");o.length!==c.length&&t.log("Error: Number of entity names do not match ids");var d=i.getMetricById(r.metricId),u={id:d.id,title:d.title,enabled:!0},h=_.map(o,function(e,t){return{id:e,title:c[t]||n.UNKNOWN,type:r.entityType,enabled:!0}});i.setTransient(!0),i.set({primaryObj:u,secondaryObjs:h,enabled:!0,title:r.title,type:i.CHART_TYPE_METRIC})}else{var p={id:r.entityId,title:r.entityName,type:r.entityType,parentType:this.validateURLValue(r.entityParentType),parentId:this.validateURLValue(r.entityParentId),enabled:!0},E=[];_.each(l,function(e){var t=i.getMetricById(e);E.push({id:t.id,title:t.title,enabled:!0})}),i.setTransient(!0),i.set({primaryObj:p,secondaryObjs:E,enabled:!0,title:r.title,type:i.CHART_TYPE_ENTITY})}_.each(this.model.getTransientCharts(),function(e){this.model.removeChart(e.getChartId())},this),this.model.addChart(i),this._addChart(i,!0,!1),this.subViewHelper.get("charts-list").render();var S=r.tr;if(S){var m=(new Date).getTime(),v=m-Number(r.tr)*n.MILLIS_PER_HOUR,f=m,A=m-6*n.MILLIS_PER_HOUR;this.model.setDrilldownTimerange(v,m,f,A)}s.showClientNotification(n.NOTIFY_SUCCESS,"A temporary chart  '"+_.escape(i.get("title"))+"'  was created for you. Click on its save button to retain it."),g.clearQueryStringParams()}},validateURLValue:function(e){return"undefined"===e?void 0:e},show:function(e){t.log("TimelineView : show:  | viewid     : "+this.cid);var i=this;this.model.initializeCharts(function(){i.processViewOptions(e)}),$(window).trigger("resize")},_initializeSubViews:function(){if(!this.subViewHelper){this.subViewHelper=new i;var e=new r({el:this.$(".charts-list"),model:this.model});this.subViewHelper.register("charts-list",e);var t=new u({el:this.$(".alerts-list"),model:this.model});if(this.subViewHelper.register("alerts-view",t),this.clusterManager.isMulticlusterNavMode())this.$(".events-list-wrapper").hide();else{this.$(".events-list-wrapper").show();var n=new h({el:this.$(".events-list"),model:this.model});this.subViewHelper.register("events-view",n)}var s=new o({el:this.$(".time-range-selector"),model:this.model});this.subViewHelper.register("time-range-selector-view",s);var a=new l({el:this.$(".time-selector-view"),model:this.model});this.subViewHelper.register("time-selector-view",a);var d=this.subViewHelper.get("charts-footer-view");d||(d=new p({el:this.$(".charts-timeline-footer"),model:this.model}),this.subViewHelper.register("charts-footer-view",d));var T=this.subViewHelper.get("alerts-and-events");T||(T=new c({el:this.$("#alerts-and-events"),model:this.model}),this.subViewHelper.register("alerts-and-events",T)),this.model.getAnalysisCharts().each(function(e){e.get("enabled")&&this._addChart(e,!1,!0)},this)}},_getCurrentChartIds:function(){var e=this;return _.filter(this.subViewHelper.getIds(),function(t){return 0===t.indexOf(e.CHART_ID_PREFIX)})},_recreateCharts:function(){var e=this._getCurrentChartIds(),t=this.model.get(this.model.ATTR_MAXIMIZED_CHART_ID);if(t){var i=this.CHART_ID_PREFIX+t;_.each(e,function(e){e!==i&&this.$("#"+e).hide()},this),this._maximizeChart(i)}else _.each(e,function(e){this._removeChart(e.substr(this.CHART_ID_PREFIX.length))},this),this.model.getAnalysisCharts().each(function(e){var t=e.getChartId(),i=this.CHART_ID_PREFIX+t;e.get("enabled")&&(this.$("#"+i).show(),this._addChart(e,!0,!0))},this);this.model.showAlertsAndEvents()?this.$("#alerts-and-events").show():this.$("#alerts-and-events").hide()},_addChart:function(e,i,n){t.debug("TimelineView : addChart: "," | chartModel.id     : "+e.get("id"));var s=this._getChartsContainer(e),a=this.CHART_ID_PREFIX+e.getChartId(),r=e.isTransient()?"chart-panel chart-panel-transient":"chart-panel",o='<div class="'+r+'" id="'+a+'"></div>';n?s.append(o):$(s.children()[0]).after(o);var l=this._instantiateChart({el:this.$("#"+a),model:e});if(this.subViewHelper.register(a,l),i&&(l.render(),e.isTransient())){s.css({scrollTop:"0px"});var c=this;this.$(".chart-panel-transient").animate({height:"150px","padding-bottom":"20px"},2e3,function(){c.$(".chart-panel-transient").css({height:"auto"})})}},_instantiateChart:function(e){return new d(e)},_maximizeChart:function(e){var t=this.subViewHelper.get(e),i=this.$(".charts-container-inner").height(),n=this.model.showAlertsAndEvents()?this.$(".alerts-and-events").height():0,s=i-n-80;t.setContainerMaxSize(s),t.refreshChart()},_removeChart:function(e){t.debug("TimelineView : removeChart: "," | chartId     : "+e);var i=this.CHART_ID_PREFIX+e;this.subViewHelper.remove(i),this.$("#"+i).remove()},_getChartsContainer:function(){return this.$(".charts-container")},_showChartHelp:function(e){e?(this.$(".charts-help").show(),this.$(".chart-button-help").addClass("selected")):(this.$(".charts-help").hide(),this.$(".chart-button-help").removeClass("selected"))},_updateAlertsEventsCounts:function(e,t){var i="",n=0;_.each(t,function(e,t){if(e>0){i+='<span  class="alert-fgcolor-'+t+'"><i aria-hidden="true" data-icon="D"></i>'+e+"</span>",n+=e}}),this.$("."+e+"-filter-count").html(n+" "),this.$("."+e+"-counts").html(i)},_refreshScrollers:function(){var e=this.clusterManager.isMulticlusterNavMode(),t=this.subViewHelper.get("time-selector-view");t&&t.updateSelectedTimeUI(),this.$(".events-list-container")[e?"hide":"show"](),this.$(".alerts-and-events-header").text("Alerts "+(e?"":" & Events")),this.$([".charts-list-inner",".charts-container-inner",".alerts-list-inner",".events-list-inner"].join(",")).each(function(e,t){var i=$(t);i.css({width:""}).height(i.closest(".scrollSizer").height())}),_.each(this.scrollers,function(e){e.refresh()})},_toggleChartList:function(){var e="No saved charts were found.";this.clusterManager.isMulticlusterNavMode()&&(e='No saved charts were found.<br>Please use the "New" button above to add a new chart.'),this.model.get("charts").length>0?(this.$(".selection-panel.charts-list").removeClass("hide"),this.$(".selection-panel.charts-restore-defaults").addClass("hide")):(this.$(".selection-panel.charts-list").addClass("hide"),this.$(".selection-panel.charts-restore-defaults .notification").html(e),this.$(".selection-panel.charts-restore-defaults").removeClass("hide"),this.clusterManager.isMulticlusterNavMode()&&this.$(".btnRestoreDefaultCharts").addClass("hide"))}})}),define("views/pages/analysis/AnalysisPageView",["jquery","views/basecomponents/pages/BasePageView","views/timeline/TimelineView","utils/AppConstants"],function(e,t,i,n){"use strict";return t.extend({pageId:n.PAGE_ANALYSIS,defaultSubPageId:n.SUBPAGE_TIMELINE,onShowSubPage:function(t,s){var a=this.getSubView(n.SUBPAGE_TIMELINE);a||(a=this.registerSubView(t,new i({el:this.getSubPageElement(n.SUBPAGE_TIMELINE),pageId:n.PAGE_ANALYSIS}))),e("body").addClass("n-app-noscroll"),a.show(s)},onHideSubPage:function(){e("body").removeClass("n-app-noscroll")}})}),define("text!templates/pages/planning/PlanningTemplate.html",[],function(){return'<div class="planning-view hide">\n  <div class="add-scenario-wrapper clearfix">\n    <button class="btn add-scenario pull-right -action">\n      <%= i18n(\'add_scenario\') %>\n    </button>\n  </div>\n  <div class="get-started-wrapper">\n    <div class="get-started-content">\n      <h1>\n        <%= i18n(\'welcome_capacity_planning\') %>\n      </h1>\n      <p>\n        <%= i18n(\'create_future_scenarios\') %>\n      </p>\n      <p>\n        <%= i18n(\'automatically_schedule_recommendations\') %>\n      </p>\n      <p class="license-violation-msg hide">\n        <%= i18n(\'license_violation_msg\') %>\n      </p>\n      <p class="feature-disabled-msg hide">\n        <%= i18n(\'xfit_feature_disabled_msg\') %>\n      </p>\n      <button class="btn btnOK add-scenario">\n        <%= i18n(\'get_started\') %>\n      </button>\n    </div>\n  </div>\n  <div class="scenario-table">\n  </div>\n</div>\n'}),define("views/planning/PlanningView",["views/basecomponents/BaseView","views/basecomponents/tableinput/TableInputView","views/popups/capacityplanning/CPWhatIfAnalysisPopupView","managers/ClusterManager","managers/PopupManager","utils/AppUtil","utils/AlertUtil","utils/TimeUtil","utils/SubViewHelper","data/DataProperties","utils/AppConstants","models/capacityplanning/CPScenarioModel","models/capacityplanning/CPScenarioQueryModel","text!templates/pages/planning/PlanningTemplate.html"],function(e,t,i,n,s,a,r,o,l,c,d,u,h,p){"use strict";var T={TABLE_VIEW:"tableView"};return e.extend({planningTemplate:_.template(p),name:"PlanningView",tableViewRendered:!1,events:{"click .action-links .edit":"editScenario","click .action-links .delete":"deleteScenario","click .add-scenario":"editScenario","click .table-data-items .scenario-name":"editScenario"},initialize:function(){e.prototype.initialize.apply(this,arguments),this.scenarioQueryModel=new h,this.scenarioModel=new u,this.subViewHelper=new l},render:function(){this.$el.empty(),this.tableViewRendered=!1,this.$el.html(this.planningTemplate(this.vtOptions()));var e=r.getXfitFeatureInfo();if(e.disabled)return this.$(".add-scenario").hide(),this.$(".planning-view").show(),void(e.licenseDisabled?this.$(".license-violation-msg").show():this.$(".feature-disabled-msg").show());this.subViewHelper.get(T.TABLE_VIEW)&&this.subViewHelper.get(T.TABLE_VIEW).destroy();var i=new t({idAttribute:this.scenarioModel.DP.ID,entityType:d.ENTITY_SCENARIO,filterAttributes:[this.scenarioModel.DP.NAME],disableInlineEdit:!0,ebTableStyle:!0,isActionEnabled:!0,isNewActionEnabled:!1,columns:this.getTableColumns()});this.subViewHelper.register(T.TABLE_VIEW,i),a.showLoader(),this.fetchScenario()},renderTable:function(){var e=this.subViewHelper.get(T.TABLE_VIEW);this.tableViewRendered?e.renderTable():(this.$el.find(".scenario-table").html(e.render().$el),this.tableViewRendered=!0)},getTableColumns:function(){var e=this,t=this.scenarioModel.DP;return[{columnName:this.i18n("scenario"),className:"scenario-name",renderer:function(e){return e[t.NAME]}},{columnName:this.i18n("last_cluster"),renderer:function(i){var s,a=n.getClusterModelByClusterUuid(i[t.CLUSTER_ID]);return a&&(s=a.get(c.NAME)),s||e.i18n("new_cluster")}},{columnName:this.i18n("workloads"),renderer:function(i){var n=[];return _.each(i[t.WORKLOAD],function(t){var i=e.scenarioModel.getWorkloadType(t);i&&n.push(i)}),n.length?_.uniq(n).join(", "):d.STATS_NOT_AVAILABLE}},{columnName:this.i18n("target_runway"),renderer:function(i){return i[t.TARGET_RUNWAY_DAYS]?i[t.TARGET_RUNWAY_DAYS]+" "+e.i18n("days"):""}},{columnName:this.i18n("last_saved"),renderer:function(e){return o.formatLongDate(1e3*e[c.UPDATED_TIME])}}]},deleteScenario:function(e){var t=this,i=$(e.currentTarget).closest("tr").data("id"),n=new u;n.id=i,n.destroy({error:function(e,i){t.showHeaderError(i.responseText)}})},editScenario:function(e){var t,n,a=this;r.getXfitFeatureInfo().disabled||($(e.currentTarget).hasClass("add-scenario")?n=!0:t=$(e.currentTarget).closest("tr").data("id"),s.renderPopupView(i,{scenarioId:t,newScenario:n,onCloseCallback:function(){a.fetchScenario()}}).startServices())},fetchScenario:function(){var e=this;this.scenarioModel.DP;this.scenarioQueryModel.save(null,{success:function(){var t=e.scenarioQueryModel.getScenarioList(),i=e.subViewHelper.get(T.TABLE_VIEW);t&&t.length&&(e.$(".get-started-wrapper").hide(),i.dataItems=t,e.renderTable()),e.$(".planning-view").show()},error:function(t,i){e.showHeaderError(i.responseText)}})},destroy:function(){e.prototype.destroy.apply(this,arguments)}})}),define("views/planning/PlanningSummaryView",["views/basecomponents/datatables/BaseTableView","views/basecomponents/datatables/DataTableTemplates","data/DataProperties","managers/NavigationManager","models/query/QueryResultCollection","models/capacityplanning/CPQueryModel","utils/AppConstants","utils/AppUtil"],function(e,t,i,n,s,a,r,o){"use strict";return e.extend({name:"PlanningSummaryView",isSelectionEnabled:!1,dataTableSettings:{sDOM:"rt",bProcessing:!0,bLengthChange:!1,bPaginate:!1,bFilter:!0,bInfo:!1,bScrollCollapse:!0,bAutoWidth:!1,bJQueryUI:!1},initialize:function(t){this.parentView=t.parentView,this.attrObj={entity_type:r.ENTITY_CLUSTER,group_member_attributes:[i.CL_NAME,i.CPU_RUNWAY_INFO,i.MEMORY_RUNWAY_INFO,i.CLUSTER_RUNWAY_INFO,i.STORAGE_RUNWAY_INFO]},this.addCustomDataModelSort(),e.prototype.initialize.apply(this,arguments)},initializeTableModel:function(e){this.model=new s,this.model.setQueryModel(new a(this.attrObj)),this.defaultMinRows=5},getNumericRunwayValue:function(e){var t=e&&e.replace(/[^\d]/g,"");return Number(t)},addCustomDataModelSort:function(){var e=this;jQuery.fn.dataTableExt.oSort["runway-desc"]=function(t,i){return t=e.getNumericRunwayValue(t),i=e.getNumericRunwayValue(i),t<i?1:t>i?-1:0},jQuery.fn.dataTableExt.oSort["runway-asc"]=function(t,i){return t=e.getNumericRunwayValue(t),i=e.getNumericRunwayValue(i),t<i?-1:t>i?1:0}},render:function(){this.$el.empty(),this.$el.append(t.LOADING).append(t.DATATABLE),this._renderDataTable(),this.renderSubviews()},getDefaultColumns:function(e,t){var n=function(e,t){var i;try{i=JSON.parse(e[t])}catch(e){o.log("RunwayInfoQueryModel: Failed to parse runway info: "+t)}return i?o.processRunwayNumber(i.runway):r.STATS_NOT_AVAILABLE};return[{sTitle:this.i18n("name"),mData:i.CL_NAME,sWidth:"30%",mRender:function(e,t,i){return e}},{sTitle:this.i18n("overall_runway"),mData:function(e,t,s){return n(e,i.CLUSTER_RUNWAY_INFO)},sType:"runway",sClass:"right",sWidth:"30%"},{sTitle:this.i18n("cpu_runway"),mData:function(e,t,s){return n(e,i.CPU_RUNWAY_INFO)},sType:"runway",sClass:"right",sWidth:"30%"},{sTitle:this.i18n("memory_runway"),mData:function(e,t,s){return n(e,i.MEMORY_RUNWAY_INFO)},sType:"runway",sClass:"right",sWidth:"30%"},{sTitle:this.i18n("storage_runway"),mData:function(e,t,s){return n(e,i.STORAGE_RUNWAY_INFO)},sType:"runway",sClass:"right",sWidth:"30%"}]},onClickDataRow:function(e){var t=$(e.currentTarget);t&&t.attr(r.NAV_ACTION_TARGET_ID)&&n.navigateToFullScreenDetailsPane(r.ENTITY_CLUSTER,t.attr(r.NAV_ACTION_TARGET_ID),null,"CAPACITY")}})}),define("views/pages/planning/PlanningPageView",["views/basecomponents/pages/BasePageView","views/planning/PlanningView","views/planning/PlanningSummaryView","utils/AppConstants","utils/AlertUtil"],function(e,t,i,n,s){"use strict";return e.extend({name:"PlanningPageView",pageId:n.PAGE_PLANNING,defaultSubPageId:n.SUBPAGE_SCENARIO,onShowSubPage:function(e,t){s.getXfitFeatureInfo().disabled&&$(".page-planning .n-page-nav").hide();var i=this.getSubView(e);i||(i=this.registerSubView(e,this._createSubPageView(e,t))),i.render(t),i.onStartServices()},_createSubPageView:function(e,s){switch(e){case n.SUBPAGE_RUNWAY:return new i({el:this.$(".n-page-master"),entityType:n.ENTITY_CLUSTER,ebTableStyle:!0,pageId:n.PAGE_PLANNING});default:return new t({el:this.$(".n-page-master"),pageId:n.PAGE_PLANNING})}}})}),define("models/cluster/GroupModel",["models/BaseModel","data/DataProperties","utils/AppConstants","utils/AppUtil"],function(e,t,i,n){"use strict";return e.extend({idAttribute:t.ID,nameAttribute:t.NAME,name:"GroupModel",defaults:{id:null,name:null,entities:[],allEntities:[],healthStats:{},description:""},destroy:function(){},getDisplayName:function(){var e=this.get(this.nameAttribute);return e===i.UNKNOWN_VALUE?"None":e},getMemberCount:function(){return this.get("entities").length},getMembers:function(){return this.get("entities")},getMemberById:function(e){var t=this.getMembers();return _.find(t,function(t){return t.get(t.idAttribute)===e})},getMembersWithAssignedHealthStatus:function(){var e=this.getMembers();return _.filter(e,function(e){var i=e.getValue(t.HEALTH_STATUS);return i&&i!==t.HEALTH_STATUS_VALUES.UNKNOWN})},getHealthStats:function(){return this.get("healthStats")},setMembers:function(e){var t=this._healthStats(e);this.set({allEntities:e,allHealthStats:t,entities:[].concat(e),healthStats:t},{silent:!0})},filterMembers:function(e){var t=this.get("allEntities");if(_.isEmpty(e))return void this.set({entities:[].concat(t),healthStats:this.get("allHealthStats")});var i=[],n=_.keys(e);_.each(t,function(t){for(var s=!0,a=0;a<n.length;a++){for(var r=n[a],o=e[r],l=!1,c=0;c<o.length;c++)if(o[c].matchTest(t)){l=!0;break}l||(s=!1)}s&&i.push(t)});var s=this._healthStats(i);this.set({entities:i,healthStats:s})},getMembersByHealth:function(e){return _.filter(this.getMembers(),function(i){return i.getValue(t.HEALTH_STATUS)===e})},toJSON:function(){var t=e.prototype.toJSON.apply(this,arguments);return t.displayName=this.getDisplayName(),t},_healthStats:function(e){var s={};return _.each(_.keys(i.HEALTH_STATUS),function(e){s[i.HEALTH_STATUS[e]]=0}),_.each(e,function(e){var i=e.getValue(t.HEALTH_STATUS);i?s[i]+=1:n.debug("GroupModel : _healthStatus","| Health information not available for entity.","| entityId:",e.get(e.idAttribute))}),s}})}),define("models/cluster/GroupByModel",["models/BaseModel","data/DataProperties","models/cluster/GroupModel","utils/SubModelHelper","utils/AppConstants","utils/AppUtil"],function(e,t,i,n,s,a){"use strict";return e.extend({idAttribute:t.ID,nameAttribute:t.NAME,name:"GroupByModel",subModelHelper:null,defaults:{id:null,name:null,attr:null,ranges:[],description:""},initialize:function(){a.debug("GroupByModel : initialize: "," | modelId     : "+this.cid),this.subModelHelper=new n},groupEntities:function(e){this.subModelHelper.getIds().length&&this.subModelHelper.removeAll();var t=this.get("attr"),n=this.get("ranges"),r=this.get("fixedValues"),o="",l=this,c=_.groupBy(e,function(e){(o=e.entityType)===s.ENTITY_CLUSTER&&l._syncClusterEntityHealthStats(e);var i=e.getValue(t),a=i||s.UNKNOWN_VALUE;if(n&&n.length)for(var r=0;r<n.length;r++){var c=n[r],d=c.start||Number.MIN_VALUE,u=c.end||Number.MAX_VALUE;if(i>d&&i<=u){a=c.name;break}}return a},this),d=_.keys(c);_.each(r,function(e){
d.indexOf(e)<0&&(c[e]=[])}),_.each(n,function(e){d.indexOf(e.name)<0&&(c[e.name]=[])});var u=_.template(this.get("description"));_.each(c,function(e,t){var l=this._groupId(t),c=_.find(n,function(e){return e.name===t}),d=c?c.idx:null,h=r.indexOf(t);h>=0&&(d=h);var p;p=t===s.UNKNOWN_VALUE?a.getPluralEntityName(o)+" with no group assignment.":u({groupName:t});var T=new i({id:l,name:t,groupIdx:d,description:p});T.setMembers(e),this.subModelHelper.register(l,T)},this)},getNumberOfGroups:function(){return this.subModelHelper.getIds().length},getGroups:function(){return this._getGroups(!1)},getWorstGroups:function(){return this._getGroups(!0)},_getGroups:function(e){var t=[];return _.each(this.subModelHelper.getIds(),function(e){t.push(this.subModelHelper.get(e))},this),_.sortBy(t,function(t){var i=t.get("name"),n=t.get("groupIdx");if(!e&&i===s.UNKNOWN_VALUE)return 999999;if(e){var r=t.get("healthStats");if(r){return-a.calculateHealthScore(r)}}return n||0},this)},getGroupById:function(e){return this.subModelHelper.get(e)},_groupId:function(e){return this.get("id")+"-"+e},_syncClusterEntityHealthStats:function(e){var i=e.get(t.HEALTH_SUMMARY),n=_.find(i[t.HEALTH_ENTITY_TYPE_SUMMARIES],function(e){return e.entityType.toLowerCase()===s.ENTITY_CLUSTER});if(n){var a=i.healthStatus;_.each(n[t.HEALTH_SUMMARY],function(e,t){0!==e&&(a=t)}),i.healthStatus=a}}})}),define("text!extras/groupbys.json",[],function(){return'{\n  "vm" : [\n    { "id": "host", "name": "host", "attr": "hostName",\n      "ranges": [], "fixedValues" : [],\n      "description": "VMs hosted on <%= groupName %>."\n    },\n\n    { "id": "os", "name": "os", "attr": "guestOperatingSystem",\n      "ranges": [], "fixedValues" : [],\n      "description": "VMs running <%= groupName %>."\n    },\n\n    { "id": "memory", "name": "memory", "attr": "memoryCapacityInBytes",\n        "ranges": [\n          { "idx": 1, "name": "0-2 GiB",\n            "start": null,        "end": 2147483648 },\n          { "idx": 2, "name": "2-4 GiB",\n            "start": 2147483648,  "end": 4294967296 },\n          { "idx": 3, "name": "4-8 GiB",\n            "start": 4294967296,  "end": 8589934592 },\n          { "idx": 4, "name": "8-16 GiB",\n            "start": 8589934592,  "end": 17179869184 },\n          { "idx": 5, "name": "> 16 GiB",\n            "start": 17179869184, "end": null }\n        ], "fixedValues" : []  ,\n        "description":\n          "VMs with a memory capacity of <%= groupName %>."\n    },\n\n    { "id": "reservedMemory", "name": "reserved_memory",\n      "attr": "memoryReservedCapacityInBytes",\n      "ranges": [\n        { "idx": 1, "name": "0-2 GiB",\n          "start": -1,        "end": 2147483648 },\n        { "idx": 2, "name": "2-4 GiB",\n          "start": 2147483648,  "end": 4294967296 },\n        { "idx": 3, "name": "4-8 GiB",\n          "start": 4294967296,  "end": 8589934592 },\n        { "idx": 4, "name": "8-16 GiB",\n          "start": 8589934592,  "end": 17179869184 },\n        { "idx": 5, "name": "> 16 GiB",\n          "start": 17179869184, "end": null }\n      ], "fixedValues" : [],\n      "description":\n        "VMs with a reserved memory of <%= groupName %>."\n    },\n\n    { "id": "diskCapacity", "name": "disk_capacity",\n      "attr": "diskCapacityInBytes",\n      "ranges": [\n        { "idx": 1, "name": "0-10 GB",\n          "start": -1,         "end": 10000000000 },\n        { "idx": 2, "name": "10-20 GB",\n          "start": 10000000000,  "end": 20000000000 },\n        { "idx": 3, "name": "20-50 GB",\n          "start": 20000000000,  "end": 50000000000 },\n        { "idx": 4, "name": "50-100 GB",\n          "start": 50000000000,  "end": 100000000000 },\n        { "idx": 5, "name": "> 100 GB",\n          "start": 100000000000, "end": null }\n      ], "fixedValues" : [],\n      "description":\n        "VMs with a disk capacity of <%= groupName %>."\n    },\n\n    { "id": "protectionDomainName", "name": "protection_domain_name",\n      "attr": "protectionDomainName", "ranges": [], "fixedValues" : [],\n      "description":\n        "VMs within protection domain <%= groupName %>."\n    },\n\n    { "id": "consistencyGroupName", "name": "consistency_group_name",\n      "attr": "consistencyGroupName", "ranges": [], "fixedValues" : [],\n      "description":\n        "VMs within consistency group <%= groupName %>."\n    },\n\n    { "id": "health", "name": "health",\n      "attr": "healthSummary.healthStatus",\n      "ranges": [],\n      "fixedValues": ["Critical", "Warning", "Good"],\n      "description":\n        "VMs with a health status of <%= groupName %>."\n    }\n  ],\n\n  "host" : [\n    { "id": "model", "name": "model", "attr": "blockModel",\n      "ranges": [], "fixedValues" : [],\n      "description": "<%= groupName %> hosts."\n    },\n\n    { "id": "nbVMs", "name": "nb_vms", "attr": "numVMs",\n      "ranges": [\n        { "idx": 1, "name": "< 50 VMs", "start": null,   "end": 50 },\n        { "idx": 2, "name": "50-100 VMs", "start": 50,   "end": 100 },\n        { "idx": 3, "name": "100-150 VMs", "start": 100, "end": 150 },\n        { "idx": 4, "name": "> 150 VMs","start": 150,    "end": null }\n      ], "fixedValues" : [],\n      "description": "Hosts with <%= groupName %>."\n    },\n\n    { "id": "cpuCapacity", "name": "cpu_capacity", "attr": "cpuFrequencyInGz",\n      "ranges": [\n        { "idx": 1, "name": "< 20 GHz",  "start": null, "end": 20 },\n        { "idx": 2, "name": "20-30 GHz", "start": 20,"end": 30 },\n        { "idx": 3, "name": "30-40 GHz", "start": 30,"end": 40 },\n        { "idx": 4, "name": "40-50 GHz", "start": 40,"end": 50 },\n        { "idx": 5, "name": "> 50 GHz", "start":  50,  "end": null }\n      ], "fixedValues" : [],\n      "description":\n        "Hosts with a CPU capacity of <%= groupName %>."\n    },\n\n    { "id": "memoryCapacity", "name": "memory_capacity",\n      "attr": "memoryCapacityInBytes",\n      "ranges": [\n        { "idx": 1, "name": "< 100 GiB",\n          "start": null,         "end": 107374182400 },\n        { "idx": 2, "name": "100-150 GiB",\n          "start": 107374182400,  "end": 161061273600 },\n        { "idx": 3, "name": "> 150 GiB",\n          "start": 161061273600, "end": null }\n      ], "fixedValues" : [],\n      "description":\n        "Hosts with memory capacity of <%= groupName %>."\n    },\n\n    { "id": "storageCapacity", "name": "storage_capacity",\n      "attr": "totalCapacity",\n      "ranges": [\n        { "idx": 1, "name": "< 500 GB",\n          "start": null,         "end": 500000000000 },\n        { "idx": 2, "name": "500 GB - 1 TB",\n          "start": 500000000000,  "end": 1000000000000 },\n        { "idx": 3, "name": "1 TB - 1.5 TB",\n          "start": 1000000000000,  "end": 1500000000000 },\n        { "idx": 4, "name": "> 1.5 TB",\n          "start": 1500000000000, "end": null }\n      ], "fixedValues" : [],\n      "description":\n        "Hosts with storage capacity of <%= groupName %>."\n    },\n\n    { "id": "health", "name": "health",\n      "attr": "healthSummary.healthStatus",\n      "ranges": [],\n      "fixedValues": ["Critical", "Warning", "Good"],\n      "description":\n        "Hosts with a health status of <%= groupName%>."\n    }\n  ],\n\n  "disk" : [\n    { "id": "storageTierName", "name": "storage_tier_name",\n      "attr": "storageTierName", "ranges": [], "fixedValues" : [],\n      "description" :\n        "Disks within the <%= groupName %> storage tier."\n    },\n\n    { "id": "diskUsage", "name": "disk_usage",\n      "attr": "totalUsedPercentageRaw",\n      "ranges": [\n        { "idx": 1, "name": "< 25%",\n          "start": -0.001, "end": 0.25 },\n        { "idx": 2, "name": "25 - 40%",\n          "start": 0.25,  "end": 0.40 },\n        { "idx": 3, "name": "40 - 75%",\n          "start": 0.40,  "end": 0.75 },\n        { "idx": 3, "name": "75 - 90%",\n          "start": 0.75,  "end": 0.90 },\n        { "idx": 4, "name": "> 90%",\n          "start": 0.90,  "end": null }\n      ], "fixedValues" : [],\n      "description":\n        "Disks with a usage of <%= groupName %>."\n    },\n\n    { "id": "diskCapacity", "name": "disk_capacity",\n      "attr": "totalCapacity",\n      "ranges": [\n        { "idx": 1, "name": "< 500 GB",\n          "start": null,         "end": 500000000000 },\n        { "idx": 2, "name": "500 GB - 1 TB",\n          "start": 500000000000,  "end": 1000000000000 },\n        { "idx": 3, "name": "1 TB - 1.5 TB",\n          "start": 1000000000000,  "end": 1500000000000 },\n        { "idx": 4, "name": "> 1.5 TB",\n          "start": 1500000000000, "end": null }\n      ], "fixedValues" : [],\n      "description":\n        "Disks with a capacity of <%= groupName %>."\n    },\n\n    { "id": "health", "name": "health",\n      "attr": "healthSummary.healthStatus",\n      "ranges": [],\n      "fixedValues" : ["Critical", "Warning", "Good"],\n      "description":\n        "Disks with a health status of <%= groupName %>."\n    }\n  ],\n\n  "protection_domain" : [\n    { "id": "nbPDVMs", "name": "nb_pd_vms", "attr": "numVMs",\n      "ranges": [\n        { "idx": 1, "name": "< 50 VMs", "start": null,   "end": 50 },\n        { "idx": 2, "name": "50-100 VMs", "start": 50,   "end": 100 },\n        { "idx": 3, "name": "100-150 VMs", "start": 100, "end": 150 },\n        { "idx": 4, "name": "> 150 VMs","start": 150,    "end": null }\n      ], "fixedValues" : [],\n      "description": "Protection Domains with <%= groupName %>."\n    },\n\n    { "id": "spaceUsed", "name": "space_used",\n      "attr": "totalUserWrittenBytes",\n      "ranges": [\n        { "idx": 1, "name": "< 500 GB",\n          "start": null,         "end": 500000000000 },\n        { "idx": 2, "name": "500 GB - 1 TB",\n          "start": 500000000000,  "end": 1000000000000 },\n        { "idx": 3, "name": "1 TB - 1.5 TB",\n          "start": 1000000000000,  "end": 1500000000000 },\n        { "idx": 4, "name": "> 1.5 TB",\n          "start": 1500000000000, "end": null }\n      ], "fixedValues" : [],\n      "description":\n        "Protection Domains with <%= groupName %> changed bytes."\n    },\n\n\n    { "id": "health", "name": "health",\n      "attr": "healthSummary.healthStatus",\n      "ranges": [],\n      "fixedValues" : ["Critical", "Warning", "Good"],\n      "description":\n        "Protection Domains with a health status of <%= groupName %>."\n    }\n  ],\n\n  "remote_site" : [\n    { "id": "health", "name": "health",\n      "attr": "healthSummary.healthStatus",\n      "ranges": [],\n      "fixedValues" : ["Critical", "Warning", "Good"],\n      "description":\n      "Remote Sites with a health status of <%= groupName %>."\n    }\n  ],\n\n  "cluster" : [\n    { "id": "health", "name": "health",\n      "attr": "healthSummary.healthStatus",\n      "ranges": [],\n      "fixedValues" : ["Critical", "Warning", "Good"],\n      "description":\n      "Clusters with a health status of <%= groupName %>."\n    }\n  ],\n\n  "storage_pool" : [\n    { "id": "health", "name": "health",\n      "attr": "healthSummary.healthStatus",\n      "ranges": [],\n      "fixedValues" : ["Critical", "Warning", "Good"],\n      "description":\n      "Storage pools with a health status of <%= groupName %>."\n    }\n  ],\n\n  "container" : [\n    { "id": "health", "name": "health",\n      "attr": "healthSummary.healthStatus",\n      "ranges": [],\n      "fixedValues" : ["Critical", "Warning", "Good"],\n      "description":\n      "Storage containers with a health status of <%= groupName %>."\n    }\n  ]\n}\n'}),define("models/cluster/EntityTypeGroupingModel",["models/BaseModel","models/cluster/GroupByModel","utils/SubModelHelper","utils/AppConstants","utils/AppUtil","text!extras/groupbys.json"],function(e,t,i,n,s,a){"use strict";return e.extend({name:"EntityTypeGroupingModel",defaults:{entityTypeToGroupByMap:null},initialize:function(){this.initializeBaseModel(),this.subModelHelper=new i},fetch:function(){try{var e=JSON.parse(a);this.set("entityTypeToGroupByMap",e,{silent:!0}),this.initializeGroupBys(),this.stateMonitor.setState(n.STATE_SUCCESS)}catch(e){s.log("EntityTypeGroupingModel : ","Error loading groupby definitions. ",e),this.stateMonitor.setState(n.STATE_ERROR)}},getEntityTypeGroupBys:function(e){var t=this.subModelHelper.getIds(),i=[];return _.each(t,function(t){0===t.indexOf(e)&&i.push(this.subModelHelper.get(t))},this),i},getEntityTypes:function(){return this.get("entityTypeToGroupByMap")?_.keys(this.get("entityTypeToGroupByMap")):[]},initializeGroupBys:function(){_.each(this.getEntityTypes(),function(e){var i=this.get("entityTypeToGroupByMap")[e];_.each(i,function(i){var n=new t(i),s=e+"-"+i.id;this.subModelHelper.register(s,n)},this)},this)}})}),define("models/cluster/GroupMembersCollection",["models/BaseCollection","utils/AppConstants"],function(e,t){"use strict";return e.extend({name:"GroupMembersCollection",sortBy:null,allModels:null,initialize:function(e,t){this.initializeBaseCollection(e,t),this._parameters={},this.allModels=[],e&&(this.allModels=this.allModels.concat(e))},setSortby:function(e){this.sortBy=e,this.sort({silent:!0})},comparator:function(e,i){if(!this.sortBy)return 0;var n=e.getSortValue(this.sortBy[0]),s=i.getSortValue(this.sortBy[0]),a=0;return n!==s&&(n>s||void 0===n?a=1:(n<s||void 0===s)&&(a=-1)),this.sortBy[1]===t.SORT_ASC&&(a*=-1),a}})}),define("models/cluster/TestModel",["models/BaseModel","data/DataURLConstants","data/DataProperties","utils/AppConstants","utils/AppUtil"],function(e,t,i,n,s){"use strict";var a={PARAM_NAME:"parameterName",PARAMETERS:"parameters",ALERT_CONFIGURABLE_PARAMETERS:"alertConfigurableParameters",ENABLED:"enabled",SEVERITY:"severity",SEVERITY_THRESHOLD_INFOS:"severityThresholdInfos",SCHEDULED:"scheduled",NOT_SCHEDULED:"not_scheduled",EVENT_DRIVEN:"event_driven",PARAM_VALUES:["parameterStringValue","parameterBooleanValue","parameterLongValue"],PARAM_DEFAULT_VALUES:["parameterDefaultStringValue","parameterDefaultBooleanValue","parameterDefaultLongValue"]};return e.extend({DP:a,urlRoot:t.HEALTH_CHECKS,idAttribute:i.ID,nameAttribute:i.NAME,name:"TestModel",UNKNOWN_CATEGORY:"Other Checks",SCHEDULE_OPTIONS:[{name:"Every Minute",value:60},{name:"Every 5 Minutes",value:300},{name:"Every 10 Minutes",value:600},{name:"Every 15 Minutes",value:900},{name:"Every 30 Minutes",value:1800},{name:"Every Hour",value:3600},{name:"Every 2 Hours",value:7200},{name:"Every 8 Hours",value:28800},{name:"Every 12 Hours",value:43200},{name:"Every Day",value:86400},{name:"Every 2 Days",value:172800},{name:"Every 3 Days",value:259200}],defaults:{id:null,name:null,categoryTypes:[],subCategoryTypes:[],description:null,enabled:!1,parameters:{},metrics:[],causes:[],resolutions:[],impacts:[],modifiedTimeStampInUsecs:0,modifiedByUsername:null,scope:null,scheduleIntervalInSecs:null},isFailing:function(e){return e===n.HEALTH_STATUS.CRITICAL},isGood:function(e){return e===n.HEALTH_STATUS.GOOD},isWarning:function(e){return e===n.HEALTH_STATUS.WARNING},isError:function(e){return e===n.HEALTH_STATUS.ERROR},isEnabled:function(){return this.get(a.ENABLED)},isScheduled:function(){return this.getCheckType()===a.SCHEDULED},isNotScheduled:function(){return this.getCheckType()===a.NOT_SCHEDULED},isEventTriggered:function(){return this.getCheckType()===a.EVENT_DRIVEN},getCheckType:function(){return this.get("checkType")},getHealthSummaryId:function(){return s.getDisplayableId(this.get(this.idAttribute))},getTestCategory:function(){var e=this.get("subCategoryTypes");return e&&e.length?e[0].replace(/-/g," | "):this.UNKNOWN_CATEGORY},getScheduleName:function(){var e=this.get("scheduleIntervalInSecs");if(!e||e<0)return null;var t=_.find(this.SCHEDULE_OPTIONS,function(t){return t.value===e});if(t)return t.name;var i=s.generateDisplayableTimeValue(e*n.MICROS_PER_SECOND);return"Every "+i.value+" "+i.units},affectsEntity:function(e){var t=this.getHealthSummaryId(),n=e.getValue(i.HEALTH_CHECK_SUMMARIES);if(n){return _.keys(n).indexOf(t)>=0}return!1},getTestStatusForEntity:function(e){var t=this.getHealthSummaryId(),n=e.getValue(i.HEALTH_CHECK_SUMMARIES);return n&&n[t]?n[t].healthStatus:null},getDisplayName:function(){return this.get(this.nameAttribute)},getSchedules:function(){return"vDisk Count Check"===this.getDisplayName()?this.SCHEDULE_OPTIONS.slice(2):this.SCHEDULE_OPTIONS},toDisplayJSON:function(){var e=this.toJSON();e.description=this.formatText(e.description);for(var t=0;t<e.causes.length;t++)e.causes[t]=this.formatText(e.causes[t]);for(var i=0;i<e.resolutions.length;i++)e.resolutions[i]=this.formatText(e.resolutions[i]);if(e.impacts)for(var n=0;n<e.impacts.length;n++)e.impacts[n]=this.formatText(e.impacts[n]);return e},formatText:function(e){var t=this.get(a.ALERT_CONFIGURABLE_PARAMETERS);return t&&t.length?this.formatConfigurableParameterText(e):this.formatParameterText(e)},formatParameterText:function(e){var t=this.get(a.PARAMETERS),i=e;return i&&i.length&&_.each(t,function(e,t){var n=e?e.value:null;null!==n&&(i=i.replace("{"+t+"}",n))}),i},formatConfigurableParameterText:function(e){var t=e,i=this.get(a.ALERT_CONFIGURABLE_PARAMETERS);if(i&&i.length){i.sort(function(e,t){var i=n.ALERT_SEVERITY_HIERARCHY[e.severity];return n.ALERT_SEVERITY_HIERARCHY[t.severity]-i});var s=this.get(a.SEVERITY_THRESHOLD_INFOS),r=_.find(i,function(e){var t=_.find(s,function(t){return t[a.SEVERITY]===e[a.SEVERITY]});return!!t&&t[a.ENABLED]});if(t&&t.length&&null!==r){var o=r[a.PARAM_NAME],l=this.getParameterValue(r);null!==l&&(t=t.replace("{"+o+"}",l))}}return t},getParameterValue:function(e){var t=_.find(a.PARAM_VALUES,function(t){return null!==e[t]}),i=t?e[t]:null;if(i)return i;var n=_.find(a.PARAM_DEFAULT_VALUES,function(t){return null!==e[t]});return n?e[n]:null}})}),define("models/cluster/TestsCollection",["models/BaseCollection","models/cluster/TestModel","data/DataURLConstants"],function(e,t,i){"use strict";return e.extend({model:t,url:i.HEALTH_CHECKS,name:"TestsCollection",searchRegex:null,setSearchTerm:function(e){this.searchTerm=e,this.searchRegex=e?new RegExp(e,"i"):null},getSearchTerm:function(){return this.searchTerm},testsForDisplay:function(){return _.filter(this.models,function(e){return!(this.searchRegex&&!this.searchRegex.test(e.getDisplayName()))},this)}})}),define("models/cluster/ClusterHealthModel",["models/BaseModel","data/DataProperties","models/cluster/ClusterHealthStatsModel","models/cluster/EntityTypeGroupingModel","models/vm/VMCollection","models/hardware/DiskCollection","models/hardware/HostCollection","models/storage/StoragePoolCollection","models/storage/ContainerCollection","models/cluster/ClusterCollection","models/dataprotection/ProtectionDomainCollection","models/dataprotection/RemoteSiteCollection","models/cluster/GroupModel","models/cluster/GroupMembersCollection","models/cluster/FiltersCollection","models/cluster/TestsCollection","utils/SubModelHelper","utils/AppConstants","utils/AppUtil"],function(e,t,i,n,s,a,r,o,l,c,d,u,h,p,T,E,g,S,m){"use strict";var v={ERROR_MESSAGE:"errorMessage"};return e.extend({DP:v,name:"ClusterHealthModel",subModelHelper:null,initialFetchRequested:!1,VIEW_RENDER_TYPE_GRID:"grid",VIEW_RENDER_TYPE_TABLE:"tbl",ENTITY_TYPES:[S.ENTITY_VM,S.ENTITY_HOST,S.ENTITY_DISK,S.ENTITY_STORAGE_POOL,S.ENTITY_CONTAINER,S.ENTITY_PROTECTION_DOMAIN,S.ENTITY_REMOTE_SITE,S.ENTITY_CLUSTER],TESTS_TRIGGERED_TYPE:{SCHEDULED:"scheduled",NOT_SCHEDULED:"not scheduled",EVENT_TRIGGERED:"event triggered"},TESTS_VIEW_TYPE:{ALL_TESTS:"all",PASSING_TESTS:"passed",WARNING_TESTS:"warning",FAILED_TESTS:"failed",DISABLED_TESTS:"off",ERROR_TESTS:"error"},ALL_ENTITIES:"all",DEFAULT_SORT_DIRECTION:S.SORT_ASC,NO_FILTERS_COUNT:-1,isLoading:!1,defaults:{selectedEntityType:null,selectedGroupBy:null,selectedGroup:null,monitoredEntityType:null,previousGroupBys:null,previousGroups:null,selectedEntities:null,selectedTest:null,selectedTestsSubPage:null,viewRenderType:null,testsViewType:null,testsTriggeredType:null,sortByMap:{},filteredEntityCounts:{},errorMessage:null,selectedEntityTypeTrigger:!1,selectedGroupByTrigger:!1,selectedGroupTrigger:!1,selectedEntitiesTrigger:!1,testsChangeTrigger:!1,selectedTestTrigger:!1,viewRenderTypeTrigger:!1,testsViewTypeTrigger:!1,testsTriggeredTypeTrigger:!1,errorMessageTrigger:!1,entityTypeGroupingTrigger:!1,clusterHealthStatsTrigger:!1,filtersChangeTrigger:!1,filtersLoadedTrigger:!1,refreshDataTrigger:!1},getEntityTypes:function(){var e=[];return _.each(this.ENTITY_TYPES,function(t){var i=this.subModelHelper.get(t+"-collection");i&&i.length&&e.push(t)},this),e},getEntitiesByType:function(e){return this.subModelHelper.get(e+"-collection")},getEntityTypeName:function(e,t){return e===S.ENTITY_CLUSTER?t?"Cluster Service":"Cluster Services":m.getEntityNameFromCount(e,t?1:2)},getShortPluralEntityName:function(e){return e===S.ENTITY_CLUSTER?"Services":m.getShortPluralEntityName(e)},getEntity:function(e,t){return e?this.subModelHelper.get(e+"-collection").findModelById(t):null},getFilteredEntityCount:function(e){var t=this.get("filteredEntityCounts")[e];return void 0===t?this.NO_FILTERS_COUNT:t},getTotalEntityCount:function(e){var t=this.getHealthStatsByEntityType(e);return _.reduce(t,function(e,t){return e+=t},0)},getHealthStatsByEntityType:function(e){return this.subModelHelper.get("clusterHealthStats").getHealthStats(e)},getHealthStatsState:function(){return this.subModelHelper.get("clusterHealthStats")?this.subModelHelper.get("clusterHealthStats").getState():S.STATE_PENDING},setSortby:function(e){var t=this.getSelectedEntityType();this.get("sortByMap")[t]=e},getSortby:function(){var e=this.getSelectedEntityType();return this.get("sortByMap")[e]||(this.get("sortByMap")[e]=[t.HEALTH_STATUS,this.DEFAULT_SORT_DIRECTION]),this.get("sortByMap")[e]},setSelectedEntityType:function(e,t,i){m.debug("ClusterHealthModel : setSelectedEntityType: "," | eType     : ",e),this.set({selectedEntityType:e}),i||this._triggerChangeEvent("selectedEntityType"),this.monitorHealthChanges()},getSelectedEntityType:function(){return this.get("selectedEntityType")},setSelectedGroupBy:function(e){m.debug("ClusterHealthModel : setSelectedGroupBy: "," | groupById     : ",e);var t=this.getSelectedEntityType();this.get("previousGroupBys")[t]=e,this.set({selectedGroupBy:e}),this._triggerChangeEvent("selectedGroupBy")},getSelectedGroupBy:function(){return this.get("selectedGroupBy")},setSelectedGroup:function(e){m.debug("ClusterHealthModel : setSelectedGroup: "," | groupId     : ",e);var t=this.getSelectedEntityType();this.get("previousGroups")[t]=e,this.set({selectedGroup:e}),this._triggerChangeEvent("selectedGroup")},getSelectedGroup:function(){return this.get("selectedGroup")},getGroupBy:function(e,t){if(this.getEntityTypeGroupingsState()!==S.STATE_SUCCESS)return null;var i=this.getEntityTypeGroupBys(e);return _.find(i,function(e){return e.id===t})},getCurrentGroupBy:function(){return this.getGroupBy(this.getSelectedEntityType(),this.getSelectedGroupBy())},getPreviousGroupBy:function(e){return this.get("previousGroupBys")[e]},clearPreviousGroupBy:function(e){this.get("previousGroupBys")[e]=null},getGroup:function(e,t,i){var n=this.getGroupBy(e,t);return n?n.getGroupById(i):null},getCurrentGroup:function(){var e=this.getSelectedEntityType();if(!e)return null;var t=this.getSelectedGroupBy();if(!t)return null;var i=this.getSelectedGroup();return i?this.getGroup(e,t,i):null},getEntityTypeGroupingsState:function(){return this.subModelHelper.get("entityTypeGroupingModel").getState()},getEntityTypeGroupBys:function(e){var t=this.subModelHelper.get("entityTypeGroupingModel");return _.filter(t.getEntityTypeGroupBys(e),function(e){return e.getNumberOfGroups()>1})},setViewRenderType:function(e){this.set("viewRenderType",e),this._triggerChangeEvent("viewRenderType")},getViewRenderType:function(){return this.get("viewRenderType")},_onClusterHealthStateChange:function(){this.subModelHelper.get("clusterHealthStats").getState()===S.STATE_ERROR?this._setError("Error fetching overall cluster health data."):this._triggerChangeEvent("clusterHealthStats")},_onEntityTypeGroupingStateChange:function(){this.subModelHelper.get("entityTypeGroupingModel").getState()===S.STATE_ERROR?this._setError("Error fetching grouping definitions."):this._triggerChangeEvent("entityTypeGrouping")},fetchData:function(){this.initialFetchRequested||(this.initialFetchRequested=!0,this.refreshData(!0))},resetModel:function(){this.set({selectedEntityType:null,selectedGroupBy:null,selectedGroup:null,selectedTest:null,viewRenderType:this.VIEW_RENDER_TYPE_GRID,testsViewType:this.TESTS_VIEW_TYPE.ALL_TESTS,testsTriggeredType:null,selectedEntities:{},previousGroupBys:{},previousGroups:{}}),this.stopMonitoringHealthChanges()},refreshData:function(e){e&&(this.isLoading=!0);var t=[];t.push(this.subModelHelper.get("clusterHealthStats").fetch()),this.subModelHelper.get("entityTypeGroupingModel").fetch(),this.subModelHelper.get("filtersCollection").fetch(),t.push(this.subModelHelper.get("testsCollection").fetch()),_.each(this.ENTITY_TYPES,function(e){t.push(this.subModelHelper.get(e+"-collection").fetch())},this);var i=this;$.whenAll.apply($,t).done(function(){i.isLoading=!1,i._triggerChangeEvent("refreshData")})},getGroupEntities:function(e){var t=new p(e.getMembers());return t.setSortby(this.getSortby()),t.models},getGroupByEntities:function(e){if(!e)return null;var i=[];_.each(e.getGroups(),function(e){var n=e.getMembers();_.each(n,function(i){var n={};n[t.GROUP]=e.getDisplayName(),n[t.GROUPID]=e.get(e.idAttribute),i.set(n,{silent:!0})}),i=i.concat(n)},this);var n=new p(i);return n.setSortby(this.getSortby()),n.models},getSelectedEntities:function(e){return this.get("selectedEntities")[e]||[]},setSelectedEntities:function(e,t){for(var i=0;i<t.length;i++)t[i]=String(t[i]);this.get("selectedEntities")[e]=t,this._triggerChangeEvent("selectedEntities")},getTestById:function(e){return this.subModelHelper.get("testsCollection").findModelById(e)},getTestStatus:function(e){return this.subModelHelper.get("clusterHealthStats").getTestStatus(e)},setCurrentTestsSubPage:function(e){this.set("currentTestsSubPage",e)},getCurrentTestsSubPage:function(e){return this.get("currentTestsSubPage")},_getTestStatusInfo:function(e,i){var n=this.getTestById(e),s={total:0};_.each(S.HEALTH_STATUS,function(e){s[e]=0});for(var a=0;a<i.length;a++){var r=n.getTestStatusForEntity(i[a]);r&&(s[r]++,s.total++)}var o=t.HEALTH_STATUS_VALUES.GOOD;return s[t.HEALTH_STATUS_VALUES.WARNING]?o=t.HEALTH_STATUS_VALUES.WARNING:s[t.HEALTH_STATUS_VALUES.CRITICAL]&&(o=t.HEALTH_STATUS_VALUES.CRITICAL),{counts:s,worstStatus:o}},getTestEntityCounts:function(e){return this.subModelHelper.get("clusterHealthStats").getTestEntityCounts(e)},getErredTestDetails:function(){return this.subModelHelper.get("clusterHealthStats").getErredTestDetails()},getTestEntities:function(e){var t={},i=this.getTestById(e);return _.each(this.ENTITY_TYPES,function(e){var n=this.subModelHelper.get(e+"-collection");t[e]=n.filter(function(e){return i.affectsEntity(e)})},this),t},getSelectedTest:function(){var e=this.get("selectedTest");return this.getTestById(e)},setSelectedTest:function(e){this.set("selectedTest",e),this._triggerChangeEvent("selectedTest")},enableDisableSelectedTest:function(){var e=this.getSelectedTest();e&&(e.set(t.TEST_ENABLED,!e.get(t.TEST_ENABLED)),this._saveAndRefreshTest(e))},scheduleSelectedTest:function(e){var i=this.getSelectedTest();i&&i.get(t.TEST_SCHEDULE_INTERVAL)!==e&&(i.set(t.TEST_SCHEDULE_INTERVAL,e),this._saveAndRefreshTest(i))},updateSelectedTestParameters:function(e){var i=this.getSelectedTest();i&&(i.set(t.TEST_PARAMETERS,e),this._saveAndRefreshTest(i))},setTestsSearchTerm:function(e){this.subModelHelper.get("testsCollection").setSearchTerm(e)},getTestsSearchTerm:function(){return this.subModelHelper.get("testsCollection").getSearchTerm()},getNumberOfTests:function(){return this.subModelHelper.get("testsCollection").length},getAllTestsForDisplay:function(){return this.subModelHelper.get("testsCollection").testsForDisplay()},getAllTests:function(){return this.subModelHelper.get("testsCollection").models},getTestsForDisplay:function(e){if(0===this.subModelHelper.get("testsCollection").models.length)return null;var i=this.subModelHelper.get("testsCollection").testsForDisplay(),n=this._getRelevantTestsForEntities(e),s=this.get("testsViewType"),a=s===this.TESTS_VIEW_TYPE.ALL_TESTS,r=s===this.TESTS_VIEW_TYPE.PASSING_TESTS,o=s===this.TESTS_VIEW_TYPE.WARNING_TESTS,l=s===this.TESTS_VIEW_TYPE.FAILED_TESTS,c=s===this.TESTS_VIEW_TYPE.DISABLED_TESTS,d=s===this.TESTS_VIEW_TYPE.ERROR_TESTS,u=this.getTestsTriggeredType(),h=u===this.TESTS_TRIGGERED_TYPE.SCHEDULED,p=u===this.TESTS_TRIGGERED_TYPE.NOT_SCHEDULED,T=u===this.TESTS_TRIGGERED_TYPE.EVENT_TRIGGERED,E={},g={};return i=_.filter(i,function(i){var s=i.get(i.idAttribute),u=i.getHealthSummaryId();if(n.length>0&&n.indexOf(u)<0)return!1;if(e.length){var _=this._getTestStatusInfo(s,e);g[s]=_.counts,E[s]=_.worstStatus}else g[s]=this.getTestEntityCounts(u),E[s]=this.getTestStatus(s);if(h&&!i.isScheduled())return!1;if(p&&!i.isNotScheduled())return!1;if(T&&!i.isEventTriggered())return!1;if(a)return!0;if(!i.get(t.TEST_ENABLED)&&!c)return!1;var S=E[s];return!(r&&!i.isGood(S))&&(!(o&&!i.isWarning(S))&&(!(l&&!i.isFailing(S))&&(!(d&&!i.isError(S))&&(!c||!i.isEnabled()))))},this),{groupedTests:_.groupBy(i,function(e){return e.getTestCategory()}),testStatusMap:E,testCountsMap:g}},getTestsForEntityType:function(e){var t=this.subModelHelper.get("testsCollection");if(0===t.length)return null;var i=this.subModelHelper.get(e+"-collection"),n=i.models,s=this._getRelevantTestsForEntities(n);return t.filter(function(e){var t=e.getHealthSummaryId();if(s.length>0&&s.indexOf(t)>-1)return!0})},setTestsViewType:function(e,t,i){this.set("testsViewType",e),i||this._triggerChangeEvent("testsViewType",t)},setTestsTriggeredType:function(e,t,i){this.set("testsTriggeredType",e),i||this._triggerChangeEvent("testsTriggeredType",t)},getTestsViewType:function(){return this.get("testsViewType")},getTestsTriggeredType:function(){return this.get("testsTriggeredType")},getTestsCollectionState:function(){return this.subModelHelper.get("testsCollection").getState()},_saveAndRefreshTest:function(e){var t=this;e.save(null,{success:function(){t._refreshTest(e)},error:function(i,n){t._setError("Error updating the current checks parameter. "+(m.processAjaxError(n.responseText)||"")),t._refreshTest(e)}})},_refreshTest:function(e){var t=this;e.fetch({alwaysTriggerChange:!0,success:function(){t._triggerChangeEvent("selectedTest")},error:function(){t._setError("Error refreshing the current test."),m.log("Error refreshing test. "+e.get(e.idAttribute))}})},_getRelevantTestsForEntities:function(e){var i=[];return _.each(e,function(e){var n=e.getValue(t.HEALTH_CHECK_SUMMARIES);n&&(i=i.concat(_.keys(n)))},this),_.uniq(i)},getWatchedEntities:function(){var e=this.getSelectedEntityType(),t=this.getSelectedEntities(e),i=this.getCurrentGroup(),n=[];if(t&&t.length&&i)_.each(t,function(e){var t=i.getMemberById(e);t&&n.push(t)},this),n.length||(n=i.getMembers());else if(t&&t.length)_.each(t,function(t){n.push(this.getEntity(e,t))},this);else if(i)n=i.getMembers();else if(e){var s=this.subModelHelper.get(e+"-collection");n=s.models}var a=this._applyFilters(n);return m.debug("ClusterHealthModel getWatchedEntities. ","Watched and Filtered Entities:",n.length,a.length),a},_testsCollectionStateChange:function(){var e=this.subModelHelper.get("testsCollection").getState();e===S.STATE_SUCCESS?this._triggerChangeEvent("testsChange"):e===S.STATE_ERROR&&this._setError("Error fetching checks.")},getFiltersByEntityType:function(e){return this.subModelHelper.get("filtersCollection").getFiltersByEntityType(e)},updateFilter:function(e,t){this.subModelHelper.get("filtersCollection").getFilterById(e).setIsApplied(t),this._filterGroupMembers(),this._triggerChangeEvent("filtersChange")},_filterGroupMembers:function(){
var e=this.getSelectedEntityType(),t=this.subModelHelper.get("filtersCollection"),i=t.getAppliedFilterGroupsByEntityType(e),n=this.getEntityTypeGroupBys(e);_.each(n,function(e){var t=e.getGroups();_.each(t,function(e){e.filterMembers(i)},this)},this);var s=this.subModelHelper.get(e+"-collection"),a=new h;a.setMembers(s.models),a.filterMembers(i),this.get("filteredEntityCounts")[e]=_.isEmpty(i)?this.NO_FILTERS_COUNT:a.getMemberCount()},_applyFilters:function(e){var t=this.getSelectedEntityType(),i=this.subModelHelper.get("filtersCollection"),n=i.getAppliedFilterGroupsByEntityType(t),s=new h;return s.setMembers(e),s.filterMembers(n),s.getMembers()},_filtersCollectionStateChange:function(){this.subModelHelper.get("filtersCollection").getState()===S.STATE_ERROR?this._setError("Error fetching filters."):this._triggerChangeEvent("filtersLoaded")},getEntityCollectionState:function(e){return this.subModelHelper.get(e+"-collection").getState()},_entityCollectionStateChange:function(e){var t=this.subModelHelper.get(e+"-collection");if(t.getState()===S.STATE_SUCCESS){var i=this.subModelHelper.get("entityTypeGroupingModel"),n=i.getEntityTypeGroupBys(e);_.each(n,function(e){e.groupEntities(t.models)},this);var s=this.getFiltersByEntityType(e),a=!1;_.each(s,function(e){e.calculateMatchCount(t.models),e.isApplied()&&(a=!0)}),e!==S.ENTITY_CLUSTER&&this._syncHealthStats(e,n),a&&this._filterGroupMembers(),this._triggerChangeEvent("entityTypeGrouping")}else if(t.getState()===S.STATE_ERROR){var r="Error fetching "+m.getPluralEntityName(e)+".";this._setError(r)}},triggerStatsError:function(e,t,i,n){this.trigger("error:clusterHealthStats",e,t,i,n)},hasEntityStatsFetchErred:function(){return!!_.some(this.ENTITY_TYPES,function(e){var t=this.subModelHelper.get(e+"-collection");return t&&t.getState()===S.STATE_ERROR},this)},getErrorMsg:function(){return this.get("errorMessage")},resetError:function(){this.set("errorMessage",null)},_setError:function(e){this.set("errorMessage",e),this._triggerChangeEvent("errorMessage")},initialize:function(){this.subModelHelper=new g,this.set({viewRenderType:this.VIEW_RENDER_TYPE_GRID,testsViewType:this.TESTS_VIEW_TYPE.ALL_TESTS,testsTriggeredType:null,selectedEntities:{},previousGroupBys:{},previousGroups:{}});var e=new i;e.setRequestDetailedStats(!0),this.subModelHelper.register("clusterHealthStats",e),e.on("stateChanged",this._onClusterHealthStateChange,this),e.on("error",this.triggerStatsError,this);var t=new n({});this.subModelHelper.register("entityTypeGroupingModel",t),t.on("stateChanged",this._onEntityTypeGroupingStateChange,this);var h=new T;this.subModelHelper.register("filtersCollection",h),h.on("stateChanged",this._filtersCollectionStateChange,this);var p=new E;this.subModelHelper.register("testsCollection",p),p.on("stateChanged",this._testsCollectionStateChange,this);var m=!1;_.each(this.ENTITY_TYPES,function(e){var t;switch(e){case S.ENTITY_VM:t=new s,m=!0;break;case S.ENTITY_HOST:t=new r,m=!0;break;case S.ENTITY_DISK:t=new a,m=!0;break;case S.ENTITY_PROTECTION_DOMAIN:t=new d;break;case S.ENTITY_REMOTE_SITE:t=new u;break;case S.ENTITY_STORAGE_POOL:t=new o;break;case S.ENTITY_CONTAINER:t=new l;break;case S.ENTITY_CLUSTER:t=new c}this.subModelHelper.register(e+"-collection",t);var i=[S.PROJECTION.BASIC_INFO,S.PROJECTION.HEALTH];m&&i.push(S.PROJECTION.STATS),t.setProjection(i),t.on("stateChanged",function(){this._entityCollectionStateChange(e)},this)},this)},destroy:function(){this.subModelHelper.get("clusterHealthStats").off("error",this.triggerStatsError,this),this.subModelHelper.destroy()},_syncHealthStats:function(e){var t={};_.each(S.HEALTH_STATUS,function(e){t[e]=0});var i=this.getGroupBy(e,"health"),n=i.getGroups();_.each(n,function(e){var i=e.get(e.idAttribute).split("-"),n=i[1];t[n]=e.getMemberCount()}),this.subModelHelper.get("clusterHealthStats").updateHealthStats(e,t)},monitorHealthChanges:function(){this.stopMonitoringHealthChanges();var e=this.getSelectedEntityType();if(e){var t=this.subModelHelper.get(e+"-collection");t&&(m.debug("ClusterHealthModel : Start monitoring: "," | eType     : ",e),this.set("monitoredEntityType",e),t.startPolling())}},stopMonitoringHealthChanges:function(){var e=this.get("monitoredEntityType");if(e){var t=this.subModelHelper.get(e+"-collection");t&&(m.debug("ClusterHealthModel : Stop monitoring: "," | eType     : ",e),t.stopPolling()),this.set("monitoredEntityType",null)}},_triggerChangeEvent:function(e,t){var i=e+"Trigger";if(this.isLoading)return void m.debug("ClusterHealthModel : Event not triggered. UI is loading. Event Name:"+i);this.set(i,!this.get(i),t)}},{DP:v})}),define("views/pages/cluster/ClusterHealthBaseSubpageView",["backbone","views/basecomponents/BaseView","utils/AppUtil","utils/SubViewHelper","utils/AppConstants","managers/TaskManager","managers/ActionManager","managers/NavigationManager","managers/NotificationManager"],function(e,t,i,n,s,a,r,o,l){"use strict";return t.extend({TESTS_HEADER_HTML:'<li navsubpage="summary">Summary</li><li navsubpage="tests">Checks</li>',subViewHelper:null,scrollers:null,currentCenterViewId:null,eventBus:null,events:{"click ul.nav li":"onTabClick","click .header-option":"onClickTestsHeaderOption","click a.all-tests":"onClickTestsHeaderOption","click .header-change-view-button":"onChangeSubview","click .bcLink":"onBreadCrumbsClick","click .watch-count-clearable":"onClearWatchCounts","click .selector a":"onViewRenderingClick","click .schedule-option":"onTestScheduleClick","click .test-enable":"onTestEnable","click .run-check.check-runnable":"onRunCheck","click .test-parameters":"onTestParameters","click .entityHistoryRow":"onEntityHistoryRowClick","click .schedule-dropdown > .dropdown-toggle":"onScheduleDropDownClick","click .btnAction":"onClickActionButton","click .action-dropdown":"onClickActionMenu","mouseover .entityTypeGroupBy,.entityTypeWorstGroups":"onGroupOver","mouseout  .entityTypeGroupBy,.entityTypeWorstGroups":"onGroupOut"},onGroupOver:function(e){},onGroupOut:function(e){},onScheduleDropDownClick:function(e){},onClickActionMenu:function(e){var t=this.isNCCTaskActive(),i=this.isLogCollectorActive();this.enableMenuItem(t,"#run-checks"),this.enableMenuItem(i,"#log-collector")},onEntityHistoryRowClick:function(){this._refreshScrollers()},onTestParameters:function(e){},onTabClick:function(){},onTestEnable:function(){},onRunCheck:function(){},onTestScheduleClick:function(e){var t=$(e.currentTarget).attr("data-id");this.model.scheduleSelectedTest(t)},onViewRenderingClick:function(e){var t=$(e.currentTarget),i=t.hasClass("grid")?this.model.VIEW_RENDER_TYPE_GRID:this.model.VIEW_RENDER_TYPE_TABLE;this.model.setViewRenderType(i),e.preventDefault()},onBreadCrumbsClick:function(e){},onClearWatchCounts:function(){var e=this.model.getSelectedEntityType();this.model.setSelectedEntities(e,[]),this.refreshCenterView()},onChangeSubview:function(){var e=o.getCurrentPageRoute(),t=e[s.NAV_PAGE_ID],i=e[s.NAV_SUBPAGE_ID];o.navigateToPage(t,i===s.SUBPAGE_TESTS?s.SUBPAGE_ENTITIES:s.SUBPAGE_TESTS)},onClickTestsHeaderOption:function(e){var t=$(e.currentTarget);if(t.hasClass("search-tests"))return void this.subViewHelper.get("testsView").toggleSearchInput();var i=null;_.each(this.model.TESTS_VIEW_TYPE,function(e){t.hasClass(e+"-tests")&&(i=e)}),i&&(this.model.setTestsViewType(i),this._renderPanelHeaders(),this._refreshScrollers())},onResize:function(){this._refreshScrollers(),this.subViewHelper&&this.subViewHelper.iterate("onResize")},onError:function(){var e=this.model.getErrorMsg();e&&e.length&&(l.showClientNotification(s.NOTIFY_ERROR,e),this.model.resetError())},onClickActionButton:function(e){var t=null;this.clusterManager.getCurrentClusterModel().isNewLogCollectorEnabled()&&e.currentTarget&&"log-collector"===e.currentTarget.id&&(t={action:s.ACTION_VIEW,isPE:!0,subApp:"ncc-log-collector"}),r.executeActionElement(e.currentTarget,t)},render:function(){i.debug("ClusterHealthBaseSubpageView : render: "," | viewid     : "+this.cid),this.eventBus=_.extend({},e.Events),this._renderViewTemplate(),this.subViewHelper||(this.subViewHelper=new n,this._initializeSubViews()),this.subViewHelper.renderAll(),this._renderPanelHeaders(),this.scrollers=[];var t="object"==typeof window.chrome,s={x:!1,y:!0,sbSize:t?17:null,autoHide:!0};if(_.each(this.$(".antiscroll-wrap"),function(e){var t=$(e).antiscroll(s).data("antiscroll");this.scrollers.push(t)},this),this._refreshScrollers(),t){var a=this;setTimeout(function(){a._refreshScrollers()},100)}},destroy:function(){i.debug("ClusterHealthBaseSubpageView : destroy: "," | viewid     : "+this.cid),this.subViewHelper.removeAll(),this.subViewHelper=null,t.prototype.destroy.apply(this,arguments)},show:function(){i.log("ClusterHealthBaseSubpageView : show:  | viewid     : "+this.cid),this.onResize()},reloadSubpage:function(){this.model.resetModel(),this.model.refreshData(!1),this.model.setSelectedGroup(null),this.model.setSelectedGroupBy(null),this.model.setSelectedEntityType(null)},refreshCenterView:function(){this.subViewHelper.get(this.currentCenterViewId).render(),this._renderPanelHeaders(),this._refreshScrollers()},setCenterView:function(e,t){this.currentCenterViewId&&this.subViewHelper.get(this.currentCenterViewId).$el.hide();var i=this.subViewHelper.get(e);i.$el.show(),t&&i.render(),this.currentCenterViewId=e,this._renderPanelHeaders();var n=this;setTimeout(function(){n._refreshScrollers()},250)},enableMenuItem:function(e,t){e?(this.$(t).removeClass("btnAction").addClass("disabledBtn"),this.$(t).tooltip({placement:this.getTooltipPlacement(),trigger:"hover",html:!1})):(this.$(t).addClass("btnAction").removeClass("disabledBtn"),this.$(t).tooltip("destroy"))},isNCCTaskActive:function(){return a.getGlobalTasks().where({status:s.TASK_STATUS_ACTIVE,component:s.TASK_COMPONENTS.NCC}).length>0},isLogCollectorActive:function(){return a.getGlobalTasks().where({status:s.TASK_STATUS_ACTIVE,component:s.TASK_COMPONENTS.LOG_COLLECTOR}).length>0},getTooltipPlacement:function(){return"left"},_renderViewTemplate:function(){},_initializeSubViews:function(){},_renderPanelHeaders:function(){},_renderTestsHeader:function(e){e.find(".nav").html(this.TESTS_HEADER_HTML)},_refreshScrollers:function(){var e=$(window).height()-6,t=$("#n-notification-bar").outerHeight(!0),i=e-104-t,n=this.$(".center-panel").width(),s=this.$(".side-panel").width();this.$(".left-panel-inner").height(i).width(s+20),this.$(".right-panel-inner").height(i).width(s+20),this.$(".left-panel-inner-wrapper").width(s),this.$(".right-panel-inner-wrapper").width(s),this.$(".center-panel-inner").height(i).width(n+20),this.$(".center-panel-container").width(n),this.$(".center-panel-inner-wrapper").width(n),this.$(".center-panel-box-wrap").width(n),_.each(this.scrollers,function(e){e.refresh()})}})}),define("views/pages/cluster/EntityTypesBaseView",["views/basecomponents/BaseView","utils/AppUtil","utils/StatsUtil","utils/SubViewHelper","utils/AppConstants"],function(e,t,i,n,s){"use strict";return e.extend({templates:null,TEMPLATE_TYPE_LOADING:"loading",TEMPLATE_TYPE_ERROR:"error",TEMPLATE_TYPE_ENTITY_TYPE_STATS:"entityTypeStats",TEMPLATE_TYPE_ENTITY_STATS_LOADING:"entityTypeStatsLoading",TEMPLATE_ERROR:_.template('<div class="text-danger n-error"><i class="n-icon error-icon"></i><%= errorMessage%><a class="n-error-details" tooltip="<%=errorDetails%>" data-original-title="<%=errorDetails%>">Show me why</a></div>'),COUNT_BOX_HOTLINKS:!1,rendered:!1,events:{"click .entityTypeStats":"onEntityTypeClick","click .entity-type-name":"onEntityTypeNameClick","click .entityTypeGroupBy":"onGroupByClick","click .count-box":"onCountBoxClick","click .groupby-header":"onGroupByHeaderClick","click .groups-container":"onGroupContainerClick"},onGroupContainerClick:function(e){e.stopPropagation()},onGroupByHeaderClick:function(e){e.stopPropagation()},onGroupByClick:function(e){var t=$(e.currentTarget).attr("id").split("-")[1];this.model.setSelectedGroup(null),this.model.setSelectedGroupBy(t),e.stopPropagation(),this.registerUserActivity(t)},onEntityTypeClick:function(e){},onEntityTypeNameClick:function(e){},onEntityTypeChange:function(){var e=this.model.getSelectedEntityType();if(this.$(".entityTypeStats.selected").removeClass("selected"),this.$(".entity-type-name-selected").removeClass("entity-type-name-selected"),this.$(".entity-type-name-selected-with-back").removeClass("entity-type-name-selected-with-back"),this.$(".entity-type-name-back").hide(),e){var t=this.$("#ets-"+e);t.hasClass("selected")||(t.addClass("selected"),t.siblings().removeClass("selected"),t.find(".entity-type-name").addClass("entity-type-name-selected"))}},onCountBoxClick:function(e){},onGroupByChange:function(){},onGroupChange:function(){},getContainerName:function(){return""},onEntityTypeGroupingChange:function(){this.render()},renderModelError:function(e,i,n,s){s=s||"",i&&t.isConnectionError(i)?s=this.i18n("unable_to_connect"):i&&i.responseText&&(s=(t.processAjaxError(i.responseText)||"").replace(/(<([^>]+)>)/gi,"")),this.$el.html(this.TEMPLATE_ERROR({errorMessage:this.i18n("api_failed"),errorDetails:s})),setTimeout(function(){this.$(".n-error-details").tooltip("destroy").tooltip({placement:"top",trigger:"hover",html:!0})},50)},renderGroupings:function(e){return""},renderGroupVisual:function(e){return""},updateGroupVisual:function(e,t){},initializeTemplates:function(){},selectEntityType:function(e,t){if(this.model.setSelectedGroup(null),this.model.setSelectedGroupBy(null),t){this.model.getSelectedEntityType()===e&&(e=null)}this.model.setSelectedEntityType(e)},_getGroupContainerId:function(e){return"groups-container-"+e},initialize:function(){t.debug("EntityTypesBaseView : initialize: "," | viewid     : ",this.cid),this.subViewHelper=new n,this.initializeTemplates()},onStartServices:function(){this.model.on("change:selectedEntityTypeTrigger",this.onEntityTypeChange,this),this.model.on("change:selectedGroupByTrigger",this.onGroupByChange,this),this.model.on("change:selectedGroupTrigger",this.onGroupChange,this),this.model.on("change:entityTypeGroupingTrigger",this.onEntityTypeGroupingChange,this),this.model.on("change:clusterHealthStatsTrigger",this.render,this),this.model.on("change:refreshDataTrigger",this.reloadView,this),this.model.on("error:clusterHealthStats",this.renderModelError,this)},onStopServices:function(){this.model.off("change:selectedEntityTypeTrigger",this.onEntityTypeChange,this),this.model.off("change:selectedGroupByTrigger",this.onGroupByChange,this),this.model.off("change:selectedGroupTrigger",this.onGroupChange,this),this.model.off("change:entityTypeGroupingTrigger",this.onEntityTypeGroupingChange,this),this.model.off("change:clusterHealthStatsTrigger",this.render,this),this.model.off("change:refreshDataTrigger",this.reloadView,this),this.model.off("error:clusterHealthStats",this.renderModelError,this)},reloadView:function(){this.rendered=!1,this.subViewHelper.destroy(),this.render()},refreshView:function(){this.subViewHelper&&this.subViewHelper.iterate("render"),this._updateCounts()},_updateCounts:function(){_.each(this.model.getEntityTypes(),function(e){var t=this.model.getHealthStatsByEntityType(e),i=this._formatStats(t),n=this.$("#ets-"+e);_.each(i,function(e,t){var i=".count-box-"+t.toLowerCase()+" .count-box-number";n.find(i).html(e)},this),n.find(".total-count-badge").html(i.total),this.updateGroupVisual(e,t)},this)},render:function(){if(t.debug("EntityTypesBaseView : render: "," | viewid     : ",this.cid),this.rendered)return void this.refreshView();if(this.model.getHealthStatsState()!==s.STATE_ERROR){var e='<div class="'+this.getContainerName()+'">',i=this.model.getEntityTypeGroupingsState();if(i===s.STATE_PENDING||i===s.STATE_INIT)e+=this.templates[this.TEMPLATE_TYPE_LOADING];else if(i===s.STATE_ERROR)e+=this.templates[this.TEMPLATE_TYPE_ERROR];else{if(0===this.model.getEntityTypes().length){if(this.model.hasEntityStatsFetchErred()){var n=this.i18n("unable_to_fetch");this.renderModelError(this,null,null,n)}else this.$el.html($('<div class="no-data"></div>').html(this.i18n("no_data")));return}_.each(this.model.getEntityTypes(),function(i){var n=this.model.getEntityTypeName(i,!1),a=this.model.getHealthStatsState();if(a===s.STATE_PENDING||a===s.STATE_INIT)e+=this.templates[this.TEMPLATE_TYPE_ENTITY_STATS_LOADING]({entityType:i,entityTypeName:n});else if(a===s.STATE_ERROR)e+=this.templates[this.TEMPLATE_TYPE_ERROR]({entityType:i,entityTypeName:n});else if(a===s.STATE_SUCCESS){var r=this.model.getHealthStatsByEntityType(i),o=this._formatStats(r),l=this.renderGroupVisual(r),c=this.renderGroupings(i),d=this._getGroupContainerId(i),u=this.model.getSelectedEntityType();e+=this.templates[this.TEMPLATE_TYPE_ENTITY_TYPE_STATS](_.extend({isCurrentEntityType:i===u,entityType:i,entityTypeName:n,totalCount:o.total,criticalCount:o[s.HEALTH_STATUS.CRITICAL],warningCount:o[s.HEALTH_STATUS.WARNING],okCount:o[s.HEALTH_STATUS.GOOD],groupContainerId:d,groupVisual:l,groupingsHTML:c},o)),this.rendered=!0}else t.log("EntityTypesBaseView: render: | ","Error: Invalid statsState:",a)},this)}e+="</div>",this.$el.html(e),this.COUNT_BOX_HOTLINKS?_.each(this.$(".count-box"),function(e){var t=$(e);"0"===t.text().trim()&&t.addClass("count-box-disabled")},this):this.$(".count-box").addClass("count-box-disabled"),this.onEntityTypeChange()}},destroy:function(){t.debug("EntityTypesBaseView : destroy: "," | viewid     : ",this.cid),this.model.off(),this.$(".n-error-details").tooltip("destroy"),this.subViewHelper.destroy(),e.prototype.destroy.apply(this,arguments)},_formatStats:function(e){var t=_.reduce(e,function(e,t){return e+=t},0),n={total:t};return _.each(s.HEALTH_STATUS,function(t){n[t]=i.rawNumericFormat(e[t],!0)}),n}})}),define("views/pages/cluster/EntityTypesSummaryView",["views/pages/cluster/EntityTypesBaseView","text!templates/pages/cluster/EntityTypesSummaryRow.html"],function(e,t){"use strict";var i=_.template(t),n=_.template("<div\n      id='ets-<%=entityType%>' class='entityTypeStats loading'>\n        <%= entityTypeName %>\n        <div class='donut-loader-blue'></div>\n      </div>"),s=_.template("<div\n      id='ets-<%=entityType%>' class='entityTypeStats'>\n        <%= entityTypeName %> |\n        <i aria-hidden='true' data-icon='v' class='errorIcon'></i>\n        Error loading health information.\n      </div>"),a=_.template('<span class="groupby-header"><%= groupByText %></span>'),r=_.template("<div id='grpby-<%=id%>' class='entityTypeGroupBy'>\n        <%= name %>\n        <span class='total-count-badge count-badge-small'>\n          <%= numberOfGroups %> <%= groupsText %>\n        </span>\n      </div>");return e.extend({name:"EntityTypesSummaryView",initializeTemplates:function(){this.templates={},this.templates[this.TEMPLATE_TYPE_LOADING]="<div class='no-data'>\n        <div class='donut-loader-blue'></div>&nbsp;Loading...\n      </div>",this.templates[this.TEMPLATE_TYPE_ENTITY_STATS_LOADING]=n,this.templates[this.TEMPLATE_TYPE_ERROR]=s,this.templates[this.TEMPLATE_TYPE_ENTITY_TYPE_STATS]=i},getContainerName:function(){return"entityTypesSummary"},onCountBoxClick:function(e){},onGroupByChange:function(){this._hideInactiveEntityTypes()},onEntityTypeGroupingChange:function(){this._hideInactiveEntityTypes(),this._updateCounts();var e=this.model.getSelectedEntityType(),t=this.renderGroupings(e);this.$("#groups-container-"+e).html(t)},onEntityTypeClick:function(e){var t=$(e.currentTarget).attr("id").split("-")[1],i=this.model.getSelectedGroupBy(),n=this.model.getSelectedGroup(),s=!1;i||n||(s=!0),this.selectEntityType(t,s)},onGroupChange:function(){this._hideInactiveEntityTypes()},refreshView:function(){this.rendered=!1,this.render()},_hideInactiveEntityTypes:function(){var e=this.model.getSelectedEntityType(),t=this.model.getSelectedGroupBy(),i=this.model.getSelectedGroup();this.$(".entityTypeGroupBy").removeClass("selected");var n=this.$(".entity-type-name-selected");t?(this.$("#grpby-"+t).addClass("selected"),n.removeClass("entity-type-name-selected").addClass("entity-type-name-selected-with-back"),n.siblings(".entity-type-name-back").show()):(n.addClass("entity-type-name-selected").removeClass("entity-type-name-selected-with-back"),n.siblings(".entity-type-name-back").hide()),t||i?(this.$(".entityTypeStats").hide(),this.$("#ets-"+e).show()):this.$(".entityTypeStats").show()},renderGroupings:function(e){var t=this.model.getEntityTypeGroupBys(e),i=a({groupByText:this.i18ns("group_by_text",this.model.getEntityTypeName(e,!1))});return _.each(t,function(e){i+=r({id:e.get(e.idAttribute),name:this.i18n(e.get(e.nameAttribute)),numberOfGroups:e.getNumberOfGroups(),groupsText:this.i18n("groups")})},this),i}})}),define("text!templates/pages/cluster/EntityTypeWorstGroupsView.html",[],function(){return'<div class="entityTypeWorstGroups" id="wrst-<%= groupBy.id %>">\n  <div class="group-by entityTypeGroupBy"\n       id="grpby-<%= groupBy.id %>">\n    <%= name %>\n  </div>\n  <div class="groups">\n    <% if ( isPending ) { %>\n      <div class="donut-loader-blue"></div>\n    <% } else if ( isError ) { %>\n        <i aria-hidden=\'true\' data-icon=\'v\' class=\'errorIcon\'></i>\n        Error loading entities\n    <% } else { %>\n        <% var nbGroupsRendered = 0; %>\n        \x3c!-- 4 groups at the most. --\x3e\n        <% for( var i=0; i<4; i++) { %>\n        <div class="group" data-groupBy=\'<%=groupBy.id%>\'>\n          <% if ( i < groups.length ) {\n              var grp = groups[i].toJSON();\n              var total =\n                StatsUtil.rawNumericFormat(groups[i].getMemberCount(), true);\n              nbGroupsRendered++;\n          %>\n              <div class=\'group-name\' id=\'<%=grp.id%>\'>\n                <%=grp.displayName%>&nbsp;</div>\n              <div class="group-total"><%=total%></div>\n              <div class="group-health-bar" id="<%= grp.id %>"\n                   data-stats="<%= [grp.healthStats.Critical,\n                   grp.healthStats.Warning, grp.healthStats.Good,\n                   grp.healthStats.Error] %>">\n                \x3c!-- Render a health bar here based on data-stats attr --\x3e\n              </div>\n          <% } else { %>\n          &nbsp;\n          <% } %>\n        </div>\n        <% } %>\n    <% } %>\n  </div>\n  <% if ( !isPending && !isError ) { %>\n    <%\n      // See Comment ID: WorstGroupsMoreLink in EntityTypeWorstGroupsView\n    %>\n\n\n    <% var offset = (groups.length < 4 ? 4 - groups.length : 0) %>\n    <% if (groups.length > 1) { %>\n      <div class="groups-count groups-count-count-1">\n        <%= groups.length - nbGroupsRendered + 3 - offset %> More\n        <i aria-hidden="true" data-icon="y"></i>\n      </div>\n    <% } %>\n    <% if (groups.length > 2) { %>\n      <div class="groups-count groups-count-count-2">\n        <%= groups.length - nbGroupsRendered + 2 - offset %> More\n        <i aria-hidden="true" data-icon="y"></i>\n      </div>\n    <% } %>\n    <% if (groups.length > 3) { %>\n      <div class="groups-count groups-count-count-3">\n        <%= groups.length - nbGroupsRendered + 1 - offset %> More\n        <i aria-hidden="true" data-icon="y"></i>\n      </div>\n    <% } %>\n    <% if (groups.length > 4) { %>\n      <div class="groups-count groups-count-count-4">\n        <%= groups.length - nbGroupsRendered %> More\n        <i aria-hidden="true" data-icon="y"></i>\n      </div>\n    <% } %>\n  <% } %>\n</div>'}),define("views/pages/cluster/EntityTypeWorstGroupsView",["views/basecomponents/BaseView","utils/AppUtil","utils/StatsUtil","utils/AppConstants","utils/VisualizationUtil","text!templates/pages/cluster/EntityTypeWorstGroupsView.html"],function(e,t,i,n,s,a){"use strict";var r=_.template(a),o=_.template('<div class="group-header"><div class="group-by"><%= entityType %> Grouped By</div><div class="groups">&nbsp;</div></div>'),l=_.template("<div class='group-tool-tip'><div class='count-badge-small'>&nbsp;</div>  <%= totalCount %><div class='spacer'>&middot;</div><div class='count-badge-small critical-count-badge'>&nbsp;</div>  <%= criticalCount %><div class='spacer'>&middot;</div><div class='count-badge-small warning-count-badge'>&nbsp;</div>  <%= warningCount %><div class='spacer'>&middot;</div><div class='count-badge-small good-count-badge'>&nbsp;</div> <%= goodCount %></div></div>");return e.extend({entityType:null,name:"EntityTypeWorstGroupsView",events:{"click .group-name":"onGroupClick","click .group-health-bar":"onGroupClick","click .groups-count":"onGroupsCountClick"},onGroupClick:function(e){var t=$(e.currentTarget);if(t.hasClass("active")){var i=t.attr("id"),n=t.parent().attr("data-groupBy");this.model.setSelectedGroupBy(n),this.model.setSelectedGroup(i);var s=this.model.getSelectedEntityType();this.model.clearPreviousGroupBy(s)}e.stopPropagation()},onGroupsCountClick:function(e){$(e.currentTarget).siblings(".group-by").trigger("click"),e.stopPropagation()},initialize:function(e){t.log("EntityTypesWorstGroupsView : initialize: "," | viewid     : "+this.cid),this.entityType=e.entityType},render:function(){var e=this;t.debug("EntityTypesWorstGroupsView : render: "," | viewid     : "+this.cid),this._clearTooltips();var a=o({entityType:this.model.getEntityTypeName(this.entityType,!1)}),c=this.model.getEntityCollectionState(this.entityType),d=this.model.getEntityTypeGroupingsState();if(d===n.STATE_PENDING||d===n.STATE_INIT)a+="<div class='no-data'><img src='app/assets/images/spinners/loading.gif'  width=16px height=16px />&nbsp;Loading...</div>";else if(d===n.STATE_ERROR)a+="<div class='no-data'><i aria-hidden='true' data-icon='v' class='errorIcon'></i> Error loading groups </div>";else{var u=this.model.getEntityTypeGroupBys(this.entityType);_.each(u,function(t){var s=t.getWorstGroups();t=t.toJSON();var o=e.i18n(t.name);a+=r({groupBy:t,name:o,groups:s,StatsUtil:i,isPending:c===n.STATE_PENDING,isError:c===n.STATE_ERROR})})}this.$el.html(a),_.each(this.$(".group-health-bar"),function(e){for(var t=$(e),i=t.attr("data-stats"),n=i.split(","),a=0;a<n.length;a++)n[a]=Number(n[a]);var r=s.renderHealthBar(n[0],n[1],n[2]);t.html(r);var o=_.reduce(n,function(e,t){return e+=t},0),c=l({totalCount:o,criticalCount:n[0],warningCount:n[1],goodCount:n[2]});o>0&&(t.find(".n-visual-bar").tooltip({title:c,placement:"right",trigger:"hover",html:"true"}),t.siblings(".group-name").addClass("active"),t.addClass("active"))},this),t.addTipsToOverflows(this.$(".group-name"))},onStopServices:function(){this._clearTooltips()},destroy:function(){t.debug("EntityTypesWorstGroupsView : destroy: "," | viewid     : ",this.cid),this._clearTooltips(),e.prototype.destroy.apply(this,arguments)},_clearTooltips:function(){_.each(this.$(".group-health-bar .n-visual-bar"),function(e){this.$(e).tooltip("destroy")},this)}})}),define("text!templates/pages/cluster/EntityTypesDetailsRow.html",[],function(){return"<div id='ets-<%=entityType%>' class='entityTypeStats'>\n  <div class='entity-type-name'>\n    <%= entityTypeName %>\n    <div class=\"count-badge-small total-count-badge\n                <%= totalCount > 0 ? '' : 'count-box-zero' %>\">\n      <%= totalCount %> total\n    </div>\n    <span class=\"group-visual\"><%= groupVisual %></span>\n  </div>\n  <div class=\"pull-right\">\n    \x3c!-- This comment aids in layout for formatting\n --\x3e<div class=\"count-box count-box-critical\n               <%= criticalCount != 0 ? '' : 'count-box-zero' %>\">\n    <span class=\"count-box-number\"><%= criticalCount %></span>\n    <div class=\"count-badge-large critical-count-badge\">&nbsp;</div>\n  </div>\x3c!-- This comment aids in layout for formatting\n --\x3e<div class=\"count-box count-box-warning\n               <%= warningCount != 0 ? '' : 'count-box-zero' %>\">\n    <span class=\"count-box-number\"><%= warningCount %></span>\n    <div class=\"count-badge-large warning-count-badge\">&nbsp;</div>\n  </div>\x3c!-- This comment aids in layout for formatting\n --\x3e<div class=\"count-box count-box-good\n               <%= okCount != 0 ? '' : 'count-box-zero' %>\">\n    <span class=\"count-box-number\"><%= okCount %></span>\n    <div class=\"count-badge-large good-count-badge\">&nbsp;</div>\n  </div>\x3c!-- This comment aids in layout for formatting\n--\x3e</div>\n  <div class='groups-container' id='<%=groupContainerId%>'>\n    <%= groupingsHTML %>\n  </div>\n</div>"}),define("views/pages/cluster/EntityTypesDetailsView",["views/pages/cluster/EntityTypesBaseView","views/pages/cluster/EntityTypeWorstGroupsView","utils/AppConstants","utils/VisualizationUtil","text!templates/pages/cluster/EntityTypesDetailsRow.html"],function(e,t,i,n,s){"use strict";var a=_.template(s),r=_.template("<div id='ets-<%=entityType%>' class='entityTypeStats loading'><%= entityTypeName %><div class='donut-loader-blue'></div></div>"),o=_.template("<div id='ets-<%=entityType%>' class='entityTypeStats'><%= entityTypeName %> | <i aria-hidden='true' data-icon='v' class='errorIcon'></i>Error loading health information.</div>");return e.extend({name:"EntityTypesDetailsView",initializeTemplates:function(){this.templates={},this.templates[this.TEMPLATE_TYPE_LOADING]="<div class='no-data'><div class='donut-loader-blue'></div>&nbsp;Loading...</div>",this.templates[this.TEMPLATE_TYPE_ENTITY_STATS_LOADING]=r,this.templates[this.TEMPLATE_TYPE_ERROR]=o,this.templates[this.TEMPLATE_TYPE_ENTITY_TYPE_STATS]=a},onEntityTypeNameClick:function(e){e.stopPropagation();var t=$(e.currentTarget).parent().attr("id").split("-")[1];this.selectEntityType(t,!0)},onEntityTypeClick:function(e){var t=$(e.currentTarget).attr("id").split("-")[1];this.selectEntityType(t,!0)},getContainerName:function(){return"entityTypesDetails"},_getGroupContainerId:function(e){return"details-groups-container-"+e},onCountBoxClick:function(e){e.stopPropagation();var t=$(e.currentTarget),n=t.parents(".entityTypeStats"),s=_.last(n.attr("id").split("-"));t.hasClass("count-box-total")||t.hasClass("count-box-disabled")?this.selectEntityType(s,!0):t.hasClass("count-box-critical")?(this.model.setSelectedEntityType(s),this.model.setSelectedGroupBy("health"),this.model.setSelectedGroup("health-"+i.HEALTH_STATUS.CRITICAL)):t.hasClass("count-box-warning")?(this.model.setSelectedEntityType(s),this.model.setSelectedGroupBy("health"),this.model.setSelectedGroup("health-"+i.HEALTH_STATUS.WARNING)):t.hasClass("count-box-good")&&(this.model.setSelectedEntityType(s),this.model.setSelectedGroupBy("health"),this.model.setSelectedGroup("health-"+i.HEALTH_STATUS.GOOD))},onEntityTypeChange:function(){var i=this.model.getSelectedEntityType();if(i){var n="worst-groups-"+i,s=this.subViewHelper.get(n);s||(s=new t({el:this.$("#"+this._getGroupContainerId(i)),entityType:i,model:this.model}),this.subViewHelper.register(n,s)),s.render()}e.prototype.onEntityTypeChange.apply(this,arguments)},renderGroupVisual:function(e){return n.renderHealthBar(e[i.HEALTH_STATUS.CRITICAL],e[i.HEALTH_STATUS.WARNING],e[i.HEALTH_STATUS.GOOD])},updateGroupVisual:function(e,t){var i=this.renderGroupVisual(t);this.$("#ets-"+e+" .group-visual").html(i)},renderGroupings:function(){return""}})}),define("views/pages/cluster/ClusterHealthDataTableColumnProvider",["views/basecomponents/datatables/DataTableColumnProvider","views/basecomponents/datatables/DataTableTemplates","data/DataProperties","utils/AppConstants","utils/AppUtil","utils/StatsUtil","utils/HypervisorUtil","utils/TooltipContent","utils/TimeUtil"],function(e,t,i,n,s,a,r,o,l){"use strict";var c=_.clone(e);return _.extend(c,{getDataColumns:function(c,d){var u,h=this;switch(c){case n.ENTITY_HOST:u=[{sTitle:"",mData:i.ID,sWidth:"15px",sClass:"center",bSortable:!1,bSearchable:!1,mRender:function(t){return e.createDataRowCheckbox(t)}},{sTitle:"Hypervisor IP",mData:i.HYPERVISOR_IP,sWidth:"20%",bSearchable:!0,mRender:function(e,a,r){return a===n.TABLE_COL_TYPE_EXPORT?e:t.HEALTH_ICON({healthIndicator:s.getJSONValue(r,i.HEALTH_STATUS)||n.UNKNOWN_VALUE})+e}},{sTitle:"CVM IP",bSearchable:!0,mData:i.SERVICE_VM_IP,sWidth:"10%"},{sTitle:"CPU Usage",mData:i.STATS+"."+i.STATS_HYP_CPU_USAGE,sWidth:"10%",sClass:"right",
bSearchable:!1,mRender:function(e,t,n){return h.renderStatsValue(i.STATS_HYP_CPU_USAGE,e,t,n)}},{sTitle:"Memory Usage",mData:i.STATS+"."+i.STATS_HYP_MEMORY_USAGE,sWidth:"10%",sClass:"right",bSearchable:!1,mRender:function(e,t,n){return h.renderStatsValue(i.STATS_HYP_MEMORY_USAGE,e,t,n)}},{sTitle:"Total Disk Usage",sWidth:"20%",sClass:"right",bSearchable:!1,mData:i.TOT_USED_PCT},{sTitle:"Disk IOPS",mData:i.STATS+"."+i.STATS_NUM_IOPS,sWidth:"10%",sClass:"right",bSearchable:!1,mRender:function(e,t,n){return h.renderStatsValue(i.STATS_NUM_IOPS,e,t,n,!1)}},{sTitle:"Disk IO B/W",mData:i.STATS+"."+i.STATS_BANDWIDTH,sWidth:"10%",sClass:"right",bSearchable:!1,mRender:function(e,t,n){return h.renderStatsValue(i.STATS_BANDWIDTH,e,t,n)}},{sTitle:"Disk IO Latency",mData:i.STATS+"."+i.STATS_AVG_IO_LATENCY,sWidth:"10%",sClass:"right",bSearchable:!1,mRender:function(e,t,n){return h.renderStatsValue(i.STATS_AVG_IO_LATENCY,e,t,n)}}];break;case n.ENTITY_DISK:u=[{sTitle:"",mData:i.ID,sWidth:"15px",sClass:"center",bSortable:!1,bSearchable:!1,mRender:function(t){return e.createDataRowCheckbox(t)}},{sTitle:"Disk ID",mData:i.DISK_UUID,sWidth:"20%",bSearchable:!0,mRender:function(e,a,r){var o=r[i.ID];return a===n.TABLE_COL_TYPE_EXPORT?o:t.HEALTH_ICON({healthIndicator:s.getJSONValue(r,i.HEALTH_STATUS)||n.UNKNOWN_VALUE})+o}},{sTitle:"Hypervisor IP",bSearchable:!0,mData:i.HOST_NAME,sWidth:"20%"},{sTitle:"Tier",bSearchable:!0,mData:i.TIER_NAME,sWidth:"10%"},{sTitle:"Disk Usage",sWidth:"20%",bSearchable:!1,sClass:"right",mData:i.TOT_USED_PCT},{sTitle:"Disk IOPS",mData:i.STATS+"."+i.STATS_NUM_IOPS,sWidth:"10%",sClass:"right",bSearchable:!1,mRender:function(e,t,n){return h.renderStatsValue(i.STATS_NUM_IOPS,e,t,n,!1)}},{sTitle:"Disk IO B/W",mData:i.STATS+"."+i.STATS_BANDWIDTH,sWidth:"10%",sClass:"right",bSearchable:!1,mRender:function(e,t,n){return h.renderStatsValue(i.STATS_BANDWIDTH,e,t,n)}},{sTitle:"Disk Avg IO Latency",mData:i.STATS+"."+i.STATS_AVG_IO_LATENCY,sWidth:"8%",sClass:"right",bSearchable:!1,mRender:function(e,t,n){return h.renderStatsValue(i.STATS_AVG_IO_LATENCY,e,t,n)}}];break;case n.ENTITY_VM:u=[{sTitle:"",mData:i.ID,sWidth:"15px",sClass:"center",bSortable:!1,bSearchable:!1,mRender:function(t){return e.createDataRowCheckbox(t)}},{sTitle:"VM Name",mData:i.VM_NAME,sWidth:"30%",sClass:n.STYLE_ALERT_TABLE_INDICATOR,bSearchable:!0,mRender:function(e,a,r){return a===n.TABLE_COL_TYPE_EXPORT?e:t.HEALTH_ICON({healthIndicator:s.getJSONValue(r,i.HEALTH_STATUS)||n.UNKNOWN_VALUE})+_.escape(e)}},{sTitle:"Host",mData:i.VM_HOST_NAME,bSearchable:!0,sWidth:"20%"},{sTitle:"CPU Usage",mData:i.STATS+"."+i.STATS_HYP_CPU_USAGE,sWidth:"10%",sClass:"right",bSearchable:!1,mRender:function(e,t,n){return h.renderStatsValue(i.STATS_HYP_CPU_USAGE,e,t,n)}},{sTitle:"Memory Usage",mData:i.STATS+"."+i.STATS_MEMORY_USAGE,sWidth:"10%",sClass:"right",bSearchable:!1,mRender:function(e,t,s){var r=s&&s[i.HYPERVISOR_TYPE],o=i.STATS_MEMORY_USAGE;return a.isVMMemoryMetricSupported(o,s.clusterUuid,r)?h.renderStatsValue(o,e,t,s):n.STATS_NOT_APPLICABLE}},{sTitle:"Controller IOPS",mData:i.STATS+"."+i.STATS_CONTROLLER_NUM_IOPS,sWidth:"10%",sClass:"right",bSearchable:!1,mRender:function(e,t,n){return h.renderStatsValue(i.STATS_CONTROLLER_NUM_IOPS,e,t,n,!1)}},{sTitle:"Controller IO B/W",mData:i.STATS+"."+i.STATS_CONTROLLER_BANDWIDTH,sWidth:"10%",sClass:"right",bSearchable:!1,mRender:function(e,t,n){return h.renderStatsValue(i.STATS_CONTROLLER_BANDWIDTH,e,t,n)}},{sTitle:"Controller Avg IO Latency",mData:i.STATS+"."+i.STATS_CONTROLLER_AVG_IO_LATENCY,sWidth:"10%",sClass:"right",bSearchable:!1,mRender:function(e,t,n){return h.renderStatsValue(i.STATS_CONTROLLER_AVG_IO_LATENCY,e,t,n)}}],r.hasHyperV()&&u.splice(4,1);break;case n.ENTITY_PROTECTION_DOMAIN:u=[{sTitle:"Name",mData:i.PD_NAME,sClass:"left",sWidth:"30%",bSearchable:!0,mRender:function(e,t,i){return t===n.TABLE_COL_TYPE_DISPLAY?_.escape(e):e}},{sTitle:"Remote Sites",mData:i.PD_REMOTE_SITES,sWidth:"20%",bSearchable:!0,mRender:function(e,t,i){return e?e.join(", "):"&nbsp;"}},{sTitle:"VMs",mData:i.PD_VMS,sWidth:"10%",sClass:"right",bSearchable:!1,mRender:function(e,t,i){return e?e.length:0}},{sTitle:"Next Snapshot Time",mData:i.PD_NEXT_SNAPSHOT_TIME,sWidth:"20%",sClass:"right",bSearchable:!1,mRender:function(e,t,i){return e?l.formatDateTime(e>0?e/1e3:0):"No Schedule"}},{sTitle:"Changed Bytes",mData:i.PD_TOTAL_USER_BYTES,sWidth:"10%",sClass:"right",bSearchable:!1,mRender:h.renderStorageStats},{sTitle:"Ongoing",mData:i.PD_ONGOING_REPS,sWidth:"5%",sClass:"right",bSearchable:!1},{sTitle:"Pending",mData:i.PD_PENDING_REPS,sWidth:"5%",sClass:"right",bSearchable:!1}];break;case n.ENTITY_REMOTE_SITE:u=[{sTitle:"Name",mData:i.RS_NAME,sWidth:"30%",bSearchable:!0,sClass:n.STYLE_ALERT_TABLE_INDICATOR},{sTitle:"Remote Addresses",mData:i.RS_REMOTE_ADDRESS,sWidth:"30%",bSearchable:!0,mRender:function(e,t,i){var n="";return _.each(_.keys(e),function(t,i,s){n+=t+(null===e[t]?"":":"+e[t])+(i+1<s.length?", ":"")}),n}},{sTitle:"Capabilities",mData:i.RS_CAPABILITIES,sWidth:"20%",bSearchable:!0,mRender:function(e,t,i){return(e||[]).map(function(e){return n.RS_CAPABILITY_NAMES[e]}).join(", ")}},{sTitle:"Compress on wire",mData:i.RS_COMPRESSION_ENABLED,sWidth:"10%",bSearchable:!1,mRender:function(e,t,i){return e?"On":"Off"}},{sTitle:"B/W Limit (Tx)",mData:i.RS_MAX_BPS,sWidth:"10%",sClass:"right",bSearchable:!1,mRender:function(e,t,i){return t===n.TABLE_COL_TYPE_DISPLAY||t===n.TABLE_COL_TYPE_EXPORT?e?a.bandwidthFormat(e/1e3):n.STATS_NOT_AVAILABLE:e}}];break;case n.ENTITY_STORAGE_POOL:u=[{sTitle:"Name",mData:i.NAME,sortKey:i.SP_NAME,bSearchable:!0,sWidth:"40%",sClass:n.STYLE_ALERT_TABLE_INDICATOR},{sTitle:"Disks",mData:i.DISKS,sWidth:"15%",sClass:"right",bSearchable:!1,sortKey:i.SP_NUM_DISKS,mRender:function(e,t,i){return e?e.length:0}},{sTitle:"Free (Physical)",sWidth:"15%",sClass:"right",bSearchable:!1,sortKey:i.NEW_FREE_BYTES_PHYSICAL,mData:function(e,t,n){var s=e[i.FREE_CAPACITY];return h.renderStorageStats(s,t,e)},ntnxTooltip:o.STORAGE_STATS.STORAGE_POOL_FREE.ID},{sTitle:"Used (Physical)",sWidth:"15%",sClass:"right",bSearchable:!1,sortKey:i.NEW_TOT_USED_PHY,mData:function(e,t,n){var s=e[i.TOT_USED_PHY];return h.renderStorageStats(s,t,e)},ntnxTooltip:o.STORAGE_STATS.STORAGE_POOL_USED.ID},{sTitle:"Max Capacity (Physical)",sWidth:"15%",sClass:"right",bSearchable:!1,sortKey:i.NEW_TOT_CAPACITY,mData:function(e,t,n){var s=e[i.CAPACITY];return h.renderStorageStats(s,t,e)},ntnxTooltip:o.STORAGE_STATS.STORAGE_POOL_MAX.ID}];break;case n.ENTITY_CONTAINER:u=[{sTitle:"Name",mData:i.NAME,sortKey:i.CTR_NAME,sWidth:"30%",sClass:n.STYLE_ALERT_TABLE_INDICATOR,bSearchable:!0},{sTitle:"RF",mData:i.RF,sortKey:i.CTR_RF,sWidth:"10%",bSearchable:!1},{sTitle:"Compression",mData:i.COMPRESSION_DELAY_SECS,sWidth:"10%",sortKey:i.CTR_COMPRESSION,bSearchable:!1,mRender:function(e,s,a){var r,o=a[i.COMPRESSION_ENABLED],l=!0===o?"On":"Off";return s===n.TABLE_COL_TYPE_DISPLAY?(r=t.CONTAINER_TABLE_CELL({value:l,width:"24px"}),e&&(r+=" ("+a[i.COMPRESSION_DELAY_SECS]/60+" min)"),r):l}},{sTitle:"Perf-Tier Deduplication",mData:i.FINGER_PRINT_ON_WRITE,sWidth:"10%",sortKey:i.CTR_FINGER_PRINT,bSearchable:!1,mRender:function(e,a,r){var o=r[i.FINGER_PRINT_ON_WRITE]||"";return o===n.FINGER_PRINT_ON_WRITE.NONE&&(o=n.FINGER_PRINT_ON_WRITE.OFF),o=s.toUpperCaseFirstChar(o),a===n.TABLE_COL_TYPE_DISPLAY?t.CONTAINER_TABLE_CELL({value:o,width:"auto"}):o}},{sTitle:"On Disk Deduplication",mData:i.ON_DISK_DEDUP,sWidth:"10%",sortKey:i.CTR_FINGER_PRINT,bSearchable:!1,mRender:function(e,a,r){var o=r[i.ON_DISK_DEDUP]||"";return o===n.FINGER_PRINT_ON_WRITE.NONE&&(o=n.FINGER_PRINT_ON_WRITE.OFF),o=o.replace(/_/g," "),o=s.toUpperCaseFirstChar(o),a===n.TABLE_COL_TYPE_DISPLAY?t.CONTAINER_TABLE_CELL({value:o,width:"100px"}):o}},{sTitle:"Free (Logical)",sWidth:"10%",sClass:"right",bSearchable:!1,sortKey:i.NEW_FREE_BYTES_LOGICAL,mData:function(e,t,n){var s=e[i.NEW_FREE_BYTES_LOGICAL];return h.renderStorageStats(s,t,e)},ntnxTooltip:o.STORAGE_STATS.CONTAINER_FREE.ID},{sTitle:"Used",sWidth:"10%",sClass:"right",bSearchable:!1,sortKey:i.NEW_CONTAINER_OWN_USAGE_LOGICAL,mData:function(e,t,n){var s=e[i.NEW_CONTAINER_OWN_USAGE_LOGICAL];return h.renderStorageStats(s,t,e)},ntnxTooltip:o.STORAGE_STATS.CONTAINER_USED.ID},{sTitle:this.renderEllipsedText("Max Capacity"),mData:function(e,t,n){var s=e[i.NEW_TOT_CAPACITY_LOGICAL];return h.renderStorageStats(s,t,e)},sortKey:i.NEW_TOT_CAPACITY_LOGICAL,sWidth:"10%",sClass:"right",bSearchable:!1,ntnxTooltip:o.STORAGE_STATS.CONTAINER_MAX.ID}];break;case n.ENTITY_CLUSTER:u=[{sTitle:"Cluster Name",mData:i.NAME,sWidth:"50%",sClass:"left",bSortable:!0,bSearchable:!0},{sTitle:"Acropolis Version",mData:i.CLUSTER_NOS_VERSION,sWidth:"25%",sClass:"left",bSearchable:!0},{sTitle:"Hypervisor(s)",mData:"hypervisorTypes",sWidth:"25%",sClass:"left",bSearchable:!0,mRender:function(e,t,i){return _.reduce(e,function(e,t){return t?(t=n.HYPERVISOR_LABEL[t],e.length?e+=", "+t:t):e},"")}}];break;default:u=e.getDataColumns(c,d)}return u},getSearchPlaceHolderText:function(e){var t="";switch(e){case n.ENTITY_HOST:t="Search Hypervisor IP or CVM IP";break;case n.ENTITY_VM:t="Search VM name or Host";break;case n.ENTITY_DISK:t="Search Disk ID or Hypervisor IP";break;case n.ENTITY_PROTECTION_DOMAIN:t="Search Name or Remote Sites";break;case n.ENTITY_REMOTE_SITE:t="Search Name or Remote Addresses";break;case n.ENTITY_STORAGE_POOL:case n.ENTITY_CONTAINER:t="Search Name";break;case n.ENTITY_CLUSTER:t="Search Cluster Name or Acropolis Version"}return t}})}),define("views/pages/cluster/BaseHealthTableView",["views/basecomponents/datatables/BaseTableView","views/pages/cluster/ClusterHealthDataTableColumnProvider","data/DataProperties","models/vm/VMCollection","utils/AppUtil","utils/AppConstants"],function(e,t,i,n,s,a){"use strict";return e.extend({dataTableSortBy:null,initializeTableModel:function(t){this.entityType===a.ENTITY_VM?(this.model=new n,this.model.setProjection([a.PROJECTION.STATS])):e.prototype.initializeTableModel.apply(this,arguments)},onTableHeaderClick:function(e){var t=$(e.currentTarget),i=t.text(),n=this.getCurrentColumns(),s=_.find(n,function(e){return e.sTitle===i}),r=a.SORT_DESC;if(t.hasClass("sorting_"+a.SORT_DESC)&&(r=a.SORT_ASC),t.parent().children().removeClass("sorting_"+a.SORT_DESC+"sorting_"+a.SORT_ASC),s){var o=[s.mData,r];this.dataTableSortBy=o,this.options.sortChangeCB(o)}},setSelectedEntities:function(e){this.checkedDataIds=e},_isRowChecked:function(e){var t=String(e[i.ID]);return $.inArray(t,this.checkedDataIds)>=0},_isRowDisabled:function(e){return!s.getJSONValue(e,i.HEALTH_STATUS)},onStartServices:function(){this.delegateEvents(),this.delegateModelEvents(),this.render(),_.bindAll(this,"onTableHeaderClick"),this.$("th").on("click",this.onTableHeaderClick)},renderSubviews:function(){e.prototype.renderSubviews.apply(this,arguments);var i=t.getSearchPlaceHolderText(this.entityType);this.$(".n-table-filter").attr("placeholder",i).attr("title",i)},onDrawCallback:function(e){var t=this.dataTableSortBy||this.options.sortBy;if(t){var i=-1;_.each(e.aoColumns,function(e,n){e.mData===t[0]&&(i=n)},this);var n=this.$("th");$(n[i]).removeClass("sorting").addClass("sorting_"+t[1])}},updateNavigation:function(e){},renderSelectAllCheckbox:function(e){},updateActionView:function(){this.options.selectionChangeCB(this.entityType,this.checkedDataIds)},destroy:function(){this.$("th").off("click",this.onTableHeaderClick),e.prototype.destroy.apply(this,arguments)},updateDataSource:function(e){this.model.reset(e)},refreshData:function(){this.model.trigger("reset")}})}),define("views/pages/cluster/EntityTypeGroupByTableView",["views/pages/cluster/ClusterHealthDataTableColumnProvider","views/pages/cluster/BaseHealthTableView","utils/AppConstants","data/DataProperties"],function(e,t,i,n){"use strict";return t.extend({getDefaultColumns:function(t,s){var a=e.getDataColumns(t,s);return a=e.appendColumn(a,{sTitle:"Group",mData:n.GROUP,sWidth:"12%",sClass:"left",bSortable:!0,mRender:function(e,t,s){return t===i.TABLE_COL_TYPE_EXPORT?e:"<span class='group-link group-table-link' data-id='"+s[n.GROUPID]+"'>"+e+"</span>"}},12,"center"),_.each(a,function(e){e.bSortable=!1}),a}})}),define("text!templates/pages/cluster/GroupRowView.html",[],function(){return"<div id='etg-<%=group.id%>'\n     class='groupStats <%= bIsActive ? \"active-group\" : \"\" %>'\n     id='group-stats-<%=group.id%>'>\n  <div class='group-name' data-id='<%=group.id%>'>\n    <div class=\"count-badge-small total-count-badge\n                <%= nbChildren > 0 ? '' : 'count-box-zero' %>\">\n      <%= nbChildren %>\n    </div>\n    <span class=\"group-header\" title=\"<%= groupBy %> : <%= group.name %>\">\n      <%= displayName || group.displayName %>\n    </span>\n    <%= groupVisual %>\n  </div>\n  <div class=\"group-counts-box pull-right\" data-id='<%=group.id%>'>\n    <div class=\"count-box count-box-critical\n               <%= healthStats.Critical != 0 ? '' : 'count-box-zero' %>\">\n      <span class=\"count-box-number\"><%= healthStats.Critical %></span>\n      <div class=\"count-badge-large critical-count-badge\">&nbsp;</div>\n    </div>\x3c!-- This comment aids in layout for formatting\n --\x3e<div class=\"count-box count-box-warning\n              <%= healthStats.Warning != 0 ? '' : 'count-box-zero' %>\">\n      <span class=\"count-box-number\"><%= healthStats.Warning %></span>\n      <div class=\"count-badge-large warning-count-badge\">&nbsp;</div>\n    </div>\x3c!-- This comment aids in layout for formatting\n --\x3e<div class=\"count-box count-box-good\n               <%= healthStats.Good != 0 ? '' : 'count-box-zero' %>\">\n      <span class=\"count-box-number\"><%= healthStats.Good %></span>\n      <div class=\"count-badge-large good-count-badge\">&nbsp;</div>\n    </div>\x3c!-- This comment aids in layout for formatting\n--\x3e</div>\n  \x3c!-- The children's container--\x3e\n  <div\n    class='<%= (groupChildrenHTML && (nbChildren > 0)) ?\n            \"group-children-container\" : \"group-no-children-container\"%>'\n    id='group-children-container-<%=group.id%>'>\n    <div class=\"group-children\">\n      <%= groupChildrenHTML || \"\" %>\n    </div>\n    <span class='group-children-all-link' data-id='<%=group.id%>'>\n      See all \x3c!--<%= nbChildren %>--\x3e in this group\n    </span>\n    <span class='group-children-none-text' data-id='<%=group.id%>'>\n      None in this group\n    </span>\n  </div>\n</div>"}),define("views/pages/cluster/EntityTypeGroupByView",["views/basecomponents/BaseView","antiscroll","fancyselect","utils/AppUtil","utils/SubViewHelper","utils/AppConstants","utils/VisualizationUtil","components/Components","data/DataProperties","views/pages/cluster/ClusterHealthDataTableColumnProvider","views/pages/cluster/EntityTypeGroupByTableView","text!templates/pages/cluster/GroupRowView.html"],function(e,t,i,n,s,a,r,o,l,c,d,u){"use strict";var h=l.HEALTH_STATUS,p=_.template(u),T=_.template('<div class="groupByDetails">  <div class="group-by-header">    <a class="group-details-back n-icon">x</a>    <span class="n-divider"></span>    <div class="group-select-dropdown dropdown">      <a class="dropdown-toggle group-selector" href="#"         data-toggle="dropdown">        <div class="group-child-selector-wrapper">         <div class="group-child-selector"></div>        </div>      </a>      <ul class="dropdown-menu dropdown-menu-left">       <li><a class="select-option" data-id="all">         Select All       </a></li>       <li><a class="select-option" data-id="Critical">         Select Critical       </a></li>       <li><a class="select-option" data-id="Warning">         Select Warning       </a></li>       <li><a class="select-option" data-id="Good">         Select Good       </a></li>       <li><a class="select-option" data-id="none">         Clear Selection       </a></li>      </ul>    </div>    <div class="pull-right group-sortby">    </div>  </div>  <div class="groups-summary"></div>  <div class="groupsContainer groups-grid"></div>  <div class="groupsContainer groups-tbl">    <div class="n-base-data-table"></div>  </div></div>'),E=_.template('  <div class="group-child-sortby dropdown"     data-class="n-select-options-align-right">    <a data-toggle="dropdown" class="btn btn-default dropdown-toggle">      <%= i18n("sortBy") %> '+o.icon("z","-down-arrow")+'    </a>    <ul class="dropdown-menu dropdown-menu-right">      <% _.each(sortOptions, function(opt) { %>        <%  var s = ""; %>        <%  if (opt.value === currentSortBy) s = " class=selected"; %>        <li<%= s %>>          <a class="sortby-link" data-id="<%=opt.value%>">            <%=opt.name%>          </a>        </li>      <% }) %>    </ul>  </div>'),g=_.template('<div class="groupby-summary">\n        <%= groupByText %>\n      </div>'),S=_.template('<div class="group-not-found">  Oops... The grouping you were viewing is no longer available.</div>');return e.extend({name:"EntityTypeGroupByView",MAX_GROUP_CHILDREN:40,events:{"click  .sortby-link":"onSortbyClick","click  .select-option":"onSelectOptionsClick","click  .group-details-back":"onGroupDetailsBack","click  .group-name":"onGroupClick","click  .group-counts-box":"onGroupClick","click  .group-link":"onGroupClick","click  .group-children-all-link":"onGroupClick","click  .count-box":"onCountBoxClick","click  .entity-circle":"onEntityCircleClick","mouseout  .entity-circle":"onEntityCircleMouseOut"},onGroupDetailsBack:function(){this.model.setSelectedGroupBy(null)},onSelectOptionsClick:function(e){var t=$(e.currentTarget).attr("data-id"),i=this.model.getCurrentGroupBy();if(i){var s=[];if(_.each(i.getGroups(),function(e){switch(t){case"all":s=s.concat(e.getMembersWithAssignedHealthStatus());break;case"none":break;case a.HEALTH_STATUS.CRITICAL:case a.HEALTH_STATUS.WARNING:case a.HEALTH_STATUS.GOOD:s=s.concat(e.getMembersByHealth(t))}}),s){var r=this.model.getSelectedEntityType(),o=n.getEntityIDs(s);this.model.setSelectedEntities(r,o),this.render()}}},onEntityCircleClick:function(e){e.stopPropagation();var t=$(e.currentTarget);if(!t.hasClass("other-count-badge")&&!t.hasClass("unknown-count-badge")){$(e.currentTarget).addClass("n-clicked");var i=t.attr("data-id"),n=$(e.currentTarget).attr("data-entityType"),s=this.model.getSelectedEntities(n);s.indexOf(i)>=0?(s=_.without(s,i),t.removeClass("selected")):(s.push(i),t.addClass("selected")),this.model.setSelectedEntities(n,s)}},onEntityCircleMouseOut:function(e){$(e.currentTarget).removeClass("n-clicked")},onGroupClick:function(e){e.stopPropagation();var t=$(e.currentTarget),i=t.parents(".groupStats"),n=t.parents().parents(".groupStats");if(t.hasClass("group-table-link")||i.hasClass("active-group")||n.hasClass("active-group")){var s=t.attr("data-id");this.model.setSelectedGroup(s)}},onCountBoxClick:function(e){e.stopPropagation();var t=$(e.currentTarget),i=t.parents(".groupStats");if(i.hasClass("active-group")){var n=i.attr("id"),s=n.indexOf("-"),a=n.substr(s+1);this.model.setSelectedGroup(a)}},onSortbyClick:function(){h=$(event.target).data("id"),this.onSortChange([h,this.model.DEFAULT_SORT_DIRECTION])},onSelectionChange:function(e,t){this.model.setSelectedEntities(e,t)},onSortChange:function(e){var t=this.model.getSortby();t[0]===e[0]&&t[1]===e[1]||(this.model.setSortby(e),this.render())},_renderGroupChildren:function(e){var t=this.model.getGroupEntities(e),i=this.model.getSelectedEntityType(),n=this.model.getSelectedEntities(i);return r.renderCirclesHTML(t,n,this.MAX_GROUP_CHILDREN,"large2")},_renderGroupsAsGrid:function(e,t){var i=t.getGroups(),n="";_.each(i,function(e){var i=e.getHealthStats(),s=r.renderHealthBar(i[a.HEALTH_STATUS.CRITICAL],i[a.HEALTH_STATUS.WARNING],i[a.HEALTH_STATUS.GOOD]),o=e.getMemberCount(),l=this._renderGroupChildren(e);n+=p({bIsActive:o>0,nbChildren:o,groupBy:t.get(t.nameAttribute),group:e.toJSON(),displayName:null,healthStats:e.getHealthStats(),groupVisual:s,groupChildrenHTML:l})},this),e.html(n),this.$(".count-box").addClass("count-box-disabled"),_.each(e.find(".entity-circle"),function(e){var t=$(e),i=t.attr("data-entityType"),n=t.attr("data-id"),s=i&&n?this.model.getEntity(i,n):null;r.renderEntityCircleTooltip(t,s)},this)},_renderGroupsAsTable:function(e,t){var i=this.model.getGroupByEntities(t),n=this.subViewHelper.get("tableView");n&&n.destroy();var s=this.model.getSelectedEntityType();n=new d({el:e,entityType:s,pageId:a.PAGE_CLUSTER_HEALTH,sortBy:this.model.getSortby(),selectionChangeCB:this.onSelectionChange,sortChangeCB:this.onSortChange}),this.subViewHelper.register("tableView",n),n.setSelectedEntities(this.model.getSelectedEntities(s)),n.startServices(),n.updateDataSource(i),n.goToFirstPage()},initialize:function(){n.log("EntityTypesGroupByView : initialize: "," | viewid     : "+this.cid),_.bindAll(this,"onSelectionChange","onSortChange"),this.subViewHelper=new s,this.$el.html(T({}))},onStartServices:function(){this.subViewHelper.iterate("onStartServices")},onStopServices:function(){this.subViewHelper.iterate("onStopServices")},render:function(){n.debug("EntityTypesGroupByView : render: "," | viewid     : "+this.cid);var e=this.model.getViewRenderType(),t=this.$(".groups-"+e),i=this.model.getCurrentGroupBy();if(!i)return n.debug("GroupDetailsView : render","Ooops... Group not found"),this.$(".groups-summary").html(""),void t.html(S);r.clearTooltips(this.$(".entity-circle")),this.$(".groupsContainer").hide();var s=0;_.each(i.getGroups(),function(e){s+=e.getMemberCount()});var o=this.model.getSelectedEntityType(),d=this.model.getEntityTypeName(o,!1),u=i.get(i.nameAttribute),p=g({groupByText:this.i18ns("groupByText",{entityTypeName:d,groupBy:u})});this.$(".groups-summary").html(p),e===this.model.VIEW_RENDER_TYPE_GRID?this._renderGroupsAsGrid(t,i):this._renderGroupsAsTable(t.find(".n-base-data-table"),i),$(t.find(".n-base-data-table")).addClass("n-entity-table"),t.show();var T=c.getDataColumns(o,a.PAGE_CLUSTER_HEALTH),m=this.getSortbyOptions(T);m.push({name:"Group",value:l.GROUP}),this.$(".group-sortby").html(E(this.vtOptions({sortOptions:m,currentSortBy:h}))),this.$(".group-child-sortby").val(this.model.getSortby()[0]),this.applyNutanixInput({types:["select"]})},getSortbyOptions:function(e){var t=[{name:"Health",value:l.HEALTH_STATUS}];return _.each(e,function(e){!1!==e.bSortable&&t.push({name:e.sTitle,value:e.mData})}),t},destroy:function(){n.debug("EntityTypeGroupByView : destroy: "," | viewid     : "+this.cid),r.clearTooltips(this.$(".entity-circle")),e.prototype.destroy.apply(this,arguments)}})}),define("views/pages/cluster/GroupDetailsTableView",["views/pages/cluster/ClusterHealthDataTableColumnProvider","views/pages/cluster/BaseHealthTableView"],function(e,t){"use strict";return t.extend({getDefaultColumns:function(t,i){var n=e.getDataColumns(t,i),s=[].concat(n);return _.each(s,function(e){e.bSortable=!1}),s}})}),define("views/pages/cluster/GroupDetailsView",["views/basecomponents/BaseView","utils/AppUtil","utils/SubViewHelper","utils/AppConstants","utils/VisualizationUtil","components/Components","data/DataProperties","views/pages/cluster/ClusterHealthDataTableColumnProvider","views/pages/cluster/GroupDetailsTableView","text!templates/pages/cluster/GroupRowView.html"],function(e,t,i,n,s,a,r,o,l,c){"use strict";var d=r.HEALTH_STATUS,u=_.template(c),h=_.template('<div class="groupDetails">  <div class="group-details-header">    <a class="group-details-back n-icon">x</a>    <span class="n-divider"></span>    <div class="group-select-dropdown dropdown">      <a class="dropdown-toggle group-selector" href="#"         data-toggle="dropdown">        <div class="group-child-selector-wrapper">         <div class="group-child-selector"></div>        </div>      </a>      <ul class="dropdown-menu dropdown-menu-left">       <li><a class="select-option" data-id="all">         Select All       </a></li>       <li><a class="select-option"          data-id="<%= AppConstants.HEALTH_STATUS.CRITICAL %>">         Select Critical       </a></li>       <li><a class="select-option"          data-id="<%= AppConstants.HEALTH_STATUS.WARNING %>">         Select Warning       </a></li>       <li><a class="select-option"          data-id="<%= AppConstants.HEALTH_STATUS.GOOD %>">         Select Good       </a></li>       <li><a class="select-option" data-id="none">         Clear Selection       </a></li>      </ul>    </div>    <div class="pull-right group-sortby">    </div>  </div>  <div class="group-details-visual"></div></div><div class="groupChildren groupChildren-grid"></div><div class="groupChildren groupChildren-tbl">  <div class="n-base-data-table"></div></div><div class="groupChildren-footer">  <span class="back-link">     <i class="n-icon" data-icon="x" aria-hidden="true"></i>    <span class="back-link-text">Back to all groups</span>  </span></div>'),p=_.template('  <div class="group-child-sortby dropdown"     data-class="n-select-options-align-right">    <a data-toggle="dropdown" class="btn btn-default dropdown-toggle">      <%= i18n("sortBy") %> '+a.icon("z","-down-arrow")+'    </a>    <ul class="dropdown-menu dropdown-menu-right">      <% _.each(sortOptions, function(opt) { %>        <%  var s = ""; %>        <%  if (opt.value === currentSortBy) s = " class=selected"; %>        <li<%= s %>>          <a class="sortby-link" data-id="<%=opt.value%>">            <%=opt.name%>          </a>        </li>      <% }) %>    </ul>  </div>'),T=_.template('<div class="group-summary"><%= group.description %> </div>'),E=_.template('<div class="group-not-found">  Oops... The group you were viewing is no longer available.</div>');return e.extend({name:"GroupDetailsView",events:{"click  .sortby-link":"onSortbyClick","click  .group-details-back":"onGroupDetailsBack","click  .back-link":"onGroupDetailsBack","click  .select-option":"onSelectOptionsClick","click  .entity-circle":"onEntityCircleClick","mouseout  .entity-circle":"onEntityCircleMouseOut"},MAX_GROUP_CHILDREN:400,onSelectOptionsClick:function(e){var i=$(e.currentTarget).attr("data-id"),s=this.model.getCurrentGroup();if(!s)return void t.debug("GroupDetailsView : onSelectOptionsClick","Ooops... Group not found");var a=null;switch(i){case"all":a=s.getMembersWithAssignedHealthStatus();break;case"none":a=[];break;case n.HEALTH_STATUS.CRITICAL:case n.HEALTH_STATUS.WARNING:case n.HEALTH_STATUS.GOOD:a=s.getMembersByHealth(i)}if(a){var r=this.model.getSelectedEntityType(),o=t.getEntityIDs(a);this.model.setSelectedEntities(r,o),this.render()}},onEntityCircleClick:function(e){var t=$(e.currentTarget);if(!t.hasClass("other-count-badge")&&!t.hasClass("unknown-count-badge")){$(e.currentTarget).addClass("n-clicked");var i=t.attr("data-id");_.isNumber(i)&&(i=Number(i));var n=$(e.currentTarget).attr("data-entityType"),s=this.model.getSelectedEntities(n);s.indexOf(i)>=0?(s=_.without(s,i),t.removeClass("selected")):(s.push(i),t.addClass("selected")),this.model.setSelectedEntities(n,s)}},onEntityCircleMouseOut:function(e){$(e.currentTarget).removeClass("n-clicked")},onSortbyClick:function(){d=$(event.target).data("id"),this.onSortChange([d,this.model.DEFAULT_SORT_DIRECTION])},onGroupDetailsBack:function(){var e=this.model.getSelectedEntityType(),t=this.model.getPreviousGroupBy(e);this.model.setSelectedGroupBy(this.model.getGroupBy(e,t)?t:null),this.model.setSelectedGroup(null)},onSortChange:function(e){var t=this.model.getSortby();t[0]===e[0]&&t[1]===e[1]||(this.model.setSortby(e),this.render())},onSelectionChange:function(e,t){this.model.setSelectedEntities(e,t)},_renderGroupChildrenAsCircles:function(e,t,i){var n=this.model.getGroupEntities(i),a=this.model.getSelectedEntities(t),r=s.renderCirclesHTML(n,a,this.MAX_GROUP_CHILDREN,null);e.html(r),_.each(e.find(".entity-circle"),function(e){var t=$(e),i=t.attr("data-entityType"),n=t.attr("data-id"),a=i&&n?this.model.getEntity(i,n):null;s.renderEntityCircleTooltip(t,a)},this)},_renderGroupChildrenAsTable:function(e,t,i){var s=this.model.getGroupEntities(i),a=this.subViewHelper.get("tableView");a&&a.destroy(),a=new l({el:e,entityType:t,pageId:n.PAGE_CLUSTER_HEALTH,sortBy:this.model.getSortby(),selectionChangeCB:this.onSelectionChange,sortChangeCB:this.onSortChange}),this.subViewHelper.register("tableView",a),a.setSelectedEntities(this.model.getSelectedEntities(t)),a.startServices(),a.updateDataSource(s),a.goToFirstPage()},initialize:function(){t.log("GroupDetailsView : initialize: "," | viewid     : "+this.cid),_.bindAll(this,"onSelectionChange","onSortChange"),this.subViewHelper=new i,this.$el.html(h({AppConstants:n}))},onStartServices:function(){this.subViewHelper.iterate("onStartServices")},onStopServices:function(){this.subViewHelper.iterate("onStopServices")},render:function(){t.debug("GroupDetailsView : render: "," | viewid     : "+this.cid),this.$(".groupChildren").hide();var e=this.model.getCurrentGroupBy(),i=this.model.getCurrentGroup(),a=this.model.getViewRenderType();if(!i)return t.debug("GroupDetailsView : render","Ooops... Group not found"),void this.$(".group-details-visual").html(E);s.clearTooltips(this.$(".entity-circle"));var r,l=i.get("healthStats"),c=s.renderHealthBar(l[n.HEALTH_STATUS.CRITICAL],l[n.HEALTH_STATUS.WARNING],l[n.HEALTH_STATUS.GOOD]),h=i.getMemberCount(),g=this.model.getSelectedEntityType(),_=i.toJSON(),S=T({group:_});_&&_.displayName&&_.displayName!==n.UNKNOWN_VALUE&&(r=_.displayName),S+=u({bIsActive:!1,nbChildren:h,groupBy:e.get(e.nameAttribute),group:_,displayName:r,healthStats:i.getHealthStats(),groupVisual:c,groupChildrenHTML:null}),this.$(".group-details-visual").html(S),this.$(".count-box").addClass("count-box-disabled");var m=this.$(".groupChildren-"+a);a===this.model.VIEW_RENDER_TYPE_GRID?this._renderGroupChildrenAsCircles(m,g,i):this._renderGroupChildrenAsTable(m.find(".n-base-data-table"),g,i),m.show();var v=o.getDataColumns(g,n.PAGE_CLUSTER_HEALTH);this.$(".group-sortby").html(p(this.vtOptions({sortOptions:this.getSortbyOptions(v),currentSortBy:d}))),this.$(".group-child-sortby").val(this.model.getSortby()[0]),this.applyNutanixInput({types:["select"]})},getSortbyOptions:function(e){var t=[{name:"Health",value:r.HEALTH_STATUS}];return _.each(e,function(e){!1!==e.bSortable&&t.push({name:e.sTitle,value:e.mData})}),t},destroy:function(){t.debug("GroupDetailsView : destroy: "," | viewid     : "+this.cid),s.clearTooltips(this.$(".entity-circle")),this.subViewHelper.removeAll(),e.prototype.destroy.apply(this,arguments)}})}),define("views/pages/cluster/TestsFilterView",["underscore","jquery","views/basecomponents/BaseView","components/Components","utils/AppUtil","data/DataProperties","models/cluster/ClusterHealthModel"],function(e,t,i,n,s,a,r){"use strict";var o=e.template('<li class="<%=filterType%>-filter <%=viewTypeCls%>-checks" filter-text="<%=viewType%>" filter-type="<%=filterType%>"><div class="clearfix"><span class="col-xs-1"><%= Components.radio({name: filterType, id: viewTypeCls + compId + "-check", checked: checked}) %></span><span class="col-xs-1"><%=icon%></span><span class="col-xs-7"><%=viewTypeName%></span><span class="col-xs-1"><%=count%></span></div></li>'),l={STATUS:"status",TYPE:"type"};return i.extend({events:{"click li.status-filter":"onFilter","click li.type-filter":"onFilter","click li.entity-filter":"onFilter","click .selected-filter .btn-close":"removeFilter","click .filter-action.filter-clear":"resetFilters","click .btn.filter":"filterPanelOpen","click .close-panel":"filterPanelClose","click .cancel-filter":"closeResetFilterPanel","click .apply-filter":"onApplyFilter"},noFiltersHTML:'<span class="no-filters text-muted">No filters applied, Showing all.</span>',filterHTML:e.template('<span class="selected-filter selected-<%= filterType%>" filter-type="<%=filterType%>"><%= displayName %><i data-icon="v" aria-hidden="true" class="btn-close"></i></span>'),
entityFiltersHTML:e.template('<li class="entity-filter <%=entityType%>-checks" filter-text="<%=entityType%>" filter-type="entity"><div class="clearfix"><span class="col-xs-1"><%= Components.radio({name: "entity-type", id: entityType + compId + "-check", checked: checked}) %></span><span class="col-xs-8"><%=entityTypeName%></span><span class="col-xs-1"><%=count%></span></div></li>'),filterControls:'<li class="filter-controls clearfix"><span class="filter-action filter-close pull-right"><a href="javascript:void(0)">Close</a></span></li>',model:null,selectedFilters:[],eventBus:null,initialize:function(e){e&&e.eventBus&&(this.eventBus=e.eventBus,this.eventBus.bind("showTabWithResetFilter",this.resetFilters.bind(this)),this.eventBus.bind("tabChanged",this.onTabChanged.bind(this)),this.eventBus.bind("testViewResized",this.onTestViewResized.bind(this)),this.closeFilters())},filterPanelOpen:function(){this.$(".filter-panel").addClass("open"),this.$(".tests-list").hide(),this.eventBus.trigger("testPanelStateChanged",!0),this.setFilterPanelHeight()},filterPanelClose:function(){this.eventBus.trigger("testPanelStateChanged",!1),this.$(".filter-panel").removeClass("open")},closeResetFilterPanel:function(e){this.filterPanelClose(),this.resetFilters(e,!0)},onTabChanged:function(){this.isFilterPanelOpen()&&this.filterPanelClose()},onTestViewResized:function(){this.isFilterPanelOpen()&&this.setFilterPanelHeight()},isFilterPanelOpen:function(){return this.$(".filter-panel").hasClass("open")},setFilterPanelHeight:function(){var e=this.$(".filter-panel"),i=this.$(".filter-header").height(),n=this.$(".filter-header").height(),s=i+n+20,a=t(window).height()-e.offset().top;e.height(a),this.$(".filter-menu-container").height(a-s)},onApplyFilter:function(){var i=this.getFilterContainer(),n=i.find("input:radio:checked"),s=this;e.each(n,function(e){var i=t(e).parents("li");s.selectedFilters.push({filterType:t(i).attr("filter-type"),text:t(i).attr("filter-text")})}),e.each(this.selectedFilters,function(e){if(e.filterType===l.STATUS)e.text!==this.model.getTestsViewType()&&this.model.setTestsViewType(e.text,{},!0);else if(e.filterType===l.TYPE){var t=e.text;t===this.model.ALL_ENTITIES&&(t=null),this.model.setTestsTriggeredType(t,{},!0)}else if(e.text!==this.model.getSelectedEntityType()){var i=e.text;i===this.model.ALL_ENTITIES&&(i=null),this.model.setSelectedEntityType(i,{},!0)}},this),this.model._triggerChangeEvent("selectedEntityType"),this.filterPanelClose()},addStatusFilters:function(i,n,a,r){this.hasFilterControls()&&i.append(t('<li class="category">Filter by Status</li>')),e.each(this._getDisplayedStatuses(),function(e){var t=s.toTitleCase(e),o=this._filterByStatus(n,e).length,c="";e===a&&(c="checked"),i.append(this.renderStatusFilter({viewType:e,viewTypeCls:this.getClassName(e),compId:s.generateClientUUID(),filterType:l.STATUS,viewTypeName:t,icon:r[e],count:o,checked:c}))},this)},addTriggeredTypeFilters:function(i,n,a,o){i.append(t('<li class="category">Filter by Type</li>')),e.each(this._getDisplayedTriggeredTypes(),function(e){var t=s.toTitleCase(e),r=this._filterByCheckType(n,e).length,c="";e===a&&(c="checked"),i.append(this.renderStatusFilter({viewType:e,viewTypeCls:this.getClassName(e),compId:s.generateClientUUID(),filterType:l.TYPE,viewTypeName:t,icon:o[e],count:r,checked:c}))},this);var c=this.getIcons(),d=c[r.prototype.TESTS_VIEW_TYPE.ALL_TESTS];i.append(this.renderStatusFilter({viewType:this.model.ALL_ENTITIES,viewTypeCls:this.getClassName(this.model.ALL_ENTITIES),compId:s.generateClientUUID(),filterType:l.TYPE,viewTypeName:s.toTitleCase(this.model.ALL_ENTITIES),icon:d,count:n.length,checked:null===a}))},addEntityTypeFilters:function(i,n,a){var r=this.getEntityTypes();r&&r.length>0&&(i.append(t('<li class="category">Filter by Entity Type</li>')),e.each(r,function(e){var t=this.model.getTestsForEntityType(e),n="";e===a&&(n="checked"),i.append(this.renderEntityFilter({entityType:e,entityTypeName:this.model.getEntityTypeName(e,!0),compId:s.generateClientUUID(),count:t.length,checked:n}))},this),i.append(this.renderEntityFilter({entityType:this.model.ALL_ENTITIES,entityTypeName:"All",compId:s.generateClientUUID(),count:n.length,checked:null===a})))},getClassName:function(t){return e.isString(t)||(t=""),t.replace(/\s/g,"-")},render:function(){var e=this.model.getAllTestsForDisplay(),t=this.model.getTestsViewType(),i=this.model.getTestsTriggeredType(),n=this.model.getSelectedEntityType(),s=this.getIcons(),a=this.getTriggeredIcons(),r=this.getFilterContainer();r.html(""),this.addStatusFilters(r,e,t,s),this.addTriggeredTypeFilters(r,e,i,a),this.addEntityTypeFilters(r,e,n),this.selectedFilters=[],this.loadFilters(!0)},renderStatusFilter:function(e){return o(this.vtOptions(e))},renderEntityFilter:function(e){return this.entityFiltersHTML(this.vtOptions(e))},loadFilters:function(e){var t=this.model.getTestsViewType(),i=this.model.getTestsTriggeredType(),n=this.model.getEntityTypeName(this.model.getSelectedEntityType(),!0);this.addFilter({filterType:l.STATUS,text:t},e),this.addFilter({filterType:"entity",text:n},e),this.addFilter({filterType:l.TYPE,text:i},e),this._loadFilters()},addFilter:function(e,t){var i=e.text===this.model.TESTS_VIEW_TYPE.ALL_TESTS;e.text===this.model.ALL_ENTITIES||!e.text||i||this.selectedFilters.push(e),t||this._loadFilters()},_loadFilters:function(){this.$(".filter-msg").html(""),e.each(this.selectedFilters,function(i){var n;n="status"===i.filterType?s.toTitleCase(i.text):"entity"===i.filterType?this.model.getEntityTypeName(i.text):i.text,this.$(".filter-msg").append(t(this.filterHTML(e.extend(i,{displayName:n}))))},this),0===this.selectedFilters.length&&this.$(".filter-msg").html(this.noFiltersHTML)},onFilter:function(e){},removeFilter:function(e){var i=t(e.currentTarget).parent(".selected-filter");this._removeFilter(i.attr("filter-type"))&&i.remove()},resetFilters:function(e,t){this.$(".filter-msg .selected-filter").remove(),this.selectedFilters=[],(this.model.TESTS_VIEW_TYPE.ALL_TESTS!==this.model.getTestsViewType()||t)&&this.model.setTestsViewType(this.model.TESTS_VIEW_TYPE.ALL_TESTS),this.model.getTestsTriggeredType()&&this.model.setTestsTriggeredType(null),this.model.getSelectedEntityType()&&this.model.setSelectedEntityType(null)},closeFilters:function(){this.$(".dropdown-toggle").removeClass("open")},_removeFilter:function(t){var i=e.find(this.selectedFilters,function(e){return e.filterType===t});if(i){if(this.selectedFilters=[],"status"===i.filterType)this.model.setTestsViewType(this.model.TESTS_VIEW_TYPE.ALL_TESTS);else if("type"===i.filterType)this.model.setTestsTriggeredType(null);else{this.model.setSelectedEntityType(null);var n=this.model.getSelectedGroup(),s=this.model.getSelectedGroupBy();n&&this.model.setSelectedGroup(null),s&&this.model.setSelectedGroupBy(null)}return!0}return!1},_filterByStatus:function(t,i){return i===this.model.TESTS_VIEW_TYPE.ALL_TESTS?t:e.filter(t,function(e){var t=this.model.getTestStatus(e.getId());switch(i){case r.prototype.TESTS_VIEW_TYPE.PASSING_TESTS:return e.isEnabled()&&e.isGood(t);case r.prototype.TESTS_VIEW_TYPE.FAILED_TESTS:return e.isEnabled()&&e.isFailing(t);case r.prototype.TESTS_VIEW_TYPE.WARNING_TESTS:return e.isEnabled()&&e.isWarning(t);case r.prototype.TESTS_VIEW_TYPE.ERROR_TESTS:return e.isEnabled()&&e.isError(t);case r.prototype.TESTS_VIEW_TYPE.DISABLED_TESTS:return!e.isEnabled()}},this)},_filterByCheckType:function(t,i){return e.filter(t,function(e){switch(e.get(a.TEST_CHECK_TYPE)){case a.HEALTH_CHECK_TYPE_VALUES.SCHEDULED:return i===r.prototype.TESTS_TRIGGERED_TYPE.SCHEDULED;case a.HEALTH_CHECK_TYPE_VALUES.UNSCHEDULED:return i===r.prototype.TESTS_TRIGGERED_TYPE.NOT_SCHEDULED;case a.HEALTH_CHECK_TYPE_VALUES.EVENT_DRIVEN:return i===r.prototype.TESTS_TRIGGERED_TYPE.EVENT_TRIGGERED}},this)},_getDisplayedStatuses:function(){return e.keys(this.getIcons())},_getDisplayedTriggeredTypes:function(){return e.keys(this.getTriggeredIcons())},getEntityTypes:function(){return this.model.getEntityTypes()},hasFilterControls:function(){return this.filterControls.length>0},getFilterContainer:function(){return this.$(".filter-menu")},onStopServices:function(){this.selectedFilters=[],this.eventBus&&(this.eventBus.unbind("showTabWithResetFilter",this.resetFilters.bind(this)),this.eventBus.unbind("tabChanged",this.onTabChanged,this),this.eventBus.unbind("testViewResized",this.onTestViewResized.bind(this))),this._loadFilters()},getIcons:function(){var e={};return e[r.prototype.TESTS_VIEW_TYPE.PASSING_TESTS]=this.getIconTemplate("check-thick","pass-icon"),e[r.prototype.TESTS_VIEW_TYPE.FAILED_TESTS]=this.getIconTemplate("x-square","failed-icon"),e[r.prototype.TESTS_VIEW_TYPE.WARNING_TESTS]=this.getIconTemplate("Exclamation_Mark","exclamation-icon"),e[r.prototype.TESTS_VIEW_TYPE.ERROR_TESTS]=this.getIconTemplate("error"),e[r.prototype.TESTS_VIEW_TYPE.DISABLED_TESTS]=this.getIconTemplate("Power"),e[r.prototype.TESTS_VIEW_TYPE.ALL_TESTS]=this.getIconTemplate("all_checks"),e},getTriggeredIcons:function(){var e={};return e[r.prototype.TESTS_TRIGGERED_TYPE.SCHEDULED]=this.getIconTemplate("Clock"),e[r.prototype.TESTS_TRIGGERED_TYPE.NOT_SCHEDULED]=this.getIconTemplate("not_scheduled"),e[r.prototype.TESTS_TRIGGERED_TYPE.EVENT_TRIGGERED]=this.getIconTemplate("event_triggered"),e},getIconTemplate:function(e,t){return t||(t=""),n.icon(e,t+" -small -inline")}})}),define("text!templates/pages/cluster/TestsView.html",[],function(){return'<div class="tests-filter">\n  <div class="filter-panel">\n      <div class="filter-header">\n        <span>APPLY FILTERS</span>\n        <i aria-hidden="true" data-icon="v" class="close-panel"></i>\n      </div>\n      <div class="filter-menu-container">\n        <ul class="filter-menu" role="menu">\n          \x3c!-- filters go here --\x3e\n        </ul>\n      </div>\n      <div class="filter-footer">\n        <button class="btnCancel btn pull-left btn-sm cancel-filter">\n          Clear Filters</button>\n        <button class="btnUpdate btn btn-primary pull-right btn-sm apply-filter">\n          Apply</button>\n      </div>\n    </div>\n  <div class="current-filters clearfix">\n    <div class="filter-msg"></div>\n    <div class="actions dropdown pull-right">\n      <button type="button" class="btn btn-default filter dropdown-toggle"\n              aria-label="filter">\n        <%= Components.icon(\'Filter\') %>\n      </button>\n      <button type="button" class="btn btn-default search-tests">\n        <%= Components.icon(\'mag-glass\') %>\n      </button>\n    </div>\n  </div>\n  <div class="tests-search">\n    <input class="test-search-input" type="text" placeholder="Search" value="">\n  </div>\n</div>\n<div class="tests-list">\n  <ul>\n    \x3c!-- Tests are rendered here...--\x3e\n  </ul>\n</div>\n\x3c!-- To show last NCC cluster check run time --\x3e\n<div class="last-test-run-wr hide">\n  <span>Last manual cluster check on </span>\n  <span id="last-test-run-date"></span>\n</div>'}),define("views/pages/cluster/TestsView",["jquery","views/basecomponents/BaseView","components/Components","utils/AppUtil","utils/SubViewHelper","utils/AppConstants","utils/TimeUtil","data/DataProperties","managers/TaskManager","views/pages/cluster/TestsFilterView","text!templates/pages/cluster/TestsView.html"],function(e,t,i,n,s,a,r,o,l,c,d){"use strict";var u=_.template(d),h=_.template('<li class="category"> <%= category  %></li>'),p=_.template(' <% if ( ! test.enabled ) { %>   <li class="test test-off <%=selectedClass%>"      data-count="<%=totalEntityCount%>" id="<%= test.id %>">'+i.icon("Power"," -small -inline")+' <% } else if ( isFailing ) { %>   <li class="test failIcon <%=selectedClass%>"      data-count="<%=totalEntityCount%>" id="<%= test.id %>">'+i.icon("x-square","failed-icon -small -inline")+' <% } else if ( isWarning ) { %>   <li class="test warningIcon <%=selectedClass%>"      data-count="<%=totalEntityCount%>" id="<%= test.id %>">'+i.icon("Exclamation_Mark","exclamation-icon -small -inline")+' <% } else if ( isError ){ %>   <li class="test textIcon <%=selectedClass%>"      data-count="<%=totalEntityCount%>" id="<%= test.id %>">'+i.icon("error"," -small -inline")+' <% } else { %>   <li class="test passIcon <%=selectedClass%>"      data-count="<%=totalEntityCount%>" id="<%= test.id %>">'+i.icon("check-thick","pass-icon -small -inline")+' <% } %> <div class="test-name" stream-action="select"   stream-target="<%= testName %>"><%= testName %></div> <div class="test-count">&nbsp;</div></li>'),T=_.template("<div class='no-data'>No checks match your selection.</div>"),E=_.template("<div class='test-tooltip'><% if ( msg ) { %><%= msg %><br><% } else if ( !msg && total <= 0 ) { %>This check has not run.<br><% } else { %>Results for <%= total %> entities.<br><div class=\"clearfix\"><span>"+i.icon("x-square","failed-icon -small -inline")+'</span><span>Failures</span><span class="pull-right"><%=nbCritical || "0"%></span></div><div class="clearfix"><span>'+i.icon("Exclamation_Mark","exclamation-icon -small -inline")+'</span><span>Warnings</span><span class="pull-right"><%=nbWarning || "0"%></span></div><div class="clearfix"><span>'+i.icon("check-thick","pass-icon -small -inline")+'</span><span>Successes</span><span class="pull-right"><%=nbGood || "0"%></span></div><div class="clearfix"><span>'+i.icon("error"," -small -inline")+'</span><span>Errors</span><span class="pull-right"><%=nbError || "0"%></span></div><% } %></div>');return t.extend({events:{"keyup .test-search-input":"onSearch","click li.test":"onTestClick","click .search-tests":"toggleSearchInput"},renderSelectedTest:!0,loadingHTML:"<div class='loading'><div class='donut-loader-blue'></div>&nbsp;Loading...</div>",errorHTML:"<div class='data-error'><i class='icon-warning-sign'></i>&nbsp;Error loading checks.</div>",noTestsHTML:"<div class='no-data'>No checks defined for this cluster.</div>",noMatchesHTML:"<div class='no-data'><span class='n-no-test-text'>No checks match your search.</span></div>",noMatchesFilterHTML:"<div class='no-data'><span class='n-no-test-text'>No checks match your current filter settings.</span></div>",testsCollection:null,delayedRenderTimer:null,eventBus:null,toggleSearchInput:function(){this.$(".tests-search").is(":visible")?(this.model.setTestsSearchTerm(null),this.$(".tests-search").hide(),this._renderTests()):(this.$(".tests-search").show(),this.$(".test-search-input").focus(),e.trim(this.$(".test-search-input").val()).length>0&&(this.model.setTestsSearchTerm(e.trim(this.$(".test-search-input").val())),this._renderTests()))},onTestClick:function(t){var i=e(t.currentTarget).attr("id");this.model.setSelectedTest(i)},onResize:function(){this.eventBus&&this.eventBus.trigger("testViewResized")},onSearch:function(){var e=this.$(".test-search-input").val().trim();this.model.setTestsSearchTerm(e),this._renderTests()},_renderTests:function(){var t=this.model.getTestsCollectionState();if(t===a.STATE_INIT||t===a.STATE_PENDING)this.$(".tests-list").html(this.loadingHTML);else if(t===a.STATE_ERROR)this.$(".tests-list").html(this.errorHTML);else if(t===a.STATE_SUCCESS){this._clearTooltips(),this.subViewHelper.renderAll(),this.subViewHelper.get("filterView").showView();var i=this.model.getSelectedEntityType();if(i){var n=this.model.getFilteredEntityCount(i);if(0===n)return void this.$(".tests-list").html(this.noMatchesFilterHTML)}var s=this.model.getWatchedEntities(),r=this.model.getTestsForDisplay(s);if(null===r)return void this.$(".tests-list").html(this.noTestsHTML);var o=this.model.getErredTestDetails(),l=r.groupedTests,c=r.testStatusMap,d=r.testCountsMap,u=_.keys(l);if(0===u.length){var g=this.model.getTestsViewType(),S=g===this.model.TESTS_VIEW_TYPE.ALL_TESTS;return void(S?this.$(".tests-list").html(this.noMatchesHTML):this.$(".tests-list").html(T({})))}u=_.sortBy(u,function(e){return e});var m=this.model.getSelectedTest(),v="<ul>",f={};_.each(u,function(e){var t=l[e];v+=h({category:e});var i=_.sortBy(t,function(e){return e.getDisplayName()});_.each(i,function(e){var t=e.get(e.idAttribute),i=c[t],n=d[t],s=n?n.total-n[a.HEALTH_STATUS.UNKNOWN]:"",r="";m&&this.renderSelectedTest&&m.get(m.idAttribute)===t&&(r="selected-test");var l="";if(e.isError(i)&&o[e.getHealthSummaryId()]){var u=o[e.getHealthSummaryId()];l=u.nodeLevel?"<span>Check resulted in an error on few nodes.</span>":u.clusterLevel[0].message}var h="";n&&(h=E({msg:l,nbError:n[a.HEALTH_STATUS.ERROR],total:s,nbCritical:n[a.HEALTH_STATUS.CRITICAL],nbWarning:n[a.HEALTH_STATUS.WARNING],nbGood:n[a.HEALTH_STATUS.GOOD]}),f[e.get(e.idAttribute)]=h),v+=p({test:e.toJSON(),testName:e.getDisplayName(),selectedClass:r,isFailing:e.isFailing(i),isWarning:e.isWarning(i),isError:e.isError(i),totalEntityCount:s})},this)},this),v+="</ul>",this.$(".tests-list").html(v);var A=this.$el.parent(".right-panel-inner-wrapper").length;_.each(this.$("li.test"),function(t){var i=e(t),n=i.attr("id");i.tooltip({placement:A?"left":"right",trigger:"hover",html:"true",title:f[n]})})}},_initializeSubViews:function(){this.subViewHelper?this.subViewHelper.register("filterView")&&this.subViewHelper.remove("filterView"):this.subViewHelper=new s;var e=new c({el:this.$(".tests-filter"),model:this.model,eventBus:this.eventBus});this.subViewHelper.register("filterView",e)},_delayedRenderTests:function(){var t=this;this.delayedRenderTimer&&(clearTimeout(this.delayedRenderTimer),this.delayedRenderTimer=null),this.$(".tests-list").html(this.loadingHTML),this.delayedRenderTimer=setTimeout(function(){t._renderTests(),e(window).trigger("resize")},250)},_clearTooltips:function(){_.each(this.$("li.test"),function(t){e(t).tooltip("destroy")})},_showTab:function(){this.$el.is(":visible")&&this.eventBus&&this.eventBus.trigger("showSelectedTab","tests")},initialize:function(e){n.debug("TestsView : initialize: "," | viewid     : ",this.cid),e&&void 0!==e.renderSelectedTest&&(this.renderSelectedTest=e.renderSelectedTest),e&&e.eventBus&&(this.eventBus=e.eventBus)},onStartServices:function(){this.model.on("change:testsChangeTrigger",this.render,this),this.model.on("change:testsViewTypeTrigger",this._renderTests,this),this.model.on("change:testsTriggeredTypeTrigger",this._renderTests,this),this.model.on("change:selectedTestTrigger",this._renderTests,this),this.model.on("change:clusterHealthStatsTrigger",this._renderTests,this),this.model.on("change:refreshDataTrigger",this._renderTests,this),this.model.on("change:selectedEntityTypeTrigger",this._delayedRenderTests,this),this.model.on("change:selectedEntitiesTrigger",this._delayedRenderTests,this),this.model.on("change:selectedGroupTrigger",this._delayedRenderTests,this),this.model.on("change:filtersChangeTrigger",this._delayedRenderTests,this),this.model.on("change:entityTypeGroupingTrigger",this._showTab,this),this.eventBus&&(this.eventBus.bind("testPanelStateChanged",this.onTestPanelStateChanged.bind(this)),this.eventBus.bind("tabChanged",this.onTabChanged.bind(this))),this._renderTests();var e=this.model.getTestsSearchTerm();e&&(this.$(".test-search-input").val(e),this.$(".tests-search").show())},onStopServices:function(){this._clearTooltips(),this.model.off("change:testsChangeTrigger",this.render,this),this.model.off("change:testsViewTypeTrigger",this._renderTests,this),this.model.off("change:selectedTestTrigger",this._renderTests,this),this.model.off("change:clusterHealthStatsTrigger",this._renderTests,this),this.model.off("change:refreshDataTrigger",this._renderTests,this),this.model.off("change:selectedEntityTypeTrigger",this._delayedRenderTests,this),this.model.off("change:selectedEntitiesTrigger",this._delayedRenderTests,this),this.model.off("change:selectedGroupTrigger",this._delayedRenderTests,this),this.model.off("change:filtersChangeTrigger",this._delayedRenderTests,this),this.model.off("change:entityTypeGroupingTrigger",this._showTab,this),this.eventBus&&(this.eventBus.unbind("testPanelStateChanged",this.onTestPanelStateChanged.bind(this),this),this.eventBus.unbind("tabChanged",this.onTabChanged.bind(this),this)),this.subViewHelper.iterate("onStopServices")},render:function(){n.debug("TestsView : render: "," | viewid     : ",this.cid);var e=u(this.vtOptions({}));this.$el.html(e),this._initializeSubViews(),this._renderTests()},onTestPanelStateChanged:function(e){e?this.$(".tests-list").hide():this.$(".tests-list").show()},onTabChanged:function(e){if(e===a.SUBPAGE_TESTS){var t=this.$el.find(".last-test-run-wr"),i=this.$el.find("#last-test-run-date"),n=l.getGlobalTasks().where({component:a.TASK_COMPONENTS.NCC});if(n.length){var s=_.filter(n,function(e){var t=e.get(o.TASK_STATUS);return t===a.TASK_STATUS_FAILED||t===a.TASK_STATUS_COMPLETE||t===a.TASK_STATUS_ABORTED});if(s.length){var c=_.last(_.sortBy(s,function(e){return e.get(o.TASK_END_TIME)})),d=r.getTimeDateFormatfromMicroseconds(c.get(o.TASK_END_TIME));i.text(d),t.removeClass("hide")}else t.addClass("hide")}else t.addClass("hide")}}})}),define("views/pages/cluster/TestsSummaryView",["jquery","utils/AppConstants","utils/AppUtil","components/Components","models/cluster/ClusterHealthModel","views/pages/cluster/TestsFilterView"],function(e,t,i,n,s,a){"use strict";var r=_.template('<li class="filter status-filter <%=viewTypeCls%>-checks" filter-text="<%=viewType%>" filter-type="<%=filterType%>"><div class="clearfix"><span class="col-xs-2"><%=icon%></span><span class="col-xs-4"><%=viewTypeName%></span><span class="col-xs-6"><%=count%></span></div></li>'),o=_.template('<div class="clearfix"><span><%=icon%></span><span><%=viewTypeName%></span><span class="pull-right"><%=count%></span></div>'),l=_.template('<div class="messages"><span class="col-xs-7 text header"><%= Components.icon("all_checks", "-small -inline") %>All Checks</span><span class="col-xs-5 text header"><%=allTestCount%></span></div>'),c={CHECK_BY_STATUS:"BY CHECK STATUS",CHECK_BY_TYPE:"BY CHECK TYPE"},d={STATUS:"status",TYPE:"type"};return a.extend({name:"TestsSummaryView",loadingHTML:'<div class="loading no-data"><div class="donut-loader-blue"></div>&nbsp;Loading...</div>',errorHTML:_.template('<div class="text-danger n-error"><i class="n-icon error-icon"></i><%= errorMessage%><a class="n-error-details" tooltip="<%=errorDetails%>" data-original-title="<%=errorDetails%>">Show me why</a></div>'),filtersContainerHTML:'<ul class="filters"></ul>',eventBus:null,initialize:function(e){e&&e.eventBus&&(this.eventBus=e.eventBus),a.prototype.initialize.apply(this,arguments)},renderStatusFilter:function(e){return r(e)},getFilterContainer:function(){return this.$(".filters")},render:function(){switch(this.model.getTestsCollectionState()){case t.STATE_INIT:case t.STATE_PENDING:this.$el.html(this.loadingHTML);break;case t.STATE_ERROR:this.$el.html(this.errorHTML({errorMessage:this.i18n("error_occurred"),errorDetails:this.i18n("unable_to_fetch")})),this.$(".n-error-details").tooltip("destroy"),this.$(".n-error-details").tooltip({placement:"top",trigger:"hover",html:!0});break;case t.STATE_SUCCESS:this._clearTooltips();var a=this.model.getAllTests(),r=this._filterByStatus(a,s.prototype.TESTS_VIEW_TYPE.ALL_TESTS).length,o=this.model.getTestsViewType(),u=this.getIcons(),h=this.getTriggeredIcons(),p=e(this.filtersContainerHTML),T=this.$el.parent(".right-panel-inner-wrapper").length;this.$el.html(l({allTestCount:r,Components:n})),p.html(""),p.append(e('<li class="category">'+c.CHECK_BY_STATUS+"</li>")),_.each(this._getDisplayedStatuses(),function(t){var n=i.toTitleCase(t),s=this._filterByStatus(a,t),r=s.length,l="";t===o&&(l="checked");var c=e(this.renderStatusFilter({viewType:t,viewTypeCls:this.getClassName(t),filterType:d.STATUS,viewTypeName:n,icon:u[t],count:r,checked:l})).tooltip({placement:T?"left":"right",trigger:"hover",html:"true",title:this.getCheckTypeTooltip(s)});p.append(c)},this),p.append(e('<li class="category">'+c.CHECK_BY_TYPE+"</li>")),_.each(this._getDisplayedTriggeredTypes(),function(t){var n=i.toTitleCase(t),s=this._filterByCheckType(a,t),r=s.length,l="";t===o&&(l="checked");var c=e(this.renderStatusFilter({viewType:t,viewTypeCls:this.getClassName(t),filterType:d.TYPE,viewTypeName:n,icon:h[t],count:r,checked:l})).tooltip({placement:T?"left":"right",trigger:"hover",html:"true",title:this.getStatusTooltip(s)});p.append(c)},this),this.$el.append(p)}},getCheckTypeTooltip:function(e){var t="<div>",n=this.getTriggeredIcons();return _.each(this._getDisplayedTriggeredTypes(),function(s){var a=i.toTitleCase(s),r=this._filterByCheckType(e,s).length;t+=o({viewTypeName:a,icon:n[s],count:r})},this),t+="</div>"},getStatusTooltip:function(e){var t="<div>",n=this.getIcons();return _.each(this._getDisplayedStatuses(),function(s){var a=i.toTitleCase(s),r=this._filterByStatus(e,s).length;t+=o({viewTypeName:a,icon:n[s],count:r})},this),t+="</div>"},_clearTooltips:function(){_.each(this.$("li.status"),function(t){e(t).tooltip("destroy")})},onStartServices:function(){this.model.on("change:refreshDataTrigger",this.render,this),this.model.on("change:selectedTestTrigger",this.render,this),this.render()},onStopServices:function(){this._clearTooltips(),this.model.off("change:refreshDataTrigger",this.render,this),this.model.off("change:selectedTestTrigger",this.render,this)},getIcons:function(){var e={};return e[s.prototype.TESTS_VIEW_TYPE.PASSING_TESTS]=this.getIconTemplate("check-thick","pass-icon"),e[s.prototype.TESTS_VIEW_TYPE.FAILED_TESTS]=this.getIconTemplate("x-square","failed-icon"),e[s.prototype.TESTS_VIEW_TYPE.WARNING_TESTS]=this.getIconTemplate("Exclamation_Mark","exclamation-icon"),e[s.prototype.TESTS_VIEW_TYPE.ERROR_TESTS]=this.getIconTemplate("error"),e[s.prototype.TESTS_VIEW_TYPE.DISABLED_TESTS]=this.getIconTemplate("Power"),e},onFilter:function(t){var i=e(t.currentTarget),n={filterType:i.attr("filter-type"),text:i.attr("filter-text")};this.selectedFilters=[],this._applyFilter(n),this.eventBus.trigger("showSelectedTab","tests")},_applyFilter:function(e){if("status"===e.filterType)e.text!==this.model.getTestsViewType()&&this.model.setTestsViewType(e.text);else if("type"===e.filterType){var t=e.text;t===this.model.ALL_ENTITIES&&(t=null),this.model.setTestsTriggeredType(t)}else if(e.text!==this.model.getSelectedEntityType()){var i=e.text;i===this.model.ALL_ENTITIES&&(i=null),this.model.setSelectedEntityType(i)}}})}),define("text!templates/pages/cluster/FiltersView.html",[],function(){return'<section class="n-filters">\n  <% _.each( _.keys(filterGroups), function(groupName) { %>\n  <div class="n-filter-by">\n    <h2 class="n-filter-header"><%= groupName %></h2>\n    <div class="n-filter-checkboxes">\n      <% _.each( filterGroups[groupName], function(fltr) {  %>\n      <%   var fltrId = fltr.get("id"); %>\n      <%   var chkBoxId = "filter-" + fltrId;       %>\n      <%   var sChecked = fltr.isApplied() ? "checked" : "";%>\n      <div class="n-checkbox-item">\n        <input <%= sChecked %> type="checkbox" class="n-switch"\n          id="<%= chkBoxId %>">\n        <label for="<%= chkBoxId %>" class="n-switch"></label>\n        <label for="<%= chkBoxId %>" class="n-label-text">\n          <span><%= fltr.get("name") %></span>\n          <span class="n-value"><%= fltr.getMatchCount()  %></span>\n        </label>\n      </div>\n      <% }) %>\n    </div>\n    <% }) %>\n  </div>\n</section>\n'}),define("views/pages/cluster/FiltersView",["views/basecomponents/BaseView","utils/AppUtil","text!templates/pages/cluster/FiltersView.html"],function(e,t,i){"use strict";return e.extend({events:{"change .n-switch":"onFilterChange"},template:_.template(i),onFilterChange:function(e){var t=$(e.currentTarget),i=t.attr("id").split("-")[1],n=t.is(":checked");this.model.updateFilter(i,n)},initialize:function(){t.debug("FiltersView : initialize: "," | viewid     : "+this.cid)},onStartServices:function(){this.model.on("change:selectedEntityTypeTrigger",this.render,this),this.model.on("change:selectedGroupByTrigger",this.render,this),this.model.on("change:filtersLoadedTrigger",this.render,this)},onStopServices:function(){this.model.off("change:selectedEntityTypeTrigger",this.render,this),this.model.off("change:selectedGroupByTrigger",this.render,this),this.model.off("change:filtersLoadedTrigger",this.render,this)},render:function(){t.debug("FiltersView : render: "," | viewid     : "+this.cid);var e="",i=this.model.getSelectedEntityType();if(this.model.getSelectedGroupBy()){var n=this.model.getFiltersByEntityType(i),s=_.groupBy(n,function(e){return e.getCategory()});e=this.template({filterGroups:s})}this.$el.html(e)},destroy:function(){t.debug("FiltersView : destroy: "," | viewid     : "+this.cid),this.model.off(),e.prototype.destroy.apply(this,arguments)}})}),define("text!templates/pages/cluster/ClusterHealthEntitiesView.html",[],function(){
return'<div class="health-container">\n\n  \x3c!-- LEFT PANEL --\x3e\n  <div class="side-panel left-panel">\n    <div class="panel-header">\n    </div>\n\n    \x3c!-- Scrollable inner panel --\x3e\n    <div class="left-panel-container">\n      <div class="antiscroll-wrap">\n        <div class="box-wrap">\n          <div class="antiscroll-inner left-panel-inner">\n            <div class="left-panel-inner-wrapper">\n              <div class="left-panel-inner-top"></div>\n              <div class="left-panel-inner-bottom"></div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n\n  </div>\n\n  \x3c!-- CENTER PANEL --\x3e\n  <div class="center-panel">\n    <div class="panel-header">\n    </div>\n    <div class="center-panel-container">\n      <div class="antiscroll-wrap">\n        <div class="box-wrap center-panel-box-wrap">\n          <div class="antiscroll-inner center-panel-inner">\n            <div class="center-panel-inner-wrapper">\n              <div class="ctr-entityTypeDetails"></div>\n              <div class="ctr-entityTypeGroupBy"></div>\n              <div class="ctr-groupDetails"></div>\n            </div>\n          </div>\n        </div>\n        <div>\n        </div>\n      </div>\n    </div>\n  </div>\n\n  \x3c!-- RIGHT PANEL --\x3e\n  <div class="side-panel right-panel">\n    <div class="panel-header right-panel-header test-panel-header">\n      <ul class="nav">\n        \x3c!-- Tests Filtering options here --\x3e\n      </ul>\n      <div class="dropdown -actions pull-right">\n        <a class="dropdown-toggle header-option action-dropdown"\n           data-toggle="dropdown" data-test="clusterhealthentitiesview_a_actions">\n          Actions <%= downArrow %>\n        </a>\n        <ul class="dropdown-menu">\n          <li>\n            <a class="header-change-view-button">Manage Checks</a>\n          </li>\n          <li>\n            <a class="btnAction" id="create-ncc-schedule"\n              title="<%= i18n(\'setNccSchedule\')%>"\n              action="set_ncc_frequency"\n              actionTarget="cluster"\n              data-test="clusterhealthentitiesview_a_createschedule">\n              <%= i18n(\'setNccSchedule\')%></a>\n          </li>\n          <li>\n            <a class="btnAction" id="run-checks"\n              title="<%= i18n(\'runNccChecksTitle\')%>"\n              action="run_check"\n              actionTarget="cluster">\n              <%= i18n(\'runNccChecks\')%></a>\n          </li>\n          <li>\n            <a class="btnAction" id="log-collector"\n              title="A manual Log Collector/NCC check is already in progress."\n              data-test="clusterhealthentitiesview_a_createlogcollector"\n              action="<%= isNewLogCollector ? \'broker_dynamic\' : \'fetch\' %>"\n              actiontarget="cluster"\n              actionParentEntityType="cluster">\n              <%= i18n(\'logCollector\')%>\n            </a>\n          </li>\n        </ul>\n      </div>\n    </div>\n\n    <div class="right-panel-container">\n      <div class="antiscroll-wrap">\n        <div class="box-wrap">\n          <div class="antiscroll-inner right-panel-inner">\n            <div class="right-panel-inner-wrapper">\n              <div class="tests-view hide">\n                \x3c!-- tests view goes here --\x3e\n              </div>\n              <div class="summary-view">\n                \x3c!-- tests summary view goes here --\x3e\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n</div>\n'}),define("views/pages/cluster/ClusterHealthEntitiesView",["utils/AppUtil","utils/SVG","views/pages/cluster/ClusterHealthBaseSubpageView","views/pages/cluster/EntityTypesSummaryView","views/pages/cluster/EntityTypesDetailsView","views/pages/cluster/EntityTypeGroupByView","views/pages/cluster/GroupDetailsView","views/pages/cluster/TestsView","views/pages/cluster/TestsSummaryView","views/pages/cluster/FiltersView","text!templates/pages/cluster/ClusterHealthEntitiesView.html"],function(e,t,i,n,s,a,r,o,l,c,d){"use strict";var u=_.template('<div class="bread-crumbs">\n      <a class="bcLink allLink"><%= i18n("all") %></a>\n      <% if ( selectedEntityType ) { %>\n        &nbsp;<i data-icon="y" aria-hidden="true"></i>&nbsp;\n        <div class="bc-select-dropdown dropdown">\n          <button data-toggle="dropdown" href="#" class="btn dropdown-toggle">\n            <div class="bc-selector">\n               <%= selectedEntityType %>\n           </div>\n          </button>\n          <ul class="all-entity-types-dropdown\n           dropdown-menu dropdown-menu-left">\n         <% _.each(entityTypes, function(eType) { %>\n           <li><a class="bcLink selectedEntityType" data-id="<%= eType %>">\n             <%= chModel.getEntityTypeName(eType, false) %></a></li>\n         <% }) %>\n          </ul>\n        </div>\n      <% } %>\n      </div>'),h=_.template('<div\n      class="bread-crumbs bread-crumbs-center">\n      <% if ( selectedGroupBy ) { %>\n        <% if ( selectedGroup ) { %>\n          <a class="bcLink selectedGroupBy selected-group-by"\n          title="\n          <%= i18ns("group_by", selectedEntityType, selectedGroupBy) %>">\n          <%= i18ns("group_by", selectedEntityType, selectedGroupBy) %>\n          </a>\n        <% } else { %>\n          <span class="selected-group-by"\n          title="Group <%= selectedEntityType %> by <%= selectedGroupBy %>">\n          Group <%= selectedEntityType %> by <%= selectedGroupBy%>\n          </span>\n        <% } %>\n        &nbsp;<i data-icon="y" aria-hidden="true"></i>&nbsp;\n        <div class="bc-select-dropdown dropdown">\n          <button data-toggle="dropdown" href="#" class="btn dropdown-toggle"\n            title="<%= selectedGroup || "All Groups" %>">\n            <div class="bc-selector">\n               <%= selectedGroup || allGroups %>\n            </div>\n          </button>\n          <ul class="all-groups-dropdown dropdown-menu dropdown-menu-left">\n          </ul>\n        </div>\n      <% } else { %>\n        <%= selectText %>\n      <% } %>\n      </div>'),p=_.template('<li><a class="bcLink selectedGroup" data-id="<%= id %>">\n        <%= displayName %>\n      </a></li>'),T=_.template(e.trimmedTemplate('\n      <div class="grid-selector">\n        <div class="selector <%= renderType %>-selected">\n          <a class="grid"></a>\n          <a class="tbl"></a>\n        </div>\n      </div>\n    ')),E=_.template('<div class="selection-counts">\n        <%= i18n("currently_watching") %>\n        <span class="counts">\n          <%= totalCount %>\n        </span>\n        <%= i18n("entities") %>\n        <span class="selection-counts-info"></span>\n      </div>'),g=_.template('<%= i18ns("total_entities", totalCount) %>\n      <br><%= i18ns("checks_running") %>'),S=_.template('<div class="selection-counts">\n        <%= i18n("currently_watching") %>\n        <span class="counts">\n          <span\n            class="<%= nbSelected > 0 ? "watch-count-clearable" : "" %>">\n            <%= nbWatching %>\n          </span> /\n          <%= entityCount %>\n        </span>\n        <%= countLabel %> <%= entityTypeName.toLowerCase() %>.\n        <span class="selection-counts-info"></span>\n      </div>'),m=_.template('<%= i18n("there_are_total") %>\n        <%= totalEntities %>\n        <%= entityTypeName %>.\n        <%\n          // Filters Statement\n        %>\n        <% if ( numberFiltered >= 0 ) { %>\n          <br><br><%= i18ns("total_reduced", numberFiltered) %><br>\n        <% } %>\n        <%\n          // Selections Statement\n        %>\n        <% if ( nbSelected === 0 ) { %>\n          <br><%= i18ns("selected_none", entityTypeName) %>\n        <% } else if ( nbWatching === 1 ) { %>\n          <br><%= i18n("selected_one") %>\n        <% } else if ( nbWatching > 1 ) { %>\n          <br><%= i18ns("selected_more", nbWatching) %>\n        <% } %> ');return i.extend({name:"ClusterHealthEntitiesView",onGroupOver:function(e){var t=$(e.currentTarget).attr("id").split("-")[1];e.stopPropagation(),this.$(".entityTypeGroupBy#grpby-"+t).addClass("syncSelected")},onGroupOut:function(e){var t=$(e.currentTarget).attr("id").split("-")[1];e.stopPropagation(),this.$(".entityTypeGroupBy#grpby-"+t).removeClass("syncSelected")},onBreadCrumbsClick:function(e){var t=$(e.currentTarget);if(t.hasClass("selectedGroup"))this.model.setSelectedGroup(t.attr("data-id"));else if(t.hasClass("selectedGroupBy"))this.model.setSelectedGroup(null);else if(t.hasClass("selectedEntityType")){var i=t.attr("data-id"),n=this.model.getEntityTypeGroupBys(i),s=n[0],a=this.model.get("previousGroupBys")[i]||s.get(s.idAttribute),r=this.model.get("previousGroups")[i];this.model.setSelectedEntityType(i),this.model.setSelectedGroupBy(a),this.model.setSelectedGroup(r)}else t.hasClass("allLink")&&(this.model.setSelectedGroup(null),this.model.setSelectedGroupBy(null),this.model.setSelectedEntityType(null))},onEntityTypeChange:function(){this.setCenterView("entityTypesDetailsView",!1)},onGroupByChange:function(){this.model.getSelectedGroupBy()?this.setCenterView("entityTypeGroupByView",!0):this.setCenterView("entityTypesDetailsView",!1),this._clearSelectionsOnGroupingChange()},onGroupChange:function(){this.model.getSelectedGroup()?this.setCenterView("groupDetailsView",!0):this.model.getSelectedGroupBy()?this.setCenterView("entityTypeGroupByView",!0):this.setCenterView("entityTypesDetailsView",!1),this._clearSelectionsOnGroupingChange()},onViewRenderingChange:function(){this.refreshCenterView()},onSelectedEntitiesTrigger:function(){this._renderPanelHeaders()},onFiltersChange:function(){this.refreshCenterView()},onTabClick:function(e){var t=$(e.currentTarget).attr("navsubpage");this.showTestsSubpage(t)},onGroupingChange:function(){this.refreshCenterView()},initialize:function(){i.prototype.initialize.apply(this,arguments),this.render(),this.model.fetchData()},onStartServices:function(){this.model.on("change:errorMessageTrigger",this.onError,this),this.model.on("change:selectedEntityTypeTrigger",this.onEntityTypeChange,this),this.model.on("change:selectedGroupByTrigger",this.onGroupByChange,this),this.model.on("change:selectedGroupTrigger",this.onGroupChange,this),this.model.on("change:viewRenderTypeTrigger",this.onViewRenderingChange,this),this.model.on("change:selectedEntitiesTrigger",this.onSelectedEntitiesTrigger,this),this.model.on("change:filtersChangeTrigger",this.onFiltersChange,this),this.model.on("change:entityTypeGroupingTrigger",this.onGroupingChange,this),this.model.on("change:selectedTestTrigger",this.onChangeSubview,this),this.model.on("change:clusterHealthStatsTrigger",this.refreshCenterView,this),this.model.on("change:refreshDataTrigger",this.refreshCenterView,this),this.eventBus.on("showSelectedTab",this.showTestsSubpage,this),this.subViewHelper.iterate("onStartServices"),this._renderPanelHeaders()},onStopServices:function(){this.model.off("change:errorMessageTrigger",this.onError,this),this.model.off("change:selectedEntityTypeTrigger",this.onEntityTypeChange,this),this.model.off("change:selectedGroupByTrigger",this.onGroupByChange,this),this.model.off("change:selectedGroupTrigger",this.onGroupChange,this),this.model.off("change:viewRenderTypeTrigger",this.onViewRenderingChange,this),this.model.off("change:selectedEntitiesTrigger",this.onSelectedEntitiesTrigger,this),this.model.off("change:filtersChangeTrigger",this.onFiltersChange,this),this.model.off("change:entityTypeGroupingTrigger",this.onGroupingChange,this),this.model.off("change:selectedTestTrigger",this.onChangeSubview,this),this.model.off("change:clusterHealthStats",this.refreshCenterView,this),this.model.off("change:refreshDataTrigger",this.refreshCenterView,this),this.eventBus.off("showSelectedTab",this.showTestsSubpage,this),this.$(".selection-counts-info").nutanixMoreInfo("destroy"),this.$(".watch-count-clearable").tooltip("destroy"),this.subViewHelper.iterate("onStopServices")},_renderViewTemplate:function(){var i=this.clusterManager.getCurrentClusterModel();e.debug("ClusterHealthEntitiesView : _renderViewTemplate: "," | viewid     : "+this.cid),this.template=_.template(d)(this.vtOptions({isNewLogCollector:i.isNewLogCollectorEnabled(),downArrow:t.SVGIcon("z","-down-arrow")})),this.$el.html(this.template)},_initializeSubViews:function(){var e=new n({el:this.$(".left-panel-inner-top"),model:this.model});this.subViewHelper.register("entityTypesSummaryView",e);var t=new s({el:this.$(".ctr-entityTypeDetails"),model:this.model});this.subViewHelper.register("entityTypesDetailsView",t);var i=new a({el:this.$(".ctr-entityTypeGroupBy"),model:this.model});this.subViewHelper.register("entityTypeGroupByView",i),this.$(".ctr-entityTypeGroupBy").hide();var d=new r({el:this.$(".ctr-groupDetails"),model:this.model});this.subViewHelper.register("groupDetailsView",d),this.$(".ctr-groupDetails").hide();var u=new o({el:this.$(".right-panel-inner-wrapper .tests-view"),model:this.model,renderSelectedTest:!1,eventBus:this.eventBus});this.subViewHelper.register("testsView",u);var h=new l({el:this.$(".right-panel-inner-wrapper .summary-view"),model:this.model,eventBus:this.eventBus});this.subViewHelper.register("testsSummaryView",h);var p=new c({el:this.$(".left-panel-inner-bottom"),model:this.model});this.subViewHelper.register("filtersView",p),this.setCenterView("entityTypesDetailsView")},_renderPanelHeaders:function(){var e=this.model.getSelectedEntityType(),t=null,i="",n=i,s=this._getSelectionSummaries();if(n+=s.summary,e){t=this.model.getCurrentGroupBy();var a=t?t.get(t.nameAttribute):null,r=this.model.getCurrentGroup(),o=r?r.getDisplayName():null;i=a?u(this.vtOptions({chModel:this.model,entityTypes:this.model.getEntityTypes(),selectedEntityType:this.model.getEntityTypeName(e,!1),selectedGroupBy:a,selectedGroup:null})):this.i18n("select_type_grouping"),n+=t?T({renderType:this.model.getViewRenderType()}):"",n+=h(this.vtOptions({selectedEntityType:this.model.getShortPluralEntityName(e),selectedGroupBy:a,selectedGroup:o,selectText:this.i18n("select_type_grouping"),allGroups:this.i18n("all_groups")}))}else i+=this.i18n("select_type"),n+=i;if(this.$(".left-panel .panel-header").html(i),this.$(".center-panel .panel-header").html(n),t){var l="",c=this.$(".all-groups-dropdown");_.each(t.getGroups(),function(e){l+=p(e.toJSON())}),c.append(l)}s&&(this.$(".selection-counts-info").nutanixMoreInfo({placement:"bottom",title:s.tooltip}),this.$(".watch-count-clearable").tooltip({title:"Click to clear selections.",placement:"bottom",trigger:"hover",html:"true"})),this._renderTestsHeader(this.$(".right-panel .panel-header")),this.showTestsSubpage(null)},_getSelectionSummaries:function(){var t=this.model.getSelectedEntityType();if(!t){var i=0;return _.each(this.model.ENTITY_TYPES,function(e){i+=this.model.getTotalEntityCount(e)},this),{summary:E(this.vtOptions({totalCount:i})),tooltip:g(this.vtOptions({totalCount:i}))}}var n=this.model.getShortPluralEntityName(t),s=this.model.getFilteredEntityCount(t),a=this.model.getTotalEntityCount(t),r=this.model.getSelectedEntities(t),o=r.length,l=this.model.getWatchedEntities(),c=l.length;e.debug("ClusterHealthEntitiesView : SelectionSummaries","numberFiltered:",s,"totalEntities:",a,"nbSelected:",o,"nbWatching:",c);var d=a,u="total";return s>=0&&(d=s,u="filtered"),{summary:S(this.vtOptions({nbWatching:c,nbSelected:o,entityCount:d,countLabel:u,entityTypeName:n})),tooltip:m(this.vtOptions({totalEntities:a,entityTypeName:n.toLowerCase(),numberFiltered:s,nbSelected:o,nbWatching:c}))}},_clearSelectionsOnGroupingChange:function(){var e=this.model.getSelectedEntityType();this.model.getSelectedEntities(e).length>0&&!this.model.getCurrentGroupBy()&&this.model.setSelectedEntities(e,[])},showTestsSubpage:function(e){e=e||this.model.getCurrentTestsSubPage()||"summary",this.$(".nav .active").removeClass("active"),this.$(".tests-view").hide(),this.$(".summary-view").hide(),this.eventBus.trigger("tabChanged",e),this.$("."+e+"-view").show(),this.$('.nav [navsubpage="'+e+'"]').addClass("active"),this.model.setCurrentTestsSubPage(e)}},null)}),define("models/ncc/RunCheckModel",["models/BaseModel","data/DataURLConstants","data/DataProperties","managers/NotificationManager","utils/AppConstants"],function(e,t,i,n,s){"use strict";var a={FORCE_CREATE_TASK:"force",IS_INTERNAL:"isInternal",NCC_CHECKS:"nccChecks",SEND_MAIL:"sendEmail"};return e.extend({DP:a,urlRoot:t.NCC_CHECKS,idAttribute:i.ID,nameAttribute:i.NAME,name:"RunCheckModel",showError:!0,defaults:{sendEmail:!1},getURL:function(){var e=this.get(i.ID),t=this.url();return e&&(t+="/"+e),t},showLatencyNotification:function(){this.enableNotifications&&(this.latencyId=n.showLatencyMessage("Submitting operation to run checks..."))},showSuccessNotification:function(){this.enableNotifications&&n.hideLatencyMessage(this.latencyId)},showErrorNotification:function(e,t,i){this.showError&&(n.hideLatencyMessage(this.latencyId),n.showNotification(s.NOTIFY_ERROR,e,t,i))},hideLatencyNotification:function(){n.hideLatencyMessage(this.latencyId)},triggerAppViewRefresh:function(){}},{DP:a})}),define("models//ebrowser/EBQueryModel",["models/query/BaseQueryModel","models/ebrowser/EBGroupModel","models/ebrowser/EBGroupsCollection","managers/NamespaceManager","managers/ExpressionManager","data/DataURLConstants","data/DataProperties","utils/EntityUtil","utils/FilterUtil","utils/AppConstants","utils/AppUtil"],function(e,t,i,n,s,a,r,o,l,c,d){"use strict";var u=e.extend({idAttribute:r.ID,urlRoot:a.ENTITY_BROWSER_QUERY,name:"EBQueryModel",DEFAULT_GROUPS_LIMIT:3,DEFAULT_UNGROUPED_MEMBERS_LIMIT:40,DEFAULT_GROUPED_MEMBERS_LIMIT:6,MAX_MEMBERS_LIMIT:1e3,DEFAULT_LOAD_MORE_MULTIPLIER:5,DEFAULT_PAGE_SIZE:10,BUCKET_SUMMARY_HELPER_KEY:"count:count_star",DEFAULT_NUM_BUCKETS:3,RESULT_ATTRIBUTES:["total_entity_count","filtered_entity_count","filtered_group_count","total_group_count","group_results"],defaults:{id:null,title:"",entity_type:null,entity_ids:null,filter_expression:null,grouping_attribute:null,group_sort_attribute:null,group_sort_order:null,group_count:null,group_offset:null,group_attributes:null,group_member_count:null,group_member_offset:null,group_member_sort_attribute:null,group_member_sort_order:null,group_member_attributes:null,total_entity_count:-1,total_group_count:-1,group_separator_values:null,group_results:null},initialize:function(){e.prototype.initialize.apply(this,arguments),this.set(this.DP.GROUP_RESULTS,new i)},parse:function(n,s){var a=e.prototype.parse.apply(this,arguments),r={};if(a){var l=this.get(this.DP.ENTITY_TYPE),d=[this.DP.TOTAL_ENTITY_COUNT,this.DP.FILTERED_ENTITY_COUNT,this.DP.FILTERED_GROUP_COUNT,this.DP.TOTAL_GROUP_COUNT];_.each(d,function(e){r[e]=a[e]});var u=this.get(this.DP.GROUPING_ATTR);r[this.DP.GROUP_RESULTS]=new i,_.each(a[this.DP.GROUP_RESULTS],function(e){var i={};i[t.DP.ENTITY_TYPE]=l,i[t.DP.GROUPING_ATTR]=u,u===c.ALL_ENTITIES_GROUP?i[t.DP.NAME]=c.ALL_ENTITIES_GROUP:i[t.DP.NAME]=e[this.DP.GROUP_BY_COLUMN_VALUE],e[this.DP.GROUP_SUMMARIES]&&(i[t.DP.GROUP_SUMMARIES]={},_.each(e[this.DP.GROUP_SUMMARIES],function(e,n){n.toLowerCase()!==this.BUCKET_SUMMARY_HELPER_KEY&&(i[t.DP.GROUP_SUMMARIES][n]=e)},this));var n=this.parseMemberCollectionResults(e);i[t.DP.MEMBERS_COL]=o.createCollection(l,n),i[t.DP.GRAND_TOTAL_ENTITIES]=r[this.DP.TOTAL_ENTITY_COUNT],i[t.DP.TOTAL_ENTITY_COUNT]=e[t.DP.TOTAL_ENTITY_COUNT],r[this.DP.GROUP_RESULTS].add(new t(i))},this)}return r},parseMemberCollectionResults:function(e){return this._rawResultsToEntities(e[this.DP.ENTITY_RESULTS])},performQuery:function(e){return this.save(null,e)},getDefaultMemberLimit:function(e){return e&&e!==c.GROUP_BY_NONE?this.DEFAULT_GROUPED_MEMBERS_LIMIT:2*this.getUserConfiguredPageSize()},getMaxMemberLimit:function(){return this.MAX_MEMBERS_LIMIT},getGroupByName:function(e){return this.get(this.DP.GROUP_RESULTS).find(function(t){return e===t.getName()})},getEntityById:function(e){for(var t=this.get(this.DP.GROUP_RESULTS),i=0;i<t.length;i++){var n=t.at(i),s=n.getMemberById(e);if(s)return s}return null},getEntitiesByIds:function(e){return _.map(e,function(e){return this.getEntityById(e)},this)},getEntityByGroupName:function(e){for(var t=this.get(this.DP.GROUP_RESULTS),i=0;i<t.length;i++){var n=t.at(i);if(n.get(r.ENTITY_GROUP_NAME)===e)return n}return null},getEntitiesByGroupName:function(e){return _.map(e,function(e){return this.getEntityByGroupName(e)},this)},getResultEntityIds:function(){var e=[];return this.get(this.DP.GROUP_RESULTS).each(function(t){_.each(t.getMembers(),function(t){e.push(t.get(t.idAttribute))})}),e},getResultEntities:function(){return this.getEntitiesByIds(this.getResultEntityIds())},getQueryResults:function(){var e={};_.each(this.RESULT_ATTRIBUTES,function(t){e[t]=this.get(t)},this);var t=[];this.get(this.DP.GROUP_RESULTS).each(function(e){t=t.concat(e.getMembers())}),e[this.DP.RESULT_MODELS]=t;var i=this.get(this.DP.GROUP_RESULTS);if(this._isContinuousGroupBy()&&i.length){var n=[];i.each(function(e){n.push(parseInt(e.get(e.DP.NAME),10))}),n=_.sortBy(n,function(e){return e});for(var s,a,r=0;r<i.length-1;r++)s=i.at(r),a=_.isNaN(n[r])||_.isNaN(n[r+1])?s.OTHER_GROUP_NAME:n[r]+s.GROUP_RANGE_SEPARATOR+n[r+1],s.set(s.DP.NAME,a);s=i.at(i.length-1);var o=n[i.length-1];a=_.isNaN(o)?s.OTHER_GROUP_NAME:o+s.GROUP_RANGE_SEPARATOR+c.FILTER_RANGE_MAX,s.set(s.DP.NAME,a)}return e[this.DP.PAGINATOR]=this,e.DP=this.DP,e},getVisibleSelectedEntityIds:function(e){var t=[];return e.length&&this.get(this.DP.GROUP_RESULTS).each(function(i){t=t.concat(this.getGroupVisibleSelectedIds(i,e))},this),t},getGroupVisibleSelectedIds:function(e,t){if(t.length){var i=this.getCurrentPage(e);if(i.length){var n=_.pluck(i,r.ID);return _.intersection(t,n)}}return[]},getPaginationInfo:function(e){var t,i,n;e?(t=e.getGroupMemberCounts(),i=e.get(e.DP.PAGE_OFFSET),n=this._getPageSizeForGroup(e)):(i=0,n=0,t={total:0});var s=i+n;s>t.total&&(s=t.total);var a=i>0,r=s<t.total;return{start:i,end:s,total:t.total,bPrev:a,bNext:r,pageSize:n}},loadNextPage:function(e,t){var i=e.getGroupMemberCounts(),n=this._getPageSizeForGroup(e),s=e.get(e.DP.PAGE_OFFSET)+n;s>i.total&&(s=0),s>=i.available?this._loadMoreGroupMembers({group:e,groupMemberOffset:i.available},function(i){i&&e.set(e.DP.PAGE_OFFSET,s),t(e,i)}):(s<i.total&&e.set(e.DP.PAGE_OFFSET,s),t(e,!0))},loadPreviousPage:function(e,t){var i=e.get(e.DP.PAGE_OFFSET)-this._getPageSizeForGroup(e);e.set(e.DP.PAGE_OFFSET,Math.max(0,i)),t(e,!0)},getCurrentPage:function(e){var t=this.getPaginationInfo(e);return e.getMembers().slice(t.start,t.end)},adjustNewPageOffset:function(e,t,i){var n=Math.floor(e/i),s=n*i;if(s>t){s=Math.floor(t/i)*i}return s},refreshCurrentPage:function(e,t){var i=e.get(e.DP.PAGE_OFFSET),n=e.getGroupMemberCounts(),s=this._getPageSizeForGroup(e),a=this.adjustNewPageOffset(i,n.total,s);a+s<=n.available?(e.set(e.DP.PAGE_OFFSET,a),t(e,!0)):this._loadMoreGroupMembers({group:e,groupMemberOffset:a},function(i){t(e,i)})},_loadMoreGroupMembers:function(e,t){var i={};_.each(this.URL_ATTRIBUTES,function(e){i[e]=this.get(e)},this);var n=this.get(this.DP.GROUPING_ATTR);i[this.DP.GROUP_MEMBER_COUNT]=e.groupSize||this.getDefaultMemberLimit(n),i[this.DP.GROUP_OFFSET]=0,i[this.DP.GROUP_MEMBER_OFFSET]=e.groupMemberOffset,i[this.DP.GROUP_ATTRIBUTES]=null,i.disableHybridQuery=this.disableHybridQuery,this.adjustGroupMemberOffset(e.groupMemberOffset);var s=this.get(this.DP.FILTER_EXPR),a=e.group.getFilterExpression();if(a){var r=_.extend({},s);_.each(a,function(e,t){var i=r[t]||[];i=i.concat(e),r[t]=i}),i[this.DP.FILTER_EXPR]=r}var o=this.getEBQueryModelInstance(i),l=this;return o.performQuery({success:function(){var n=o.getQueryResults();l.onNewGroupMembersLoaded({group:e.group,newMembers:n[l.DP.RESULT_MODELS],newOffset:i[l.DP.GROUP_MEMBER_OFFSET],reset:e.reset}),t(e.group,!0)},error:function(){d.debug("EBQueryModel : Load More Query Failed."),t(e.group,!1)}})},onNewGroupMembersLoaded:function(e){e.reset?e.group.resetMembers(e.newOffset,e.newMembers):e.group.updateMembers(e.newOffset,e.newMembers)},adjustGroupMemberOffset:function(e){},_getPageSizeForGroup:function(e){return e.isAllEntitiesGroup()?this.getUserConfiguredPageSize():this.DEFAULT_GROUPED_MEMBERS_LIMIT},getUserConfiguredPageSize:function(){var e,t=n.get(n.USER_SETTINGS);return t&&(e=Number(t.getUserSetting(c.EB_USER_SETTINGS.PAGE_SIZE))),e||2*this.DEFAULT_PAGE_SIZE},getEBQueryModelInstance:function(e){return new u(e)},applyAdditionalFiltersByEntityType:function(e){switch(this.get(this.DP.ENTITY_TYPE)){case c.ENTITY_GPU:l.addFilterCondition(e,r.EB.GPU.GPU_TYPE,l.createFilterCondition(r.EB.GPU.GPU_TYPE,c.ENTITY_GPU,c.FILTER_OPERATORS.NOT_EQUALS,r.EB.GPU.KVIRTUAL));break;case c.ENTITY_USER:l.addFilterCondition(e,r.EB.USER.USER_TYPE,l.createFilterCondition(r.EB.USER.USER_TYPE,c.ENTITY_USER,c.FILTER_OPERATORS.NOT_EQUALS,c.USER_TYPES.INTERNAL));break;case c.ENTITY_MARKETPLACE_ITEM:s.getFilterExpression(s.FILTERS.ONLY_INFRA_MARKETPLACE_ITEMS,!1,e);break;case c.ENTITY_VM:s.getFilterExpression(s.FILTERS.NOT_INCLUDE_AWS,!1,e);break;case c.ENTITY_QOS_POLICY:s.getFilterExpression(s.FILTERS.EXCLUDE_DELETED_QOS_POLICIES,!1,e);break;case c.ENTITY_NGT_POLICY:s.getFilterExpression(s.FILTERS.EXCLUDE_DELETED_NGT_POLICIES,!1,e);break;case c.ENTITY_AUDIT:l.addFilterCondition(e,c.FILTER_ALERT_TYPE_UUID,l.createFilterCondition(c.ENTITY_AUDIT,c.FILTER_ALERT_TYPE_UUID,c.FILTER_OPERATORS.NOT_EQUALS,c.AUDIT.TYPE.AUDIT_RECOVERY_PLAN_JOB))}},_filterExpressionToFilterCriteria:function(t,i){var n={};return this.applyAdditionalFiltersByEntityType(n),_.extend(n,t),e.prototype._filterExpressionToFilterCriteria.call(this,n,i)}},{DP:e.DP});return u}),define("models/cluster/TestStatsModel",["models/query/BaseQueryModel","models//ebrowser/EBQueryModel","data/DataURLConstants","data/DataProperties","models/stats/StatsModel","utils/AppUtil","utils/AppConstants"],function(e,t,i,n,s,a,r){"use strict";var o=r.TEST_SCORE_THRESHOLDS.ERROR-3,l=_.extend(e.DP,{ERROR_PROTO:"error_proto"}),c=t.extend({idAttribute:n.ID,urlRoot:i.ENTITY_BROWSER_QUERY,name:"TestErrorCodeModel",DP:l,toJSON:function(){var e=t.prototype.toJSON.apply(this,arguments);return e[this.DP.GROUP_MEMBER_ATTRIBUTES]=[{attribute:this.DP.ERROR_PROTO}],e},showLatencyNotification:function(e,t){},showSuccessNotification:function(e,t,i){},triggerAppViewRefresh:function(){},performQuery:function(e){return this.save(null,e)},getErrorMessageForCode:function(e){var t=this.getEntityById(e);return t?t.get(this.DP.ERROR_PROTO):e}},{DP:l}),d=new c,u={};u[l.ENTITY_TYPE]=r.ENTITY_NCC_ERROR_CODE,d.set(u);d.performQuery();return s.extend({errors:{},errorStartTime:null,testErrorCodeModel:null,initialize:function(){s.prototype.initialize.apply(this,arguments),this.testErrorCodeModel=d},getDataPoints:function(e){var t=[];if(e&&e.successful){var i=1e3*e.intervalInSecs,n=Math.round(e.startTimeInUsecs/1e3);if(a.debug("StatsModel Received:\n: ","\n start: "+new Date(n),"\n backend intervalMills: "+i,"\n client  intervalMills: ",1e3*this.get(this.DP.SAMPLING_INTERVAL_SECS),"\n nbValues: "+e.values.length),!_.isEmpty(this.errors)&&this.errorStartTime<=n){var s={};_.each(e.values,function(e,t){s[n+i*t]=e}),_.each(this.errors,function(e,i){var n=e;n=!e&&s[i]&&s[i]!==r.STATS_NO_VALUE?s[i]:e?o:null,t.push([i,n])})}else this.errorStartTime||(this.errorStartTime=n),_.each(e.values,function(e,s){var a=n+i*s,o=e===r.STATS_NO_VALUE&&e?null:e;t.push([a,o])},this)}else _.each(this.errors,function(e,i){e=e!==r.STATS_NO_VALUE&&e?null:o,t.push([i,e])});return t},parse:function(e){var t=[];if(e&&e.statsSpecificResponses){var i=a.findIndex(e.statsSpecificResponses,function(e){return e.metric&&a.endsWith(e.metric,"error_id")});i>-1&&(this.errors=a.createObject(this.getDataPoints(e.statsSpecificResponses.splice(i,1)[0]))),_.each(e.statsSpecificResponses,function(e){t.push(this.processStats(this.getDataPoints(e)))},this)}return{stats:t}},getErrorMessageAtTime:function(e){return this.getError(e)?this.testErrorCodeModel.getErrorMessageForCode(this.getError(e)):null},getAllErrors:function(){return this.errors},getError:function(e){return this.errors[e]}})}),define("text!templates/pages/cluster/TestEntityHistoryView.html",[],function(){return'\x3c!-- Dates Row --\x3e\n<div class="entityHistoryRow entityHistoryDayRow">\n  <div class="entity-name">\n    &nbsp;\n  </div>\n  <div class="days">\n    <% for(var i=6; i > 0; i--) { %>\x3c!-- Comment for Formatting\n --\x3e<div class="day">\n    <%=  dates[i]  %>\n  </div>\x3c!-- Comment for Formatting\n --\x3e<% } %>\x3c!-- Comment for Formatting\n --\x3e<div class="day">\n    Today\n  </div>\n  </div>\n</div>\n<% _.each(entities, function( entity ) { %>\n<div class="entityHistoryRow"\n     data-id="<%= entity.get(entity.idAttribute) %>"\n     data-entityType="<%= entity.entityType %>">\n  <div class="entity-name">\n    <%= entity.entityType === "disk" ?\n        ("Disk ID : " + entity.getValue("id")) :\n        entity.getValue(entity.nameAttribute) %>\n  </div>\n  <div class="days">\n    <% for(var i=0; i < 7; i++) {\n        var barInfo = entityBars[entity.get(entity.idAttribute)][i];\n    %>\x3c!-- Comment for Formatting\n --\x3e<div data-day="<%= -(6 - i) %>" class="day">\n    <div class="day-stats-bar" data-day="<%= i %>">\n      <%= barInfo.barHTML %>\n    </div>\n  </div>\x3c!-- Comment for Formatting\n --\x3e<% } %>\n  </div>\n</div>\n<% }) %>\n\x3c!-- Load More Row--\x3e\n<div class="entityHistoryRow entityHistoryFullRow">\n  <div class="pull-left">\n    <%= entities.length %> / <%= numberOfEntities %>\n  </div>\n  <% if ( entities.length < numberOfEntities ) { %>\n    <div class="load-more"> Load More </div>\n  <% } else {  %>\n    <div class="load-more inactive"> &nbsp; </div>\n  <% } %>\n</div>\n'}),define("views/pages/cluster/TestEntityHistoryView",["datejs","components/Components","views/basecomponents/BaseView","utils/AppUtil","utils/SubModelHelper","utils/AppConstants","utils/VisualizationUtil","models/cluster/TestStatsModel","data/DataProperties","text!templates/pages/cluster/TestEntityHistoryView.html"],function(e,t,i,n,s,a,r,o,l,c){"use strict";var d=_.template(c),u=_.template('<div class="chealth-tooltip">  <div class="clearfix">    <span>'+t.icon("x-square","failed-icon -small -inline")+'</span>    <span>Failures</span>    <span class="pull-right"><%=nbCritical || "0"%>%</span>  </div>  <div class="clearfix">    <span>'+t.icon("Exclamation_Mark","exclamation-icon -small -inline")+'</span>    <span>Warnings</span>    <span class="pull-right"><%=nbWarning || "0"%>%</span>  </div>  <div class="clearfix">    <span>'+t.icon("error"," -small -inline")+'</span>    <span>Errors</span>    <span class="pull-right"><%=nbError || "0"%>%</span>  </div>  <div class="clearfix">    <span>'+t.icon("check-thick","pass-icon -small -inline")+'</span>    <span>Successes</span>    <span class="pull-right"><%=nbGood || "0"%>%</span>  </div></div>');return i.extend({noTestSelectedHTML:"<div class='no-data'>Please select a check.</div>",noEntitiesHTML:"<div class='no-data no-metric'><span class='n-no-chart-text'><img src='app/assets/images/icons/icon_no_alerts.png' /><br><br>There were no entities checked by this check.</span></div>",events:{"click .load-more":"onLoadMore","click .entityHistoryRow":"onEntityRowClick"},subModelHelper:null,SAMPLING_INTERVAL_SECS:30,maxEntitiesForDisplay:5,onEntityRowClick:function(e){var t=$(e.currentTarget);if(!t.hasClass("entityHistoryFullRow")&&!t.hasClass("entityHistoryDayRow")){this.$(".entityHistoryRow").removeClass("selected"),t.addClass("selected");var i=t.attr("data-entityType"),n=t.attr("data-id");this.onEntitySelectCB(i,n)}},onLoadMore:function(e){e.stopPropagation(),$(e.currentTarget).hasClass("inactive")||(this.maxEntitiesForDisplay+=5,this.render())},getCurrentTestId:function(){var e=this.model.getSelectedTest();return e.get(e.idAttribute)},getDisplayEntityInfo:function(){var e=this.model.getSelectedTest(),t=e.get(e.idAttribute),i=this.model.getTestEntities(t),s=[]
;_.each(i,function(e){s=s.concat(e)});var a=this.model.getWatchedEntities(),r=n.getEntityIDs(a);s=_.sortBy(s,function(t){var i=e.getTestStatusForEntity(t),n=l.HEALTH_STATUS_SORT_VALUES[i],s=t.get(t.idAttribute);return-n*(r.indexOf(s)>=0?10:1)});var o=s.length;return this.maxEntitiesForDisplay<=5&&a.length&&(this.maxEntitiesForDisplay=Math.min(this.maxEntitiesForDisplay,a.length)),s.length>this.maxEntitiesForDisplay&&(s=s.splice(0,this.maxEntitiesForDisplay)),{numberOfEntities:o,entities:s}},getStats:function(e){var t=this.subModelHelper.get(e);return t?t.getStats():[]},getStatsModel:function(e,t){var i=this.subModelHelper.get(e);if(!i){i=new o;var n=this.getCurrentTestId(),s=["check."+n+".score","check."+n+".error_id"];i.setStatsFor(e,t,s);var a=Date.today().add({days:-6}).getTime(),r=Date.today().add({days:1}).getTime();i.setTimeInterval(a,r,this.SAMPLING_INTERVAL_SECS),i.on("stateChanged",this.render,this),this.subModelHelper.register(e,i),i.fetch()}return i},getEntityBars:function(e){var t={};return _.each(e,function(e){var i=[],s=e.get(e.idAttribute),o=e.entityType,l=e.getValue(e.nameAttribute);o===a.ENTITY_DISK&&(l=s);var c=this.getStatsModel(s,o),d=a.STATE_INIT;c&&(d=c.getState());for(var u=0;u<7;u++){var h="",p=0,T=[0,0,0,0];switch(d){case a.STATE_INIT:case a.STATE_PENDING:h="<div class='no-data'><div class='donut-loader-blue'></div></div>";break;case a.STATE_ERROR:h="<div class='no-data'><i aria-hidden='true' data-icon='v' class='errorIcon'></i>Error</div>";break;case a.STATE_SUCCESS:var E=this._getStatsForDay(u,c);n.debug("TestEntityHistoryView : ","Aggregated Stats: Day",u,"Stats:",E);var g=r.healthDistributionByPercentage(E[a.HEALTH_STATUS.CRITICAL],E[a.HEALTH_STATUS.WARNING],E[a.HEALTH_STATUS.GOOD],E[a.HEALTH_STATUS.ERROR]);T=[g[a.HEALTH_STATUS.CRITICAL],g[a.HEALTH_STATUS.WARNING],g[a.HEALTH_STATUS.GOOD],g[a.HEALTH_STATUS.ERROR]],p=_.reduce(E,function(e,t){return e+=t},0);var S=0,m=0,v=null;_.each(g,function(e,t){e>0&&e<5&&(g[t]=5),e>S&&(v=t,S=e),m+=g[t]}),v&&(g[v]-=m-100),h=r.renderHealthBarByPercentage(g)}i.push({barHTML:h,total:p,stats:T,entityName:l})}t[s]=i},this),t},initialize:function(e){n.debug("TestEntityHistoryView : initialize: "," | viewid     : "+this.cid),this.onEntitySelectCB=e.onEntitySelectCB,this.subModelHelper=new s},render:function(){n.debug("TestEntityHistoryView : render: "," | viewid     : "+this.cid);var e=this.model.getSelectedTest(),t="";if(!e)return void this.$el.html(this.noTestSelectedHTML);var i=this.getDisplayEntityInfo();if(i.numberOfEntities>0){for(var s=this.getEntityBars(i.entities),o=[],l=0;l<7;l++)o.push(Date.today().add({days:-l}).toString("MMM dd"));t=d({entities:i.entities,entityBars:s,dates:o,numberOfEntities:i.numberOfEntities}),this.$el.html(t),_.each(this.$(".day-stats-bar"),function(e){var t=$(e),i=t.parents(".entityHistoryRow"),n=i.attr("data-id"),r=i.attr("data-entityType"),o=t.attr("data-day"),l=s[n][o],c=l.total,d=l.entityName;if(c>0){var h=u({entityType:a.ENTITY_NAMES[r],entityName:d,total:c,nbCritical:l.stats[0],nbWarning:l.stats[1],nbGood:l.stats[2],nbError:l.stats[3]});t.parent().tooltip({title:h,placement:"bottom",trigger:"hover",html:"true"})}}),_.each(this.$(".entity-name"),function(e){var t=$(e),i=t.parent().attr("data-entityType"),n=t.parent().attr("data-id"),s=i&&n?this.model.getEntity(i,n):null;s&&r.renderEntityCircleTooltip(t,s)},this)}else this.$el.html(this.noEntitiesHTML)},destroy:function(){n.debug("TestEntityHistoryView : destroy: "," | viewid     : "+this.cid),this.subModelHelper.destroy(),_.each(this.$(".day-stats-bar"),function(e){$(e).parent().tooltip("destroy")}),_.each(this.$(".entity-name"),function(e){$(e).tooltip("destroy")}),i.prototype.destroy.apply(this,arguments)},_getStatsForDay:function(e,t){var i=t.getStats(),s=t.get("startTime"),r=s+e*a.MILLIS_PER_DAY,o=r+a.MILLIS_PER_DAY;n.debug("TestEntityHistoryView : _getStatsForDay :",e," Start:",new Date(r)," End:",new Date(o));var l={};if(l[a.HEALTH_STATUS.CRITICAL]=0,l[a.HEALTH_STATUS.WARNING]=0,l[a.HEALTH_STATUS.GOOD]=0,l[a.HEALTH_STATUS.ERROR]=0,i)for(var c=0;c<i.length;c++){var d=i[c][0],u=i[c][1];u&&d>=r&&d<o&&(t.getError(d)?l[a.HEALTH_STATUS.ERROR]++:u>a.TEST_SCORE_THRESHOLDS.GOOD?l[a.HEALTH_STATUS.GOOD]++:u>a.TEST_SCORE_THRESHOLDS.WARNING?l[a.HEALTH_STATUS.WARNING]++:u>=a.TEST_SCORE_THRESHOLDS.CRITICAL&&l[a.HEALTH_STATUS.CRITICAL]++)}return l}})}),define("views/pages/cluster/TestEntityHistoryChartView",["flotr2","datejs","views/basecomponents/BaseView","antiscroll","data/DataProperties","utils/StyleDescriptor","utils/StatsUtil","utils/AppConstants","utils/AppUtil"],function(e,t,i,n,s,a,r,o,l){"use strict";var c=_.template("<div class='no-data no-metric'><span class='n-no-chart-text'><img src='app/assets/images/icons/icon_error.png' /><br><br><%= errorMessage || 'Error Rendering Chart' %></span></div>"),d=_.template("<div class='legend-box'       style='background: <%=color%>;'></div><div class='legend-title'><%= title %></div>");return i.extend({MIN_POINTS_FOR_LINE_CHART:20,events:{},entityId:null,statsModel:null,onResize:function(){this.renderChart()},configureChartOptions:function(){var e=this.statsModel.get("startTime"),t=this.statsModel.get("endTime"),i=0,n=0,a=this._isPlottingScore(),l=!1,c=3,d=0,u=0,h=0,p=this.statsModel.get(s.METRIC_IDS);if(_.each(p,function(e){for(var t=this.statsModel.getStats(e)||[],s=0;s<t.length;s++){var a=t[s];null!==a[1]?(a[1]>=n&&(n=a[1]),a[1]<=i&&(i=a[1]),a[1]>=0&&(d++,u++,h=Math.max(h,u))):u=0}},this),h<3&&(l=!0,c=1),d<this.MIN_POINTS_FOR_LINE_CHART&&(l=!0,c=3),a)i=-10,n=110;else{var T=Math.abs(n-i);if(T<7)n=7,i=-1;else if(T>=1e4)n+=1e3;else{var E=2;n>i&&(E=Math.ceil(Math.log(n-i))),n+=Math.max(E,40),i=i>10?i-E:-10}}for(var g=[],S=1;S<7;S++){var m=e+S*o.MILLIS_PER_DAY,v=S<6?new Date(m).toString("MMM dd"):"Today";g.push([m,v])}return{plotOffsetOveride:function(e){e.left=0},shadowSize:0,lines:{lineWidth:1},xaxis:{color:"#a8aeb2",ticks:g,min:e,max:t},points:{show:l,radius:c},yaxis:{color:"#a8aeb2",max:n,min:i,showLabels:!0,noTicks:5,scaling:"linear",tickFormatter:function(e){return a?e==o.TEST_SCORE_THRESHOLDS.WARNING?"Failing checks below this line":e==o.TEST_SCORE_THRESHOLDS.GOOD?"Successful checks above this line":e==o.TEST_SCORE_THRESHOLDS.CRITICAL?"Erred checks below this line":"":e<0?e:r.rawNumericFormat(e)}},grid:{tickColor:"#f0f0f0",horizontalLines:!1,verticalLines:!0,minorHorizontalLines:!1,minorVerticalLines:!1,outline:""},mouse:{track:!0,relative:!0,position:"ew",margin:6,trackFormatter:_.bind(this.toolTipTrackFormatter,this),mouseTrackOverride:this.mouseTrackOverride}}},_isPlottingScore:function(){var e=this.statsModel?this.statsModel.get(s.METRIC_IDS):[];return e.length&&e[0].indexOf(".score")>0},_renderLegend:function(e){var t="";e.length>1&&_.each(e,function(e){var i=e.metricId.split("."),n=[];_.each(i,function(e,t){t>1&&t!==i.length-1&&n.push(e)});var s=n.join(".").replace(/_/g," ");t+=d({color:e.color,title:s})}),this.$el.parent().find(".chart-legend").html(t)},toolTipTrackFormatter:function(e){var t=Math.round(e.x),i=e.y;if(this.statsModel.getError(t)){var n=this.statsModel.getErrorMessageAtTime(t);i=n||this.statsModel.getError(t)}else i=Math.round(i);return i+"<br>"+new Date(t).toString("hh:mm tt (MMM dd)")},mouseTrackOverride:function(e,t,i,n,s){var a=e.relX,r=e.mouse.margin,o=t.left,l=Number((i.style.left||"").replace("px","")),c=Number((i.style.right||"").replace("px","")),d=$(i).width(),u=a-d-30<0;!isNaN(c)&&u?(i.style.right="auto",i.style.left=r+o+e.xaxis.d2p(e.x)+"px"):!isNaN(l)&&u&&(i.style.right=r-o-e.xaxis.d2p(e.x)+s+"px",i.style.left="auto")},renderChart:function(){if(this.statsModel){switch(this.statsModel.getState()){case o.STATE_INIT:case o.STATE_PENDING:this.$el.html("<div class='no-data'><div class='donut-loader-blue'></div> Loading...</div>");break;case o.STATE_ERROR:this.$el.html(c({errorMessage:"Error loading chart data"}));break;case o.STATE_SUCCESS:var t=this.configureChartOptions(),i=this.$el,n=[],r=[],d=this.statsModel.get(s.METRIC_IDS);_.each(d,function(e){if(!l.endsWith(e,"error_id")){var t=a.getUniqueChartColor(r);r.push(t),n.push({metricId:e,data:this.statsModel.getStats(e),color:"#"+t})}},this),this._renderLegend(n);var u=this._isPlottingScore();if(u){var h=t.xaxis.min,p=t.xaxis.max,T={points:{show:!1},lines:{lineWidth:.5},mouse:{track:!1}},E=o.TEST_SCORE_THRESHOLDS.GOOD;n.push(_.extend({color:"#"+a.getHealthColor(o.HEALTH_STATUS.GOOD),data:[[h,E],[p,E]]},T));var g=o.TEST_SCORE_THRESHOLDS.WARNING;n.push(_.extend({color:"#"+a.getHealthColor(o.HEALTH_STATUS.CRITICAL),data:[[h,g],[p,g]]},T));var S=o.TEST_SCORE_THRESHOLDS.ERROR;n.push(_.extend({color:"#"+a.getHealthColor(o.HEALTH_STATUS.ERROR),data:[[h,S],[p,S]]},T))}if(e.draw(i[0],n,t),u){var m=this.$(".flotr-grid-label-y");$(m[0]).css("top","+=3"),$(m[1]).css("top","+=8"),$(m[2]).css("top","-=8")}}}},initialize:function(){l.debug("TestEntityHistoryChartView : initialize: "," | viewid     : "+this.cid)},onStartServices:function(){_.bindAll(this,"renderChart"),$(window).on("resize",_.throttle(this.renderChart,250))},onStopServices:function(){$(window).off("resize",this.renderChart),this.statsModel&&(this.statsModel.off("stateChanged",this.renderChart,this),this.statsModel=null)},setStatsModel:function(e){if(this.statsModel&&(this.statsModel.off("stateChanged",this.renderChart,this),this.statsModel=null),!e.hasMetrics())return void this.$el.html(c({errorMessage:"Unable to load chart. The selected entity has no metrics defined for it."}));this.statsModel=e,this.statsModel.on("stateChanged",this.render,this),this.statsModel.fetch()},render:function(){l.debug("TestEntityHistoryChartView : render: "," | viewid     : "+this.cid),this.model.getSelectedTest()&&this.renderChart()},destroy:function(){l.debug("TestEntityHistoryChartView : destroy: "," | viewid     : "+this.cid),i.prototype.destroy.apply(this,arguments)}})}),define("text!templates/pages/cluster/TestDetailsView.html",[],function(){return'<div class="n-description">\n</div>\n\n<div class="n-test-history">\n  <header class=\'testEntityHistoryHeader\'>\n  </header>\n  <div class=\'testEntityHistory\'>\n    \x3c!-- Table with bars here --\x3e\n  </div>\n  <div class="detailedHistory">\n    <div>\n      <h3 class="n-test-header chart-header"></h3>\n    </div>\n    <div class=\'testHistory\'>\n      \x3c!-- Big chart here.--\x3e\n    </div>\n    <div>\n      <div class="chart-legend"></div>\n    </div>\n  </div>\n</div>'}),define("views/pages/cluster/TestDetailsView",["views/basecomponents/BaseView","views/pages/cluster/TestEntityHistoryView","views/pages/cluster/TestEntityHistoryChartView","utils/AppUtil","utils/SubViewHelper","models/cluster/TestStatsModel","data/DataProperties","text!templates/pages/cluster/TestDetailsView.html"],function(e,t,i,n,s,a,r,o){"use strict";var l=_.template('<p><span class="n-defined">Description</span>:&nbsp;<%= description %> </p><p class="n-log"><i aria-hidden="true" data-icon="F" class="n-icon"></i>Check configuration last updated <%= lastUpdated %> by <%= test.modifiedByUsername %>&nbsp;&nbsp;&middot;&nbsp;&nbsp;<i class="n-icon" data-icon="E" aria-hidden="true"></i><%= scheduleText %></p>'),c=_.template(o),d=_.template('<h3 class="n-test-header">History of <%= entityTypeName %> evaluated by this check<% if ( nodeErrorCount ) { %><a class="node-errors btn btn-sm btn-default in-active pull-right" data-toggle="popover" href="javascript:void(0);"><%=nodeErrorCount%> Node Errors</a><%}%></h3>'),u=_.template("<ul><% _.each(nodes, function(node) {%>  <li><span><%=node.entityName%></span><p><%=node.message%></p></li><%});%></ul>");return e.extend({noTestSelectedHTML:"<div class='no-data'><span class='n-no-test-text'>Please select a check in the left pane.</span></div>",noTestMetricsHTML:"<div class='no-data no-metric'><span class='n-no-chart-text'><img src='app/assets/images/icons/icon_no_alerts.png' /><br><br>This check does not generate any metrics that can be charted.</span></div>",MAX_NUMBER_OF_METRICS:5,STATS_SAMPLING_INTERVAL:1200,STATS_SCORE_SAMPLING_INTERVAL:600,events:{"click .n-test-header a.in-active":"showPopover","click .n-test-header a.active":"clearPopover"},onEntitySelectCB:function(e,t){this.$(".detailedHistory").show();var i=this.model.getEntity(e,t),n=this.model.getSelectedTest(),s=this._getMetrics(n,i),o=n.get(n.idAttribute),l=this.STATS_SAMPLING_INTERVAL,c=[];s.length?_.each(s,function(e){if(c.length<this.MAX_NUMBER_OF_METRICS){var t="check."+o+"."+e;c.push(t)}},this):(c=["check."+o+".score"],c.push("check."+o+".error_id"),l=this.STATS_SCORE_SAMPLING_INTERVAL);var d=new a;d.setStatsFor(t,e,c);var u=Date.today().add({days:-6}).getTime(),h=(new Date).getTime();d.setTimeInterval(u,h,l);var p="";if(s&&s.length){p=" Check history ";var T=s[0].replace(/_/g," "),E=n.get(r.TEST_METRICS);E&&E.length&&(T=E[0][r.DISPLAY_NAME]),T&&T.length&&(p+=' for "'+T+'"')}else p=" Check pass/fail history for selected "+i.entityType;this.$(".chart-header").html(p),this.subViewHelper.get("testEntityHistoryChartView").setStatsModel(d)},onResize:function(){this.subViewHelper&&this.subViewHelper.iterate("onResize")},initialize:function(){n.debug("TestDetailsView : initialize: "," | viewid     : "+this.cid),this.subViewHelper=new s,this.$el.html(c()),this._initializeSubViews()},onStartServices:function(){this.model.on("change:selectedTestTrigger",this.render,this),this.subViewHelper.iterate("onStartServices")},onStopServices:function(){this.model.off("change:selectedTestTrigger",this.render,this),this.subViewHelper.iterate("onStopServices")},render:function(){n.debug("TestDetailsView : render: "," | viewid     : "+this.cid),this._initializeSubViews();var e=this.model.getSelectedTest();if(!e)return this.$(".n-description").html(this.noTestSelectedHTML),this.$(".n-description").addClass("n-no-test"),void this.$(".n-test-history").hide();var t=e.getScheduleName(),i=null;e.get(r.TEST_CHECK_TYPE)===r.HEALTH_CHECK_TYPE_VALUES.EVENT_DRIVEN?i="This Check is Event Triggered":e.get(e.DP.ENABLED)?(i=t?"It is scheduled to run "+t.toLowerCase():"This check does not have an assigned schedule.",i+="."):i="This check is currently disabled.";var s=n.getElapsedTime({timestamp:e.get(r.TEST_LAST_MODIFIED)}),a=e.toDisplayJSON(),o=l({description:a.description,test:a,scheduleText:i,lastUpdated:s});this.$(".n-description").html(o),this.$(".n-description").removeClass("n-no-test"),this.$(".n-test-history").show(),this.$(".detailedHistory").hide();var c=e.getHealthSummaryId(),h=this.model.getErredTestDetails(),p=0;h[c]&&h[c].nodeLevel&&(p=h[c].nodeLevel.length);var T=this.model.getSelectedEntityType(),E=T?this.model.getEntityTypeName(T,!1):"entities",g=d({entityTypeName:E,nodeErrorCount:p});this.$(".testEntityHistoryHeader").html(g),this.subViewHelper.renderAll();var _=this;p>0?setTimeout(function(){_.$(".n-test-header a").popover({content:u({nodes:h[c].nodeLevel}),html:!0,placement:"left",title:"Node Errors",trigger:"manual"})},10):this.$(".n-test-header a").popover("destroy")},showPopover:function(){this.$(".n-test-header a.in-active").popover("show").removeClass("in-active").addClass("active")},clearPopover:function(){this.$(".n-test-header a.active").popover("hide").addClass("in-active").removeClass("active")},_initializeSubViews:function(){this.subViewHelper.destroy();var e=this,n=new t({el:this.$(".testEntityHistory"),model:this.model,onEntitySelectCB:function(t,i){e.onEntitySelectCB(t,i)}});this.subViewHelper.register("testEntityHistoryView",n);var s=new i({el:this.$(".testHistory"),model:this.model});this.subViewHelper.register("testEntityHistoryChartView",s)},_getMetrics:function(e,t){var i=e.get(e.idAttribute),n=[],s=t.getValue(r.HEALTH_CHECK_SUMMARIES);if(s&&s[i]){var a=s[i][r.HEALTH_CHECK_ATTRIB_MAP];a&&(n=n.concat(_.keys(a)))}return n},destroy:function(){n.debug("TestDetailsView : destroy: "," | viewid     : "+this.cid),this.subViewHelper.destroy(),this.$(".n-test-header a").popover("destroy"),e.prototype.destroy.apply(this,arguments)}})}),define("text!templates/pages/cluster/CauseAndResolutionView.html",[],function(){return'<div class="n-cause-res">\n  <h3 class="n-c-r-header">Causes of failure</h3>\n  <% _.each(causes, function(cause) { %>\n    <p class="n-c-r-copy"><%= cause %></p>\n  <% }) %>\n</div>\n<div class="n-cause-res">\n  <h3 class="n-c-r-header">Resolutions</h3>\n  <% _.each(resolutions, function(resolution) { %>\n  <p class="n-c-r-copy"><%= resolution %></p>\n  <% }) %>\n</div>\n<% if ( impacts && impacts.length ) { %>\n  <div class="n-cause-res">\n    <h3 class="n-c-r-header">Impact</h3>\n    <% _.each(impacts, function(impacts) { %>\n    <p class="n-c-r-copy"><%= impacts %></p>\n    <% }) %>\n  </div>\n<% } %>\n<% if ( kbList && kbList.length ) { %>\n  <div class="n-cause-res">\n    <h3 class="n-c-r-header">References</h3>\n    <% _.each(kbList, function(kb, index) { %>\n    <p class="n-c-r-copy"><a href="<%= kb %>" target="_blank">\n      Related Nutanix Knowledge Base (KB) Article\n      <%= kbList.length > 1? index+1: \'\' %></a></p>\n    <% }) %>\n  </div>\n<% } %>'}),define("views/pages/cluster/CauseAndResolutionView",["views/basecomponents/BaseView","utils/AppUtil","data/DataProperties","text!templates/pages/cluster/CauseAndResolutionView.html"],function(e,t,i,n){"use strict";var s=_.template(n);return e.extend({noTestSelectedHTML:"<div class='no-data'><span class='n-no-test-text'>Please select a check in the left pane.</span></div>",events:{},initialize:function(){t.debug("CauseAndResolutionView : initialize: "," | viewid     : "+this.cid),this.render()},onStartServices:function(){this.model.on("change:selectedTestTrigger",this.render,this)},onStopServices:function(){this.model.off("change:selectedTestTrigger",this.render,this)},render:function(){t.debug("CauseAndResolutionView : render: "," | viewid     : "+this.cid);var e,n=this.model.getSelectedTest();if(n){var a=n.toDisplayJSON(),r=a[i.TEST_CAUSES],o=a[i.TEST_RESOLUTIONS],l=a[i.TEST_IMPACTS];e=s({causes:r,resolutions:o,impacts:l,kbList:a[i.TEST_KBLIST]})}else e=this.noTestSelectedHTML;this.$el.html(e)},destroy:function(){t.debug("CauseAndResolutionView : destroy: "," | viewid     : "+this.cid),this.model.off("change:selectedTestTrigger",this.render,this),e.prototype.destroy.apply(this,arguments)}})}),define("text!templates/pages/cluster/TestParametersView.html",[],function(){return'<div class="test-parameters n-modal-wrapper">\n  <div class="n-modal-body">\n    <form id="testParametersForm" class="form-horizontal">\n      <% _.each(parameters, function(valueMap, key) { %>\n        <div class="control-group">\n          <label class="control-label">\n            <%= valueMap.displayName %>\n          </label>\n          <div class="controls">\n            <input type="text"\n                   id="<%= key %>"\n                   value="<%= valueMap.value || \'\' %>"\n                   autocomplete="off">\n          </div>\n        </div>\n      <% }) %>\n    </form>\n    <div class="error-container">\n      <span class=\'control-label errorMessage\'></span>\n    </div>\n  </div>\n  <div class="n-modal-footer">\n    <button class="btnCancel btn">\n      Cancel\n    </button>\n    <button class="btnUpdate btn btn-primary"\n            data-loading-text="Saving...">\n      Update\n    </button>\n  </div>\n</div>\n'}),define("views/pages/cluster/TestParametersView",["views/basecomponents/BaseView","text!templates/pages/cluster/TestParametersView.html"],function(e,t){"use strict";var i=_.template(t);return e.extend({events:{"click .btnCancel":"onClickCancel","click .btnUpdate":"onClickUpdate","keypress input":"clearErrorMsg",click:"onClick"},onClick:function(e){e.stopPropagation()},clearErrorMsg:function(){this._setErrorMessage(null)},onClickCancel:function(){this.trigger("cancel",null)},onClickUpdate:function(e){for(var t=_.clone(this.parameters),i=_.keys(this.parameters),n=!1,s=0;s<i.length;s++){var a=i[s],r=this.$("#"+a).val().trim();if(0===r.length){n=!0;break}t[a]&&(t[a].value=r)}n?(e.stopPropagation(),this._setErrorMessage("Please enter all values")):this.trigger("update",t)},initialize:function(e){if(!e)throw"TestParametersView: Invalid instantiation. Options not available.";this.parameters=e.parameters,this.onCancel=e.onCancel,this.onUpdate=e.onUpdate,this.render()},render:function(){this.$el.html(i({parameters:this.parameters}))},_setErrorMessage:function(e){e?(this.$(".errorMessage").html(e),this.$(".error-container").show()):this.$(".error-container").hide()}})}),define("text!templates/pages/cluster/ClusterHealthTestsView.html",[],function(){return'<div class="health-container">\n\n  \x3c!-- LEFT PANEL --\x3e\n  <div class="side-panel left-panel">\n    <div class="panel-header test-panel-header">\n      <span class="header-option">Manage Checks</span>\n      <div class="dropdown -actions pull-right">\n        <a class="dropdown-toggle header-option action-dropdown" data-toggle="dropdown">\n          Actions <%= downArrow %>\n        </a>\n        <ul class="dropdown-menu">\n          <li>\n            <a class="btnAction" id="create-ncc-schedule"\n               title="<%= i18n(\'setNccSchedule\')%>"\n               action="set_ncc_frequency"\n               actionTarget="cluster">\n              <%= i18n(\'setNccSchedule\')%></a>\n          </li>\n          <li>\n            <a class="btnAction" id="run-checks"\n               title="A manual NCC check/Log Collector is already in progress."\n               action="run_check"\n               actionTarget="cluster">\n              Run Checks</a>\n          </li>\n          <li>\n            <a class="btnAction" id="log-collector"\n               title="A manual Log Collector/NCC check is already in progress."\n               action="<%= isNewLogCollector ? \'broker_dynamic\' : \'fetch\' %>"\n               actiontarget="cluster"\n               actionParentEntityType="cluster">\n              <%= i18n(\'logCollector\')%>\n            </a>\n          </li>\n        </ul>\n      </div>\n    </div>\n\n    \x3c!-- Scrollable inner panel --\x3e\n    <div class="left-panel-container">\n      <div class="antiscroll-wrap">\n        <div class="box-wrap">\n          <div class="antiscroll-inner left-panel-inner">\n            <div class="left-panel-inner-wrapper">\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n\n  </div>\n\n  \x3c!-- CENTER PANEL --\x3e\n  <div class="center-panel">\n    <div class="panel-header">\n    </div>\n    <div class="center-panel-container">\n      <div class="antiscroll-wrap">\n        <div class="box-wrap center-panel-box-wrap">\n          <div class="antiscroll-inner center-panel-inner">\n            <div class="center-panel-inner-wrapper">\n              <div class="ctr-testDetails"></div>\n            </div>\n          </div>\n        </div>\n        <div>\n        </div>\n      </div>\n    </div>\n  </div>\n\n  \x3c!-- RIGHT PANEL --\x3e\n  <div class="side-panel right-panel">\n    <div class="panel-header right-panel-header cr-panel-header">\n      Causes &amp; Resolutions\n      <div class="header-change-view-button header-change-view-action">\n        Back to Entities</div>\n    </div>\n\n    <div class="right-panel-container">\n      <div class="antiscroll-wrap">\n        <div class="box-wrap">\n          <div class="antiscroll-inner right-panel-inner">\n            <div class="right-panel-inner-wrapper">\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n</div>\n'}),define("text!templates/pages/cluster/TestHeader.html",[],function(){return'<div class="n-test-controls">\n  <% if ( canModify ) { %>\n    <div class="n-control <%= (isEventTriggered || !isEnabled) ? \'run-check-off\' : \'run-check\' %> <%= nccActive ? \'check-running\': \'check-runnable\'%>"\n         title="<%= nccActive ? \'A manual NCC check is already in progress. Multiple NCC checks can not be run in parallel.\' : \'Run Check\'%>">\n      <%= SVG.SVGIcon(\'Play\', \'-regular\') %>\n      <span class="test-run-text">\n        Run Check\n      </span>\n    </div>\n    <div class="n-control test-enable\n      <%= test.enabled ? \'test-on\' : \'test-off\' %>">\n      <%= SVG.SVGIcon(\'Power\', \'-regular\') %>\n      <span class="test-enable-text">\n        Turn Check <%= test.enabled ? "Off" : "On" %>\n      </span>\n    </div>\n    <div class="n-control test-parameters\n                <%= hasParameters ? \'\' : \'parameters-off\' %>" >\n      <i aria-hidden="true" data-icon="C" class="n-icon" title="Parameters"></i>\n      <span class="test-parameters-text">Parameters</span>\n      <i aria-hidden="true" data-icon="z" class="n-icon"></i>\n    </div>\n    <% if (hasAlertId) { %>\n      <div class="n-control" >\n        <div class="btnAction" action="show" actionTargetId="<%= id %>" actionTarget="alert_policy">\n          <i aria-hidden="true" data-icon="C" class="n-icon" title="Alert Policy"></i>\n          <span class="test-policy-text">Alert Policy</span>\n        </div>\n      </div>\n    <% } %>\n    <div class="n-control dropdown schedule-dropdown <%= !isScheduled ? \'schedule-off\' : \'\'%>">\n      <a data-toggle="dropdown" href="#" class="dropdown-toggle">\n        <i aria-hidden="true" data-icon="E" class="n-icon" title="Schedule"></i>\n        <span class="test-schedule-text">Schedule</span>\n        <i aria-hidden="true" data-icon="z" class="n-icon"></i>\n      </a>\n      <ul class="dropdown-menu dropdown-menu-left">\n        <% _.each( scheduleOptions, function(opt) { %>\n          <% if ( opt.value == test.scheduleIntervalInSecs ) { %>\n            <li class="selected">\n          <% } else { %>\n            <li>\n          <% }  %>\n            <a data-id="<%=opt.value%>" class="schedule-option">\n              <%= opt.name %>\n            </a>\n          </li>\n        <% }) %>\n      </ul>\n    </div>\n  <% } %>\n</div>\n<div class="test-header" id="<%= test.id %>">\n  <div class="test-name"><%= testName %></div>\n</div>'}),define("views/pages/cluster/ClusterHealthTestsView",["utils/AppUtil","utils/SVG","managers/AccessManager","managers/UserBehaviorManager","models/ncc/RunCheckModel","data/DataProperties","views/pages/cluster/ClusterHealthBaseSubpageView","views/pages/cluster/TestsView","views/pages/cluster/TestDetailsView","views/pages/cluster/CauseAndResolutionView","views/pages/cluster/TestParametersView","utils/AppConstants","text!templates/pages/cluster/ClusterHealthTestsView.html","text!templates/pages/cluster/TestHeader.html"],function(e,t,i,n,s,a,r,o,l,c,d,u,h,p){"use strict";var T=_.template(p),E=_.template(h);return r.extend({name:"ClusterHealthTestsView",onTestEnable:function(e){e.stopPropagation(),this._destroyPopover();var t=this.model.getSelectedTest();if(t){var i=this,s=t.get(a.TEST_ENABLED),r=s?"Turn this check off ?":"Turn this check on ?";$.nutanixConfirm({msg:r,yes:function(){n.recordUserActivities({action:s?"disable":"enable",actionTarget:$(e.currentTarget).parent().next().text().trim()+" check"}),i.model.enableDisableSelectedTest()},yesText:"Yes",noText:"No"})}},onRunCheck:function(t){var i=this.model.getSelectedTest(),n=i.getHealthSummaryId(),a=new s;a.set(s.DP.NCC_CHECKS,[n]),a.save(null,{success:function(t){e.log("Run Check triggered")},error:function(t,i){e.log("Run Check Error")}})},getTooltipPlacement:function(){return"right"},onTestParameters:function(e){var t=$(e.currentTarget);if(e.stopPropagation(),this._destroyPopover(),!t.hasClass("parameters-off")){var i=this.model.getSelectedTest(),n=new d({parameters:i.get(a.TEST_PARAMETERS)});n.on("update",this._updateTestParameters,this),n.on("cancel",this._destroyPopover,this),t.popover({content:n.el,trigger:"manual",html:"true",animation:!1,placement:"bottom",title:"",delay:0,container:$("body")}),t.popover("show"),$(document).on("click",this.onDocumentClick),this.subViewHelper.register("testParametersView",n)}},onScheduleDropDownClick:function(){this._destroyPopover()},onDocumentClick:function(){this._destroyPopover()},onSelectedTestChange:function(){this._renderPanelHeaders(),this._refreshScrollers()},initialize:function(){r.prototype.initialize.apply(this,arguments),this.render(),this.eventBus.bind("showSelectedTab",this.onShowSelectedTab.bind(this)),_.bindAll(this,"onDocumentClick"),this.model.fetchData()},onShowSelectedTab:function(){this.eventBus.trigger("tabChanged")},onStartServices:function(){this.model.on("change:selectedTestTrigger",this.onSelectedTestChange,this),this.model.on("change:errorMessageTrigger",this.onError,this),this.subViewHelper.iterate("onStartServices"),this.model.getSelectedTest()&&(this.refreshCenterView(),this.subViewHelper.get("causeAndResolutionView").render()),this._renderPanelHeaders(),this._createTooltip()},onStopServices:function(){this.model.off("change:selectedTestTrigger",this.onSelectedTestChange,this),this.model.off("change:errorMessageTrigger",this.onError,this),this.eventBus.off("showSelectedTab",this.onShowSelectedTab,this),this._destroyPopover(),this._destroyTooltip(),this.subViewHelper.iterate("onStopServices")},_renderViewTemplate:function(){var i=this.clusterManager.getCurrentClusterModel();e.debug("ClusterHealthTestsView : _renderViewTemplate: "," | viewid     : "+this.cid),this.$el.html(E(this.vtOptions({isNewLogCollector:i.isNewLogCollectorEnabled(),downArrow:t.SVGIcon("z","-down-arrow")})))},_initializeSubViews:function(){var e=new o({el:this.$(".left-panel-inner-wrapper"),model:this.model,eventBus:this.eventBus});this.subViewHelper.register("testsView",e);var t=new l({el:this.$(".ctr-testDetails"),model:this.model});this.subViewHelper.register("testDetailsView",t);var i=new c({el:this.$(".right-panel-inner-wrapper"),model:this.model});this.subViewHelper.register("causeAndResolutionView",i),this.setCenterView("testDetailsView")},_renderPanelHeaders:function(){var e="",n=this.isNCCTaskActive(),s=this.model.getSelectedTest();s&&(e=T({test:s.toJSON(),testName:s.getDisplayName(),SVG:t,isEventTriggered:s.get(a.TEST_CHECK_TYPE)===a.HEALTH_CHECK_TYPE_VALUES.EVENT_DRIVEN,isScheduled:s.get(a.TEST_CHECK_TYPE)===a.HEALTH_CHECK_TYPE_VALUES.SCHEDULED,isEnabled:s.get(a.TEST_ENABLED),nccActive:n,scheduleOptions:s.getSchedules(),hasAlertId:!_.isEmpty(s.get(a.ALERT_TYPE_ID)),id:s.get(a.ID),hasParameters:!_.isEmpty(s.get(a.TEST_PARAMETERS)),canModify:i.canModifyByEntityType(u.ENTITY_CLUSTER)})),this.$(".center-panel .panel-header").html(e),this._renderTestsHeader(this.$(".left-panel .panel-header"))},_updateTestParameters:function(e){this._destroyPopover(),this.model.updateSelectedTestParameters(e)},_destroyPopover:function(){$(document).off("click",this.onDocumentClick),this.$(".dropdown.open").removeClass("open"),this.$(".test-parameters").popover("destroy"),this.subViewHelper.get("testParametersView")&&this.subViewHelper.remove("testParametersView")},_createTooltip:function(){this.$(".run-check-disabled").tooltip({placement:"left",trigger:"hover",html:!1})},_destroyTooltip:function(){this.$(".run-check-disabled").tooltip("destroy")}})}),define("views/pages/cluster/ClusterHealthPageView",["views/basecomponents/pages/BasePageView","managers/TutorialManager","managers/AjaxManager","managers/NavigationManager","models/cluster/ClusterHealthModel","views/pages/cluster/ClusterHealthEntitiesView","views/pages/cluster/ClusterHealthTestsView","utils/AppUtil","utils/AppConstants"],function(e,t,i,n,s,a,r,o,l){"use strict";return e.extend({pageId:l.PAGE_CLUSTER_HEALTH,defaultSubPageId:l.SUBPAGE_ENTITIES,initialize:function(){this.model=new s,e.prototype.initialize.apply(this,arguments)},onShowSubPage:function(e,t){$("body").addClass("n-app-noscroll"),this.model.monitorHealthChanges(),this.$(".n-page-nav").hide();var i;switch(e){case l.SUBPAGE_ENTITIES:i=this.getSubView(l.SUBPAGE_ENTITIES),i||(i=this.registerSubView(e,new a({el:this.getSubPageElement(l.SUBPAGE_ENTITIES),model:this.model,pageId:l.PAGE_CLUSTER_HEALTH})));var s=this._startTutorial(i);if(i.show(t),!s&&t&&t.length){var c=o.parseQueryToObject(t)||{},d=n.getNavigationContext(c.contextId)
;if(d&&d.entityType){var u=this;setTimeout(function(){u.model.setCurrentTestsSubPage("tests"),u.model.setSelectedEntityType(d.entityType)},100),n.clearNavigationContext(c.contextId)}}break;case l.SUBPAGE_TESTS:i=this.getSubView(l.SUBPAGE_TESTS),i?i.show(t):(i=this.registerSubView(e,new r({el:this.getSubPageElement(l.SUBPAGE_TESTS),model:this.model,pageId:l.PAGE_CLUSTER_HEALTH})),i.show(t))}},onHideSubPage:function(){this.$(".n-page-nav").show(),$("body").removeClass("n-app-noscroll"),this.model.stopMonitoringHealthChanges(),e.prototype.onHideSubPage.apply(this,arguments)},_startTutorial:function(e){if(!o.hasLocalStorage())return!1;if(!localStorage[l.LOCAL_STORAGE.TUTORIAL_CLUSTER_HEALTH]&&!t.isTutorialInProgress()){localStorage[l.LOCAL_STORAGE.TUTORIAL_CLUSTER_HEALTH]=!0;var n=function(){o.debug("ClusterHealthPageView |  Starting Tutorial"),i.startSimulation(l.TUTORIALS.CLUSTER_HEALTH_INTRO),e.reloadSubpage()},s=function(){o.debug("ClusterHealthPageView |  Stopping Tutorial"),i.stopSimulation(l.TUTORIALS.CLUSTER_HEALTH_INTRO),e.reloadSubpage()},a=this;return t.startTutorial({name:l.TUTORIALS.CLUSTER_HEALTH_INTRO,context:a,simulationStartCB:n,simulationCompleteCB:s}),!0}return!1}})}),define("views/pages/ebrowser/viz/EBExpandableTableView",["views/pages/ebrowser/viz/EBTableView","managers/EntityManager","utils/AppConstants","utils/AppUtil"],function(e,t,i,n){"use strict";var s=_.template('<span class="expandable-primary-cell"><%= displayValue %><div class="pull-right"><% if ( showChildren ) { %><div class="children-box" data-id="<%= dataId %>">   <%= children.length %> <%= childrenLabel %></div><% }%></div></span>'),a={};return e.extend({DP:{IS_ROW_CHILD:"isRowChild"},entityTypeOfParent:null,entityTypeOfChildren:null,childrenAttribute:null,primaryAttributeForChild:null,minChildrenVisible:2,extraEvents:{"click .children-box":"onClickChildrenBox"},initialize:function(t){if(e.prototype.initialize.apply(this,arguments),this.addExtraEvents(this.extraEvents),_.isNull(this.entityTypeOfParent)||_.isNull(this.entityTypeOfChildren)||_.isNull(this.childrenAttribute)||_.isNull(this.primaryAttributeForChild))throw new Error("Override all the appropriate properties.")},render:function(){e.prototype.render.apply(this,arguments),this.dataTable&&this.dataTable.addClass("n-expandable")},getExpandedRowIds:function(){return _.isArray(a[this.entityTypeOfParent])||(a[this.entityTypeOfParent]=[]),a[this.entityTypeOfParent]},setExpandedRowIds:function(e){a[this.entityTypeOfParent]=e},renderColumnCheckbox:function(t,i,n){return n.get(this.DP.IS_ROW_CHILD)?"":e.prototype.renderColumnCheckbox.apply(this,arguments)},getDisplayValueForPrimaryAttribute:function(e){},renderPrimaryColumnCell:function(e,t,a,r){var o=r.getAttributeDisplayValue(a,!0,e),l=a.getValue(this.childrenAttribute)||[];a.get(this.DP.IS_ROW_CHILD)&&(o=this.getDisplayValueForPrimaryAttribute(a)||a.getValue(this.primaryAttributeForChild));var c=this.isChildrenBoxShown(a,l);switch(t){case i.TABLE_COL_TYPE_DISPLAY:return s({dataId:a.getId(),displayValue:_.escape(o),children:l,childrenLabel:n.getEntityNameFromCount(this.entityTypeOfChildren,l.length),showChildren:c});case i.TABLE_COL_TYPE_EXPORT:return e;default:return _.escape(o)}},renderColumnCell:function(t,i,n,s){if(n.get(this.DP.IS_ROW_CHILD)){if(s.get(s.nameAttribute)===this.primaryAttributeForChild)return""}return e.prototype.renderColumnCell.apply(this,arguments)},updateDataSource:function(e){e=this.updateExpandCollapseRowData(e),this.model.reset(e)},_dataTableRowCallback:function(t,i,n){e.prototype._dataTableRowCallback.apply(this,arguments);var s=$(t);i.get(this.DP.IS_ROW_CHILD)?s.addClass("row-child"):this._isRowExpanded(i.get(i.idAttribute))&&s.find(".children-box").addClass("active")},updateExpandCollapseRowData:function(e){var i=[];return _.each(e,function(e){var n=e.get(this.childrenAttribute);if(e.get(this.DP.IS_ROW_CHILD)||i.push(e),this._isRowExpanded(e.getId())){var s=0;_.each(n,function(n){var a=_.extend({id:e.get(e.idAttribute)+s++},n),r=t.createGenericEntityModel(this.entityTypeOfParent);r.set(a),r.set(this.DP.IS_ROW_CHILD,!0),i.push(r)},this)}},this),i},_isRowExpanded:function(e){var t=this.getExpandedRowIds(),i=_.find(t,function(t){return t===e});return!_.isUndefined(i)&&!_.isNull(i)},isChildrenBoxShown:function(e,t){return this.minChildrenVisible<=t.length},onClickDataRow:function(){this.dataTable&&e.prototype.onClickDataRow.apply(this,arguments)},onClickChildrenBox:function(e){var t=$(e.currentTarget),i=t.attr("data-id"),n=this.getExpandedRowIds();this._isRowExpanded(i)?n=_.reject(n,function(e){return e===i}):n.push(i),this.setExpandedRowIds(n),this.updateDataSource(this.model.models)}})}),define("models/ncc/NCCTaskModel",["models/PollingModel","data/DataURLConstants","data/DataProperties","managers/NotificationManager"],function(e,t,i,n){"use strict";return e.extend({urlRoot:t.NCC_CHECKS,idAttribute:i.ID,nameAttribute:i.NAME,name:"NCCTaskModel",defaults:{numChecks:0,numPass:0,numFail:0,numError:0,startTimeInUsecs:0,runSummary:null},getURL:function(){var e=this.get(i.ID);return _.template(t.NCC_CHECK_STATUS,{taskid:e})},showLatencyNotification:function(){},showSuccessNotification:function(){n.hideLatencyMessage(this.latencyId)},hideLatencyNotification:function(){n.hideLatencyMessage(this.latencyId)},triggerAppViewRefresh:function(){}})}),define("views/pages/tasks/viz/TaskEBTableView",["views/pages/ebrowser/viz/EBExpandableTableView","models/ncc/NCCTaskModel","models/vm/VMModel","data/DataManager","managers/ActionManager","managers/NavigationManager","managers/ClusterManager","data/DataURLConstants","data/DataProperties","utils/AppConstants","utils/AppUtil","utils/DataExportUtil","utils/AjaxUtil","utils/VMUtil","events/AppEvents"],function(e,t,i,n,s,a,r,o,l,c,d,u,h,p,T){"use strict";var E=_.template("data:<%= mimeType %>;charset=utf-8,<%= data %>");return e.extend({name:"TaskEBTableView",entityTypeOfParent:c.ENTITY_TASK,entityTypeOfChildren:c.ENTITY_SUBTASK,childrenAttribute:l.TASK_SUB_TASKS,primaryAttributeForChild:l.TASK_NAME,PLAINTEXT:"text/plain",initialize:function(){e.prototype.initialize.apply(this,arguments),this.addExtraEvents({"click     .entityDetails":"onClickBatchTaskEntities","click     .taskUpgradeDetails":"onClickBatchTaskEntities","click     .pageLink":"onPageLinkClick","click     .n-link-action":"onClickLinkAction","click     .enableTooltip":"onClickTaskStatus","mouseover .taskStatusDetails":"onStatusMouseOver","mouseout  .taskStatusDetails":"onStatusMouseOut","mouseover .pageLink":"onPageLinkMouseOver","mouseout  .pageLink":"onPageLinkMouseOut","mouseover .entityDetailsTooltip":"onEntityDetailsMouseOver","mouseout  .entityDetailsTooltip":"onEntityDetailsMouseOut"})},render:function(){e.prototype.render.apply(this,arguments),this.$el.tooltip({placement:"right",trigger:"hover",html:!0,selector:".enableTooltip"})},destroy:function(){this.$(".pageLink").tooltip("destroy"),this.$el.tooltip("destroy"),e.prototype.destroy.apply(this,arguments)},getDefaultColumns:function(t,i){var n=e.prototype.getDefaultColumns.apply(this,arguments);if(n.shift(),!r.isMulticlusterNavMode()){var s=[];return _.each(n,function(e){e.ntnxAttr!==l.TASK_CLUSTER_NAME&&s.push(e)}),s}return n},getDefaultSort:function(){return[]},onClickBatchTaskEntities:function(e){var t=$(e.currentTarget).attr("data-id"),i=this.model.findModelById(t),n=$(e.currentTarget).hasClass("taskUpgradeDetails"),a=$(e.currentTarget).hasClass("entityDetails"),o=!1;a&&(o=!0),!i.isClusterUpgradeTask()||i.isFileServerUpgradeTask()&&!n?T.triggerAppEvent(T.TASK_DRILLDOWN_BATCH,{taskModel:i,clearFilter:o}):r.isMulticlusterNavMode()&&i.getClusterUuid()?s.onEntityAction(c.ENTITY_CLUSTER,c.ACTION_NAVIGATE_TO_PE,[i.getClusterUuid()]):s.executeAction({action:c.ACTION_UPGRADE,actionTarget:c.ENTITY_CLUSTER})},onPageLinkClick:function(e){r.isMulticlusterNavMode()?s.executeActionElement(e.currentTarget,{changeUrl:!0}):a.navigateToPageByPageLink(e.currentTarget)},_renderTooltip:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];e.tooltip({title:t,placement:"top",trigger:"manual",html:i}),e.tooltip("show")},onPageLinkMouseOver:function(e){var t=this,n=$(e.currentTarget),s=n.attr(c.NAV_ACTION_TARGET_ID),a=n.attr(c.NAV_ACTION_TARGET);if(this.$(".pageLink").tooltip("destroy"),s&&a===c.ENTITY_VM){var r=new i;r.setId(s),r.fetch({success:function(){var e=t.i18n("vm_name")+": "+r.getName();$(n).attr("data-original-title",e),t._renderTooltip(n,e)},error:function(e,i){var s=h.processAjaxError(i.responseText);$(n).attr("data-original-title",s),t._renderTooltip(n,s)}})}},onPageLinkMouseOut:function(e){this.$(".pageLink").tooltip("destroy")},onEntityDetailsMouseOver:function(e){var t=this,i=$(e.currentTarget),n=i.attr(c.NAV_ACTION_TARGET),s=i.attr(c.NAV_ACTION_TARGET_ID).split("|");switch(this.$(".entityDetailsTooltip").tooltip("destroy"),n){case c.ENTITY_VM:this._renderTooltip(i,this.i18n("loading")),p.getVMNamesByIds(s,function(e){t.$(".entityDetailsTooltip").tooltip("destroy");var n=_.first(e,3);e.length>3&&n.push(e.length-3+" more"),t._renderTooltip(i,n.join("<br>"),!0)});break;default:this._renderTooltip(i,s.join("<br>"),!0)}},onEntityDetailsMouseOut:function(e){this.$(".entityDetailsTooltip").tooltip("destroy")},onClickLinkAction:function(e){var t=$(e.currentTarget);if(t.hasClass("schedule-link")){var i=t.attr(c.NAV_ACTION);s.onEntityAction(t.attr(c.NAV_ACTION_TARGET),i,[t.attr(c.NAV_ACTION_TARGET_ID)])}else s.executeActionElement(e.currentTarget,{changeUrl:!1})},onStatusMouseOver:function(e){var t=$(e.currentTarget),i=t.attr("data-id"),n=this.model.get(i);if(null!==n){var s=_.escape(n.getErrorMessage());t.tooltip({title:s,placement:"top",trigger:"manual",html:!0}),t.tooltip("show")}},onClickTaskStatus:function(e){var i=this,n=$(e.currentTarget),s=n.attr("data-id");if(r.getCurrentClusterModel().isNewLogCollectorEnabled()){var a=this.buildLogbayDownloadUrl(s);this.downloadUrlContent(a)}else{var o=new t({id:s});o.fetch({success:function(){if(o.get(l.TASK_RUN_MESSAGE)){var e=o.get(l.TASK_RUN_MESSAGE),t=i.buildDownloadUrl(e);i.downloadUrlContent(t)}else o.get(l.TASK_RUN_SUMMARY)?i.downloadOutput(o.get(l.TASK_RUN_SUMMARY)):d.log("Unable to find the log file")},error:function(e){d.log("Server error")}})}},downloadUrlContent:function(e){var t=null;d.getBrowser()===c.BROWSER_AGENT.SAFARI&&(t=window.open(E({mimeType:this.PLAINTEXT,data:this.i18n("downloading")}),"_blank")),t?t.location=e:a.navigateToURL(e,!0)},buildDownloadUrl:function(e){return window.location.protocol+"//"+window.location.host+window.location.pathname+c.DOWNLOADS_PATH+"/"+e},buildLogbayDownloadUrl:function(e){return n.getV3DataSourceURL()+_.template(o.NCC_DOWNLOAD_BUNDLE,{taskid:e})},downloadOutput:function(e){var t=u.getWinRef();u._export({type:"txt",data:e},t)},onStatusMouseOut:function(e){$(e.currentTarget).tooltip("destroy")},isChildrenBoxShown:function(t,i){return!t.isClusterUpgradeTask()&&(!t.isFanOut()&&(!!t.isOldTask()||e.prototype.isChildrenBoxShown.apply(this,arguments)))},getDisplayValueForPrimaryAttribute:function(e){return e.getValue(l.TASK_DISPLAY_NAME)||e.getValue(this.primaryAttributeForChild)||e.getValue(l.SUB_TASK_MESSAGE)}})}),define("views/pages/tasks/viz/TaskTableVisualizationView",["views/pages/ebrowser/viz/BaseTableVisualizationView","views/pages/tasks/viz/TaskEBTableView","utils/AppConstants","utils/AppUtil","components/Components","managers/ClusterManager"],function(e,t,i,n,s,a){"use strict";var r=_.template('<% if ( value ) { %><% if ( nbSelected > 0 ) { %><div class="selection-count"><%= nbSelected %> Selected &nbsp;/&nbsp;</div><% } %><div class="description"><%= value %> Total <%= description %></div><% } else { %><div class="description">There are no <%= description %> available.</div><% } %>');return e.extend({_isGroupTaskRendered:!1,_renderGroupMembers:function(){e.prototype._renderGroupMembers.apply(this,arguments),this._isGroupTaskRendered=!0},isGroupTaskRendered:function(){return this._isGroupTaskRendered},isSelectionEnabled:function(){return!1},getEBTableView:function(e){var i=this;return new t(_.extend(e,{onDrawCallback:function(){},onEntityDetails:function(e){i.showEntityDetails(e)}}))},getTaskTotalCountDisplay:function(e){return e>=i.TASK_MAX_TOTAL_COUNT?i.TASK_MAX_TOTAL_COUNT+"+":e},_renderAllGroupHeader:function(e){var t=this.getSelectedEntityIds(this.entityType),i=this.queryResults[this.queryResults.DP.PAGINATOR],s=i.getGroupVisibleSelectedIds(e,t),a=e.get(e.DP.TOTAL_ENTITY_COUNT);return r({value:this.getTaskTotalCountDisplay(a),description:n.getPluralEntityName(this.entityType),nbSelected:s.length})},_renderGroupPaginator:function(e){var t='.group-container[data-id="'+e.get(e.idAttribute)+'"]  .paginator',i=this.queryResults[this.queryResults.DP.PAGINATOR],n=i.getPaginationInfo(e);n.pageSizeOptions=a.isMulticlusterUI()?this.PAGE_SIZE_OPTIONS:null,n.total=this.getTaskTotalCountDisplay(n.total),this.$(t).html(s.pager(n))}})}),define("views/pages/tasks/TaskEBPerspectivesView",["views/pages/ebrowser/EBPerspectivesView","views/pages/tasks/viz/TaskTableVisualizationView","managers/TaskManager","utils/AppUtil"],function(e,t,i,n){"use strict";var s=_.template('<div class="donut-loader-blue"></div><span class="loading-tasks">Loading <%= showMore ? "More" : "" %> Tasks...</span>');return e.extend({initialize:function(){e.prototype.initialize.apply(this,arguments),this.$(".controls-container > .selections").hide()},render:function(){e.prototype.render.apply(this,arguments),this.showTaskLoading()},showTaskLoading:function(){if(i.getGlobalTasks().isTaskLoading()&&!i.getGlobalTasks().isAllTaskFetched()){this.$(".no-entities").html(s({showMore:!1}));var e=this.$(".summary-all-group .description");e.length&&e.html(s({showMore:!0})),n.showLoader(!0)}else n.hideLoader()},showSelectedEntitiesMenu:function(){return!1},_addTooltip:function(){},_renderQueryOptions:function(){this.$(".eb-options").hide()},getTableVisualizationView:function(e){return new t(e)}})}),define("views/pages/tasks/TaskEntityBrowserView",["views/pages/ebrowser/EntityBrowserView","views/pages/tasks/TaskEBPerspectivesView","managers/TaskManager","managers/ExploreManager","utils/AppConstants","utils/AppUtil","events/AppEvents"],function(e,t,i,n,s,a,r){"use strict";return e.extend({initialize:function(){_.bindAll(this,"onTaskDrilldownBatch"),r.onAppEvent(r.TASK_DRILLDOWN_BATCH,this.onTaskDrilldownBatch),i.getGlobalTasks().isAllTaskFetched()||i.getGlobalTasks().isTaskLoading()||(i.fetchOnDemand(),a.showLoader(!0)),e.prototype.initialize.apply(this,arguments)},destroy:function(){r.offAppEvent(r.TASK_DRILLDOWN_BATCH,this.onTaskDrilldownBatch),e.prototype.destroy.apply(this,arguments)},onTaskDrilldownBatch:function(e,t){this.model.updateBatchDrilldownFilter(t)},showLeftPanel:function(){return n.isEnableSearchConvergence()},getDefaultEntityType:function(){return s.ENTITY_TASK},createPerspectivesView:function(e,i){return new t({el:e,model:i})}})}),define("models/task/TaskEntityBrowserModel",["data/DataProperties","models/task/TaskEBQueryModel","models/ebrowser/EntityBrowserModel","utils/AppConstants"],function(e,t,i,n){"use strict";return i.extend({name:"TaskEntityBrowserModel",startQueryPolling:function(){},stopQueryPolling:function(){},getEBQueryModelInstance:function(e){return new t(e)},getEntityTypes:function(){return[n.ENTITY_TASK]},updateBatchDrilldownFilter:function(t){var i=t.taskModel,s=t.clearFilter,a=n.ENTITY_TASK,r=this.subModelHelper.get("EBFiltersManager"),o=r.getAllFiltersByEntityType(a),l=_.find(o,function(t){return t.get(t.DP.ATTRIBUTE)===e.TASK_NAME});l.set(l.DP.NAME,n.FILTER_DRILLDOWN);var c=i.getTaskMessageSummary();l.set(l.DP.CUSTOM_LABEL,"Details of "+c),s&&r.clearAllFilters(a),this.updateFilter(l.getId(),n.FILTER_OPERATORS.EQUALS,i.getId(),null,!0,a)},onTasksChange:function(){},startTaskPolling:function(){},stopTaskPolling:function(){},fetchEntityCounts:function(){!(arguments.length>0&&void 0!==arguments[0])||arguments[0];i.prototype.fetchEntityCounts.call(this,!1)}})}),define("views/pages/tasks/TasksPageView",["views/pages/ebrowser/EntityBrowserPageView","views/pages/tasks/TaskEntityBrowserView","managers/TaskManager","models/task/TaskEntityBrowserModel","utils/AppConstants"],function(e,t,i,n,s){"use strict";return e.extend({pageId:s.PAGE_TASKS,defaultSubPageId:s.SUBPAGE_ENTITIES,initialize:function(){_.bindAll(this,"onGlobalTaskFetch"),e.prototype.initialize.apply(this,arguments)},createBrowserModel:function(){return new n},getEntityBrowserViewClass:function(){return t},onStartServices:function(){i.registerHandlerResetStructure(this.onGlobalTaskFetch,this),e.prototype.onStartServices.apply(this,arguments)},onStopServices:function(){i.unregisterHandlerResetStructure(this.onGlobalTaskFetch,this),e.prototype.onStopServices.apply(this,arguments)},destroy:function(){i.unregisterHandlerResetStructure(this.onGlobalTaskFetch,this),e.prototype.destroy.apply(this,arguments)},onGlobalTaskFetch:function(){this.model&&this.hasDataLoaded&&this.model.pollCurrentQuery(s.ENTITY_TASK)},_fetchEntityCounts:function(){var t=this.getSubView(s.SUBPAGE_ENTITIES);t&&t.showLeftPanel()&&e.prototype._fetchEntityCounts.apply(this,arguments)}})}),define("views/pages/multicluster/health/MulticlusterHealthPageView",["views/basecomponents/pages/BasePageView","views/basecomponents/datatables/DataTableGroupView","managers/NavigationManager","data/DataURLConstants","utils/AppUtil","utils/AppConstants"],function(e,t,i,n,s,a){"use strict";return e.extend({pageId:a.PAGE_MC_HEALTH,defaultSubPageId:a.SUBPAGE_TABLE,events:{"click .health-page":"onClickHealthPageLink"},onShowSubPage:function(e,i){var n=this.getSubView(e);switch(e){case a.SUBPAGE_TABLE:n||(n=this.registerSubView(e,new t({el:this.getSubPageElement(e),pageId:a.PAGE_MC_HEALTH})),this.$(".n-table-tab-buttons .buttonTab").html(a.PAGE_NAMES[a.PAGE_MC_HEALTH]))}n&&n.show(i)},onClickHealthPageLink:function(e){var t=$(e.currentTarget).attr("clusterUuid"),r={},o={};r.pageId=a.PAGE_CLUSTER_HEALTH,o[n.CLUSTER_ID]=t,r.options=s.formatObjectToQuery(o),i.navigateToPageRouteObject(r,!0)}})}),define("managers/PrismCentralObjectManager",["managers/NotificationManager","managers/NavigationManager","managers/NamespaceManager","data/DataProperties","data/DataURLConstants","utils/AppUtil","utils/AppConstants"],function(e,t,i,n,s,a,r){"use strict";var o=[r.ROUTE_LOGOUT],l={version:"1.0",clusterUuid:null,applyProxyAjax:function(e,t){return"object"==typeof e&&(t=e,e=t.url),t=t||{},"GET"===t.type||void 0===t.type?-1===e.indexOf(s.CLUSTER_PROXY_UUID)&&(t.data=t.data||{},t.data[s.CLUSTER_PROXY_UUID]=this.clusterUuid):-1===e.indexOf(s.CLUSTER_PROXY_UUID)&&(e+=s.MC_PASS_THROUGH_QUERY_PARAMS({delimiter:a.getQueryStringParamDelimiter(e),uuid:this.clusterUuid})),$.ajax(e,t)},toggleMulticlusterNavMenu:function(){$(".n-multi-nav-bar a").trigger("click")},showDisplaySettings:function(){$('.n-nav-menu-item [actiontarget="'+r.DISPLAY_SETTINGS.SETTINGS+'"]').trigger("click")},callPrismElementSuccess:function(){this.hidePrismElementPreloader()},callPrismElementError:function(t){this.hidePrismElementPreloader(),t="The Prism Element encountered an error while being loaded: "+t,e.showClientNotification(r.NOTIFY_ERROR,t),a.log("PrismElementIFrameView : Error : "+t)},hidePrismElementPreloader:function(){$(".n-prism-element-preloader").remove(),$("body").removeClass("n-page-loader-show")},updatePageTitle:function(e){document.title=e},updateRoute:function(e){var i=a.getQueryStringParamDelimiter(e);i="?"===i?"/?":i,-1===_.indexOf(o,e)&&(e+=i+s.CLUSTER_ID+"="+this.clusterUuid),t.navigateToRoute(e)}};return{getNamespaceObject:function(e){var t=_.clone(l);return t[n.CLUSTER_UUID]=e,t[i.IDLE_MANAGER]=i.get(i.IDLE_MANAGER),t[i.SESSION_INFO]=i.get(i.SESSION_INFO),t[n.PC_DELOS]=!0,t}}}),define("views/multicluster/PrismElementIFrameView",["views/basecomponents/BaseView","views/basecomponents/iframe/IFrameView","managers/AppManager","managers/NavigationManager","managers/HelpManager","managers/PrismCentralObjectManager","data/DataProperties","data/DataURLConstants","utils/AppConstants","utils/AppUtil","utils/CommonTemplates","utils/SVG"],function(e,t,i,n,s,a,r,o,l,c,d,u){"use strict";var h=_.template(o.MULTICLUSTER_PE_IFRAME);return e.extend({className:"n-prism-element-container  n-prism-element-frame",iFrameView:null,currentClusterUuid:null,clusterUids:null,clusterVersion:null,_pageRouteObject:null,_isFrameLoaded:null,_pcObjectInstance:null,_iFrameIdWithClusterVersion:null,events:{"click  .linkDoc":"onClickDocLink","click  .linkHome":"onClickHomeLink","click  .linkReload":"onClickReloadLink"},initialize:function(t){t=t||{},this.clusterUids=[],this.clusterVersion=t[r.CLUSTER_NOS_FULL_VERSION],this.setCurrentClusterUuid(t[o.CLUSTER_ID]),this.setIFramePageRoute(t[l.NAV_OPTIONS]),e.prototype.initialize.apply(this,arguments)},render:function(){var e=this.getIFramePageRouteUrl();this.iFrameView=new t({iFrameId:this.getIFrameId(),url:e,width:"100%",height:"100%"}),this.$el.attr(r.VERSION,this.clusterVersion),this.$el.append(this.iFrameView.render().el),0===$(".n-prism-element-preloader").length&&this.$el.append(d.PRELOADER_PRISM_ELEMENT_IFRAME);var s=n.getCurrentPageRoute()||{},l=c.parseQueryToObject(s.options)||{},u=l[o.CLUSTER_ID];this._pcObjectInstance=a.getNamespaceObject(u);var h=this;return c.setIntervalWithTimeout({intervalPeriod:300,timeoutPeriod:12e4,timeoutHandler:function(){c.log("PrismElementIFrameView : The Prism Element does not have the proxy API for initialization."),h._pcObjectInstance.hidePrismElementPreloader(),h._isFrameLoaded=!1,h.showIFrameError()},intervalHandler:function(){var e=h.getIFrameContent();if(e&&null===e.PrismCentral){e.focus(),e.PrismCentral=h._pcObjectInstance;var t=i.getContrastState();return e.$&&e.$("body").addClass(t),h._isFrameLoaded=!0,!0}}}),this},setCurrentClusterUuid:function(e){if(!e)throw new Error("The clusterUuid is required.");this.currentClusterUuid!==e&&(this.currentClusterUuid=e,this._pcObjectInstance&&(this._pcObjectInstance[r.CLUSTER_UUID]=e)),-1===this.clusterUids.indexOf(e)&&this.clusterUids.push(e)},setIFramePageRoute:function(e){this._pageRouteObject=this._pageRouteObject||{},e=e||{},this._pageRouteObject[l.NAV_PAGE_ID]=e[l.NAV_PAGE_ID],this._pageRouteObject[l.NAV_SUBPAGE_ID]=e[l.NAV_SUBPAGE_ID];var t={};_.each(e,function(e,i){i!==l.NAV_PAGE_ID&&i!==l.NAV_SUBPAGE_ID&&i!==r.CLUSTER_NOS_FULL_VERSION&&(t[i]=e)}),t[l.ROUTE_IFRAME_MODE]=!0,this._pageRouteObject[l.NAV_OPTIONS]=t},getIFramePageRouteUrl:function(){var e,t=this._pageRouteObject[l.NAV_OPTIONS];return e=n.canUseActionRoute(t)?n.formActionRouteUrl(t):n.formPageRouteUrl(this._pageRouteObject),h({baseUrl:this.clusterVersion,routeUrl:e})},getIFrameContent:function(){var e=this.$("iframe#"+this.getIFrameId());if(e.length)return e[0].contentWindow},getIFrameId:function(){return this._iFrameIdWithClusterVersion||(this._iFrameIdWithClusterVersion=this.clusterVersion.replace(/(\.|\#|\:)/g,"")),this._iFrameIdWithClusterVersion},showIFrameError:function(){this.$el.removeClass("n-prism-element-frame-error"),this.$el.addClass("n-prism-element-frame-error"),this.$el.html(d.ERROR_SOMETHING_IS_WRONG({SVG:u,mainText:"UNABLE TO ACCESS PRISM ELEMENT INSTANCE.",subText:"Please check your network connection and that iFrame support is enabled in your browser.",actionLinks:'<a class="n-link linkDoc">Try this</a> or <a class="n-link linkReload">reload this page</a> or <a class="n-link linkHome">return to the '+l.MULTICLUSTER_NAME+" home page.</a>"})),i.showHideHeaderElements(!1)},isIFrameLoaded:function(){return this._isFrameLoaded},destroy:function(){this.getIFrameContent()&&this.getIFrameContent().destroy&&this.getIFrameContent().destroy(),this.iFrameView.destroy(),e.prototype.destroy.apply(this,arguments)},onStartServices:function(){if(!this.getIFrameContent())return void c.log("iFrame not loaded in PE: "+this.currentClusterUuid);try{c.log("Attempting to start services on "+this.currentClusterUuid);var e=this.getIFrameContent().nutanix,t=e&&e.ns.appRouter.appView;t&&t.startServices&&t.startServices()}catch(e){c.log("Error: "+e)}},onStopServices:function(){if(!this.getIFrameContent())return void c.log("iFrame not loaded in PE: "+this.currentClusterUuid);try{c.log("Attempting to stop services on "+this.currentClusterUuid);var e=this.getIFrameContent().nutanix,t=e&&e.ns.appRouter.appView;t&&t.stopServices&&t.stopServices()}catch(e){c.log("Error: "+e)}},show:function(e){if(this.setCurrentClusterUuid(e[o.CLUSTER_ID]),this.setIFramePageRoute(e),this.iFrameView){var t=this.getIFramePageRouteUrl();c.log("PrismElementIFrameView : Navigate to URL: "+t),this.iFrameView.updateUrl(t)}$("body").addClass("n-prism-element-app-noscroll"),this.$el.show()},hide:function(){$("body").removeClass("n-prism-element-app-noscroll"),this.$el.hide()},onClickDocLink:function(){s.navigateToHelpPageBasedOnKB(s.MAP_KB_ID.PRISM_ELEMENT_IFRAME_BROKEN)},onClickReloadLink:function(){window.location.reload()},onClickHomeLink:function(){n.navigateToPage(l.PAGE_MC_DASHBOARD,null,null,!0)}})}),define("views/pages/multicluster/iframe/PrismElementIFramePageView",["views/basecomponents/pages/BasePageView","managers/AppManager","data/DataProperties","data/DataURLConstants","views/multicluster/PrismElementIFrameView","utils/AppConstants","utils/AppUtil"],function(e,t,i,n,s,a,r){"use strict";return e.extend({pageId:a.PAGE_MC_PE_IFRAME,defaultSubPageId:a.SUBPAGE_BLANK,iFrameView:null,onShowSubPage:function(e,a){var o=r.parseQueryToObject(a)||{};o[n.CLUSTER_ID]||r.error("PrismElementIFramePageView: clusterID not found in the URL."),o[i.CLUSTER_NOS_FULL_VERSION]||r.error("PrismElementIFramePageView: clusterVersion not found in the URL."),this.iFrameView||(this.iFrameView=new s(o),this.$el.html(this.iFrameView.render().el)),!1===this.iFrameView.isIFrameLoaded()&&t.showHideHeaderElements(!1),this.iFrameView.show(o)},onHideSubPage:function(){this.iFrameView&&this.iFrameView.hide()},onStartServices:function(){this.iFrameView&&this.iFrameView.startServices(),e.prototype.onStartServices.apply(this,arguments)},onStopServices:function(){this.iFrameView&&this.iFrameView.stopServices(),e.prototype.onStopServices.apply(this,arguments)},destroy:function(){this.iFrameView&&this.iFrameView.destroy(),e.prototype.destroy.apply(this,arguments)}})}),define("views/pages/apps/iframe/AppsIFramePageView",["managers/NavigationManager","views/entity/onboarding/NuCalmOnboardingView","views/basecomponents/pages/BasePageView","views/basecomponents/iframe/IFrameView","utils/AppConstants","utils/ExploreConstants"],function(e,t,i,n,s,a){"use strict";function r(e){return"/"+e.replace(/_/g,"/")}return i.extend({name:"AppsIFramePageView",pageId:s.PAGE_APPS,defaultSubPageId:s.SUBPAGE_BLANK,iFrameView:null,deepLink:null,subPageId:null,queryOptions:null,nuCalmOnboardingView:null,reRenderIframeRequired:!1,initialize:function(){i.prototype.initialize.apply(this,arguments),this.onIframeLoaded=this.onIframeLoaded.bind(this),this.nuCalmOnboardingView=new t},destroy:function(){this.iFrameView&&(this.iFrameView.destroy(),this.iFrameView=null),this.nuCalmOnboardingView.destroy(),i.prototype.destroy.apply(this,arguments)},onIframeLoaded:function(){var t=e.getNavigationContext(this.contextId);this.contextId=null,t&&t.entityType&&this.iFrameView.postMessage({service:"prism-ui",serviceTargets:["calm"],action:{target:"SEARCH_SERVICE",state:s.WINDOW_MESSAGES.CHANGE,value:{entityType:t.entityType,entityId:t.options&&t.options.entityId}}},window.location.origin)},_showSubPage:function(t,i){t=t||this.subPageId,i=i||this.queryOptions,this.contextId=i&&i.contextId,t===s.SUBPAGE_BLANK&&this.subPageId&&this.subPageId!==t&&this.iFrameView&&e.navigateToPage(s.PAGE_APPS,this.subPageId),t!==s.SUBPAGE_BLANK&&(this.subPageId=t),this.iFrameView?this.reRenderIframeRequired?(this.reRenderIframeRequired=!1,this.$el.html(this.iFrameView.render().el),this.iFrameView.registerForIframeOnload()):this.onIframeLoaded():(this.reRenderIframeRequired=!1,this.iFrameView=new n({iFrameId:"appsIFrame",url:a.ROUTES.APPS_PREFIX,width:"100%",height:"100%",onIframeLoadedCallback:this.onIframeLoaded}),this.$el.html(this.iFrameView.render().el),t!==s.SUBPAGE_BLANK&&(this.deepLink=r(t)),this.iFrameView.registerForIframeOnload())},onShowSubPage:function(e,t){var i=this;this.subPageId=e,this.queryOptions=t,this.nuCalmOnboardingView.stepsCompleted(function(){i.nuCalmOnboardingView.destroy(),i._showSubPage()}).stepsNotCompleted(function(){i.nuCalmOnboardingView.show(i.$el)})}})}),define("text!templates/pages/fileserver/details/FileServerTabDetailsView.html",[],function(){return'\x3c!-- Wrap --\x3e\n<div class="n-unit-wrap">\n  \x3c!-- Fixed unit --\x3e\n  <div class="n-unit-fixed">\n    \x3c!-- Column 1: Summary --\x3e\n    <div class="n-details-unit">\n      <div class="title"><%= i18n(\'heading\') %></div>\n      <ul class="n-list-info">\n       \x3c!-- File Server List Info --\x3e\n        <li>\n          <div class="n-info-block">\n            <span class="n-label"><%= i18n(\'file_server\') %></span>\n            <ul class="listFileServer  n-ul">\n              \x3c!-- @view: File Servers li links go here... --\x3e\n            </ul>\n          </div>\n        </li>\n        \x3c!-- Share list count --\x3e\n        <li>\n          <div class="n-info-block">\n            <span class="n-label"><%= i18n(\'share_export_count\') %></span>\n            <ul class="listCount n-ul">\n              \x3c!-- @view: Share list count go here... --\x3e\n            </ul>\n          </div>\n        </li\n        \x3c!-- Used Capacity Info --\x3e\n        <li>\n          <div class="n-info-block">\n            <span class="usedCapacityTitle n-label"><%= i18n(\'used_capacity\') %></span>\n            <span class="nutanixMoreInfo"\n              data-tooltip-classes="-nudge-up"\n              data-tooltip-container="body"\n              data-tooltip-title="<%= i18n(\'used_capacity_title\') %>">\n            </span>\n            <a class="usedCapacity n-ul">\n              \x3c!-- @view: Usage data goes here... --\x3e\n            </a>\n          </div>\n        </li>\n      </ul>\n    </div>\n  </div>\n  \x3c!-- Fluid unit --\x3e\n  <div class="n-unit-fluid  n-tab-details-unit">\n    \x3c!-- @view: Tab details view goes here... --\x3e\n  </div>\n</div>\n'}),define("models/fileserver/FileServerUsageModel",["models/MinervaModel","data/DataURLConstants","utils/AppConstants"],function(e,t,i){"use strict";var n={TOTAL_FILE_SERVERS_SPACE_USED_IN_BYTES:"totalFileServersSpaceUsedInBytes"};return e.extend({urlRoot:t.FILE_SERVER_USAGE,entityType:i.ENTITY_FILE_SERVER,DP:n,getURL:function(){return this.url()},parse:function(e,t){return e[0]}},{DP:n})}),define("text!templates/pages/fileserver/details/FileServerTabDetailsEntityView.html",[],function(){
return'\x3c!-- Wrap --\x3e\n<div id="detailsFileServerWrap" class="n-unit-wrap">\n  \x3c!-- Fixed unit --\x3e\n  <div id="detailsFileServerUnitFixed"class="n-unit-fixed">\n    \x3c!-- Column 1: Summary --\x3e\n    <div id="detailsFileServerUnit" class="n-details-unit">\n      <div id="detailsFileServerTitle" class="title"><%= i18n(\'file_server_details\') %></div>\n      <ul id="detailsFileServerListInfo" class="n-list-info">\n        <li>\n          <div class="n-info-block">\n            <span class="n-label"><%= i18n(\'name\') %></span>\n            <span id="detailsFileServerLabelName"\n              class="lblName n-value n-resettable"\n              data-test="fileserver_file_server_details_name">\n              \x3c!-- @value: name used goes here... --\x3e\n            </span>\n          </div>\n        </li>\n\n        <li>\n          <div class="n-info-block">\n            <span class="n-label"><%= i18n(\'domain_name\') %></span>\n            <span id="fsDomainName"\n                  class="lblFsDomainName n-value n-resettable"\n                  data-test="fileserver_file_server_domain_name">\n              \x3c!-- @value: value goes here... --\x3e\n            </span>\n          </div>\n        </li>\n\n        <li>\n          <div class="n-info-block">\n            <span class="n-label"><%= i18n(\'share_export_count\') %></span>\n            <span id="shareCountDetails"\n              class="lblShareCount n-value n-resettable"\n              data-test="fileserver_file_server_details_share_count">\n              \x3c!-- @value: value goes here... --\x3e\n            </span>\n          </div>\n        </li>\n\n        <li>\n          <div class="n-info-block">\n            <span class="n-label"><%= i18n(\'open_connections\') %></span>\n            <span id="connectedUsersDetails"\n              class="lblConnectedUsers n-value n-resettable"\n              data-test="fileserver_file_server_details_connected_users">\n              \x3c!-- @value: value goes here... --\x3e\n            </span>\n          </div>\n        </li>\n\n        <li>\n          <div class="n-info-block">\n            <span class="n-label"><%= i18n(\'space_used\') %></span>\n            <span id="totalSpaceUsedDetails"\n              class="lblTotalSpaceUsed n-value n-resettable"\n              data-test="fileserver_file_server_details_tot_space_used">\n              \x3c!-- @value: value goes here... --\x3e\n            </span>\n          </div>\n        </li>\n\n        <li>\n          <div class="n-info-block">\n            <span class="n-label"><%= i18n(\'space_used_by_snapshots\') %></span>\n            <span id="usedSnapshotSpaceDetails"\n              class="lblSnapshotSpaceUsed n-value n-resettable"\n              data-test="fileserver_file_server_details_used_snap_space">\n              \x3c!-- @value: value goes here... --\x3e\n            </span>\n          </div>\n        </li>\n\n        <li>\n          <div class="n-info-block">\n            <span class="n-label"><%= i18n(\'total_available_space\') %></span>\n            <span id="totalAvailableSpaceDetails"\n                  class="lblAvailableSpace n-value n-resettable"\n                  data-test="fileserver_file_server_details_tot_avail_space">\n              \x3c!-- @value: value goes here... --\x3e\n            </span>\n          </div>\n        </li>\n\n        <li>\n          <div class="n-info-block">\n            <span class="n-label"><%= i18n(\'size\') %></span>\n            <span id="fileServerSize"\n                  class="lblSize n-value n-resettable"\n                  data-test="fileserver_file_server_reserved_size">\n              \x3c!-- @value: value goes here... --\x3e\n            </span>\n          </div>\n        </li>\n\n        <li>\n          <div class="n-info-block">\n            <span class="n-label"><%= i18n(\'protection_domain\') %></span>\n            <span id="fsProtectionDomain"\n              class="lblFsProtectionDomain n-value n-resettable"\n              data-test="fileserver_file_server_details_protection_domain">\n              \x3c!-- @value: value goes here... --\x3e\n            </span>\n          </div>\n        </li>\n\n        <li>\n          <div class="n-info-block">\n            <span class="n-label"><%= i18n(\'storage_container\') %></span>\n            <span id="fsContainer"\n              class="lblFsContainer n-value n-resettable n-fs-container"\n              data-test="fileserver_file_server_details_fs_containers">\n              \x3c!-- @value: value goes here... --\x3e\n            </span>\n          </div>\n        </li>\n\n        <li data-test="fileServerTabDetailsEntityView_summury_protocoltypeOne"\n          class="SMB-summary NFS-summary">\n          <div class="n-info-block">\n            <span class="n-label">\n              <%= i18n(\'protocol\') %>\n            </span>\n            <span class="protocoType n-value n-resettable">\n              \x3c!-- @value: value goes here... --\x3e\n            </span>\n          </div>\n        </li>\n\n        <li data-test="fileServerTabDetailsEntityView_summury_smb_directory_service"\n          class="SMB-summary">\n          <div class="n-info-block">\n            <span class="n-label"><%= i18n(\'smb_directory_service\') %></span>\n            <span class="directoryServiceSMB n-value n-resettable">\n              \x3c!-- @value: value goes here... --\x3e\n            </span>\n          </div>\n        </li>\n\n        <li data-test="fileServerTabDetailsEntityView_summury_nfs_directory_service"\n          class="NFS-summary">\n          <div class="n-info-block">\n            <span class="n-label"><%= i18n(\'nfs_directory_service\') %></span>\n            <span class="directoryServiceNFS n-value n-resettable">\n              \x3c!-- @value: value goes here... --\x3e\n            </span>\n          </div>\n        </li>\n\n        <li data-test="fileServerTabDetailsEntityView_summury_client_side_network">\n          <div class="n-info-block">\n            <span class="n-label"><%= i18n(\'client_side_network\') %></span>\n            <span class="ClientSideNetwork n-value n-resettable">\n              \x3c!-- @value: value goes here... --\x3e\n            </span>\n          </div>\n        </li>\n\n        <li>\n          <div class="n-info-block">\n            <span class="n-label"><%= i18n(\'storage_network\') %></span>\n            <span class="storageNetwork n-value n-resettable">\n              \x3c!-- @value: value goes here... --\x3e\n            </span>\n          </div>\n        </li>\n\n        <li data-test="fileservertabdetailsentityview_li_memory">\n          <div class="n-info-block">\n            <span class="n-label"><%= i18n(\'memory\') %></span>\n            <span class="lblTotalMemory n-value n-resettable">\n              \x3c!-- @value: value goes here... --\x3e\n            </span>\n          </div>\n        </li>\n\n        <li data-test="fileservertabdetailsentityview_li_cpu">\n          <div class="n-info-block">\n            <span class="n-label"><%= i18n(\'cpu\') %></span>\n            <span class="lblCpu n-value n-resettable">\n              \x3c!-- @value: value goes here... --\x3e\n            </span>\n          </div>\n        </li>\n\n        <li data-test="fileservertabdetailsentityview_li_file_blocking"\n          class="fileBlockingContainer">\n          <div class="n-info-block">\n            <span class="n-label"><%= i18n(\'blocked_file_types\') %></span>\n            <span class="lblFileBlocking n-value n-resettable">\n              \x3c!-- @value: value goes here... --\x3e\n            </span>\n          </div>\n        </li>\n      </ul>\n    </div>\n  </div>\n  \x3c!-- Fluid unit --\x3e\n  <div id="detailsFileServerUnitFluid" class="n-unit-fluid  n-tab-details-unit">\n    \x3c!-- @view: Tab details view goes here... --\x3e\n  </div>\n</div>\n'}),define("views/pages/fileserver/details/FileServerTabDetailsEntityView",["views/basecomponents/details/BaseDetailsEntityView","models/fileserver/FileServerModel","models/fileserver/ShareCollection","models/storage/ContainerModel","models/network/AcropolisNetworkCollection","text!templates/pages/fileserver/details/FileServerTabDetailsEntityView.html","managers/NotificationManager","managers/NavigationManager","data/DataProperties","utils/AppConstants","utils/AppUtil","utils/StatsUtil","utils/FileServerUtil","utils/TooltipContent","utils/VisualizationUtil"],function(e,t,i,n,s,a,r,o,l,c,d,u,h,p,T){"use strict";return e.extend({name:"FileServerTabDetailsEntityView",entityType:c.ENTITY_FILE_SERVER,containerModel:null,events:{"click a.pageLink":"onPageLinkClick"},onPageLinkClick:function(e){o.navigateToPageByPageLink(e.currentTarget)},initializeProperties:function(e){e=e||{},this.model=new t,this.model.setProjection([c.PROJECTION.USAGE_STATS]),this.containerModel=new n,this.shareCollection=e.shareCollection||new i,this.render()},render:function(){this.$el.html(_.template(a)(this.vtOptions()));var e={};e[c.TAB_DETAILS.FS_USAGE]=c.TAB_DETAILS_NAMES.USAGE,e[c.TAB_DETAILS.FS_PERFORMANCE]=c.TAB_DETAILS_NAMES.FS_PERFORMANCE,e[c.TAB_DETAILS.FS_SHARES]=d.getPluralEntityName(c.ENTITY_SHARE),e[c.TAB_DETAILS.FS_ANTI_VIRUS]=c.TAB_DETAILS_NAMES.ANTI_VIRUS,e[c.TAB_DETAILS.ALERTS]=d.getPluralEntityName(c.ENTITY_ALERT),e[c.TAB_DETAILS.EVENTS]=d.getPluralEntityName(c.ENTITY_EVENT),this.$(".n-storage-stats-link").tooltip({title:p.STORAGE_STATS.FILE_SERVER_LOGICAL_SPACE_USED.INFO,placement:"right",trigger:"hover",html:!0,animation:!1}),this.tabDetailsView=T.renderTabDetailsView(this.$(".n-tab-details-unit"),e,this.entityType,c.PAGE_FILE_SERVER)},renderDetails:function(){var t=this,i=this.model&&this.model.get(this.model.DP.DNS_ENTRIES);i&&i.length>0?this.tabDetailsView.showTab(c.TAB_DETAILS.FS_NETWORK):this.tabDetailsView.hideTab(c.TAB_DETAILS.FS_NETWORK);var n=this.model.get(this.model.DP.VERSION),s=0,a=0;n&&(s=d.compareVersions(n,c.FILE_SERVER_VERSIONS.HERA),a=d.compareVersions(n,c.FILE_SERVER_VERSIONS.SPECTRE),this.hasSmbShare=a<0?_.find(this.shareCollection.models,function(e){return t.model.get(t.model.DP.UUID)===e.get(e.DP.FILE_SERVER_UUID)}):_.find(this.shareCollection.models,function(e){return e.get(e.DP.PROTOCOL_TYPE)===c.FS_PROTOCOLS.SMB&&t.model.get(t.model.DP.UUID)===e.get(e.DP.FILE_SERVER_UUID)}),s<0||!this.hasSmbShare?this.tabDetailsView.hideTab(c.TAB_DETAILS.FS_ANTI_VIRUS):this.tabDetailsView.showTab(c.TAB_DETAILS.FS_ANTI_VIRUS),a>=0?this.tabDetailsView.showTab(c.TAB_DETAILS.FS_PERFORMANCE):this.tabDetailsView.hideTab(c.TAB_DETAILS.FS_PERFORMANCE));var r,o;e.prototype.renderDetails.apply(this,arguments),this.$(".lblName").html(this.model.get(this.model.DP.NAME)).attr("title",this.model.get(this.model.DP.NAME)),this.$(".lblFsDomainName").html(this.model.getDomainConfig(this.model.DP[this.model.DP.DOMAIN_CONFIG].REALM)||this.model.get(this.model.DP.DNS_DOMAIN_NAME)),r=this.model.get(this.model.DP.NUM_SHARES)||c.STATS_NOT_AVAILABLE,this.$(".lblShareCount").html(r),o=u.getUsageStats(this.model,this.model.DP.NUM_CONNECTED_USERS),o=o>0?o:"0",this.$(".lblConnectedUsers").html(o),this.$(".lblTotalSpaceUsed").html(u.storageFormat(u.getUsageStats(this.model,this.model.DP.TOTAL_SPACE_USED))),this.$(".lblSnapshotSpaceUsed").html(u.storageFormat(u.getUsageStats(this.model,this.model.DP.SPACE_USED_BY_SNAPSHOTS))),this.$(".lblAvailableSpace").html(u.storageFormat(u.getUsageStats(this.model,this.model.DP.TOTAL_SPACE_AVAILABLE))),this.$(".lblSize").html(u.storageFormat(u.getUsageStats(this.model,this.model.DP.SIZE))),this.$(".lblTotalMemory").html(u.storageFormat(u.convertToBytes(this.model.getNvmDetails(this.model.DP[this.model.DP.NVMS].MEM_PER_VM)))),this.$(".lblCpu").html(this.model.getNvmDetails(this.model.DP[this.model.DP.NVMS].NUM_VCPUS_PER_VM));var p=h.compareAFSversion(this.model,c.FILE_SERVER_VERSIONS.THREE_DOT_SIX)>=0&&!1,T=this.model.get(this.model.DP.FILE_BLOCKING_EXTENSIONS);if(p&&T&&T.length?(this.$(".fileBlockingContainer").removeClass("hidden"),this.$(".lblFileBlocking").html(this.i18ns("extensions",T.length)),this.$(".lblFileBlocking").tooltip("destroy"),this.$(".lblFileBlocking").tooltip({title:this.i18ns("extensions_tooltip",T.join(", ")),placement:"right",trigger:"hover",html:!0})):this.$(".fileBlockingContainer").hasClass("hidden")||this.$(".fileBlockingContainer").addClass("hidden"),this.model.get(this.model.DP.PD_NAME)){var E=d.createPageLink(this.model.get(this.model.DP.PD_NAME),c.ENTITY_ASYNC_PD,this.model.get(this.model.DP.PD_NAME));this.$(".lblFsProtectionDomain").html(E)}else this.$(".lblFsProtectionDomain").html(c.NOT_PROTECTED);this.fetchNetwork();var g=this,S=this.model.get(this.model.DP.CONTAINER_ID);this.containerModel.get(l.ID)!==S?(d.addInLineDonutLoader(this.$(".lblFsContainer")),this.containerModel.set(this.containerModel.idAttribute,S,{silent:!0}),this.containerModel.fetch({success:function(){g.renderContainerName()},error:function(){g.renderContainerError()}})):this.renderContainerName(),a>=0?this.setProtocolInfo():(this.$(".protocoType").closest("li").hide(),this.$(".directoryService").closest("li").hide())},setProtocolInfo:function(){var e=void 0,t=void 0,i=this.model.getAdDetails(),n=this.model.getProtocolType(),s=this.model.getServerIP(),a=this.model.getLocalDetailsProtocolType(),r=0,o=n&&n.includes(c.FS_PROTOCOLS.SMB),l=n&&n.includes(c.FS_PROTOCOLS.NFS)||s||a===c.FS_PROTOCOLS.NFS;this.$(".NFS-summary, .SMB-summary").hide(),o&&(this.$(".SMB-summary").show(),this.$(".protocoType").text(c.FS_PROTOCOLS.SMB),e=this.i18n("active_directory"),r++),l&&(this.$(".NFS-summary").show(),this.$(".protocoType").text(c.FS_PROTOCOLS.NFS),s&&(t=this.i18n("ldap_only")),!s&&i&&(t=this.i18n("active_directory")),a===c.FS_PROTOCOLS.NFS&&(t=this.i18n("none")),r++);r>1&&this.$(".protocoType").text(this.i18n("multi_protocol_type")),this.$(".directoryServiceSMB").text(e),this.$(".directoryServiceNFS").text(t)},fetchNetwork:function(){var e=this;this.networks=new s,this.networks.useUhura(!0),this.networks.fetch({success:function(t){e.renderNetworkName(t)},error:function(t){r.showClientNotification(c.NOTIFY_ERROR,e.i18n("error.network_fetch"))}})},renderNetworkName:function(e){var t=this.model.get(this.model.DP.INTERNAL_NETWORK)&&this.model.get(this.model.DP.INTERNAL_NETWORK).uuid,i=this.model.get(this.model.DP.EXTERNAL_NETWORK)&&this.model.get(this.model.DP.EXTERNAL_NETWORK)[0].uuid,n=void 0,s=void 0;e.forEach(function(e){e.get(l.UUID)===t&&(n=e),e.get(l.UUID)===i&&(s=e)}),s&&this.$(".ClientSideNetwork").html(s.get(l.NAME)),n&&this.$(".storageNetwork").html(n.get(l.NAME))},checkTabsupported:function(){var e=this.model.get(this.model.DP.VERSION),t=0,i=0;e&&(t=d.compareVersions(e,c.FILE_SERVER_VERSIONS.HERA),i=d.compareVersions(e,c.FILE_SERVER_VERSIONS.SPECTRE));var n=!1;this.tabDetailsView.currentTabId!==c.TAB_DETAILS.FS_ANTI_VIRUS&&this.tabDetailsView.currentTabId!==c.TAB_DETAILS.FS_PERFORMANCE||(n=!0),(e&&t<0||this.hasSmbShare||e&&i<0)&&n&&this.tabDetailsView.selectFirstTab()},destroy:function(){e.prototype.destroy.apply(this,arguments),this.$(".n-storage-stats-link .lblFileBlocking").tooltip("destroy")},renderContainerName:function(){if(this.containerModel&&this.containerModel.get(this.containerModel.idAttribute)){var e=d.createPageLink(this.containerModel.get(l.NAME),c.ENTITY_CONTAINER,this.containerModel.get(this.containerModel.idAttribute));this.$(".lblFsContainer").html(e)}},renderContainerError:function(){this.$(".lblFsContainer").empty(),this.model&&d.log("FileServerTabDetailsEntityView: Could not fetch the storage container with id: "+this.model.get(this.model.DP.CONTAINER_ID))}})}),define("text!templates/pages/fileserver/details/ShareTabDetailsEntityView.html",[],function(){return'\x3c!-- Wrap --\x3e\n<div class="n-unit-wrap">\n  \x3c!-- Fixed unit --\x3e\n  <div class="n-unit-fixed">\n    \x3c!-- Column 1: Summary --\x3e\n    <div class="n-details-unit">\n      <div class="title"><%= i18n(\'share_details\') %></div>\n      <ul class="n-list-info">\n        <li>\n          <div class="n-info-block">\n            <span class="n-label"><%= i18n(\'name\') %></span>\n            <span class="lblName n-value n-resettable">\n              \x3c!-- @value: name used goes here... --\x3e\n            </span>\n          </div>\n        </li>\n\n        <li>\n          <div class="n-info-block">\n            <span class="n-label"><%= i18n(\'file_server\') %></span>\n            <span class="lblFileServer n-value n-resettable">\n              \x3c!-- @value: File Server Name for this share goes here... --\x3e\n            </span>\n          </div>\n        </li>\n\n        <li>\n          <div class="n-info-block">\n            <span class="n-label"><%= i18n(\'self_service_restore\') %></span>\n            <span class="lblPreviousVersionsEnabled n-value n-resettable">\n              \x3c!-- @value: Previous Versions Enabled goes here... --\x3e\n            </span>\n          </div>\n        </li>\n        <li data-test="sharetabdetailsentityview_li_file_blocking"\n          class="fileBlockingContainer">\n          <div class="n-info-block">\n            <span class="n-label"><%= i18n(\'blocked_file_types\') %></span>\n            <span class="lblFileBlocking n-value n-resettable">\n              \x3c!-- @value: value goes here... --\x3e\n            </span>\n          </div>\n        </li>\n        <li>\n          <div class="n-info-block">\n            <span class="n-label"><%= i18n(\'access_based_enumeration_enabled\') %></span>\n            <span class="lblEnableABE n-value n-resettable">\n              \x3c!-- @value: Access Based Enumeration Enabled goes here... --\x3e\n            </span>\n          </div>\n        </li>\n        <div class="nfsContainer">\n          <li>\n            <div class="n-info-block">\n              <span class="n-label"><%= i18n(\'default_access_setting\') %></span>\n              <span class="lblDefaultAccessSetting n-value n-resettable">\n                \x3c!-- @value: NFS Default access setting goes here... --\x3e\n              </span>\n            </div>\n          </li>\n          <li>\n            <div class="n-info-block">\n              <span class="n-label"><%= i18n(\'authentication_type\') %></span>\n              <span class="lblAuthType n-value n-resettable">\n                \x3c!-- @value: NFS Authentication type goes here... --\x3e\n              </span>\n            </div>\n          </li>\n        </div>\n        <li>\n          <div class="n-info-block">\n            <span class="n-label"><%= i18n(\'open_connections\') %></span>\n            <span class="lblConnectedUsers n-value n-resettable">\n              \x3c!-- @value: Users count goes here... --\x3e\n            </span>\n          </div>\n        </li>\n\n        <li>\n          <div class="n-info-block">\n            <span class="n-label"><%= i18n(\'space_used\') %></span>\n            <span class="lblTotalSpaceUsed n-value n-resettable">\n              \x3c!-- @value: Used space goes here... --\x3e\n            </span>\n          </div>\n        </li>\n\n        <li>\n          <div class="n-info-block">\n            <span class="n-label"><%= i18n(\'max_share_size\') %></span>\n            <span class="lblMaxShareSize n-value n-resettable">\n              \x3c!-- @value: Max share size goes here... --\x3e\n            </span>\n          </div>\n        </li>\n\n        <li>\n          <div class="n-info-block">\n            <span class="n-label"><%= i18n(\'space_used_by_snapshots\') %></span>\n            <span class="lblUsedSnapshotSpace n-value n-resettable">\n              \x3c!-- @value: used snapshot space goes here... --\x3e\n            </span>\n          </div>\n        </li>\n\n        <li>\n          <div class="n-info-block block-iqn">\n            <span class="n-label"><%= i18n(\'mount_path\') %></span>\n            <span class="lblMountpath n-value n-resettable">\n              \x3c!-- @value: Mount name for this share goes here... --\x3e\n            </span>\n          </div>\n        </li>\n\n        <li>\n          <div class="n-info-block block-iqn">\n            <span class="n-label"><%= i18n(\'share_path\') %></span>\n            <span class="lblSharepath n-value n-resettable">\n              \x3c!-- @value: Share path goes here... --\x3e\n            </span>\n          </div>\n        </li>\n\n        <li>\n          <div class="n-info-block">\n            <span class="n-label"><%= i18n(\'description\') %></span>\n            <span class="lblDescription n-value n-resettable">\n              \x3c!-- @value: Description for this share goes here... --\x3e\n            </span>\n          </div>\n        </li>\n\n        <li>\n          <div class="n-info-block">\n            <span class="n-label"><%= i18n(\'share_type\') %></span>\n            <span class="lblShareType n-value n-resettable">\n              \x3c!-- @value: Share Type for this share goes here... --\x3e\n            </span>\n          </div>\n        </li>\n\n        <li class="smbEncryption" data-test="sharetabdetailsentityview_li_smb_encrypt">\n          <div class="n-info-block">\n            <span class="n-label"><%= i18n(\'encrypt_smb_message\') %></span>\n            <span class="lblSmbEncrypt n-value n-resettable">\n              \x3c!-- @value: Encrypt SMB for this share goes here... --\x3e\n            </span>\n          </div>\n        </li>\n      </ul>\n    </div>\n  </div>\n  \x3c!-- Fluid unit --\x3e\n  <div class="n-unit-fluid  n-tab-details-unit">\n    \x3c!-- @view: Tab details view goes here... --\x3e\n  </div>\n</div>\n'}),define("views/pages/fileserver/details/ShareTabDetailsEntityView",["views/basecomponents/details/BaseDetailsEntityView","text!templates/pages/fileserver/details/ShareTabDetailsEntityView.html","models/fileserver/ICAPServerCollection","models/fileserver/ShareModel","models/fileserver/FileServerModel","managers/NotificationManager","managers/NavigationManager","utils/AppConstants","utils/FileServerUtil","utils/CommonTemplates","utils/StatsUtil","utils/AppUtil","utils/VisualizationUtil"],function(e,t,i,n,s,a,r,o,l,c,d,u,h){"use strict";return e.extend({name:"ShareTabDetailsEntityView",entityType:o.ENTITY_SHARE,fileServerModel:null,events:{"click a.pageLink":"onPageLinkClick"},onPageLinkClick:function(e){r.updateRouteOption(e.currentTarget)},initializeProperties:function(){this.model=new n,this.model.setProjection([o.PROJECTION.USAGE_STATS]),this.fileServerModel=new s,this.render()},render:function(){this.$el.html(_.template(t)(this.vtOptions()));var e={};e[o.TAB_DETAILS.FS_USAGE]=o.TAB_DETAILS_NAMES.USAGE,e[o.TAB_DETAILS.FS_PERFORMANCE]=o.TAB_DETAILS_NAMES.FS_PERFORMANCE,e[o.TAB_DETAILS.FS_QUOTAS]=o.TAB_DETAILS_NAMES.QUOTA,e[o.TAB_DETAILS.SELF_SERVICE_RESTORE]=o.TAB_DETAILS_NAMES.SELF_SERVICE_RESTORE,e[o.TAB_DETAILS.FS_ANTI_VIRUS]=o.TAB_DETAILS_NAMES.ANTI_VIRUS,this.tabDetailsView=h.renderTabDetailsView(this.$(".n-tab-details-unit"),e,this.entityType,o.PAGE_FILE_SERVER)},renderDetails:function(){var e=this,t=this.model.get(this.model.DP.OBJECT_VERSION),n=0,s=0;this.isPostSabine=0,t&&(n=u.compareVersions(t,o.FILE_SERVER_VERSIONS.HERA),s=u.compareVersions(t,o.FILE_SERVER_VERSIONS.SPECTRE),this.isPostSabine=u.compareVersions(t,o.FILE_SERVER_VERSIONS.THREE_DOT_FIVE)>=0,n<0||this.model.get(this.model.DP.PROTOCOL_TYPE)!==o.FS_PROTOCOLS.SMB&&s>=0?this.tabDetailsView.hideTab(o.TAB_DETAILS.FS_ANTI_VIRUS):this.tabDetailsView.showTab(o.TAB_DETAILS.FS_ANTI_VIRUS),s>=0?(this.tabDetailsView.showTab(o.TAB_DETAILS.FS_PERFORMANCE),this.model.get(this.model.DP.PROTOCOL_TYPE)===o.FS_PROTOCOLS.SMB||this.isPostSabine?this.tabDetailsView.showTab(o.TAB_DETAILS.SELF_SERVICE_RESTORE):this.tabDetailsView.hideTab(o.TAB_DETAILS.SELF_SERVICE_RESTORE)):(this.tabDetailsView.hideTab(o.TAB_DETAILS.FS_PERFORMANCE),this.tabDetailsView.hideTab(o.TAB_DETAILS.SELF_SERVICE_RESTORE))),this.tmpModel=jQuery.extend(!0,{},this.model);var r=this.model.get(this.model.DP.FILE_SERVER_UUID);if(t&&n>=0){var l=new i;l.setFSId(r),l.fetch({silent:!0,success:function(t){t.models&&t.models.length&&e.model.set(e.model.DP.ENABLE_ANTIVIRUS,!0),e.renderRealDetails()},error:function(t,i){var n=i.responseText||e.i18n("message");a.showClientNotification(o.NOTIFY_ERROR,n),e.renderRealDetails()}})}else this.renderRealDetails()},renderRealDetails:function(){var t;e.prototype.renderDetails.apply(this,arguments);var i=this.tmpModel.get(this.tmpModel.DP.NAME),n=this.tmpModel.get(this.tmpModel.DP.SHARE_PATH);this.$(".lblName").html(i).attr("title",i);if(this.tmpModel.get(this.tmpModel.DP.PROTOCOL_TYPE)===o.FS_PROTOCOLS.NFS){this.$(".lblEnableABE").html("No"),this.$(".smbEncryption").hide(),this.$(".nfsContainer").show();var s=this.tmpModel.get(this.tmpModel.DP.DEFAULT_SHARE_ACCESS_TYPE)&&this.tmpModel.get(this.tmpModel.DP.DEFAULT_SHARE_ACCESS_TYPE).toLowerCase();this.$(".lblDefaultAccessSetting").html(s||o.STATS_NOT_AVAILABLE);var a=this.tmpModel.get(this.tmpModel.DP.AUTHENTICATION_TYPE)&&this.tmpModel.get(this.tmpModel.DP.AUTHENTICATION_TYPE).toLowerCase();this.$(".lblAuthType").html(a||o.STATS_NOT_AVAILABLE)}else this.$(".lblEnableABE").html(this.tmpModel.get(this.tmpModel.DP.ENABLE_ABE)?"Yes":"No"),this.$(".smbEncryption").hide(),this.$(".nfsContainer").hide();this.$(".lblPreviousVersionsEnabled").html(this.tmpModel.get(this.tmpModel.DP.WINDOWS_PREVIOUS_VERSION)?"Yes":"No");var r=l.compareAFSversion(this.tmpModel,o.FILE_SERVER_VERSIONS.THREE_DOT_SIX)>=0&&!1,c=this.tmpModel.get(this.tmpModel.DP.FILE_BLOCKING_EXTENSIONS);r&&c&&c.length?(this.$(".fileBlockingContainer").removeClass("hidden"),this.$(".lblFileBlocking").html(this.i18ns("extensions",c.length)),this.$(".lblFileBlocking").tooltip("destroy"),this.$(".lblFileBlocking").tooltip({title:this.i18ns("extensions_tooltip",c.join(", ")),placement:"right",trigger:"hover",html:!0})):this.$(".fileBlockingContainer").hasClass("hidden")||this.$(".fileBlockingContainer").addClass("hidden"),t=d.getUsageStats(this.tmpModel,this.tmpModel.DP.NUM_CONNECTED_USERS),t=t>0?t:"0",this.$(".lblConnectedUsers").html(t),this.$(".lblTotalSpaceUsed").html(d.storageFormat(d.getUsageStats(this.tmpModel,this.tmpModel.DP.TOTAL_SPACE_USED)));var h=void 0,p=this.tmpModel.get(this.tmpModel.DP.FILE_SERVER_NAME),T=this.tmpModel.get(this.tmpModel.DP.DOMAIN_NAME);T&&(p+="."+T),h=i?this.tmpModel.get(this.tmpModel.DP.PROTOCOL_TYPE)===o.FS_PROTOCOLS.SMB?"\\\\"+p+"\\"+i:p+":/"+i:o.STATS_NOT_AVAILABLE,this.$(".lblMountpath").html(h),this.$(".lblMountpath").tooltip("destroy"),this.$(".lblMountpath").tooltip({title:h,placement:"top",trigger:"hover",html:"no",container:this.$(".lblMountpath")}),n&&(this.$(".lblSharepath").html(n),this.$(".lblSharepath").tooltip("destroy"),this.$(".lblSharepath").tooltip({title:n,placement:"top",trigger:"hover",container:this.$(".lblSharepath")}));var E=this.tmpModel.get(this.tmpModel.DP.DESCRIPTION);this.$(".lblDescription").html(E||o.STATS_NOT_AVAILABLE);var g=this,_=this.tmpModel.get(this.tmpModel.DP.FILE_SERVER_UUID);this.tmpModel.get(this.tmpModel.DP.CONTAINER_ID);this.fileServerModel.get(this.fileServerModel.DP.UUID)!==_?(u.addInLineDonutLoader(this.$(".lblFileServer")),this.fileServerModel.set(this.fileServerModel.idAttribute,_),this.fileServerModel.fetch({success:function(){g.renderFileServerName()},error:function(){g.renderFileServerError()}})):this.renderFileServerName();var S=this.tmpModel.get(this.tmpModel.DP.MAX_SIZE);this.$(".lblMaxShareSize").html(S?S+" "+d.UOM_GIB:d.storageFormat(d.getUsageStats(this.fileServerModel,this.fileServerModel.DP.FILE_SERVER_SIZE_BYTES))),this.$(".lblUsedSnapshotSpace").html(d.storageFormat(d.getUsageStats(this.tmpModel,this.tmpModel.DP.SPACE_USED_BY_SNAPSHOTS)));var m=this.tmpModel.get(this.tmpModel.DP.SHARE_TYPE)&&this.tmpModel.get(this.tmpModel.DP.SHARE_TYPE).toLowerCase(),v=this.i18n("standard");this.tmpModel.get(this.tmpModel.DP.SHARE_TYPE)===o.FS_SHARE_TYPES.HOMES&&(v=this.i18n("distributed")),this.$(".lblShareType").html(m?v:o.STATS_NOT_AVAILABLE)},renderFileServerName:function(){if(this.fileServerModel&&this.fileServerModel.get(this.fileServerModel.DP.UUID)){var e=u.createPageLink(this.fileServerModel.get(this.fileServerModel.DP.NAME),o.ENTITY_FILE_SERVER,this.fileServerModel.get(this.fileServerModel.DP.UUID));this.$(".lblFileServer").html(e)}},renderFileServerError:function(){this.$(".lblFileServer").empty(),this.model&&u.log("ShareTabDetailsEntityView: Could not fetch the file server with id: "+this.model.get(this.model.DP.FILE_SERVER_UUID))},checkTabsupported:function(){var e=this.model.get(this.model.DP.OBJECT_VERSION),t=0,i=0;e&&(t=u.compareVersions(e,o.FILE_SERVER_VERSIONS.HERA),i=u.compareVersions(e,o.FILE_SERVER_VERSIONS.SPECTRE)),this.checkNestedShare(e)?this.disableTabs():this.enableTabs();var n=!1;this.tabDetailsView.currentTabId!==o.TAB_DETAILS.FS_ANTI_VIRUS&&this.tabDetailsView.currentTabId!==o.TAB_DETAILS.FS_PERFORMANCE&&this.tabDetailsView.currentTabId!==o.TAB_DETAILS.SELF_SERVICE_RESTORE||(n=!0),(e&&t<0||e&&i<0||this.model.get(this.model.DP.PROTOCOL_TYPE)!==o.FS_PROTOCOLS.SMB&&!this.isPostSabine)&&n&&this.tabDetailsView.selectFirstTab()},startModelPolling:function(t){var i=l.getFileServerAndShareUuidsFromPageRoute();i&&this.model.setUuid(i),e.prototype.startModelPolling.apply(this,arguments)},onStartServices:function(){if(this.tabDetailsView.$(".nutanixMoreInfo").nutanixMoreInfo("destroy"),!this.tooltipAdded){this.tabDetailsView.$el.find('span[title="Unquarantined Files"]').append(c.MOREINFO_TOOLTIP_TEMPLATE(this.vtOptions({tooltip:{content:this.i18n("unquarantined_tooltip")}}))),this.tooltipAdded=!0}this.tabDetailsView.$(".nutanixMoreInfo").nutanixMoreInfo({parseDataAttrs:!0,placement:"top"}),e.prototype.onStartServices.apply(this,arguments)},onStopServices:function(){this.tabDetailsView.$(".nutanixMoreInfo").nutanixMoreInfo("destroy"),this.$(".lblMountpath, .lblSharepath .lblFileBlocking").tooltip("destroy"),e.prototype.onStopServices.apply(this,arguments)},checkNestedShare:function(e){var t=!1;if(e){if(u.compareVersions(e,o.FILE_SERVER_VERSIONS.THREE_DOT_TWO)>=0){this.model.get(this.model.DP.PARENT_SHARE_UUID)&&(t=!0)}}return t},disableTabs:function(){var e=this,t=["FS_QUOTAS","SELF_SERVICE_RESTORE","FS_ANTI_VIRUS"];_.each(this.tabDetailsView.tabIds,function(i){t.indexOf(i)>-1&&e.$('.n-tab-details-button[data-target="'+i+'"]').addClass("disabled")}),this.$(".n-tab-details-button.disabled span").attr("title",this.i18n("tab_not_supported")).tooltip({placement:"bottom"})},enableTabs:function(){var e=this.$(".n-tab-details-button.disabled");this.$(".n-tab-details-button.disabled span").tooltip("destroy");var t="";e.length&&e.each(function(){t=$(this).find("span").text().trim(),$(this).removeClass("disabled").attr("title",t)})}})}),define("views/pages/fileserver/details/FileServerTabDetailsView",["views/basecomponents/details/BaseDetailsView","views/basecomponents/details/detailsaction/DetailsActionTemplates","data/DataProperties","data/DataURLConstants","text!templates/pages/fileserver/details/FileServerTabDetailsView.html","models/fileserver/FileServerCollection","models/fileserver/ShareCollection","models/fileserver/FileInsightsCollection","models/fileserver/FileServerUsageModel","managers/NavigationManager","managers/ActionManager","managers/NamespaceManager","views/pages/fileserver/details/FileServerTabDetailsEntityView","views/pages/fileserver/details/ShareTabDetailsEntityView","components/Components","utils/AppConstants","utils/StatsUtil","utils/AppUtil","utils/FileServerUtil","utils/CommonTemplates","utils/VisualizationUtil"],function(e,t,i,n,s,a,r,o,l,c,d,u,h,p,T,E,g,S,m,v,f){"use strict";return e.extend({name:"FileServerTabDetailsView",pageId:E.PAGE_FILE_SERVER,summaryTemplate:_.template(s),bannerTemplate:_.template('\n        <div class="n-page-message"></div>\n        '),fileServerCollection:null,shareCollection:null,fileServerUsageModel:null,displayNotificationBanner:!0,events:{"click  .linkRowItem":"onClickLinkRowItem"},modelEvents:{
"reset  fileServerCollection":"renderFileServerViews","reset  shareCollection":"renderShareViews","change fileServerUsageModel":"renderUsageViews"},initializeProperties:function(){this.fileServerCollection=new a,this.shareCollection=new r,this.fileServerUsageModel=new l,this.fileServerUsageModel.alwaysTriggerChange=!0},render:function(){var e={};e[E.TAB_DETAILS.ALERTS]="File Server Alerts",this.clusterManager.isMulticlusterNavMode()||(e[E.TAB_DETAILS.EVENTS]="File Server Events"),this.tabDetailsView=f.renderTabDetailsView(this.$(".n-tab-details-unit"),e,E.ENTITY_CLUSTER,E.PAGE_FILE_SERVER),this.storeToDetailsEntityMap(E.ENTITY_FILE_SERVER,new h({el:this.getDetailsEntityElement(E.ENTITY_FILE_SERVER),shareCollection:this.shareCollection})),this.storeToDetailsEntityMap(E.ENTITY_SHARE,new p({el:this.getDetailsEntityElement(E.ENTITY_SHARE)})),this.$(".nutanixMoreInfo").nutanixMoreInfo({parseDataAttrs:!0})},getDataAndRender:function(){this.fileServerCollection.isPolling()||this.fileServerCollection.startPolling(),this.shareCollection.isPolling()||this.shareCollection.startPolling(),this.fileServerUsageModel.isPolling()||this.fileServerUsageModel.startPolling()},onStartServices:function(){e.prototype.onStartServices.apply(this,arguments),this.fileServerCollection.startPolling(),this.shareCollection.startPolling(),this.fileServerUsageModel.startPolling()},onStopServices:function(){e.prototype.onStopServices.apply(this,arguments),this.fileServerCollection.stopPolling(),this.shareCollection.stopPolling(),this.fileServerUsageModel.stopPolling(),this.$(".nutanixMoreInfo").nutanixMoreInfo("destroy")},destroy:function(){S.debug("FileServerTabDetailsView : destroy: "," | viewid     : "+this.cid),this.tabDetailsView&&this.tabDetailsView.destroy(),e.prototype.destroy.apply(this,arguments)},renderFileServerViews:function(){this.displayNotificationBanner&&this.renderNFSDiscoverBanner();var e,t,i=this.fileServerCollection.models,n=this.$el.find(".listFileServer");$(n).empty();for(var s=0;s<i.length;s++)t=S.convertModelToNavItemModel(i[s],E.ENTITY_FILE_SERVER,E.ACTION_DETAILS),e=_.template(v.LIST_ITEM_LINK,{model:t}),$(n).append(e)},renderNFSDiscoverBanner:function(){var e=this.fileServerCollection.models;if(e&&e.length){if(_.find(e,function(e){return 0===m.compareAFSversion(e,E.FILE_SERVER_VERSIONS.SPECTRE)})){var t=v.INFO({msg:this.i18n("discover_nfs_banner")});$(".page-file_server .n-page-message").length&&$(".page-file_server .n-page-message").remove(),$(".page-file_server .n-page-nav").after(this.bannerTemplate()),$(".page-file_server .n-page-message").html(t),this.displayNotificationBanner=!1}}},renderShareViews:function(){var e=this.shareCollection.models,t=e&&e.length>0?e.length:0;this.$(".listCount.n-ul").html(t)},renderUsageViews:function(){$(".usedCapacity").html(g.storageFormat(this.fileServerUsageModel.get(this.fileServerUsageModel.DP.TOTAL_FILE_SERVERS_SPACE_USED_IN_BYTES)))},onClickLinkRowItem:function(e){c.updateRouteOption(e.currentTarget)},getDetailsAction:function(e,n){var s=[];if(!e)return s;var a=0,r=0,o=0,l=0,c=n.get(n.DP.VERSION)||n.get(n.DP.OBJECT_VERSION);switch(c&&(a=S.compareVersions(c,E.FILE_SERVER_VERSIONS.ASTERIX_DOT_TWO),r=S.compareVersions(c,E.FILE_SERVER_VERSIONS.THREE_DOT_FIVE),o=S.compareVersions(c,E.FILE_SERVER_VERSIONS.HERA),l=S.compareVersions(c,E.FILE_SERVER_VERSIONS.SPECTRE)),e[E.NAV_ACTION_TARGET]){case E.ENTITY_FILE_SERVER:var d=m.checkTaskStatus(n,E.TASK_FILE_SERVER_UPGRADE),u=m.checkTaskStatus(n,E.TASK_FILE_SERVER_UPDATE),h=m.checkTaskStatus(n,E.TASK_FILE_SERVER_NAME_SERVICES),p=m.checkTaskStatus(n,E.TASK_FILE_SERVER_DNS_OPERATIONS),T=m.checkTaskStatus(n,E.TASK_FILE_SERVER_ACTIVATE);if(n.get(n.DP.PD_NAME)&&a>=0&&s.push({action:E.ACTION_FILE_SERVER_CLONE,content:t.CLONE}),d)return s;if(r>=0){var g=_.template(t.FILE_INSIGHTS_TAG),v=g({isNewAction:!1,newTooltip:"",text:this.i18n("file_insights"),tagName:this.i18n("new")});s.unshift({action:E.ACTION_VIEW_FILE_INSIGHTS,content:v})}if(n.get(n.DP.NVMS)&&(n.get(n.DP.FILE_SERVER_STATE)===E.FILE_SERVER_STATES.FS_PD_ACTIVATED||n.get(n.DP.FILE_SERVER_STATE)===E.FILE_SERVER_STATES.FS_PD_DEACTIVATED)){var f="";return u=!1,n.get(n.DP.FILE_SERVER_STATE)===E.FILE_SERVER_STATES.FS_PD_DEACTIVATED?(u=!0,f=this.i18n("activate_pd_text")):T&&(f=this.i18n("activating_text")),s.push({content:t.ACTIVATE_FILE_SERVER,action:E.ACTION_ACTIVATE_FILE_SERVER,disabled:u||T,tooltip:f}),s}if(s.push({disabled:u,action:E.ACTION_UPDATE,dropdownEnabled:!u,content:u?E.ACTION_UPDATE:this.getFsUpdateDropdown(n)}),!n.get(n.DP.NVMS)||!n.get(n.DP.DOMAIN_CONFIG)||!n.get(n.DP.DNS_SERVER_IP_ADDRESSES)||!n.get(n.DP.NTP_SERVERS)||n.get(n.DP.UPGRADE_IN_PROGRESS)||!n.get(n.DP.VERSION))return s.push({action:E.ACTION_FORCE_DELETE,content:t.DELETE}),s;var A=n.getDomainConfig(n.DP[n.DP.DOMAIN_CONFIG].REALM),y=n.getProtocolType();a>=0&&s.push({action:E.ACTION_ADD_ADMINS,content:t.ADD_ADMINS});var C=!1;C=l<0?_.find(this.shareCollection.models,function(e){return n.get(n.DP.UUID)===e.get(e.DP.FILE_SERVER_UUID)}):_.find(this.shareCollection.models,function(e){return e.get(e.DP.PROTOCOL_TYPE)===E.FS_PROTOCOLS.SMB&&n.get(n.DP.UUID)===e.get(e.DP.FILE_SERVER_UUID)}),o>=0&&C&&s.push({action:E.ACTION_ANTIVIRUS_SETUP,content:t.ANTIVIRUS_SETUP}),s.push({action:E.ACTION_PROTECT,content:t.SCHEDULE_FILE_SERVER_SNAPSHOTS});var I=n.get(n.DP.NAME_SERVICE_CONFIG),b=!1;I||A||(b=!0),s.push({disabled:b,action:E.ACTION_SHARE_CREATE,content:t.ADD_SHARE_EXPORT,tooltip:this.i18ns("mount_target_tab_message")});_.template(t.DIRECTORY_SERVICES);return s.push({dropdownEnabled:!0,action:E.ACTION_PRTOCOL_MGMT,content:this.getProtocolMgmtDropdown(n),newTooltip:this.i18n("discover_nfs"),isNewAction:l>=0&&y!==E.FS_PROTOCOLS.NFS&&y!==E.FS_PROTOCOLS.NFS_SMB}),l>=0&&s.push({disabled:p,action:E.ACTION_ADD_DNS,content:t.DNS,tooltip:this.i18ns("dns_tab_message")}),s.push({disabled:h,action:E.ACTION_DELETE,content:t.DELETE,tooltip:this.i18ns("user_management_tab_message")}),s;case E.ENTITY_SHARE:var R=this.fileServerCollection.models.find(function(e){return e.get(e.DP.UUID)===n.get(n.DP.FILE_SERVER_UUID)});if(R&&m.checkTaskStatus(R,E.TASK_FILE_SERVER_UPGRADE))return s;var N=this.checkNestedShare(R,n),P="";if(N&&(P=this.i18ns("disable_nested_share_action_text")),n.get(n.DP.DOMAIN_NAME)){if((n.get(n.DP.PROTOCOL_TYPE)===E.FS_PROTOCOLS.SMB||n.get(n.DP.SECONDARY_PROTOCOL_TYPE)===E.FS_PROTOCOLS.SMB||l<0)&&o>=0){var w=!1;if(N&&(w=!0),n.get(n.DP.ENABLE_ANTIVIRUS))s.push({action:E.ACTION_ANTIVIRUS_SETUP,content:t.ANTIVIRUS_SETUP,actionTargetId:n.get(n.DP.UUID),disabled:w,tooltipMsg:P});else{var D=n.get(n.DP.FILE_SERVER_NAME);P||(P=this.i18ns("av_tab_message",D)),s.push({disabled:!0,action:E.ACTION_ANTIVIRUS_SETUP,content:t.ANTIVIRUS_SETUP,actionTargetId:n.get(n.DP.UUID),tooltip:P})}}var O=!1;(n.get(n.DP.AUTHENTICATION_TYPE)===E.FS_AUTH_TYPES.NONE||N)&&(O=!0),P||(P=this.i18ns("quota_policy_tab_message")),s.push({disabled:O,action:E.ACTION_ADD_QUOTA_POLICY,content:t.ADD_QUOTA_POLICY,actionTargetId:n.get(n.DP.UUID),tooltip:P})}var M=m.compareAFSversion(R,E.FILE_SERVER_VERSIONS.SPECTRE)>=0,L=!1;M||n.get(n.DP.DOMAIN_NAME)||(L=!0),s.push({disabled:L,action:E.ACTION_UPDATE,content:t.UPDATE,tooltip:this.i18ns("update_tab_message")});var V=n.get(i.USAGE_STATS);if(this.checkParentNestedShare(R,n))s.push({disabled:L,action:E.ACTION_PARENT_NESTED_SHARE_DELETE,content:t.DELETE,tooltip:this.i18ns("delete_tab_message")});else{var U=E.ACTION_DELETE;V&&V[n.DP.NUM_CONNECTED_USERS]>0?U=E.ACTION_FORCE_DELETE:N&&(U=E.ACTION_NESTED_SHARE_DELETE),s.push({disabled:L,action:U,content:t.DELETE,tooltip:this.i18ns("delete_tab_message")})}return s;default:return[]}},getFsUpdateDropdown:function(e){var t="",n=[];e.get(e.DP.DOMAIN_CONFIG)&&e.get(e.DP.NVMS)&&e.get(e.DP.VERSION||!e.get(e.DP.PD_STATUS)||!e.get(e.DP.DNS_SERVER_IP_ADDRESSES)||!e.get(e.DP.NTP_SERVERS))||(t="btnDisabled");var s=[{text:this.i18n("fs_update_msg.basics"),className:t,action:E.ACTION_UPDATE_SIZE},{text:this.i18n("fs_update_msg.nvm"),className:t,action:E.ACTION_UPDATE_NVM},{text:this.i18n("fs_update_msg.vm_config"),className:t,action:E.ACTION_UPDATE_NVM_CONFIG},{text:this.i18n("fs_update_msg.networks"),action:E.ACTION_UPDATE_NETWORK}];m.compareAFSversion(e,E.FILE_SERVER_VERSIONS.THREE_DOT_SIX)>=0&&!1&&s.push({text:this.i18n("fs_update_msg.block_file_types"),action:E.ACTION_UPDATE_FILE_BLOCKING});var a=0,r=e.get(e.DP.VERSION)||e.get(e.DP.OBJECT_VERSION);r&&(a=S.compareVersions(r,E.FILE_SERVER_VERSIONS.THREE_DOT_ONE));var o=void 0;e.get(e.DP.NVMS)&&(o=e.get(e.DP.NVMS).length),a>=0&&o<3&&n.push(E.ACTION_UPDATE_NVM),s=s.filter(function(e){return-1===n.indexOf(e.action)});var l=_.map(s,function(t){return{attributes:E.NAV_ACTION+'="'+t.action+'"'+E.NAV_ACTION_TARGET+'="'+E.ENTITY_FILE_SERVER+'"'+E.NAV_ACTION_TARGET_ID+'="'+e.get(e.DP.UUID)+'"'+E.NAV_ACTION_TARGET_NAME+'="'+e.get(i.NAME)+'"',name:t.text,class:"btnDetailsAction "+t.className}}),c=T.dropdown({classes:"updateDropdown",text:this.i18n("lbl_update"),options:l,rightAlign:!0}),d=$("<div></div>").html(c);return d.find(".dropdown-toggle span").removeClass("text"),d.html()},getProtocolMgmtDropdown:function(e){var t=e.getProtocolType(),n=m.checkTaskStatus(e,E.TASK_FILE_SERVER_NAME_SERVICES),s=[{text:this.i18n("protocol_mgmt_option.directory_services"),action:E.ACTION_USER_MANAGEMENT,actionTarget:E.ENTITY_FILE_SERVER,title:this.i18ns("user_management_tab_message"),className:n?"btnDisabled":""}],a=e.get(e.DP.VERSION)||e.get(e.DP.OBJECT_VERSION);if(S.compareVersions(a,E.FILE_SERVER_VERSIONS.THREE_DOT_FIVE)>=0){var r=void 0,o=m.checkTaskStatus(e,E.TASK_FILE_SERVER_USER_MAPPING);(m.isSmbOnly(e)||m.isNfsOnly(e)||t===E.FS_PROTOCOLS.NFS||!t||o)&&(r=!0),n&&(r=!0);var l=this.i18ns("user_mapping_tab_message");o&&(l=this.i18ns("user_mapping_task_in_progress")),s.push({text:this.i18n("protocol_mgmt_option.user_mapping"),title:l,action:E.ACTION_ADD_USER_MAPPING,actionTarget:E.ENTITY_FILE_SERVER,className:r?"btnDisabled":""})}var c=_.map(s,function(t){return{attributes:E.NAV_ACTION+'="'+t.action+'" '+E.NAV_ACTION_TARGET+'="'+t.actionTarget+'" '+E.FORM_ATTR.TITLE+'="'+t.title+'"'+E.NAV_ACTION_TARGET_ID+'="'+e.get(e.DP.UUID)+'" '+E.NAV_ACTION_TARGET_NAME+'="'+e.get(i.NAME)+'" ',name:t.text,class:"btnDetailsAction "+t.className}}),d=T.dropdown({classes:"updateDropdown",text:this.i18n("protocol_mgmt"),options:c,rightAlign:!0}),u=$("<div></div>").html(d);return u.find(".dropdown-toggle span").removeClass("text"),u.html()},_canExpandFileServer:function(e,t){var i=e.getDomainConfig(e.DP[e.DP.DOMAIN_CONFIG].REALM);return e.get(e.DP.VERSION)===t&&!!i&&!!e.getNvmDetails(e.DP[e.DP.NVMS].NUM_VCPUS_PER_VM)&&!!e.getNvmDetails(e.DP[e.DP.NVMS].MEM_PER_VM)},handleDetailsViewAction:function(t,i){switch(i.action){case E.ACTION_SHARE_CREATE:return $(t.currentTarget).hasClass("btnDisabled")||d.executeAction({actionTarget:E.ENTITY_SHARE,action:E.ACTION_CREATE,actionTargetId:i.actionTargetId}),!0;case E.ACTION_VIEW_FILE_INSIGHTS:return this.viewFilInsights(i),!0;default:return e.prototype.handleDetailsViewAction.apply(this,arguments)}},checkFileInsightsVm:function(e){var t=this;this.fileInsightsCollection=new o,this.fileInsightsCollection.fetch({success:function(e){var i=e.models[0];i&&i.get(i.DP.IS_DEPLOYED)||t.disableFileInsightsLink()},error:function(){t.disableFileInsightsLink(),S.log("Error: fetching File Insights vms.")}})},disableFileInsightsLink:function(){var e=this.i18n("deploy_file_insights");this.$(".btnDetailsAction[action = "+E.ACTION_VIEW_FILE_INSIGHTS+"]").addClass("btnDisabled").attr("title",e),this.$(".btnDetailsAction[action = "+E.ACTION_VIEW_FILE_INSIGHTS+"] .new-tag").attr("title",e)},viewFilInsights:function(e){var t=this.$(".btnDetailsAction[action = "+E.ACTION_VIEW_FILE_INSIGHTS+"]"),s=t.hasClass("btnDisabled"),a=this.fileInsightsCollection.models[0];if(!(s||a&&!a.get(a.DP.IS_DEPLOYED))){var r=a.get(a.DP.IP),o=e.actionTargetId,l=u.get(u.USER_DETAILS),c=void 0;l.userData&&l.userData.status&&l.userData.status.resources&&l.userData.status.resources.display_name?c=l.userData.status.resources.display_name:l.profile&&(c=l.profile.username);var d=_.template(n.AFS_ANALYTICS_URL),h=d({protocol:i.PROTOCOLS.HTTPS,host:r,port:"3000",username:c,fsUuid:o});window.open(h,"_blank")}},checkNestedShare:function(e,t){var i=!1;m.compareAFSversion(e,E.FILE_SERVER_VERSIONS.THREE_DOT_TWO)>=0&&(t.get(t.DP.PARENT_SHARE_UUID)&&(i=!0));return i},checkParentNestedShare:function(e,t){var i=!1;if(m.compareAFSversion(e,E.FILE_SERVER_VERSIONS.THREE_DOT_TWO)>=0){var n=t.get(t.DP.NESTED_SHARES);n&&Object.keys(n).length&&(i=!0)}return i}})}),define("views/pages/fileserver/details/FileServerdataTableGroupView",["views/basecomponents/datatables/DataTableGroupView","managers/NavigationManager","utils/AppConstants","utils/AppUtil"],function(e,t,i,n){"use strict";return e.extend({updateTabAttributes:function(){e.prototype.updateTabAttributes.apply(this,arguments);var s=this.selectedEntity,a=this.$('.tableGrpHeader a[data-target="#'+s+this._uid+'"]'),r=t.getCurrentPageRoute().options,o=n.parseQueryToObject(r);o&&o.actionParentId?(a.attr(i.NAV_ACTION_PARENT_ID,o.actionParentId),a.attr(i.NAV_ACTION_PARENT_ENTITY_TYPE,o.actionParentEntityType)):(a.removeAttr(i.NAV_ACTION_PARENT_ID),a.removeAttr(i.NAV_ACTION_PARENT_ENTITY_TYPE))}})}),define("views/pages/fileserver/FileServerPageView",["views/basecomponents/pages/BasePageView","views/pages/fileserver/details/FileServerTabDetailsView","views/pages/fileserver/details/FileServerdataTableGroupView","utils/AppConstants"],function(e,t,i,n){"use strict";return e.extend({pageId:n.PAGE_FILE_SERVER,defaultSubPageId:n.SUBPAGE_TABLE,onShowSubPage:function(e,t){var s=this.getSubView(n.SUBPAGE_TABLE);s||(s=this.registerSubView(e,new i({el:this.getSubPageElement(n.SUBPAGE_TABLE),pageId:n.PAGE_FILE_SERVER}))),s.show(t)},onChangeDetailsPane:function(e){var i=this.getSubView(n.SUBPAGE_COMPONENT_DETAILS);i||(i=this.registerSubView(n.SUBPAGE_COMPONENT_DETAILS,new t({el:this.getDetailsElement()}))),i.show(e)}})}),define("text!templates/pages/insights/InsightsView.html",[],function(){return'<div class="insights-container">\n  <div class="insights-header">\n    <div class="dashboards-selector">\n    </div>\n\n    <div class="time-range-selector-wrapper">\n      <div class="time-range-selector">\n        \x3c!-- TimerangeSelectorView is rendered here --\x3e\n      </div>\n    </div>\n  </div>\n  <div class="insights-center">\n    <div class="charts-container-outer">\n        <div class="charts-container-box-wrap">\n          <div class="charts-container-inner">\n            <div class="charts-container">\n              \x3c!-- One or more ChartViews are rendered here --\x3e\n            </div>\n          </div>\n        </div>\n    </div>\n  </div>\n</div>\n'}),define("views/pages/insights/InsightsView",["utils/AppUtil","utils/AppConstants","utils/SubViewHelper","data/DataProperties","managers/NavigationManager","views/timeline/TimelineView","views/timeline/TimerangeSelectorView","views/pages/insights/InsightsChartView","text!templates/pages/insights/InsightsView.html"],function(e,t,i,n,s,a,r,o,l){"use strict";var c=_.template('<div class="chart-category-container"   id="chart-category-container-<%= id %>">  <div class="chart-category-header"><%= chartCategory %></div></div>'),d=_.template('<a data-toggle="dropdown" class="dropdown-toggle"><div class="dropdown-value"><%= selectedDashboard %><i aria-hidden="true" data-icon="z" class="n-icon"></i></div></a><ul class="dropdown-menu n-square"><% _.each(dashboards, function(d) { %><li> <a data-id="<%= d.id %>" class="dashboard-btn"><%= d.title %></a></li><% }) %></ul>');return a.extend({viewTemplate:_.template(l),extraEvents:{"click .dashboard-btn":"onSelectDashboard","click .chart-panel":"onChartPanelClick"},initialize:function(){e.debug("InsightsDashboard : initialize: "," | viewid     : "+this.cid),this.model.on("change:boundsRangeChangeTrigger",this.onBoundsRangeChange,this),this.model.on("change:timeRangeChangeTrigger",this.onTimeRangeChange,this),this.model.on("change:selectedTime",this.onSelectedTimeChange,this),this.model.on("change:chartChangeTrigger",this.onChartChange,this),this.model.on("change:zoomChangeTrigger",this.onZoomChange,this),this.addExtraEvents(this.extraEvents),this.render()},destroy:function(){this.model.off("change:boundsRangeChangeTrigger",this.onBoundsRangeChange,this),this.model.off("change:timeRangeChangeTrigger",this.onTimeRangeChange,this),this.model.off("change:selectedTime",this.onSelectedTimeChange,this),this.model.off("change:chartChangeTrigger",this.onChartChange,this),this.model.off("change:zoomChangeTrigger",this.onZoomChange,this),a.prototype.destroy.apply(this,arguments)},processViewOptions:function(e){},onStartServices:function(){this.model.resumeFetchingStats()},onStopServices:function(){this.model.pauseFetchingStats()},onChartChange:function(){this.renderDashboardsSelector(),a.prototype.onChartChange.apply(this,arguments)},renderDashboardsSelector:function(){var e=this.model.getDashboards(),t=this.model.get(n.SELECTED_DASHBOARD),i=_.find(e,function(e){return e[n.ID]===t}),s=d({dashboards:e,selectedDashboard:i.title});this.$(".dashboards-selector").html(s)},onSelectDashboard:function(i){var a=$(i.currentTarget).attr("data-id"),r=this.model.getAnalysisContext();r[n.DASHBOARD_ID]=a;var o=e.formatObjectToQuery(r,!0);s.navigateToPage(t.PAGE_INSIGHTS,t.SUBPAGE_PERSPECTIVE,o)},onChartPanelClick:function(i){var a=$(i.currentTarget).attr("id"),r=a.split("-")[1],o=_.clone(this.model.getAnalysisContext());o[n.CHART_ID]=r,o=_.extend(o,this.model.getSelectedTimeRanges()),s.navigateToPage(t.PAGE_INSIGHTS,t.SUBPAGE_CHART,e.formatObjectToQuery(o,!0))},_initializeSubViews:function(){if(!this.subViewHelper){this.subViewHelper=new i;var e=new r({el:this.$(".time-range-selector"),model:this.model});this.subViewHelper.register("time-range-selector-view",e),this.model.getAnalysisCharts().each(function(e){e.get("enabled")&&this._addChart(e,!1,!0)},this)}},_recreateCharts:function(){var e=this._getCurrentChartIds();_.each(e,function(e){this._removeChart(e.substr(this.CHART_ID_PREFIX.length))},this);var t=this.$(".charts-container");t.empty();var i=this.model.getChartCategories(),n="";_.each(i,function(e){var t=e.replace(" ","_");n+=c({id:t,chartCategory:e})}),t.html(n),_.each(i,function(e){var t=this.model.getChartsInCategory(e);_.each(t,function(e){e.get("enabled")&&this._addChart(e,!0,!0)},this)},this)},onSelectedTimeChange:function(){e.debug("TimelineView : onSelectedTimeChange: "," | viewid     : ",this.cid),this.subViewHelper.iterate("onSelectedTimeChange")},_instantiateChart:function(e){return new o(e)},_getChartsContainer:function(e){var t=this.model.getChartCategory(e.getChartId());return this.$("#chart-category-container-"+t.replace(" ","_"))},_refreshScrollers:function(){var e=$(window).height()-6,t=$(window).width(),i=$(".navbar").outerHeight(!0),n=$("#n-notification-bar").outerHeight(!0),s=this.$(".insights-header").outerHeight(!0),a=e-(i+n+s);this.$(".insights-center").width(t),this.$(".insights-center").height(a)}})}),define("views/pages/insights/InsightsLegendView",["views/basecomponents/BaseView","data/DataProperties","utils/AppConstants","utils/StatsUtil"],function(e,t,i,n){"use strict";var s=_.template('<%= headerHTML %><div class="legend-content"><%= legendHTML %></div>'),a=_.template('<div class="header"><div class="main"><span class="dropdown dropdown-menu-right"><a data-toggle="dropdown" class="dropdown-toggle"><%= sortDirection %><i class="n-icon" data-icon="z" aria-hidden="true"></i></a><ul class="dropdown-menu"><li><a class="btnSortOption" data-direction="desc">Sort Descending</a></li><li><a class="btnSortOption" data-direction="asc">Sort Ascending</a></li></ul></span></div><div class="close-btn"></div></div>'),r=_.template('<div class="query-container"><span class="metric-box" style="background: #<%= colorHex %>;"> &nbsp; </span><div class="description"> <div class="entity" title="<%= entityDisplayName %>"><%= entityDisplayName %></div></div><div class="value"><%= value %></div> <div class="metric" title="<%= metricName %>">   <%= metricName %></div></div>'),o=_.template('<span class="legend-box <%= disabledClass %>" id="<%= objectId %>"><span class="metric-box"  style="background: #<%=colorHex%>;"></span><span class="chart-data-value"  title="There was an error retrieving statistics for this query."> Error</span></span>'),l=_.template('<span class="legend-box <%=disabledClass%>" id="<%=objectId%>"><span class="metric-box"       style="background: #<%=colorHex%>;"></span><span class="chart-data-value"> <img src="app/assets/images/spinners/loading.gif"    width=16px height=16px /> </span></span>');return e.extend({OBJECT_PREFIX:"object-",selectionHitZoneMillis:3e4,needsSort:!0,sortDirection:i.SORT_DESC,SORT_LABEL_ASC:"Ascending",SORT_LABEL_DESC:"Descending",NO_DATA_LABEL:"No Data",events:{"click .close-btn":"onCloseBtnCLick","click .btnSortOption":"onSortOptionClick"},onCloseBtnCLick:function(){this.$(".legend-content").toggleClass("closed")},onSortOptionClick:function(e){this.sortDirection=$(e.currentTarget).attr("data-direction"),this.needsSort=!0,this.renderLegend(this.lastChartData,this.lastSelectedTime)},calculateSelectionHitZoneWidth:function(){var e=this.model.getParentModel().getCurrentTimeRange(),t=this.$el.parent().width();this.selectionHitZoneMillis=Math.round(e/t*4)},renderLegend:function(e,n){this.lastChartData=e,this.lastSelectedTime=n;var c=this.model.getQueries(),d=this.sortDirection===i.SORT_ASC?this.SORT_LABEL_ASC:this.SORT_LABEL_DESC,u=a({sortDirection:d}),h=[],p="",T=!1;if(_.each(c,function(s){if(s.isEnabled()){T=!0;var a=s.get(t.CHART_COLORS),r=s.get(t.ID),c=_.find(e,function(e){return e.queryModel.get(t.ID)===r}),d=this.model.getStatsState(s),u=c[t.QUERY_RESULTS_DATA];d===i.STATE_ERROR?p+=o({objectId:this.OBJECT_PREFIX+r,colorHex:a[0],disabledClass:""}):d===i.STATE_PENDING?p+=l({objectId:this.OBJECT_PREFIX+r,colorHex:a[0],disabledClass:""}):d===i.STATE_SUCCESS&&0===u.length?p=this.NO_DATA_LABEL:u.length>1?h=h.concat(this._composeMultipleResults(s,c,n)):h.push(this._composeSingleResult(s,c,n))}},this),h.length){var E=this._sortResults(h);_.each(E,function(e){p+=r(e)})}this.$el.html(s({headerHTML:u,legendHTML:p})),T?this.$el.show():this.$el.hide()},_sortResults:function(e){if(this.needsSort){this.needsSort=!1;var t=this.sortDirection;e=_.sortBy(e,function(e){return t===i.SORT_ASC?e.value:-e.value})}return e},onSelectedTimeUpdateComplete:function(){this.needsSort=!0},_composeMultipleResults:function(e,i,s){var a=[],r=e.get(t.ID),o=e.get(t.CHART_COLORS),l=i[t.QUERY_RESULTS_DATA],c=i[t.QUERY_RESULTS_PROPERTIES];return _.each(l,function(t,i){if(t.length&&c[i].enabled){var l=this._getDataPointAtTime(t,s),d=l?l[1]:null,u=l?l[2]:null,h="";h=null===d||""===d?"&nbsp;":n.isValidStats(d)?u:"&nbsp;";var p=e.fullMetricDisplayName(),T=c[i].name||c[i].id;a.push({objectId:this.OBJECT_PREFIX+r,colorHex:o[i],disabledClass:"",value:h,entityDisplayName:T,metricName:p})}},this),a},_composeSingleResult:function(e,i,s){var a=e.get(t.ID),r=e.get(t.CHART_COLORS),o=i[t.QUERY_RESULTS_DATA];if(o[0].length){var l=this._getDataPointAtTime(o[0],s),c=l?l[1]:null,d=l?l[2]:null,u="";u=null===c||""===c?"&nbsp;":n.isValidStats(c)?d:"&nbsp;";var h=e.fullMetricDisplayName();return{objectId:this.OBJECT_PREFIX+a,colorHex:r[0],disabledClass:"",value:u,entityDisplayName:e.getEntityDisplayName(),metricName:h}}},_getDataPointAtTime:function(e,t){for(var i=this.selectionHitZoneMillis,n=0;n<e.length;n++){var s=e[n][0],a=s-i,r=s+i;if(t>=a&&t<=r)return e[n]}return null}})}),define("views/pages/insights/InsightsDetailedChartView",["utils/SubViewHelper","views/pages/insights/InsightsLegendView","views/timeline/AnalysisChartView","views/pages/insights/InsightsChartView"],function(e,t,i,n){"use strict";return n.extend({subViewHelper:null,initialize:function(){n.prototype.initialize.apply(this,arguments),this.subViewHelper=new e},destroy:function(){this.subViewHelper.destroy(),this.subViewHelper=null},render:function(){var e=this.subViewHelper.get("legendView");e&&e.calculateSelectionHitZoneWidth(),n.prototype.render.apply(this,arguments)},onChartPanelClick:function(){},onSelectedTimeUpdateComplete:function(){var e=this.subViewHelper.get("legendView");e&&(e.onSelectedTimeUpdateComplete(this.getParentModelValue("selectedTime")),this.renderChartHeader())},renderChartHeader:function(){if(null!==this.chartData){var e=this.subViewHelper.get("legendView");e||(e=new t({el:this.$el.parent().siblings(".chart-legend"),model:this.model}),this.subViewHelper.register("legendView",e));var i=this.getParentModelValue("selectedTime");e.renderLegend(this.chartData,i)}},setContainerSize:function(){var e=this.$el.height();this.$(".chart-content").height(e)},configureChartEvents:function(e){i.prototype.configureChartEvents.apply(this,arguments)},getChartOptions:function(){var e=i.prototype.getChartOptions.apply(this,arguments);return e.points={show:!0,radius:2,fill:!0},e.lines.show=!0,e.yaxis.noTicks=5,e.xaxis.noTicks=40,delete e.xaxis.ticks,e}})}),define("text!templates/pages/insights/InsightsQueryParameters.html",[],function(){return'\x3c!-- The parent div modal is #queryParametersPopupView --\x3e\n<div class="modal-header">\n  <button type="button" class="close" data-dismiss="modal">\n    <i data-icon="K" aria-hidden="true"></i>\n  </button>\n  <h4 class="n-title">Edit Query</h4>\n</div>\n<div class="n-modal-wrapper">\n  <div class="n-modal-body">\n    <div class="n-modal-content-wrapper">\n      <div class="n-modal-alert-header">\n        \x3c!-- @view: alert goes here... --\x3e\n      </div>\n      <div class="n-modal-content">\n        \x3c!-- Form to change password --\x3e\n        <form class="form-horizontal" onsubmit="return false;">\n          <div class="control-group">\n            <label class="control-label" for="queryEntityType">\n              Entity Type\n            </label>\n            <div class="controls">\n              <select id="queryEntityType">\n                <option value="">&nbsp;</option>\n                <option value="cluster">Cluster</option>\n                <option value="cvm">CVM</option>\n                <option value="volume">Volume</option>\n                <option value="disk">Disk</option>\n                <option value="vdisk">VDisk</option>\n              </select>\n            </div>\n          </div>\n          <div class="control-group">\n            <label class="control-label" for="groupBy">\n              Group By\n            </label>\n            <div class="controls">\n              <select id="groupBy">\n                <option value="">&nbsp;</option>\n                <option value="cluster">Cluster</option>\n                <option value="cvm">CVM</option>\n                <option value="volume">Volume</option>\n                <option value="disk">Disk</option>\n                <option value="vdisk">VDisk</option>\n              </select>\n            </div>\n          </div>\n          <div class="control-group">\n            <label class="control-label" for="sort">\n              Sort By\n            </label>\n            <div class="controls">\n              <select id="sort">\n                <option value="">&nbsp;</option>\n                <option value="cluster">Cluster</option>‘‘\n                <option value="cvm">CVM</option>\n                <option value="volume">Volume</option>\n                <option value="disk">Disk</option>\n                <option value="vdisk">VDisk</option>\n              </select>\n              <select id="sortOrder">\n                <option value="">&nbsp;</option>\n                <option value="asc">Ascending</option>\n                <option value="desc">Descending</option>\n              </select>\n            </div>\n          </div>\n          <div class="control-group">\n            <label class="control-label" for="metricOperator">\n              Operator\n            </label>\n            <div class="controls">\n              <select id="metricOperator">\n                <option value="">&nbsp;</option>\n                <option value="avg">Average</option>\n                <option value="max">Maximum</option>\n                <option value="min">Minimum</option>\n                <option value="sum">Sum</option>\n              </select>\n            </div>\n          </div>\n          <div class="control-group">\n            <label class="control-label" for="metricOperator">\n              Show\n            </label>\n            <div class="controls">\n              <select id="sortKey">\n                <option value="">&nbsp;</option>\n                <option value="max">Top</option>\n                <option value="min">Bottom</option>\n              </select>\n              <div class="sortCount">\n                <input type="text" id="count"> Values\n              </div>\n            </div>\n          </div>\n          <div class="control-group">\n            <label class="control-label" for="metricOperator">\n              Limits\n            </label>\n            <div class="controls">\n              <div class="filterCount">\n                <input type="text" id="filterMin" placeholder="Min">\n                <input type="text" id="filterMax" placeholder="Max">\n              </div>\n            </div>\n          </div>\n        </form>\n      </div>\n    </div>\n  </div>\n  <div class="n-modal-footer">\n    <button class="btnCancel btn">\n      Cancel\n    </button>\n    <button class="btnSave btn btn-primary"\n            data-loading-text="Saving...">\n      Save\n    </button>\n  </div>\n</div>'}),define("views/pages/insights/InsightsQueryParametersView",["views/basecomponents/popups/BasePopupView","utils/AppUtil","text!templates/pages/insights/InsightsQueryParameters.html"],function(e,t,i){"use strict";return e.extend({events:{"click  .btnSave":"onSave","click  .btnCancel":"hide","click  .modal-header .close":"hide","keypress input":"onKeyPress"},initialize:function(e){this.queryModel=e.queryModel,this.onSuccess=e.onSuccess,this.render()},render:function(){if(!this.queryModel)return void t.log("Internal error. Query not available.");this.$el.html(i),_.each(this.queryModel.QUERY_OPTIONS,function(e){this.$("#"+e).val(this.queryModel.get(e)||"")},this),this.applyNutanixInput({types:["select"]})},onSave:function(){_.each(this.queryModel.QUERY_OPTIONS,function(e){if(this.$("#"+e).length){var t=this.$("#"+e).val();t&&t.length?this.queryModel.set(e,t):this.queryModel.set(e,null)}},this),this.onSuccess()}})}),define("views/pages/insights/InsightsChartOptionsView",["views/basecomponents/BaseView","data/DataProperties","views/pages/insights/InsightsQueryParametersView","managers/NavigationManager","utils/AppConstants","utils/AppUtil"],function(e,t,i,n,s,a){"use strict"
;var r=_.template('<div class="query-results-header"> <%= title %></div>'),o=_.template('<div class="query-container <%= disabled %>" id="<%= queryId %>"><span class="metric-box" style="background: #<%= colorHex %>;"> &nbsp; </span><div class="description"> <div class="entity" title="<%= entityDisplayName %>"><%= entityDisplayName %></div></div><div class="query-options"><i class="checkIcon" aria-hidden="true" data-icon="J"></i><span class="dropdown dropdown-menu-right"><a data-toggle="dropdown" class="dropdown-toggle" href="#"><i class="plusIcon" aria-hidden="true" data-icon="H"></i></a><ul class="dropdown-menu"><% _.each(qOptions, function(qOption) { %><li><a class="btnQueryOption" data-groupBy="<%= qOption.groupBy %>" data-sortOrder="<%= qOption.sortOrder %>" data-sortKey="<%= qOption.sortKey %>" data-count="<%= qOption.count %>" ><%= qOption.title %></a></li><% }) %><li class="divider"></li><li><a class="btnEditQuery">Edit</a></li></ul></span></div> <div class="metric" title="<%= metricName %>">   <%= metricName %></div></div>'),l=_.template('<div class="query-container top-n-result <%= disabled %>" id="<%= resultId %>"><span class="metric-box" style="background: #<%= colorHex %>;"> &nbsp; </span><div class="description"> <div class="entity" title="<%= entityDisplayName %>"><%= entityDisplayName %></div></div><div class="query-options"><i class="checkIcon" aria-hidden="true" data-icon="J"></i></div> <div class="metric" title="<%= metricName %>">   <%= metricName %></div></div>'),c=_.template('<div class="query-container"><div class="description">Loading...</div></div>'),d=_.template('<div class="query-container"><div class="description">Error retrieving results.</div></div>'),u=_.template('<div class="query-container query-results-header top-n-query" id="<%= queryId %>"><div class="description">  <div class="back-link">     <i class="n-icon" data-icon="x" aria-hidden="true"></i>  <div class="back-link-text"><%= chartTitle %></div>  <div class="back-link-sub-text"><%= resultsTitle %></div>  </div></div><% if ( qOptions.length ) { %> <div class="header-options"><span class="dropdown dropdown-menu-right"><a data-toggle="dropdown" class="dropdown-toggle" href="#"><i class="plusIcon" aria-hidden="true" data-icon="H"></i></a><ul class="dropdown-menu"><% _.each(qOptions, function(qOption) { %><li><a class="btnQueryOption" data-groupBy="<%= qOption.groupBy %>" data-sortOrder="<%= qOption.sortOrder %>" data-sortKey="<%= qOption.sortKey %>" data-count="<%= qOption.count %>" ><%= qOption.title %></a></li><% }) %></ul></span></div><% } %></div>');return e.extend({detailsChartId:null,events:{"click .checkIcon":"onEnableQuery","click .btnQueryOption":"onQueryDrilldown","click .btnEditQuery":"onEditQuery","click .back-link":"onClickBackLink"},initialize:function(e){this.detailsChartId=e.detailsChartId,this.model.on("stats:loaded",this.render,this),this.model.on("stats:error",this.render,this)},destroy:function(){this.model.off("stats:loaded",this.render,this),this.model.off("stats:error",this.render,this)},onClickBackLink:function(){var e=_.clone(this.model.getAnalysisContext());e[t.CHART_ID]=this.detailsChartId,e=_.extend(e,this.model.getSelectedTimeRanges()),n.navigateToPage(s.PAGE_INSIGHTS,s.SUBPAGE_CHART,a.formatObjectToQuery(e,!0))},_getChartModel:function(){return this.model.getChartById(this.detailsChartId)},onEnableQuery:function(e){var i=$(e.currentTarget),n=i.parents(".query-container").attr(t.ID),s=this._getChartModel();s.get(t.CHART_TYPE)===s.CHART_TYPE_INSIGHTS_TOP_N?s.toggleQueryResultEnable(n):s.toggleQueryEnable(n)},onQueryDrilldown:function(e){var i=$(e.currentTarget),r=i.parents(".query-container").attr(t.ID),o=this._getChartModel(),l=o.getQueryById(r),c={chartId:this.detailsChartId,type:o.CHART_TYPE_INSIGHTS_TOP_N,euid:l.get(t.QUERY_ENTITY).uid,muid:l.get(t.QUERY_METRIC).uid};_.each(l.QUERY_OPTIONS,function(e){var t=i.attr("data-"+e);t&&(c[e]=t)}),c=_.extend(c,this.model.getAnalysisContext(),this.model.getSelectedTimeRanges()),n.navigateToPage(s.PAGE_INSIGHTS,s.SUBPAGE_CHART,a.formatObjectToQuery(c,!0))},onEditQuery:function(e){var n=$(e.currentTarget),s=n.parents(".query-container").attr(t.ID),r=this._getChartModel(),o=r.getQueryById(s),l=new i({el:a.createPopupContainer("queryParametersPopupView"),queryModel:o,onSuccess:function(){l.hide(),r.refreshQuery(o)}});l.show()},onChartChange:function(){this.render()},renderChartHeader:function(){this.render()},render:function(){var e=this._getChartModel();if(!e)return void this.$el.html(c());var i;if(e.get(t.CHART_TYPE)===e.CHART_TYPE_INSIGHTS_TOP_N)i=this._renderTopNQueryResults(e);else{i=r({title:e.getTitle()});var n=e.getQueries();_.each(n,function(e){var n=e.fullMetricDisplayName(),s=e.getDDOptions();i+=o({queryId:e.get("id"),entityDisplayName:e.getEntityDisplayName(),metricName:n,disabled:e.isEnabled()?"":"disabled",colorHex:e.get(t.CHART_COLORS)[0],qOptions:s})},this)}this.$el.html(i)},_renderTopNQueryResults:function(e){var i="",n=e.getQueries()[0],a=this.model.getStatsState(n);if(null===a||a===s.STATE_INIT||a===s.STATE_PENDING)i=c();else if(a===s.STATE_ERROR)i=d();else{var r=n.getDDTitle();i=u({queryId:n.get("id"),qOptions:n.getDDOptions(),chartTitle:e.getTitle(),resultsTitle:r});var o=this.model.getStats(n),h=n.get(t.CHART_COLORS),p=o[t.QUERY_RESULTS_PROPERTIES],T=n.fullMetricDisplayName();_.each(p,function(e,t){var n=e.name||e.id,s=e.enabled?"":"disabled";i+=l({resultId:e.id,colorHex:h[t],disabled:s,entityDisplayName:n,metricName:T})},this)}return i}})}),define("text!templates/pages/insights/InsightsEntityChartEditorView.html",[],function(){return'<div class="modal-header">\n  <button type="button" class="close" data-dismiss="modal">\n    <i data-icon="K" aria-hidden="true"></i>\n  </button>\n  <h4 class="n-title">Configure Chart</h4>\n</div>\n<div class="n-modal-wrapper">\n  <div class="n-modal-body">\n    <div class="n-modal-content-wrapper">\n      <div class="n-modal-alert-header">\n        \x3c!-- @view: alert goes here... --\x3e\n      </div>\n      <div class="n-modal-content ">\n        <div class="insights-chart-editor">\n          <div class="left-side">\n            <div class="selectors">\n              <div class="header">\n                SEARCH\n              </div>\n              \x3c!-- The metric or entity selector --\x3e\n              <div class="n-spotlight"></div>\n            </div>\n\n            <div class="selection-results">\n              <div class="header">\n                <div class="selector" data-id="metric">Metrics</div>\n                &middot;\n                <div class="selector" data-id="entity">Entities</div>\n              </div>\n              <div class="results results-metric"></div>\n              <div class="results results-entity"></div>\n            </div>\n          </div>\n\n          <div class="right-side">\n            <div class="selections-wrapper">\n              <div class="header">\n                SELECTED METRICS\n              </div>\n              <div class="selections" data-id="metric">\n                \x3c!-- Selected metrics here--\x3e\n              </div>\n            </div>\n            <div class="selections-wrapper">\n              <div class="header">\n                SELECTED ENTITIES\n              </div>\n              <div class="selections" data-id="entity">\n                \x3c!-- Selected entitites here--\x3e\n              </div>\n            </div>\n          </div>\n\n          <div class="summary">\n            \x3c!-- Summary of selections rendered here--\x3e\n          </div>\n\n        </div>\n      </div>\n    </div>\n  </div>\n  <div class="n-modal-footer">\n    <button class="btnCancel btn n-btn-form"> Cancel</button>\n    <button class="btnSave btn btn-primary n-btn-form"> Save</button>\n  </div>\n</div>\n'}),define("views/pages/insights/InsightsChartEditorView",["backbone","views/basecomponents/popups/BasePopupView","data/DataURLConstants","views/basecomponents/spotlight/SpotlightView","views/basecomponents/spotlight/SpotlightResultsView","models/spotlight/SpotlightCollection","utils/AppConstants","utils/AppUtil","utils/InsightsUtil","text!templates/pages/insights/InsightsEntityChartEditorView.html"],function(e,t,i,n,s,a,r,o,l,c){"use strict";var d=_.template(c),u=_.template('<% if ( ! nbMetrics ) { %>Please select a metric.<% } else if ( ! nbEntities ) { %>Please select an entity.<% } else {  %>You have selected <%= nbMetrics === 1 ? "one metric" : (nbMetrics + " metrics") %> and <%= nbEntities === 1 ? "one entity" : (nbEntities + " entities") %>. This will generate <%= nbMetrics * nbEntities %> lines.<% } %>'),h=_.template('<div class="results-row"><input class="result-checkbox" type="checkbox" id="<%=id%>"><div class="result-title"><%= title %></div></div>'),p=_.template('<div class="results-row"><div class="result-title"><%= message %></div></div>'),T=_.template('<div class="selection-row"><div class="selection-title"><%= displayName %></div><div class="selection-delete"><i class="btnDelete btnDeleteMetric" data-uid="<%= metric.uid %>" aria-hidden="true" data-icon="v"></i></div></div>'),E=_.template('<div class="selection-row"><div class="selection-title"><%= displayName %></div><div class="selection-delete"><i class="btnDelete btnDeleteEntity" data-uid="<%= entity.uid %>" aria-hidden="true" data-icon="v"></i></div></div>'),g={METRIC:"metric",ENTITY:"entity"},S=a.extend({selectionMode:null,analysisContext:null,spotLightURLs:{entity:i.INSIGHTS_ENTITY_SEARCH,metric:i.INSIGHTS_METRIC_SEARCH},initialize:function(e){this.analysisContext=e.analysisContext,a.prototype.initialize.apply(this,arguments)},setSelectionMode:function(e){this.selectionMode=e,this.url=this.spotLightURLs[e],this.analysisContext&&(this.url+="?"+o.formatObjectToQuery(this.analysisContext,!0))},_preProcessResults:function(e){return this.selectionMode===g.METRIC&&_.each(e,function(e){e.title=e.name.replace(/_|\./g," "),e.id=e.name,e.entityOrGeneric=r.SPOTLIGHT_COMMAND_ENTITY}),e},_sortResults:function(e){return this.selectionMode===g.ENTITY?e.sort(function(e,t){var i=e.entityName||e.entityId,n=t.entityName||t.entityId;return i.localeCompare(n)}):e.sort(function(e,t){return e.title.localeCompare(t.title)})},_filterResults:function(e){return e}}),m=s.extend({render:function(){},suggest:function(e){this.options.suggest(e)}}),v=n.extend({selectionMode:null,analysisContext:null,initialize:function(e,t){this.analysisContext=t.analysisContext,n.prototype.initialize.apply(this,arguments)},setSelectionMode:function(e){this.selectionMode=e,this.spotlightCollection.setSelectionMode(e)},_createSpotlightCollection:function(){return new S({analysisContext:this.analysisContext})},_createResultsView:function(e){return new m({parentEl:this.$el,selectHandler:e.selectHandler,wrapperEl:e.wrapperEl,cssPosition:e.cssPosition,suggest:e.suggest,isMulticluster:this.isMulticluster})}});return t.extend({currentSelectionMode:null,chartEntities:null,chartMetrics:null,analysisContext:null,spotlight:null,spotLightResults:{metric:"",entity:""},events:{"click  .btnSave":"onSave","click  .btnCancel":"hide","click  .modal-header .close":"hide","click  .selector":"onSelectionModeChange","click  .btnDeleteEntity":"onDeleteEntity","click  .btnDeleteMetric":"onDeleteMetric","change .result-checkbox":"onResultSelect","keypress input":"onKeyPress"},onEnterKeyPress:function(){if(this.currentSelectionMode===g.METRIC){var e=this.$("#searchText").val().trim();if(e.length){var t={id:e,title:e,fieldValue:e};this.spotLightResults[this.currentSelectionMode]=[t],this.renderResults()}}},onResultSelect:function(e){var t,i=$(e.currentTarget),n=i.is(":checked"),s=i.attr("id"),a=this.spotLightResults[this.currentSelectionMode];if(this.currentSelectionMode===g.METRIC){t=_.find(a,function(e){return e.id===s});var r={id:t.id,title:t.title,uid:t.id};n?(this.chartMetrics.push(r),this.renderMetrics()):this._deleteMetric(r.uid)}else{t=_.find(a,function(e){return e.entityId===s});var o={id:t.entityId,type:t.entityType,title:t.entityName};o.uid=l.uniqueEntityIdentifier(o),n?(this.chartEntities.push(o),this.renderEntities()):this._deleteEntity(o.uid)}},onDeleteMetric:function(e){var t=$(e.currentTarget).attr("data-uid");this._deleteMetric(t)},_deleteMetric:function(e){var t=_.find(this.chartMetrics,function(t){return t.uid===e});this.chartMetrics=_.without(this.chartMetrics,t),this.renderMetrics(),this.$('input[id="'+t.id+'"]').prop("checked",!1)},onDeleteEntity:function(e){var t=$(e.currentTarget).attr("data-uid");this._deleteEntity(t)},_deleteEntity:function(e){var t=_.find(this.chartEntities,function(t){return t.uid===e});this.chartEntities=_.without(this.chartEntities,t),this.renderEntities(),this.$('input[id="'+t.id+'"]').prop("checked",!1)},onSelectionModeChange:function(e){var t=$(e.currentTarget),i=t.attr("data-id");this.currentSelectionMode!==i&&(this.$(".selector").removeClass("selected"),this.$(".results-"+this.currentSelectionMode).hide(),this.currentSelectionMode=i,this.$('.selector[data-id="'+this.currentSelectionMode+'"]').addClass("selected"),this.$(".results-"+this.currentSelectionMode).show(),this.spotlight.setSelectionMode(this.currentSelectionMode))},onSave:function(){this.onSubmit({chartEntities:this.chartEntities,chartMetrics:this.chartMetrics}),this.hide()},initialize:function(e){this.currentSelectionMode=g.METRIC,e&&(this.chartEntities=e.chartEntities,this.chartMetrics=e.chartMetrics,this.analysisContext=e.analysisContext,this.onSubmit=e.onSuccess)},render:function(){var e=d({});this.$el.html(e);var t=this,i=function(){return!1},n=function(e){t.spotLightResults[t.currentSelectionMode]=e,t.renderResults()};this.spotlight&&this.spotlight.destroy(),this.spotlight=new v({el:this.$(".n-spotlight")},{selectHandler:i,entityType:this.$("#inputEntityType").val(),wrapperEl:this.$(".n-spotlight"),cssPosition:"absolute",analysisContext:this.analysisContext,suggest:n}),this.spotlight.setSelectionMode(this.currentSelectionMode),this.renderResults(),this.renderMetrics(),this.renderEntities()},renderResults:function(){this.$('.selector[data-id="'+this.currentSelectionMode+'"]').addClass("selected");var e,t=this.spotLightResults[this.currentSelectionMode];0===t.length?e="":"No results"===t[0].fieldValue?e=p({message:"No Results"}):(e="",_.each(t,function(t){var i=t;this.currentSelectionMode===g.ENTITY&&(i={id:t.entityId,title:t.entityName||t.entityId}),e+=h(i)},this)),this.$(".results-"+this.currentSelectionMode).html(e).show()},renderMetrics:function(){var e="";_.each(this.chartMetrics,function(t){e+=T({displayName:l.metricDisplayName(t),metric:t})}),this.$('.selections[data-id="metric"]').html(e),this.renderSummary()},renderEntities:function(){var e="";_.each(this.chartEntities,function(t){e+=E({displayName:l.entityDisplayName(t),entity:t})}),this.$('.selections[data-id="entity"]').html(e),this.renderSummary()},renderSummary:function(){var e=u({nbEntities:this.chartEntities.length,nbMetrics:this.chartMetrics.length});this.$(".summary").html(e)},destroy:function(){this.spotlight&&this.spotlight.destroy()}})}),define("text!templates/pages/insights/InsightsDetailsView.html",[],function(){return'<div class="insights-details-container">\n  <div class="insights-header">\n    <div class="insights-chart-actions">\n      <div class=\'db-icon\'>\n        <div class=\'inner\' style=\'top: 0; left:0;\'></div>\n        <div class=\'inner\' style=\'top: 0; right:0;\'></div>\n        <div class=\'inner\' style=\'bottom: 0; left:0;\'></div>\n        <div class=\'inner\' style=\'bottom: 0; right:0;\'></div>\n      </div>\n      <div class="db-label">Dashboard</div>\n      <div class="chart-configure chart-actions-box">\n        &middot;&nbsp;&middot;&nbsp;&middot;\n      </div>\n      <div class="chart-enable-options chart-actions-box">\n        <span class=\'dropdown dropdown-menu-right\'>\n          <a data-toggle=\'dropdown\' class=\'dropdown-toggle\' href=\'#\'>\n            <i class="checkIcon" data-icon="J" aria-hidden="true"></i></a>\n            <ul class=\'dropdown-menu enable-options-dropdown\'>\n          </ul>\n          </span>\n      </div>\n    </div>\n    <div class="time-range-selector-wrapper">\n      <div class="time-range-selector">\n        \x3c!-- TimerangeSelectorView is rendered here --\x3e\n      </div>\n    </div>\n  </div>\n  <div class="chart-configuration-container">\n    <div class="chart-config-panel">\n      \x3c!-- Chart configuration UI here on the left--\x3e\n    </div>\n  </div>\n  <div class="chart-buttons-panel chart-config-buttons">\n    <button class="chart-button n-secondary-btn"\n            id="chart-button-editor">Chart Editor</button>\n  </div>\n\n  <div class="insights-center">\n    <div class="charts-container">\n      \x3c!-- The main chart and its legend rendered here --\x3e\n    </div>\n    <div class="chart-container-bottom">\n      <div class="time-selector-view">\n        \x3c!--Time Selector here--\x3e\n      </div>\n      <div class="selected-time-line">\n        \x3c!-- The selected time (rendered as a vertical line)--\x3e\n      </div>\n      <div class="charts-timeline-footer">\n        \x3c!--Time Line Footer here--\x3e\n      </div>\n    </div>\n    <div class="chart-legend">\n      \x3c!-- Chart legend goes here.--\x3e\n    </div>\n  </div>\n</div>'}),define("views/pages/insights/InsightsDetailsView",["managers/NavigationManager","utils/AppUtil","utils/SubViewHelper","utils/AppConstants","utils/InsightsUtil","data/DataProperties","views/timeline/TimelineView","views/timeline/TimerangeSelectorView","views/timeline/TimeSelectorView","views/pages/insights/InsightsDetailedChartView","views/pages/insights/InsightsChartOptionsView","views/timeline/ChartsFooterView","views/pages/insights/InsightsChartEditorView","text!templates/pages/insights/InsightsDetailsView.html"],function(e,t,i,n,s,a,r,o,l,c,d,u,h,p){"use strict";var T=l.extend({updateSelectedTimeUI:function(){t.debug("TimeSelector : updateSelectedTimeUI: "," | viewid     : ",this.cid);var e=this.$(".ui-slider-handle");if(e.length){var i=this.$el.siblings(".selected-time-line");if(i.length){var n=e.offset().left+e.outerWidth()/2,s=this.$el.parent().siblings(".charts-container"),r=s.height();i.css({left:n-280,height:r+2})}var o=this.model.get(a.SELECTED_TIME),l=new Date(o).toString(this.SLIDER_DATE_FORMAT);e.html(l)}}}),E=_.template('<li>  <a class="btnDropdownOption chartEnableOption" data-id="<%= id %>">  <%= name %>  </a></li>');return r.extend({viewTemplate:_.template(p),detailsChartId:null,extraEvents:{"click .db-label":"onDashboardClick","click .db-icon":"onDashboardClick","click .chartEnableOption":"onChartEnableOptionClick","click #chart-button-editor":"onChartConfigureClick"},onDashboardClick:function(){var i=this.model.getAnalysisContext();delete i[a.CHART_ID],e.navigateToPage(n.PAGE_INSIGHTS,n.SUBPAGE_PERSPECTIVE,t.formatObjectToQuery(i,!0))},onChartEnableOptionClick:function(e){var t=$(e.currentTarget).attr("data-id");"hideAll"===t?this.model.enableAll(!1):"showAll"===t?this.model.enableAll(!0):this.model.enableMetric(t,!0)},onChartConfigureClick:function(e){if(!$(e.currentTarget).hasClass("disabled")){var i=this,n=this.model.getChartById(this.detailsChartId);new h({el:t.createPopupContainer("chartConfigurePopupView"),chartEntities:n.getChartEntities(),chartMetrics:n.getChartMetrics(),analysisContext:this.model.getAnalysisContext(),onSuccess:function(e){i._updateChartConfiguration(e.chartEntities,e.chartMetrics)}}).show()}},_updateChartConfiguration:function(e,t){var i=this.model.getChartById(this.detailsChartId),n=i.getChartEntities(),s=i.getChartMetrics(),a=_.difference(n,e),r=_.difference(e,n),o=_.difference(s,t),l=_.difference(t,s),c=[];c=c.concat(_.pluck(a,"uid")),c=c.concat(_.pluck(o,"uid")),c.length&&i.removeQueries(c),(r.length||l.length)&&(i.addQueries(r,l),i.assignChartColors()),i.triggerChartChange()},initialize:function(e){t.debug("InsightsDetailsView : initialize: "," | viewid     : "+this.cid),this.detailsChartId=e[a.CHART_ID],this.addExtraEvents(this.extraEvents),this.model.on("change:boundsRangeChangeTrigger",this.onBoundsRangeChange,this),this.model.on("change:timeRangeChangeTrigger",this.onTimeRangeChange,this),this.model.on("change:selectedTime",this.onSelectedTimeChange,this),this.model.on("change:selectedTimeUpdateComplete",this.onSelectedTimeUpdateComplete,this),this.model.on("change:chartChangeTrigger",this.onChartChange,this),this.model.on("change:zoomChangeTrigger",this.onZoomChange,this),this.render()},processViewOptions:function(e){this.detailsChartId=t.parseQueryToObject(e).chartId,this._recreateCharts()},render:function(){r.prototype.render.apply(this,arguments);var e=this.model.getChartById(this.detailsChartId);if(e){var t=e.getChartMetrics(),i="";i+=E({id:"showAll",name:"Show all"}),i+=E({id:"hideAll",name:"Hide all"}),_.each(t,function(e){i+=E({id:e.uid,name:"Show all "+s.metricDisplayName(e)})}),this.$("ul.enable-options-dropdown").append(i),this.$(".dropdown-toggle").dropdown(),e.get(a.CHART_TYPE)===e.CHART_TYPE_INSIGHTS_TOP_N&&this.$("#chart-button-editor").addClass("disabled")}},onSelectedTimeUpdateComplete:function(){this.subViewHelper.iterate("onSelectedTimeUpdateComplete")},_initializeSubViews:function(){if(!this.subViewHelper){this.subViewHelper=new i;var e=this,t=new d({el:this.$(".chart-config-panel"),model:this.model,detailsChartId:this.detailsChartId,onChange:function(){e.model._triggerChartChange()}});this.subViewHelper.register("chartOptionsView",t);var n=new o({el:this.$(".time-range-selector"),model:this.model});this.subViewHelper.register("time-range-selector-view",n);var s=new T({el:this.$(".time-selector-view"),model:this.model});this.subViewHelper.register("time-selector-view",s);var a=new u({el:this.$(".charts-timeline-footer"),model:this.model});this.subViewHelper.register("charts-footer-view",a)}},_recreateCharts:function(){if(!this._getCurrentChartIds().length){var e=this.model.getChartById(this.detailsChartId);e&&this._addChart(e,!1,!0)}},_instantiateChart:function(e){return new c(e)},_refreshScrollers:function(){var e=$(window).height()-6,t=e-170,i=$(window).width()-280;t-=$("#n-notification-bar").outerHeight(!0),this.$(".insights-center").width(i),this.$(".charts-container").width(i),this.$(".chart-config-panel").height(t+14),this.$(".insights-center").height(t+64);var n=t+26;if(this.$(".chart-panel").height(n),this.$(".chart-content").height(n),this.subViewHelper){var s=this.CHART_ID_PREFIX+this.detailsChartId,a=this.subViewHelper.get(s);a&&a.render();var r=this.subViewHelper.get("time-selector-view");r&&r.updateSelectedTimeUI()}_.each(this.scrollers,function(e){e.refresh()})}})}),define("models/insights/InsightsTimelineModel",["models/timeline/TimelineModel","models/insights/InsightsChartModel","models/insights/InsightsStatsModel","utils/AppUtil","utils/AppConstants","data/DataProperties","data/DataURLConstants"],function(e,t,i,n,s,a,r){"use strict";var o=null;return e.extend({statsRequests:null,isFetchingStats:!1,isPausedFetching:!1,initialize:function(){n.debug("InsightsTimelineModel : initialize:  | modelId     : "+this.cid),this.initializeBaseModel(),this.initializeDefaults(),this.statsRequests=[],this.isFetchingStats=!1,this.isPausedFetching=!1},setAnalysisContext:function(e){this.set(a.ANALYSIS_CONTEXT,e),this._clearStats(),this.initializeCharts()},getAnalysisContext:function(){return this.get(a.ANALYSIS_CONTEXT)},getDefaultTimeRanges:function(){var e=Date.now();return{boundsRangeMax:e,boundsRangeMin:e-6*s.MILLIS_PER_HOUR,samplingIntervalSecs:n.samplingIntervalByDays(7),timeRangeMax:e,timeRangeMin:e-3*s.MILLIS_PER_HOUR}},loadInsightsJSON:function(e){if(o)return void e();$.getJSON(n.cacheBustURL(r.INSIGHTS_DASHBOARD),function(t){try{o=_.template(JSON.stringify(t)),e()}catch(t){n.log("Error parsing insights dashboard. "+t),o="ERROR parsing dashboard",e()}})},initializeCharts:function(e){var t=this;this.loadInsightsJSON(function(){var i=t.get(a.CHARTS);i.reset();var r=t.getAnalysisContext()||{},l=r.entityId||"CURRENT_CLUSTER",c=r.entityType||s.ENTITY_CLUSTER,d=r.dashboardId||null,u=o({entityId:l,entityType:c}),h=JSON.parse(u);t.set(a.DASHBOARDS,h[a.DASHBOARDS]),d=d||h[a.DASHBOARDS][0].id,t.set(a.SELECTED_DASHBOARD,d);var p={};_.each(h.charts,function(e,s){p[s]||(p[s]=[]),e.length>30&&(e=e.slice(0,30),n.log("InsightsTimelineModel : Charts limit of 30 exceeded for category "+s+". Some charts not processed.")),_.each(e,function(e){var t=this.createChartModel();t.setParentModel(this),t.fromPersistedObject(e);var n=s+t.getTitle();n=n.replace(/\s/g,""),t.setChartId(n),i.add(t),p[s].push(t.getChartId())},t)},t),t.set(a.CHART_CATEGORY_MAP,p),t._triggerChartChange(),e&&e()})},pauseFetchingStats:function(){this.isPausedFetching=!0},resumeFetchingStats:function(){this.isPausedFetching=!1,this._processNextStatsRequest()},getDashboards:function(){return this.get(a.DASHBOARDS)},getChartCategories:function(){var e=this.get(a.SELECTED_DASHBOARD),t=_.find(this.get(a.DASHBOARDS),function(t){return t.id===e});return t?t.sections:[]},getChartCategory:function(e){var t=null,i=this.get(a.CHART_CATEGORY_MAP);return _.each(i,function(i,n){i.indexOf(e)>=0&&(t=n)}),t},getChartsInCategory:function(e){var t=[],i=this.get(a.CHART_CATEGORY_MAP)[e],n=this.get(a.CHARTS).models;return i&&(t=_.filter(n,function(e){return i.indexOf(e.getChartId())>=0})),t},enableAll:function(e){this.get(a.CHARTS).each(function(t){t.enableAllQueries(e)}),this._triggerChartChange()},enableMetric:function(e,t){this.get(a.CHARTS).each(function(i){i.enableMetric(e,t)}),this._triggerChartChange()},setSelectedTime:function(e,t){var i=this.get(a.TIME_RANGE_MIN);e<=this.get(a.TIME_RANGE_MAX)&&e>=i?(this.set({selectedTime:e}),t||this._triggerSelectedTimeUpdateComplete()):n.debug("Error: setSelectedTime, invalid time:",new Date(e))},_getStatsModel:function(e){var t=e.get(a.ID);return _.find(this.get(a.STATS_MODELS),function(e){return e.getQuery().get(a.ID)===t})},getStats:function(e){var t=this._getStatsModel(e),i=t?t.getStats():null;return n.debug("InisightsTimelineModel : getStats: "," | queryModelId:",e.get("id")," ret:",i),i},removeStats:function(e){var t=this._getStatsModel(e),i=this.get(a.STATS_MODELS);this.set(a.STATS_MODELS,_.without(i,t))},getStatsState:function(e){var t=this._getStatsModel(e);return t?this.get(a.STATS_STATE)[t.cid]:null},loadStats:function(e,t){var i=e.get(a.ID),r=this;n.debug("InsightsTimelineModel : loadStats: "," | queryModel:",e," requestorId:",t);var o=this._getStatsModel(e);if(o){n.debug("InsightsTimelineModel:loadStats-Stats already loaded:",i);return void(this.get(a.STATS_STATE)[o.cid]===s.STATE_PENDING?o.addRequestor(t):this.trigger("stats:loaded",[i,t]))}var l=this.get(a.BOUNDS_RANGE_MIN),c=this.get(a.BOUNDS_RANGE_MAX),d=this.get(a.SAMPLING_INTERVAL_SECS);o=this.createStatsModel(),o.setTimeInterval(l,c,d),o.setQuery(e),o.addRequestor(t),this.get(a.STATS_MODELS).push(o);var u=o.cid;this._setStatsState(u,s.STATE_PENDING);var h=function(e,t,i){_.each(e.getRequestors(),function(e){r.trigger(t,[i,e])})};this.requestStats(o,{success:function(e){r._setStatsState(e.cid,s.STATE_SUCCESS),h(e,"stats:loaded",e.queryModel.get(a.ID))},error:function(e){r._setStatsState(e.cid,s.STATE_ERROR),h(e,"stats:error",e.queryModel.get(a.ID))}})},requestStats:function(e,t){this.statsRequests.push([e,t]),this._processNextStatsRequest()},createStatsModel:function(){return new i},createChartModel:function(){return new t},_clearStats:function(){this.set({stats:[]}),this.statsRequests=[]},_processNextStatsRequest:function(){var e=this;if(!this._isFetchingStats&&!this.isPausedFetching&&this.statsRequests.length>0){this._isFetchingStats=!0;var t=this.statsRequests[0];this.statsRequests.splice(0,1);var i=t[0],n=t[1];i.fetch({success:function(t){e._isFetchingStats=!1,n.success(t),e._processNextStatsRequest()},error:function(t){e._isFetchingStats=!1,n.error(t),e._processNextStatsRequest()}})}},_fetchEvents:function(){},_fetchAlerts:function(){},_triggerSelectedTimeUpdateComplete:function(){var e=a.SELECTED_TIME_UPDATE_COMPLETE;this.set({attr:!this.get(e)})}})}),define("views/pages/insights/InsightsPageView",["views/basecomponents/pages/BasePageView","views/pages/insights/InsightsView","views/pages/insights/InsightsDetailsView","models/insights/InsightsTimelineModel","data/DataProperties","utils/AppUtil","utils/AppConstants"],function(e,t,i,n,s,a,r){"use strict";return e.extend({pageId:r.PAGE_INSIGHTS,defaultSubPageId:r.SUBPAGE_PERSPECTIVE,AC_ATTRIBUTES:[s.ENTITY_ID,s.ENTITY_TYPE,s.DASHBOARD_ID],initialize:function(){var t={},i=a.getHashParameters();i&&_.each(this.AC_ATTRIBUTES,function(e){t[e]=i[e]}),this.model=new n({analysisContext:t}),i&&this._setOverrideTimeRange(this.model,i),e.prototype.initialize.apply(this,arguments)},onShowSubPage:function(e,n){var o,l=$("body");switch(this.$(".n-page-nav").hide(),e){case r.SUBPAGE_PERSPECTIVE:l.removeClass("n-app-noscroll"),o=this.getSubView(r.SUBPAGE_PERSPECTIVE),o||(o=this.registerSubView(e,new t({el:this.getSubPageElement(r.SUBPAGE_PERSPECTIVE),model:this.model,pageId:r.PAGE_INSIGHTS})));var c=a.parseQueryToObject(n),d={};c&&_.each(this.AC_ATTRIBUTES,function(e){d[e]=c[e]}),this.model.setAnalysisContext(d),o.show(n);break;case r.SUBPAGE_CHART:l.addClass("n-app-noscroll");var u=a.parseQueryToObject(n)[s.CHART_ID];o=this.getSubView(r.SUBPAGE_CHART),o&&this.removeSubView(e);var h=this;this._createTimelineModel(u,n,function(t){o=h.registerSubView(e,new i({el:h.getSubPageElement(r.SUBPAGE_CHART),model:t,chartId:u,pageId:r.PAGE_INSIGHTS})),o.show(n)})}},onHideSubPage:function(){$("body").removeClass("n-app-noscroll")},_createTimelineModel:function(e,t,i){var s=t?a.parseQueryToObject(t):{},r=_.clone(this.model.getAnalysisContext()),o=new n({analysisContext:r});this._setOverrideTimeRange(o,s),o.initializeCharts(function(){var t=o.getChartById(e);if(t){var n=t.toPersistedObject(),a=o.createChartModel();a.setChartId(e),a.setParentModel(o),a.fromPersistedObject(n),o.get("charts").reset([a]),s.type===a.CHART_TYPE_INSIGHTS_TOP_N&&a.setDDOptions(s)}i(o)})},_setOverrideTimeRange:function(e,t){var i=[s.BOUNDS_RANGE_MIN,s.BOUNDS_RANGE_MAX,s.TIME_RANGE_MIN,s.TIME_RANGE_MAX],n={},a=!1;_.each(i,function(e){t[e]?n[e]=Number(t[e]):a=!0},this),a||e.setDrilldownTimerange(n[s.TIME_RANGE_MIN],n[s.TIME_RANGE_MAX],n[s.BOUNDS_RANGE_MAX],n[s.BOUNDS_RANGE_MIN])}})}),define("text!templates/pages/broker/BrokerTemplate.html",[],function(){return'\x3c!-- Page Body --\x3e\n<div class="n-page-body">\n  <div class="sub-app-shell">\x3c!--subApp goes here --\x3e</div>\n</div>'}),define("views/pages/broker/BrokerTemplateRenderer",["text!templates/pages/broker/BrokerTemplate.html"],function(e){"use strict";var t=_.template(e);return{getPageTemplate:function(e){return t()}}}),define("views/pages/broker/BaseBrokerPageView",["views/basecomponents/pages/BasePageView","views/pages/broker/BrokerTemplateRenderer"],function(e,t){"use strict";return e.extend({pageId:null,defaultSubPageId:null,setSubappTemplate:function(){this.$el.attr("id",this.pageUuid),this.template=t.getPageTemplate(this.pageUuid),this.$el.html(this.template)},render:function(){return this.setSubappTemplate(),setTimeout(function(){this.loadSubapp()}.bind(this),0),this.$el},loadSubapp:function(){},unloadSubapp:function(){},show:function(){this.startServices(),this.$el.show()},onStartServices:function(){},onStopServices:function(){},destroy:function(){this.unloadSubapp(),e.prototype.destroy.apply(this,arguments)}})}),define("views/pages/broker/BrokerPageView",["views/pages/broker/BaseBrokerPageView","utils/AppConstants","managers/ClusterManager","managers/NavigationManager"],function(e,t,i,n){"use strict";return e.extend({pageId:t.PAGE_BROKER,defaultSubPageId:t.SUBPAGE_PERSPECTIVE,render:function(){return this.setSubappTemplate(),this.$el},show:function(e){i.isMulticlusterUI()?n.navigateToPage(t.PAGE_MC_DASHBOARD):n.navigateToPage(t.PAGE_DASHBOARD)},getSubPageId:function(e){return e.subPageId.split("?")[0]}})}),
define("text!templates/pages/settings/SettingsPageView.html",[],function(){return'\x3c!-- This is the global settings experimental page --\x3e\n<div class="main-sidebar-wrapper">\n  <div class="main-sidebar">\n  </div>\n</div>\n\n<div class="main-sidebar-spacer"></div>\n\n<div class="main-body-wrapper">\n  <div class="main-alert-header"></div>\n  <div class="main-body"></div>\n</div>\n'}),define("views/pages/settings/SettingsPageView",["views/basecomponents/pages/BasePageView","views/navigation/MenuDescriptor","managers/ClusterManager","managers/NotificationManager","broker/managers/BrokerManager","utils/AppConstants","utils/AppUtil","text!templates/pages/settings/SettingsPageView.html"],function(e,t,i,n,s,a,r,o){"use strict";var l=_.template(o);return e.extend({name:"SettingsPageView",pageId:a.PAGE_SETTINGS,setting:null,defaultSubPageId:a.SUBPAGE_BLANK,initialize:function(){e.prototype.initialize.apply(this,arguments)},render:function(){return this.viewRendered?this.$el:(this.$el.html(l({})),t.getSettingsList(i.isMulticlusterNavMode(),null,this.renderMenu.bind(this)),this.viewRendered=!0,this.$el)},renderMenu:function(e,t){this.menuItems=t,this.loadReactWidget(this.$(".main-sidebar"))},showSubPage:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(e.subPageId&&-1===this.menuItems.indexOf(e.subPageId))return void n.showClientNotification(a.NOTIFY_ERROR,this.i18n("AccessDeniedReasons.accessDenied"));this.updateBodyStyle(e.subPageId),this.action=a.ACTION_SHOW,this.setting=e.subPageId,this.renderSettingsNav()},loadReactWidget:function(e){var t=this;this.componentId=s.loadComponent("NtnxReactUIApp",e,{componentName:"PrismSettingsMenu"},{success:function(e){t.reactComponent=e;try{t.renderSettingsNav()}catch(e){r.error(e)}}})},stopServices:function(){this.$(".main-body").html(""),e.prototype.stopServices.apply(this,arguments)},renderSettingsNav:function(){if(this.reactComponent){var e={settings:this.menuItems,action:this.action,setting:this.setting,categoryMapping:t.getSettingsCategoryMapping()};this.reactComponent.render(e)}}})}),define("views/pages/explore/SearchGuidelinesPageView",["views/basecomponents/pages/BasePageView","broker/managers/BrokerManager","utils/AppConstants","utils/AppUtil"],function(e,t,i,n){"use strict";return e.extend({name:"SearchGuidelinesPageView",pageId:i.PAGE_SEARCH_GUIDELINES,defaultSubPageId:i.SUBPAGE_BLANK,render:function(){return this.viewRendered?this.$el:(this.viewRendered=!0,this.loadReactWidget(this.$el),this.$el)},showSubPage:function(){this.updateBodyStyle(this.defaultSubPageId)},loadReactWidget:function(e){var i=this;this.componentId=t.loadComponent("SearchWidgets",e,{componentName:"SearchGuidelines"},{success:function(e){i.reactComponent=e;try{i.reactComponent.render()}catch(e){n.error(e)}}})},destroy:function(){this.reactComponent&&this.componentId&&t.unloadComponent(this.componentId),e.prototype.destroy.apply(this,arguments)}})}),define("components/TileComponent",["data/DataProperties","utils/AppUtil","utils/EntityUtil","utils/DataRendererUtil"],function(e,t,i,n){"use strict";var s=_.template('<div class="entity-tile-wrapper"><div class="entity-tile <%= tileClass %>" data-id="<%= dataId  %>"><%= tileContent %></div></div>'),a=_.template('<div class="tile-header"><input type="checkbox" class="tile-checkbox"   <%= isSelected ? "checked" : "" %> data-class="-blue"><div class="<%= entityNameClass %>"><%= primaryAttributeValue || "Unnamed" %></div></div><div class="tile-body"><div class="entity-info attribute-list -ellipsed"><% _.each(attributes, function(attr) { %><div  class="entity-attribute attribute-value <%= attr.rowColorClass %>"><div class="name"><%= attr.displayName %></div><div class="value"><%= attr.displayValue %></div></div><% }) %></div></div>');!function(r){function o(e){var t="";return _.each(e,function(e){var i=_.extend({dataId:"",tileContent:"",tileClass:""});t+=s(_.extend(i,e))}),t}function l(e,i){return e.getValue?e.getValue(i):t.getJSONValue(e,i)}function c(i){return i.getId?i.getId():t.getJSONValue(i,e.ID)}function d(e,t){var s,a=t;t.name?(s=t,a=t.name):s={name:t};var r;return e&&(r=i.getAttributeSchema(e,a)),s=r||s,n.getRenderer(s)}function u(e,t,i){if(i&&i.length){var n={};return _.each(i,function(i){var s=l(t,i),a=s;if(e||t.entityType){a=d(e,i).getAttributeDisplayValue(t,!1,s)}n[i]=a}),n}return t.getValue?t.toJSON({includeAttribute:!0,includeCustomAttributes:!0}):t}function h(e){var t=e.entityType,i=e.entities,n=e.attributes,s=e.primaryAttribute,r=e.selectedEntities,u=e.highlightAttribute;return o(_.map(i,function(e){var i,o=_.map(n,function(i){var n=d(t,i),s=l(e,n.getAttributeName());return(t||e.entityType)&&(s=n.getAttributeDisplayValue(e,!1,s)),{displayName:n.getAttributeDisplayName(),displayValue:s,rowColorClass:u===i?"highlight":""}},this);if(s){var h=d(t,s);i=l(e,h.getAttributeName()),(t||e.entityType)&&(i=h.getAttributeDisplayValue(e,!1,i))}var p=c(e);return{dataId:p,tileContent:a({entityId:p,isSelected:r&&r.indexOf(p)>=0,primaryAttributeValue:i||"-",entityNameClass:"",attributes:o})}}))}function p(e){var t=e.entityType,i=e.entities,n=e.attributes,s=e.template,a=e.tileClass;return o(_.map(i,function(i){return{dataId:c(i),tileContent:s(_.extend({model:u(t,i,n)},e.templateOptions||{})),tileClass:a||""}}))}r.fn.tileView=function(e){return e=e||{},e.tileCells?r(this).html(o(e.tileCells)):e.template?r(this).html(p(e)):e.attributes&&r(this).html(h(e)),this}}(jQuery)}),define("views/popups/lcm/LCMTileView",["views/basecomponents/BaseView","components/TileComponent","utils/AppUtil","utils/TimeUtil"],function(e,t,i,n){"use strict";var s=_.template('<div><span class="n-tooltip "><%= entityClass %></span><span class="n-tooltip "><%= entityModel %></span><span class="n-tooltip n-version"><%= version %></span></div>');return e.extend({name:"LCMTileView",initialize:function(t){e.prototype.initialize.apply(this,arguments),this.models=t.models,this.selectionModel=t.selectionModel},render:function(e){var t=this;if(!e||!e.template)throw new Error("Missing tile template for the tile view.");var i=e.attributes,n=e.template,s=this.dataSource(i),a=_.map(s,function(e){return t.renderTileCell(e,n)});this.$el.tileView({tileCells:a});var r=this;return this.$(".depend-tooltip").tooltip({title:function(){var e=$(this).attr("data-id"),t=$(this).attr("version-id");return r.getDependentVersionTooltip(e,t)},placement:"left",trigger:"hover",html:!0}),this.applyNutanixInput({types:["checkbox"]}),this},destroy:function(){this.$(".depend-tooltip").tooltip("destroy"),this.$el.tileView("destroy"),e.prototype.destroy.apply(this,arguments)},dataSource:function(e){return _.map(this.models,function(t){var i={};return e?(i[t.idAttribute]=t.getId(),i.id=t.getId(),_.each(e,function(e){i[e]=this.getAttributeDisplayValue(t,e)},this)):i=t.toJSON({includeAttribute:!0}),_.extend(i,{DP:t.DP,UIDP:t.UIDP})},this)},renderTileCell:function(e,t){return{dataId:e.id,tileContent:t(this.vtOptions({model:e})),tileClass:e.checked?"selected":""}},getAttributeDisplayValue:function(e,t){switch(t){case e.UIDP.LAST_UPDATED_TIME:return this.getLastUpdateTimeRange(e,!1);case e.UIDP.UPDATED_ON:return this.getLastUpdateTimeRange(e,!0);case e.UIDP.SELECTED_VERSION:return this.getSelectedVersion(e);case e.UIDP.DEPENDENCY_LIST:var i=this.getSelectedVersion(e);return this.findVersionDependencyListByModel(e,i);case e.UIDP.CHECKED:return this.isModelSelected(e);case e.UIDP.CLUSTER_WITH_UPGRADE:return this.getClusterInfo(e,!0);case e.UIDP.CLUSTER_WITHOUT_UPGRADE:return this.getClusterInfo(e,!1);case e.UIDP.ENTITY_COUNTS_WITHOUT_UPGRADE:var n=e.getEntities(!1);return _.size(n);default:return e.getValue(t)}},isModelSelected:function(e){if(this.selectionModel){var t=e.get(e.DP.ENTITY_CLASS);return this.selectionModel.isSelectedByEntityClass(t,e.getId())||this.selectionModel.isSelectedByDependency(t,[e.get(e.DP.MODEL)],[e.get(e.DP.VERSION)],e.get(e.DP.LOCATION_ID))}return!1},getClusterInfo:function(e,t){if(this.clusterManager.isMulticlusterNavMode()){var i=e.getClusters(t)||[];if(i.length>1)return this.i18ns("clusterInfo",i.length);if(i.length){var n=_.first(i),s=this.clusterManager.getNameById(n);if(s)return this.i18ns("clusterName",s)}}return""},findVersionDependencyListByModel:function(e,t){if(e){var i=e.get(e.UIDP.AVAILABLE_VERSIONS),n=_.find(i,function(e){return e.version===t});if(n)return n[e.UIDP.DEPENDENCY_LIST]||[]}return[]},getSelectedVersion:function(e){var t;if(this.selectionModel){var i=e.get(e.DP.ENTITY_CLASS);t=this.selectionModel.getSelectedVersionEntityClass(i,e.getId())||this.selectionModel.getSelectedDependentVersion(i,e),t===this.selectionModel.DEFAULT_UPDATE_VERSION&&(t=null)}return t||e.getValue(e.UIDP.AVAILABLE_VERSION).version},getLastUpdateTimeRange:function(e,t){var s=e.getValue(e.UIDP.LAST_UPDATED_TIME)||e.get(e.DP.LAST_UPDATED_TIME);return t?s?this.i18ns("updateTime",n.formatFullDateTime(s/1e3)):this.i18n("unknownUpdateTime"):s?this.i18ns("updateTimeRange",i.getElapsedTime({timestamp:s,includeAgo:!0,isDelta:!1})):this.i18n("unknownUpdateTime")},getDependentVersionTooltip:function(e,t){var i=_.find(this.models,function(t){return t.get(t.DP.UUID)===e}),n=this.findVersionDependencyListByModel(i,t);return _.map(n,function(e){return s({entityClass:e[i.DP.ENTITY_CLASS],entityModel:e[i.DP.MODEL],version:e[i.DP.VERSION]})}).join("")}})}),define("views/popups/lcm/LCMBaseSubPage",["views/basecomponents/BaseSubView","views/popups/lcm/LCMTileView","models/lcm/LCMModel","models/query/QueryResultCollection","data/DataProperties","utils/AppConstants","utils/AppUtil","utils/SubViewHelper","utils/CommonTemplates"],function(e,t,i,n,s,a,r,o,l){"use strict";var c=i.LCM_FRAMEWORK,d={DRILL_DOWN_VIEW:"_drillDetailsView_",UPDATE_PREVIEW_VIEW:"_updatePreviewView_"},u=_.template('<% _.each(errorInfo, function(info) { %><div><%= i18ns("versionUpdateError", info.version) %></div><div><%= info.taskMessage%></div><% }) %>');return e.extend({name:"LCMBaseSubPage",LCM_FRAMEWORK:c,VIEW_TYPES:d,events:{"click .lcm-drill-down":"onClickLinkAction","click .close-drill-down-view-link":"onClickLinkAction"},modelEvents:{"reset model":"onDataLoaded","error model":"onDataError"},initialized:!1,hostCollection:null,versionModel:null,viewByEntityType:null,editMode:!1,clusterIds:null,initialize:function(t){e.prototype.initialize.apply(this,arguments),this.clusterIds=t.clusterIds,this.initializeModel(t),this.delegateModelEvents(),this.hostCollection=t.hostCollection,this.versionModel=t.versionModel,this.subViewHelper=new o},initializeModel:function(e){var t=i.DP.MODEL;this.viewByEntityType===a.ENTITY_HOST&&(t=i.DP.LOCATION_ID),this.model?this.initialized=!0:(this.model=new n(null,{entityType:i.ENTITY_TYPE,queryType:n.QUERY_TYPES.LCM,entityModel:i,groupBys:[t]}),this.initialized=!1)},render:function(){return this.isModelInitialized()&&this.initialized?(this.populateVersionData(this.model),this.renderViewContents()):(this.$el.html(l.LOADING_MSG({msg:this.i18n("loading")})),this.loadData()),this},renderPageLoadingMessage:function(e){this.$el.empty(),this.$el.html(l.THREE_DOTS_LOADER_WITH_CONTENT({content:e}))},destroy:function(){this.undelegateModelEvents(),this.subViewHelper.destroy(),this.subViewHelper=null,this.$(".error-indicator[data-toggle=tooltip]").tooltip("destroy"),e.prototype.destroy.apply(this)},setParentView:function(t){e.prototype.setParentView.apply(this,arguments),this.name=t.name},setCurrentTask:function(e){this.currentTask=e},onDataLoaded:function(){this.initialized=!0,this.render()},onDataError:function(e,t){var i=r.processThrownError(t);this.showError(i)},loadData:function(){this.model.fetch()},populateVersionData:function(e){var t=this,i=this.versionsGroupByEntityUUId(),n=this.clusterManager.isMulticlusterNavMode();_.size(i)&&_.each(e.models,function(e){var s={},a=e.getId();if(!n||!e.get(e.DP.CLUSTER)){var r=i[a],o=t.formatVersionList(r);o&&(e.set(e.UIDP.AVAILABLE_VERSIONS,o),s[a]=o)}var l=e.getValue(e.UIDP.ENTITIES);l&&l.length>1&&_.each(l,function(r){if(!n||!r[e.DP.CLUSTER]){var l=r[e.DP.UUID];if(l!==a){var c=i[l];o=t.formatVersionList(c),o&&(s[l]=o)}}}),_.size(s)>0&&e.set(e.UIDP.VERSIONS_BY_ENTITY,s)})},formatVersionList:function(e){if(e){var t=_.map(e,function(e){return e.attributes});return _.sortBy(t,function(e){return e.order}).reverse()}},versionsGroupByEntityUUId:function(){return this.versionModel?_.groupBy(this.versionModel.models,function(e){return e.get(e.DP.ENTITY_UUID)}):{}},getSortByAttribute:function(){return i.DP.ENTITY_CLASS},renderTiles:function(e,i,n,s){this.subViewHelper.get(s)&&this.subViewHelper.remove(s),this.sortModels(i,this.getSortByAttribute());var a=new t({el:e,models:i,selectionModel:this.selectionModel});a.render({template:n,attributes:this.getVisualizationAttributes()}),this.subViewHelper.register(s,a)},sortModels:function(e,t){e.sort(function(e,n){var s=$.trim(e.getValue(t)),a=$.trim(n.getValue(t));if(t===i.DP.ENTITY_CLASS){if(e.isLCMFrameworkModule())return-1;if(n.isLCMFrameworkModule())return 1}return s<a?-1:s>a?1:0})},renderViewContents:function(){},getVisualizationAttributes:function(){},getModelsByType:function(e,t,i){return _.filter(e,function(e){if(e.getValue(e.DP.LOCATION_ID)){if(i){var n=e.get(e.UIDP.AVAILABLE_VERSIONS);return n&&n.length&&0===e.getValue(e.DP.LOCATION_ID).indexOf(t)}return 0===e.getValue(e.DP.LOCATION_ID).indexOf(t)}})},groupModelsByType:function(e,t,i){return _.groupBy(this.getModelsByType(e,t,i),function(e){return e.getValue(e.DP.LOCATION_ID).replace(t+":","")})},findModelByEntityClass:function(e){return _.find(this.model.models,function(t){return t.get(t.DP.ENTITY_CLASS)===e})},onClickLinkAction:function(t){var i=$(t.currentTarget),n="true"===i.attr("editMode");if(i.hasClass("lcm-drill-down")&&i.attr(a.NAV_ACTION_TARGET)===a.ENTITY_HOST)this.showDrillDownDetails(i.attr(a.NAV_ACTION_TARGET_ID),n);else if(i.hasClass("close-drill-down-view-link"))i.attr(a.NAV_ACTION)!==a.ACTION_UPDATE?this.hideDrillDownDetails():(this.subViewHelper.get(d.DRILL_DOWN_VIEW).onSave(),this.hideDrillDownDetails()),i.removeAttr(a.NAV_ACTION);else if(i.hasClass("change-selection"))return void this.subViewHelper.get(d.DRILL_DOWN_VIEW).onChangeSelection(i.attr(a.NAV_ACTION_TARGET_ID));e.prototype.onClickLinkAction.apply(this,arguments)},hideDrillDownDetails:function(){this.hideEntityClassDetailsView(),this.subViewHelper.remove(d.DRILL_DOWN_VIEW)},showDrillDownDetails:function(e,t){var i=this.showEntityClassDetailsView(e,t);i&&this.subViewHelper.register(d.DRILL_DOWN_VIEW,i)},getDrillDownDetailsView:function(){return this.subViewHelper.get(d.DRILL_DOWN_VIEW)},showBreadcrumb:function(e,t){this.$(".lcm-breadcrumb").show(),this.$(".close-drill-down-view-link").html(e),this.$(".breadcrumb > .active").html(t)},showTaskStatus:function(e){if(this.$(".error-indicator[data-toggle=tooltip]").tooltip("destroy"),this.currentTask){var t=this,i=_.groupBy(this.getTaskStatus(this.currentTask),function(i,n){var s=t.findEntityClassModelByUUId(n);return s&&s.get(e)});_.each(i,function(t,i){if(i){var n=this.$(".error-indicator["+e+'="'+i+'"]');n&&(n.show(),n.attr("data-toggle","tooltip"),n.html(this.i18n("updateErrorIndicator")))}},this),this.$(".error-indicator[data-toggle=tooltip]").tooltip({title:function(){var n=$(this).attr(e);return t.getTaskStatusMessage(i,n)},placement:"right",trigger:"hover",container:"body",html:!0})}},getTaskStatus:function(e){var t={};if(e&&e.requestList){var i=e.parentTask;if(i&&!i.isStatusComplete()){var n=this.getParentTaskInfo(i,e.subTasks),s=this.getEntityInfoFromTask(e.subTasks);_.each(e.requestList,function(e,i){var a=s[i];a||(a=_.clone(n)),a=_.extend(a,e),t[i]=a},this)}}return t},findSubTaskByType:function(e,t){return _.find(e.models,function(e){return e.get(s.TASK_TYPE)===t})},getEntityInfoFromTask:function(e){var t={};return _.each(e.models,function(e){if(e.get(s.TASK_TYPE)!==a.TASK_OPERATION_LCM.LCM_DOWN_LOAD_TASK){var i=e.get(s.TASK_ENTITY_TYPE),n=e.get(s.TASK_ENTITY_ID);i&&n&&_.each(i,function(i,s){i===a.ENTITY_LCM&&(t[n[s]]=this.getTaskInfo(e))},this)}},this),t},getTaskInfo:function(e){return{taskMessage:e.get(s.SUB_TASK_MESSAGE),progress:e.getPercentageDisplay(),isCompleted:e.isTaskCompleted(),status:e.get(s.TASK_STATUS)}},getParentTaskInfo:function(e,t){var i=this.findSubTaskByType(t,a.TASK_OPERATION_LCM.LCM_DOWN_LOAD_TASK)||this.findSubTaskByType(t,a.TASK_OPERATION_LCM.LCM_PRE_CHECKS_TASK);return i?this.getTaskInfo(i):this.getTaskInfo(e)},getTaskStatusMessage:function(e,t){var i=e[t];return this.getErrorTooltip(i)},getErrorTooltip:function(e){return e?u(this.vtOptions({errorInfo:e})):""},findEntityClassModelByUUId:function(e){return this.model.find(function(t){return t.get(t.DP.UUID)===e||t.getValue(t.UIDP.ENTITY_IDS)&&t.getValue(t.UIDP.ENTITY_IDS).indexOf(e)>=0})}})}),define("text!templates/popups/lcm/LCMNodesPage.html",[],function(){return'<% _.each(nodes, function(node) {%>\n<div class="node-container">\n  <div class="node-name">\n    <%= AppUtil.getSingularEntityName(AppConstants.ENTITY_HOST)%>: <%= node.name %>\n  </div>\n  <div class="lcm-members" data-id="<%= node.uuid %>"></div>\n</div>\n<% }) %>\n'}),define("text!templates/popups/lcm/LCMClustersPage.html",[],function(){return'<% _.each(clusters, function(cluster) {%>\n<div class="node-container">\n  <div class="node-name">\n    <%= AppUtil.getSingularEntityName(AppConstants.ENTITY_CLUSTER)%>: <%= cluster.name %>\n  </div>\n  <div class="lcm-members" data-id="<%= cluster.uuid %>"></div>\n</div>\n<% }) %>\n'}),define("views/popups/lcm/LCMNodesPage",["views/popups/lcm/LCMBaseSubPage","models/lcm/LCMModel","models/query/QueryResultCollection","data/DataProperties","events/AppEvents","managers/ActionManager","utils/AppUtil","utils/AppConstants","utils/FilterUtil","text!templates/popups/lcm/LCMNodesPage.html","text!templates/popups/lcm/LCMClustersPage.html"],function(e,t,i,n,s,a,r,o,l,c,d){"use strict";var u=_.template(c),h=_.template(d),p={SELECT_ALL:"SelectAll",CLEAR_SELECTION:"ClearSelection",SELECT_VERSION:"SelectVersion",RESET_SELECTION:"ResetSelection"};return e.extend({viewByEntityType:o.ENTITY_HOST,selectedList:null,sortByAttribute:t.UIDP.MODEL_DISPLAY_NAME,initialize:function(t){this.editMode=t.editMode||!1,this.previewMode=t.previewMode||!1,e.prototype.initialize.apply(this,arguments),this.tileTemplate=t.tileTemplate,this.visualizationAttributes=t.visualizationAttributes,this.editMode&&(_.bindAll(this,"lcmVersionChanged"),s.onAppEvent(s.ENTITIES_UPDATED,this.lcmVersionChanged),this.selectionModel=t.selectionModel,this.selectedList=[],this.previewMode||this.addExtraEvents({"change .tile-checkbox":"onCheckboxClick","click .lcm-versions":"onClickLinkAction"})),t.populateVersionData&&(this.populateVersionData=t.populateVersionData),this.parents={},this.children={}},initializeModel:function(e){if(this.model)this.initialized=!0;else{e=e||{};var n=[];e.filterAttribute&&n.push(e.filterAttribute);var s={},a=_.last(n);l.addFilterCondition(s,a.attribute,l.createFilterCondition(o.ENTITY_LCM,a.attribute,o.FILTER_OPERATORS.EQUALS,a.value)),this.clusterIds&&l.addFilterConditions(s,o.ENTITY_LCM,t.DP.CLUSTER,this.clusterIds);var r={entityType:t.ENTITY_TYPE,queryType:i.QUERY_TYPES.LCM,entityModel:t,filter_expression:s};e.entity_ids&&(this.entity_ids=e.entity_ids,r.entity_ids=this.entity_ids),a.attribute===t.DP.ENTITY_CLASS&&a.value.toLowerCase()===t.LCM_FRAMEWORK.toLowerCase()&&(this.sortByAttribute=t.DP.MODEL),this.model=new i(null,r),this.initialized=!1}},destroy:function(){s.offAppEvent(s.ENTITIES_UPDATED,this.lcmVersionChanged),e.prototype.destroy.apply(this,arguments)},getVisualizationAttributes:function(){return this.visualizationAttributes},getSortByAttribute:function(){return this.sortByAttribute},renderViewContents:function(){var e=this;this.$el.empty();var i=_.some(this.model.models,function(e){return-1!==e.getValue(e.DP.LOCATION_ID).indexOf(t.LOCATION_PREFIX.NODE)}),n=this.model.models;if(n=this.editMode?this.getModelsWithAvailableUpdates(this.model):this.getModelsWithoutUpdates(this.model),i){var s=this.getModelsByHosts(n,t.LOCATION_PREFIX.NODE);this.$el.html(u(this.vtOptions({nodes:s}))),_.each(s,function(t){e.renderTiles(e.$('.lcm-members[data-id="'+t.uuid+'"]'),t.models,e.tileTemplate,t.uuid)})}else if(this.clusterManager.isMulticlusterNavMode()){var a=this.getModelsGroupByCluster(n),r=_.map(a,function(t,i){return{name:e.clusterManager.getNameById(i)||e.i18n("unknownCluster"),uuid:i}});this.$el.html(h(this.vtOptions({clusters:r}))),_.each(a,function(t,i){var n=e.$('.lcm-members[data-id="'+i+'"]');n&&e.renderTiles(n,t,e.tileTemplate,i)})}else this.renderTiles(this.$el,n,this.tileTemplate,this.LCM_FRAMEWORK);if(this.editMode&&!this.previewMode){this.parents={},this.children={},this.selectedList=[];var o=this.options&&this.options.filterAttribute,l=o&&o.attribute;_.each(this.$(".tile-checkbox"),function(t){var i=$(t).attr("data-id");if($(t).is(":checked")){e.selectedList.push(i);var n=e.model.findModelById(i),s=e.$('.entity-version[data-id="'+i+'"]').attr("version-id");e.selectDependentModels(n,s,l)}}),this.showTaskStatus(t.DP.UUID)}this.previewMode&&(this.$(".tile-checkbox").prop("disabled",!0),this.$(".lcm-versions").hide())},onSave:function(e){var t=[],i=!1;if(_.each(this.$(".tile-checkbox"),function(e){var n=$(e).is(":checked"),s=$(e).attr("data-id"),a=this.$('.entity-version[data-id="'+s+'"]').attr("version-id");if(n){var r=this.model.findModelById(s);this.selectionModel.selectVersionByModel(s,r,a,{silent:!0}),i=!0}else this.selectedList.indexOf(s)>=0&&t.push(s)},this),t.length){var n=this.model.at(0);this.selectionModel.unSelectByUuids(n.get(n.DP.ENTITY_CLASS),t,{silent:!0})&&(i=!0)}i&&this.selectionModel.triggerSelectionChanged()},onChangeSelection:function(e){switch(e){case p.SELECT_ALL:case p.CLEAR_SELECTION:this.selectAll(e===p.SELECT_ALL);break;case p.RESET_SELECTION:this.resetSelection()}},selectAll:function(e){var t=this;_.each(this.$(".tile-checkbox"),function(i){var n=$(i);n.prop("checked",e),e&&t.selectModel(n)}),_.each(this.$(".entity-tile"),function(t){e?$(t).addClass("selected"):$(t).removeClass("selected")}),e||(this.parents={},this.children={})},resetSelection:function(){this.renderViewContents()},onClickLinkAction:function(t){this.clearBaseHeader(),$(t.currentTarget).hasClass("lcm-versions")?a.executeActionElement(t.currentTarget):e.prototype.onClickLinkAction.apply(this,arguments)},lcmVersionChanged:function(e,t){if(e.type===s.ENTITIES_UPDATED&&t.entityType===o.ENTITY_LCM_VERSION){var i=t.entity,n=i.getValue(i.DP.ENTITY_UUID),a=this.getCheckBoxElement(n),r=i.get(i.DP.DEPENDENCIES)||[],l=i.get(i.DP.VERSION),c=this.$('.entity-version[data-id="'+n+'"]'),d=c.attr("version-id");a.is(":checked")&&d!==l&&this.unSelectModel(a),this.onVersionChanged(l,n,r)}},refreshSelectVersion:function(e,t,i){this.$('.entity-version[data-id="'+e+'"]').attr("version-id",t),this.$('.to-version-label[data-id="'+e+'"]').html(this.i18nsStatic("LCMTileView","UpdatingTo",t)),this.$('.to-version-label[data-id="'+e+'"]').attr("title",t),this.$('.lcm-versions[actiontargetid="'+e+'"]').attr(o.NAV_ACTION_TARGET_NAME,t);var n=this.$('.entity-dependency[data-id="'+e+'"]'),s=this.$('.depend-tooltip[data-id="'+e+'"]');s.removeClass("has-dependency no-dependency");var a=r.pluralize("LCMTileView","dependencyFound","No dependencies found","%d dependency found","%d dependencies found",i);n.html(a),s.addClass(i?"has-dependency":"no-dependency"),s.attr("version-id",t)},onVersionChanged:function(e,t,i){this.refreshSelectVersion(t,e,i.length);var n=this.getCheckBoxElement(t);n.prop("checked",!0),this.selectModel(n)},onCheckboxClick:function(e){this.clearBaseHeader();var t=$(e.currentTarget);t.is(":checked")?(this.selectModel(t),t.attr("manual",!0)):(t.removeAttr("manual"),this.unSelectModel(t))},selectModel:function(e){var t=e.attr("data-id"),i=this.model.findModelById(t);this.$('.entity-tile[data-id="'+t+'"]').addClass("selected");var n=this.$('.entity-version[data-id="'+t+'"]').attr("version-id"),s=this.options&&this.options.filterAttribute,a=s&&s.attribute;this.selectDependentModels(i,n,a)},unSelectModel:function(e){var t=e.attr("data-id"),i=this.$('.entity-tile[data-id="'+t+'"]'),n=this.model.findModelById(t);i.removeClass("selected"),this.unSelectModelWithDependentModel(n),this.unSelectDependentModels(n)},findDependentModelIdsByModel:function(e,t,i){var n=this,s=[],a=e&&e.findDependenciesByVersion(t);if(_.size(a||[])){var r;i&&(r=e.getValue(i));var l=e.get(e.DP.LOCATION_ID);return _.each(a,function(t){if(!r||t[i]===r){var a=!0===t.exact||t.exact===o.BOOLEAN_TRUE;s=s.concat(n.findDependentModelIds(t[e.DP.ENTITY_CLASS],t[e.DP.MODEL],t[e.DP.VERSION],a,l))}}),s}},selectDependentModels:function(e,t,i){var n=this,s=this.findDependentModelIdsByModel(e,t,i);_.each(s,function(t){var s=t.uuid,a=t.version,r=t.exact,o=n.model.findModelById(s);if(o){var l=n.$('.entity-version[data-id="'+s+'"]').attr("version-id");if(a.version!==l){var c=parseInt(a.order,10);if(r||!c)n.onVersionChanged(a.version,s,a[e.UIDP.DEPENDENCY_LIST]);else{var d=o.get(e.UIDP.AVAILABLE_VERSIONS),u=n.findVersionOrder(d,l);(!u||c>u)&&n.onVersionChanged(a.version,s,a[e.UIDP.DEPENDENCY_LIST])}}var h=n.getCheckBoxElement(s);h.is(":checked")||(h.prop("checked",!0),n.$('.entity-tile[data-id="'+s+'"]').addClass("selected"));var p=n.parents[s];p||(p=[],n.parents[s]=p),_.contains(p,e.getId())||(p.push(e.getId()),n.selectDependentModels(o,a.version,i));var T=n.children[e.getId()];T||(T=[],n.children[e.getId()]=T),_.contains(T,s)||T.push(s)}})},unSelectModelWithDependentModel:function(e){var t=this;if(e){var i=e.getId(),n=this.parents[e.getId()];n&&(delete this.parents[e.getId()],_.each(n,function(e){var n=t.getCheckBoxElement(e);(i===e||n.is(":checked"))&&(n.prop("checked",!1).removeAttr("manual"),t.unSelectModel(n))}))}},unSelectDependentModels:function(e){var t=this;if(e){var i=e.getId(),n=this.children[e.getId()];n&&(delete this.children[e.getId()],_.each(n,function(n){var s=t.parents[n];if(s){var a=s.indexOf(e.getId());s.splice(a,1)}if(!s||!_.size(s)){s&&delete t.parents[n];var r=t.getCheckBoxElement(n);r.attr("manual")||i!==n&&!r.is(":checked")||(r.prop("checked",!1),t.unSelectModel(r))}}))}},findDependentModelIds:function(e,t,i,n,s){var a=[];return _.each(this.model.models,function(r){if(e===r.get(r.DP.ENTITY_CLASS)&&t===r.get(r.DP.MODEL)&&(!s||s===r.get(r.DP.LOCATION_ID))){var o=r.get(r.UIDP.AVAILABLE_VERSIONS),l=_.find(o,function(e){return e.version===i});l?a.push({uuid:r.get(r.DP.UUID),version:l,exact:n}):n||(l=_.first(o),a.push({uuid:r.get(r.DP.UUID),version:l,exact:n}))}}),a},getModelsByHosts:function(e,t){var i=0,s=_.map(this.groupModelsByType(e,t,this.editMode),function(e,t){var s=this.hostCollection.findModelByUuid(t),a=s?s.get(n.NAME):r.getSingularEntityName(o.ENTITY_NODE)+" "+ ++i;if(this.clusterManager.isMulticlusterNavMode()){var l=_.first(e);a=a+" ("+(this.clusterManager.getNameById(l.get(l.DP.CLUSTER))||this.i18n("unknownCluster"))+") "}return{uuid:t,name:a,models:e}},this);return s=_.sortBy(s,function(e){return e.name})},getModelsWithAvailableUpdates:function(e){return _.filter(e.models,function(e){var t=e.get(e.UIDP.VERSIONS_BY_ENTITY);return t&&_.size(t)})},getModelsWithoutUpdates:function(e){return _.filter(e.models,function(e){var t=e.get(e.UIDP.VERSIONS_BY_ENTITY);return!t||_.size(t)<=0})},getModelsGroupByCluster:function(e){var t=this.clusterManager;return _.groupBy(e,function(e){return e.get(e.DP.CLUSTER)||t.getPrismCentralClusterUuid()},this)},getCheckBoxElement:function(e){return this.$('.tile-checkbox[data-id="'+e+'"]')},findVersionOrder:function(e,t){var i=_.find(e,function(e){return e.version===t});if(i)return parseInt(i.order,10)}})}),define("models/lcm/LCMSelectionCollection",["backbone","events/AppEvents","utils/AppConstants"],function(e,t,i){"use strict";var n={ID:"id",ENTITY_CLASS:"entity_class",ENTITY_MODEL:"entity_model",LOCATION_ID:"location_id",UUID:"uuid",VERSION:"version",SELECTED:"selected",ENTITY_IDS:"entity_ids",DEPENDENCIES:"dependencies",LOCATION:"location",REQUEST_LIST:"request_list",PLAN_MESSAGE:"plan_message",VERSIONS_BY_ENTITY:"versions_by_entity",VERSIONS:"versions"},s={ALL:"Update All",REQUIRED:"Update Required",SELECTED:"Update Selected"},a="_ALL",r=e.Model.extend({idAttribute:n.ID});return e.Collection.extend({model:r,name:"LCMSelectionCollection",DP:n,ALL:a,DEFAULT_UPDATE_VERSION:"_lcm_defalut_update_version_",planMessage:null,entityModelCollection:null,setEntityModel:function(e){this.entityModelCollection=e},selectVersionByModel:function(e,n,s,a){var r;r=e===this.ALL?this.findDependenciesByModel(e,n):this.findDependenciesByModel(e,n,s);var o=n.get(n.DP.ENTITY_CLASS),l=this.findModelByEntityClass(e,n.get(n.DP.ENTITY_CLASS)),c={uuid:e,entity_class:o,id:e+"-"+o,selected:!0,location:e===this.ALL?this.ALL:n.get(n.DP.LOCATION_ID),version:s,dependencies:r,entity_ids:n.getValue(n.UIDP.ENTITY_IDS),versions_by_entity:n.get(n.UIDP.VERSIONS_BY_ENTITY),versions:n.getValue(n.UIDP.VERSIONS)};l?l.set(c):this.add(c,a),(a||{}).silent||(this.trigger("changed",this),t.triggerAppEvent(t.ENTITIES_CREATED,{entityType:i.ENTITY_LCM_VERSION,entity:this}))},unSelectVersion:function(e,t,i){var s=this.findModelByEntityClass(t,e);return s?t===a?this.remove(s):s.set(n.SELECTED,!1):t!==a&&(s=this.add({uuid:t,id:t+"-"+e,entity_class:e,selected:!1})),s&&!(i||{}).silent&&this.triggerSelectionChanged(),s},triggerSelectionChanged:function(){this.trigger("changed",this),t.triggerAppEvent(t.ENTITIES_DELETED,{entityType:i.ENTITY_LCM_VERSION,entity:this})},selectAll:function(e,t){this.selectVersionByModel(this.ALL,e,"_lcm_defalut_update_version_",t)},unSelectAll:function(e,t,i){var n=this.findModelByEntityClass(this.ALL,t);if(n)this.remove(n),(i||{}).silent||this.triggerSelectionChanged();else{var s=e.getValue(e.UIDP.ENTITY_IDS);s&&this.unSelectByUuids(t,s,i)}},unSelectByUuids:function(e,t,i){if(t&&t.length){var s=this.findModelByEntityClass(a,e),r=!1,o=!1;if(s&&s.get(n.SELECTED)){var l=s.get(n.VERSIONS_BY_ENTITY);if(_.size(l)===t.length)r=!0;else{var c=this.findCustomDefinedModels(e,!0);r=!c||c.length}r&&(this.remove(s),o=!0)}else r=!0;return _.each(t,function(t){var i=this.findModelByEntityClass(t,e);r?(this.remove(i),o=!0):this.unSelectVersion(e,t,{silent:!0})&&(o=!0)},this),o&&!(i||{}).silent&&this.triggerSelectionChanged(),o}},hasEmptySelection:function(){return!_.some(this.models,function(e){return e.get(n.SELECTED)})},hasCustomDefinedSelection:function(e){return _.some(this.models,function(t){return t.get(n.ENTITY_CLASS)===e&&t.get(n.UUID)!==a})},isSelectedByEntityClass:function(e,t,i){var s=this.findModelByAttribute(e,null,n.UUID,t)||this.findModelByAttribute(e,!0,n.UUID,a);if(s){var r=s.get(n.SELECTED);if(r&&i){var o=s.get(n.VERSION);return"_lcm_defalut_update_version_"===o||o===i}return r}return!1},getSelectedVersionEntityClass:function(e,t){var i=this.findModelByAttribute(e,!0,n.UUID,t)||this.findModelByAttribute(e,!0,n.UUID,a);if(i)return i.get(n.VERSION)},getSelectedCount:function(e){var t=this.findModelByAttribute(e,!0,n.UUID,a);if(t){var i=this.findCustomDefinedModels(e,!1),s=t.get(n.VERSIONS_BY_ENTITY);return(s?_.size(s):0)-i.length}return this.findCustomDefinedModels(e,!0).length},getAllDependentEntitiesByClassModelAndVersion:function(){var e=[];return _.each(this.models,function(t){if(t.get(n.SELECTED)){var i=t.get(n.DEPENDENCIES);_.each(i,function(i){e.push({dependencies:i,uuid:t.get(n.UUID),entity_class:t.get(n.ENTITY_CLASS),location:t.get(n.LOCATION)})})}}),_.groupBy(e,function(e){var t=e[n.DEPENDENCIES];return t[n.ENTITY_CLASS]+"-"+t[n.ENTITY_MODEL]+"-"+t[n.VERSION]})},isSelectedByDependency:function(e,t,i,s){return _.some(this.models,function(r){if(r.get(n.SELECTED)){if(s&&r.get(n.LOCATION)!==a&&r.get(n.LOCATION)!==s)return!1;var o=r.get(n.DEPENDENCIES);return _.some(o,function(s){var a=s[n.VERSION];return s[n.ENTITY_CLASS]===e&&t.indexOf(s[n.ENTITY_MODEL])>=0&&_.some(i,function(e){return a!==e})})}},this)},getSelectedDependentVersion:function(e,t){
var i=null,s=t.get(t.DP.LOCATION_ID),r=t.get(t.UIDP.AVAILABLE_VERSIONS),o=t.getValue(t.DP.MODEL);return _.some(this.models,function(t){if(t.get(n.SELECTED)){if(s&&t.get(n.LOCATION)!==a&&t.get(n.LOCATION)!==s)return!1;var l=t.get(n.DEPENDENCIES);_.some(l,function(t){if(t[n.ENTITY_CLASS]===e&&o===t[n.ENTITY_MODEL]){if(_.find(r,function(e){return e.version===t[n.VERSION]}))return i=t[n.VERSION],!0}})}},this),i},getSelectionsList:function(e){var t=[];return _.each(this.models,function(i){i.get(n.SELECTED)&&i.get(n.UUID)===a?_.each(i.get(n.ENTITY_IDS),function(s){if(!this.findModelByUUId(s)){var a=i.get(n.VERSIONS_BY_ENTITY);if(a&&a[s]){var r=e(a[s]);t.push([s,r.version])}}},this):i.get(n.SELECTED)&&t.push([i.get(n.UUID),i.get(n.VERSION)])},this),t},findModelByUUId:function(e){return this.find(function(t){return t.get(n.UUID)===e})},findModelByEntityClass:function(e,t){return this.find(function(i){return i.get(n.ID)===e+"-"+t})},getSelectionsByEntityClass:function(){return _.groupBy(this.models,function(e){return e.get(n.ENTITY_CLASS)})},findModelByAttribute:function(e,t,i,s){return _.find(this.models,function(a){var r;return r=null===t?a.get(n.ENTITY_CLASS)===e:a.get(n.SELECTED)===t&&a.get(n.ENTITY_CLASS)===e,r&&i?a.get(i)===s:r})},findCustomDefinedModels:function(e,t,i){return _.filter(this.models,function(s){return s.get(n.ENTITY_CLASS)===e&&(i||s.get(n.UUID)!==a)&&s.get(n.SELECTED)===t})},setUpdatePlan:function(e){this.updatePlan=e},getUpdatePlan:function(){return this.updatePlan},findDependenciesByModel:function(e,t,i){var s=[];return e===this.ALL?this.appendChildDependencies(s,t.findDependenciesByEntityClass(),null):this.appendChildDependencies(s,t.findDependenciesByVersion(i),t.get(n.LOCATION_ID)),t.toUniqueDependencies(s)},appendChildDependencies:function(e,t,i){_.size(t)&&(Array.prototype.push.apply(e,t),_.each(t,function(t){var s=t[n.ENTITY_CLASS],a=this.findEntityModelByEntityClass(s);if(a){var r=a.findChildDependenciesByLocation(t,i);_.size(r||[])&&this.appendChildDependencies(e,r)}},this))},findEntityModelByEntityClass:function(e){return _.find(this.entityModelCollection.models,function(t){var i=t.get(t.UIDP.VERSIONS_BY_ENTITY);return i&&_.size(i)&&t.get(t.DP.ENTITY_CLASS)===e})}},{DP:n,ALL:a,SELECT_MODES:s})}),define("text!templates/popups/lcm/LCMAvailableUpdatePage.html",[],function(){return'<div>\n  <% if (previewMode) { %>\n    <div class="update-plan">\n      <ul class="plan-message">\n        \x3c!--Plan messages--\x3e\n      </ul>\n      <div class="n-popup-title n-lcm-plan-footer">\n        <%= i18n(\'planFooterMsg\') %>\n      </div>\n      <div class="n-popup-title">\n        <%= i18n(\'updateLabel\') %>\n      </div>\n    </div>\n  <% } %>\n  <div class="lcm-breadcrumb" style="display: none">\n    <div class="update-breadcrumb">\n      <ol class="breadcrumb" >\n        <li action="details" actionTarget="cluster">\n          <a class="close-drill-down-view-link"\n             data-test="close-drill-down-view">\n          </a>\n        </li>\n        <li class="active"></li>\n      </ol>\n    </div>\n    <% if (!previewMode) { %>\n      <div class="dropdown dropdown-menu-right lcm-btn-group lcm-drill-down-btn-group">\n        <a data-toggle="dropdown"\n           class="btn btn-default dropdown-toggle"\n           data-test="selection-dropdown"\n           action="changeSelection" actionTargetId="SelectAll">\n          <%= i18n(\'select\') %>\n          <%= Components.icon(\'z\', \'-down-arrow\') %>\n        </a>\n        <ul class="dropdown-menu dropdown-menu-right" role="menu">\n          <li>\n            <a class="change-selection"\n               data-test="select-all-selection"\n               action="changeSelection" actionTargetId="SelectAll">\n              <%= i18n(\'selectAll\') %>\n            </a>\n          </li>\n          <li class="divider"></li>\n          <li>\n            <a class="change-selection"\n               data-test="clear-selections"\n               action="changeSelection" actionTargetId="ClearSelection">\n              <%= i18n(\'clearSelections\') %>\n            </a>\n          </li>\n          <li>\n            <a class="change-selection"\n               data-test="reset-selection"\n               action="changeSelection" actionTargetId="ResetSelection">\n              <%= i18n(\'resetSelections\') %>\n            </a>\n          </li>\n        </ul>\n      </div>\n    <% } %>\n  </div>\n  <% if (previewMode) { %>\n    <div class="lcm-members update-preview-nodes parent-nodes"></div>\n  <% } else { %>\n    \x3c!--Show available update nodes by versions status --\x3e\n    <%  _.each(updateVersionsStatus, function (status) {\n      if (modelMaps[status] && _.size(modelMaps[status])) {\n    %>\n      <div class="node-container lcm-available-updates parent-nodes">\n        <div class="node-name"><%= i18n(status, status) %></div>\n        <div class="lcm-members" data-id="<%= status %>"></div>\n      </div>\n    <% } }) %>\n  <% } %>\n  <div class="lcm-members lcm-nodes child-nodes" style="display:none"></div>\n</div>'}),define("text!templates/popups/lcm/LCMAvailableUpdateTile.html",[],function(){return'<div class="tile-header">\n  <div class="entity-name">\n    <%= Components.checkbox({\n      jsClasses :\'tile-checkbox -blue\',\n      type: \'default\',\n      attributes:\'data-id="\' + model[model.DP.UUID]+\'"\',\n      labelText: model[model.DP.ENTITY_CLASS],\n      dataTestAttribute : \'entity-class-\' + model[model.DP.UUID]\n    })%>\n  </div>\n  <div class="badge -red">\n    <%= model[model.UIDP.UPDATE_COUNTS] %>\n  </div>\n</div>\n<div class="tile-body">\n  <div>\n    <%= i18n(\'update\') %>\n    <span class="selected-entity-count" data-id="<%= model[model.DP.UUID]%>" style="display:none">\n    </span>\n    <%= model[model.UIDP.UPDATE_COUNTS] %> <%= model[model.UIDP.UPDATE_COUNTS] === 1 ? i18n(\'entity\') : i18n(\'entities\') %>\n    <%= model[model.UIDP.CLUSTER_WITH_UPGRADE] %>\n    <span class="error-indicator" <%= model.DP.ENTITY_CLASS %>="<%= model[model.DP.ENTITY_CLASS] %>">\n    </span>\n  </div>\n  <div> <%= model[model.UIDP.LAST_UPDATED_TIME] %></div>\n  <div>\n    <a class="lcm-drill-down lcm-see-all"\n       actiontargetid="<%= model[model.DP.ENTITY_CLASS] %>"\n       actiontarget="host" action="showSubView" editMode="true"\n       actionParentId="<%= model[model.DP.CLUSTER] %>"\n       view="update"\n       data-test="lcm-see-all"\n       stream-action="LCM:select"\n       stream-target="Define Selection">\n      <%= i18n(\'edit\') %>\n    </a>\n  </div>\n</div>'}),define("text!templates/popups/lcm/LCMUpdateDrillDownTile.html",[],function(){return'<div class="tile-header">\n  <div class="entity-name">\n    <%= Components.checkbox({\n    jsClasses :\'tile-checkbox -blue\',\n    type: \'default\',\n    attributes:\'data-id="\' + model[model.DP.UUID]+\'"\',\n    checked: model.checked || false,\n    labelText: model[model.UIDP.MODEL_DISPLAY_NAME],\n    dataTestAttribute: \'entity-uuid-\' + model[model.DP.UUID]\n    })%>\n  </div>\n</div>\n<div class="tile-body">\n  <div class="version-label" title="<%= model[model.DP.VERSION] || i18n(\'n_a\') %>">\n    <%= i18n(\'installedVersion\') %>: <%= model[model.DP.VERSION] || i18n(\'n_a\') %>\n  </div>\n  <div class="entity-version"\n       data-id="<%= model[model.DP.UUID] %>"\n       version-id="<%= model[model.UIDP.SELECTED_VERSION]%>">\n    <span>\n      <div class="to-version-label version-label"\n           title="<%=  model[model.UIDP.SELECTED_VERSION] %>"\n           data-id="<%= model[model.DP.UUID] %>">\n        <%= i18ns(\'UpdatingTo\', model[model.UIDP.SELECTED_VERSION]) %>\n      </div>\n      <span class="error-indicator" <%= model.DP.UUID %>="<%= model[model.DP.UUID] %>">\n      </span>\n    </span>\n    <a class="lcm-versions" action="show"\n       actiontarget="lcm_available_version"\n       actiontargetid="<%= model[model.DP.UUID] %>"\n       actionTargetName="<%= model[model.UIDP.SELECTED_VERSION]%>"\n       data-test="show-lcm-available-version"\n       stream-action="LCM:select"\n       stream-target="Select Version">\n      Change\n    </a>\n  </div>\n</div>\n<div class="tile-footer">\n  <div class="entity-footer entity-dependency" data-id="<%= model[model.DP.UUID] %>">\n    <%=\n    AppUtil.pluralize(\'LCMTileView\', \'dependencyFound\',\n    \'No dependencies found\', \'%d dependency found\',\n    \'%d dependencies found\', model[model.UIDP.DEPENDENCY_LIST].length)\n    %>\n  </div>\n  <span class="depend-tooltip <%= model[model.UIDP.DEPENDENCY_LIST].length ? \'has-dependency\' : \'no-dependency\' %>"\n        data-toggle="tooltip"\n        data-id="<%= model[model.DP.UUID] %>"\n        version-id="<%= model[model.UIDP.SELECTED_VERSION] %>">\n    <%= Components.icon("information-tooltip", "-regular -inline") %>\n  </span>\n</div>'}),define("text!templates/popups/lcm/LCMInventoryTileView.html",[],function(){return'<div class="tile-header">\n  <div class="entity-name">\n    <%= model[model.DP.ENTITY_CLASS] %>\n  </div>\n</div>\n<div class="tile-body">\n  <div class="entity-description" title="<%= model[model.UIDP.ENTITY_COUNTS] %> Entities">\n    <%= model[model.UIDP.ENTITY_COUNTS_WITHOUT_UPGRADE] %> <%= model[model.UIDP.ENTITY_COUNTS_WITHOUT_UPGRADE] === 1 ? i18n(\'entity\') : i18n(\'entities\') %>\n    <%= model[model.UIDP.CLUSTER_WITHOUT_UPGRADE] %>\n  </div>\n  <div> <%= model[model.UIDP.LAST_UPDATED_TIME] %></div>\n  <div>\n    <a class="lcm-drill-down"\n       action="showSubView" actiontarget="host"\n       view="inventory"\n       data-test="see-all-inventory"\n       actiontargetid="<%= model[model.DP.ENTITY_CLASS] %>" editMode="false">\n      <%= i18n(\'seeAll\') %>\n    </a>\n  </div>\n</div>'}),define("text!templates/popups/lcm/LCMInventoryDrillDownTile.html",[],function(){return'<div class="tile-header">\n  <div class="entity-name">\n    <%= model[model.UIDP.MODEL_DISPLAY_NAME] %>\n  </div>\n</div>\n<div class="tile-body">\n  <div class="version-label" title="<%= model[model.DP.VERSION] || i18n(\'n_a\') %>">\n    <%= i18n(\'installedVersion\') %>: <%= model[model.DP.VERSION] || i18n(\'n_a\') %>\n  </div>\n  <div>\n    <%= model[model.UIDP.UPDATED_ON] %>\n  </div>\n</div>'}),define("text!templates/popups/lcm/PopoverGPUList.html",[],function(){return'<div class="gpu-list">\n  <table class="table">\n    <thead>\n    <tr>\n      <th><%= vmLabel %></th>\n      <th><%= nodeLabel %></th>\n    </tr>\n    </thead>\n    <tbody>\n    <% _.each(vms, function(vm, index){ %>\n    <tr>\n      <td>\n        <%= vm.vm_name %>\n      </td>\n      <td>\n        <%= vm.node_name%>\n      </td>\n    </tr>\n    <% }) %>\n    </tbody>\n  </table>\n</div>'}),define("views/popups/lcm/LCMAvailableUpdatePage",["backbone","views/popups/lcm/LCMBaseSubPage","views/popups/lcm/LCMNodesPage","models/lcm/LCMModel","models/lcm/LCMSelectionCollection","data/DataProperties","managers/TaskManager","utils/AppUtil","utils/AppConstants","utils/GpuUtil","text!templates/popups/lcm/LCMAvailableUpdatePage.html","text!templates/popups/lcm/LCMAvailableUpdateTile.html","text!templates/popups/lcm/LCMUpdateDrillDownTile.html","text!templates/popups/lcm/LCMInventoryTileView.html","text!templates/popups/lcm/LCMInventoryDrillDownTile.html","text!templates/popups/lcm/PopoverGPUList.html"],function(e,t,i,n,s,a,r,o,l,c,d,u,h,p,T,E){"use strict";var g=_.template(d),S=_.template(u),m=_.template(h),v=_.template(p),f=_.template(T),A=_.template(E),y=["reboot_host","boot_into_phoenix"],C=["Required","Available","Recent"],I=_.template('<a class="n-plan-warning-popover" data-toggle="popover"><%= cnt %> <%= label %></a>'),b=_.template('<li class="divider"></li><li> <%= i18ns("UserVMGPUWarningMsg." + key, popoverLink) %></li>'),R={UPDATE:[n.DP.UUID,n.UIDP.MODEL_DISPLAY_NAME,n.DP.VERSION,n.UIDP.CHECKED,n.UIDP.SELECTED_VERSION,n.UIDP.DEPENDENCY_LIST],INVENTORY:[n.DP.UUID,n.UIDP.MODEL_DISPLAY_NAME,n.DP.VERSION,n.UIDP.UPDATED_ON]};return t.extend({viewByEntityType:l.ENTITY_LCM_VERSION,modelEvents:{"changed selectionModel":"onModelSelectionChanged"},selectionModel:null,selectionChanged:!1,previewMode:!1,VIEW_MODE:null,initialize:function(e){t.prototype.initialize.apply(this,arguments),this.VIEW_MODE=e.VIEW_MODE,e&&e.selectionModel?(this.selectionModel=e.selectionModel,this.delegateModelEvents()):(this.selectionModel=null,this.addExtraEvents({"change .parent-nodes .tile-checkbox":"onTilCheckboxClick","click .change-selection":"onClickLinkAction"}))},initializeModel:function(e){if(t.prototype.initializeModel.apply(this,arguments),this.nonLiveMigratableVMs=null,e&&e.selectionModel){var i=[],n=e.selectionModel,s=n.getUpdatePlan();s&&(i=this._getAHVNodeUUids(s[n.DP.PLAN_MESSAGE])),_.size(i)&&(this.nonLiveMigratableVMs=c.nonLiveMigratablePoweredOnUserVms(l.HYPERVISOR_TYPE.KVM,i))}},isModelInitialized:function(){return!this._loadNonLiveMigratableVMs()&&t.prototype.isModelInitialized.apply(this,arguments)},loadData:function(){var e=this;this._loadNonLiveMigratableVMs()?this.nonLiveMigratableVMs.fetch().always(function(){e.render()}):t.prototype.loadData.apply(this,arguments)},destroy:function(){this.undelegateModelEvents(),this.nonLiveMigratableVMs&&this.nonLiveMigratableVMs.length&&this.$(".n-plan-warning-popover").popover("destroy"),t.prototype.destroy.apply(this,arguments)},getVisualizationAttributes:function(){return[n.DP.UUID,n.DP.ENTITY_CLASS,n.UIDP.UPDATE_COUNTS,n.UIDP.ENTITY_COUNTS,n.UIDP.ENTITY_COUNTS_WITHOUT_UPGRADE,n.UIDP.CLUSTER_WITH_UPGRADE,n.UIDP.CLUSTER_WITHOUT_UPGRADE,n.UIDP.LAST_UPDATED_TIME]},renderViewContents:function(){if(this.isModelInitialized()){this.previewMode=!1;var e;this.selectionModel?(e=this.getPreviewModels(),this.previewMode=!0):e=this.model.models,e.length?this.renderAvailableUpdates(this.previewMode,e):this.$el.html(this.i18n("noUpdatesAvailable")),this.showTaskStatus(n.DP.ENTITY_CLASS)}else this.$el.html(this.i18n("loading"));return this},renderAvailableUpdates:function(e,t){var i=e?{}:this.getModelsByVersions(this.getAvailableUpdateModels());e||(i.Recent=this.getModelsWithoutVersions()),this.$el.html(g(this.vtOptions({modelMaps:i,updateVersionsStatus:C,previewMode:e}))),e?(this.showPlanMessages(),this.renderTiles(this.$(".update-preview-nodes"),t,S,this.VIEW_TYPES.UPDATE_PREVIEW_VIEW)):(_.each(i,function(e,t){if(_.size(e)){var i=S;"Recent"===t&&(i=v),this.renderTiles(this.$('.lcm-members[data-id="'+t+'"]'),e,i,t)}else this.$('.lcm-members[data-id="'+t+'"]').hide()},this),r.getGlobalTasks().hasActiveUpgradeTasks()&&(this.$(".tile-checkbox").attr("disabled",!0),this.$(".lcm-see-all").addClass("disabled"))),e?(this.refreshViewBySelections(),this.refreshViewByDependencies(),this.$(".tile-checkbox").prop("disabled",!0),this.$(".lcm-see-all").text(this.i18n("seeAll")).attr("view","preview"),this.$(".badge").hide()):(this.selectionModel=new s,this.selectionModel.setEntityModel(this.model),this.delegateModelEvents())},getAvailableUpdateModels:function(){return _.filter(this.model.models,function(e){var t=e.get(e.UIDP.VERSIONS_BY_ENTITY);return t&&_.size(t)},this)},getPreviewModels:function(){return _.filter(this.model.models,function(e){var t=e.get(e.DP.ENTITY_CLASS);return e.get(e.UIDP.VERSIONS_BY_ENTITY)&&this.selectionModel.getSelectedCount(t)>0||this.selectionModel.isSelectedByDependency(t,e.getValue(e.UIDP.ENTITY_MODELS),e.getValue(e.UIDP.VERSIONS))},this)},refreshView:function(){this.selectionChanged&&(this.resetAllTiles(),this.refreshViewBySelections(),this.refreshViewByDependencies()),this.selectionChanged=!1},resetAllTiles:function(){_.each(this.$(".tile-checkbox"),function(e){$(e).prop("checked",!1).removeAttr("parent")}),_.each(this.$(".entity-tile"),function(e){$(e).removeClass("selected")}),_.each(this.$(".selected-entity-count"),function(e){$(e).hide()})},refreshViewBySelections:function(){var e=this.selectionModel.getSelectionsByEntityClass();_.each(e,function(e,t){var i=this.selectionModel.getSelectedCount(t),n=this.findModelByEntityClass(t);if(n){var s=this.$('.entity-tile[data-id="'+n.getId()+'"]');i>0&&(this.$('.tile-checkbox[data-id="'+n.getId()+'"]').prop("checked",!0),s.addClass("selected"));var a=n.getValue(n.UIDP.UPDATE_COUNTS),r=this.$('.selected-entity-count[data-id="'+n.getId()+'"]');i>0&&i!==a&&(r.show(),r.html(i+"/"))}},this)},getAllDependentEntitiesInfo:function(){var e=this.selectionModel.getAllDependentEntitiesByClassModelAndVersion(),t=this.selectionModel.DP,i=this.selectionModel.ALL,n={};return _.each(e,function(e){var s=_.first(e),a=s[t.DEPENDENCIES],r=a[t.ENTITY_CLASS],o=a[t.ENTITY_MODEL],l=null;if(this.selectionModel.isSelectedByEntityClass(r,i)||(l=this.findModelByEntityClass(r)),l){var c=l.getId();n[c]||(n[c]=[]);var d=_.some(e,function(e){return e[t.LOCATION]===i});if(!d){var u=this.selectionModel.findModelByAttribute(r,!0,t.UUID,i);d=u&&u.get(t.SELECTED)}var h=[],p=!1;if(d?s[t.ENTITY_CLASS]===r?p=d:(h=h.concat(this.findDependentModelIds(r,o,i)),p=_.unique(h).length===l.getValue(l.UIDP.UPDATE_COUNTS)):_.each(e,function(e){h=h.concat(this.findDependentModelIds(r,o,e[t.LOCATION]))},this),!p){var T=this.selectionModel.findCustomDefinedModels(r,!0);_.each(T,function(e){h.push(e.get(t.UUID))},this)}var E={parentEntityClass:s[t.ENTITY_CLASS],entityIds:_.unique(h),selectAll:p};n[c].push(E)}},this),n},refreshViewByDependencies:function(){var e=this.getAllDependentEntitiesInfo();_.each(e,function(e,t){var i=this.$('.selected-entity-count[data-id="'+t+'"]');if(_.some(e,function(e){return e.selectAll}))this.selectDependentModels(t,e),i.html(""),i.hide();else{var n=[];_.each(e,function(e){n=n.concat(e.entityIds)}),n=_.unique(n),n.length?(i.html(n.length+"/"),i.show(),this.selectDependentModels(t,e)):(i.html(""),i.hide())}},this)},selectDependentModels:function(e,t){_.each(t,function(t){this.selectDependentModel(e,t.parentEntityClass)},this)},selectDependentModel:function(e,t){var i=this.$('.tile-checkbox[data-id="'+e+'"]');this.$('.entity-tile[data-id="'+e+'"]').addClass("selected");var n=this.findModelByEntityClass(t);n&&i.prop("checked",!0).attr("parent",n.get(n.DP.ENTITY_CLASS))},onModelSelectionChanged:function(e){this.selectionChanged=!0},onTilCheckboxClick:function(e){this.clearBaseHeader();var t=$(e.currentTarget),i=t.is(":checked"),n=(t.parents(".entity-tile"),t.attr("data-id")),s=t.attr("parent"),a=this.model.findModelById(n);if(i)this.selectionModel.selectAll(a);else{if(s){var r=this.findModelByEntityClass(s);this.selectionModel.unSelectAll(r,s,{silent:!0})}this.selectionModel.unSelectAll(a,a.get(a.DP.ENTITY_CLASS))}this.selectionChanged=!0,this.refreshView()},hideEntityClassDetailsView:function(){this.$(".parent-nodes").show(),this.$(".child-nodes").hide(),this.$(".lcm-breadcrumb").hide(),this.refreshView()},showEntityClassDetailsView:function(e,t){var s=m,a=R.UPDATE;t||(s=f,a=R.INVENTORY),this.$(".parent-nodes").hide(),this.$(".child-nodes").show();var r=new i({el:this.$(".child-nodes"),editMode:t,previewMode:this.previewMode,hostCollection:this.hostCollection,versionModel:this.versionModel,selectionModel:this.selectionModel,tileTemplate:s,visualizationAttributes:a,filterAttribute:{attribute:n.DP.ENTITY_CLASS,value:e},clusterIds:this.clusterIds});this.currentTask&&r.setCurrentTask(this.currentTask),r.setParentView(this),this.showBreadcrumb(this.i18n("allUpdates"),e);var o=this.VIEW_MODE.UPDATE_VIEW;return this.previewMode&&(o=this.VIEW_MODE.PREVIEW_VIEW),this.$(".close-drill-down-view-link").attr("parentView",o),this.previewMode||this.$(".lcm-drill-down-btn-group").toggle(t),r.render(),r},getModelsByVersions:function(e){var t=this;return _.groupBy(e,function(e){return t.getUpdateVersionStatus(e)})},getModelsWithoutVersions:function(){return _.filter(this.model.models,function(e){var t=e.get(e.UIDP.ENTITIES),i=e.get(e.UIDP.VERSIONS_BY_ENTITY);return!i||_.size(i)<=0||_.size(t)!==_.size(i)},this)},getUpdateVersionStatus:function(e){var t=e.get(e.UIDP.VERSIONS_BY_ENTITY),i=[];return _.each(t,function(e){var t=n.findVersionByHierarchy(e);i&&i.push(t)}),_.some(i,function(e){return e.status===n.VERSION_HIERARCHY[0]||e.status===n.VERSION_HIERARCHY[1]})?C[0]:C[1]},findModelByEntityClass:function(e){return _.find(this.model.models,function(t){var i=t.get(t.UIDP.VERSIONS_BY_ENTITY);return i&&_.size(i)&&t.get(t.DP.ENTITY_CLASS)===e})},findDependentModelIds:function(e,t,i){var n=[],s=this.selectionModel.ALL;return _.each(this.model.models,function(a){var r=a.get(a.UIDP.VERSIONS_BY_ENTITY),o=a.getValue(a.UIDP.LOCATIONS),l=a.getValue(a.UIDP.ENTITY_IDS),c=a.getValue(a.UIDP.ENTITY_MODELS);r&&_.size(r)&&a.get(a.DP.ENTITY_CLASS)===e&&_.each(c,function(e,a){e!==t||s!==i&&o[a]!==i||!r[l[a]]||n.push(l[a])})},this),n},getSelectedUpdates:function(e){if(e===s.SELECT_MODES.SELECTED)return this.selectionModel;var t=e===s.SELECT_MODES.REQUIRED,i=this.model.models;t&&(i=_.filter(this.model.models,function(e){return this.getUpdateVersionStatus(e)===C[0]},this));var n=new s;return n.setEntityModel(this.model),_.each(i,function(e){n.selectAll(e,{silent:!0})},this),n},getMatchDependentEntityIds:function(e,t,i){var n=this.selectionModel.DP,s=[];return _.each(i,function(i){s=s.concat(this.findDependentModelIds(e,t,i[n.LOCATION]))},this),_.unique(s)},getSelectedRequestList:function(e){var t=this,i=e?e.getSelectionsList(n.findVersionByHierarchy):[],s=function(e){return _.find(i,function(t){return t[0]===e})},a=e.getAllDependentEntitiesByClassModelAndVersion(),r=e.DP;return _.each(a,function(e){var n=_.first(e),a=n[r.DEPENDENCIES],o=a[r.ENTITY_CLASS],c=a[r.ENTITY_MODEL],d=!0===a.exact||a.exact===l.BOOLEAN_TRUE,u=t.getMatchDependentEntityIds(o,c,e);_.each(u,function(e){var n=s(e),r=t.findEntityClassModelByUUId(e),o=void 0,l=void 0,c=void 0;if(r){l=r.findCurrentVersionByEntityId(e);var u=r.get(r.UIDP.VERSIONS_BY_ENTITY);o=u?u[e]:[],c=r.findMatchingDependentVersion(o,a)}if(c){var h=c.order,p=c.version,T=t.findVersionOrder(o,l);if(n){if(d&&l!==p)n[1]=p;else if(!T||h>T){var E=t.findVersionOrder(o,n[1]);(!E||h>E)&&(n[1]=p)}}else(l!==p||!T||h>T)&&i.push([e,p])}})}),i},findVersionOrder:function(e,t){var i=_.find(e,function(e){return e.version===t},this);if(i)return parseInt(i.order,10)},showPlanMessages:function(){var e=this.selectionModel.getUpdatePlan(),t=this.formatPlanMsg(e[this.selectionModel.DP.PLAN_MESSAGE]);if(t&&t.length){var i=_.map(_.unique(t),function(e){return"<li>"+e+"</li>"}).join(""),n=this._formatGPUInfo();if(n&&(i+=n.message),this.$(".plan-message").html(i),n){var s=this;this.$(".n-plan-warning-popover").popover({title:this.i18ns("UserVMGPUWarningTitle",n.vmLabel),placement:"bottom",trigger:"hover",html:!0,content:function(){return s._getGPUVMContent()}})}}else this.$(".plan-message").hide()},formatMsg:function(e,t,i){var n=this.i18ns("planMessages."+e,t,i);return n||o.toUpperCaseFirstChar(e.replace(/_/g," "))},formatPlanMsg:function(e){var t=[],i=[],n=[];_.each(e,function(e,t){var s=t.split(":"),r=this.hostCollection.findModelByUuid(s[1]);r?i.push({node:r.get(a.NAME),msg:e[0]}):n.push(e[0])},this);var s=_.groupBy(i,function(e){return e.msg});if(_.size(n)){var r=o.getSingularEntityName(l.ENTITY_CLUSTER);_.each(n,function(e){t.push(this.formatMsg(e,1,r))},this)}return _.each(s,function(e,i){var n=_.size(e),s=o.getEntityNameFromCount(l.ENTITY_NODE,n);s=s&&s.toLowerCase(),t.push(this.formatMsg(i,n,s))},this),t},getErrorTooltip:function(e){if(e){var t=_.size(e);return this.i18ns("updateFailedMsg",t,o.getEntityNameFromCount(l.ENTITY_GENERIC,t))}return null},hasSelectedUpdateRequest:function(){return this.selectionModel&&this.selectionModel.length>0},_getAHVNodeUUids:function(e){var t=[];return _.each(e,function(e,i){var n=i.split(":");e[1]===l.SOFTWARE_RELEASES_HYP_TYPE.AHV&&y.indexOf(e[0])>=0&&t.indexOf(n[1])<0&&t.push(n[1])},this),t},_getGPUVMContent:function(){var e=this.nonLiveMigratableVMs.toJSON();return e=_.sortBy(e,function(e){return e[a.EB.VM.VM_NAME]}),A(this.vtOptions({vmLabel:o.getSingularEntityName(l.ENTITY_VM),nodeLabel:o.getSingularEntityName(l.ENTITY_NODE),vms:e}))},_formatGPUInfo:function(){var e,t=this.nonLiveMigratableVMs?this.nonLiveMigratableVMs.length:0;if(t){e=o.getEntityNameFromCount(l.ENTITY_VM,t);var i=I(this.vtOptions({cnt:t,label:e}));return{vmLabel:e,message:b(this.vtOptions({key:1===t?"singular":"plural",popoverLink:i}))}}return null},_loadNonLiveMigratableVMs:function(){return this.nonLiveMigratableVMs&&this.nonLiveMigratableVMs.getState()===l.STATE_INIT}})}),define("text!templates/popups/lcm/LCMProgressView.html",[],function(){return'<h4 class="n-loader-header"> <%= message %> </h4>\n<div class="lcm-task-in-progress">\n  <div class="lcm-task-proc-ctr">\n    <div class="n-proc-steps lcm-proc-steps">\n      <% _.each(tasks, function(task, index) { %>\n      <div class="n-proc-step">\n        <div class="proc-step-title  <%= task.className %>">&nbsp;</div>\n        <div class="proc-step-content">\n          <h4 class=""><%= task.operation %></h4>\n          <div><%= task.message %> (<%= task.progress %>)</div>\n          <div><%= task.timeStampInfo %></div>\n        </div>\n      </div>\n      <% }) %>\n    </div>\n  </div>\n</div>'}),define("views/popups/lcm/LCMTasksPage",["views/popups/lcm/LCMBaseSubPage","models/lcm/LCMModel","models/query/QueryResultCollection","data/DataProperties","events/AppEvents","managers/TaskManager","utils/AppConstants","utils/FilterUtil","utils/TimeUtil","text!templates/popups/lcm/LCMProgressView.html"],function(e,t,i,n,s,a,r,o,l,c){"use strict";var d=_.template(c),u=[r.TASK_STATUS_ACTIVE,r.TASK_STATUS_QUEUED,r.TASK_STATUS_FAILED,r.TASK_STATUS_CANCELED,r.TASK_STATUS_ABORTED,r.TASK_STATUS_SKIPPED,r.TASK_STATUS_COMPLETE,r.TASK_STATUS_COMPLETED];return e.extend({modelEvents:{"reset subTasks":"onTaskLoaded","error subTasks":"onTaskLoadedError","reset model":"onDataLoaded","error model":"onDataError"},viewByEntityType:r.ENTITY_CLUSTER,subTasks:null,requestList:null,destroy:function(){this.stopServices(),e.prototype.destroy.apply(this,arguments)},onStartServices:function(){this.subTasks.startPolling()},onStopServices:function(){this.subTasks.stopPolling()},refreshView:function(){this.taskUpdated&&(this.render(),this.taskUpdated=!1)},populateVersionData:function(e){var t=this.getTaskMessage(this.subTasks),i=void 0,s=a.getTaskById(this.lcmTaskId);s&&s.isTaskCompleted()&&s.isStatusFailed()&&(i=s.get(n.SUB_TASK_MESSAGE)),_.each(e.models,function(e){var n=this.taskInfo[e.get(e.DP.UUID)],a=_.extend({},n);i?(a=this.getTaskInfo(s),a[e.UIDP.PROGRESS]=i):a[e.UIDP.PROGRESS]||(a[e.UIDP.PROGRESS]=this.i18n("inProgress")),a[e.UIDP.TASK_MESSAGE]=a[e.UIDP.TASK_MESSAGE]||t,!e.get(e.DP.REQUEST_VERSION)&&this.requestList&&(a[e.DP.REQUEST_VERSION]=this.requestList[e.get(e.DP.UUID)].version),e.set(a,{silent:!0})},this)},initializeModel:function(e){this.lcmTaskId=e.lcmTaskId,this.subTasks=this.createLCMTaskCollectionModel(this.lcmTaskId),this.initialized=!1},loadData:function(){var e=this;a.getTaskById(this.lcmTaskId)?this.startServices():a.fetchOnDemand().always(function(){e.startServices()})},onTaskLoaded:function(){this.taskInfo=this.getEntityInfoFromTask(this.subTasks);var e=a.getTaskById(this.lcmTaskId),t=e?e.get(n.TASK_TYPE):null;this.subTasks.length&&t!==r.TASK_OPERATION_LCM.LCM_INVENTORY_OPERATION&&(t=e&&this.findSubTaskByType(this.subTasks,r.TASK_OPERATION_LCM.LCM_INVENTORY_OPERATION)?r.TASK_OPERATION_LCM.LCM_INVENTORY_OPERATION:r.TASK_OPERATION_LCM.LCM_UPDATE_OPERATION);var i=void 0;i=t===r.TASK_OPERATION_LCM.LCM_UPDATE_OPERATION?this.i18n("updateInProgress"):t===r.TASK_OPERATION_LCM.LCM_INVENTORY_OPERATION?this.i18n("inventoryInProgress"):e?e.get(n.SUB_TASK_MESSAGE)||e.getTaskDisplayName():this.i18n("loading"),this.renderSubTaskProgress(i),s.triggerAppEvent(s.ENTITIES_UPDATED,{entityType:r.ENTITY_LCM,entity:this.model,task:{parentTask:e,subTasks:this.subTasks,requestList:this.requestList,operationType:t}})},onTaskLoadedError:function(e,t){this.$el.html(t)},renderSubTaskProgress:function(e){if(this.subTasks&&this.subTasks.length){var t=_.map(this.subTasks.models,function(e){return e.getId()});_.size(t)?this.loadSubTasks(t,e):this.renderSubTasks(this.subTasks.models,e)}else this.renderPageLoadingMessage(e)},loadSubTasks:function(e,t){var s=this,a={};o.addFilterConditions(a,r.ENTITY_TASK,n.TASK_PARENT_TASK_UUID,e);var l=new i(null,{entityType:r.ENTITY_TASK,queryType:i.QUERY_TYPES.TASK,filter_expression:a});l.fetch().always(function(){l.length?s.renderSubTasks(l.models,t):s.renderSubTasks(s.subTasks.models,t)})},renderSubTasks:function(e,t){if(e.length){this.$el.empty();var i=_.groupBy(e,function(e){return e.get(n.TASK_STATUS)}),s=[];_.each(this.subTasks,function(e){var t=e.get(n.TASK_SUB_TASK_UUIDS);if(!t||!t.length){var s=i[e.get(n.TASK_STATUS)];s||(i[e.get(n.TASK_STATUS)]=[]),s.push(e)}}),_.each(u,function(e){var t=i[e];t&&(s=s.concat(_.sortBy(t,function(e){return e.get(n.TASK_LAST_UPDATE_TIME)}).reverse()))});var a=d(this.vtOptions({message:t,tasks:this.toDisplayJSON(s)}));this.$el.html(a)}},toDisplayJSON:function(e){var t=this;return _.map(e,function(e){var i=void 0;i=e.isStatusActive()?e.getPercentageDisplay():e.get(n.TASK_STATUS);var s=e.get(n.TASK_CREATE_TIME)||e.get(n.TASK_START_TIME),a="startedOn";e.isTaskCompleted()&&(s=e.get(n.TASK_LAST_UPDATE_TIME),a="completedOn");var r=t.i18ns(a,l.formatFullDateTime(s/1e3));return{operation:e.getTaskOperationType(),message:e.getMessage(),className:(e.get(n.TASK_STATUS)||"").toLowerCase(),progress:i,timeStampInfo:r}})},getTaskMessage:function(e){var t=this.findSubTaskByType(e,r.TASK_OPERATION_LCM.LCM_DOWN_LOAD_TASK)||this.findSubTaskByType(e,r.TASK_OPERATION_LCM.LCM_PRE_CHECKS_TASK);return t?t.get(n.SUB_TASK_MESSAGE):this.i18n("inProgress")},createLCMCollectionModel:function(e){return new i(null,{entity_ids:e,entityType:t.ENTITY_TYPE,queryType:i.QUERY_TYPES.LCM,groupBys:[t.DP.ENTITY_CLASS],entityModel:t})},createLCMTaskCollectionModel:function(e){var t={};return o.addFilterCondition(t,n.TASK_PARENT_TASK_UUID,o.createFilterCondition(r.ENTITY_TASK,n.TASK_PARENT_TASK_UUID,r.FILTER_OPERATORS.EQUALS,e)),new i(null,{entityType:r.ENTITY_TASK,queryType:i.QUERY_TYPES.TASK,filter_expression:t})}})}),define("views/utils/MultipleItemPickerView",["views/basecomponents/BaseView","utils/AppConstants","utils/AppUtil","utils/ComboBox","utils/SVG"],function(e,t,i,n,s){"use strict";var a=_.template('<div class="select-item-box" data-id="<%= item.id %>"><div class="select-item-name"><%= item.name %></div><% if (!readOnly) { %><div class="close-btn deselect-item" data-id="<%= item.id %>"><%= SVG.SVGIcon("K","-inline -micro") %></div><% } %></div>'),r=_.template('<select class="item-selector n-preserve-style"><option value="">&nbsp;</option><% _.each(items, function(item) { %><option value="<%= item.id %>"><%= item.name %></option><% }) %></select>'),o=_.template('<input type="text" class="item-input" placeholder="<%= placeholder %>">'),l={INPUT:"input",SELECT:"select"};return e.extend({selectedItems:null,selectableItems:null,itemNameLookupFunc:null,placeholder:null,initalSelectPrompt:null,inputType:null,customClass:null,showAllSelectOptions:!0,events:{"click .deselect-item":"onDeselectItem"},selectorEvents:{"select .item-selector":"onItemSelect","open .item-selector":"onOpenSelector"},inputEvents:{"keypress .item-input":"onItemInputKeyPress","blur .item-input":"onBlur"},initialize:function(t){e.prototype.initialize.apply(this,arguments),_.bindAll(this,"getItemName"),this.inputType=t.inputType||"input",this.selectedItems=t.selectedItems||[],this.showAllSelectOptions=_.isUndefined(t.showAllSelectOptions)?this.showAllSelectOptions:t.showAllSelectOptions,this.selectableItems=t.selectableItems||[],this.itemNameLookupFunc=t.itemNameLookupFunc||this.getItemName,this.customClass=t.customClass||"",this.placeholder=t.placeholder||"",this.initalSelectPrompt=t.initalSelectPrompt||"Select",this.readOnly=t.readOnly||!1,this.readOnly||(this.inputType===l.SELECT?this.addExtraEvents(this.selectorEvents):this.addExtraEvents(this.inputEvents))},destroy:function(){this.$(".item-selector").combobox("destroy"),
this.$el.off("multiSelectItemChanged"),e.prototype.destroy.apply(this,arguments)},render:function(){this.$el.html('<div class="multiple-select-bar"><div class="selected-items"></div><div class="search-box"></div></div>');var e=_.map(this.selectedItems,function(e){var t=e,i=e;return this.inputType===l.SELECT&&(i=this.itemNameLookupFunc(t)),{id:t,name:i}},this);_.each(e,function(e){this.$(".selected-items").append(a({item:e,SVG:s,readOnly:this.readOnly}))},this),this.readOnly||(this.inputType===l.INPUT?this.renderItemInput():this.renderSelector())},getSelectedItems:function(){return this.selectedItems},onSelectionChangeEvent:function(e){this.$el.on("multiSelectItemChanged",e)},renderSelectableItems:function(){var e=this.getSelectableItems(),t=this.$(".item-selector");t.combobox("destroy");var n=_.map(e,function(e){return{name:e.name,value:e.id}});i.populateDropdown(t,_.sortBy(n,function(e){return e.name})),this.$(".item-selector").combobox({initalSelectPrompt:this.initalSelectPrompt||"Select",customClass:this.customClass,showAllSelectOptions:this.showAllSelectOptions}),this.resizeSelector()},renderSelector:function(){var e=this.getSelectableItems();this.$(".search-box").html(r({items:e})),this.$(".item-selector").combobox({initalSelectPrompt:this.initalSelectPrompt||"Select",customClass:this.customClass,showAllSelectOptions:this.showAllSelectOptions}),this.resizeSelector()},renderItemInput:function(){this.$(".search-box").html(o({placeholder:this.placeholder})),this.applyNutanixInput(),this.resizeSelector()},resizeSelector:function(){if(this.$el.is(":visible")){var e=this.$(".multiple-select-bar").outerWidth(!1),t=this.$(".selected-items").outerWidth(!0)+2,i=e-2-t-20;i<50&&(i=e-30),this.$(".search-box").css("width",i),this.inputType===l.SELECT?this.$("input.ui-autocomplete-input").css("width",i):this.$(".item-input").css("width",i)}},onItemSelect:function(e){var t=$(e.currentTarget),i=t.val();if(""!==i){var n=this.itemNameLookupFunc(i);this.addItem({id:i,name:n})}},onDeselectItem:function(e){var i=$(e.currentTarget),n=i.data("id"),s=this.selectedItems.indexOf(n);-1!==s&&this.selectedItems.splice(s,1),this.$el.trigger("multiSelectItemChanged",[t.ACTION_DELETE,this]),this.$('.select-item-box[data-id="'+n+'"]').remove(),this.refreshItems()},onItemInputKeyPress:function(e){var t=$.ui.keyCode;if(e.keyCode===t.ENTER){var i=$(e.currentTarget).val();this.addItem({id:i,name:i}),$(e.currentTarget).val("")}},onBlur:function(e){var t=$(e.currentTarget).val();t&&(this.addItem({id:t,name:t}),$(e.currentTarget).val(""))},onOpenSelector:function(e){var t=this.$(".multiple-select-bar"),i=t.offset(),n=t.outerHeight(),s=$(e.target).data().combobox.input.data().autocomplete.menu.element,a=t.outerWidth(!1);s.css({width:a,top:i.top+n+1,left:i.left}),s.show()},refreshItems:function(){this.inputType===l.SELECT?this.renderSelectableItems():this.resizeSelector()},setSelectableItems:function(e){this.selectableItems=e,this.refreshItems()},addItem:function(e){-1===this.selectedItems.indexOf(e.id)&&(this.selectedItems.push(e.id),this.$(".selected-items").append(a({item:e,SVG:s,readOnly:!1})),this.$el.trigger("multiSelectItemChanged",[t.ACTION_ADD,this]),this.refreshItems())},getItemName:function(e){if(this.inputType===l.INPUT)return e;var t=_.find(this.selectableItems,function(t){return t.id===e});return t?t.name:"Unknown"},getSelectableItems:function(){var e=[];return _.each(this.selectableItems,function(t){-1===this.selectedItems.indexOf(t.id)&&e.push(t)},this),e}},{INPUT_TYPES:l})}),define("models/lcm/LCMVersionModel",["models/BaseModel","utils/AppConstants"],function(e,t){"use strict";var i={UUID:"uuid",ENTITY_UUID:"entity_uuid",ENTITY_CLASS:"entity_class",STATUS:"status",VERSION:"version",DEPENDENCIES:"dependencies",ORDER:"order"},n=t.ENTITY_LCM_VERSION;return e.extend({DP:i,idAttribute:i.UUID,nameAttribute:i.NAME,entityType:n,name:"LCMVersionModel",initialize:function(t){e.prototype.initialize.apply(this,arguments);var n=this.get(i.DEPENDENCIES);n&&""!==n?this.set(i.DEPENDENCIES,JSON.parse(n)):this.set(i.DEPENDENCIES,[])}},{DP:i,ENTITY_TYPE:n})}),define("models/genesis/LCMActionModel",["models/genesis/GenesisBaseModel","utils/AppConstants"],function(e,t){"use strict";var i={PERFORM_INVENTORY:"perform_inventory",PERFORM_UPDATE:"perform_update",GENERATE_PLAN:"generate_plan",CONFIGURE:"configure",GET_URL:"get_url",GET_CONFIG:"get_config",GET_ROOT_TASK:"get_root_task",IS_LCM_UPDATE_NEEDED:"is_lcm_update_needed",IS_LCM_OPERATION_IN_PROGRESS:"is_lcm_operation_in_progress"},n={AUTOUPDATE:"Autoupdate",INVENTORY:"Inventory",UPDATE:"Update",UNKNOWN:"Unknown",NONE:"None"},s={URL:"url",NEXT_UPDATE:"next_update",INTERVAL_DAYS:"interval_days",AUTO_UPDATE_ENABLED:"auto_update_enabled",LCM_UI_APP_ENABLED:"lcm_standalone_ui_enabled",LCM_PC_ENABLED:"lcm_pc_enabled",SUPPORTED_LCM_UPDATE_ENTITIES:"supported_software_entities",DEPRECATED_ONECLICK_UPDATE_ENTITIES:"deprecated_software_entities",UI_VERSION:"ui_version",LCM_CPDB_TABLE_DEF_LIST:"lcm_cpdb_table_def_list",LCM_ENTITY:"entity",LCM_AVAILABLE_VERSION:"available_version"};return e.extend({name:"LCMActionModel",methodName:"lcm_framework_rpc",managerName:t.GENESIS.LCM_MANAGER,setRPCParams:function(e,t,n,s){var a={method_class:"LcmFramework",method:e};if(e!==i.GET_URL&&e!==i.GET_ROOT_TASK&&e!==i.GET_CONFIG&&e!==i.IS_LCM_UPDATE_NEEDED&&e!==i.IS_LCM_OPERATION_IN_PROGRESS){if(e!==i.CONFIGURE&&!t)throw new Error("Portal URL is required for all lcm operation.");var r=[t];n&&_.isArray(n)?r.push(n):n&&_.each(n,function(e){r.push(e)}),s&&_.each(s,function(e){r.push(e)}),a.args=r}_.extend(this.kwargs,a)}},{LCM_ACTIONS:i,INPROGRESS_OPERATIONS:n,DP:s})}),define("text!templates/popups/lcm/LCMPopupView.html",[],function(){return'\x3c!-- The parent div modal is #popuplcmPopupView  --\x3e\n<div class="modal-header">\n  <button type="button" class="close" data-dismiss="modal">\n    <i data-icon="K" aria-hidden="true"></i>\n  </button>\n  <h4 class="n-title"> <%= i18n(\'lcm\', \'Life Cycle Management\') %> </h4>\n</div>\n<div class="n-modal-wrapper">\n  <div class="n-modal-body">\n    <div class="n-modal-content-wrapper center-panel">\n    </div>\n  </div>\n</div>'}),define("text!templates/popups/lcm/LCMView.html",[],function(){return'<div class="n-modal-alert-header">\n  \x3c!-- @view: update message goes here --\x3e\n</div>\n\n<div class="n-modal-content">\n  <% if (loading || autoUpdateInProgress) { %>\n  <div class="lcm-task-content lcm-contents">\n    <h4 class="n-loader-header">\n      <%= (loading) ? i18n(\'loading\') : i18n(\'autoUpdateInProgress\') %>\n    </h4>\n    <div class="circleLoader">\n    </div>\n  </div>\n  <% } else if (lcmAppEnabled) { %>\n  <div class="lcm-react-app-container"></div>\n  <% } else {%>\n  <div class="lcm-content-wrapper active">\n    <div class="lcm-header-wrapper">\n      <% if (!lcmTaskId) { %>\n      \x3c!-- update actions --\x3e\n      <div class="lcm-btn-group lcm-update-group">\n        <div class="actions-dropdown -not-selectable btn-group">\n          <button type="button"\n                  class="btn -default dropdown-btn dropdown-toggle"\n                  data-test="option-dropdown"\n                  data-toggle="dropdown">\n                  <span>\n                    <%= i18n("options") %>\n                  </span>\n            <%= Components.icon(\'z\', \'-down-arrow\') %>\n          </button>\n          <ul class="dropdown-menu dropdown-menu-right" role="menu">\n            <% _.each(selectOptions, function(val, key) { %>\n            <li data-test="li-lcm-select-<%= val %>">\n              <a class="update-selection-mode lcm-op <%= disabled %>"\n                 data-id="<%= val %>"\n                 data-test="lcm-select-<%= val %>"\n                 stream-action="LCM:select"\n                 stream-target="<%= val %>">\n                <%= val %>\n              </a>\n            </li>\n            <% }) %>\n            <li class="divider" data-test="li-divider-1"></li>\n            <li data-test="li-perform-inventory">\n              <a class="btnInventory <%= disabled %>"\n                 data-test="perform-inventory"\n                 stream-action="LCM:action"\n                 stream-target="Perform Inventory">\n                <%= i18n(\'performInventory\') %>\n              </a>\n            </li>\n            <li data-test="li-run-check">\n              <a class="btnPopupLink btnNCCChecks"\n                 actiontarget="cluster" action="run_check"\n                 data-test="run-check"\n                 stream-action="LCM:runChecks"\n                 stream-target="Run NCC Checks">\n                <%= i18n(\'runNCCChecks\') %>\n              </a>\n            </li>\n            <li class="divider" data-test="li-divider-2"></li>\n            <li data-test="li-advance-settings">\n              <a class="btnPopupLink btnSettings <%= lcmTaskId ? \'disabled\' : \'\' %>"\n                 actiontarget="lcm_entity" action="update"\n                 data-test="advance-settings"\n                 stream-action="LCM:action"\n                 stream-target="Advanced Settings">\n                <%= i18n(\'advancedSettings\') %>\n              </a>\n            </li>\n            <li  data-test="li-about-version">\n              <a class="btnPopupLink btnVersion"\n                 actiontarget="version" action="show"\n                 data-test="about-version"\n                 stream-action="LCM:about-version"\n                 stream-target="About LCM Version">\n                <%= i18n(\'aboutLCMVersion\') %>\n              </a>\n            </li>\n          </ul>\n        </div>\n        <button type="button"\n                class="btn btn-default -blue btnUpdateSelection lcm-op btnUpdateSelection <%= disabled %>"\n                data-test="select-all"\n                stream-action="LCM:select"\n                stream-target="<%= selectOptions.ALL %>"\n                data-id="<%= selectOptions.ALL %>">\n          <%= selectOptions.ALL %>\n        </button>\n      </div>\n\n      \x3c!--Update Preview actions--\x3e\n      <div class="lcm-btn-group lcm-preview-group">\n        <button type="button"\n                class="btn btnCancelUpdate n-btn-list"\n                data-test="cancel-update"\n                stream-action="LCM:action"\n                stream-target="Cancel Update">\n          <%= i18n(\'cancel\') %>\n        </button>\n        <button type="button"\n                class="btn btnStartUpdate btn-primary -btn-list <%= disabled %>"\n                data-test="start-update"\n                stream-action="LCM:action"\n                stream-target="Start Update">\n          <%= i18n(\'start\') %>\n        </button>\n      </div>\n\n      \x3c!--Update define selection actions--\x3e\n      <div class="lcm-btn-group lcm-selection-group">\n        <button type="button"\n                data-test="cancel-selection"\n                class="btn btnCancelSelection n-btn-list">\n          <%= i18n(\'cancel\') %>\n        </button>\n        <button type="button"\n                class="btn btnSaveSelection btn-primary -btn-list <%= disabled %>"\n                data-test="save-selection"\n                stream-action="LCM:select"\n                stream-target="Save selection">\n          <%= i18n(\'saveSelection\') %>\n        </button>\n      </div>\n      <% if (isPC) { %>\n      <div class="filter-selector">\n        <div class="filter-header">\n          <%= i18n(\'clusterFilter\') %>\n        </div>\n        <div class="clusterSelector"></div>\n      </div>\n      <% } %>\n      \x3c!--Preview header--\x3e\n      <div class="preview-header">\n        <%= i18n(\'readyToPerformUpdates\') %>\n      </div>\n      <% } else { %>\n      \x3c!-- task header--\x3e\n      <div class="task-header">\n        <span class="task-operation-label"></span>\n        <span class="task-percentage"></span>\n      </div>\n      <% } %>\n    </div>\n    <% if (!lcmTaskId) { %>\n    \x3c!--Your view content here--\x3e\n    <div class="tab-content lcm-contents lcm-general-contents">\n      <% _.each (tabs, function(tab, tabId) { %>\n      <div class="tab-pane lcm-<%= tabId %>-content">\n        \x3c!--  Tab view contents --\x3e\n      </div>\n      <% })%>\n    </div>\n    <div class="lcm-preview-content lcm-contents">\n    </div>\n    <% } else {%>\n    <div class="lcm-task-content lcm-contents">\n    </div>\n    <% } %>\n  </div>\n  <% } %>\n</div>'}),define("text!templates/popups/softwareupgrade/HypervisorAuthenticationTemplate.html",[],function(){return'<div>\n  <label class="n-popup-captcha-error"></label>\n</div>\n\n<div class="n-popup-title credentials-prompt">\n  Please enter the server details and credentials\n</div>\n<div>\n  <label class="n-popup-title credentials">\n    <%=serverDetails%>\n    </label>\n  <input class="host-details credentials-input n-popup-fields"\n  type="text" value>\n</div>\n<div>\n  <label class="n-popup-title credentials">\n    Username:\n    </label>\n  <input class="username-auth credentials-input n-popup-fields"\n  type="text" placeholder="domain\\username or username@domain" value>\n</div>\n<div>\n  <label class="n-popup-title credentials">\n    Password:\n    </label>\n  <input class="password-auth credentials-input n-popup-fields"\n  type="password" autocomplete="off" value>\n</div>\n'}),define("views/popups/lcm/LCMPopupView",["views/basecomponents/popups/BasePopupView","views/popups/lcm/LCMAvailableUpdatePage","views/popups/lcm/LCMTasksPage","views/utils/MultipleItemPickerView","models/lcm/LCMModel","models/lcm/LCMVersionModel","models/lcm/LCMSelectionCollection","models/genesis/LCMActionModel","models/query/QueryResultCollection","models/hardware/HostCollection","managers/TaskManager","managers/ActionManager","broker/managers/BrokerManager","data/DataProperties","events/AppEvents","utils/AppConstants","utils/AppUtil","utils/SubViewHelper","utils/FilterUtil","text!templates/popups/lcm/LCMPopupView.html","text!templates/popups/lcm/LCMView.html","text!templates/popups/softwareupgrade/HypervisorAuthenticationTemplate.html"],function(e,t,i,n,s,a,r,o,l,c,d,u,h,p,T,E,g,S,m,v,f,A){"use strict";var y=_.template(v),C=_.template(f),I=_.template(A),b={UPDATE_VIEW:"update",PREVIEW_VIEW:"preview",INVENTORY_VIEW:"inventory",TASK_VIEW:"task",DRILL_DOWN_VIEW:"drill-down-view"},R={update:"Available Updates",inventory:"Inventory"},N={update:t,preview:t,task:i},P=_.template('<div class="n-popup-data-list"><% for (var i = 0; i < msgs.length; i++) { %><div class="n-popup-data"><%= msgs[i]%></div><% } %></div><div class="n-popup-title">Click on <b><%= action %></b> to continue.</div>'),w=_.template('<a class="configPopupLink" <%= actionAttributes %>><%= i18n("configAdvancedSettings") %></a>'),D=_.template('<%= i18n("failedToPerformUpdate") %>'),O=_.template('<%= i18n("vCenterIPAddress") %>:'),M=_.template('<div class="control-group">  <%= Components.checkbox({    id: \'lcm-auto-update-enabled\',    checked: false  }) %>  <label for="lcm-auto-update-enabled">    <%= i18n("enableLCMAutoUpdate") %>  </label></div>');return e.extend({name:"LCMPopupView",el:"#popuplcmPopupView",settingPopup:!0,events:{"click .modal-header .close":"hide","keypress input":"onKeyPress","click .tab-lcm":"onClickLinkAction","click .configPopupLink":"onPopupLinkClick","click .btnPopupLink":"onPopupLinkClick","click .lcm-op:not(.disabled)":"onUpdateSelectionChanged","click .btnStartUpdate":"onUpdate","click .btnCancelUpdate":"onCancelUpdate","click .btnInventory:not(.disabled)":"onPerformInventory","click .btnCancelSelection":"onCancelSelection","click .btnSaveSelection":"onSaveSelection","click .docLink":"onKBLinkClick"},initialized:!1,subViewHelper:null,portalURL:null,autoUpdateEnabled:null,lcmFrameworkUpdatedNeed:!1,overlayPopup:!0,canModify:!1,updateInProgress:!1,clusterIds:null,clusterSelector:null,lcmAppEnabled:!1,showInPopup:!0,reactComponent:null,initialize:function(t){e.prototype.initialize.apply(this,arguments),this.showInPopup=!(t&&t.standaloneView),this.lcmAppEnabled=t&&t.lcmAppEnabled,this.subViewHelper=new S,this.config={},this.lcmAppEnabled?this.initialized=!0:this.initialized=!1,_.bindAll(this,"lcmConfigUpdated","onEntityChanged","selectionChangeEvent","getClusterName"),T.onAppEvent(T.ENTITIES_UPDATED,this.lcmConfigUpdated),T.onAppEvent(T.ENTITIES_CREATED,this.onEntityChanged),T.onAppEvent(T.ENTITIES_DELETED,this.onEntityChanged)},render:function(){if(!this.isViewRendered){if(this.showInPopup){var e=y(this.vtOptions());this.$el.html(e)}else this.$el.html('<div class="n-modal-content-wrapper center-panel"/>');this._render(),this.isViewRendered=!0}},_render:function(e){return this.initialized?this.lcmAppEnabled?(this.unRegisterAppEvents(),this.renderBrokerView(e)):this.renderLCMContents(e):(this.renderTemplate({loading:!0,lcmTaskId:null,autoUpdateInProgress:!1},!1,!1),this.loadRootTask()),this},renderAutoUpdateInProgress:function(){var e=this,t={autoUpdateInProgress:!0,loading:!1,lcmTaskId:null};this.renderTemplate(t,!1,!1),this.timerId=setTimeout(function(){e.loadRootTask()},5e3)},show:function(t){if(this.clusterManager.isMulticlusterNavMode()){var i=t[E.NAV_ACTION_TARGET_ID];i&&(this.clusterIds=i.split(","))}e.prototype.show.apply(this,arguments)},destroy:function(){this.subViewHelper.destroy(),this.unRegisterAppEvents(),this.reactId&&(h.unloadComponent(this.reactId),this.reactId=null,this.reactComponent=null),this.timerId&&clearTimeout(this.timerId),this.$(".lcm-op.disabled, .btnInventory.disabled").tooltip("destroy"),e.prototype.destroy.apply(this)},unRegisterAppEvents:function(){T.offAppEvent(T.ENTITIES_CREATED,this.onEntityChanged),T.offAppEvent(T.ENTITIES_DELETED,this.onEntityChanged),T.offAppEvent(T.ENTITIES_UPDATED,this.lcmConfigUpdated)},initializeModels:function(e){if(e=e||{},!e.lcmTaskId){var t=null;this.clusterIds&&(t=m.addFilterConditions({},E.ENTITY_LCM,s.DP.CLUSTER,this.clusterIds)),this.model=new l(null,{entityType:s.ENTITY_TYPE,queryType:l.QUERY_TYPES.LCM,groupBys:[s.DP.ENTITY_CLASS],entityModel:s,filter_expression:t}),this.versionModel=new l(null,{entityType:a.ENTITY_TYPE,entityModel:a})}this.hostCollection=new c},setLCMModelFilter:function(){var e=null;this.clusterIds&&(e=m.addFilterConditions({},E.ENTITY_LCM,s.DP.CLUSTER,this.clusterIds)),e?this.model.setQueryOption({filter_expression:e}):this.model.setQueryOption({filter_expression:null})},confirmHide:function(e){if(this.canModify&&this.$(".btnStartUpdate").hasClass("disabled"))return void this.showHeaderWarning(this.i18n("updateInProgress","Update in progress. Please close the view later."));var t=this.subViewHelper.get(b.PREVIEW_VIEW)||this.subViewHelper.get(b.UPDATE_VIEW),i=!1,n=void 0;this.canModify&&t&&(i=t.hasSelectedUpdateRequest())&&(n=this.i18n("confirmClose",this.i18n("exitWarning"))),i?$.nutanixConfirm({msg:n,yes:e,yesText:"Yes",noText:"No"}):e()},clearHeader:function(){!this.canModify&&this.$(".alert-warning").is(":visible")||e.prototype.clearHeader.apply(this,arguments)},isModelInitialized:function(){return this.initialized},onClickLinkAction:function(e){this.clearHeader();var t=$(e.currentTarget),i=t.attr(E.NAV_ACTION),n=t.attr(E.NAV_ACTION_TARGET),s=void 0;if(i===E.ACTION_SHOW_SUBVIEW&&n===E.ENTITY_LCM)this.selectTab($(e.currentTarget).attr(E.NAV_ACTION_TARGET_ID));else if(t.hasClass("lcm-drill-down")){var a=t.attr("view");a&&this.$(".lcm-content-wrapper").attr("view-id",a),s=this.$(".lcm-content-wrapper").attr("view-id"),this.$(".lcm-content-wrapper").addClass(s+"-"+b.DRILL_DOWN_VIEW)}else if(t.hasClass("close-drill-down-view-link")){s=t.attr("parentView");var r=this.$(".lcm-content-wrapper").attr("view-id");this.$(".lcm-content-wrapper").removeClass(r+"-"+b.DRILL_DOWN_VIEW),s&&s!==r&&this.$(".lcm-content-wrapper").attr("view-id",s)}},onUpdateSelectionChanged:function(e){var t=this;if(this.currentTabId===b.UPDATE_VIEW){this.clearHeader();var i=this.subViewHelper.get(b.UPDATE_VIEW),n=$(e.currentTarget).attr("data-id"),s=i.getSelectedUpdates(n);if(s.hasEmptySelection())return void this.showHeaderError("Please select entity to update.");var a=i.getSelectedRequestList(s);if(_.size(a)<=0)return void this.showError("Please select a model to update.");if(!this.portalURL)return void this._showConfigWarning();this.$(".btnUpdateSelection").button("loading"),s.setUpdatePlan(null);var r=new o;r.setRPCParams(o.LCM_ACTIONS.GENERATE_PLAN,this.portalURL,a),r.save().done(function(){t._showPlanMessages(r,s,a)}).always(function(){t.$(".btnUpdateSelection").button("reset")})}},showPreview:function(e){this.$(".lcm-content-wrapper").attr("view-id",b.PREVIEW_VIEW);var t=e.getUpdatePlan(),i=t?t[e.DP.REQUEST_LIST]:[],n=_.size(i),s="updateEntityLabel.singular";n>1&&(s="updateEntityLabel.plural"),this.$(".btnStartUpdate").text(this.i18ns(s,n)),this.createSubView(b.PREVIEW_VIEW,{model:this.model,versionModel:this.versionModel,selectionModel:e}).render()},showTaskView:function(e){this.createSubView(b.TASK_VIEW,e).render(),this.$(".lcm-content-wrapper").attr("view-id",b.TASK_VIEW)},updateTaskProgress:function(e){var t=e.parentTask,i=e.operationType;i===E.TASK_OPERATION_LCM.LCM_INVENTORY_OPERATION?this.$(".task-operation-label").html(this.i18n("inventoryTabLabel")):i===E.TASK_OPERATION_LCM.LCM_UPDATE_OPERATION?this.$(".task-operation-label").html(this.i18n("updateTabLabel")):t&&this.$(".task-operation-label").html(t.getTaskDisplayName()),t&&t.isTaskCompleted()&&this.reload(e)},showError:function(e){this.showHeaderError(e)},showSuccess:function(e){this.showHeaderSuccess(e)},showInfo:function(e){this.showHeaderInfo(e)},reload:function(e){this.initialized=!1,this.loadRootTask({currentTask:e})},loadRootTask:function(e){var t=this,i=[],n=new o;n.setRPCParams(o.LCM_ACTIONS.GET_ROOT_TASK),i.push(n.save());var s=new o;s.setRPCParams(o.LCM_ACTIONS.IS_LCM_OPERATION_IN_PROGRESS),i.push(s.save());var a=new o;a.setRPCParams(o.LCM_ACTIONS.GET_CONFIG),i.push(a.save()),$.whenAll.apply($,i).done(function(){t.initializeConfigInfo(a),t.lcmAppEnabled?(t.initialized=!0,t._render(e)):(t.setInProgressStatus(s),t.inProgressOperation===o.INPROGRESS_OPERATIONS.AUTOUPDATE?t.renderAutoUpdateInProgress():t.setRootTask(n,e))})},setInProgressStatus:function(e){e.hasErrorResponse()||(this.inProgressOperation=e.getReturnResponse())},setRootTask:function(e,t){t=t||{};var i=void 0;if(e.hasErrorResponse())i=e.getParsedErrorResponse(D(this.vtOptions())),delete t.requestList;else{var n=e.getReturnResponse();if(n){var s=d.getTaskById(n);s&&s.isTaskCompleted()?s.isStatusComplete()||(t.taskError=s.getFailedTaskMessageWithKBLink()):t.lcmTaskId=n}else t.requestList&&(delete t.requestList,i=D(this.vtOptions()))}this.initialized?i?this.showError(i):this._render(t):(i&&(t.error=i),this.initializeModels(t),this.loadLCMData(t))},loadLCMData:function(e){var t=this,i=[];this.model&&i.push(this.model.fetch()),this.versionModel&&i.push(this.versionModel.fetch()),this.hostCollection&&i.push(this.hostCollection.fetch()),$.whenAll.apply($,i).done(function(){t.lcmAppEnabled||!t.autoUpdateEnabled&&!1!==t.autoUpdateEnabled?(t.initialized=!0,t._render(e)):t._checkFrameworkStatus(e)})},renderBrokerView:function(e){var t=this;this.reactId&&(h.unloadComponent(this.reactId),this.reactId=null,this.reactComponent=null),this.$(".center-panel").empty(),e=e||{},this.reactId=h.loadComponent("LCMUIApp",this.$(".center-panel"),{el:this.$(".center-panel")[0]},{success:function(i){t.reactComponent=i,i.render(_.extend({clusterIds:t.clusterIds,isPC:t.clusterManager.isMulticlusterNavMode()},e))}})},renderLCMContents:function(e){this.subViewHelper.removeAll(),this.currentTabId=null,this.$(".n-modal-content-wrapper").empty(),e=e||{};var t=d.getGlobalTasks().hasActiveUpgradeTasks();this.renderTemplate(e,t,!1),e.lcmTaskId?this.showTaskView(e):(this.selectTab(b.UPDATE_VIEW,e),this.hasNoUpdates(this.versionModel,this.model)&&(this.$(".update-selection-mode").addClass("disabled"),this.$(".btnUpdateSelection").addClass("disabled")),!t&&this.clusterManager.isMulticlusterNavMode()&&this.createClusterSelector()),t?this.showHeaderWarning(this.i18n("nosUpgradeInProgress")):e.error?this.showError(e.error):e.taskError?this.showError(e.taskError):this.lcmFrameworkUpdatedNeed&&this.showInfo(this.i18n("newVersionAvailable"))},renderTemplate:function(e,t,i){this.canModify=this.canModifyByEntityType(E.ENTITY_LCM)&&!e.error&&!t,e=e||{};var n=C(this.vtOptions(_.extend({lcmAppEnabled:i,loading:!this.initialized,lcmFrameworkUpdatedNeed:this.lcmFrameworkUpdatedNeed,lcmTaskId:e.lcmTaskId,autoUpdateInProgress:!1,disabled:this.canModify?"":"disabled",hasUpdateTasks:t,tabs:R,selectOptions:r.SELECT_MODES,isPC:this.clusterManager.isMulticlusterNavMode()},e)));if(this.$(".lcm-op.disabled, .btnInventory.disabled").tooltip("destroy"),this.$(".n-modal-content-wrapper").html(n),!this.canModify){var s=null;s=t?this.i18n("nosUpgradeInProgress"):e.error?e.error:this.i18n("noAccess"),this.$(".lcm-op.disabled, .btnInventory.disabled").tooltip({title:s,placement:"bottom",trigger:"hover",html:!1})}},initializeConfigInfo:function(e){if(!e.hasErrorResponse()){var t=e.getReturnResponse();if(t){this.portalURL=t[o.DP.URL],this.autoUpdateEnabled=t[o.DP.AUTO_UPDATE_ENABLED],this.lcmAppEnabled=t[o.DP.LCM_UI_APP_ENABLED]||!1;var i=t[o.DP.LCM_CPDB_TABLE_DEF_LIST];i&&(s.ENTITY_TYPE=i[o.DP.LCM_ENTITY]||E.ENTITY_LCM,a.ENTITY_TYPE=i[o.DP.LCM_AVAILABLE_VERSION]||E.ENTITY_LCM_VERSION),this.config=t}}},createSubView:function(e,t,i){var n=void 0;return N[e]&&(this.subViewHelper.remove(e),n=new N[e](_.extend({el:this.$(".lcm-"+e+"-content"),hostCollection:this.hostCollection,clusterIds:this.clusterIds,VIEW_MODE:b},t||{})),this.subViewHelper.register(e,n),n.setParentView(this)),n},selectTab:function(e,t){if(this.currentTabId!==e){var i=this.subViewHelper.get(this.currentTabId);i&&i.hideView();var n=this.subViewHelper.get(e);if(!n){var s={model:this.model,versionModel:this.versionModel};n=this.createSubView(e,s,t),e===b.UPDATE_VIEW&&this._showUpdateTaskStatus(t)&&n.setCurrentTask(t.currentTask),n.render()}n.showView(),this.currentTabId=e,this.$('.tab-lcm[actionTargetId="'+this.currentTabId+'"]').tab("show"),this.currentTabId===b.UPDATE_VIEW?this.$(".lcm-content-wrapper").attr("view-id",b.UPDATE_VIEW):this.$(".lcm-content-wrapper").attr("view-id",b.INVENTORY_VIEW)}},onUpdate:function(e){var t=this.subViewHelper.get(b.PREVIEW_VIEW),i=t.getSelectedUpdates(r.SELECT_MODES.SELECTED),n=void 0,s=i.getUpdatePlan();if(s&&(n=s[i.DP.REQUEST_LIST]),_.size(n)<=0)return void this.showError(this.i18n("selectionError"));if(!this.portalURL)return void this._showConfigWarning();var a=s[i.DP.PLAN_MESSAGE],o=this._getManagementServerTypeFromResponses(a),l=this._getAuthDetailsInfo(o);null!==l?this._promptForCredential(l,E.SOFTWARE_RELEASES_HYP_TYPE.ESXI,n):this._performUpdate(n)},onCancelUpdate:function(e){this.currentTabId===b.UPDATE_VIEW?this.$(".lcm-content-wrapper").attr("view-id",b.UPDATE_VIEW):this.$(".lcm-content-wrapper").attr("view-id",b.INVENTORY_VIEW),this.subViewHelper.remove(b.PREVIEW_VIEW)},onPopupLinkClick:function(e){u.executeActionElement(e.currentTarget)},onPerformInventory:function(e){if(this.initialized&&!this.updateInProgress){if(this.clearHeader(),!this.portalURL)return void this._showConfigWarning();this.$(".btnInventory").button("loading"),this.updateInProgress=!0,!1===this.autoUpdateEnabled&&this.lcmFrameworkUpdatedNeed?this._promptForUserConfirmation():this._preformInventory()}},_preformInventory:function(){var e=this,t=new o;t.setRPCParams(o.LCM_ACTIONS.PERFORM_INVENTORY,this.portalURL),t.save().done(function(){if(t.hasErrorResponse())e.showError(t.getParsedErrorResponse());else{var i=t.getReturnResponse();e._render({lcmTaskId:i})}}).always(function(){e._resetUpgradeInProgress()})},_checkFrameworkStatus:function(e){var t=this,i=new o;i.setRPCParams(o.LCM_ACTIONS.IS_LCM_UPDATE_NEEDED),this.lcmFrameworkUpdatedNeed=!0,i.save().done(function(){if(i.hasErrorResponse()){var n=i.getParsedErrorResponse();t.initialized=!0,t._render(e),t.showError(n)}else t.lcmFrameworkUpdatedNeed=!!i.getReturnResponse(),t.initialized=!0,t._render(e)}).fail(function(i){t.initialized=!0,t._render(e),t.showError(i)})},_promptForUserConfirmation:function(){var e=M(this.vtOptions({})),t=!1;$.nutanixConfirm({msg:this.i18n("autoUpdateConfirm"),yes:function(){var e=this;t&&_.size(this.config)?this._upgradeConfig(function(){e._preformInventory()}):this._preformInventory()},no:function(){this._resetUpgradeInProgress()},class:"modal-lcm",yesText:this.i18n("ok"),noText:this.i18n("cancel"),extHTML:e||"",captcha:function(){return t=$("#nutanixConfirmModal #lcm-auto-update-enabled").is(":checked"),!0},context:this})},_upgradeConfig:function(e){var t=this,i={timestamp:this.config[o.DP.NEXT_UPDATE],intervalDays:this.config[o.DP.INTERVAL_DAYS]};i.autoUpdateEnabled=!0;var n=new o;n.setRPCParams(o.LCM_ACTIONS.CONFIGURE,this.portalURL,i),n.save().done(function(){if(n.hasErrorResponse()){var i=n.getParsedErrorResponse();t.showError(i),t._resetUpgradeInProgress()}else n.getReturnResponse()?(t.autoUpdateEnabled=!0,e()):e()}).fail(function(e){t.showError(e),t._resetUpgradeInProgress()})},_resetUpgradeInProgress:function(){this.updateInProgress=!1,this.$(".btnInventory").button("reset")},onCancelSelection:function(e){var t=this.subViewHelper.get(b.PREVIEW_VIEW)||this.subViewHelper.get(this.currentTabId);if(t){t.$(".close-drill-down-view-link").click()}},onSaveSelection:function(e){var t=this.subViewHelper.get(b.PREVIEW_VIEW)||this.subViewHelper.get(this.currentTabId);if(t){var i=t.$(".close-drill-down-view-link");i.attr(E.NAV_ACTION,E.ACTION_UPDATE),i.click()}},lcmConfigUpdated:function(e,t){if(e.type===T.ENTITIES_UPDATED&&t.entityType===E.ENTITY_LCM)if(t.portalURL){this.clearHeader();var i=this.portalURL!==t.portalURL;this.portalURL=t.portalURL;var n=t.configValue,s=this.autoUpdateEnabled;this.autoUpdateEnabled=n.autoUpdateEnabled,this.config[o.DP.INTERVAL_DAYS]=n.intervalDays,this.config[o.DP.NEXT_UPDATE]=n.timestamp,(i||!1===s&&this.autoUpdateEnabled&&this.lcmFrameworkUpdatedNeed)&&(this.initialized=!1,this.loadRootTask())}else t.task&&this.updateTaskProgress(t.task)},onEntityChanged:function(e,t){if(this.$(".lcm-content-wrapper").attr("view-id")!==b.PREVIEW_VIEW&&this.canModify&&(e.type===T.ENTITIES_CREATED||e.type===T.ENTITIES_DELETED)&&t.entityType===E.ENTITY_LCM_VERSION){var i=this.$(".btnUpdateSelection");t.entity.hasEmptySelection()?(i.attr("data-id",r.SELECT_MODES.ALL),i.html(r.SELECT_MODES.ALL)):(i.attr("data-id",r.SELECT_MODES.SELECTED),i.html(r.SELECT_MODES.SELECTED))}},_showPlanMessages:function(e,t,i){if(e.hasErrorResponse())e.hasErrorResponse()?this.showError(e.getParsedErrorResponse(D(this.vtOptions()))):this.showError(D(this.vtOptions()));else{var n={};n[t.DP.REQUEST_LIST]=i,n[t.DP.PLAN_MESSAGE]=e.getReturnResponse(),t.setUpdatePlan(n),this.showPreview(t)}},_promptForCredential:function(e,t,i){$.nutanixConfirm({msg:"",yes:function(){var e=this._getAuthDetailsInputValues(),n=[t];n.push(e.hostDetails),n.push(e.username),n.push(e.password),this._performUpdate(i,n)},no:function(){this.$(".btnStartUpdate").button("reset")},yesText:this.i18n("ok"),noText:this.i18n("cancel"),class:"modal-lcm",extHTML:e||"",captcha:function(){if(null!==e){var t=this._getAuthDetailsInputValues();return!_.some(t,function(e){return _.isEmpty(e)})||($("#nutanixConfirmModal .n-popup-captcha-error").html(this.i18n("AllFieldsAreRequired")).show(),!1)}return!0},context:this})},_confirmUpdate:function(e,t,i){$.nutanixConfirm({msg:P({msgs:e,action:"Update"}),yes:function(){this._performUpdate(t,i)},no:function(){this.$(".btnStartUpdate").button("reset")},yesText:"Update",noText:"No",class:"modal-lcm",context:this})},_getAuthDetailsInfo:function(e){var t=null;return _.some(e,function(e){return e===E.SOFTWARE_RELEASES_HYP_TYPE.ESXI})&&(t=I({serverDetails:O(this.vtOptions())})),t},_getAuthDetailsInputValues:function(){return{hostDetails:$("#nutanixConfirmModal .host-details").val().trim(),username:$("#nutanixConfirmModal .username-auth").val().trim(),
password:$("#nutanixConfirmModal .password-auth").val().trim()}},_performUpdate:function(e,t){var i=this;if(this.initialized&&!this.updateInProgress){this.clearHeader(),this.showHeaderSaving("Updating");var n=new o;n.setRPCParams(o.LCM_ACTIONS.PERFORM_UPDATE,this.portalURL,e,t),this.updateInProgress=!0,n.save().done(function(){i._updateCompleted(n,e)}).always(function(){i.updateInProgress=!1,i.$(".btnStartUpdate").button("reset")})}},_getManagementServerTypeFromResponses:function(e){var t=[];return _.each(e,function(e){var i=e[1];i&&t.indexOf(i)<=0&&t.push(i)}),t},_updateCompleted:function(e,t){this.setRootTask(e,{requestList:t})},_showConfigWarning:function(){this.showHeaderWarning("A portal URL has not been configured. <br>"+w(this.vtOptions({actionAttributes:g.createActionAttr(E.ENTITY_LCM,E.ACTION_UPDATE)})))},_showUpdateTaskStatus:function(e){var t=e&&e.currentTask,i=t?t.parentTask:null;if(i&&!i.isStatusComplete()){var n=i.getFailedTaskMessageWithKBLink();return this.showError(n),i.get(p.TASK_TYPE)===E.TASK_OPERATION_LCM.LCM_UPDATE_OPERATION}return!1},getSelectableClusters:function(){var e=[];return e.push({id:E.FILTER_NULL_VALUE,name:E.MULTICLUSTER_NAME}),e},createClusterSelector:function(){this.clusterSelector=new n({el:".clusterSelector",inputType:n.INPUT_TYPES.SELECT,initalSelectPrompt:this.i18n("selectCluster"),selectedItems:_.clone(this.clusterIds||[]),selectableItems:this.getSelectableClusters(),itemNameLookupFunc:this.getClusterName,customClass:"modal-autocomplete",readOnly:!1}),this.clusterSelector.onSelectionChangeEvent(this.selectionChangeEvent),this.clusterSelector.render()},getClusterName:function(e){return e===E.FILTER_NULL_VALUE?E.MULTICLUSTER_NAME:this.clusterManager.getNameById(e)||this.i18n("unnamed")},selectionChangeEvent:function(e){var t=this,i=this.clusterSelector.getSelectedItems()||[];this.clusterIds=_.clone(i),this.setLCMModelFilter(),this.model.fetch().done(function(){t.renderLCMContents()})},hasNoUpdates:function(e,t){var i=e.length<=0||t.length<=0;if(this.clusterManager.isMulticlusterNavMode()&&!i){i=!_.some(t.models,function(e){var t=e.get(e.UIDP.VERSIONS_BY_ENTITY);return t&&_.size(t)})}return i},onStartServices:function(){this.reactComponent&&this.reactComponent.onStartServices&&this.reactComponent.onStartServices({startService:!0,stopService:!1})},onStopServices:function(){this.reactComponent&&this.reactComponent.onStopServices&&this.reactComponent.onStopServices({startService:!1,stopService:!0})}})}),define("views/pages/lcm/LCMView",["views/basecomponents/BaseView","views/popups/lcm/LCMPopupView","models/genesis/LCMActionModel","utils/AppUtil","utils/CommonTemplates","utils/SubViewHelper"],function(e,t,i,n,s,a){"use strict";return e.extend({waitingForFramework:!1,initialize:function(t){e.prototype.initialize.apply(this,arguments),this.subViewHelper=new a,this.initialized=!1,this.waitingForFramework=!1,this.name="LCMView",this.uiVersion=null,this.lcmAppEnabled=!1},render:function(){if(this.initialized){this.subViewHelper.removeAll();var e=new t({el:this.$el,standaloneView:!0,lcmAppEnabled:this.lcmAppEnabled});e.render(),this.subViewHelper.register("lcmView",e)}else this.waitingForFramework?(this.$el.html('<div class="waiting-div"/>'),this.$(".waiting-div").html(s.LOADING_MSG({msg:this.i18n("waitingForFramework")}))):this.$el.html(s.LOADING_MSG({msg:this.i18n("loading")}))},loadLCMConfig:function(){var e=this,t=new i;t.setRPCParams(i.LCM_ACTIONS.GET_CONFIG),t.save().done(function(){if(t.hasErrorResponse())n.log(t.getErrorResponse()),e.initialized||(e.waitingForFramework=!0,e.render());else{var s=t.getReturnResponse();if(s){var a=!e.initialized,r=s[i.DP.UI_VERSION],o=s[i.DP.LCM_UI_APP_ENABLED]||!1;null!==r&&r!==e.uiVersion&&(e.uiVersion=r,a=!0),o!==e.lcmAppEnabled&&(e.lcmAppEnabled=o,a=!0),e.initialized=!0,e.waitingForFramework=!1,a&&e.render()}else e.initialized||(e.waitingForFramework=!0,e.render())}e.waitingForFramework&&(e.timerId=setTimeout(function(){e.loadLCMConfig()},5e3))})},destroy:function(){this.subViewHelper.destroy(),e.prototype.destroy.apply(this)},onStartServices:function(){this.loadLCMConfig(),this.subViewHelper.iterate("onStartServices")},onStopServices:function(){this.timerId&&clearTimeout(this.timerId),this.subViewHelper.iterate("onStopServices")}})}),define("views/pages/lcm/LCMPageView",["views/basecomponents/pages/BasePageView","views/pages/lcm/LCMView","utils/AppConstants"],function(e,t,i){"use strict";return e.extend({pageId:i.PAGE_LCM,defaultSubPageId:i.SUBPAGE_PERSPECTIVE,onShowSubPage:function(e,n){var s=this.getSubView(i.SUBPAGE_PERSPECTIVE);s||(s=this.registerSubView(i.SUBPAGE_PERSPECTIVE,new t({el:this.getSubPageElement(i.SUBPAGE_PERSPECTIVE)})),s.render()),s.showView(n),s.startServices()}})}),define("app/scripts/pages",function(){});