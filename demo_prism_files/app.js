function _defineProperty(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function _defineProperty(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function _defineProperty(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function _defineProperty(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function _defineProperty(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function _defineProperty(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function _defineProperty(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function _defineProperty(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function _defineProperty(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function _defineProperty(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function _defineProperty(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function _defineProperty(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function _defineProperty(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function _defineProperty(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function _defineProperty(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function _defineProperty(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function _defineProperty(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function _defineProperty(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function _defineProperty(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function _defineProperty(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function _defineProperty(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function _defineProperty(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function _defineProperty(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function _defineProperty(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,i=Array(e.length);t<e.length;t++)i[t]=e[t];return i}return Array.from(e)}function _defineProperty(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function _defineProperty(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function _defineProperty(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function _defineProperty(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function _defineProperty(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function _defineProperty(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function _defineProperty(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function _defineProperty(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function _defineProperty(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function _defineProperty(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function _defineProperty(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function _defineProperty(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function _defineProperty(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function _defineProperty(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function _defineProperty(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function _defineProperty(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function _defineProperty(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function _defineProperty(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function _defineProperty(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function _defineProperty(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function _defineProperty(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function _defineProperty(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function _defineProperty(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function _defineProperty(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function _defineProperty(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function _defineProperty(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function _defineProperty(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,i=Array(e.length);t<e.length;t++)i[t]=e[t];return i}return Array.from(e)}require.config({waitSeconds:30,urlArgs:"_=1562395276611",paths:{components:"app/scripts/components",data:"app/scripts/data",events:"app/scripts/events",managers:"app/scripts/managers",models:"app/scripts/models",plugins:"app/scripts/plugins",routers:"app/scripts/routers",utils:"app/scripts/utils",views:"app/scripts/views",broker:"app/scripts/broker",templates:"app/templates",extras:"app/extras",jqueryplugins:"app/scripts/plugins/jqueryplugins",graphql:"app/scripts/plugins/graphql/graphql",jquery:"lib/jquery-1.7.1/jquery-1.7.1",underscore:"lib/underscore-1.3.3/underscore-1.3.3",backbone:"lib/backbone-0.9.2/backbone-0.9.2",bootstrap:"lib/bootstrap-2.2.1/js/bootstrap",text:"lib/require-2.0.2/text-2.0.0",xml:"lib/require-2.0.2/xml-2.0.0",bean:"lib/flotr2/bean",flotr2:"lib/flotr2/flotr2.amd",d3:"lib/d3.v3/d3.v3",nvd3:"lib/nvd3-1.1.15/nv.d3",d3tip:"lib/d3-tip/index","d3-array":"lib/d3-extras/d3-array/d3-array.v1","d3-path":"lib/d3-extras/d3-path/d3-path.v1",d3chord:"lib/d3-extras/d3-chord/d3-chord.v1",datatables:"lib/datatables/js/jquery.dataTables",colresize:"lib/colresize/dataTables.colResize",parsimmon:"lib/parsimmon/parsimmon.browser",datejs:"lib/datejs/date",gridster:"lib/gridster/js/jquery.gridster",bootstraptoggles:"lib/bootstrap-toggles/js/jquery.toggle.buttons",IdpSessionIframe:"lib/nutanix/idp-session-frame/js/idp-session-frame",jqueryui:"lib/jquery-ui-1.8.24/ui-amd",jqrangeslider:"lib/jqrange-slider/jQAllRangeSlider-AMD",antiscroll:"lib/antiscroll/js/antiscroll",hoverintent:"lib/hoverintent/js/jquery.hoverIntent",scrollintoview:"lib/scrollintoview/js/jquery.scrollIntoView",datepicker:"lib/datepicker/js/bootstrap-datepicker",timepicker:"lib/timepicker/js/bootstrap-timepicker",fancyselect:"lib/fancy-select/fancySelect",particleground:"lib/particleground/jquery.particleground",sparkmd5:"lib/spark-md5-0.0.5/spark-md5",sprintf:"lib/sprintf/sprintf",bluebird:"lib/bluebird-3.4.7/bluebird",messageformat:"lib/messageformat-1.1.1/index",moment:"lib/moment/moment-with-locales.min",momentTimeZone:"lib/moment/moment-timezone-with-data.min",nutanixListDropdown:"lib/nutanix/components/list-dropdown/nutanixListDropdown",nutanixMoreInfo:"lib/nutanix/components/more-info/moreInfo",CommonUtils:"lib/prism-utils-common/index"},shim:{underscore:{exports:"_"},backbone:{deps:["underscore","jquery"],exports:"Backbone"},bootstrap:{deps:["jquery"],exports:"Bootstrap"},datatables:{deps:["jquery"],exports:"DataTables"},gridster:{deps:["jquery"],exports:"Gridster"},bootstraptoggles:{deps:["jquery"],exports:"bootstraptoggles"},antiscroll:{deps:["jquery"],exports:"antiscroll"},hoverintent:{deps:["jquery"],exports:"HoverIntent"},scrollintoview:{deps:["jquery"],exports:"scrollintoview"},datepicker:{deps:["jquery"],exports:"DatePicker"},fancyselect:{deps:["jquery"],exports:"fancyselect"},jqueryplugins:{deps:["jquery"],exports:"jqueryplugins"},d3:{exports:"d3"},nvd3:{deps:["d3"],exports:"nv"},d3tip:{deps:["d3"],exports:"d3tip"},"d3-array":{deps:["d3"],exports:"d3-array"},"d3-path":{deps:["d3"],exports:"d3-path"},d3chord:{deps:["d3"],exports:"d3chord"},particleground:{deps:["jquery"],exports:"particleground"},sparkmd5:{exports:"SparkMD5"},nutanixListDropdown:{deps:["jquery"],exports:"nutanixListDropdown"},sprintf:{exports:"sprintf"},nutanixMoreInfo:{deps:["underscore","jquery","bootstrap"],exports:"nutanixMoreInfo"},moment:{exports:"moment"},momentTimeZone:{deps:["moment"],exports:"momentTimeZone"}}}),localStorage&&localStorage.getItem&&"true"===localStorage.getItem("disable_cache_busting")&&require.config({urlArgs:""}),define("app/scripts/config",function(){}),define("utils/LibOverrideUtil",["underscore"],function(e){"use strict";!function(){var t=e.template;e.template=function(e,i,n){var s=/<%[^<%=]*(=>|\Wconst |\Wlet |`|\.{3})[^%>]*%>/g,a=s.exec(e);if(a&&a.length>0)throw new Error('Disallowed ES6 syntax "'+a[1]+'" found in underscore template.');return t.apply(this,arguments)}}()}),require(["backbone","bootstrap","jquery","jqueryplugins","underscore","utils/LibOverrideUtil"],function(e,t,i,n,s,a){"use strict"}),define("app/scripts/common",function(){}),define("utils/DataExportUtil",["utils/StatsUtil","utils/AppConstants","utils/AppUtil","utils/TimeUtil","managers/I18nManager","managers/PrismElementManager"],function(e,t,i,n,s,a){"use strict";var r=_.template("data:<%= mimeType %>;charset=utf-8,<%= data %>");return{MIME_TYPE:{PLAINTEXT:"text/plain",CSV:"text/csv;charset=utf-8;",JSON:"application/json",ATTACHMENT:"attachment/file",PDF:"application/pdf"},CRLF:"\r\n",LOADING_TEXT:s.t("DataExportUtil","downloading_msg"),DEFAULT_FILENAME:"data",_getMimeType:function(e){switch(e){case"csv":return this.MIME_TYPE.CSV;case"json":return this.MIME_TYPE.JSON;case"txt":case"text":return this.MIME_TYPE.PLAINTEXT;case"pdf":return this.MIME_TYPE.PDF;default:return i.log("DataExportUtil | Unsupported type: "+e),""}},openExportWindow:function(){var e=a.isLoadedFromPrismCentral()?"_top":"_blank";return window.open(r({mimeType:this.MIME_TYPE.PLAINTEXT,data:this.LOADING_TEXT}),e)},getWinRef:function(){var e=null;return i.getBrowser()===t.BROWSER_AGENT.SAFARI&&(e=this.openExportWindow()),e},_export:function(e,t){var n=e.type,s=e.data,a="."+n;e.hasOwnProperty("fileExtension")&&(a=e.fileExtension.length?"."+e.fileExtension:"");var o=(e.filename||this.DEFAULT_FILENAME)+a;"json"===n&&(s=JSON.stringify(s));var l=this._getMimeType(n);if(t)t.location=r({mimeType:this.MIME_TYPE.ATTACHMENT,data:encodeURIComponent(s)}),setTimeout(function(){t.close()},100);else if(Blob){var c=new Blob([s],{type:l,endings:"native"});this._saveAs(c,o)}else{var u=window.frames.saveTxtWindow;if(!u&&(u=document.createElement("iframe"),u.id="saveTxtWindow",u.style.display="none",document.body.insertBefore(u,null),!(u=window.frames.saveTxtWindow)&&!(u=window.open("","_temp","width=100,height=100"))))return void i.log("DataExportUtil | Failed to export "+n);var d=u.document;d.open("text/html","replace"),d.charset="utf-8",d.write(s),d.close();var h=d.execCommand("SaveAs",null,o+".txt");u.close(),h||i.log("DataExportUtil | Failed to export "+n)}},_saveAs:function(e,t){t=t||this.DEFAULT_FILENAME;var n=e;if(/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(e.type)&&(n=new Blob(["\ufeff",e],{type:e.type,endings:"native"})),"undefined"!=typeof navigator&&navigator.msSaveOrOpenBlob)return navigator.msSaveOrOpenBlob(n,t);var s=document.createElementNS("http://www.w3.org/1999/xhtml","a");"download"in s?setTimeout(function(){s.href=(URL||window.webkitURL).createObjectURL(n),s.download=t,s.dispatchEvent(new MouseEvent("click"))},10):i.log("DataExportUtil | Failed to export: "+t)},exportChartCSV:function(e,i,a,r,o){var l=this.CRLF,c="",u=[],d=s.t("DataExportUtil","time_header")+","+s.t("DataExportUtil","timestamp_header");_.each(e,function(e){var t=this.formatTitle(e.title,"raw"),i=this.formatTitle(e.title,"display");d+=","+t+","+i,u.push(t),u.push(i)},this),c+=d+l;var h=this._chartDataMap(e,i,!0,r,o);_.each(h,function(e,i){var s=Number(i),a='"'+n.formatDateTime(s||0)+'"',r=a+","+i;_.each(u,function(i){var n=e[i];n&&_.isString(n)&&n.indexOf(",")>-1&&(n='"'+n+'"'),r+=","+(n||t.STATS_NOT_AVAILABLE)}),c+=r+l}),this._export({type:"csv",data:c},a)},exportBarChartCSV:function(e,i,n){var s=this.CRLF,a="",r=[],o="";_.each(e,function(e,t){var i=this.formatTitle(e.title,"raw"),n=this.formatTitle(e.title,"display");t>0&&(o+=","),o+=i+","+n,r.push(i),r.push(n)},this),a+=o+s;var l=this._barChartDataMap(e,i);_.each(l,function(e){var i="";_.each(r,function(n,s){s>0&&(i+=","),i+=e[n]||t.STATS_NOT_AVAILABLE}),a+=i+s}),this._export({type:"csv",data:a},n)},formatTitle:function(e,t){return s.ts("DataExportUtil",t+"_value",e)},exportChartJSON:function(e,t,i,n,s){this._export({type:"json",data:this._chartDataMap(e,t,!1,n,s)},i)},exportBarChartJSON:function(e,t,i){this._export({type:"json",data:this._barChartDataMap(e,t)},i)},_chartDataMap:function(t,i,s,a,r){var o=this,l={};return _.each(i,function(i){if(i.enabled){var c=_.find(t,function(e){return e.objectId===i.id}),u=c.data;_.each(u,function(t){var u=t[0];if(!(u<a||u>r)){var d=s?u:n.formatDateTime(u>0?u:0),h=l[d];h||(h={},l[d]=h),h[o.formatTitle(i.title,"raw")]=t[1],h[o.formatTitle(i.title,"display")]=t[2]||e.statsFormat(c.objectId,parseFloat(t[1]),!0)}})}}),l},_barChartDataMap:function(t,i){var n={};return _.each(i,function(i,s){if(i.enabled)for(var a=_.find(t,function(e){return e.objectId===i.id}),r=a.data,o=0;o<r.length;o++){var l=r[o],c=n[o];c||(c={},n[o]=c),c[this.formatTitle(i.title,"raw")]=l[0],c[this.formatTitle(i.title,"display")]=l[1]||e.statsFormat(a.objectId,parseFloat(l[0]),!0)}},this),n},exportTableCSV:function(e,t,i,n){i=i||{};var s=this.CRLF,a=this._toTableArray(e,t),r="",o="";_.each(t,function(e,n){e=_.isString(e)?'"'+e+'"':e,o=e.exportTitle||e.sTitle,o=0===$.trim(o).length?"-":i.preserveTags?o:this.stripTags(o),r+=(n?",":"")+o+(n+1===t.length?s:"")},this);var l;_.each(a,function(e){_.each(t,function(n,a){o=this.stripTags(n.exportTitle||n.sTitle),l=e[o]||"",l=_.isString(l)?'"'+(i.preserveTags?l:this.stripTags(l))+'"':l,r+=(a?",":"")+l+(a+1===t.length?s:"")},this)},this),this._export({type:"csv",data:r},n)},exportData:function(e,t,i,n){this._export({data:e,filename:t,type:i,fileExtension:i,windowRef:n})},exportTableJSON:function(e,t,i){this._export({type:"json",data:this._toTableArray(e,t)},i)},stripTags:function(e,t){if("string"!=typeof e||0===e.trim().length)return e;t=(((t||"")+"").toLowerCase().match(/<[a-z][a-z0-9]*>/g)||[]).join("");var i=/<\/?([a-z][a-z0-9]*)\b[^>]*>/gi,n=/<!--[\s\S]*?-->/gi;return e.replace(n,"").replace(i,function(e,i){return t.indexOf("<"+i.toLowerCase()+">")>-1?e:""})},_toTableArray:function(e,i,n){n=n||{};var s,a,r,o,l,c=[];return _.each(e,function(e){s={},_.each(i,function(i){if(i.sTitle||i.exportTitle){if(a=i.exportTitle||i.sTitle,a=n.preserveTags?a:this.stripTags(a),_.isFunction(i.mData))r=i.mData(e,t.TABLE_COL_TYPE_EXPORT),_.isFunction(i.mRender)&&(r=i.mRender(r,t.TABLE_COL_TYPE_EXPORT,e));else if(i.mData)if(_.isFunction(i.mRender))r=i.mRender(e[i.mData],t.TABLE_COL_TYPE_EXPORT,e);else{o=i.mData?i.mData.split("."):"",l=e;for(var c=0;c<o.length;c++)l=l[o[c]];r=l}void 0!==r&&null!==r||(r=""),a&&(s[a]=n.preserveTags?r:this.stripTags(r))}},this),c.push(s)},this),c}}}),define("utils/DRaaSUtil",["utils/AppUtil","utils/AppConstants"],function(e,t){"use strict";function i(i,n){switch(t.HYPERVISOR[n]||n){case t.HYPERVISOR_TYPE.KVM:return e.compareVersions(i,t.DRAAS_AHV_VERSION)>=0;case t.HYPERVISOR_TYPE.ESXI:return e.getLocalStorageProperty(t.LOCAL_STORAGE.ENABLE_DR_ON_ESX)!==t.BOOLEAN_FALSE&&e.compareVersions(i,t.DRAAS_ESX_VERSION)>=0;default:return!1}}return{isDraasSupported:i}}),define("models/task/AcropolisTaskModel",["models/BaseModel","data/DataURLConstants","data/DataProperties","data/DataManager","utils/AppConstants"],function(e,t,i,n,s){"use strict";var a={OPERATION_TYPE:"operationType",CREATE_TIME:"createTime",START_TIME:"startTime",COMPLETE_TIME:"completeTime",PERCENTAGE_COMPLETE:"percentageComplete",PROGRESS_STATUS:"progressStatus",ENTITY_LIST:"entityList",META_RESPONSE:"metaResponse",ERROR_DETAIL:"errorDetail",VM_TASK_UUID:"taskUuid",TASK_INFO:"taskInfo",ENTITY_TYPE:"entityType",ENTITY_NAME:"entityName",MESSAGE:"message",PARENT_TASK_UUID:"parentTaskUuid",SUB_TASK_UUID_LIST:"subtaskUuidList",TASK_UUID:"taskUuid",V2_TASK_UUID:"task_uuid",V2_ERROR_DETAIL:"error_detail"},r={VmSetPowerState:"Set Power State",SnapshotCreate:"Create Snapshot",SnapshotDelete:"Delete Snapshot",VmClone:"Clone",VmCreate:"Create",VmDelete:"Delete",VmDiskCreate:"Create Virtual Disk",VmDiskDelete:"Delete Virtual Disk",VmDiskUpdate:"Update Virtual Disk",VmMigrate:"Migrate",VmNicCreate:"Create NIC",VmNicDelete:"Delete NIC",VmRestore:"Restore Snapshot",VmUpdate:"Update"},o={FAILED:"Failed",SUCCEEDED:"Succeeded",RUNNING:"Running",QUEUED:"Queued"};return e.extend({DP:a,TIMEOUT_SECONDS:30,DISPLAY_OPERATION:r,TASK_STATUS:o,idAttribute:i.ID,nameAttribute:i.NAME,urlRoot:t.MGMT_TASKS,name:"AcropolisTaskModel",entityType:s.ENTITY_ACROPOLIS_TASK,parseOptions:function(t,i,n){return n=e.prototype.parseOptions.apply(this,arguments),"read"===t&&this.actionMode===s.ACTION_POLL&&_.extend(n.data,{timeoutseconds:this.TIMEOUT_SECONDS}),n},getMetaResponseAttr:function(e){var t=this.get(a.META_RESPONSE);return t?t[e]:null},getDataSourceURL:function(){return n.getNutanixApiDataSourceURL()},getURL:function(){var e=this.url();return this.actionMode===s.ACTION_POLL?e+=_.template(t.MGMT_TASKS_POLL,{taskId:this.get(i.UUID)}):this.actionMode===s.ACTION_CLIENT_POLL&&(e+=_.template(t.MGMT_TASK,{taskId:this.get(i.UUID)})),e},getEntityTypes:function(){var e=this.get(a.ENTITY_LIST);return _.map(e,function(e){return e[a.ENTITY_TYPE].toLowerCase()},this)}},{DP:a,DISPLAY_OPERATION:r,TASK_STATUS:o})}),define("models/PollingDiffCollection",["models/PollingCollection","utils/AppConstants","utils/FilterUtil"],function(e,t,i){"use strict";return e.extend({name:"PollingDiffCollection",isResetData:!1,latestTimestampProp:null,latestTimestampPropFilter:null,latestTimestampValue:null,prependDiffModels:!1,initialize:function(t,i){if(!this.latestTimestampProp)throw new Error("Specify latestTimestampProp.");this.latestTimestampValue=0,e.prototype.initialize.apply(this,arguments)},fetch:function(t,i){return void 0===i&&(i=this.getFilterCriteriaForDiff()),this.setFilterCriteria(i),e.prototype.fetch.apply(this,arguments)},getFilterCriteriaForDiff:function(){if(this.latestTimestampValue&&this.isResetData){var e=this.latestTimestampPropFilter||this.latestTimestampProp;return i.filterConditionToFIQL(e,{op:t.FILTER_OPERATORS.GREATER_THAN,value1:this.latestTimestampValue})}return null},reset:function(t,i){return i=i||{},this.latestTimestampValue=this.getLatestTimestamp(t),this.isResetData&&!i.forceReset?this.mergeModels(t,i):(this.isResetData=!0,e.prototype.reset.apply(this,arguments))},mergeModels:function(e,t){var i=[];if(_.each(e,function(e){var n=this._prepareModel(e,t),s=this.get(n.getId());s?s.set(e,{silent:!0}):i.push(e)},this),i&&i.length){var n={silent:!0,at:this.prependDiffModels?0:null};this.add(i,_.extend(n,t))}return t.silent||this.trigger("reset",this,t),this},getLatestTimestamp:function(e){var t=this.latestTimestampValue;return _.each(e,function(e){e[this.latestTimestampProp]>t&&(t=e[this.latestTimestampProp])},this),t}})}),define("models/task/TaskModel",["models/PollingModel","data/DataURLConstants","data/DataProperties","utils/AppConstants","utils/AppUtil","utils/TimeUtil"],function(e,t,i,n,s,a){"use strict";return e.extend({idAttribute:i.TASK_ID,nameAttribute:i.TASK_TYPE,urlRoot:t.TASK,name:"TaskModel",entityType:n.ENTITY_TASK,getValue:function(t){var s=void 0;switch(t){case i.TASK_DURATION:s=this.getDurationTime();break;case i.TASK_CLUSTER_NAME:s=this.getClusterName();break;case i.TASK_END_TIME:case i.TASK_START_TIME:case i.TASK_CREATE_TIME:var r=this.get(t);s=r?a.formatLocaleDateTime(r/1e3):n.INVALID_STRING;break;default:s=e.prototype.getValue.apply(this,arguments)}return s},getDurationTime:function(){var e=this.get(i.TASK_CREATE_TIME)||this.get(i.TASK_START_TIME),t=this.get(i.TASK_END_TIME),a=t-e;if(isNaN(a)||a<=0)return n.INVALID_STRING;var r={timestamp:a/1e3,isDelta:!0,secondDetail:!0,shortFormDateMetric:!1,showNumUnits:2,includeAgo:!1};return s.getElapsedTime(r)},getClusterName:function(e){var t=this.get(i.TASK_CLUSTER_UUID),s=this.clusterManager.getClusterModelByClusterUuid(t);return s?s.getName():this.isPublisherPrismCentral()?n.MULTICLUSTER_NAME:e?"":n.INVALID_STRING},getCreatedTimestamp:function(){var e=this.get(i.TASK_CREATED_TIMESTAMP);return e&&e>0?e/1e3:0},getPercentage:function(){return this.get(i.TASK_PERCENT_COMPLETE)},getPercentageDisplay:function(){var e=this.get(i.TASK_PERCENT_COMPLETE);return e=s.isDisplayableNumber(e)?Math.floor(this.get(i.TASK_PERCENT_COMPLETE))+"%":n.STATS_NOT_AVAILABLE},isPublisherPrismCentral:function(){var e=!1;return this.get(i.TASK_COMPONENT)===n.TASK_COMPONENTS.PRISM_CENTRAL||this.get(i.TASK_COMPONENT)===n.TASK_COMPONENTS.SCHEDULE_JOB?e=!0:_.isEmpty(this.get(i.TASK_COMPONENT))&&this.collection&&this.collection.isMulticlusterVMTask&&(e=!0),e},getType:function(){return this.get(i.TASK_TYPE)},isFanOut:function(){return this.get(i.TASK_TYPE)===n.TASK_OPERATION_FANOUT},getMessage:function(){return this.get(i.TASK_MESSAGE)||this.get(i.SUB_TASK_MESSAGE)},getErrorMessage:function(){return this.get(i.TASK_DISPLAY_ERROR)},getErrorCode:function(){return this.get(i.TASK_ERROR_CODE)},getFailedTaskMessageWithKBLink:function(){var e=this.getMessage();return this.isStatusFailed()?s.generateKBLinkFromMessage(e):e},_statusChecker:function(e){return(this.get(i.TASK_STATUS)||"").toLowerCase()===e},isStatusActive:function(){return this._statusChecker(n.TASK_STATUS_ACTIVE)},isStatusComplete:function(){return this._statusChecker(n.TASK_STATUS_COMPLETE)},isStatusCanceled:function(){return this._statusChecker(n.TASK_STATUS_CANCELED)},isStatusFailed:function(){return this._statusChecker(n.TASK_STATUS_FAILED)},isStatusQueued:function(){return this._statusChecker(n.TASK_STATUS_QUEUED)},isStatusAborted:function(){return this._statusChecker(n.TASK_STATUS_ABORTED)},isTaskCompleted:function(){return this.isStatusAborted()||this.isStatusFailed()||this.isStatusCanceled()||this.isStatusComplete()},isStatusCategoryRunning:function(){return this.isStatusActive()||this.isStatusQueued()},isStatusCategorySucceeded:function(){return this.isStatusComplete()},isStatusCategoryFailed:function(){return this.isStatusFailed()||this.isStatusCanceled()||this.isStatusAborted()},isDeleteEnabled:function(){return this.get(this.idAttribute)&&!(this.isStatusQueued()||this.isStatusActive())},isPreupgradeCheckTask:function(){return this.isUpgradeTask()&&this.getValue(i.TASK_ENTITY_TYPE)===n.ENTITY_CLUSTER&&(this.get(i.TASK_NAME)||"").toLowerCase().indexOf("preupgrade")>-1},isUpgradeTask:function(){var e=this.get(i.TASK_TYPE)||"";return 0===e.indexOf(n.TASK_OPERATION_UPGRADE)||0===e.indexOf(n.TASK_OPERATION_TYPES[n.UPGRADE_SOFTWARE_TYPE.FILE_SERVER])},isFileServerUpgradeTask:function(){return 0===(this.get(i.TASK_TYPE)||"").indexOf(n.TASK_OPERATION_TYPES[n.UPGRADE_SOFTWARE_TYPE.FILE_SERVER])},isClientSideClusterUpgradeTask:function(){return 0===(this.get(i.TASK_TYPE)||"").indexOf(n.TASK_OPERATION_CLUSTER_UPGRADE)},isClusterUpgradeTask:function(){return this.isUpgradeTask()||this.isClientSideClusterUpgradeTask()},isEncryptionTask:function(){switch(this.get(i.TASK_TYPE)){case n.TASK_OPERATION_PROTECT:case n.TASK_OPERATION_UNPROTECT:case n.TASK_OPERATION_REKEY:case n.TASK_OPERATION_SW_REKEY:return!0;default:return!1}},isPcDeploymentTask:function(){return 0===this.get(i.TASK_TYPE).indexOf(n.TASK_OPERATION_PC_DEPLOYMENT)},isIntentUpdateClusterTask:function(){return 0===this.get(i.TASK_TYPE).indexOf(n.TASK_UPDATE_CLUSTER_INTENTFUL)},isTaskOfType:function(e){return 0===this.get(i.TASK_TYPE).indexOf(e)},isRemotePcDeploymentTask:function(){return 0===this.get(i.TASK_TYPE).indexOf(n.TASK_OPERATION_REMOTE_PC_DEPLOYMENT)},isPCAddNodeTask:function(){return 0===this.get(i.TASK_TYPE).indexOf(n.TASK_OPERATION_PC_ADD_NODE)},isOldTask:function(){return this.get(i.TASK_IS_OLD_TASK)},isScheduleJob:function(){return this.get(i.TASK_COMPONENT)===n.TASK_COMPONENTS.SCHEDULE_JOB},isPreupgradeNOS:function(){return this.isPreupgradeCheckTask()&&this.get(i.TASK_TYPE)===n.TASK_OPERATION_TYPES.nos},isPreupgradeHypervisor:function(){return this.isPreupgradeCheckTask()&&this.get(i.TASK_TYPE)===n.TASK_OPERATION_TYPES.hypervisor},isPreupgradeFirmware:function(){return this.isPreupgradeCheckTask()&&this.get(i.TASK_TYPE)===n.TASK_OPERATION_TYPES.disk},isPreupgradeNCC:function(){return this.isPreupgradeCheckTask()&&this.get(i.TASK_TYPE)===n.TASK_OPERATION_TYPES.ncc},isIgnoreDisplayOnFailure:function(){return this.get(i.TASK_IGNORE_FAILURE)}})}),define("models/task/TaskCollection",["managers/ClusterManager","models/PollingDiffCollection","models/task/TaskModel","data/DataProperties","data/DataURLConstants","utils/AppConstants","utils/AppUtil","utils/FilterUtil","events/AppEvents"],function(e,t,i,n,s,a,r,o,l){"use strict";return t.extend({model:i,url:s.TASK,name:"TaskCollection",latestTimestampProp:n.TASK_LAST_UPDATE_TIME,latestTimestampPropFilter:n.TASK_NEW_LAST_UPDATE_TIME,prependDiffModels:!0,_upgradeTasks:null,_clusterUpgradeTaskModels:null,_clusterSEDTaskModel:null,isGlobal:!1,_allTaskFetched:!1,_isAboutToFetchAllTasks:!1,percentTasksUnsyncdEntites:99,preFetch:function(){this.isGlobal&&l.triggerAppEvent(l.TASK_GLOBAL_FETCH)},startPolling:function(e){this.on("reset",this.restructureModels,this),t.prototype.startPolling.apply(this,arguments)},stopPolling:function(){t.prototype.stopPolling.apply(this,arguments),this.off("reset",this.restructureModels,this)},reset:function(e,i){this._isAboutToFetchAllTasks&&(this._allTaskFetched=!0),t.prototype.reset.apply(this,arguments)},getLatestTimestamp:function(e){var t=this.latestTimestampValue;return _.each(e,function(e){e[n.TASK_PERCENT_COMPLETE]===this.percentTasksUnsyncdEntites&&(e[this.latestTimestampProp]<t||0===t)?t=e[this.latestTimestampProp]:e[this.latestTimestampProp]>t&&(t=e[this.latestTimestampProp])},this),t},restructureModels:function(t){t=t||{};var s,o,l,c,u,d,h,p,T=[],E={},S=[],g=0;E[a.TASK_STATUS_COMPLETE]=1,E[a.TASK_STATUS_QUEUED]=2,E[a.TASK_STATUS_ACTIVE]=3,E[a.TASK_STATUS_FAILED]=4,E[a.TASK_STATUS_CANCELED]=5,E[a.TASK_STATUS_SKIPPED]=6,E[a.TASK_STATUS_ABORTED]=7,this._upgradeTasks=[],this._clusterUpgradeTaskModels=[];var A;if(this.each(function(t){t.isMulticlusterVMTask=this.isMulticlusterVMTask,t.isFileServerUpgradeTask()?(!A||A.get(n.TASK_CREATE_TIME)<t.get(n.TASK_CREATE_TIME))&&(A=t):t.isUpgradeTask()?(t.isPreupgradeCheckTask()||(s=t.toJSON(),s[n.SUB_TASK_MESSAGE]=t.get(n.TASK_NAME),s[n.SUB_TASK_TAG]=t.getValue(n.TASK_ENTITY_ID),s[n.SUB_TASK_COMPONENT]="genesis",o||(o=e.isMulticlusterNavMode()?t[n.CLUSTER_UUID]:e.getCurrentClusterId()),T.push(s)),this._upgradeTasks.push(t)):t.isEncryptionTask()&&(g+=Number(t.get(n.TASK_PERCENT_COMPLETE)),h=Math.min(h,t.get(n.TASK_CREATE_TIME))||t.get(n.TASK_CREATE_TIME),u=Math.min(u,t.get(n.TASK_START_TIME))||t.get(n.TASK_START_TIME),d=Math.max(c,t.get(n.TASK_END_TIME))||t.get(n.TASK_END_TIME),c=Math.max(c,t.get(n.TASK_LAST_UPDATE_TIME))||t.get(n.TASK_LAST_UPDATE_TIME),(!p||p<c)&&(l=t.get(n.TASK_TYPE),p=c),s=t.toJSON(),s[n.SUB_TASK_MESSAGE]=t.get(n.TASK_NAME),s[n.SUB_TASK_TAG]=t.getValue(n.TASK_ENTITY_ID),s[n.SUB_TASK_COMPONENT]="genesis",o||(o=e.isMulticlusterNavMode()?t[n.CLUSTER_UUID]:e.getCurrentClusterId()),S.push(s))},this),A){1e3*Date.now()-A.get(n.TASK_CREATE_TIME)<=a.RECENT_FILE_SERVER_UPGRADE_TASK_USECS&&(this._clusterUpgradeTaskModels.push(A),A&&A.get(n.TASK_SUB_TASKS)&&_.each(A.get(n.TASK_SUB_TASKS),function(e){this._upgradeTasks.push(new i(e))},this))}if(T.length){r.debug("TaskCollection : Upgrade tasks are present.");var m=_.groupBy(T,n.TASK_TYPE);_.each(m,function(e,t){var s=new i,l=t+o;s.set(s.idAttribute,l);var c,u,d,h,p=0,T=a.TASK_STATUS_COMPLETE;_.each(e,function(e){p+=Number(e[n.TASK_PERCENT_COMPLETE]),h=Math.min(h,e[n.TASK_CREATE_TIME])||e[n.TASK_CREATE_TIME],u=Math.min(u,e[n.TASK_START_TIME])||e[n.TASK_START_TIME],d=Math.max(c,e[n.TASK_END_TIME])||e[n.TASK_END_TIME],c=Math.max(c,e[n.TASK_LAST_UPDATE_TIME])||e[n.TASK_LAST_UPDATE_TIME];var t=e[n.TASK_STATUS];E[t]?E[t]>E[T]&&(T=t):r.log("TaskCollection: restructureModels: Invalid upgrade task status of "+t+". Skipping. ")}),s.isMulticlusterVMTask=this.isMulticlusterVMTask;var S=a.TASK_OPERATION_LABELS[t];s.set(n.TASK_NAME,S),s.set(n.TASK_DISPLAY_NAME,S),p=Math.floor(p/e.length),s.set(n.TASK_PERCENT_COMPLETE,p),s.set(n.TASK_TYPE,a.TASK_OPERATION_CLUSTER[t]),s.set(n.TASK_ENTITY_ID,o),s.set(n.TASK_ENTITY_TYPE,a.ENTITY_CLUSTER),s.set(n.TASK_STATUS,T),s.set(n.TASK_CREATE_TIME,h),s.set(n.TASK_START_TIME,u),s.set(n.TASK_END_TIME,100===p?d:null),s.set(n.TASK_LAST_UPDATE_TIME,c),s.set(n.TASK_SUB_TASKS,e),s.set(n.TASK_UPGRADE_OP,t),s.set(n.TASK_TYPE,t),this._clusterUpgradeTaskModels.push(s)},this)}return S.length&&(this._clusterSEDTaskModel=this._clusterSEDTaskModel||new i,this._clusterSEDTaskModel.isMulticlusterVMTask=this.isMulticlusterVMTask,this._clusterSEDTaskModel.set(n.TASK_NAME,a.TASK_LABEL_SED_OPERATION),this._clusterSEDTaskModel.set(n.TASK_DISPLAY_NAME,a.TASK_LABEL_SED_OPERATION),this._clusterSEDTaskModel.set(n.TASK_TYPE,l),this._clusterSEDTaskModel.set(n.TASK_ENTITY_ID,o),this._clusterSEDTaskModel.set(n.TASK_ENTITY_TYPE,a.ENTITY_CLUSTER),this._clusterSEDTaskModel.set(n.TASK_CREATE_TIME,h),this._clusterSEDTaskModel.set(n.TASK_START_TIME,u),this._clusterSEDTaskModel.set(n.TASK_END_TIME,100===g?d:null),this._clusterSEDTaskModel.set(n.TASK_LAST_UPDATE_TIME,c),this._clusterSEDTaskModel.set(n.TASK_SUB_TASKS,S)),this.hasActiveUpgradeTasks()?this.updateIntervalTime(a.TASK_UPGRADE_POLLING_INTERVAL):this.updateIntervalTime(this.intervalTimeInMilliSec),
t.silent||this.triggerResetStructure(),this},triggerResetStructure:function(){this.trigger(l.TASK_RESET_STRUCTURE,this)},getTask:function(e){return _.find(this.models,function(t){return t.get(n.TASK_ID)==e})},getTasksByEntityId:function(e){return _.filter(this.models,function(t){var i=t.get(n.TASK_ENTITY_ID);return _.contains(i,e)})},getAllTasks:function(e){var t;return e=e||{},e.isHostUpgradeSummarized&&this._upgradeTasks&&this._upgradeTasks.length?(r.debug("TaskCollection : Filter out upgrade host tasks."),t=this.filter(function(e){return!(e.isUpgradeTask()&&!e.isPreupgradeCheckTask())}),this._clusterUpgradeTaskModels&&this._clusterUpgradeTaskModels.length&&_.each(this._clusterUpgradeTaskModels,function(e){t.unshift(e)})):t=this.models,t},getSummarizedTasks:function(){return this.getAllTasks({isHostUpgradeSummarized:!0})},getUpgradeTasks:function(e){var t=a.TASK_OPERATION_TYPES[e];return t?_.filter(this._upgradeTasks,function(e){return e.get(n.TASK_TYPE)===t}):this._upgradeTasks},getLatestPcDeploymentTask:function(){return this.find(function(e){return e.isPcDeploymentTask()})},getLatestIntentUpdateClusterTask:function(){return this.find(function(e){return e.isIntentUpdateClusterTask()})},getLatestTaskForType:function(e){return this.find(function(t){return t.isTaskOfType(e)})},getLatestRemotePcDeploymentTask:function(){return this.find(function(e){return e.isRemotePcDeploymentTask()})},getLatestPCAddNodeTask:function(){return this.find(function(e){return e.isPCAddNodeTask()})},getClusterUpgradeTask:function(e){var t=a.TASK_OPERATION_TYPES[e];return _.find(this._clusterUpgradeTaskModels,function(i){return e===a.UPGRADE_SOFTWARE_TYPE.FILE_SERVER?0===i.get(n.TASK_TYPE).indexOf(t):i.get(n.TASK_UPGRADE_OP)===t})},getClusterSEDTaskModel:function(){return this._clusterSEDTaskModel},getLatestSEDOperationTasks:function(e){var t=this.getClusterSEDTaskModel();return e&&t?_.filter(t.get(n.TASK_SUB_TASKS),function(t){return t[n.TASK_TYPE]===e}):null},hasActiveUpgradeTasks:function(e){return!!_.find(this.getUpgradeTasks(e),function(e){return e.isStatusActive()||e.isStatusQueued()})},getClusterConvertTask:function(){return _.find(this.models,function(e){return e.get(n.TASK_TYPE)===a.TASK_OPERATION_CONVERT_NODE})},getActiveNodeConvertTask:function(e){var t=this.getTasksByEntityId(e),i=_.find(t,function(e){return e.get(n.TASK_TYPE)===a.TASK_OPERATION_CONVERT_NODE&&e.isStatusActive()},this);return i||null},getTaskForOperation:function(e){return _.find(this.models,function(t){return t.get(n.TASK_TYPE)===e})},getLaJollaPreDeploymentTask:function(){var e=this.getAllTasks();return _.find(e,function(e){return e.get(n.TASK_TYPE)===a.TASK_CPS_PRE_DEPLOYMENT})},getExpandClusterTask:function(){return _.find(this.models,function(e){var t=e.get(n.TASK_ENTITY_TYPE),i=e.get(n.TASK_TYPE),s=_.isArray(t)?t:[t];return _.indexOf(s,a.ENTITY_CLUSTER)>=0&&i===a.ACTION_ADD})},getHostRebootTask:function(){return _.find(this.models,function(e){return e.get(n.TASK_TYPE)===a.ACTION_REBOOT})},getCVMConfigTask:function(){return _.find(this.models,function(e){return e.get(n.TASK_TYPE)===a.TASK_RECONFIG_CVM})},hasActiveClusterConvertTask:function(){return _.find(this.models,function(e){return e.get(n.TASK_TYPE)===a.TASK_OPERATION_CONVERT_NODE&&e.isStatusActive()})},hasFailedTask:function(){return!!this.find(function(e){return e.isStatusFailed()||e.isStatusCanceled()||e.isStatusAborted()})},hasActiveUploadTasks:function(){return!!_.find(this.models,function(e){return e.get(n.TASK_TYPE)===a.ACTION_DOWNLOAD&&(e.isStatusActive()||e.isStatusQueued())})},getActiveUpgradeTaskModel:function(){return _.find(this.getUpgradeTasks(),function(e){return e.isStatusActive()||e.isStatusQueued()||e.isStatusAborted()||e.isStatusFailed()})},getActiveUpgradeTaskEntity:function(){var e=this.getActiveUpgradeTaskModel();return e?e.get(n.TASK_ENTITY_TYPE):null},getTasksInTimeRange:function(e,t){return this.filter(function(i){var n=i.getCreatedTimestamp();return n>=e&&n<t})},getTasksByName:function(){var e={};return this.each(function(t){var i=t.get(n.TASK_NAME);e[i]=e[i]?e[i]+1:1}),e},comparator:function(e,t){var i=e.get(n.TASK_CREATE_TIME)||e.get(n.TASK_START_TIME),s=t.get(n.TASK_CREATE_TIME)||e.get(n.TASK_START_TIME);return i>s?-1:i<s?1:0},getOldTasks:function(){for(var e=[],t=this.models.length,i=0;i<t;i++){var n=this.at(i);n.isOldTask()&&e.push(n)}return e},isTaskLoading:function(){return this.stateMonitor.getState()===a.STATE_PENDING},isAllTaskFetched:function(){return this._allTaskFetched},getFilterCriteriaForDiff:function(){this.taskManager=require("managers/TaskManager");var e=t.prototype.getFilterCriteriaForDiff.apply(this,arguments);if(!this.taskManager.isQuickViewFilterApplicable())return this._isAboutToFetchAllTasks?e:(this._isAboutToFetchAllTasks=!0,null);var i="";return i="("+o.filterConditionToFIQL(n.TASK_NEW_STATUS,{op:a.FILTER_OPERATORS.EQUALS,value1:a.TASK_STATUS_FILTER.RUNNING})+","+o.filterConditionToFIQL(n.TASK_NEW_END_TIME,{op:a.FILTER_OPERATORS.GREATER_THAN,value1:this.taskManager.getMaxTimeUsecs()})+")",e&&(i+=";"+e),i},forceFetchTasks:function(e,t){e&&t&&this.fetch(e,t)}})}),define("models/AcropolisModel",["models/PollingModel","models/task/AcropolisTaskModel","models/task/TaskCollection","data/DataProperties","data/DataManager","managers/AppManager","utils/AppConstants","utils/AppUtil","utils/FilterUtil"],function(e,t,i,n,s,a,r,o,l){"use strict";var c=_.template('<% if (isPopupNotificationMessage) { %>Successfully completed operation to <% } else if (isLatencyMessage) { %>Submitting operation to <% } else { %>Received operation to <% } %><%= action %><%= entityMsg %> <%= entityType %>  <%= entityName %>.<% if (! suppressLink && isAsyncTask) { %><br><a class="acropolisTaskLink">View the task details.</a><% } %>'),u=_.template("Operation failed: <%= message %>"),d=i.extend({getFilterCriteriaForDiff:function(){return l.filterConditionToFIQL(n.UUID,{op:r.FILTER_OPERATORS.EQUALS,value1:this.taskUuid})}});return e.extend({TASK_POLL_INTERVAL_MS:5e3,entityMsg:"",name:"AcropolisModel",taskModel:null,msg:null,taskCollection:null,getName:function(){return this.get(this.nameAttribute)},initMessage:function(e){this.msg={isLatencyMessage:!1,suppressLink:!1,isAsyncTask:!1,isPopupNotificationMessage:!1},this.setMessage(e)},getLatencyMessage:function(e){return this.initMessage(e),this.msg.isLatencyMessage=!0,this.msg.suppressLink=!0,c(this.msg)},getNotificationMessage:function(e){this.initMessage(e);var i=(o.getBaseURL(),o.processSerializedObject(this._jqXHR.responseText));return this.msg.isAsyncTask=i[t.DP.VM_TASK_UUID],c(this.msg)},setMessage:function(e){e=e||this.actionMode,this.msg.action=r.ACTION_NAMES[e].toLowerCase(),this.msg.entityMsg=this.entityMsg,this.msg.entityType=r.ENTITY_NAMES[r.ENTITY_VM],this.msg.entityName=this.vmName},getPopupNotificationMessage:function(e){return this.initMessage(e),this.msg.isPopupNotificationMessage=!0,this.msg.suppressLink=!0,c(this.msg)},isPCVM:function(){return this.get(n.VM_TYPE)===r.VM_TYPES.PCVM||this.get(n.VM_DESCRIPTION)===r.NUTANIX_PRISM_CENTRAL},parseOptions:function(i,n,s){if(s=e.prototype.parseOptions.apply(this,arguments),"read"!==i){var a=s.success,r=this,o=function(e,i,n){a(e,i,n);var o=e[t.DP.VM_TASK_UUID]||e[t.DP.TASK_UUID],l=e[t.DP.V2_TASK_UUID];o||l?!0!==s.noPoll&&(l?r.pollErgonTask(l):r.pollTask(o)):r.onTaskSucceeded(r)};s.success=o}return s},pollErgonTask:function(e){var t=this;this.taskCollection||(this.taskCollection=new d,this.taskCollection.intervalTimeInMilliSec=this.TASK_POLL_INTERVAL_MS),this.taskCollection.taskUuid=e,this.taskCollection.on("reset",function(){var e=t.taskCollection.models[0];e&&(e.isStatusFailed()||e.isStatusAborted()?t.onTaskError(e):e.isStatusActive()||e.isStatusQueued()||(t.onTaskSucceeded(),t.taskCollection.stopPolling()))}),this.taskCollection.on("error",function(){var e=t.taskCollection.models[0];t.onTaskError(e)}),this.taskCollection.startPolling()},onTaskError:function(e){this.onTaskFailed(e),this.taskCollection.stopPolling()},pollTask:function(e,i){if(!this.taskModel){var s=this;this.taskModel=new t,this[n.CLUSTER_ID]&&this.taskModel.setProxyClusterUuid(this[n.CLUSTER_ID]),this.taskModel.actionMode=i?r.ACTION_CLIENT_POLL:r.ACTION_POLL,this.taskModel.set(n.UUID,e),s.taskModel.fetch({success:function(e,r){s.actionMode=null;var o=null;o=i?e:new t(s.taskModel.get(t.DP.TASK_INFO)),s[n.CLUSTER_ID]&&o.setProxyClusterUuid(s[n.CLUSTER_ID]),o.get(t.DP.PROGRESS_STATUS)===t.TASK_STATUS.FAILED?s.onTaskFailed(o):o.get(t.DP.PROGRESS_STATUS)===t.TASK_STATUS.SUCCEEDED?s.onTaskSucceeded(o):r.timedOut?s.onPollingTimedOut(o):s.onTaskInProgress(o),a.refreshView(s),s.taskModel=null},error:function(){o.log("AcropolisModel: pollTask: Issue with taskModel poll fetch."),s.taskModel=null,s.onPollingError()}})}},onTaskFailed:function(e){var i="";e&&("function"==typeof e.getMetaResponseAttr?i=e.getMetaResponseAttr(t.DP.ERROR_DETAIL)||"":"function"==typeof e.getMessage&&((i=e.getMessage())||"function"!=typeof e.getErrorMessage||(i=e.getErrorMessage()))),this.showClientNotification(r.NOTIFY_ERROR,u({message:i}))},onTaskSucceeded:function(e){},onTaskInProgress:function(e){},onPollingTimedOut:function(e){},onPollingError:function(e){},getDataSourceURL:function(){return s.getNutanixApiDataSourceURL()}})}),define("models/storage/AcropolisDiskModel",["models/AcropolisModel","data/DataURLConstants","data/DataProperties","data/DataManager","utils/AppUtil","utils/AppConstants"],function(e,t,i,n,s,a){"use strict";var r={DISK_UUID:"vmDiskUuid",CONTAINER_ID:"containerUuid",IMAGE_ID:"imageId",DISK_SIZE:"vmDiskSize",DISK_TYPE:"type",VM_ID:"vmid",UPDATE_SPEC:"updateSpec",DISK_PATH:"imagePath",IS_CDROM:"isCdrom",IS_EMPTY:"isEmpty",IS_HOT_REMOVE:"isHotRemoveEnabled",DISK_CLONE:"vmDiskClone",DISKS:"disks",DISK_CREATE:"vmDiskCreate",DISK_ADDRESS:"diskAddress",BUS_TYPE:"deviceBus",MIN_SIZE:"minimumSize",DEVICE_INDEX:"deviceIndex",VG_UUID:"volumeGroupUuid",INDEX:"index",DISK_LABEL:"diskLabel",ENABLE_FLASH_MODE:"flashModeEnabled",DISK_ADDR:"addr",NEW_DISK_PATH:"newDiskPath",UPGRADE_SPEC:"upgradeSpec",SIZE_MB:"sizeMb",PRESERVE_DATA:"preserveData"},o={IS_HOT_REMOVE:"is_hot_remove_enabled",IS_CDROM:"is_cdrom",IS_EMPTY:"is_empty",DISK_CREATE:"vm_disk_create",DISK_CLONE:"vm_disk_clone",CONTAINER_ID:"container_uuid",DISK_SIZE:"size",DISK_ADDRESS:"disk_address",BUS_TYPE:"device_bus",DEVICE_INDEX:"device_index",NDFS_FILEPATH:"ndfs_filepath",VMDISK_UUID:"vmdisk_uuid",DEVICE_UUID:"device_uuid",STORAGE_CONTAINER_UUID:"storage_container_uuid",DISK_LABEL:"disk_label",VM_DISKS:"vm_disks",FLASH_MODE_ENABLED:"flash_mode_enabled",MINIMUM_SIZE:"minimum_size",DISK_PATH:"disk_path",SRC_ADDRESS:"source_disk_address",CREATE_SPEC:"create_spec",UPGRADE_SPEC:"upgrade_spec",SIZE_MB:"size_mb",PRESERVE_DATA:"preserve_data",VOLUME_GROUP_UUID:"volume_group_uuid"},l={DISK:"DISK",CDROM:"CD-ROM"},c={CLONE:"CLONE",EMPTY:"EMPTY",ALLOCATE:"ALLOCATE",CLONE_IMAGE:"CLONE_IMAGE"},u={SCSI:"scsi",PCI:"pci",IDE:"ide",SATA:"sata",SPAPR:"spapr"};return e.extend({DP:r,DISK_TYPES:l,OPERATION_TYPES:c,BUS_TYPES:u,HYPERV_DISK_EXTN_REGEX:new RegExp("\\.vhdx$","gi"),nameAttribute:i.NAME,urlRoot:t.MGMT_VM,entityType:a.ENTITY_VIRTUAL_DISK,name:"AcropolisDiskModel",entityMsg:" virtual disk for ",getDataSourceURL:function(){return this.useUhura?n.getV2DataSourceURL():e.prototype.getDataSourceURL.apply(this)},getURL:function(){var e=this.url();if(this.isVolumeDisk)e=_.template(t.MGMT_VG_DISK,{id:this.volumeGroupId});else if(this.useUhura)switch(this.actionMode){case a.ACTION_CREATE:e=_.template(t.VM_DISK_ATTACH,{vmId:this.vmId});break;case a.ACTION_DELETE:e=_.template(t.VM_DISK_DETACH,{vmId:this.vmId});break;case a.ACTION_UPDATE:e=_.template(t.VM_DISK_UPDATE,{vmId:this.vmId})}else{var i=s.getEntityIdWithoutClusterId(this.vmId);this.actionMode===a.ACTION_DELETE||this.actionMode===a.ACTION_UPDATE?e=_.template(t.MGMT_VIRTUAL_DISK,{vmId:i,diskAddress:this.getDiskAddressId()}):this.actionMode===a.ACTION_CREATE&&(e=_.template(t.MGMT_VIRTUAL_DISK,{vmId:i,diskAddress:""}))}return e},getDiskImagePath:function(){return this.get(r.DISK_PATH)},isCloneFromNDFSFileOperation:function(){return!!this.get(r.DISK_PATH)},isCloneFromImageServiceOperation:function(){return!!this.get(r.IMAGE_ID)},isEmpty:function(){return this.get(r.IS_EMPTY)},isHotRemovable:function(){return this.get(r.IS_HOT_REMOVE)||!1},getDiskIndex:function(){return(this.get(r.DISK_ADDRESS)||{})[r.DEVICE_INDEX]},getBusType:function(){return(this.get(r.DISK_ADDRESS)||{})[r.BUS_TYPE]},getDiskAddressId:function(){var e=this.get(r.DISK_ADDRESS);return e[r.BUS_TYPE]+"-"+e[r.DEVICE_INDEX]},getSourceDiskName:function(){var e=this.get(o.SRC_ADDRESS);if(e&&e[o.NDFS_FILEPATH]){var t=e[o.NDFS_FILEPATH].split("/");return t[t.length-1]}return null},toVolumeDiskJSON:function(e){var t={};if(e===a.ACTION_CREATE)t[o.CREATE_SPEC]={},t[o.CREATE_SPEC][o.CONTAINER_ID]=this.get(r.CONTAINER_ID),t[o.CREATE_SPEC][o.SIZE_MB]=this.get(r.DISK_SIZE);else if(e===a.ACTION_UPDATE){var i={};t[r.INDEX]=this.get(r.INDEX),i[o.SIZE_MB]=this.get(r.DISK_SIZE),i[o.PRESERVE_DATA]=!0,t[o.UPGRADE_SPEC]=i}return t},toJSON:function(e){var t={},n={},l={};if(this.useUhura)return t[o.VM_DISKS]=[this.toUhuraDiskConfigJson()],this.isFanout&&(t[i.UUID]=s.getEntityIdWithoutClusterId(this.vmId)),t;if(this.isVolumeDisk)return this.toVolumeDiskJSON(this.actionMode);if(t[r.ENABLE_FLASH_MODE]=this.get(r.ENABLE_FLASH_MODE)||!1,t[i.DISK_UUID]=this.get(this.idAttribute),!this.get(r.IS_CDROM)&&this.actionMode===a.ACTION_UPDATE)return l.minimumSize=this.get(r.DISK_SIZE),l[r.DISK_UUID]=this.get(this.idAttribute),n[r.DISK_CLONE]=l,this.get(r.DISK_SIZE)&&(t[r.UPDATE_SPEC]=n),t;if(s.isDisplayableNumber(this.get(r.DISK_SIZE))&&!this.get(r.IS_CDROM)&&(this.isCloneFromNDFSFileOperation()||this.isCloneFromImageServiceOperation()?l.minimumSize=this.get(r.DISK_SIZE):l.size=this.get(r.DISK_SIZE)),!this.get(r.CONTAINER_ID)||this.get(r.IS_CDROM)||this.isCloneFromNDFSFileOperation()||this.isCloneFromImageServiceOperation()||(l[r.CONTAINER_ID]=this.get(r.CONTAINER_ID)),this.isCloneFromNDFSFileOperation()?(l[r.DISK_PATH]=this.get(r.DISK_PATH),n[r.DISK_CLONE]=l):this.isCloneFromImageServiceOperation()?(l[r.DISK_UUID]=this.get(r.IMAGE_ID),n[r.DISK_CLONE]=l):this.get(r.IS_EMPTY)||(n[r.DISK_CREATE]=l),n[r.IS_EMPTY]=!!this.get(r.IS_EMPTY),this.actionMode!==a.ACTION_UPDATE&&this.get(r.BUS_TYPE)&&(n[r.DISK_ADDRESS]={},n[r.DISK_ADDRESS][r.BUS_TYPE]=this.get(r.BUS_TYPE)),this.actionMode===a.ACTION_CREATE){n[r.IS_CDROM]=!!this.get(r.IS_CDROM);var c=this.get(r.DISK_ADDRESS);c&&c[r.BUS_TYPE]&&(n[r.DISK_ADDRESS]={},n[r.DISK_ADDRESS][r.BUS_TYPE]=c[r.BUS_TYPE])}return this.actionMode===a.ACTION_CREATE?(t[r.DISKS]=[],t[r.DISKS].push(n)):this.actionMode===a.ACTION_UPDATE&&(t[r.UPDATE_SPEC]=n),t},toUhuraDiskConfigJson:function(){var e,t={},n=this.get(i.ID);if(n&&(t[o.DISK_ADDRESS]=t[o.DISK_ADDRESS]||{},t[o.DISK_ADDRESS][o.VMDISK_UUID]=n),this.actionMode===a.ACTION_DELETE||this.actionMode===a.ACTION_UPDATE){if(e=this.get(r.DISK_ADDRESS),t[o.DISK_ADDRESS]=t[o.DISK_ADDRESS]||{},t[o.DISK_ADDRESS][o.DEVICE_INDEX]=e[r.DEVICE_INDEX],t[o.DISK_ADDRESS][o.BUS_TYPE]=e[r.BUS_TYPE],this.isHyperv&&(t[o.IS_CDROM]=this.get(r.IS_CDROM)),this.actionMode===a.ACTION_DELETE)return t;if(t[o.FLASH_MODE_ENABLED]=this.get(r.ENABLE_FLASH_MODE)||!1,this.updateFlashModeOnly)return t}var s=a.ACTION_CREATE;(this.get(r.DISK_PATH)||this.get(r.IMAGE_ID))&&(s=a.ACTION_CLONE);var l={},c={};e=this.get(r.DISK_ADDRESS)||{},t[o.IS_CDROM]=this.get(r.IS_CDROM),t[o.IS_EMPTY]=this.get(r.IS_EMPTY);var u=e[r.BUS_TYPE],d=e[r.DEVICE_INDEX];if(s===a.ACTION_CREATE){l[o.STORAGE_CONTAINER_UUID]=this.get(r.CONTAINER_ID),l[o.DISK_SIZE]=this.get(r.DISK_SIZE),u&&this.actionMode!==a.ACTION_UPDATE&&(t[o.DISK_ADDRESS]=t[o.DISK_ADDRESS]||{},t[o.DISK_ADDRESS][o.BUS_TYPE]=u,_.isUndefined(d)||(t[o.DISK_ADDRESS][o.DEVICE_INDEX]=d));var h=this.get(r.NEW_DISK_PATH);h&&(this.isHyperv&&!this.HYPERV_DISK_EXTN_REGEX.test(h)&&(h+=".vhdx"),l[o.DISK_PATH]=h),_.isEmpty(l)||this.get(r.IS_EMPTY)||(t[o.DISK_CREATE]=l)}else s===a.ACTION_CLONE&&(this.get(r.DISK_PATH)?c[o.NDFS_FILEPATH]=this.get(r.DISK_PATH):c[o.VMDISK_UUID]=this.get(r.IMAGE_ID),u&&this.actionMode!==a.ACTION_UPDATE&&(t[o.DISK_ADDRESS]={},t[o.DISK_ADDRESS][o.BUS_TYPE]=u,t[o.DISK_ADDRESS][o.VMDISK_UUID]=this.getId()),l[o.STORAGE_CONTAINER_UUID]=this.get(r.CONTAINER_ID),l[o.DISK_ADDRESS]=c,l[o.MINIMUM_SIZE]=this.get(r.DISK_SIZE),_.isEmpty(l)||this.get(r.IS_EMPTY)||(t[o.DISK_CLONE]=l));return t},validate:function(e){return this.get(r.IS_CDROM)||void 0===e[r.DISK_SIZE]||s.isDisplayableNumber(e[r.DISK_SIZE])?this.actionMode===a.ACTION_UPDATE&&s.isDisplayableNumber(this.get(r.DISK_SIZE))&&e[r.DISK_SIZE]<this.get(r.DISK_SIZE)?this.i18n("reducing_disk_size_msg"):"":this.i18n("invalid_disk_size_msg")}},{DP:r,V2_DP:o,DISK_TYPES:l,OPERATION_TYPES:c,BUS_TYPES:u})}),define("models/network/AcropolisNicModel",["models/AcropolisModel","data/DataURLConstants","data/DataProperties","data/DataManager","utils/AppConstants","utils/AppUtil"],function(e,t,i,n,s,a){"use strict";var r={MAC_ADDRESS:"macAddress",NETWORK_UUID:"networkUuid",REQ_IP_ADDRESS:"requestedIpAddress",SPEC_LIST:"specList",NICS:"vmNics",OVERRIDE_CONFIG:"overrideNetworkConfig",MODEL:"model",ADAPTER_TYPE:"adapterType",VLAN_ID:"vlanId",IS_CONNECTED:"isConnected"},o={MAC_ADDRESS:"mac_address",NETWORK_UUID:"network_uuid",REQ_IP_ADDRESS:"requested_ip_address",REQUEST_IP:"request_ip",MODEL:"model",SPEC_LIST:"spec_list",VLAN_ID:"vlan_id",ADAPTER_TYPE:"adapter_type",NIC_ID:"nic_id",NIC_SPEC:"nic_spec",IS_CONNECTED:"is_connected"};return e.extend({DP:r,idAttribute:r.MAC_ADDRESS,nameAttribute:i.NAME,urlRoot:t.MGMT_VM,name:"AcropolisNicModel",entityType:s.ENTITY_ACROPOLIS_NIC,entityMsg:" NIC for ",isNicDisconnectSupported:null,getDataSourceURL:function(){return this.useUhura?n.getV2DataSourceURL():e.prototype.getDataSourceURL.apply(this,arguments)},getURL:function(){var e=this.url();return this.useUhura?_.template(t.MGMT_NIC.substring(1),{vmId:this.vmId,macAddr:this.get(r.MAC_ADDRESS)}):(this.actionMode===s.ACTION_DELETE||this.actionMode===s.ACTION_UPDATE?e=_.template(t.MGMT_NIC,{vmId:this.vmId,macAddr:this.get(r.MAC_ADDRESS)}):this.actionMode===s.ACTION_CREATE?e=_.template(t.MGMT_NIC,{vmId:this.vmId,macAddr:""}):e+=_.template(t.MGMT_NICS_PER_VM,{entityId:this.get(i.VM_ID)}),e)},toJSON:function(t){if(this.actionMode===s.ACTION_CREATE||this.actionMode===s.ACTION_UPDATE||this.actionMode===s.ACTION_CLONE){var n={},l=[],c={},u=this.useUhura?o:r;if(c[u.NETWORK_UUID]=this.get(r.NETWORK_UUID),this.get(r.REQ_IP_ADDRESS)&&(c[u.REQ_IP_ADDRESS]=this.get(r.REQ_IP_ADDRESS)),this.get(r.MODEL)&&(c[u.MODEL]=this.get(r.MODEL)),this.get(r.ADAPTER_TYPE)&&(c[u.ADAPTER_TYPE]=this.get(r.ADAPTER_TYPE)),this.isNicDisconnectSupported&&this.useUhura&&(c[u.IS_CONNECTED]=this.get(r.IS_CONNECTED)),this.useUhura){t&&!t.ignoreMac&&(c[o.MAC_ADDRESS]=this.get(r.MAC_ADDRESS));var d=this.get(r.VLAN_ID);if(void 0!==d&&(c[o.VLAN_ID]=d),this.actionMode===s.ACTION_UPDATE){var h={};return h[o.NIC_SPEC]=c,h[o.NIC_ID]=this.getNicId(),this.isFanout&&(h[i.UUID]=a.getEntityIdWithoutClusterId(this.vmId)),h}return this.vmId?(n[o.SPEC_LIST]=[c],this.isFanout&&(n[i.UUID]=a.getEntityIdWithoutClusterId(this.vmId)),n):c}return l.push(c),n[r.SPEC_LIST]=l,n}if(this.actionMode===s.ACTION_DELETE){if(this.isFanout){var p={};return p[o.NIC_ID]=this.get(r.MAC_ADDRESS),p[i.UUID]=a.getEntityIdWithoutClusterId(this.vmId),p}return{}}return e.prototype.toJSON.apply(this,arguments)},getNicId:function(){var e=this.getMacAddress();if(e)return e.replace(/:/g,"-")},getMacAddress:function(){var e=this.get(o.MAC_ADDRESS);return e||(e=this.get(r.MAC_ADDRESS)),e},getNicConnectionState:function(){var e=this.get(o.IS_CONNECTED);return e||(e=this.get(r.IS_CONNECTED)),e||!1}},{DP:r,V2_DP:o})}),define("models/gpu/GpuModel",["models/BaseModel","data/DataURLConstants","utils/AppConstants","utils/AppUtil","data/DataManager"],function(e,t,i,n,s){"use strict";var a={ID:"id",ENTITY_ID:"entity_id",UUID:"uuid",NODE:"node",GPU_CONFIG:"gpu_config",DEVICE_ID:"device_id",DEVICE_NAME:"device_name",GPU_TYPE:"gpu_type",GPU_VENDOR:"gpu_vendor",GPU_MODE:"gpu_mode",GPU_PROFILE:"gpu_profile",IN_USE:"in_use",ASSIGNABLE:"assignable",NUMA_NODE:"numa_node",SBDF:"sbdf",DEVICE_COUNT:"count",IN_USE_COUNT:"in_use_count",FRACTION:"fraction",FRAMEBUFFER:"frame_buffer_size_bytes",LICENSES:"licenses",VM_ASSIGNED:"current_resource_owner",DISPLAY_HEAD:"num_virtual_display_heads",RESOLUTION:"max_resolution",HOST_NAME:"node_name",HOST_UUID:"node_uuid",CLUSTER_UUID:"cluster_uuid",VM_UUID:"vm_uuids",VMS_ALLOCATED:"allocated_vm_uuids",VMS_ALLOCATED_PER_PROFILE:"profile_vm_uuids",IS_UNKNOWN:"is_unknown",GUEST_DRIVER_VERSION:"guest_driver_version"},r={PASSTHROUGH:"PASS_THROUGH_GRAPHICS",COMPUTE:"PASS_THROUGH_COMPUTE",VIRTUAL:"VIRTUAL"},o={VIRTUAL:"kVirtual",PASSTHROUGH:"kPassthroughGraphics",COMPUTE:"kPassthroughCompute"},l={NONE:"UNUSED",PASSTHROUGH:"USED_FOR_PASSTHROUGH",VIRTUAL:"USED_FOR_VIRTUAL"},c={NONE:"kUnused",PASSTHROUGH:"kUsedForPassthrough",VIRTUAL:"kUsedForVirtual"};return e.extend({urlRoot:t.HOST_GPU,DP:a,GPU_TYPE:r,GPU_TYPE_KSTRING:o,GPU_MODE:l,GPU_MODE_KSTRING:c,idAttribute:"_",entityType:i.ENTITY_GPU,name:"GpuModel",getDataSourceURL:function(){return s.getV2DataSourceURL()},getId:function(){if(this.idString)return this.idString;var e=this.get(a.ENTITY_ID)||this.get(a.UUID),t=this.get(a.NODE)||this.get(a.HOST_UUID);return e+i.GRAPH_DATA_SEPARATOR+t},getValue:function(t){return t===this.idAttribute?this.getId():e.prototype.getValue.apply(this,arguments)},setId:function(e,n){this.idString=e;var s=e.split(i.GRAPH_DATA_SEPARATOR),a=s[0],r=s[1];this.urlRoot=_.template(t.HOST_GPU,{hostUuid:r}),this.set(this.idAttribute,a,{silent:n||!0})},getDeviceId:function(){var e=this.get(a.GPU_CONFIG);return e&&e[a.DEVICE_ID]},isAllInUse:function(){return this.get(a.DEVICE_COUNT)===this.get(a.IN_USE_COUNT)},isAssignable:function(){var e=this.get(a.GPU_CONFIG);return e||n.log("GpuModel Error: gpu_config is not populated correctly"),e&&e[a.ASSIGNABLE]},isUnknown:function(){var e=this.get(a.GPU_CONFIG);return!e||e[a.IS_UNKNOWN]},getSBDF:function(){var e=this.get(a.GPU_CONFIG);return e&&e[a.SBDF]},getVmsAllocated:function(){var e=this.get(a.GPU_CONFIG);return e&&e[a.VM_UUID]},getGpuModeOfPGpu:function(){return this.get(a.GPU_CONFIG)[a.GPU_MODE]},getGpuSummaryStr:function(){var e=this.get(a.DEVICE_COUNT);return this.getGpuName()+(1===e?"":" ("+e+")")},getGpuType:function(){var e=this.get(a.GPU_CONFIG);return e&&e[a.GPU_TYPE]},getGpuName:function(){var e=this.get(a.GPU_CONFIG);return e&&e[a.DEVICE_NAME]},getLicenseTypes:function(){var e=this.get(a.GPU_CONFIG);return e&&e[a.LICENSES]},getName:function(){return this.getGpuName()},getClusterUuid:function(){return this.get(a.CLUSTER_UUID)}},{DP:a,GPU_TYPE:r,GPU_TYPE_KSTRING:o,GPU_MODE:l,GPU_MODE_KSTRING:c})}),define("views/notification/NotificationTemplates",[],function(){"use strict";return{MSG_GENERIC_SUCCESS:_.template("<%= _.escape(entityName) %> has been <%= actionName %><%= endingChars %>"),MSG_ALERT_SUCCESS:_.template("Successfully <%= actionMode %>d."),MSG_DATASTORE_UNMOUNT_SUCCESS:_.template('Unmounted successfully on <%= count === 1 ? " selected host" : (count + " hosts") %>.'),MSG_DATASTORE_MOUNT_SUCCESS:_.template('Mounted successfully as NFS datastore on <%= count === 1 ? " selected host" : (count + " hosts") %>.'),MSG_UPGRADE_START_DOWNLOAD:_.template("Started downloading <%= name %>."),MSG_UPGRADE_CANCEL_TRANSFER:_.template("Canceled the transfer process on <%= name %>."),MSG_GENERIC_ERROR:"An error occurred.",MSG_CONNECTION_ERROR:"Unable to reach server. Please check your network connection.",MSG_DATASTORE_MOUNT_ERROR:_.template('<%=errors.length%> error<%=errors.length > 1 ? "s" : ""%> occured during mounting of NFS datastore.'),MSG_DATASTORE_UNMOUNT_ERROR:_.template('<%=errors.length%> error<%=errors.length > 1 ? "s" : ""%> occured during unmounting of NFS datastore.'),MSG_SMB_SHARE_UPDATE_ERROR:_.template('<%=errors.length%> error<%=errors.length > 1 ? "s" : ""%> occured when updating default smb share on hosts.'),MSG_SMB_SHARE_UPDATE_SUCCESS:_.template('Successfully updated the default smb share on <%= count <= 1 ? " selected host" : (count + " hosts") %>.'),MSG_FAILOVER_CLUSTER_CREATE_ERROR:_.template('<%=errors.length%> error<%=errors.length > 1 ? "s" : ""%> occured when creating failover cluster.'),MSG_FAILOVER_CLUSTER_CREATE_SUCCESS:_.template('Successfully created failover cluster on <%= count == 1 ? " selected host" : (count + " hosts") %>.'),MSG_HYPERV_DOMAIN_CLUSTER_CREATE_ERROR:_.template('<%=errors.length%> error<%=errors.length > 1 ? "s" : ""%> occured when domain joining hosts and Acropolis cluster.'),MSG_HYPERV_DOMAIN_CLUSTER_CREATE_SUCCESS:_.template('Successfully domain joined Acropolis cluster and <%= count === 1 ? " selected host" : (count + " hosts") %>.'),MSG_ENTITY_TASK_SUCCESS:_.template("<%- entityName %> <%= actionName %> task has been submitted."),MSG_ENTITY_SUBSCRIPTION:_.template("File Server is subscribed to <%- entityName %>."),MSG_ENTITY_UNSUBSCRIPTION:_.template("File Server is unsubscribed to <%- entityName %>."),LATENCY_CREATE:_.template("<% if (entityName) { %>\n          Creating <%= _.escape(entityName) %>..\n        <% } else { %>\n          Creating... <%\n        } %>"),LATENCY_UPDATE:_.template("<% if (entityName) { %>\n          Updating <%= _.escape(entityName) %>..\n        <% } else { %>\n          Updating... <%\n        } %>"),LATENCY_DELETE:_.template("<% if (entityName) { %>\n          Deleting <%= _.escape(entityName) %>..\n        <% } else { %>\n          Deleting... <%\n        } %>"),LATENCY_RESOLVE:"Resolving...",LATENCY_ACKNOWLEDGE:"Acknowledging...",LATENCY_GENERIC:"Processing your request...",LATENCY_DATASTORE_MOUNT:"Mounting datastore on host(s)...",LATENCY_DATASTORE_UNMOUNT:"Unmounting datastore on host(s)...",START_REMOVE_HARDWARE:_.template("The <%= entity %> has been marked for removal."),BTN_MORE_INFO:'<a notificationId="<%= notificationId %>"                            class="btnMoreInfo">                          Details                        </a>',NOTIFICATION_MSG:'<div class="n-<%= notifyTypeStyle %>                              n-notification-msg"                              notificationId="<%= notificationId %>">                            <a notificationId="<%= notificationId %>"                              class="n-close">                            </a>                            <div class="n-notification-text">                              <%= message %>                            </div>                            <div class="n-button-holder">                              <%= buttons %>                            </div>                          </div>',NOTIFICATION_BAR_MSG:'<div class="n-message" id="<%= id %>">             <%= message %>               <% if (showCloseBtn) { %>                <a class="n-close" notificationBar="true">                   <i class="" data-icon="v" aria-hidden="true"/>                 </a>               <% } %>            <span class="n-nav"></span>           </div>',LATENCY_MSG:'<div class="n-notification-loading                              n-notification-msg"                              latencyId="<%= latencyId %>">                            <a latencyId="<%= latencyId %>"                              class="n-close">                            </a>                            <div class="n-notification-text">                              <%= message %>                            </div>                          </div>',ROW_DATASTORE_MSG:'<div class="n-notification-msg-row  alert            <%= model.successful ? "alert-success" : "alert-error"%>">           <div class="n-notification-data-row">              <div class="n-notification-data-label">Host: </div>              <div class="n-notification-data-value">                <%= hostModel ? hostModel.hypervisorAddress : model.nodeId %>             </div>            </div>            <div class="n-notification-data-row">              <div class="n-notification-data-label">Message: </div>              <div class="n-notification-data-value">                <% if (model.message) { %>                <%=  model.message %>                <% } else { %>                <%=  model.successful ? "Successful " : "Error occurred " %>              <% } %>                <%=  containerMessage %>            </div>            </div>          </div>',ROW_HYPERV_MSG:'<div class="n-notification-msg-row  alert            <%= model.successful ? "alert-success" : "alert-error"%>">           <div class="n-notification-data-row">              <div class="n-notification-data-label">Host: </div>              <div class="n-notification-data-value">                <%= hostModel ? hostModel.hypervisorAddress : model.nodeId %>             </div>            </div>            <div class="n-notification-data-row">              <div class="n-notification-data-label">Message: </div>              <div class="n-notification-data-value">                <% if (model.message) { %>                <%=  model.message %>                <% } else { %>                <%=  model.successful ? "Successful " : "Error occurred " %>              <% } %>              </div>            </div>          </div>',LOADING:'<div             class="n-notification n-notification-loading n-notification-msg"             style="opacity:1"             latencyId="loading">            <div class="n-notification-text">              Loading...            </div>          </div>',REMOTE_SNAPSHOT_DELETE_SUCCESS_MSG:_.template("The snapshot delete operation for <%- entityName %> has been received."),LOCAL_SNAPSHOT_DELETE_SUCCESS_MSG:_.template("Snapshot <%- entityName %> successfully deleted.")}}),define("models/notification/NotificationModel",["backbone","views/notification/NotificationTemplates","utils/AppConstants","utils/AppUtil","utils/I18nMixin","data/DataProperties"],function(e,t,i,n,s,a){"use strict";return e.Model.extend(_.extend({},s,{name:"NotificationModel",defaults:{id:null,notifyType:null,model:null,response:null,method:null,entityAction:null,stringMessage:null},initialize:function(){if(this.set({id:(new Date).getTime()}),!this.getStringMessage()){var e=this.getAssociatedModel(),t=e&&e.actionMode;this.set({entityAction:t||i.METHOD_ACTION_MAP[this.get("method")]})}},getNotificationId:function(){return this.get("id")},getLatencyId:function(){var e=this.getAssociatedModel();return e?e.entityType+this.get("entityAction"):this.get("entityAction")},getModelType:function(){return this.getAssociatedModel()?this.getAssociatedModel().entityType:null},getStringMessage:function(){return this.get("stringMessage")},getNotificationMessage:function(){if(this.getStringMessage())return this.getStringMessage();if(this.getModelType()===i.ENTITY_DATASTORE)return this.getDatastoreNotificationMessage();if(this._isHypervSetupStep(this.getModelType()))return this.getHypervSetupNotificationMessage(this.getModelType());if(this.getModelType()===i.ENTITY_ALERT||this.getModelType()===i.ENTITY_EVENT)return this.getAlertNotificationMessage();if(this.get("model")&&"function"==typeof this.get("model").getNotificationMessage)return this.get("model").getNotificationMessage(this.get("entityAction"),this.get("notifyType"));if(this.getModelType()===i.ENTITY_SOFTWARE_RELEASE){var e=this.getSoftwareReleaseMessage();if(e)return e}else{if(!(this.get("entityAction")!==i.ACTION_REMOVE&&this.get("entityAction")!==i.ACTION_DELETE||this.get("notifyType")===i.NOTIFY_ERROR||this.getModelType()!==i.ENTITY_DISK&&this.getModelType()!==i.ENTITY_HOST))return this.getStartRemovalProcessMessage();if(this.get("entityAction")===i.ACTION_DISABLE_METRO_AVAIL&&this.get("notifyType")===i.NOTIFY_SUCCESS){var s=this.getAssociatedModel(),r=s.getValue(s.nameAttribute);return this.i18ns("disable_metro_avail_success_msg",r)}}switch(this.get("notifyType")){case i.NOTIFY_SUCCESS:
var o=this.getAssociatedModel(),l=o.getValue(o.nameAttribute),c=o.entityType,u=l||n.getSingularEntityName(c)||"The entity",d=i.ACTION_NAMES[this.get("entityAction")].toLowerCase();if(c===i.ENTITY_CLUSTER&&o[a.NAME]&&"ClusterUpdateModel"!==o[a.NAME]&&(u+=" "+o[a.NAME]),c!==i.ENTITY_CLUSTER_PUBLIC_KEY&&c!==i.ENTITY_CONTAINER&&c!==i.ENTITY_HTTPPROXY&&c!==i.ENTITY_STORAGE_POOL||!l||(u=i.ENTITY_NAMES[c]+" '"+l+"'"),c===i.ENTITY_SNAPSHOT&&d===i.ACTION_DELETE&&"function"==typeof o.isRemoteSnapshot)return o.isRemoteSnapshot()?t.REMOTE_SNAPSHOT_DELETE_SUCCESS_MSG({entityName:u}):t.LOCAL_SNAPSHOT_DELETE_SUCCESS_MSG({entityName:u});var h=n.endsWith(d,"e")?"d":"ed";return c===i.ENTITY_MANAGEMENT_SERVER?t.MSG_ENTITY_TASK_SUCCESS({entityName:u,actionName:d}):t.MSG_GENERIC_SUCCESS({entityName:u,actionName:d,endingChars:h});case i.NOTIFY_WARNING:case i.NOTIFY_ERROR:default:if("read"===this.get("method")&&n.isConnectionError(this.get("response")))return t.MSG_CONNECTION_ERROR;var p=this.get("response");return p&&p.responseText?this.getResponseErrorWarningMessage():p&&404===p.status&&p.statusText?p.statusText+": "+this.getAssociatedModel().getURL():p&&p.statusText?p.statusText:t.MSG_GENERIC_ERROR}},getLatencyMessage:function(){if(this.getModelType()===i.ENTITY_DATASTORE)return this.getDatastoreLatencyMessage();if(this.getModelType()===i.ENTITY_ALERT)return this.getAlertLatencyMessage();if(this.get("model")&&"function"==typeof this.get("model").getLatencyMessage)return this.get("model").getLatencyMessage(this.get("entityAction"));var e=this.getAssociatedModel(),n=e.getValue(e.nameAttribute)||i.ENTITY_NAMES[e.entityType];switch(e.entityType===i.ENTITY_CLUSTER&&e[a.NAME]&&"ClusterUpdateModel"!==e[a.NAME]&&(n+=" "+e[a.NAME]),this.get("entityAction")){case i.ACTION_CREATE:case i.ACTION_ADD:return t.LATENCY_CREATE({entityName:n});case i.ACTION_UPDATE:return t.LATENCY_UPDATE({entityName:n});case i.ACTION_DELETE:case i.ACTION_REMOVE:return t.LATENCY_DELETE({entityName:n});default:return t.LATENCY_GENERIC}},getNotifyType:function(){return this.getModelType()===i.ENTITY_DATASTORE||this._isHypervSetupStep(this.getModelType())?this.getDatastoreNotifyType():this.get("notifyType")},getNotifyTypeStyle:function(){switch(this.getNotifyType()){case i.NOTIFY_SUCCESS:return"notification-success";case i.NOTIFY_WARNING:return"notification-warning";case i.NOTIFY_ERROR:return"notification-error";case i.NOTIFY_INFO:default:return"notification-info"}},hasMoreInfo:function(){if(this.getAssociatedModel()){var e=this.getAssociatedModel().entityType;return e===i.ENTITY_DATASTORE||this._isHypervSetupStep(e)}return!1},getAssociatedModel:function(){return this.get("model")},getNodeSpecificStatusArray:function(){return _.sortBy(this.get("response")[a.NODE_STATUS],function(e){return e.successful})},getDatastoreNotifyType:function(){var e=_.filter(this.getNodeSpecificStatusArray(),function(e){return!1===e.successful});return e&&e.length>0?i.NOTIFY_ERROR:i.NOTIFY_SUCCESS},getDatastoreNotificationMessage:function(){var e=_.filter(this.getNodeSpecificStatusArray(),function(e){return!1===e.successful}),n=_.filter(this.getNodeSpecificStatusArray(),function(e){return!0===e.successful}),s=this.getAssociatedModel().actionMode;return s===i.ACTION_ADD?e&&e.length>0?t.MSG_DATASTORE_MOUNT_ERROR({errors:e}):t.MSG_DATASTORE_MOUNT_SUCCESS({count:n.length}):s===i.ACTION_REMOVE?e&&e.length>0?t.MSG_DATASTORE_UNMOUNT_ERROR({errors:e}):t.MSG_DATASTORE_UNMOUNT_SUCCESS({count:n.length}):void 0},getHypervSetupNotificationMessage:function(e){var t=_.filter(this.getNodeSpecificStatusArray(),function(e){return!1===e.successful}),i=_.filter(this.getNodeSpecificStatusArray(),function(e){return!0===e.successful});return t&&t.length>0?this._getHypervSetupStepTemplate(e,!0,t):this._getHypervSetupStepTemplate(e,!1,i)},_getHypervSetupStepTemplate:function(e,n,s){return e===i.ENTITY_SMB_SHARE?n?t.MSG_SMB_SHARE_UPDATE_ERROR({errors:s}):t.MSG_SMB_SHARE_UPDATE_SUCCESS({count:s.length}):e===i.ENTITY_HYPERV_FAILOVER_CLUSTER?n?t.MSG_FAILOVER_CLUSTER_CREATE_ERROR({errors:s}):t.MSG_FAILOVER_CLUSTER_CREATE_SUCCESS({count:s.length}):e===i.ENTITY_HYPERV_DOMAIN_JOIN?n?t.MSG_HYPERV_DOMAIN_CLUSTER_CREATE_ERROR({errors:s}):t.MSG_HYPERV_DOMAIN_CLUSTER_CREATE_SUCCESS({count:s.length}):void 0},_isHypervSetupStep:function(e){return-1!==[i.ENTITY_SMB_SHARE,i.ENTITY_HYPERV_FAILOVER_CLUSTER,i.ENTITY_HYPERV_DOMAIN_JOIN].indexOf(e)},getDatastoreLatencyMessage:function(){var e=this.getAssociatedModel().actionMode;return e===i.ACTION_ADD?t.LATENCY_DATASTORE_MOUNT:e===i.ACTION_REMOVE?t.LATENCY_DATASTORE_UNMOUNT:void 0},getAlertNotificationMessage:function(){var e=this.getAssociatedModel(),s=i.ACTION_NAMES[e.actionMode]||e.actionMode;switch(s=s.toLowerCase(),this.get("notifyType")){case i.NOTIFY_SUCCESS:return _.isFunction(e.getSuccessNotificationMsg)?e.getSuccessNotificationMsg():t.MSG_ALERT_SUCCESS({actionMode:s});case i.NOTIFY_WARNING:case i.NOTIFY_ERROR:default:return this.get("response")?n.processAjaxError(this.get("response").responseText):t.MSG_GENERIC_ERROR}},getAlertLatencyMessage:function(){var e=this.getAssociatedModel().actionMode;return e===i.ACTION_RESOLVE||e===i.ACTION_RESOLVE_ALL?t.LATENCY_RESOLVE:e===i.ACTION_ACKNOWLEDGE||e===i.ACTION_ACKNOWLEDGE_ALL?t.LATENCY_ACKNOWLEDGE:void 0},getSoftwareReleaseMessage:function(){var e=this.getAssociatedModel().actionMode;return e===i.ACTION_DOWNLOAD?t.MSG_UPGRADE_START_DOWNLOAD({name:this.getAssociatedModel().get(a.UPGRADE_NAME)}):e===i.ACTION_CANCEL_TRANSFER?t.MSG_UPGRADE_CANCEL_TRANSFER({name:this.getAssociatedModel().get(a.UPGRADE_NAME)}):void 0},getStartRemovalProcessMessage:function(){var e=this.getAssociatedModel(),n=i.ENTITY_NAMES[e.entityType];return t.START_REMOVE_HARDWARE({entity:n.toLowerCase()})},getContainerDeleteMessage:function(){var e=this.get("response");if(e&&e.responseText&&e.responseText.indexOf("contains")>-1&&e.responseText.indexOf("not marked for removal")>-1)return this.i18n("error_container_removal_file")},getResponseErrorWarningMessage:function(){var e=this.get("entityAction"),t=this.get("response"),s=this.get("notifyType"),a=this.get("model")||{},r=a.entityType,o=void 0;return s!==i.NOTIFY_ERROR||r!==i.ENTITY_CONTAINER||e!==i.ACTION_REMOVE&&e!==i.ACTION_DELETE||(o=this.getContainerDeleteMessage()),o||(o=n.processAjaxError(t.responseText)),o}}))}),define("managers/NotificationManager",["utils/AppConstants","utils/AppUtil","models/notification/NotificationModel","managers/BaseManager","managers/NamespaceManager"],function(e,t,i,n,s){"use strict";return n.extend({name:e.MANAGER.NOTIFICATION,tmplBatchLatency:_.template("Processing <%= action %> operation on <%= actionCount %> <%= entityType %>"),tmplBatchSuccess:_.template("Received operation to <%= action %> <%= actionCount %> <%= entityType %>."),tmplBatchError:_.template("Error submitting batch <%= entityType %> actions"),initialize:function(){this.addToManagerHelper()},showLatencyAction:function(e,t){if(s.get(s.APP_VIEW)){var n=new i({model:e,method:t});s.get(s.APP_VIEW).showLatencyAction(n)}},showLatencyMessage:function(e){if(s.get(s.APP_VIEW))return s.get(s.APP_VIEW).showLatencyMessage(e)},showNotification:function(e,t,n,a){if(s.get(s.APP_VIEW)){var r=new i({notifyType:e,model:_.clone(t),method:n,response:_.clone(a)});s.get(s.APP_VIEW).showNotification(r)}},showClientNotification:function(e,t,n){if(s.get(s.APP_VIEW)){n=n||{};var a=new i({notifyType:e,stringMessage:t});return n.width&&a.set("width",n.width),n.latencyId&&this.hideLatencyMessage(n.latencyId),s.get(s.APP_VIEW).showNotification(a,n.temporary),a.getNotificationId()}},showIntentActionNotification:function(e,i,n){var s=n?n.length:0,a=this.getAppManager&&this.getAppManager(),r=a&&a.isOnprem();return this.showLatencyMessage(this.tmplBatchLatency({action:this.getIntentActionName(e,i),actionCount:s,entityType:t.getEntityNameFromCount(t.getEntityTypeBasedOnEnvironment(i,r),s)}))},showIntentSuccessNotification:function(t,i,n,s){this.showResultNotification({notificationType:e.NOTIFY_SUCCESS,actionId:t,entityType:i,ids:n,latencyId:s})},showIntentErrorNotification:function(t,i,n,s){this.showResultNotification({notificationType:e.NOTIFY_ERROR,actionId:t,entityType:i,ids:n,latencyId:s})},showResultNotification:function(i){if(!i)throw new Error("options is required param.");i.latencyId&&this.hideLatencyMessage(i.latencyId);var n;n=i.notificationType===e.NOTIFY_ERROR?this.tmplBatchError:this.tmplBatchSuccess;var s=i.ids?i.ids.length:0,a=this.getAppManager&&this.getAppManager(),r=a&&a.isOnprem();this.showClientNotification(i.notificationType,n({entityType:t.getEntityNameFromCount(t.getEntityTypeBasedOnEnvironment(i.entityType,r),s),action:this.getIntentActionName(i.actionId,i.entityType),actionCount:s}))},getIntentActionName:function(e,i){var n=this.getEntityManager().getEntityActions(i);if(!n.length){var s=t.getEntityTypeEB(i);n=this.getEntityManager().getEntityActions(s)}var a=e;if(n){var r=n.getActionModelByActionId(e);r&&(a=r.get(r.DP.TITLE))}return a=(a||"").toLowerCase()},hideLatencyAction:function(e,t){if(s.get(s.APP_VIEW)){var n=new i({model:_.clone(e),method:t});s.get(s.APP_VIEW).hideLatencyAction(n.getLatencyId()),n=null}},hideLatencyMessage:function(e,t){s.get(s.APP_VIEW)&&(t=t||0,t>0?setTimeout(function(){s.get(s.APP_VIEW).hideLatencyMessage(e)},t):s.get(s.APP_VIEW).hideLatencyMessage(e))},showNotificationBar:function(e,i,n){s.get(s.APP_VIEW)&&(t.log("Notification: "+e),s.get(s.APP_VIEW).showNotificationBar(e,i,n))},hideNotificationBar:function(e){s.get(s.APP_VIEW)&&s.get(s.APP_VIEW).hideNotificationBar(e)}})}),define("utils/SubModelHelper",["backbone","utils/AppUtil"],function(e,t){"use strict";return e.Model.extend({subModels:null,initialize:function(){t.debug("SubModelHelper initialize cid:"+this.cid),this.subModels={}},destroy:function(){t.debug("SubModelHelper destroy cid:"+this.cid),this.removeAll()},register:function(e,i){t.debug("SubModelHelper register id:"+e+" cid:"+this.cid),this.subModels[e]=i},get:function(e){return t.debug("SubModelHelper get:"+e+" cid:"+this.cid),this.subModels[e]},getIds:function(){return _.keys(this.subModels)},iterate:function(e,i,n,s,a,r){var o=[];return t.debug("SubModelHelper iterate cid:"+this.cid+" functionName:"+e),_.each(this.subModels,function(t,l){t[e]&&o.push(t[e](i,n,s,a,r))}),o},attachEventHandler:function(e,i,n){t.debug("SubModelHelper attachEventHandler cid:"+this.cid+" eventName:"+e),_.each(this.subModels,function(t){t.on(e,i,n)})},removeAllEventHandlers:function(){t.debug("SubModelHelper removeAllEventHandlers cid:"+this.cid),_.each(this.subModels,function(e){e.off("all")})},removeAll:function(){t.debug("SubModelHelper removeAll cid:"+this.cid),this.removeAllEventHandlers(),this.subModels={}},remove:function(e){t.debug("SubModelHelper remove id:"+e+" cid:"+this.cid);var i=this.get(e);i.off("all"),i.destroy&&i.destroy(),delete this.subModels[e]}})}),define("models/FanoutActionCollection",["models/BaseCollection","utils/AppConstants","data/DataURLConstants","data/DataProperties","utils/AppUtil","utils/CommonTemplates","data/DataManager"],function(e,t,i,n,s,a,r){"use strict";var o=_.template("Submitting <%= actionMode %> operation."),l=_.template("Error performing <%= actionMode %> operation.<div><%= errorMsg %></div>"),c=_.template("Successfully submitted <%= actionMode %> operation.<div><%= taskMsg %></div>"),u={PARENT_TASK_ID:"taskUuid",SUCCESS_LIST:"successList",ERROR_LIST:"errorList",ERROR_MESSAGE:"message",V2_TASK_ID:"task_uuid",V2_GENERIC_DTO:"generic_dto",V2_CLUSTER_UUID:"cluster_uuid"};return e.extend({models:null,successResponse:null,entityType:null,action:null,DP:u,initialize:function(t,i){e.prototype.initialize.apply(this,arguments),this.entityType=i.entityType,this.actionMode=i.action},toJSON:function(){var e=this;return _.map(this.models,function(i){var s={};s[t.IS_FANOUT]=!0;var a=i.toJSON(s);a[i.idAttribute]=i.getId();var r={},o=n.FANOUT.GENERIC_DTO,l=n.FANOUT.CLUSTER_UUID;if(e.entityType===t.ENTITY_VM)switch(e.actionMode){case t.ACTION_SNAPSHOT:case t.ACTION_RESTORE:case t.ACTION_MIGRATE:case t.ACTION_ENABLE_NGT:case t.ACTION_DISABLE_NGT:break;default:o=e.DP.V2_GENERIC_DTO,l=e.DP.V2_CLUSTER_UUID}else e.entityType===t.ENTITY_VDISK||e.entityType===t.ENTITY_NIC?(o=e.DP.V2_GENERIC_DTO,l=e.DP.V2_CLUSTER_UUID):e.entityType===t.ENTITY_ALERT&&(r[n.TASK_TYPE]=i.actionMode);return r[o]=a,r[l]=i[n.CLUSTER_UUID],r})},getURL:function(){var e=r.getNutanixApiDataSourceURL()+"/";switch(this.entityType){case t.ENTITY_VM:switch(this.actionMode){case t.ACTION_POWER_OFF:case t.ACTION_POWER_ON:case t.ACTION_PAUSE:case t.ACTION_RESUME:case t.ACTION_POWER_CYCLE:case t.ACTION_POWER_RESET:case t.ACTION_ACPI_SHUTDOWN:case t.ACTION_ACPI_REBOOT:return e+i.FANOUT.VM.SET_POWER_STATE;case t.ACTION_FANOUT.CREATE:return(e=r.getDataSourceURL()+"/")+i.FANOUT.VM.CREATE;case t.ACTION_CLONE:return(e=r.getDataSourceURL()+"/")+i.FANOUT.VM.CLONE;case t.ACTION_UPDATE:return e+i.FANOUT.VM.UPDATE;case t.ACTION_MIGRATE:return e+i.FANOUT.VM.MIGRATE;case t.ACTION_DELETE:return e+i.FANOUT.VM.DELETE;case t.ACTION_SNAPSHOT:return e+i.FANOUT.VM.SNAPSHOTS;case t.ACTION_RESTORE:return e+i.FANOUT.VM.SNAPSHOT_RESTORE;case t.ACTION_ENABLE_NGT:return(e=r.getDataSourceURL())+i.FANOUT.VM.ENABLE_NGT;case t.ACTION_DISABLE_NGT:return(e=r.getDataSourceURL())+i.FANOUT.VM.DISABLE_NGT;default:throw new Error("Error: Fanout for VM action "+this.actionMode+" is not available.")}case t.ENTITY_ACROPOLIS_SNAPSHOT:switch(this.actionMode){case t.ACTION_CLONE:return e+i.FANOUT.VM.SNAPSHOTS_CLONE;case t.ACTION_DELETE:return e+i.FANOUT.VM.SNAPSHOTS_DEL;default:throw new Error("Error: Fanout for Snapshot action "+this.actionMode+" is not available.")}case t.ENTITY_MANAGEMENT_SERVER:switch(e=r.getDataSourceURL(),this.actionMode){case t.ACTION_REGISTER:return e+i.FANOUT.MGMT_SERVER.REGISTER;case t.ACTION_UNREGISTER:return e+i.FANOUT.MGMT_SERVER.UNREGISTER;default:throw new Error("Error: Fanout for management server action "+this.actionMode+" is not available.")}case t.ENTITY_VDISK:switch(this.actionMode){case t.ACTION_CREATE:case t.ACTION_UPDATE:return e+i.FANOUT.VM.DISK_ATTACH;case t.ACTION_DELETE:return e+i.FANOUT.VM.DISK_DETACH}break;case t.ENTITY_NIC:switch(this.actionMode){case t.ACTION_CREATE:return e+i.FANOUT.VM.NIC_ATTACH;case t.ACTION_UPDATE:return e+i.FANOUT.VM.NIC_UPDATE;case t.ACTION_DELETE:return e+i.FANOUT.VM.NIC_DETACH}break;case t.ENTITY_ALERT:switch(e=r.getDataSourceURL(),this.actionMode){case t.ACTION_ACKNOWLEDGE:return e+i.ALERT_ACKNOWLEDGE_FANOUT;case t.ACTION_RESOLVE:return e+i.ALERT_RESOLVE_FANOUT}break;default:throw new Error("Error: Fanout for entity type "+this.entityType+" is not available.")}},performFanout:function(e){e=e||{};var i=this,n=e.success,s=this.getNotificationManager(),a=this.getTaskManager();e.success=function(e,r,o){i.successResponse=e,a.fetchTasksOnDemand([i.getTaskUuid(e)]),s.showNotification(t.NOTIFY_SUCCESS,i,i.actionMode,e),n&&n(i,e)};var r=e.error;e.error=function(n,a,o){i.errorResponse=n,s.showNotification(t.NOTIFY_ERROR,i,i.actionMode,n),r&&r(i,n,e)};var o=this.toJSON();return s.showLatencyAction(this,this.actionMode),$.ajax({type:e.type||"POST",url:this.getURL(),data:JSON.stringify(o),dataType:"json",contentType:"application/json; charset=UTF-8",success:e.success,error:e.error})},getLatencyMessage:function(e){return o({actionMode:this.getActionName(e)})},getNotificationMessage:function(e,i){if(i===t.NOTIFY_ERROR)return l({actionMode:this.getActionName(e),errorMsg:s.processThrownError(this.errorResponse)});if(!this.getTaskUuid(this.successResponse))return l({actionMode:this.getActionName(e),errorMsg:"The task response did not contain a task ID"});var n=a.PAGE_LINK({content:"Task details."});return c({actionMode:this.getActionName(e),taskMsg:$(n).attr({pageId:t.PAGE_TASKS}).prop("outerHTML")})},getTaskUuid:function(e){if(e[this.DP.PARENT_TASK_ID])return e[this.DP.PARENT_TASK_ID];if(e[this.DP.V2_TASK_ID])return e[this.DP.V2_TASK_ID];throw new Error("The fanout response didn't contain a task uuid")},getActionName:function(e){return t.ACTION_NAMES[e]||s.toTitleCase(e)}},{DP:u})}),define("utils/ConfigAccessMixin",["utils/AppConstants","utils/AppUtil","utils/ManagerMixin"],function(e,t,i){"use strict";var n={ACTION_ACCESS:"access",EB_ACCESS_ROLES:"roles",EB_ACCESS_PERMS:"permissions",EB_ACCESS_ENVIRONMENTS:"environments",EB_ATTRIBUTES:"attributes",EB_FEATURES:"features",EB_MATCH:"match",ENTITY_TYPE:"entityType"},s={ANY:"any",ALL:"all"};return _.extend({},i,{getAccessConfig:function(e){return e[n.ACTION_ACCESS]},hasAccess:function(e){return!e||this.canAccessByRole(e)&&this.canAccessByPerm(e)&&this.canAccessByEnvironment(e)},canAccessByPerm:function(e){var t=e[n.EB_ACCESS_PERMS];if(t){var i=this.getAccessManager();return _.every(t,function(e){return i.hasPermission(this.get(n.ENTITY_TYPE),e)},this)}return!0},canAccessByRole:function(e){var i=this,s=e[n.EB_ACCESS_ROLES];return!(s&&!t.isLocalStorageProperty("nutanix_by_pass_eb_action_roles"))||_.some(s,function(e){return i.getAccessManager().hasRole(e)})},canAccessByEnvironment:function(e){var t=e[n.EB_ACCESS_ENVIRONMENTS];if(t&&this.getAppManager()){var i=this.getAppManager().getEnvironmentMode();return _.contains(t,i)}return!0},canAccessByFeatureFlag:function(t,i){var a=t[n.EB_FEATURES],r=this.getClusterManager(),o=i||r.getPrimaryClusterModel();if(a){var l=t[n.EB_FEATURES+"."+n.EB_MATCH]||s.ANY,c=function(t){return o&&e.FFLAGS[t]&&o.isFFEnabled(e.FFLAGS[t])};return l===s.ANY?_.some(a,c):_.every(a,c)}return!0},canAccessEntityAttribute:function(e,i){try{var n=this.getEntityManager().getEntitySchema(e);if(n)return this.canAccessAttributeBySchema(n,i)}catch(e){t.log(e)}return!1},canAccessAttributeBySchema:function(e,i){var n=e.get(e.DP.ATTRIBUTES)[i];if(n){var s=this.getAccessConfig(n);if(s){var a=this.hasAccess(s);return a||t.debugObject("ConfigAccessMixin: Filtering out attribute as its not accessible to the user",s),a}}return!0}})}),define("models/ebrowser/schema/SchemaModel",["backbone","data/DataURLConstants","utils/AppConstants","utils/ConfigAccessMixin"],function(e,t,i,n){"use strict";var s={ENTITY_TYPE:"entityType",ID_ATTR:"idAttribute",NAME_ATTR:"nameAttribute",GROUPING_ATTR:"groupingAttribute",ATTRIBUTES:"attributes",ATTR_TYPE:"type",ATTR_SUBTYPE:"subType",ATTR_INPUT_TYPE:"inputType",ATTR_INPUT_PARAMS:"inputParams",ATTR_DISP_NAME:"displayName",ATTR_UNITS:"units",ATTR_VALUES:"values",ATTR_FILTERABLE:"filterable",ATTR_SORTABLE:"sortable",ATTR_CONTINUOUS:"continuous",ATTR_IS_LIST:"isList",ATTR_IS_INTERNAL:"internalAttribute"},a={INT:"int",STR:"string",ENUM:"enum",OBJECT:"object",OBJECT_STR:"objectStr"};return e.Model.extend(_.extend({},n,{name:"SchemaModel",urlRoot:t.ENTITY_SCHEMA,DP:s,TYPES:a,UNITS:i.UNITS,defaults:{entityType:null,idAttribute:null,nameAttribute:null,attributes:{}},getGroupingAttribute:function(){return this.get(s.GROUPING_ATTR)||this.get(s.NAME_ATTR)},getAttributeInfo:function(e){return this.get(this.DP.ATTRIBUTES)[e]},getNameAttribute:function(){return this.get(s.NAME_ATTR)},canAccessAttribute:function(e){return this.canAccessAttributeBySchema(this,e)},getUserVisibleAttrs:function(){var e=this,t=this.get(this.DP.ATTRIBUTES),i=[];return _.each(t,function(t,n){e.canAccessAttribute(t)&&!t[e.DP.ATTR_IS_INTERNAL]&&i.push(n)}),i}}),{DP:s,TYPES:a})}),define("utils/EntityUtil",["managers/I18nManager","models/FanoutActionCollection","models/ebrowser/schema/SchemaModel","data/DataProperties","utils/SVG","utils/StatsUtil","utils/AppConstants","utils/AppUtil","utils/HypervisorUtil","utils/ManagerMixin","utils/TimeUtil"],function(e,t,i,n,s,a,r,o,l,c,u){"use strict";var d,h=_.template('<div class="eb-label-tooltip"><% _.each(labels, function(label) { %><div class="label-name"><%- label %></div><% }) %></div>'),p=[r.ENTITY_VM_RECOVERY_POINT],T=[r.ENTITY_CATEGORY,r.ENTITY_NETWORK_SECURITY_RULE,r.ENTITY_VM_RECOVERY_POINT],E=[r.ENTITY_OBJECT_STORE],S=[r.ENTITY_OBJECT_STORE,r.ENTITY_K8S_CLUSTER],g=[],A=(d={},_defineProperty(d,r.ENTITY_STORAGE_CONTAINER,r.ENTITY_CONTAINER),_defineProperty(d,r.SSP_INTENT_KINDS.IMAGE,r.ENTITY_IMAGE),d),m={};return _.extend({},c,{name:"EntityUtil",initialize:function(){this.getAccessManager().hasPermission(r.ENTITY_MH_VM,r.ACTION_VIEW)&&(A[r.ENTITY_MH_VM]=r.ENTITY_VM),this._fillMapUIEDB()},_fillMapUIEDB:function(){_.each(A,function(e,t){m[e]=t})},createCollection:function(e,t){return this.getEntityManager().createGenericEntityCollection(e,t)},createFanoutCollection:function(e,i,n){_.isArray(n)||(n=[n]);var s=new t([],{entityType:e,action:i});return s.add(n),s},isGraphqlEntityType:function(e){return _.contains(p,e)},isExternalEntityType:function(e){return _.contains(S,e)},isGroupedEntityType:function(e){return _.contains(T,e)},isBetaEntityType:function(e){return _.contains(E,e)},isBetaEntityForm:function(e){return _.contains(g,e)},isInnerFilteredEntityType:function(e){var t=[r.ENTITY_GPU,r.ENTITY_USER,r.ENTITY_MARKETPLACE_ITEM,r.ENTITY_VM,r.ENTITY_PROJECT,r.ENTITY_QOS_POLICY,r.ENTITY_NGT_POLICY];return _.contains(t,e)},getEntityActionTitle:function(t,i,n){var s=this.getEntityManager().getEntityActionTitle(t);if(s){var a=s.getActionModelByActionId(i);if(!a)return null;var r=o.sprintf("actions_%s.%s%s",t,i,n?"_short":""),l="";return l=n?a.get(a.DP.SHORT_TITLE)||a.get(a.DP.TITLE):a.get(a.DP.TITLE),e.t(this.name,r,l)}},getEntityActionGroupTitle:function(t,i){return e.t(this.name,"actions_"+t+"."+i,i)},isEvictableEntity:function(e){switch(e){case r.ENTITY_ALERT:case r.ENTITY_EVENT:case r.ENTITY_AUDIT:return!0;default:return!1}},getNameAttribute:function(e){try{return this.getEntityManager().getEntitySchema(e).getNameAttribute()}catch(e){o.log(e)}return null},getAttributeSchema:function(e,t){try{var i=this.getEntityManager().getEntitySchema(e);if(i)return i.getAttributeInfo(t)}catch(e){o.log(e)}return null},isAttributeOfType:function(e,t,n){var s=this.getAttributeSchema(e,t);return s&&s[i.DP.ATTR_TYPE]===n},isStringAttribute:function(e,t){return this.isAttributeOfType(e,t,i.TYPES.STR)},isObjectStringAttribute:function(e,t){return this.isAttributeOfType(e,t,i.TYPES.OBJECT_STR)},isIntAttribute:function(e,t){return this.isAttributeOfType(e,t,i.TYPES.INT)},isListAttribute:function(e,t){var n=this.getAttributeSchema(e,t);return n&&n[i.DP.ATTR_IS_LIST]},isSortableAttribute:function(e,t){var n=this.getAttributeSchema(e,t);return n&&!1!==n[i.DP.ATTR_SORTABLE]},getAttributeDisplayName:function(t,i){if(i&&0===i.indexOf(r.ENTITY_CATEGORY_PREFIX))return i.split(".")[1];var n=null,s=this.getEntityManager().getEntitySchema(t);if(s){var a=s.getAttributeInfo(i);a&&(n=a[s.DP.ATTR_DISP_NAME])}var l=o.sprintf("schema_%s.%s",t,i);return e.t(this.name,l,n)||o.toTitleCase(i)},getAttributeDisplayTooltip:function(t,i,s){var r=this.getEntityManager().getEntitySchema(t);if(r){if(r.getAttributeInfo(i)){switch(i){case n.STATS_MEMORY_USAGE:var c=s&&s.get("cluster");if(c){if(!a.isVMMemoryMetricSupported(n.STATS_MEMORY_USAGE,c))return}else if(!l.hasAnyPENull()&&!l.hasAnyPEHyperv())return}var u=o.sprintf("tooltips_%s.%s",t,i);return e.t(this.name,u,"")}}},getAttributeDisplayValue:function(t,i,s,l,c){var d=this.getEntityManager().getEntitySchema(t);if(d){var h=d.getAttributeInfo(i);if(h){var p=void 0;if(h[d.DP.ATTR_TYPE]===r.FILTER_TYPES.ENUM){p=h[d.DP.ATTR_VALUES];var T=_.isNull(s)?"":s;if(p&&p[T]){if(c)return p[T]||r.DATA_NOT_AVAILABLE;var E=o.sprintf("schema_values_%s.%s_%s",t,i,T);return e.t(this.name,E,p[T]||r.DATA_NOT_AVAILABLE)}}if(_.isNull(s))return r.DATA_NOT_AVAILABLE;var S=h[d.DP.ATTR_UNITS];if(S)switch(S){case d.UNITS.BYTES:return a.storageFormat(s);case d.UNITS.MB:return a.workingSetSizeFormat(s);case d.UNITS.HZ:return a.cpuHertzFormat(s);case d.UNITS.KBPS:return isNaN(s)||s<0?r.STATS_NOT_AVAILABLE:a.bandwidthFormat(s,l);case d.UNITS.IOPS:return a.iopsFormat(s,l);case d.UNITS.PPM:return a.ppmFormat(s);case d.UNITS.PPH:return a.hundredsFormat(s);case d.UNITS.PCT:return a.roundPercent(s);case d.UNITS.SECS:return a.rawNumericFormat(s);case d.UNITS.USECS:return a.microSecondsFormat(s);case d.UNITS.MSECS:return u.formatDateTime(s);case d.UNITS.RAW:return a.rawNumericFormat(s);case d.UNITS.TIME:return u.formatDateTime(s>0?s/1e3:0);case d.UNITS.HEALTH:return this.getHealthDisplayValue(s);case r.UNITS.PERCENT:return a.percentageFormat(s)}}if(i===n.CLUSTER_HYPERVISOR||i===n.EB.VM.HYPERVISOR_TYPE||i===n.EB.CLUSTER.HYPERVISOR_TYPES||i===n.CLUSTER_HYPERVISORS){if(_.isArray(s)){var g=[];return _.each(s,function(e){g.push(r.HYPERVISOR_LABEL[e]||e)}),g.join(",")}return r.HYPERVISOR_LABEL[s]||s}if(i===n.HOST_TYPE){var A=t+"_"+s;return e.t("Common","EntityValues."+A)}}return s},getMetricUnits:function(e,t){var i="",n=this.getEntityManager().getEntitySchema(e);if(n){var s=n.getAttributeInfo(t);s&&(i=s[n.DP.ATTR_UNITS])}return i},getSortableAttributes:function(e,t){return _.filter(t,function(t){return this.isSortableAttribute(e,t)},this)},assignTooltips:function(e,t,i){_.each(t,function(t){var n=i(t),s=t.getValue(t.idAttribute);e.find('[data-id="'+s+'"]').tooltip({title:n,placement:"right",trigger:"hover",html:!0,container:$("body")})})},clearTooltips:function(e,t){_.each(e.find(t),function(e){$(e).tooltip("destroy")})},sortLabels:function(e){return(e||[]).slice().sort(function(e,t){var i=e.get(e.nameAttribute)||"",n=t.get(t.nameAttribute)||"";return i.localeCompare(n)})},clearLabelIcons:function(e){e.find(".label-icon").empty()},renderLabelIcon:function(e,t){var i=this.getEntityLabelsIconAndTooltip(t);if(i){var n=t.get(t.idAttribute),s='.entityTooltipTarget[data-id="'+n+'"] .label-icon',a=e.find(s);a.html(i.iconHTML),a.tooltip({title:i.tipHTML,placement:"top",trigger:"hover",html:!0,container:$("body")})}},getEntityLabelsIconAndTooltip:function(e){var t=e.get(n.LABEL_NAMES);if(t&&t.length){var i=void 0;switch(t.length){case 1:i=s.SVGIcon("Label_Single","labelIcon");break;case 2:i=s.SVGIcon("Label_Double","labelIcon");break;default:i=s.SVGIcon("Label_Triple","labelIcon")}return{iconHTML:'<div class="cover-svg"></div>'+i,tipHTML:h({labels:t})}}return null},hasArithmosStats:function(){return this.getClusterManager().isClusterFFEnabled(r.FFLAGS.ARITHMOS_USAGE_STATS)},getHealthDisplayValue:function(t){var i=void 0;return i=t?t>r.TEST_SCORE_THRESHOLDS.GOOD?r.HEALTH_STATUS.GOOD:t>r.TEST_SCORE_THRESHOLDS.WARNING?r.HEALTH_STATUS.WARNING:t>=r.TEST_SCORE_THRESHOLDS.CRITICAL?r.HEALTH_STATUS.CRITICAL:r.HEALTH_STATUS.UNKNOWN:r.HEALTH_STATUS.UNKNOWN,e.t(this.name,"healthStatus."+i,i)},getEntityAttributes:function(e,t,i,n){var s=require("models/query/BaseQueryModel"),a=new s;a.set(a.DP.ENTITY_IDS,t),a.set(a.DP.ENTITY_TYPE,e),a.setGroupMemberAttributesList(i),a.save(null,n)},getNetworkEntityAttributes:function(t){var i={};switch(t){case n.NW_E_TYPES.HOST:i={title:e.t(this.name,"network_details.host_title"),attribs:{hypervisorAddress:{label:e.t(this.name,"network_details.hypervisor_ip")},serviceVMExternalIP:{label:e.t(this.name,"network_details.cvm_ip")},ipmiAddress:{label:e.t(this.name,"network_details.ipmi_ip")},name:{label:e.t(this.name,"network_details.bridges")},link_capacity:{label:e.t(this.name,"network_details.physical_nics"),format:!0}}};break;case n.NW_E_TYPES.BRIDGE:i={title:e.t(this.name,"network_details.bridge_lbl"),attribs:{name:{label:e.t(this.name,"network_details.name")},mtu_bytes:{label:e.t(this.name,"network_details.mtu")}}};break;case n.NW_E_TYPES.BOND:i={title:e.t(this.name,"network_details.bond_lbl"),attribs:{name:{label:e.t(this.name,"network_details.name")},type:{label:e.t(this.name,"network_details.bond_type")}}};break;case n.NW_E_TYPES.PNIC:i={title:e.t(this.name,"network_details.pnic_lbl"),attribs:{mtu_bytes:{label:e.t(this.name,"network_details.mtu")},link_capacity:{label:e.t(this.name,"network_details.pnic_link_cap")},mac_address:{label:e.t(this.name,"network_details.mac")},port_name:{label:e.t(this.name,"network_details.port_name")},discovery_protocol:{label:e.t(this.name,"network_details.pnic_discovery_protocol")},switch_name:{label:e.t(this.name,"network_details.pnic_switch_name")},switch_port_name:{label:e.t(this.name,"network_details.pnic_switch_port_name")},switch_mgmt_ip_address:{label:e.t(this.name,"network_details.pnic_switch_mgmt_ip")},switch_port_native_vlan:{label:e.t(this.name,"network_details.pnic_switch_port_vlan")}}};break;case n.NW_E_TYPES.SWITCH:i={title:e.t(this.name,"network_details.switch_lbl"),attribs:{name:{label:e.t(this.name,"network_details.name")},vendor_name:{label:e.t(this.name,"network_details.switch_vendor")},management_ip_address:{label:e.t(this.name,"network_details.switch_mgmt_ip")},vlan_ids:{label:e.t(this.name,"network_details.switch_vlan_ids")},description:{label:e.t(this.name,"network_details.switch_description")},contact:{label:e.t(this.name,"network_details.switch_contact")},location:{label:e.t(this.name,"network_details.switch_location")}}};break;case n.NW_E_TYPES.SWITCH_INTERFACE:i={title:e.t(this.name,"network_details.switch_port_lbl"),attribs:{name:{label:e.t(this.name,"network_details.name")},physical_address:{label:e.t(this.name,"network_details.switch_port_phy_address")},type:{label:e.t(this.name,"network_details.switch_port_type")},allowed_vlan_ids:{label:e.t(this.name,"network_details.switch_port_native_vlans")},mtu_bytes:{label:e.t(this.name,"network_details.mtu")},speed_kbps:{label:e.t(this.name,"network_details.switch_speed")}}};break;case n.NW_E_TYPES.CVM:i={title:e.t(this.name,"network_details.cvm_lbl"),attribs:{mac_address:{label:e.t(this.name,"network_details.mac")},port_name:{label:e.t(this.name,"network_details.port_name")},mtu_bytes:{label:e.t(this.name,"network_details.mtu")},vlan_id:{label:e.t(this.name,"network_details.vm_vlan_id")},ipv4_addresses:{label:e.t(this.name,"network_details.vm_ipv4_addresses")}}};break;case n.NW_E_TYPES.VM:i={title:e.t(this.name,"network_details.vm_lbl"),attribs:{mac_address:{label:e.t(this.name,"network_details.mac")},port_name:{label:e.t(this.name,"network_details.port_name")},mtu_bytes:{label:e.t(this.name,"network_details.mtu")},vlan_id:{label:e.t(this.name,"network_details.vm_vlan_id")},virtual_network:{label:e.t(this.name,"network_details.vm_virtual_network")},ipv4_addresses:{label:e.t(this.name,"network_details.vm_ipv4_addresses")}}}}return i},getNetworkEntityMetrics:function(e){var t=[];switch(e){case n.NW_E_TYPES.PNIC:case n.NW_E_TYPES.VNIC:t=[n.STATS_NETWORK_RECEIVED_RATE,n.STATS_NETWORK_TRANSMITTED_RATE,n.STATS_NETWORK_DROPPED_RECEIVED_PACKETS,n.STATS_NETWORK_DROPPED_TRANSMITTED_PACKETS,n.STATS_NETWORK_ERROR_RECEIVED_PACKETS];break;case n.NW_E_TYPES.SWITCH_INTERFACE:t=[n.STATS_NETWORK_UNICAST_RECEIVED_PACKETS,n.STATS_NETWORK_UNICAST_TRANSMITTED_PACKETS,n.STATS_NETWORK_DISCARD_TRANSMITTED_PACKETS,n.STATS_NETWORK_DISCARD_RECEIVED_PACKETS,n.STATS_NETWORK_ERROR_RECEIVED_PACKETS]}return t},fromEdb:function(e){return A[e]||e},toEdb:function(e){return m[e]||e},getEntityActions:function(e){return this.getEntityManager().getEntityActions(e)},isContinuousGroupByAttribute:function(e,t){try{var i=this.getEntityManager().getEntitySchema(e);if(i){var n=i.getAttributeInfo(t);return n&&n[i.DP.ATTR_CONTINUOUS]}}catch(e){o.debug(e)}return!1},getSubstituteEntityType:function(e){switch(e){case r.ENTITY_AVAILABILITY_ZONE:return r.ENTITY_CLOUD_TRUST;default:return e}},resetSubstituteEntityType:function(e){switch(e){case r.ENTITY_CLOUD_TRUST:return r.ENTITY_AVAILABILITY_ZONE;default:return e}}})}),define("models/query/BaseQueryModel",["models/BaseModel","utils/AppUtil","utils/EntityUtil","utils/FilterUtil","utils/AppConstants","data/DataURLConstants","data/DataProperties","data/DataManager"],function(e,t,i,n,s,a,r,o){"use strict";var l={ENTITY_TYPE:"entity_type",ENTITY_IDS:"entity_ids",TITLE:"title",QUERY_NAME:"query_name",AVAILABILITY_ZONE_SCOPE:"availability_zone_scope",FILTER_CRITERIA:"filter_criteria",FILTER_EXPR:"filter_expression",FILTER_ATTR_JOIN_OPS:"filter_join_ops",FILTER_OR_EXPR:"filter_or_expression",GROUPING_ATTR:"grouping_attribute",GROUPING_ATTR_TYPE:"grouping_attribute_type",GROUP_SORT_ATTR:"group_sort_attribute",
GROUP_SORT_ORDER:"group_sort_order",GROUP_SORT_DS_FUNC:"group_sort_downsample_function",GROUP_COUNT:"group_count",GROUP_OFFSET:"group_offset",GROUP_ATTRIBUTES:"group_attributes",GROUP_NUM_BUCKETS:"number_of_buckets",GROUP_BUCKET_BOUNDARY:"bucket_boundary",GROUP_MEMBER_COUNT:"group_member_count",GROUP_MEMBER_OFFSET:"group_member_offset",GROUP_MEMBER_SORT_ATTRIBUTE:"group_member_sort_attribute",GROUP_MEMBER_SORT_ORDER:"group_member_sort_order",GROUP_MEMBER_SORT_DS_FUNC:"group_member_sort_downsampling_function",GROUP_MEMBER_ATTRIBUTES:"group_member_attributes",INTERVAL_START:"interval_start_ms",INTERVAL_END:"interval_end_ms",DOWNSAMPLING_INTERVAL:"downsampling_interval",TOTAL_ENTITY_COUNT:"total_entity_count",FILTERED_ENTITY_COUNT:"filtered_entity_count",TOTAL_GROUP_COUNT:"total_group_count",FILTERED_GROUP_COUNT:"filtered_group_count",GROUP_RESULTS:"group_results",GROUP_BY_COLUMN_VALUE:"group_by_column_value",GROUP_SUMMARIES:"group_summaries",GROUP_SUMMARIES_NAME:"sum:name",ENTITY_RESULTS:"entity_results",RESULT_MODELS:"models",PAGINATOR:"paginator"},c=[s.ENTITY_VM];return e.extend({idAttribute:r.ID,urlRoot:a.ENTITY_BROWSER_QUERY,name:"BaseGroupModel",DP:l,GROUPING_TYPE_CONTINUOUS:"CONTINUOUS",URL_ATTRIBUTES:["entity_type","entity_ids","query_name","grouping_attribute","grouping_attribute_type","group_sort_attribute","group_sort_order","group_count","group_offset","group_page_number","group_attributes","number_of_buckets","bucket_boundary","group_member_count","group_member_offset","group_member_sort_attribute","group_member_sort_order","group_member_attributes","availability_zone_scope","interval_start_ms","interval_end_ms","downsampling_interval"],URL_STR_ATTRIBUTES:["entity_type","query_name","grouping_attribute","grouping_attribute_type","group_sort_attribute","group_sort_attribute","group_member_sort_attribute","group_member_sort_order"],initialize:function(t){t=t||{},e.prototype.initialize.apply(this,arguments),this.isIntent=t.isIntent,this.disableHybridQuery=t.disableHybridQuery},showLatencyNotification:function(e,t){},showSuccessNotification:function(e,t,i){},triggerAppViewRefresh:function(){},toJSON:function(){var e={};_.each(this.URL_ATTRIBUTES,function(t){var i=this.get(t);(0===i||i)&&(this.URL_STR_ATTRIBUTES.indexOf(t)>=0?e[t]=String(i):e[t]=i)},this),e[l.QUERY_NAME]||(e[l.QUERY_NAME]="prism:"+this.name),this.isQueryForHybrid()&&!e[l.AVAILABILITY_ZONE_SCOPE]&&(e[l.AVAILABILITY_ZONE_SCOPE]=s.AVAILABILITY_ZONE_SCOPE.GLOBAL);var t=e[this.DP.GROUPING_ATTR];if(this._isContinuousGroupBy()&&(e[this.DP.GROUP_SORT_ATTR]=e[this.DP.GROUP_SORT_ATTR]||t,e[this.DP.GROUP_SORT_ORDER]=e[this.DP.GROUP_SORT_ORDER]||s.SORT_ASCENDING,e[this.DP.GROUPING_ATTR_TYPE]=this.GROUPING_TYPE_CONTINUOUS,e[this.DP.GROUP_NUM_BUCKETS]=this.get(this.DP.GROUP_NUM_BUCKETS)||this.DEFAULT_NUM_BUCKETS,e[this.DP.GROUP_BUCKET_BOUNDARY]=this.get(this.DP.GROUP_BUCKET_BOUNDARY)||this._getGroupByAttributeBucketBoundary(t),e[this.DP.GROUP_ATTRIBUTES]=e[this.DP.GROUP_ATTRIBUTES]||[{attribute:t,operation:r.AGGREGATORS.AVERAGE}]),this.get(this.DP.FILTER_CRITERIA))throw"Invalid query. Filter criteria is set directly.";if(this.get(this.DP.FILTER_EXPR)&&this.get(l.FILTER_OR_EXPR))throw new Error("Invalid query: cannot set both FILTER_EXPR or FILTER_OR_EXPR");var n=this._filterExpressionToFilterCriteria(this.get(this.DP.FILTER_EXPR),this.get(this.DP.FILTER_ATTR_JOIN_OPS));n&&(e[this.DP.FILTER_CRITERIA]=n);var a=void 0;if(this.get(l.FILTER_OR_EXPR)&&(a=this._filterORExpressionToFilterCriteria(this.get(l.FILTER_OR_EXPR))),a&&(e[this.DP.FILTER_CRITERIA]=a),this.getDataManager().isV3PrimaryDataSource()){var o=this.get(this.DP.ENTITY_TYPE);e[this.DP.ENTITY_TYPE]=i.toEdb(o)}return i.isEvictableEntity(e[this.DP.ENTITY_TYPE])&&e[this.DP.GROUPING_ATTR]===s.GROUP_BY_NONE&&(e[this.DP.GROUPING_ATTR]=""),e},parse:function(t,n){var s=e.prototype.parse.apply(this,arguments);if(this.getDataManager().isV3PrimaryDataSource()){var a=t[this.DP.ENTITY_TYPE];s[this.DP.ENTITY_TYPE]=i.fromEdb(a)}return s},getDataSourceURL:function(){return this.isIntent?o.getV3DataSourceURL():e.prototype.getDataSourceURL.apply(this,arguments)},toSavedQueryJSON:function(){var e=this.toJSON();return delete e[this.DP.FILTER_CRITERIA],e[this.DP.FILTER_EXPR]=this.get(this.DP.FILTER_EXPR),e},getIncompletedStateModels:function(){return[]},setMultipleGroupByAttributes:function(e){e&&this.set(this.DP.GROUPING_ATTR,e.join(","))},setTimeInterval:function(e,t,i){var n={};if(e>t)throw new Error("Invalid : Start time greater than End time");n[this.DP.INTERVAL_START]=e,n[this.DP.INTERVAL_END]=t,n[this.DP.DOWNSAMPLING_INTERVAL]=i,this.set(n,{silent:!0})},setDefaultGroupByTimeInterval:function(e){var t=Date.now();e[this.DP.INTERVAL_START]=t-3*s.MILLIS_PER_HOUR,e[this.DP.INTERVAL_END]=t},getQueryResultAttributes:function(){var e=[],t=this.get(this.DP.GROUP_RESULTS);return _.each(t,function(t){var i=this._rawResultsToEntities(t[this.DP.ENTITY_RESULTS]);e=e.concat(i)},this),e},getQueryResultSummary:function(){var e=[],t=this.get(this.DP.GROUP_RESULTS);return _.each(t,function(t){var i=this._getSummaryAttributes(t[this.DP.GROUP_SUMMARIES]),n=this._rawResultsToEntities(t[this.DP.ENTITY_RESULTS]);e.push({summary:i,entities:n})},this),e},_getSummaryAttributes:function(e){var t={},i=e&&e[this.DP.GROUP_SUMMARIES_NAME];return i&&i.values&&i.values[0]&&i.values[0].values&&(t[i.name]=i.values[0].values[0]),t},convertGroupMemberAttributesList:function(e){var t=[];return _.each(e,function(e){t.push({attribute:e})}),t},setGroupMemberAttributesList:function(e){this.set(this.DP.GROUP_MEMBER_ATTRIBUTES,this.convertGroupMemberAttributesList(e),{silent:!0})},_filterExpressionToFilterCriteria:function(e,t){return e?n.filterExpressionToFIQL(e,t):null},_filterORExpressionToFilterCriteria:function(e){return e?n.filterORExpressionToFIQL(e):null},_isContinuousGroupBy:function(){var e=this.get(this.DP.ENTITY_TYPE),t=this.get(this.DP.GROUPING_ATTR);if(t){var n=t.split(",");return _.some(n,function(t){return i.isContinuousGroupByAttribute(e,t)},this)}},_getGroupByAttributeBucketBoundary:function(e){var t=this.get(this.DP.ENTITY_TYPE);if(e){switch(i.getAttributeSchema(t,e).units){case s.UNITS.PPM:return 1e5;case s.UNITS.BYTES:return 1024;case s.UNITS.KBPS:return 1e3;case s.UNITS.IOPS:return 100;case s.UNITS.USECS:return 1e4}}return 1024},_rawResultsToEntities:function(e){return this.clusterManager.isMulticlusterNavMode()&&t.compareVersions(this.clusterManager.getPrismCentralVersion(),"4.7",2)<=0?this._rawResultsToEntities_delos(e):this._rawResultsToEntities_astrix(e)},_rawResultsToEntities_astrix:function(e){for(var t=[],n=e?e.length:0,s=this.get(this.DP.ENTITY_TYPE),a=0;a<n;a++){var o=e[a],l={};l.id=o[r.EB.ENTITY_ID],l[r.EB.ENTITY_ID]=o[r.EB.ENTITY_ID];for(var c=o.data?o.data.length:0,u=0;u<c;u++){var d=o.data[u],h=d.name,p=i.isListAttribute(s,h),_=i.isObjectStringAttribute(s,h);if(0===d.values.length)l[h]=null;else if(1===d.values.length){if(d.values[0].values)if(p)l[h]=this._listParse(d.values[0].values,_);else{var T=d.values[0].values[0];l[h]=this._valueParse(T,_)}}else{for(var E=[],S=d.values?d.values.length:0,g=0;g<S;g++)E.push(this._valueParse(d.values[g].values[0],_));l[h]=E}}t.push(l)}return t},_listParse:function(e,t){var i=[],n=e?e.length:0;if(!t)return e;for(var s=0;s<n;s++)i.push(this._valueParse(e[s],t));return i},_valueParse:function(e,t){return e&&t?this._jsonParse(e):e},_rawResultsToEntities_delos:function(e){for(var t=[],i=e?e.length:0,n=0;n<i;n++){var s=e[n],a={};a.id=s[r.EB.ENTITY_ID],a[r.EB.ENTITY_ID]=s[r.EB.ENTITY_ID];for(var o=s.data?s.data.length:0,l=0;l<o;l++){var c=s.data[l],u=c.name;if(0===c.values.length)a[u]=null;else if(1===c.values.length)c.values[0].list_values?a[u]=c.values[0].list_values:a[u]=c.values[0].value;else{for(var d=[],h=c.values?c.values.length:0,p=0;p<h;p++)d.push(c.values[p].value);a[u]=d}}t.push(a)}return t},_jsonParse:function(e){return t.parseJSON(e)||null},isQueryForHybrid:function(){if(this.disableHybridQuery)return!1;var e=this.getAppManager(),t=this.getAccessManager(),i=this.get(l.ENTITY_TYPE);return t.isClusterFFEnabled(s.FFLAGS.XI_HYBRID_VIEW,!0)&&e.isOnprem()&&_.contains(c,i)}},{DP:l})}),define("utils/VMUtil",["data/DataProperties","utils/CommonTemplates","utils/AppConstants","data/DataURLConstants","utils/FilterUtil","utils/ManagerMixin","utils/I18nMixin","models/query/BaseQueryModel"],function(e,t,i,n,s,a,r,o){"use strict";var l={};l[i.HYPERVISOR_TYPE.KVM]=[i.ACTION_LAUNCH_CONSOLE,i.ACTION_UPDATE,i.ACTION_CLONE,i.ACTION_MIGRATE,i.ACTION_DELETE,i.ACTION_SNAPSHOT,i.ACTION_POWER_OFF,i.ACTION_POWER_ON,i.ACTION_MANAGE_NGT,i.ACTION_DELETE_FILE_INSIGHTS],l[i.HYPERVISOR_TYPE.ESXI]=[i.ACTION_LAUNCH_CONSOLE,i.ACTION_UPDATE,i.ACTION_CLONE,i.ACTION_DELETE,i.ACTION_POWER_OFF,i.ACTION_POWER_ON,i.ACTION_MANAGE_NGT,i.ACTION_RESUME,i.ACTION_SUSPEND,i.ACTION_DELETE_FILE_INSIGHTS],l[i.HYPERVISOR_TYPE.XEN]=[i.ACTION_LAUNCH_CONSOLE],l[i.HYPERVISOR_TYPE.HYPERV]=[i.ACTION_LAUNCH_CONSOLE,i.ACTION_UPDATE,i.ACTION_CLONE,i.ACTION_DELETE,i.ACTION_POWER_OFF,i.ACTION_POWER_ON,i.ACTION_RESUME,i.ACTION_SUSPEND,i.ACTION_SAVE,i.ACTION_DISCARD];var c=[i.ACTION_UPDATE,i.ACTION_EDIT,i.ACTION_CLONE,i.ACTION_DELETE,i.ACTION_RESUME,i.ACTION_SUSPEND,i.ACTION_PAUSE],u={};u[i.HYPERVISOR_TYPE.KVM]=/["'*,[\]?%$]/,u[i.HYPERVISOR_TYPE.ESXI]=/[\%\&\$\#\@\!\\\/\:\*\?\"<\>\|\;\']/;var d=_.template("<%= name %><%= count %>");return _.extend({},r,{name:"VMUtil",getPowerState:function(e){return e||(e="unknown"),t.VM_POWER_STATE({state:e})},isVmActionSupported:function(t,n){if(n.isCVM()&&t!==i.ACTION_LAUNCH_CONSOLE)return!1;var s,r=n?n.get(e.VM_HYPERVISOR_TYPE):null;if(n.isHyperV()){var o=n.get(e.CLUSTER_UUID),c=a.getClusterManager().getClusterModelByClusterUuid(o);if(!c||!c.isAmfOverHypervSupported())return!1}return n.isKVM()&&(r=i.HYPERVISOR_TYPE.KVM),!(!n||!r)&&((s=l[r])&&s.indexOf(t)>=0)},getActionsRequiringMgmtServerRegistration:function(){return c},isVmActionSupportedOnCurrentCluster:function(t,i){var n=i.get(e.CLUSTER_UUID),s=a.getClusterManager().getClusterModelByClusterUuid(n);return!(i.isESX()&&_.indexOf(c,t)>=0&&s&&!s.isManagementServerRegistered())&&this.isVmActionSupported(t,i)},isValidVmName:function(e,t){if(e=$.trim(e)){var i=u[t];return!i||!i.test(e)}return!1},getCloneNames:function(e,t,i,n){for(var s=[],a=(""+(e+i)).length,r=new Array(a+1).join("0"),o=n&&"number"==typeof n?n:e,l=0;l<o;l++){var c=(""+r+(l+i)).slice(-a),u=d({name:t,count:c});s.push(u)}return s},getRunningUVMs:function(t){var r,l={};s.addFilterCondition(l,e.EB.VM.POWER_STATE,s.createFilterCondition(i.ENTITY_VM,e.EB.VM.POWER_STATE,i.FILTER_OPERATORS.EQUALS,i.VM_POWER_STATE.ON)),s.addFilterCondition(l,e.EB.VM.IS_CVM,s.createFilterCondition(i.ENTITY_VM,e.EB.VM.IS_CVM,i.FILTER_OPERATORS.EQUALS,0));var c=o,u=(r={},_defineProperty(r,c.DP.ENTITY_TYPE,i.ENTITY_VM),_defineProperty(r,c.DP.GROUP_MEMBER_ATTRIBUTES,[e.EB.VM.VM_NAME]),_defineProperty(r,c.DP.FILTER_EXPR,l),r);return a.getEntityManager().createGenericEntityCollection(i.ENTITY_VM,null,n.ENTITY_BROWSER_QUERY,u).fetch().done(function(e){return t(e)})},getVMNamesByIds:function(t,s){var r,l=o,c=(r={},_defineProperty(r,l.DP.ENTITY_TYPE,i.ENTITY_VM),_defineProperty(r,l.DP.ENTITY_IDS,t),_defineProperty(r,l.DP.GROUP_MEMBER_ATTRIBUTES,[e.EB.VM.VM_NAME]),r);return a.getEntityManager().createGenericEntityCollection(i.ENTITY_VM,null,n.ENTITY_BROWSER_QUERY,c).fetch().done(function(i){var n=i.toJSON();s(_.map(t,function(t){var i=_.find(n,function(i){return i[e.EB.ID]===t});return _.isUndefined(i)?t:i[e.EB.VM.VM_NAME]}))})},getLinkedVMPoweroffMsgTemplate:function(e){var t=e.count>1?"entityNamesPlural.vm":"entityNames.vm",i='\n          <a href="#" class="'+(e.linkClass||"")+'">\n            '+e.count+"\n            "+this.i18nStatic("AppUtil",t)+"\n          </a>",n=e.count>1?"vm_power_state_warning_plural":"vm_power_state_warning_singular";return'\n          <div class="confirmMsg">\n            <p>'+this.i18ns(n,i)+"</p>\n            <p>"+this.i18n("uvm_power_state_warning")+"</p>\n          </div>"}})}),define("models/vm/AcropolisVMModel",["models/AcropolisModel","models/task/AcropolisTaskModel","models/storage/AcropolisDiskModel","models/network/AcropolisNicModel","models/gpu/GpuModel","data/DataURLConstants","data/DataProperties","managers/NotificationManager","data/DataManager","utils/SubModelHelper","utils/AppConstants","utils/VMUtil","utils/AppUtil"],function(e,t,i,n,s,a,r,o,l,c,u,d,h){"use strict";var p={VM_TIMEZONE:"timezone",VM_DESCRIPTION:"description",VM_NUM_VCPUS:"num_vcpus",VM_NUM_CPU_CORES:"num_cores_per_vcpu",VM_MEMORY_MB:"memory_mb",VM_HYPERVISOR_TYPE:"hypervisor_type",VM_HYPERVISOR_IP:"hypervisorIp",VM_HYPERVISOR_MANAGER_UUID:"hypervisorManagerUuid",VM_DISK_INFO:"vm_disk_info",VM_DISKS:"vm_disks",VM_NICS:"vm_nics",VM_TRANSITION:"transition",VM_STATE:"power_state",VM_CONFIG:"config",VM_HA_PRIORITY:"ha_priority",VM_HOST_UUID:"host_uuid",SNAPSHOT_UUID:"snapshotUuid",SPEC_LIST:"spec_list",HOST_UUID:"host_id",CONTAINER_UUID:"storage_container_uuid",VG_UUID:"volumeGroupUuid",VM_USERDATA:"userdata",VM_USERDATA_PATH:"userdata_path",VM_SOURCE_PATH:"source_path",VM_DESTINATION_PATH:"destination_path",VM_CUSTOMIZATION_CONFIG:"vm_customization_config",VM_FILES_TO_INJECT_LIST:"files_to_inject_list",SOURCE_PATH:"source_path",DESTINATION_PATH:"destination_path",VM_AFFINITY:"affinity",VM_CLEAR_AFFINITY:"clear_affinity",VM_AFFINE_HOST_LIST:"host_uuids",VM_GUEST_OS:"guest_os",VM_DISK_CLONE_SPEC:"vm_disk_clone_spec",VM_DISK_CREATE:"vm_disk_create",VM_DELETE_SNAPSHOTS:"delete_snapshots",VM_FEATURES:"vm_features",VM_OVERRIDE_NETWORK_CONFIG:"override_network_config",VM_TOOLS_INSTALLER_MOUNTED:"tools_installer_mounted",VM_CLONE_AFFINITY:"clone_affinity",VM_TOOLS_RUNNING_STATUS:"tools_running_status",VM_BOOT:"boot",VM_BOOT_DEVICE_TYPE:"boot_device_type",VM_BOOT_BY_UEFI:"uefi_boot",VM_BOOT_DEVICE_ORDER:"boot_device_order",VM_BOOT_DISK_UUID:"bootDiskUuid",VM_BOOT_CONFIG:"boot_config",VM_GPUS:"vm_gpus",GUEST_DRIVER_VERSION:"guest_driver_version",VM_AGENT:"AGENT_VM",MIGRATE_HOST_UUID:"hostUuid",VM_GENERATION:"generation",VM_PATH:"vm_path",VM_DYNAMIC_MEMORY:"dynamic_memory",VM_AUTO_START_ACTION:"automatic_start_action",VM_AUTO_STOP_ACTION:"automatic_stop_action",VM_RESTORE_NETWORK_CONFIG:"restoreNetworkConfiguration",SNAPSHOT_CLONE_SPEC:"specList",SNAPSHOT_NUM_VCPUS:"numVcpus",SNAPSHOT_NUM_CPU_CORES:"numCoresPerVcpu",SNAPSHOT_MEMORY_MB:"memoryMb",SNAPSHOT_DISK_INFO:"vmDisks",SNAPSHOT_NICS:"vmNics",SNAPSHOT_BOOT_CONFIG:"bootConfig",SNAPSHOT_BOOT_BY_UEFI:"uefiBoot",INCLUDE_VM_DISK_CONFIG:"include_vm_disk_config",INCLUDE_VM_NIC_CONFIG:"include_vm_nic_config"},T={VM_HA_PRIORITY:"haPriority",VM_HOST_UUID:"hostUuid",VM_MEMORY_MB:"memoryMb",VM_NUM_VCPUS:"numVcpus",VM_NUM_CPU_CORES:"numCoresPerVcpu",VM_STATE:"state",INCLUDE_VM_DISK_SIZE:"includeVMDiskSizes",INCLUDE_ADDRESS_ASSIGNMENT:"includeAddressAssignments"},E={ON:"on",OFF:"off",SUSPEND:"suspend",PAUSE:"pause",PAUSED:"paused",RESUME:"resume",CYCLE:"powercycle",RESET:"reset",ACPI_SHUTDOWN:"acpi_shutdown",ACPI_REBOOT:"acpi_reboot",STANDBY:"standby",SAVE:"save",DISCARD:"discard"},S={centosGuest:"CentOS 4/5/6/7",centos64Guest:"CentOS 4/5/6/7 (64-bit)",debian4Guest:"Debian GNU/Linux 4",debian4_64Guest:"Debian GNU/Linux 4 (64 bit)",debian5Guest:"Debian GNU/Linux 5",debian5_64Guest:"Debian GNU/Linux 5 (64 bit)",debian6Guest:"Debian GNU/Linux 6",debian6_64Guest:"Debian GNU/Linux 6 (64 bit)",dosGuest:"MS-DOS",windows7_64Guest:"Windows 7 (64 bit)",windows7Guest:"Windows 7",windows7Server64Guest:"Windows Server 2008 R2 (64 bit)",winXPHomeGuest:"Windows XP Home Edition",winXPPro64Guest:"Windows XP Professional Edition (64 bit)",winXPProGuest:"Windows XP Professional",win2000AdvServGuest:"Windows 2000 Advanced Server",win2000ProGuest:"Windows 2000 Professional",win2000ServGuest:"Windows 2000 Server",winMeGuest:"Windows Millenium Edition",winNTGuest:"Windows NT 4",winNetEnterpriseGuest:"Windows Server 2003, Enterprise Edition",winNetEnterprise64Guest:"Windows Server 2003, Enterprise Edition (64 bit)",winNetStandardGuest:"Windows Server 2003, Standard Edition",winNetStandard64Guest:"Windows Server 2003, Standard Edition (64 bit)",winNetWebGuest:"Windows Server 2003, Web Edition",windows8Guest:"Windows 8",windows8_64Guest:"Windows 8 (64 bit)",windows8Server64Guest:"Windows Server 2012 (64 bit)",windows9Guest:"Windows 10",windows9_64Guest:"Windows 10 (64 bit)",windows9Server64Guest:"Windows Server 2016 (64 bit)",opensuseGuest:"OpenSUSE Linux (64 bit)",opensuse64Guest:"OpenSUSE Linux (64 bit)",ubuntu64Guest:"Ubuntu Linux (64 bit)",ubuntuGuest:"Ubuntu Linux",redhatGuest:"Red Hat Linux 2.1",rhel2Guest:"Red Hat Enterprise Linux 2",rhel3_64Guest:"Red Hat Enterprise Linux 3 (64 bit)",rhel3Guest:"Red Hat Enterprise Linux 3",rhel4_64Guest:"Red Hat Enterprise Linux 4 (64 bit)",rhel4Guest:"Red Hat Enterprise Linux 4",rhel5Guest:"Red Hat Enterprise Linux 5",rhel5_64Guest:"Red Hat Enterprise Linux 5 (64 bit) (experimental)",rhel6Guest:"Red Hat Enterprise Linux 6",rhel6_64Guest:"Red Hat Enterprise Linux 6 (64 bit)",rhel7Guest:"Red Hat Enterprise Linux 7",rhel7_64Guest:"Red Hat Enterprise Linux 7 (64 bit)",solaris6Guest:"Solaris 6",solaris7Guest:"Solaris 7",solaris8Guest:"Solaris 8",solaris9Guest:"Solaris 9"},g={},A={ONE:"GENERATION_1",TWO:"GENERATION_2"},m={NOTHING:"NOTHING",START_IF_RUNNING:"START_IF_RUNNING",START:"START"},f={TURN_OFF:"TURNOFF",SAVE:"SAVE",SHUTDOWN:"SHUTDOWN"},I=[p.VM_GENERATION,p.VM_HOST_UUID,p.VM_PATH,p.VM_AUTO_START_ACTION,p.VM_AUTO_STOP_ACTION];return g[u.HYPERVISOR_TYPE.KVM]="ACROPOLIS",g[u.HYPERVISOR_TYPE.ESXI]="VMWARE",g[u.HYPERVISOR_TYPE.HYPERV]="HYPERV",g[u.HYPERVISOR_TYPE.XEN]="XEN",g[u.HYPERVISOR_TYPE.NULL]="NULL",e.extend({DP:p,VM_POWER_STATE:E,NIC_SUB_MODEL:"NIC_SUB_MODEL",DISK_SUB_MODEL:"DISK_SUB_MODEL",idAttribute:r.UUID,nameAttribute:r.NAME,urlRoot:a.MGMT_VM.substring(1),entityType:u.ENTITY_VM,name:"AcropolisVMModel",includeVMDiskSizes:!1,includeAddressAssignments:!1,subModelHelper:null,vmName:null,useV2DataSource:!0,initialize:function(){e.prototype.initialize.apply(this,arguments),this.subModelHelper=new c},destroy:function(){this.subModelHelper.destroy(),this.subModelHelper=null,e.prototype.destroy.apply(this,arguments)},getDataSourceURL:function(){if(!this.useV2DataSource)return e.prototype.getDataSourceURL.apply(this,arguments)+"/";switch(this.actionMode){case u.ACTION_MIGRATE:case u.ACTION_RESTORE:return e.prototype.getDataSourceURL.apply(this,arguments);default:return l.getV2DataSourceURL()}},parse:function(t,s){if(!this.useV2DataSource){var a=t[p.VM_CONFIG],o={};o[r.NAME]=a[r.NAME],o[r.UUID]=t[r.UUID],o[p.VM_DESCRIPTION]=a[p.VM_DESCRIPTION],o[p.VM_HA_PRIORITY]=a[T.VM_HA_PRIORITY],o[p.VM_MEMORY_MB]=a[T.VM_MEMORY_MB],o[p.VM_NUM_VCPUS]=a[T.VM_NUM_VCPUS],o[p.VM_NUM_CPU_CORES]=a[T.VM_NUM_CPU_CORES],o[p.VM_STATE]=t[T.VM_STATE],o[p.VM_HOST_UUID]=t[T.VM_HOST_UUID];var l=[];_.each(a.vmDisks,function(e){var t={},n={};n[i.V2_DP.BUS_TYPE]=e[i.DP.DISK_ADDR][i.DP.BUS_TYPE],n[i.V2_DP.DEVICE_INDEX]=e[i.DP.DISK_ADDR][i.DP.DEVICE_INDEX],n[i.V2_DP.VMDISK_UUID]=e[i.DP.DISK_UUID],n[i.V2_DP.VOLUME_GROUP_UUID]=e[i.DP.VG_UUID],t[i.V2_DP.DISK_ADDRESS]=n,t[i.V2_DP.IS_CDROM]=e[i.DP.IS_CDROM],t[i.V2_DP.IS_EMPTY]=e[i.DP.IS_EMPTY],t[i.V2_DP.STORAGE_CONTAINER_UUID]=e[i.DP.CONTAINER_ID],l.push(t)}),o[p.VM_DISK_INFO]=l;var c=[];return _.each(a.vmNics,function(e){var t={};t[n.V2_DP.ADAPTER_TYPE]=e[n.DP.ADAPTER_TYPE],t[n.V2_DP.MAC_ADDRESS]=e[n.DP.MAC_ADDRESS],t[n.V2_DP.MODEL]=e[n.DP.MODEL],t[n.V2_DP.REQ_IP_ADDRESS]=e[n.DP.REQ_IP_ADDRESS],t[n.V2_DP.NETWORK_UUID]=e[n.DP.NETWORK_UUID],c.push(t)}),o[p.VM_NICS]=c,o}return e.prototype.parse.apply(this,arguments)},parseOptions:function(t,i,n){switch(this.actionMode){case u.ACTION_CREATE:case u.ACTION_CLONE:n.noPoll=!0}return e.prototype.parseOptions.apply(this,arguments)},setMessage:function(e){switch(e=e||this.actionMode,this.msg.action=(u.ACTION_NAMES[e]||e).toLowerCase(),this.msg.entityMsg=this.entityMsg,this.msg.entityType=u.ENTITY_NAMES[this.entityType],this.msg.entityName=this.getName(),e){case u.ACTION_CREATE:case u.ACTION_CLONE:this.msg.suppressLink=!0}},getName:function(){return _.escape(this.get(r.NAME)||this.get(this.nameAttribute)||this.vmName)},setDisks:function(e){this.subModelHelper.register(this.DISK_SUB_MODEL,e)},setNics:function(e){return this.subModelHelper.register(this.NIC_SUB_MODEL,e)},getDisks:function(){return this.subModelHelper.get(this.DISK_SUB_MODEL)},getNics:function(){return this.subModelHelper.get(this.NIC_SUB_MODEL)},getHAPriority:function(){return this.get(p.VM_HA_PRIORITY)},getAffineHostList:function(){var e=this.get(p.VM_AFFINITY);return e?e[p.VM_AFFINE_HOST_LIST]:null},getAssignedGpus:function(){return this.get(p.VM_GPUS)},getGpuMode:function(){var e=this.getAssignedGpus()||[];return 1===e.length&&e[0][s.DP.GPU_TYPE]===s.GPU_TYPE.VIRTUAL?s.GPU_MODE.VIRTUAL:s.GPU_MODE.PASSTHROUGH},isPoweredOn:function(){return this.get(p.VM_STATE)===E.ON},getHostUuid:function(){return this.get(p.VM_HOST_UUID)},getPoweredOnHostUuid:function(){return this.isPoweredOn()||this.get(p.VM_STATE)===E.PAUSED?this.getHostUuid():null},isFlashModeEnabled:function(){return(this.get(p.VM_FEATURES)||{})[r.VM_FLASH_MODE]||!1},isAgentVm:function(){return(this.get(p.VM_FEATURES)||{})[p.VM_AGENT]||!1},isToolsInstallerMounted:function(){return this.get(p.VM_TOOLS_INSTALLER_MOUNTED)},isToolsRunning:function(){return this.get(p.VM_TOOLS_RUNNING_STATUS)===u.VM_TOOLS_STATUS.GUEST_TOOLS_RUNNING},getGuestDriverVersion:function(){return this.get(p.GUEST_DRIVER_VERSION)},getToolsInstallerRunningStatus:function(){return this.get(p.VM_TOOLS_RUNNING_STATUS)},isSecondGeneration:function(){return this.get(p.VM_GENERATION)===A.TWO},getURL:function(){var e=this.url();switch(this.actionMode){case u.ACTION_POWER_OFF:case u.ACTION_POWER_ON:case u.ACTION_POWER_CYCLE:case u.ACTION_POWER_RESET:case u.ACTION_ACPI_REBOOT:case u.ACTION_ACPI_SHUTDOWN:case u.ACTION_SAVE:case u.ACTION_DISCARD:case u.ACTION_RESUME:case u.ACTION_PAUSE:case u.ACTION_SUSPEND:case u.ACTION_STANDBY:e=_.template(a.MGMT_VM_POWER_STATE.substring(1),{id:this.vmId});break;case u.ACTION_MIGRATE:e=_.template(a.MGMT_VM_MIGRATE,{id:this.vmId});break;case u.ACTION_CLONE:e=_.template(a.MGMT_VM_CLONE.substring(1),{id:this.vmId});break;case u.ACTION_RESTORE:e=_.template(a.MGMT_VM_RESTORE,{id:this.vmId});break;case u.ACTION_DELETE:e+=h.getQueryStringParamDelimiter(e)+p.VM_DELETE_SNAPSHOTS+"="+this.get(p.VM_DELETE_SNAPSHOTS);break;default:e+=h.getQueryStringParamDelimiter(e)+p.INCLUDE_VM_DISK_CONFIG+"=true",e+=h.getQueryStringParamDelimiter(e)+p.INCLUDE_VM_NIC_CONFIG+"=true",this.includeVMDiskSizes&&(e+=h.getQueryStringParamDelimiter(e)+T.INCLUDE_VM_DISK_SIZE+"=true"),this.includeAddressAssignments&&(e+=h.getQueryStringParamDelimiter(e)+T.INCLUDE_ADDRESS_ASSIGNMENT+"=true")}return e},toJSON:function(e){var t=this,i={};switch(this.actionMode){case u.ACTION_POWER_OFF:case u.ACTION_POWER_ON:case u.ACTION_POWER_CYCLE:case u.ACTION_POWER_RESET:case u.ACTION_ACPI_REBOOT:case u.ACTION_ACPI_SHUTDOWN:case u.ACTION_PAUSE:case u.ACTION_SUSPEND:case u.ACTION_RESUME:case u.ACTION_STANDBY:case u.ACTION_SAVE:case u.ACTION_DISCARD:i[p.VM_TRANSITION]=this.get(p.VM_TRANSITION);break;case u.ACTION_ENABLE_NGT:case u.ACTION_DISABLE_NGT:i[p.VM_MOUNT]=this.get(p.VM_MOUNT);break;case u.ACTION_MIGRATE:this.get(p.HOST_UUID)&&(i[p.MIGRATE_HOST_UUID]=this.get(p.HOST_UUID));break;case u.ACTION_RESTORE:i[p.SNAPSHOT_UUID]=this.get(p.SNAPSHOT_UUID);var n=this.get(p.VM_RESTORE_NETWORK_CONFIG);_.isNull(n)||_.isUndefined(n)||(i[p.VM_RESTORE_NETWORK_CONFIG]=n);break;case u.ACTION_DELETE:break;default:i[this.nameAttribute]=this.get(this.nameAttribute),i[p.VM_MEMORY_MB]=this.get(p.VM_MEMORY_MB),i[p.VM_NUM_VCPUS]=this.get(p.VM_NUM_VCPUS),i[p.VM_DESCRIPTION]=this.get(p.VM_DESCRIPTION),i[p.VM_NUM_CPU_CORES]=this.get(p.VM_NUM_CPU_CORES),i[p.VM_TIMEZONE]=this.get(p.VM_TIMEZONE),i[p.VM_BOOT]=this.get(p.VM_BOOT);var a=this.getDisks(),o=this.getNics(),l=[],c=[];this.actionMode===u.ACTION_CREATE&&(i[p.VM_GUEST_OS]=this.get(p.VM_GUEST_OS)),this.actionMode!==u.ACTION_CLONE&&a&&a.length&&a.each(function(e){e.actionMode=this.actionMode,l.push(e.toUhuraDiskConfigJson())},this),l.length&&(i[p.VM_DISKS]=l);var d=this.actionMode===u.ACTION_CLONE;if((!_.isEmpty(o)&&d||!_.isEmpty(o))&&o.each(function(e){e.actionMode=t.actionMode,e.useUhura=!0,c.push(e.toJSON({ignoreMac:!0}))}),c.length&&(i[p.VM_NICS]=c),this.actionMode===u.ACTION_CLONE&&(i[p.VM_OVERRIDE_NETWORK_CONFIG]=this.get(p.VM_OVERRIDE_NETWORK_CONFIG),i[p.VM_CLONE_AFFINITY]=this.get(p.VM_CLONE_AFFINITY),i[p.VM_BOOT_CONFIG]=this.get(p.VM_BOOT_CONFIG)),this.actionMode===u.ACTION_CLONE){var h=[i];_.isArray(i.name)&&(h=[],_.each(i.name,function(e){var t=_.clone(i);t.name=e,h.push(t)})),i={},i[p.SPEC_LIST]=h}var T=this.get(p.VM_HYPERVISOR_TYPE);if(_.isEmpty(T)||(i[p.VM_HYPERVISOR_TYPE]=g[T]),this.actionMode!==u.ACTION_CLONE){var E=this.get(p.VM_AFFINE_HOST_LIST);E&&E.length?(i[p.VM_AFFINITY]={},i[p.VM_AFFINITY][p.VM_AFFINE_HOST_LIST]=E,i[p.VM_AFFINITY][r.POLICY]=u.AFFINITY_POLICY.AFFINITY):(i[p.VM_AFFINITY]=null,i[p.VM_CLEAR_AFFINITY]=!0)}_.isEmpty(this.get(p.VM_CUSTOMIZATION_CONFIG))&&_.isEmpty(this.get(p.VM_FILES_TO_INJECT_LIST))||(i[p.VM_CUSTOMIZATION_CONFIG]={},i[p.VM_CUSTOMIZATION_CONFIG]=this.get(p.VM_CUSTOMIZATION_CONFIG),i[p.VM_CUSTOMIZATION_CONFIG][p.VM_FILES_TO_INJECT_LIST]=this.get(p.VM_FILES_TO_INJECT_LIST));var S=this.get(p.VM_FEATURES);_.isEmpty(S)||(i[p.VM_FEATURES]=S);var A=this.get(p.VM_GPUS);if(A){var m=[];_.each(A,function(e){var t={};t[s.DP.DEVICE_ID]=e[s.DP.DEVICE_ID],t[s.DP.GPU_TYPE]=e[s.DP.GPU_TYPE],t[s.DP.GPU_VENDOR]=e[s.DP.GPU_VENDOR],m.push(t)},this),i[p.VM_GPUS]=m}_.each(I,function(e){var n=t.get(e);_.isEmpty(n)||(i[e]=n)});var f=this.get(p.VM_DYNAMIC_MEMORY);_.isUndefined(f)||(i[p.VM_DYNAMIC_MEMORY]=f)}return i},getTaskUuid:function(){return this.attributes[0][t.DP.VM_TASK_UUID]},savePowerState:function(e,t,i,n){this.setPowerState(e),this.vmName=i,this.vmId=t,this.save(null,n)},setPowerState:function(e){var t=this.VM_POWER_STATE.ON;switch(e){case u.ACTION_POWER_OFF:t=this.VM_POWER_STATE.OFF;break;case u.ACTION_PAUSE:t=this.VM_POWER_STATE.PAUSE;break;case u.ACTION_SUSPEND:t=this.VM_POWER_STATE.SUSPEND;break;case u.ACTION_RESUME:t=this.VM_POWER_STATE.RESUME;break;case u.ACTION_POWER_CYCLE:t=this.VM_POWER_STATE.CYCLE;break;case u.ACTION_POWER_RESET:t=this.VM_POWER_STATE.RESET;break;case u.ACTION_ACPI_SHUTDOWN:t=this.VM_POWER_STATE.ACPI_SHUTDOWN;break;case u.ACTION_ACPI_REBOOT:t=this.VM_POWER_STATE.ACPI_REBOOT;break;case u.ACTION_STANDBY:t=this.VM_POWER_STATE.STANDBY;break;case u.ACTION_SAVE:t=this.VM_POWER_STATE.SAVE;break;case u.ACTION_DISCARD:t=this.VM_POWER_STATE.DISCARD}this.actionMode=e,this.set(p.VM_TRANSITION,t)},migrate:function(e,t){this.vmName=t,this.vmId=e,this.actionMode=u.ACTION_MIGRATE,this.save()},takeSnapshot:function(e,t){this.vmName=t,this.vmId=e,this.actionMode=u.ACTION_SNAPSHOT,this.save()},showSuccessNotification:function(t,i,n){var s=[u.ACTION_POWER_OFF,u.ACTION_POWER_ON,u.ACTION_PAUSE,u.ACTION_RESUME,u.ACTION_POWER_CYCLE,u.ACTION_POWER_RESET,u.ACTION_ACPI_SHUTDOWN,u.ACTION_ACPI_REBOOT,u.ACTION_STANDBY,u.ACTION_MIGRATE];_.contains(s,this.actionMode)?o.showNotification(u.NOTIFY_SUCCESS,t,i,n):e.prototype.showSuccessNotification.apply(this,arguments)},validate:function(e){if(this.actionMode&&this.actionMode!==u.ACTION_DELETE&&this.actionMode!==u.ACTION_POWER_ON&&this.actionMode!==u.ACTION_POWER_OFF&&this.actionMode!==u.ACTION_POWER_CYCLE&&this.actionMode!==u.ACTION_POWER_RESET&&this.actionMode!==u.ACTION_ACPI_SHUTDOWN&&this.actionMode!==u.ACTION_ACPI_REBOOT&&this.actionMode!==u.ACTION_SAVE&&this.actionMode!==u.ACTION_DISCARD&&this.actionMode!==u.ACTION_STANDBY&&this.actionMode!==u.ACTION_MIGRATE&&this.actionMode!==u.ACTION_PAUSE&&this.actionMode!==u.ACTION_SUSPEND&&this.actionMode!==u.ACTION_RESUME&&this.actionMode!==u.ACTION_RESTORE){var t=$.trim(e[r.NAME]),i=e[p.VM_HYPERVISOR_TYPE];if(0===t.length||!d.isValidVmName(t,i))return this.i18n("invalidVmName");if(!h.isDisplayableNumber(e[p.VM_NUM_VCPUS])||!h.isPositiveInt(e[p.VM_NUM_VCPUS]))return this.i18n("invalidCpuNumber");if(!h.isDisplayableNumber(e[p.VM_NUM_CPU_CORES])||!h.isPositiveInt(e[p.VM_NUM_CPU_CORES]))return this.i18n("invalidCpuCoreNumber");if(!h.isDisplayableNumber(e[p.VM_MEMORY_MB])||!h.isPositive(e[p.VM_MEMORY_MB]))return"Please provide a positive number for memory.";if(i===u.HYPERVISOR_TYPE.ESXI&&!e[p.VM_GUEST_OS])return this.i18n("noGuestOs");if(i===u.HYPERVISOR_TYPE.HYPERV&&e[p.VM_GENERATION]===A.ONE&&e[p.VM_NUM_VCPUS]>64)return this.i18ns("invalidVcpu","1","64");if(i===u.HYPERVISOR_TYPE.HYPERV&&e[p.VM_GENERATION]===A.TWO&&e[p.VM_NUM_VCPUS]>240)return this.i18ns("invalidVcpu","2","240")}return""}},{DP:p,VM_POWER_STATE:E,VM_HYPERVISOR_TYPE:g,GUEST_OS_LIST:S,VM_GENERATION:A,VM_AUTO_START_ACTION:m,VM_AUTO_STOP_ACTION:f})}),define("models/vm/VMModel",["models/PollingModel","models/vm/AcropolisVMModel","models/task/AcropolisTaskModel","data/DataURLConstants","data/DataProperties","utils/AppConstants","utils/StatsUtil","utils/AppUtil","utils/HypervisorUtil"],function(e,t,i,n,s,a,r,o,l){"use strict";var c={POWER_ACTION_STARTED:"powerActionStarted",POWER_ACTION_COMPLETED:"powerActionCompleted",POWER_ACTION_ERROR:"powerActionError",TASK_STARTED:"taskStarted"};return e.extend({idAttribute:s.VM_ID,nameAttribute:s.VM_NAME,urlRoot:n.VM,entityType:a.ENTITY_VM,powerStateChangeInProgress:!1,name:"VMModel",EVENT:c,defaults:{vmId:null,vmName:"",ipAddresses:null,hostName:"",hostId:0,memoryCapacityInBytes:0,numVCpus:1,vdiskNames:null,diskCapacityInBytes:0,timeStampInUsec:0,powerState:""},initialize:function(t){this.powerStateChangeInProgress=!1,null===this.get(s.VM_IP_ADDRESSES)&&this.set(s.VM_IP_ADDRESSES,[],{silent:!0}),null===this.get(s.VM_VDISK_NAMES)&&this.set(s.VM_VDISK_NAMES,[],{silent:!0}),e.prototype.initialize.apply(this,arguments)},getMemoryCapacity:function(){return this.get(s.VM_MEM_CAPACITY)?this.get(s.VM_MEM_CAPACITY):0},getNumVCpus:function(){return this.get(s.VM_NUM_VCPUS)?this.get(s.VM_NUM_VCPUS):0},getReservedCPU:function(){if(null!==this.get(s.VM_CPU_RESERVED))return r.prefixFormat(this.get(s.VM_CPU_RESERVED),r.SYMBOL_HERTZ)},getReservedMemory:function(){if(null!==this.get(s.VM_MEM_RESERVED))return r.storageFormat(this.get(s.VM_MEM_RESERVED))},getAssignedMemory:function(){var e=this.get(s.STATS);if(e&&null!==e.hypervisor_memory_assigned_bytes)return r.storageFormat(e.hypervisor_memory_assigned_bytes)},isKVM:function(){return this.get(s.VM_ACROPOLIS_VM)},isESX:function(){return l.isESX(this)},isHyperV:function(){return l.isHyperv(this)},isCVM:function(){return this.get(s.VM_CONTROLLER_VM)},isPCVM:function(){return this.get(s.VM_TYPE)===a.VM_TYPES.PCVM||this.get(s.VM_DESCRIPTION)===a.NUTANIX_PRISM_CENTRAL},getHypervisorType:function(){return this.isKVM()?a.HYPERVISOR_TYPE.KVM:this.isESX()?a.HYPERVISOR_TYPE.ESXI:this.get(s.HYPERVISOR_TYPE)},savePowerState:function(e){if(!this.isKVM())throw new Error("Currently only KVM support VM action");var i=new t;this.clusterManager.isMulticlusterNavMode()&&i.setProxyClusterUuid(this.get([s.CLUSTER_UUID]));i.on("sync",this.onPowerSave,this),i.savePowerState(e,this.getId(),this.get(this.nameAttribute)),this.powerStateChangeInProgress=!0,this.trigger(this.EVENT.POWER_ACTION_STARTED,this)},onPowerSave:function(e){e.off("sync",this.onPowerSave,this),this.trigger(this.EVENT.TASK_STARTED,this);var t=e.getTaskUuid(),n=new i;this.clusterManager.isMulticlusterNavMode()&&n.setProxyClusterUuid(this.getClusterUuid()),n.actionMode=a.ACTION_POLL,n.set(s.UUID,t);var r=this,l=setInterval(function(){n.fetch({success:function(){var e=n.get(i.DP.TASK_INFO),t=!1;switch(e[i.DP.PROGRESS_STATUS]){case i.TASK_STATUS.FAILED:t=!0,r.trigger(r.EVENT.POWER_ACTION_ERROR,n);break;case i.TASK_STATUS.SUCCEEDED:t=!0}if(t){clearInterval(l);var s=0;r.clusterManager.isMulticlusterNavMode()&&(s=1e4),setTimeout(function(){r.powerStateChangeInProgress=!1,r.trigger(r.EVENT.POWER_ACTION_COMPLETED,r)
},s)}},error:function(){o.log("VMModel.onPowerSave : Error polling task"),r.trigger(r.EVENT.POWER_ACTION_ERROR)}})},3e3)},isPowerOn:function(){return this.get(s.VM_POWER_STATE)===a.VM_POWER_STATE.ON},isPowerOff:function(){return this.get(s.VM_POWER_STATE)===a.VM_POWER_STATE.OFF},isPowerSuspended:function(){return this.get(s.VM_POWER_STATE)===a.VM_POWER_STATE.SUSPENDED},getPowerStateChangeInProgress:function(){return this.powerStateChangeInProgress},isFanoutSupported:function(){return!!this.getClusterUuid()&&(this.clusterManager.getClusterModelByClusterUuid(this.getClusterUuid()).isEntityActionSupportFanout(null,a.ENTITY_VM)&&this.clusterManager.isMulticlusterNavMode())},isHostAffinitySupported:function(){if(!this.getClusterUuid())return!1;var e=this.clusterManager.getClusterModelByClusterUuid(this.getClusterUuid());return e&&e.isFFEnabled(a.FFLAGS.VM_HOST_AFFINITY)&&!this.isESX()},hasAmfOverEsxBasicSupport:function(){return!!this.getClusterUuid()&&this.clusterManager.getClusterModelByClusterUuid(this.getClusterUuid()).isAmfOverEsxBasicSupported()}},{EVENT:c})}),define("models/vm/VMCollection",["models/PollingCollection","models/vm/VMModel","data/DataURLConstants","data/DataProperties","utils/HypervisorUtil"],function(e,t,i,n,s){"use strict";return e.extend({model:t,url:i.VM,name:"VMCollection",hasHyperV:function(){return _.some(this.models,function(e){return s.hasHyperV(e.get(n.CLUSTER_UUID))})},getVMListRunningGPU:function(){var e=[];return _.each(this.models,function(t){var i=t.get(n.VM_GPUS)||[];_.find(i,function(e){return e[n.GPU_IN_USE]})&&e.push(t)}),e},getVMNameListRunningGPU:function(){var e=this.getVMListRunningGPU();return _.map(e,function(e){return e.get(n.VM_NAME)})}})}),define("models/hardware/BreakFixModel",["models/BaseModel","data/DataURLConstants","utils/AppConstants","utils/AppUtil","managers/NotificationManager"],function(e,t,i,n,s){"use strict";return e.extend({urlRoot:null,entityType:null,actionMode:null,name:"BreakFixModel",showError:!0,getURL:function(){return this.actionMode===i.ACTION_TURN_ON_LED?t.HADES_LIGHT_LED_ON:this.actionMode===i.ACTION_TURN_OFF_LED?t.HADES_LIGHT_LED_OFF:this.actionMode===i.ACTION_PREPARE_ADD?t.HADES_PREPARE_DISK:this.actionMode===i.ACTION_ADD_BACK?t.HADES_ADD_BACK_DISK:void 0},getUpdatedMethod:function(){return"create"},showSuccessNotification:function(e,t,n){s.hideLatencyAction(e,t);var a,r=i.ENTITY_NAMES[this.entityType],o=i.NOTIFY_SUCCESS;this.actionMode===i.ACTION_TURN_ON_LED?a="The LED of the "+r+" has been turned on.":this.actionMode===i.ACTION_TURN_OFF_LED?a="The LED of the "+r+" has been turned off.":this.actionMode===i.ACTION_PREPARE_ADD?n&&!1===n.value?(a=this.i18nfStatic("BreakFixModel","repartitioning_failed",r),o=i.NOTIFY_ERROR):a=this.i18nfStatic("BreakFixModel","repartitioning_initiated",r):a=this.actionMode===i.ACTION_ADD_BACK?"The "+r+" has been added to the cluster.":"Operation was successful.",s.showClientNotification(o,a)},flipLED:function(e,t,n){this.actionMode=e?i.ACTION_TURN_ON_LED:i.ACTION_TURN_OFF_LED,this.save({entityType:this.entityType.toUpperCase(),serialNumber:t,turnOnLED:e},n)},prepareAndAdd:function(e,t){this.actionMode=i.ACTION_PREPARE_ADD,this.save(n.convertPrimitiveToJSON(e),t)},addBack:function(e,t){this.actionMode=i.ACTION_ADD_BACK,this.save(n.convertPrimitiveToJSON(e),t)}})}),define("models/hardware/HostBreakFixModel",["models/hardware/BreakFixModel","data/DataURLConstants","utils/AppConstants"],function(e,t,i){"use strict";return e.extend({urlRoot:t.HOST,entityType:i.ENTITY_HOST,name:"HostBreakFixModel"})}),define("models/hardware/HostModel",["models/BaseModel","models/PollingModel","models/hardware/HostBreakFixModel","data/DataURLConstants","data/DataProperties","utils/AppConstants","utils/StatsUtil","utils/HypervisorUtil"],function(e,t,i,n,s,a,r,o){"use strict";var l=_defineProperty({},a.HOST_TYPES.COMPUTE_ONLY,[s.SERVICE_VM_IP,s.NEW_TOT_USED_PHY,s.TOT_CAPACITY,s.STATS_NUM_IOPS,s.STATS_BANDWIDTH,s.STATS_AVG_IO_LATENCY]);return t.extend({idAttribute:s.SERVICE_VM_ID,urlRoot:n.HOST,entityType:a.ENTITY_HOST,name:"HostModel",hasArithmosStats:!0,initialize:function(e,i){t.prototype.initialize.apply(this,arguments),this.hasArithmosStats=this.clusterManager.isClusterFFEnabled(a.FFLAGS.ARITHMOS_USAGE_STATS)},getMemoryCapacity:function(){return this.get(s.MEM_CAPACITY)||0},getStorageCapacity:function(){return this.get(s.USAGE_STATS)?this.hasArithmosStats?this.get(s.USAGE_STATS)[s.NEW_TOT_CAPACITY]:this.get(s.USAGE_STATS)[s.TOT_CAPACITY]:0},getUsedPhysical:function(){return this.get(s.USAGE_STATS)?this.hasArithmosStats?this.get(s.USAGE_STATS)[s.NEW_TOT_USED_PHY]:this.get(s.USAGE_STATS)[s.TOT_USED_PHY]:0},getName:function(){return this.get(s.NAME)},getSimpleName:function(){var e=this.getName()||"";if(this.hasDomainName()){var t=e.indexOf(".");e=e.substring(0,t)}return e},getNotApplicableProps:function(){return l[this.get(s.NODE_TYPE)]||[]},hasDomainName:function(){return-1!==(this.getName()||"").indexOf(".")},getCPUCapacity:function(){return this.get(s.CPU_CAPACITY)*this.get(s.CPU_CORES)},getCPUCapacityInGz:function(){return Math.round(this.getCPUCapacity()/1e9*100)/100},getTotalDiskUsedPercentage:function(){var e=this.getStorageCapacity(),t=this.getUsedPhysical();return e>0?r.roundPercent(t/e):"0%"},getUsageStats:function(e){return this.get(s.USAGE_STATS)&&e?this.get(s.USAGE_STATS)[e]:0},getHostType:function(){return this.get(s.NODE_TYPE)||a.HOST_TYPES.DEFAULT},getDisplayableHostType:function(){return this.i18n("type_names."+this.getHostType().toLowerCase())},getOplogPercent:function(){return r.isValidStats(this.get(s.OPLOG_PERCENT))?this.get(s.OPLOG_PERCENT)+"%":a.STATS_NOT_AVAILABLE},getBlockModelName:function(){var e=this.get(s.BLOCK_MODEL);return e===a.USE_LAYOUT?this.get(s.BLOCK_MODEL_NAME):e},getModelName:function(){return this.get(s.BLOCK_MODEL_NAME)||""},getValue:function(t){var i;switch(t){case s.CPU_CAPACITY:i=this.getCPUCapacity();break;case s.CPU_CAPACITY_GZ:i=this.getCPUCapacityInGz();break;case s.MEM_CAPACITY:i=this.getMemoryCapacity();break;case s.TOT_CAPACITY:i=this.getStorageCapacity();break;case s.TOT_USED_PCT:i=this.getTotalDiskUsedPercentage();break;case s.OPLOG_PERCENT:i=this.getOplogPercent();break;case s.BLOCK_MODEL:i=this.getBlockModelName();break;case s.NAME:i=this.getName();break;case s.SIMPLE_NAME:i=this.getSimpleName();break;default:i=e.prototype.getValue.apply(this,arguments)}return i},getURL:function(){if(this.actionMode===a.ACTION_REMOVE)return _.template(n.REMOVE_HOST,{id:this.get(this.idAttribute)})},toJSON:function(t){var i=e.prototype.toJSON.apply(this,arguments);return t&&t.includeCustomAttributes&&(i[s.TOT_USED_PCT]=this.getTotalDiskUsedPercentage(),i[s.TOT_CAPACITY]=this.getStorageCapacity(),i[s.TOT_USED_PHY]=this.getUsedPhysical(),i[s.NA_DATA_PROPS]=this.getNotApplicableProps()),i},isESX:function(){return o.isESX(this)},isHyperv:function(){return o.isHyperv(this)},isKVM:function(){return o.isKVM(this)},isComputeOnly:function(){return this.getHostType()===a.HOST_TYPES.COMPUTE_ONLY},hasIpmi:function(){return!(this.get(s.IPMI_IP)||"").match(/0.0.0.0/g)},isDisplayableMetric:function(e){return!_.contains(this.getNotApplicableProps(),e)},startRemove:function(e){this.actionMode=a.ACTION_REMOVE,this.destroy(e)},isBeingRemoved:function(){return-1===_.indexOf(this.get(s.REMOVAL_STATUS),a.HOST_REMOVAL_STATUS.NA)},isDetachable:function(){return this.get(s.STATE)===a.HOST_STATUS.DETACHABLE},flipLED:function(e,t){(new i).flipLED(e,this.getId(),t)},getPerTierStats:function(){return this.hasArithmosStats?r.formulatePerTierStats(this.get(s.USAGE_STATS)):r.formulatePerTierStatsOld(this.get(s.USAGE_STATS))},getHypervisorLabel:function(){var e=this.get(s.HYPERVISOR_TYPE);return a.HYPERVISOR_LABEL[e]},isHAReserved:function(){return this.get(s.HYPERVISOR_STATE)===a.HOST_HYPERVISOR_STATE.RESERVED_FOR_HA_FAILOVER}})}),define("models/hardware/HostCollection",["models/PollingCollection","models/hardware/HostModel","data/DataURLConstants","data/DataProperties","utils/AppConstants","utils/HypervisorUtil"],function(e,t,i,n,s,a){"use strict";return e.extend({model:t,url:i.HOST,name:"HostCollection",comparator:function(e){return(e.get(n.NAME)||"").toLowerCase()},getHypervisorNames:function(){var e=[];return _.each(this.models,function(t){var i=t.get(n.HYPERVISOR_TYPE);i&&e.push(s.HYPERVISOR_LABEL[i])}),_.uniq(e)},getHypervisorVersions:function(e){var t,i=this.getHypervisorNames(),r={},o=[];return i.length>1?_.each(this.models,function(t){var i=t.get(n.HYPERVISOR_TYPE),o=t.get(n.HYPERVISOR_NAME)||s.HYPERVISOR_UNKNOWN;if(e){var l=a.getHypervisorVersionDisplay(i,o,!0);r[l]=(r[l]||0)+1}else r[s.HYPERVISOR_LABEL[i]]=(r[s.HYPERVISOR_LABEL[i]]||0)+1}):_.each(this.models,function(e){var t=e.get(n.HYPERVISOR_TYPE),i=e.get(n.HYPERVISOR_NAME)||s.HYPERVISOR_UNKNOWN,o=a.getHypervisorVersionDisplay(t,i);r[o]=(r[o]||0)+1}),_.each(_.keys(r),function(e){t=[],t[0]=e,t[1]=r[e],o.push(t)}),o},getDatastoreMountableHosts:function(){var e=[];return _.each(this.models,function(t){var i=t.get(n.HYPERVISOR_TYPE);_.indexOf(s.HYPERVISOR_WITH_DATASTORE,i)>-1&&e.push(t)}),e},getHostsWithHypervisor:function(e){return _.filter(this.models,function(t){return e===t.get(n.HYPERVISOR_TYPE)})},getHypervisorsWithNoDatastore:function(){var e=[];return _.each(this.models,function(t){var i=t.get(n.HYPERVISOR_TYPE);-1===_.indexOf(s.HYPERVISOR_WITH_DATASTORE,i)&&e.push(s.HYPERVISOR_LABEL[i])}),_.uniq(e)},getHostsWithDefaultShare:function(e){if(!e)return[];var t=_.filter(this.models,function(t){return t.get(n.DEFAULT_SMB_SHARE)==e});return _.pluck(_.map(t,function(e){return e.toJSON()}),n.SERVICE_VM_ID)},getHostsWithOutstandingTasks:function(){var e=[];return _.each(this.models,function(t){t.get(n.HOST_STATUS)!==n.ONLINE&&e.push(t.toJSON())}),e},groupByModelNumber:function(){return this.groupBy(function(e){return e.getModelName()})},getMaxHostMemory:function(){return this.chain().map(function(e){return e.get(n.MEM_CAPACITY)}).max().value()},getNodeCountByType:function(e){return this.filter(function(t){return t.getHostType()===e}).length},getNodeCount:function(){return this.length}})}),define("models/hardware/DiskBreakFixModel",["models/hardware/BreakFixModel","data/DataURLConstants","utils/AppConstants"],function(e,t,i){"use strict";return e.extend({urlRoot:t.DISK,entityType:i.ENTITY_DISK,name:"DiskBreakFixModel"})}),define("models/hardware/DiskModel",["models/BaseModel","models/PollingModel","models/hardware/DiskBreakFixModel","data/DataURLConstants","data/DataProperties","utils/StatsUtil","utils/AppUtil","utils/AppConstants"],function(e,t,i,n,s,a,r,o){"use strict";return t.extend({urlRoot:n.DISK,entityType:o.ENTITY_DISK,nameAttribute:s.MOUNT_PATH,name:"DiskModel",_diskConfig:null,hasArithmosStats:!0,initialize:function(e,i){t.prototype.initialize.apply(this,arguments),this.hasArithmosStats=this.clusterManager.isClusterFFEnabled(o.FFLAGS.ARITHMOS_USAGE_STATS)},nameParserFunc:function(){if(this.get(this.nameAttribute)){var e=this.get(this.nameAttribute).split("/");return e&&e.length?e[e.length-1]:this.get(this.nameAttribute)}return""},getDiskSerialNumber:function(){var e=this.getHardwareConfig();return this.isUnmounted()&&e?e[s.DISK_HW_CONFIGS_DISK_SERIAL]:this.nameParserFunc()},getUsedPhysical:function(){return this.hasArithmosStats?a.getUsageStats(this,s.NEW_TOT_USED_PHY):a.getUsageStats(this,s.TOT_USED_PHY)},getTotalCapacity:function(){return this.hasArithmosStats?a.getUsageStats(this,s.NEW_TOT_CAPACITY):a.getUsageStats(this,s.TOT_CAPACITY)},getTotalUsedPercentage:function(){var e=this.getTotalUsedPercentageRaw();return a.roundPercent(e)},getTotalUsedPercentageRaw:function(){var e=this.getTotalCapacity(),t=this.getUsedPhysical();return e>0?t/e:0},getHardwareConfig:function(){return this._diskConfig?this._diskConfig:this.getValue(s.DISK_HW_CONFIG)},getValue:function(t){var i;switch(t){case s.TOT_CAPACITY:i=this.getTotalCapacity();break;case s.TOT_USED_PHY:i=this.getUsedPhysical();break;case s.TOT_USED_PCT:i=this.getTotalUsedPercentage();break;case s.TOT_USED_PCT_RAW:i=this.getTotalUsedPercentageRaw();break;case s.NAME:i=this.nameParserFunc();break;default:i=e.prototype.getValue.apply(this,arguments)}return i},getSortValue:function(t){var i;if(t===s.ID){var n=this.get(t);i=n?Number(n):n}else i=t===s.TOT_USED_PCT?this.getTotalUsedPercentageRaw():e.prototype.getSortValue.apply(this,arguments);return i},getURL:function(){if(this.actionMode===o.REMOVE)return _.template(n.REMOVE_DISK,{id:this.get(s.ID)})},toJSON:function(t){var i=e.prototype.toJSON.apply(this,arguments);return t&&t.includeCustomAttributes&&(i[s.TOT_USED_PCT]=this.getTotalUsedPercentage(),i[s.DISK_ID]=this.getDisplayableId(),i[s.TOT_CAPACITY]=this.getTotalCapacity(),i[s.TOT_USED_PHY]=this.getUsedPhysical()),i},isUnmounted:function(){var e=this.getHardwareConfig();return e&&!e[s.DISK_HW_CONFIGS_DISK_MOUNTED]},getHostIp:function(){var e=this.getHardwareConfig();if(e)return e[s.HOST_IP]},setDiskConfig:function(e){if(!e)return void r.log("DiskModel : diskConfig should not be empty.");this._diskConfig=e;var t={};t[s.ID]=e[s.DISK_HW_CONFIGS_DISK_ID],t[s.MOUNT_PATH]=e[s.DISK_HW_CONFIGS_DISK_SERIAL],t[s.DISK_HW_CONFIG]=e,this.set(t,{silent:!0})},getMountedStatus:function(){var e=this.get(s.DISK_STATUS);return o.DISK_STATUS_LABEL[e]},getUnmountedStatus:function(){var e=this.getBackgroundOperation();return e?o.BACKGROUND_OPERATION_LABEL[e]||e:this.isUnmountedDiskStateBad()?o.UNMOUNTED_DISK_STATUS_LABEL.BAD:this.isUnmountedDiskStatePrepareAndAdd()?o.UNMOUNTED_DISK_STATUS_LABEL.PREPARE_ADD:this.isUnmountedDiskStatePulledOut()?o.UNMOUNTED_DISK_STATUS_LABEL.PULLED_OUT:this.isUnmountedDiskStateOffline()?o.UNMOUNTED_DISK_STATUS_LABEL.OFFLINE:void 0},isUnmountedDiskStatePrepareAndAdd:function(){var e=this.getHardwareConfig();return e&&e[s.DISK_HW_CONFIGS_DISK_NEW_CAN_ADD]&&!e[s.DISK_HW_CONFIGS_DISK_MOUNTED]},isUnmountedDiskStatePulledOut:function(){var e=this.getHardwareConfig();return e&&e[s.DISK_HW_CONFIGS_DISK_OLD_CAN_ADD]&&!e[s.DISK_HW_CONFIGS_DISK_MOUNTED]},isUnmountedDiskStateBad:function(){var e=this.getHardwareConfig();return e&&e[s.DISK_HW_CONFIGS_DISK_BAD]},isUnmountedDiskStateOffline:function(){var e=this.getHardwareConfig();return e&&e[s.DISK_HW_CONFIGS_DISK_DIAGNOSIS]},isBootDiskOnly:function(){var e=this.getHardwareConfig();return e&&e[s.DISK_HW_CONFIGS_DISK_BOOT_DISK]&&e[s.DISK_HW_CONFIGS_DISK_BOOT_DISK_ONLY]},isSSD:function(){var e=this.getHardwareConfig();return e&&e[s.DISK_HW_CONFIGS_DISK_BOOT_DISK]},isHostMetadataStoreDisabled:function(){var e=this.getHardwareConfig();return e&&!_.isUndefined(e[s.METADATA_STORE_STATUS])&&e[s.METADATA_STORE_STATUS]!==o.METADATA_STORE_STATUS.NORMAL},getBackgroundOperation:function(){var e=this.getHardwareConfig();return e&&e[s.DISK_HW_CONFIGS_DISK_BG_OPERATION]},startRemove:function(e){this.actionMode=o.REMOVE,this.destroy(e)},isNormal:function(){return this.get(s.DISK_STATUS)===o.DISK_STATUS.NORMAL},isBeingRemoved:function(){return this.get(s.DISK_STATUS)===o.DISK_STATUS.DATA_MIGRATION_INITIATED||this.get(s.DISK_STATUS)===o.DISK_STATUS.MARKED_FOR_REMOVAL_BUT_NOT_DETACHABLE},isDetachable:function(){return this.get(s.DISK_STATUS)===o.DISK_STATUS.DETACHABLE},flipLED:function(e,t){(new i).flipLED(e,this.getDiskSerialNumber(),t)},prepareAndAdd:function(e){(new i).prepareAndAdd(this.getDiskSerialNumber(),e)},addBack:function(e){(new i).addBack(this.getDiskSerialNumber(),e)},getStorageTierName:function(){return this.get(s.TIER_NAME)}})}),define("models/hardware/DiskCollection",["models/PollingCollection","models/hardware/DiskModel","data/DataURLConstants","data/DataProperties","utils/AppConstants","utils/StatsUtil","utils/AppUtil"],function(e,t,i,n,s,a,r){"use strict";return e.extend({model:t,url:i.DISK,name:"DiskCollection",getTotalUsedPhysical:function(e){var t=0;if(this.models)for(var i=0;i<this.models.length;i++)void 0!==e&&e!=this.models[i].get(n.SERVICE_VM_ID)||this.models[i].get(n.SP_ID)===s.ENTITY_INVALID_VALUE||(t+=this.models[i].getUsedPhysical());return t},getTotalMaxCapacity:function(e){var t=0;if(this.models)for(var i=0;i<this.models.length;i++)void 0!==e&&e!=this.models[i].get(n.SERVICE_VM_ID)||this.models[i].get(n.SP_ID)===s.ENTITY_INVALID_VALUE||(t+=this.models[i].getTotalCapacity());return t},getUnAllocatedDisks:function(){var e=[];if(this.models)for(var t=0;t<this.models.length;t++)this.models[t].get(n.SP_ID)!==s.ENTITY_INVALID_VALUE||this.models[t].get(n.FOR_REMOVAL)||e.push(this.models[t]);return e},getUnAllocatedDiskIds:function(){return _.map(this.getUnAllocatedDisks(),function(e){return e.get(n.ID)})},getTotalCapacityOfUnAllocatedDisks:function(){var e=0;return _.each(this.getUnAllocatedDisks(),function(t){e+=t.getTotalCapacity()}),e},getTotalUsedPercentagePhysical:function(){return this.getTotalMaxCapacity()>0?a.roundPercent(this.getTotalUsedPhysical()/this.getTotalMaxCapacity()):s.STATS_NOT_AVAILABLE},getTotalAvailablePhysical:function(){return this.getTotalMaxCapacity()-this.getTotalUsedPhysical()},areAllDisksUnallocated:function(){return this.getUnAllocatedDisks().length===this.length},getDisksFromHost:function(e){var t=[];return _.each(this.models,function(i){var s=i.get(n.SERVICE_VM_ID);e!=s&&e!=r.getDisplayableId(s)||t.push(i.toJSON())}),t},getDisksWithOutstandingTasks:function(){var e=[];return _.each(this.models,function(t){t.get(n.DISK_STATUS)!==n.ONLINE&&e.push(t.toJSON())}),e},getPerTierMap:function(e){var t,i={};return _.each(this.models,function(s){s.get(n.SP_ID)!=e&&e||(t=s.get(n.TIER_NAME),i[t]?i[t]={used:i[t].used+s.getUsedPhysical(),capacity:i[t].capacity+s.getTotalCapacity()}:i[t]={used:s.getUsedPhysical(),capacity:s.getTotalCapacity()})}),i},hasNVMeDisk:function(){return this.any(function(e){return e.getStorageTierName()===s.DISK_TIER.PCIE})}})}),define("models/alert/AlertPolicyModel",["models/BaseModel","data/DataURLConstants","managers/NamespaceManager","utils/AppConstants"],function(e,t,i,n){"use strict";var s={ID:"id",ALERT_TYPE_ID:"alertTypeId",NAME:"name",TITLE:"title",ENABLED:"enabled",MESSAGE:"message",DESCRIPTION:"description",SEVERITY:"severity",SEVERITY_THRESHOLD_INFOS:"severityThresholdInfos",CATEGORY_TYPES:"categoryTypes",EXCEPTION_COUNT:"exceptionCount",AFFECTED_ENTITY_TYPES:"affectedEntityTypes",SCHEDULE_INTERVAL_IN_SECS:"scheduleIntervalInSecs",PARAMETERS:"parameters",IS_USER_DEFINED:"isUserDefined",POLICY_UUID:"policyUuid",MODIFIED_TIME_STAMP_IN_USECS:"modifiedTimeStampInUsecs",ALERT_CONFIGURABLE_PARAMETERS:"alertConfigurableParameters",ALERT_CONFIG_EXCEPTION_GROUP:"alertConfigExceptionGroups",CONFIGURABLE_PARAMETERS:"configurableParameters",PARAM_NAME:"parameterName",PARAM_CLUSTER_UUIDS:"clusterUuids",PARAM_VALID_VALUES:"parameterValidValues",PARAM_DEFAULT_STRING_VALUE:"parameterDefaultStringValue",PARAM_DEFAULT_BOOLEAN_VALUE:"parameterDefaultBooleanValue",PARAM_DEFAULT_LONG_VALUE:"parameterDefaultLongValue",PARAM_STRING_VALUE:"parameterStringValue",PARAM_BOOLEAN_VALUE:"parameterBooleanValue",PARAM_LONG_VALUE:"parameterLongValue",PARAM_UNIT:"parameterUnit",APPLICABLE_FOR_PC:"applicableForMultiCluster",APPLICABLE_FOR_PE:"applicableForSingleCluster",PARAM_VALUES:["parameterStringValue","parameterBooleanValue","parameterLongValue"],PARAM_DEFAULT_VALUES:["parameterDefaultStringValue","parameterDefaultBooleanValue","parameterDefaultLongValue"],AUTO_RESOLVE:"autoResolve",CATEGORY_LIST:"categoryList",AFFECTED_ENTITY_LIST:"affectedEntityList",CONFIGURABLE_RULE:"configurableRule",CONFIGURABLE:"configurable",LAST_UPDATE_TIME:"lastUpdateTime",AUTO_RESOLVE_VALUES:{NOT_SUPPORTED:"not_supported",ENABLED:"enabled",DISABLED:"disabled"},KB_LIST:"kbList"};return e.extend({nameAttribute:s.TITLE,urlRoot:t.ALERT_POLICY,entityType:n.ENTITY_ALERT_POLICY,name:"AlertPolicyModel",DP:s,parse:function(e){return _.isArray(e)?e[0]:e},canModify:function(){return n.LICENSE_ALERT_POLICIES.indexOf(this.get(s.ALERT_TYPE_UUID))<0},parseOptions:function(t,i,n){return"read"===t&&this.clusterManager.isMulticlusterNavMode()?(this._parameters=this._parameters||{},this._parameters.exceptionDetails=!0,this._parameters.globalConfig=!0):this._parameters={},e.prototype.parseOptions.apply(this,arguments)},toJSON:function(t){if(t&&(t.includeCustomAttributes||t.includeAttribute)){var n=e.prototype.toJSON.apply(this,arguments);if(t.includeCustomAttributes){n[s.CATEGORY_LIST]=this.getDisplayableCategory(),n[s.AFFECTED_ENTITY_LIST]=this.getAffectedEntityTypes(),n[s.CONFIGURABLE_RULE]=this.getConfigurableRule();var a=this.get(s.SEVERITY_THRESHOLD_INFOS);n[s.CONFIGURABLE]=a&&a.length>0}return n}var r=i.get(i.USER_DETAILS);return{alertTypeId:this.get(s.ALERT_TYPE_ID),id:this.getId(),isGlobalConfig:this.isGlobalConfig(),autoResolve:this.get(s.AUTO_RESOLVE),severityThresholdInfos:this.get(s.SEVERITY_THRESHOLD_INFOS),alertConfigurableParameters:this.get(s.ALERT_CONFIGURABLE_PARAMETERS),modifiedByUsername:r.profile.username}},showLatencyNotification:function(e,t){},showSuccessNotification:function(e,t,i){},triggerAppViewRefresh:function(){},getDisplayableSeverity:function(){return this.get(s.SEVERITY).substring(1)},getDisplayableCategory:function(){var e=this.get(s.CATEGORY_TYPES);return e=_.filter(e,function(e){return n.ALERT_IMPACT_TYPES[e]}),_.map(e,function(e){return n.ALERT_IMPACT_TYPES[e][0]}).join(",")},getConfigurableRule:function(){if(this.get(s.IS_USER_DEFINED))return"";var e=this.get(s.SEVERITY_THRESHOLD_INFOS);if(e&&e.length){var t=_.some(e,function(e){return null!==e[s.ENABLED]&&!1===e[s.ENABLED]});if(!t){var i=this.get(s.ALERT_CONFIGURABLE_PARAMETERS);i&&i.length&&(t=_.some(i,function(e){var t=_.find(s.PARAM_VALUES,function(t){return null!==e[t]}),i=t?e[t]:null;if(null===i)return!1;var n=_.find(s.PARAM_DEFAULT_VALUES,function(t){return null!==e[t]});return(n?e[n]:null)!==i}))}return t?"Overridden":"Default"}return""},getAffectedEntityTypes:function(){var e=this.get(s.AFFECTED_ENTITY_TYPES);return _.map(e,function(e){return n.ENTITY_NAMES[e.toLowerCase()]||e}).join(",")},parseConfigurableParameters:function(e,t){var i=[];return _.each(e,function(e){if(null!==e[s.ENABLED]){var a=n.ALERT_SEVERITY_NAMES[e[s.SEVERITY]]||e[s.SEVERITY],r={severity:e[s.SEVERITY],enabled:e[s.ENABLED],severityLabel:a},o=this.getSeverityThresholdParameter(t,e[s.SEVERITY]);_.size(o)&&(r=_.extend(r,o)),i.push(r)}},this),i.sort(function(e,t){return n.ALERT_SEVERITY_HIERARCHY[e.severity]-n.ALERT_SEVERITY_HIERARCHY[t.severity]}),i},getSeverityThresholdParameter:function(e,t){var i=_.find(e,function(e){return e[s.SEVERITY]===t});if(i){var n=_.find(s.PARAM_VALUES,function(e){return null!==i[e]}),a=n?i[n]:null,r=_.find(s.PARAM_DEFAULT_VALUES,function(e){return null!==i[e]}),o=r?i[r]:null;if(!n){var l=s.PARAM_DEFAULT_VALUES.indexOf(r);n=l>=0?s.PARAM_VALUES[l]:null}return{name:i[s.PARAM_NAME],value:a,defaultValue:o,valueAttribute:n,validValues:(i[s.PARAM_VALID_VALUES]||[]).join(","),unit:i[s.PARAM_UNIT]}}return{}},getConfigurableParameters:function(){return this.parseConfigurableParameters(this.get(s.SEVERITY_THRESHOLD_INFOS),this.get(s.ALERT_CONFIGURABLE_PARAMETERS))},getExceptions:function(){return _.map(this.get(s.ALERT_CONFIG_EXCEPTION_GROUP),function(e){var t=e[s.PARAM_CLUSTER_UUIDS];return{clusters:_.map(t,function(e){return{clusterUuid:e,name:this.clusterManager.getNameById(e)||e}},this),parameters:this.parseConfigurableParameters(e[s.SEVERITY_THRESHOLD_INFOS],e[s.CONFIGURABLE_PARAMETERS]),autoResolve:e[s.AUTO_RESOLVE]}},this)},getDefaultValueAttributeName:function(e){return e.replace("parameter","parameterDefault")},isGlobalConfig:function(){return this.clusterManager.isMulticlusterNavMode()}},{DP:s})}),define("models/alert/AlertPolicyCollection",["models/alert/AlertPolicyModel","models/BaseCollection","data/DataURLConstants"],function(e,t,i){"use strict";return t.extend({model:e,url:i.ALERT_POLICY,excludeUDAPolicy:null,initializeBaseCollection:function(e,i){t.prototype.initializeBaseCollection.apply(this,arguments),i&&i.includeInternalChecks&&(this._parameters.includeInternalChecks=!0),this.clusterManager.isMulticlusterNavMode()&&(this._parameters.exceptionDetails=!0,this._parameters.globalConfig=!0),this.excludeUDAPolicy=i&&i.excludeUDAPolicy},comparator:function(e){return e.get(e.DP.ALERT_TYPE_ID)},parse:function(i,n){var s=t.prototype.parse.apply(this,arguments),a=this.clusterManager.isMulticlusterNavMode();return _.filter(s,function(t){return(!this.excludeUDAPolicy||!t[e.DP.IS_USER_DEFINED])&&(t[e.DP.ALERT_TYPE_ID]||a&&t[e.DP.IS_USER_DEFINED])},this)}},{INCLUDE_INTERNAL_CHECKS_PARAM:"includeInternalChecks",EXCLUDE_UDA_POLICY:"excludeUDAPolicy"})}),define("managers/ActionManager",["utils/AppConstants","utils/AppUtil","managers/I18nManager","managers/AccessManager"],function(e,t,i,n){"use strict";return{name:"ActionManager",actionWorkflowFactory:null,entityFactory:null,setActionWorkflowFactory:function(e){this.actionWorkflowFactory=e},setEntityFactory:function(e){this.entityFactory=e},executeAction:function(e,t){this.actionWorkflowFactory&&this.actionWorkflowFactory.executeAction(e,t)},executeActionElement:function(i,n){var s,a=$(i),r=a.attr(e.NAV_ACTION_ROUTE);if(r)try{s=JSON.parse(r)}catch(e){return void t.log("Error in parsing action route: "+e)}else{s={action:a.attr(e.NAV_ACTION),actionId:a.attr(e.NAV_ACTION_ID),actionTarget:a.attr(e.NAV_ACTION_TARGET),actionTargetId:a.attr(e.NAV_ACTION_TARGET_ID),actionTargetName:a.attr(e.NAV_ACTION_TARGET_NAME),actionParentId:a.attr(e.NAV_ACTION_PARENT_ID),actionInnerTemplate:a.attr(e.NAV_ACTION_INNER_TEMPLATE),actionParentEntityType:a.attr(e.NAV_ACTION_PARENT_ENTITY_TYPE)};var o=a.attr(e.NAV_ACTION_CONTEXT_ID);s.action!==e.ACTION_DETAILS&&s.action!==e.ACTION_CREATE||!o||(s[e.NAV_ACTION_CONTEXT_ID]=o)}this.executeAction(s,n)},isNavigationAction:function(e){if(this.actionWorkflowFactory)return this.actionWorkflowFactory.isNavigationAction(e)},navigateToURL:function(t,i,n){var s={action:e.ACTION_NAVIGATE_URL,actionTarget:t,isNewWindow:i,windowOptions:n};this.executeAction(s)},getActions:function(e){var t=this.entityFactory.getEntityActions(e);return n.filterActions(e,t)},getActionById:function(e,t){return this.getActions(e).findModelById(t)},hasDeleteAction:function(e){return this.getActions(e).find(function(e){return e.isDeleteAction()})},hasCreateAction:function(e,t){return this.getActions(e).findModelById(t).isCreateAction()},onEntityAction:function(t,n,s,a,r){var o=this.getActions(t);if(o){var l,c,u=o.find(function(e){return e.get(e.idAttribute)===n});if(u){c=u.getActionRoute({targetIds:s,parentEntityType:t,clusterUuid:a}),c[e.NAV_ACTION_ID]=n;u.get(u.DP.CONFIRMATION)&&(l=i.t(this.name,u.get(u.DP.CONFIRMATION)))}else c={action:n,actionTarget:t,actionTargetId:s,clusterUuid:a},c[e.NAV_ACTION_ID]=n;r=r||{},c[e.NAV_ACTION_INNER_TEMPLATE]=c[e.NAV_ACTION_INNER_TEMPLATE]||r[e.NAV_ACTION_INNER_TEMPLATE],c[e.NAV_ACTION_SWAGGER_PATH]=c[e.NAV_ACTION_SWAGGER_PATH]||r[e.NAV_ACTION_SWAGGER_PATH],!r.skipConfirm&&l&&l.length?$.nutanixConfirm({msg:l,yes:function(){this.executeAction(c,r)},context:this}):this.executeAction(c,r)}}}}),define("models/license/LicenseModel",["models/PollingModel","data/DataURLConstants","data/DataProperties","utils/AppConstants","utils/AppUtil"],function(e,t,i,n,s){"use strict";var a=_.template("<%= actionMode %> in progress."),r={NODE_MODEL_NAME:"model",NODE_LICENSE_LIST:"nodeLicenseList",ADDON_LICENSE_LIST:"addonLicenseList",FEAT_VIOLATIONS:"featureViolations",LICENSE_CALM_MESSAGE:"licenseCalmMessage",FV_FEAT_NAME:"featureName",FV_DESC:"violationDescription",FV_AFFECTED:"affected",LICENSE_ID:"licenseId",LICENSE_CATEGORY:"category",LICENSE_CLASS:"licenseClass",LICENSE_EXPIRY:"clusterExpiryUsecs",LICENSE_IN_USE:"used",LICENSE_NODE_EXPIRY:"nodeExpiryUsecs",COINS_APPLIED:"coinsLicensed",CALM_EXTRA_PACKS:"calmExtraPacks",CLUSTER_COINS_TOTAL:"totalCoinsLicensed",LICENSE_COIN_EXPIRY:"expiryUsecs",LICENSE_LIST:"licenseList",CLUSTER_CAPACITY:"capacity",CLUSTER_CAPACITY_LICENSED:"capacityLicensed",LICENSE_ATTRIBUTE:"attribute",QUANTITY_APPLIED:"quantity",CLUSTER_LICENSE_LIST:"clusterLicenseList",LICENSE_MODE:"licenseMode",LICENSE_EXPIRY_MSG:"licenseExpiryMessage",NODE_EXPIRY_MSG:"nodeExpiryMessage",LICENSE_TYPE:"licenseType"},o={SSP:"SELF_SERVICE_PORTAL",VMBL:"VM_BEHAVIOR_LEARNING"};return e.extend({urlRoot:t.LICENSE,entityType:n.ENTITY_LICENSING,name:"LicenseModel",getLicenseMode:function(){return this.get(r.LICENSE_MODE)},isCoinEnabled:function(){return this.getLicenseMode()===n.LICENSE_CLUSTER_TYPE.COINS},isABLEnabled:function(){return this.getLicenseMode()===n.LICENSE_CLUSTER_TYPE.ATTRIBUTE},isNodeEnabled:function(){return!this.getLicenseMode()||this.getLicenseMode()===n.LICENSE_CLUSTER_TYPE.NODE},isMixedCluster:function(){return this.getLicenseMode()===n.LICENSE_CLUSTER_TYPE.MIXED},isCapacityLicense:function(e){return e[r.COINS_APPLIED]||e[r.QUANTITY_APPLIED]},getFeatureAllowance:function(e,t){var i=this.getFeatureAllowanceMap(t);if(i&&i[e])return i[e];s.log("LicenseModel: getFeatureLicense: Issue retrieving allowance for feature "+e)},getAddonFeatureAllowanceMap:function(e){var t=this.get(i.ADDON_ALLOWANCE_MAP)||{},s={};return _.each(t,function(e){_.extend(s,e)}),e?t[n.ADDON_LICENSE_TYPES[e]]:s},getFeatureAllowanceMap:function(e,t){return e?this.getAddonFeatureAllowanceMap(t):this.get(i.ALLOWANCE_MAP)},getFeatureMap:function(){var e=_.extend({},this.get(i.ALLOWANCE_MAP),this.get(i.ADDON_ALLOWANCE_MAP)),t={};return _.each(e,function(e,i){t[i]=i,t["LICENSE_"+i]={id:i},_.each(o,function(e,n){e===i&&(t[n]=e)})}),t},getFeatureViolations:function(e){var t=this.get(r.FEAT_VIOLATIONS)||[];return e?(e=e.replace(/ /g,"").toLowerCase(),_.filter(t,function(t){var i=t[r.FV_FEAT_NAME];return e===i.replace(/ /g,"").toLowerCase()})):t},getLicenseCalmMessage:function(){return this.get(r.LICENSE_CALM_MESSAGE)},getCalmExtraPacks:function(){return this.get(r.CALM_EXTRA_PACKS)||0},getURL:function(e,t){if("create"===e){var n=this.urlRoot+"/"+this.getCategory()+"?enable="+this.get(i.LICENSE_ENABLED);return this.unset(i.LICENSE_TYPE),n}},getLicenseExpiryMsg:function(){var e=this.get(r.LICENSE_EXPIRY_MSG)||[];return e[0]?e||[]:[]},isGeneralLicensesExpired:function(){return _.indexOf(this.getExpiredLicenseTypes(),this.getCategory())>-1},isCalmLicensesExpired:function(){return _.indexOf(this.getExpiredLicenseTypes(),n.LICENSE_TYPES.CALM)>-1},isFlowLicensesExpired:function(){return _.indexOf(this.getExpiredLicenseTypes(),n.LICENSE_CLASSES.FLOW)>-1},getFormattedExpiryMsg:function(){var e={expiredTypes:[],expiringTypes:[]};return _.each(this.getLicenseExpiryMsg(),function(t){var i=t.split(","),n=i[2],s=i[3];if(n&&s){var a=n&&n.trim();new Date(s)>=new Date&&e.expiringTypes.indexOf(a)<0?e.expiringTypes.push(a):new Date(s)<new Date&&e.expiredTypes.indexOf(a)<0&&e.expiredTypes.push(a)}}),e},getExpiredLicenseTypes:function(){return this.getFormattedExpiryMsg().expiredTypes},getExpired:function(){return this.getExpiredAfterDate(Date.now())},getExpiredAddons:function(){var e=this,t=Date.now()*n.MICROS_PER_MILLI,i={};return _.each(this.getAllAddons(),function(n){var s=n[r.LICENSE_CATEGORY];n[e.getExpiryPropFromLicense(n)]<t&&(i[s]?i[s].push(n):i[s]=[n])}),i},getExpiredAfterDate:function(e,t){var i=this,s=e*n.MICROS_PER_MILLI;return t=t||this.getLicenseList(),_.filter(t,function(e){var t=i.getExpiryPropFromLicense(e),n=e[t];return n>0&&n<s})},getDisplayableLicenseClass:function(){switch(this.getLicenseClass()){case n.LICENSE_CLASSES.PRISM_CENTRAL:return n.LICENSE_TITLES.PRISM;case n.LICENSE_CLASSES.XPRESS:return n.LICENSE_TITLES.XPRESS;default:return this.isVDIEnabled()?n.LICENSE_TITLES.VDI:this.isRoboEnabled()?n.LICENSE_TITLES.ROBO:n.LICENSE_TITLES.ACROPOLIS}},getLicenseClass:function(){return this.get(r.LICENSE_CLASS)},getClusterLicenseList:function(){return this.get(r.CLUSTER_LICENSE_LIST)||[]},isVDIEnabled:function(){return _.any(this.getClusterLicenseList(),function(e){return!!e[r.LICENSE_TYPE]&&e[r.LICENSE_TYPE].toLowerCase()===n.LICENSE_TYPES.VDI_CORE.toLowerCase()})},isRoboEnabled:function(){
return _.any(this.getClusterLicenseList(),function(e){return!!e[r.LICENSE_TYPE]&&e[r.LICENSE_TYPE].toLowerCase()===n.LICENSE_TYPES.ROBO_PRO.toLowerCase()})},getCategory:function(){return this.getPrimaryCategory(this.getLicenseClass())},getNodes:function(){return this.get(r.NODE_LICENSE_LIST)||[]},getAllAddons:function(){return this.get(r.ADDON_LICENSE_LIST)||[]},getPrimaryCategory:function(e){var t=this,s=_.find(this.getClusterLicenseList(),function(s){return t.isOfClass(e,s)&&s[i.LICENSE_SUBTYPE]!==n.LICENSE_SUBCATEGORIES.ADDON});return s?s[r.LICENSE_CATEGORY]:e===n.LICENSE_CLASSES.APPLIANCE||e===n.LICENSE_CLASSES.XPRESS||e===n.LICENSE_CLASSES.PRISM_CENTRAL||e===n.LICENSE_CLASSES.SOFTWARE_ONLY?this.get(r.LICENSE_CATEGORY)||n.LICENSE_TYPES.NO_LICENSE:n.LICENSE_TYPES.NO_LICENSE},getAllLicenses:function(){var e=this.getLicenseMode(),t=[];switch(e){case n.LICENSE_CLUSTER_TYPE.COINS:t=this.getCoinLicenseList();break;case n.LICENSE_CLUSTER_TYPE.ATTRIBUTE:t=this.getABLLicenseList();break;case n.LICENSE_CLUSTER_TYPE.MIXED:t=this.getABLLicenseList().concat(this.getNodes());break;default:t=[].concat(this.getNodes(),this.getAllAddons())}return t},getVDIUsersTotal:function(){var e=this.get(r.LICENSE_LIST)||[],t=_.filter(e,function(e){return e[r.LICENSE_ATTRIBUTE]&&e[r.LICENSE_ATTRIBUTE].toLowerCase()===n.LICENSE_PORTAL_ATTRIBUTE_TYPES.USERS.toLowerCase()});return _.reduce(t,function(e,t){return e+t[r.QUANTITY_APPLIED]},0)},getRoboVMsTotal:function(){var e=this.get(r.LICENSE_LIST)||[],t=_.filter(e,function(e){return e[r.LICENSE_ATTRIBUTE]&&e[r.LICENSE_ATTRIBUTE].toLowerCase()===n.LICENSE_PORTAL_ATTRIBUTE_TYPES.VM.toLowerCase()});return _.reduce(t,function(e,t){return e+t[r.QUANTITY_APPLIED]},0)},getNodeCount:function(){return(this.getNodes()||[]).length},getNodeSummary:function(){return _.groupBy(this.getNodes(),r.NODE_MODEL_NAME)},getAddonNodeSummary:function(e){return _.groupBy(this.getAddonNodes(e),r.NODE_MODEL_NAME)},getAddonNodes:function(e){var t=new RegExp("^"+e+"$","i");return _.filter(this.getAllAddons(),function(e){return t.test(e[r.LICENSE_CATEGORY])})},getLicensedNodes:function(){return _.filter(this.getNodes(),function(e){return!!e.licenseId})},getLicensedNodeCount:function(){return this.getLicensedNodes().length},getCalmLicenses:function(e){var t=this.getNodes();return _.filter(t,function(e){return e[r.LICENSE_CLASS]===n.LICENSE_CLASSES.CALM})},getCalmLicenseCount:function(){return this.getCalmLicenses().length},getLicenseIds:function(){var e=this,t=_.filter(this.getAllLicenses(),function(t){return!e.isOfClass(n.LICENSE_CLASSES.FILE,t)&&!e.isOfClass(n.LICENSE_CLASSES.BUCKET,t)});return _.pluck(t,r.LICENSE_ID)},getLicenseById:function(e){return _.find(this.getAllLicenses(),function(t){return e===t[r.LICENSE_ID]})},canUseFeat:function(e,t,n){e=_.isString(e)?e.toUpperCase():(e||{}).id;var s=this.getFeatureAllowance(e,n);if(!s)return!1;switch(s[i.ALLOWANCES_TYPE]){case i.ALLOWANCE_TYPE_LIST.BOOLEAN:return this._checkBooleanAllowance(s);case i.ALLOWANCE_TYPE_LIST.INTEGER_LIST:return this._checkIntListAllowance(s,t);default:return!1}},hasProduct:function(e){var t=this;return _.any(this.getClusterLicenseList(),function(i){return t.isOfClass(e,i)})},getLicenseTypeOfProduct:function(e,t){var s=this;if(t=t||!1,this.hasProduct(e)){return _.find(this.getClusterLicenseList(),function(i){return t?s.isOfClass(e,i)&&s.isOfSubcategory(i,n.LICENSE_SUBCATEGORIES.ADDON):s.isOfClass(e,i)&&!s.isOfSubcategory(i,n.LICENSE_SUBCATEGORIES.ADDON)})[i.LICENSE_TYPE]}return n.LICENSE_TYPES.NO_LICENSE},getLicensesByProduct:function(e){var t=this,i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return _.filter(this.getAllLicenses(),function(n){return t.isOfProduct(n,e,i)&&null!==n.licenseId})},hasUnlicensedNodes:function(){var e=this,t=void 0,i=_.filter(this.getNodes(),function(t){return e.getLicenseClass().toLowerCase()===t[r.LICENSE_CLASS].toLowerCase()});return _.any(i,function(e,i){var n=e[r.LICENSE_ID],s=!(_.isString(n)&&n.length);return 0===i&&(t=!s),t?s:Boolean(n)})},isPrimaryLicense:function(e){return this.isOfClass(n.LICENSE_CLASSES.APPLIANCE,e)||this.isOfClass(n.LICENSE_CLASSES.SOFTWARE_ONLY,e)||this.isOfClass(n.LICENSE_CLASSES.PRISM_CENTRAL,e)||this.isOfClass(n.LICENSE_CLASSES.XPRESS,e)},isOfClass:function(e,t){return(t?t[r.LICENSE_CLASS]:this.getLicenseClass()||"").toLowerCase()===(e||"").toLowerCase()},getLicensesByClass:function(e){var t=this;return _.filter(this.getClusterLicenseList(),function(i){return t.isOfClass(e,i)})},isOfSubcategory:function(e,t){return e[i.LICENSE_SUBTYPE].toLowerCase()===t.toLowerCase()},isOfProduct:function(e,t){return arguments.length>2&&void 0!==arguments[2]&&arguments[2]?this.isOfClass(t,e)&&this.isOfSubcategory(e,n.LICENSE_SUBCATEGORIES.ADDON):this.isOfClass(t,e)&&!this.isOfSubcategory(e,n.LICENSE_SUBCATEGORIES.ADDON)},isInStandbyMode:function(){return this.get(i.LICENSE_STANDBY)},isExpired:function(e){var t=this,i=Date.now()*n.MICROS_PER_MILLI;return e=e||this.getLicenseList(),_.any(e,function(e){var n=t.getExpiryPropFromLicense(e),s=e[n];return 0!==s&&s<i})},isOfCategory:function(e,t){return(t?t[r.LICENSE_CATEGORY]:this.getCategory()||"").toLowerCase()===(e||"").toLowerCase()},isFeatureEnabled:function(){var e=this.get(i.LICENSE_ENABLED);return void 0===e||e},isModelBased:function(){return this.isOfClass(n.LICENSE_CLASSES.APPLIANCE)},hasAddons:function(){return!!(_.filter(this.getClusterLicenseList(),function(e){return e[i.LICENSE_SUBTYPE]===n.LICENSE_SUBCATEGORIES.ADDON})||[]).length},hasGeneralLicense:function(){return this.getCategory()!==n.LICENSE_TYPES.NO_LICENSE},getLatencyMessage:function(e){return a({actionMode:e})},showFeatureToggle:function(){return this.isOfClass(n.LICENSE_CLASSES.PRISM_CENTRAL)&&-1!==n.LICENSE_FEATURES_TOGGLING.indexOf(this.getCategory())},getAddonListGroupByType:function(){var e=this.get(i.LICENSE_ADDON_LIST);return _.groupBy(e,function(e){return e[i.LICENSE_TYPE]})},getExpiryPropFromLicense:function(e){return this.isCapacityLicense(e)?i.LICENSE_COIN_EXPIRATION:i.LICENSE_EXPIRATION},getExpiryUsecs:function(e,t){t&&(e=_.filter(e,function(e){return e.category===t}));var i=this.getMinExpiryLic(e);if(i){return i[this.getExpiryPropFromLicense(i)]}return null},getMinExpiryLic:function(e){var t=this,i=null,n=void 0;return _.each(e,function(e){var s=t.getExpiryPropFromLicense(e);i=n<e[s]?i:e,n=i[s]}),i},getLicenseDaysRemaining:function(){var e=this.get(r.LICENSE_EXPIRY);if(_.isNumber(e)){if(0===e)return Number.POSITIVE_INFINITY;var t=e/n.MICROS_PER_MILLI,i=(t-Date.now())/n.MILLIS_PER_HOUR;return Math.ceil(i/n.HOURS_PER_DAY)}return-1},isFlowPurchased:function(){return this.getLicensesByProduct(n.LICENSE_CLASSES.FLOW).length>0},isMicrosegPurchased:function(){return this.hasProduct(n.LICENSE_CLASSES.FLOW)},getLicenseList:function(){var e=this.getLicenseMode(),t=[];switch(e){case n.LICENSE_CLUSTER_TYPE.COINS:case n.LICENSE_CLUSTER_TYPE.ATTRIBUTE:t=this.getCoinLicenseList();break;case n.LICENSE_CLUSTER_TYPE.MIXED:t=this.getCoinLicenseList().concat(this.getNodes());break;default:t=this.getNodes()}return t},getABLLicenseList:function(){return[].concat(this.getCoinLicenseList(),this.getAllAddons())},getCoinLicenseList:function(){return this.get(r.LICENSE_LIST)||[]},getAddonLicenseList:function(){return this.get(r.ADDON_LICENSE_LIST)||[]},getLicenseCoinApplied:function(e){return e?e[r.COINS_APPLIED]:0},getGeneralCoinTotal:function(){var e=this,t=this.getClusterLicenseList(),i=_.filter(t,function(t){return e.isOfClass(e.getLicenseClass(),t)&&t.subCategory!==n.LICENSE_SUBCATEGORIES.ADDON});return this.getTotal(i)},getCalmCoinTotal:function(){return this.getTotal(this.getLicensesByClass(n.LICENSE_CLASSES.CALM))},getClusterCoinTotal:function(){return this.get(r.CLUSTER_COINS_TOTAL)},getAddonCoinTotal:function(){var e=this.get(r.ADDON_LICENSE_LIST);return this.getTotal(e)},getCoinsLicensedByProduct:function(e,t){var n=this,s=_.find(this.getClusterLicenseList(),function(i){return n.isOfProduct(i,e,t)});return s?s[i.LICENSE_COINS_APPLIED]:0},getAddonCoinByType:function(e){e===n.ADDON_LICENSE_TYPES.DATA_ENCRYPTION&&this.isOfCategory(n.LICENSE_TYPES.PRO)&&(e=n.ADDON_LICENSE_TYPES.SOFTWARE_ENCRYPTION);var t=_.find(this.getAddonLicenseList(),function(t){return t[i.LICENSE_TYPE]===e});return t?t[i.LICENSE_COINS_APPLIED]:-1},getCoinExpired:function(e){return this.getCoinExpiryAfterDate(e||this.getCoinLicenseList(),Date.now())},getCoinExpiryAfterDate:function(e,t){var i=this,s=t*n.MICROS_PER_MILLI;e=e||this.getCoinLicenseList();var a=0;return _.each(e,function(e){var t=e[r.LICENSE_COIN_EXPIRY];0!==t&&t<s&&(a+=i.getLicenseCoinApplied(e))}),a},getCapacity:function(){return this.get(r.CLUSTER_CAPACITY)},getLicensedCapacity:function(){return this.get(r.CLUSTER_CAPACITY_LICENSED)},getTotal:function(e){return e?this.getTotalLicenseQuantity(e):0},getTotalLicenseQuantity:function(e){var t=this.isCoinEnabled()?r.COINS_APPLIED:r.QUANTITY_APPLIED;return _.reduce(e,function(e,i){return e+i[t]},0)},getCapacityDiff:function(){var e=this.getCapacity(),t=this.getLicensedCapacity(),i={};if(!t)return 0;for(var s in e)Object.prototype.hasOwnProperty.call(t,s)&&_.contains(n.LICENSE_CAPACITY_TYPE,s)&&(i[s]=t[s]-e[s]);return i},hasOverlicensedCapacity:function(e){var t=e?n.LICENSE_PE_CAPACITY_TYPES:n.LICENSE_PC_CAPACITY_TYPES;return _.any(this.getCapacityDiff(),function(e,i){return e>0&&t.indexOf(i)>=0})},hasEnoughCapacity:function(e,t){var i=[];if(!t)return 0;for(var s in e)if(e[s]>0){if(!Object.prototype.hasOwnProperty.call(t,s))return 1;if(_.contains(n.LICENSE_CAPACITY_TYPE,s)){var a=t[s]?t[s]-e[s]:0;if(a<0)return 1;s!==n.LICENSE_ATTRIBUTE_TYPE.HDD&&i.push(a)}}return _.any(i,function(e){return e>0})?-1:0},hasUnlicensedCapacity:function(){var e=this.getCapacity(),t=this.getLicensedCapacity();return this.hasEnoughCapacity(e,t)},getEarliestExpiryCoin:function(){var e=this.getLicenseList(),t=this.getExpiryUsecs(e),i=_.filter(e,function(e){return e[r.LICENSE_COIN_EXPIRY]===t});return this.getTotal(i)},_checkBooleanAllowance:function(e){var t=e[i.ALLOWANCE_BOOL_VALUE]||{},n=t[i.ALLOWANCE_BOOL_VALUE];return Boolean(n)},_checkIntListAllowance:function(e,t){var n=_.first(e[i.ALLOWANCE_INT_VALUES])||{},s=n[i.ALLOWANCE_INT_VALUE];return _.isNumber(t)&&t<=s}},{DP:r})}),define("managers/LicenseManager",["models/license/LicenseModel","managers/BaseManager","managers/NamespaceManager","managers/NotificationManager","managers/ActionManager","managers/I18nManager","managers/ClusterManager","data/DataProperties","events/AppEvents","utils/AppUtil","utils/AppConstants"],function(e,t,i,n,s,a,r,o,l,c,u){"use strict";var d=u.DAYS_PER_MONTH,h=new RegExp("^NX","i"),p=_.template('<div class="<%= classes %>" dismissflag="<%= dismissFlag %>"><%= bannerText %> <a class="n-license-popup <%= extraClass %>"><%= bannerLinkText %></a></div>'),T=_.template('<div class="n-license-warning"> <%= msg %></div>');return t.extend({FEAT_MAP:{},FEATURE_MAP:{},LICENSE_LEVEL:{PRO:"pro",ULTIMATE:"ultimate"},SHOW_LICENSE_INFO_THRESHOLD:30,LICENSE_INFO_CATEGORIES:{pro_trial_prism_central:{DISPLAY_NAME:"Prism Pro Trial",DISPLAY_CLASS:"Prism Central",DISMISS_FLAG:"license_info_prismprotrial_dismissed"},starter_xpress:{DISPLAY_NAME:"Xpress Starter",DISPLAY_CLASS:"Xpress",DISMISS_FLAG:"license_info_xpress_dismissed"}},name:u.MANAGER.LICENSE,model:null,initialize:function(){this.addToManagerHelper(),_.bindAll(this,"onClickLicenseLink"),this.model=new e,this.model.setIntervalTime(u.LICENSE_POLLING_INTERVAL),this.registerListener("change",this.onLicenseChange,this),this.registerListener("error",this.onLicenseError,this),i.set(i.LICENSE_MANAGER,this);var t=i.get(i.APP_VIEW);t&&t.on(l.APP_VIEW_IS_RENDERED,this.onAppRender,this)},fetchOnDemand:function(){return this.model.fetch()},registerListener:function(e,t,i){this.model.on(e,t,i)},unregisterListener:function(e,t,i){this.model.off(e,t,i)},getLicenseModel:function(){return this.model},startServices:function(){return this.model.isPolling()?$.Deferred().resolve(this.model):($(".n-license-popup").live("click",this.onClickLicenseLink),this.model.startPolling())},stopServices:function(){$(".n-license-popup").off("click",this.onClickLicenseLink),this.model.stopPolling()},createLicenseInfoBanner:function(){if(this.model.getState()!==u.STATE_ERROR){var e=this.model.getCategory(),t=this.model.getLicenseClass(),i=(e+"_"+t).toLowerCase(),n=this.LICENSE_INFO_CATEGORIES[i];if(!n)return void this.removeAllLicenseInfoFlags();if(!this.model.isFeatureEnabled())return void(c.hasLocalStorage()&&localStorage.removeItem(n.DISMISS_FLAG));var s=!1;if(c.hasLocalStorage()&&(s=localStorage[n.DISMISS_FLAG]),!s){var a=this.getLicenseInfoText(i,n.DISPLAY_NAME,n.DISPLAY_CLASS);return this.createLicenseBanner("info",a,n.DISMISS_FLAG)}}},removeAllLicenseInfoFlags:function(){c.hasLocalStorage()&&$.each(this.LICENSE_INFO_CATEGORIES,function(e,t){localStorage.removeItem(t.DISMISS_FLAG)})},getLicenseInfoText:function(e,t,i){var n;switch(e){case"starter_xpress":n=this.i18ns("banner_xpress",t);break;default:var s=this.model.getLicenseDaysRemaining(),r=1===s?a.t("AppUtil","dateMetric.day_singular"):a.t("AppUtil","dateMetric.day_plural");n=this.i18ns("banner_pro_trial",t,s,r)}return n},violatedFeatureLicense:function(e,t,i){return!this.model.canUseFeat(e,t,i)},getAllFeatureAllowances:function(e,t){var i=this.model.getFeatureAllowanceMap(e,t);r.isMulticlusterUI()&&(i=_.filter(i,function(e,t){return-1===u.LICENSE_HIDDEN_FEATURE.indexOf(t)}));var n=_.map(i,function(e,t){var i=e[o.ALLOWANCES_TYPE];return i===o.ALLOWANCE_TYPE_LIST.BOOLEAN?{key:t,featureName:e.displayName||t,details:e.boolValue.boolValue?u.LABEL_YES:u.LABEL_NO,enabled:void 0===e.enabled?u.LABEL_YES:e.enabled?u.LABEL_YES:u.LABEL_NO}:i===o.ALLOWANCE_TYPE_LIST.INTEGER_LIST?{key:t,featureName:e.displayName||t,details:e.intValues.length?e.intValues[0].intValue:u.LICENSE_UNLIMITED,enabled:void 0===e.enabled?u.LABEL_YES:e.enabled?u.LABEL_YES:u.LABEL_NO}:void 0},this);return _.sortBy(n,function(e){return e.featureName})},getAllFeatureAllowancesGroupByDetails:function(e,t){var i=this.getAllFeatureAllowances(e,t),n=_.groupBy(i,function(e,t){return"number"==typeof e.details?u.LABEL_YES:e.details});return _.sortBy(n,function(e,t){return t===u.LABEL_YES?1:2})},getPopupMessageTemplate:function(e,t){return e=$.extend({},{showDetails:!0},e),t||T({msg:this.i18n("popup_boolean_violation_message")})},getLimitPopupMessageTemplate:function(e,t){var i=this.model.getFeatureAllowance(e.id),n=i[o.ALLOWANCE_INT_VALUES][0][o.ALLOWANCE_INT_VALUE];if(e.id===this.FEATURE_MAP.LICENSE_MAX_REPLICATION_FACTOR.id)return T({msg:this.i18ns("popup_rf_limit_violation_message",n)});var s=u.ENTITY_NAMES[t]+"(s)";return T({msg:this.i18ns("popup_limit_violation_message",n,s)})},_buildNotificationAlert:function(e){var t=e.getLicenseDaysRemaining(),i=e.getFeatureViolations(),n=e.getLicenseCalmMessage(),s=e.getCategory(),a=void 0;if(e.isInStandbyMode())a=this.createLicenseBanner("info",this.i18n("standby_mode"),"",this.i18n("fixAction"),"completeLicense");else if(this.isStarterViolation(s))a=this.createLicenseBanner("error",this.i18n("starterViolation"),"",this.i18n("licenseNow"));else if(i.length){var r=1===i.length?this.i18n("default_violation"):this.i18n("multiple_violation");a=this.createLicenseBanner("error",r)}else if(n){var o=this.i18n("calm_violation");a=this.createLicenseBanner("error",o)}else if(this.model.isGeneralLicensesExpired()||t<0)a=e.isNodeEnabled()?this.createLicenseBanner("error",this.i18n("expired_licenses")):this.createLicenseBanner("error",this.i18n("clusterExpired"));else if(t<d){var l=1===t?this.i18n("expiring_today_license"):this.i18ns("expiring_license",t);a=this.createLicenseBanner("error",l)}else this.model.isVDIEnabled()?a=this.createLicenseInfoBanner():e.hasUnlicensedNodes()?a=this.createLicenseBanner("error",this.i18n("invalid_nodes")):e.hasUnlicensedCapacity()>0&&(a=this.createLicenseBanner("error",this.i18n("capacityViolation"),"",this.i18n("licenseNow")));return e.isNodeEnabled()||(s?e.hasUnlicensedCapacity()>0&&(a=this.createLicenseBanner("error",this.i18n("capacityViolation"),"",this.i18n("licenseNow"))):a=this.createLicenseBanner("error",this.i18n("clusterUnlicensed"),"",this.i18n("licenseNow"))),a},isThirdPartyCluster:function(){if(r.isMulticlusterUI())return!1;var e=r.getCurrentClusterModel().getModelVersions();return!_.any(e,function(e){return h.test(e[0])})},isStarterViolation:function(e){return!((e=e||this.model.getCategory())!==u.LICENSE_TYPES.STARTER||r.isMulticlusterUI()||this.model.isOfClass(u.LICENSE_CLASSES.APPLIANCE)||this.model.isOfClass(u.LICENSE_CLASSES.XPRESS)||this.model.isABLEnabled()||this.model.isCoinEnabled())},isAOSUnlicensed:function(){return this.model.isOfClass(u.LICENSE_CLASSES.APPLIANCE)?this.model.isOfCategory(u.LICENSE_TYPES.STARTER):!!this.model.isOfClass(u.LICENSE_CLASSES.SOFTWARE_ONLY)&&(this.isStarterViolation()||!this.model.hasGeneralLicense())},isPrismProFeaturesEnabled:function(){var e=this.model.isOfClass(u.LICENSE_CLASSES.PRISM_CENTRAL),t=this.model.isFeatureEnabled();return e&&t},hasXPressLicense:function(){return this.model.isOfClass(u.LICENSE_CLASSES.XPRESS)},hasFeatureViolations:function(e){return!!this.model.getFeatureViolations(e).length},hasAddonFeatureViolations:function(){var e=this.model.getAddonListGroupByType();return _.any(e,function(e,t){return this.hasFeatureViolations(t)},this)},checkClusterLicensing:function(){var e=this._buildNotificationAlert(this.model);e&&n.showNotificationBar(e,u.NOTIFICATION_BAR.LICENSING,!0)},canUseFeat:function(e,t,i){return this.model.canUseFeat(e,t,i)},getFeatInfo:function(e){return{denied:!(this.isPrismProFeaturesEnabled()||this.canUseFeat(e)),minLevel:this.LICENSE_LEVEL.PRO,message:this.i18ns("feat_unavailable_msg",this.LICENSE_LEVEL.PRO)}},createLicenseBanner:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",n=arguments[3],s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",a="info"===e?"-blue":"-red";return a+=i?" dismissOnClose":"",p({bannerLinkText:n||this.i18n("view_details"),bannerText:t,dismissFlag:i,extraClass:s,classes:a})},getClusterLicenseClass:function(){return r.isMulticlusterUI()?u.LICENSE_CLASSES.PRISM_CENTRAL:this.model.isCoinEnabled()?u.LICENSE_CLASSES.SOFTWARE_ONLY:this.model.getLicenseClass()},onClickLicenseLink:function(e){0!==$("#globalModalContainer .modal:visible").length&&$("#globalModalContainer .modal:visible .modal-header .close").trigger("click");var t=$(e.target).hasClass("completeLicense");s.executeAction({action:u.ACTION_SHOW,actionTarget:u.ENTITY_LICENSING},{completeLicensing:t})},onLicenseError:function(){this.appRendered&&n.showNotificationBar(this.i18n("license_fetch_failure"),u.NOTIFICATION_BAR.LICENSE_FETCH_FAILURE,!1)},onAppRender:function(){this.appRendered=!0,this.model.getState()===u.STATE_ERROR&&this.onLicenseError(),this.checkClusterLicensing()},onLicenseChange:function(){this.FEAT_MAP=this.model.getFeatureMap(),this.FEATURE_MAP=this.FEAT_MAP}})}),define("models/task/IntentTaskPollModel",["models/BaseModel","data/DataURLConstants","utils/AppConstants"],function(e,t,i){"use strict";return e.extend({namenameAttribute:"IntentTaskPollModel",entityType:i.ENTITY_TASK,urlRoot:t.TASKS_POLL,isV3API:!0,enableNotifications:!1,pollDuration:1,retryPeriod:10,poll:function(e,t){if(e){var i=$.Deferred();return this._poll(e,t,i),i.promise()}},_poll:function(e,t,n){var s=this;this._pollForTask(e).then(function(e){n.resolve(e)}).fail(function(){--t?setTimeout(function(){s._poll(e,t,n)},s.retryPeriod*i.MILLIS_PER_SECOND):n.reject()})},_pollForTask:function(e){var t=$.Deferred();return this.save({poll_timeout_seconds:this.pollDuration,task_uuid_list:[e]}).then(function(e){e&&e.length?t.resolve(_.first(e)):t.reject()}),t.promise()}})}),define("models/task/TaskServiceModel",["models/task/TaskModel","data/DataURLConstants","data/DataProperties","utils/AppConstants","utils/AppUtil","utils/TimeUtil"],function(e,t,i,n,s,a){"use strict";var r=["BIOS","BMC","CPS","CVM","DPM","DSC","DVM","HA","NCC","NDFS","NFS","NIC","OM","SMA","SPF","SQL","SSD","VG","VM","VMM","WAP","WSUS","LCM","PC","SSP"],o=e.extend({DEFAULT_TIMEOUT:30,urlRoot:t.TASK,name:"TaskServiceModel",entityType:n.ENTITY_TASK,_operationTitle:null,_taskName:null,subTasksEntityMap:null,getEntitySubTasksMap:function(){var e={};return this.get(i.TASK_SUB_TASKS)?(_.each(this.get(i.TASK_SUB_TASKS),function(t){var n=t[i.TASK_ENTITY_ID];_.each(n,function(i){e[i]=new o(t)},this)},this),e):e},getValue:function(t){var s;switch(t){case i.TASK_TYPE:s=this.getTaskOperationType();break;case i.TASK_NAME:s=this.getTaskName();break;case i.TASK_DURATION:s=this.getDurationTime();break;case i.TASK_CLUSTER_NAME:s=this.getClusterName();break;case i.TASK_END_TIME:case i.TASK_START_TIME:case i.TASK_CREATE_TIME:var r=this.get(t);s=r?a.formatLocaleDateTime(r/1e3):n.INVALID_STRING;break;case i.TASK_ENTITY_TYPE:case i.TASK_ENTITY_ID:var o=this.get(t);s=_.isArray(o)?o.join(","):o;break;case i.TASK_DISPLAY_NAME:s=this.getTaskDisplayName();break;default:s=e.prototype.getValue.apply(this,arguments)}return s},hasDrilldown:function(){return _.isArray(this.get(i.TASK_SUB_TASK_UUIDS))},getTaskOperationType:function(){if(this.isFanOut()){var e=this.get(i.TASK_SUBTASK_OPERATION)||this.get(i.TASK_TYPE);return n.TASK_FANOUT_LABEL+" "+this.interpretTaskOperationType(e)}return this.isOldTask()?this.get(i.TASK_NAME):this.interpretTaskOperationType(this.get(i.TASK_TYPE))},interpretTask:function(e){var t;e=e||"","k"===e.charAt(0)&&(e=e.substr(1)),_.each(r,function(t){e=e.replace(new RegExp(t,"g"),s.toUpperCaseFirstChar(t))},this),e=s.insertSpaceCamelOrSnakeCase(e),e=e.replace(/\s+/g," "),e=s.toUpperCaseFirstChar(e);for(var i=0;i<r.length;i++)t=r[i],e=e.replace(new RegExp("\\s("+t+")\\s","gi")," "+t+" "),e=e.replace(new RegExp("\\s("+t+")","gi")," "+t),e=e.replace(new RegExp("^("+t+")\\s","gi"),t+" ");return e},interpretTaskName:function(e){return this._taskName?this._taskName:(e=this.interpretTask(e),this._taskName=e,e)},interpretTaskOperationType:function(e){return this._operationTitle?this._operationTitle:(e=this.interpretTask(e),this._operationTitle=e,e)},getTaskName:function(){var e=this.get(i.TASK_NAME);return e?s.hasWhiteSpace(e)?e:this.interpretTaskName(e):this.getTaskOperationType()},getTaskDisplayName:function(){return this.get(i.TASK_DISPLAY_NAME)||this.getTaskName()||this.getTaskOperationType()},getTaskMessageSummary:function(){var e=this.getTaskDisplayName()||this.getTaskName(),t=this.getTaskOperationType();return this.isFanOut()&&e!==t?t+" "+e:e},getNumberOfEntities:function(){var e=this.get(i.TASK_ENTITY_TYPE);return _.isArray(e)&&e.length?e.length:_.isString(e)?e.split(",").length:0},getEntityTypeLabel:function(){var e,t=this.get(i.TASK_ENTITY_TYPE),a=this.getNumberOfEntities();if(_.isString(t)&&(t=t.split(",")),_.isArray(t)&&t.length){e=t[0],a=t.length;for(var r=!0,o=0;o<a;o++)if(t[o]!==e){r=!1;break}if(!r)return null}else e=n.ENTITY_GENERIC;return s.getEntityNameFromCount(e,a)},getTaskEntityDetails:function(){var e=this.getNumberOfEntities();if(e>0){var t=this.getEntityTypeLabel();return t?e+" "+t:n.TASK_LABEL_DETAILS}return null},getTaskEntityIds:function(){var e=this.get(i.TASK_ENTITY_TYPE),t=this.get(i.TASK_ENTITY_ID),n={};return t&&_.each(e,function(e,i){n[e]||(n[e]=[]),n[e].push(t[i])}),n},hasEntityType:function(e){return _.contains(this.get(i.TASK_ENTITY_TYPE),e)},containsEntityId:function(e){var t=this.get(i.TASK_ENTITY_ID);return _.contains(t,e)}});return o}),define("models/task/TaskServiceCollection",["models/task/TaskCollection","models/task/TaskServiceModel","data/DataURLConstants","utils/AppConstants"],function(e,t,i,n){"use strict";return e.extend({DEFAULT_TIMEOUT:30,model:t,url:i.TASK,name:"TaskServiceCollection",initialize:function(t,i){e.prototype.initialize.apply(this,arguments),this.setCount(n.TASK_MAX_TOTAL_COUNT),this.setPage(1)},setIncludeSubTaskList:function(e){this._parameters=this._parameters||{},this._parameters[n.TASK_PARAM.HAS_SUBTASK_DETAIL]=e},checkTaskStatus:function(e){var t,i,n=this.intervalTimeInMilliSec;e.timeoutSec=e.timeoutSec||this.DEFAULT_TIMEOUT;var s=e.success;e.callSuccessWhenComplete;e.success=function(t,a){var r=t.findModelById(e.taskId);r&&r.isTaskCompleted()&&(t.updateIntervalTime(n),clearTimeout(i),t.off("reset",e.success,this),s&&s(r,a,e))},this.on("reset",e.success,this),t=2,e.pollingSec>t&&(t=e.pollingSec),t*=1e3,this.setIncludeSubTaskList(!0),this.updateIntervalTime(t);var a=this;i=setTimeout(function(){a.updateIntervalTime(n),clearTimeout(i),a.off("reset",e.success,this),e.timeoutCB&&e.timeoutCB("Timeout waiting for taskId:"+e.taskId+" to complete")},1e3*e.timeoutSec)},getFilterCriteriaForDiff:function(){var t=e.prototype.getFilterCriteriaForDiff.apply(this,arguments),i="internal_task==false;(display_failures==[no_val],display_failures==true,(display_failures==false;status!=kFailed))";return t?i+";"+t:i}})}),define("models/intent/IntentDataFetchModel",["managers/IntentManager","models/BaseModel","data/DataProperties","utils/AppConstants","utils/AppUtil","events/AppEvents"],function(e,t,i,n,s,a){"use strict";var r=void 0;return t.extend({name:"IntentDataFetchModel",enableNotifications:!1,failedEntities:[],fetchedEntities:[],dataObject:null,defaults:{actionRoute:null,urls:null,entityListToFetch:null,includeKind:!1},DP:{TOTAL_MATCHES:"total_matches"},initialize:function(i){t.prototype.initialize.apply(this,arguments),e=require("managers/IntentManager"),r=require("managers/BatchManager"),this.dataObject=e.initializeDataObject()},fetch:function(){var t=this;return new Promise(function(i){var n=[];e._isBatchRequest(t.get("actionRoute"))&&n.push(t.getBatchPromise()),n.push(t.getUrlsFetchPromise()),Promise.all(n).then(function(){t.handleFetchError(),s.debugObject("IntentManager : dataObject: ",t.dataObject),t.isAllEntitiesFailed()||i(t.dataObject)})})},getBatchPromise:function(){var e=this,t=this.get("actionRoute");return new Promise(function(n){var o=t.actionTargetId?t.actionTargetId.split(","):null;e.batchFetchEntities(t,o,function(o){e.dataObject.batch_entities=[];var l=[];_.each(o[r.DP.API_RESPONSE_LIST],function(n){var a=n[r.DP.RESPONSE.API_RESPONSE],o=a&&a[r.DP.RESPONSE.STATUS],c=o&&o[i.INTENT_STATE],u=t.actionTarget,d=s.getEntityTypeIntent(u),h=s.isIntentStateIncomplete(d,c);c&&h?l.push(a):e.dataObject.batch_entities.push(a)});var c=[];if(l.length&&c.push(e.i18n("error_messages.incomplete_entities")),!_.isEmpty(c)){var u=c.join(" ");s.log("IntentDataFetchModel.getBatchPromise: "+u),a.triggerAppEvent(a.INTENT_FETCH_ERROR,u)}n()})})},batchFetchEntities:function(t,i,o){var l=this,c=r.createBatchRequestObj(),u=s.getEntityTypeIntent(t[n.NAV_ACTION_TARGET]),d=e.getURLObject(u,e.SWAGGER_REST.GET,{includeUuid:!0}),h=d.url;return _.each(i,function(t){var i=h.replace(e.SWAGGER_PROPERTIES.UUID,t),n=r.createRequest(e.SWAGGER_REST.GET,i);c[r.DP.API_REQUEST_LIST].push(n)}),r.performBatch({requestBody:c,success:o,error:function(){s.log("IntentManager : batchFetchEntities: Failed to fetch all the required intent entities."),a.triggerAppEvent(a.INTENT_FETCH_ERROR,l.i18n("error_messages.entity_fetch_error"))}})},getUrlsFetchPromise:function(){var e=this,t=[];return _.each(this.get("urls"),function(i){t.push(e.getUrlFetchPromise(i))}),new Promise(function(e){Promise.all(t).then(function(){e()})})},getUrlFetchPromise:function(e){var t=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return new Promise(function(n){var s=t.getUrlRequestParams({urlObject:e,page:i});return s.success=function(a,r,o){if(t.appendResponse(o),!t.isRequestNeedNextPage(a,s.dataObject))return void n();var l=[t.getUrlFetchPromise(e,i+1)];Promise.all(l).then(function(){n()})},s.error=function(e,t,i){var s=e&&e.responseText;a.triggerAppEvent(a.INTENT_FETCH_ERROR,s),n()},$.ajax(s),!1})},isAllEntitiesFailed:function(){return this.fetchedEntities.length>0&&this.failedEntities.length===this.fetchedEntities.length},addFailedEntityType:function(e){this.failedEntities.indexOf(e)<0&&this.failedEntities.push(e)},addFetchedEntityType:function(e){this.fetchedEntities.indexOf(e)<0&&this.fetchedEntities.push(e)},isEntityBeingFetched:function(){var t=this.get("actionRoute");return!!_.isObject(t)&&(e._isUpdateOrFetch(t)&&!e._isBatchRequest(t)&&e.getUrlObjectUsingActionRoute(t))},appendResponse:function(t,i){var n="rejected"===t.state(),a=this.get("actionRoute"),r=e.convertToJSON(e.getResponseText(t));if(i||(i=s.getObjectArrayPathValue(r,[e.SWAGGER_PROPERTIES.PROP_METADATA,e.SWAGGER_PROPERTIES.KIND])),this.isEntityBeingFetched()&&r[e.SWAGGER_PROPERTIES.PROP_STATUS])return this.dataObject.entity=r,i=a.actionTarget,this.addFetchedEntityType(i),void(n&&this.addFailedEntityType(i));if(_.isString(i))if(this.dataObject[i]=this.dataObject[i]||{},this.addFetchedEntityType(i),n)this.addFailedEntityType(i),s.log("IntentManager : _fetchIntentData: Failure in fetching "+i);else if(_.isEmpty(this.dataObject[i]))this.dataObject[i]=r;else if(_.isArray(r.entities)){var o=this.dataObject[i];o.entities=o.entities.concat(r.entities)}},handleFetchError:function(){var e;if(this.isAllEntitiesFailed())s.log("IntentManager : _fetchIntentData: Failed to fetch ALL the required intent entities."),e=this.i18ns("error_messages.generic_fetch");else if(0!==this.failedEntities.length){var t=[];_.each(this.failedEntities,function(e){t.push(s.getSingularEntityName(e))}),e=this.i18ns("error_messages.entity_fetch",t.join(", "))}e&&a.triggerAppEvent(a.INTENT_FETCH_ERROR,e)},isRequestNeedNextPage:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return i.length+i.offset<s.getObjectArrayPathValue(t,[e.SWAGGER_PROPERTIES.PROP_METADATA,this.DP.TOTAL_MATCHES])},getUrlRequestParams:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=e.getDataURL(t.urlObject.url),a={type:t.urlObject.method,url:s.cacheBustURL(i),contentType:"application/json"};return t.urlObject.method!==n.HTTP_METHOD.GET&&(a.dataObject=e.getEntitiesRequest(t.urlObject,this.get("includeKind"),{page:t.page}),a.data=JSON.stringify(a.dataObject)),a}})}),define("managers/IntentManager",["managers/BaseManager","models/intent/IntentDataFetchModel","data/DataURLConstants","data/DataManager","data/DataProperties","utils/AppConstants","utils/AppUtil","utils/ValidationUtil"],function(e,t,i,n,s,a,r,o){"use strict";var l={swagger:null,templates:{popup:{},page:{},list:{}}},c={GET:"get",POST:"post",PUT:"put",DELETE:"delete"},u={V3:"3.0"};return e.extend({name:"IntentManager",_expressionFactory:null,VIEW_TYPE:{POPUP:"popup",PAGE:"page",LIST:"list"},SWAGGER_PROPERTIES:{API_VERSION:"api_version",DEFINITIONS:"#/definitions/",X_KIND:"x-ntnx-kind",X_REF_KEY:"x-ntnx-ref-key",LIST:"/list",UUID:"{uuid}",PROP:"properties",KIND:"kind",KIND_REF_LIST:"kind_reference_list",FILTER:"filter",PROP_SPEC:"spec",PROP_STATUS:"status",PROP_METADATA:"metadata",PROP_SPEC_VERSION:"spec_version",PROP_RESOURCES:"resources",PROP_UUID:"uuid",PROP_NAME:"name",PROP_DESC:"description",PROP_TYPE:"type",OFFSET:"offset",LENGTH:"length",REQUIRED:"required",PROP_STATE:"state",PROP_CATEGORIES:"categories_mapping",USE_CATEGORY_MAP:"use_categories_mapping",PROP_PROJECT_REF:"project_reference",PROP_OWNER_REF:"owner_reference",PROP_CLUSTER_REF:"cluster_reference",CREATE_TIME:"create_time",ENTITY_VERSION:"entity_version",PROP_MESSAGE_LIST:"message_list",PROP_MESSAGE:"message",OPERATION:"operation",PROP_ENTITY_ID:"_entity_id_"},SWAGGER_REST:c,API_VERSION:u,ID_MAPPER:{project:{user:"name"},oauth_client:{uuid:"client_id"},directory_service:{user:"name"}},initialize:function(){this.addToManagerHelper()},initializeDataObject:function(){return{entity:{}}},fetchConfigurations:function(){var e=$.Deferred();if(this.isIntentSwaggerLoaded())e.resolve(l.swagger);else{var t=function(){e.resolve(l.swagger)};this.loadIntentAPIObject(t)}return e.promise()},setQueryFactory:function(e){this._expressionFactory=e},getQueryFactory:function(){
return this._expressionFactory},loadIntentAPIObject:function(e,t,n){n=n||this.VIEW_TYPE.POPUP;var s=[];if(this.isIntentSwaggerLoaded()||s.push(i.INTENT_SWAGGER),t){t.generateTemplate||this.isTemplateLoaded(t,n)||s.push(this._getTemplateUrl(t,n))}0===s.length&&_.isFunction(e)?e():this._fetchIntentAPIObject(t,n,e,s)},_getTemplateUrl:function(e,t){var n=r.getEntityTypeIntent(e[a.NAV_ACTION_TARGET]),s=(e[a.NAV_ACTION_ID],this.getInnerTemplate(e));return s?i.INNER_INTENT_TEMPLATE({entityType:n,viewType:t,action:s}):i.INTENT_TEMPLATE({entityType:n,viewType:t})},getInnerTemplate:function(e){return e=e||{},e[a.NAV_ACTION_INNER_TEMPLATE]},_fetchIntentAPIObject:function(e,t,i,n){var s;e&&(s=r.getEntityTypeIntent(e[a.NAV_ACTION_TARGET]),e[a.NAV_ACTION_ID]);var o=[];_.each(n,function(e){o.push($.ajax(r.cacheBustURL(e)))});var c=this;$.whenAll.apply($,o).done(function(){l.templates[t][s]=l.templates[t][s]||{};var r;2===n.length?(l.swagger=c.convertToJSON(c.getResponseText(o[0])),r=c.getInnerTemplate(e),r?l.templates[t][s][r]=c.convertToTemplate(c.getResponseText(o[1])):l.templates[t][s][a.INTENT_TEMPLATE_DEFAULT_ACTION]=c.convertToTemplate(c.getResponseText(o[1]))):c.isIntentSwaggerLoaded()?(r=c.getInnerTemplate(e),r?l.templates[t][s][r]=c.convertToTemplate(c.getResponseText(o[0])):l.templates[t][s][a.INTENT_TEMPLATE_DEFAULT_ACTION]=c.convertToTemplate(c.getResponseText(o[0]))):l.swagger=c.convertToJSON(c.getResponseText(o[0])),_.isFunction(i)&&i()})},getEntityDefinition:function(e,t,i){if(this.isIntentSwaggerLoaded()){var n=r.getEntityTypeIntent(e);n&&0===n.indexOf(this.SWAGGER_PROPERTIES.DEFINITIONS)&&(n=n.replace(this.SWAGGER_PROPERTIES.DEFINITIONS,""));var s;if(t&&(s=this.getDefinitionWithAction(n,t,i)),s||(s=l.swagger.definitions[n]),!s)throw new Error("Invalid entityType finding defintion: "+e);return s}},getDefinitionWithAction:function(e,t,i){var n,s=this.getMethod(t);t&&-1!==t.indexOf(a.ACTION_UPDATE)&&(n={includeUuid:!0}),i&&(n={swaggerPath:i});var r=this.getURLObject(e,s,n);if(r&&r.object){var o,l,c=r.object;if(s===this.SWAGGER_REST.GET&&c.responses[200]?o=c.responses[200]:c.parameters&&c.parameters.length&&(o=_.find(c.parameters,function(e){if(e.in&&"body"===e.in)return!0})),o&&o.schema)return l=o.schema.$ref,this.getEntityDefinition(l)}},getAPIVersion:function(){if(this.isIntentSwaggerLoaded())return l.swagger.info.version},getIntentErrorMsg:function(e){var t="";if(e){var i=e[this.SWAGGER_PROPERTIES.PROP_STATUS];if(i){var n=i[this.PROP_MESSAGE];if(n)return n;var s=i[this.SWAGGER_PROPERTIES.PROP_MESSAGE_LIST];_.isArray(s)&&_.each(s,function(e){_.isArray(e.details)?_.each(e.details,function(e){t+=e+". "}):_.isString(e.details)?t+=e.details+". "+(e.reason||""):_.isString(e.message)&&(t+=e.message+". ")})}}return t},loadEntityAndIntentData:function(e,t,i,n,s){var r=[],o=this._isBatchRequest(i);if(this._isUpdateOrFetch(i)&&!o){var l=_.clone(i);l.action=a.ACTION_FETCH;var c=this.getUrlObjectUsingActionRoute(l);this.entityBeingFetched=!0,c?r.push(c):this.entityBeingFetched=!1}var u=void 0;t&&t.length&&(u=[],_.each(t,function(e){var t=this._expressionFactory.removeFilterName(e),i=this.getFetchURLObject(t,n);if(i){var s=_.clone(i),o=this._expressionFactory.getFilterName(e);s.filterExpression=this._expressionFactory.getFilterExpression(o,!0),r.push(s),u.push(t)}else this.getNotificationManager().showClientNotification(a.NOTIFY_ERROR,"Path is not present for "+t+" in the swagger file.")},this)),o||0!==r.length?this._fetchIntentData(i,e,r,u,s):e()},getEntitiesRequest:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n={};if(e.method!==this.SWAGGER_REST.GET&&e.method!==this.SWAGGER_REST.DELETE&&e.kind&&!1!==t&&(n[this.SWAGGER_PROPERTIES.KIND]=e.kind),e.url&&-1!==e.url.indexOf(this.SWAGGER_PROPERTIES.LIST)&&e.method===this.SWAGGER_REST.POST){var s=i.limit||a.DEFAULT_INTENT_NUM_LIST_RESULTS;n[this.SWAGGER_PROPERTIES.LENGTH]=s;var r=0;_.isNumber(i.page)&&i.page>1&&(r=(parseInt(i.page,10)-1)*s),n[this.SWAGGER_PROPERTIES.OFFSET]=r}return e.filterExpression&&(n.filter=e.filterExpression),e.data&&_.extend(n,e.data),n},_fetchIntentData:function(e,i,n,s,a){new t({actionRoute:e,urls:n,entityListToFetch:s,includeKind:a}).fetch().then(function(e){i(e)})},fetchEntityList:function(e,t){var i=this;this.isIntentSwaggerLoaded()?i.loadEntityAndIntentData(e,t):this.loadIntentAPIObject(function(){i.loadEntityAndIntentData(e,t)})},fetchEntity:function(e,t,i){var n=this,s={};s[a.NAV_ACTION]=a.ACTION_FETCH,s[a.NAV_ACTION_TARGET]=t,s[a.NAV_ACTION_TARGET_ID]=i,this.isIntentSwaggerLoaded()?n.loadEntityAndIntentData(e,null,s):this.loadIntentAPIObject(function(){n.loadEntityAndIntentData(e,null,s)})},mergeEntityWithViewModel:function(e,t){var i=this.SWAGGER_PROPERTIES;if(t=t||{},!_.isEmpty(e)){t[i.PROP_SPEC]=t[i.PROP_SPEC]||{};var n=e[i.PROP_STATUS],a=e[i.PROP_SPEC];e[i.API_VERSION]&&(t[i.API_VERSION]=e[i.API_VERSION]);var o=e[i.PROP_METADATA],l=t[i.PROP_METADATA]||{};l=$.extend(!0,{},o,l);var c=r.getObjectArrayPathValue(t,[i.PROP_METADATA,i.PROP_CATEGORIES]);c&&(l[i.PROP_CATEGORIES]=c),delete l[i.CREATE_TIME],delete l[i.ENTITY_VERSION];var u=t[i.PROP_SPEC],d=l[i.KIND],h=void 0;n&&n[i.PROP_RESOURCES]?h=r.isUseSpecEntityType(d)?a:n:a&&a[i.PROP_RESOURCES]&&(h=a),h&&h[i.PROP_RESOURCES]&&delete h[i.PROP_RESOURCES][s.SSP_DISK.BOOT_CONFIG],u=$.extend(!0,{},h,u),t[i.PROP_METADATA]=l;var p=t[i.PROP_SPEC][i.PROP_RESOURCES],T=u[i.PROP_RESOURCES];p&&T[s.SSP_DISK.DISK_LIST]&&p[s.SSP_DISK.DISK_LIST]&&(T[s.SSP_DISK.DISK_LIST]=p[s.SSP_DISK.DISK_LIST]),p&&T[s.SSP_VM.NIC_LIST]&&p[s.SSP_VM.NIC_LIST]&&(T[s.SSP_VM.NIC_LIST]=p[s.SSP_VM.NIC_LIST]),u=this.pickEntityAttributesFromSwaggerSpec(u,d),t[i.PROP_SPEC]=u}return delete t.status,t},pickEntityAttributesFromSwaggerSpec:function(e,t,i){var n=this.SWAGGER_PROPERTIES,s=this.getEntityDefinition(t,i),a=this.getDetailDefinitionObj(s);i=i||this.SWAGGER_REST.PUT;var r=void 0;return r=a[n.PROP_SPEC]?a[n.PROP_SPEC]:a,this.checkAndMergeResources(e,r)},checkAndMergeResources:function(e,t){if(!t||t&&t[this.SWAGGER_PROPERTIES.PROP_TYPE])return e;if(_.isArray(e)){var i=[];return _.each(e,function(e){i.push(this.checkAndMergeResources(e,t))},this),i}var n={};return _.isObject(e)&&_.each(e,function(e,i){var s=t[i];s&&(n[i]=this.checkAndMergeResources(e,s))},this),r.logObject("IntentManager: checkAndMergeSpecResources: ",n),n},getResponseText:function(e){return 404!==e.status?e.responseText:null},convertToJSON:function(e){try{return JSON.parse(e)}catch(t){return r.log("IntentManager: cannot convert responseText to JSON "+e),null}},convertToTemplate:function(e){try{return e?_.template(e):null}catch(e){throw new Error("Invalid template.")}},isIntentSwaggerLoaded:function(){return _.isObject(l.swagger)},isTemplateLoaded:function(e,t){var i=r.getEntityTypeIntent(e[a.NAV_ACTION_TARGET]),n=(e[a.NAV_ACTION_ID],this.getInnerTemplate(e));return n?_.isObject(l.templates[t][i])&&_.isObject(l.templates[t][i][n]):_.isObject(l.templates[t][i])&&_.isObject(l.templates[t][i][a.INTENT_TEMPLATE_DEFAULT_ACTION])},getTemplate:function(e,t){var i=r.getEntityTypeIntent(e[a.NAV_ACTION_TARGET]);e[a.NAV_ACTION_ID];if(this.isTemplateLoaded(e,t)){var n=this.getInnerTemplate(e);return n?l.templates[t][i][n]:l.templates[t][i][a.INTENT_TEMPLATE_DEFAULT_ACTION]}r.log("IntentManager: configuration cannot be found: "+i)},getDataURL:function(e){return n.getDataSourceURL(n.API_VERSION.V3)+(0===e.indexOf("/")?e.substring(1):e)},getURLObject:function(e,t,n){var s,o=r.getEntityTypeIntent(e);if(n=n||{},!l.swagger)throw new Error("Swagger JSON not loaded yet.");if(_.some(l.swagger.paths,function(r,l){if(s)return!0;var u,d=r[t];if(d&&(u=(d[this.SWAGGER_PROPERTIES.X_KIND]||"").replace("'","").replace("‘","")),d&&u===o){var h;this.ID_MAPPER[e]&&this.ID_MAPPER[e][this.SWAGGER_PROPERTIES.PROP_UUID]&&(h=this.ID_MAPPER[e][this.SWAGGER_PROPERTIES.PROP_UUID]);var p;if(u!==a.ENTITY_CLUSTER){var _=i.CLUSTERS+"/"+this.SWAGGER_PROPERTIES.UUID,T=l.replace(_,"");p=h?T.search(h):T.search(/\{.*uuid}$/i)}if(u===a.ENTITY_PROJECT&&!n.includeList&&t!==c.DELETE&&-1===l.indexOf("projects_internal"))return;if(n.includeUuid&&-1===p||!n.includeUuid&&p>-1)return;if(n.includeList&&-1===l.indexOf(this.SWAGGER_PROPERTIES.LIST)||!n.includeList&&l.indexOf(this.SWAGGER_PROPERTIES.LIST)>-1)return;if(n.swaggerPath&&-1===l.indexOf("/"+n.swaggerPath))return;s={url:l,method:t,kind:d[this.SWAGGER_PROPERTIES.X_KIND],object:d}}},this),s&&s.url){var u=s.url,d=this.getClusterManager().getCurrentClusterUuid(!0),h=i.CLUSTERS+"/"+this.SWAGGER_PROPERTIES.UUID;u.indexOf(h+"/")>-1&&(s.url=u.replace(h,i.CLUSTERS+"/"+d))}return s},getV3SupportedEntitiesList:function(){if(!l.swagger)throw new Error("IntentManager.getV3SupportedEntitiesList:\n            Swagger JSON not loaded yet.");var e=[];return _.each(l.swagger.paths,function(t){_.each(t,function(t){if(t){var i=(t[this.SWAGGER_PROPERTIES.X_KIND]||"").replace("'","").replace("‘","");e.push(i)}},this)},this),_.uniq(e)},getUrlObjectUsingActionRoute:function(e){var t=e[a.NAV_ACTION],i=!1;t!==a.ACTION_CREATE&&(e[a.NAV_ACTION_TARGET_ID]||"").length>0&&(i=!0);var n=this.getMethod(t)||this.SWAGGER_REST.GET,s=r.getEntityTypeIntent(e[a.NAV_ACTION_TARGET]),o=this.getURLObject(s,n,{includeUuid:i,swaggerPath:e[a.NAV_ACTION_SWAGGER_PATH]});return o&&i&&(o.url=this.replaceUuid(o.url,e[a.NAV_ACTION_TARGET_ID])),o},replaceUuid:function(e,t){return-1===e.indexOf(this.SWAGGER_PROPERTIES.PROP_UUID)?e:(e||"").replace(/\{.*?\}/,t)},getFormattedURL:function(e){var t=this.getUrlObjectUsingActionRoute(e);return t&&t.url?this.getDataURL(t.url):(r.log("No url found for ",e),null)},getMethod:function(e){switch(e&&(e=e.split(".")[0]),e){case a.ACTION_CREATE:return this.SWAGGER_REST.POST;case a.ACTION_UPDATE:return this.SWAGGER_REST.PUT;case a.ACTION_DELETE:return this.SWAGGER_REST.DELETE;case a.ACTION_FETCH:case a.ACTION_SHOW:return this.SWAGGER_REST.GET}return e=e||"",e.indexOf("create")>-1?this.SWAGGER_REST.POST:e.indexOf("update")>-1||e.indexOf("edit")>-1?this.SWAGGER_REST.PUT:e.indexOf("delete")>-1?this.SWAGGER_REST.DELETE:void 0},getFetchURLObject:function(e,t){var i;i=this.getURLObject(e,this.SWAGGER_REST.POST,{includeList:!0}),i||(i=this.getURLObject(e,this.SWAGGER_REST.GET,{includeUuid:!1})),i||(i=this.getURLObject(e,this.SWAGGER_REST.POST,{includeList:!0,includeUuid:!0}));var n=this._getDataToSend(e,t);return i&&n&&(i.data=n),i&&n&&n.uuid&&(i.url=this.replaceUuid(i.url,n.uuid),n.uuid=void 0),i},getAttributes:function(e,t){var i=null;if(e&&e.properties){if(!e.properties[t])return e;i=e.properties[t],i.$ref&&(i=this.getEntityDefinition(i.$ref))}return i},getSpecAttributes:function(e){var t=null;if(e&&e.properties){if(!e.properties.spec)return e;t=e.properties.spec,t.$ref&&(t=this.getEntityDefinition(t.$ref))}return t},getDefinitionAttributes:function(e){var t=this.getSpecAttributes(e);if(t&&t.properties&&t.properties.resources){var i=t.properties.resources;return i.$ref&&(i=this.getEntityDefinition(i.$ref)),i}if(e&&e.properties&&!e.properties.spec)return e;throw new Error("The definition object spec is not set yet: ",e)},getDetailDefinitionObj:function(e){if(!e)throw new Error("Invalid definition object "+e);if(e.properties){var t={};return _.each(e.properties,function(e,i){var n=e.$ref||e.items&&e.items.$ref;if(n){var s=this.getEntityDefinition(n);e=this.getDetailDefinitionObj(s)}e.properties&&(e=this.getDetailDefinitionObj(e)),t[i]=e},this),t}return e},getDefinitionAttribute:function(e,t){var i=this.getDefinitionAttributes(e);if(i&&i.properties)return i.properties[t];throw new Error("The definition spec is undefined for "+t)},mapModelToSwagger:function(e,t,i){var n=r.getEntityTypeIntent(e),s={},o=this.getIntentModelProperties(t,!0),l=i?i[a.NAV_ACTION]:null,c=i?i[a.NAV_ACTION_SWAGGER_PATH]:null,u=this.getEntityDefinition(n,l,c),d=this.getSpecAttributes(u)||{},h=d[this.SWAGGER_PROPERTIES.PROP],p={};if(h){h[this.SWAGGER_PROPERTIES.PROP_NAME]&&o[this.SWAGGER_PROPERTIES.PROP_NAME]&&(p[this.SWAGGER_PROPERTIES.PROP_NAME]=o[this.SWAGGER_PROPERTIES.PROP_NAME]),h[this.SWAGGER_PROPERTIES.PROP_DESC]&&o[this.SWAGGER_PROPERTIES.PROP_DESC]&&(p[this.SWAGGER_PROPERTIES.PROP_DESC]=o[this.SWAGGER_PROPERTIES.PROP_DESC]);var T=t[this.SWAGGER_PROPERTIES.PROP_SPEC]||{};_.each(h,function(e,t){t!==this.SWAGGER_PROPERTIES.PROP_NAME&&t!==this.SWAGGER_PROPERTIES.PROP_DESC&&t!==this.SWAGGER_PROPERTIES.PROP_RESOURCES&&T[t]&&(p[t]=T[t])},this)}var E=this.getDefinitionAttributes(u),S=E[this.SWAGGER_PROPERTIES.PROP],g=o[this.SWAGGER_PROPERTIES.PROP_RESOURCES]||{};if(_.each(S,function(t,i){var n=o[i];if(void 0!==n&&t)if("integer"===t.type)n=parseInt(n,10),_.isNaN(n)?r.log(r.sprintf("IntentManager: Failed to assign an non-number to number field %s",i)):g[i]=n;else if("string"===t.type||"boolean"===t.type)g[i]=n;else if("array"===t.type&&"string"===t.items.type)g[i]=_.isArray(n)?n:[n];else if("object"===t.type)if(_.isString(n))try{g[i]=JSON.parse(n)}catch(e){g[i]=n}else g[i]=n;else{var s,a=!1;t.$ref?s=t.$ref:t.items&&t.items.$ref&&(s=t.items.$ref,a=!0);var l=s?this.getEntityDefinition(s):null;if(l&&l.properties&&l.properties.kind){var c=l.properties.kind.default;if(a){var u=[],d=_.isArray(n)?n:[n];_.each(d,function(t){u.push(this.getMetaKindValue(t,e,c))},this),g[i]=u}else g[i]=this.getMetaKindValue(n,e,c)}else g[i]=n}},this),u.properties.spec||u.properties.resources){p[this.SWAGGER_PROPERTIES.PROP_RESOURCES]=g,s[this.SWAGGER_PROPERTIES.PROP_SPEC]=p;var A=t[this.SWAGGER_PROPERTIES.PROP_METADATA]||{};A=_.extend(A,{kind:n}),s[this.SWAGGER_PROPERTIES.PROP_METADATA]=A,s[this.SWAGGER_PROPERTIES.API_VERSION]=this.getAPIVersion()}else s=g;return s},getMetaKindValue:function(e,t,i){if(_.isObject(e)&&!_.isUndefined(e[this.SWAGGER_PROPERTIES.KIND]))return e;var n={},s=this.SWAGGER_PROPERTIES.PROP_UUID;return this.ID_MAPPER[t]&&void 0!==this.ID_MAPPER[t][i]&&(s=this.ID_MAPPER[t][i]),n[s]=e,n[this.SWAGGER_PROPERTIES.KIND]=i,n},_getDataToSend:function(e,t){var i=!_.isEmpty(t),n=_.isArray(t),s=i&&n&&_.find(t,function(t){return!!t[e]});if(s)return s[e]},_isUpdateOrFetch:function(e){return e&&e.action&&(-1!==e.action.indexOf(a.ACTION_UPDATE)||e.action===a.ACTION_FETCH)},_isBatchRequest:function(e){return e&&e.options&&e.options[a.NAV_ACTION_ROUTE_OPTION_BATCH]},getIntentModelProperties:function(e,t){var i,n=e;i=t?e[this.SWAGGER_PROPERTIES.PROP_SPEC]:e[this.SWAGGER_PROPERTIES.PROP_STATUS];var a=e[this.SWAGGER_PROPERTIES.PROP_METADATA];if(i){n=_.pick(i,this.SWAGGER_PROPERTIES.PROP_NAME,this.SWAGGER_PROPERTIES.PROP_DESC),n=_.extend(n,this._getIntentModelReferenceProperties(i[this.SWAGGER_PROPERTIES.PROP_CLUSTER_REF],this.SWAGGER_PROPERTIES.PROP_CLUSTER_REF));var r=i[this.SWAGGER_PROPERTIES.PROP_RESOURCES];r&&(n=_.extend(n,r))}return a&&a[s.UUID]&&(n[s.UUID]=a[s.UUID]),n},_getIntentModelReferenceProperties:function(e,t){var i={};return _.isObject(e)&&!_.isEmpty(e)&&_.each(e,function(e,n){i[t+"."+n]=e}),i},getSpecFromModel:function(e){if(e)return e[this.SWAGGER_PROPERTIES.PROP_SPEC]},getStatusFromModel:function(e){if(e)return e[this.SWAGGER_PROPERTIES.PROP_STATUS]},getMetadataFromModel:function(e){if(e)return e[this.SWAGGER_PROPERTIES.PROP_METADATA]},getUuidFromModel:function(e){return(this.getMetadataFromModel(e)||{})[this.SWAGGER_PROPERTIES.PROP_UUID]},getSpecResourcesFromModel:function(e){var t,i=this.getSpecFromModel(e);return i&&(t=i[this.SWAGGER_PROPERTIES.PROP_RESOURCES]),!t&&e&&(t=e[this.SWAGGER_PROPERTIES.PROP_RESOURCES]),t},getStatusResourcesFromModel:function(e){var t,i=this.getStatusFromModel(e);return i&&(t=i[this.SWAGGER_PROPERTIES.PROP_RESOURCES]),t},getRequiredFields:function(e){if(e)return e[this.SWAGGER_PROPERTIES.REQUIRED]},interpretIntentServerError:function(e,t){var i,n="";return _.isString(e)?e:(i=e&&e.responseText?e.responseText:e,i=r.processSerializedObject(i),_.isObject(i)&&(_.isArray(i.message_list)?_.each(i.message_list,function(e){_.isArray(e.details)||_.isObject(e.details)?_.each(e.details,function(e){_.isArray(e)?n+=e.join(". "):_.isString(e)&&(n+=e),n+=". "}):_.isString(e.details)?n+=e.details+". "+(e.reason||""):_.isString(e.message)&&(n+=e.message)}):_.isArray(i.details)?_.each(i.details,function(e){n+=e+". "}):_.isArray(i.message_list)?_.each(i.message_list,function(e){e.message&&(n+=e.message+". ")}):_.isString(i.details)?n+=i.details+". "+(i.reason||""):n=i.message||""),n||(n=this.i18n("serverError")),n)},validateIntentDataModel:function(e,t){var i=e.toJSON()||{},n=t?t[a.NAV_ACTION]:null,s=e.entityType,r=t?t[a.NAV_ACTION_SWAGGER_PATH]:null;return this.validateIntentPayload(i,s,n,r)},validateIntentPayload:function(e,t,i,n){var s=[],a=this.getEntityDefinition(t,i,n);if(a&&a.properties&&!a.properties.spec&&!a.properties.resources)return s=s.concat(this.getIntentValidationErrors(a,e));var r=this.getSpecAttributes(a),o=this.getSpecFromModel(e);s=s.concat(this.getIntentValidationErrors(r,o));var l=this.getDefinitionAttributes(a),c=this.getSpecResourcesFromModel(e);return s=s.concat(this.getIntentValidationErrors(l,c))},getIntentValidationErrors:function(e,t){var i,n=[];return t=t||{},_.each(this.getRequiredFields(e),function(e){e!==this.SWAGGER_PROPERTIES.PROP_RESOURCES&&(i=o.validate(t[e],o.RULE.REQUIRED),i.valid||(i.attr=e,i.type=o.RULE.REQUIRED,i.intent=!0,n.push(i)))},this),n}})}),define("models/intent/IntentSpecToTaskModel",["models/query/BaseQueryModel","data/DataManager","data/DataProperties","utils/AppConstants","utils/AppUtil","utils/FilterUtil","managers/IntentManager"],function(e,t,i,n,s,a,r){"use strict";var o={UUID:i.UUID,ID:i.ID,KIND:r.SWAGGER_PROPERTIES.KIND,MODIFIED_TIME:i.INTENT_SPEC_ATTR.MODIFIED_TIME,PERCENTAGE_COMPLETE:i.INTENT_SPEC_ATTR.PERCENTAGE_COMPLETE,STATE:i.INTENT_STATE,NAME:i.NAME,VERSION:i.INTENT_SPEC_ATTR.VERSION,CREATED_TIMESTAMP_USECS:i.INTENT_CREATED_TIMESTAMP_USECS,MESSAGE:i.INTENT_TASK.MESSAGE,REASON:i.INTENT_TASK.REASON};return e.extend({name:"IntentSpecModel",_latestModifiedTimeStampInSec:null,_isAllTaskFetched:!1,initialize:function(t){e.prototype.initialize.apply(this,arguments),this.DP=_.extend({},this.DP,o);var i=[o.NAME,o.PERCENTAGE_COMPLETE,o.STATE,o.UUID,o.KIND,o.MODIFIED_TIME,o.VERSION,o.CREATED_TIMESTAMP_USECS,o.MESSAGE,o.REASON],s={};s[this.DP.ENTITY_TYPE]=n.ENTITY_INTENT_SPEC,s[this.DP.GROUP_MEMBER_SORT_ATTRIBUTE]=o.MODIFIED_TIME,s[this.DP.GROUP_MEMBER_SORT_ORDER]=n.SORT_DESCENDING,this.set(s),this.setGroupMemberAttributesList(i)},getDataSourceURL:function(){return t.getDataSourceURL(t.API_VERSION.V3)},fetch:function(t){var i=this.getLatestModifiedTimeStampInSecond(),s={};return s=a.addFilterCondition(s,o.MODIFIED_TIME,a.createFilterCondition(n.ENTITY_INTENT_SPEC,o.MODIFIED_TIME,n.FILTER_OPERATORS.GREATER_OR_EQUAL,i)),this.set(this.DP.FILTER_EXPR,s),this.triggerPendingEvent(t),this.triggerRequestEvent(),this.updateState(n.STATE_PENDING),e.prototype.save.call(this,null,t)},parse:function(t,i){return this._isAllTaskFetched=!0,e.prototype.parse.apply(this,arguments)},isAllTaskFetched:function(){return this._isAllTaskFetched},getLatestModifiedTimeStampInSecond:function(){if(!this._latestModifiedTimeStampInSec){var e=new Date;e.setDate(e.getDate()-2),this._latestModifiedTimeStampInSec=Math.round(e.getTime()/n.MILLIS_PER_SECOND)}if(this.getState()===n.STATE_SUCCESS){var t=this.getQueryResultAttributes(),i=_.max(t,function(e){return e[o.MODIFIED_TIME]}),s=i&&i[o.MODIFIED_TIME];s&&s>this._latestModifiedTimeStampInSec&&(this._latestModifiedTimeStampInSec=s)}return this._latestModifiedTimeStampInSec},getTaskServiceModels:function(){var e=this,t=this.getQueryResultAttributes();return _.map(t,function(t){return e.getTaskServiceModelAttributes(t)})},getTaskServiceModelAttributes:function(e){var t={},a=e[o.STATE],r=e[o.VERSION],l=e[o.KIND],c=e[o.CREATED_TIMESTAMP_USECS],u=e[o.MODIFIED_TIME],d=e[o.PERCENTAGE_COMPLETE],h=s.getSingularEntityName(l);return t[i.TASK_ID]=e[o.UUID],t[i.TASK_NAME]=e[o.NAME],t[i.TASK_STATUS]=s.getTaskStateFromIntentState(a),t[i.TASK_DISPLAY_ERROR]=e[o.MESSAGE]||e[o.REASON],t[i.TASK_PERCENT_COMPLETE]=d,t[i.TASK_TYPE]=s.getActionForIntentSpecEntity(r,a),t[i.TASK_DISPLAY_NAME]=this.getTaskDisplayNameFromIntentAction(a,r,h),t[i.TASK_ENTITY_TYPE]=[l],t[i.TASK_LAST_UPDATE_TIME]=u*n.MICROS_PER_SECOND,t[i.TASK_CREATE_TIME]=c,d&&100===parseInt(d,10)&&(t[i.TASK_END_TIME]=u*n.MICROS_PER_SECOND),t},getTaskDisplayNameFromIntentAction:function(e,t,i){var n=s.getActionForIntentSpecEntity(t,e);return(n=s.toUpperCaseFirstChar(n))+" "+i}})}),define("models/dataprotection/RecoveryPlanJobToTaskModel",["models/query/BaseQueryModel","data/DataManager","data/DataProperties","utils/AppConstants","utils/AppUtil"],function(e,t,i,n,s){"use strict";var a={ID:i.ID,PERCENTAGE_COMPLETE:i.EB.RECOVERY_PLAN_JOB.PERCENTAGE_COMPLETE,STATE:i.EB.RECOVERY_PLAN_JOB.STATUS,NAME:i.NAME,VERSION:i.INTENT_SPEC_ATTR.VERSION,CREATED_TIMESTAMP_USECS:i.INTENT_CREATED_TIMESTAMP_USECS,MESSAGE:i.INTENT_TASK.MESSAGE,REASON:i.INTENT_TASK.REASON,OPERATION_TYPE:i.TASK_OPERATION_TYPE,WARNING_COUNT:i.EB.RECOVERY_PLAN_JOB.WARN_COUNT,ERROR_COUNT:i.EB.RECOVERY_PLAN_JOB.ERR_COUNT,RECOVERY_PLAN_UUID:i.EB.RECOVERY_PLAN_JOB.RECOVERY_PLAN_UUID,END_TIME_SECS:i.EB.RECOVERY_PLAN_JOB.END_TIME_SECS,ENTITY_ID:i.ENTITY_ID_ATTR,RECOVERY_PLAN_NAME:i.EB.RECOVERY_PLAN_JOB.RECOVERY_PLAN_NAME};return e.extend({name:"IntentSpecModel",_isAllTaskFetched:!1,initialize:function(t){e.prototype.initialize.apply(this,arguments),this.DP=_.extend({},this.DP,a);var i=[a.NAME,a.PERCENTAGE_COMPLETE,a.STATE,a.OPERATION_TYPE,a.WARNING_COUNT,a.ERROR_COUNT,a.END_TIME_SECS,a.RECOVERY_PLAN_UUID,a.CREATED_TIMESTAMP_USECS,a.MESSAGE];this.recoveryPlanList=[],this.fetchRPlist();var s={};s[this.DP.ENTITY_TYPE]=n.ENTITY_RECOVERY_PLAN_JOB,this.set(s),this.setGroupMemberAttributesList(i)},getDataSourceURL:function(){return t.getDataSourceURL(t.API_VERSION.V3)},fetch:function(t){return this.fetchRPlist(),this.triggerPendingEvent(t),this.triggerRequestEvent(),this.updateState(n.STATE_PENDING),e.prototype.save.call(this,null,t)},parse:function(t,i){return this._isAllTaskFetched=!0,e.prototype.parse.apply(this,arguments)},isAllTaskFetched:function(){return this._isAllTaskFetched},getTaskServiceModels:function(){var e=this,t=this.getQueryResultAttributes(),i=_.map(t,function(t){return e.getTaskServiceModelAttributes(t)}),n=i.filter(function(e){return e[a.RECOVERY_PLAN_NAME]});return n.sort(function(e,t){return t.createTimeUsecs-e.createTimeUsecs}),n},getTaskServiceModelAttributes:function(e){var t={},r=this.getRPName(e[a.RECOVERY_PLAN_UUID]),o=e[a.STATE],l=e[a.VERSION],c=n.ENTITY_RECOVERY_PLAN_JOB,u=e[a.CREATED_TIMESTAMP_USECS],d=e[a.END_TIME_SECS],h=e[a.PERCENTAGE_COMPLETE];return h&&(h=Number(h)),t[i.TASK_ID]=e[a.ID],t[a.RECOVERY_PLAN_UUID]=e[a.RECOVERY_PLAN_UUID],t[a.RECOVERY_PLAN_NAME]=r,t[i.TASK_DISPLAY_NAME]=this.getTaskDisplayNameFromRPName(r,e[a.OPERATION_TYPE]),t[i.TASK_STATUS]=this.getTaskState(o),t[i.TASK_DISPLAY_ERROR]=e[a.MESSAGE]||e[a.REASON],t[i.TASK_PERCENT_COMPLETE]=h,t[i.TASK_TYPE]=s.getActionForIntentSpecEntity(l,o),t[i.TASK_NAME]=this.getTaskDisplayNameFromRPName(r,e[a.OPERATION_TYPE]),t[i.TASK_ENTITY_TYPE]=[c],t[i.TASK_ENTITY_ID]=[e[a.ENTITY_ID]],t[i.TASK_CREATE_TIME]=u,t[i.TASK_END_TIME]=1e6*d,t[i.TASK_LAST_UPDATE_TIME]=d,t[a.WARNING_COUNT]=e[a.WARNING_COUNT],t[a.ERROR_COUNT]=e[a.ERROR_COUNT],t},getRPName:function(e){var t=void 0;return this.recoveryPlanList.forEach(function(i){i.id===e&&(t=i.name)}),t},fetchRPlist:function(){var t=this;this.rpList=new e(_defineProperty({},i.EB.ENTITY_TYPE,n.ENTITY_RECOVERY_PLAN)),this.rpList.setGroupMemberAttributesList([a.NAME]),this.rpList.save().then(function(e){t.recoveryPlanList=t.rpList.getQueryResultAttributes()})},getTaskDisplayNameFromRPName:function(e,t){var i=n.RECOVERY_PLAN.JOB_TYPES;return e+" ("+[i.VALIDATE,i.MIGRATE,i.FAILOVER,i.FAILBACK,i.TEST_FAILOVER,i.TEST_FAILBACK][t]+")"},getTaskState:function(e){switch(parseInt(e,10)){case 0:case 6:return n.TASK_STATUS_COMPLETE;case 1:return n.TASK_STATUS_ACTIVE;case 2:return n.TASK_STATUS_PAUSED;case 3:return n.TASK_STATUS_ABORTED;case 4:case 7:return n.TASK_STATUS_FAILED;case 5:return n.TASK_STATUS_QUEUED}}})}),define("models/multicluster/TaskMulticlusterCollection",["models/task/TaskServiceCollection","models/task/TaskServiceModel","models/intent/IntentSpecToTaskModel","models/dataprotection/RecoveryPlanJobToTaskModel","data/DataProperties","events/AppEvents","utils/AppConstants","utils/AppUtil"],function(e,t,i,n,s,a,r,o){"use strict";var l=2*r.MILLIS_PER_MINUTE;return e.extend({name:"TaskMulticlusterCollection",clusterUuid:null,model:t,mcTaskCollection:null,fetchOptions:null,totalCountOldTask:0,intentTasks:null,recoveryPlanTasks:null,skipProgressMonitorTask:!1,fetchPending:!1,timeSinceLastSecondaryTaskFetch:0,initialize:function(t,s){e.prototype.initialize.apply(this,arguments),this.clusterUuid="all_clusters",this.skipProgressMonitorTask=s&&s.skipProgressMonitorTask,this.skipProgressMonitorTask?this.intentTasks=new i({}):this.intentTasks=null,this.skipProgressMonitorTask?this.mcTaskCollection=null:(this.mcTaskCollection=new e,this.mcTaskCollection.isMulticlusterVMTask=!0),this.fetchOptions={},this._isAboutToFetchAllTasks=!0,this.recoveryPlanTasks=new n({})},fetch:function(t){var i=this;if(this.fetchPending&&this.deferred)return o.debug("TaskMulticlusterCollection | Fetch Ignored. Current State is pending"),this.deferred.promise();var n=$.Deferred();this.deferred=n,this.fetchPending=!0,t=t||{},t.data=t.data||{},t.data[r.TASK_PARAM.OLD_PROGRESS_ONLY]=!0;var s=[];return this.skipProgressMonitorTask||s.push(this.mcTaskCollection.fetch(this.fetchOptions)),s.push(this.recoveryPlanTasks.fetch()),(t.fetchOnDemand||Date.now()-this.timeSinceLastSecondaryTaskFetch>=l)&&(this.intentTasks&&s.push(this.intentTasks.fetch()),this.skipProgressMonitorTask||s.push(e.prototype.fetch.call(this,t)),this.timeSinceLastSecondaryTaskFetch=Date.now()),$.whenAll.apply($,s).done(function(e,t){i.add(i.getRecoveryPlanTaskServiceModels(i.recoveryPlanTasks),{silent:!0}),i.mcTaskCollection&&(i.mcTaskCollection.restructureModels(),i.add(i.mcTaskCollection.getSummarizedTasks(),{silent:!0})),i.intentTasks&&i.add(i.getIntentSpecTaskServiceModels(i.intentTasks),{silent:!0}),i.triggerUpdate(),i.triggerResetStructure(),i.fetchPending=!1,n.resolve(i,"success")}).fail(function(e,t,s){i.fetchPending=!1,n.reject(e,t,s)}),n.promise()},restructureModels:function(){this.each(function(e){e[s.CLUSTER_UUID]=e.getClusterUuid()})},parse:function(t){var i=[],n=new e;return this.totalCountOldTask=0,_.each(t,function(e,t){var a;_.isArray(e.successResponse)?a=e.successResponse:e.successResponse&&e.successResponse.entities&&(a=e.successResponse.entities),"SUCCESS"===e.type&&a&&a.length&&(n.reset(a,{silent:!0}),n.restructureModels(),_.each(n.getSummarizedTasks(),function(e){e[s.CLUSTER_ID]=t,e.set(s.CLUSTER_UUID,t),e.set(s.TASK_IS_OLD_TASK,!0),i.push(e.toJSON()),this.totalCountOldTask++},this))},this),i},getMetaDataGrandTotalCount:function(){return this.length},fetchOnDemand:function(){this.fetch()},isFirstPass:function(e){return!_.find(this.previousModels,function(t){return t.getClusterUuid()===e.getClusterUuid()&&t.getClusterUuid()===e.getClusterUuid()})},getAllTasks:function(){return this.models},getUpgradeTasks:function(){return _.filter(this.models,function(e){return(e.get(s.TASK_TYPE)===r.TASK_OPERATION_PC_CLUSTER_UPGRADE||e.get(s.TASK_TYPE)===r.TASK_OPERATION_UPGRADE)&&e.isMulticlusterVMTask})},getClusterUpgradeTask:function(){return _.find(this.models,function(e){var t=e.get(s.TASK_TYPE);return(e.isPreupgradeCheckTask()||t===r.TASK_OPERATION_PC_CLUSTER_UPGRADE||t===r.TASK_OPERATION_CLUSTER_UPGRADE)&&e.isMulticlusterVMTask})},hasActiveUpgradeTasks:function(){return!!_.find(this.models,function(e){var t=e.get(s.TASK_TYPE);return!(!e.isPreupgradeCheckTask()&&t!==r.TASK_OPERATION_PC_CLUSTER_UPGRADE&&t!==r.TASK_OPERATION_CLUSTER_UPGRADE||!e.isMulticlusterVMTask)&&(e.isStatusActive()||e.isStatusQueued())})},hasActiveUploadTasks:function(){return!!_.find(this.models,function(e){return!(e.get(s.TASK_TYPE)!==r.ACTION_DOWNLOAD||!e.isMulticlusterVMTask)&&(e.isStatusActive()||e.isStatusQueued())})},triggerUpdate:function(){this.trigger(a.PC_TASK_FETCH,this)},setIncludeSubTaskList:function(e){this.fetchOptions.data=this.fetchOptions.data||{},this.fetchOptions.data[r.TASK_PARAM.HAS_SUBTASK_DETAIL]=e},isTaskLoading:function(){var e=!1;this.intentTasks&&(e=this.intentTasks.getState()===r.STATE_PENDING);var t=!1;return this.recoveryPlanTasks&&(t=this.recoveryPlanTasks.getState()===r.STATE_PENDING),this.skipProgressMonitorTask?e:e||t||this.stateMonitor.getState()===r.STATE_PENDING||this.mcTaskCollection.stateMonitor.getState()===r.STATE_PENDING},isAllTaskFetched:function(){var t=!0;return this.intentTasks&&(t=this.intentTasks.isAllTaskFetched()),this.recoveryPlanTasks&&(t=t&&this.recoveryPlanTasks.isAllTaskFetched()),this.skipProgressMonitorTask||(t=t&&e.prototype.isAllTaskFetched.apply(this,arguments)&&this.mcTaskCollection.isAllTaskFetched()),t},getIntentSpecTaskServiceModels:function(e){var i=e.getTaskServiceModels();return _.map(i,function(e){return new t(e)})},getRecoveryPlanTaskServiceModels:function(e){return e.getTaskServiceModels().map(function(e){return new t(e)})},getScheduleTaskServiceModels:function(e){var i=e.getTaskServiceModels();return _.map(i,function(e){return new t(e)})},forceFetchTasks:function(e,t){e&&t&&this.mcTaskCollection.fetch(e,t)}})}),define("managers/TaskManager",["models/task/IntentTaskPollModel","models/task/TaskCollection","models/task/TaskServiceCollection","models/multicluster/TaskMulticlusterCollection","managers/NamespaceManager","managers/BaseManager","data/DataProperties","utils/AppConstants","utils/AppUtil","utils/HypervisorUtil","utils/FilterUtil","events/AppEvents"],function(e,t,i,n,s,a,r,o,l,c,u,d){"use strict";var h={DOMAIN_JOIN:"nosClusterAndHostsDomainJoined"};return a.extend({name:o.MANAGER.TASK,TASKS:{LABEL_ENTITIES:"Label entities",UPDATE_LABELS:"Update labels"},TASK_TRIGGER_TYPE:{INITIATED:"initiated",CREATED:"created"},TASK_TYPES:{GENERIC:{FANOUT:"fanout"},VM:{POWER_ACTION:"power_action"},LABEL:{ADD_ENTITIES:"add_entities",REMOVE_ENTITIES:"remove_entities"}},SUBTASK_MSGS:{LABEL:{ADD_ENTITIES:"Assign label to entity",REMOVE_ENTITIES:"Remove label from entity"}},SUBTASK_OPERATIONS:{TAG:"Configure",VM:{SET_POWER_STATE:"VmSetPowerState",DELETE:"VmDelete",CREATE:"VmCreate",MIGRATE:"VmMigrate",CLONE:"VmClone"}},TRIGGER_APP_EVENT_OPERATIONS:{entitiesCreated:["create","createVM","VmCreate"],entitiesUpdated:["update","updateVM","VmUpdate","VmSetPowerState","VmChangePowerState"],entitiesDeleted:["delete","deleteVM","VmDelete","DirectConnectVifDelete","ImageDelete"]},OPERATION_ENTITY_TYPES:{DirectConnectVifDelete:o.ENTITY_DIRECT_CONNECT_VIF},TASK_MESSAGES:{success:_.template('Task(s) were successfully completed. Operation: "<%= operation %>"'),error:_.template('There were errors completing task(s). Operation:  "<%= operation %>"'),errorFetch:_.template('Unable to fetch task(s). Operation: "<%= operation %>"'),timeout:_.template('There were timeouts fetching task(s). Operation: "<%= operation %>"'),initiated:_.template("A background task was successfully initiated to <%= operation.toLocaleLowerCase() %>")},MAX_TIME_IN_QUICK_VIEW_USECS:1728e8,SUCCESS_TASKS_IN_QUICK_VIEW_USECS:36e8,MAX_COUNT_QUICK_VIEW:100,MAX_TIME_RUNNING_TASK_USECS:3e8,isMulticlusterMode:!1,taskCollection:null,taskMulticlusterCollection:null,listCallbacksGlobalTaskChange:[],mapChanges:{},_quickViewTasks:[],_runningTasks:[],_newTasksForQuickView:null,hasDisplayedUpgradeWarning:!1,_hasStarted:!1,_taskChangeHandlersById:{},initialize:function(){this.addToManagerHelper(),this.taskCollection=this.getTaskCollection(),this.taskCollection.setIncludeSubTaskList(!1),this.taskCollection.isGlobal=!0,this.taskCollection.setIntervalTime(o.TASK_POLLING_INTERVAL),_.bindAll(this,"fetchOnDemand","getTasksWithChanges","_changedTaskByIdHandler");var e=this;this.taskCollection.on("reset",function(){e.updateFlagForNewQuickTasks(),e.broadcastChanges()})},
getTaskCollection:function(){return new i},refreshViews:function(){},selectTaskIndicatorView:function(e){},initializeMulticlusterTask:function(e){this.isMulticlusterMode=!0,this.taskMulticlusterCollection=new n(null,e),this.taskMulticlusterCollection.setIncludeSubTaskList(!1),this.taskMulticlusterCollection.isGlobal=!0,this.taskMulticlusterCollection.setIntervalTime(o.TASK_POLLING_INTERVAL);var t=this;this.taskMulticlusterCollection.on(d.PC_TASK_FETCH,function(){t.updateFlagForNewQuickTasks(),t.broadcastChanges()})},getTaskMulticlusterCollection:function(){return this.taskMulticlusterCollection},fetchOnDemand:function(){var e,t,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=this.getGlobalTasks();if(n){return _.find(n._clusterUpgradeTaskModels||[],function(e){return e.isFileServerUpgradeTask()})&&(n.setIncludeSubTaskList(!0),t=Math.min(n.latestTimestampValue,1e3*Date.now()-o.RECENT_FILE_SERVER_UPGRADE_TASK_USECS),e=u.filterConditionToFIQL(r.TASK_NEW_LAST_UPDATE_TIME,{op:o.FILTER_OPERATORS.GREATER_THAN,value1:t})),i.fetchOnDemand=!0,n.fetch(i,e)}},fetchTasksOnDemand:function(e,t){t=t||{};var i=e.length,n=[],s=[],a=t.operation,r=this;_.each(e,function(e){r.getGlobalTasks().checkTaskStatus({taskId:e,success:function(e){e.isStatusFailed()?s.push(e):n.push(e),n.length+s.length===i&&(s.length?t.error&&t.error(s,r.TASK_MESSAGES.error({operation:a})):t.success&&t.success(n,r.TASK_MESSAGES.success({operation:a})))},error:function(){t.error&&t.error(null,r.TASK_MESSAGES.errorFetch({operation:a}))},timeout:function(){t.timeout&&t.timeout(r.TASK_MESSAGES.timeout({operation:a}))}})})},getGlobalTasks:function(){return this.isMulticlusterMode?this.taskMulticlusterCollection:this.taskCollection},getOldTasksFromGlobalCollection:function(){return this.getGlobalTasks().getOldTasks()},findRunningTaskByTypeAndEntity:function(e,t,i){var n=this.getGlobalTasks();if(n)return _.find(n.models,function(n){if(!n.isTaskCompleted()&&n.get(r.TASK_TYPE)===e){var s=n.get(r.TASK_ENTITY_TYPE)||[],a=n.get(r.TASK_ENTITY_ID)||[];return _.some(s,function(e,n){return e===t&&a[n]===i})}})},startServices:function(){if(!this._hasStarted){this._hasStarted=!0;var e=this.getGlobalTasks();e&&(e.isPolling()||e.startPolling()),d.onAppEvent(this.TASK_TRIGGER_TYPE.CREATED+this.TASK_TYPES.GENERIC.FANOUT,this.fetchOnDemand),this.postStartServices()}},stopServices:function(){this._hasStarted=!1;var e=this.getGlobalTasks();e&&e.stopPolling(),d.offAppEvent(this.TASK_TRIGGER_TYPE.CREATED+this.TASK_TYPES.GENERIC.FANOUT,this.fetchOnDemand),this.postStopServices()},postStartServices:function(){},postStopServices:function(){},hideProgressMonitorDropdown:function(){$(document).trigger("click")},registerHandlerResetStructure:function(e,t){if(!_.isFunction(e))throw new Error("The callback is not a valid function.");if(!t)throw new Error("The context should not be empty.");var i=this.getGlobalTasks();i&&i.on(d.TASK_RESET_STRUCTURE,e,t)},unregisterHandlerResetStructure:function(e,t){var i=this.getGlobalTasks();i&&i.off(d.TASK_RESET_STRUCTURE,e,t)},broadcastChanges:function(e,t){var i=this.getTasksWithChanges()||[];!0!==e&&0===i.length||(this.updateFlagForNewQuickTasks(!0),_.each(this.listCallbacksGlobalTaskChange,function(e){e(i,t)}),this.broadcastEntityCUDOperations(i))},broadcastEntityCUDOperations:function(e){var t={entitiesCreated:{},entitiesDeleted:{},entitiesUpdated:{}};_.each(e,function(e){var i=e.get(r.TASK_TYPE),n=e.get(r.TASK_ENTITY_ID),s=e.get(r.TASK_ENTITY_TYPE);s=s&&s.length?s[0]:this.OPERATION_ENTITY_TYPES[i]||s,_.each(t,function(a,r){if(i===o.TASK_OPERATION_FANOUT){var l=e.getEntitySubTasksMap();_.isEmpty(l)||this._broadcastEntityCUDFanOutTasks(t,r,l)}else _.contains(this.TRIGGER_APP_EVENT_OPERATIONS[r],i)&&(t[r][s]=t[r][s]||[],t[r][s]=t[r][s].concat(n))},this)},this),_.each(t,function(e,t){_.each(e,function(e,i){d.triggerAppEvent(t,{entityType:i,entityIds:e})},this)},this)},_broadcastEntityCUDFanOutTasks:function(e,t,i){_.each(i,function(i){var n=i.get(r.SUB_TASK_OPERATION);if(_.contains(this.TRIGGER_APP_EVENT_OPERATIONS[t],n)){var s=i.get(r.TASK_ENTITY_ID),a=i.get(r.TASK_ENTITY_TYPE);a=a&&a.length?a[0]:a,a&&(e[t][a]=e[t][a]||[],e[t][a]=e[t][a].concat(s))}},this)},updateFlagForNewQuickTasks:function(e){var t=this;null===t._newTasksForQuickView?t._newTasksForQuickView=!0:_.isBoolean(e)&&(t._newTasksForQuickView=e)},registerHandlerForChangedTasks:function(e){if(!_.isFunction(e))throw new Error("The callback is not a valid function.");_.find(this.listCallbacksGlobalTaskChange,function(t){return e===t})||this.listCallbacksGlobalTaskChange.push(e)},unregisterHandlerForChangedTasks:function(e){this.listCallbacksGlobalTaskChange=_.without(this.listCallbacksGlobalTaskChange,e)},registerHandlerForChangedTaskById:function(e,t){var i=this._changedTaskByIdHandler;_.indexOf(this.listCallbacksGlobalTaskChange,i)<0&&this.registerHandlerForChangedTasks(i),this._taskChangeHandlersById[e]=t},_changedTaskByIdHandler:function(e){var t=this;_.each(e,function(e){var i=t._taskChangeHandlersById[e.getId()];_.isFunction(i)&&i(e)})},unregisterHandlerForChangedTaskById:function(e){this._taskChangeHandlersById[e]&&delete this._taskChangeHandlersById[e],_.isEmpty(this._taskChangeHandlersById)&&this.unregisterHandlerForChangedTasks(this._changedTaskByIdHandler)},triggerTaskAppEvent:function(e,t,i){d.triggerAppEvent(e+t,i)},registerHandlerTaskTriggerType:function(e,t,i){d.onAppEvent(e+t,i)},unregisterHandlerTaskTriggerType:function(e,t,i){d.offAppEvent(e+t,i)},getCurrentTaskState:function(e,t){return this.getGlobalTasks().filter(function(e){var i=e.get(r.TASK_ENTITY_ID);return _.isArray(i)||(i=[i]),_.some(t,function(e){return _.contains(i,e)})})},getTaskById:function(e){return this.getGlobalTasks().find(function(t){return t.getId()===e})},trackTaskStatus:function(e,i){var n=t.extend({getFilterCriteriaForDiff:function(){return u.filterConditionToFIQL(r.UUID,{op:o.FILTER_OPERATORS.EQUALS,value1:e})}}),s=new n,a=_.isNumber(i.intervalTime)?i.intervalTime:5e3;s.setIntervalTime(a);var l=_.isFunction(i.onTaskUpdate)?i.onTaskUpdate:null;return s.on("reset",function(){var e=_.first(s.models);e&&(l&&l(e)||e.isTaskCompleted())&&s.stopPolling()}),s.startPolling(),s},getScheduleTasks:function(){return this.getGlobalTasks().filter(function(e){return e.isScheduleJob()})},getTaskEntityIds:function(){var e={};return this.getGlobalTasks().each(function(t){var i=t.get(r.TASK_ENTITY_TYPE),n=t.get(r.TASK_ENTITY_ID);_.each(n,function(t,n){e[i[n]]?e[i[n]].push(t):e[i[n]]=[t]},this)},this),e},getTasksWithChanges:function(){var e=[];return this.getGlobalTasks().each(function(t){var i=t.getId(),n=this.mapChanges[i],s=!1;n?t.get(r.TASK_PERCENT_COMPLETE)===n[r.TASK_PERCENT_COMPLETE]&&t.get(r.TASK_STATUS)===n[r.TASK_STATUS]||(s=!0):s=!0,s&&(this.mapChanges[i]=this.mapChanges[i]||{},this.mapChanges[i][r.TASK_PERCENT_COMPLETE]=t.get(r.TASK_PERCENT_COMPLETE),this.mapChanges[i][r.TASK_STATUS]=t.get(r.TASK_STATUS),this.isNotFirstTimeToMapChanges&&e.push(t))},this),this.isNotFirstTimeToMapChanges=!0,e},getQuickViewTasks:function(){if(this._newTasksForQuickView){this.updateFlagForNewQuickTasks(!1),this._quickViewTasks=[];var e,t,i=0,n=0,s=0;this._runningTasks=[];for(var a=this.getGlobalTasks().getSummarizedTasks(),c=a.length,u=Date.now(),d=1e3*u,h=0;h<c;h++){e=!1,t=a[h];var p=t.get(r.TASK_END_TIME),_=Math.abs(d-p),T=0;l.hasLocalStorage()&&(T=Number(localStorage.getItem(o.LOCAL_STORAGE.TASK_CLEAN_UP_TIMESTAMP))||0),t.isStatusCategoryRunning()?(e=!0,i++,this._runningTasks.push(t)):t.isStatusCategoryFailed()&&!t.isIgnoreDisplayOnFailure()?_<=this.MAX_TIME_IN_QUICK_VIEW_USECS&&T<p&&(e=!0,s++):t.isStatusCategorySucceeded()&&_<=this.SUCCESS_TASKS_IN_QUICK_VIEW_USECS&&T<p&&(e=!0,n++),e&&this._quickViewTasks.push(t)}}var E=[],S=[];this._quickViewTasks.forEach(function(e){e.get(o.ENTITY_GENERIC)&&e.get(o.ENTITY_GENERIC)[0]===o.ENTITY_RECOVERY_PLAN_JOB?E.push(e):S.push(e)});var g=E.concat(S);return this.hasRecentRunningTask()?this.getGlobalTasks().setIncludeSubTaskList(!0):this.getGlobalTasks().setIncludeSubTaskList(!1),g},getNoTaskActivityMessage:function(e){if(e){var t=Math.round(this.MAX_TIME_IN_QUICK_VIEW_USECS/o.MICROS_PER_HOUR);return this.i18nsStatic("VantagePointProperties","no_task_activity_for_time",t)}return"No task activity."},getRunningTaskByEntityId:function(e){for(var t={},i=this._runningTasks.length,n=e.length,s=0;s<n;s++)for(var a=e[s],o=0;o<i;o++){var l=this._runningTasks[o],c=l.get(r.TASK_ENTITY_ID);if(c&&(_.isString(c)&&(c=c.split(",")),_.contains(c,a))){t[a]=l;break}}return t},hasRecentRunningTask:function(){return _.find(this._runningTasks,function(e){return Date.now()*o.MICROS_PER_MILLI-(e.get(r.TASK_LAST_UPDATE_TIME)||e.get(r.TASK_CREATE_TIME))<this.MAX_TIME_RUNNING_TASK_USECS},this)},getMaxTimeUsecs:function(){return Date.now()*o.MICROS_PER_MILLI-this.MAX_TIME_IN_QUICK_VIEW_USECS},isQuickViewFilterApplicable:function(){var e=s.get(s.PAGE_ROUTE),t=this.getClusterManager().getCurrentClusterModel(),i=!0;if(t){c.hasHyperV(t.get(r.CLUSTER_UUID))&&(i=t.get(h.DOMAIN_JOIN))}return e[o.NAV_PAGE_ID]!==o.PAGE_TASKS&&i},cleanUpCompletedQuickViewTasks:function(e){var t=Date.now()*o.MICROS_PER_MILLI;l.hasLocalStorage()&&localStorage.setItem(o.LOCAL_STORAGE.TASK_CLEAN_UP_TIMESTAMP,t),this.broadcastChanges(!0,e)},pollIntentTask:function(t){if(t){return(new e).poll(t,3)}},displayUpgradeWarning:function(){var e=this;if(!this.hasDisplayedUpgradeWarning){var t=_.find(this.taskCollection.getUpgradeTasks(),function(e){var t=e.get(r.TASK_TYPE);return(e.isStatusActive()||e.isStatusQueued())&&t!==o.TASK_OPERATION_TYPES.ncc&&t!==o.TASK_OPERATION_TYPES.foundation&&t!==o.TASK_OPERATION_TYPES.afs});t=!!t;var i=function(){e.hasDisplayedUpgradeWarning=!0,$.nutanixConfirm({msg:e.i18nStatic("TaskManager","confirm_nos_upgrade_warning_message"),yesText:e.i18nStatic("Common","ok","OK"),hideNo:!0})};t&&(l.hasLocalStorage()?Date.now()-o.MILLIS_PER_DAY>Number(localStorage.getItem("lastUpgradeWarningTime"))&&(localStorage.setItem("lastUpgradeWarningTime",Date.now()),i()):i())}}})}),define("managers/EntityStateTracker",["models/query/BaseQueryModel","data/DataProperties","utils/AppConstants","utils/AppUtil","utils/FilterUtil","events/AppEvents"],function(e,t,i,n,s,a){"use strict";var r=[t.INTENT_TASK.MESSAGE,t.INTENT_TASK.STATE,t.INTENT_TASK.REASON],o=[t.INTENT_TASK.MESSAGE,t.INTENT_TASK.STATE,t.INTENT_TASK.REASON,t.INTENT_TASK.UUID],l={UPDATE:"update",DELETE:"delete"},c={ENTITY_TYPE:"entityType",ENTITY_ID:"entityId",ATTRIBUTES:"attributes",RESULT:"result",CHANGE_TYPE:"changeType",USE_INTENT_SPEC:"useIntentSpec",MESSAGE:"message",TRACK_INFO_ENTITY:"entity",TRACK_INFO_STATE_INFO:"stateInfo"};return{trackedEntities:null,isPolling:!1,pollingIntervalMilliSecs:2e3,queryModelMap:null,DP:c,CONSTANTS:l,intentSpecEntityTypes:null,initialize:function(){this.trackedEntities={},this.queryModelMap={},this.intentSpecEntityTypes=[],_.bind(this._poll,this)},track:function(e,t){var i=this;t=t||{},e=_.isArray(e)?e:[e];var s={},r={},o=[];return _.each(e,function(e){var l=i.getTrackingEntityObject(e,t),u=l[c.ENTITY_ID],d=l[c.ENTITY_TYPE];if(!u||!d)throw new Error("Can't find tracking info for entity");o.push(new Promise(function(t,o){i.addEntity(l);var h=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};d===n.entityType&&_.contains(n.entityIds,u)&&(i.removeEntity({entityType:d,entityId:u}),a.offAppEvent(a.ENTITIES_DELETED,h),s[u]={},t())};a.onAppEvent(a.ENTITIES_DELETED,h);var p=function(o,l){var h=i.findTrackingEntityInResponse(l,u,d);if(h){var _=h[c.RESULT].state,T=n.isIntentStateError(d,_),E=n.isIntentStateComplete(d,_);if(T||E){var S;i.removeEntity({entityType:d,entityId:u}),a.offAppEvent(a.INTENT_ENTITIES_STATE_CHANGED,p);var g=(S={},_defineProperty(S,c.TRACK_INFO_ENTITY,e),_defineProperty(S,c.TRACK_INFO_STATE_INFO,h),S);E?s[u]=g:r[u]=g,t()}}};a.onAppEvent(a.INTENT_ENTITIES_STATE_CHANGED,p)}))}),Promise.all(o).then(function(){if(_.isFunction(t.callback)&&t.callback(s,r),_.isFunction(t.onSuccess)&&!_.isEmpty(s)&&_.isEmpty(r))t.onSuccess(s);else if(_.isFunction(t.onError)&&!_.isEmpty(r)){var e=i.getErrors(r);t.onError(r,e)}}),o.length===e.length},getErrors:function(e){var t=[];return _.each(e,function(e){var i=n.getObjectArrayPathValue(e,[c.TRACK_INFO_STATE_INFO,c.RESULT,c.MESSAGE]);i&&t.push(i)}),t},findTrackingEntityInResponse:function(e,t,i){return _.find(e,function(e){var n=e[c.RESULT]&&e[c.RESULT].uuid===t,s=e.entityId===t,a=!i||i===e.entityType;return(n||s)&&a},this)},getTrackingEntityObject:function(e,t){var i,s=_.isArray(t.entityTypePath)?t.entityTypePath.join("."):null,a=_.isArray(t.entityUuidPath)?t.entityUuidPath.join("."):null;return i={},_defineProperty(i,c.ENTITY_TYPE,s?n.getObjectPathValue(e,s):e[c.ENTITY_TYPE]),_defineProperty(i,c.ENTITY_ID,a?n.getObjectPathValue(e,a):e[c.ENTITY_ID]),_defineProperty(i,c.USE_INTENT_SPEC,_.isBoolean(t.isUseIntentSpec)?t.isUseIntentSpec:e[c.USE_INTENT_SPEC]),i},isIntentSpecEntityType:function(e){return this.intentSpecEntityTypes.indexOf(e)>=0},cleanIntentSpecEntityType:function(e){var t=n.getObjectPathValue(this.trackedEntities,e);t&&!_.isEmpty(t)||(this.intentSpecEntityTypes=_.filter(this.intentSpecEntityTypes,function(t){return t!==e}))},addEntity:function(e){!0!==e[c.USE_INTENT_SPEC]||this.isIntentSpecEntityType(e[c.ENTITY_TYPE])||this.intentSpecEntityTypes.push(e[c.ENTITY_TYPE]);var n=void 0;if(n=!0===e[c.USE_INTENT_SPEC]?o:r,e[c.ATTRIBUTES]=e[c.ATTRIBUTES]||[],e[c.ATTRIBUTES]=_.union(e[c.ATTRIBUTES],n),e[c.ENTITY_TYPE]===i.ENTITY_GPU){var s=e[c.ENTITY_ID].split(i.GRAPH_DATA_SEPARATOR);e[c.ENTITY_ID]=s[0]}var a=this.findEntity(e);if(a)return a[c.ATTRIBUTES]=_.union(a[c.ATTRIBUTES],e[c.ATTRIBUTES]),a;var l={};l[t.INTENT_TASK.STATE]=i.INTENT_RESPONSE_STATUS.PENDING,e[c.RESULT]=l;var u=this.trackedEntities[e[c.ENTITY_TYPE]];return u||(u=this.trackedEntities[e[c.ENTITY_TYPE]]=[]),u.push(e),this._startPolling(),e},addIntentSpecEntity:function(e){return e[c.USE_INTENT_SPEC]=!0,this.addEntity(e)},addIntentSpecEntities:function(e,t,i){i=i||{};var n=_.map(e,function(e){return this.addEntity({entityType:t,entityId:e,options:i[e]||{},useIntentSpec:!0})},this);this._triggerAdded(n)},addEntities:function(e,t,i){i=i||{};var n=_.map(e,function(e){return this.addEntity({entityType:t,entityId:e,options:i[e]||{}})},this);this._triggerAdded(n)},removeEntity:function(e){var t=this.trackedEntities[e[c.ENTITY_TYPE]];if(t){if(t=_.filter(t,function(t){return t[c.ENTITY_ID]!==e[c.ENTITY_ID]}),!t.length)return delete this.trackedEntities[e[c.ENTITY_TYPE]],void this.cleanIntentSpecEntityType(e[c.ENTITY_TYPE]);this.trackedEntities[e[c.ENTITY_TYPE]]=t}},findEntity:function(e){var t=this.trackedEntities[e[c.ENTITY_TYPE]];if(t)return _.find(t,function(t){return t[c.ENTITY_ID]===e[c.ENTITY_ID]})},getTrackedEntityIds:function(e){var t=this.trackedEntities[e]||[];return _.map(t,function(e){return e[c.ENTITY_ID]})},_getEntityAttributes:function(e){var t=this.trackedEntities[e]||[],i=[];return _.each(t,function(e){i=_.union(e[c.ATTRIBUTES],i)}),i},_checkDeletedEntities:function(e,t){var i=this.trackedEntities[t]||[];i=i.slice();var n=[];_.each(i,function(t){_.contains(e,t[c.ENTITY_ID])||(t[c.CHANGE_TYPE]=l.DELETE,n.push(t),this.removeEntity(t))},this),n.length&&a.triggerAppEvent(a.ENTITIES_DELETED,{entityType:t,entityIds:_.pluck(n,c.ENTITY_ID)})},_triggerChange:function(e){e.length&&a.triggerAppEvent(a.INTENT_ENTITIES_STATE_CHANGED,[e])},_triggerAdded:function(e){e.length&&a.triggerAppEvent(a.INTENT_ENTITIES_TRACKING_INITIATED,[e])},getEntityTypeIdFieldName:function(e){return this.isIntentSpecEntityType(e)?t.INTENT_TASK.UUID:t.EB.ENTITY_ID},_updateEntities:function(e,i){var n=[],s=this.getEntityTypeIdFieldName(i);_.each(e,function(e){var a=this.findEntity({entityId:e[s],entityType:i});a&&e[t.INTENT_TASK.STATE]!==a[c.RESULT][t.INTENT_TASK.STATE]&&(a[c.RESULT]=e,a[c.CHANGE_TYPE]=l.UPDATE,n.push(a))},this),this._triggerChange(n),this._removeCompletedEntities(i)},_removeCompletedEntities:function(e){var i=this.trackedEntities[e]||[];i=i.slice(),_.each(i,function(i){var s=i[c.RESULT][t.INTENT_TASK.STATE];(n.isIntentStateComplete(e,s)||n.isIntentStateError(e,s))&&this.removeEntity(i)},this)},getFilter:function(e,i){return s.addFilterConditions({},e,t.UUID,i)},updateFilter:function(t,i){t.set(e.DP.FILTER_EXPR,this.getFilter(t.get(e.DP.ENTITY_TYPE),i))},registerIntentSpecQueryModel:function(n,s,a){var r={};r[e.DP.ENTITY_TYPE]=i.ENTITY_INTENT_SPEC,r[t.IS_INTENT]=!0;var o=new e(r);return this.updateFilter(o,s),a||(this.queryModelMap[n]=o),o},registerQueryModel:function(t,i,n){var s=new e({entity_ids:i,entity_type:t,isIntent:!0});return n||(this.queryModelMap[t]=s),s},_poll:function(){if(!_.size(this.trackedEntities))return void this._stopPolling();_.each(this.trackedEntities,function(e,t){if(e&&e.length){var n=this.getTrackedEntityIds(t),s=this._getEntityAttributes(t),a=this.queryModelMap[t],r=!_.isEmpty(_.filter(e,function(e){return!0===(e&&e.options&&e.options.ignoreESTQueryModelMap)}));!a||r?a=this.isIntentSpecEntityType(t)?this.registerIntentSpecQueryModel(t,n,r):this.registerQueryModel(t,n,r):this.isIntentSpecEntityType(t)?this.updateFilter(a,n):a.set(a.DP.ENTITY_IDS,n),a.setGroupMemberAttributesList(s),a.getState()!==i.STATE_PENDING&&a.save({},{success:function(e){var n=e.getQueryResultAttributes(),s=_.pluck(n,this.getEntityTypeIdFieldName(t));this._updateEntities(n,t),this._checkDeletedEntities(s,t),e.updateState(i.STATE_SUCCESS)}.bind(this)})}},this)},_startPolling:_.debounce(function(){this.isPolling||(this.isPolling=!0,this._poll(),this.intervalId=setInterval(function(){this._poll()}.bind(this),this.pollingIntervalMilliSecs))},100),_stopPolling:function(){this.intervalId&&clearInterval(this.intervalId),this.isPolling=!1}}}),define("managers/BatchManager",["managers/BaseManager","managers/NotificationManager","managers/IntentManager","data/Config","data/DataManager","data/DataURLConstants","data/DataProperties","managers/EntityStateTracker","events/AppEvents","utils/AppConstants","utils/AppUtil","utils/EntityUtil"],function(e,t,i,n,s,a,r,o,l,c,u,d){"use strict";return e.extend({MAX_REQUEST_LIST_IN_ONE_BATCH_CALL:60,DP:{ACTION_ON_FAILURE:"action_on_failure",API_REQUEST_LIST:"api_request_list",API_VERSION:"api_version",EXECUTION_ORDER:"execution_order",REQUEST:{OPERATION:"operation",PATH_AND_PARAMS:"path_and_params",BODY:"body"},API_RESPONSE_LIST:"api_response_list",RESPONSE:{API_RESPONSE:"api_response",STATUS:"status",MESSAGE_LIST:"message_list",MESSAGE:"message"},PROPS:i.SWAGGER_PROPERTIES,CONTINUE_ON_FAILURE:"continue_on_failure",EXECUTE_ORDER:"execute_order"},HTTP_RESPONSE_SUCCESS_STATUS_RANGE:[199,300],tmplBatchAllErrorMessage:_.template("Error: <%= message %>"),tmplActionIntentFailMessage:_.template("<div> Operation failed on entity <%=entity%>. <%=message%> </div>"),getBatchUrl:function(){return s.getDataSourceURL(s.API_VERSION.V3)+a.BATCH},performBatch:function(e){var t=this,i=e.requestBody||{},n=i[this.DP.API_REQUEST_LIST]||[];if(n.length<=this.MAX_REQUEST_LIST_IN_ONE_BATCH_CALL)return this._performBatch(e);u.debug("BatchMananger: Request list has exceeded the max calls:\n          "+n.length+". Creating sub batch calls.");var s=e.success,a=e.error,r=[],o=[],l=0,c=0,d=void 0;_.each(n,function(t){(l>=this.MAX_REQUEST_LIST_IN_ONE_BATCH_CALL||0===l)&&(l=0,d={success:function(e){return c+=1,function(e,t){u.debug("BatchMananger: Subcall success "+t),o.push({index:t,success:!0,response:e})}(e,c)},error:function(e,t,i){return c+=1,function(e,t,i,n){u.debug("BatchMananger: Subcall error "+n),o.push({index:n,success:!1,jqXHR:e,textStatus:t,erorThrown:i})}(e,t,i,c)}},e.ajax&&(d.ajax=e.ajax),d.requestBody=_.extend({},i),d.requestBody[this.DP.API_REQUEST_LIST]=[],r.push(d)),d.requestBody[this.DP.API_REQUEST_LIST].push(t),l+=1},this);var h=[];_.each(r,function(e){h.push(t._performBatch(e))});var p=$.Deferred();return $.whenAll.apply($,h).done(function(){var e=0;if(_.each(o,function(t){t.success||(e+=1)}),e===r.length&&_.isFunction(a)){var i=_.find(o,function(e){return!1===e.success});return a(i.jqXHR,i.textStatus,i.erorThrown),void p.reject(i.jqXHR,i.textStatus,i.erorThrown)}var n=t.DP.API_RESPONSE_LIST,l=_defineProperty({},n,[]),c=_.sortBy(o,"index");_.each(c,function(e){var t=e.response[n];_.isArray(t)&&(l[n]=l[n].concat(t))}),s(l),p.resolve(l)}),p},_performBatch:function(e){var t={type:"POST",data:JSON.stringify(e.requestBody),contentType:"application/json",success:e.success,error:e.error};e.ajax&&(t=_.extend(t,e.ajax));var i=this.getBatchUrl();return $.ajax(i,t)},createBatchRequestObj:function(e){e=e||{};var t={};return u.isLocalStorageProperty("ssp_force_asterix_compatible")?(t[this.DP.CONTINUE_ON_FAILURE]=!0,t[this.DP.EXECUTE_ORDER]=c.BATCH_REQUEST.SEQUENTIAL):(t[this.DP.ACTION_ON_FAILURE]=e[this.DP.ACTION_ON_FAILURE]||c.BATCH_REQUEST.CONTINUE,t[this.DP.EXECUTION_ORDER]=e[this.DP.EXECUTION_ORDER]||c.BATCH_REQUEST.SEQUENTIAL),t[this.DP.API_REQUEST_LIST]=e[this.DP.API_REQUEST_LIST]||[],t[this.DP.API_VERSION]=e[this.DP.API_VERSION]||c.BATCH_REQUEST.API_VERSION,t},createRequest:function(e,t,i,s){var a={};return a[this.DP.REQUEST.OPERATION]=e.toUpperCase(),a[this.DP.REQUEST.PATH_AND_PARAMS]="/"+n.getServiceData(n.INTENT_GATEWAY).contextRoot+t,_.isEmpty(i)&&!s||(a[this.DP.REQUEST.BODY]=i),a},processBatchEntityIntentSpec:function(e,t){},_patchResponseWithIntentSpec:function(e,n,s,a){var o=s.method,l=s.url,d=this.createBatchRequestObj(),h="";return _.each(e[this.DP.API_RESPONSE_LIST],function(e,t){var s=e[this.DP.RESPONSE.API_RESPONSE];this.processBatchEntityIntentSpec(s,n);var c={};s[this.DP.PROPS.PROP_METADATA]&&(c[this.DP.PROPS.PROP_METADATA]=s[this.DP.PROPS.PROP_METADATA]),s[this.DP.PROPS.API_VERSION]&&(c[this.DP.PROPS.API_VERSION]=s[this.DP.PROPS.API_VERSION]);var p,T=s[this.DP.PROPS.PROP_STATUS],E=s[this.DP.PROPS.PROP_METADATA],S=E[this.DP.PROPS.KIND];if(p=u.isUseSpecEntityType(S)?s[this.DP.PROPS.PROP_SPEC]:T,p=i.pickEntityAttributesFromSwaggerSpec(p,S,o)){if(c[this.DP.PROPS.PROP_SPEC]=p,this.isStatusError(e[this.DP.RESPONSE.STATUS]))return;var g=l.replace(this.DP.PROPS.UUID,s.metadata.uuid),A=n;_.isArray(n)&&(A=n[t]);var m=void 0;m=u.isOverrideEntity(S)?$.extend(!0,c,A):$.extend(c,A);var f=this.createRequest(o,g,m);d[this.DP.API_REQUEST_LIST].push(f)}else{var I=s[this.DP.PROPS.PROP_METADATA][r.UUID],C=a.indexOf(I);C>-1&&a.splice(C,1);var v=i.getIntentErrorMsg(s);h+=this.tmplActionIntentFailMessage({entity:T.name,message:v})}},this),_.isEmpty(h)||t.showClientNotification(c.NOTIFY_ERROR,h),d},executeAction:function(e,t,i,n){e===c.ACTION_DELETE?this.deleteEntities(e,t,i,n):this.updateEntities(e,t,i,n)},createEntities:function(e,t,n){var s=this,a=this.createBatchRequestObj(),r=i.SWAGGER_REST.POST,o=i.getURLObject(t,i.SWAGGER_REST.POST,{swaggerPath:n.swaggerPath});if(!o)return void u.log("BatchManager:createEntities: urlObject is empty for request:\n            method: "+r+"\n            entityType: "+t);var l=o.url;return _.each(n.apiRequestBodyList,function(e){var t=s.createRequest(r,l,e);a[s.DP.API_REQUEST_LIST].push(t)}),this.performBatch({requestBody:a,success:function(e,t,i){_.isFunction(n.success)&&n.success(e,t,i)},error:function(e){_.isFunction(n.error)&&n.error(e)}})},updateEntities:function(e,n,s,a){var r=this.createBatchRequestObj(),c=i.getURLObject(n,i.SWAGGER_REST.GET,{includeUuid:!0}),d=t.showIntentActionNotification(e,n,s),h=function(r){if(this.handleResponseError(r,e,n,s))return void t.hideLatencyMessage(d);var c=i.getURLObject(n,i.SWAGGER_REST.PUT,{includeUuid:!0}),h=this._patchResponseWithIntentSpec(r,a,c,s),p=h[this.DP.API_REQUEST_LIST];p&&p.length?this.performBatch({requestBody:h,success:function(i){this.hasErrorInBatchResponse(i)?t.showIntentErrorNotification(e,n,s,d):t.showIntentSuccessNotification(e,n,s,d),o.addEntities(s,u.getEntityTypeEB(n)),l.triggerAppEvent(l.REFRESH_PENDING_ENTITIES)}.bind(this),error:function(){t.showIntentErrorNotification(e,n,s,d)}.bind(this)}):t.hideLatencyMessage(d)}.bind(this);return _.each(s,function(e){var t=this.createRequest(c.method,c.url.replace(i.SWAGGER_PROPERTIES.UUID,e));r[this.DP.API_REQUEST_LIST].push(t)},this),this.performBatch({requestBody:r,success:h,error:function(){t.showIntentErrorNotification(e,n,s,d)}.bind(this)})},deleteEntities:function(e,n,s,a,r){r=r||{};var h=this.createBatchRequestObj(),p=i.SWAGGER_REST.DELETE;n=d.getSubstituteEntityType(n);var T=i.getURLObject(n,p,{includeUuid:!0});if(!T)return void u.log("BatchManager:deleteEntities:  urlObject is empty for request: \n method:"+p+"\n entityType:"+n+"\n ids:"+s);var E=T.url;_.each(s,function(e){var t=E.replace(i.SWAGGER_PROPERTIES.UUID,e),n=this.createRequest(p,t);h[this.DP.API_REQUEST_LIST].push(n)},this),n=d.resetSubstituteEntityType(n);var S=void 0;return S=r.latencyMsg?t.showLatencyMessage(r.latencyMsg):t.showIntentActionNotification(e,n,s),this.performBatch({requestBody:h,success:function(i){this.hasErrorInBatchResponse(i)?t.showIntentErrorNotification(e,n,s,S):r.successMsg?t.showClientNotification(c.NOTIFY_SUCCESS,r.successMsg,{latencyId:S}):t.showIntentSuccessNotification(e,n,s,S),o.addEntities(s,u.getEntityTypeEB(n)),l.triggerAppEvent(l.REFRESH_PENDING_ENTITIES)}.bind(this),error:function(){t.showIntentErrorNotification(e,n,s,S)}.bind(this)})},fetchEntities:function(e){e=e||{};var t=this.createBatchRequestObj();return _.each(e.requestList,function(e){var n=e.method,s=e.entityType,a=e.uuid,r=e.includeList,o=e.private,l=i.getURLObject(s,n,{includeUuid:!_.isEmpty(a),includeList:!0===r});if(!l&&o&&(l=_.extend({},e)),!l)return void u.log("BatchManager: urlObject is empty for request: \n method:"+n+"\n entityType:"+s+"\n uuid:"+a+"\n includeList:"+r);var c=l.url,d=a?c.replace(i.SWAGGER_PROPERTIES.UUID,a):c,h=i.getEntitiesRequest(l,!0,{limit:e.limit}),p=this.createRequest(n,d,h);t[this.DP.API_REQUEST_LIST].push(p)},this),this.performBatch({ajax:e.ajax,requestBody:t,success:function(t,i,n){_.isFunction(e.success)&&e.success(t,i,n)}.bind(this),error:function(t){_.isFunction(e.error)&&e.error(t)}.bind(this)})},hasErrorInBatchResponse:function(e){var t=this.getErrorInBatchResponse(e);return!!t&&t.length>0},getErrorInBatchResponse:function(e){if(e){var t=e[this.DP.API_RESPONSE_LIST];return _.filter(t,function(e){return this.isStatusError(e[this.DP.RESPONSE.STATUS])},this)}},extractErrorsInBatchResponse:function(e){var t=this,i=[];if(e){var n=this.getErrorInBatchResponse(e);_.each(n,function(e){var n=e[t.DP.RESPONSE.API_RESPONSE];if(n){var s=n[t.DP.RESPONSE.MESSAGE_LIST];s&&s.length&&i.push(s[0][t.DP.RESPONSE.MESSAGE])}})}return i},handleResponseError:function(e,i,n,s){var a=!1;if(e){var r=this.extractErrorsInBatchResponse(e),o=e[this.DP.API_RESPONSE_LIST]||[],l=r.length;if(l>0)if(l===o.length){a=!0;var u=r[0][this.DP.RESPONSE.API_RESPONSE][this.DP.RESPONSE.MESSAGE];t.showClientNotification(c.NOTIFY_ERROR,this.tmplBatchAllErrorMessage({message:u}))}else{var d=r.join(",");t.showClientNotification(c.NOTIFY_ERROR,this.i18ns("batch_error",d))}}return a},isStatusSuccess:function(e){return(e=Number(e))>this.HTTP_RESPONSE_SUCCESS_STATUS_RANGE[0]&&e<this.HTTP_RESPONSE_SUCCESS_STATUS_RANGE[1]},isStatusError:function(e){return!this.isStatusSuccess(e)}})}),define("models/service/ServiceCollection",["models/BaseCollection","managers/BatchManager","utils/AppConstants"],function(e,t,i){"use strict";return e.extend({name:"ServiceCollection",isFetched:!1,onFetchedCallbacks:[],get:function(e){return this.find(function(t){return t.serviceName===e})},fetch:function(){var e=this;this.updateState(i.STATE_PENDING);var n=[],s=[];this.each(function(e){var t=e.getFetchBatchRequest();t?s.push(t):e.fetch&&n.push(e.fetch())});var a=t.createBatchRequestObj();a[t.DP.API_REQUEST_LIST]=s,n.push(t.performBatch({requestBody:a,success:function(t){return e.processBatchResponse(t)},error:function(e){}})),Promise.all(n).then(this.onFetched.bind(this))},onFetched:function(){this.isFetched||(this.isFetched=!0,this.executeFetchedCallbacks())},processBatchResponse:function(e){var i=t.DP,n=e[i.API_RESPONSE_LIST];this.each(function(e,t){var s=n[t];if(s){var a=s[i.RESPONSE.API_RESPONSE];e.set(a)}})},fetched:function(e){this.onFetchedCallbacks.push(e),this.isFetched&&this.executeFetchedCallbacks()},executeFetchedCallbacks:function(){for(;this.onFetchedCallbacks.length;){var e=this.onFetchedCallbacks.shift();_.isFunction(e)&&e()}}})}),define("models/service/ServicePrechecksModel",["models/BaseModel","data/DataURLConstants"],function(e,t){"use strict";return e.extend({name:"ServicePrechecksModel",isV3API:!0,enableNotifications:!1,serviceName:null,DP:{VALIDATION_RESULTS:"validation_result_list",CONFIGURATION_INFO:"configuration_info",ADDITIONAL_MEMORY:"additional_memory",HAS_PASSED_CHECK_FLAG_NAME:"has_passed"},requestFlagName:null,initialize:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};e.prototype.initialize.apply(this,arguments),this.requestFlagName=i.requestFlagName,this.serviceName=i.serviceName},url:function(){return _.template(t.SERVICE_ROOT)({serviceName:this.serviceName})},getRequestBody:function(){return _defineProperty({},this.requestFlagName,!0)},check:function(){var e=this,t=void 0,i=void 0,n=void 0;this.attributes={},this.save(this.getRequestBody()).then(function(n){e.set(n),_.isEmpty(e.getFailedPrechecks())?_.isFunction(t)&&t(e):_.isFunction(i)&&i(e)},function(e){_.isFunction(n)&&n(e)});var s={successPrecheck:function(e){return t=e,s},failedPrecheck:function(e){return i=e,s},requestError:function(e){return n=e,s}};return s},getFailedPrechecks:function(){var e=this,t=this.getPrecheckResult(),i=[];return _.each(t,function(t){t&&!1===t[e.DP.HAS_PASSED_CHECK_FLAG_NAME]&&i.push(t)}),i},getPrecheckResult:function(){return this.get(this.DP.VALIDATION_RESULTS)},getConfigurationInfo:function(){return this.get(this.DP.CONFIGURATION_INFO)},getAdditionalMemory:function(){var e=this.getConfigurationInfo()||{};return parseFloat(e[this.DP.ADDITIONAL_MEMORY])||0}})}),define("models/service/ServiceEnablementModel",["models/BaseModel","data/DataURLConstants","utils/AppConstants"],function(e,t,i){"use strict";return e.extend({name:"ServiceEnablementModel",serviceName:null,enableNotifications:!1,isV3API:!0,DP:{STATE_PROP_NAME:"state",VALUES:{ENABLE:"ENABLE",DISABLE:"DISABLE"}},initialize:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};e.prototype.initialize.apply(this,arguments),this.serviceName=i.serviceName,this.serviceModel=i.serviceModel},url:function(){return _.template(t.SERVICE_ROOT)({serviceName:this.serviceName})},servicePost:function(e){return this.attributes=e.data,this.save(null,{success:e.success,error:function(){_.isFunction(e.error)&&e.error.apply(this,arguments),this.onServicePostError.apply(this,arguments)}.bind(this)})},changeServiceEnablement:function(e,t){var i=this;return t.data=t.data||{},t.data[this.DP.STATE_PROP_NAME]=e,this.servicePost(t).then(function(){i.trigger("onServiceStatusUpdated")})},enableService:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.serviceModel.setEnablingStatus(),this.changeServiceEnablement(this.DP.VALUES.ENABLE,e)},disableService:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.changeServiceEnablement(this.DP.VALUES.DISABLE,e)},onServicePostError:function(e,t){this.getNotificationManager().showClientNotification(i.NOTIFY_ERROR,this.getIntentManager().interpretIntentServerError(t),{temporary:!1})}})}),define("models/service/BaseServiceModel",["models/BaseModel","models/service/ServicePrechecksModel","models/service/ServiceEnablementModel","data/DataURLConstants","data/DataProperties","utils/IntentUtil","events/AppEvents","managers/BatchManager","managers/IntentManager"],function(e,t,i,n,s,a,r,o,l){"use strict";var c={DISABLED:"DISABLED",ENABLING:"ENABLING",ENABLED:"ENABLED",ERROR:"ERROR"};return e.extend({STATUS:c,DP:{STATUS_ATTRIBUTE_NAME:"service_enablement_status"},name:"BaseServiceModel",serviceName:null,enableNotifications:!1,
isV3API:!0,prechecksModel:null,prechecksModelOptions:{},enablementModel:null,enablementModelOptions:{},initialize:function(){e.prototype.initialize.apply(this,arguments),this.on("change",this.onChange,this)},onChange:function(e,t){var i=t&&t.changes;!_.isEmpty(i)&&i[this.DP.STATUS_ATTRIBUTE_NAME]&&this.onStateChange(e)},onStateChange:function(e){r.triggerAppEvent(r.SERVICE_STATE_CHANGED,e)},getServiceName:function(){return this.serviceName},url:function(){return _.template(n.SERVICE_STATUS)({serviceName:this.serviceName})},getFetchBatchRequest:function(){var e="/"+this.url();return o.createRequest("GET",e)},getStatus:function(){return this.get(this.DP.STATUS_ATTRIBUTE_NAME)},isEnabled:function(){return this.getStatus()===this.STATUS.ENABLED},isDisabled:function(){return this.getStatus()===this.STATUS.DISABLED},isEnabling:function(){return this.getStatus()===this.STATUS.ENABLING},setEnablingStatus:function(){this.set(this.DP.STATUS_ATTRIBUTE_NAME,this.STATUS.ENABLING)},isError:function(){return a.isIntentStateError(null,this.get(s.INTENT_STATE))},getErrorText:function(){if(this.isError())return l.interpretIntentServerError(this.attributes)},_createSubModel:function(e,t){return _.isFunction(t.customConstructor)&&(e=t.customConstructor,delete t.customConstructor),t.serviceName=this.serviceName,t.serviceModel=this,new e(null,t)},setPrechecksModelOptions:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.prechecksModelOptions=e},getPrechecksModel:function(){return this.prechecksModel||(this.prechecksModel=this._createSubModel(t,this.prechecksModelOptions)),this.prechecksModel},setEnablementModelOptions:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.enablementModelOptions=e},getEnablementModel:function(){return this.enablementModel||(this.enablementModel=this._createSubModel(i,this.enablementModelOptions),this.enablementModel.on("onServiceStatusUpdated",this.fetch,this)),this.enablementModel}},{STATUS:c})}),define("models/service/BaseCapabilityModel",["models/BaseModel","utils/AppUtil","utils/AppConstants","data/DataURLConstants","utils/HypervisorUtil"],function(e,t,i,n,s){"use strict";return e.extend({serviceName:null,_getAOSVersion:null,_formatCapability:null,isV3API:!0,DP:{CLUSTER_CAPABILITY_LIST:"cluster_capability_list",TRAFFIC_VISIBILITY_LIST:"traffic_visible_hypervisor_list",DATA_COLLECTOR_SUPPORTED:"is_data_collector_supported",HYPERVISOR_LIST:"hypervisor_list",HYPERVISOR_TYPE:"hypervisor_type",AOS_VERSION:"aos_version",HYPERVISOR_VERSION:"hypervisor_version",CLUSTER_NAME:"cluster_name",CLUSTER_UUID:"cluster_uuid",IS_CAPABLE:"is_capable",IS_TRAFFIC_VISIBLE:"is_traffic_visible"},CLUSTER_CAPABILITY_CHECKS:{HYPERVISOR:"hypervisor",AOS_VERSION:"aos_version",AHV_VERSION:"ahv_version",MIXED_HYPERVISOR:"mixed_hypervisor"},CLUSTER_CAPABILITY_CHECK_VALUES:{AOS_VERSION:i.PC_OBELIX_1_VERSION,AHV_VERSION:"20170830.115"},url:function(){return _.template(n.SERVICE_CLUSTER_CAPABILITY)({serviceName:this.serviceName})},_checkHypervisorClusterCapability:function(e){var t=this,i=_.filter(e[this.DP.HYPERVISOR_LIST],function(e){return s.hasKVMOnly(null,[e[t.DP.HYPERVISOR_TYPE]])});return{is_pass:!_.isEmpty(i)}},_checkAOSVersionClusterCapability:function(e){var i=this.CLUSTER_CAPABILITY_CHECK_VALUES.AOS_VERSION;return{value:i,is_pass:t.compareVersions(this._getAOSVersion(e),i,3)>=0}},_checkAHVVersionClusterCapability:function(e){var i=this,n=this.CLUSTER_CAPABILITY_CHECK_VALUES.AHV_VERSION,s=_.filter(e[this.DP.HYPERVISOR_LIST],function(e){var s=e[i.DP.HYPERVISOR_VERSION].match(/([0-9.]+)/g);return t.compareVersions(s[0],n,3)>=0});return{value:n,is_pass:!_.isEmpty(s)}},_getMixedHypervisorClusterCheckResult:function(e){var t=this,i=e[this.DP.HYPERVISOR_LIST],n=_.filter(i,function(e){return!s.hasKVMOnly(null,[e[t.DP.HYPERVISOR_TYPE]])});return{is_pass:!(!_.isEmpty(n)&&n.length!==i.length)}},_getClusterCapabilityCheckResults:function(e){var t=this.CLUSTER_CAPABILITY_CHECKS,i={},n=this._getMixedHypervisorClusterCheckResult(e);return n.is_pass?i[t.HYPERVISOR]=this._checkHypervisorClusterCapability(e):i[t.MIXED_HYPERVISOR]=n,i[t.AOS_VERSION]=this._checkAOSVersionClusterCapability(e),i[t.AHV_VERSION]=this._checkAHVVersionClusterCapability(e),i},getClusterCapability:function(){var e=this;return this.get(this.DP.CLUSTER_CAPABILITY_LIST).map(function(t){return e._formatCapability(t)})}})}),define("models/service/microseg/MicrosegClusterCapabilityModel",["models/service/BaseCapabilityModel","utils/AppConstants"],function(e,t){"use strict";return e.extend({serviceName:t.SERVICES.MICROSEG,_getAOSVersion:function(e){return e[this.DP.AOS_VERSION]},_formatCapability:function(e){return{name:e[this.DP.CLUSTER_NAME],is_capable:e[this.DP.IS_CAPABLE],check_results:this._getClusterCapabilityCheckResults(e)}}})}),define("models/service/microseg/MicrosegServiceModel",["models/service/BaseServiceModel","models/service/microseg/MicrosegClusterCapabilityModel","utils/AppConstants","utils/TimeUtil"],function(e,t,i,n){"use strict";var s=i.MICROSEG_SERVICE_TRIAL_PERIOD;return e.extend({name:"MicrosegServiceModel",serviceName:i.SERVICES.MICROSEG,clusterCapabilityModel:null,initialize:function(){e.prototype.initialize.apply(this,arguments),this.DP=_.extend({},this.DP,{SERVICE_ENABLEMENT_TIMESTAMP:"service_enablement_timestamp"}),this.setPrechecksModelOptions({requestFlagName:"is_validation_only"})},getServiceEnablementUTC:function(){return n.convertISODateTimeToUTS(this.get(this.DP.SERVICE_ENABLEMENT_TIMESTAMP))},isMicrosegTrialPeriodFinished:function(){var e=this.getServiceEnablementUTC();if(e){return e+s*i.MILLIS_PER_DAY<Date.now()}return!1},getClusterCapabilityModel:function(){return this.clusterCapabilityModel||(this.clusterCapabilityModel=new t),this.clusterCapabilityModel}})}),define("models/service/epoch/EpochClusterCapabilityModel",["models/service/BaseCapabilityModel","utils/AppConstants"],function(e,t){"use strict";return e.extend({serviceName:t.SERVICES.EPOCH,_getAOSVersion:function(e){return e[this.DP.TRAFFIC_VISIBILITY_LIST][0][this.DP.AOS_VERSION]},_formatCapability:function(e){return{name:e[this.DP.CLUSTER_NAME],uuid:e[this.DP.CLUSTER_UUID],traffic_visibility:e[this.DP.TRAFFIC_VISIBILITY_LIST][0][this.DP.IS_TRAFFIC_VISIBLE],data_collector_support:e[this.DP.DATA_COLLECTOR_SUPPORTED],check_results:this._getClusterCapabilityCheckResults(e)}}})}),define("models/service/epoch/EpochServiceModel",["models/service/BaseServiceModel","models/service/epoch/EpochClusterCapabilityModel","utils/AppConstants"],function(e,t,i){"use strict";return e.extend({name:"EpochServiceModel",serviceName:i.SERVICES.EPOCH,clusterCapabilityModel:null,getClusterCapabilityModel:function(){return this.clusterCapabilityModel||(this.clusterCapabilityModel=new t),this.clusterCapabilityModel}})}),define("models/service/nucalm/NuCalmEnablementModel",["models/service/ServiceEnablementModel"],function(e){"use strict";return e.extend({initialize:function(t){arguments.length>1&&void 0!==arguments[1]&&arguments[1];e.prototype.initialize.apply(this,arguments),this.DP=_.extend({},this.DP,{ENABLE_NUTANIX_APPS:"enable_nutanix_apps"})}})}),define("models/service/nucalm/NuCalmServiceModel",["models/service/BaseServiceModel","models/service/nucalm/NuCalmEnablementModel","utils/AppConstants"],function(e,t,i){"use strict";return e.extend({name:"NuCalmServiceModel",serviceName:i.SERVICES.NUCALM,serviceStatusCheckTimeoutId:null,initialize:function(){e.prototype.initialize.apply(this,arguments),this.setPrechecksModelOptions({requestFlagName:"perform_validation_only"}),this.setEnablementModelOptions({customConstructor:t})},set:function(){e.prototype.set.apply(this,arguments),clearTimeout(this.serviceStatusCheckTimeoutId),this.isEnabling()&&(this.serviceStatusCheckTimeoutId=setTimeout(this.fetch.bind(this),i.DEFAULT_POLLING_INTERVAL))}})}),define("models/service/object_store/ObjectStoreServiceModel",["models/service/BaseServiceModel","utils/AppConstants"],function(e,t){"use strict";return e.extend({name:"ObjectStoreServiceModel",serviceName:t.SERVICES.OBJECT_STORE,statePoller:null,statePollerInterval:1e4,onStateChange:function(){var t=this;e.prototype.onStateChange.apply(this,arguments),this.isEnabling()?this.statePoller=setInterval(function(){t.fetch()},this.statePollerInterval):this.statePoller&&clearInterval(this.statePoller)}})}),define("models/service/xfit/XfitServiceModel",["models/service/BaseServiceModel","utils/AppConstants"],function(e,t){"use strict";return e.extend({name:"XfitServiceModel",serviceName:t.SERVICES.XFIT})}),define("models/genesis/GenesisBaseModel",["models/PollingModel","data/DataURLConstants","utils/AppUtil"],function(e,t,i){"use strict";var n={GENESIS_RETURN:".return",GENESIS_ERROR:".error"};return e.extend({name:"GenesisBaseModel",urlRoot:t.GENESIS,managerName:null,methodName:null,kwargs:null,ipv6:null,DP:n,initialize:function(){e.prototype.initialize.apply(this,arguments),this.kwargs={}},fetch:function(t){t=t||{};var i=this,n=_.isFunction(t.success)?t.success:null,s=_.isFunction(t.error)?t.error:null;return t.success=function(e,t,a){if(i.hasErrorResponse()){var r=_.escape(i.getErrorResponse());i.trigger("error",e,r,a),s&&s(e,r,a)}else n&&n(e,t,a)},e.prototype.fetch.apply(this,[t])},save:function(e){return this.fetch(e)},getURL:function(){return this.ipv6?this.urlRoot+"/proxy/"+encodeURIComponent(this.ipv6):this.urlRoot},parseOptions:function(t,n,s){return s=e.prototype.parseOptions.apply(this,arguments),s.data=i.convertPrimitiveToJSON(JSON.stringify({".oid":this.managerName,".method":this.methodName,".kwargs":this.kwargs}),!0),s.type="POST",s.contentType="application/json",s},parse:function(e,t){if(e=i.processAjaxPrimitive(e),_.isString(e))try{e=JSON.parse(e)}catch(e){i.log(this.name+" : Error parsing response")}return e},getErrorResponse:function(){return this.get(n.GENESIS_ERROR)},getReturnResponse:function(){var e=this.get(n.GENESIS_RETURN);return void 0!==e?e:{}},getParsedReturnResponse:function(){var e=this.get(n.GENESIS_RETURN);return e&&e.length>0?e[0]:[]},getParsedErrorResponse:function(e){var t=this.get(n.GENESIS_ERROR);if(t)return t;var i=this.getReturnResponse();return!1===i[0]||null===i[0]?i[1]?i[1]:e||"Failed to fetch "+this.name+".":void 0},hasErrorResponse:function(){return void 0!==this.getErrorResponse()},setProxyIpv6:function(e){this.ipv6=e},setRPCParams:function(){}},{DP:n})}),define("models/genesis/K8sClusterEnableModel",["models/genesis/GenesisBaseModel","utils/AppConstants"],function(e,t){"use strict";return e.extend({DP:{ACS_UI_SERVICE:"KarbonUIService",ACS_CONTROLLER_SERVICE:"KarbonCoreService",SERVICE_LIST_JSON:"service_list_json",SERVICE_LIST:"service_list",K8S_CLUSTER_SERVICE_NAME:"KarbonUIService",SERVICE_NAME:"service_name"},name:"K8sClusterEnableModel",methodName:t.CLUSTER_MANAGER_METHODS.IS_SERVICE_ENABLED,managerName:t.GENESIS.CLUSTER_MANAGER,initialize:function(t){e.prototype.initialize.apply(this,arguments),t&&t.method&&(this.methodName=t.method)},getErrorResponse:function(){return this.getParsedErrorResponse(this.i18n("modelError"))},getReturnResponse:function(){return this.get(e.DP.GENESIS_RETURN)||[]},setRPCParams:function(e){_.extend(this.kwargs,e)},setRpcEnableServiceParams:function(){this.methodName=t.CLUSTER_MANAGER_METHODS.ENABLE_SERVICE_WITH_PRECHECKS,this.setRPCParams(_defineProperty({},this.DP.SERVICE_LIST_JSON,JSON.stringify(_defineProperty({},this.DP.SERVICE_LIST,[this.DP.ACS_UI_SERVICE,this.DP.ACS_CONTROLLER_SERVICE]))))},setIsServiceEnableParams:function(){this.methodName=t.CLUSTER_MANAGER_METHODS.IS_SERVICE_ENABLED,this.setRPCParams(_defineProperty({},this.DP.SERVICE_NAME,this.DP.K8S_CLUSTER_SERVICE_NAME))}})}),define("models/service/k8scluster/K8sClusterServiceModel",["models/service/BaseServiceModel","models/genesis/K8sClusterEnableModel","utils/AppConstants"],function(e,t,i){"use strict";var n={LAST_ERROR:"last_error"};return e.extend({name:"K8sClusterServiceModel",serviceName:i.SERVICES.K8S_CLUSTER,enableModel:null,initialize:function(){e.prototype.initialize.apply(this,arguments),this.enableModel=new t},fetch:function(){return this.set(n.LAST_ERROR,""),this.enableModel.setIsServiceEnableParams(),this.enableModel.fetch({success:this.onFetchSuccess.bind(this),error:this.onFetchFailed.bind(this)})},onFetchSuccess:function(){this.get(this.DP.STATUS_ATTRIBUTE_NAME)!==this.STATUS.ENABLING&&this.set(this.DP.STATUS_ATTRIBUTE_NAME,this.STATUS.ENABLED)},onFetchFailed:function(e,t){this.set(this.DP.STATUS_ATTRIBUTE_NAME,this.STATUS.DISABLED)},isError:function(){return this.get(n.LAST_ERROR)},getErrorText:function(){if(this.isError())return this.get(n.LAST_ERROR)},setModelError:function(e){var t;this.set((t={},_defineProperty(t,this.DP.STATUS_ATTRIBUTE_NAME,this.STATUS.ERROR),_defineProperty(t,n.LAST_ERROR,e),t))},getFetchBatchRequest:function(){}})}),define("models/service/dr/DRServiceModel",["models/service/BaseServiceModel","models/service/ServicePrechecksModel","utils/AppConstants","data/DataURLConstants"],function(e,t,i,n){"use strict";var s=t.extend({url:function(){return _.template(n.SERVICE_ROOT)({serviceName:n.DRAAS_STATUS})}});return e.extend({name:"DraasServiceModel",serviceName:i.SERVICES.DR,clusterCapabilityModel:null,enablementModel:null,getPrechecksModel:function(){return this.prechecksModel||(this.prechecksModel=this.createSubModel(s,this.prechecksModelOptions)),this.prechecksModel}})}),define("managers/ServiceManager",["managers/BaseManager","managers/TaskManager","models/service/ServiceCollection","models/service/microseg/MicrosegServiceModel","models/service/epoch/EpochServiceModel","models/service/nucalm/NuCalmServiceModel","models/service/object_store/ObjectStoreServiceModel","models/service/xfit/XfitServiceModel","models/service/k8scluster/K8sClusterServiceModel","models/service/dr/DRServiceModel","utils/AppConstants","events/AppEvents"],function(e,t,i,n,s,a,r,o,l,c,u,d){"use strict";return e.extend({SERVICES:{MICROSEG:u.SERVICES.MICROSEG,EPOCH:u.SERVICES.EPOCH,NUCALM:u.SERVICES.NUCALM,XFIT:u.SERVICES.XFIT,OBJECT_STORE:u.SERVICES.OBJECT_STORE,K8S_CLUSTER:u.SERVICES.K8S_CLUSTER,DR:u.SERVICES.DR},SIMPLE_ENAMBLEMENT_SERVICES:[u.SERVICES.OBJECT_STORE],SERVICE_ENABLEMENT_OPERATIONS:{MICROSEG:u.TASK_OPERATION_ENABLE_SERVICE.MICROSEG,EPOCH:u.TASK_OPERATION_ENABLE_SERVICE.EPOCH,OBJECT_STORE:u.TASK_OPERATION_ENABLE_SERVICE.OBJECT_STORE,NUCALM:u.TASK_OPERATION_ENABLE_SERVICE.NUCALM},name:u.MANAGER.SERVICE,serviceCollection:null,initialize:function(){this.addToManagerHelper(),d.onAppEventOnce(d.USER_AUTHENTICATED,this.initializeCollection.bind(this)),t.registerHandlerForChangedTasks(this.onTaskChanged.bind(this))},initializeCollection:function(){this.serviceCollection=new i(this.getInitServiceModels()),this.fetch()},fetch:function(e){var t=this.getServiceModel(e);return _.isObject(t)?t.fetch():this.getServiceCollection().fetch()},getServiceNameCaption:function(e){return this.i18n("name_captions."+e)},serviceModelFactory:function(e){switch(e){case this.SERVICES.MICROSEG:return new n;case this.SERVICES.EPOCH:return new s;case this.SERVICES.NUCALM:return new a;case this.SERVICES.OBJECT_STORE:return new r;case this.SERVICES.XFIT:return new o;case this.SERVICES.K8S_CLUSTER:return new l;case this.SERVICES.DR:return new c}},getEnablingPopupNavData:function(e){var t,i,n,s;switch(e){case this.SERVICES.MICROSEG:return t={},_defineProperty(t,u.NAV_ACTION,u.ACTION_DIRECTORY_SERVICE.ENABLE_MICROSEG),_defineProperty(t,u.NAV_ACTION_INNER_TEMPLATE,u.ACTION_DIRECTORY_SERVICE.ENABLE_MICROSEG),_defineProperty(t,u.NAV_ACTION_TARGET,u.ENTITY_DIRECTORY_SERVICE),t;case this.SERVICES.EPOCH:return i={},_defineProperty(i,u.NAV_ACTION,u.ACTION_DIRECTORY_SERVICE.ENABLE_EPOCH),_defineProperty(i,u.NAV_ACTION_INNER_TEMPLATE,u.ACTION_DIRECTORY_SERVICE.ENABLE_EPOCH),_defineProperty(i,u.NAV_ACTION_TARGET,u.ENTITY_DIRECTORY_SERVICE),i;case this.SERVICES.NUCALM:return n={},_defineProperty(n,u.NAV_ACTION,u.ACTION_DIRECTORY_SERVICE.ENABLE_APP_ORCHESTRATION),_defineProperty(n,u.NAV_ACTION_INNER_TEMPLATE,u.ACTION_DIRECTORY_SERVICE.ENABLE_APP_ORCHESTRATION),_defineProperty(n,u.NAV_ACTION_TARGET,u.ENTITY_DIRECTORY_SERVICE),n;case this.SERVICES.K8S_CLUSTER:return s={},_defineProperty(s,u.NAV_ACTION,u.ACTION_DIRECTORY_SERVICE.ENABLE_K8S_CLUSTER),_defineProperty(s,u.NAV_ACTION_INNER_TEMPLATE,u.ACTION_DIRECTORY_SERVICE.ENABLE_K8S_CLUSTER),_defineProperty(s,u.NAV_ACTION_TARGET,u.ENTITY_K8S_CLUSTER),s;default:throw new Error('Service "'+e+"\" doesn't have navigation info.")}},getInitServiceNames:function(){return[]},getInitServiceModels:function(){var e=this,t=[];return _.each(this.getInitServiceNames(),function(i){t.push(e.serviceModelFactory(i))}),t},getServiceCollection:function(){return this.serviceCollection},getServiceModel:function(e){return this.getServiceCollection().get(e)},isServiceEnabled:function(e){var t=this.getServiceModel(e);return t&&t.isEnabled()},isServiceDisabled:function(e){var t=this.getServiceModel(e);return t&&t.isDisabled()},isServiceEnabling:function(e){var t=this.getServiceModel(e);return t&&t.isEnabling()},collectionFetched:function(e){this.serviceCollection.fetched(e)},isSimpleEnablementService:function(e){return this.SIMPLE_ENAMBLEMENT_SERVICES.indexOf(e)>=0},showEnablementConfirmationPopup:function(e){var t=this.getServiceModel(e);this.isSimpleEnablementService(e)&&t.isDisabled()&&$.nutanixConfirm({msg:this.i18ns("simple_enablement_confirm.text",this.getServiceNameCaption(e)),yesText:this.i18n("simple_enablement_confirm.yes"),noText:this.i18n("simple_enablement_confirm.no"),yes:function(){t.getEnablementModel().enableService()}})},onTaskChanged:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],i=this.SERVICE_ENABLEMENT_OPERATIONS;_.each(t,function(t){if(t.isTaskCompleted()){var n=t.getType(),s=void 0;_.find(i,function(t,i){if(t===n&&_.isString(e.SERVICES[i]))return s=e.getServiceModel(e.SERVICES[i]),!0}),_.isObject(s)&&s.fetch()}})}})}),define("utils/EntityTooltips",["utils/AppConstants","data/DataProperties","utils/StatsUtil"],function(e,t,i){"use strict";var n={};n[e.ENTITY_VM]=_.template('<div class="n-entity-tooltip"><div>VM : <%= e.getValue(e.nameAttribute) || "Unnamed"  %></div><div>Host : <%= e.getValue(DataProp.HOST_NAME) %></div><div>Guest OS : <%= e.getValue(DataProp.VM_GUEST_OS) || "None" %></div><div>Memory : <%= StatsUtil.storageFormat(    e.getValue(DataProp.VM_MEM_CAPACITY))%></div><div>Disk Capacity : <%= StatsUtil.storageFormat(e.getValue(DataProp.VM_DISK_CAPACITY)) %></div><div>Power State : <%= e.getValue(DataProp.POWER_STATE) %></div><div>vCPUs : <%= e.getValue(DataProp.VM_NUM_VCPUS) %></div></div>'),n[e.ENTITY_HOST]=_.template('<div class="n-entity-tooltip"><div>Host :   <%= e.getValue(e.nameAttribute) || "Unnamed" %></div><div># of VMs :   <%= e.getValue(DataProp.NUM_VMS) %></div><div>CPU Capacity :   <%= StatsUtil.cpuHertzFormat(      e.getValue(DataProp.CPU_CAPACITY)) %></div><div>Memory Capacity :   <%= StatsUtil.storageFormat(      e.getValue(DataProp.VM_MEM_CAPACITY)) %></div><div>Storage Capacity :   <%= StatsUtil.storageFormat(e.getValue(DataProp.TOT_CAPACITY)) %></div></div>'),n[e.ENTITY_DISK]=_.template('<div class="n-entity-tooltip"><div> Disk Serial #:   <%= e.getValue(DataProp.NAME) || "Unknown" %></div><div> Disk Id:   <%= e.getValue(e.idAttribute) %></div><div> Storage Tier:   <%= e.getValue(DataProp.TIER_NAME) %></div><div> Used:   <%= e.getValue(DataProp.TOT_USED_PCT) %></div><div> Capacity (Physical):  <%= StatsUtil.storageFormat(e.getValue(DataProp.TOT_CAPACITY)) %></div></div>'),n[e.ENTITY_PROTECTION_DOMAIN]=_.template('<div class="n-entity-tooltip"><div>Name :   <%= e.getValue(e.nameAttribute) || "Unnamed" %></div><div># of VMs :   <%= e.getValue(DataProp.NUM_VMS) %></div><div>Mode :   <%= e.getValue(DataProp.CPU_CAPACITY) ? "Active" : "Inactive" %> </div><div>Next Snapshot :   <%= e.getValue(DataProp.PD_NEXT_SNAPSHOT_FORMATTED) %></div></div>'),n[e.ENTITY_REMOTE_SITE]=_.template('<div class="n-entity-tooltip"><div>Name :   <%= e.getValue(e.nameAttribute) || "Unnamed" %></div><div>Capabilities :   <%= e.getValue(DataProp.RS_CAPABILITY_NAMES) %></div><div>Compress on Wire :   <%= e.getValue(DataProp.RS_COMPRESSION_ENABLED) ? "On" : "Off" %> </div><div>Proxy Enabled :   <%= e.getValue(DataProp.RS_PROXY_ENABLED) ? "Yes" : "No" %> </div><div>Use SSH Tunnel :   <%= e.getValue(DataProp.RS_SSH_ENABLED) ? "Yes" : "No" %> </div></div>');var s=_.template('<div class="n-entity-tooltip"> Name: <%= e.getValue(e.nameAttribute) %></div>');return{entityTooltip:function(e){var a=e.entityType;return(n[a]||s)({e:e,DataProp:t,StatsUtil:i})}}}),define("utils/SubViewHelper",["models/BaseModel","utils/AppUtil"],function(e,t){"use strict";return e.extend({subViews:null,initialize:function(){t.debug("SubViewHelper initialize cid:"+this.cid),this.subViews={}},destroy:function(){t.debug("SubViewHelper destroy cid:"+this.cid),this.removeAll()},register:function(e,i){t.debug("SubViewHelper register id:"+e+" cid:"+this.cid),this.subViews[e]=i},get:function(e){return this.subViews[e]},getIds:function(){return _.keys(this.subViews)},render:function(e){t.debug("SubViewHelper render id:"+e+" cid:"+this.cid);var i=this.get(e);return i&&i.render?i.render():null},renderAll:function(){return t.debug("SubViewHelper renderAll cid:"+this.cid),this.iterate("render")},start:function(e){var t=this.get(e);t&&(t.showView(),t.startServices())},stop:function(e){var t=this.get(e);t&&(t.hideView(),t.stopServices())},iterate:function(){var e=Array.prototype.slice.call(arguments),i=e.shift();return t.debug("SubViewHelper iterate cid:"+this.cid+" functionName:"+i),_.map(this.subViews,function(t){return _.isFunction(t[i])?t[i].apply(t,e):null})},removeAll:function(){t.debug("SubViewHelper removeAll cid:"+this.cid),this.iterate("destroy"),this.subViews={}},remove:function(e){t.debug("SubViewHelper remove id:"+e+" cid:"+this.cid);var i=this.get(e);i&&i.destroy&&i.destroy(),delete this.subViews[e]},isEmpty:function(){return 0===_.size(this.subViews)}})}),define("views/details/TabDetailsView",["views/basecomponents/BaseView","utils/AppConstants","utils/AppUtil","utils/SubViewHelper","managers/EntityManager"],function(e,t,i,n,s){"use strict";var a=_.template('<div class="n-tab-details-container <%= tabClass %>"><div class="n-tab-details-header"></div><div class="n-tab-details-body"></div></div>'),r=_.template('<div class="n-tab-details-button" data-target="<%= tabId %>" stream-action="show" stream-target="<%= tabName %>"><span title="<%= tabName %>"><%= tabName %></span></div>');return e.extend({pageId:null,entityType:null,tabIds:null,tabNames:null,tabClass:null,subViewHelper:null,currentTabId:null,currentModelId:null,TAB_CREATE_EVENT:"onTabCreated",TAB_CHANGED_EVENT:"onTabChanged",events:{"click  .n-tab-details-button":"onClickTab"},initialize:function(t){e.prototype.initialize.apply(this,arguments),this.subViewHelper=new n,this.tabIds=this.tabIds||[],this.pageId=t.pageId,this.entityType=t.entityType,this.tabIds=t.tabIds,this.tabNames=t.tabNames,this.tabClass=t.tabClass||"",_.bindAll(this,"_renderTabView"),t&&t.currentModel&&(this.currentModel=t.currentModel),this.render()},render:function(){this.$el.html(a({tabClass:this.tabClass})),_.each(this.tabIds,function(e,i){var n=(this.tabNames?this.tabNames[e]:null)||t.TAB_DETAILS_NAMES[e]||e;this.$(".n-tab-details-header").append(r({tabId:e,tabName:n}))},this),this.applyTabWidth()},resetTabWidth:function(){this.$(".n-tab-details-header:first .n-tab-details-button").css({width:""})},applyTabWidth:function(){this.resetTabWidth();var e=this.$('.n-tab-details-header:first .n-tab-details-button[style!="display: none;"]'),t=this.$('.n-tab-details-header:first .n-tab-details-button[style!="display: none;"]:last'),i=Math.floor(100/e.length),n=100-(e.length-1)*i;e.css({width:i+"%"}),t.css({width:n+"%"})},showContent:function(){this.$(".n-tab-details-container").children().show()},hideContent:function(){this.$(".n-tab-details-container").children().hide()},setModelId:function(e){this.currentModelId=e;var t=this.subViewHelper.get(this.currentTabId);t&&t.setModelId(e)},setModel:function(e){this.currentModel=e;var t=this.subViewHelper.get(this.currentTabId);t&&"function"==typeof t.setModel&&t.setModel(e)},getTabContent:function(e){return this.subViewHelper.get(e)},refreshCurrentTab:function(){if(!this.isTabDisabled(this.currentTabId)&&this.currentTabId){var e=this.subViewHelper.get(this.currentTabId);e&&e.refreshView()}else this.selectFirstTab()},selectFirstTab:function(){this.$(".n-tab-details-button:not(.disabled)").length&&this.selectTab(this.$(".n-tab-details-button:not(.disabled)")[0].getAttribute("data-target"))},hasTabSelected:function(){return i.isValidId(this.currentTabId)},selectTab:function(e){if(!this.isTabDisabled(e)){var t;if(-1!==this.tabIds.indexOf(e)&&e!==this.currentTabId){t=this.subViewHelper.get(this.currentTabId),t&&(t.hide(),i.log("TabDetailsView | Tab deselected: "+this.currentTabId),t.stopServices()),t=this.subViewHelper.get(e);var n=this.currentTabId;this.currentTabId=e,t?this._showSubViewTab(t):this._createTabContentView(e),this.$(".n-tab-details-body:first").attr("tab-id",e),_.each(this.$(".n-tab-details-header:first .n-tab-details-button"),function(t){$(t).attr("data-target")===e?$(t).addClass("active"):$(t).removeClass("active")},this),this.trigger(this.TAB_CHANGED_EVENT,[n,this.currentTabId]),i.log("TabDetailsView | Tab selected: "+e)}}},_showSubViewTab:function(e){e&&(e.show(),e.setModelId(this.currentModelId),"function"==typeof e.setModel&&e.setModel(this.currentModel),e.startServices())},_createTabContentView:function(e){s.loadEntityTabDetailsView(this.entityType,e,this._renderTabView)},_renderTabView:function(e){if(this.subViewHelper){var t=new e({tabId:this.currentTabId,pageId:this.pageId,entityType:this.entityType,model:this.currentModel});this.subViewHelper.register(this.currentTabId,t),this.trigger(this.TAB_CREATE_EVENT,this.currentTabId),this.renderTabBodyContent(t.render().el),i.log("TabDetailsView | Tab content subview created: "+this.currentTabId),this._showSubViewTab(t)}},renderTabBodyContent:function(e){this.$(".n-tab-details-body:first").append(e)},onClickTab:function(e){this.selectTab($(e.currentTarget).attr("data-target"))},destroy:function(){i.debug("TabDetailsView : destroy: "," | viewid     : "+this.cid),this.subViewHelper&&(this.subViewHelper.removeAll(),this.subViewHelper=null),e.prototype.destroy.apply(this,arguments)},getTabElement:function(e){return this.$('[data-target="'+e+'"]')},hideTab:function(e){this.getTabElement(e).hide(),this.applyTabWidth()},showTab:function(e){this.getTabElement(e).show(),this.applyTabWidth()},onStartServices:function(){this.subViewHelper.get(this.currentTabId)&&this.subViewHelper.get(this.currentTabId).startServices()},onStopServices:function(){this.subViewHelper&&this.subViewHelper.iterate("stopServices")},isTabDisabled:function(e){return $('.n-tab-details-button[data-target="'+e+'"]').hasClass("disabled")}})}),define("text!templates/basecomponents/usagebar/MultiUsageBar.html",[],function(){return'<div>\n  <div class="stat-labels">\n    <div class="resource-title"><%= title %></div>\n    <div class="resource-stat"><%= stat %></div>\n  </div>\n  <div class="multi-usage-bar">\n    <% _.each(percentageList, function(percentage, index) { %>\n      <div class="m-progress <%= percentage.class %>"\n        style="width:<%= percentage.value %>%"\n        <% if(percentage.tooltip) { %>\n          ntnxtooltip="<%= percentage.tooltip %>"\n        <% } %>>\n      </div>\n    <% }); %>\n  </div>\n</div>'}),define("utils/VisualizationUtil",["utils/AppUtil","utils/AntiscrollUtil","utils/StatsUtil","utils/EntityTooltips","utils/CommonTemplates","utils/AppConstants","data/DataProperties","views/details/TabDetailsView","text!templates/basecomponents/usagebar/MultiUsageBar.html"],function(e,t,i,n,s,a,r,o,l){"use strict";var c=_.template('<div data-name="<%=name%>" data-id="<%=entityId%>" data-entityType="<%=entityType%>" class="entity-circle count-badge-<%=size%> <%=severity%>-count-badge <%= isSelected ? "selected" : "" %>"></div>'),u=_.template('<div data-name="<%=name%>" data-id="<%=entityId%>" data-entityType="<%=entityType%>" class="entity-circle" style="<%= circleColorStyle %>"<%= isSelected ? "selected" : "" %>"></div>'),d=_.template('<div class="n-widget"><div class="n-visual-bar"><% _.each(pctMap, function(value, key) { %>  <%  if ( value > 0 ) { %>    <div class="bar bar-<%=key.toLowerCase()%>"     style="width: <%=value%>%;"></div>  <% } %> <% }) %></div></div>'),h=_.template("Type <%= captchaText %> to confirm <%= action %>."),p=_.template('<div class="text-left"><% if (captchaDetails) { %><div class="captcha-details"><%= captchaDetails %></div><% } %><label class="n-popup-title"><%= captchaMsg %></label><input class="captcha-text n-popup-fields" type="text" value><label class="n-popup-captcha-error"></label></div>'),T=_.template(l);return{BAR_GOOD:"progress-bar-success",BAR_WARNING:"progress-bar-warning",BAR_CRITICAL:"progress-bar-danger",BAR_STORAGE_WARNING_START:75,BAR_STORAGE_WARNING_END:95,storgeBarTemplate:_.template('<div class="n-widget">  <div class="n-visual-bar  n-visual-bar-storage">    <div class="bar <%= bar %>" style="width: <%= percentUsed %>%;      display: <%= percentUsed > 0 ? "block" : "none" %>" >    </div>    </div>  <div class="n-visual-bar-label">      <%= barLabel %>    </div>  </div>  '),progressBarTemplate:_.template('<% if ( leftTextLabel ) { %>  <div class="n-widget two-labels-progress">    <div class="n-visual-bar-label">        <%= leftTextLabel %>      </div>  <% } else { %>  <div class="n-widget <%= widgetClass %>"><% } %><% if ( showBar ) { %>    <div class="visual-bar-wrapper">      <div class="n-visual-bar n-visual-bar-progress progress"            >        <div class="bar progress-bar <%= barClass %>"           style="width: <%= percentUsed %>%;" >        </div>        </div>    </div><% } %><% if ( rightTextLabel ) { %>    <div class="n-visual-bar-label">        <%= rightTextLabel %>      </div>  <% } %>  </div>  '),protectionDomainIconTemplate:_.template('<a title="<%= title %>" class="n-protection-domain-icon  n-<%= state %>"></a> '),appConsistentSnapshotCGTemplate:_.template('<span title="This group targets application consistent snapshots."><%=_.escape(cgName)%>&nbsp;<span class="n-vm-state-icon n-unknown n-small">&nbsp;</span>'),tmplItemAction:_.template('<a class="btnItemAction"    action="<%= action %>"     actionTarget="<%= actionTarget %>"    actionTargetId="<%= actionTargetId %>"    actionTargetName="<%= actionTargetName %>">   <%= content %> </a>'),tmplUnknownHealth:_.template("This <%= entityType %> does not have a health status. <br><br>"),tmplMoreEntities:_.template("There are <%= nbMore %> more entries. Use filters to narrow them down."),DELETE:'<i aria-hidden="true" data-icon="v" class="n-delete-icon"></i>',UPDATE:'<i aria-hidden="true" data-icon="F" class="n-pencil-icon"></i>',DOWNLOAD:'<span class="action-label">Download</span>',RESTORE:'<span class="action-label">Restore</span>',RETRIEVE:'<span class="action-label">Retrieve</span>',UNPROTECT:'<span class="action-label">Unprotect</span>',DISABLE:'<span class="action-label">Disable</span>',ENABLE:'<span class="action-label">Enable</span>',ACTION_SEPARATOR:'<span class="action-separator">&middot;</span>',renderStorageBar:function(e,t,n,s,a){var r=i.round(e/t*100),o=this.BAR_GOOD,l=s||this.BAR_STORAGE_WARNING_START,c=a||this.BAR_STORAGE_WARNING_END;r>=l&&r<=c?o=this.BAR_WARNING:r>c&&(o=this.BAR_CRITICAL);var u;return u=n?i.storageFormat(e):i.storageFormat(e)+" of "+i.storageFormat(t),this.storgeBarTemplate({bar:o,percentUsed:r,barLabel:u})},usageBarStyle:function(e){return 0===e?"zero-usage":100===e?"max-usage":e<=.5?"zero-usage":""},renderProgressBar:function(e){return e=e||{},_.defaults(e,{percentUsed:0,leftTextLabel:"",rightTextLabel:"",barClass:"n-progress-bar",widgetClass:"",showBar:!0}),
this.progressBarTemplate(e)},renderProtectionDomainIcon:function(e){var t,i;if(e[r.PD_METRO_AVAIL]){var n=e[r.PD_METRO_AVAIL][r.PD_METRO_AVAIL_STATUS],s=e[r.PD_METRO_AVAIL][r.PD_METRO_AVAIL_ROLE];n===a.PD_METRO_AVAIL_STATUS.REMOTE_UNREACHABLE||n===a.PD_METRO_AVAIL_STATUS.DECOUPLED?(t="critical",i=s+" ("+n+")"):s===a.PD_METRO_AVAIL_ROLE.ACTIVE?(t="active_role",i=a.PD_METRO_AVAIL_ROLE.ACTIVE+" ("+n+")"):s===a.PD_METRO_AVAIL_ROLE.STANDBY?(t="standby_role",i=a.PD_METRO_AVAIL_ROLE.STANDBY+" ("+n+")"):(t="normal-inactive",i=a.PD_METRO_AVAIL_STATUS.DISABLED)}else e[r.PD_ACTIVE]&&null===e[r.PD_VSTORE_ID]?(t="normal-active",i=a.PD_STATE.ACTIVE):e[r.PD_ACTIVE]||null!==e[r.PD_VSTORE_ID]?e[r.PD_ACTIVE]&&null!==e[r.PD_VSTORE_ID]?(t="vstore-active",i=a.PD_STATE.ACTIVE+" (vStore)"):e[r.PD_ACTIVE]||null===e[r.PD_VSTORE_ID]||(t="vstore-inactive",i=a.PD_STATE.INACTIVE+" (vStore)"):(t="normal-inactive",i=a.PD_STATE.INACTIVE);return this.protectionDomainIconTemplate({state:t,title:i})},healthDistributionByPercentage:function(e,t,n,s){var a=e+t+n+s,r={Critical:i.round(e/a*100),Warning:i.round(t/a*100),Good:i.round(n/a*100),Error:i.round(s/a*100)},o=0,l=0,c=null;_.each(r,function(e,t){o+=e,e>l&&(l=e,c=t)});var u=o-100;return u>0&&(r[c]=i.round(r[c]-u)),r},renderHealthBar:function(e,t,i,n){var s=this.healthDistributionByPercentage(e,t,i,n||0);return this.renderHealthBarByPercentage(s)},renderHealthBarByPercentage:function(e){return d({pctMap:e})},renderCirclesHTML:function(t,i,n,s,a){e.debug("EntityCirclesUtil : render: "," | viewid     : "+this.cid);for(var o="",l=Math.min(t.length,n),d=0;d<l;d++){var h=t[d],p={entityId:h.get(h.idAttribute),name:h.get(h.nameAttribute),entityType:h.entityType,size:s||"details",isSelected:i.indexOf(String(h.get(h.idAttribute)))>=0};if(a){var T=a(h);o+=u(_.extend(p,{circleColorStyle:T}))}else{var E=h.getValue(r.HEALTH_STATUS);o+=c(_.extend(p,{severity:E?E.toLowerCase():"unknown"}))}}if(t.length>n){var S,g=t.length-n;S=1===g?"There is one more entry.":this.tmplMoreEntities({nbMore:g}),o+=c({severity:"other",entityId:"",entityType:"",name:S,size:s||"details",isSelected:!1})}return o},renderEntityCircleTooltip:function(t,i){var s=$(t),a=null;i&&(s.hasClass("other-count-badge")?a=s.attr("data-name"):s.hasClass("unknown-count-badge")?(a=this.tmplUnknownHealth({entityType:e.getEntityNameFromCount(i.entityType,1)}),a+=n.entityTooltip(i)):a=n.entityTooltip(i),a&&s.tooltip({title:a,placement:"bottom",trigger:"hover",html:"true",container:$("body")}))},clearTooltips:function(e){_.each(e,function(e){$(e).tooltip("destroy")})},renderAppConsistentSnapshotCG:function(e){return this.appConsistentSnapshotCGTemplate({cgName:e})},renderTabDetailsView:function(e,t,i,n,s){var a,r;return _.isArray(t)?r=t:_.isObject(t)&&(r=_.keys(t),a=t),new o({el:e,pageId:n,entityType:i,tabIds:r,tabNames:a,tabClass:s})},renderColumnContent:function(e,t){var i=s.CONTENT_COLUMN({numberOfColumns:e});if(!t)return i;t.html(i)},updateColumnContent:function(e,i,n,a){var r=e.find(".n-column-content-"+n);a?(r.find(".n-content-inner").length||r.html(s.ANTISCROLL),i=s.CONTENT_COLUMN_CELL_CENTERBOX({content:i}),r.find(".n-content-inner").html(i),t.applyAntiScroll(e.find(".antiscroll-wrap"))):r.html(i)},renderItemUpdateDeleteActions:function(e,t,i){var n={};return n[a.ACTION_UPDATE]=this.UPDATE,n[a.ACTION_DELETE]=this.DELETE,this.renderItemActions(e,t,i,n)},renderItemActions:function(e,t,i,n){var s=this,a="",r=0;return _.each(n,function(n,o){r++>0&&(a+=s.ACTION_SEPARATOR),a+=s.tmplItemAction({action:o,actionTarget:e,actionTargetId:t,actionTargetName:i,content:n})}),a},renderCaptchaTemplate:function(e,t){return p({captchaMsg:e,captchaDetails:t})},captchaConfirmationTest:function(e,t){return function(){return $("#nutanixConfirmModal .captcha-text").val().trim().toUpperCase()===e||($("#nutanixConfirmModal .n-popup-captcha-error").html(h({action:t,captchaText:e})).show(),!1)}},initCaptchaTestEvent:function(e,t){$("#nutanixConfirmModal .btnYes").attr("disabled","disabled");var i=$("#nutanixConfirmModal input.captcha-text"),n=e.toUpperCase();i.off("keyup").on("keyup",function(s){i.val().trim().toUpperCase()===n?$("#nutanixConfirmModal .btnYes").removeAttr("disabled"):($("#nutanixConfirmModal .btnYes").attr("disabled","disabled"),13===s.keyCode?$("#nutanixConfirmModal .n-popup-captcha-error").html(h({action:t,captchaText:e})).show():$("#nutanixConfirmModal .n-popup-captcha-error").hide())})},renderMultiUsageBar:function(e){e=e||{};var t=[];return e.percentageList&&e.percentageList.length&&!_.isObject(e.percentageList[0])&&(_.each(e.percentageList,function(e){t.push({value:e,class:""})}),e.percentageList=t),_.defaults(e,{title:"",percentageList:{},colorClass:"",stat:""}),T(e)}}}),define("text!templates/basecomponents/alerts/AlertWidget.html",[],function(){return'<% if (totalAlertCount > 0) { %>\n  <div class="n-alert-widget"\n       actiontargetid="<%= id %>"\n       actiontarget="<%= entity %>" data-original-title=""\n       alert-popover="true">\n    <% if (alertSummaries.CRITICAL.metadata.grandTotalEntities > 0) { %>\n      <a class="n-alert-count\n       n-alert-count-critical n-alert-link"><%= alertSummaries.CRITICAL.metadata.grandTotalEntities %></a>\n    <% } %>\n    <% if (alertSummaries.WARNING.metadata.grandTotalEntities > 0) { %>\n      <a class="n-alert-count\n       n-alert-count-warning n-alert-link"><%= alertSummaries.WARNING.metadata.grandTotalEntities %></a>\n    <% } %>\n    <% if (alertSummaries.INFO.metadata.grandTotalEntities > 0) { %>\n      <a class="n-alert-count\n       n-alert-count-info n-alert-link"><%= alertSummaries.INFO.metadata.grandTotalEntities %></a>\n    <% } %>\n  </div>\n<% } %>'}),define("utils/AlertUtil",["models/alert/AlertPolicyCollection","data/DataURLConstants","data/DataProperties","utils/AppConstants","managers/ActionManager","managers/LicenseManager","managers/ServiceManager","components/Components","utils/AppUtil","utils/TimeUtil","utils/VisualizationUtil","utils/I18nMixin","utils/ManagerMixin","utils/FilterUtil","utils/CommonTemplates","text!templates/basecomponents/alerts/AlertWidget.html"],function(e,t,i,n,s,a,r,o,l,c,u,d,h,p,T,E){"use strict";var S=_.template(E),g={SEVERITY:"severity",PARSED_EXCEPTIONS:"parsedExceptions",PARSED_PARAMETERS:"parsedParameters",EXCEPTION_COUNT:"exceptionCount",CAUSE:"alert cause",RESOLUTION:"alert resolution",ALERT_TITLE:"alert_title"},A={error:_.template("Error retrieving <%= metadataType %> information."),pending:_.template("Retrieving <%= metadataType %> information in progress, please retry later."),notFound:_.template("Unable to retrieve <%= metadataType %> information, it might have been deleted.")},m=_.template('<div class="alert-count icons">\n        <a class="alert-link" actionTargetType="<%= entityType %>"\n          actionTargetId="<%= entityId %>"\n          data-severity="critical">\n          <%= Components.icon(\'bell\', \'-critical -small\') %>\n          <%= criticalCount %>\n        </a>\n        <a class="alert-link" actionTargetType="<%= entityType %>"\n          actionTargetId="<%= entityId %>"\n          data-severity="warning">\n          <%= Components.icon(\'bell\', \'-warning -small\') %>\n          <%= warningCount %></a>\n      </div>'),f=_.template('<a class="event-link" actionTargetType="<%= entityType %>"\n        actionTargetId="<%= entityId %>">\n        <%= Components.icon(\'Anomaly\', \'-warning -small\') %>\n        <%= count %>\n      </a>'),I={error:"Error retrieving threshold information.",pending:"Retrieving threshold information in progress, please retry later.",notFound:"Unable to retrieve threshold information, it might have been deleted."},C={kEqualTo:" = ",kGreaterThan:" > ",kGreaterThanOrEqualTo:" >= ",kLessThan:" < ",kLessThanOrEqualTo:" <= ",kContains:" contains "},v=_.template('<span class="n-tooltip-circle-small no-metadata-tooltip" data-toggle="tooltip" data-original-title="<%= tooltip %>">!</span>');return _.extend({},d,h,{name:"AlertUtil",MAX_OFFSET_TOP_PIXELS:150,SELECTOR_ALERT_DIAGRAM_INDICATOR:".n-alert-diagram-indicator",COMPARATORS:C,alertTypeMetadata:null,alertMetaDataState:null,metaDataLoader:null,ALERTS_METADATA_STORE_STATUS:[n.METADATA_STORE_STATUS.DETACHED,n.METADATA_STORE_STATUS.PRELIMBO],ALERT_TYPES_BLINK:[n.HIGH_PRIORITY_ALERTS.CASSANDRA_DETACHED,n.HIGH_PRIORITY_ALERTS.CASSANDRA_MARKED],docTooltipTemplate:_.template("<div class='n-alert-doc-tip'> <%= tipText %></div>"),formatByUserAndTimestamp:function(e,t,i,n,s){var a="";if(!0===e){i=i>0?i/1e3:i;var r=c.formatShortDateTime(i);if(n){var o=s?"auto_"+s:"auto";a=this.i18ns(o,r)}else if(null!==t){var l=s?s+"_by":"by";a=this.i18ns(l,t,r)}}return a},getAlertSeverityCount:function(e,t,i,n){return e=e||0,t=t||0,m({criticalCount:e,warningCount:t,entityId:i,entityType:n,Components:o})},getAnomalyCountLink:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments[1],i=arguments[2];return f({count:e,entityId:t,entityType:i,Components:o})},formatSeverity:function(e){switch(e){case i.ALERT_SEVERITY_INFO:case i.ALERT_SEVERITIES.INFO:return'<div class="n-alert-icon n-info-icon"></div>Info';case i.ALERT_SEVERITY_WARNING:case i.ALERT_SEVERITIES.WARNING:return'<div class="n-alert-icon n-warning-icon"></div>Warning';case i.ALERT_SEVERITY_CRITICAL:case i.ALERT_SEVERITIES.CRITICAL:return'<div class="n-alert-icon n-critical-icon"></div>Critical';default:return""}},orderSeverity:function(e){var t=0;switch(e){case i.ALERT_SEVERITY_INFO:t=-1;break;case i.ALERT_SEVERITY_WARNING:t=0;break;case i.ALERT_SEVERITY_CRITICAL:t=1}return t},formatEditAlertPolicy:function(e,t){if(this.canModify(t)){var s={};return s[n.ACTION_EDIT]=u.UPDATE,u.renderItemActions(n.ENTITY_ALERT_POLICY,t[i.ALERT_CHECK_ID],i.ID,s)}return""},findMetricByName:function(e,t,i){var n=this.findMetricsByEntityType(e,t);return _.find(n,function(e){return e.name===i})},findMetricsByEntityType:function(e,t){t===n.ENTITY_HOST&&(t=n.ENTITY_NODE);var s=t,a=_.find(e.models,function(e){return e.get(i.ENTITY_TYPE)===s});return a&&a.get(i.METRICS_DP.SUPPORTED_METRICS)},canModify:function(e){return n.LICENSE_ALERT_POLICIES.indexOf(e[i.ALERT_METADATA_ID])<0},_getValue:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:{})[e]||e,_.isFunction(t.get)?t.get(e):t[e]},getAlertDisplayName:function(e,t){var n,s=this._getValue(i.ALERT_TITLE_V3,e)||this._getValue(g.ALERT_TITLE,e),a=this._getValue(i.ALERT_DEFAULT_MSG,e)||this._getValue(i.ALERT_MESSAGE,e),r=t?a||s:s||a,o=this._getValue(i.ALERT_PARAM_NAMES,e),l=o?i.ALERT_PARAM_NAMES:i.CP.ALERT.CONTEXT_TYPES,c=o?i.ALERT_PARAM_VALUES:i.CP.ALERT.CONTEXT_VALUES,u=(n={},_defineProperty(n,i.ALERT_CONTEXT_TYPES,l),_defineProperty(n,i.ALERT_CONTEXT_VALUES,c),_defineProperty(n,i.ALERT_AFFECTED_ENTITY_UUID_LIST,i.ALERT_AFFECTED_ENTITY_UUID_LIST),_defineProperty(n,i.ALERT_AFFECTED_ENTITY_NAME_LIST,i.ALERT_AFFECTED_ENTITY_NAME_LIST),_defineProperty(n,i.ALERT_AFFECTED_ENTITY_TYPE_LIST,i.ALERT_AFFECTED_ENTITY_TYPE_LIST),n);return this.formatIssue(r,e,u)},getAlertCreatedTime:function(e){return this._getValue(i.EB.CREATED_TIMESTAMP_USECS,e)||this._getValue(i.CP.ALERT.CREATED_TIME_STAMP,e)},formatIssue:function(e,t){var n=this,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(e){var a=this._getValue(i.ALERT_CONTEXT_TYPES,t,s),r=this._getValue(i.ALERT_CONTEXT_VALUES,t,s);_.each(_.isArray(a)&&a,function(t,i){e=n.replaceParam(e,t,r[i])});var o=this._getValue(i.ALERT_AFFECTED_ENTITY_NAME_LIST,t,s);_.each(_.isArray(o)&&o,function(t,i){e=e.replace("{entity["+i+"].name}",t)});var l=this._getValue(i.ALERT_AFFECTED_ENTITY_UUID_LIST,t,s);_.each(_.isArray(l)&&l,function(t,i){e=e.replace("{entity["+i+"].uuid}",t)});var c=this._getValue(i.ALERT_AFFECTED_ENTITY_TYPE_LIST,t,s);_.each(_.isArray(c)&&c,function(t,i){e=e.replace("{entity["+i+"].type}",t)})}return e},replaceParam:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments[1],i=arguments[2],n=new RegExp("{"+t+"}","g");return e.replace(n,i)},loadAlertTypeMetadata:function(t){if(this.getDataManager().isV3PrimaryDataSource()&&!this.getAccessManager().hasV3andV1Role()){var i=$.Deferred();return i.reject(),i.promise()}if(this.metaDataLoader&&!t)return this.metaDataLoader;var n=this;n.alertTypeMetadata={};var s={};s[e.INCLUDE_INTERNAL_CHECKS_PARAM]=!0;var a=new e(null,s);return this.alertMetaDataState=a.getState(),this.metaDataLoader=a.fetch({success:function(e){e.each(function(e){var t=e.toJSON({includeAttribute:!0});t[g.PARSED_EXCEPTIONS]=e.getExceptions(),t[g.PARSED_PARAMETERS]=e.getConfigurableParameters(),n.alertTypeMetadata[e.get(e.DP.ALERT_TYPE_ID)]=t}),n.alertMetaDataState=a.getState()},error:function(e,t,i){n.alertMetaDataState=a.getState(),l.log("ERROR: Could not load alert metadata information"+l.processAjaxError(t.responseText)+" | "+t.statusText+" | "+l.safeStringify(i))}}),this.alertMetaDataState=a.getState(),this.metaDataLoader},getMetaDataLoadState:function(){return this.alertMetaDataState},getAlertTypeMetadata:function(e){return null===this.alertTypeMetadata?null:this.alertTypeMetadata[e]},getSupportedMetrics:function(){var e=this,i=$.Deferred();return this.supportedMetrics&&this.supportedMetrics.getState()===n.STATE_SUCCESS?i.resolve(this.supportedMetrics):(this.supportedMetrics=this.getEntityManager().createGenericEntityCollection("metric",null,t.ALERT_METRICS),this.supportedMetrics.fetch({success:function(){i.resolve(e.supportedMetrics)},error:function(){i.reject(e.supportedMetrics)}})),i.promise()},getXfitFeatureInfo:function(){var e=r.getServiceModel(r.SERVICES.XFIT),t=e.isDisabled(),i=a.getFeatInfo(a.FEAT_MAP.VMBL),n=_.isString(e.getStatus()),s="";return i&&i.denied?s=i.message:t&&(s=this.i18n("xfit_disabled")),{disabled:t||i.denied,message:s,featureDisabled:t,serviceInfoAvailable:n,licenseDisabled:i.denied}},evaluateThresholdParameter:function(e,t,i,n){if(e&&-1!==e.indexOf("{")&&-1!==e.indexOf("}")&&t){var s;if(n&&t[g.EXCEPTION_COUNT]){var a=t[g.PARSED_EXCEPTIONS],r=_.find(a,function(e){var t=e.clusters;return _.some(t,function(e){return e.clusterUuid===n})});r&&(s=r.parameters)}s||(s=t[g.PARSED_PARAMETERS]);var o=_.find(s,function(e){return i===e[g.SEVERITY]});if(o){var l=(o.value||o.defaultValue)+(o.unit||"");return e.replace("{"+o.name+"}",l)}}return e},formatCause:function(e,t,i,s){if(e&&-1!==e.indexOf("{")&&-1!==e.indexOf("}")){var a=this.getAlertTypeMetadata(t);if(a)return this.evaluateThresholdParameter(e,a,i,s);var r;return r=this.alertMetaDataState===n.STATE_SUCCESS?I.notFound:this.alertMetaDataState===n.STATE_INIT?I[n.STATE_PENDING]:I[this.alertMetaDataState]||I[n.STATE_ERROR],e+v({tooltip:r})}return e},getNoMetaDataErrorStatus:function(e){if(this.alertMetaDataState===n.STATE_SUCCESS)return A.notFound({metadataType:e});return(this.alertMetaDataState===n.STATE_INIT?A[n.STATE_PENDING]:A[this.alertMetaDataState]||A[n.STATE_ERROR])({metadataType:e})},formatCauses:function(e,t,n){return e?_.map(e[i.ALERT_CAUSES],function(i){return this.evaluateThresholdParameter(i,e,t,n)},this):null},isHostMetadataDetached:function(e){return e&&this.ALERTS_METADATA_STORE_STATUS.indexOf(e[i.METADATA_STORE_STATUS])>-1},isBlinking:function(e){return e&&this.ALERT_TYPES_BLINK.indexOf(e)>-1},comparatorHighPriorityUnresolved:function(e,t){var n=e.get(i.ALERT_RESOLVED),s=t.get(i.ALERT_RESOLVED),a=_.indexOf(this.getHighPriorityAlerts(),e.get(i.ALERT_TYPE_UUID)),r=_.indexOf(this.getHighPriorityAlerts(),t.get(i.ALERT_TYPE_UUID));return!1===n&&!0===s?-1:!0===n&&!1===s?1:a>r?-1:r>a?1:e.getCreatedTimestamp()>t.getCreatedTimestamp()?-1:e.getCreatedTimestamp()<t.getCreatedTimestamp()?1:0},createTooltip:function(e,t,n,s){var a=this.getAlertTypeMetadata(e);if(a){var r,o=a[t];if(_.isArray(o)){var l=o;t===i.ALERT_CAUSES&&(l=this.formatCauses(a,n,s)),r=l.join("<br>")}else r=o,t===i.ALERT_CAUSES&&this.formatCause(o,e,n,s);return this.docTooltipTemplate({tipText:r})}return this.getNoMetaDataErrorStatus(t===i.ALERT_CAUSES?g.CAUSE:g.RESOLUTION)},getAlertPopoverContent:function(e){var t=_.sortBy(e,function(e,t){return n.ALERT_SUMMARY_SEVERITY_HIERARCHY[t]});return T.ALERT_POPOVER_WIDGET({alertSummaries:t,formatIssue:_.bind(this.formatIssue,this),maxItems:3})},constructAttributeObject:function(e,t){return _.each(e,function(e){if(e&&e.current){var i=e.current;e.high="capacity."+i+".upper_buff",e.low="capacity."+i+".lower_buff",t&&(e.low_future="capacity."+i+".lower_buff",e.high_future="capacity."+i+".upper_buff",e.current_future="capacity."+i+".average_buff")}},this),e},renderHighlightAlerts:function(e,t){_.each(e,function(e){var s=$(e),a=s.attr(n.NAV_ACTION_TARGET_ID);if(!a||0===a)return void l.debug("Problem rendering alerts. Invalid entityId.");s.removeClass("n-alert-highlight-critical"),s.removeClass("n-alert-highlight-warning"),s.removeClass("n-alert-highlight-info");var r=[];if(_.isArray(t)?r=t:t&&t.count>0&&_.each(t.alertSummaries,function(e){r=r.concat(e.entities||[])}),r&&r.length>0){var o;r.every(function(e){var t=e.get?e.get(i.ALERT_SEVERITY):e[i.ALERT_SEVERITY];return t===i.ALERT_SEVERITY_CRITICAL?(o="critical",!1):(t===i.ALERT_SEVERITY_WARNING?o="warning":t===i.ALERT_SEVERITY_INFO&&(o="info"),!0)}),s.addClass("n-alert-highlight-"+o),this.renderAlertPopOver(e,r,n.ALERT_TYPE_HIGHLIGHT)}},this)},renderAlertWidget:function(e){var t=e.targetEl.find(".n-alert-widget");if(t.popover("destroy"),t.remove(),e.alertSummary&&e.alertSummary.count>0){var i=S({id:e.entityId,entity:e.entityType,alertSummaries:e.alertSummary.alertSummaries,totalAlertCount:e.alertSummary.count});e.alertType===n.ALERT_TYPE_TABLE?e.targetEl.append(i):e.targetEl.html(i);var s="top";e.alertType===n.ALERT_TYPE_TABLE&&(s="right"),t=e.targetEl.find(".n-alert-widget"),t.popover({title:n.ENTITY_NAMES[e.entityType]+" Alert"+(e.alertSummary.count>1?"s":""),content:this.getAlertPopoverContent(e.alertSummary.alertSummaries),placement:s,trigger:"hover",html:!0,animation:!1,delay:0,container:$("body")})}},findMetricRelatedModels:function(e,t){if(e){var n=e.getQueryResultAttributes();return _.filter(n,function(e){if(e[i.ALERT_METRIC_NAME]===t)return!0})}},showUDAPolicyPopup:function(e,t,i){s.executeAction({action:n.ACTION_SHOW,actionTarget:n.ENTITY_USER_DEFINED_ALERT_POLICY,params:{entityType:e,entityId:t,metricName:i}})},renderAlertPopOver:function(e,t,s){var a=$(e);if(a.popover("destroy"),t&&t.length>0){var r,o,l=a.attr(n.NAV_ACTION_TARGET),c=!1,u=0,d=0,h=0,p=new Array(3);_.each(t,function(e,t){var n,s,a;e.get?(n=e.get(i.ALERT_SEVERITY),s=e.get(i.ALERT_MESSAGE),a=e.toJSON()):(n=e[i.ALERT_SEVERITY],s=e[i.ALERT_MESSAGE],a=e),t<3&&(r={},r.severity=n.replace("k","").toLowerCase(),r.message=this.formatIssue(s,a),p.push(r)),n===i.ALERT_SEVERITY_CRITICAL?u++:n===i.ALERT_SEVERITY_WARNING?d++:n===i.ALERT_SEVERITY_INFO&&h++},this),o="top",s===n.ALERT_TYPE_DIAGRAM?(o="top",a.offset().top<this.MAX_OFFSET_TOP_PIXELS&&p.length>=3&&(o="bottom"),a.closest(this.SELECTOR_ALERT_DIAGRAM_INDICATOR).attr(n.ALERT_DIAGRAM_TYPE_ATTRIBUTE)===n.ALERT_DIAGRAM_TYPE.NONSKEUOMORPHIC&&(c=!0)):s===n.ALERT_TYPE_TABLE?o="right":s===n.ALERT_TYPE_HIGHLIGHT&&(c=!0),a.popover({title:n.ENTITY_NAMES[l]+" Alert"+(t.length>1?"s":""),content:T.ALERT_POPOVER_HIGHLIGHT({alerts:p,showCount:c,countCritical:u,countWarning:d,countInfo:h}),placement:o,trigger:"hover",html:!0,animation:!1,delay:0,container:$("body")})}},getEntityScopeLabel:function(e,t,i){t===n.ENTITY_NODE&&(t=n.ENTITY_HOST);var s=void 0;if("single_entity"===e){if(s=l.getSingularEntityName(t),i)return s+" "+i}else s=l.getPluralEntityName(t);return i?this.i18ns("specific_"+e,{entityType:s,entityName:i}):this.i18ns(e,s)},useV1Filter:function(e,t){return t||!this.getDataManager().isV3PrimaryDataSource()},getStringListFilterOperator:function(e,t){var i=n.FILTER_OPERATORS.EQUALS;return this.useV1Filter(e,t)||(i=n.FILTER_OPERATORS.CONTAINS_V3),i},setAlertResolvedFilter:function(e,t){return p.addFilterCondition(e,i.ALERT_RESOLVED,p.createFilterCondition(n.ENTITY_ALERT,i.ALERT_RESOLVED,n.FILTER_OPERATORS.EQUALS,_.isBoolean(t)?t.toString():t))},setAlertSeverityFilter:function(e,t){return p.addFilterCondition(e,n.ALERT_FILTER.SEVERITY,p.createFilterCondition(n.ENTITY_ALERT,n.ALERT_FILTER.SEVERITY,n.FILTER_OPERATORS.EQUALS,t))},setAlertImpactTypeFilter:function(e,t){return p.addFilterCondition(e,i.ALERT_IMPACT_TYPE,p.createFilterCondition(n.ENTITY_ALERT,i.ALERT_IMPACT_TYPE,this.getStringListFilterOperator(n.ENTITY_ALERT),t))},setClusterFilter:function(e,t,s,a,r){return s||(s=n.ENTITY_ALERT),this.useV1Filter(s,r)?p.addFilterCondition(e,i.EB.CLUSTER_UUID,p.createFilterCondition(s,i.EB.CLUSTER_UUID,n.FILTER_OPERATORS.EQUALS,t,null,a)):p.addFilterCondition(e,n.ENTITY_CLUSTER,p.createFilterCondition(s,n.ENTITY_CLUSTER,n.FILTER_OPERATORS.EQUALS,t))},setEntityFilter:function(e,t,i,s,a){if(s||(s=n.ENTITY_ALERT),this.useV1Filter(s,a))return e=p.addFilterCondition(e,n.FILTER_ENTITY_TYPE,p.createFilterCondition(s,n.FILTER_ENTITY_TYPE,n.FILTER_OPERATORS.EQUALS,t)),i&&(e=p.addFilterCondition(e,n.FILTER_ENTITY_ID,p.createFilterCondition(s,n.FILTER_ENTITY_ID,n.FILTER_OPERATORS.EQUALS,i))),e;if(t===n.ENTITY_HOST)t=n.ENTITY_NODE;else{if(t===n.PERSPECTIVE_STORAGE)return this.setClassificationFilter(e,n.ALERT_CLASSIFICATIONS.STORAGE,s);if(t===n.PERSPECTIVE_DR||t===n.PERSPECTIVE_BACKUP)return this.setClassificationFilter(e,n.ALERT_CLASSIFICATIONS.DR,s);if(t===n.PERSPECTIVE_HARDWARE)return this.setClassificationFilter(e,n.ALERT_CLASSIFICATIONS.HARDWARE,s);if("license"===t)return this.setClassificationFilter(e,n.ALERT_CLASSIFICATIONS.LICENSE,s)}return i?p.addFilterCondition(e,t,p.createFilterCondition(s,t,n.FILTER_OPERATORS.CONTAINS_V3,i)):p.addFilterCondition(e,t,p.createFilterCondition(s,t,n.FILTER_OPERATORS.NOT_EQUALS,n.FILTER_NULL_VALUE))},setIndicatorEntityTypeFilter:function(e,t,i){return i||(i=n.ENTITY_ALERT),p.addFilterCondition(e,n.FILTER_INDICATOR_ENTITY_TYPE,p.createFilterCondition(i,n.FILTER_INDICATOR_ENTITY_TYPE,this.getStringListFilterOperator(i),t))},setTimeRangeFilter:function(e,t,s,a,r){return a||(a=n.ENTITY_ALERT),this.useV1Filter(a,r)?(t&&(e=p.addFilterCondition(e,i.ALERT_INTERVAL_START,p.createFilterCondition(a,i.ALERT_INTERVAL_START,n.FILTER_OPERATORS.EQUALS,t))),s&&(e=p.addFilterCondition(e,i.ALERT_INTERVAL_END,p.createFilterCondition(a,i.ALERT_INTERVAL_END,n.FILTER_OPERATORS.EQUALS,s)))):(t&&(e=p.addFilterCondition(e,i.EB.CREATED_TIMESTAMP_USECS,p.createFilterCondition(a,i.EB.CREATED_TIMESTAMP_USECS,n.FILTER_OPERATORS.GREATER_OR_EQUAL,t*n.MICROS_PER_MILLI))),s&&(e=p.addFilterCondition(e,i.EB.CREATED_TIMESTAMP_USECS,p.createFilterCondition(a,i.EB.CREATED_TIMESTAMP_USECS,n.FILTER_OPERATORS.LESS_OR_EQUAL,s*n.MICROS_PER_MILLI)))),e},setMetricFilter:function(e,t,s){return s||(s=n.ENTITY_ALERT),p.addFilterCondition(e,i.ALERT_METRIC_NAME,p.createFilterCondition(s,i.ALERT_METRIC_NAME,this.getStringListFilterOperator(s),t))},setClassificationFilter:function(e,t,i){return i||(i=n.ENTITY_ALERT),p.addFilterCondition(e,n.EVENT.FILTER.TYPE,p.createFilterCondition(i,n.EVENT.FILTER.TYPE,this.getStringListFilterOperator(i),t))}})}),define("models/alert/AlertModel",["models/BaseModel","data/DataURLConstants","data/DataProperties","utils/AlertUtil","utils/AppConstants"],function(e,t,i,n,s){"use strict";return e.extend({idAttribute:i.ALERT_ID,urlRoot:t.ALERT,name:"AlertModel",entityType:s.ENTITY_ALERT,getCreatedTimestamp:function(){var e=this.get(i.ALERT_CREATED_TIMESTAMP);return e&&e>0?e/1e3:0},getDisplayableId:function(){var e=this.get(this.idAttribute),t=e.indexOf("::");return t>=0?e.substring(0,t):e},nameParserFunc:function(){return this.getDisplayName()},getDisplayName:function(){var e=this.get(i.ALERT_TITLE)||this.get(i.ALERT_MESSAGE);return n.formatIssue(e,this.toJSON())}})}),define("models/alert/AlertCollection",["models/PollingCollection","models/alert/AlertModel","data/DataProperties","data/DataURLConstants","utils/AppConstants"],function(e,t,i,n,s){"use strict";var a=null;return e.extend({model:t,url:n.ALERT,name:"AlertCollection",addFilterURL:function(e){e&&e.length&&(e===n.getFilterUrlByPageId(s.PAGE_FILE_SERVER)?this.url=this.url+"?entityType="+e:this.url=this.url+"/"+e)},getAlert:function(e){return _.find(this.models,function(t){return t.get(i.ALERT_ID)===e})},getAlertsByEntityId:function(e,t){var n=_.filter(this.models,function(t){var n=t.get(i.ALERT_ENTITY_IDS);return _.contains(n,e)});if(t&&n.length){var a,r,o,l,c=this.getHighPriorityAlerts();n=n.sort(function(e,t){return o=_.indexOf(c,e.get(i.ALERT_TYPE_UUID)),l=_.indexOf(c,t.get(i.ALERT_TYPE_UUID)),o>l?-1:l>o?1:(a=s.ALERT_SEVERITY_HIERARCHY[e.get(i.ALERT_SEVERITY)],r=s.ALERT_SEVERITY_HIERARCHY[t.get(i.ALERT_SEVERITY)],a-r)})}return n},getAlertsBySeverity:function(e){return _.filter(this.models,function(t){return t.get(i.ALERT_SEVERITY)===e})},getAllAlerts:function(){return this.models},getAlertsInTimeRange:function(e,t){return this.filter(function(i){var n=i.getCreatedTimestamp();return n>=e&&n<t})},getAlertsInTimeRangeBySeverity:function(e,t,i){return this.filter(function(n){var s=n.getCreatedTimestamp();return n.get("severity")===i&&s>=e&&s<t})},getHighPriorityAlerts:function(){return a=a||_.values(s.HIGH_PRIORITY_ALERTS)},getPowerSupplyAlerts:function(e,t,n){if(void 0!==e&&(void 0!==t||void 0!==n)){var a;return _.filter(this.models,function(r){return a=r.get(i.ALERT_CONTEXT_VALUES),r.get(i.ALERT_TYPE_UUID)===s.ALERT_UUID_POWER_SUPPLY_DOWN&&_.contains(a,e)&&_.find(a,function(e){var i,s=e.toLowerCase();return t?i=t.toLowerCase():n&&(i=n.toLowerCase()),-1!==s.indexOf(i)})})}}})}),define("models/dataprotection/ProtectionDomainModel",["models/BaseModel","models/PollingModel","data/DataURLConstants","data/DataProperties","data/DataManager","utils/AppConstants","utils/StatsUtil","utils/AppUtil","utils/TimeUtil"],function(e,t,i,n,s,a,r,o,l){"use strict";var c="Enter a timeout value between 10 and 30 seconds.",u={IS_AUTO_ADDED:"isAutoAdded",AUTO_ADDED_ARRAY:"allAutoAdded"};return t.extend({idAttribute:n.PD_NAME,nameAttribute:n.PD_NAME,urlRoot:i.PROTECTION_DOMAIN,name:"ProtectionDomainModel",entityType:a.ENTITY_PROTECTION_DOMAIN,defaults:{name:null,vms:null,nfsFiles:null,active:!0,remoteSiteNames:null,nextSnapshotTimeUsecs:0,pendingReplicationCount:0,ongoingReplicationCount:0,markedForRemoval:!1,totalUserWrittenBytes:null,replicationLinks:[],stats:null,vstoreId:null,annotations:[],consistencyGroups:[],metroAvail:null,allAutoAdded:[]},toJSON:function(e){var i=t.prototype.toJSON.apply(this,arguments);return e&&e.includeCustomAttributes&&(i[n.PD_SPACE_USAGE]=this.getValue(n.PD_SPACE_USAGE),i[n.PD_METRO_AVAIL_FAILURE_HANDLING]=this.getMetroWitnessFailureHandling(),i[n.PD_METRO_REPLICATION_STATS]=this.getMetroReplicationStats()),i},getURL:function(e){return e===a.ACTION_DELETE&&this.isMetroAvailPD()&&this.getMetroAvailStatus()===a.PD_METRO_AVAIL_STATUS.SYNC_INCOMPLETE?this.url()+"?skipRemoteCheck=true":t.prototype.getURL.apply(this,arguments)},isCreatedExternal:function(){return null!==this.get(n.PD_VSTORE_ID)},isActive:function(){return!0===this.get(n.PD_ACTIVE)},isMetroAvailPD:function(){return null!==this.get(n.PD_METRO_AVAIL)},inActiveRole:function(){var e=this.get(n.PD_METRO_AVAIL);return e&&e[n.PD_METRO_AVAIL_ROLE]===a.PD_METRO_AVAIL_ROLE.ACTIVE},inStandbyRole:function(){var e=this.get(n.PD_METRO_AVAIL);return e&&e[n.PD_METRO_AVAIL_ROLE]===a.PD_METRO_AVAIL_ROLE.STANDBY},isMetroAvailDeletable:function(){var e=this.get(n.PD_METRO_AVAIL);if(e){var t=e[n.PD_METRO_AVAIL_STATUS];if(e[n.PD_METRO_AVAIL_ROLE]===a.PD_METRO_AVAIL_ROLE.ACTIVE)return t===a.PD_METRO_AVAIL_STATUS.DISABLED||t===a.PD_METRO_AVAIL_STATUS.PENDING||t===a.PD_METRO_AVAIL_STATUS.ERROR;if(e[n.PD_METRO_AVAIL_ROLE]===a.PD_METRO_AVAIL_ROLE.STANDBY)return t===a.PD_METRO_AVAIL_STATUS.DISABLED||t===a.PD_METRO_AVAIL_STATUS.SYNCHRONIZING||t===a.PD_METRO_AVAIL_STATUS.SYNC_INCOMPLETE}return!1},isScheduleEditable:function(){var e=this.get(n.PD_METRO_AVAIL);if(e){var t=e[n.PD_METRO_AVAIL_STATUS];return t!==a.PD_METRO_AVAIL_STATUS.REMOTE_UNREACHABLE&&t!==a.PD_METRO_AVAIL_STATUS.SYNC_INCOMPLETE}return!0},isRemoteSiteUnreachable:function(){var e=this.get(n.PD_METRO_AVAIL);return e&&e[n.PD_METRO_AVAIL_STATUS]===a.PD_METRO_AVAIL_STATUS.REMOTE_UNREACHABLE},getMetroAvailStatus:function(){var e=this.get(n.PD_METRO_AVAIL);return e?e[n.PD_METRO_AVAIL_STATUS]:null},getVMCount:function(){return(this.get(n.PD_VMS)||[]).length},getProtectedEntities:function(){var e=[];return _.each(this.get(n.PD_VMS),function(t){var i={};i[n.ID]=t[n.VM_ID]||"",i[n.NAME]=t[n.VM_NAME]||"",i[n.VM_CONSISTENCY_GROUP]=t[n.VM_CONSISTENCY_GROUP],i[n.VM_POWER_STATE_ON_RECOVERY]=t[n.VM_POWER_STATE_ON_RECOVERY],i[n.TYPE]=a.PD_ENTITY_TYPES.VM,i[n.APP_CONSISTENT_SNAPSHOTS]=t[n.APP_CONSISTENT_SNAPSHOTS],_.contains(this.get(u.AUTO_ADDED_ARRAY),t[n.VM_ID])&&(i[u.IS_AUTO_ADDED]=!0),i[n.RELATED_ENTITY_UUIDS]=t[n.RELATED_ENTITY_UUIDS]||[],e.push(i)},this),_.each(this.get(n.PD_VGS),function(t){var i={};i[n.ID]=t[n.VG_UUID]||"",i[n.NAME]=t[n.NAME]||"",i[n.VM_CONSISTENCY_GROUP]=t[n.VM_CONSISTENCY_GROUP],i[n.VM_POWER_STATE_ON_RECOVERY]="",i[n.TYPE]=a.PD_ENTITY_TYPES.VG,_.contains(this.get(u.AUTO_ADDED_ARRAY),t[n.VG_UUID])&&(i[u.IS_AUTO_ADDED]=!0),i[n.RELATED_ENTITY_UUIDS]=t[n.RELATED_ENTITY_UUIDS]||[],e.push(i)},this),e},getFormattedNextSnapshotTime:function(){var e=this.get(n.PD_NEXT_SNAPSHOT_TIME);return e?l.formatDateTime(e>0?e/1e3:0):"Not Scheduled"},getValue:function(t){var i=void 0;switch(t){case n.NUM_VMS:i=this.getVMCount();break;case n.PD_NEXT_SNAPSHOT_FORMATTED:i=this.getFormattedNextSnapshotTime();break;case n.PD_SPACE_USAGE:var s=this.get(n.USAGE_STATS);i=(s&&s[n.PD_EXCLUSIVE_USAGE_IN_BYTES]?Number(s[n.PD_EXCLUSIVE_USAGE_IN_BYTES]):0)+(s&&s[n.PD_LWS_STORE_USED_IN_BYTES]?Number(s[n.PD_LWS_STORE_USED_IN_BYTES]):0)+(s&&s[n.PD_HYDRATION_SPACE_IN_BYTES]?Number(s[n.PD_HYDRATION_SPACE_IN_BYTES]):0);break;default:i=e.prototype.getValue.apply(this,arguments)}return i},createPD:function(e,t,n){var a=s.getFormattedURL(i.PROTECTION_DOMAIN),r=this;$.ajax({type:"POST",url:a,contentType:"application/json; charset=UTF-8",data:o.convertPrimitiveToJSON(e,!0),statusCode:this.getStatusCode(),success:function(e,i,n){t(e)},error:function(e,t,i){var s=r._errorMsg(e,t,o.safeStringify(i));n(s)}})},fetchConsistencyGroups:function(e,t){var a=i.PROTECTION_DOMAIN,r=s.getFormattedURL(a+"/"+this.get(this.nameAttribute)+"/consistency_groups"),l=this;$.ajax({type:"GET",url:o.cacheBustURL(r),contentType:"application/json; charset=UTF-8",statusCode:this.getStatusCode(),success:function(t,i,s){l.set(n.SNAP_CONSISTENCY_GRPS,t),e(t)},error:function(e,i,n){var s=l._errorMsg(e,i,o.safeStringify(n));t(s)}})},fetchUnprotectedVMs:function(e,t){var r=s.getFormattedURL(i.PD_UNPROTECTED_VMS),l=this;$.ajax({type:"GET",url:o.cacheBustURL(r),contentType:"application/json; charset=UTF-8",statusCode:this.getStatusCode(),success:function(t,i,s){t=_.filter(t,function(e){return e.vmType!==a.VM_TYPES.AFS});var r=t.map(function(e){return{name:e[n.VM_NAME]||"",id:e[n.VM_ID]||"",type:a.PD_ENTITY_TYPES.VM}});e(r)},error:function(e,i,n){var s=l._errorMsg(e,i,o.safeStringify(n));t(s)}})},fetchUnprotectedVGs:function(e,t){var r=s.getFormattedURL(i.PD_UNPROTECTED_VGS),l=this;$.ajax({type:"GET",url:o.cacheBustURL(r),contentType:"application/json; charset=UTF-8",statusCode:this.getStatusCode(),success:function(t,i,s){var r=[];t.entities&&(t=t.entities),r=t.map(function(e){return{id:e[n.UUID],name:e[n.NAME],type:a.PD_ENTITY_TYPES.VG}}),e(r)},error:function(e,i,n){var s=l._errorMsg(e,i,o.safeStringify(n));t(s)}})},getConsistencyGroupNames:function(){for(var e=[],t=this.get(n.SNAP_CONSISTENCY_GRPS)||[],i=0;i<t.length;i++)t[i][n.APP_CONSISTENT_SNAPSHOTS]||e.push(t[i][n.VM_CONSISTENCY_GROUP_NAME]);return e},isAppConsistentSnapshotCG:function(e){for(var t=this.get(n.SNAP_CONSISTENCY_GRPS)||[],i=0;i<t.length;i++)if(t[i][n.VM_CONSISTENCY_GROUP_NAME]===e)return t[i][n.APP_CONSISTENT_SNAPSHOTS];return!1},migrate:function(e,t,n){
var a=s.getFormattedURL(_.template(i.PD_MIGRATE,{name:this.get(this.nameAttribute)})),r=this;$.ajax({type:"POST",url:a,contentType:"application/json; charset=UTF-8",data:o.convertPrimitiveToJSON(e,!0),statusCode:this.getStatusCode(),success:function(e,i,n){t(e)},error:function(e,t,i){var s=r._errorMsg(e,t,o.safeStringify(i));n(s)}})},protect:function(e,t,r,l,c,d){var h=i.PROTECTION_DOMAIN,p=s.getFormattedURL(h+"/"+this.get(this.nameAttribute)+"/add_entities"),T=[],E=[];_.each(e,function(e){e.type===a.PD_ENTITY_TYPES.VM?T.push(e.id):E.push(e.id)});var S={vmAddRemoveType:T.length>0?"LISTED_VMS":"NO_VMS",protectionDomainName:this.get(this.nameAttribute),vmIds:T,volumeGroupUuids:E,appConsistentSnapshots:r,protectRelatedEntities:l};t&&(S.consistencyGroupName=t);var g=this;$.ajax({type:"POST",url:p,data:JSON.stringify(S),contentType:"application/json; charset=UTF-8",statusCode:this.getStatusCode(),success:function(t,i,s){g.set(u.AUTO_ADDED_ARRAY,[]);var a=_.pluck(e,"id"),r=_.flatten(_.pluck(t[n.PD_VMS],n.RELATED_ENTITY_UUIDS)),o=_.flatten(_.pluck(t[n.PD_VGS],n.RELATED_ENTITY_UUIDS)),l=_.uniq(_.union(r,o));l=_.difference(l,a),_.each(t[n.PD_VMS],function(e){_.contains(a,e[n.VM_ID])||_.contains(l,e[n.VM_ID])&&g.get(u.AUTO_ADDED_ARRAY).push(e[n.VM_ID])}),_.each(t[n.PD_VGS],function(e){_.contains(a,e[n.VG_UUID])||_.contains(l,e[n.VG_UUID])&&g.get(u.AUTO_ADDED_ARRAY).push(e[n.VG_UUID])}),g.set(n.PD_VMS,t[n.PD_VMS]),g.set(n.PD_VGS,t[n.PD_VGS]),c(t)},error:function(e,t,i){var n=g._errorMsg(e,t,o.safeStringify(i));d(n)}})},unprotect:function(e,t,r){var l=this,c=i.PROTECTION_DOMAIN,u=s.getFormattedURL(c+"/"+this.get(this.nameAttribute)+"/remove_entities"),d=[],h=[];_.each(e,function(e){if(_.isString(e)){var t=e;if(void 0===(e=_.find(l.getProtectedEntities(),function(e){return e[n.ID]===t})))return void o.log("ProtectionDomainModel: entity cannot be found: "+t)}e.type===a.PD_ENTITY_TYPES.VM?d.push(e[n.ID]):h.push(e[n.ID])});var p={vmAddRemoveType:d.length>0?a.PD_VM_ADD_REMOVE_TYPES.LISTED_VMS:a.PD_VM_ADD_REMOVE_TYPES.NO_VMS,protectionDomainName:this.getName(),vmIds:d,volumeGroupUuids:h};$.ajax({type:"POST",url:u,data:JSON.stringify(p),contentType:"application/json; charset=UTF-8",statusCode:this.getStatusCode(),success:function(e,i,n){t(e)},error:function(e,t,i){var n=l._errorMsg(e,t,o.safeStringify(i));r(n)}})},replicate:function(e,t,a,r,l,c){var u=i.PROTECTION_DOMAIN,d=s.getFormattedURL(u+"/"+this.get(this.nameAttribute)+"/oob_schedules"),h={remoteSiteNames:e,scheduleStartTimeUsecs:t,snapshotRetentionTimeSecs:a};null!==r&&(h[n.SCHEDULE_APP_CONSISTENT]=r);var p=this;$.ajax({type:"POST",url:d,data:JSON.stringify(h),contentType:"application/json; charset=UTF-8",statusCode:this.getStatusCode(),success:function(e,t,i){l(e)},error:function(e,t,i){var n=p._errorMsg(e,t,o.safeStringify(i));c(n)}})},enableMetroAvailability:function(e,t,n){var r=s.getFormattedURL(_.template(i.ENABLE_METRO_AVAIL_PD)({pdName:this.get(this.nameAttribute)})),l=this;this.actionMode=a.ACTION_CREATE,$.ajax({type:"POST",url:r,data:JSON.stringify(e),contentType:"application/json; charset=UTF-8",statusCode:this.getStatusCode(),success:this.getOptionsSuccessFunction(this,a.ACTION_CREATE,t),error:function(e,t,i){var s=l._errorMsg(e,t,o.safeStringify(i));n(s)}})},metroAvailAction:function(e,t){if(e===a.ACTION_ENABLE_METRO_AVAIL)return void o.log("ProtectionDomainModel: Unsupported action: "+e);var r=this,l=function(e,t,i){var n=r._errorMsg(e,t,o.safeStringify(i));r.showClientNotification(a.NOTIFY_ERROR,n)};this.actionMode=e;var c=void 0,u={},d="POST";if(e===a.ACTION_UPDATE_FAILURE)c=s.getFormattedURL(_.template(i.FAILURE_HANDLING_PD)({pdName:this.get(this.nameAttribute)})),d="PUT",u={localOnly:!1,failureHandlingMode:this.getMetroWitnessFailureHandling()};else if(e===a.ACTION_RENABLE_METRO_AVAIL)c=s.getFormattedURL(_.template(i.RE_ENABLE_METRO_AVAIL_PD)({pdName:this.get(this.nameAttribute)}));else{var h=i.PROTECTION_DOMAIN;if(c=s.getFormattedURL(h+"/"+this.get(this.nameAttribute)+"/"+e),e===a.ACTION_PROMOTE&&t){var p=o.getQueryStringParamDelimiter(c);this.getMetroAvailStatus()===a.PD_METRO_AVAIL_STATUS.ENABLED?c+=p+"force=true":c+=p+"skipRemoteCheck=true"}u={protection_domain_name:this.get(n.PD_NAME)}}return $.ajax({type:d,url:c,data:JSON.stringify(u),contentType:"application/json; charset=UTF-8",statusCode:this.getStatusCode(),success:this.getOptionsSuccessFunction(this,a.ACTION_UPDATE),error:l})},_errorMsg:function(e,t,i){var n=i;return e&&e.responseText&&e.responseText.length>0&&(n=o.processAjaxError(e.responseText)),n},getLastSuccessfulReplicationLinks:function(){return(this.get(n.RS_REPLICATION_LINKS)||[]).filter(function(e){return null!==e[n.REP_LAST_REPLICATION_START_TIME]&&null!==e[n.REP_LAST_REPLICATION_END_TIME]})},getMetroWitnessFailureHandling:function(){var e=this.get(n.PD_METRO_AVAIL);return e?e[n.PD_METRO_AVAIL_FAILURE_HANDLING]:null},getFailureHandlingForDisplay:function(){var e=this.get(n.PD_METRO_AVAIL);return e?a.FAILURE_HANDLING_DISPLAY_VALUES[e[n.PD_METRO_AVAIL_FAILURE_HANDLING]]:null},getMetroReplicationStats:function(){var e=this.get(n.PD_SYNC_REPLICATIONS),t=this.get(n.STATS);if(e&&e.length>0){var i=e[0][n.STATS];t&&i?(t[n.STATS_REP_BW_TRANSFERRED]=this.combineTwoStats(t[n.STATS_REP_BW_TRANSFERRED],i[n.PD_SYNC_REPLICATION_TRANSMITTED_BANDWIDTH_KBPS]),t[n.STATS_REP_BW_RECEIVED]=this.combineTwoStats(t[n.STATS_REP_BW_RECEIVED],i[n.PD_SYNC_REPLICATION_RECEIVED_BANDWIDTH_KBPS])):t||(t={},t[n.STATS_REP_BW_TRANSFERRED]=i[n.PD_SYNC_REPLICATION_TRANSMITTED_BANDWIDTH_KBPS],t[n.STATS_REP_BW_RECEIVED]=i[n.PD_SYNC_REPLICATION_TRANSMITTED_BANDWIDTH_KBPS])}return t},combineTwoStats:function(e,t){return r.isValidStats(t)?r.isValidStats(e)?parseInt(e,10)+parseInt(t,10):t:e},validateTimeoutValue:function(e){return isNaN(e)||e<10||e>30?c:null},getMetroMaxTimeoutValue:function(){return 30},getMetroMinTimeoutValue:function(){return 10},getMetroTimeoutTooltip:function(){return c},getMetroStandbySiteName:function(){var e=this.get(n.PD_METRO_AVAIL);return e?e[n.PD_METRO_AVAIL_REMOTE_SITE]:null},isFileServerPD:function(){var e=this.get(n.PD_ANNOTATIONS);if(e&&e.length){var t=_.first(e);return t&&0===t.indexOf("NTNX-FS")}return!1}})}),define("models/dataprotection/ProtectionDomainCollection",["models/PollingCollection","models/dataprotection/ProtectionDomainModel","data/DataURLConstants"],function(e,t,i){"use strict";return e.extend({model:t,url:i.PROTECTION_DOMAIN,name:"ProtectionDomainCollection",initializeBaseCollection:function(t,i){e.prototype.initializeBaseCollection.apply(this,arguments),i&&i.metroAvail&&(this._parameters.metroAvail="true"===i.metroAvail)}})}),define("managers/ModelInstanceManager",["models/vm/VMCollection","models/hardware/HostCollection","models/hardware/DiskCollection","models/alert/AlertCollection","models/dataprotection/ProtectionDomainCollection","models/query/BaseQueryModel","utils/AppUtil"],function(e,t,i,n,s,a,r){"use strict";var o={VMS:"VMS",HOSTS:"HOSTS",DISKS:"DISKS",ALERTS:"ALERTS",PDS:"PDS",QUERY_MODEL:"QUERY_MODEL"},l={};return l[o.VMS]=e,l[o.HOSTS]=t,l[o.DISKS]=i,l[o.ALERTS]=n,l[o.PDS]=s,l[o.QUERY_MODEL]=a,{modelsMap:{},registerFactoryInstance:function(e){var t=e.factoryId;this.modelsMap[t]||(this.modelsMap[t]={})},getCollection:function(e,t){return!this.modelsMap[e][t]&&l[t]?this.modelsMap[t]=new l[t]:r.log("APIManager: We only support the following data types: "+o.join(",")),this.modelsMap[t]},getModel:function(e,t,i){var n=this.getCollection(e,t);if(n&&n.model){var s=n.model,a=new s;return a.set(s.idAttribute,i),a}},setPrismAppModel:function(e,t){this.modelsMap[e][t.appId]=t},getPrismAppModel:function(e,t){return this.modelsMap[e][t]}}}),define("utils/ExploreConstants",["utils/AppConstants"],function(e){"use strict";function t(){return i+Array.prototype.slice.call(arguments).join("/")}var i="page/";return{ROUTES:{EBROWSER:"ebrowser",EXPLORE:"explore",SETTINGS:"settings",ENTITIES:"entities",APPS:"apps",SEARCH:"s",PAGE_PREFIX:i,SETTINGS_PREFIX:"settings ",APPS_PREFIX:"/apps/",DASHBOARD_PAGE:t("pc_dashboard"),EBROWSER_PAGE:t("ebrowser"),EBROWSER_ENTITIES_PAGE:t("ebrowser","entities"),EXPLORE_PAGE:t("explore")},QUERY_CONTEXT:{FILTER_ONLY_UPDATE:"filterOnlyUpdate",LOGICAL_AND:"logical_operator=AND",PERSPECTIVE:"perspective"},STORAGE_CONTAINER:"storage container",EB_FILTER:{SEARCH_FILTER_CHANGE:"SEARCH_FILTER_CHANGE"},TRIGGER_SOURCE:{SEARCH_BOX:"search_box",MAIN_MENU:"menu",LEFT_NAV:"left_nav",USER_ENTER_BEFORE_RESULT:"user_enter_before_result"},EXPLORE_SUBPAGES:["ebrowser","settings","s"],PAGE_ENTITY_TYPE:"any",ENTITY_NAME_TO_USE_UUID:"<entity_name>",REGEX:{ANY_CHAR:"*"},URL_ATTR_DELIMITER:",",URL_QUERY_TERM_KEY_PREFIX:"term_",FILTER_OPERATORS:{CONTAINS:"~",NOTCONTAINS:"!~"},PERSPECTIVE_TYPES:{SUMMARY:"SUMMARY",ENTITIES:"ENTITIES",TOPOLOGY:"TOPOLOGY",EB:"EB",ALERTS:"ALERTS",EVENTS:"EVENTS",METRIC:"METRIC",ENTITY_DETAIL:"ENTITY_DETAIL",ENTITY_INSTANCE_DETAIL:"ENTITY_INSTANCE_DETAIL",NAVIGATION:"NAVIGATION",PROPERTIES:"PROPERTIES",METRIC_CATEGORIES_SUMMARY:"METRIC_CATEGORIES_SUMMARY",TIME_SERIES:"TIME_SERIES"},PROPERTY_TYPE:{PAGE:"page"},LAYOUT_TYPES:{TWO_COLUMN:"TWO_COLUMN",TWO_COLUMN_TALL:"TWO_COLUMN_TALL",ONE_COLUMN:"ONE_COLUMN",FULL_SCREEN:"FULL_SCREEN",EB:"EB"},PERSPECTIVE_TO_LAYOUT_MAPPING:{SUMMARY:"TWO_COLUMN",DETAIL:"FULL_SCREEN",ENTITY_DETAIL:"FULL_SCREEN",ENTITIES:"EB",ALERTS:"EB",EVENTS:"EB",METRIC_CATEGORIES_SUMMARY:"TWO_COLUMN_TALL",PROPERTIES:"TWO_COLUMN",METRICS:"ONE_COLUMN",TIMESERIES:"ONE_COLUMN"},WIDGET_TYPE:{ANOMALY_CHART:"ANOMALY_LAST_DURATION_BREAKDOWN_DATA",EB_EXTERNAL:"EB_EXTERNAL"},WIDGET_ID:{TOP_LEVEL_SUMMARY:"TOP_LEVEL_SUMMARY"},LOADER_TYPE:{TABLE:"TABLE"},SEARCH_PAGE_CLASSES:{EXPLORE_CONTAINER:"exp-container",SEARCH_CONTAINER:"exp-search-container",HIDE_MAIN_NAV:"hide-main-nav",FULL_SCREEN:"full-screen"},LAYOUT_CLASSES:{TWO_COLUMN:"two-col-perspective-container",TWO_COLUMN_TALL:"two-col-perspective-container",ONE_COLUMN:"one-col-perspective-container",FULL_SCREEN:"full-screen-perspective-container",EB:"eb-perspective-container"},LAYOUT:{ONE_COLUMN:"one-column",WRAPPING:"wrapping",EB:"eb"},ALERT_LEVEL:{CRITICAL:"CRITICAL",WARNING:"WARNING",INFO:"INFO",AUDIT:"AUDIT"},ALERT_TYPE:{CRITICAL:"critical",WARNING:"warning",INFO:"info",AUDIT:"audit"},ALERT_SEVERITY_COLOR:{critical:"#F55656",warning:"#ffbc0b",info:"#7C8D9F"},ANOMALY_TYPE:{MEMORY:"memory",IO:"io",CPU:"cpu",NETWORK:"networking",DISK:"disk"},ALERT_SEVERITY_MAP:{kCritical:"critical",kWarning:"warning",kInfo:"info",kAudit:"audit"},DURATION:{LAST_WEEK:"last_1_weeks",LAST_DAY:"last_1_days"},OPERATOR_MAPPING:{contains:"~",cs:"~",eq:"=",ne:"!=",ra:"=",in:"in",gt:">",ge:">=",lt:"<",le:"<=",cateq:"=",startswith:"=",endswith:"=",notcontains:"!~"},CONTEXT_VALUES:{NAME:"name",PERSPECTIVE:"perspective",ENTITIES:"entities",LIST:"list",METRIC:"Metric",ATTRIBUTE:"Attribute"},SEARCH_SUPPORTED_ENTITY_LIST_PERSPECTIVE:[e.ENTITY_VM,e.ENTITY_CLUSTER,e.ENTITY_CONTAINER,e.ENTITY_HOST,e.ENTITY_DISK],SEARCH_SUPPORTED_ENTITY_DETAIL:[e.ENTITY_VM,e.ENTITY_CLUSTER,e.ENTITY_CONTAINER,e.ENTITY_HOST,e.ENTITY_DISK],SEARCH_SUPPORTED_ENTITY_TYPES:[e.ENTITY_VM,e.ENTITY_CLUSTER,e.ENTITY_CONTAINER,e.ENTITY_HOST,e.ENTITY_DISK,e.ENTITY_ALERT,e.ENTITY_EVENT],DISPLAY_CONTEXT_PROPERTY_TYPES:{PERSPECTIVE:"perspective",ATTRIBUTE:"attribute",PAGE:"page"},MATCH_TYPES:{EXACT:"exact",PREFIX:"prefix"},SEARCH_CONTEXT_HISTORY_OP:{PUSH:"push",POP:"pop",RESET:"reset"},SYNONYM:"synonym",I18N_KEY:"Search",CREATE_TIME:"create_time",OVER_PROVISIONED:"over provisioned"}}),define("text!extras/docs/help_url_prism_element.json",[],function(){return'[\n    {\n        "base": "https://portal.nutanix.com/#/page/prismDocs?",\n        "default": "https://portal.nutanix.com/#/page/prismDocs?",\n        "kbBase": "https://portal.nutanix.com/kb/",\n        "kbIdMap": {"prismElementIFrameBroken": "1842"},\n        "pages": {\n            "alerts": {\n                "default": "wc-alerts-dashboard-wc-r.html",\n                "events": "wc-alerts-event-view-wc-r.html",\n                "messages": "wc-alerts-alert-view-wc-r.html"\n            },\n            "analysis": {"default": "wc-analysis-dashboard-wc-r.html"},\n            "clusterh": {"default": "wc-health-dashboard-wc-r.html"},\n            "dashboard": {"default": "wc-home-dashboard-wc-r.html"},\n            "dr": {\n                "default": "wc-dr-dashboard-wc-r.html",\n                "overview": "wc-dr-overview-view-wc-r.html",\n                "table": "wc-dr-table-view-wc-r.html"\n            },\n            "hardware": {\n                "default": "wc-hardware-dashboard-wc-r.html",\n                "diagram": "wc-hardware-diagram-view-wc-r.html",\n                "overview": "wc-hardware-overview-view-wc-r.html",\n                "table": "wc-hardware-table-view-wc-r.html"\n            },\n            "overview": {"default": "wc-overview-wc-r.html"},\n            "storage": {\n                "default": "wc-storage-dashboard-wc-r.html",\n                "diagram": "wc-storage-diagram-view-wc-r.html",\n                "overview": "wc-storage-overview-view-wc-r.html",\n                "table": "wc-storage-table-view-wc-r.html"\n            },\n            "tasks": {"default": "wc-task-status-c.html"},\n            "vm": {"default": "wc-vm-dashboard-wc-r.html"},\n            "vms": {\n                "overview": "wc-vm-overview-view-wc-r.html",\n                "table": "wc-vm-table-view-wc-r.html"\n            },\n            "lcm": {\n                "default": "lcm-lcm-c.html",\n                "overview": "cm-lcm-update-t.html"\n            }\n        },\n        "popups": {\n            "acropolis_image": {"create": "wc-image-configure-acropolis-wc-t.html"},\n            "acropolis_network": {\n                "create": "wc-system-nework-configuration-acropolis-wc-t.html",\n                "update": "wc-system-network-modify-acropolis-wc-t.html"\n            },\n            "acropolis_volume_group": {\n                "create": "wc-volume-group-create-wc-t.html",\n                "update": "wc-volume-group-modify-wc-t.html"\n            },\n            "alert_policy": {"default": "wc-alert-policies-wc-t.html"},\n            "alertservices": {"default": "wc-alert-email-enable-wc-t.html"},\n            "asup": {"default": "wc-support-smart-support-wc-t.html"},\n            "async_pd": {\n                "create": "wc-protection-domain-wc-c.html",\n                "migrate": "wc-protection-domain-edit-wc-t.html",\n                "replicate": "wc-protection-domain-edit-wc-t.html",\n                "update": "wc-protection-domain-edit-wc-t.html"\n            },\n            "auth_config": {"default": "wc-security-authentication-wc-t.html"},\n            "change_password": {"default": "wc-user-current-update-wc-t.html"},\n            "citrix_connector": {"show": "wc-cloud-connection-citrix-t.html"},\n            "cloud_aws": {"create": "wc-remote-site-configuration-c.html"},\n            "cluster": {\n                "convert": "man-cluster-conversion-c.html",\n                "default": "wc-cluster-details-modify-wc-t.html",\n                "fetch": "wc-logs-collection-ncc-web-console-wc-t.html",\n                "run_check": "wc-ncc-checks-using-web-console-t.html",\n                "set_ncc_frequency": "wc-ncc-frequency-configuration-t.html",\n                "unregister": "mul-register-wc-t.html",\n                "update": "wc-cluster-modify-wc-t.html"\n            },\n            "cluster_add": {"default": "mul-register-wc-t.html"},\n            "cluster_lockdown": {"default": "wc-security-cluster-lockdown-wc-t.html"},\n            "container": {\n                "create": "wc-container-create-wc-t.html",\n                "update": "wc-container-modify-wc-t.html"\n            },\n            "cvm_config": {"cvm_config": "wc-controller-vm-memory-increase-wc-t.html"},\n            "degraded_node": {"show": "man-node-degraded-management-t.html"},\n            "enable_pulse": {"default": "wc-support-smart-support-wc-t.html"},\n            "encryption": {"create": "wc-security-data-encryption-wc-c.html"},\n            "entity_chart": {"create": "wc-create-entity-chart-wc-t.html"},\n            "failover_cluster": {"default": "hyp-hyperv-failover-cluster-t.html"},\n            "health_checks": {"manage": "wc-health-checks-confiugre-wc-t.html"},\n            "high_availability": {"default": "ahv-acropolis-cluster-setting-ha-t.html"},\n            "host": {\n                "default": "wc-cluster-expand-wc-t.html",\n                "hypervisor_rolling_reboot": "wc-request-reboot-wc-t.html",\n                "repair": "bre-boot-disk-repair-graceful-t.html",\n                "showNetworkEntityDetails": "wc-host-view-in-network-visualizer-t.html"\n            },\n            "http_proxy": {"default": "wc-support-http-proxies-wc-t.html"},\n            "hyperv_domain_join": {"default": "hyp-host-join-domain-t.html"},\n            "kerberos_config": {"default": "hyp-kerberos-enable-t.html"},\n            "language-settings": {"update": "wc-cluster-language-settings-change-wc-t.html"},\n            "lcm_entity": {\n                "default": "lcm-lcm-c.html",\n                "inventory": "lcm-lcm-inventory-t.html",\n                "update": "lcm-lcm-update-t.html"\n            },\n            "licensing": {\n                "default": "lic-licensing-managing-c.html",\n                "manage": "lic-licensing-install-new-t.html"\n            },\n            "management_server": {"show": "wc-vcenter-server-register-t.html"},\n            "metric_chart": {"create": "wc-create-metric-chart-wc-t.html"},\n            "metro_availability_pd": {"default": "wc-protection-domain-ma-wc-t.html"},\n            "name_server": {"default": "wc-system-name-servers-wc-t.html"},\n            "network_switch": {\n                "default": "wc-system-network-switches-wc-t.html",\n                "showNetworkEntityDetails": "wc-switch-level-information-view-in-network-visualizer-t.html"\n            },\n            "network_switch_interface": {"showNetworkEntityDetails": "wc-switch-interface-level-information-view-in-network-visualizer-t.html"},\n            "nfs_whitelist": {"default": "wc-system-filesystem-whitelists-wc-t.html"},\n            "ntp_server": {"default": "wc-system-ntp-servers-wc-t.html"},\n            "prism_central_vm": {"deploy": "mul-pc-install-cluster-internet-t.html"},\n            "prism_pem_key": {"default": "wc-security-ssl-certificate-wc-t.html"},\n            "redundancy_state": {"show": "wc-cluster-fault-tolerance-update-ui-t.html"},\n            "remote_site": {\n                "create": "wc-remote-site-wc-t.html",\n                "update": "wc-remote-site-edit-wc-t.html"\n            },\n            "remote_support": {"default": "wc-support-enable-wc-t.html"},\n            "resiliency_status": {"default": "wc-home-dashboard-wc-r.html"},\n            "role_mapping": {"default": "wc-security-role-permissions-wc-t.html"},\n            "smtp_server": {"default": "wc-system-smtp-server-wc-t.html"},\n            "snapshot": {"restore": "wc-vm-restore-wc-t.html"},\n            "snmp": {"default": "wc-system-snmp-wc-t.html"},\n            "storage_pool": {\n                "create": "wc-storage-pool-create-wc-t.html",\n                "update": "wc-storage-pool-modify-wc-t.html"\n            },\n            "system_data_welcome_banner": {"default": "wc-system-welcome-banner-wc-t.html"},\n            "ui_settings": {"default": "wc-ui-settings-modify-wc-t.html"},\n            "update_profile": {"default": "wc-user-current-update-wc-t.html"},\n            "upgrade": {"upgrade": "wc-cluster-nos-upgrade-intro-wc-r.html"},\n            "user": {"default": "wc-user-create-wc-t.html"},\n            "version": {"default": "wc-cluster-version-display-wc-t.html"},\n            "vm": {\n                "clone": "wc-vms-create-main-topic-c.html",\n                "create": "wc-vms-create-main-topic-c.html",\n                "manage_ngt": "wc-vms-create-main-topic-c.html",\n                "migrate": "wc-vm-manage-acropolis-wc-t.html",\n                "power_cycle": "wc-vms-create-main-topic-c.html",\n                "power_off": "wc-vms-create-main-topic-c.html",\n                "power_on": "wc-vms-create-main-topic-c.html",\n                "power_reset": "wc-vms-create-main-topic-c.html",\n                "showNetworkEntityDetails": "wc-vm-view-in-network-visualizer-t.html",\n                "snapshot": "wc-vm-manage-acropolis-wc-t.html",\n                "update": "wc-vms-create-main-topic-c.html"\n            },\n            "witness_add": {"show": "sto-metro-availability-witness-register-t.html"}\n        }\n    },\n    {\n        "base": "https://portal.nutanix.com/#/page/prismDocs?",\n        "default": "afs-file-server-wc-c.html",\n        "kbBase": "https://portal.nutanix.com/kb/",\n        "pages": {"file_server": {"default": "afs-file-server-dashboard-wc-r.html"}},\n        "popups": {\n            "file_server": {\n                "activate_file_server": "afs-file-server-activate-wc-t.html",\n                "add_admins": "afs-file-server-admin-permissions-t.html",\n                "add_dns": "afs-file-server-add-dns-t.html",\n                "antivirus_setup": "afs-file-server-anti-virus-enable-t.html",\n                "create": "afs-file-server-create-wc-t.html",\n                "delete": "afs-file-server-delete-t.html",\n                "expand_file_server": "afs-file-server-update-wc-t.html",\n                "file_server_clone": "afs-file-server-clone-c.html",\n                "fs_user_management": "afs-file-server-update-user-management-t.html",\n                "join_domain": "afs-file-server-join-domain-wc-t.html",\n                "load_balance": "afs-file-server-load-balance-configure-wc-t.html",\n                "protect": "afs-file-server-enable-ssr-t.html",\n                "share_create": "afs-file-server-create-share-export-c.html",\n                "unjoin_domain": "afs-file-server-leave-domain-wc-t.html",\n                "update": "afs-file-server-update-wc-t.html"\n            },\n            "file_server_share": {\n                "add_quota_policy": "afs-file-server-quotas-c.html",\n                "antivirus_setup": "afs-file-server-anti-virus-enable-t.html",\n                "create": "afs-file-server-create-share-export-c.html",\n                "delete": "afs-file-share-export-update-t.html",\n                "update": "afs-file-share-export-update-t.html"\n            },\n            "file_server_share_quotas": {"default": "afs-file-server-quotas-set-wc-t.html"}\n        }\n    }\n]'}),define("text!extras/docs/help_url_prism_central.json",[],function(){
return'{\n    "base": "https://portal.nutanix.com/#/page/prismDocs?",\n    "default": "mul-intro-landing-page-pc-c.html",\n    "kbBase": "https://portal.nutanix.com/kb/",\n    "details": {\n        "abac_user_capability": {"default": "mul-explore-user-details-view-pc-r.html"},\n        "alert": {"default": "mul-alert-details-pc-r.html"},\n        "category": {"default": "mul-explore-category-details-view-pc-r.html"},\n        "cluster": {"default": "mul-explore-cluster-details-view-pc-r.html"},\n        "container": {"default": "mul-explore-container-details-view-pc-r.html"},\n        "disk": {"default": "mul-explore-disk-details-view-pc-r.html"},\n        "host": {"default": "mul-explore-host-details-view-pc-r.html"},\n        "host_gpu": {"default": "mul-explore-gpu-details-view-pc-r.html"},\n        "network_security_rule": {"default": "mul-quarantine-category-configure-for-forensics-pc-t.html"},\n        "project": {"default": "mul-explore-project-details-view-pc-r.html"},\n        "role": {"default": "mul-explore-role-details-view-pc-r.html"},\n        "scenario": {"default": "mul-resource-planning-scenario-create-pc-t.html"},\n        "vm": {"default": "mul-explore-vm-details-view-pc-r.html"}\n    },\n    "kbIdMap": {"prismElementIFrameBroken": "1842"},\n    "pages": {\n        "alert_explorer": {\n            "default": "mul-alerts-dashboard-pc-r.html",\n            "events": "mul-alerts-event-view-pc-r.html",\n            "messages": "mul-alerts-alert-view-pc-r.html"\n        },\n        "analysis": {"default": "mul-analysis-dashboard-pc-r.html"},\n        "apps": {"default": "mul-applications-management-pc-c.html"},\n        "ebrowser": {"default": "mul-explore-dashboard-pc-c.html"},\n        "pc_dashboard": {"default": "mul-home-dashboard-pc-r.html"},\n        "planning": {\n            "default": "mul-resource-planning-pc-c.html",\n            "runway": "mul-resource-planning-runway-view-pc-r.html",\n            "scenario": "mul-resource-planning-scenario-view-pc-r.html"\n        },\n        "tasks": {"default": "mul-tasks-view-page-pc-r.html"},\n        "lcm": {\n            "default": "lcm-lcm-c.html",\n            "overview": "cm-lcm-update-t.html"\n        }\n    },\n    "popups": {\n        "abac_user_capability": {"default": "mul-user-manage-pc-t.html"},\n        "acropolis_network": {\n            "create": "mul-network-configuration-acropolis-pc-t.html",\n            "update": "mul-network-modify-acropolis-pc-t.html"\n        },\n        "alert_configuration": {"default": "mul-alert-emails-configure-pc-t.html"},\n        "alert_policy": {"default": "mul-alert-policies-configure-pc-t.html"},\n        "asup": {"default": "mul-pulse-configure-pc-t.html"},\n        "auth_config": {"default": "mul-security-authentication-pc-t.html"},\n        "category": {\n            "create": "ssp-ssp-category-create-pc-t.html",\n            "delete": "ssp-ssp-category-modify-pc-t.html",\n            "update-category": "ssp-ssp-category-modify-pc-t.html"\n        },\n        "change_password": {"default": "mul-user-current-update-pc-t.html"},\n        "cluster": {\n            "showCPRecommendations": "mul-explore-cluster-details-view-pc-r.html",\n            "showCPWhatIfAnalysis": "mul-explore-cluster-details-view-pc-r.html",\n            "ssp_config": "ssp-ssp-migrate-pc-t.html",\n            "unregister": "mul-register-wc-t.html",\n            "unregister_cluster": "mul-register-wc-t.html",\n            "update_cluster": "mul-pc-cluster-aos-upgrade-c.html"\n        },\n        "cluster_lockdown": {"default": "mul-security-cluster-lockdown-pc-t.html"},\n        "cp_alert_policy": {"default": "mul-capacity-sizing-configure-pc-t.html"},\n        "dashboard": {\n            "create": "mul-dashboard-create-pc-t.html",\n            "reset": "mul-dashboard-modify-pc-t.html"\n        },\n        "dashboard_vp_add": {"addWidget": "mul-dashboard-widgets-pc-r.html"},\n        "directory_service": {\n            "create": "ssp-ssp-configure-pc-t.html",\n            "enable_app_orchestration": "mul-calm-configure-pc-t.html",\n            "enable_microseg": "mul-microseg-enable-t.html",\n            "manage_administrators": "ssp-ssp-configure-modify-pc-t.html"\n        },\n        "entity_chart": {"create": "mul-create-entity-chart-pc-t.html"},\n        "host": {"assign-entity-categories": "ssp-ssp-category-assign-pc-t.html"},\n        "http_proxy": {"default": "mul-http-proxy-configure-pc-t.html"},\n        "image": {\n            "create": "mul-image-add-pc-t.html",\n            "delete": "mul-image-modify-pc-t.html",\n            "update": "mul-image-modify-pc-t.html"\n        },\n        "image_info": {"migrate": "mul-image-import-pc-t.html"},\n        "language-settings": {"update": "mul-cluster-language-settings-change-pc-t.html"},\n        "licensing": {"default": "lic-licensing-managing-c.html"},\n        "management_server": {"show": "mul-vcenter-server-register-pc-t.html"},\n        "marketplace_item": {"create": "mul-catalog-item-add-pc-t.html"},\n        "metric_chart": {"create": "mul-create-metric-chart-pc-t.html"},\n        "name_server": {"default": "mul-name-servers-configure-pc-t.html"},\n        "network_security_rule": {\n            "apply": "mul-security-policy-assign-pc-t.html",\n            "create": "mul-security-policy-create-secure-app-pc-t.html",\n            "delete": "mul-explore-security-policies-view-pc-r.html",\n            "edit_rule": "mul-security-policy-modify-pc-t.html",\n            "monitor": "mul-security-policy-monitor-pc-t.html"\n        },\n        "ntp_server": {"default": "mul-ntp-servers-configure-pc-t.html"},\n        "portal_configuration": {"default": "lic-licensing-portal-connection-c.html"},\n        "prism_central": {"add": "mul-pc-monitor-r.html"},\n        "prism_central_vm": {\n            "create_pc": "mul-pc-install-cluster-internet-t.html",\n            "deploy": "mul-pc-install-cluster-internet-t.html",\n            "scale_pc": "mul-pc-scale-out-t.html",\n            "show": "mul-pc-monitor-r.html"\n        },\n        "prism_pem_key": {"default": "mul-security-ssl-certificate-pc-t.html"},\n        "project": {\n            "create": "ssp-ssp-project-create-pc-t.html",\n            "delete": "ssp-ssp-project-modify-pc-t.html",\n            "update": "ssp-ssp-project-modify-pc-t.html"\n        },\n        "report": {\n            "bar_chart": "ssp-report-widgets-bar-chart-ssp-pc-t.html",\n            "config_summary": "ssp-report-widgets-configuration-summary-pc-t.html",\n            "count_summary": "ssp-report-widgets-entity-count-pc-t.html",\n            "edit": "ssp-report-managing-t.html",\n            "histogram": "ssp-report-widgets-bar-chart-ssp-pc-t.html",\n            "instance": "ssp-report-view-ssp-pc-t.html",\n            "line_chart": "ssp-report-widgets-bar-chart-ssp-pc-t.html",\n            "metric_summary": "ssp-report-widget-metric-summary-pc-t.html",\n            "run": "ssp-report-creation-new-t.html",\n            "schedule": "ssp-report-scheduling-pc-t.html",\n            "section": "ssp-report-widgets-group-ssp-pc-t.html",\n            "settings": "ssp-report-settings-configuration-pc-t.html",\n            "table": "ssp-report-widgets-data-table-pc-t.html",\n            "text": "ssp-report-widgets-title-description-pc-t.html"\n        },\n        "role": {\n            "create": "ssp-ssp-role-create-pc-t.html",\n            "delete": "ssp-ssp-role-modify-pc-t.html",\n            "update": "ssp-ssp-role-modify-pc-t.html"\n        },\n        "role_mapping": {"default": "mul-security-role-permissions-pc-t.html"},\n        "smtp_server": {"default": "mul-smtp-server-configure-pc-t.html"},\n        "snmp": {"default": "mul-snmp-configure-pc-t.html"},\n        "support_case": {"create": "mul-support-case-create-pc-t.html"},\n        "system_data_welcome_banner": {"update": "mul-welcome-banner-configure-pc-t.html"},\n        "ui_settings": {"update": "mul-ui-settings-modify-pc-t.html"},\n        "update_profile": {"default": "mul-user-current-update-pc-t.html"},\n        "upgrade": {"upgrade": "mul-upgrade-wc-t.html"},\n        "user": {"default": "mul-user-manage-pc-t.html"},\n        "user_defined_alert_policy": {\n            "create": "mul-alert-policies-user-defined-configure-pc-c.html",\n            "update": "mul-alert-policies-user-defined-configure-pc-c.html"\n        },\n        "version": {"default": "mul-pc-version-display-pc-t.html"},\n        "vm": {\n            "add_blueprint": "mul-vm-create-manage-pc-c.html",\n            "affinity": "mul-vm-create-manage-pc-c.html",\n            "assign-entity-categories": "ssp-ssp-category-assign-pc-t.html",\n            "clone": "mul-vm-create-manage-pc-c.html",\n            "create": "mul-vm-create-manage-pc-c.html",\n            "delete": "mul-vm-create-manage-pc-c.html",\n            "disable_ngt": "mul-vm-create-manage-pc-c.html",\n            "edit": "mul-vm-create-manage-pc-c.html",\n            "enable_ngt": "mul-vm-create-manage-pc-c.html",\n            "launch_console": "mul-vm-create-manage-pc-c.html",\n            "migrate": "mul-vm-create-manage-pc-c.html",\n            "pause": "mul-vm-create-manage-pc-c.html",\n            "quarantine-vms": "mul-vm-create-manage-pc-c.html",\n            "resume": "mul-vm-create-manage-pc-c.html",\n            "snapshot": "mul-vm-create-manage-pc-c.html",\n            "update": "mul-vm-create-manage-pc-c.html",\n            "update.change_owner": "mul-vm-create-manage-pc-c.html",\n            "vm_create_wrapper": "mul-vm-create-manage-pc-c.html"\n        },\n        "vmbl": {"increase_pc_resources": "mul-pc-memory-increase-t.html"}\n    },\n    "search": {"default": "mul-search-options-pc-r.html"}\n}'}),define("managers/HelpManager",["managers/BaseManager","managers/ActionManager","managers/ClusterManager","utils/AppConstants","utils/ExploreConstants","utils/AppUtil","data/DataURLConstants","text!extras/docs/help_url_prism_element.json","text!extras/docs/help_url_prism_central.json"],function(e,t,i,n,s,a,r,o,l){"use strict";return e.extend({DP:{BASE:"base",DEFAULT:"default",DETAILS:"details",PAGES:"pages",POPUPS:"popups",KB_BASE:"kbBase",KB_ID_MAP:"kbIdMap",SEARCH:"search"},MAP_KB_ID:{PRISM_ELEMENT_IFRAME_BROKEN:"1842"},name:"HelpManager",_initialized:!1,prismElementHelpURLs:null,prismCentralHelpURLs:null,initialize:function(){this._initialized||(this.addToManagerHelper(),this._initialized=!0)},getHelpUrlForPage:function(e,t){return this.searchTarget({path:[this.DP.PAGES,e,t],options:{useDefaultValues:!0,urlBase:this.DP.BASE}}).url},getHelpUrlForKB:function(e){return this.searchTarget({path:[this.DP.KB_ID_MAP,e],options:{useDefaultValues:!0,urlBase:this.DP.KB_BASE}}).url},getHelpUrlForDetails:function(e,t){var i=[this.DP.DETAILS,e];return t&&i.push(t),this.searchTarget({path:i,options:{useDefaultValues:!0,urlBase:this.DP.BASE}}).url},getHelpUrlForAction:function(e){if(e){var t=[this.DP.POPUPS,e[n.NAV_ACTION_TARGET]];e[n.NAV_ACTION]&&e[n.NAV_ACTION]!==n.ACTION_SHOW?t.push(e[n.NAV_ACTION]):t.push(n.DOCS_HELP_DEFAULT);return this.searchTarget({path:t,options:{useDefaultValues:!0,urlBase:this.DP.BASE,contextId:e[n.NAV_ACTION_CONTEXT_ID],targetVerion:e[n.NAV_ACTION_TARGET_VERSION]}}).url}},getUrlForGeneralHelp:function(){var e={path:[this.DP.DEFAULT],options:{urlBase:this.DP.BASE}},t=this.searchTarget(e);return t&&t.url&&""!==$.trim(t.url)?t.url:r.DOCS_HELP},getHelpUrlForSearch:function(){var e,t={path:[this.DP.SEARCH,this.DP.DEFAULT],options:{urlBase:this.DP.BASE}},i=this.searchTarget(t);return i&&i.url&&""!==$.trim(i.url)&&(e=i.url),e},navigateToGeneralHelp:function(){var e=this.getUrlForGeneralHelp();t.navigateToURL(decodeURIComponent(e))},navigateToSearchHelp:function(){var e=this.getHelpUrlForSearch();this.navigationToHelpPage(e)},navigateToHelpPageBasedOnCurrentPage:function(){var e=this.getNavigationManager(),t=e.getCurrentPageRoute(),i=t[n.NAV_PAGE_ID],a=void 0,r=t[n.NAV_SUBPAGE_ID];if(this.getExploreManager().isEnableSearchConvergence())if(i===s.ROUTES.EBROWSER)r=this.getExploreManager().getEBViewEntityType();else if(i===s.ROUTES.EXPLORE){var o=this.getExploreSearchManager().getSearchModel().getEntityType(),l=this.getExploreSearchManager().getSearchModel().getEntity();l&&(a=this.getHelpUrlForDetails(o,s.ROUTES.EXPLORE)),r=o}a=a||this.getHelpUrlForPage(i,r),this.navigationToHelpPage(a)},navigateToHelpPageBasedOnAction:function(e){var t=this.getHelpUrlForAction(e);this.navigationToHelpPage(t)},navigateToHelpPageForDetails:function(e){var t=this.getHelpUrlForDetails(e);this.navigationToHelpPage(t)},navigateToHelpPageBasedOnKB:function(e){var t=this.getHelpUrlForKB(e);this.navigationToHelpPage(t)},navigationToHelpPage:function(e){e&&_.isString(e)?t.navigateToURL(e):(a.log("HelpManager : Help link is not specified."),this.navigateToGeneralHelp())},searchTarget:function(e){e=_.defaults(e||{},{path:[],options:{useDefaultValues:!1,urlBase:null}});var t=this.getTargets(),i=this.searchTargetsByPath(t,e.path);if(0===i.length&&!0===e.options.useDefaultValues&&(i=this.getDefaultsByPath(t,e.path)),0===i.length)return null;var n=i[0],s=e.options.urlBase;return 2===e.path.length&&e.path.push(this.DP.DEFAULT),s&&s!==this.DP.DEFAULT&&s!==this.DP.BASE?s===this.DP.KB_BASE&&(n.prism_id=e.path[1]):n.prism_id=e.path.join("/"),n.url=this.getResultURL(n,e.options),n},sortTargetsByPathDepth:function(e,t){for(var i,n,s=[],a=t.length;a>=0;a--){i=t.slice(0,a);for(var r=0;r<e.length;r++)n=e[r],this.getObjectPathCell(n,i)&&-1===_.indexOf(s,n)&&s.push(n)}return s},getDefaultsByPath:function(e,t){for(var i=[],n=this.sortTargetsByPathDepth(e,t),s=0;s<=t.length;s++)i=i.concat(this.searchTargetsByPath(n,t.slice(0,t.length-s).concat([this.DP.DEFAULT])));return i},getObjectPathCell:function(e,t){var i=_.extend({},e);for(var n in t){if(!i||!_.has(i,t[n]))return null;i=i[t[n]]}return i},searchTargetsByPath:function(e,t){var i=[];return _.each(e,function(e){_.has(e,"structure")&&_.has(e,"cell")&&2===_.keys(e).length&&(e=e.structure);var n=this.getObjectPathCell(e,t);n&&!_.isObject(n)&&i.push({structure:e,cell:n})},this),i},getResultURL:function(e,t){var s="",a=["software_type="+(t.contextId?t.contextId:n.DOCS_HELP_SOFTWARE_TYPE_PRISM),"software_version="+(t.targetVerion||i.getCurrentClusterVersion()),"prism_id="+e.prism_id].join("&"),r=void 0;return t.urlBase&&""!==$.trim(t.urlBase)&&_.has(e.structure,t.urlBase)?(r=e.structure[t.urlBase],s=r):s=e.structure[this.DP.DEFAULT],t.urlBase&&t.urlBase!==this.DP.DEFAULT&&t.urlBase!==this.DP.BASE?t.urlBase===this.DP.KB_BASE&&(s+=e.prism_id):s+=a,s},parseTargets:function(){try{this.prismElementHelpURLs=JSON.parse(o),this.prismCentralHelpURLs=JSON.parse(l)}catch(e){a.log("HelpTargetSearch : Error parsing help URL file. "+e),this.prismElementHelpURLs=[],this.prismCentralHelpURLs=[]}_.isArray(this.prismElementHelpURLs)||(this.prismElementHelpURLs=[this.prismElementHelpURLs]),_.isArray(this.prismCentralHelpURLs)||(this.prismCentralHelpURLs=[this.prismCentralHelpURLs])},getTargets:function(){return this.prismElementHelpURLs&&this.prismCentralHelpURLs||this.parseTargets(),i.isMulticlusterNavMode()?this.prismCentralHelpURLs:this.prismElementHelpURLs}})}),define("models/smtpserver/SmtpServerModel",["backbone","models/BaseModel","data/DataProperties","data/DataURLConstants","utils/AppConstants","utils/AppUtil"],function(e,t,i,n,s,a){"use strict";var r={ADDRESS:"address",PORT:"port",USERNAME:"username",PASSWORD:"password",SECUREMODE:"secureMode"};return t.extend({urlRoot:n.SMTP,entityType:s.ENTITY_SMTP_SERVER,actionMode:s.ACTION_UPDATE,defaults:{address:null,port:null,username:null,password:null,secureMode:null,fromEmailAddress:null},name:"SmtpServerModel",initialize:function(){this.initializeBaseModel()},sync:function(t,i,n){return n=this.parseOptions(t,i,n),"update"!==t&&"create"!==t||(t=this._isEmpty()?"delete":"update"),a.debug("BaseModel : \n\t method: "+t+"\n\t data  : "+n.url),e.sync(t,i,n)},_isEmpty:function(){var e=_.pick(this.attributes,_.keys(this.defaults));return _.all(e,function(e,t){return t===r.SECUREMODE&&"NONE"===e||!e})},isConnectionStatusSuccess:function(){return((this.get(i.CONN_EMAIL_STATUS)||{}).status||"").toLowerCase()===s.CONN_STATUS_SUCCESS}})}),define("models/ebrowser/EBGroupModel",["models/BaseModel","utils/EntityUtil","utils/AppConstants"],function(e,t,i){"use strict";var n={NAME:"group_name",GROUP_SUMMARIES:"group_summaries",GRAND_TOTAL_ENTITIES:"grand_total_entities",TOTAL_ENTITY_COUNT:"total_entity_count",ENTITY_TYPE:"entity_type",GROUPING_ATTR:"grouping_attribute",MEMBERS_COL:"members_collection",PAGE_OFFSET:"pageOffset"};return e.extend({name:"EBGroupModel",idAttribute:n.NAME,nameAttribute:n.NAME,GROUP_RANGE_SEPARATOR:"::",OTHER_GROUP_NAME:"Other",DP:n,defaults:{group_name:null,entity_type:null,grouping_attribute:null,group_summaries:null,members_collection:null,pageOffset:0,isExpanded:!1},initialize:function(e){this.set(this.DP.NAME,e[this.DP.NAME]||i.UNDEFINED_ENTITIES_GROUP),this.set(this.DP.GROUP_SUMMARIES,e[this.DP.GROUP_SUMMARIES]||{})},getMembers:function(){return this.get(this.DP.MEMBERS_COL).models},updateMembers:function(e,t){this.set(this.DP.PAGE_OFFSET,e),this.get(this.DP.MEMBERS_COL).add(t)},resetMembers:function(e,t){this.set(this.DP.PAGE_OFFSET,e),this.get(this.DP.MEMBERS_COL).reset(t)},isEmpty:function(){return 0===this.get(this.DP.TOTAL_ENTITY_COUNT)},isAllEntitiesGroup:function(){return this.get(this.DP.NAME)===i.ALL_ENTITIES_GROUP},getMemberById:function(e){return this.get(this.DP.MEMBERS_COL).findModelById(e)},getDisplayName:function(){var e=this.get(this.DP.ENTITY_TYPE),n=this.get(this.DP.GROUPING_ATTR);if(this.isAllEntitiesGroup())return"";var s=this.get(this.DP.NAME);s=s===i.UNDEFINED_ENTITIES_GROUP?"":s;var a=this.OTHER_GROUP_NAME;if(s!==this.OTHER_GROUP_NAME&&(a=t.getAttributeDisplayValue(e,n,s),0===a.length&&(a=i.UNDEFINED_ENTITIES_GROUP)),s.indexOf(this.GROUP_RANGE_SEPARATOR)>0){var r=s.split(this.GROUP_RANGE_SEPARATOR);2===r.length&&(a=t.getAttributeDisplayValue(e,n,r[0]),a+=" - ",a+=t.getAttributeDisplayValue(e,n,r[1]))}return t.getAttributeDisplayName(e,n)+" : "+a},getGroupMemberCounts:function(){var e=this.get(this.DP.TOTAL_ENTITY_COUNT);return{available:this.getMembers().length,total:e}},getFilterExpression:function(){var e={},n=this.get(this.DP.ENTITY_TYPE),s=this.get(this.DP.NAME),a=this.get(this.DP.GROUPING_ATTR),r=a,o=t.getAttributeSchema(n,a);if(o)if(s.indexOf(this.GROUP_RANGE_SEPARATOR)>0){var l=s.split(this.GROUP_RANGE_SEPARATOR);e[r]=[{op:i.FILTER_OPERATORS.RANGE,name:s,type:o.type,subType:o.subType,value1:this._formatValue(o,l[0]),value2:this._formatValue(o,l[1])}]}else e[r]=[{op:i.FILTER_OPERATORS.EQUALS,name:s,type:o.type,subType:o.subType,value1:this._formatValue(o,s),value2:null}];return e},_formatValue:function(e,t){if(t){if(t===i.UNDEFINED_ENTITIES_GROUP)return i.FILTER_NULL_VALUE;switch(e.type===i.FILTER_TYPES.ENUM?e.subType:e.type){case i.FILTER_TYPES.INT:return Number(t);case i.FILTER_TYPES.STRING:return String(t);case i.FILTER_TYPES.BOOLEAN:return Boolean(t)}}return t},getSummaryAttributes:function(){var e={},t=this.get(this.DP.GROUP_SUMMARIES);return _.each(t,function(t){t.values[0]&&t.values[0].values?e[t.name]=t.values[0].values[0]:e[t.name]=void 0}),e}},{DP:n})}),define("models/ebrowser/EBGroupsCollection",["models/BaseCollection","models/ebrowser/EBGroupModel"],function(e,t){"use strict";return e.extend({model:t,name:"EBGroupsCollection"})}),define("managers/ExpressionManager",["managers/BaseManager","utils/AppConstants"],function(e,t){"use strict";return e.extend({name:t.MANAGER.EXPRESSION,FILTERS:null,initialize:function(e){this.addToManagerHelper(),this.expressionfactory=e&&e.expressionFactory,this.FILTERS=this.expressionfactory.FILTERS},getFilterExpression:function(e,t,i){return this.expressionfactory&&this.expressionfactory.getFilterExpression(e,t,i)},removeFilterName:function(e){return this.expressionfactory&&this.expressionfactory.removeFilterName(e)}})}),define("models/ebrowser/EBQueryModel",["models/query/BaseQueryModel","models/ebrowser/EBGroupModel","models/ebrowser/EBGroupsCollection","managers/NamespaceManager","managers/ExpressionManager","data/DataURLConstants","data/DataProperties","utils/EntityUtil","utils/FilterUtil","utils/AppConstants","utils/AppUtil"],function(e,t,i,n,s,a,r,o,l,c,u){"use strict";var d=e.extend({idAttribute:r.ID,urlRoot:a.ENTITY_BROWSER_QUERY,name:"EBQueryModel",DEFAULT_GROUPS_LIMIT:3,DEFAULT_UNGROUPED_MEMBERS_LIMIT:40,DEFAULT_GROUPED_MEMBERS_LIMIT:6,MAX_MEMBERS_LIMIT:1e3,DEFAULT_LOAD_MORE_MULTIPLIER:5,DEFAULT_PAGE_SIZE:10,BUCKET_SUMMARY_HELPER_KEY:"count:count_star",DEFAULT_NUM_BUCKETS:3,RESULT_ATTRIBUTES:["total_entity_count","filtered_entity_count","filtered_group_count","total_group_count","group_results"],defaults:{id:null,title:"",entity_type:null,entity_ids:null,filter_expression:null,grouping_attribute:null,group_sort_attribute:null,group_sort_order:null,group_count:null,group_offset:null,group_attributes:null,group_member_count:null,group_member_offset:null,group_member_sort_attribute:null,group_member_sort_order:null,group_member_attributes:null,total_entity_count:-1,total_group_count:-1,group_separator_values:null,group_results:null},initialize:function(){e.prototype.initialize.apply(this,arguments),this.set(this.DP.GROUP_RESULTS,new i)},parse:function(n,s){var a=e.prototype.parse.apply(this,arguments),r={};if(a){var l=this.get(this.DP.ENTITY_TYPE),u=[this.DP.TOTAL_ENTITY_COUNT,this.DP.FILTERED_ENTITY_COUNT,this.DP.FILTERED_GROUP_COUNT,this.DP.TOTAL_GROUP_COUNT];_.each(u,function(e){r[e]=a[e]});var d=this.get(this.DP.GROUPING_ATTR);r[this.DP.GROUP_RESULTS]=new i,_.each(a[this.DP.GROUP_RESULTS],function(e){var i={};i[t.DP.ENTITY_TYPE]=l,i[t.DP.GROUPING_ATTR]=d,d===c.ALL_ENTITIES_GROUP?i[t.DP.NAME]=c.ALL_ENTITIES_GROUP:i[t.DP.NAME]=e[this.DP.GROUP_BY_COLUMN_VALUE],e[this.DP.GROUP_SUMMARIES]&&(i[t.DP.GROUP_SUMMARIES]={},_.each(e[this.DP.GROUP_SUMMARIES],function(e,n){n.toLowerCase()!==this.BUCKET_SUMMARY_HELPER_KEY&&(i[t.DP.GROUP_SUMMARIES][n]=e)},this));var n=this.parseMemberCollectionResults(e);i[t.DP.MEMBERS_COL]=o.createCollection(l,n),i[t.DP.GRAND_TOTAL_ENTITIES]=r[this.DP.TOTAL_ENTITY_COUNT],i[t.DP.TOTAL_ENTITY_COUNT]=e[t.DP.TOTAL_ENTITY_COUNT],r[this.DP.GROUP_RESULTS].add(new t(i))},this)}return r},parseMemberCollectionResults:function(e){return this._rawResultsToEntities(e[this.DP.ENTITY_RESULTS])},performQuery:function(e){return this.save(null,e)},getDefaultMemberLimit:function(e){return e&&e!==c.GROUP_BY_NONE?this.DEFAULT_GROUPED_MEMBERS_LIMIT:2*this.getUserConfiguredPageSize()},getMaxMemberLimit:function(){return this.MAX_MEMBERS_LIMIT},getGroupByName:function(e){return this.get(this.DP.GROUP_RESULTS).find(function(t){return e===t.getName()})},getEntityById:function(e){for(var t=this.get(this.DP.GROUP_RESULTS),i=0;i<t.length;i++){var n=t.at(i),s=n.getMemberById(e);if(s)return s}return null},getEntitiesByIds:function(e){return _.map(e,function(e){return this.getEntityById(e)},this)},getEntityByGroupName:function(e){for(var t=this.get(this.DP.GROUP_RESULTS),i=0;i<t.length;i++){var n=t.at(i);if(n.get(r.ENTITY_GROUP_NAME)===e)return n}return null},getEntitiesByGroupName:function(e){return _.map(e,function(e){return this.getEntityByGroupName(e)},this)},getResultEntityIds:function(){var e=[];return this.get(this.DP.GROUP_RESULTS).each(function(t){_.each(t.getMembers(),function(t){e.push(t.get(t.idAttribute))})}),e},getResultEntities:function(){return this.getEntitiesByIds(this.getResultEntityIds())},getQueryResults:function(){var e={};_.each(this.RESULT_ATTRIBUTES,function(t){e[t]=this.get(t)},this);var t=[];this.get(this.DP.GROUP_RESULTS).each(function(e){t=t.concat(e.getMembers())}),e[this.DP.RESULT_MODELS]=t;var i=this.get(this.DP.GROUP_RESULTS);if(this._isContinuousGroupBy()&&i.length){var n=[];i.each(function(e){n.push(parseInt(e.get(e.DP.NAME),10))}),n=_.sortBy(n,function(e){return e});for(var s,a,r=0;r<i.length-1;r++)s=i.at(r),a=_.isNaN(n[r])||_.isNaN(n[r+1])?s.OTHER_GROUP_NAME:n[r]+s.GROUP_RANGE_SEPARATOR+n[r+1],s.set(s.DP.NAME,a);s=i.at(i.length-1);var o=n[i.length-1];a=_.isNaN(o)?s.OTHER_GROUP_NAME:o+s.GROUP_RANGE_SEPARATOR+c.FILTER_RANGE_MAX,s.set(s.DP.NAME,a)}return e[this.DP.PAGINATOR]=this,e.DP=this.DP,e},getVisibleSelectedEntityIds:function(e){var t=[];return e.length&&this.get(this.DP.GROUP_RESULTS).each(function(i){t=t.concat(this.getGroupVisibleSelectedIds(i,e))},this),t},getGroupVisibleSelectedIds:function(e,t){if(t.length){var i=this.getCurrentPage(e);if(i.length){var n=_.pluck(i,r.ID);return _.intersection(t,n)}}return[]},getPaginationInfo:function(e){var t,i,n;e?(t=e.getGroupMemberCounts(),i=e.get(e.DP.PAGE_OFFSET),n=this._getPageSizeForGroup(e)):(i=0,n=0,t={total:0});var s=i+n;s>t.total&&(s=t.total);var a=i>0,r=s<t.total;return{start:i,end:s,total:t.total,bPrev:a,bNext:r,pageSize:n}},loadNextPage:function(e,t){var i=e.getGroupMemberCounts(),n=this._getPageSizeForGroup(e),s=e.get(e.DP.PAGE_OFFSET)+n;s>i.total&&(s=0),s>=i.available?this._loadMoreGroupMembers({group:e,groupMemberOffset:i.available},function(i){i&&e.set(e.DP.PAGE_OFFSET,s),t(e,i)}):(s<i.total&&e.set(e.DP.PAGE_OFFSET,s),t(e,!0))},loadPreviousPage:function(e,t){var i=e.get(e.DP.PAGE_OFFSET)-this._getPageSizeForGroup(e);e.set(e.DP.PAGE_OFFSET,Math.max(0,i)),t(e,!0)},getCurrentPage:function(e){var t=this.getPaginationInfo(e);return e.getMembers().slice(t.start,t.end)},adjustNewPageOffset:function(e,t,i){var n=Math.floor(e/i),s=n*i;if(s>t){s=Math.floor(t/i)*i}return s},refreshCurrentPage:function(e,t){var i=e.get(e.DP.PAGE_OFFSET),n=e.getGroupMemberCounts(),s=this._getPageSizeForGroup(e),a=this.adjustNewPageOffset(i,n.total,s);a+s<=n.available?(e.set(e.DP.PAGE_OFFSET,a),t(e,!0)):this._loadMoreGroupMembers({group:e,groupMemberOffset:a},function(i){t(e,i)})},_loadMoreGroupMembers:function(e,t){var i={};_.each(this.URL_ATTRIBUTES,function(e){i[e]=this.get(e)},this);var n=this.get(this.DP.GROUPING_ATTR);i[this.DP.GROUP_MEMBER_COUNT]=e.groupSize||this.getDefaultMemberLimit(n),i[this.DP.GROUP_OFFSET]=0,i[this.DP.GROUP_MEMBER_OFFSET]=e.groupMemberOffset,i[this.DP.GROUP_ATTRIBUTES]=null,i.disableHybridQuery=this.disableHybridQuery,this.adjustGroupMemberOffset(e.groupMemberOffset);var s=this.get(this.DP.FILTER_EXPR),a=e.group.getFilterExpression();if(a){var r=_.extend({},s);_.each(a,function(e,t){var i=r[t]||[];i=i.concat(e),r[t]=i}),i[this.DP.FILTER_EXPR]=r}var o=this.getEBQueryModelInstance(i),l=this;return o.performQuery({success:function(){var n=o.getQueryResults();l.onNewGroupMembersLoaded({group:e.group,newMembers:n[l.DP.RESULT_MODELS],newOffset:i[l.DP.GROUP_MEMBER_OFFSET],reset:e.reset}),t(e.group,!0)},error:function(){u.debug("EBQueryModel : Load More Query Failed."),t(e.group,!1)}})},onNewGroupMembersLoaded:function(e){e.reset?e.group.resetMembers(e.newOffset,e.newMembers):e.group.updateMembers(e.newOffset,e.newMembers)},adjustGroupMemberOffset:function(e){},_getPageSizeForGroup:function(e){return e.isAllEntitiesGroup()?this.getUserConfiguredPageSize():this.DEFAULT_GROUPED_MEMBERS_LIMIT},getUserConfiguredPageSize:function(){var e,t=n.get(n.USER_SETTINGS);return t&&(e=Number(t.getUserSetting(c.EB_USER_SETTINGS.PAGE_SIZE))),e||2*this.DEFAULT_PAGE_SIZE},getEBQueryModelInstance:function(e){return new d(e)},applyAdditionalFiltersByEntityType:function(e){switch(this.get(this.DP.ENTITY_TYPE)){case c.ENTITY_GPU:l.addFilterCondition(e,r.EB.GPU.GPU_TYPE,l.createFilterCondition(r.EB.GPU.GPU_TYPE,c.ENTITY_GPU,c.FILTER_OPERATORS.NOT_EQUALS,r.EB.GPU.KVIRTUAL));break;case c.ENTITY_USER:l.addFilterCondition(e,r.EB.USER.USER_TYPE,l.createFilterCondition(r.EB.USER.USER_TYPE,c.ENTITY_USER,c.FILTER_OPERATORS.NOT_EQUALS,c.USER_TYPES.INTERNAL));break;case c.ENTITY_MARKETPLACE_ITEM:s.getFilterExpression(s.FILTERS.ONLY_INFRA_MARKETPLACE_ITEMS,!1,e);break;case c.ENTITY_VM:s.getFilterExpression(s.FILTERS.NOT_INCLUDE_AWS,!1,e);break;case c.ENTITY_QOS_POLICY:s.getFilterExpression(s.FILTERS.EXCLUDE_DELETED_QOS_POLICIES,!1,e);break;case c.ENTITY_NGT_POLICY:s.getFilterExpression(s.FILTERS.EXCLUDE_DELETED_NGT_POLICIES,!1,e);break;case c.ENTITY_AUDIT:l.addFilterCondition(e,c.FILTER_ALERT_TYPE_UUID,l.createFilterCondition(c.ENTITY_AUDIT,c.FILTER_ALERT_TYPE_UUID,c.FILTER_OPERATORS.NOT_EQUALS,c.AUDIT.TYPE.AUDIT_RECOVERY_PLAN_JOB))}},_filterExpressionToFilterCriteria:function(t,i){var n={};return this.applyAdditionalFiltersByEntityType(n),_.extend(n,t),e.prototype._filterExpressionToFilterCriteria.call(this,n,i)}},{DP:e.DP});return d}),define("models/ebrowser/EBGroupedQueryModel",["models/ebrowser/EBQueryModel","managers/EntityManager","data/DataProperties","utils/EntityUtil","utils/AppUtil","utils/AppConstants"],function(e,t,i,n,s,a){"use strict";var r,o=[a.ENTITY_CATEGORY],l=[i.NAME,i.CAT_IMMUTABLE,i.CAT_CARDINALITY,i.CAT_DESC,i.TOTAL_POLICY_COUNTS,i.TOTAL_ENTITY_COUNTS],c=(r={},_defineProperty(r,i.TOTAL_ENTITY_COUNTS,i.ENTITY_COUNTS),_defineProperty(r,i.TOTAL_POLICY_COUNTS,i.POLICY_COUNTS),r),u=e.extend({DEFAULT_GROUPS_LIMIT:20,DEFAULT_GROUPED_MEMBERS_LIMIT:5,_ancestorAttributes:null,getGroupingOptions:function(){var e=t.getEntitySchema(this.get(this.DP.ENTITY_TYPE));if(!e)throw new Error("Schema not available for "+this.get(this.DP.ENTITY_TYPE));var i=e.getGroupingAttribute();if(!i||i===a.GROUP_BY_NONE)throw new Error("Group By Attribute not defined");var n={};return n[this.DP.GROUPING_ATTR]=i,n[this.DP.GROUP_COUNT]=this.get(this.DP.GROUP_COUNT)||this.DEFAULT_GROUPS_LIMIT,n[this.DP.GROUP_MEMBER_COUNT]=this.get(this.DP.GROUP_MEMBER_COUNT)||this.DEFAULT_UNGROUPED_MEMBERS_LIMIT,n[this.DP.GROUP_SORT_ATTR]=i,n[this.DP.GROUP_SORT_ORDER]=this.get(this.DP.GROUP_MEMBER_SORT_ORDER),_.contains(o,this.get(this.DP.ENTITY_TYPE))&&this._ancestorJoinJSON(n),n},getDefaultMemberLimit:function(e){return this.DEFAULT_GROUPED_MEMBERS_LIMIT},performQuery:function(t){return this.set(this.getGroupingOptions()),e.prototype.performQuery.apply(this,arguments)},_getAncestorAttributes:function(){var e=this;return _.isEmpty(this._ancestorAttributes)&&(this._ancestorAttributes=[],_.each(l,function(t){(t!==i.TOTAL_POLICY_COUNTS&&t!==i.TOTAL_ENTITY_COUNTS||e._hasGroupMemberAttribute(c[t]))&&e._ancestorAttributes.push(t)})),this._ancestorAttributes},_hasGroupMemberAttribute:function(e){return _.some(this.get(this.DP.GROUP_MEMBER_ATTRIBUTES),function(t){return t&&t.attribute===e})},_ancestorJoinJSON:function(e){e[this.DP.GROUP_SORT_ATTR]=_.first(this._getAncestorAttributes()),e[this.DP.GROUP_MEMBER_SORT_ATTRIBUTE]=i.CAT_VALUE,e[this.DP.GROUP_ATTRIBUTES]=_.map(this._getAncestorAttributes(),function(e){return{attribute:e,ancestor_entity_type:"abac_category_key"}});var t=this.get(this.DP.GROUP_MEMBER_ATTRIBUTES)||[];t.length||t.push({attribute:i.UUID}),e[this.DP.GROUP_MEMBER_ATTRIBUTES]=t},parse:function(t,i){var n=e.prototype.parse.apply(this,arguments);return _.contains(o,this.get(this.DP.ENTITY_TYPE))&&(n=this._ancestorJoinParse(n)),n},_ancestorJoinParse:function(e){var t=this;return e.group_results.each(function(e){var n=e.get(e.DP.GROUP_SUMMARIES);_.each(t._getAncestorAttributes(),function(s){var a=n["sum:"+s];if(a){var r=null;switch(0===a.values.length?r=null:a.values.length&&a.values[0].values.length&&(r=a.values[0].values[0]),s){case i.NAME:e.get(e.DP.MEMBERS_COL).each(function(e){e.set(s,r)}),e.set(i.ENTITY_GROUP_NAME,r);break;case i.CAT_CARDINALITY:r=parseInt(r,10);case i.CAT_IMMUTABLE:e.set(s,r);break;default:e.set("sum:"+s,t._jsonParse(r))}}})}),e},getGroupCounts:function(){return{available:this.get(this.DP.GROUP_RESULTS).length,total:this.get(this.DP.FILTERED_GROUP_COUNT)}},getPaginationInfo:function(){var e=this.getUserConfiguredPageSize(),t=this.getGroupCounts(),i=this.get(this.DP.GROUP_OFFSET),n=void 0,s=void 0,a=void 0;return 0===t.total?(i=0,e=0,t={total:0}):(n=i+e,n>t.total&&(n=t.total),s=i>0,a=n<t.total),{start:i,end:n,total:t.total,bPrev:s,bNext:a,pageSize:e}},loadNextPage:function(e,t){
var i=this.getGroupCounts(),n=this.getUserConfiguredPageSize(),s=this.get(this.DP.GROUP_OFFSET)+n;s>i.total&&(s=0);var a=this;this._loadGroups(s,function(i){i&&a.set(a.DP.GROUP_OFFSET,s),t(e,i)})},loadPreviousPage:function(e,t){var i=this.getUserConfiguredPageSize(),n=Math.max(0,this.get(this.DP.GROUP_OFFSET)-i),s=this;this._loadGroups(n,function(i){i&&s.set(s.DP.GROUP_OFFSET,n),t(e,i)})},getCurrentPage:function(e){return this.get(this.DP.GROUP_RESULTS).models},refreshCurrentPage:function(e,t){var i=this.get(this.DP.GROUP_OFFSET),n=this;this._loadGroups(i,function(s){s&&n.set(n.DP.GROUP_OFFSET,i),t(e,s)})},getUserConfiguredPageSize:function(){var t=this.get(this.DP.ENTITY_TYPE);return n.isGroupedEntityType(t)?this.DEFAULT_GROUPS_LIMIT:e.prototype.getUserConfiguredPageSize.apply(this,arguments)},getVisibleSelectedEntityIds:function(e){var t=this.getCurrentPage(),i=_.pluck(t,"id");return _.intersection(i,e)},_loadGroups:function(e,t){var i={};_.each(this.URL_ATTRIBUTES,function(e){i[e]=this.get(e)},this),i[this.DP.FILTER_EXPR]=this.get(this.DP.FILTER_EXPR),i[this.DP.GROUP_OFFSET]=e;var n=this.getEBQueryModelInstance(i),a=this;return n.performQuery({success:function(){var e=n.getQueryResults();a.get(a.DP.GROUP_RESULTS).reset(e[a.DP.GROUP_RESULTS].models),t(!0)},error:function(){s.debug("EBGroupedQueryModel : Load More Query Failed."),t(!1)}})},getGroupsUsingGroupingIds:function(e){var t=this.get(this.DP.GROUP_RESULTS);return e.map(function(e){return t.find(function(t){return t.get(i.ENTITY_GROUP_NAME)===e})})},getEBQueryModelInstance:function(e){return new u(e)}});return u}),define("models/categories/CategoriesQueryModel",["bluebird","models/ebrowser/EBGroupedQueryModel","data/DataProperties","utils/AppUtil","utils/AppConstants","utils/FilterUtil"],function(e,t,i,n,s,a){"use strict";var r=null,o=null,l=t.extend({name:"CategoriesQueryModel",initialize:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t.prototype.initialize.apply(this,arguments);var n={};n[this.DP.ENTITY_TYPE]=s.ENTITY_CATEGORY,n[this.DP.GROUP_COUNT]=e.isSearchMode?15:64,n[this.DP.GROUP_MEMBER_COUNT]=e.isSearchMode?15:this.MAX_MEMBERS_LIMIT,n[this.DP.GROUP_MEMBER_OFFSET]=0,n[this.DP.GROUP_MEMBER_ATTRIBUTES]=[{attribute:i.CAT_NAME},{attribute:i.CAT_VALUE},{attribute:i.CAT_DESC},{attribute:i.CAT_IMMUTABLE},{attribute:i.CAT_CARDINALITY}],e.fetchEntityCounts&&n[this.DP.GROUP_MEMBER_ATTRIBUTES].push({attribute:i.ENTITY_COUNTS}),e.fetchPolicyCounts&&n[this.DP.GROUP_MEMBER_ATTRIBUTES].push({attribute:i.POLICY_COUNTS}),n[this.DP.GROUP_MEMBER_SORT_ATTRIBUTE]=i.CAT_NAME,this.set(n)},setSearchFilter:function(e){var t={},r=n.categoryFromString(e),o=r.name,l=_.isEmpty(r.value)?e:r.value;t=a.addFilterCondition(t,i.CAT_NAME,a.createFilterCondition(s.ENTITY_CATEGORY,i.NAME,s.FILTER_OPERATORS.CONTAINS,o)),t=a.addFilterCondition(t,i.CAT_VALUE,a.createFilterCondition(s.ENTITY_CATEGORY,i.CAT_VALUE,s.FILTER_OPERATORS.CONTAINS,l)),this.set(this.DP.FILTER_OR_EXPR,t)},setNameFilter:function(e){this.setNameFilters([e])},setNameFilters:function(e){var t={};_.each(e,function(e){t=a.addFilterCondition(t,i.CAT_NAME,a.createFilterCondition(s.ENTITY_CATEGORY,i.NAME,s.FILTER_OPERATORS.EQUALS,e))}),this.set(this.DP.FILTER_EXPR,t)},getCategories:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.getResultEntities();return e&&(t=_.filter(t,function(e){return e.get(i.CAT_NAME)!==s.SYSTEM_CATEGORIES.QUARANTINE_NAME})),_.map(t,function(e){return n.categoryToString(e.toJSON())}).sort()},getCategoriesByIds:function(){var e={};return _.each(this.getResultEntities(),function(t){var s=n.categoryToString(t.toJSON());e[s]=t.get(i.EB.ENTITY_ID)}),e},getCategoryValues:function(e){var t=this.getResultEntities(),n=[];return _.each(t,function(t){t.get(i.CAT_NAME)===e&&n.push(t.get(i.CAT_VALUE))},this),n.sort()},getCategoryIDValuePair:function(e){var t=this.getResultEntities(),n=[];return _.each(t,function(t){t.get(i.CAT_NAME)===e&&n.push({value:t.get(i.CAT_VALUE),id:t.get(i.ID)})},this),n.sort()},fetchCategoryEntityCounts:function(e,t){var n=this,s=_.pluck(e,i.NAME);this.setNameFilters(_.uniq(s)),this.performQuery().done(function(){t(n.getUsageCountsByCategory())})},isCategoryNameImmutable:function(e){var t=this.getGroupByName(e);return t&&t.get(i.CAT_IMMUTABLE)},isCategoryImmutable:function(e,t){var n=_.find(this.getResultEntities(),function(n){return n.get(i.CAT_NAME)===e&&n.get(i.CAT_VALUE)===t});return!!n&&n.get(i.CAT_IMMUTABLE)},getCategoryEntityCounts:function(e){return this._getCategoryCounts(e,i.ENTITY_COUNTS)},getCategoryPolicyCounts:function(e){return this._getCategoryCounts(e,i.POLICY_COUNTS)},getUsageCountsByCategory:function(){var e={};return _.each(this.getResultEntities(),function(t){e[n.categoryToString(t.toJSON())]=t.get(i.ENTITY_COUNTS)||{}}),e},getCategoryNames:function(){var e=this.getResultEntities();return _.map(e,function(e){return e.get(i.CAT_NAME)},this)},hasCategory:function(e){if(!e||!e.length)return!1;var t=n.categoryFromString(e),s=_.find(this.getResultEntities(),function(e){return e.get(i.CAT_NAME)===t.name&&e.get(i.CAT_VALUE)===t.value});return!_.isUndefined(s)},getUsageCounts:function(){var e={},t=this.getResultEntities();return _.each(t,function(t){var n=t.get(i.ENTITY_COUNTS);_.each(n,function(t,i){e[i]=e[i]?e[i]+t:t});var s=t.get(i.POLICY_COUNTS);_.each(s,function(t,i){e[i]=e[i]?e[i]+t:t})}),e},_getCategoryCounts:function(e,t){var n={},s=this.getResultEntities();return _.each(s,function(s){if(s.get(i.CAT_NAME)===e){var a=s.get(t),r=s.get(i.CAT_VALUE);n[r]=a}}),n},getSummaryDescription:function(){var e=this.get(this.DP.GROUP_RESULTS).first();if(e){return e.getSummaryAttributes()[i.CAT_DESC]}return null},isSummaryImmutable:function(){var e=this.get(this.DP.GROUP_RESULTS).first();if(e){return e.getSummaryAttributes()[i.CAT_IMMUTABLE]===s.BOOLEAN_TRUE}return!1}},{getSharedInstance:function(){return null===r&&(r=new l,o=r.performQuery()),r},loadCategories:function(t){return o&&!t||(null===r&&(r=new l),o=r.performQuery()),e.resolve(o).then(function(){return r})},releaseSharedInstance:function(){r=null}});return l}),define("models/broker/GenericAppModel",["models/BaseModel","data/DataManager"],function(e,t){"use strict";return e.extend({url:null,getURL:function(e,t){return this.url},setURL:function(e){this.url=e},getDataSourceURL:function(){return t.getV3DataSourceURL()},showLatencyNotification:function(e,t){},getNotificationMessage:function(){},showSuccessNotification:function(){}})}),define("models/intent/BatchPollingModel",["models/PollingModel","data/DataProperties","data/DataManager","managers/BatchManager","managers/IntentManager","utils/AppUtil"],function(e,t,i,n,s,a){"use strict";return e.extend({TIMEOUT_MILLISECONDS:12e4,intervalTimeInMilliSec:2e3,idAttribute:t.UUID,requestList:[],entityTypeMap:{},apiVersion:null,continueOnFail:null,executionOrder:null,allRequestErred:!0,hasError:!1,name:"BatchPollingModel",completedRequests:{},getDataSourceURL:function(){return i.getDataSourceURL(i.API_VERSION.V3)},initialize:function(t,i){if(this.completedRequests={},!i.requestList||!i.requestList.length)throw new Error("Missing the required parameters for calling BatchPollingModel");this.requestList=i.requestList,this.entityTypeMap=i.entityTypeMap,this.apiVersion=i.apiVersion,this.continueOnFail=i.continueOnFail,this.executionOrder=i.executionOrder,e.prototype.initialize.apply(this,arguments)},startPolling:function(e){},fetch:function(e){var t=this;this._pollingOptions=_.clone(e),this.preFetch();var i=this.requestList.filter(function(e){return!t.completedRequests[e[n.DP.REQUEST.PATH_AND_PARAMS]]}),r=n.createBatchRequestObj({api_request_list:i,api_version:this.apiVersion,continue_on_failure:this.continueOnFail,execute_order:this.executionOrder}),o=$.Deferred();return n.performBatch({requestBody:r}).done(function(e){if(e[n.DP.API_RESPONSE_LIST].forEach(function(e){var i=e[n.DP.RESPONSE.API_RESPONSE],r=e[n.DP.REQUEST.PATH_AND_PARAMS],o=e[n.DP.RESPONSE.STATUS],l=t.entityTypeMap[r];if(i[s.SWAGGER_PROPERTIES.PROP_METADATA]&&i[s.SWAGGER_PROPERTIES.PROP_STATUS]){var c=i[s.SWAGGER_PROPERTIES.PROP_STATUS][s.SWAGGER_PROPERTIES.PROP_STATE];a.isIntentStateIncomplete(l.entityType,c)||(t.completedRequests[r]=e),a.isIntentStateComplete(l.entityType,c)&&(t.allRequestErred=!1),a.isIntentStateError(l.entityType,c)&&(t.hasError=!0)}else"404"===o&&"delete"===l.getMethod().toLowerCase()&&(t.completedRequests[r]=e,e[n.DP.RESPONSE.STATUS]="200")}),!t.requestList.filter(function(e){return!t.completedRequests[e[n.DP.REQUEST.PATH_AND_PARAMS]]}).length){t.stopPolling();var i=_defineProperty({},n.DP.API_RESPONSE_LIST,Object.keys(t.completedRequests).map(function(e){return t.completedRequests[e]}));return t.hasError?o.reject(i):o.resolve(i)}return o.resolve(e)}),o.promise()},waitForCompletion:function(){var e={success:null,error:null};return this.setPollingOptions(e),this.pollForCompletion()}})}),define("models/intent/BatchService",["underscore","bluebird","models/intent/BatchPollingModel","data/DataProperties","managers/BatchManager","managers/IntentManager","utils/AppUtil","utils/AppConstants"],function(e,t,i,n,s,a,r,o){"use strict";function l(){this.initialize()}var c={CONTINUE_ON_FAIL:"continue_on_failure",API_VERSION:"api_version",EXECUTE_ORDER:"execution_order",REQUEST:{OPERATION:"operation",PATH_AND_PARAMS:"path_and_params",BODY:"body"}};return l.prototype={name:"BatchService",DP:c,initialize:function(e){e=e||{},this.continueOnFail=e[this.DP.CONTINUE_ON_FAIL]||!0,this.apiVersion=e[this.DP.API_VERSION],this.executionOrder=e[this.DP.EXECUTE_ORDER]||o.BATCH_REQUEST.SEQUENTIAL,this.requestList=[],this.requestContext={}},addFromService:function(e,t,i){this.apiVersion||(this.apiVersion=e.apiVersion);var n=e[t].getAction(i),s=n.getResolvedUrl(i),a=this._getRequestUrl(n,i,s),r=n.getQueryParamsMap(i);i&&i.$fanoutProxy&&Object.keys(r).length&&(r.method=o.HTTP_METHOD.GET.toUpperCase(),r.url_path=n._getParameterisedURL(r.url_path,i));var l=n.getQueryParams(r),c=n.getUrlPrefix(i),u=n._getParameterisedURL(n._getUrl(i),n.getUrlContext(i)),d=function(e){return""+c+u+e+l};this.requestContext[a]={url:d,data:i,action:n};var h=n.getMethod();i&&i.$fanoutProxy&&(h=o.HTTP_METHOD.POST),this.add(h,n.getResolvedUrl(i),n.getPayload(t,i||{}),!0)},_getRequestUrl:function(e,t,i){return i="/"===i[0]?i.substring(1):i,""+e.getBaseUrl(t)+i},add:function(e,t,i,n){this.requestList.push(s.createRequest(e,t,i,n))},execute:function(l){var c=this,u={$isAsync:!1};l=e.extend({},u,l);var d=s.createBatchRequestObj({api_request_list:this.requestList,api_version:this.apiVersion,continue_on_failure:this.continueOnFail,execute_order:this.executionOrder});return t.resolve(s.performBatch({requestBody:d})).then(function(e){if(!l.$isAsync){var t=[],u={},d=!1;if(e[s.DP.API_RESPONSE_LIST].forEach(function(e){var i=e[s.DP.RESPONSE.API_RESPONSE],l=e[s.DP.REQUEST.PATH_AND_PARAMS],h=e[s.DP.RESPONSE.STATUS],p=c.requestContext[l];if(d=p&&"202"===h,i[a.SWAGGER_PROPERTIES.PROP_METADATA]&&i[a.SWAGGER_PROPERTIES.PROP_STATUS]&&d&&i[a.SWAGGER_PROPERTIES.PROP_STATUS]&&(d=r.isIntentStateIncomplete(p.action.entityType,i[a.SWAGGER_PROPERTIES.PROP_STATUS][a.SWAGGER_PROPERTIES.PROP_STATE])),d){var _=p.action,T="";if("post"===_.getMethod()&&!_.isListAction()){T="/"+i[a.SWAGGER_PROPERTIES.PROP_METADATA][n.UUID]}var E=o.HTTP_METHOD.GET;p.data.$fanoutProxy&&(E=o.HTTP_METHOD.POST);var S=p.url(T);u[l]=_,u[c._getRequestUrl(_,p.data,S)]=_,t.push(s.createRequest(E,S,{},!0))}}),!d)return e;return new i(null,{requestList:t,entityTypeMap:u,apiVersion:c.apiVersion,continueOnFail:c.continueOnFail,executionOrder:c.executionOrder}).waitForCompletion()}return e})}},l.DP=c,l}),define("models/intent/IntentResultModel",["models/PollingModel","data/DataProperties","data/DataManager","data/DataURLConstants","managers/NotificationManager","utils/AppConstants","utils/AppUtil"],function(e,t,i,n,s,a,r){"use strict";var o={TIMEOUT_RETRIEVE_ENTITY:"Timeout when request an entity with uuid "};return e.extend({TIMEOUT_MILLISECONDS:3e5,intervalTimeInMilliSec:2e3,idAttribute:t.UUID,urlRoot:null,name:"IntentResultModel",urlRegex:/url_path=([^&]+)/,methodRegex:/method=([^&]+)/,getDataSourceURL:function(){return i.getDataSourceURL(i.API_VERSION.V3)},initialize:function(t,i){if(!i.urlRoot||!t[this.idAttribute])throw new Error("Missing the required parameters for calling IntentResultModel");if(this.urlRoot=i.urlRoot,this.entityType=i.entityType,this.isFanout=this.urlRoot.indexOf(n.FANOUT_PROXY.substring(1))>-1,e.prototype.initialize.apply(this,arguments),this.isFanout){var s=this.urlRoot.match(this.urlRegex)[1],r="/"===s.charAt(s.length-1)?"":"/",o=this.urlRoot.match(this.methodRegex);o&&o.length>1&&o[1].toLowerCase()===a.HTTP_METHOD.POST&&(this.urlRoot=this.urlRoot.replace(this.urlRegex,"url_path="+s+r+encodeURIComponent(this.id))),this.urlRoot=this.urlRoot.replace(this.methodRegex,"method=GET")}},showLatencyNotification:function(){this.isFanout||e.prototype.showLatencyNotification.apply(this,arguments)},showSuccessNotification:function(){this.isFanout||e.prototype.showSuccessNotification.apply(this,arguments)},isNew:function(){if(this.isFanout)return!0;e.prototype.isNew.apply(this,arguments)},fetchAndGetData:function(e){return this.isFanout?this.save(null,e):this.fetch(e)},startPolling:function(t){var i=this,n={success:function(e,n){var s,a=n?n.status:null;a&&(s=a.state),r.isIntentStateComplete(i.entityType,s)?(i.stopPolling(),_.isFunction(t.success)&&t.success(e,n)):r.isIntentStateError(i.entityType,s)&&(i.stopPolling(),_.isFunction(t.error)&&t.error(e,n))},error:function(e,n){i.stopPolling(),_.isFunction(t.error)&&t.error(e,n)}};e.prototype.startPolling.call(this,n),setTimeout(function(){i.isPolling()&&(i.stopPolling(),s.showClientNotification(a.NOTIFY_ERROR,i.i18n("timeoutRetreiveEntity",o.TIMEOUT_RETRIEVE_ENTITY)+i.get(i.idAttribute),{temporary:!0}))},this.TIMEOUT_MILLISECONDS)},_pollingHandler:function(){return this.fetchAndGetData(this._pollingOptions)},getStatusMessage:function(){var e=this.get(t.INTENT_STATUS);return e?e[t.INTENT_STATUS_MSG]||e[t.INTENT_STATUS_REASON]:this.i18n("notFound")},getIntervalTime:function(){return this.intervalTimeInMilliSec}})}),define("models/intent/IntentDynamicModel",["models/BaseModel","models/intent/IntentResultModel","managers/IntentManager","managers/NotificationManager","managers/EntityStateTracker","data/DataManager","data/DataProperties","utils/AppConstants","utils/AppUtil","utils/EntityUtil","events/AppEvents"],function(e,t,i,n,s,a,r,o,l,c,u){"use strict";var d={SUCCESS_SAVE:"Saving the %s...",ERROR_SAVE_POLL:"Error in saving entity: %s"},h={NAME:i.SWAGGER_PROPERTIES.PROP_NAME,DESC:i.SWAGGER_PROPERTIES.PROP_DESC,SPEC:i.SWAGGER_PROPERTIES.PROP_SPEC,STATUS:i.SWAGGER_PROPERTIES.PROP_STATUS,RESOURCES:i.SWAGGER_PROPERTIES.PROP_RESOURCES,PROPS:i.SWAGGER_PROPERTIES};return e.extend({name:"IntentDynamicModel",executeSuccessUntilStateComplete:!1,actionRoute:null,dataObject:null,DP:h,SP:i.SWAGGER_PROPERTIES,serializePollingRequests:!1,specVersion:null,swaggerValidationNeeded:!0,trackOnSave:!1,latencyTimeOut:5e3,initialize:function(t,i){this.serializePollingRequests=i&&i.serializePollingRequests,e.prototype.initialize.apply(this,arguments)},setDataObject:function(e){this.dataObject=e},getOriginalEntityModel:function(){return this.dataObject&&this.dataObject.entity},getOriginalEntityStatus:function(){return i.getStatusResourcesFromModel(this.getOriginalEntityModel())},sync:function(e,t,i){var n=this._getV3AccessDeniedPromise(i);return n||(i=this.parseOptions(e,t,i),"update"!==e&&"create"!==e||(i.url=a.getFormattedURL(this.getURL(e,i),!1,a.API_VERSION.V3),t.unset("id")),l.logObject("IntentDynamicModel : \n\t method: "+e+"\n\t url: "+i.url+"\n\t dataObject: ",t.toJSON()),Backbone.sync(e,t,i))},getDataSourceURL:function(){return a.getDataSourceURL(a.API_VERSION.V3)},save:function(s){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},c=this.isNew(),u=a.success,h=a.error;a.success=null,a.error=null;var p=e.prototype.save.apply(this,arguments),T=this;return p&&p.done(function(e){if(!T.executeSuccessUntilStateComplete&&_.isFunction(u)&&u(T,p),e&&e[i.SWAGGER_PROPERTIES.PROP_METADATA]){var s,a=e[i.SWAGGER_PROPERTIES.PROP_METADATA],E=a[r.UUID];if(c)s=T.urlRoot;else{var S=T.urlRoot.lastIndexOf("/");-1!==S&&(s=T.urlRoot.substring(0,S))}if(T.executeSuccessUntilStateComplete){var g=new t({uuid:E},{urlRoot:s,serializeRequests:T.serializePollingRequests,entityType:T.entityType});window.setTimeout(function(){g.startPolling({success:function(e,t){_.isFunction(u)&&u(e,t),n.hideLatencyMessage(T.latencyNotificationId),T.triggerEntityRefresh(c,E)},error:function(e,t){_.isFunction(h)&&h(e,t),n.hideLatencyMessage(T.latencyNotificationId);var i=l.sprintf(T.i18n("showErrorSavePoll",d.ERROR_SAVE_POLL),e.getStatusMessage());T.showError&&n.showClientNotification(o.NOTIFY_ERROR,i,{temporary:!0})}})},g.getIntervalTime())}else setTimeout(function(){n.hideLatencyMessage(T.latencyNotificationId)},T.latencyTimeOut),T.triggerEntityRefresh(c,E)}}).fail(function(e,t,i){var s=T.interpretIntentServerError(e);T.showError&&n.showClientNotification(o.NOTIFY_ERROR,s,{temporary:!0}),_.isFunction(h)&&h(T,s)}),p},triggerEntityRefresh:function(e,t){var i=e?u.ENTITIES_CREATED:u.ENTITIES_UPDATED,n=c.resetSubstituteEntityType(this.entityType);u.triggerAppEvent(i,{entityType:l.getEntityTypeEB(n),entityIds:[t]}),this.trackOnSave&&s.addEntity({entityType:l.getEntityTypeEB(n),entityId:t})},destroy:function(){var t=this;return e.prototype.destroy.apply(this,arguments).done(function(){var e=t.getId();if(e){var i=c.resetSubstituteEntityType(t.entityType);u.triggerAppEvent(u.ENTITIES_DELETED,{entityType:l.getEntityTypeEB(i),entityIds:[e]})}})},showSuccessNotification:function(e,t,i){if(!this.executeSuccessUntilStateComplete&&this.enableNotifications){var s=this.i18n("showSuccessEntitySave",d.SUCCESS_SAVE),a=this.getEntityName(e);this.latencyNotificationId=n.showLatencyMessage(l.sprintf(s,a))}},showErrorNotificationMessage:function(e,t){t=_.defaults({},t,{temporary:!0}),n.showClientNotification(o.NOTIFY_ERROR,e,t)},showLatencyNotification:function(e,t){},hideLatencyNotification:function(e,t){},setRootUrl:function(e){e&&0===e.indexOf("/")&&(e=e.substring(1)),this.urlRoot=e},getURL:function(e,t){if(!this.urlRoot)throw new Error("Invalid urlRoot. Seems there is no url path for this entity type.");if("create"===e){var i=this.urlRoot.replace(/\{(.*?)\}/g,"");return i&&"/"===i.charAt(i.length-1)&&(i=i.substring(0,i.length-1)),i}return"update"===e||"delete"===e?this.urlRoot.replace(/\{(.*?)\}/g,this.get(this.idAttribute)):this.urlRoot},populateBatchEntity:function(e,t,n){var s=i.SWAGGER_PROPERTIES.PROP_METADATA,a=i.SWAGGER_PROPERTIES.PROP_CATEGORIES;switch(e){case o.ACTION_QUARANTINE:case o.ACTION_UNQUARANTINE:case o.ACTION_MANAGE_CATEGORIES:var r=l.getObjectPathValue(n,"metadata.categories.revoke");if(r){var c={metadata:{}};c[s][a]=r,t=this.updateCategories(t,c,!1)}if(l.getObjectPathValue(n,"metadata.categories.assign")){var u={metadata:{}};u[s][a]=n.metadata.categories.assign,t=this.updateCategories(t,u,!0)}break;case o.ACTION_MANAGE_OWNERSHIP:t=this.updateProjectReference(t,n),t=this.updateOwners(t,n,!0)}return i.mergeEntityWithViewModel(t)},updateProjectReference:function(e,t){var n=i.SWAGGER_PROPERTIES,s=t[n.PROP_METADATA]||{},a=s[n.PROP_PROJECT_REF];if(_.isObject(a)){var r=e[n.PROP_METADATA]=e[n.PROP_METADATA]||{};_.isEmpty(a)?r[n.PROP_PROJECT_REF]&&delete r[n.PROP_PROJECT_REF]:(a[n.KIND]=o.SSP_INTENT_KINDS.PROJECT,r[n.PROP_PROJECT_REF]=a)}return e},getFormDataObj:function(e){var t=e||this.dataObject.entity,n={},s=i.SWAGGER_PROPERTIES,a=t[s.PROP_METADATA],r=void 0;a&&(r=a[s.KIND]);var o=t[s.PROP_STATUS]||{};return(l.isUseSpecEntityType(r)||o&&!o[s.PROP_RESOURCES])&&(o=t[s.PROP_SPEC]||{}),_.each(o,function(e,t){t===s.PROP_RESOURCES?_.each(e,function(e,t){e&&e[s.PROP_UUID]?n[t]=e[s.PROP_UUID]:n[t]=e}):n[t]=e}),_.each(t,function(e,t){t===s.PROP_SPEC||t===s.PROP_STATUS||(n[t]=e)}),n},updateCategories:function(e,t,n){var s=e[i.SWAGGER_PROPERTIES.PROP_METADATA]||{},a=s[i.SWAGGER_PROPERTIES.PROP_CATEGORIES]||{},r=t[i.SWAGGER_PROPERTIES.PROP_METADATA][i.SWAGGER_PROPERTIES.PROP_CATEGORIES]||{};return _.each(r,function(e,t){t&&e&&(n?a[t]=_.union(a[t]||[],e):!_.isEqual(e,a[t])&&_.isEmpty(_.intersection(e,a[t]))||delete a[t])}),e[i.SWAGGER_PROPERTIES.PROP_METADATA]=s,s[i.SWAGGER_PROPERTIES.PROP_CATEGORIES]=a,s[i.SWAGGER_PROPERTIES.USE_CATEGORY_MAP]=!0,e},updateOwners:function(e,t){var n=e[i.SWAGGER_PROPERTIES.PROP_METADATA]||{},s=t[i.SWAGGER_PROPERTIES.PROP_METADATA]||{},a=n[i.SWAGGER_PROPERTIES.PROP_OWNER_REF]||{},r=s[i.SWAGGER_PROPERTIES.PROP_OWNER_REF]||{};return a=_.extend(a,r),a.name||delete a.name,a[i.SWAGGER_PROPERTIES.KIND]=o.SSP_INTENT_KINDS.USER,e[i.SWAGGER_PROPERTIES.PROP_METADATA]=n,n[i.SWAGGER_PROPERTIES.PROP_OWNER_REF]=a,e},getEntityList:function(e){return((this.dataObject||{})[e]||{}).entities||[]},getEntityName:function(e){var t=this.getAppManager&&this.getAppManager(),i=t&&t.isOnprem();return l.getSingularEntityName(l.getEntityTypeBasedOnEnvironment(e.entityType,i))},interpretIntentServerError:function(e){return i.interpretIntentServerError(e)},isSwaggerValidationNeeded:function(){return this.swaggerValidationNeeded},_getV3AccessDeniedPromise:function(e){if(!this.getAccessManager().hasAccessToV3()&&this.getDataSourceURL()===a.getV3DataSourceURL()){var t=e&&e.error;_.isFunction(t)&&t(this,{responseText:o.ERROR_ACCESS_DENIED}),this.updateState(o.STATE_ERROR),n.showClientNotification(o.NOTIFY_ERROR,this.i18n("AccessDeniedReasons.noAccessToV3"));var i=$.Deferred();return i.reject(this,o.ERROR_ACCESS_DENIED),i.promise()}return null}})}),define("models/intent/IntentAction",["underscore","jquery","bluebird","models/intent/IntentDynamicModel","managers/IntentManager","utils/AppConstants","utils/AppUtil","data/DataURLConstants"],function(e,t,i,n,s,a,r,o){"use strict";function l(e){this.initialize(e)}var c={NAME:s.SWAGGER_PROPERTIES.PROP_NAME,DESC:s.SWAGGER_PROPERTIES.PROP_DESC,SPEC:s.SWAGGER_PROPERTIES.PROP_SPEC,OFFSET:s.SWAGGER_PROPERTIES.OFFSET,LENGTH:s.SWAGGER_PROPERTIES.LENGTH,STATUS:s.SWAGGER_PROPERTIES.PROP_STATUS,RESOURCES:s.SWAGGER_PROPERTIES.PROP_RESOURCES,METADATA:s.SWAGGER_PROPERTIES.PROP_METADATA,UUID:s.SWAGGER_PROPERTIES.PROP_UUID,KIND:s.SWAGGER_PROPERTIES.KIND,PROPS:s.SWAGGER_PROPERTIES.PROP,$METADATA:"$metadata",$REMOTE_PROXY:"$remoteProxy",$FANOUT_PROXY:"$fanoutProxy",FANOUT_METHOD:"method",FANOUT_URL_PATH:"url_path",FANOUT_AZ_NAME:"az_name",FANOUT_REMOTE_CLUSTER_UUID:"remote_cluster_uuid",API_VERSION:"api_version"},u={CREATE:"create",GET:"get",ERASE:"erase",UPDATE:"update",ALL:"all"},d=a.HTTP_METHOD,h=/\{([^}]*)}/;return l.prototype={name:"IntentAction",initialize:function(e){this.entityType=e.entityType,this.parser=e.parser,this.method=e.method,this.actionObj=e.actionObj,this.parameters=this.parser.resolveParameters(this.actionObj.parameters),this.url=e.url,this.apiVersion=e.apiVersion,this.baseUrl=e.baseUrl.replace(/\/?$/,"/")},asBehaviour:function(){var e=this.getName(),t=this._getActionHandler(e),i=this;return t.getAction=function(){return i},t},getName:function(){return this._getName(this.url,this.method)},_getName:function(e,t){return this.isListAction(e,t)?u.ALL:t.toLowerCase()},isListAction:function(e,t){return t.toLowerCase()===d.POST&&(e.indexOf("/list")>-1||"/tasks/poll"===e)},getMethod:function(){return this.method},_getUrl:function(e){return e&&e.$fanoutProxy?"":this.url},getQueryParamsMap:function(e){var t;if(!e||!e.$fanoutProxy)return{};var i=void 0;i=e.url?e.url:"/"===this.url[0]?this.url.substring(1):this.url;var n=(t={},_defineProperty(t,c.FANOUT_METHOD,this.getMethod().toUpperCase()),_defineProperty(t,c.FANOUT_URL_PATH,i),t);return e.$fanoutProxy.remoteClusterUuid&&(n[c.FANOUT_REMOTE_CLUSTER_UUID]=e.$fanoutProxy.remoteClusterUuid),e.$fanoutProxy.azName&&(n[c.FANOUT_AZ_NAME]=e.$fanoutProxy.azName),n},getQueryParams:function(e){var t=Object.keys(e).map(function(t){return t+"="+e[t]}).join("&");return t?"?"+t:""},getUrlPrefix:function(e){return e&&e.$fanoutProxy?o.FANOUT_PROXY:""},getUrlContext:function(e){var t=this._getPathParameterValues(this.parameters,e);return e&&e.$remoteProxy&&(t[c.$REMOTE_PROXY]=e[c.$REMOTE_PROXY]),e&&e.$fanoutProxy&&(t[c.$FANOUT_PROXY]=e[c.$FANOUT_PROXY]),t},getUrl:function(t){var i=this.getUrlPrefix(t);t&&t.$remoteProxy&&(i=o.REMOTE_PROXY+t.$remoteProxy.uuid);var n=e.extend(this._getQueryParameterValues(this.parameters,t),this.getQueryParamsMap(t)),s=this.getQueryParams(n);return""+i+this._getUrl(t)+s},getParameters:function(){return this.parameters},_getActionHandler:function(n){var s=this,o=this.url;switch(this.getMethod().toLowerCase()){case d.POST:return n===u.ALL?function(n){if(!n||!n.$body){var o={};o[c.OFFSET]=0,o[c.LENGTH]=a.DEFAULT_INTENT_NUM_LIST_RESULTS,n=e.extend(n||{},{$body:o})}var l=s._getParameterisedURL(s.getUrl(n),n);0===l.indexOf("/")&&(l=l.substring(1)),l=s.getBaseUrl(n)+l;var d=t.ajax({type:s.getMethod(),url:r.cacheBustURL(l),data:JSON.stringify(s.getPayload(u.ALL,n)),contentType:"application/json"});return i.resolve(d)}:function(e){var t=s.getResolvedUrl(e),i=s.getPayload(n,e),a=s._getModel(e);return a.setRootUrl(t),a.set(i),s._wrapSaveInPromise(a)};case d.PATCH:case d.PUT:return function(e){var t=s.getResolvedUrl(e),i=s.getPayload(n,e),a=s._getModel(e);return a.setRootUrl(t),a.set(i),e&&e.$fanoutProxy||a.setId(e[c.UUID]),s._wrapSaveInPromise(a)};case d.GET:return function(e){var t=s.getResolvedUrl(e),i=s.getPayload(n,e),a=s._getModel(e);return a.set(i),a.setRootUrl(t),e&&e.$fanoutProxy?(a.executeSuccessUntilStateComplete=!1,a.enableNotifications=!1,s._wrapSaveInPromise(a)):s._wrapFetchInPromise(a)};case d.DELETE:return function(e){var t=s.getResolvedUrl(e),a=s.getPayload(n,e),r=s._getModel(e);return r.setId(e[c.UUID]),r.setRootUrl(t),r.set(a),new i(function(t){r.destroy(),t(e[c.UUID])})};default:return function(){throw new Error("at endpoint "+o+"action "+n+"is not supported for entity: "+s.entityType)}}},getResolvedUrl:function(e){return this._getParameterisedURL(this.getUrl(e),this.getUrlContext(e))},getPayload:function(e,t){var i=this._getBodyParameterValue(this.parameters,t),n=this._getBodyParameter(this.parameters);if(e!==u.ALL&&this._isIntentParameter(n)){var s=this.getMetadata(e,t);return this._addMetaInfo(i,s)}return i},_isIntentParameter:function(e){if(e)return e.schema&&(e=e.schema),e[c.SPEC]&&e[c.METADATA]&&e[c.API_VERSION]||e.properties&&e.properties[c.SPEC]&&e.properties[c.METADATA]&&e.properties[c.API_VERSION]},getMetadata:function(t,i){var n={};return"update"===t&&(n=this._getUpdateMetadata(i[c.UUID])),n[c.KIND]=this.entityType,e.extend(n,i[c.$METADATA]||{})},_wrapSaveInPromise:function(t){return new i(function(i,n){t.save(null,{success:function(e){i(e.toJSON())},error:function(t,i){n(e.isString(i)?Error(i):arguments)}})})},_wrapFetchInPromise:function(t){return new i(function(i,n){t.fetch({success:function(e){i(e.toJSON())},error:function(t,i){n(e.isString(i)?Error(i):arguments)}})})},_getModel:function(e){var t=this,i=new n(null,{serializePollingRequests:!0});i.getDataSourceURL=function(){return t.getBaseUrl(e)},i.entityType=this.entityType;var s=!0;return e&&e.hasOwnProperty("$isAsync")&&(s=e.$isAsync),e&&e.hasOwnProperty("$enableNotifications")&&(i.enableNotifications=Boolean(e.$enableNotifications)),e&&e.hasOwnProperty("$disablePageRefresh")&&(i.triggerAppViewRefresh=function(){}),i.executeSuccessUntilStateComplete=s,i},getBaseUrl:function(e){return this.baseUrl},_getUpdateMetadata:function(e){return{uuid:e,kind:this.entityType}},_getQueryParameterValues:function(e,t){var i={};return t?(this._getQueryParameters(e).forEach(function(e){if(t[e.name])i[e.name]=t[e.name];else if(e.required)throw new Error("missing required query parameter "+e.name)}),i):i},_getQueryParameters:function(e){var t=this;return e.filter(function(e){return e.$ref&&(e=t.parser.getParameter(e.$ref)),"query"===e.in})},_getPathParameters:function(t){return e.filter(t,function(e){return e.$ref&&(e=this.parser.getParameter(e.$ref)),"path"===e.in},this)},_getPathParameterValues:function(t,i){var n={};return e.each(this._getPathParameters(t),function(e){n[e.name]=i[e.name]}),n},_getBodyParameter:function(t){var i=e.filter(t,function(e){return"body"===e.in});if(i.length>1)throw new Error("Multiple body parameters are not allowed");return i.length?(i[0].name="$body",i[0]):null},_getBodyParameterValue:function(e,t){var i=this._getBodyParameter(e);if(i&&!t[i.name]&&i.required)throw new Error("required body parameter "+i.name+" is not provided");return i?t[i.name]:{}},_getParameterisedURL:function(e,t){for(var i;null!==(i=h.exec(e));){if(!t[i[1]])throw new Error("mandatory parameter "+i[1]+"not provided");e=e.replace("{"+i[1]+"}",t[i[1]])}return e},_addMetaInfo:function(e,t){e||(e={});var i={};return i[c.SPEC]=e,i[c.METADATA]=t,i[c.API_VERSION]=this.apiVersion,i}},l}),define("models/intent/IntentActionCollection",["underscore"],function(e){"use strict";function t(e,t){this.initialize(e,t)}t.prototype={name:"IntentActionCollection",actions:[],initialize:function(e,t){this.actions=e.slice(0),this.operationName=t.name},asBehaviour:function(){var e=this,t=function(t){return e._getAction(t)._getActionHandler(e.operationName)(t)};return t.getAction=function(t){return e._getAction(t)},t},_getAction:function(t){var i=this.find(function(e){return t.$method?t.$url&&t.$method&&e.getUrl()===t.$url&&e.getMethod()===t.$method:t.$url&&e._getUrl()===t.$url}),n=[];if(i||this.each(function(i){var s=i.getParameters();e.find(s,function(e){var i=e.name;return"body"===e.in&&(i="$body"),!t.hasOwnProperty(i)})||n.push(i)},this),1===n.length&&(i=n[0]),!i){if(n.length)throw new Error("Ambiguous request please add $url to data");throw new Error("no action found")}return i},add:function(e){return this.actions.push(e)}};var i=["forEach","each","map","reduce","reduceRight","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","sortBy","sortedIndex","toArray","size","first","initial","rest","last","without","indexOf","shuffle","lastIndexOf","isEmpty","groupBy"];return e.each(i,function(i){t.prototype[i]=function(){return e[i].apply(e,[this.actions].concat(e.toArray(arguments)))}}),t}),define("models/intent/IntentValidator",["underscore"],function(e){"use strict";function t(e,t){this.entityType=e,this.parser=t,this.definition=t.getDefinitionByEntityType(e)}return t.prototype={validate:function(e){this._validateDefinition(e,this.definition)},_validateDefinition:function(t,i){var n=[];return e.each(i.properties,function(i,s){try{this.validateField(s,t[s],i)}catch(t){e.isArray(t)?n.concat(t):n.push(t)}}),n},validateField:function(e,t,i){var n=[];switch(i.type){case"object":this._validateDefinition(t,i);break;case"array":this._validateDefinition(t,i.items);break;case"string":this._validateStringField(e,t,i);break;case"integer":this._validateIntegerField(e,t,i);break;case"boolean":this._validateBooleanField(e,t,i);break;case"number":this._validateNumberField(e,t,i);break;default:throw new Error("Unknown field type "+i.type)}return n},_validateStringField:function(e,t,i){if(t){if(i.maxLength&&t.length>i.maxLength)throw new Error(e+" can't be longer than "+i.maxLength);i.pattern?this._validatePatternField(e,t,i):i.enum&&this._validateEnumField(e,t,i)}},_validateIntegerField:function(e,t,i){if(t){if(isNaN(t))throw new Error(e+" is an integer field");if(i.minimum&&t>i.minimum)throw new Error(e+" can't be less than "+i.minimum);if(i.maximum&&t>i.maximum)throw new Error(e+" can't be greater than "+i.maximum)}},_validateNumberField:function(e,t,i){if(t){if(isNaN(t))throw new Error(e+" is an Number field");if(i.minimum&&t>i.minimum)throw new Error(e+" can't be less than "+i.minimum);if(i.maximum&&t>i.maximum)throw new Error(e+" can't be greater than "+i.maximum)}},_validateBooleanField:function(e,t){if(t){var i=t.toLowerCase()
;if("true"!==i&&"false"!==i)throw new Error(e+" is boolean field, possible values are (true, false).")}},_validatePatternField:function(e,t,i){if(!new RegExp(i.pattern).test(t))throw new Error("Invalid value "+t+" for "+e)},_validateEnumField:function(t,i,n){if(!e.find(n.enum,function(e){return i===e}))throw new Error("Invalid value "+i+" for "+t+" possible values are("+JSON.stringify(n.enum)+")")}},t}),define("models/intent/IntentServiceProvider",[],function(){"use strict";function e(){this.data={}}var t=null;return(e.prototype={getServiceClass:function(e,t,i){var n=null;return i&&(n=this._getServiceClass(e,t,i)),n||(i="default",n=this._getServiceClass(e,t,i)),n},_getServiceClass:function(e,t,i){if(!t)throw new Error("version is required");return this.data[t]||(this.data[t]={}),this.data[t][i]||(this.data[t][i]={}),this.data[t][i][e]},register:function(e,t,i){var n=(i||{}).context;return n||(n="default"),this.data[n]||(this.data[n]={}),this.data[n][e]=t,t},getInstance:function(){return t||(t=new e),t}}).getInstance()}),define("models/intent/IntentService",["underscore","models/intent/BatchService","models/intent/IntentAction","models/intent/IntentActionCollection","models/intent/IntentValidator","models/intent/IntentServiceProvider","utils/AppUtil"],function(e,t,i,n,s,a,r){"use strict";function o(e){this.initialize(e)}var l=function(){},c=function(t,i,n){var s;return s=i&&i.hasOwnProperty("constructor")?i.constructor:function(){t.apply(this,arguments)},e.extend(s,t),l.prototype=t.prototype,s.prototype=new l,i&&e.extend(s.prototype,i),n&&e.extend(s,n),s.prototype.constructor=s,s.__super__=t.prototype,s};return o.prototype={name:"IntentService",DP:{METHOD_ALL:"all"},initialize:function(t){this.entityType=t.entityType,this.parser=t.parser,this.endpoints=t.endpoints,this.actions=[],this.baseUrl=t.baseUrl.replace(/\/?$/,"/"),this.apiVersion=t.apiVersion,this.validator=new s(this.entityType,this.parser),e.each(this.endpoints,function(e,t){this.addEndpoint(e,t)},this),e.each(this.actions,function(e){var t=e.getName();"function"!=typeof this[t]&&(this[t]=this[t].asBehaviour())},this)},addEndpoint:function(t,i){e.each(t,function(e,t){this.addAction(i,t,e)},this)},addAction:function(e,t,s){var a=new i({url:e,method:t,actionObj:s,baseUrl:this.baseUrl,parser:this.parser,entityType:this.entityType,apiVersion:this.apiVersion}),o=a.getName();o||r.log("unable to get name for "+e+" http method: "+t+" entityType: "+this.entityType),this.actions.push(a),this[o]?(r.log(this.entityType+" "+t+" "+o+" already exists"),this[o]instanceof i?this[o]=new n([this[o],a],{name:o}):this[o].add(a)):this[o]=a},getAllActions:function(t){return e.filter(this.actions,function(e){return e.getName()===t})},remoteProxy:function(e,t,i){return i.$remoteProxy={uuid:e},this[t](i)},fanoutProxy:function(e,t,i){if(!e||!e.remoteClusterUuid&&!e.azName)throw new Error("Please provide a valid destination");return i.$fanoutProxy={remoteClusterUuid:e.remoteClusterUuid,azName:e.azName},this[t](i)},validate:function(e,t,i){}},o.extend=function(e,t){var i=c(this,e,t);return i.extend=o.extend,i},o.getServiceClass=function(e,t){return t||(t={}),a.getServiceClass(e,t.version,t.context)||o},o.getBatchService=function(e){return new t(e)},o}),define("models/intent/IntentParser",["jqueryplugins","underscore","bluebird","models/intent/IntentService","managers/IntentManager"],function(e,t,i,n,s){"use strict";function a(e,i){var n=this;this.context=i,this.swaggerInfo=o,this.definitions=[],this.paths=this.swaggerInfo.then(function(e){return e.paths}),this.entityMap=this.swaggerInfo.then(function(e){n.parameters=e.parameters,n.definitions=e.definitions,n.apiVersion=e.info.version;var i={};return t.each(e.paths,function(s){t.each(s,function(s){var a=n._getKindFromMethod(s),r=n._getDefinitionObject(a);if(a&&r&&!i[a]){var o=n._getPathsByEntityType(a,e.paths);t.isEmpty(o)||(i[a]={entityType:a,isTag:!1,endpoints:o,baseUrl:e.basePath,apiVersion:e.info.version,parser:n})}else if(!a){var l=n._getTagsFromMethod(s);l.forEach(function(s){if(!i[s]){var a=n._getPathsByTag(s,e.paths);t.isEmpty(a)||(i[s]={entityType:s,isTag:!0,endpoints:a,baseUrl:e.basePath,apiVersion:e.info.version,parser:n})}})}})}),i})}var r={ENTITY_TYPE:"x-ntnx-kind",TAGS:"tags"},o=i.resolve(s.fetchConfigurations()),l={};return a.prototype={_getDefinitionObject:function(e){return t.extend({},t.find(this.definitions,function(t,i){return i.toLowerCase()===e.toLowerCase()}))},getInstance:function(e){e||(e={});var t=e.version||"latest";return l[t]||(l[t]=new a(e.version,e.context)),l[t]},getServiceByEntityType:function(e){var t=this;return this.entityMap.then(function(i){return new(n.getServiceClass(e,{context:t.context,version:t.apiVersion}))(i[e])})},getPathsByEntityType:function(e){return this.paths.then(function(t){return this._getPathsByEntityType(e,t)})},_getPathsByEntityType:function(e,i){var n={};return t.each(i,function(i,s){t.find(i,function(t){return this._getKindFromMethod(t)===e},this)&&(n[s]=i)},this),n},_getPathsByTag:function(e,i){var n={};return t.each(i,function(i,s){t.find(i,function(t){return this._getTagsFromMethod(t).indexOf(e)>-1},this)&&(n[s]=i)},this),n},_getKindFromMethod:function(e){return(e[r.ENTITY_TYPE]||"").replace("'","").replace("‘","")},_getTagsFromMethod:function(e){return e[r.TAGS]||[]},_getAttributeByPath:function(e){for(var i=e.replace("#/","").split("/"),n=this.swaggerInfo.value(),s=0;s<i.length;s++)n=n[i[s]];return t.isArray(n)?n=n.slice(0):t.isObject(n)&&(n=t.extend({},n)),n},getParameter:function(e){return this._getAttributeByPath(e)},_getDefinitionByPath:function(e){return this._resolveDefinition(this._getAttributeByPath(e))},getDefinitionByEntityType:function(e){if(!this.swaggerInfo.isFulfilled())throw new Error("Not initialized with swagger yet");return this._resolveDefinition(this._getDefinitionObject(e))},getPropertiesByEntityType:function(e){if(!this.swaggerInfo.isFulfilled())throw new Error("Not initialized with swagger yet");return this.getDefinitionByEntityType(e).properties},_resolveDefinition:function(e){return e.properties=t.extend({},e.properties),t.each(e.properties,function(i,n){i=t.extend({},i),e.properties[n]=i,i.$ref?e.properties[n]=this._resolveDefinition(this._getDefinitionByPath(i.$ref)):i.items&&i.items.$ref?i.items=this._resolveDefinition(this._getDefinitionByPath(i.items.$ref)):i.properties&&this._resolveDefinition(i)},this),e},getPropertiesObjectByEntityType:function(e,t){var i=this;return this.swaggerInfo.then(function(){return i._getPropertiesObject(i.getDefinitionByEntityType(e),t)})},getPropertiesObjectByRef:function(e,t){if(!this.swaggerInfo.isFulfilled())throw new Error("Not initialized with swagger yet");return this._getPropertiesObject(this._getDefinitionByPath(e),t)},_getPropertiesObject:function(e,i){var n={};return t.each(e.properties,function(e,t){if("object"===e.type)n[t]=this._getPropertiesObject(e,i);else if("array"===e.type)n[t]=[this._getPropertiesObject(e.items,i)];else if(!e.readonly){var s=e.default||"";"string"===e.type&&e.enum&&1===e.enum.length&&(s=e.enum[0]),!s&&i&&i.onlyValue||(n[t]=s)}},this),n},resolveParameters:function(e){return t.map(e,function(e){return e.$ref?this.getParameter(e.$ref):e.schema&&e.schema.$ref?t.extend({},e,{schema:this.getParameter(e.schema.$ref)}):t.extend({},e)},this)},getPropertiesByEntityAction:function(e,t){var i=this.getAllPropertiesByEntityAction(e,t);return i&&i.length?i[0]:[]},getAllPropertiesByEntityAction:function(e,i){return t.map(this.getAllActions(e,i),function(e){return e.getParameters()},this)},getAllActions:function(e,t){if(!this.entityMap.isFulfilled())throw new Error("Not initialized with swagger yet");return this.getServiceByEntityType(e).value().getAllActions(t)},getAction:function(e,t){var i=this.getAllActions(e,t);return i&&i.length?i[0]:null}}}),define("views/utils/ParticleViewControls",["views/basecomponents/BaseView"],function(e){"use strict";var t=_.template('<div id="disableVideoSection"><div id="disableVideoLink" class="videoControlLink"><%= i18n("freeze_time") %></div><div id="enableVideoLink" class="videoControlLink"><%= i18n("start_time") %></div></div>');return e.extend({name:"ParticleViewControls",events:{"click #disableVideoLink":"onDisableParticlesClick","click #enableVideoLink":"onEnableParticlesClick"},initialize:function(e){this.options&&_.isObject(this.options)&&e.el&&(this.el=e.el),this.render()},render:function(){return this.$el.html(t(this.vtOptions())),this},destroy:function(){e.prototype.destroy.apply(this,arguments)},onDisableParticlesClick:function(){this.options&&_.isObject(this.options)&&_.isObject(this.options.eventHandlers)&&_.isFunction(this.options.eventHandlers.evDisableParticles)&&this.options.eventHandlers.evDisableParticles(),this.toggleVideoControlLink()},onEnableParticlesClick:function(){this.options&&_.isObject(this.options)&&_.isObject(this.options.eventHandlers)&&_.isFunction(this.options.eventHandlers.evDisableParticles)&&this.options.eventHandlers.evEnableParticles(),this.toggleVideoControlLink()},toggleVideoControlLink:function(){this.$(".videoControlLink").toggle()},hideVideoSettingLink:function(){this.$("#disableVideoSection").hide()}})}),define("utils/StyleDescriptor",["data/DataProperties","utils/AppConstants","utils/AppUtil"],function(e,t,i){"use strict";var n={CSS_CLASS_PREFIX:"sd-color-",CHART_COLORS:null,DEFAULT_COLORS:["#000000","#000000","#000000","#000000","#000000"],APP_COLORS:{Blue:["1ABCEC","63D0F1","90DEF4","D3F1FB"],Red:["DD7379","E89DA0","EEB9BB","F8E3E4"],Orange:["FFCE68","FFDD92","FFE6B0","FFF6DF"],Green:["00A187","55BDAA","87CFC3","CFECE7"],Purple:["F588F8","F8ACFA","FAC4FB","FDE7FD"],DarkGreen:["A7CD77","C1DC9E","D3E6B9","EDF5E2"],DarkRed:["E97F38","EFA56F","F4BF98","FAE5D6"],DarkBlue:["277BB4","67A3CA","92BDD8","D4E4F0"],Gray:["BDC3C7","D1D5D8","DEE1E3","F2F3F4"]},DIAGRAM_COLORS:{BLUE:"#22A5F7",PURPLE:"#8a77ed",GREEN:"#36D068"},CHART_LIMITED_COLORS:{Blue:["1ABCEC","63D0F1"],Red:["DD7379","E89DA0"],Orange:["FFCE68","FFDD92"],Green:["00A187","55BDAA"],Purple:["F588F8","F8ACFA"],DarkGreen:["A7CD77","C1DC9E"],DarkRed:["E97F38","EFA56F"],DarkBlue:["277BB4","67A3CA"]},CHART_LIMIT_EXCEEDED_COLOR:"BDC3C7",CP:{COLORS_MAP:{BLACK:"#000000",WHITE:"#ffffff",GRAY:"#dbdfe1",RED:"#cc6164",GRAY_1:"#89949b",GRAY_2:"#edeff0",GRAY_3:"#a7b4bb",BLUE:"#52c6e3",BLUE_2:"#D5F1FC",GRAY_4:"#454c53",GRAY_5:"#c4c9cd",GRAY_6:"#f3f4f5",YELLOW:"#ffce68"},CHART_FILL_COLORS:["#1ABCEC","#DD7379","#FFCE68","#00A187"],CHART_STROKE_COLORS:["#ada5e0","#88cddb","#a3dfca","#a6daa6"]},FS:{COLORS_MAP:{RED:"#cf6a6d",BLUE:"#26bbf0",GREEN:"#6eb17b",YELLOW:"#ffd055"}},EB:{DEFAULT_COLOR_HEX:"26BBF0",CIRCLE_CHECK_COLOR:"#ffffff",CIRCLE_HIGHLIGHT_COLOR:"#cccccc",Critical:"CC6164",Warning:"FFBC0B",Good:"0DC984",Error:"C4C9CD",Unknown:"C4C9CD"},EXPLORE:{TOPOLOGY:{CLUSTER_COLOR:"#eeeeee",HOST_COLOR:"#d8d8d8",VM_COLOR:"#bbbbbb",BG_COLOR:"#ffffff"},PERFORMANCE_IO_TREEMAP:{VM_CRITICAL_COLOR:"#efd1d1",VM_WARNING_COLOR:"#d9df88",VM_NORMAL_COLOR:"#f0f0f0",BG_COLOR:"#ffffff"},ALERT_DISTRIBUTION:{kCritical:"#CC6164",kWarning:"#FFC053",kInfo:"#a7a7a7"},ANOMALIES_DISTRIBUTION:{kIO:"#9e91e3",kCPU:"#f29d49",kMemory:"#a8cc3d",kNetworking:"#60c2e3"}},NETVIZ:{VLAN_UNSELECTED_FILL:"FFFFFF",VLAN_UNSELECTED_STROKE:"DCE1E3",VLAN_UNKNOWN_FILL:"000000",VLAN_COLORS:["9E91E3","A8CC3D","F2CA00","5F96E3","F29D49"]},LOGIN_THEME_COLORS:[{name:"Default",leftColor:"#3F3251",rightColor:"#002025"},{name:"Sunrise",leftColor:"#CC6164",rightColor:"#FFD055"},{name:"Ocean",leftColor:"#11A3D7",rightColor:"#3f3251"},{name:"Denim",leftColor:"#606c88",rightColor:"#3f4c6b"},{name:"Blackberry Lemonade",leftColor:"#F0C27B",rightColor:"#4B1248"},{name:"Green Tea",leftColor:"#ADD100",rightColor:"#7B920A"},{name:"Lavender",leftColor:"#B993D6",rightColor:"#8CA6DB"}],LOGIN_IE9_CUSTOM_BACKGROUNDS:[{name:"Default",backgroundColor:"#162634"},{name:"Rainbow",backgroundColor:"#F4A6FD"}],RAINBOW_GRADIENT:"linear-gradient(56deg, #F08080 0%, #FFA07A 15%, #F0E68C 30%, #90EE90 50%, #87CEEB 63%, #DDA0DD 80%)",INTENT_STATE_STYLE:{SUCCEEDED:"succeeded",FAILED:"failed",PENDING:"pending",WARNING:"warning",DEFAULT:""},QOS_CHART_COLORS:{QUEUED:"#DF4A53",DELIVERED:"#2282E3"},getChartColor:function(i){switch(i){case e.STATS_HYP_NUM_IOPS:case e.STATS_HYP_NUM_READ_IOPS:case e.STATS_HYP_NUM_WRITE_IOPS:case e.STATS_HYP_CPU_READY_TIME:case e.STATS_NUM_IOPS:case e.STATS_CONTROLLER_NUM_IOPS:case e.STATS_CONTROLLER_NUM_READ_IOPS:case e.STATS_CONTROLLER_NUM_WRITE_IOPS:case e.STATS_NETWORK_RECEIVED_RATE:case e.STATS_NETWORK_DISCARD_RECEIVED_PACKETS:case e.STATS_NETWORK_ERROR_RECEIVED_PACKETS:case t.METRIC_IOPS:case"rx_dropped":return["#36D068","#36D068"];case e.STATS_HYP_BANDWIDTH:case e.STATS_HYP_READ_BANDWIDTH:case e.STATS_HYP_WRITE_BANDWIDTH:case e.STATS_BANDWIDTH:case e.STATS_CONTROLLER_BANDWIDTH:case e.STATS_CONTROLLER_READ_BANDWIDTH:case e.STATS_CONTROLLER_WRITE_BANDWIDTH:case e.STATS_NETWORK_TRANSMITTED_RATE:case e.STATS_NETWORK_DISCARD_TRANSMITTED_PACKETS:case e.STATS_NETWORK_ERROR_TRANSMITTED_PACKETS:case t.METRIC_BANDWIDTH:case"tx_dropped":return["#FFCF26","#FFCF26"];case e.STATS_HYP_AVG_IO_LATENCY:case e.STATS_HYP_AVG_READ_IO_LATENCY:case e.STATS_HYP_AVG_WRITE_IO_LATENCY:case e.STATS_AVG_IO_LATENCY:case e.STATS_CONTROLLER_AVG_IO_LATENCY:case t.METRIC_LATENCY:case e.STATS_NETWORK_USAGE_RATE:case e.STATS_NETWORK_DISCARD_RECEIVED_PACKETS:return["#F16363","#F16363"];case e.STATS_CONTROLLER_AVG_READ_IO_LATENCY:return["#9e91e3","#9e91e3"];case e.STATS_CONTROLLER_AVG_WRITE_IO_LATENCY:return["#a8cc3d","#a8cc3d"];case e.STATS_CTRLR_READ_SRC_CACHE_SSD_BYTES:return["#9e91e3","#c8c1ef","#f2f0fb"];case e.STATS_CTRLR_RANDOM_READ_OPS:return["#9e91e3","#f2f0fb","#a8cc3d","#f4f8e6"];case t.METRIC_USAGE_SUMMARY:return["#4d86a7","#639ab9"];case"cpu_usage":case t.METRIC_CPU_USAGE:case e.STATS_HYP_CPU_USAGE:case e.STATS_HYP_CPU_USAGE_ESX:case e.STATS_HYP_CPU_USAGE_KVM:case e.STATS_HYP_CPU_USAGE_HYPERV:case e.STATS_NETWORK_TOTAL_RECEIVED_PACKETS:case e.STATS_NETWORK_UNICAST_RECEIVED_PACKETS:return["#6496c7","#3d6892"];case"memory_usage":case t.METRIC_MEMORY_USAGE:case e.STATS_MEMORY_USAGE:case e.STATS_HYP_MEMORY_USAGE:case e.STATS_HYP_MEMORY_USAGE_ESX:case e.STATS_HYP_MEMORY_USAGE_KVM:case e.STATS_HYP_MEMORY_USAGE_HYPERV:case e.STATS_NETWORK_TOTAL_TRANSMITTED_PACKETS:case e.STATS_NETWORK_UNICAST_TRANSMITTED_PACKETS:return["#af6dd4","#5f2282"];case t.METRIC_BW_TRANSFERRED:case e.STATS_REP_BW_TRANSFERRED:return["#6496c7","#3d6892"];case t.METRIC_BW_RECEIVED:case e.STATS_REP_BW_RECEIVED:case e.CP_RESERVED_USAGE:case e.CP_RESERVED_PREDICT_USAGE:return["#af6dd4","#5f2282"];case e.CP_MEMORY_USAGE:case e.CP_MEMORY_PREDICT_USAGE:case e.CP_SSHOT_RECLAIM_BYTES:case e.CP_SSHOT_RECLAIM_PREDICT_BYTES:return["#1ABCEC","#ada5e0"];case e.CP_CPU_USAGE:case e.CP_CPU_PREDICT_USAGE:return["#DD7379","#88cddb"];case e.CP_STORAGE_LIVE_USAGE:case e.CP_LIVE_PREDICT_USAGE:case e.CP_STORAGE_USAGE:case e.CP_STORAGE_PREDICT_USAGE:return["#FFCE68","#f0faf7"];case e.CP_STORAGE_NO_RESERVATION:case e.CP_STORAGE_SYSTEM_USAGE:case e.CP_SYSTEM_PREDICT_USAGE:return["#00A187","#a6daa6"];case e.STATS_FS_CONNECTED_USERS:case e.STATS_SHARE_CONNECTED_USERS:case e.STATS_VFS_FILES_USED:case e.SHARE_STATS_VFS_FILES_USED:return["#E9F7FB"];case e.STATS_CONTROLLER_ICAP_TOTAL_QUEUE_LENGTH_OVER_TIME:return["#FDF7D9"];case e.STATS_CONTROLLER_FS_TOTAL_SIZE_OVER_TIME:case e.STATS_CONTROLLER_FS_SNAPSHOT_SIZE_OVER_TIME:case e.STATS_CONTROLLER_SHARE_TOTAL_SIZE_OVER_TIME:case e.STATS_CONTROLLER_SHARE_SNAPSHOT_SIZE_OVER_TIME:return["#60C2E3","#F2CA00"];case e.STATS_CONTROLLER_ICAP_TOTAL_FILES_SCANNED_OVER_TIME:case e.STATS_CONTROLLER_ICAP_TOTAL_THROUGHPUT_OVER_TIME:case e.STATS_CONTROLLER_ICAP_FILES_SCANNED_OVER_TIME:case e.STATS_CONTROLLER_ICAP_THROUGHPUT_OVER_TIME:return["#E9F7FB","#FDF7D9"];case e.STATS_CONTROLLER_SHARE_SIZES:case e.STATS_CONTROLLER_ICAP_TOTAL_LATENCY_OVER_TIME:case e.STATS_CONTROLLER_ICAP_LATENCY_OVER_TIME:return["#60c2e3","#F2CA00"];case e.STATS_PERFORMANCE_FS_OVERALL_LATENCY_OVER_TIME:case e.STATS_PERFORMANCE_SHARE_OVERALL_LATENCY_OVER_TIME:case e.STATS_PERFORMANCE_FS_OVERALL_TPUT_OVER_TIME:case e.STATS_PERFORMANCE_SHARE_OVERALL_TPUT_OVER_TIME:return["#60C2E3"];case e.STATS_PERFORMANCE_FS_OVERALL_IOPS_OVER_TIME:case e.STATS_PERFORMANCE_SHARE_OVERALL_IOPS_OVER_TIME:return["#E9F7FB"];case e.STATS_PERFORMANCE_FS_WRITE_TPUT_OVER_TIME:case e.STATS_PERFORMANCE_FS_READ_TPUT_OVER_TIME:case e.STATS_PERFORMANCE_SHARE_WRITE_TPUT_OVER_TIME:case e.STATS_PERFORMANCE_SHARE_READ_TPUT_OVER_TIME:return["#9E91E3","#E67388"];case e.STATS_PERFORMANCE_FS_WRITE_LATENCY_OVER_TIME:case e.STATS_PERFORMANCE_FS_READ_LATENCY_OVER_TIME:case e.STATS_PERFORMANCE_FS_METADATA_LATENCY_OVER_TIME:case e.STATS_PERFORMANCE_FS_WRITE_IOPS_OVER_TIME:case e.STATS_PERFORMANCE_FS_READ_IOPS_OVER_TIME:case e.STATS_PERFORMANCE_FS_METADATA_IOPS_OVER_TIME:case e.STATS_PERFORMANCE_SHARE_WRITE_LATENCY_OVER_TIME:case e.STATS_PERFORMANCE_SHARE_READ_LATENCY_OVER_TIME:case e.STATS_PERFORMANCE_SHARE_METADATA_LATENCY_OVER_TIME:case e.STATS_PERFORMANCE_SHARE_WRITE_IOPS_OVER_TIME:case e.STATS_PERFORMANCE_SHARE_READ_IOPS_OVER_TIME:case e.STATS_PERFORMANCE_SHARE_METADATA_IOPS_OVER_TIME:return["#9E91E3","#E67388","#F2CA00"]}return i.toLowerCase().indexOf("memory")>=0?["#af6dd4","#5f2282"]:i.toLowerCase().indexOf("cpu")>=0?["#6496c7","#3d6892"]:i.toLowerCase().indexOf("iops")>=0?["#36D068","#36D068"]:i.toLowerCase().indexOf("bandwidth")>=0?["#FFCF26","#FFCF26"]:i.toLowerCase().indexOf("latency")>=0?["#F16363","#F16363"]:["#36D068","#36D068"]},getChartStrokeColor:function(t){switch(t){case e.STATS_FS_CONNECTED_USERS:case e.STATS_SHARE_CONNECTED_USERS:case e.STATS_VFS_FILES_USED:case e.SHARE_STATS_VFS_FILES_USED:return["#60C2E3"];case e.STATS_CONTROLLER_ICAP_TOTAL_QUEUE_LENGTH_OVER_TIME:return["#F2CA00"];case e.STATS_CONTROLLER_ICAP_TOTAL_FILES_SCANNED_OVER_TIME:case e.STATS_CONTROLLER_ICAP_TOTAL_THROUGHPUT_OVER_TIME:case e.STATS_CONTROLLER_ICAP_FILES_SCANNED_OVER_TIME:case e.STATS_CONTROLLER_ICAP_THROUGHPUT_OVER_TIME:return["#60C2E3","#F2CA00"];case e.STATS_PERFORMANCE_FS_OVERALL_IOPS_OVER_TIME:case e.STATS_PERFORMANCE_FS_OVERALL_TPUT_OVER_TIME:case e.STATS_PERFORMANCE_SHARE_OVERALL_TPUT_OVER_TIME:return["#60c2e3"];case e.STATS_PERFORMANCE_FS_WRITE_IOPS_OVER_TIME:case e.STATS_PERFORMANCE_FS_READ_IOPS_OVER_TIME:case e.STATS_PERFORMANCE_FS_METADATA_IOPS_OVER_TIME:case e.STATS_PERFORMANCE_SHARE_WRITE_IOPS_OVER_TIME:case e.STATS_PERFORMANCE_SHARE_READ_IOPS_OVER_TIME:case e.STATS_PERFORMANCE_SHARE_METADATA_IOPS_OVER_TIME:return["#9E91E3","#E67388","#F2CA00"]}return["#36D068","#36D068"]},getAllChartColors:function(){return _.map(n.CHART_LIMITED_COLORS,function(e,t){return e[0]})},getPieChartColor:function(e){switch(e){case t.METRIC_IOPS:return["#36D068","#36D068"];case t.METRIC_BANDWIDTH:return["#FFCF26","#FFCF26"];case t.METRIC_LATENCY:return["#F16363","#F16363"];case t.METRIC_USAGE_SUMMARY:return["#6eb17b","#777777"];case t.METRIC_CPU_USAGE:return["#6496c7","#3d6892"];case t.METRIC_MEMORY_USAGE:return["#af6dd4","#5f2282"];case t.METRIC_BW_TRANSFERRED:return["#6496c7","#3d6892"];case t.METRIC_BW_RECEIVED:return["#af6dd4","#5f2282"];default:return["#000000","#000000"]}},getAnalysisChartColors:function(e){return null===this.CHART_COLORS&&this._initColors(),this.CHART_COLORS[e]||this.DEFAULT_COLORS},getHealthColor:function(e){switch(e){case t.HEALTH_STATUS.CRITICAL:return this.EB.Critical;case t.HEALTH_STATUS.WARNING:return this.EB.Warning;case t.HEALTH_STATUS.GOOD:return this.EB.Good;case t.HEALTH_STATUS.ERROR:return this.EB.Error;case t.HEALTH_STATUS.UNKNOWN:return this.EB.Unknown}return this.EB.Unknown},getHealthColorClass:function(e){var i=void 0;switch(e){case t.HEALTH_STATUS.CRITICAL:case t.HEALTH_STATUS.WARNING:case t.HEALTH_STATUS.GOOD:i=e;break;default:i="unknown"}return this.CSS_CLASS_PREFIX+"health-"+i.toLowerCase()},getInsightsThresholdColor:function(e){switch(e){case t.INSIGHTS_CHART_WATERMARKS.THRESHOLD_WARN:return"CCCC00";case t.INSIGHTS_CHART_WATERMARKS.THRESHOLD_MAX:return"D50F19"}},getAlertThresholdColor:function(e){return e===t.ALERT_HEALTH.CRITICAL?"CC6164":e===t.ALERT_HEALTH.WARNING?"FFC053":void 0},getAlertHealthColorClass:function(e){switch(e){case t.ALERT_HEALTH.CRITICAL:case t.ALERT_HEALTH.HIGH:case t.ALERT_HEALTH.MEDIUM:case t.ALERT_HEALTH.WARNING:case t.ALERT_HEALTH.LOW:case t.ALERT_HEALTH.INFO:return e=e.toLowerCase(),this.CSS_CLASS_PREFIX+"alerts-"+e}return this.CSS_CLASS_PREFIX+"alerts-unknown"},getPowerStateColorClass:function(e){var i=e.toLowerCase();switch(i){case t.VM_POWER_STATE.ON:case t.VM_POWER_STATE.OFF:case t.VM_POWER_STATE.SUSPENDED:case t.VM_POWER_STATE.PAUSED:case t.VM_POWER_STATE.UNKNOWN:return this.CSS_CLASS_PREFIX+"power-state-"+i}return this.CSS_CLASS_PREFIX+"power-state-unknown"},getUniqueChartColor:function(e){for(var t=null,i=0;i<2&&(_.each(this.CHART_LIMITED_COLORS,function(n){if(!t){var s=n[i];e.indexOf(s)<0&&(t=s)}},this),!t);i++);return t||this.DEFAULT_COLORS[0]},getUniqueColorClass:function(e){return this.CSS_CLASS_PREFIX+"unique-"+(1+e.length)},getColorLuminance:function(e,t){e=String(e).replace(/[^0-9a-f]/gi,""),e.length<6&&(e=e[0]+e[0]+e[1]+e[1]+e[2]+e[2]),t=t||0;var i="",n=void 0,s=void 0;for(s=0;s<3;s++)n=parseInt(e.substr(2*s,2),16),n=Math.round(Math.min(Math.max(0,n+n*t),255)).toString(16),i+=("00"+n).substr(n.length);return i},getIntentStateStyle:function(e){return i.isIntentStateComplete(null,e)?this.INTENT_STATE_STYLE.SUCCEEDED:i.isIntentStateError(null,e)?this.INTENT_STATE_STYLE.FAILED:i.isIntentStatePending(null,e)?this.INTENT_STATE_STYLE.PENDING:i.isIntentStateRetry(null,e)?this.INTENT_STATE_STYLE.WARNING:this.INTENT_STATE_STYLE.DEFAULT},_initColors:function(){this.CHART_COLORS={},this.CHART_COLORS[e.STATS_HYP_NUM_IOPS]=this.CHART_COLORS[e.STATS_HYP_NUM_READ_IOPS]=this.CHART_COLORS[e.STATS_HYP_NUM_WRITE_IOPS]=this.CHART_COLORS[e.STATS_HYP_CPU_READY_TIME]=this.APP_COLORS.DarkGreen,this.CHART_COLORS[e.STATS_NUM_IOPS]=this.CHART_COLORS[e.STATS_NUM_READ_IOPS]=this.CHART_COLORS[e.STATS_NUM_WRITE_IOPS]=this.APP_COLORS.DarkGreen,this.CHART_COLORS[e.STATS_READ_IO_PPM]=this.APP_COLORS.Red,this.CHART_COLORS[e.STATS_WRITE_IO_PPM]=this.APP_COLORS.Blue,this.CHART_COLORS[e.STATS_HYP_BANDWIDTH]=this.CHART_COLORS[e.STATS_HYP_READ_BANDWIDTH]=this.CHART_COLORS[e.STATS_HYP_WRITE_BANDWIDTH]=this.APP_COLORS.Orange,this.CHART_COLORS[e.STATS_BANDWIDTH]=this.CHART_COLORS[e.STATS_READ_BANDWIDTH]=this.CHART_COLORS[e.STATS_WRITE_BANDWIDTH]=this.APP_COLORS.Orange,this.CHART_COLORS[e.STATS_HYP_AVG_IO_LATENCY]=this.CHART_COLORS[e.STATS_HYP_AVG_READ_IO_LATENCY]=this.CHART_COLORS[e.STATS_HYP_AVG_WRITE_IO_LATENCY]=this.APP_COLORS.DarkRed,this.CHART_COLORS[e.STATS_AVG_IO_LATENCY]=this.CHART_COLORS[e.STATS_AVG_READ_IO_LATENCY]=this.CHART_COLORS[e.STATS_AVG_WRITE_IO_LATENCY]=this.APP_COLORS.DarkRed,this.CHART_COLORS[e.STATS_HYP_CPU_USAGE]=this.APP_COLORS.Green,this.CHART_COLORS[e.STATS_HYP_MEMORY_USAGE]=this.APP_COLORS.Purple,this.CHART_COLORS[e.STATS_MEMORY_USAGE]=this.APP_COLORS.Purple,this.CHART_COLORS[e.NEW_TOT_USED_PHY]=this.CHART_COLORS[e.STATS_TRANSFORMED_USAGE]=this.APP_COLORS.DarkBlue,this.CHART_COLORS[e.NEW_TOT_USED_LOG]=this.CHART_COLORS[e.NEW_CONTAINER_OWN_USAGE_LOGICAL]=this.CHART_COLORS[e.STATS_UNTRANSFORMED_USAGE]=this.APP_COLORS.Gray,this.CHART_COLORS[e.STATS_HYP_CPU_USAGE_ESX]=this.APP_COLORS.Green,this.CHART_COLORS[e.STATS_HYP_MEMORY_USAGE_ESX]=this.APP_COLORS.Purple,this.CHART_COLORS[e.STATS_HYP_CPU_USAGE_KVM]=this.APP_COLORS.DarkBlue,this.CHART_COLORS[e.STATS_HYP_MEMORY_USAGE_KVM]=this.APP_COLORS.DarkRed,this.CHART_COLORS[e.STATS_HYP_CPU_USAGE_HYPERV]=this.APP_COLORS.Orange,this.CHART_COLORS[e.STATS_HYP_MEMORY_USAGE_HYPERV]=this.APP_COLORS.Blue,this.CHART_COLORS[e.STATS_REP_NUM_TRANSMITTED_BYTES]=this.APP_COLORS.Blue,this.CHART_COLORS[e.STATS_REP_TOT_TRANSMITTED_BYTES]=this.APP_COLORS.Red,this.CHART_COLORS[e.STATS_REP_NUM_RECEIVED_BYTES]=this.APP_COLORS.Orange,this.CHART_COLORS[e.STATS_REP_TOT_RECEIVED_BYTES]=this.APP_COLORS.Green,this.CHART_COLORS[e.STATS_REP_BW_TRANSFERRED]=this.APP_COLORS.Purple,this.CHART_COLORS[e.STATS_REP_BW_RECEIVED]=this.APP_COLORS.Gray,this.CHART_COLORS[e.STATS_CONTROLLER_NUM_IOPS]=this.CHART_COLORS[e.STATS_CONTROLLER_NUM_READ_IOPS]=this.CHART_COLORS[e.STATS_CONTROLLER_NUM_WRITE_IOPS]=this.APP_COLORS.DarkGreen,this.CHART_COLORS[e.STATS_CONTROLLER_BANDWIDTH]=this.CHART_COLORS[e.STATS_CONTROLLER_READ_BANDWIDTH]=this.CHART_COLORS[e.STATS_CONTROLLER_WRITE_BANDWIDTH]=this.APP_COLORS.Orange,this.CHART_COLORS[e.STATS_CONTROLLER_READ_IO_PPM]=this.APP_COLORS.Red,this.CHART_COLORS[e.STATS_CONTROLLER_WRITE_IO_PPM]=this.APP_COLORS.Blue,this.CHART_COLORS[e.STATS_CONTROLLER_AVG_IO_LATENCY]=this.APP_COLORS.DarkRed,this.CHART_COLORS[e.STATS_CONTROLLER_AVG_READ_IO_LATENCY]=this.APP_COLORS.Blue,this.CHART_COLORS[e.STATS_CONTROLLER_AVG_WRITE_IO_LATENCY]=this.APP_COLORS.Purple,this.CHART_COLORS[e.CONTENT_CACHE_NUM_HITS]=this.APP_COLORS.DarkGreen,this.CHART_COLORS[e.CONTENT_CACHE_NUM_LOOKUPS]=this.APP_COLORS.Green,this.CHART_COLORS[e.CONTENT_CACHE_HIT_PPM]=this.APP_COLORS.DarkGreen,this.CHART_COLORS[e.CONTENT_CACHE_NUM_DEDUP_REF_COUNT_PPH]=this.APP_COLORS.Blue,this.CHART_COLORS[e.CONTENT_CACHE_PHYSICAL_MEMORY_USAGE_BYTES]=this.APP_COLORS.Orange,this.CHART_COLORS[e.CONTENT_CACHE_PHYSICAL_SSD_USAGE_BYTES]=this.APP_COLORS.Orange,this.CHART_COLORS[e.CONTENT_CACHE_LOGICAL_MEMORY_USAGE_BYTES]=this.APP_COLORS.DarkRed,this.CHART_COLORS[e.CONTENT_CACHE_LOGICAL_SSD_USAGE_BYTES]=this.APP_COLORS.DarkRed,this.CHART_COLORS[e.CONTENT_CACHE_SAVED_MEMORY_USAGE_BYTES]=this.APP_COLORS.Green,this.CHART_COLORS[e.CONTENT_CACHE_SAVED_SSD_USAGE_BYTES]=this.APP_COLORS.Purple,this.CHART_COLORS[e.DEDUP_FINGERPRINT_CLEARED_BYTES]=this.APP_COLORS.DarkBlue,this.CHART_COLORS[e.DEDUP_FINGERPRINT_ADDED_BYTES]=this.APP_COLORS.Gray,this.CHART_COLORS[e.STATS_HYP_SWAP_IN_RATE]=this.APP_COLORS.DarkBlue,this.CHART_COLORS[e.STATS_HYP_SWAP_OUT_RATE]=this.APP_COLORS.Orange,this.CHART_COLORS[e.STATS_FS_CONNECTED_USERS]=this.CHART_COLORS[e.STATS_SHARE_CONNECTED_USERS]=this.APP_COLORS.DarkGreen,this.CHART_COLORS[t.ENTITY_HOST]=[this.APP_COLORS.Red[0],this.APP_COLORS.Red[2],this.APP_COLORS.Blue[0],this.APP_COLORS.DarkGreen[0],this.APP_COLORS.Purple[0]],this.CHART_COLORS[t.ENTITY_DISK]=[this.APP_COLORS.Orange[0],this.APP_COLORS.Orange[2],this.APP_COLORS.Blue[0],this.APP_COLORS.DarkGreen[0],this.APP_COLORS.Purple[0]],this.CHART_COLORS[t.ENTITY_STORAGE_POOL]=[this.APP_COLORS.Green[0],this.APP_COLORS.Green[2],this.APP_COLORS.Blue[0],this.APP_COLORS.DarkRed[0],this.APP_COLORS.Purple[0]],this.CHART_COLORS[t.ENTITY_CONTAINER]=[this.APP_COLORS.Blue[0],this.APP_COLORS.Blue[2],this.APP_COLORS.Green[0],this.APP_COLORS.DarkRed[0],this.APP_COLORS.Purple[0]],this.CHART_COLORS[t.ENTITY_VM]=[this.APP_COLORS.DarkGreen[0],this.APP_COLORS.DarkGreen[2],this.APP_COLORS.Blue[0],this.APP_COLORS.Red[0],this.APP_COLORS.Purple[0]],this.CHART_COLORS[t.ENTITY_REMOTE_SITE]=[this.APP_COLORS.Green[0],this.APP_COLORS.Green[2],this.APP_COLORS.Blue[0],this.APP_COLORS.Red[0],this.APP_COLORS.Purple[0]],this.CHART_COLORS[t.ENTITY_PROTECTION_DOMAIN]=[this.APP_COLORS.DarkBlue[0],this.APP_COLORS.DarkBlue[2],this.APP_COLORS.Green[0],this.APP_COLORS.Red[0],this.APP_COLORS.Purple[0]],this.CHART_COLORS[t.ENTITY_REPLICATION_LINK]=[this.APP_COLORS.Purple[0],this.APP_COLORS.Purple[2],this.APP_COLORS.Green[0],this.APP_COLORS.Red[0],this.APP_COLORS.Purple[0]],this.CHART_COLORS[t.ENTITY_CLUSTER]=[this.APP_COLORS.DarkRed[0],this.APP_COLORS.DarkRed[2],this.APP_COLORS.Green[0],this.APP_COLORS.Blue[0],this.APP_COLORS.Purple[0]]}};return n}),define("views/utils/ParticleView",["views/basecomponents/BaseView","views/utils/ParticleViewControls","data/DataProperties","utils/AppConstants","utils/AppUtil","utils/StyleDescriptor","particleground"],function(e,t,i,n,s,a,r){"use strict";var o={dotColor:"rgba(255, 255, 255, 1)",lineColor:"rgba(255, 255, 255, 0.05)",minSpeedX:.4,maxSpeedX:1,minSpeedY:.4,maxSpeedY:1,density:2e4,curvedLines:!1,proximity:120,parallaxMultiplier:20,particleRadius:2},l={dotColor:"rgba(255, 255, 255, 0.5)",lineColor:"rgba(255, 255, 255, 0.05)",minSpeedX:.2,maxSpeedX:.5,minSpeedY:.2,maxSpeedY:.5,density:1e4,curvedLines:!1,proximity:10,parallaxMultiplier:40,particleRadius:1,backgroundLayer:!0},c=_.template('<div id="particlesGradient" class="particles-gradient <%= classNames || "" %>"></div>'),u=_.template('<div id="particles-foreground" class="<%= classNames || "" %>"></div><div id="particles-background" class="<%= classNames || "" %>"></div>'),d=void 0,h=void 0,p={masterPaused:!1,foregroundPaused:!1,backgroundPaused:!0,foregroundStartFPS:25,foregroundStopFPS:12,backgroundStartFPS:50,backgroundStopFPS:22,intervalCheck:1e3,pauseIfNeeded:function(e){this.masterPaused||(!0===this.foregroundPaused&&!0===this.backgroundPaused&&e>=this.foregroundStartFPS?(this.foregroundPaused=!1,d.particleground("start")):!1===this.foregroundPaused&&!0===this.backgroundPaused&&e<=this.foregroundStopFPS?(this.foregroundPaused=!0,d.particleground("pause")):!1===this.backgroundPaused&&e<=this.backgroundStopFPS?(this.backgroundPaused=!0,h.particleground("pause")):!0===this.backgroundPaused&&e>=this.backgroundStartFPS&&(this.backgroundPaused=!1,h.particleground("start")))}},T=[],E={startTime:0,frameNumber:0,getFPS:function(){this.frameNumber++;var e=(new Date).getTime(),t=(e-this.startTime)/1e3,i=Math.floor(this.frameNumber/t);return t>1&&(this.startTime=(new Date).getTime(),this.frameNumber=0),i}};return e.extend({particlesOffTimer:null,storedFPSInterval:null,autoPauseIntervalCheck:null,customSettings:null,enableParticles:null,particleViewControls:null,initialize:function(e){this.el=e.el,this.manager=e.manager,this.customSettings=e.customSettings,this.enableParticles=!!_.isBoolean(e.enableParticles)&&e.enableParticles,_.bindAll(this,"fpsLoop")},fpsLoop:function(){this.storedFPSInterval=setInterval(function(){T.push(E.getFPS())},1e3/60)},killParticlesAutoOffTimer:function(){this.particlesOffTimer&&clearTimeout(this.particlesOffTimer),this.storedFPSInterval&&clearInterval(this.storedFPSInterval),this.autoPauseIntervalCheck&&clearInterval(this.autoPauseIntervalCheck),this.particlesOffTimer=null,this.storedFPSInterval=null,this.autoPauseIntervalCheck=null},enableParticlesAutoOffTimer:function(){var e=this;this.killParticlesAutoOffTimer(),this.particlesOffTimer=setTimeout(function(){e.disableParticles()},12e4),this.fpsLoop(),this.autoPauseIntervalCheck=setInterval(function(){for(var e=0,t=0,i=0;i<T.length;i++)e+=parseInt(T[i],10);t=Math.floor(e/T.length),T=[],p.pauseIfNeeded(t)},p.intervalCheck)},renderParticles:function(e){e=e||{},_.isObject(this.options)&&this.options.particleControlsEl&&(this.particleViewControls=new t({el:this.options.particleControlsEl,eventHandlers:{evDisableParticles:this.onDisableVideoClick.bind(this),evEnableParticles:this.onEnableVideo.bind(this)}})),this.$el.prepend(c({classNames:this.getClassNames()})+u({classNames:this.getClassNames()}));var i=this.$("#particlesGradient");d=this.$("#particles-foreground"),h=this.$("#particles-background"),this.customSettings&&this.customSettings.color_in&&this.customSettings.color_in&&this.renderCustomBackground(i);var n=_.defaults(e.fgOptions||{},o),s=_.defaults(e.bgOptions||{},l);d.particleground(n),h.particleground(s),this.enableParticles?this.enableParticlesAutoOffTimer():(this.particleViewControls&&this.particleViewControls.toggleVideoControlLink(),this.$("#particles-foreground, #particles-background").particleground("pause"),p.masterPaused=!0)},hideVideo:function(){this.$el.html(c({classNames:this.getClassNames()}));var e=this.$("#particlesGradient");this.customSettings&&this.customSettings.color_in&&this.customSettings.color_out&&this.renderCustomBackground(e)},getClassNames:function(){return this.options&&_.isObject(this.options)&&this.options.classNames&&_.isString(this.options.classNames)?this.options.classNames:""},renderCustomBackground:function(e){var t,n
;"rainbow"===this.customSettings.color_in&&"rainbow"===this.customSettings.color_out?(t=a.RAINBOW_GRADIENT,n=this._getIE9BackgroundColor("Rainbow")):(t="linear-gradient(-134deg, "+this.customSettings.color_out+" 0%, "+this.customSettings.color_in+" 98%)",n=this.customSettings.color_in===a.LOGIN_THEME_COLORS[0][i.STYLE_DESC_LOGIN_LEFT_COLOR]&&this.customSettings.color_out===a.LOGIN_THEME_COLORS[0][i.STYLE_DESC_LOGIN_RIGHT_COLOR]?this._getIE9BackgroundColor("Default"):this.customSettings.color_in),e.css({"background-color":n,"background-image":t})},_getIE9BackgroundColor:function(e){return _.filter(a.LOGIN_IE9_CUSTOM_BACKGROUNDS,function(t){return t[i.STYLE_DESC_LOGIN_NAME]===e})[0][i.STYLE_DESC_LOGIN_BACKGROUND_COLOR]},destroy:function(){this.particleViewControls&&this.particleViewControls.destroy(),this.disableParticles(),this.undelegateEvents(),this.$("#particles-foreground, #particles-background").particleground("destroy"),this.$("#particles-foreground, #particles-background, #particlesGradient").remove()},onDisableVideoClick:function(){s.hasLocalStorage()&&(localStorage[n.LOCAL_STORAGE.NO_VIDEO]="true"),this.disableParticles()},disableParticles:function(){this.$("#particles-foreground, #particles-background").particleground("pause"),p.masterPaused=!0,this.killParticlesAutoOffTimer()},onEnableVideo:function(){s.hasLocalStorage()&&(localStorage[n.LOCAL_STORAGE.NO_VIDEO]="false"),!1===p.foregroundPaused&&this.$("#particles-foreground").particleground("start"),!1===p.backgroundPaused&&this.$("#particles-background").particleground("start"),p.masterPaused=!1,this.enableParticlesAutoOffTimer()},hideVideoSettingLink:function(){this.particleViewControls.hideVideoSettingLink()}})}),define("broker/api/AppAPI",["bluebird","utils/AjaxUtil","utils/AppConstants","utils/AppUtil","utils/DataExportUtil","utils/TimeUtil","utils/FilterUtil","utils/LogUtil","utils/ValidationUtil","utils/HypervisorUtil","utils/DRaaSUtil","utils/SVG","utils/IntentUtil","utils/StringUtil","utils/StatsUtil","utils/ManagerMixin","components/Components","managers/ModelInstanceManager","managers/I18nManager","managers/IntentManager","managers/HelpManager","managers/UserBehaviorManager","managers/LicenseManager","managers/ActionManager","data/DataManager","data/DataProperties","data/DataURLConstants","graphql","models/smtpserver/SmtpServerModel","models/categories/CategoriesQueryModel","models/broker/GenericAppModel","models/license/LicenseModel","models/intent/IntentService","models/intent/IntentParser","views/utils/ParticleView"],function(e,t,i,n,s,a,r,o,l,c,u,d,h,p,T,E,S,g,A,m,f,I,C,v,R,N,P,O,y,D,M,b,L,w,U){"use strict";var V={QUERY_MODEL:"QUERY_MODEL",QUERY_NAME:"query_name",FILTER_ENTITY_TYPE:"entity_type",FILTER_EXPRESSION:"filter_expression",GROUP_MEMBER_COUNT:"group_member_count",GROUP_COUNT:"group_count",GROUP_MEMBER_OFFSET:"group_member_offset",GROUP_MEMBER_SORT_ORDER:"group_member_sort_order",GROUP_MEMBER_SORT_ATTRIBUTE:"group_member_sort_attribute",TOTAL_ENTITY_COUNT:"total_entity_count",GROUPING_ATTR:"grouping_attribute",GROUP_ATTRIBUTES:"group_attributes",AVAILABILITY_ZONE_SCOPE:"availability_zone_scope"};return _.extend({},E,{setFactoryId:function(e){g.registerFactoryInstance({factoryId:e})},getAppAPI:function(E){var k=this.getAccessManager(),x=this.getAppManager(),F=this.getClusterManager(),Y=this.getNavigationManager(),G=this.getNotificationManager(),B=this.getBrokerManager(),H=k.getPermittedActionsByEntity||function(){};return this.setFactoryId(E),{_require:require,utils:{AppConstants:i,DataProp:N,DataURLConstants:P,uploadBinaryFile:_.bind(n.uploadBinaryFile,n),downloadReport:_.bind(s.exportData,s),filterConditionToFIQL:_.bind(r.filterConditionToFIQL,r),calculateStartTime:_.bind(a.calculateStartTime,a),formatShortTime:_.bind(a.formatShortTime,a),formatShortDate:_.bind(a.formatShortDate,a),formatDateTime:_.bind(a.formatDateTime,a),formatBytes:_.bind(T.storageFormat,T),getDefaultTimezone:_.bind(a.getDefaultTimezone,a),icon:_.bind(S.icon,S),getTestClass:_.bind(n.getTestClass,n),recordUserActivities:_.bind(I.recordUserActivities,I),generateClientUUID:_.bind(n.generateClientUUID,n),debug:o.debug.bind(o),getIn:n.get.bind(n),loadSvg:d.loadSVG.bind(d),particleView:U,isIntentStateComplete:h.isIntentStateComplete.bind(h),getDataURL:m.getDataURL.bind(m),categoryToString:n.categoryToString.bind(n),getPermittedActionsByEntity:_.bind(H,k),isClusterViewerOnly:k.isClusterViewerOnly.bind(k),toUpperCaseFirstChar:p.toUpperCaseFirstChar.bind(p),isFeatureSupportedOnHypervisor:c.isFeatureSupported.bind(c),getDominantHypervisor:c.getDominantHypervisor.bind(c),isDraasSupported:u.isDraasSupported.bind(u),compareVersions:n.compareVersions.bind(n),isClusterAdmin:k.isClusterAdmin.bind(k),processSerializedObject:t.processSerializedObject.bind(t)},models:{getModel:g.getModel.bind(g),getCollection:g.getCollection.bind(g),SmtpServerModel:y.bind(y),getCategories:function(t){var i=D.loadCategories(t);return e.resolve(i).then(function(e){return e.getResultEntities().map(function(e){var t;return t={},_defineProperty(t,N.CAT_NAME,e.get(N.CAT_NAME)),_defineProperty(t,N.CAT_VALUE,e.get(N.CAT_VALUE)),_defineProperty(t,N.CAT_IMMUTABLE,e.get(N.CAT_IMMUTABLE)),t})})},GenericAppModel:M,LicenseModel:b},navigation:{navigateToRoute:Y.navigateToRoute.bind(Y),getHelpUrlForAction:f.getHelpUrlForAction.bind(f),navigateToHelpPageBasedOnAction:f.navigateToHelpPageBasedOnAction.bind(f),navigateToPage:Y.navigateToPage.bind(Y)},validation:{validateIntentPayload:m.validateIntentPayload.bind(m),validEmail:_.bind(l.validEmail,l),validate:l.validate.bind(l)},i18n:{translate:A.ts.bind(A),translateICU:A.tf.bind(A),getLocale:A.getLocale.bind(A),getDateTimeLocale:A.getDateTimeLocale.bind(A)},notification:{showClientNotification:G.showClientNotification.bind(G),showLatencyMessage:G.showLatencyMessage.bind(G),hideLatencyMessage:G.hideLatencyMessage.bind(G)},appContext:{getEnvMode:x.getEnvironmentMode.bind(x),isLocalEnvXi:x.isXi.bind(x),hasPermission:(k.hasPermission||n.noop).bind(k),isSnippetEnabled:k.isSnippetEnabled.bind(k),getCurrentHost:R.getCurrentHost.bind(R),getCurrentClusterUuid:F.getCurrentClusterUuid.bind(F),getClusterUuid:F.getPrismCentralClusterUuid.bind(F),getClusterModelByClusterUuid:F.getClusterModelByClusterUuid.bind(F),getCurrentClusterTimezone:F.getCurrentClusterTimezone.bind(F),getAllHypervisors:function(){var e=[];return F.getClusterCollection().forEach(function(t){return t.get(N.CLUSTER_HYPERVISORS).forEach(function(t){return e.push(i.HYPERVISOR_LABEL[t])})}),e}},getComponents:{nutanixConfirm:$.nutanixConfirm.bind($)},dispatch:B.dispatch.bind(B),groupsAPI:{getCollection:function(t,i,n,s,a,r,o,l,c,u,d,h){var p=this.getAppAPI().models.getCollection(E,V.QUERY_MODEL);return p.set(V.FILTER_ENTITY_TYPE,t),p.setGroupMemberAttributesList(n),i&&p.set(V.QUERY_NAME,i),s&&p.set(V.FILTER_EXPRESSION,s),a&&p.set(V.GROUP_MEMBER_COUNT,a),r&&p.set(V.GROUP_MEMBER_OFFSET,r),h&&p.set(V.GROUP_COUNT,h),o&&p.set(V.GROUPING_ATTR,o),l&&p.set(V.GROUP_ATTRIBUTES,l),u&&p.set(V.GROUP_MEMBER_SORT_ORDER,u),d&&p.set(V.GROUP_MEMBER_SORT_ATTRIBUTE,d),c&&p.set(V.AVAILABILITY_ZONE_SCOPE,c),e.resolve(p.save(null)).then(function(){return{results:p.get(V.GROUPING_ATTR)?p.getQueryResultSummary():p.getQueryResultAttributes(),totalEntityCount:p.get(V.TOTAL_ENTITY_COUNT)}})}.bind(this)},getGraphQLInstance:function(){return new O},intentService:{create:function(e,t){return w.getInstance().getServiceByEntityType(e).then(function(e){return e.post(t)})},get:function(e,t){return w.getInstance().getServiceByEntityType(e).then(function(e){return e.get(t)})},update:function(e,t){return w.getInstance().getServiceByEntityType(e).then(function(e){return e.put(t)})},erase:function(e,t){return w.getInstance().getServiceByEntityType(e).then(function(e){return e.delete(t)})},all:function(e,t){return w.getInstance().getServiceByEntityType(e).then(function(e){return e.all(t)})},remoteProxy:function(e,t,i,n){return w.getInstance().getServiceByEntityType(e).then(function(e){return e.remoteProxy(t,i,n)})},getBatchService:function(e){return L.getBatchService(e)},getIntentService:function(e){return w.getInstance().getServiceByEntityType(e)},getIntentErrorMsg:m.getIntentErrorMsg.bind(m),interpretIntentServerError:m.interpretIntentServerError.bind(m)},licensing:{LICENSE_LEVEL:C.LICENSE_LEVEL,getLicenseModel:C.getLicenseModel.bind(C)},action:{executeAction:v.executeAction.bind(v),getActions:v.getActions.bind(v),onEntityAction:v.onEntityAction.bind(v)}}}})}),define("text!templates/broker/BrokerFrameView.html",[],function(){return'<section class="n-subapp-body">\n  \x3c!-- Body goes here... --\x3e\n</section>'}),define("broker/views/BrokerFrameView",["views/basecomponents/BaseView","views/basecomponents/iframe/IFrameView","broker/api/AppAPI","utils/AppUtil","text!templates/broker/BrokerFrameView.html"],function(e,t,i,n,s){"use strict";var a=_.template("prism_app_proxy/<%= url %>/prism_app_redirect");return e.extend({className:"n-subapp",iFrameView:null,appId:null,isVantagePointMode:!1,initialize:function(e){e=e||{},_.extend(this,{appName:e.appName,appInfo:e.appInfo,isVantagePointMode:e.isVantagePointMode,useProxy:e.appInfo.useProxy,payloadTransferCallback:e.payloadTransferCallback,subappWidth:e.subappWidth,subappHeight:e.subappHeight})},render:function(e){this.$el.html(s),this.$(".n-subapp-name").html(this.appInfo.name);var i=this.appInfo.url;if(window.iFrameWin="",this.useProxy&&(i=a({url:encodeURIComponent(i.replace("http://",""))}),n.log(i)),this.isVantagePointMode&&(i+="/index_vantage_point.html"),this.iFrameView=new t({iFrameId:this.appInfo.id,url:i,width:this.subappWidth,height:this.subappHeight}),this.$(".n-subapp-body").html(this.iFrameView.render().el),n.log(this.useProxy),window.iFrameWin="",this.useProxy){var r=this;n.setIntervalWithTimeout({intervalPeriod:500,timeoutPeriod:1e4,timeoutHandler:function(){n.log("BrokerFrameView: This Prism App does not accept the Prism namespace object.")},intervalHandler:function(){var t=r.getSubAppContent();t&&!t.Prism&&(t.focus(),t.Prism=r.getPrismNamespace(),t.initialize(),e&&e())}})}return this},getSubAppContent:function(){var e="#"+this.appInfo.id;if(this.$(e).length)return this.$(e)[0].contentWindow},getPrismNamespace:function(){return{AppAPI:i}},destroy:function(){this.getSubAppContent()&&this.getSubAppContent().destroy&&this.getSubAppContent().destroy(),this.iFrameView.destroy(),e.prototype.destroy.apply(this,arguments),this.$el.remove()},resize:function(e,t){},onStartServices:function(){},onStopServices:function(){},show:function(){this.$el.show()},hide:function(){this.$el.hide()}})}),define("text!app/scripts/pages.json",[],function(){return'{\n  "moduleName": "pages",\n  "modules": {\n    "VMsPageView": "views/pages/vms/VMsPageView",\n    "StoragePageView": "views/pages/storage/StoragePageView",\n    "HardwarePageView": "views/pages/hardware/HardwarePageView",\n    "NetworkPageView": "views/pages/network/NetworkPageView",\n    "DRPageView": "views/pages/dr/DRPageView",\n    "AlertsPageView": "views/pages/alerts/AlertsPageView",\n    "AlertExplorerPageView": "views/pages/ebrowser/AlertExplorerPageView",\n    "AnalysisPageView": "views/pages/analysis/AnalysisPageView",\n    "PlanningPageView": "views/pages/planning/PlanningPageView",\n    "ClusterHealthPageView": "views/pages/cluster/ClusterHealthPageView",\n    "TasksPageView": "views/pages/tasks/TasksPageView",\n    "EntityBrowserPageView": "views/pages/ebrowser/EntityBrowserPageView",\n    "MulticlusterHealthPageView": "views/pages/multicluster/health/MulticlusterHealthPageView",\n    "PrismElementIFramePageView": "views/pages/multicluster/iframe/PrismElementIFramePageView",\n    "AppsIFramePageView": "views/pages/apps/iframe/AppsIFramePageView",\n    "FileServerPageView": "views/pages/fileserver/FileServerPageView",\n    "MulticlusterDashboardPageView": "views/pages/multicluster/home/MulticlusterDashboardPageView",\n    "DashboardPageView": "views/pages/dashboard/DashboardPageView",\n    "InsightsPageView": "views/pages/insights/InsightsPageView",\n    "BrokerPageView": "views/pages/broker/BrokerPageView",\n    "SettingsPageView": "views/pages/settings/SettingsPageView",\n    "SearchGuidelinesPageView": "views/pages/explore/SearchGuidelinesPageView",\n    "LCMPageView": "views/pages/lcm/LCMPageView"\n  }\n}\n'}),define("text!app/scripts/popups.json",[],function(){return'{\n  "moduleName": "popups",\n  "modules": {\n    "HostRebootPopupView": "views/popups/hostreboot/HostRebootPopupView",\n    "ConfigureCVMPopupView": "views/popups/cvmconfig/ConfigureCVMPopupView",\n    "NodeConversionPopupView": "views/popups/nodeconversion/NodeConversionPopupView",\n    "RecommendationPopupView": "views/popups/capacityplanning/RecommendationPopupView",\n    "AlertConfigWizard": "views/wizards/alert/AlertConfigWizard",\n    "WhatIfPopupView": "views/popups/capacityplanning/WhatIfPopupView",\n    "RunChecksPopupView": "views/popups/clusterhealth/RunChecksPopupView",\n    "NccFrequencyPopupView": "views/popups/clusterhealth/NccFrequencyPopupView",\n    "LogCollectorPopupView": "views/popups/clusterhealth/LogCollectorPopupView",\n    "ClusterPopupView": "views/popups/cluster/ClusterPopupView",\n    "ClusterSelectionPopupView": "views/popups/cluster/ClusterSelectionPopupView",\n    "ClusterUpdatePopupView": "views/popups/cluster/ClusterUpdatePopupView",\n    "ClusterUplinkPopupView": "views/popups/cluster/ClusterUplinkPopupView",\n    "StoragePopupView": "views/popups/storage/StoragePopupView",\n    "VmManageNgtPopupView": "views/popups/vm/VmManageNgtPopupView",\n    "VmPopupView": "views/popups/vm/VmPopupView",\n    "VmFanoutActionView": "views/popups/vm/VmFanoutActionView",\n    "LaunchConsolePopupView": "views/popups/vm/LaunchConsolePopupView",\n    "EncryptionPagePopupView": "views/popups/encryption/EncryptionPagePopupView",\n    "HttpProxyPopupView": "views/popups/httpproxy/HttpProxyPopupView",\n    "ServiceCenterPopupView": "views/popups/servicecenter/ServiceCenterPopupView",\n    "RegisterManagementServerPopupView": "views/popups/managementserver/RegisterManagementServerPopupView",\n    "NameServerPopupView": "views/popups/nameserver/NameServerPopupView",\n    "NtpServerPopupView": "views/popups/ntpserver/NtpServerPopupView",\n    "NetworkEntityPopupView": "views/popups/network/NetworkEntityPopupView",\n    "NetworkSwitchConfigPopupView": "views/popups/networkswitch/NetworkSwitchConfigPopupView",\n    "NfsWhitelistPopupView": "views/popups/nfswhitelist/NfsWhitelistPopupView",\n    "RemoteSupportPopupView": "views/popups/remotesupport/RemoteSupportPopupView",\n    "HypervFailoverClusterPopupView": "views/popups/cluster/HypervFailoverClusterPopupView",\n    "KerberosManagementPopupView": "views/popups/storage/security/KerberosManagementPopupView",\n    "SmtpServerPopupView": "views/popups/smtpserver/SmtpServerPopupView",\n    "SnmpPopupView": "views/popups/snmp/SnmpPopupView",\n    "PrismPemKeyPopupView": "views/popups/key/PrismPemKeyPopupView",\n    "AuthConfigPopupView": "views/popups/authconfig/AuthConfigPopupView",\n    "LockDownPopupView": "views/popups/lockdown/LockDownPopupView",\n    "MulticlusterFilterPopupView": "views/popups/multicluster/filters/MulticlusterFilterPopupView",\n    "MulticlusterManagementPopupView": "views/popups/multicluster/clustermanagement/MulticlusterManagementPopupView",\n    "AlertPoliciesPopupView": "views/popups/alertpolicy/AlertPoliciesPopupView",\n    "AlertPolicyPopupView": "views/popups/alertpolicy/AlertPolicyPopupView",\n    "UDAPolicyPopupView": "views/popups/alertpolicy/UDAPolicyPopupView",\n    "CPAlertPolicyPopupView": "views/popups/alertpolicy/CPAlertPolicyPopupView",\n    "SoftwareUpgradePopupView": "views/popups/softwareupgrade/SoftwareUpgradePopupView",\n    "HypervDomainJoinPopupView": "views/popups/cluster/HypervDomainJoinPopupView",\n    "HypervCpsDeploymentPopupView": "views/popups/cluster/HypervCpsDeploymentPopupView",\n    "RedundancyStatePopupView": "views/popups/redundancystate/RedundancyStatePopupView",\n    "LicensingPopupView": "views/popups/licensing/LicensingPopupView",\n    "RemoveHostPopupView": "views/popups/hardwareadmin/RemoveHostPopupView",\n    "BootDiskRepairPopupView": "views/popups/noderepair/BootDiskRepairPopupView",\n    "NetworkEntitiesBasePopupView": "views/popups/network/NetworkEntitiesBasePopupView",\n    "ExpandClusterPopupView": "views/popups/hardwareadmin/ExpandClusterPopupView",\n    "RemoveDiskPopupView": "views/popups/hardwareadmin/RemoveDiskPopupView",\n    "ReplaceDiskPopupView": "views/popups/hardwareadmin/ReplaceDiskPopupView",\n    "UpdateProfilePopupView": "views/popups/user/UpdateProfilePopupView",\n    "ChangePasswordPopupView": "views/popups/user/ChangePasswordPopupView",\n    "UserPopupView": "views/popups/user/UserPopupView",\n    "ManageDashboardsPopupView": "views/popups/dashboards/ManageDashboardsPopupView",\n    "RoleMappingPopupView": "views/popups/user/RoleMappingPopupView",\n    "VersionPopupView": "views/popups/version/VersionPopupView",\n    "RemoteSiteFormView": "views/popups/dr/RemoteSiteFormView",\n    "MigratePDFormView": "views/popups/dr/MigratePDFormView",\n    "ReplicatePDFormView": "views/popups/dr/ReplicatePDFormView",\n    "ActivatePDFormView": "views/popups/dr/ActivatePDFormView",\n    "PDWarningPopupView": "views/popups/dr/PDWarningPopupView",\n    "GenericNotificationPopupView": "views/popups/notification/GenericNotificationPopupView",\n    "VMAvailabilityPopupView": "views/popups/dr/VMAvailabilityPopupView",\n    "RestoreSnapshotPopupView": "views/popups/dr/RestoreSnapshotPopupView",\n    "WelcomeBannerPopupView": "views/popups/welcomebanner/WelcomeBannerPopupView",\n    "UISettingsPopupView": "views/popups/systemdata/UISettingsPopupView",\n    "LanguageSettingsPopupView": "views/popups/language_settings/LanguageSettingsPopupView",\n    "AutoSupportPopupView": "views/popups/asup/AutoSupportPopupView",\n    "ResiliencyStatusPopupView": "views/popups/resiliency/ResiliencyStatusPopupView",\n    "SchedulePopupView": "views/popups/dr/SchedulePopupView",\n    "NetworkConfigurationPopupView": "views/popups/network/NetworkConfigurationPopupView",\n    "CVMNetworkInterfacePopupView": "views/popups/network/CVMNetworkInterfacePopupView",\n    "AddVantagePointPopupView": "views/popups/dashboards/AddVantagePointPopupView",\n    "AcropolisImagePopupView": "views/popups/imageservice/AcropolisImagePopupView",\n    "HighAvailabilityPopupView": "views/popups/ha/HighAvailabilityPopupView",\n    "FileServerPrerequisitePopupView": "views/popups/fileserver/FileServerPrerequisitePopupView",\n    "FileServerAddAdminsPopupView": "views/popups/fileserver/FileServerAddAdminsPopupView",\n    "FileServerUserManagementPopupView": "views/popups/fileserver/FileServerUserManagementPopupView",\n    "FileServerAddDNSPopupView": "views/popups/fileserver/FileServerAddDNSPopupView",\n    "FileServerInsightPopupView": "views/popups/fileserver/FileServerInsightPopupView",\n    "FileInsightDeployPopupView": "views/popups/fileserver/FileInsightDeployPopupView",\n    "FileServerPopupView": "views/popups/fileserver/FileServerPopupView",\n    "FileServerProtectPopupView": "views/popups/fileserver/FileServerProtectPopupView",\n    "FileServerSizingPopupView": "views/popups/fileserver/FileServerSizingPopupView",\n    "SharePopupView": "views/popups/fileserver/SharePopupView",\n    "FileServerAntivirusPopupView": "views/popups/fileserver/FileServerAntivirusPopupView",\n    "FileServerShareQuotaPopupView": "views/popups/fileserver/FileServerShareQuotaPopupView",\n    "NonRecoverableVMPopupView": "views/popups/dr/NonRecoverableVMPopupView",\n    "IscsiClientPopupView": "views/popups/volumegroup/IscsiClientPopupView",\n    "VolumeGroupPopupView": "views/popups/volumegroup/VolumeGroupPopupView",\n    "HyperVAzureOnboardingView": "views/popups/cluster/HyperVAzureOnboardingView",\n    "PCDeploymentPopupView": "views/popups/pcdeployment/PCDeploymentPopupView",\n    "MultipleNodePCDeploymentCreatePopupView": "views/popups/pcdeployment/MultipleNodePCDeploymentCreatePopupView",\n    "WitnessVMRegisterPopupView": "views/popups/witnessregister/WitnessVMRegisterPopupView",\n    "LCMConfigPopupView": "views/popups/lcm/LCMConfigPopupView",\n    "LCMPopupView": "views/popups/lcm/LCMPopupView",\n    "LCMAvailableVersionPopupView": "views/popups/lcm/LCMAvailableVersionPopupView",\n    "NCCTaskSuceededPopupView": "views/popups/clusterhealth/NCCTaskSuceededPopupView",\n    "FileServerEulaPopupView": "views/popups/fileserver/FileServerEulaPopupView",\n    "BrokerPopupView": "views/popups/broker/BrokerPopupView",\n    "FeatureDisabledPopupView": "views/popups/cluster/FeatureDisabledPopupView",\n    "IntentDynamicPopupView": "views/popups/intent/IntentDynamicPopupView",\n    "IntentDynamicOverlayPopupView": "views/popups/intent/IntentDynamicOverlayPopupView",\n    "SupportCasePopupView": "views/popups/supportcase/SupportCasePopupView",\n    "MulticlusterSelfMonitorPopupView": "views/popups/multicluster/clustermanagement/MulticlusterSelfMonitorPopupView",\n    "DegradedNodePopupView": "views/popups/degradednode/DegradedNodePopupView",\n    "PCVirtualIPDetailsPopupView": "views/popups/multicluster/clustermanagement/PCVirtualIPDetailsPopupView",\n    "CitrixConnectorPopupView": "views/popups/citrix/CitrixConnectorPopupView",\n    "NVMeGuidePopupView": "views/popups/hardwareadmin/NVMeGuidePopupView"\n  }\n}\n'}),define("managers/AsyncLoadManager",["events/AppEvents","utils/AppUtil","text!app/scripts/pages.json","text!app/scripts/popups.json"],function(e,t,i,n){"use strict";var s,a;try{s=JSON.parse(i).moduleName+".js",a=JSON.parse(n).moduleName+".js"}catch(e){t.log("AsyncLoadManager: Error parsing modules config: "+e)}var r="app/scripts/",o={};o[s]=!1,o[a]=!1,o["vendor.js"]=!1;var l=[];return{loadScript:function(e,t){var i=document.getElementById("uiv"),n=i?i.value:null,s="";s=e.indexOf("?")>=0?"&":"?",n&&(s+="uiv="+n,e+=s);var a,r;a=document.createElement("script"),a.type="text/javascript",a.src=e,a.onload=a.onreadystatechange=function(){this.readyState&&"complete"!==this.readyState||t()},r=document.getElementsByTagName("script")[0],r.parentNode.insertBefore(a,r)},initialize:function(t){if(t=t||{},t.scriptsPath&&(r=t.scriptsPath),window.nutanix&&!1===window.nutanix.asyncLoad)for(var i in o)o[i]=!0;else e.onAppEvent(e.ASYNC_SCRIPT_LOAD,function(e,t){for(var i=l.length-1;i>=0;i--){var n=l[i];n.file===t&&(n.successCallback(),l.splice(i,1))}}),_.each(o,function(t,i){this.loadScript(r+i,function(){o[i]=!0,e.triggerAppEvent(e.ASYNC_SCRIPT_LOAD,[i])})},this)},whenLoaded:function(t,i){o[t]?i():void 0===o[t]?(l.push({file:t,successCallback:i}),this.loadScript(r+t,function(){o[t]=!0,e.triggerAppEvent(e.ASYNC_SCRIPT_LOAD,[t])})):l.push({file:t,successCallback:i})}}}),define("text!broker/manifests/manifest.json",[],function(){return'{\n  "draas": {\n    "metadata": {\n      "appName": "draas",\n      "author": "draas-ui@nutanix.com",\n      "description": "DR app v 0.1",\n      "version": 0.1\n    },\n    "configuration": {\n      "iframe": false,\n      "vendorDependency": true,\n      "routePath": "draas",\n      "baseRoute": "/page/broker/draas/",\n      "appSourcePath": "react/draas/dist",\n      "parentApp": ["pe", "pc"]\n    },\n    "lifecycle": {\n      "initApp": "bundle",\n      "init": "mountFn",\n      "destroy": "unmountFn"\n    }\n  },\n  "report": {\n    "metadata": {\n      "appName": "pcreport",\n      "author": "ui@nutanix.com",\n      "description": "Prism Central Reporting",\n      "version": 1.0\n    },\n    "configuration": {\n      "iframe": false,\n      "vendorDependency": true,\n      "routePath": "report",\n      "baseRoute": "/page/broker/report",\n      "appSourcePath": "react/pcreport/dist",\n      "parentApp": [ "pc" ]\n    },\n    "lifecycle": {\n      "initApp": "main.bundle",\n      "init": "init",\n      "destroy": "destroy"\n    }\n  },\n  "reportInstances": {\n    "metadata": {\n      "appName": "pcreport_instances",\n      "author": "ui@nutanix.com",\n      "description": "Prism Central Reporting",\n      "version": 1.0\n    },\n    "configuration": {\n      "iframe": false,\n      "vendorDependency": true,\n      "routePath": "report",\n      "baseRoute": "/page/broker/report",\n      "appSourcePath": "react/pcreport/dist",\n      "parentApp": [ "pc" ]\n    },\n    "lifecycle": {\n      "initApp": "instances.bundle",\n      "init": "init",\n      "destroy": "destroy"\n    }\n  },\n  "rackconfigurer": {\n    "metadata": {\n      "appName": "rackconfigurer",\n      "author": "ui@nutanix.com",\n      "description": "Rack Configurer",\n      "version": "1.0"\n    },\n    "configuration": {\n      "iframe": false,\n      "vendorDependency": true,\n      "routePath": "rackconfigurer",\n      "baseRoute": "/page/broker/rackconfigurer",\n      "appSourcePath": "react/rackconfig/dist",\n      "parentApp": [ "pe", "pc" ]\n    },\n    "lifecycle": {\n      "initApp": "bundle",\n      "init": "init",\n      "destroy": "destroy",\n      "confirmDestroy": "confirmDestroy"\n    }\n  },\n  "ngt": {\n    "metadata": {\n      "appName": "ngt",\n      "author": "ui@nutanix.com",\n      "description": "NGT Management",\n      "version": "1.0"\n    },\n    "configuration": {\n      "iframe": false,\n      "vendorDependency": true,\n      "routePath": "ngt",\n      "baseRoute": "/page/broker/ngt/",\n      "appSourcePath": "react/ngt/dist",\n      "parentApp": [ "pc" ]\n    },\n    "lifecycle": {\n      "initApp": "bundle",\n      "init": "mountFn",\n      "destroy": "unmountFn"\n    }\n  },\n  "XiDashboard": {\n    "metadata": {\n      "appName": "XiDashboard",\n      "author": "van@nutanix.com",\n      "description": "XiDashboard",\n      "version": 0.1\n    },\n    "configuration": {\n      "iframe": false,\n      "vendorDependency": true,\n      "routePath": "",\n      "baseRoute": "",\n      "appSourcePath": "react/xi/build",\n      "parentApp": ["xi"]\n    },\n    "lifecycle": {\n      "initApp": "XiDashboard",\n      "init": "init",\n      "destroy": "destroy"\n    }\n  },\n  "NtnxReactUIApp": {\n    "metadata": {\n      "appName": "NtnxReactUIApp",\n      "author": "suren.madheshwaran@nutanix.com",\n      "description": "Repo for custom components for  PC, PE, Xi and Nutanix Central.",\n      "version": 0.1\n    },\n    "configuration": {\n      "iframe": false,\n      "vendorDependency": false,\n      "routePath": "",\n      "baseRoute": "",\n      "appSourcePath": "react/ntnx-react-ui-app/build",\n      "parentApp": ["pc"]\n    },\n    "lifecycle": {\n      "initApp": "NtnxReactUiApp",\n      "init": "init",\n      "destroy": "destroy"\n    }\n  },\n  "SearchWidgets": {\n    "metadata": {\n      "appName": "SearchWidgets",\n      "author": "shamita.pisal@nutanix.com, suren.madheshwaran@nutanix.com",\n      "description": "All the react widgets used in Search 2.0",\n      "version": 0.1\n    },\n    "configuration": {\n      "iframe": false,\n      "vendorDependency": false,\n      "routePath": "",\n      "baseRoute": "",\n      "appSourcePath": "react/search/build",\n      "parentApp": ["pc"]\n    },\n    "lifecycle": {\n      "initApp": "SearchWidgets",\n      "init": "init",\n      "destroy": "destroy"\n    }\n  },\n  "LCMUIApp": {\n    "metadata": {\n      "appName": "LCMUIApp",\n      "author": "ui@nutanix.com",\n      "description": "LCM UI App",\n      "version": 0.1\n    },\n    "configuration": {\n      "iframe": false,\n      "vendorDependency": false,\n      "routePath": "",\n      "baseRoute": "",\n      "appSourcePath": "react/lcm/build",\n      "parentApp": ["pc", "pe"]\n    },\n    "lifecycle": {\n      "initApp": "LCMUIApp",\n      "init": "init",\n      "destroy": "destroy"\n    }\n  },\n  "vulcan": {\n    "metadata": {\n      "appName": "vulcan",\n      "author": "sarah.hernandez@nutanix.com",\n      "description": "Prism Pro trigger based automation workflow",\n      "version": 0.1\n    },\n    "configuration": {\n      "iframe": false,\n      "vendorDependency": false,\n      "routePath": "",\n      "baseRoute": "",\n      "appSourcePath": "react/vulcan/build",\n      "parentApp": ["pc"]\n    },\n    "lifecycle": {\n      "initApp": "vulcan",\n      "init": "init",\n      "destroy": "destroy"\n    }\n  },\n  "vnc": {\n    "metadata": {\n      "appName": "vnc",\n      "author": "jsims@nutanix.com",\n      "description": "The VNC console that provides remote access to Nutanix VMs",\n      "version": 0.1\n    },\n    "configuration": {\n      "iframe": false,\n      "vendorDependency": false,\n      "routePath": "",\n      "baseRoute": "",\n      "appSourcePath": "react/vnc/build",\n      "parentApp": ["pe", "pc"]\n    },\n    "lifecycle": {\n      "initApp": "vnc",\n      "init": "init",\n      "destroy": "destroy"\n    }\n  },\n  "flow": {\n    "metadata": {\n      "appName": "flow",\n      "author": "ui@nutanix.com",\n      "description": "Flow UI",\n      "version": "0.1"\n    },\n    "configuration": {\n      "iframe": false,\n      "vendorDependency": true,\n      "routePath": "flow",\n      "baseRoute": "/page/broker/flow/",\n      "appSourcePath": "react/flow/dist",\n      "parentApp": ["pc"]\n    },\n    "lifecycle": {\n      "initApp": "bundle",\n      "init": "mountFn",\n      "destroy": "unmountFn"\n    }\n  },\n  "ad-firewall": {\n    "metadata": {\n      "appName": "adFirewall",\n      "author": "sherry.li@nutanix.com",\n      "description": "AD categorization workflow",\n      "version": "0.1"\n    },\n    "configuration": {\n      "iframe": false,\n      "vendorDependency": false,\n      "routePath": "",\n      "baseRoute": "",\n      "appSourcePath": "react/ad-firewall/build",\n      "parentApp": ["pc"]\n    },\n    "lifecycle": {\n      "initApp": "adFirewall",\n      "init": "init",\n      "destroy": "destroy"\n    }\n  },\n  "security-planning": {\n    "metadata": {\n      "appName": "securityPlanning",\n      "author": "raj@nutanix.com",\n      "description": "Flow/Netsil Security Planning",\n      "version": "0.1"\n    },\n    "configuration": {\n      "iframe": false,\n      "vendorDependency": false,\n      "routePath": "",\n      "baseRoute": "",\n      "appSourcePath": "react/security-planning/dist",\n      "parentApp": ["pc"]\n    },\n    "lifecycle": {\n      "initApp": "securityPlanning",\n      "init": "init",\n      "destroy": "destroy"\n    }\n  },\n  "ncc-log-collector": {\n    "metadata": {\n      "appName": "ncc-log-collector",\n      "author": "ui@nutanix.com",\n      "description": "NCC log collector UI",\n      "version": "1.0"\n    },\n    "configuration": {\n      "iframe": false,\n      "vendorDependency": true,\n      "routePath": "ncc-log-collector",\n      "baseRoute": "/page/broker/ncc-log-collector/",\n      "appSourcePath": "react/ncc-log-collector/dist",\n      "parentApp": ["pe"]\n    },\n    "lifecycle": {\n      "initApp": "main.bundle",\n      "init": "init",\n      "destroy": "destroy"\n    }\n  }\n}\n'}),define("broker/managers/BrokerManager",["bluebird","managers/BaseManager","managers/AppManager","managers/ClusterManager","utils/AppConstants","broker/api/AppAPI","broker/views/BrokerFrameView","utils/AppUtil","utils/LogUtil","managers/AsyncLoadManager","utils/ReleaseUtil","app/scripts/envConfiguration","text!broker/manifests/manifest.json"],function(e,t,i,n,s,a,r,o,l,c,u,d,h){"use strict";return _.extend({},t,{name:s.MANAGER.BROKER,currentSubApp:null,iframeView:null,lastAphroApp:null,subAppData:{},registeredPath:null,currentComponents:{},VIEW_TYPE:{PAGE_VIEW:"page",POPUP_VIEW:"popup"},APP_TEMPLATE:_.template('<div id="<%= appName %>"class="<%= className %>"></div>'),subApps:null,initialize:function(){window.BrokerManager=this;try{this.subAppData=JSON.parse(h)}catch(e){return void o.log("BrokerManager: Error in parsing sub-app manifest: "+e)}this.addToManagerHelper(),window.nutanix=window.nutanix||{},window.nutanix.Prism=window.nutanix.Prism||{},window.addEventListener("hashchange",function(){
this.onLocationHashChanged()}.bind(this),!1),this.subApps={}},getSubAppConfiguration:function(e){return e=e||this.currentSubApp,this.subAppData[e]},getCurrentPath:function(){return window.location.hash.split("#")[1]||""},registerBasePath:function(e){var t=this.getSubAppConfiguration();this.registeredPath=e||t.configuration.baseRoute},unregisterBasePath:function(){this.registeredPath=null},loadSubApp:function(e,t,i,n){this.currentSubApp=e,this.registerBasePath(),t?this.currentEl=t:(o.showLoader(),this.currentEl=$('<div class="broker-ctr"></div>').appendTo("body"),this.loadedSubAppInNewCtr=!0),n&&(this.isHashChangeRequired=!0,this.lastAphroApp=window.location.hash,this.createSubAppHash(i)),$.extend(i,{baseRoute:this.getSubPathHash()}),this.createSubAppView(i)},_loadComponentHelper:function(e,t,i,n,s){var r=this.getSubAppConfiguration(e);t.html(this.getAppContainer(r));var l=this.getAppInitPath(r);require([l],function(l){if(r&&r.lifecycle&&r.lifecycle.init)try{var c=l;"function"==typeof l&&(c=new l),this.currentComponents[s]=e,this.subApps[s]=c,this.subApps[s].currentEl=t,i=i||{},i.el=i.el||t[0],i.api=a.getAppAPI(r.metadata.appName);var u=this.subApps[s][r.lifecycle.init](i);n&&n.success&&n.success(u)}catch(e){o.log("BrokerManager: Init method missing: ",e),n&&n.error&&n.error(e)}else o.log("BrokerManager: Missing options.  Check sub app manifest.json",e,r)}.bind(this))},loadComponent:function(e,t,i,n){var s=this,a=this.getSubAppConfiguration(e),r=o.randomId();return!0===a.configuration.vendorDependency?this.loadVendorChunk(function(){s._loadComponentHelper(e,t,i,n,r)}):this._loadComponentHelper(e,t,i,n,r),r},unloadComponent:function(e){var t=this.currentComponents[e],i=this.getSubAppConfiguration(t)||{};if(i&&i.lifecycle&&i.lifecycle.destroy)try{this.subApps[e][i.lifecycle.destroy](),this.subApps[e].currentEl.remove(),this.stopComponentServices(t),delete this.currentComponents[e],delete this.subApps[e]}catch(e){o.log("BrokerManager: Destroy method missing: "+e)}},stopComponentServices:function(e){var t=this.getSubAppConfiguration(e);this.subApps[t.metadata.appName]=null},tunnel:function(e,t){var i=this.currentComponents[e],n=this.getSubAppConfiguration(i);if(n.lifecycle.tunnel)try{this.subApps[e][n.lifecycle.tunnel](t)}catch(e){o.log("BrokerManager: Tunnel method missing: "+e)}},createSubAppHash:function(e){window.history.pushState({},{},this.getSubPathHash(e))},getSubPathHash:function(e){var t=this.getSubAppConfiguration(),i="#page/"+s.PAGE_BROKER+"/"+t.configuration.routePath;return e&&e.subAppRoute&&(i=i+"/"+e.subAppRoute),i},createSubAppView:function(e){var t=this.getSubAppConfiguration();t?t.configuration.iframe?this.renderSubAppIframe():this.renderSubAppDiv(t,e):o.log("BrokerManager: SubApp not found")},getAppContainer:function(e){var t;return t=this.isHashChangeRequired?e.metadata.appName+"-"+this.VIEW_TYPE.POPUP_VIEW:e.metadata.appName+"-"+this.VIEW_TYPE.PAGE_VIEW,this.APP_TEMPLATE({appName:e.metadata.appName,className:t})},loadVendorChunk:function(e){c.whenLoaded("vendor.js",e)},renderSubAppDiv:function(e,t){this.currentEl.html(this.getAppContainer(e));var i=this.getAppInitPath(e);!0===e.configuration.vendorDependency?c.whenLoaded("vendor.js",_.bind(function(){this.loadSubAppAndStartServices(i,t)},this)):this.loadSubAppAndStartServices(i,t)},loadSubAppAndStartServices:function(e,t){require([e],function(e){this.startServices(e,t)}.bind(this),function(e){o.log("BrokerManager: Error loading subapp: ",e),window.history.back()})},renderSubAppIframe:function(){var e=this.getSubAppConfiguration();this.iframeView=new r({el:this.currentEl,appInfo:{id:"",name:e.metadata.appName,url:this.getAppInitPath(e)+this.getBaseHash(),useProxy:!1},appName:e.metadata.appName,payloadTransferCallback:function(){}}),this.iframeView.render()},getAppInitPath:function(e){return"app/subapps/"+e.configuration.appSourcePath+"/"+e.lifecycle.initApp},startServices:function(e,t){var i=this.getSubAppConfiguration(),n={};if(i.lifecycle.init)try{this.loadedSubAppInNewCtr&&o.hideLoader(),this.subApps[i.metadata.appName]=e,t.basePath=this.getCurrentPath();var s=i.release;if(s&&s.accessReleaseInfo){var a=this.subApps[i.metadata.appName][i.release.getReleaseInfo]();a.appName=i.metadata.appName,n=this.parseReleaseInfo(a)}this.subApps[i.metadata.appName][i.lifecycle.init]({data:t,api:this.getAppAPI(),releaseInfo:n}),n=null}catch(e){o.log("BrokerManager: Init method missing: ",e)}},parseReleaseInfo:function(e){var t=e.releaseConfigJson,s=e.appName,a=e.elements;return u.init({releaseConfigJson:t,appName:s,buildType:d.getBuildType(),environment:i.getEnvironmentMode(),releaseVersion:n.getCurrentClusterVersion()}),u.processElements({elements:a})},getAppAPI:function(){var e=this.getSubAppConfiguration();return a.getAppAPI(e.metadata.appName)},destroy:function(){var e=this.getSubAppConfiguration();if(e.lifecycle.destroy)try{this.subApps[e.metadata.appName][e.lifecycle.destroy](),this.subApps[e.metadata.appName]=null,this.stopServices(),this.loadedSubAppInNewCtr&&this.currentEl.remove()}catch(e){o.log("BrokerManager: Destroy method missing: "+e)}this.iframeView&&(this.iframeView.destroy(),this.stopServices(),this.iframeView=null)},stopServices:function(){this.currentSubApp=null},goBack:function(){this.isHashChangeRequired&&(window.location.hash=this.lastAphroApp,this.lastAphroApp=null,this.isHashChangeRequired=!1)},isSubAppRoute:function(){return-1!==location.hash.indexOf(s.PAGE_BROKER)},getSubAppName:function(){var e=window.location.hash.substr(1).split("/")||[];return e[0]?e[2]:e[3]},onLocationHashChanged:function(){this.currentSubApp&&-1===this.getCurrentPath().indexOf(this.registeredPath)&&(this.destroy(),this.unregisterBasePath())},getBaseHash:function(){return window.location.hash},canSubappUnload:function(t){if(this.currentSubApp&&-1===t.indexOf(this.registeredPath)){var i=this.getSubAppConfiguration(),n=i&&i.lifecycle.confirmDestroy,s=i&&i.metadata.appName;if(n&&s&&_.isFunction(this.subApps[s][n]))return this.subApps[s][n]()}return e.resolve(!0)},getMountedApp:function(e){var t=this;return _.reduce(this.currentComponents||{},function(i,n,s){return i||n!==e?_.extend(t.subApps[e],{key:s})||i:_.extend({},t.subApps[s],{key:s})},null)},dispatch:function(e,t){if(!t.type)return l.log("BrokerManager: action.type is required."),!1;var i=this.getMountedApp(e);return i?"function"!=typeof i.dispatch?(l.log("BrokerManager: "+e+" is not listening to actions. Define dispatch() in addition to init() and destroy() in "+e+"."),!1):i.dispatch(t):(l.log("Could not find the sub-app",e,". It is required to be mounted."),!1)}})}),define("text!templates/pages/AppView.html",[],function(){return'\x3c!-- Content\n================================================== --\x3e\n\n\x3c!-- Main navigation bar and page wrapper\n================================================== --\x3e\n<div id="containerFluid" class="container-fluid" data-tutorial="body">\n\n  \x3c!-- Notification Bar\n  ================================================== --\x3e\n  <div id="n-notification-bar">\n    \x3c!-- @view: License Notification view goes here... --\x3e\n  </div>\n\n  \x3c!-- Header\n  ================================================== --\x3e\n  <div id="n-header" class="header">\n    \x3c!-- @view: Header view goes here... --\x3e\n  </div>\n\n  \x3c!-- Body\n  ================================================== --\x3e\n  <div id="n-body-content" class="row-fluid">\n\n    \x3c!-- Content-View Wrapper\n    ================================================== --\x3e\n    <div id="n-view-wrapper" class="span12">\n\n      \x3c!-- 2) Page View (current cluster view)\n      ================================================== --\x3e\n      <div id="n-view-cluster-wrapper">\n        \x3c!-- Pages\n        ================================================== --\x3e\n        <div id="n-ctr-page"></div>\n\n        <div id="explore-nav-menu"></div>\n\n      </div>\x3c!-- /Page View Wrapper --\x3e\n\n    </div>\x3c!-- /Content-Wrapper --\x3e\n  </div>\x3c!-- /Body --\x3e\n\n</div>\x3c!-- /Content --\x3e\n\n\x3c!-- Notification Center\n================================================== --\x3e\n<div id="n-ctr-notification">\n  \x3c!-- @view: Notification view goes here... --\x3e\n</div>\n\n\x3c!-- Full Details Page Container\n================================================== --\x3e\n<div id="containerDetails" class="page-details">\n  \x3c!-- FullDetailsPageView operates here. --\x3e\n</div>\n\n\x3c!-- Modals Popups Container\n================================================== --\x3e\n<div id="globalModalWrapper">\n  <div id="globalModalContainer">\n\n    \x3c!-- Popup divs are dynamically created here. --\x3e\n\n    \x3c!-- Confirm dialog popup will be created here. --\x3e\n\n  </div>\n</div>\n'}),define("managers/UITemplateManager",["utils/AppUtil","managers/BaseManager"],function(e,t){"use strict";var i=null,n={PRISM_PAGE:"prism_page",IFRAME:"iframe"},s=function(e){return i&&i.metadata&&i.metadata[e]},a=function(e){return i&&i.frontend&&i.frontend[e]};return t.extend({configURL:"app/extras/ui_template_override/ui_template_override.json",fetchConfiguration:function(){var t=this,i=$.Deferred();return $.ajax(this.configURL,{success:function(n){e.log("UITemplateManager: UI template configuration loaded."),t.setConfig(n),i.resolve()},error:function(){e.error("UITemplateManager: Error in loading configuration."),i.resolve()}}),i.promise()},setConfig:function(e){i=e},getDefaultPage:function(){return a("defaultPage")},getPageTitle:function(){return s("pageTitle")},getPageList:function(){var e=a("pageList");return _.pluck(e,"id")},getPageDescriptor:function(e){return _.find(a("pageList"),function(t){return t&&t.id===e})},isIFramePage:function(e){var t=this.getPageDescriptor(e);return t&&t.type===n.IFRAME},isPrismPage:function(e){var t=this.getPageDescriptor(e);return t&&t.type===n.PRISM_PAGE}})}),define("models/app/AppModel",["models/BaseModel","managers/NamespaceManager","managers/ClusterManager","managers/PrismElementManager","managers/UITemplateManager","data/DataURLConstants","data/DataProperties","utils/AppUtil","utils/AppConstants"],function(e,t,i,n,s,a,r,o,l){"use strict";return e.extend({name:"AppModel",_tempPageRoute:null,initialized:!1,defaults:{currentCluster:null,currentPageRoute:null,multiclusterPageRoute:null,singleClusterPageRoutes:{}},initialize:function(){e.prototype.initialize.apply(this,arguments),i.attachEventHandler("load",this._onResetSubModel,this),i.attachEventHandler("error",this._onErrorSubModel,this)},_onErrorSubModel:function(e,t,i){var n="";_.isString(t)?n=t:_.isObject(t)&&t.responseText&&(n=o.processAjaxError(t.responseText)),this.trigger("error",n)},_onResetSubModel:function(e){if(this.initialized=!0,i.isMulticlusterUI()){var t=o.parseQueryToObject(this._tempPageRoute.options);if(t&&t[a.CLUSTER_ID]){var n=i.getClusterCollection().findModelByUuid(t[a.CLUSTER_ID]);n?i.setCurrentClusterId(n.getClusterUuid()):o.log("AppModel | Issue setting current cluster")}}else e&&e.length&&i.setCurrentClusterId(e.at(0).getId());this._tempPageRoute&&(this.setCurrentPageRoute(_.clone(this._tempPageRoute)),this._tempPageRoute=null)},destroy:function(){i.detachEventHandler("load",this._onResetSubModel,this),i.detachEventHandler("error",this._onErrorSubModel,this),e.prototype.destroy.apply(this,arguments)},getCurrentPageRoute:function(){var e=this.get(r.APP_CURRENT_PAGE_ROUTE);if(this.checkUndefinedPageRoute(e)){e={};var t=s.getDefaultPage();if(i.isMulticlusterUI())e.pageId=t||l.PAGE_MC_DASHBOARD;else{e.pageId=t||l.PAGE_DASHBOARD;var n={};n[a.CLUSTER_ID]=i.getCurrentClusterUuid(),e.options=o.formatObjectToQuery(n)}}return e},getSingleClusterPageRoute:function(e){return this.get(r.APP_SC_PAGE_ROUTE)[e]},getMulticlusterPageRoute:function(){return this.get(r.APP_MC_PAGE_ROUTE)},checkUndefinedPageRoute:function(e){var t=!0;return _.each(e,function(i,n){t=t&&void 0===e[n]}),t},setSingleClusterPageRoute:function(e){var t=i.getClusterIdFromPageRoute(e);this.get(r.APP_SC_PAGE_ROUTE)[t]=e},setCurrentPageRoute:function(e){this.initialized?(t.set(t.PAGE_ROUTE,e),n.isLoadedFromPrismCentral()&&!i.isCurrentClusterIdSameInPageRoute(e)&&(this._tempPageRoute=e),this.setProperty(r.APP_CURRENT_PAGE_ROUTE,_.clone(e),{eventName:"route"}),i.isMulticlusterUI()&&(i.isMulticlusterPageRoute(e)?this.set(r.APP_MC_PAGE_ROUTE,e):this.setSingleClusterPageRoute(e))):this._tempPageRoute=e}})}),define("jqueryui/slider",["jquery","./core","./mouse","./widget"],function(e){!function(e,t){e.widget("ui.slider",e.ui.mouse,{widgetEventPrefix:"slide",options:{animate:!1,distance:0,max:100,min:0,orientation:"horizontal",range:!1,step:1,value:0,values:null},_create:function(){var t=this,i=this.options,n=this.element.find(".ui-slider-handle").addClass("ui-state-default ui-corner-all"),s=i.values&&i.values.length||1,a=[];this._keySliding=!1,this._mouseSliding=!1,this._animateOff=!0,this._handleIndex=null,this._detectOrientation(),this._mouseInit(),this.element.addClass("ui-slider ui-slider-"+this.orientation+" ui-widget ui-widget-content ui-corner-all"+(i.disabled?" ui-slider-disabled ui-disabled":"")),this.range=e([]),i.range&&(!0===i.range&&(i.values||(i.values=[this._valueMin(),this._valueMin()]),i.values.length&&2!==i.values.length&&(i.values=[i.values[0],i.values[0]])),this.range=e("<div></div>").appendTo(this.element).addClass("ui-slider-range ui-widget-header"+("min"===i.range||"max"===i.range?" ui-slider-range-"+i.range:"")));for(var r=n.length;r<s;r+=1)a.push("<a class='ui-slider-handle ui-state-default ui-corner-all' href='#'></a>");this.handles=n.add(e(a.join("")).appendTo(t.element)),this.handle=this.handles.eq(0),this.handles.add(this.range).filter("a").click(function(e){e.preventDefault()}).hover(function(){i.disabled||e(this).addClass("ui-state-hover")},function(){e(this).removeClass("ui-state-hover")}).focus(function(){i.disabled?e(this).blur():(e(".ui-slider .ui-state-focus").removeClass("ui-state-focus"),e(this).addClass("ui-state-focus"))}).blur(function(){e(this).removeClass("ui-state-focus")}),this.handles.each(function(t){e(this).data("index.ui-slider-handle",t)}),this.handles.keydown(function(i){var n,s,a,r=e(this).data("index.ui-slider-handle");if(!t.options.disabled){switch(i.keyCode){case e.ui.keyCode.HOME:case e.ui.keyCode.END:case e.ui.keyCode.PAGE_UP:case e.ui.keyCode.PAGE_DOWN:case e.ui.keyCode.UP:case e.ui.keyCode.RIGHT:case e.ui.keyCode.DOWN:case e.ui.keyCode.LEFT:if(i.preventDefault(),!t._keySliding&&(t._keySliding=!0,e(this).addClass("ui-state-active"),!1===t._start(i,r)))return}switch(a=t.options.step,n=s=t.options.values&&t.options.values.length?t.values(r):t.value(),i.keyCode){case e.ui.keyCode.HOME:s=t._valueMin();break;case e.ui.keyCode.END:s=t._valueMax();break;case e.ui.keyCode.PAGE_UP:s=t._trimAlignValue(n+(t._valueMax()-t._valueMin())/5);break;case e.ui.keyCode.PAGE_DOWN:s=t._trimAlignValue(n-(t._valueMax()-t._valueMin())/5);break;case e.ui.keyCode.UP:case e.ui.keyCode.RIGHT:if(n===t._valueMax())return;s=t._trimAlignValue(n+a);break;case e.ui.keyCode.DOWN:case e.ui.keyCode.LEFT:if(n===t._valueMin())return;s=t._trimAlignValue(n-a)}t._slide(i,r,s)}}).keyup(function(i){var n=e(this).data("index.ui-slider-handle");t._keySliding&&(t._keySliding=!1,t._stop(i,n),t._change(i,n),e(this).removeClass("ui-state-active"))}),this._refreshValue(),this._animateOff=!1},destroy:function(){return this.handles.remove(),this.range.remove(),this.element.removeClass("ui-slider ui-slider-horizontal ui-slider-vertical ui-slider-disabled ui-widget ui-widget-content ui-corner-all").removeData("slider").unbind(".slider"),this._mouseDestroy(),this},_mouseCapture:function(t){var i,n,s,a,r,o,l,c,u=this.options;return!u.disabled&&(this.elementSize={width:this.element.outerWidth(),height:this.element.outerHeight()},this.elementOffset=this.element.offset(),i={x:t.pageX,y:t.pageY},n=this._normValueFromMouse(i),s=this._valueMax()-this._valueMin()+1,r=this,this.handles.each(function(t){var i=Math.abs(n-r.values(t));s>i&&(s=i,a=e(this),o=t)}),!0===u.range&&this.values(1)===u.min&&(o+=1,a=e(this.handles[o])),!1!==this._start(t,o)&&(this._mouseSliding=!0,r._handleIndex=o,a.addClass("ui-state-active").focus(),l=a.offset(),c=!e(t.target).parents().andSelf().is(".ui-slider-handle"),this._clickOffset=c?{left:0,top:0}:{left:t.pageX-l.left-a.width()/2,top:t.pageY-l.top-a.height()/2-(parseInt(a.css("borderTopWidth"),10)||0)-(parseInt(a.css("borderBottomWidth"),10)||0)+(parseInt(a.css("marginTop"),10)||0)},this.handles.hasClass("ui-state-hover")||this._slide(t,o,n),this._animateOff=!0,!0))},_mouseStart:function(e){return!0},_mouseDrag:function(e){var t={x:e.pageX,y:e.pageY},i=this._normValueFromMouse(t);return this._slide(e,this._handleIndex,i),!1},_mouseStop:function(e){return this.handles.removeClass("ui-state-active"),this._mouseSliding=!1,this._stop(e,this._handleIndex),this._change(e,this._handleIndex),this._handleIndex=null,this._clickOffset=null,this._animateOff=!1,!1},_detectOrientation:function(){this.orientation="vertical"===this.options.orientation?"vertical":"horizontal"},_normValueFromMouse:function(e){var t,i,n,s,a;return"horizontal"===this.orientation?(t=this.elementSize.width,i=e.x-this.elementOffset.left-(this._clickOffset?this._clickOffset.left:0)):(t=this.elementSize.height,i=e.y-this.elementOffset.top-(this._clickOffset?this._clickOffset.top:0)),n=i/t,n>1&&(n=1),n<0&&(n=0),"vertical"===this.orientation&&(n=1-n),s=this._valueMax()-this._valueMin(),a=this._valueMin()+n*s,this._trimAlignValue(a)},_start:function(e,t){var i={handle:this.handles[t],value:this.value()};return this.options.values&&this.options.values.length&&(i.value=this.values(t),i.values=this.values()),this._trigger("start",e,i)},_slide:function(e,t,i){var n,s,a;this.options.values&&this.options.values.length?(n=this.values(t?0:1),2===this.options.values.length&&!0===this.options.range&&(0===t&&i>n||1===t&&i<n)&&(i=n),i!==this.values(t)&&(s=this.values(),s[t]=i,a=this._trigger("slide",e,{handle:this.handles[t],value:i,values:s}),n=this.values(t?0:1),!1!==a&&this.values(t,i,!0))):i!==this.value()&&!1!==(a=this._trigger("slide",e,{handle:this.handles[t],value:i}))&&this.value(i)},_stop:function(e,t){var i={handle:this.handles[t],value:this.value()};this.options.values&&this.options.values.length&&(i.value=this.values(t),i.values=this.values()),this._trigger("stop",e,i)},_change:function(e,t){if(!this._keySliding&&!this._mouseSliding){var i={handle:this.handles[t],value:this.value()};this.options.values&&this.options.values.length&&(i.value=this.values(t),i.values=this.values()),this._trigger("change",e,i)}},value:function(e){return arguments.length?(this.options.value=this._trimAlignValue(e),this._refreshValue(),void this._change(null,0)):this._value()},values:function(t,i){var n,s,a;if(arguments.length>1)return this.options.values[t]=this._trimAlignValue(i),this._refreshValue(),void this._change(null,t);if(!arguments.length)return this._values();if(!e.isArray(arguments[0]))return this.options.values&&this.options.values.length?this._values(t):this.value();for(n=this.options.values,s=arguments[0],a=0;a<n.length;a+=1)n[a]=this._trimAlignValue(s[a]),this._change(null,a);this._refreshValue()},_setOption:function(t,i){var n,s=0;switch(e.isArray(this.options.values)&&(s=this.options.values.length),e.Widget.prototype._setOption.apply(this,arguments),t){case"disabled":i?(this.handles.filter(".ui-state-focus").blur(),this.handles.removeClass("ui-state-hover"),this.handles.propAttr("disabled",!0),this.element.addClass("ui-disabled")):(this.handles.propAttr("disabled",!1),this.element.removeClass("ui-disabled"));break;case"orientation":this._detectOrientation(),this.element.removeClass("ui-slider-horizontal ui-slider-vertical").addClass("ui-slider-"+this.orientation),this._refreshValue();break;case"value":this._animateOff=!0,this._refreshValue(),this._change(null,0),this._animateOff=!1;break;case"values":for(this._animateOff=!0,this._refreshValue(),n=0;n<s;n+=1)this._change(null,n);this._animateOff=!1}},_value:function(){var e=this.options.value;return e=this._trimAlignValue(e)},_values:function(e){var t,i,n;if(arguments.length)return t=this.options.values[e],t=this._trimAlignValue(t);for(i=this.options.values.slice(),n=0;n<i.length;n+=1)i[n]=this._trimAlignValue(i[n]);return i},_trimAlignValue:function(e){if(e<=this._valueMin())return this._valueMin();if(e>=this._valueMax())return this._valueMax();var t=this.options.step>0?this.options.step:1,i=(e-this._valueMin())%t,n=e-i;return 2*Math.abs(i)>=t&&(n+=i>0?t:-t),parseFloat(n.toFixed(5))},_valueMin:function(){return this.options.min},_valueMax:function(){return this.options.max},_refreshValue:function(){var t,i,n,s,a,r=this.options.range,o=this.options,l=this,c=!this._animateOff&&o.animate,u={};this.options.values&&this.options.values.length?this.handles.each(function(n,s){t=(l.values(n)-l._valueMin())/(l._valueMax()-l._valueMin())*100,u["horizontal"===l.orientation?"left":"bottom"]=t+"%",e(this).stop(1,1)[c?"animate":"css"](u,o.animate),!0===l.options.range&&("horizontal"===l.orientation?(0===n&&l.range.stop(1,1)[c?"animate":"css"]({left:t+"%"},o.animate),1===n&&l.range[c?"animate":"css"]({width:t-i+"%"},{queue:!1,duration:o.animate})):(0===n&&l.range.stop(1,1)[c?"animate":"css"]({bottom:t+"%"},o.animate),1===n&&l.range[c?"animate":"css"]({height:t-i+"%"},{queue:!1,duration:o.animate}))),i=t}):(n=this.value(),s=this._valueMin(),a=this._valueMax(),t=a!==s?(n-s)/(a-s)*100:0,u["horizontal"===l.orientation?"left":"bottom"]=t+"%",this.handle.stop(1,1)[c?"animate":"css"](u,o.animate),"min"===r&&"horizontal"===this.orientation&&this.range.stop(1,1)[c?"animate":"css"]({width:t+"%"},o.animate),"max"===r&&"horizontal"===this.orientation&&this.range[c?"animate":"css"]({width:100-t+"%"},{queue:!1,duration:o.animate}),"min"===r&&"vertical"===this.orientation&&this.range.stop(1,1)[c?"animate":"css"]({height:t+"%"},o.animate),"max"===r&&"vertical"===this.orientation&&this.range[c?"animate":"css"]({height:100-t+"%"},{queue:!1,duration:o.animate}))}}),e.extend(e.ui.slider,{version:"@VERSION"})}(e)}),define("models/login/LoginModel",["backbone","managers/I18nManager","models/BaseModel","data/DataURLConstants"],function(e,t,i,n){"use strict";return i.extend({url:n.LOGIN,defaults:{username:"",password:""},name:"LoginModel",initialize:function(){this.initializeBaseModel()},validate:function(e){if(0===e.username.length||0===e.password.length)return t.t("LoginView","login_error_no_username_and_pass","Please enter a username and password.")}})}),define("models/login/NextCredentialModel",["models/BaseModel","utils/AppConstants","data/DataURLConstants","data/DataProperties"],function(e,t,i,n){"use strict";return e.extend({DP:{USERNAME:"username",PASSWORD:"password"},name:"NextCredentialModel",urlRoot:i.CE_USERS,entityType:t.ENTITY_CE_USER,isCommunityEditionOverallCredentialValid:function(){return this.isCommunityEditionCredentialAccepted()&&this.isCommunityEditionCredentialEnabled()},isCommunityEditionCredentialAccepted:function(){return!(!this.get(n.CE_USERNAME)||!this.get(n.CE_VALID_CREDENTIALS))},isCommunityEditionCredentialEnabled:function(){return!!this.get(n.CE_IS_ENABLED)},getNextMessageForFailure:function(){return this.get(n.CE_REASON_FOR_FAILURE)||"Unknown reason"},saveNextCredential:function(e,t){this.save(e,t)},showLatencyNotification:function(e,t){},showSuccessNotification:function(e,t,i){},showErrorNotification:function(e,t,i){}})}),define("models/login/PreLoginModel",["models/BaseModel","utils/AppConstants","utils/AppUtil","utils/SubModelHelper","models/login/NextCredentialModel","data/DataURLConstants","data/DataProperties"],function(e,t,i,n,s,a,r){"use strict";var o=e.extend({DP:{PASSWORD:"password",PASSWORD_CONFIRM:"passwordConfirm",CURRENT_PASSWORD:"currentPassword",CURRENT_USERNAME:"currentUsername"},name:"ChangeDefaultPasswordModel",urlRoot:a.DEFAULT_PASSWORD_CHANGE,entityType:t.ENTITY_USER_PASSWORD,triggerAppViewRefresh:function(){},validate:function(e){if(e[this.DP.PASSWORD]!==e[this.DP.PASSWORD_CONFIRM])return"The passwords don't match."},toJSON:function(){var e={};return e[r.OLD_PASSWORD]=this.get(this.DP.CURRENT_PASSWORD),e[r.NEW_PASSWORD]=this.get(this.DP.PASSWORD),e},save:function(t,i){var n=this;return i=i||{},i.beforeSend=function(e){return e.setRequestHeader("Authorization",n.getAuthHeader()),!0},e.prototype.save.call(this,t,i)},getAuthHeader:function(){var e=this.get(this.DP.CURRENT_USERNAME),t=this.get(this.DP.CURRENT_PASSWORD);return i.convertToBasicAuth(e,t)}});return e.extend({DP:{DIRECTORY_DOMAINS:"directoryDomains",WELCOME_BANNER:"welcomeBanner",IS_USING_DEFAULT:r.IS_USING_DEFAULT_PASSWORD,COMMUNITY_EDITION:r.COMMUNITY_EDITION,IS_COMMUNITY_EDITION:r.IS_COMMUNITY_EDITION,IS_LENOVO:r.IS_LENOVO},urlRoot:a.UTILS_PRE_LOGIN_DETAILS,name:"PreLoginModel",subModelHelper:null,initialize:function(){this.initializeBaseModel(),this.subModelHelper=new n,this.subModelHelper.register("changeDefaultPasswordModel",new o),this.subModelHelper.register("changeNextCredential",new s)},getURL:function(e){return this.urlRoot},triggerAppViewRefresh:function(){},isADDomainsConfigured:function(){var e=this.get(this.DP.DIRECTORY_DOMAINS);return Boolean(e?e.length:e)},getActiveDirectoryDomains:function(){return this.get(this.DP.DIRECTORY_DOMAINS)},getWelcomeBannerStatus:function(){var e=this._getFromWelcomeBanner(r.SYSTEM_DATA_TYPE_WELCOME_BANNER_STATUS);return e?e.value:""},getWelcomeBannerContent:function(){var e=this._getFromWelcomeBanner(r.SYSTEM_DATA_TYPE_WELCOME_BANNER_CONTENT);return e?e.value:""},_getFromWelcomeBanner:function(e){var t=this.get(this.DP.WELCOME_BANNER);return _.find(t,function(t){return t[r.SYSTEM_DATA_KEY]===e})},isVideoDisabled:function(){var e=this._getFromWelcomeBanner(r.SYSTEM_DATA_TYPE_WELCOME_BANNER_DISABLE_VIDEO);return!!e&&"true"===e.value},isPasswordDefault:function(){return this.get(this.DP.IS_USING_DEFAULT)},isHXBranding:function(){return this.get(this.DP.IS_LENOVO)},isCommunityEdition:function(){return!!this.get(this.DP.IS_COMMUNITY_EDITION)},isCommunityEditionCredentialAccepted:function(){var e=this.get(this.DP.COMMUNITY_EDITION);return!!(e&&e[r.CE_USERNAME]&&e[r.CE_VALID_CREDENTIALS])},isCommunityEditionCredentialEnabled:function(){var e=this.get(this.DP.COMMUNITY_EDITION);return!(!e||!e[r.CE_IS_ENABLED])},getNextMessageForFailure:function(){var e=this.get(this.DP.COMMUNITY_EDITION);return e&&e[r.CE_REASON_FOR_FAILURE]||"Unknown reason"},overrideDefaultCredentials:function(e,t){return this.subModelHelper.get("changeDefaultPasswordModel").save(e,t)},saveNextCredential:function(e,t){this.subModelHelper.get("changeNextCredential").save(e,t)}})}),define("models/systemdata/SystemDataModel",["models/BaseModel","views/notification/NotificationTemplates","managers/NamespaceManager","data/DataURLConstants","data/DataProperties","utils/AppUtil","utils/AppConstants","utils/SubModelHelper"],function(e,t,i,n,s,a,r,o){"use strict";var l=e.extend({name:"WelcomeBannerStatusModel",urlRoot:n.APP_SYSTEM_DATA,entityType:r.ENTITY_SYSTEM_DATA,defaults:{type:s.SYSTEM_DATA_TYPE_WELCOME_BANNER,key:s.SYSTEM_DATA_TYPE_WELCOME_BANNER_STATUS,value:null},getURL:function(e){var t=this.urlRoot;return"update"===e||"create"===e?this.unset("id"):"read"!==e&&"delete"!==e||null!==this.get(s.SYSTEM_DATA_KEY)&&(t+="/"+this.get(s.SYSTEM_DATA_KEY)),t},getNotificationMessage:function(e,i){switch(i){case r.NOTIFY_SUCCESS:var n=this.i18n("welcome_banner"),s=r.ACTION_NAMES[e].toLowerCase(),o=a.endsWith(s,"e")?"d":"ed";return t.MSG_GENERIC_SUCCESS({entityName:n,actionName:s,endingChars:o});case r.NOTIFY_WARNING:case r.NOTIFY_ERROR:default:return t.MSG_GENERIC_ERROR}},getLatencyMessage:function(e){var i=this.i18n("welcome_banner");switch(e){case r.ACTION_CREATE:case r.ACTION_ADD:return t.LATENCY_CREATE({entityName:i});case r.ACTION_UPDATE:return t.LATENCY_UPDATE({entityName:i});case r.ACTION_DELETE:case r.ACTION_REMOVE:return t.LATENCY_DELETE({entityName:i});default:return t.LATENCY_GENERIC}}}),c=l.extend({name:"WelcomeBannerContentModel",defaults:{type:s.SYSTEM_DATA_TYPE_WELCOME_BANNER,key:s.SYSTEM_DATA_TYPE_WELCOME_BANNER_CONTENT,value:null},validate:function(e){var t=e[s.SYSTEM_DATA_VALUE],i="";if(a.hasInvalidTagAndAttributes(t)&&(i=this.i18n("error_msg")),$.trim(i).length>0)return _.escape(i)}}),u=e.extend({name:"PulseEnableModel",urlRoot:n.APP_SYSTEM_DATA,entityType:r.ENTITY_SYSTEM_DATA,defaults:{type:s.SYSTEM_DATA_TYPE_PULSE_CONFIG,key:s.SYSTEM_DATA_TYPE_PULSE_CONFIG_KEY,value:null},validate:function(e){var t=e[s.SYSTEM_DATA_VALUE],i="";if(a.hasInvalidTagAndAttributes(t)&&(i=this.i18n("error_msg")),$.trim(i).length>0)return i}}),d=e.extend({name:"DisableVideoModel",urlRoot:n.APP_SYSTEM_DATA,entityType:r.ENTITY_SYSTEM_DATA,defaults:{type:s.SYSTEM_DATA_TYPE_WELCOME_BANNER,key:s.SYSTEM_DATA_TYPE_WELCOME_BANNER_DISABLE_VIDEO,value:null},getURL:function(e){var t=this.urlRoot;return"update"===e||"create"===e?this.unset("id"):"read"!==e&&"delete"!==e||null!==this.get(s.SYSTEM_DATA_KEY)&&(t+="/"+this.get(s.SYSTEM_DATA_KEY)),t}}),h=e.extend({name:"CustomizeLoginModel",urlRoot:n.APP_SYSTEM_DATA,entityType:r.ENTITY_SYSTEM_DATA,isNewMap:null,defaults:{type:s.SYSTEM_DATA_CUST_LOGIN_TYPE,key:null,value:null},initialize:function(){e.prototype.initialize.apply(this,arguments),this.isNewMap={},this.isNewMap[s.SYSTEM_DATA_CUST_LOGIN_COLOR_IN_KEY]=!0,this.isNewMap[s.SYSTEM_DATA_CUST_LOGIN_COLOR_OUT_KEY]=!0,this.isNewMap[s.SYSTEM_DATA_CUST_LOGIN_PRODUCT_TITLE_KEY]=!0,this.isNewMap[s.SYSTEM_DATA_CUST_LOGIN_TITLE_KEY]=!0},getURL:function(e){var t=this.urlRoot;return"update"===e||"create"===e?this.unset("id"):"read"!==e&&"delete"!==e||null!==this.get(s.SYSTEM_DATA_KEY)&&(t+="/"+this.get(s.SYSTEM_DATA_KEY)),t},saveColorIn:function(e){this._isNew=this.isNewMap[s.SYSTEM_DATA_CUST_LOGIN_COLOR_IN_KEY],this.save({key:s.SYSTEM_DATA_CUST_LOGIN_COLOR_IN_KEY,value:e})},saveColorOut:function(e){this._isNew=this.isNewMap[s.SYSTEM_DATA_CUST_LOGIN_COLOR_OUT_KEY],this.save({key:s.SYSTEM_DATA_CUST_LOGIN_COLOR_OUT_KEY,value:e})},saveProductTitle:function(e){this._isNew=this.isNewMap[s.SYSTEM_DATA_CUST_LOGIN_PRODUCT_TITLE_KEY],this.save({key:s.SYSTEM_DATA_CUST_LOGIN_PRODUCT_TITLE_KEY,value:e})},saveTitle:function(e){this._isNew=this.isNewMap[s.SYSTEM_DATA_CUST_LOGIN_TITLE_KEY],this.save({key:s.SYSTEM_DATA_CUST_LOGIN_TITLE_KEY,value:e})},saveCustomizeLogin:function(e,t,i,n,s){return _.map(e,function(e,t){this.isNewMap[t]=!1},this),[this.saveColorIn(t),this.saveColorOut(i),this.saveProductTitle(n),this.saveTitle(s)]}}),p=e.extend({name:"Disable2048Model",urlRoot:n.APP_SYSTEM_DATA,entityType:r.ENTITY_SYSTEM_DATA,defaults:{type:s.SYSTEM_DATA_TYPE_UI_CONFIG,key:s.SYSTEM_DATA_TYPE_UI_CONFIG_DISABLE_2048,value:null},getURL:function(e){var t=this.urlRoot;return"update"===e||"create"===e?this.unset("id"):"read"!==e&&"delete"!==e||null!==this.get(s.SYSTEM_DATA_KEY)&&(t+="/"+this.get(s.SYSTEM_DATA_KEY)),t}}),T=e.extend({name:"TempSaveModel",urlRoot:n.APP_SYSTEM_DATA,entityType:r.ENTITY_SYSTEM_DATA,defaults:{type:s.SYSTEM_DATA_TYPE_TEMP_SAVE,key:null,value:null},getURL:function(e){var t=this.urlRoot;return"update"===e||"create"===e?this.unset("id"):"read"!==e&&"delete"!==e||null!==this.get(s.SYSTEM_DATA_KEY)&&(t+="/"+this.get(s.SYSTEM_DATA_KEY)),t},saveTempSaveState:function(e,t,i,n){switch(e){case s.SYSTEM_DATA_TYPE_TEMP_SAVE_ENCRYPTION:this.saveEncryption(t,i,n)}},saveEncryption:function(e,t,i){this._isNew=t,this.save({key:s.SYSTEM_DATA_TYPE_TEMP_SAVE_ENCRYPTION,value:e},i)}}),E=e.extend({name:"GlobalSessionTimeoutModel",urlRoot:n.APP_SYSTEM_DATA,entityType:r.ENTITY_SYSTEM_DATA,defaults:{type:s.SYSTEM_DATA_TYPE_UI_CONFIG,key:s.SYSTEM_DATA_TYPE_UI_CONFIG_GLOBAL_TIMEOUT,value:null},getURL:function(e){var t=this.urlRoot;return"update"===e||"create"===e?this.unset("id"):"read"!==e&&"delete"!==e||null!==this.get(s.SYSTEM_DATA_KEY)&&(t+="/"+this.get(s.SYSTEM_DATA_KEY)),t}}),S=e.extend({name:"OverrideSessionTimeoutModel",urlRoot:n.APP_SYSTEM_DATA,entityType:r.ENTITY_SYSTEM_DATA,
defaults:{type:s.SYSTEM_DATA_TYPE_UI_CONFIG,key:s.SYSTEM_DATA_TYPE_UI_CONFIG_OVERRIDE_TIMEOUT,value:null},getURL:function(e){var t=this.urlRoot;return"update"===e||"create"===e?this.unset("id"):"read"!==e&&"delete"!==e||null!==this.get(s.SYSTEM_DATA_KEY)&&(t+="/"+this.get(s.SYSTEM_DATA_KEY)),t}});return e.extend({name:"SystemDataModel",urlRoot:n.APP_SYSTEM_DATA,entityType:r.ENTITY_SYSTEM_DATA,defaults:{type:null,systemDataList:[]},savedHash:null,initialize:function(t,i){e.prototype.initialize.apply(this,arguments);var n=new l({},i),a=new c({},i),r=new d({},i),_=new u({},i),g=new h({},i),A=new p({},i),m=new T({},i),f=new E({},i),I=new S({},i);this.subModelHelper=new o,this.subModelHelper.register(s.SYSTEM_DATA_TYPE_WELCOME_BANNER_STATUS,n),this.subModelHelper.register(s.SYSTEM_DATA_TYPE_WELCOME_BANNER_CONTENT,a),this.subModelHelper.register(s.SYSTEM_DATA_TYPE_WELCOME_BANNER_DISABLE_VIDEO,r),this.subModelHelper.register(s.SYSTEM_DATA_TYPE_PULSE_CONFIG_KEY,_),this.subModelHelper.register(s.SYSTEM_DATA_CUST_LOGIN_TYPE,g),this.subModelHelper.register(s.SYSTEM_DATA_TYPE_UI_CONFIG_DISABLE_2048,A),this.subModelHelper.register(s.SYSTEM_DATA_TYPE_TEMP_SAVE,m),this.subModelHelper.register(s.SYSTEM_DATA_TYPE_UI_CONFIG_GLOBAL_TIMEOUT,f),this.subModelHelper.register(s.SYSTEM_DATA_TYPE_UI_CONFIG_OVERRIDE_TIMEOUT,I),i&&!1===i.enableNotifications&&(this.enableNotifications=i.enableNotifications),this.subModelHelper.attachEventHandler("sync",this._onSyncSubModel,this),this.subModelHelper.attachEventHandler("error",this._onErrorSubModel,this),this.savedHash={}},_onErrorSubModel:function(e,t,i){var n="";_.isString(t)?n=t:_.isObject(t)&&t.responseText&&(n=a.processAjaxError(t.responseText)),this.trigger("error",n)},_onSyncSubModel:function(e){this.savedHash[e.get(s.SYSTEM_DATA_KEY)]=!0,this.fetch({alwaysTriggerChange:!0})},getURL:function(e){var t=this.urlRoot;return"read"===e&&null!==this.get(s.SYSTEM_DATA_TYPE)&&(t+="?"+s.SYSTEM_DATA_TYPE+"="+this.get(s.SYSTEM_DATA_TYPE)),t},parse:function(e){var t={};return t[s.SYSTEM_DATA_TYPE]=this.get(s.SYSTEM_DATA_TYPE),t[s.SYSTEM_DATA_LIST]=e,_.each(e,function(e){var t=e[s.SYSTEM_DATA_KEY],i=this.subModelHelper.get(t);i&&i.set(e)},this),t},isValueSaved:function(e){return this.savedHash[e]},setValue:function(e,t,i){var n=this.subModelHelper.get(e),a=n.validate?n.validate({value:t}):null;if(i=i||{},a)return void this.trigger("error",a);i.overrideSubModel&&n.set(s.SYSTEM_DATA_VALUE,t,i),this.savedHash[e]=!1;for(var r=this.get(s.SYSTEM_DATA_LIST)||[],o=!1,l=0;l<r.length;l++)if(e===r[l][s.SYSTEM_DATA_KEY]){r[l][s.SYSTEM_DATA_VALUE]=t,i.silent||this.trigger("change",this),o=!0;break}if(!o){var c={};c[s.SYSTEM_DATA_KEY]=e,c[s.SYSTEM_DATA_VALUE]=t,r.push(c),i.silent||this.trigger("change",this)}},getValue:function(e){for(var t=this.get(s.SYSTEM_DATA_LIST),i=0;i<t.length;i++)if(e===t[i][s.SYSTEM_DATA_KEY])return t[i][s.SYSTEM_DATA_VALUE]},setIsModelNew:function(e){e.isNew(null===e.get(s.SYSTEM_DATA_VALUE))},getStatusCode:function(t){return{401:function(t,n,s){i.get(i.IS_LOGGED_IN)&&e.prototype.getStatusCode.apply(this,arguments)}}},savePulseConfig:function(e){var t=this.subModelHelper.get(s.SYSTEM_DATA_TYPE_PULSE_CONFIG_KEY);return this.setIsModelNew(t),t.save({value:e})},saveWelcomeBannerContent:function(e){var t=this.subModelHelper.get(s.SYSTEM_DATA_TYPE_WELCOME_BANNER_CONTENT);this.setIsModelNew(t),t.save({value:e})},previewWelcomeBannerContent:function(e){var t={overrideSubModel:!1};this.setValue(s.SYSTEM_DATA_TYPE_WELCOME_BANNER_CONTENT,e,t)},saveWelcomeBannerStatus:function(e){var t=this.subModelHelper.get(s.SYSTEM_DATA_TYPE_WELCOME_BANNER_STATUS);this.setIsModelNew(t),t.save({value:Boolean(e)})},saveDisableVideoStatus:function(e){var t=this.subModelHelper.get(s.SYSTEM_DATA_TYPE_WELCOME_BANNER_DISABLE_VIDEO);return this.setIsModelNew(t),t.save({value:e})},isVideoDisabled:function(){return"true"===this.subModelHelper.get(s.SYSTEM_DATA_TYPE_WELCOME_BANNER_DISABLE_VIDEO).get(s.SYSTEM_DATA_VALUE)},saveDisable2048Status:function(e){var t=this.subModelHelper.get(s.SYSTEM_DATA_TYPE_UI_CONFIG_DISABLE_2048);return this.setIsModelNew(t),t.save({value:e})},saveTempSaveState:function(e,t,i){var n=this.subModelHelper.get(s.SYSTEM_DATA_TYPE_TEMP_SAVE),a=!this.getTempSaveState(e);return n.saveTempSaveState(e,t,a,i)},getTempSaveState:function(e){return this.getAttributeList()&&this.getAttributeList()[e]?this.getAttributeList()[e]:null},is2048Disabled:function(){return"true"===this.subModelHelper.get(s.SYSTEM_DATA_TYPE_UI_CONFIG_DISABLE_2048).get(s.SYSTEM_DATA_VALUE)},isWelcomeBannerEnabled:function(){return this.subModelHelper.get(s.SYSTEM_DATA_TYPE_WELCOME_BANNER_STATUS).get(s.SYSTEM_DATA_VALUE)},saveGlobalSessionTimeout:function(e){var t=this.subModelHelper.get(s.SYSTEM_DATA_TYPE_UI_CONFIG_GLOBAL_TIMEOUT);return this.setIsModelNew(t),t.save({value:e})},getGlobalSessionTimeout:function(){var e=this.subModelHelper.get(s.SYSTEM_DATA_TYPE_UI_CONFIG_GLOBAL_TIMEOUT),t=e.get(s.SYSTEM_DATA_VALUE);if(null!==t)return t},saveOverrideSessionTimeout:function(e){var t=this.subModelHelper.get(s.SYSTEM_DATA_TYPE_UI_CONFIG_OVERRIDE_TIMEOUT);return this.setIsModelNew(t),t.save({value:e})},getOverrideSessionTimeout:function(){var e=this.subModelHelper.get(s.SYSTEM_DATA_TYPE_UI_CONFIG_OVERRIDE_TIMEOUT),t=e.get(s.SYSTEM_DATA_VALUE);if(null!==t)return t},getAttributeList:function(){var e=this.get(s.SYSTEM_DATA_LIST),t={};return e.length&&_.map(e,function(e){t[e[s.SYSTEM_DATA_KEY]]=e[s.SYSTEM_DATA_VALUE]},this),t},getCustomizedLoginSettings:function(){return this.getAttributeList()},saveCustomizeLogin:function(e,t,i,n){return this.subModelHelper.get(s.SYSTEM_DATA_CUST_LOGIN_TYPE).saveCustomizeLogin(this.getCustomizedLoginSettings(),e,t,i,n)}})}),define("models/identityprovider/IdentityProviderPreLoginModel",["models/BaseModel","data/DataURLConstants","data/DataProperties","utils/AppConstants","broker/api/AppAPI"],function(e,t,i,n,s){"use strict";return e.extend({name:"IdentityProviderPreLoginModel",fetch:function(){var e=this,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a={};return a.$body={},a.$isAsync=!1,a.$url=t.IDENTITY_PROVIDER_INTENT.PRELOGIN_LIST,s.getAppAPI().intentService.create(n.SSP_INTENT_KINDS.IDENTITY_PROVIDER,a).then(function(t){e.setModelFromResponse(t),i.success&&i.success(e,t)}).catch(function(e){throw e})},setModelFromResponse:function(e){if(0===e.entities.length)return this.set({});var t=e.entities,n={},s=t[0];n=s[i.INTENT_STATUS][i.INTENT_RESOURCES][i.IDENTITY_PROVIDER.IDP_PROPERTIES],n.id=s[i.INTENT_METADATA][i.UUID],n.name=s[i.INTENT_STATUS][i.NAME],this.set(n)}})}),define("text!templates/login/LoginView.html",[],function(){return'<div id="n-login-wrapper">\n  <div id="n-ctr-login">\n    \x3c!-- Login form section --\x3e\n    <section id="formLoginSection" class="form-login">\n      \x3c!-- Yey! We have our own Prism logo. --\x3e\n      <div id="loginPrismLogoContainer" class="prism-logo">\n        <%= prismLogo %>\n      </div>\n      <form class="n-login-form">\n        <section id="sectionLoginControls" class="login-controls">\n          \x3c!-- TODO: Add Loader --\x3e\n          Loading...\n        </section>\n      </form>\n      <div class="n-login-help">\n        <span>Having issues logging in?</span>\n      </div>\n      \x3c!-- Alert error --\x3e\n      <div id="alertLogin" class="alert alert-error">\n      </div>\n      \x3c!-- Login message --\x3e\n      <div id="loginFooterMessage" class="login-footer-message"></div>\n    </section>\n    \x3c!-- Login welcome banner --\x3e\n    <section id="welcomeBannerSection">\n      \x3c!-- Welcome banner template goes here... --\x3e\n    </section>\n  </div>\n  \x3c!-- Nutanix Logo --\x3e\n  <div id="loginNutanixLogoContainer" class="bottom-left"></div>\n  <div id="loginControls" class="bottom-right"></div>\n</div>'}),define("text!templates/login/LoginNextFormView.html",[],function(){return'<div class="login-instructions">\n  Please enter your NEXT account information to access the cluster.\n</div>\n<div id="msgError" class="alert alert-error" style="display:none">\n</div>\n<div id="loginNextUsername">\n  <input id="inputUsername" type="text" autocomplete="off"\n    placeholder="NEXT username">\n</div>\n<div id="loginNextPassword" class="login-password-submit">\n  <input id="inputPassword" type="password" autocomplete="off"\n    placeholder="NEXT password">\n  <label class="submit-button-wrapper">\n    <input id="btnLogin" value="Submit" class="submit"\n      autocomplete="off" class="password-submit">\n    <div class="loginSubmit">\n      <%= SVG.loginSubmitArrow %>\n      <div class="donut-loader" style="display: none;"></div>\n    </div>\n  </label>\n</div>\n<div class="loginLinks">\n  <div class="left">\n    <a href="https://my.nutanix.com" target="_blank">\n      Create account\n    </a>\n  </div>\n  <div class="right">\n    <a href="https://my.nutanix.com" target="_blank">\n      Forgot your password?\n    </a>\n  </div>\n  <div class="n-clearfix"></div>\n</div>'}),define("text!templates/login/LoginNextDisabledView.html",[],function(){return'<div class="alert alert-error">\n  <%= message %>\n</div>\n<div class="login-instructions">\n  Your .NEXT account does not have the required Community Edition role.\n  Please request the role from your Nutanix contact or on the .NEXT forum.\n</div>'}),define("text!templates/login/LoginOverrideDefaultView.html",[],function(){return'<div class="login-instructions">\n  Create a new password for the cluster admin.\n</div>\n<div id="loginOverrideUsername">\n  <input id="inputUsername" type="text" autocomplete="off"\n    value="admin" placeholder="admin" disabled>\n</div>\n<div id="loginOverridePassword1">\n  <input id="inputPasswordConfirm" type="password" autocomplete="off"\n    placeholder="password" autofocus>\n</div>\n<div id="loginOverridePassword2" class="login-password-submit">\n  <input id="inputPassword" type="password" autocomplete="off"\n    placeholder="re-type password" class="password-submit">\n  <label class="submit-button-wrapper">\n    <input id="btnLogin" value="Submit" class="submit"\n      autocomplete="off">\n    <div class="loginSubmit">\n      <%= SVG.loginSubmitArrow %>\n      <div class="donut-loader" style="display: none;"></div>\n    </div>\n  </label>\n</div>\n\n<div class="help-text">\n  Note: When you change the admin user password, update any applications and scripts using the admin user credentials for authentication. Nutanix recommends that you create a user assigned with the admin role instead of using the admin user for authentication. The Prism Web Console Guide describes authentication and roles.\n</div>'}),define("text!templates/login/LoginFormView.html",[],function(){return'<% if (idpName) { %>\n  <div class="idp-login-section">\n    <a href="<%= idpLoginUrl %>" class="idp-login-button">\n      <%= i18ns(\'loginWithIDP\', idpName) %>\n    </a>\n  </div>\n  <div class="login-separator"><%= i18n(\'or\') %></div>\n<% } %>\n<div id="loginHostPort"><input id="inputHostPort"\n  type="text" placeholder="host:port">\n</div>\n<div id="loginUsername2">\n  <input id="inputUsername"\n  type="text" placeholder="username" autocomplete="off">\n</div>\n<div id="loginPassword" class="login-password-submit">\n  <input id="inputPassword" type="password" autocomplete="off"\n    placeholder="password" class="password-submit">\n  <label class="submit-button-wrapper">\n    <input id="btnLogin" value="Submit" class="submit"\n      autocomplete="off">\n    <div class="loginSubmit">\n      <%= SVG.loginSubmitArrow %>\n      <div class="donut-loader" style="display: none;"></div>\n    </div>\n  </label>\n</div>'}),define("text!templates/login/WelcomeBannerView.html",[],function(){return'\x3c!-- Welcome banner container --\x3e\n<div id="loginWelcomeBanner">\n  <div class="antiscroll-wrap">\n    <div class="box-wrap">\n      <div class="antiscroll-inner">\n        <div id="welcomeBannerContainer" class="box-inner">\n          \x3c!-- customized content goes here... --\x3e\n        </div>\n      </div>\n    </div>\n  </div>\n</div>\n\x3c!-- Accept Button --\x3e\n<button id="btnAccept" tabindex="1">\n  <p class="n-msg">Accept terms and conditions</p>\n  <i class="n-check" aria-hidden="true" data-icon="J"></i>\n</button>\n\x3c!-- Alert error --\x3e\n<div id="alertLogin" class="alert alert-error">\n</div>'}),define("models/ebrowser/filters/EBFilterModel",["models/BaseModel","utils/AppConstants","data/DataProperties","utils/EntityUtil"],function(e,t,i,n){"use strict";return e.extend({idAttribute:i.ID,nameAttribute:i.NAME,name:"EntityBrowserFilterModel",DP:{ENTITY_TYPE:"entityType",NAME:"name",VALUE:"value",IS_APPLIED:"isApplied",TYPE:"type",SUB_TYPE:"subType",INPUT_TYPE:"inputType",INPUT_PARAMS:"inputParams",UNITS:"units",ATTRIBUTE:"attribute",OPERATOR:"operator",START:"start",END:"end",COUNT:"count",CATEGORY:"category",FILTERABLE:"filterable",CUSTOM_LABEL:"label"},defaults:{id:null,entityType:null,name:null,value:null,isApplied:null,type:null,subType:null,inputType:null,inputParams:null,units:null,attribute:null,operator:null,start:null,end:null,count:null},initialize:function(t){e.prototype.initialize.apply(this,arguments),this.set(this.DP.COUNT,null),this.set(this.DP.INPUT_PARAMS,t[this.DP.INPUT_PARAMS]||[])},getDisplayName:function(){var e;if(this.get(this.DP.TYPE)===t.FILTER_TYPES.ENUM){var i=this.get(this.DP.ATTRIBUTE),s=this.get(this.DP.VALUE);this.get(this.DP.UNITS)===t.UNITS.HEALTH&&(s=this.get(this.DP.END)-1),e=s===t.FILTER_NULL_VALUE?this.get(this.DP.NAME):n.getAttributeDisplayValue(this.get(this.DP.ENTITY_TYPE),i,s)}else(e=this.get(this.DP.NAME))&&e.length||(e=t.UNKNOWN_VALUE);return e},getMatchCount:function(){return this.get(this.DP.COUNT)},setMatchCount:function(e){this.set(this.DP.COUNT,e)},isRangeEndFilter:function(){return Number(this.get(this.DP.END))===t.FILTER_RANGE_MAX},isTimeRangeFilter:function(){return this.get(this.DP.SUB_TYPE)===t.FILTER_TYPES.TIME},getFilterCondition:function(){var e=this.get(this.DP.NAME),i=this.get(this.DP.TYPE)===t.FILTER_TYPES.ENUM?this.get(this.DP.SUB_TYPE):this.get(this.DP.TYPE),n=_.isNull(this.get(this.DP.START))?this.get(this.DP.VALUE):this.get(this.DP.START),s=this.isRangeEndFilter()?null:this.get(this.DP.END);return this.isTimeRangeFilter()&&(n=this.convertTimestampForFiltering(n),s=this.convertTimestampForFiltering(s)),{op:this.get(this.DP.OPERATOR),name:e,type:i,value1:n,value2:s,label:this.get(this.DP.CUSTOM_LABEL)}},convertTimestampForFiltering:function(e){var i=void 0;return i=this.get(this.DP.NAME)===t.CUSTOM_SEARCH.NUM_SEARCH?e:Date.now()-e*t.MILLIS_PER_HOUR,this.get(this.DP.UNITS)===t.UNITS.MSECS?i:i*t.MICROS_PER_MILLI},getCountsFilterExpression:function(){var e=null;return this.get(this.DP.NAME)!==t.CUSTOM_SEARCH.NUM_SEARCH&&this.get(this.DP.NAME)!==t.CUSTOM_SEARCH.STR_SEARCH&&(e={},e[this.get(this.DP.ATTRIBUTE)]=[this.getFilterCondition()]),e},getExcludeNullsFilterExpression:function(){var e={};return e[this.get(this.DP.ATTRIBUTE)]=[{op:t.FILTER_OPERATORS.NOT_NULL,name:this.get(this.DP.ATTRIBUTE),type:this.get(this.DP.TYPE),value1:null,value2:null}],e},isFilterForCondition:function(e,t){if(this.get(this.DP.ATTRIBUTE)===e){var i=this.getFilterCondition();return i.op===t.op&&i.op===t.op&&i.type===t.type&&i.value1==t.value1&&i.value2==t.value2}return!1},isFilterable:function(){return this.get(this.DP.FILTERABLE)},getUnitsForManualEntry:function(){switch(this.get(this.DP.UNITS)){case t.UNITS.BYTES:return"GiB";case t.UNITS.USECS:return"ms";case t.UNITS.PPM:case t.UNITS.PPH:case t.UNITS.PCT:return"%";case t.UNITS.IOPS:return"IOPS";case t.UNITS.KBPS:return"MBps";case t.UNITS.RAW:case t.UNITS.TIME:case t.UNITS.MSECS:return""}return this.get(this.DP.UNITS)}})}),define("data/ExploreDataProperties",[],function(){"use strict";return{USER_QUERY:"user_query",COMPLETE_QUERY:"complete_query",QUERY_TERM_LIST:"query_term_list",AUTOCOMPLETION_LIST:"autocompletion_list",RESULT:"result",AMBIGUOUS_RESULTS:"disambiguated_searches",IS_AUTOCOMPLETE_SELECTION:"is_autocomplete_selection",EXPLICIT_QUERY:"explicit_query",WIDGET_LIST:"widget_id_list",PLAIN_TEXT_QUERY:"plain_text_query",TYPE:"type",QUERY_CONTEXT:"query_context",QUERY_EXPLANATION:"query_explanation",SEARCH_QUERY:"search_query",TERM:"term",RESULT_LIST:"result_list",PERSPECTIVE_LIST:"perspective_list",PERSPECTIVE_GROUP_LIST:"perspective_group_list",AUTOCOMPLETE_ONLY:"generate_autocompletions_only",SUMMARY_DATA_LIST:"summary_data_list",CHILD_LINK_LIST:"child_link_list",ACTIVE_PERSPECTIVE:"active_perspective",DATA_LIST:"data_list",CHILD_LINKS:"child_links",METRIC_METADATA:"metric_metadata",NAME:"name",DATA:"data",VALUES:"values",PARAMS:"params",GRAND_TOTAL_ENTITIES:"grand_total_entities",FILTERED_ENTITY_COUNT:"filtered_entity_count",TOTAL_ENTITY_COUNT:"total_entity_count",GROUP_RESULT_LIST:"group_result_list",GROUP_SUMMARY_LIST:"group_summary_list",ENTITY_RESULT_LIST:"entity_result_list",METRIC_DATA_LIST:"metric_data_list",TIME_VALUE_PAIR_LIST:"time_value_pair_list",VALUE_LIST:"value_list",STRING_VALUE:"string_value",ENTITY_RESULTS:"entity_results",GROUP_RESULTS:"group_results",GROUP_BY_COL:"group_by_column_value",GROUP_BY:"group_by",TITLE:"title",FILTER:"filter",PAGE_METADATA:"page_metadata",TARGET_TAB_ID:"target_tab_id",TARGET_ID:"target_id",METRIC_TYPE:"metric_type",DOWN_SAMPLING_OPERATOR:"down_sampling_operator",AGGREGATION_OPERATOR:"aggregation_operator",ENTITY_TYPE:"entity_type",ENTITY_TYPES:"entity_types",ENTITY_NAME:"entity_name",ENTITY_PARENT_TYPE:"entity_parent_type",ENTITY_ID:"entity_id",PROPERTY_TYPE:"property_type",PROPERTY_NAME:"property_name",OPERATOR:"operator",VALUE:"value",CREATED_TIMESTAMP_USEC:"_created_timestamp_usecs_",SYNONYM:"synonym",PREFIX:"prefix",DISPLAY_CONTEXT:"display_context",ADDITIONAL_CONTEXT:"additional_context",IDENTIFIER:"identifier",IS_CHILD_ENTITY_TYPE:"is_child_entity_type",MATCH_TYPE:"match_type",TOKEN_LIST:"token_list",LOWER_BOUND:"lower_bound",UPPER_BOUND:"upper_bound",GROUPING_ATTRIBUTE_TYPE:"grouping_attribute_type",GROUP_MEMBER_ATTRIBUTES:"group_member_attributes",GROUPING_ATTRIBUTE:"grouping_attribute",GROUP_ATTRIBUTES:"group_attributes",INTERVAL_START_MS:"interval_start_ms",INTERVAL_END_MS:"interval_end_ms",ATTRIBUTE:"attribute",ENTITY_IDS:"entity_ids",ALERT_LISTING:"listingResult",GROUP_BY_RESULT:"groupByResult",SEVERITY_BREAKDOWN:"severity_breakdown",ALERT_SUMMARIES:"alertSummaries",COUNT:"count",SEVERITY:"severity",ALERT_TITLE:"alert_title",ALERT_CONTEXT_TYPES:"context_types",ALERT_CONTEXT_VALUES:"context_values",CREATED_TIME_STAMP:"created_time_stamp",BUCKETIZATION_VALUE:"bucketization_value",MAP_ENTRY_LIST:"map_entry_list",TIME:"time",KEY:"key",CREATED_TIME_USECS:"created_timestamp_usecs",TIME_USECS:"timestamp_usecs",TIMESTAMP:"timestamp",MESSAGE:"message",NUMERIC_VALUE:"numeric_value",COLUMN_NAME:"column_name",SORT_TYPE:"sort_type",FILTER_NAME:"filter_name",ENTITY_DATA:"entity_data",FILTERED_DATA:"filtered_data",RANGED_DATA:"ranged_data",MAX_COUNT:"max_count",SELECTED_INDICES:"selected_indices",CLUSTER_NAME:"cluster_name",SEARCH_CONTEXT_HISTORY_OPERATION:"search_context_history_operation",OVERALL_EFFICIENCY:"data_reduction.overall.saving_ratio_ppm",EFFECTIVE_FREE:"effective_free",COMPRESSION_RATIO:"data_reduction.compression.saving_ratio_ppm",THICK_PROVISION:"thick_provision",COMPRESSION_TYPE:"compression_type",ERASURE_CODE:"erasure_code"}}),define("utils/ExploreSearchUtil",["utils/AppUtil","utils/EntityUtil","utils/AlertUtil","utils/FilterUtil","utils/StatsUtil","utils/TimeUtil","utils/AppConstants","utils/ExploreConstants","managers/AccessManager","models/ebrowser/filters/EBFilterModel","data/ExploreDataProperties","data/DataProperties"],function(e,t,i,n,s,a,r,o,l,c,u,d){"use strict";var h,p={ALERTS:"alerts",CAPACITY:"capacity",EVENTS:"events",HEALTH:"health",METRICS:"metrics",USAGE:"usage","HOST NICS":'"host nics"',PERFORMANCE:"performance",VMS:"vms","VIRTUAL DISKS":'"virtual disks"',"VIRTUAL NICS":'"virtual nics"',TASKS:"tasks",NICS:"nics",SNAPSHOTS:"snapshots"},T=["ipv4_addresses","external_ip_address","service_vm_ipv4_address","node_ipv4_address","vm_ipv4_address"],E=[o.FILTER_OPERATORS.CONTAINS,o.FILTER_OPERATORS.NOTCONTAINS,r.FILTER_OPERATORS.STARTS,r.FILTER_OPERATORS.ENDS],S=(h={},_defineProperty(h,r.ENTITY_CATEGORY,"categories"),_defineProperty(h,r.ENTITY_PROTECTION_RULE,"protection_policies"),_defineProperty(h,r.ENTITY_NGT_POLICY,"ngt_policies"),_defineProperty(h,r.ENTITY_QOS_POLICY,"qos_policies"),_defineProperty(h,r.ENTITY_VM_RECOVERY_POINT,"recoverable_entities"),_defineProperty(h,r.SSP_MAPPING_ENTITY_TO_EB[r.ENTITY_USER],"users"),h),g=["check.score","capacity.vm_efficiency_status","capacity.vm_overprovisioned_status","capacity.vm_constrained_status"],A=["storage.user_capacity_bytes","memory_size_bytes","storage.capacity_bytes","_created_timestamp_usecs_",""],m=["source_entity_type","source_entity_uuid","vm"],f=[r.FILTER_NULL_VALUE],I={cluster:"cluster_name",node:"node_name"},C=void 0;return{isIPAddress:function(e){return _.contains(T,e)},getEntityTypeForUI:function(t){return t=t&&t.toLowerCase(),t===o.STORAGE_CONTAINER&&(t=r.ENTITY_CONTAINER),e.getEntityTypeForUI(t)},getPrettyEntityType:function(t,i){var n=this.getEntityTypeForUI(t);return n=e.getSingularEntityName(n),i&&(n=e.getPluralEntityName(n)),n},isDemarcationTerm:function(e){return e&&0===e.indexOf("demarcation")},stripQuotes:function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"").replace(/"/g,"")},getEntityForSubroute:function(t){return C||(C=e.invertObj(S)),C[t]||t.substring(0,t.length-1)},getSubRouteForEntity:function(e){return S[e]||e+"s"},getNameAttribute:function(e){return e=this.getEntityTypeForUI(e),t.getNameAttribute(e)},formatAlertIssue:function(e,t,n){if(_.isEmpty(n)||_.isEmpty(t))return e;var s=_.map(n,function(e){var t=e&&e[u.VALUE_LIST][0];return t&&t[u.STRING_VALUE]}),a=_.map(t,function(e){var t=e&&e[u.VALUE_LIST][0];return t&&t[u.STRING_VALUE]});return _.each(s,function(t,n){e=i.replaceParam(e,t,a[n])}),e},caseInSensitiveMatch:function(e,t){return e&&t&&"string"==typeof e&&"string"==typeof t?e.toLowerCase()===t.toLowerCase():e==t},checkMetricType:function(e){return e&&(e.indexOf("_")>=0||e.indexOf(".")>=0)&&(e=this.toTitleCase(e)),e=e&&e.replace("Cpu","CPU"),e=e&&e.replace("Ppm","ppm")},toTitleCase:function(t){var i=e.toTitleCase(t);switch(i&&i.toLowerCase()){case r.ENTITY_VM:case r.VP_RESOURCE_TYPE.CPU:case r.VP_RESOURCE_TYPE.IO:i=i.toUpperCase()}return i},getAttributeDisplayName:function(i,n){i=this.getEntityTypeForUI(i);var s=t.getAttributeDisplayName(i,n);return s=e.getAttributeKey(s),s=this.checkMetricType(s)},getAttributeDisplayValue:function(e,i,n){return e=this.getEntityTypeForUI(e),t.getAttributeDisplayValue(e,i,n)},getValuefromTimeValuePair:function(e,t,i){var n=e&&e[0],s=n&&n[u.VALUE_LIST],a=s&&s[0];return void 0===a&&(a="-"),a=a&&void 0!==a[u.NUMERIC_VALUE]?a[u.NUMERIC_VALUE]:a[u.STRING_VALUE],a=this.getAttributeDisplayValue(i,t,a)||a},createFilterExpression:function(e,t,i,s,a,r){var o={},l=n.createFilterCondition(e,t,i,s,a,r);return n.addFilterCondition(o,t,l)},createFilterExpressionFromFilter:function(e,t){var i={};return t&&_.size(t)<=0?i:(_.each(t,function(s){var a=s[d.SEARCH.FILTER_ATTR],o=s[d.SEARCH.FILTER_DISPLAY_OPERATOR],l=o||s[d.SEARCH.FILTER_OPERATOR],c=null,h=null;if(h=-1!==E.indexOf(o)?s[d.SEARCH.FILTER_EB_RHS_VALUE]||s[d.SEARCH.FILTER_VALUE]:s[d.SEARCH.FILTER_VALUE],l===r.FILTER_OPERATORS.RANGE&&h){var p=h.slice(1,h.length-1),_=p.split(",");h=_[0],c=Number(_[1])===r.FILTER_RANGE_MAX?null:_[1]}l=r.FILTER_OPERATOR_REVERSE_MAPPING[l],e===r.ENTITY_EVENT&&a===u.ENTITY_ID&&(a=r.ENTITY_CLUSTER),e===r.ENTITY_ALERT&&a===d.ALERT_SOURCE_ENTITY_ID&&this.getSourceEntityType(t)===r.ENTITY_CLUSTER&&(a=r.ENTITY_CLUSTER);var T=n.createFilterCondition(e,a,l,h,c,"custom filter");delete T.name,s.name&&(T.name=s.name),T.displayFilterValue=s[d.SEARCH.FILTER_EB_RHS_VALUE],n.addFilterCondition(i,a,T)},this),i)},getSourceEntityType:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=_.find(e,function(e){return e[d.SEARCH.FILTER_ATTR]===d.ALERT_SOURCE_ENTITY_TYPE});if(t)return t[d.SEARCH.FILTER_VALUE]},getSummaryDataList:function(e){return e&&e[u.SUMMARY_DATA_LIST]&&e[u.SUMMARY_DATA_LIST].length&&e[u.SUMMARY_DATA_LIST][0]},getPerspectiveResult:function(e){var t=e&&e[u.RESULT_LIST];return t&&t[0]||{}},getSummaryEntity:function(e){var t=this.getSummaryDataList(e);if(t){var i=t[u.GROUP_RESULT_LIST];if(i&&i.length){var n=i[0];if(n&&n[u.ENTITY_RESULT_LIST]&&n[u.ENTITY_RESULT_LIST].length)return n[u.ENTITY_RESULT_LIST][0]}}},getFirstToken:function(e){return e&&e.token_list&&e.token_list[0]},getDisplayContext:function(e){var t=this.getFirstToken(e);return t&&t[u.DISPLAY_CONTEXT]},getAdditionalContext:function(e){var t=this.getFirstToken(e);return t&&t[u.ADDITIONAL_CONTEXT]},getEntityTypeFromSearchResult:function(e){var t=this.getActivePerspective(e),i=this.getSummaryDataList(t);return i&&i[u.ENTITY_TYPE]},getEntityFromSearchResult:function(e){var t=this.getActivePerspective(e);return this.getSummaryEntity(t)},getActivePerspective:function(e){return e&&e[u.ACTIVE_PERSPECTIVE]},getQueryContext:function(t,i){var n=e.getPluralEntityName(t),s=t,a=[];switch(t){case r.ENTITY_HOST:s=r.ENTITY_NODE,a.push({operator:o.OPERATOR_MAPPING.eq,property_name:o.SYNONYM,value:e.getPluralEntityName(r.ENTITY_HOST)});break;case r.ENTITY_CONTAINER:n="Containers",a.push({operator:o.OPERATOR_MAPPING.eq,property_name:o.SYNONYM,value:e.getPluralEntityName(o.STORAGE_CONTAINER)});break;case o.STORAGE_CONTAINER:s=r.ENTITY_CONTAINER,n="Containers"}var l=t+"s",c={query:l,queryTermList:[{term:n,token_list:[{display_context:{entity_type:s},additional_context:a,match_type:"exact"}]}]};return i&&c.queryTermList.push({term:i,token_list:[{display_context:{property_type:"perspective",property_name:i,entity_type:s}}]}),c},getQueryContextForPage:function(e){return[{term:e,token_list:[{display_context:{operator:"=",property_type:o.DISPLAY_CONTEXT_PROPERTY_TYPES.PAGE,property_name:o.CONTEXT_VALUES.NAME,value:e,entity_type:o.PAGE_ENTITY_TYPE}}]}]},getAutoCompleteQuery:function(e){return{complete_query:e,query_term_list:this.getQueryContextForPage(e)}},isSearchSupportedEntityListPerspective:function(e){return!l.isSspOnlyUser()&&-1!==o.SEARCH_SUPPORTED_ENTITY_LIST_PERSPECTIVE.indexOf(e)},isSearchSupportedEntityDetail:function(e){return!l.isSspOnlyUser()&&-1!==o.SEARCH_SUPPORTED_ENTITY_DETAIL.indexOf(e)},isSearchSupportedEntityType:function(e){return!l.isSspOnlyUser()&&-1!==o.SEARCH_SUPPORTED_ENTITY_TYPES.indexOf(e)},getSearchSupportedEntityTypes:function(){return l.isSspOnlyUser()?[]:o.SEARCH_SUPPORTED_ENTITY_TYPES},getEntityNameAttr:function(e){var i=t.fromEdb(e),n=i+"_name";switch(e){case r.ENTITY_HOST:n=r.SPOTLIGHT_FN_NODE_NAME;break;case r.ENTITY_DISK:n=d.EB.DISK.SERIAL_NUMBER}return n},getQueryEntityType:function(e){var t=e;return"container"===e?t="storage_container":"host"===e&&(t="node"),t},createIdentifierforEntityInstance:function(e,t){return{entity_type:e,property_name:"entity_id",property_type:"attribute",value:t,operator:"="}},makeQueryTermListForEntityInstance:function(e,t,i,n){var s="host"===e?"node":e,a=[{term:i,token_list:[{match_type:o.MATCH_TYPES.PREFIX,identifier:{operator:"=",property_type:u.ATTRIBUTE,property_name:u.ENTITY_ID,value:t,entity_type:s}}]}],r=p[n];return r&&a.push({term:r,token_list:[{display_context:{property_type:"perspective",property_name:r,entity_type:s},match_type:"exact"}]}),a},generateQueryTermFromFilterExpressions:function(t,i){var n=[];return _.each(i,function(i,s){i.forEach(function(i){var a,o=i.op,l=i[d.NAME],h=void 0,p=void 0,_=void 0;switch(i.type){case r.FILTER_TYPES.TIME:o=r.FILTER_OPERATORS.RANGE,h=r.UNITS.MSECS,l=r.CUSTOM_SEARCH.NUM_SEARCH,_=Date.now(),p=i.value1/r.MICROS_PER_MILLI}n.push(new c((a={},_defineProperty(a,d.NAME,l),_defineProperty(a,d.ID,e.randomId("filter")),_defineProperty(a,"entityType",t),_defineProperty(a,"attribute",s),_defineProperty(a,u.OPERATOR,o),_defineProperty(a,u.VALUE,i.value1),_defineProperty(a,"units",h),_defineProperty(a,"start",p),_defineProperty(a,"end",_),a)))})}),this.generateQueryTermFromFilterModels(t,n,!1,!1)},filtersToIgnore:function(e){var t=e.get(e.DP.ATTRIBUTE),i=this.getRHSValue(e),n=e.get(e.DP.OPERATOR);return-1!==m.indexOf(t)||-1!==f.indexOf(i)||t===r.ENTITY_CLUSTER&&n===r.FILTER_OPERATORS.IN},generateQueryTermFromFilterModels:function(e,t,i){var n=this,s=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=[];return _.each(t,function(t){var r,l=t.get(t.DP.ATTRIBUTE);if(!n.filtersToIgnore(t)){var c=n.getQueryTerm(t,e),d=n.getRHSValue(t);if(d||0===d){var h="";if(_.contains(_.keys(I),l)&&!i){var p,T=t.get(t.DP.NAME),E=t.get(t.DP.VALUE),S=l;l=I[l],d=s?T:o.ENTITY_NAME_TO_USE_UUID,p={},_defineProperty(p,u.ENTITY_TYPE,S),_defineProperty(p,u.OPERATOR,o.OPERATOR_MAPPING[t.get(t.DP.OPERATOR)]),_defineProperty(p,u.PROPERTY_NAME,u.ENTITY_ID),_defineProperty(p,u.PROPERTY_TYPE,n.getPropertyType(t)),_defineProperty(p,u.VALUE,E),h=p}var g=_defineProperty({term:c},u.TOKEN_LIST,[_defineProperty({},u.DISPLAY_CONTEXT,(r={},_defineProperty(r,u.ENTITY_TYPE,e),_defineProperty(r,u.PROPERTY_TYPE,n.getPropertyType(t)),_defineProperty(r,u.PROPERTY_NAME,l),_defineProperty(r,u.OPERATOR,n.getOperator(t)),_defineProperty(r,u.VALUE,d.toString()),r))]);_.isEmpty(h)||(_.first(g.token_list).identifier=h),a.push(g)}}}),a},getPropertyType:function(e){if(-1!==g.indexOf(e.get(e.DP.ATTRIBUTE)))return o.CONTEXT_VALUES.METRIC;if(-1!==A.indexOf(e.get(e.DP.ATTRIBUTE)))return o.CONTEXT_VALUES.ATTRIBUTE;switch(e.get(e.DP.OPERATOR)){case r.FILTER_OPERATORS.RANGE:case r.FILTER_OPERATORS.GREATER_THAN:case r.FILTER_OPERATORS.GREATER_OR_EQUAL:case r.FILTER_OPERATORS.LESS_THAN:case r.FILTER_OPERATORS.LESS_OR_EQUAL:return o.CONTEXT_VALUES.METRIC;default:return o.CONTEXT_VALUES.ATTRIBUTE}},getRHSValue:function(e,t){var i=e.get(e.DP.OPERATOR),n=e.get(e.DP.TYPE)===r.FILTER_TYPES.ENUM?e.get(e.DP.NAME):e.get(e.DP.VALUE),a=void 0,l=void 0;switch(i){case r.FILTER_OPERATORS.EQUALS:return t&&e.get(e.DP.INPUT_TYPE)===r.INPUT_TYPES.SPOTLIGHT?e.get(e.DP.NAME):n;case r.FILTER_OPERATORS.STARTS:return n+o.REGEX.ANY_CHAR;case r.FILTER_OPERATORS.ENDS:return o.REGEX.ANY_CHAR+n;case r.FILTER_OPERATORS.RANGE:var c="";if(t&&e.get(e.DP.TYPE)===r.FILTER_TYPES.ENUM)return n;switch(e.get(e.DP.UNITS)){case r.UNITS.PPM:a=s.ppmFormat(e.get(e.DP.START),!1),l=s.ppmFormat(e.get(e.DP.END),!1);break;case r.UNITS.HEALTH:return n;case r.UNITS.TIME:var u=e.get(e.DP.START),d=e.get(e.DP.END);return"custom filter"!==e.get(e.DP.CUSTOM_LABEL)&&(u=e.convertTimestampForFiltering(u),d=e.convertTimestampForFiltering(d)),this.getTimeValue(u/r.MICROS_PER_MILLI,d/r.MICROS_PER_MILLI);case r.UNITS.MSECS:return a=e.convertTimestampForFiltering(e.get(e.DP.START)),l=e.convertTimestampForFiltering(e.get(e.DP.END)),this.getTimeValue(a,l);case r.UNITS.BYTES:a=s.convertBytesToUnit(e.get(e.DP.START),s.UOM_GIB),l=s.convertBytesToUnit(e.get(e.DP.END),s.UOM_GIB),a=a&&a.toFixed(2),l=l&&l.toFixed(2);break;default:var h=e.get(e.DP.ATTRIBUTE);a=s.statsFormat(h,e.get(e.DP.START),!1),l=s.statsFormat(h,e.get(e.DP.END),!1)}return c="[ "+a+" to "+l+" }",Number(e.get(e.DP.END))===r.FILTER_RANGE_MAX?a:c;default:return n}},getTimeValue:function(e,t){if(e&&t){return a.formatDate(new Date(e),"dd-MMM-yyyy h:mm tt","en-US")+" to "+a.formatDate(new Date(t),"dd-MMM-yyyy h:mm tt","en-US")}},getQueryTerm:function(e,i){var n=t.getAttributeDisplayName(i,e.get(e.DP.ATTRIBUTE)),s=this.getRHSValue(e,!0);return this.hasSpaceInTerm(n)&&(n='"'+n+'"'),this.hasSpaceInTerm(s)&&(s='"'+s+'"'),""+n+this.getOperator(e)+s},hasSpaceInTerm:function(e){return e&&_.isString(e)&&e.match(/ /)},getOperator:function(e){var t=e.get(e.DP.OPERATOR),i=e.get(e.DP.END);return t=t===r.FILTER_OPERATORS.RANGE&&Number(i)===r.FILTER_RANGE_MAX?r.FILTER_OPERATOR_SYMBOLS.ge:o.OPERATOR_MAPPING[e.get(e.DP.OPERATOR)]}}}),
define("managers/ExploreMenuDataManager",["managers/BaseManager","utils/AppUtil","utils/ExploreConstants","utils/ExploreSearchUtil"],function(e,t,i,n){"use strict";function s(e){return{route:e[0],label:e[1],count:e[2],subpageid:e[3],searchTerm:""+e[4]}}var a=[s(["pc_dashboard","Dashboard","","pc_dashboard","dashboard"]),s(["analysis","Analysis","","analysis","analysis"]),s(["planning","Planning","","planning","planning"]),s(["alerts","Alerts","","alert_explorer","alerts"]),s(["tasks","Tasks","","tasks","tasks"]),s(["apps","Apps","","apps","apps"]),s(["search_guidelines","Search Guidelines","","search_guidelines","search guidelines"]),s(["settings","Settings","","settings","settings"]),s(["capacity planning","Capacity Planning","","capacity planning","capacity planning"]),s(["planning runway","Planning Runway","","planning runway","planning runway"]),s(["calm","Calm","","calm","Calm"]),s(["security_planning","Security Planning","","security_planning","Security Planning"]),s(["lcm","LCM","","lcm","LCM"])];return e.extend({getEBListItems:function(){var e=this.getSearchDataManager(),a=e&&e.getBrowserModel(),r=[];return a&&_.each(a.getEntityTypes(),function(e){var o=a.getTotalEntityCount(e),l="";_.isUndefined(o)||_.isNull(o)||(l=-1===o?"Error":Number(o).toLocaleString());var c=t.getPluralEntityName(e),u=n.getSubRouteForEntity(e),d=i.ROUTES.EBROWSER,h=i.ROUTES.SEARCH,p=d+"/"+u,T=d;n.isSearchSupportedEntityType(e)&&(T=h,p=h+"/"+u),r.push(s([p,c,l,T,c]))},this),r},isInitialized:function(){var e=this.getSearchDataManager();return e&&e.getBrowserModel()},getStaticListItems:function(){return a},_isSearchAware:function(e){return-1!==i.SEARCH_AWARE_ENTITY_TYPES.indexOf(e)}})}),define("models/search/SearchModel",["backbone","models/BaseModel","data/DataURLConstants","data/ExploreDataProperties","utils/ExploreSearchUtil"],function(e,t,i,n,s){"use strict";var a={};return t.extend({name:"SearchModel",isV3API:!0,enableNotifications:!1,getURL:function(){return i.SEARCH},getEntityType:function(){return s.getEntityTypeFromSearchResult(this.get(n.RESULT))},getEntity:function(){return s.getEntityFromSearchResult(this.get(n.RESULT))},getActivePerspective:function(){return s.getActivePerspective(this.get(n.RESULT))},getQueryTermList:function(){if(this.isResultAmbiguous()||this.hasNoResult())return this.get(n.QUERY_TERM_LIST);var e=this.get(n.AUTOCOMPLETION_LIST),t=e&&_.first(e);return t&&t[n.QUERY_TERM_LIST]||this.get(n.QUERY_TERM_LIST)},isResultAmbiguous:function(){var e=this.get(n.RESULT);return Boolean(e&&e[n.AMBIGUOUS_RESULTS])},isPlainTextAmbiguousResult:function(){return this.isResultAmbiguous()&&this.get(n.PLAIN_TEXT_QUERY)},hasNoResult:function(){var e=this.get(n.RESULT);if(!e||_.isEmpty(e))return!0;var t=e[n.AMBIGUOUS_RESULTS];return t&&(!t[n.RESULT_LIST]||_.isEmpty(t[n.RESULT_LIST]))}},{DP:a})}),define("models/userdata/UserDataCollection",["models/PollingCollection","models/userdata/UserDataModel","data/DataURLConstants","data/DataProperties","utils/AppConstants"],function(e,t,i,n,s){"use strict";return e.extend({model:t,name:"UserDataCollection",url:i.APP_USER_DATA,type:null,initialize:function(t){t=t||{},this.type=this.type||t.type,e.prototype.initialize.apply(this,arguments)},fetch:function(t){return t=_.extend({data:{type:this.type}},t),e.prototype.fetch.apply(this,[t])},getAutoLogoutTimeModel:function(){return this.find(function(e){if(e.get(n.USER_DATA_KEY)===n.UI_CONFIG_AUTO_LOGOUT_TIME)return!0})},getAutoLogoutTime:function(){var e=this.getAutoLogoutTimeModel();if(e&&e.get(n.SYSTEM_DATA_USERNAME)!==s.ENTITY_SYSTEM_DATA)return Number(e.get(n.USER_DATA_VALUE))},getAutoLogoutGlobalModel:function(){return this.find(function(e){if(e.get(n.USER_DATA_KEY)===n.SYSTEM_DATA_TYPE_UI_CONFIG_GLOBAL_TIMEOUT)return!0})},getAutoLogoutGlobal:function(){var e=this.getAutoLogoutGlobalModel();if(e)return Number(e.get(n.USER_DATA_VALUE))},getAutoLogoutOverrideModel:function(){return this.find(function(e){if(e.get(n.USER_DATA_KEY)===n.SYSTEM_DATA_TYPE_UI_CONFIG_OVERRIDE_TIMEOUT)return!0})},getAutoLogoutOverride:function(){var e=this.getAutoLogoutOverrideModel();if(e)return Number(e.get(n.USER_DATA_VALUE))},getSearchTutorialInfoModel:function(){return this.find(function(e){return e.get(n.USER_DATA_KEY)===n.UI_CONFIG_HAS_VIEWED_SEARCH_TUTORIAL})},hasUserViewedSearchTutorial:function(){var e=this.getSearchTutorialInfoModel();if(e)return e.get(n.USER_DATA_VALUE)===s.BOOLEAN_TRUE}})}),define("utils/ExploreNavigationUtil",["managers/ExploreMenuDataManager","utils/LogUtil","utils/ExploreSearchUtil","utils/ExploreConstants","data/ExploreDataProperties"],function(e,t,i,n,s){"use strict";var a,r,o,l,c;return{getStaticRouteMap:function(){if(!a){var t={};return _.each(e.getStaticListItems(),function(e){t[e.route]=!0}),_.each(e.getEBListItems(),function(e){t[e.route]=!0}),e.isInitialized()&&(a=t),t}return a},getStaticRouteToSearchTermMap:function(){if(!r){var t={};return _.each(e.getStaticListItems(),function(e){t[e.route]=e.searchTerm}),_.each(e.getEBListItems(),function(e){t[e.route]=e.searchTerm}),e.isInitialized()&&(r=t),t}return r},getStaticRouteToPageIdMap:function(){if(!o){var t={};return _.each(e.getStaticListItems(),function(e){t[e.route]=e.subpageid}),_.each(e.getEBListItems(),function(e){t[e.route]=e.subpageid}),e.isInitialized()&&(o=t),t}return o},getStaticRouteToLabelMap:function(){if(!c){var t={};return _.each(e.getStaticListItems(),function(e){t[e.route]=e.label}),_.each(e.getEBListItems(),function(e){var i=e.searchTerm,n=e.route;t[n]=i}),e.isInitialized()&&(c=t),t}return c},getPageIdToStaticRouteMap:function(){if(!l){var t={};return _.each(e.getStaticListItems(),function(e){e.subpageid!==n.ROUTES.EBROWSER&&(t[e.subpageid]=e.route)}),e.isInitialized()&&(l=t),t}return l},makeEBRoute:function(e){var t=n.ROUTES.EBROWSER,s=i.getSubRouteForEntity(e);return i.isSearchSupportedEntityType(e)&&(t=n.ROUTES.SEARCH),t+"/"+s},navigateToPage:function(e,t,s){var a=e||{},r=a&&a.type,o=s._navigationManager,l=void 0;switch(r){case"SIMPLE":a.page_id&&(o.navigateToPage(a.page_id,a.sub_page_id),s.exploreSearchInputView&&s.exploreSearchInputView.updateSearchBubbles(t));break;case"SERVICE_ENTITY":l=a.params&&a.params[0]&&a.params[0].entity_type;var c=a.target_id;if(l){var u={};c&&(u.entityId=c);var d=o.createNavigationContext(l,u);o.navigateToPage(a.service_name,null,{contextId:d}),s.exploreSearchInputView&&s.exploreSearchInputView.updateSearchBubbles(t)}break;case"EBROWSER":var h=n.ROUTES.EBROWSER;l=a.entity_type;var p=i.getSubRouteForEntity(l),_=h+"/"+p;if(a&&a.params&&a.params.length){var T=a.params[0]||{};if(T.entity_type&&T.value)return void o.navigateToEBPage(T.entity_type,null,T.property_name,T.value)}o.navigateToPage(n.ROUTES.EXPLORE,_,{});break;default:if(a&&a.params&&a.params.length){var E=a.params[0];E.entity_type&&E.value&&o.navigateToFullScreenDetailsPane(E.entity_type,E.value,null,a.target_tab_id,!1)}}},formQueryParamsFromQueryTermList:function(e){var i={},a=0;return e.forEach(function(e){var r=e.token_list&&_.first(e.token_list),o=r&&r[s.DISPLAY_CONTEXT],l=r&&r[s.ADDITIONAL_CONTEXT],c=r&&r[s.IDENTIFIER];if(o){var u=o[s.VALUE];u&&(u=u.replace(n.URL_ATTR_DELIMITER,"\\"+n.URL_ATTR_DELIMITER));var d=o[s.ENTITY_TYPE];d||t.error("entity_type is a required attribute in display_context");var h=[d,o[s.PROPERTY_TYPE],o[s.PROPERTY_NAME],o[s.OPERATOR],u,c&&c[s.VALUE],l&&_.first(l)&&_.first(l)[s.ENTITY_TYPE]],p=h.join().replace(/([,\s]+$)/g,"");a+=1;var T=""+n.URL_QUERY_TERM_KEY_PREFIX+a;i[T]=p}}),i},formQueryTermListFromQueryParams:function(e){var t=[];return _.each(e,function(e,a){if(a.match("^"+n.URL_QUERY_TERM_KEY_PREFIX)){var r=parseInt(a.substring(5),10)-1,o={},l=e.split(n.URL_ATTR_DELIMITER),c={};[[s.ENTITY_TYPE],[s.PROPERTY_TYPE],[s.PROPERTY_NAME],[s.OPERATOR],[s.VALUE]].forEach(function(e,t){c[e]=l[t]}),Object.keys(c).forEach(function(e){return!c[e]&&delete c[e]}),c[s.VALUE]&&(c[s.VALUE]=c[s.VALUE].replace("\\"+n.URL_ATTR_DELIMITER,n.URL_ATTR_DELIMITER)),o[s.DISPLAY_CONTEXT]=c,l[5]&&(o[s.IDENTIFIER]=i.createIdentifierforEntityInstance(c[s.ENTITY_TYPE],l[5])),l[6]&&(o[s.ADDITIONAL_CONTEXT]=[_defineProperty({},s.ENTITY_TYPE,l[6])]);var u={term:a,token_list:[o]};t[r]=u}}),t}}}),define("views/explore/ExploreSearchInputView",["managers/AccessManager","components/Components","views/basecomponents/BaseView","models/userdata/UserDataCollection","models/userdata/UserDataModel","utils/SVG","utils/AppConstants","utils/ExploreConstants","utils/AppUtil","utils/LogUtil","utils/ExploreSearchUtil","utils/ExploreNavigationUtil","data/DataProperties","data/DataURLConstants","data/ExploreDataProperties"],function(e,t,i,n,s,a,r,o,l,c,u,d,h,p,T){"use strict";function E(e){var t=e||"";switch(e){case I.NAVIGATE_TO:t="Navigate to";break;case I.SEARCH_FOR:t="Search for";break;case I.SEARCH_LOGS:t="Search logs";break;case I.STAY_ON:t="Stay on"}return t}var S=[{minWidth:0,className:"default-width"},{minWidth:350,className:"medium-width"},{minWidth:600,className:"large-width"},{minWidth:800,className:"full-width"}],g=$.ui.keyCode,A=[g.UP,g.DOWN],m="Dashboard",f={PAGE_ICON:"page-icon",SEARCH_ICON:"searchIcon search-icon -search"},I={NAVIGATE_TO:"NAVIGATE_TO",SEARCH_FOR:"SEARCH_FOR",SEARCH_LOGS:"SEARCH_LOGS",STAY_ON:"STAY_ON"},C={INPUT:"input",SEARCH_INPUT:".exp-search-input",SEARCH_BOX:".search-box",SEARCH_BUBBLES:".search-bubbles-container",SEARCH_BUBBLE:".search-bubble",SELECTED_SEARCH_BUBBLES:".search-bubble.selected",SEARCH_SUGGESTIONS:".search-sgst",SEARCH_SUGGESTION:".search-sgst .search-sgst-item"},v={MOUSE_UP_SCH:"mouseup.expsch"},R=_.template('\n      <div class="search-sgst-item <%= selected %>"\n        data-test="search_sgst_item_<%= index %>"\n        data-search-query="<%- query %>" data-index="<%= index %>">\n        <div class="<%= iconClass %>">\n          <%= componentIcon %>\n        </div>\n        <div class="sgst-text-wrapper">\n          <%= autoCompletionBubbles %>\n        </div>\n        <div class="search-sgst-type"><%= category %></div>\n      </div>\n    '),N=_.template('\n      <div class="search-sgst-text">\n        <%= text %>\n      </div>\n    '),P=_.template('<span class="text"><%= text %></span>');return i.extend({name:"ExploreSearchInputView",currentHighlightedItem:0,isDefaultAutoCompleteShown:!1,events:{"input .exp-search-input":"_onInput","keydown .exp-search-input":"_onKeyDown","focus .exp-search-input":"_onFocus","click .search-box":"_onClickSearchBox","click .clear-filter":"_onClearFilter","mousedown .search-box":"_onMouseDownSearchBox","mousemove .search-box":"_onMouseMoveSearchBox","click .icon-star":"_onClickFavStar","click .search-sgst-item":"_onClickSearchSuggestion","mouseover .search-sgst-item":"_onMouseOverSearchSuggestion"},initialize:function(t){var n=this;i.prototype.initialize.apply(this,arguments),this._brokerManager=t.brokerManager,this._exploreSearchManager=t.exploreSearchManager,this._exploreBookmarkManager=t.exploreBookmarkManager,e.isSspOnlyUser()?(this.$(C.SEARCH_INPUT).prop("disabled",!0),this.$(C.SEARCH_BOX).addClass("read-only"),e.isXiUserType()||(m="VMs")):this.triggerSearchTutorial(),e.isSspOnlyUser()||this._exploreBookmarkManager.fetchSearchFavoriteCollection(),this._searchBubbles=[m],this.$(C.SEARCH_INPUT).val(m),this._dbDoAutoCompletion=_.debounce(this._doAutoCompletion.bind(this),250),$(document).click(function(e){n._isFocused()&&n._removeSearchBoxFocus()}),this.transitionEvent=function(){var e=void 0,t=document.createElement("div"),i={transition:"transitionend",OTransition:"oTransitionEnd",MozTransition:"transitionend",WebkitTransition:"webkitTransitionEnd"};for(e in i)if(void 0!==t.style[e])return i[e]}();var s=this;this._onMouseMoveSearchBox=function(e){s._onMouseMoveSearchBox_.call(this,e,s)},this._exploreBookmarkManager&&this._exploreBookmarkManager.on(this._exploreBookmarkManager.EVENT_UPDATE,this._renderStarIcon.bind(this))},makeAutoCompletionBubbles:function(e){var t=void 0;if(e.search_type===I.SEARCH_FOR)return N({text:e.complete_query});e.query_term_list&&(t=_.map(e.query_term_list,function(e){return e.term}));var i=[],n=[];return _.each(t,function(e,t){e&&!u.isDemarcationTerm(e)?n.push(P({text:u.stripQuotes(e)})):(i.push(N({text:n.join("")})),n=[])}),i.push(N({text:n.join("")})),i.join("")},addSearchInputListener:function(){var e=this;this._inputListenerAdded||(this._searchBubbles.length&&this._renderSearchBubbles(),$(document).on(v.MOUSE_UP_SCH,function(){e._mousedownActivated=!1,e._bubbleGroup=null}),this._inputListenerAdded=!0)},removeSearchInputListener:function(){this._inputListenerAdded&&($(document).off(v.MOUSE_UP_SCH),this._inputListenerAdded=!1)},getSearchInputValue:function(){var e=this._getSearchInputElement();if(e.length){return e.val().trim()}return""},setSearchInputValue:function(e){this._getSearchInputElement().val(e)},updateSearchBubbles:function(e,t){if(e=decodeURIComponent(e),t){var i=_.filter(t,function(e){return Boolean(e.token_list)});this._updateSearchBubbles(_.map(i,function(e){return e.term}))}else this._updateSearchBubbles(this._parseBubbles(e)),this.setSearchInputValue("");this._renderSearchBubbles(),this._clearAutoCompletionResultsMaybe()},getSearchTutorialSteps:function(){return new Promise(function(e,t){require(["text!"+p.TUTORIAL_PATH+"/"+p.TUTORIALS.SEARCH_V2],function(i){var n={};try{n=JSON.parse(i)}catch(e){t(new Error("ExploreSearchInputView | triggerSearchTutorial |\n              failed to fetch tutorial steps"))}e(n)},t)})},triggerSearchTutorial:function(){var e=this,t=new n({type:h.USER_DATA_TYPE_UI_CONFIG},{enableNotifications:!1});t.fetch().then(function(){var i=t.hasUserViewedSearchTutorial(),n=l.getLocalStorageProperty(r.LOCAL_STORAGE.SHOW_SEARCH_TUTORIAL)===r.BOOLEAN_TRUE,s=l.getLocalStorageProperty(r.LOCAL_STORAGE.SHOW_SEARCH_TUTORIAL)===r.BOOLEAN_FALSE;i&&!n||s||e.loadSearchTutorialComponent()},function(){c.error("ExploreSearchInputView | triggerSearchTutorial |\n            fetch user data failed")})},loadSearchTutorialComponent:function(){var e=this;this.getSearchTutorialSteps().then(function(t){e._searchTutorialMountPoint||(e._searchTutorialMountPoint=document.createElement("div")),document.body.appendChild(e._searchTutorialMountPoint);var i=e.$(".search-box").get(0),n=e._brokerManager.loadComponent("SearchWidgets",$(e._searchTutorialMountPoint),{componentName:"SearchTutorial"},{success:function(n){n.render({searchInput:i,helpItems:t,endTutorial:e.markSearchTutorialAsViewed,unmountHook:e.stopSearchTutorial,viewGuidelinesHandler:e.onClickViewGuidelines.bind(e)})}});e._searchTutorialComponentId=n})},onClickViewGuidelines:function(){this._exploreSearchManager.getNavigationManager().navigateToPage(r.PAGE_SEARCH_GUIDELINES),this.stopSearchTutorial()},markSearchTutorialAsViewed:function(){var e=new s;return e.set({type:h.USER_DATA_TYPE_UI_CONFIG,key:h.UI_CONFIG_HAS_VIEWED_SEARCH_TUTORIAL,value:!0}),e.save()},stopSearchTutorial:function(){this._searchTutorialComponentId&&(this._brokerManager.unloadComponent(this._searchTutorialComponentId),this._searchTutorialComponentId=null,this._searchTutorialMountPoint.remove())},getDisplayIconClassName:function(e){var i={iconClass:f.PAGE_ICON,componentIcon:t.icon("page")};switch(e){case I.SEARCH_FOR:i.iconClass=f.SEARCH_ICON,i.componentIcon=t.icon("mag-glass","-light")}return i},_parseBubbles:function(e){if(e=e.trim())return[e]},_updateOnFocus:function(){this._exploreSearchManager._onFocusSearchInput(),this._searchBubbles.length&&this.setSearchInputValue(this.filterSpecialTerms().join(" ")),this._updateAutoCompletion(),this._getSearchInputElement().select()},_isBrowsingKey:function(e){return-1!==A.indexOf(e)},_onKeyDown:function(e){var t=e.keyCode,i=this.getSearchInputValue();if(t===g.ENTER){var n=this._autoCompletionResults,s={};this._removeSearchBoxFocus(),n&&(n.user_query===i||this.isDefaultAutoCompleteShown)&&n.autocompletion_list&&n.autocompletion_list.length&&n.autocompletion_list[this.currentHighlightedItem]?(s.query=n.autocompletion_list[this.currentHighlightedItem][T.COMPLETE_QUERY],s.context=_defineProperty({query:s.query,source:o.TRIGGER_SOURCE.SEARCH_BOX,queryTermList:n.autocompletion_list[this.currentHighlightedItem].query_term_list},T.SEARCH_CONTEXT_HISTORY_OPERATION,o.SEARCH_CONTEXT_HISTORY_OP.RESET),this._exploreSearchManager.handleSearchInput(s)):(this._exploreSearchManager.setSearchContext({source:o.TRIGGER_SOURCE.USER_ENTER_BEFORE_RESULT}),this._exploreSearchManager._navigateToPageForQuery(i))}else if(this._isBrowsingKey(t)){var a=t===g.UP,r=this.currentHighlightedItem+(a?-1:1);this.highlightSuggestResult(this.$('.search-sgst-item[data-index="'+r+'"]'),!0),e.preventDefault()}else t===g.TAB&&this.selectedUserQuery&&(this.setSearchInputValue(this.selectedUserQuery),this._dbDoAutoCompletion(this.getSearchInputValue()),e.preventDefault())},_onInput:function(e){this._dbDoAutoCompletion(this.getSearchInputValue())},filterSpecialTerms:function(){return _.filter(this._searchBubbles,function(e){return!u.isDemarcationTerm(e)})||[]},_getSearchInputElement:function(){return this.$(C.INPUT)},_onFocus:function(){e.isSspOnlyUser()||this._isFocused()||(this.$el.addClass("focused"),this._updateOnFocus())},_isFocused:function(){return this.$el.hasClass("focused")},_onClickSearchBox:function(e){e.stopImmediatePropagation(),this._onFocus()},_onClearFilter:function(e){var t=$(e.target),i=t.data("original-text"),n=t.data("group-terms"),s=t.hasClass("group-clear"),a=this._exploreSearchManager.getSearchModel(),r=[],o=void 0;o=s&&n?n.split("|"):[i];var c=_.reject(a.getQueryTermList(),function(e,t){var i=-1!==o.indexOf(e.term);return i||r.push(e.term),i});e.stopPropagation(),l.showLoader();var u={userQuery:r.join(" "),explicitQuery:!0,queryTermList:c,generateAutoCompletionsOnly:!1};u.success=function(){l.hideLoader()},u.error=function(){l.hideLoader()},this._exploreSearchManager.search(u)},_onMouseDownSearchBox:function(){this._mousedownActivated=!0,this._bubbleGroup=this.$(C.SEARCH_BUBBLE)},_onMouseMoveSearchBox_:function(e,t){if(t._mousedownActivated){var i=e.pageX;t._bubbleGroup.each(function(){var e=$(this);e.offset().left+e.width()>i?e.addClass("selected"):e.removeClass("selected")})}},_removeSearchBoxFocus:function(){this._removeExpand(),this._renderSearchBubbles(),this.$(C.SEARCH_INPUT).blur()},_onClickFavStar:function(e){if(e.stopImmediatePropagation(),this._searchBubbles.length){var t=this.filterSpecialTerms().join(" ");this._exploreBookmarkManager.isBookmark(t)?this._exploreBookmarkManager.removeBookmark(t):this._exploreBookmarkManager.addBookmark(t,this.getPageQueryTermList(),this.getPageRoute())}},getPageRoute:function(){var e=this._exploreSearchManager.getNavigationManager().getCurrentPageRoute();if(e)return e.pageId===o.ROUTES.EBROWSER&&e.options&&e.options.entity_type?d.makeEBRoute(e.options.entity_type):e.subPageId?e.pageId+"/"+e.subPageId:e.pageId},getPageQueryTermList:function(){if(!this._exploreSearchManager.getNavigationManager().isCurrentPage(r.PAGE_SETTINGS))return this._exploreSearchManager.getPageQueryTermList()},_onMouseOverSearchBubble:function(e){var t=$(e.currentTarget);this.$(C.SEARCH_BUBBLE).removeClass("selected"),t.addClass("selected")},_onMouseOutSearchBubble:function(e){$(e.currentTarget).removeClass("selected")},_renderSearchBubbles:function(){var e=this._exploreSearchManager.getHTMLBubbles(this._searchBubbles);this.$(C.SEARCH_BUBBLES).empty().html(e),this.setSearchInputValue("")},_removeExpand:function(){var e=this,t=this.$(C.SEARCH_BOX),i=this._getWidthClasses().filter(function(e){return t.hasClass(e)}).join(" "),n=function(){t.css("width","").removeClass(i)};t.removeClass("showing-sgst"),this.$el.removeClass("focused");var s=this._getAutoWidth(t,i);s===t.outerWidth()?n():setTimeout(function(){t.one(e.transitionEvent,n).css("width",s)})},_addExpand:function(e){var t=this,i=this.$(C.SEARCH_BOX),n=i.outerWidth();i.css("width",n).addClass("showing-sgst"),this.$el.addClass("focused"),setTimeout(function(){i.removeClass(t._getWidthClasses().join(" ")).addClass(S.reduce(function(t,i){return e>i.minWidth?i.className:t},"")).css("width","")})},_getWidthClasses:function(){return S.map(function(e){return e.className})},_getAutoWidth:function(e,t){var i=e[0].style.width;e.addClass("no-animation").removeClass(t).css("width","");var n=e.outerWidth();return e.removeClass("no-animation").addClass(t).css("width",i),n},_updateSearchBubbles:function(e){this._searchBubbles=e,this._renderStarIcon()},_onClickSearchSuggestion:function(e){e.stopImmediatePropagation();var t=$(e.currentTarget),i=t.attr("data-search-query"),n=Number(t.attr("data-index")),s={query:i};this._updateSearchBubbles([]);var a=_.find(this._autoCompletionResults.autocompletion_list,function(e,t){return t===n});a&&(s.context=_defineProperty({query:i,source:o.TRIGGER_SOURCE.SEARCH_BOX,queryTermList:a.query_term_list},T.SEARCH_CONTEXT_HISTORY_OPERATION,o.SEARCH_CONTEXT_HISTORY_OP.RESET),this._exploreSearchManager.handleSearchInput(s),this._removeSearchBoxFocus())},_onMouseOverSearchSuggestion:function(e){var t=$(e.currentTarget);this.highlightSuggestResult(t)},highlightSuggestResult:function(e,t){if(e&&e.length){var i=e.data("index");this.currentHighlightedItem=i,t&&(this.selectedUserQuery=e.data("search-query")),this.$(C.SEARCH_SUGGESTION).removeClass("selected"),e.addClass("selected")}},_showLoader:function(){var e=this;setTimeout(function(){e.loadInProgress&&e.$(C.SEARCH_BOX).addClass("showing-loader")},500)},_hideLoader:function(){this.loadInProgress=!1,this.$(C.SEARCH_BOX).removeClass("showing-loader")},getDefaultAutoCompleteResult:function(){return{autocompletion_list:[u.getAutoCompleteQuery("Dashboard"),u.getAutoCompleteQuery("Search Guidelines")]}},_doAutoCompletion:function(e){var t=this;if(!e)return this.$(C.SEARCH_SUGGESTIONS).empty(),this._autoCompletionResults=this.getDefaultAutoCompleteResult(),this.isDefaultAutoCompleteShown=!0,void this._renderAutoCompletionResults();if(!this._exploreSearchManager.pageTransitionInProgress){this.loadInProgress=!0,this._showLoader();var i={userQuery:encodeURIComponent(e),explicitQuery:!0,generateAutoCompletionsOnly:!0};i.success=function(e){var i=e.toJSON();t.isDefaultAutoCompleteShown=!1,t._acResultsMatchQuery(i)&&(t._autoCompletionResults=i,t._renderAutoCompletionResults()),t._hideLoader()},i.error=function(){t._hideLoader()},this._exploreSearchManager.search(i)}},_acResultsMatchQuery:function(e){var t=!1;return e&&(t=e[T.USER_QUERY]===this.getSearchInputValue()),t},_renderAutoCompletionResults:function(){var e=this,t=this._autoCompletionResults,i=this.$(C.SEARCH_SUGGESTIONS).empty(),n=t&&t.autocompletion_list,s=this.getSearchInputValue();s.split(/\s+/);if(n&&n.length){var a=void 0;this._removeExpand(),_.each(n,function(t,n){var s=t.entity_type||"";t.search_type||(t.search_type=I.NAVIGATE_TO),t.search_type===I.SEARCH_FOR&&(s=e.i18n("search_in_prism"));var r=e.getDisplayIconClassName(t.search_type),o=a===t.search_type?"transparent":"",l=e.makeAutoCompletionBubbles(t),c=0===n?"selected":"";c&&(e.selectedUserQuery=t.complete_query),i.append(R(e.vtOptions({searchType:t.search_type,searchTypeDisplay:E(t.search_type),iconClass:r.iconClass,componentIcon:r.componentIcon,query:t.complete_query,category:s,clarifyText:t.clarifyText||"",transparent:o,autoCompletionBubbles:l,selected:c,index:n}))),a=t.search_type}),this.currentHighlightedItem=0,this._addExpand(i.width())}},_clearAutoCompletionResultsMaybe:function(){if(this._autoCompletionResults){this.getSearchInputValue()&&this._acResultsMatchQuery(this._autoCompletionResults)||(this._autoCompletionResults=null,this._renderAutoCompletionResults())}},_updateAutoCompletion:function(){var e=this.getSearchInputValue();e&&(this._acResultsMatchQuery(this._autoCompletionResults)?this._renderAutoCompletionResults():this._doAutoCompletion(e))},isBookmarkDisabled:function(){var e=["Dashboard"];return this._searchBubbles&&-1!==e.indexOf(this._searchBubbles[0])},_renderStarIcon:function(){if(this._searchBubbles.length&&!this.isBookmarkDisabled()){var e=this.filterSpecialTerms().join(" ");this._exploreBookmarkManager.isBookmark(e)?this.$(".search-box .icon-star").html(a.SVGIcon("Star")).attr("title","Remove Bookmark").removeClass("hide icon-star-empty"):this.$(".search-box .icon-star").html(a.SVGIcon("Star_Empty")).attr("title","Add Bookmark").addClass("icon-star-empty").removeClass("hide")}else this.$(".search-box .icon-star").addClass("hide")}})}),define("text!templates/explore/ExploreNavBubbles.html",[],function(){return'<% _.each(groups, function(group, index) { %>\n  <ul class="search-bubbles">\n    <% _.each(group.bubbles, function(bubble) { %>\n      <li class="search-bubble <%= bubble.showOnHover ? \'tooltip-filter\' : \'\' %>">\n        <div class="bubble-text" title="<%= bubble.text %>">\n          <span><%= AppUtil.truncateMiddle (bubble.text, 80) %></span>\n          <% if(bubble.clearable) { %>\n          <span class="clear-filter"\n            data-original-text=\'<%= bubble.actualText %>\'>\n            <%= Components.icon(\'v\') %>\n          </span>\n          <% } %>\n        </div>\n        <% if(bubble.showOnHover) { %>\n          <div class="more-filters">\n            <div class="transparent-gap-filler"></div>\n            <ul class="search-hidden-bubbles">\n                <li class="search-hidden-bubble">\n                  <span><%= bubble.actualText %></span>\n                </li>\n            </ul>\n          </div>\n        <% } %>\n      </li>\n    <% }) %>\n    <% if (group.hiddenBubbles.length) { %>\n      <li class="search-bubble hidden-bubbles">\n        <div class="bubble-text">\n          <span><%= group.filter_key %></span>\n          <span class="clear-filter group-clear"\n            data-group-terms=\'<%= group.filter_terms %>\'>\n            <%= Components.icon(\'v\') %>\n          </span>\n        </div>\n        <div class="more-filters">\n          <div class="transparent-gap-filler"></div>\n          <div class="filters-title"><%= filter_text %></div>\n          <ul class="search-hidden-bubbles">\n            <% _.each(group.hiddenBubbles, function(bubble, index) { %>\n              <li class="search-hidden-bubble">\n                <span><%= bubble.text %></span>\n                <% if(bubble.clearable) { %>\n                  <span class="clear-filter"\n                    data-original-text=\'<%= bubble.actualText %>\'>\n                    <%= Components.icon(\'v\') %>\n                  </span>\n                <% } %>\n              </li>\n            <% }) %>\n          </ul>\n        </div>\n      </li>\n    <% } %>\n  </ul>\n<% }) %>\n'}),define("managers/ExploreSearchManager",["data/DataProperties","data/ExploreDataProperties","managers/BaseManager","models/search/SearchModel","views/explore/ExploreSearchInputView","components/Components","utils/AppConstants","utils/ExploreConstants","utils/AppUtil","utils/TimeUtil","utils/ExploreSearchUtil","utils/ExploreNavigationUtil","text!templates/explore/ExploreNavBubbles.html"],function(e,t,i,n,s,a,r,o,l,c,u,d,h){"use strict";function p(e){var i=null;if(e&&e[t.PERSPECTIVES]){var n=e[t.PERSPECTIVES],s=_.filter(n,function(e){return Boolean(e.result_list)})[0];if(s&&s.type===T&&s[t.RESULT_LIST]&&s[t.RESULT_LIST].length){var a=s[t.RESULT_LIST][0];a&&a.type===T&&(i=a.entityType)}}return i}h=_.template(h);var T="EB";return i.extend({name:"ExploreSearchManager",_navigationManager:null,_explorePageView:null,_exploreMenuDataManager:null,_currentEbModel:null,_generateAutoCompletionsOnly:null,_pageQueryTermList:null,originalPageRoute:null,pageTransitionInProgress:!1,_searchContextHistoryStack:[],initialize:function(e){this._navigationManager=e.navigationManager,this._exploreMenuDataManager=e.exploreMenuDataManager,this._exploreBookmarkManager=e.exploreBookmarkManager,this._options=e,this._searchContext=null,this.model=new n,this.addToManagerHelper(this),require(["utils/EntityUtil"],this._setEntityUtil.bind(this))},addSearchInputListener:function(){this.exploreSearchInputView||(this.exploreSearchInputView=new s({el:$(".search-cnvg-qb-wrapper"),brokerManager:this.getBrokerManager(),exploreSearchManager:this,exploreBookmarkManager:this._exploreBookmarkManager})),this.exploreSearchInputView.addSearchInputListener(),this._searchBubblesToUpdate&&this.exploreSearchInputView.updateSearchBubbles(this._searchBubblesToUpdate)},removeSearchInputListener:function(){this.exploreSearchInputView.removeSearchInputListener()},updateRoute:function(e,t){var i=this._getSearchLabel(e);this.exploreSearchInputView&&!t?this.exploreSearchInputView.updateSearchBubbles(i):this._searchBubblesToUpdate=i},handleAppModelChange:function(){(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).pageId===r.PAGE_MC_DASHBOARD&&this.updateRoute("Dashboard")},handleSearchInput:function(e){var i=e.query,n=e.context;n[t.SEARCH_CONTEXT_HISTORY_OPERATION]||(n[t.SEARCH_CONTEXT_HISTORY_OPERATION]=o.SEARCH_CONTEXT_HISTORY_OP.PUSH),this.setSearchContext(n),this.originalPageRoute=this._navigationManager.getCurrentPageRoute();var s=this.constructNewPageRoute(i),a=this._navigationManager.formPageRouteUrl(s),r=window.location.hash;this._isSameUrl(a,r)?this.search({userQuery:i,generateAutoCompletionsOnly:!1}):this._navigateToPageForQuery(encodeURIComponent(i))},setSearchContext:function(e){this._searchContext=e},getSearchContext:function(){return this._searchContext},setExplorePageView:function(e){this._explorePageView=e},getExplorePageView:function(){return this._explorePageView},getExploreSearchResultsView:function(){return this._explorePageView&&this._explorePageView._searchResultsView},getSearchModel:function(){return this.model},getSearchResults:function(){return this.model.toJSON()},getPageQueryTermList:function(){return this._pageQueryTermList},setPageQueryTermList:function(e){this._pageQueryTermList=e},isSearchRoute:function(e){return e===o.ROUTES.SEARCH},search:function(){var i,n=this,s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};s.explicitQuery=s.explicitQuery||!1,s.generateAutoCompletionsOnly=!_.isBoolean(s.generateAutoCompletionsOnly)||s.generateAutoCompletionsOnly,s.queryTermList=s.queryTermList||[];var a={user_query:s.userQuery,explicit_query:s.explicitQuery,generate_autocompletions_only:s.generateAutoCompletionsOnly,query_term_list:s.queryTermList};a.user_query&&(a.user_query=decodeURIComponent(a.user_query)),s.queryContext&&(a[t.QUERY_CONTEXT]=s.queryContext),a.timezone=c.getGMTOffset(!0);var u=void 0,d=this.getSearchContext();if(d&&d.query&&a.user_query&&d.query.toLowerCase()===a.user_query.toLowerCase()&&!s.generateAutoCompletionsOnly&&(a.query_term_list=d.queryTermList,u=d[t.SEARCH_CONTEXT_HISTORY_OPERATION],d[t.QUERY_CONTEXT]&&(a[t.QUERY_CONTEXT]=d[t.QUERY_CONTEXT]),this.setSearchContext(null)),d)switch(d.source){case o.TRIGGER_SOURCE.SEARCH_BOX:a[t.IS_AUTOCOMPLETE_SELECTION]=!0,a[t.EXPLICIT_QUERY]=!0;break;case o.TRIGGER_SOURCE.USER_ENTER_BEFORE_RESULT:a[t.EXPLICIT_QUERY]=!0}var h=(i={},_defineProperty(i,e.SEARCH.ENTITY_TYPE,this.model.getEntityType()),_defineProperty(i,e.SEARCH.ENTITY_ID,this.model.getEntity()&&this.model.getEntity()[e.EB.ENTITY_ID]),_defineProperty(i,e.SEARCH.ENTITY_NAME,this.model.getEntity()&&this.model.getEntity()[e.EB.ENTITY_NAME]),_defineProperty(i,"isResultAmbiguous",this.model.isResultAmbiguous()),_defineProperty(i,"isPlainTextAmbiguousResult",this.model.isPlainTextAmbiguousResult()),i);this.model.clear({silent:!0}),this.model.set(a,{silent:!0}),this.model.save(null,{success:function(i){if(s.success&&s.success(i),!s.generateAutoCompletionsOnly){var a;n._updateSearchContextHistory(u,h,(a={},_defineProperty(a,e.SEARCH.ENTITY_TYPE,i.getEntityType()),_defineProperty(a,e.SEARCH.ENTITY_ID,i.getEntity()&&i.getEntity()[e.EB.ENTITY_ID]),a));var r=p(i.get(t.RESULT));if(r){var o=n._exploreMenuDataManager.getModel(r);n._currentEbModel=o,i.setSelectedEntityType(r)}if(n._updateUrlQueryParams(i,s.hasRouteUpdated),n.exploreSearchInputView){var l=i.getQueryTermList();n._pageQueryTermList=i.isPlainTextAmbiguousResult()?[]:l,
n.exploreSearchInputView.updateSearchBubbles(s.userQuery,i.isResultAmbiguous()?null:l)}n._explorePageView.handleSearchResults(i)}},error:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};s.error&&s.error(e);var i=l.processSerializedObject(t.responseText),a=n.i18n("error.data_fetch");i&&i.message_list&&i.message_list.length&&(a=i.message_list[0]&&i.message_list[0].message),n.getNotificationManager().showClientNotification(r.NOTIFY_ERROR,a)}})},applyBubblesFromQuery:function(e){var t=this._parseQuery(e);return this._parseAndApplyBubbles(t.bubblesString),t},onDetailPageUpdate:function(e,t){var i=t.actionTarget;if(u.isSearchSupportedEntityDetail(i)){var n=t.targetTabId.toLowerCase(),s=l.getPluralEntityName(i);-1!==e.indexOf(" ")&&(e='"'+e+'"');var a=s+" "+e+" "+n;this.exploreSearchInputView.updateSearchBubbles(a)}},clearSearchContextHistory:function(){this._searchContextHistoryStack=[]},peekSearchContextHistory:function(){return _.first(this._searchContextHistoryStack.slice(-1))},_setEntityUtil:function(e){this._EntityUtil=e},_getSearchLabel:function(e){return d.getStaticRouteToLabelMap()[e]||e||""},_navigateToPageForQuery:function(e){this.setPageNavigationInProgress(!0),e&&this._navigationManager.navigateToPage(o.ROUTES.EXPLORE,o.ROUTES.SEARCH+"/"+e)},setPageNavigationInProgress:function(e){this.pageTransitionInProgress=e},_isSameUrl:function(e,t){return e=e.toLowerCase(),e=e.replace("/?",""),t=t.replace("#",""),(t=decodeURIComponent(t).toLowerCase())===e},constructNewPageRoute:function(e){var t={};return t[r.NAV_PAGE_ID]=o.ROUTES.EXPLORE,t[r.NAV_SUBPAGE_ID]=o.ROUTES.SEARCH+"/"+e,t[r.NAV_OPTIONS]={},t},_updateSearchContextHistory:function(t,i,n){if((!_.isEmpty(this.getPageQueryTermList())||i.isResultAmbiguous)&&(!i||i.entityId||i.entityType||!1!==i.isPlainTextAmbiguousResult||!1!==i.isResultAmbiguous)&&(t||i.isResultAmbiguous||i[e.SEARCH.ENTITY_TYPE])&&(i[e.SEARCH.ENTITY_TYPE]!==n[e.SEARCH.ENTITY_TYPE]||i[e.SEARCH.ENTITY_ID]!==n[e.SEARCH.ENTITY_ID])){var s=this.peekSearchContextHistory();switch(!t&&s&&s.lastSearch[e.SEARCH.ENTITY_TYPE]===n[e.SEARCH.ENTITY_TYPE]&&s.lastSearch[e.SEARCH.ENTITY_ID]===n[e.SEARCH.ENTITY_ID]&&(t=o.SEARCH_CONTEXT_HISTORY_OP.POP),t){case o.SEARCH_CONTEXT_HISTORY_OP.RESET:this.clearSearchContextHistory();break;case o.SEARCH_CONTEXT_HISTORY_OP.POP:this._searchContextHistoryStack.pop();break;case o.SEARCH_CONTEXT_HISTORY_OP.PUSH:var a="";this.originalPageRoute&&this.originalPageRoute.subPageId&&(a=decodeURIComponent(this.originalPageRoute.subPageId)),this._searchContextHistoryStack.push({queryTermList:i.isPlainTextAmbiguousResult?[]:this.getPageQueryTermList(),userTerm:a,lastSearch:i})}var r=this.getExploreSearchResultsView();r&&r.updateBackLink()}},_updateUrlQueryParams:function(e,t){if(!e.hasNoResult()&&!e.isPlainTextAmbiguousResult()){var i=e.getActivePerspective(),n=u.getPerspectiveResult(i);if(n.type!==o.PERSPECTIVE_TYPES.ENTITY_INSTANCE_DETAIL&&n.type!==o.PERSPECTIVE_TYPES.NAVIGATION){var s=this._mergeSearchQueryParams(e,l.getHashParameters());this._navigationManager.updatePageQueryParams(l.formatObjectToQuery(s),{replaceUrl:t})}}},_mergeSearchQueryParams:function(e,t){var i=d.formQueryParamsFromQueryTermList(e.getQueryTermList()),n={};return _.each(t,function(e,t){t.match("^"+o.URL_QUERY_TERM_KEY_PREFIX)||(n[t]=e)}),_.extend(n,i)},_onFocusSearchInput:function(){this._options.onFocusSearchInputCallback&&this._options.onFocusSearchInputCallback()},_formatArray:function(e){var t=[];return e.reduce(function(e,i,n,s){return u.isDemarcationTerm(i)?(e.push(t),t=[]):(t.push(i),n===s.length-1&&e.push(t)),e},[])},getBubbleDisplayItem:function(t){var i=this.getQueryTermFromText(t),n=t,s=!1;if(i){switch((u.getDisplayContext(i)||{}).property_name){case e.EB.CREATED_TIMESTAMP_USECS:n=this.i18n("time_range"),s=!0}}return{displayText:u.stripQuotes(n),showOnHover:s}},getQueryTermFromText:function(e){return _.find(this.getPageQueryTermList(),function(t){return t.term===e})},_processBubbles:function(e){var t=this,i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._formatArray(e||[]).map(function(e,n,s){var a=0===n;return e.reduce(function(n,r,o){var l="bubbles",c=a&&s[1]&&e.length>2&&o>=1,u=!a&&o>3,d=1===s.length&&o>3;!i&&(c||u||d)&&(l="hiddenBubbles");var h=t.getBubbleDisplayItem(r)||{};return n[l].push({text:h.displayText,showOnHover:h.showOnHover,actualText:r,clearable:0!==o}),n},{bubbles:[],hiddenBubbles:[]})})},getBubbleGroups:function(e){var t=this;return this._processBubbles(e).map(function(e,i){var n="filter_group"+(i>0?"_more":"")+(e.hiddenBubbles.length>1?"_plural":"");return e.filter_key=t.i18ns(n,e.hiddenBubbles.length),e.filter_terms=_.map(e.hiddenBubbles,function(e){return e.actualText}).join("|"),e})},getHTMLBubbles:function(e){return h({filter_text:this.i18n("filters"),Components:a,AppUtil:l,groups:this.getBubbleGroups(e)})}})}),define("models/search/FavoriteModel",["models/BaseModel","data/DataURLConstants"],function(e,t){"use strict";var i={COMPLETE_QUERY:"complete_query",QUERY_TERM_LIST:"query_term_list",UUID:"uuid",ROUTE:"route"};return e.extend({name:"FavoriteModel",urlRoot:t.FAVORITE,idAttribute:i.UUID,DP:i,isV3API:!0,enableNotifications:!1,getURL:function(){return this.url()}})}),define("models/search/FavoriteCollection",["models/search/FavoriteModel","models/BaseCollection","utils/AppConstants","data/DataURLConstants"],function(e,t,i,n){"use strict";return t.extend({model:e,name:"FavoriteCollection",url:n.FAVORITE,isV3API:!0,parse:function(e){return e&&e.favourite_query_list||[]},getQueryModel:function(e){return _.find(this.models,function(t){return t.get(t.DP.COMPLETE_QUERY)===e})},addAndSaveQuery:function(e,t,i,n){n=_.extend({},n,{wait:!0});var s={complete_query:e,query_term_list:t};t||(s.route=i),this.create(s,n)},deleteQuery:function(t,n){var s=this.getQueryModel(t);if(this.remove(s),s){var a=s.get(s.DP.UUID),r=new e;r.actionMode=i.ACTION_DELETE,r.set(r.idAttribute,a),r.destroy(n)}}})}),define("managers/ExploreBookmarkManager",["models/search/FavoriteCollection"],function(e){"use strict";return _.extend({EVENT_UPDATE:"update",initialize:function(){var t=this;this._bookmarks=[],this._favoriteCollection=new e,this._favoriteCollection.on("add",function(){t.fetchSearchFavoriteCollection()}),this._favoriteCollection.on("remove",function(){t.fetchSearchFavoriteCollection()})},getBookmarks:function(){return this._bookmarks},isBookmark:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return!!_.find(this._bookmarks,function(t){return t.query&&e.toLowerCase()===t.query.toLowerCase()})},getBookmarkByQuery:function(e){return _.find(this._bookmarks,function(t){return t.query===e})},addBookmark:function(e,t,i){this._favoriteCollection.addAndSaveQuery(e,t,i)},removeBookmark:function(e){var t=this;this._favoriteCollection.deleteQuery(e,{success:function(){t.fetchSearchFavoriteCollection()}})},fetchSearchFavoriteCollection:function(){var e=this,t=this._favoriteCollection.fetch();t&&t.then(function(){e._onSearchFavoriteCollectionUpdate()})},_onSearchFavoriteCollectionUpdate:function(){this._bookmarks=this._favoriteCollection.map(function(e,t){return{query:e.get(e.DP.COMPLETE_QUERY),queryTermList:e.get(e.DP.QUERY_TERM_LIST),id:e.get(e.DP.UUID),route:e.get(e.DP.ROUTE)}}),this.trigger(this.EVENT_UPDATE)}},Backbone.Events)}),define("utils/ZoneUtil",["utils/AppConstants","data/DataProperties"],function(e,t){"use strict";return{isLocal:function(t){return this._checkZoneType(t,e.ZONE_TYPE.LOCAL)},isExternal:function(e){return this.isRemote(e)||this.isXi(e)},isRemote:function(t){return this._checkZoneType(t,e.ZONE_TYPE.REMOTE)},isXi:function(t){return this._checkZoneType(t,e.ZONE_TYPE.XI)},_checkZoneType:function(e,i){return!!e&&(_.isFunction(e.get)?e.get(t.EB.VM.ZONE_TYPE)===i:e[t.EB.VM.ZONE_TYPE]===i)}}}),define("managers/ExploreManager",["managers/NamespaceManager","managers/ExploreMenuDataManager","managers/ExploreSearchManager","managers/ExploreBookmarkManager","managers/ActionManager","managers/BaseManager","models/ebrowser/filters/EBFilterModel","utils/AppConstants","utils/AppUtil","utils/ZoneUtil","utils/ExploreConstants","utils/ExploreNavigationUtil","utils/ExploreSearchUtil","data/DataURLConstants","data/DataProperties","events/AppEvents"],function(e,t,i,n,s,a,r,o,l,c,u,d,h,p,T,E){"use strict";function S(e,t){if(this.get(this.DP.ATTRIBUTE)===e){var i=this.getFilterCondition();return i.op===t.op&&(h.caseInSensitiveMatch(i.value1,t.value1)&&h.caseInSensitiveMatch(i.value2,t.value2)||h.caseInSensitiveMatch(i.value1,t.displayFilterValue))}return!1}var g={EXPLORE_CLASS:"explore",SHOW_SEARCH_HEADER_CLASS:"-show-search-header",SHOW_LEFT_MENU_CLASS:"-show-left-menu",REVEAL_CLASS:"reveal",BODY:"body"},A={NO_REWRITE_ROUTES:["logout","login"]};return a.extend({name:o.MANAGER.EXPLORE,_navigationManager:null,_ebrowserView:null,_exploreNavMenuView:null,_entityType:null,_inExplorePage:!1,_initialized:!1,_isAppEnvSet:!1,_ebListenerAdded:!1,_ebFetchDone:!1,initialize:function(){this._initialized||(this.addToManagerHelper(),this._initialized=!0)},initializeExploreSearchManager:function(){var e=this;this._isAppEnvSet=!0,this.isEnableSearchConvergence()&&(r.prototype.isFilterForCondition=S,this._navigationManager=this.getNavigationManager(),i.initialize({navigationManager:this._navigationManager,exploreMenuDataManager:t,exploreBookmarkManager:n,onFocusSearchInputCallback:function(){e._exploreNavMenuView&&e._exploreNavMenuView.hide()}}))},initializeViews:function(){this.isEnableSearchConvergence()&&(this._addExploreCssClasses(),n.initialize(),setTimeout(this._initializeExploreMenuView.bind(this)))},isMulticlusterNavMode:function(){var e=window.location.href&&window.location.href.substr(window.location.href.indexOf("?")),t=l.parseQueryToObject(e);return!t||!t[p.CLUSTER_ID]},isEnableSearchConvergence:function(){if(!this._initialized)return!1;if(void 0===this._enableSearchConvergence){var e=this.getAppManager();e.getEnvironmentMode()===e.ENV_MODE.PC&&this.isMulticlusterNavMode()?this._enableSearchConvergence="false"!==l.getLocalStorageProperty(o.LOCAL_STORAGE.SEARCH_CONVERGENCE):this._enableSearchConvergence=!1}return this._enableSearchConvergence},showPage:function(e,t,i,n){!this._isAppEnvSet||this.isEnableSearchConvergence()?this.showExplorePage(e,t,i,n):this.renderUnsupportedPage()},showExplorePage:function(e,t,i,n){var a=t||u.ROUTES.EXPLORE,r=i,c=!1,h=d.getStaticRouteToPageIdMap()[a],p=t.split("?");if(p&&p[0]===o.ROUTE_ACTION){var _=l.parseQueryToObject(p[1]);return void(_&&_[o.NAV_ACTION]===o.ACTION_DETAILS?this._navigationManager.navigateToFullScreenDetailsPane(_[o.NAV_ACTION_TARGET],_[o.NAV_ACTION_TARGET_ID]):s.executeAction(_))}if(a===u.ROUTES.EBROWSER?r=u.ROUTES.ENTITIES:a=h||a,this._enterExplorePage(),t===u.ROUTES.SEARCH)n=n||{},n.hasRouteUpdated=!0,e.showPage(u.ROUTES.EXPLORE,r,n);else{if(-1!==a.indexOf(" ")&&!r){var T=a.split(/\s+/);T.length>1&&(a=T[0],r=T[1],c=!0)}e.showPage(a,r,n)}c?this._onRouteChange(a,r,n):this._onRouteChange.apply(this,Array.prototype.slice.call(arguments,1))},renderUnsupportedPage:function(){e.get(e.APP_VIEW).renderPageAccessDenied()},beforeRenderPageView:function(e,t){this.isEnableSearchConvergence()&&e&&0===e.indexOf(u.ROUTES.EBROWSER)&&(this._ebrowserView=t,this._ebListenerAdded||(this._ebListenerAdded=!0,t.model.on(t.model.CHANGE_EVENTS.REFRESH_DATA,this._ebRefreshDataCallback.bind(this))),this._entityType&&this._ebFetchDone&&(this._ebrowserView.model.setSelectedEntityType(this._entityType),this._entityType=null))},beforeNavigateToRoute:function(e){if(!1===this.isEnableSearchConvergence())return e;var t=this.getAccessManager(),i=e,n="",s=e.indexOf("?");if(-1!==s&&(i=e.substring(0,s),n=e.substring(s)),-1!==A.NO_REWRITE_ROUTES.indexOf(i)||t&&t.isSspOnlyUser())return e;this._enterExplorePage();var a=e.match(u.ROUTES.EXPLORE_PAGE+"/(.*)"),r=a&&a[1]&&a[1].split("/"),o=r&&r[0];if(a&&o&&-1===u.EXPLORE_SUBPAGES.indexOf(o)&&(e=u.ROUTES.EXPLORE_PAGE+"/"+u.ROUTES.SEARCH+"/"+a[1]),0!==e.indexOf(u.ROUTES.EXPLORE_PAGE)){var c=Backbone.history.fragment&&0===Backbone.history.fragment.indexOf(u.ROUTES.EXPLORE_PAGE),p=0===e.indexOf(u.ROUTES.PAGE_PREFIX);if(c||p){var _=e.indexOf("/"),T=e.substring(_+1),E=T.indexOf("?"),S=-1!==E,g=S?T.substring(0,E):T,m=d.getPageIdToStaticRouteMap(),f=void 0;f=-1!==g.indexOf("/")?g.substring(0,g.indexOf("/")):g;var I=m[f];if(c&&(I=I||g),I)e=u.ROUTES.EXPLORE_PAGE+"/"+g,S&&(e+=T.substring(E));else if(e===u.ROUTES.EBROWSER_ENTITIES_PAGE&&this._ebrowserView){var C=this.getEBViewEntityType();e=[u.ROUTES.EXPLORE_PAGE,u.ROUTES.EBROWSER,h.getSubRouteForEntity(C)].join("/")}else-1!==i.indexOf(u.ROUTES.EBROWSER_PAGE)?e=u.ROUTES.EXPLORE_PAGE+"/"+u.ROUTES.EBROWSER+"/"+n:l.log("ExploreManager.beforeNavigateToRoute: don't know how to handle url: "+e)}}return e},isEBPageForSupportedEntity:function(e,t,i){if(!this.isEnableSearchConvergence())return!1;if((e===u.ROUTES.EBROWSER||e===o.PAGE_ALERT_EXPLORER)&&i){var n=l.parseQueryToObject(i);if(n&&n.contextId){var s=this._navigationManager.getNavigationContext(n.contextId);if(s&&s.entityType&&h.isSearchSupportedEntityType(s.entityType))return s.entityType}}return!1},beforeReplaceFullScreenDetailsRoute:function(e){if(this.isEnableSearchConvergence()){var t=$("#containerDetails"),n=!1;if(e&&"alert"!==e.actionTarget&&e.contextId){var s=e.contextId,a=this._navigationManager.getNavigationContext(s);if(a){var r=a.options&&a.options.entities;if(r){var o=_.find(r,function(t){return t.id===e.actionTargetId});if(o){var l=o.getName();l&&(i.onDetailPageUpdate(l,e),n=!0)}}}}n?$("#containerFluid").addClass(g.REVEAL_CLASS):(t.removeClass(g.SHOW_SEARCH_HEADER_CLASS),$("#containerFluid").removeClass(g.REVEAL_CLASS))}},filterDefaultPageList:function(e){return this.isEnableSearchConvergence()&&(e=[]),e},handleLinkHijacking:function(e,t,n,s,a){if(this.isEnableSearchConvergence()){if(n){var r=this._navigationManager.getNavigationContext(n);if(r&&r.options&&r.options.entities){var o=_.find(r.options.entities,function(e){return e.get(T.ID)===t});if(o&&c.isExternal(o))return!1}}if(e&&t){if(h.isSearchSupportedEntityDetail(e)){var l=(h.getQueryEntityType(e),h.getEntityNameAttr(e),h.makeQueryTermListForEntityInstance(e,t,"entity_instance",s));return i.handleSearchInput({query:"entity_instance",context:{query:"entity_instance",queryTermList:l}}),!0}}}return!1},getEBViewEntityType:function(){return this._ebrowserView&&this._ebrowserView.model.getSelectedEntityType()},_setAppViewRenderedCallback:function(t){e.get(e.APP_VIEW)[t](E.APP_VIEW_IS_RENDERED,this._appViewIsRenderedCallback,this)},_initializeExploreMenuView:function(){this._setAppViewRenderedCallback("on")},_appViewIsRenderedCallback:function(){if(!this._appViewIsRendered){this._setAppViewRenderedCallback("off"),this.isEnableSearchConvergence()&&$(".explore-remove").remove(),this._appViewIsRendered=!0}},_onRouteChange:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=e;if(s===u.ROUTES.EBROWSER)if(t)s=s+"/"+t;else if(n.entity_type)s=s+"/"+h.getSubRouteForEntity(n.entity_type);else if(n.contextId){var a=this._navigationManager.getNavigationContext(n.contextId);a&&a.entityType&&(s=s+"/"+h.getSubRouteForEntity(a.entityType))}if(s===u.ROUTES.SETTINGS&&t&&(s=s+" "+t),this._isStaticRoute(s)&&i.updateRoute(s),i.isSearchRoute(s)){var r=0;this._firstRouteChangeDone||(this._firstRouteChangeDone=!0,r=1e3),setTimeout(function(){i.updateRoute(t,!0)},r)}if(e===u.ROUTES.EBROWSER){var o=t&&h.getEntityForSubroute(t);if(o)if(this._ebrowserView&&this._ebFetchDone){var l=this._ebrowserView.model.getSelectedEntityType()===o;if(l)this._ebrowserView.model.refreshCurrentQuery(o);else{var c=this._ebrowserView.model.get("selectedPerspectiveMap"),d=c&&c[o];this._ebrowserView.model.setSelectedEntityType(o),d&&this._ebrowserView.model.refreshCurrentQuery(o)}}else this._entityType=o}},_isStaticRoute:function(e){return!(!d.getStaticRouteMap()[e]&&e)||!(!e||e!==u.ROUTES.SETTINGS)},_enterExplorePage:function(){this._appViewIsRendered&&(this._inExplorePage||(this._inExplorePage=!0,this._addExploreCssClasses(),i.addSearchInputListener()))},_exitExplorePage:function(){this._appViewIsRendered&&this._inExplorePage&&(this._inExplorePage=!1,i.removeSearchInputListener())},_addExploreCssClasses:function(){$(g.BODY).addClass(g.EXPLORE_CLASS)},_removeExploreCssClasses:function(){$(g.BODY).removeClass(g.EXPLORE_CLASS)},_ebRefreshDataCallback:function(){this._ebFetchDone=!0,this._entityType&&(this._ebrowserView.model.setSelectedEntityType(this._entityType),this._entityType=null)}})}),define("managers/NavigationManager",["managers/NamespaceManager","managers/PrismElementManager","managers/ExploreManager","managers/ExploreSearchManager","managers/BaseManager","broker/managers/BrokerManager","data/DataProperties","data/ExploreDataProperties","data/DataURLConstants","utils/AppConstants","utils/ExploreConstants","utils/ExploreSearchUtil","utils/ExploreNavigationUtil","utils/FilterUtil","utils/AlertUtil","utils/AppUtil"],function(e,t,i,n,s,a,r,o,l,c,u,d,h,p,T,E){"use strict";var S=_.template('details?action=details&actionTargetId=<%= encodeURIComponent(actionTargetId) %>&actionTarget=<%= actionTarget %><%= typeof contextId !== "undefined" ? "&contextId="+contextId : "" %><%= typeof targetTabId !== "undefined" ? "&targetTabId="+targetTabId : "" %>');return s.extend({name:"NavigationManager",navigationContexts:{},initialize:function(){this.addToManagerHelper(this)},navigateToPageRouteObject:function(e,t){var i,n,s;e&&(i=e[c.NAV_PAGE_ID],n=e[c.NAV_SUBPAGE_ID],s=e[c.NAV_OPTIONS]),this.navigateToPage(i,n,s,t)},navigateToPage:function(t,s,a,r){if(this.getClusterManager().isMulticlusterUI()){var p=E.parseQueryToObject(a)||{};if(!r){var _=this.getClusterManager().getClusterIdFromPageRoute();_&&_!==c.MULTICLUSTER_CLUSTER_ID?p[l.CLUSTER_ID]=this.getClusterManager().getClusterIdFromPageRoute():delete p[l.CLUSTER_ID]}a=E.formatObjectToQuery(p)||void 0}var T=i.isEBPageForSupportedEntity(t,s,a);if(T){var S=d.getQueryContext(T,u.CONTEXT_VALUES.LIST),g=E.parseQueryToObject(a)||{},A=this.getNavigationContext(g.contextId)||{},m=E.get(A,"options.filter_expression"),f=E.get(A,"options.filter_join_operators");if(m){var I=d.generateQueryTermFromFilterExpressions(T,m);S.queryTermList=S.queryTermList.concat(I)}return f&&(S[o.QUERY_CONTEXT]=u.QUERY_CONTEXT.LOGICAL_AND),S[o.SEARCH_CONTEXT_HISTORY_OPERATION]=u.SEARCH_CONTEXT_HISTORY_OP.RESET,n.setSearchContext(S),void this.navigateToPage(u.ROUTES.EXPLORE,h.makeEBRoute(T),a)}var C={};C[c.NAV_PAGE_ID]=t,C[c.NAV_SUBPAGE_ID]=s,C[c.NAV_OPTIONS]=a,e.set(e.PAGE_ROUTE,C);var v=this.formPageRouteUrl(C);this.navigateToRoute(v)},formPageRouteUrl:function(e){var t,i,n;return e=e||{},t=_.isString(e[c.NAV_PAGE_ID])?"page/"+e[c.NAV_PAGE_ID]:"",i=_.isString(e[c.NAV_SUBPAGE_ID])?"/"+e[c.NAV_SUBPAGE_ID]:"",n=this.getOptionString(e),t+i+n},getOptionString:function(e){var t=e[c.NAV_OPTIONS],i=void 0,n=void 0;return _.isString(t)?(n=E.parseQueryToObject(t),i=t):_.isObject(t)&&(n=t,i=E.formatObjectToQuery(t)),n&&n[c.NAV_CUSTOM_URL]?n[c.NAV_CUSTOM_URL]:i?"/?"+i:""},formActionRouteUrl:function(e){var t=E.formatObjectToQuery(e);return l.EXECUTE_ACTION({options:t})},canUseActionRoute:function(e){var t=this.getClusterManager().getCurrentClusterModel(),i=t.getNosVersion(),n=e[c.NAV_ACTION]&&e[c.NAV_ACTION_TARGET]&&(t.isCurrentClusterEVersion()||i>=c.ACTION_MANAGER_VERSION);return e[c.NAV_ACTION]===c.ACTION_DETAILS&&(n=!1),n},navigateToPageByElement:function(e,t,i){var n=this.formOptionsFromElement(i);this.navigateToPage(e,t,n)},navigateToPageByObject:function(e,t,i){var n=this.formOptionsFromObject(i);this.navigateToPage(e,t,n)},navigateToSubPageByElement:function(e,t){var i=this.getCurrentPageRoute()[c.NAV_PAGE_ID];this.navigateToPageByElement(i,e,t)},navigateToRoute:function(e){e=i.beforeNavigateToRoute(e),a.canSubappUnload(e).then(function(i){if(i){if(t.isLoadedFromPrismCentral())return void t.updatePrismCentralRoute(e);Backbone.history.fragment===e?Backbone.history.loadUrl(Backbone.history.fragment):Backbone.history.navigate(e,{trigger:!0,replace:!1})}return i})},navigateToPageByPageLink:function(e){var t=$(e).attr(c.NAV_PAGE_ID),i=$(e).attr(c.NAV_SUBPAGE_ID),n=this.formOptionsFromElement(e);this.navigateToPage(t,i,n)},navigateToPageByNavObject:function(e){this.navigateToPage(e.page,e.subPage,this.formOptionsFromObject(e))},executeDownloadAction:function(e,t){var i,n=!1,s=this.getDataManager();switch(e){case c.FILE_NCLI:i=c.NCLI_FILE_NAME,n=!0;break;case c.FILE_NUTANIX_MIB:i=c.NUTANIX_MIB_FILE_NAME,n=!0;break;case c.FILE_LICENSE:i=s.getDataSourceURL()+c.NUTANIX_CLUSTER_INFO_FILE;break;case c.FILE_CMDLETS_MSI:i=c.NUTANIX_CMDLETS_FILE_NAME,n=!0;break;case c.FILE_ENCRYPTION_CSR:i=s.getDataSourceURL()+c.ENCRYPTION_CSRS,t&&(i+="?nodeIdList="+t);break;case c.FILE_ENCRYPTION_EXPAND_CLUSTER_CSR:i=s.getDataSourceURL()+c.ENCRYPTION_EC_CSRS,t&&(i+="?nodeIp="+t);break;case c.FILE_PHOENIX_IMAGE:i=t[c.NAV_ACTION_TARGET_ID];break;case c.ENTITY_NETWORK_SECURITY_RULE:i=l.EXPORT_SECURITY_POLICY;break;case c.ENTITY_OVA:i=E.sprintf(l.OVA_DOWNLOAD,t.actionTargetId),n=!0}n||(i=s.appendSingleClusterProxyParam(i)),this.navigateToURL(i)},updateRouteOption:function(t,i,n){var s=this.formOptionsFromElement(t),a=e.get(e.PAGE_ROUTE);this.navigateToPage(i||a[c.NAV_PAGE_ID],n||a[c.NAV_SUBPAGE_ID],s)},showDetailsSummary:function(t){var i=c.NAV_ACTION+"="+c.ACTION_DETAILS+"&"+c.NAV_ACTION_TARGET_ID+"="+c.ACTION_SUMMARY,n=t&&t[c.NAV_ACTION_TARGET];n&&(i+="&"+c.NAV_ACTION_TARGET+"="+n);var s=e.get(e.PAGE_ROUTE);this.navigateToPage(s[c.NAV_PAGE_ID],s[c.NAV_SUBPAGE_ID],i)},formOptionsFromElement:function(e){var t="",i=c.NAV_ACTION,n=c.NAV_ACTION_TARGET_ID,s=c.NAV_ACTION_TARGET_NAME,a=c.NAV_ACTION_TARGET,r=c.NAV_ACTION_SPOTLIGHT,o=c.NAV_ACTION_SOURCE,l=c.NAV_ACTION_PARENT_ENTITY_TYPE,u=c.NAV_ACTION_PARENT_ID;return t+=$(e).attr(i)?i+"="+$(e).attr(i)+"&":"",t+=$(e).attr(n)?n+"="+encodeURIComponent($(e).attr(n))+"&":"",t+=$(e).attr(s)?s+"="+encodeURIComponent($(e).attr(s))+"&":"",t+=$(e).attr(l)?l+"="+encodeURIComponent($(e).attr(l))+"&":"",t+=$(e).attr(u)?u+"="+encodeURIComponent($(e).attr(u))+"&":"",t+=$(e).attr(r)?r+"="+encodeURIComponent($(e).attr(r))+"&":"",t+=$(e).attr(o)?o+"="+encodeURIComponent($(e).attr(o))+"&":"",t+=$(e).attr(a)?a+"="+$(e).attr(a):"","&"===t[t.length-1]&&(t=t.substring(0,t.length-1)),t},formOptionsFromObject:function(e){var t="",i=c.NAV_ACTION,n=c.NAV_ACTION_TARGET_ID,s=c.NAV_ACTION_TARGET_NAME,a=c.NAV_ACTION_TARGET,r=c.NAV_ACTION_SPOTLIGHT,o=c.NAV_ACTION_SOURCE;return t+=e[i]?i+"="+e[i]+"&":"",t+=e[n]?n+"="+encodeURIComponent(e[n])+"&":"",t+=e[s]?s+"="+encodeURIComponent(e[s])+"&":"",t+=e[r]?r+"="+encodeURIComponent(e[r])+"&":"",t+=e[o]?o+"="+encodeURIComponent(e[o])+"&":"",t+=e[a]?a+"="+e[a]:""},getCurrentPageRoute:function(){return e.get(e.PAGE_ROUTE)},isCurrentPage:function(e){var t=this.getCurrentPageRoute();return t&&t.pageId===e},updateGlobalPageRoute:function(t,i,n){var s=e.get(e.PAGE_ROUTE);t&&(s[c.NAV_PAGE_ID]=t),i?s[c.NAV_SUBPAGE_ID]=i:_.isNull(i)&&delete s[c.NAV_SUBPAGE_ID],n&&(s[c.NAV_OPTIONS]=n),e.set(e.PAGE_ROUTE,s)},navigateToURL:function(e,t,i){t=void 0===t||t;var n=[];_.map(i,function(e,t){n.push(t+"="+e)}),window.open(e,t?"_blank":"_self",n.join(","))},refreshToBaseURL:function(e){if(window.location.href.split("#")[0]){var t=window.location.href.split("#")[0],i=e?"?"+e:"";window.location.href=t+i}},getBaseUrl:function(){if(_.isString(window.location.href))return window.location.href.match(/^([^?#]*)/)[0]},refreshToURL:function(e){var t=this.getBaseUrl();if(t){var i=t+(_.isString(e)?"#"+e:"");window.location.href=i,window.location.reload()}},refreshToPage:function(e){var t=this.formPageRouteUrl(_defineProperty({},c.NAV_PAGE_ID,e));this.refreshToURL(t)},clearQueryStringParams:function(){var e,t,i=window.location.href,n=i.split("#");if(window.history.replaceState){if(!(n.length>1))return void E.log("NavigationManager: clearQueryStringParams: Issue parsing base url for url "+i);if(n[0],e=n[1].split("?"),!e.length)return void E.log("NavigationManager: clearQueryStringParams: Issue parsing path url for url "+i);t="#"+e[0];var s=E.getHashParameters(),a="";s&&s[l.CLUSTER_ID]&&(a="?"+l.CLUSTER_ID+"="+s[l.CLUSTER_ID]),window.history.replaceState({},E.getPageTitle(),t+a)}},updatePageQueryParams:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=Backbone.history.fragment,s=n&&n.indexOf("/?")>=0,a=s&&n.indexOf("/?");if((s?n.substring(a):"")!==t){var r=s?n.substring(0,a):n;Backbone.history.navigate("#"+r+"/?"+t,{trigger:!1,replace:Boolean(i.replaceUrl)});var o=this.getCurrentPageRoute();o[c.NAV_OPTIONS]=E.parseQueryToObject(t),e.set(e.PAGE_ROUTE,o)}},navigateToFullScreenDetailsPane:function(e,t,n,s,a){if(!i.handleLinkHijacking(e,t,n,s,a)){void 0===this.getNavigationContext(n)&&(n=this.createNavigationContext(e,{}));var r=S({actionTargetId:t,actionTarget:e,contextId:n,targetTabId:s||this._getDefaultTabId(e)});Backbone.history.navigate(r,{trigger:!0,replace:a})}},navigateToEBPage:function(e,t,i,n,s){var a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{};s||!i||_.isUndefined(n)||(s={},s=p.addFilterCondition(s,i,p.createFilterCondition(e,i,c.FILTER_OPERATORS.CONTAINS,n)));var r=this.createNavigationContext(e,{entity_type:e,filter_expression:_.isEmpty(s)?null:s,perspective:t,action:a.action,actionTargetId:a.actionTargetId});this.navigateToPage(c.PAGE_ENTITY_BROWSER,null,{contextId:r})},categoriesSearch:function(e,t){var i={};i=p.addFilterCondition(i,r.EB.CATEGORIES,p.createFilterCondition(e,r.EB.CATEGORIES,c.FILTER_OPERATORS.CATEGORY_EQUALS,t));var n=this.createNavigationContext(e,{entity_type:e,filter_expression:i});this.navigateToPage(c.PAGE_ENTITY_BROWSER,null,{contextId:n})},navigateToAlertsPage:function(e,t,i,n){var s={};e&&T.setAlertImpactTypeFilter(s,e),n&&T.setAlertSeverityFilter(s,n.toLowerCase()),this._setAlertOrEventEntityFilter(s,t,i,c.ENTITY_ALERT),T.setAlertResolvedFilter(s,!1);var a=this.createNavigationContext(c.ENTITY_ALERT,{filter_expression:s}),r={contextId:a};this.navigateToPage(c.PAGE_ALERT_EXPLORER,null,r)},navigateToEventsPage:function(e,t,i){var n={};e&&T.setClassificationFilter(n,e,c.ENTITY_EVENT),this._setAlertOrEventEntityFilter(n,t,i,c.ENTITY_EVENT);var s=Date.now()-1*c.MILLIS_PER_DAY;T.setTimeRangeFilter(n,s,null,c.ENTITY_EVENT);var a=this.createNavigationContext(c.ENTITY_EVENT,{filter_expression:n}),r={contextId:a};this.navigateToPage(c.PAGE_ALERT_EXPLORER,null,r)},_setAlertOrEventEntityFilter:function(e,t,i,n){if(t&&i===c.ENTITY_CLUSTER){var s=this.getClusterManager().getNameById(t);s!==c.MULTICLUSTER_NAME&&(s=c.ENTITY_NAMES[c.ENTITY_CLUSTER]+" : "+(s||t)),T.setClusterFilter(e,t,n,s)}else t&&i&&T.setEntityFilter(e,i,t,n)},replaceFullScreenDetailsRoute:function(e){var t=e[c.NAV_ACTION_TARGET];if(!d.isSearchSupportedEntityDetail(t)){var n=S(e);this.updateWindowURL(n)}i.beforeReplaceFullScreenDetailsRoute(e)},updateWindowURL:function(e){e=e||this.latestPageRoute||"",window.history.replaceState?window.history.replaceState({},E.getPageTitle(),"#"+e):E.log("NavigationManager.updateWindowURL : older browser doesn't support replaceState")},cloneNavigationContext:function(e){var t=this.getNavigationContext(e);return this.createNavigationContext(t.entityType,_.clone(t.options))},clearNavigationContext:function(e){delete this.navigationContexts[e]},createNavigationContext:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=E.randomId();return this.navigationContexts[i]={entityType:e,options:_.clone(t),pageRoute:this.getCurrentPageRoute()},i},getNavigationContext:function(e){return this.navigationContexts[e]},isRouteExecuteAction:function(){return(window.location.href||"").indexOf("#execute")>-1},isPEAssistMode:function(){return(window.location.href||"").indexOf(l.PE_ASSIST+"=true")>-1},_getDefaultTabId:function(e){switch(e){case c.ENTITY_NETWORK_SECURITY_RULE:return c.TAB_DETAILS.NETWORK_SECURITY_RULES;case c.ENTITY_CATEGORY:return c.TAB_DETAILS.CATEGORY_DETAILS;default:return c.TAB_DETAILS.SUMMARY}},isXiContextRoot:function(){return!(!window.location.pathname||0!==window.location.pathname.indexOf("/xi"))},isConsoleContextRoot:function(){return!(!window.location.pathname||0!==window.location.pathname.indexOf("/console"))},isPCLoadingPEIFrame:function(){var e=this._getWindowLocationHref(),t=e&&e.substr(e.indexOf("?")),i=E.parseQueryToObject(t)||{};return!_.isEmpty(i[l.CLUSTER_ID])},_getWindowLocationHref:function(){return window.location.href}})}),define("models/SessionInfoModel",["models/PollingModel","data/DataURLConstants","data/DataManager","data/DataProperties","utils/AppConstants","utils/AppUtil","events/AppEvents","managers/AccessManager","managers/IntentManager","managers/NavigationManager","managers/BatchManager"],function(e,t,i,n,s,a,r,o,l,c,u){"use strict";var d={USERNAME:"username",ROLES:"roles",PROJECTS:"projects",USER_DATA:"userData",AUTH_HEADER:"authHeader",ACPS:"access_control_policies",ACP:"access_control_policy",PERMISSIONS:"permissions",USER_INFO:"user_info",LEGACY_NAME:"user_legacy_name"},h={USER_ME:"users/me",USER_INFO:"users/info",ROLES:"roles",PROJECTS:"projects",ACPS:"access_control_policies",PERMISSIONS:"permissions",CLOUD_TRUST:"cloud_trust",CLOUD_INFO:"/tenant_clusters/physical_availability_zone",AZ_LIST:"availability_zones/list"},p={LOCAL:"LOCAL",DIRECTORY_SERVICE:"DIRECTORY_SERVICE",INTERNAL:"INTERNAL"},T=[s.SSP_USER_ROLE_TYPES.SUPER_ADMIN,s.USER_ROLE.USER_ADMIN,s.USER_ROLE.MULTICLUSTER_ADMIN,s.USER_ROLE.CLUSTER_ADMIN];return e.extend({urlRoot:t.INTENT_LOGIN,entityType:s.ENTITY_USER,name:"SessionInfoModel",authHeader:null,DP:d,defaults:{username:null,roles:null,userData:null,cloudTrusts:null},notRequiredSuccessAPIs:[h.CLOUD_INFO],permissionsList:null,cloudTrustsList:null,cloudInfo:null,azList:null,isUsersMeDiff:!0,trackFetchCounter:0,intervalTimeInMilliSec:3e5,_userSearchDirectoryServiceUuid:null,initialize:function(t){e.prototype.initialize.apply(this,arguments),r.onAppEvent(r.REFRESH_V3_USER_DETAILS,this.triggerForceFetch.bind(this))},fetch:function(e){e=e||{},this._pollingOptions=_.clone(e);var t=this.createBatchRequest(e);if(null!==this[d.AUTH_HEADER]){var i=this;t.ajax={beforeSend:function(e){return e.setRequestHeader("Authorization",i[d.AUTH_HEADER]),e.setRequestHeader("X-Nutanix-Login",!0),!0}}}return u.fetchEntities(t)},createBatchRequest:function(e){return{requestList:this.createRequestList(),success:function(t,n,s){var a=this;i.setupEnvironment(s),this.trackFetchCounter++;var r=this.processBatchResponse(t,s);if(r.failed)return void e.error(this,r.errorXhr);var o=this.parse(r.responseMap),l=this.isUsersMeDiff;this.isUsersMeDiff=this.isThereDiffInUser(r.responseMap),this.set(o,{silent:!0}),r.successCount+r.validErrorCount===r.responseList.length&&this.postFetch({isUsersMeDiff:!0===l,error:e.error,success:function(){_.isFunction(e.success)&&e.success(a)}})}.bind(this),error:function(t){i.setupEnvironment(t),a.logObject("SessionInfoModel: Error in all batch call:",t),_.isFunction(e.error)&&e.error(this,t)}.bind(this)}},processBatchResponse:function(e,t){var i=this,n={successCount:0,validErrorCount:0,failed:!1,errorXhr:null,responseList:[],responseMap:{}};return n.responseList=e[u.DP.API_RESPONSE_LIST],_.each(n.responseList,function(e){var s=e[u.DP.RESPONSE.API_RESPONSE],r=e[u.DP.REQUEST.PATH_AND_PARAMS]||"";if(u.isStatusSuccess(e.status))n.successCount++,_.find(h,function(e){if(r.indexOf(e)>-1)return n.responseMap[e]=s,!0});else{var o=!1;_.each(i.notRequiredSuccessAPIs,function(e){r.indexOf(e)&&(o=!0)}),o?n.validErrorCount++:(a.logObject("SessionInfoModel: Error in a batch call: "+r+", "+s),n.errorXhr=t,n.errorXhr.status=e.status,n.failed=!0)}}),n},createRequestList:function(){var e=[];return e.push({method:l.SWAGGER_REST.GET,entityType:a.getEntityTypeIntent(s.ENTITY_USER),uuid:"me"}),this.permissionsList||e.push({method:l.SWAGGER_REST.POST,entityType:a.getEntityTypeIntent(s.ENTITY_PERMISSION),includeList:!0,limit:2e3}),
this.isUsersMeDiff&&e.push({method:l.SWAGGER_REST.GET,entityType:a.getEntityTypeIntent(s.ENTITY_USER),uuid:"info"}),this.cloudTrustsList||e.push({method:l.SWAGGER_REST.POST,entityType:a.getEntityTypeIntent(s.ENTITY_CLOUD_TRUST),includeList:!0}),!this.cloudInfo&&this.isCloudInfoNeeded()&&e.push({private:!0,method:l.SWAGGER_REST.GET,url:h.CLOUD_INFO}),e.push({method:l.SWAGGER_REST.POST,entityType:a.getEntityTypeIntent(s.ENTITY_AVAILABILITY_ZONE),includeList:!0}),e},destroy:function(t){e.prototype.destroy.apply(this,arguments),r.offAppEvent(r.REFRESH_V3_USER_DETAILS,this.triggerForceFetch)},parse:function(e){var t=e[h.USER_ME],i={},n=t&&t.status&&t.status.resources,r=e[h.PERMISSIONS];r&&(this.permissionsList=a.getEntityList(s.ENTITY_PERMISSION,{permission:r},{includeError:!0}));var o=e[h.CLOUD_TRUST];o&&(this.cloudTrustsList=a.getEntityList(s.ENTITY_CLOUD_TRUST,{cloud_trust:o},{includeError:!0}));var l=e[h.CLOUD_INFO];if(l&&(this.cloudInfo=l),this.azList=a.getEntityList(s.ENTITY_AVAILABILITY_ZONE,_defineProperty({},s.ENTITY_AVAILABILITY_ZONE,e[h.AZ_LIST]),{includeError:!0}),this.isUsersMeDiff){var c=e[h.USER_INFO];n&&c&&(n.roles_list=this.buildRolesList(n,c),i[this.DP.ROLES]=n.roles_list,i[this.DP.USER_INFO]=c)}else i[this.DP.ROLES]=this.get(this.DP.ROLES),i[this.DP.PROJECTS]=this.get(this.DP.PROJECTS);return i[this.DP.USERNAME]=t.status.name,i[this.DP.USER_DATA]=t,i},buildRolesList:function(e,t){var i=[],s=t[n.ACP_LIST];return _.each(s,function(e){var t=e[n.ACP_FILTERS.ROLE];t&&i.push(t[n.NAME])},this),i},isThereDiffInUser:function(e){if(1===this.trackFetchCounter)return!1;var t=e[h.USER_ME],i=this.get(this.DP.USER_DATA)||{},n=t.status&&t.status.resources||{},s=i.status&&i.status.resources||{},a=_.pluck(n.projects_reference_list,"name"),r=_.pluck(s.projects_reference_list,"name"),o=_.pluck(s.access_control_policy_reference_list,"name"),l=_.pluck(n.access_control_policy_reference_list,"name"),c=_.difference(a,r),u=_.difference(r,a),d=_.difference(l,o),p=_.difference(o,l);return c.length||u.length||d.length||p.length},getAcpRoleReference:function(e){var t=void 0;return e.status&&e.status.resources?t=e.status.resources:e.resources&&(t=e.resources),t.role_reference},getStatusCode:function(e){return{401:function(e,t,i){c.navigateToRoute(s.ROUTE_LOGIN)}}},getDataSourceURL:function(){return i.getDataSourceURL(i.API_VERSION.V3)},createPostFetchRequestList:function(e){var t=[];return!this.isNoProjectListUser()&&e.isUsersMeDiff&&t.push({method:l.SWAGGER_REST.POST,entityType:a.getEntityTypeIntent(s.ENTITY_PROJECT),includeList:!0}),t},postFetch:function(e){var t=this,i=this.createPostFetchRequestList(e);return _.isEmpty(i)?void e.success():u.fetchEntities({requestList:i,success:function(i,n,s){var a=t.processBatchResponse(i,s);if(a.failed)return void e.error(t,a.errorXhr);t.appendPostFetchData(a.responseMap),e.success()},error:function(i){a.logObject("SessionInfoModel: Error in all post fetch batch call:",i),_.isFunction(e.error)&&e.error(t,i)}})},appendPostFetchData:function(e){var t=a.getObjectArrayPathValue(this.getUserDetails(),["userData",l.SWAGGER_PROPERTIES.PROP_STATUS,l.SWAGGER_PROPERTIES.PROP_RESOURCES]),i=e[h.PROJECTS];_.isEmpty(i)||this.set(this.DP.PROJECTS,this.buildProjectsList(t,i))},isNoProjectListUser:function(){var e=this.get(d.ROLES);return _.difference(e,T).length!==e.length},buildProjectsList:function(e,t){var i=[],n=a.getEntityList(s.ENTITY_PROJECT,{project:t},{includeError:!0}),r=_.clone(e.projects_reference_list)||_.map(e.projects_list,function(e){return this.getProjectReference(e)},this);return _.each(n,function(t){var n=this.getProjectReference(t),s=_.find(r,function(e){return e.name===n.name}),a=!1;if(n&&n.resources){if(n.resources.is_default){var l=e.role_reference_list||e.roles_list||[];a=o.isDefaultProjectAllowed(l)}}(s||a)&&i.push(t)},this),i},getProjectReference:function(e){return e.status?e.status:e},getUserDetails:function(){var e=this.get(this.DP.USERNAME),t=this.get(this.DP.ROLES),i=this.get(this.DP.PROJECTS),n=this.get(this.DP.USER_DATA),s=this.permissionsList,a=this.get(this.DP.USER_INFO);return{profile:{username:e},roles:_.map(t,function(e){return e}),projects:_.map(i,function(e){return e}),userInfo:a,userData:n,permissions:_.map(s,function(e){return e})}},getLegacyUsername:function(){var e=this.get(this.DP.USER_INFO);if(e)return e[this.DP.LEGACY_NAME]},getUserUuid:function(){var e=this.get(this.DP.USER_DATA);if(e&&e.metadata&&e.metadata.uuid)return e.metadata.uuid},getUserType:function(){var e=this.get(this.DP.USER_DATA);if(e&&e.status&&e.status.resources)return e.status.resources.user_type},isDirectoryServiceUser:function(){return this.getUserType()===p.DIRECTORY_SERVICE},isLocalUser:function(){return this.getUserType()===p.LOCAL||this.getUserType()===p.INTERNAL},getDirectoryServiceUuid:function(e){var t=this.get(this.DP.USER_DATA)||{},i=t.status&&t.status.resources||{},n=i.directory_service_reference||{};if(n&&_.isString(n.uuid)&&""!==n.uuid)return n.uuid;var s=this.getUserSearchDirectoryServiceUuid();return s||void 0},setUserSearchDirectoryServiceUuid:function(e){this._userSearchDirectoryServiceUuid=e},getUserSearchDirectoryServiceUuid:function(){return this._userSearchDirectoryServiceUuid},triggerForceFetch:function(){this.isUsersMeDiff=!0,this.fetch(this._pollingOptions)},getSystemInfo:function(){var e={};return e[n.SYS_INFO.XI_CONNECTED]=this.isConnectedToXi(),e[n.SYS_INFO.XI_CONNECTED_TO_ONPREM]=this.isConnectedToOnPrem(),e[n.SYS_INFO.PC_CONNECTED]=this.isConnectedToPC(),e},isConnectedToXi:function(){var e=!1;return this.cloudTrustsList&&_.each(this.cloudTrustsList,function(t){t&&t.status&&t.status.resources&&t.status.resources.cloud_type===s.CLOUD_TYPE.XI&&(e=!0)}),e},isConnectedToOnPrem:function(){var e=this.getAppManager(),t=!1;return e.isXi()&&this.cloudTrustsList&&_.each(this.cloudTrustsList,function(e){e&&e.status&&e.status.resources&&e.status.resources.cloud_type===s.CLOUD_TYPE.PC&&(t=!0)}),t},isConnectedToPC:function(){var e=!1;return this.cloudTrustsList&&_.each(this.cloudTrustsList,function(t){t&&t.status&&t.status.resources&&t.status.resources.cloud_type===s.CLOUD_TYPE.PC&&(e=!0)}),e},getCloudServicesInfo:function(){return this.cloudInfo},getLocalAvailabilityZone:function(){return _.find(this.azList,function(e){return e[n.INTENT_STATUS][n.INTENT_RESOURCES][n.AVAILABILITY_ZONE.AZ_TYPE]===s.AVAILABILITY_ZONE_TYPE.LOCAL})},isCloudInfoNeeded:function(){return this.getAppManager().isXi()||c.isXiContextRoot()}},{DP:d,BATCH_API:h})}),define("models/UserSettings",["models/BaseModel","utils/AppUtil"],function(e,t){"use strict";return e.extend({VERSION:1,defaults:{userSettings:null,currentCluster:null,userId:null},initialize:function(e){return e.cluster?e.userId?(this.set({userSettings:{},currentCluster:e.cluster,userId:e.userId}),void this._fetch()):void t.log("UserSettings.inialize Error: userId not specfied"):void t.log("UserSettings.inialize Error: Cluster not specfied")},setUserSetting:function(e,t){this.get("userSettings")[e]=t,this._save()},getUserSetting:function(e){return this.get("userSettings")[e]},_clusterKey:function(e){return this.get("currentCluster")+"-"+e},_persistenceKey:function(){return("nutanix-"+this.VERSION+"-"+this.get("currentCluster")+"-"+this.get("userId")).replace(/\./g,"_")},_fetch:function(){if(t.hasLocalStorage()){var e=localStorage[this._persistenceKey()];e&&this.set({userSettings:JSON.parse(e)})}},_save:function(){if(t.hasLocalStorage()){var e=JSON.stringify(this.get("userSettings"));localStorage[this._persistenceKey()]=e}}})}),define("models/V3APIPollingModel",["models/PollingModel","data/DataURLConstants","data/DataManager"],function(e,t,i){"use strict";return e.extend({urlRoot:t.INTENT_LOGIN,intervalTimeInMilliSec:78e4,getDataSourceURL:function(){return i.getDataSourceURL(i.API_VERSION.V3)}})}),define("models/version/VersionModel",["backbone","models/BaseModel","data/DataURLConstants","data/DataManager","data/DataProperties","data/Config","utils/AppConstants","utils/AppUtil"],function(e,t,i,n,s,a,r,o){"use strict";var l=/^.*?-(.*)-.*$/;return t.extend({urlRoot:i.VERSION,entityType:r.SYSTEM_VERSION,defaults:{id:null,buildName:"",buildType:"",version:"",commitId:"",commitIdShort:"",lastCommitDate:"",nccVersion:"",uiVersion:a.UI_VERSION},name:"VersionModel",sync:function(t,s,a){a=this.parseOptions(t,s,a),a.url=n.getDataSourceURL()+i.VERSION,t="read",o.log("BaseModel : \n\t method: "+t+"\n\t data  : "+a.url),e.sync(t,s,a)},getCurrentVersion:function(){var e=this.get(s.VERSION)||"",t=l.exec(e);return t&&t.length>=1?t[1]:e},getTaggedCurrentVersion:function(){var e=this.getCurrentVersion()||"";return this.get(s.IS_LTS)?[e,this.i18n("long_term_support")].join(" "):e},getNCCVersion:function(){var e=this.get(s.VERSION_NCC);return void 0!==e&&null!==e?e:r.UNKNOWN_VALUE},getFoundationVersion:function(){var e=this.get(s.VERSION_FOUNDATION);return void 0!==e&&null!==e?e:r.UNKNOWN_VALUE},parse:function(e){return e}})}),define("managers/ReloadManager",["models/version/VersionModel","data/DataProperties","managers/BaseManager","managers/NamespaceManager","managers/TaskManager","utils/AppConstants","utils/AppUtil"],function(e,t,i,n,s,a,r){"use strict";return i.extend({name:"ReloadManager",initCheckDone:!1,versionModel:null,currentVersion:null,isPromptDisplayed:!1,initialize:function(){if(_.bindAll(this,"checkUpgrade"),this.versionModel=new e,!window.sessionStorage)return void r.log("No sessionStorage support")},destroy:function(){s.unregisterHandlerForChangedTasks(this.checkUpgrade,this)},setVersionLoaded:function(e){if(window.sessionStorage){var i=e.get(t.APPLIANCE_VERSION)||{};this.currentVersion=i[t.COMMIT_ID],sessionStorage.setItem(a.UI_VERSION,this.currentVersion)}},startVersionStaleCheck:function(){if(window.sessionStorage){var e=this.getVersionFromSessionInfo();this.currentVersion?null!==e&&this.currentVersion!==e&&this.promptReload():(this.currentVersion=e,sessionStorage.setItem(a.UI_VERSION,this.currentVersion)),s.registerHandlerResetStructure(this.checkUpgrade,this)}},checkVersionStale:function(){var e=this.versionModel.get(t.COMMIT_ID);e&&this.currentVersion&&e!==this.currentVersion&&this.promptReload()},checkUpgrade:function(){var e=s.getGlobalTasks(),t=e.getUpgradeTasks(a.TASK_OPERATION_UPGRADE),i=t.length>0;_.each(t,function(e){e.isStatusComplete()||(i=!1)},this),this.initCheckDone?(s.unregisterHandlerResetStructure(this.checkUpgrade,this),s.registerHandlerForChangedTasks(this.checkUpgrade,this)):this.initCheckDone=!0,i&&this.fetchVersionAndCheckStale()},getVersionFromSessionInfo:function(){var e=n.get(n.SESSION_INFO),i=e?e[t.APPLIANCE_VERSION]:{};return i?i[t.COMMIT_ID]:null},fetchVersionAndCheckStale:function(){var e;if(Function.prototype.bind)e=this.checkVersionStale.bind(this);else{var t=this;e=function(){t.checkVersionStale.call(t)}}this.versionModel.fetch({success:e,error:function(){r.log("Error in fetching cluster version")}})},promptReload:function(){var e=this;this.isPromptDisplayed||($("#globalModalContainer").length?($.nutanixConfirm({msg:this.i18n("reload"),yes:function(){this.reload(),this.isPromptDisplayed=!1},no:function(){this.isPromptDisplayed=!1},yesText:this.i18n("yes"),noText:this.i18n("no"),class:"n-reload-prompt",context:this}),this.isPromptDisplayed=!0):r.requestAnimationFrame(function(){e.promptReload.call(e)}))},reload:function(){window.location.reload(!0)}})}),define("managers/LoginManager",["data/DataManager","data/Config","data/DataURLConstants","data/DataProperties","models/SessionInfoModel","models/UserSettings","models/V3APIPollingModel","managers/AppManager","managers/NamespaceManager","managers/ClusterManager","managers/LicenseManager","managers/PrismElementManager","managers/I18nManager","managers/ReloadManager","managers/NavigationManager","managers/AccessManager","utils/AppUtil","utils/AppConstants","events/AppEvents"],function(e,t,i,n,s,a,r,o,l,c,u,d,h,p,T,E,S,g,A){"use strict";var m={"x-nutanix-api-key":"500e8ffa-9a8b-ef46-b8cc-6e06c460fb50"},f={V1:"V1",V3:"V3"};return{SESSION_VERSIONS:f,VIDEO_URL_PARAMETER:"novideo",SHOW_HOST_PORT_PARAMETER:"showhost",primarySession:f.V1,hasProceededToSuccessCB:!1,userInfoModel:null,isV3LoggedIn:!1,isV1LoggedIn:!1,showVideo:!1,showHostPort:!1,v3APIPollingModel:null,delayId:null,initialize:function(){e.isV3PrimaryDataSource()?this.primarySession=f.V3:this.primarySession=f.V1,S.log("LoginManager: Primary session "+this.primarySession)},checkLoginSession:function(e,t){var i=S.getHashParameters(),n=g.JITAGS_TOKEN;if(i&&i[n])return localStorage.setItem(g.LOCAL_STORAGE.JITAGS_BEARER_TOKEN,i[n]),void T.refreshToBaseURL();localStorage.getItem(g.LOCAL_STORAGE.JITAGS_BEARER_TOKEN)&&setTimeout(function(){T.navigateToRoute(g.ROUTE_LOGOUT)},g.FORCED_AGS_LOGOUT_TIME_MINUTES*g.MILLIS_PER_MINUTE),this.isPrimarySessionV1()?this._checkLoginSessionV1(e,t):this._checkLoginSessionV3(e,t)},login:function(e,t,i,n){this.isPrimarySessionV1()?this._loginV1(e,t,i,n):this._loginV3(e,t,i,n)},isPrimarySessionV1:function(){return this.primarySession===f.V1},isPrimarySessionV3:function(){return this.primarySession===f.V3},_checkLoginSessionV1:function(e,t){var i=this,n=function(t){S.log("LoginManager : Session is active"),p.startVersionStaleCheck(),i.setIsLoggedIn(!0,t.profile.username),i._postV1Login(null,null,e,t.profile.ldapLoginName)},s=function(e){S.log("LoginManager : Not yet logged in."),i.setIsLoggedIn(!1,null),t(e)};_.bindAll(this,"fetchPostLoginData"),this.fetchPostLoginData(n,s)},_loginV1:function(t,n,s,a){var r=this;$.ajax({url:e.getGatewayURL()+i.SERVICE_LOGIN,data:{j_username:t,j_password:n},type:"POST",dataType:"text",cache:"false",headers:m,success:function(e){var i=$.trim(e)===g.LOGIN_SUCCESS;if(r.setIsLoggedIn(i,t),i){var o=function(e){var i=e&&e.profile&&e.profile.ldapLoginName;r._postV1Login(t,n,function(){s(!0,g.LOGIN_SUCCESS)},i)},l=function(e){a(e)};S.hasLocalStorage()&&(window.localStorage[g.TAB_COUNT]=0),r.fetchPostLoginData(o,l)}else s(i,e)},error:function(e,t,i){function n(){var e=arguments;o.isV3LoggedIn?o._logoutV3().complete(function(){a.apply(null,e)}):a.apply(null,arguments)}var o=r;"error"===t&&0===$.trim(i).length?r.checkLoginSafari(s,n):n(e)}})},_logoutV1:function(){var t=this;return this.isV1LoggedIn?$.ajax({url:e.getGatewayURL()+i.SERVICE_LOGOUT,type:"GET",dataType:"text",cache:!1,success:function(){t.isV1LoggedIn=!1},error:function(){S.log("LoginManager: Error occurred in v1 logout.")}}):$.Deferred().resolve().promise()},_logoutV3:function(){var t=this;return this.isV3LoggedIn?$.ajax({url:e.getDataSourceURL(e.API_VERSION.V3)+i.SSP_LOGOUT,type:"GET",cache:!1,success:function(){t.isV3LoggedIn=!1,t.setIsV3LoggedIn(t.isV3LoggedIn)},error:function(){S.log("LoginManager: Error occurred in v3 logout.")}}):$.Deferred().resolve().promise()},logout:function(e,t){var i=this;$.xhrObj.abortAll(),this.v3APIPollingModel&&(this.v3APIPollingModel.stopPolling(),this.v3APIPollingModel=null),clearTimeout(this.delayId);var n=[this._logoutV3(),this._logoutV1()];$.when.apply($,n).done(function(t,n){S.log("LoginManager : logout success"),i.primarySession===f.V3&&t?i.primarySessionSuccessV3(t[0]):n&&i.primarySessionSuccessV1(n[0]),localStorage.removeItem(g.LOCAL_STORAGE.JITAGS_BEARER_TOKEN),e&&!o.isXi()&&e()}).fail(function(e,n,s){i.primarySessionFailV1andV3(e,n,s),t(e)})},primarySessionSuccessV3:function(e){this.setIsLoggedIn(!1,null),this.userInfoModel.stopPolling(),e&&e.external_logout_url_list&&e.external_logout_url_list[0]&&T.navigateToURL(e.external_logout_url_list[0],!1)},primarySessionSuccessV1:function(e){_.isString(e)&&$.trim(e)===g.LOGOUT_SUCCESS&&this.setIsLoggedIn(!1,null)},primarySessionFailV1andV3:function(e,t,i){void 0!==t&&void 0!==i&&"error"===t&&0===$.trim(i).length&&setTimeout(function(){window.location.reload()},1e3)},isLoggedIn:function(){return l.get(l.IS_LOGGED_IN)},setIsLoggedIn:function(e,i){if(l.set(l.IS_LOGGED_IN,e),e){var n=void 0;n=this.isPrimarySessionV1()?t.getServiceData(t.PRISM_GATEWAY).host:t.getServiceData(t.INTENT_GATEWAY).host,l.set(l.USER_SETTINGS,new a({cluster:n,userId:i})),A.triggerAppEvent(A.USER_AUTHENTICATED)}},setIsV3LoggedIn:function(e){l.set(l.IS_V3_LOGGED_IN,e)},isChangeSystemDefaultPasswordView:function(){return!(!this.isLoginPrevious||this.loginView.currentMode!==g.LOGIN_MODE.OVERRIDE)},checkLoginSafari:function(e,t){var i=this,n=function(t){i.setIsLoggedIn(!0,t.profile.username),e(!0,g.LOGIN_SUCCESS)},s=function(e){i.setIsLoggedIn(!1,null),t(e)};this.fetchPostLoginData(n,s)},saveSessionInfo:function(e){l.set(l.SESSION_INFO,e)},saveUserDetails:function(e){l.set(l.USER_DETAILS,e)},saveUserDetailsV1:function(e){l.set(l.USER_DETAILS_V1,e)},saveUserDetailsV3:function(e){l.set(l.USER_DETAILS_V3,e)},saveFF:function(e){l.set(l.FF,e)},setMulticlusterUI:function(e){e&&void 0!==e[n.MULTICLUSTER_GATEWAY]?c.setMulticlusterUI(e[n.MULTICLUSTER_GATEWAY]):c.setMulticlusterUI(!1)},fetchPostLoginData:function(t,s){var a=this,r=void 0;d.isLoadedFromPrismCentral()&&(r={},r[i.CLUSTER_PROXY_UUID]=d.getClusterIdFromPrismCentralProxy()),$.ajax({type:"GET",url:S.cacheBustURL(e.getDataSourceURL()+i.SESSION_INFO),data:r,dataType:"json",cache:"false",success:function(e){a.isV1LoggedIn=!0;var i=PrismCentral&&PrismCentral[l.SESSION_INFO]&&PrismCentral[l.SESSION_INFO][n.USER_DTO],s=function(){d.isLoadedFromPrismCentral()&&0===e[n.USER_DTO][n.USER_ROLES].length&&i&&(e[n.USER_DTO][n.USER_ROLES]=_.map(i[n.USER_ROLES],function(e){return e===g.USER_ROLE.MULTICLUSTER_ADMIN?g.USER_ROLE.CLUSTER_ADMIN:e})),a.saveSessionInfo(e),a.saveFF(e[n.FF]),a.setMulticlusterUI(e);var s=e[n.USER_DTO];a.saveUserDetailsV1(s),a.isPrimarySessionV1()&&a.saveUserDetails(s),_.isFunction(t)&&t(e[n.USER_DTO])},r=e[n.USER_DTO].profile,o=r[n.USER_LOCALE],c=r[n.USER_REGION];d.isLoadedFromPrismCentral()&&i&&i.profile&&i.profile[n.USER_LOCALE]&&(o=i.profile[n.USER_LOCALE],c=i.profile[n.USER_REGION]);var p=[];o&&o.length&&(h.setTimeDateRegion(c),p.push(h.setLocale(o))),u.initialize(),p.push(u.startServices()),$.whenAll.apply($,p).done(function(){s()})},error:function(e,t,i){_.isFunction(s)&&s(e)}})},checkParameters:function(){this.updateLoginParticlesState(),this.checkHostPort()},checkHostPort:function(){var e=S.getHashParameters();e&&e[this.SHOW_HOST_PORT_PARAMETER]&&"TRUE"===e[this.SHOW_HOST_PORT_PARAMETER].toUpperCase()?localStorage[g.LOCAL_STORAGE.SHOW_HOST]="true":e&&e[this.SHOW_HOST_PORT_PARAMETER]&&"FALSE"===e[this.SHOW_HOST_PORT_PARAMETER].toUpperCase()&&(localStorage[g.LOCAL_STORAGE.SHOW_HOST]="false"),S.isLocalStorageProperty(g.LOCAL_STORAGE.SHOW_HOST)&&(this.showHostPort=!0,S.log("LoginManager: Host/Port has been enabled."))},updateLoginParticlesState:function(){var e=S.getHashParameters();S.hasLocalStorage()&&(e&&e[this.VIDEO_URL_PARAMETER]&&"TRUE"===e[this.VIDEO_URL_PARAMETER].toUpperCase()?localStorage[g.LOCAL_STORAGE.NO_VIDEO]="true":e&&e[this.VIDEO_URL_PARAMETER]&&"FALSE"===e[this.VIDEO_URL_PARAMETER].toUpperCase()&&(localStorage[g.LOCAL_STORAGE.NO_VIDEO]="false"),S.isLocalStorageProperty(g.LOCAL_STORAGE.NO_VIDEO)?(this.showVideo=!1,S.log("LoginManager: Login background has been disabled.")):"false"===localStorage[g.LOCAL_STORAGE.NO_VIDEO]&&(this.showVideo=!0))},isShowVideo:function(){return this.showVideo},isShowHostPort:function(){return this.showHostPort},checkVideoState:function(){this.checkParameters()},isLoginWorkflow:function(e,t){return!_.isEmpty(e)&&!_.isEmpty(t)},_checkLoginSessionV3:function(e,t){this._loginV3(null,null,e,t)},_loginV3:function(e,t,i,n){var a=this,r=i,c=n,u=this.isLoginWorkflow(e,t);this.userInfoModel=new s,u&&(this.userInfoModel[s.DP.AUTH_HEADER]=S.convertToBasicAuth(e,t));var d=!0,h={success:function(n,h){a.isV3LoggedIn=!0;var p=n.getUserDetails();l.set(l.USER_INFO_MODEL,n),a.saveUserDetails(p),a.saveUserDetailsV3(p);var _=n.get(n.DP.ROLES);_?E.setGlobalRolesList(_):E.setGlobalRolesList(null);var T=n.getSystemInfo();o.setSystemInfo(T);var A=n.getCloudServicesInfo();o.setCloudServicesInfo(A);var m=n.getLocalAvailabilityZone();if(o.setLocalAZDetails(m),E.hasV3andV1Role()){if(a.hasProceededToSuccessCB=!0,!a.isV1LoggedIn)if(u){var f=n.getLegacyUsername();f||(S.log("Legacy username does not exist. Using v3 username..."),f=e),a._loginV1(f,t,r,c)}else a._checkLoginSessionV1(r,c)}else e||(e=n.get(n.DP.USERNAME)),a.setIsLoggedIn(!0,e),a.saveSessionInfo({userSettings:{}});a.hasProceededToSuccessCB||(a.hasProceededToSuccessCB=!0,i(!0,g.LOGIN_SUCCESS)),d&&(d=!1,a.userInfoModel[s.DP.AUTH_HEADER]=null)},error:function(e,t){if(t){if(e.getState()!==g.STATE_CANCELED&&S.isConnectionError(t))return;var i=t.status;i>=400&&i<500&&_.isFunction(e.stopPolling)&&e.stopPolling()}a.setIsLoggedIn(!1,null),n(t)}};this.userInfoModel.startPolling(h)},_postV1Login:function(e,t,i,n){var s=this;if(this.isPrimarySessionV1()){var a=function(){s.logout(function(){T.refreshToBaseURL()},function(e){S.debug(e)})};if(!E.isADUser()||n){var r=n||e;this._simpleLoginV3(r,t,i,a)}else S.log("LoginManager: NOT logged in v3 because of AD user."),i()}else i()},_simpleLoginV3:function(t,n,s,a){var o=this,l=e.getDataSourceURL(e.API_VERSION.V3)+i.INTENT_LOGIN;$.ajax({url:l,cache:!1,type:"GET",beforeSend:function(e){if(t&&n){var i=S.convertToBasicAuth(t,n);e.setRequestHeader("Authorization",i)}return!0},success:function(e){o.isV3LoggedIn=!0,o.setIsV3LoggedIn(o.isV3LoggedIn),o.v3APIPollingModel=new r,o.delayId=setTimeout(function(){o.v3APIPollingModel.startPolling()},o.v3APIPollingModel.intervalTimeInMilliSec),S.log("LoginManager: Successful login to Intent Gateway."),_.isFunction(s)&&s()},error:function(){o.setIsV3LoggedIn(!1),S.log("LoginManager: Could not login to Intent Gateway."),_.isFunction(a)&&a()}})}}}),define("views/login/LoginView",["jquery","jqueryui/autocomplete","jqueryui/slider","views/basecomponents/BaseView","views/utils/ParticleView","models/login/LoginModel","models/login/PreLoginModel","models/systemdata/SystemDataModel","data/DataProperties","models/identityprovider/IdentityProviderPreLoginModel","text!templates/login/LoginView.html","text!templates/login/LoginNextFormView.html","text!templates/login/LoginNextDisabledView.html","text!templates/login/LoginOverrideDefaultView.html","text!templates/login/LoginFormView.html","text!templates/login/WelcomeBannerView.html","managers/LoginManager","managers/NavigationManager","managers/ClusterManager","managers/ReloadManager","managers/HelpManager","utils/AppConstants","utils/AppUtil","utils/AntiscrollUtil","utils/SVG","utils/StyleDescriptor","utils/SubViewHelper","utils/ValidationUtil","data/DataManager"],function(e,t,i,n,s,a,r,o,l,c,u,d,h,p,T,E,S,g,A,m,f,I,C,v,R,N,P,O,y){"use strict";var D={NORMAL:"NORMAL",OVERRIDE:"OVERRIDE",COMMUNITY:"COMMUNITY"},M=_.template('Either the server is not reachable or <br/><a href="https://<%= host %>:<%= port %>/console" target="_blank">you need to accept the certificate</a>.'),b=_.template('<div id="loginCompanyText" class="company-text"><%= text %></div>'),L=(_.template("<%= SVG.loginSubmitArrow %>"),_.template(T)),w=(_.template(d),_.template(h),_.template(p)),U=_.template('<div class="rebrand"><span><%= SVG.loadSVG(SVG.LENOVOLOGO) %></span><span><%= SVG.loadSVG(SVG.HXLOGO) %></span><span> Series</span></div>');return n.extend({name:"LoginView",forwardRoute:null,options:null,viewOptions:null,currentMode:null,events:{"click     #btnLogin":"onLogin","click     #btnAccept":"onClickAccept","click     .n-login-help":"onClickHelp","keyup     #btnLogin":"onLogin","keyup     #inputPassword":"onKeyUp","keyup     #inputUsername":"onKeyUp","keypress  #inputUsername":"onKeyPressUserName","dblclick  #loginPrismLogoContainer":"onDoubleClickLogo"},initialize:function(e){this.viewOptions=e&&_.isObject(e)?e:{},this.model=new a,this.preLoginModel=new r,this.subViewHelper=new P,this.systemDataModel=new o({type:l.SYSTEM_DATA_TYPE_WELCOME_BANNER}),this.customLoginModel=new o({type:l.SYSTEM_DATA_CUST_LOGIN_TYPE}),this.currentMode=D.NORMAL;var t=this;this.model.on("error",function(e,i){t.showError(i),t.model.set({username:"",password:""},{silent:!0}),t.hideSpinner()}),_.bindAll(this,"onPreLoginModelSuccess","onPreLoginModelError","_renderLoadedContent")},setForwardRoute:function(e){this.forwardRoute=e},getForwardRoute:function(){return this.forwardRoute},setOptions:function(e){this.options=e},getLoginTemplate:function(){return u},render:function(){if(this.isViewRendered)return void C.log("LoginView has already been rendered.");this._renderLoginTemplate();var t=C.parseQueryToObject(this.options);if(t&&t[I.ROUTE_AUTHORIZE]){this.$("#loginFooterMessage").html(this.i18n("prismAppAuthorize","Authorize Prism App by signing in"));var i={};i[I.NAV_PAGE_ID]=I.PAGE_AUTHORIZE,i[I.NAV_OPTIONS]=C.formatObjectToQuery(t),this.setForwardRoute(i)}var n=[this.fetchCustomLoginData(),this.fetchPreLoginData()],s=this;e.whenAll.apply(e,n).done(function(){s._renderContentAfterFetch(),s.model.trigger("loaded")})},_renderLoginTemplate:function(){this.$el.append(_.template(u,{prismLogo:this._renderPrismLogo()}))},_renderPrismLogo:function(e){return C.renderAppLogo(e)},_renderContentAfterFetch:function(){var e=this,t=e.customLoginModel.getCustomizedLoginSettings(),i={};i=_.isEmpty(t[l.SYSTEM_DATA_CUST_LOGIN_COLOR_IN_KEY])||_.isEmpty(t[l.SYSTEM_DATA_CUST_LOGIN_COLOR_OUT_KEY])?this.getDefaultThemeColorsParticleView():{color_in:t[l.SYSTEM_DATA_CUST_LOGIN_COLOR_IN_KEY],color_out:t[l.SYSTEM_DATA_CUST_LOGIN_COLOR_OUT_KEY]},e.subViewHelper.register("particleView",new s({el:e.$("#loginBackground"),particleControlsEl:e.$("#loginControls"),manager:{continueLoop:function(){return!S.isLoggedIn()}},customSettings:i,classNames:"fade-in",enableParticles:S.isShowVideo()})),_.isEmpty(t[l.SYSTEM_DATA_CUST_LOGIN_PRODUCT_TITLE_KEY])||""===t[l.SYSTEM_DATA_CUST_LOGIN_PRODUCT_TITLE_KEY].trim()||(t[l.SYSTEM_DATA_CUST_LOGIN_PRODUCT_TITLE_KEY].trim().length>12&&e.$("#loginPrismLogoContainer").addClass("small"),e.$("#loginPrismLogoContainer").html(e._renderPrismLogo(t[l.SYSTEM_DATA_CUST_LOGIN_PRODUCT_TITLE_KEY].trim()))),this.appendBlurbText(e.$("#sectionLoginControls"),t),e.preLoginModel.isCommunityEdition()?e.$("#loginNutanixLogoContainer").html('<img src="./app/assets/images/common/nutanix_ce_login_logo.png">'):e.preLoginModel.isHXBranding()?e.$("#loginNutanixLogoContainer").append(U(this.vtOptions())):e.$("#loginNutanixLogoContainer").html('<span class="powered-by">Powered by</span>'+R.loadSVG(R.NUTANIX_LOGIN_LOGO)),A.isMulticlusterUI()&&e.$("#loginNutanixLogoContainer").append('<div class="multicluster-mode">Prism Central</div>'),e.isLogoDefault(t)?e.$("#loginPrismLogoContainer").removeClass("custom"):e.$("#loginPrismLogoContainer").addClass("custom")},appendBlurbText:function(e,t){var i=t[l.SYSTEM_DATA_CUST_LOGIN_TITLE_KEY]||"";_.isEmpty(i)||""===i.trim()||e.append(b({text:i.trim()}))},isLogoDefault:function(e){var t=!e||!e[l.SYSTEM_DATA_CUST_LOGIN_COLOR_IN_KEY]||e[l.SYSTEM_DATA_CUST_LOGIN_COLOR_IN_KEY]===N.LOGIN_THEME_COLORS[0][l.STYLE_DESC_LOGIN_LEFT_COLOR],i=(!e||!e[l.SYSTEM_DATA_CUST_LOGIN_COLOR_OUT_KEY]||(e[l.SYSTEM_DATA_CUST_LOGIN_COLOR_OUT_KEY],N.LOGIN_THEME_COLORS[0][l.STYLE_DESC_LOGIN_RIGHT_COLOR]),t&&t),n=!e||!e[l.SYSTEM_DATA_CUST_LOGIN_PRODUCT_TITLE_KEY]||""===e[l.SYSTEM_DATA_CUST_LOGIN_PRODUCT_TITLE_KEY].trim();return i&&n},getDefaultThemeColorsParticleView:function(){return{}},_renderLoginForm:function(){this.reset(),this._renderLoginFormNormal();var e=C.isHTML5Browser();!0!==e&&this.showError(e)},_renderLoginFormTmpl:function(e,t){return L(this.vtOptions({idpName:e,idpLoginUrl:t}))},_renderLoginFormNormal:function(){var e=this;this.currentMode=D.NORMAL;var t=new c,i=this.customLoginModel.getCustomizedLoginSettings();t.fetch({error:function(e){}}).finally(function(){var n=e.$("#sectionLoginControls");n.html(e._renderLoginFormTmpl(t.get(l.NAME),t.get(l.IDENTITY_PROVIDER.LOGIN_URL))),e.appendBlurbText(n,i)});var n=function(){this._renderLoginStateLoaded(),this.showMessage(),this.model.off("loaded",n,this)}.bind(this);this.model.on("loaded",n,this)},_renderLoginFormOverrideDefault:function(e){this.currentMode=D.OVERRIDE,this.$("#sectionLoginControls").html(w({SVG:R}));var t=function(){this._renderLoginStateLoaded(),this.$("#formLoginSection").addClass("form-section-override"),this.model.off("loaded",t,this)}.bind(this);this.model.on("loaded",t,this),e&&this.$("#alertLogin").removeClass("alert-error alert-success").addClass("alert-info").html(e).show()},_renderLoginStateLoaded:function(){this.viewOptions&&_.isFunction(this.viewOptions.stopPreloader)?this.viewOptions.stopPreloader(this._renderLoadedContent):this._renderLoadedContent()},_renderLoadedContent:function(){var e=this.subViewHelper.get("particleView");e&&(this.preLoginModel.isVideoDisabled()?e.hideVideo():e.renderParticles()),this.$("#formLoginSection").show(),this.updateInputWithAnimations(),this.$("#n-login-wrapper").addClass("loaded")},updateInputWithAnimations:function(t){S.isShowHostPort()&&this.$("#loginHostPort").show(),t=t||this._getFocusElement(),C.onAnimationEnd(this.$("#sectionLoginControls > div"),function(e){e.addClass("animateFocus"),e.focus()},null,t),C.onAnimationEnd(this.$("#sectionLoginControls > div"),function(e){C.addSVGClass(e,"animate")},null,this.$(".loginSubmitArrow")),C.onAnimationEnd(this.$(".loginSubmitArrow"),function(e){e.removeClass("animateFocus")},null,t);var i=this;this.$("#inputPassword").on("input",function(t){e(t.currentTarget).val()?C.addSVGClass(i.$(".loginSubmitArrow"),"active"):C.removeSVGClass(i.$(".loginSubmitArrow"),"active")})},_getFocusElement:function(){return S.isShowHostPort()?this.$("#inputHostPort"):this.$("#inputUsername").val()?this.$("#inputPasswordConfirm").val()?this.$("#inputPassword"):this.$("#inputPasswordConfirm"):this.$("#inputUsername")},_renderWelcomeBanner:function(){this.reset(),this.$("#welcomeBannerSection").html(E);var e=this.preLoginModel.getWelcomeBannerContent()||"";e=C.stripInvalidTagsAndAttributes(e),this.$("#welcomeBannerContainer").show().html(e),this.$("#welcomeBannerSection").show(),this.applyAntiScroll(),this.$("#welcomeBannerContainer").css("opacity",1)},fetchPreLoginData:function(){return this.preLoginModel.fetch({timeout:12e4,success:this.onPreLoginModelSuccess,error:this.onPreLoginModelError})},fetchCustomLoginData:function(){return this.customLoginModel.fetch({error:function(){C.log("Custom Login : no data")}})},onPreLoginModelSuccess:function(){var e=this.preLoginModel.getWelcomeBannerStatus();!0===e||"true"===e?this._renderWelcomeBanner():this._renderLoginForm(),m.setVersionLoaded(this.preLoginModel)},onPreLoginModelError:function(e,t,i){switch(C.log("Error retrieving welcome banner: "+C.processAjaxError(t.responseText)),t.status){case 404:case 415:case 0:this._renderLoginForm();break;default:this._renderWelcomeBanner(),this.showError(C.processAjaxError(t.responseText))}},showError:function(e,t){var i=this.interpretError(e);e&&this.$("#alertLogin").removeClass("alert-info alert-success").addClass("alert-error").html(i).show(),(t=void 0===t||t)&&(this.$("#inputPassword").val("").focus(),C.removeSVGClass(this.$(".loginSubmitArrow"),"active"))},showSuccess:function(e,t){e&&this.$("#alertLogin").removeClass("alert-info alert-error").addClass("alert-success").html(e).show(),(t=void 0===t||t)&&(this.$("#inputPassword").val("").focus(),C.removeSVGClass(this.$(".loginSubmitArrow"),"active"))},interpretError:function(e){var t=!1;if(_.isString(e))try{JSON.parse(e)}catch(e){t=!0}return t||_.isObject(e)&&e.responseText?this.interpretErrorV1(e):this.interpretErrorV3(e)},interpretErrorV1:function(e){var t="";return _.isString(e)?t=e:_.isObject(e)&&e.responseText&&(t=C.processPamErrorResponse(e)),t||(t="Oops... A server error occurred."),t},interpretErrorV3:function(e){var t;if(_.isString(e))try{t=JSON.parse(e)}catch(e){C.log("LoginView error:"+e)}else _.isObject(e)&&(t=e);var i;return t&&401===t.code?(i=this.i18n("loginInvalid"),this.isADUsername()&&(i+=". "+this.i18n("loginADUserHelp"))):i=e===this.i18n("login_error_no_username_and_pass")?this.i18n("login_error_no_username_and_pass"):this.i18n("loginServerError"),i},
showInfo:function(e){e&&this.$("#alertLogin").removeClass("alert-error").addClass("alert-info").text(e).show()},showMessage:function(){if(this.options){var e=C.parseQueryToObject(this.options),t="";e&&I.LOGOUT_CODE[e.code]?t=I.LOGOUT_CODE[e.code]:e&&e[I.IDENTITY_PROVIDER.IDP_ERROR_PARAM]&&(t=e[I.IDENTITY_PROVIDER.IDP_ERROR_PARAM]),t&&this.$("#alertLogin").text(t).show()}},reset:function(){this.resetError(),this.$("#inputPassword").val(""),this.$("#bgLogin").hide(),this.$("#btnLogin").button("reset")},resetError:function(e){this.$("#alertLogin").html("").hide()},applyAntiScroll:function(){v.applyAntiScroll(this.$(".antiscroll-wrap"),460)},showSpinner:function(){this.$(".loginSubmitArrow").hide(),this.$(".donut-loader").show()},hideSpinner:function(){this.$(".loginSubmitArrow").show(),this.$(".donut-loader").hide()},isADUsername:function(){var e=this.$("#inputUsername").val();return O.validEmail(e)},destroy:function(){this.welcomeBanneriFrameView&&this.welcomeBanneriFrameView.destroy(),this.undelegateEvents(),this.model.off(),this.$("#n-login-wrapper").remove(),this.subViewHelper.removeAll(),this.subViewHelper=null},onLogin:function(){switch(this.$("#inputUsername").autocomplete("destroy"),this.$("#alertLogin").hide(),this.showSpinner(),this.currentMode){case D.NORMAL:this.onLoginNormal();break;case D.OVERRIDE:this.onLoginOverride();break;default:throw new Error("Unrecognized login mode.")}},onLoginNormal:function(){var t=this;if(this.model.set({username:this.cUsername||this.$("#inputUsername").val(),password:this.cPassword||this.$("#inputPassword").val()}),this.model.isValid()){var i,n,s,a=this.$("#inputHostPort").val();i=(a||"").split(":"),n=i.length>=1?i[0]:"",s=2===i.length?i[1]:"",(e.trim(n).length>0||e.trim(s).length>0)&&y.updateDataSourceURL(n,s),S.login(this.model.get("username"),this.model.get("password"),function(e,i){t.$("#alertLogin").hide(),t.hideSpinner(),C.removeSVGClass(t.$(".loginSubmitArrow"),"active"),C.log("LoginView : isLoggedIn? "+i),e?t._proceedToAppAfterSuccessfulLogin():t.showError(i),m.startVersionStaleCheck()},function(e){var i=parseInt(e.getResponseHeader("StatusCode"),10);if(t.hideSpinner(),C.removeSVGClass(t.$(".loginSubmitArrow"),"active"),9===i){var n=C.parseJSON(e.responseText),s=C.formatAdminUserPamMessage(n.passwordComplexityCriteria);return t._renderLoginFormOverrideDefault(s),void t.model.trigger("loaded")}var a=e.responseText||"Login failed.";C.log("Login failed."),401!==e.status&&(a=y.isConnectedToRemoteServer()?M({host:y.currentHost,port:y.currentPort}):"Server is not reachable.",C.log("Gateway Not Reachable: "+y.getGatewayURL())),t.showError(a)})}},_proceedToAppAfterSuccessfulLogin:function(){if(S.isLoggedIn()){var e=this;this.$("#n-login-wrapper").fadeOut("fast",function(){e.reset(),e.destroy();var t=e.getForwardRoute();t?g.navigateToPageRouteObject(t):g.navigateToPage(e.getDefaultPage())})}else C.log("LoginView : Not valid to proceed to login.")},getDefaultPage:function(){return A.isMulticlusterUI()?I.PAGE_MC_DASHBOARD:I.PAGE_DASHBOARD},onLoginOverride:function(){var e=this,t=function(){e.hideSpinner(),e.disableUpdatePasswordInputs(),e.showSuccess(e.i18n("passwordUpdateSuccess")),setTimeout(function(){var t=function(){e._renderLoginForm(),e.model.trigger("loaded");e.showSuccess("Your password was successfully changed. Please login with your new password.")},i=function(t){e.showError(t)};S.logout(t,i)},3e3)},i=function(t,i){e.showError(i),e.hideSpinner()};this.preLoginModel.overrideDefaultCredentials({password:this.$("#inputPassword").val(),passwordConfirm:this.$("#inputPasswordConfirm").val(),currentPassword:this.model.get("password"),currentUsername:this.model.get("username")},{success:t.bind(this),error:i})},disableUpdatePasswordInputs:function(){this.$("#inputPassword").attr("disabled","disabled"),this.$("#inputPasswordConfirm").attr("disabled","disabled")},onLoginCommunity:function(){var e=this,t=function(){S.isLoggedIn()?e._proceedToAppAfterSuccessfulLogin():e.fetchPreLoginData()},i=function(t,i){e.showError(i),e.hideSpinner()};this.preLoginModel.saveNextCredential({username:this.$("#inputUsername").val(),password:this.$("#inputPassword").val()},{success:t,error:i})},showLoginDropDown:function(){var e=this,t=this.$("#inputUsername").val().trim(),i=this.preLoginModel.getActiveDirectoryDomains(),n=_.map(i,function(e){return t+"@"+e},this);n.unshift(t);var s=this.$("#inputUsername");s.autocomplete({source:n,delay:0,autoFocus:!0,open:function(t,i){e.$("#inputUsername").addClass("noBottomBorder focus")},close:function(t,i){e.$("#inputUsername").removeClass("noBottomBorder focus")}}),s.autocomplete("search",s.val()).focus()},onKeyPressUserName:function(t){e.ui.keyCode;this.preLoginModel.isADDomainsConfigured()&&t.keyCode===I.KEY_CODE.AT_SIGN&&this.showLoginDropDown(t)},onKeyUp:function(t){var i=e.ui.keyCode;t.keyCode===i.ENTER&&this.onLogin()},onDoubleClickLogo:function(e){e.shiftKey&&this.$("#loginHostPort").show()},onClickAccept:function(){var e=this;this.$("#welcomeBannerSection").fadeOut("fast",function(){e._renderLoginForm(),e.model.trigger("loaded")})},onClickHelp:function(){window.open(f.getHelpUrlForPage("overview"),"_blank")}})}),define("text!templates/popups/default/DefaultPopup.html",[],function(){return'\x3c!-- Default Structure for Popups --\x3e\n<header class="modal-header">\n  <% if (closeButton) { %>\n    <button type="button" class="close xClose" data-dismiss="modal">\n      <i data-icon="K" aria-hidden="true"></i>\n    </button>\n  <% } %>\n  <h4 class="n-title"><%= title %></h4>\n</header>\n\n<% if (!nestedAlert) { %>\n  <div class="n-modal-alert-header">\n    <%= alertContent %>\n  </div>\n<% } %>\n\n<div class="n-modal-wrapper">\n  <div class="n-modal-body">\n    <div class="n-modal-content-wrapper">\n\n      <% if (tabs) { %>\n        <nav class="n-modal-tabs">\n          <ul class="n-modal-tab-header nav-tabs <%= stepTabs ? \'step-tabs\' : \'\' %>">\n            <%= tabsList %>\n          </ul>\n        </nav>\n      <% } %>\n\n      <div class="n-modal-content <%= antiscroll ? \'\' : \'scroll\' %>">\n        <% if (antiscroll) { %>\n        <div class="antiscroll-wrap">\n          <div class="box-wrap">\n            <div class="antiscroll-inner">\n              <div class="box-inner">\n        <% } %>\n                <% if (nestedAlert) { %>\n                  <div class="n-modal-alert-header">\n                    <%= alertContent %>\n                  </div>\n                <% } %>\n\n                <%= bodyContent %>\n        <% if (antiscroll) { %>\n              </div>\n            </div>\n          </div>\n        </div>\n        <% } %>\n      </div>\n    </div>\n  </div>\n\n  <% if (footer) { %>\n    <footer class="n-modal-footer <%= (isHiddenFooter ? \'hidden\' : \'\') %>">\n      <%= footerButtons %>\n    </footer>\n  <% } %>\n\n</div>\n'}),define("text!templates/popups/default/DefaultTabs.html",[],function(){return'\x3c!-- Default Structure for Tabs in Popups --\x3e\n<%\n  _.each( tabs, function(tab) {\n%>\n  <li\n    class="<%= tab.isActive ? \'active\' : \'\' %>"\n  >\n    <button\n      class="tab <%= tab.extraClasses %>"\n      role="tab"\n      <%\n        if (tab.extraAttr) {\n          for (var attr in tab.extraAttr) {\n      %>\n        <%= tab.extraAttr[attr].key %>="<%= tab.extraAttr[attr].value %>"\n      <%\n          }\n        }\n      %>\n    >\n      <%= tab.text %>\n    </button>\n  </li>\n<%\n  });\n%>'}),define("data/CleanedPopups",[],function(){"use strict";return["popupUser","popupCategoryList","popupUserGroupList","popupNtpServer","popupImageConfig","popupExpandCluster","popupConfigureCVM","popupClusterSSPConfig","popupHttpProxy","popupHostReboot","popupAutoSupport","popupAffinityRuleLegacy","popupSmtpServer","popupRedundancyState","popupRemoteSupport","popupClusterUpdate","popupAlertPolicy","popupUDAPolicy","popupIncreasePCResources","popupUpdateProfile","popupNetworkSwitchConfig","popupAntivirus","popupAddAdmins","popupPCScaleDeployment","popupNetworkConfig","popupTestSettings","popupLanguageSettings","popupDetailedTestDescription","popupMulticlusterSelfMonitor","popupNameServer","popupFileServer","popupChangePassword","popupEnableK8sCluster","popupDegradedNodeSettings","popupImageImport","popupLockDown","popupCitrixConnector","popupHighAvailability","popupVolumeGroup","popupAddDNS","popupShareWizard","popupUserManagement","popupPCVirtualIPDetails","popupManageKeys","popupMultiCategorySelector","popupConfirmHypervUpgradeWarning","popupVm","popupForcedSync","popupNewChart","popupAuthConfig","popupClusterUplinkDetails","popupNVMeGuide","popupReplaceDisk","popupCPAdjustNodes","popupCPAdjustWorkload","popupSaveScenarioView","popupVmRecoveryReplicate","popupVPNOnPremGatewayConfig","popupDirectoryServiceSelector","popupCasResolution","popupEnableFileInsights","popupDeployFileInsights","popupInitiator","popupFileServerUserMapping","popupSecurityPolicy","popupIDBasedSecurity","popupNetvizStats","popupChartView","popupCvmInterface"]}),define("utils/ModalMixin",[],function(){"use strict";function e(e){return e.$el.hasClass("modal")&&!!e.actionReferences}function t(e){var t=e.$el.closest(".modal")[0];return t&&t.id}function i(e){return n[e]}var n={};return{registerPopup:function(){e(this)&&(n[t(this)]=this)},unregisterPopup:function(){e(this)&&delete n[t(this)]},triggerAction:function(e,n){var s=t(this),a=i(s);a&&a[a.actionReferences[e]](n)},triggerActions:function(e){var t=this;_.isArray(e)&&e.length&&e.forEach(function(e){_.isString(e)?t.triggerAction(e):_.isArray(e)?t.triggerAction(e[0],e[1]):_.isObject(e)&&t.triggerAction(e.action,e.data)})}}}),define("views/basecomponents/popups/BasePopupView",["views/basecomponents/BaseView","managers/NavigationManager","managers/HelpManager","managers/I18nManager","managers/AccessManager","text!templates/popups/default/DefaultPopup.html","text!templates/popups/default/DefaultTabs.html","data/CleanedPopups","utils/ModalMixin","utils/CommonTemplates","utils/AppConstants","utils/AppUtil","utils/AntiscrollUtil","utils/ValidationUtil","events/AppEvents","components/Components"],function(e,t,i,n,s,a,r,o,l,c,u,d,h,p,T,E){"use strict";var S,g={host:!0,vm:!0},A={closeButton:!0,nestedAlert:!1,tabs:!1,stepTabs:!1,antiscroll:!0,footer:!0,title:"",alertContent:"",tabsList:"",bodyContent:"",footerButtons:""},m={isActive:!1,extraClasses:"",extraAttr:null,text:""},f=_.template(c.SAVING);return a=_.template(a),r=_.template(r),e.extend(_.extend({},l,{GATEWAY_RESTART_WAIT_PERIOD:15e3,SHOW_ALERT:"showAlert",mode:null,actionRoute:null,removePopupOnHide:!0,fullPagePopup:!1,overlayPopup:!1,updateHelpButtonTimeoutId:null,cleanedPopup:!1,settingPopup:!1,alertIsAnimating:!1,alertCallbacks:[],$scrollElt:null,scrollOptions:{},antiscrollInstance:null,hideHeaderTimeoutId:null,actionReferences:(S={},_defineProperty(S,u.MODAL.ACT.AS_REFRESH,"_refreshAntiscroll"),_defineProperty(S,u.MODAL.ACT.AS_REBUILD,"_rebuildAntiscroll"),_defineProperty(S,u.MODAL.ACT.ALERT_SHOW,"_showAlert"),_defineProperty(S,u.MODAL.ACT.ALERT_HIDE,"_hideAlert"),_defineProperty(S,u.MODAL.ACT.COVER_SHOW,"_showCover"),_defineProperty(S,u.MODAL.ACT.COVER_HIDE,"_hideCover"),_defineProperty(S,u.MODAL.ACT.TABS_SHOW,"_showTabs"),_defineProperty(S,u.MODAL.ACT.TABS_HIDE,"_hideTabs"),_defineProperty(S,u.MODAL.ACT.SET_TITLE,"_setTitle"),_defineProperty(S,u.MODAL.ACT.REVERT_TITLE,"_revertTitle"),_defineProperty(S,u.MODAL.ACT.SET_STEP,"_setStep"),_defineProperty(S,u.MODAL.ACT.SUBVIEW_SHOW,"showSubview"),S),initialize:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.cleanedPopup=!!this.el&&o.indexOf(this.el.id)>-1,e.prototype.initialize.apply(this,arguments),this.settingPopup=_.isBoolean(t.settingPopup)?t.settingPopup:this.settingPopup,this.registerAppEvents()},registerAppEvents:function(){!this.settingPopup&&this.clusterManager&&this.clusterManager.isMulticlusterNavMode()&&(_.bindAll(this,"onRouteChange"),T.onAppEvent(T.ROUTE_CHANGE,this.onRouteChange)),this.cleanedPopup&&(this.registerPopup(),this.$el.on("click.closeAlert",".alert .close",this._hideAlert.bind(this)),this.$el.on("click.selectStep",".step-tabs li:not(.disabled) button",this.onStepClick.bind(this)))},onRouteChange:function(){this.hide(!1,!0)},onStepClick:function(e){var t=$(e.currentTarget),i=t.closest("li").index();this.triggerAction(u.MODAL.ACT.SET_STEP,i),this.onClickStepCallback(i,t)},onClickStepCallback:function(e,t){},stopServices:function(){e.prototype.stopServices.apply(this,arguments)},defaultTemplate:function(e){return e=e||{},a(_.extend({},A,e,{isHiddenFooter:!s.hasAccessToSubmitActions()}))},defaultTabs:function(e){return r({tabs:e.map(function(e){return e=e||{},_.extend({},m,e)})})},defaultFooter:function(e){return e.reduce(function(e,t){return t.leftAligned&&(t.extraClasses=t.extraClasses+" pull-left"),e+E.button(t)},"")},updateFooterVisibility:function(){s.hasAccessToSubmitActions()||this.$(".n-modal-footer").addClass("hidden")},show:function(e){if(this.actionRoute=e,this.render(),this.updateFooterVisibility(),this.actionRoute&&this.actionRoute.action===u.ACTION_CREATE&&g[this.actionRoute.actionTarget]&&this.clusterManager.isMulticlusterNavMode()&&this.appendClusterListForMulticlusterUI(),this.actionRoute&&(this.overlayPopup=this.overlayPopup||this.actionRoute.actionRouteOverlay),this.$el.nutanixPopup({show:!0,fullPagePopup:this.fullPagePopup,overlayPopup:this.overlayPopup}),this.delegateModelEvents(),this.isClusterFFEnabled(u.FFLAGS.HELP_DOC)&&this.createHelpIcon(e),this.$scrollElt=this.$(".antiscroll-wrap"),this.cleanedPopup){var t=this.$(".step-tabs li").filter(".active").index();this.triggerAction(u.MODAL.ACT.SET_STEP,t),this.scrollOptions={x:!1},this.applyAntiScroll()}},_initSteps:function(){if(!this.cleanedPopup)return void(this.hasSteps=!1);this.$steps=this.$(".step-tabs li"),this.hasSteps=this.$steps.length>0},_setStep:function(e){if(void 0===this.hasSteps&&this._initSteps(),this.hasSteps){(void 0===e||e<0)&&(e=0);var t=this.$steps.eq(e);this.$steps.removeClass("disabled active"),t.addClass("active").nextAll().addClass("disabled")}},_getAlertContainer:function(){return this.settingPopup?this.$el.closest(".main-body-wrapper").find(".main-alert-header"):this.$(".n-modal-alert-header")},_showAlert:function(e){e=this._getAlertOptionsBasedOnType(e||{}),this._populateAlertTpl(e.tplOptions),e._callback&&e._callback.bind(this)(),this._slideAlert(!0,this._getAlertCloseTiming(e.closeTiming))},_hideAlert:function(){this._slideAlert()},_getAlertOptionsBasedOnType:function(){var e,t=(e={},_defineProperty(e,u.MODAL.ALERT.TYPE_INFO,function(e){return{closeTiming:e.closeTiming||u.MODAL.ALERT.CLOSE_TYPE_DEFAULT,tplOptions:{style:u.MODAL._ALERT.STYLE_INFO,closeButton:!e.cbSet||e.closeButton,message:e.message||this.i18n("alerts.info")}}}),_defineProperty(e,u.MODAL.ALERT.TYPE_SUCCESS,function(e){return{closeTiming:e.closeTiming||u.MODAL.ALERT.CLOSE_TYPE_DEFAULT,tplOptions:{style:u.MODAL._ALERT.STYLE_SUCCESS,closeButton:!e.cbSet||e.closeButton,message:e.message||this.i18n("alerts.success")}}}),_defineProperty(e,u.MODAL.ALERT.TYPE_WARNING,function(e){return{closeTiming:e.closeTiming||u.MODAL.ALERT.CLOSE_TYPE_DEFAULT,tplOptions:{style:u.MODAL._ALERT.STYLE_WARNING,closeButton:!e.cbSet||e.closeButton,message:e.message||this.i18n("alerts.warning")}}}),_defineProperty(e,u.MODAL.ALERT.TYPE_ERROR,function(e){var t={closeTiming:e.closeTiming||u.MODAL.ALERT.CLOSE_TYPE_PERMANENT,tplOptions:{style:u.MODAL._ALERT.STYLE_ERROR,closeButton:!e.cbSet||e.closeButton}},i=d.processAjaxError(e.message),n=d.processThrownError(i||this.i18n("alerts.server_error"),e.isHtml);return e.description&&(n=e.description+" "+n),e.details&&(t.tplOptions.tooltip=d.processAjaxError(e.details),t._callback=function(){this.$(".n-error-details").tooltip({placement:"bottom",trigger:"hover",container:"body",html:!e.displayDetailsAsTxt})}),e.routeObj&&(e.routeObj.options&&"click"===e.routeObj.options.trigger?t.tplOptions.clickLink=e.routeObj:t.tplOptions.link=e.routeObj),t.tplOptions.message=n,t}),_defineProperty(e,u.MODAL.ALERT.TYPE_LOADING,function(e){return t[u.MODAL.ALERT.TYPE_INFO].bind(this)(_.extend({},e,{cbSet:!0,closeButton:!!e.cbSet&&e.closeButton,closeTiming:e.closeTiming||u.MODAL.ALERT.CLOSE_TYPE_PERMANENT,message:this.i18n("alerts.loading")}))}),_defineProperty(e,u.MODAL.ALERT.TYPE_SAVING,function(e){return t[u.MODAL.ALERT.TYPE_INFO].bind(this)(_.extend({},e,{cbSet:!0,closeButton:!!e.cbSet&&e.closeButton,closeTiming:e.closeTiming||u.MODAL.ALERT.CLOSE_TYPE_PERMANENT,message:this.i18n("alerts.saving")}))}),_defineProperty(e,u.MODAL.ALERT.TYPE_NODATA,function(e){return t[u.MODAL.ALERT.TYPE_ERROR].bind(this)(_.extend({},e,{cbSet:!0,closeButton:!!e.cbSet&&e.closeButton,closeTiming:e.closeTiming||u.MODAL.ALERT.CLOSE_TYPE_DEFAULT,message:this.i18n("alerts.no_data")}))}),_defineProperty(e,u.MODAL._ALERT.TYPE_DEFAULT,function(e){return t[u.MODAL.ALERT.TYPE_INFO].bind(this)(_.extend({},e,{cbSet:!0,closeButton:!!e.cbSet&&e.closeButton}))}),e);return function(e){return e.cbSet=_.isBoolean(e.closeButton),(t[e.type]||t[u.MODAL._ALERT.TYPE_DEFAULT]).bind(this)(e)}}(),_getAlertCloseTiming:function(){var e,t=(e={},_defineProperty(e,u.MODAL.ALERT.CLOSE_TYPE_FAST,u.MODAL._ALERT.CLOSE_TIMER_FAST),_defineProperty(e,u.MODAL.ALERT.CLOSE_TYPE_SLOW,u.MODAL._ALERT.CLOSE_TIMER_SLOW),_defineProperty(e,u.MODAL.ALERT.CLOSE_TYPE_PERMANENT,u.MODAL._ALERT.CLOSE_TIMER_PERMANENT),_defineProperty(e,u.MODAL.ALERT.CLOSE_TYPE_DEFAULT,u.MODAL._ALERT.CLOSE_TIMER_DEFAULT),e);return function(e){return _.isNumber(e)?e:t[e]||t[u.MODAL.ALERT.CLOSE_TYPE_DEFAULT]}}(),_populateAlertTpl:function(e){var t="";e.link?t=c.ALERT_LINK(e.link):e.clickLink?t=c.ALERT_CLICK_LINK(e.clickLink):e.tooltip&&(t=c.ALERT_TOOLTIP(_.extend({},e,{text:this.i18n("alerts.show_why")}))),this._getAlertContainer().html(c.DEFAULT_ALERT({style:e.style,closeButton:e.closeButton,content:e.message+t}))},_slideAlert:function(e,t){var i=this,n=arguments;clearTimeout(this.hideHeaderTimeoutId),this.alertIsAnimating?this.alertCallbacks.push(function(){i._slideAlert.apply(i,n)}):(this.alertIsAnimating=!0,this._getAlertContainer()[e?"slideDown":"slideUp"]({duration:u.MODAL.ALERT.SLIDING_DURATION,complete:function(){i.alertIsAnimating=!1,i.alertCallbacks.length?i.alertCallbacks.shift()():_.isNumber(t)&&(i.hideHeaderTimeoutId=setTimeout(function(){i._slideAlert()},t))}}))},_refreshAntiscroll:function(){h.refreshAntiscroll(this.antiscrollInstance)},_rebuildAntiscroll:function(){this.$scrollElt&&(h.rebuildAntiScroll(this.$scrollElt,this.scrollOptions),this.antiscrollInstance=this.$scrollElt.data("antiscroll"))},_showCover:function(){this.$(".n-modal-wrapper").addClass(u.MODAL._CLASS.COVER)},_hideCover:function(){this.$(".n-modal-wrapper").removeClass(u.MODAL._CLASS.COVER)},_showTabs:function(){this.$(".n-modal-tabs").removeClass(u.MODAL._CLASS.TABS)},_hideTabs:function(){this.$(".n-modal-tabs").addClass(u.MODAL._CLASS.TABS)},discardChanges:function(){this.render()},hide:function(e){var t=this,i=function(){t.$el.nutanixPopup({show:!1,removePopup:t.removePopupOnHide,fullPagePopup:t.fullPagePopup,overlayPopup:t.overlayPopup,cleanUp:_.bind(t.destroy,t)}),t.resetVerticalPosition(),t.actionRoute?$("body").trigger(T.POPUP_CLOSE,[t.actionRoute]):$("body").trigger(T.POPUP_CLOSE),clearTimeout(t.updateHelpButtonTimeoutId)};(this.canHide()||e)&&this.confirmHide(i)},confirmHide:function(e){e()},canHide:function(){return!$("#nutanixConfirmModal:visible").length},showForm:function(e,t){},showList:function(){},reset:function(e){},confirmDelete:function(e,t){t=t||{};var i=e[u.NAV_ACTION_TARGET],s=e[u.NAV_ACTION_TARGET_NAME],a=void 0;a=i===u.ENTITY_HOST||i===u.ENTITY_DISK?n.t("BasePopupView","action_remove_disk_or_host"):n.t("BasePopupView","action_delete");var r="entityNames."+i,o=u.ENTITY_NAMES[i].toLowerCase(),l=n.t("AppUtil",r,o).toLowerCase(),c=n.ts("BasePopupView","confirm_delete",[{actionText:a,entityTypeText:l,entityName:s}]),h=u.DELETE_WARNING_MESSAGES[i];h&&(t.extHTML=t.extHTML?h+"<br>"+t.extHtml:h),$.nutanixConfirm(_.defaults({},t,{msg:c,context:this,class:"-compact -red-confirm",yesText:d.toTitleCase(a),yes:function(){this.deleteEntity(e[u.NAV_ACTION_TARGET],e[u.NAV_ACTION_TARGET_ID],e[u.NAV_ACTION_TARGET_NAME]),this.hide()},no:function(){this.hide()}}))},navigateToHelpPage:function(e){i.navigationToHelpPage(this.getHelpUrl(e))},onKBLinkClick:function(e){var t=$(e.currentTarget);if(t.attr(u.NAV_ACTION)===u.ACTION_NAVIGATE_TO_KB){var n=t.attr(u.NAV_ACTION_TARGET);i.navigateToHelpPageBasedOnKB(n)}},getHelpUrl:function(e){return i.getHelpUrlForAction(e)},createHelpIcon:function(e){e=e||this.actionRoute,this.getHelpUrl(e)?this.$(".modal-header .help-icon").length>0?this.updateHelpButton(e):this.updateHelpButtonWithDelay(e):this.destroyHelpIcon()},updateHelpButtonWithDelay:function(e){this.updateHelpButtonTimeoutId=setTimeout(function(){this.updateHelpButton(e)}.bind(this),500)},updateHelpButton:function(e){var t=this.$(".modal-header");if(0===t.length)return void this.updateHelpButtonWithDelay(e);var i=t.find(".help-icon");i.length>0?i.off("click"):i=$('<div class="help-icon"><i aria-hidden="true" data-icon="O"></i></div>').appendTo(this.$(".modal-header")),i.click(function(){this.navigateToHelpPage(e)}.bind(this))},destroyHelpIcon:function(){this.$(".modal-header  .help-icon").remove()},onKeyPress:function(e){if(this.cleanedPopup?this._hideAlert():this.clearHeader(),13===e.keyCode)this.onEnterKeyPress(),e.preventDefault();else{var t=$(e.currentTarget);p.removeError(t)}},onEnterKeyPress:function(){},showSubview:function(e,t,i,n){var s=this;n=n||{},_.defaults(n,{duration:500});var a=0;if(!i){var r=n.complete;n.complete=function(){r&&r(),s.cleanedPopup&&s.triggerAction(u.MODAL.ACT.AS_REBUILD)},a="left"===t?"600px":"-560px"}this.$(e).css({left:a}),this.$(e).show({complete:function(){s.cleanedPopup&&s.triggerAction(u.MODAL.ACT.AS_REBUILD),i||s.$(e).animate({left:"0px"},n)},duration:0})},hideSubview:function(e){var t=this;this.$(e).hide({complete:function(){t.cleanedPopup&&t.triggerAction(u.MODAL.ACT.AS_REBUILD)},duration:0})},scrollToBottom:function(){var e=this.$(".n-modal-body");$(e).animate({scrollTop:$(e).prop("scrollHeight")-$(e).height()},0,"fast")},scrollToTop:function(e){var t=this.$(".n-modal-body");e?$(t).animate({scrollTop:"0px"},0):$(t).animate({scrollTop:"0px"},"fast")},resetVerticalPosition:function(){this.$el.css("top","")},clearHeader:function(){this.$(".n-modal-alert-header").slideUp(300),this.$(".n-modal-alert-header").removeClass("not-empty")},destroy:function(){this.$(".n-error-details").tooltip("destroy"),!this.settingPopup&&this.clusterManager&&this.clusterManager.isMulticlusterNavMode()&&T.offAppEvent(T.ROUTE_CHANGE,this.onRouteChange),this.cleanedPopup&&(this.antiscrollInstance&&this.antiscrollInstance.destroy(),this.$el.off("click.closeAlert"),this.$el.off("click.selectStep"),this.unregisterPopup()),this.destroyHelpIcon(),e.prototype.destroy.apply(this,arguments)},showHeaderSuccess:function(e){e=e||"Success";var t=c.SUCCESS({msg:e});this._showHeader(t)},showHeaderError:function(e,t,i){var n=void 0;_.isString(e)?n=e:_.isString(t)?n=t:t&&t.responseText&&(n=t.responseText);var s=!0;_.isBoolean(t)?s=t:_.isBoolean(i)&&(s=t),n=d.processAjaxError(n,s),n=d.removeServerException(n)||"Server Error",this.showHeaderTextError(n)},showHeaderErrorWithDescription:function(e,t){var i=d.processThrownError(e);t&&(i=t+" "+i),this.showHeaderTextError(i)},showHeaderErrorWithAction:function(e,t){var i=c.ERROR_WITH_ACTION({error:e,routeObj:t});this._showHeader(i)},showHeaderTextError:function(e){var t=c.ERROR({error:e});this._showHeader(t),this.$(".n-modal-body").animate({scrollTop:0},300)},showHeaderInfo:function(e){e=e||"Info";var t=c.INFO({msg:e});this._showHeader(t)},showHeaderWarning:function(e){e=e||"Warning";var t=c.WARNING({msg:e});this._showHeader(t)},showHeaderErrorWithDetails:function(e,t,i){var n={};n.error=d.removeServerException(e)||"Server Error",n.details=d.processAjaxError(t)||"No details available";var s=c.ERROR_DETAILS(n);this._showHeader(s),this.$(".n-error-details").tooltip({placement:"right",trigger:"hover",container:"body",html:!i}),this.$(".n-modal-body").animate({scrollTop:0},300)},showHeaderLoading:function(e){e=e||this.i18n("loading"),this.showHeaderInfo(e)},showHeaderSaving:function(e){var t=e||"Saving";t+=u.ELLIPSIS_TEXT,this._showHeader(f({message:t}))},showHeaderNoData:function(){this._showHeader(c.NO_DATA)},_showHeader:function(e){var t=this.$(".n-modal-alert-header.not-empty .alert").is(":visible");this.$(".n-modal-alert-header").html(e),this.$(".n-modal-alert-header").slideDown(300),this.$(".n-modal-alert-header").addClass("not-empty"),t||this.$(".n-modal-alert-header").trigger(this.SHOW_ALERT)},_setTitle:function(e){this.setTitle(e)},_revertTitle:function(){this.revertTitle()},setTitle:function(e){var t=this.$(".n-title");t.attr("data-old-title",t.text()),t.text(e)},revertTitle:function(){var e=this.$(".n-title"),t=e.attr("data-old-title");t&&(e.text(t),e.removeAttr("data-old-title"))},appendClusterListForMulticlusterUI:function(){},onClusterChange:function(e){this.currentSelectedClusterUUId=e.currentTarget.attr("value")},getCurrentSelectedClusterUUId:function(){return this.currentSelectedClusterUUId},applyAntiScroll:function(e,t,i,n){var s=this;n=n||this.scrollOptions||{},e?setTimeout(function(){s._createAntiScroll(t,i,n)},e):this._createAntiScroll(t,i,n)},_createAntiScroll:function(e,t,i){i=i||{},e=(e||this.$(".n-modal-body").width())+"px",t=(t||this.$(".n-modal-body").height())+"px",this.$scrollElt=this.$scrollElt&&this.el.contains(this.$scrollElt[0])?this.$scrollElt:this.$(".antiscroll-wrap"),h.applyAntiScroll(this.$scrollElt,e,t,i),this.antiscrollInstance=this.$scrollElt.data("antiscroll"),this.$scrollElt.css("visibility","visible")},showReload:function(e,t){var i=this;this.$(".modal-header button").remove(),this.$(".n-modal-content-wrapper").html(c.GATEWAY_RESTART({subject:e})),this.$(".btnBack").hide(),this.$(".btnSave").hide(),this.$(".btnClose").hide(),this.$(".btnImport").hide(),setTimeout(function(){d.log("Automatically logging out the user."),i.logout(t)},this.GATEWAY_RESTART_WAIT_PERIOD)},logout:function(e){t.navigateToRoute(e)},disableCloseButton:function(e){var t=this.$(".modal-header .close");t.addClass("disabled"),e&&t.tooltip({title:e,placement:"bottom",trigger:"hover",html:"false",template:'<div class="tooltip closebtn-tooltip" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>'})},enableCloseButton:function(){var e=this.$(".modal-header .close");e.removeClass("disabled"),e.tooltip("destroy")}}))}),define("text!templates/popups/notification/NotificationPopupView.html",[],function(){return'\x3c!-- The parent div modal is #popupNotification --\x3e\n<div class="modal-header">\n  <button type="button" class="close" data-dismiss="modal">\n    <i data-icon="K" aria-hidden="true"></i>\n  </button>\n  <h4 class="n-title">Notification</h4>\n</div>\n<div class="n-modal-body">\n  <div class="n-modal-notification-content">\n    \x3c!-- @view: messages go here... --\x3e\n  </div>\n</div>\n<div class="modal-footer">\n  <button class="btnClose btn n-btn-form -blue" data-dismiss="modal">\n    Close\n  </button>\n</div>'}),define("views/popups/notification/NotificationPopupView",["jquery","backbone","views/basecomponents/popups/BasePopupView","data/DataProperties","text!templates/popups/notification/NotificationPopupView.html","views/notification/NotificationTemplates","models/hardware/HostCollection","managers/NavigationManager","utils/AppConstants","utils/AppUtil"],function(e,t,i,n,s,a,r,o,l,c){"use strict";return i.extend({el:"#popupNotification",hostCollection:null,events:{"click .modal-header .close":"hide","click .btnClose":"hide","click a.pageLink":"onPageLinkClick"},render:function(){this.template=_.template(s),this.$el.html(this.template)},show:function(e){i.prototype.show.apply(this,arguments);var t=this,n=e.getModelType();n===l.ENTITY_DATASTORE?(this.hostCollection=new r,this.hostCollection.fetch({success:function(i,n){t.renderDatastore(e)},error:function(e,i){t.getDOM(".n-modal-notification-content").html(c.processAjaxError(i.responseText))}})):n===l.ENTITY_SMB_SHARE||n===l.ENTITY_HYPERV_FAILOVER_CLUSTER||n===l.ENTITY_HYPERV_DOMAIN_JOIN?(this.hostCollection=new r,this.hostCollection.fetch({success:function(i,n){t.renderHypervNodeSpecificMessages(e)},error:function(e,i){t.getDOM(".n-modal-notification-content").html(c.processAjaxError(i.responseText))}})):t.renderNotificationMessage(e)},renderDatastore:function(e){this.$(".n-modal-notification-content").empty();for(var t=e.getNodeSpecificStatusArray(),i=0;i<t.length;i++){var s=this.hostCollection.get(t[i].nodeId),r="",o=e.get("model");if(o){var l=o.get(n.DATASTORE_NAME);if(l)r="for storage container '"+l+"'";else{var c=o.get(n.CONTAINER_NAME);c&&(r="for storage container '"+c+"'")}}this.$(".n-modal-notification-content").append(_.template(a.ROW_DATASTORE_MSG,{model:t[i],hostModel:s.toJSON(),containerMessage:r}))}},renderHypervNodeSpecificMessages:function(e){this.$(".n-modal-notification-content").empty();for(var t=e.getNodeSpecificStatusArray(),i=0;i<t.length;i++){var n=this.hostCollection.get(t[i].nodeId);this.$(".n-modal-notification-content").append(_.template(a.ROW_HYPERV_MSG,{model:t[i],hostModel:n.toJSON()}))}},renderNotificationMessage:function(e){this.$(".n-modal-notification-content").empty(),this.$(".n-modal-notification-content").html(c.removeServerException(e.getNotificationMessage()))},onPageLinkClick:function(t){var i=e(t.currentTarget);o.navigateToPageByPageLink(i),this.hide()}})}),define("views/notification/NotificationView",["bootstrap","models/BaseCollection","views/basecomponents/BaseView","views/popups/notification/NotificationPopupView","views/notification/NotificationTemplates","managers/NavigationManager","managers/ActionManager","utils/AppConstants","utils/AppUtil"],function(e,t,i,n,s,a,r,o,l){"use strict";return i.extend({TIME_DELAY:15e3,NOTIFICATION_LOADING:"loading",notificationCollection:null,events:{"click  .btnMoreInfo      ":"onClickBtnMoreInfo","click  .n-close          ":"onClickClose","click  .acropolisTaskLink":"onClickAcropolisTaskLink","click  .popupLink":"onClickPopupLink","click  .pageLink":"onPageLinkClick"},initialize:function(){this.render(),this.notificationCollection=new t},render:function(){},showNotification:function(e,t){if(void 0===t&&(t=!0),e.getStringMessage()||this.hideLatency(e.getLatencyId()),!_.find(this.notificationCollection.models,function(t){return t.getNotificationMessage()===e.getNotificationMessage()})){this.notificationCollection.add(e),this.$el.prepend(this.createNotificationHTML(e));var i=e.getNotificationId(),n=this;setTimeout(function(){$(n.getNotificationMsg(i)).addClass("n-show")},20),e.get("width")&&$(this.getNotificationMsg(i)).css("maxWidth",e.get("width")),t&&this.startCountDownHide(i)}},createNotificationHTML:function(e){var t=e.getNotifyTypeStyle(),i=e.getNotificationId(),n=l.removeServerException(e.getNotificationMessage()),a=!1;n.length>o.NOTIFICATION_LENGTH_LIMIT&&(n=l.truncateNotificationMessage(n),a=!0);var r="";return(e.hasMoreInfo()||a)&&(r+=_.template(s.BTN_MORE_INFO,{notificationId:i})),_.template(s.NOTIFICATION_MSG,{notificationId:i,notifyTypeStyle:t,message:n,buttons:r})},getNotificationMsg:function(e){return this.getDOM('div.n-notification-msg:[notificationId="'+e+'"]')},startCountDownHide:function(e){var t=this;setTimeout(function(){t.hideNotification(e)},this.TIME_DELAY)},hideNotification:function(e){var t=this;this.getNotificationMsg(e).removeClass("n-show").addClass("n-hide"),setTimeout(function(){t.getNotificationMsg(e).remove(),t.notificationCollection.remove(t.notificationCollection.get(e))},1e3)},showLatencyAction:function(e){var t=this.createLatencyHTML(e),i=e.getLatencyId();this._showLatencyMsg(t,i)},showLatencyMessage:function(e){var t=l.randomId(),i=l.randomId(),n=_.template(s.LATENCY_MSG,{notificationId:i,latencyId:t,
message:_.escape(e)});return this._showLatencyMsg(n,t),t},createLatencyHTML:function(e){var t=e.getNotificationId(),i=e.getLatencyId(),n=e.getLatencyMessage();return _.template(s.LATENCY_MSG,{notificationId:t,latencyId:i,message:_.escape(n)})},getLatencyMsg:function(e){return this.getDOM('div.n-notification-msg:[latencyId="'+e+'"]')},hideLatency:function(e){var t=this;this.getLatencyMsg(e).removeClass("n-show").addClass("n-hide"),setTimeout(function(){t.getLatencyMsg(e).remove()},1e3)},_showLatencyMsg:function(e,t){this.$el.prepend(e),$(this.getLatencyMsg(t)).removeClass("n-hide").addClass("n-show")},onClickBtnMoreInfo:function(e){var t=$(e.currentTarget).attr("notificationId"),i=this.notificationCollection.get(t);this.showNotificationPopup(i)},onClickClose:function(e){var t=$(e.currentTarget).attr("notificationId");t&&this.hideNotification(t);var i=$(e.currentTarget).attr("latencyId");i&&this.hideLatency(i)},onClickAcropolisTaskLink:function(e){var t='.page-vms .n-details-content-summary .n-tab-details-button[data-target="TASKS"]',i={};i[o.NAV_ACTION]=o.SUBPAGE_COMPONENT_DETAILS,i[o.NAV_ACTION_TARGET_ID]=o.ACTION_SUMMARY,i[o.NAV_ACTION_TARGET]=o.ENTITY_VM,a.navigateToPageByElement(o.PAGE_VMS,o.SUBPAGE_TABLE,i);var n={};n.intervalHandler=function(){$(".page-vms .n-nic-details");if($(t).is(":visible"))return $(t).click(),$("html, body").animate({scrollTop:$(t).offset().top},500),!0},n.intervalPeriod=200,n.timeoutPeriod=5e3,n.timeoutHandler=function(){l.log("NotificationView: onClickAcropolisTaskLink: Timed out waiting for tasks tab to render.")},l.setIntervalWithTimeout(n)},onClickPopupLink:function(e){r.executeActionElement(e.currentTarget)},onPageLinkClick:function(e){var t=$(e.currentTarget);a.navigateToPageByPageLink(t)},showNotificationPopup:function(e){var t=n.prototype.el;new n({el:l.createPopupContainer(t.replace("#",""))}).show(e)},showLoading:function(){this.getLatencyMsg(this.NOTIFICATION_LOADING).length&&this.getLatencyMsg(this.NOTIFICATION_LOADING).remove(),this.$el.prepend(s.LOADING),$(this.getLatencyMsg(this.NOTIFICATION_LOADING)).show()},hideLoading:function(){this.hideLatency(this.NOTIFICATION_LOADING)}})}),define("views/notification/NotificationBarView",["views/notification/NotificationView","utils/AppUtil","views/notification/NotificationTemplates","utils/AppConstants","data/DataProperties","events/AppEvents"],function(e,t,i,n,s,a){"use strict";var r=_.template('\n      <span class="nav-item" data-action="prev">\n        <%= Components.icon("caret-left")%>\n      </span>\n      <%= current %> / <%= total %>\n      <span class="nav-item" data-action="next">\n        <%= Components.icon("caret-right")%>\n      </span>'),o={},l=[n.NOTIFICATION_BAR.MICROSEG_TRIAL_PRECHECKS];return e.extend({activeMsgIdx:0,notificationBarType:n.NOTIFICATION_BAR.LICENSING,notificationTypesOrder:[n.NOTIFICATION_BAR.TECH_PREVIEW,n.NOTIFICATION_BAR.LICENSING,n.NOTIFICATION_BAR.LICENSE_INFO,n.NOTIFICATION_BAR.PULSE,n.NOTIFICATION_BAR.ENABLE_XFIT],events:{"click  .n-close":"onClickClose","click  .nav-item":"onClickMsgNav","click  .popupLink":"onClickPopupLink"},initialize:function(){this.render()},render:function(){},renderNotificationNav:function(){var e=this.$(".n-message"),t=this.$(".n-nav");e.length>1?(t.html(r(this.vtOptions({current:this.activeMsgIdx+1,total:e.length}))),t.show()):t.hide()},showNotificationBar:function(e,t,s){var a=!0;if(_.isUndefined(s)||(a=s),t=t||n.NOTIFICATION_BAR.LICENSING,!(sessionStorage.getItem(t)&&l.indexOf(t)<0)){var r=this.$(".n-message");if(!r.filter("#"+t).length){var o=$(_.template(i.NOTIFICATION_BAR_MSG,{id:t,message:e,showCloseBtn:a}));r.hide(),this.setNotificationAlertType(o),this.isAppend(r,t)?this.$el.append(o):this.$el.prepend(o),$("body").addClass("notification-bar-open"),this.refreshWindowSize(),this.renderNotificationNav()}}},setNotificationAlertType:function(e){var t=e.attr("id");if(t&&o[t]){var i=void 0;switch(o[t]){case s.ALERT_STATUS_VALUES.WARNING:i="-warning";break;case s.ALERT_STATUS_VALUES.INFO:i="-info"}i&&e.wrapInner($("<div>").addClass(i))}},hideNotificationBar:function(e,t){var i=null;if(e?i=$(e.target).closest(".n-message"):(t=t||n.NOTIFICATION_BAR.LICENSING,i=this.$(".n-message").filter("#"+t)),0!==i.length&&1===this.$(".n-message").length){if(!t){t=$(e.target).parents(".n-message").attr("id")}$("body").removeClass("notification-bar-open"),setTimeout(function(){i.remove()},1e3),a.triggerAppEvent(a.BANNER_CLOSE,{type:t})}else{i.remove();var s=this.$(".n-message");this.activeMsgIdx=this.activeMsgIdx<s.length?this.activeMsgIdx:s.length-1,s.eq(this.activeMsgIdx).show(),this.renderNotificationNav()}},onClickClose:function(e){this.hideNotificationBar(e),this.refreshWindowSize(),this.dismissNotificationOnClose(e)},onClickMsgNav:function(e){var t=this.$(".n-message"),i=t.length-1;"prev"===e.currentTarget.getAttribute("data-action")?this.activeMsgIdx=this.activeMsgIdx?this.activeMsgIdx-1:i:this.activeMsgIdx=this.activeMsgIdx===i?0:this.activeMsgIdx+1,t.hide(),t.eq(this.activeMsgIdx).show(),this.renderNotificationNav()},isAppend:function(e,t){var i=e.last().attr("id"),n=this.notificationTypesOrder.indexOf(i),s=this.notificationTypesOrder.indexOf(t);return-1!==n&&-1!==s&&n<s},refreshWindowSize:function(){setTimeout(function(){$(window).trigger("resize")},200)},dismissNotificationOnClose:function(e){var i=$(e.currentTarget),n=i.siblings(".dismissOnClose");n&&n.attr("dismissflag")&&t.hasLocalStorage()&&(localStorage[n.attr("dismissflag")]=!0);var s=i.closest(".n-message");s&&sessionStorage.setItem(s.attr("id"),!0)}})}),define("text!templates/header/HeaderView.html",[],function(){return'<div class="navbar navbar-fixed-top">\n\n  \x3c!-- Header: First Level\n  ================================================== --\x3e\n  <div class="n-header-level-1"></div>\n\n</div>'}),define("views/header/alert/AlertTemplates",[],function(){"use strict";return{ALERT_MENU_ITEM:_.template('<li class="n-nav-menu-item"><a class="n-alert-menuitem"><span class="n-alert-link" title="<%= message %>"><%= message %></span><span class="n-time"><%= time %></span></a></li>'),SHOW_ALL_ALERTS:'<li  class="n-nav-menu-item"><a class="n-alert-show-all n-alert-menuitem"><i class="n-bars"><span class="bar one"></span><span class="bar two"></span><span class="bar three"></span></i><span class="n-alert-link" action="details" actionTarget="alert"> See all alerts.</span></a></li>'}}),define("models/genesis/LajollaGenesisBaseModel",["models/genesis/GenesisBaseModel","utils/AppConstants"],function(e,t){"use strict";return e.extend({ERROR_MSG:"Error in retrieving response.",name:"LajollaGenesisBaseModel",managerName:t.GENESIS.CLUSTER_MANAGER})}),define("models/genesis/LaJollaClusterModel",["models/genesis/LajollaGenesisBaseModel","utils/AppConstants"],function(e,t){"use strict";return e.extend({ERROR_MSG:"Failed to get LaJolla Capability",name:"LaJollaClusterModel",methodName:t.CLUSTER_MANAGER_METHODS.IS_LA_JOLLA_CLUSTER})}),define("models/genesis/AzureOnboardingStatusModel",["models/genesis/LajollaGenesisBaseModel","utils/AppConstants"],function(e,t){"use strict";return e.extend({ERROR_MSG:"Failed to get Azure Onboarding status",name:"AzureOnboardingStatusModel",methodName:t.CLUSTER_MANAGER_METHODS.AZURE_ONBOARD_STATUS})}),define("utils/MenuConfigUtil",[],function(){"use strict";return{name:"MenuConfigUtil",getAllMenuItems:function(e,t){var i=[];return _.each(e.menuItems,function(e){_.each(e.items,function(e){i.push(e)}),t&&i.push({id:t})}),i},getItemsByEnvironment:function(e,t,i){var n=this.getAllMenuItems(e,i),s=_.filter(n,function(e){return e.id===i||e.environment&&-1!==e.environment.indexOf(t)});return _.map(s,function(e){return e.id})},getCategoryMapping:function(e){var t={};return _.each(e.menuItems,function(e){var i=[];t[e.groupId]=i,_.each(e.items,function(e){i.push(e.id)})}),t}}}),define("managers/PopupManager",["utils/AppConstants","utils/AppUtil","events/AppEvents","managers/AccessManager"],function(e,t,i,n){"use strict";return{currentActionRoute:null,popupViews:[],popupViewFactory:null,initialize:function(){_.bindAll(this,"renderPopupView","renderMultiplePopupView","reduceOpenPopupCount"),$.fn.modal.Constructor.prototype.enforceFocus=function(){},$("body").on(i.POPUP_CLOSE,this.reduceOpenPopupCount)},setPopupViewFactory:function(e){this.popupViewFactory=e},hasAccess:function(e){var i=t.getActionFromActionRoute(e),s=t.getEntityTypeFromActionRoute(e);return n.canModifyByEntityType(s,i)||n.canViewByEntityType(s,i)},handleAction:function(i){t.debug("PopupManager : showAction: "," | action: ",i[e.NAV_ACTION]," | actionTarget: ",i[e.NAV_ACTION_TARGET]," | actionTargetId: ",i[e.NAV_ACTION_TARGET_ID]," | actionTargetName: ",i[e.NAV_ACTION_TARGET_NAME]),this.hasAccess(i)?(this.currentActionRoute=i,t.showLoader(),this.showPopup(i[e.NAV_ACTION],i[e.NAV_ACTION_TARGET])):n.showActionDeniedMessage()},renderPopupView:function(i,n){t.hideLoader();var s=i.prototype.el,a=_.defaults({},n,_defineProperty({el:t.createPopupContainer(s.replace("#",""))},e.NAV_ACTION_ROUTE,this.currentActionRoute)),r=new i(a);return this.popupViews.push(r),r.show(a[e.NAV_ACTION_ROUTE]),r},renderMultiplePopupView:function(e){t.hideLoader();var i=e.prototype.el;if(this.popupViews.length&&$("body").hasClass("n-popup-show")&&$("#globalModalContainer").find(i).length){this.currentPopupView().renderCreateUpdate(this.currentActionRoute)}else{var n=new e({el:t.createPopupContainer(i.replace("#",""))});n.show(this.currentActionRoute),this.popupViews.push(n)}},currentPopupView:function(){return _.last(this.popupViews)},renderWizardPopupView:function(e,t){this.currentActionRoute=t,this.renderPopupView(e)},showPopup:function(e,t){if(!this.popupViewFactory)throw new Error("PopupManager: Missing PopupViewFactory.");this.popupViewFactory.showPopup(e,t,this.renderPopupView,this.renderMultiplePopupView)},hidePopup:function(e){var t=this.currentPopupView();this.popupViews.length&&t.$el&&t.$el.is(":visible")&&t.hide(e)},isPopupVisible:function(){return $("#globalModalContainer .modal:visible:not(#nutanixConfirmModal)").length>0},reduceOpenPopupCount:function(){this.popupViews.pop()}}}),define("text!templates/communityedition/CommunityEditionPrecheck.html",[],function(){return'<div class="n-community-edition-precheck-container">\n  \x3c!-- NEXT account --\x3e\n  <section id="sectionNext" isNextAccount="true">\n    \x3c!-- Status icons --\x3e\n    <div class="n-precheck-status-icon-container">\n      <div class="n-precheck-status-icon  donut-loader-blue" state="loading">\n      </div>\n      <div class="n-precheck-status-icon  success" state="success"\n          style="display: none">\n        <i aria-hidden="true" data-icon="G"></i>\n      </div>\n      <div class="n-precheck-status-icon  fail" state="fail"\n          style="display: none">\n        <%= SVG.SVGIcon(\'M\') %>\n      </div>\n    </div>\n    \x3c!-- Message --\x3e\n    <div class="n-message" state="loading">\n      Checking NEXT account...\n    </div>\n    <div class="n-message" state="success" style="display:none">\n      NEXT account is enabled.\n    </div>\n    <div class="n-message" state="fail" style="display:none">\n      <span id="lblNextCredentialsReq">NEXT Credentials</span>\n      <p></p>\n      <div id="nextForm" class="n-next-form">\n      </div>\n    </div>\n  </section>\n\n  \x3c!-- Pulse --\x3e\n  <section id="sectionPulse" isNextAccount="false">\n    \x3c!-- Status icons --\x3e\n    <div class="n-precheck-status-icon-container">\n      <div class="n-precheck-status-icon  donut-loader-blue" state="loading">\n      </div>\n      <div class="n-precheck-status-icon  success" state="success"\n          style="display: none">\n        <i aria-hidden="true" data-icon="G"></i>\n      </div>\n      <div class="n-precheck-status-icon  fail" state="fail"\n          style="display: none">\n        <i aria-hidden="true" data-icon="v"></i>\n      </div>\n    </div>\n    \x3c!-- Message --\x3e\n    <div class="n-message" state="loading">\n      Checking Pulse connectivity...\n    </div>\n    <div class="n-message" state="success" style="display:none">\n      Pulse is enabled.\n    </div>\n    <div class="n-message" state="fail" style="display:none">\n      Pulse Connectivity Failure\n      <p>\n        Pulse provides diagnostic system data to Nutanix support teams.\n        Please ensure that Pulse is not blocked by your network.\n      </p>\n      <a class="n-precheck-link" type="pulse"\n         action="show" actionTarget="upgrade">Retry Connection</a>\n    </div>\n  </section>\n\n  \x3c!-- Upgrade --\x3e\n  <section id="sectionUpgrade" isNextAccount="false">\n    \x3c!-- Status icons --\x3e\n    <div class="n-precheck-status-icon-container">\n      <div class="n-precheck-status-icon  donut-loader-blue" state="loading">\n      </div>\n      <div class="n-precheck-status-icon  success"\n          state="success" style="display: none">\n        <i aria-hidden="true" data-icon="G"></i>\n      </div>\n      <div class="n-precheck-status-icon  fail" state="fail"\n          style="display: none">\n        <i aria-hidden="true" data-icon="v"></i>\n      </div>\n    </div>\n    \x3c!-- Message --\x3e\n    <div class="n-message" state="loading">\n      Checking available software update...\n    </div>\n    <div class="n-message" state="success" style="display:none">\n      Your Acropolis version is up to date.\n    </div>\n    <div class="n-message" state="fail" style="display:none">\n      New Acropolis Version Available\n      <p>\n        To access Prism, you need the latest Acropolis version.\n      </p>\n      <a class="n-precheck-link" type="upgrade"\n        action="upgrade" actionTarget="upgrade">Upgrade to latest Acropolis</a>\n    </div>\n  </section>\n</div>'}),define("views/communityedition/CommunityEditionPrecheckView",["views/basecomponents/BaseView","managers/PopupManager","utils/AppConstants","utils/AppUtil","utils/SVG","events/AppEvents","text!templates/communityedition/CommunityEditionPrecheck.html","text!templates/login/LoginNextFormView.html","text!templates/login/LoginNextDisabledView.html"],function(e,t,i,n,s,a,r,o,l){"use strict";var c=_.template(r),u=_.template(o),d=_.template(l);return e.extend({id:"precheckWrapperCE",className:"n-community-edition-precheck-wrapper",events:{"click  .n-precheck-link":"onClickPrecheckLink","click  #btnLogin":"onEnterNextCredentials","keyup  #inputPassword":"onKeyUpPassword"},render:function(){return this.$el.html(c({SVG:s})),this},destroy:function(){e.prototype.destroy.apply(this,arguments),this.$el.remove()},updatePulseStatus:function(e){this.$('#sectionPulse  [state="loading"]').hide(),e?this.$('#sectionPulse  [state="success"]').show():this.$('#sectionPulse  [state="fail"]').show()},updateSoftwareVersionStatus:function(e){this.$('#sectionUpgrade  [state="loading"]').hide(),e?this.$('#sectionUpgrade  [state="success"]').show():this.$('#sectionUpgrade  [state="fail"]').show()},fadeOut:function(e){this.$el.fadeOut("slow",e)},showUpgradePopup:function(){t.handleAction({action:i.ACTION_UPGRADE,actionTarget:i.ENTITY_UPGRADE})},updateNextStatus:function(e){this.nextCredentialModel=e,this.$('#sectionNext  [state="loading"]').hide(),this.nextCredentialModel.isCommunityEditionOverallCredentialValid()?(this.$('#sectionNext  [state="success"]').show(),this.$('[isNextAccount="false"]').show()):(this.$('#sectionNext  [state="fail"]').show(),this.$('[isNextAccount="false"]').hide(),this.$("#lblNextCredentialsReq").hide(),this.$("#sectionNext .n-precheck-status-icon.fail").hide(),this.nextCredentialModel.isCommunityEditionCredentialAccepted()?this.nextCredentialModel.isCommunityEditionCredentialEnabled()||this.showDisabledNext():this.showDefaultNextRegistration())},showDefaultNextRegistration:function(){this.$("#lblNextCredentialsReq").show(),this.$("#sectionNext .n-precheck-status-icon.fail").show(),this.$("#nextForm").html(u({SVG:s}))},showDisabledNext:function(){this.$("#nextForm").html(d({message:this.nextCredentialModel.getNextMessageForFailure(),SVG:s}))},showSpinner:function(){this.$(".loginSubmitArrow").hide(),this.$(".donut-loader").show()},hideSpinner:function(){this.$(".loginSubmitArrow").show(),this.$(".donut-loader").hide()},showError:function(e,t){var i="";_.isString(e)?i=e:_.isObject(e)&&e.responseText&&(i=n.processAjaxError(e.responseText)),i||(i="Oops... A server error occurred."),e&&this.$("#msgError").html(i).show(),(t=void 0===t||t)&&this.$("#inputPassword").val("").focus()},onClickPrecheckLink:function(e){var t=$(e.currentTarget),i=t.attr("type");"pulse"===i?this.trigger(a.FETCH_LOGIN_POST_DATA):"upgrade"===i&&this.showUpgradePopup()},onKeyUpPassword:function(e){var t=$.ui.keyCode;e.keyCode===t.ENTER&&this.onEnterNextCredentials()},onEnterNextCredentials:function(){this.$("#msgError").hide(),this.showSpinner();var e=this;this.nextCredentialModel.saveNextCredential({username:this.$("#inputUsername").val(),password:this.$("#inputPassword").val()},{success:function(){e.trigger(a.FETCH_LOGIN_POST_DATA)},error:function(t,i){e.showError(i),e.hideSpinner()}})}})}),define("managers/CommunityEditionManager",["managers/AppManager","managers/NamespaceManager","managers/LoginManager","models/login/NextCredentialModel","data/DataProperties","events/AppEvents","utils/AppUtil","views/communityedition/CommunityEditionPrecheckView"],function(e,t,i,n,s,a,r,o){"use strict";return{MICROSECONDS_OF_15_DAYS:1296e9,MICROSECONDS_OF_30_DAYS:2592e9,TEMPLATE_CE_LOGO:'<img src="./app/assets/images/common/header-logo-ce.png">',LABEL_COMMUNITY_EDITION:"Community Edition",_initialized:!1,_successCallbacks:null,precheckView:null,nextCredentialModel:null,initialize:function(){this._successCallbacks=[]},registerCallbackSuccessfulPrechecks:function(e){this._successCallbacks.push(e)},startPrechecks:function(){this.destroyPrechecks(),$("body").addClass("n-community-edition").addClass("n-community-edition-hide-elements-during-precheck");var t=$("#n-header .header-logo .n-logo-link");t.find("svg").remove(),t.html(this.TEMPLATE_CE_LOGO),t.parent().width(45),e.showHideHeaderElements(!1),this.precheckView=new o,this.precheckView.on(a.FETCH_LOGIN_POST_DATA,this.fetchPostLoginData,this),$("body").append(this.precheckView.render().el);var i=this;setTimeout(function(){r.hideLoader(),i.checkNextCredential(),i.checkPulse(),i.checkSoftwareVersion(),i.isValidCommunityEdition()&&i.finishSuccessfulPrechecks()},2e3)},finishSuccessfulPrechecks:function(){var t=this;setTimeout(function(){e.showHideHeaderElements(!0),_.each(t._successCallbacks,function(e){_.isFunction(e)&&e()},t),t.precheckView.fadeOut(function(){t.destroyPrechecks()})},2e3)},destroyPrechecks:function(){$("body").removeClass("n-community-edition-hide-elements-during-precheck"),this.precheckView&&(this.precheckView.destroy(),this.precheckView.off(a.FETCH_LOGIN_POST_DATA,this.fetchPostLoginData,this),this.precheckView=null)},checkPulse:function(){var e=this.isPulseValid();return this.precheckView.updatePulseStatus(e),e},checkSoftwareVersion:function(){var e=this.isSoftwareVersionValid();return this.precheckView.updateSoftwareVersionStatus(e),e},checkNextCredential:function(){this.setupNextCredentialModel(),this.precheckView.updateNextStatus(this.nextCredentialModel)},getCommunityEditionValue:function(e){var i=t.get(t.SESSION_INFO)[s.COMMUNITY_EDITION];if(i)return i[e]},getPrecheckValue:function(e){return t.get(t.SESSION_INFO)[e]},isCommunityEditionCluster:function(){return t.get(t.SESSION_INFO)[s.IS_COMMUNITY_EDITION]},isPulseValid:function(){var e=!0;this.getPrecheckValue(s.CE_TUNNEL_DOWN)&&(e=this.getPrecheckValue(s.CE_TUNNEL_DOWN_TIME)<=this.MICROSECONDS_OF_15_DAYS);return e},isSoftwareVersionValid:function(){var e=!0;return this.getPrecheckValue(s.CE_UPGRADE_AVAILABLE)&&(e=!1),e},isValidCommunityEdition:function(){return this.isPulseValid()&&this.isSoftwareVersionValid()&&this.isCommunityEditionOverallCredentialValid()},isCommunityEditionOverallCredentialValid:function(){return this.setupNextCredentialModel(),this.nextCredentialModel.isCommunityEditionOverallCredentialValid()},isCommunityEditionCredentialAccepted:function(){return this.nextCredentialModel.isCommunityEditionCredentialAccepted()},isCommunityEditionCredentialEnabled:function(){return this.nextCredentialModel.isCommunityEditionCredentialEnabled()},hasNextUserAccount:function(){return!!t.get(t.SESSION_INFO)[s.COMMUNITY_EDITION]},isCommunityEditionButNoNextAccount:function(){return this.isCommunityEditionCluster()&&!this.hasNextUserAccount()},setupNextCredentialModel:function(){this.nextCredentialModel||(this.nextCredentialModel=new n);var e=this.getPrecheckValue(s.COMMUNITY_EDITION);this.nextCredentialModel.set(e)},isPreCheckMode:function(){return!!this.precheckView},fetchPostLoginData:function(){var e=this,t=function(){e.setupNextCredentialModel(),e.startPrechecks()},n=function(){r.log("CommunityEditionManager : Error in fetching post login data.")};i.fetchPostLoginData(t,n)}}}),define("models/genesis/ConfiguredNodesModel",["backbone","models/genesis/GenesisBaseModel","utils/AppConstants"],function(e,t,i){"use strict";return t.extend({name:"UnConfiguredNodesModel",methodName:i.NODE_MANAGER_METHODS.DISCOVER_CONFIGURED_NODES,managerName:i.GENESIS.NODE_MANAGER,getReturnResponse:function(){return this.get(t.DP.GENESIS_RETURN)||[]},parse:function(i,n){return i=t.prototype.parse.call(this,i,n),i[t.DP.GENESIS_RETURN]=new e.Collection(i[t.DP.GENESIS_RETURN]),i}})}),define("models/genesis/GetIPModel",["models/genesis/GenesisBaseModel","utils/AppConstants"],function(e,t){"use strict";return e.extend({name:"GetIPModel",methodName:t.NODE_MANAGER_METHODS.GET_IP,managerName:t.GENESIS.NODE_MANAGER,getReturnResponse:function(){return this.get(e.DP.GENESIS_RETURN)||[]},getIPs:function(){var e=this.getReturnResponse();return _.map(e,function(e){return e?e.address:null})},getSubnetMasks:function(){var e=this.getReturnResponse();return _.map(e,function(e){return e?e.netmask:null})}})}),define("utils/BlockConstants",[],function(){"use strict";return{MODEL_DESKTOP:"Desktop",MODEL_NULL:"Null",MODEL_NX2000:"NX2000",MODEL_NX3000:"NX3000",MODEL_NX3050:"NX3050",MODEL_NX3060:"NX3060",MODEL_NX6020:"NX6020",MODEL_NX6050:"NX6050",MODEL_NX6060:"NX6060",MODEL_NX6070:"NX6070",MODEL_NX6080:"NX6080",MODEL_NX1050:"NX1050",MODEL_NX1020:"NX1020",MODEL_NX7010:"NX7010",MODEL_NX7110:"NX7110",MODEL_NX6220:"NX6220",MODEL_NX6280:"NX6280",MODEL_NX9040:"NX9040",POSITION_C:"C",POSITION_L:"L",POSITION_R:"R",POSITION_TL:"TL",POSITION_TR:"TR",POSITION_BL:"BL",POSITION_BR:"BR",MIN_HOST_COUNT:{NX2000:4,NX3000:4,NX3050:4,NX3060:4,NX1050:4,NX1020:4,Desktop:4,Null:4,NX6020:2,NX6050:2,NX6060:2,NX6070:2,NX6080:2,NX6220:2,NX6280:2,NX7010:1,NX7110:1,NX9040:2},DISK_ON_HOST_COUNT:{NX2000:6,NX3000:6,NX3050:6,NX3060:6,NX1050:6,NX1020:3,Desktop:6,Null:6,NX6020:6,NX6050:6,NX6060:6,NX6070:6,NX6080:6,NX6220:6,NX6280:6,NX7010:8,NX7110:8,NX9040:6},BLOCK_DIM:{WIDTH:"450",HEIGHT:"120",MARGIN:"6",FRONT_HEIGHT:"0.35",REAR_HEIGHT:"0.65"}}}),define("text!templates/basecomponents/diagrams/hardware/DiskGroup2U4NodeView.html",[],function(){return'\x3c!-- Disk Group for 2U 4Node Block\n     (Front of Block)\n  ================================================== --\x3e\n<div class="n-hardware-disk-node-group-4-node"\n  ordinalPosition="<%= ordinalPosition %>">\n\n  <% for (var ii=1; ii < (minDiskCount + 1); ii++) { %>\n    <% var diskModel = model[ \'disk\'+ii ]; %>\n    <div class="n-hardware-disk-4-node">\n      \x3c!-- Disk (selectable or blank) --\x3e\n      <div class="<%=diskModel ? \'n-hardware-selectable\' : \'n-hardware-blank\'%>\n            n-hardware-disk  n-alert-highlight-indicator"\n          actionTargetId="<%= diskModel ? diskModel.id : \'\' %>"\n          actionTargetName="<%= diskModel ? diskModel.name : \'\' %>"\n          actionTarget="disk"\n          action="details"\n          hostId="<%= hostId %>"\n          position="<%= ii %>">\n        \x3c!-- Disk Label --\x3e\n        <div class="n-hardware-disk-label">\n          <%= diskModel ? ii : \'\' %>\n        </div>\n      </div>\n    </div>\n  <% } %>\n\n</div>'}),define("text!templates/basecomponents/diagrams/hardware/DiskGroup2U4Node3DiskView.html",[],function(){return'\x3c!-- Disk Group for 2U 4Node Block - Jaguar (NX-1020). 3 disk per node system.\n     (Front of Block)\n  ================================================== --\x3e\n<div class="n-hardware-disk-node-group-4-node-3-disk"\n     ordinalPosition="<%= ordinalPosition %>">\n\n  <% // The array dictates the order of the disk\n     _.each( [ 3, 2, 1 ], function(num) {\n       var diskModel = model[\'disk\' + num];\n   %>\n\n    <div class="n-hardware-disk-4-node-3-disk">\n      \x3c!-- Disk (Selectable) --\x3e\n      <div class="<%=diskModel ? \'n-hardware-selectable\' : \'n-hardware-blank\'%>\n            n-hardware-disk  n-alert-highlight-indicator"\n          actionTargetId="<%= diskModel ? diskModel.id : \'\' %>"\n          actionTargetName="<%= diskModel ? diskModel.name : \'\' %>"\n          actionTarget="disk"\n          action="details"\n          hostId="<%= hostId %>"\n          position="<%= num %>">\n        \x3c!-- Disk Label --\x3e\n        <div class="n-hardware-disk-label">\n          <%= diskModel ? num : \'\' %>\n        </div>\n      </div>\n    </div>\n\n  <% }); %>\n\n</div>'}),define("text!templates/basecomponents/diagrams/hardware/HostGroup2U4NodeView.html",[],function(){
return'\x3c!-- Host Group for 2U 4Node Block\n     (Front of Block)\n  ================================================== --\x3e\n\n\x3c!-- (TC) Padding Power Supply --\x3e\n<div class="n-hardware-powersupply-label-4-node"></div>\n\n\x3c!-- Top Host (Hardware Components)\n  ================================================== --\x3e\n\x3c!-- (TL) Hardare Host Component --\x3e\n<div class="node1 n-hardware-host-4-node">\n\n  \x3c!-- (TL) Host (Selectable) --\x3e\n  <div class="<%= model.node1 ? \'n-hardware-selectable\' : \'n-hardware-blank\'%>\n      n-hardware-host"\n    actionTargetId="<%= model.node1 ? model.node1.id : \'\' %>"\n    actionTargetName="<%= model.node1 ? model.node1.name : \'\' %>"\n    actionTarget="host"\n    action="details"\n    title="<%= model.node1 ? model.node1.name : \'\' %>">\n  </div>\n\n  <% if (model.disk1) { %>\n    \x3c!-- (TL) Disk in Host --\x3e\n    <div class="n-hardware-selectable  n-hardware-disk-in-host\n                n-alert-highlight-indicator"\n      actionTargetId="<%= model.disk1 ? model.disk1.id : \'\' %>"\n      actionTargetName="<%= model.disk1 ? model.disk1.name : \'\' %>"\n      actionTarget="disk"\n      action="details">\n    </div>\n  <% } %>\n\n  \x3c!-- (TL) Host Name --\x3e\n  <div class="lblNode1 n-hardware-host-label-4-node">\n    <%= alertWidget1 %>\n    <%= model.node1 ? AppUtil.truncateMiddle(model.node1.name, 8) : \'\'  %>\n  </div>\n\n  \x3c!-- (TL) Alert Widget will be placed here by the AlertManager. --\x3e\n  <div class="n-alert-diagram-indicator"\n       actionTargetId="<%= model.node1 ? model.node1.id : \'\' %>"\n       actionTargetName="<%= model.node1 ? model.node1.name : \'\' %>"\n       actionTarget="host">\n  </div>\n</div>\n\n\x3c!-- (TC) Hardware Power Supply Component --\x3e\n<div class="n-hardware-powersupply-4-node n-alert-highlight-indicator"\n     actionTarget="powerSupply" actionTargetId="<%= blockSerial %>"\n     position="<%= psPosTop %>">\n  <i data-icon="N" aria-hidden="true" class="power-supply-icon"></i>\n</div>\n\n\x3c!-- (TR) Hardware Host Component --\x3e\n<div class="node2 n-hardware-host-4-node">\n\n  \x3c!-- (TR) Host (Selectable) --\x3e\n  <div class="<%= model.node2 ? \'n-hardware-selectable\' : \'n-hardware-blank\'%>\n      n-hardware-host"\n    actionTargetId="<%= model.node2 ? model.node2.id : \'\' %>"\n    actionTargetName="<%= model.node2 ? model.node2.name : \'\' %>"\n    actionTarget="host"\n    title="<%= model.node2 ? model.node2.name : \'\' %>"\n    action="details">\n  </div>\n\n  <% if (model.disk2) { %>\n    \x3c!-- (TL) Disk in Host --\x3e\n    <div class="n-hardware-selectable  n-hardware-disk-in-host\n                n-alert-highlight-indicator"\n      actionTargetId="<%= model.disk2 ? model.disk2.id : \'\' %>"\n      actionTargetName="<%= model.disk2 ? model.disk2.name : \'\' %>"\n      actionTarget="disk"\n      action="details">\n    </div>\n  <% } %>\n\n  \x3c!-- (TR) Host Name --\x3e\n  <div class="lblNode2 n-hardware-host-label-4-node">\n    <%= alertWidget2 %>\n    <%= model.node2 ? AppUtil.truncateMiddle(model.node2.name, 8) : \'\'  %>\n  </div>\n\n  \x3c!-- (TR) Alert Widget will be placed here by the AlertManager. --\x3e\n  <div class="n-alert-diagram-indicator"\n       actionTargetId="<%= model.node2 ? model.node2.id : \'\' %>"\n       actionTargetName="<%= model.node2 ? model.node2.name : \'\' %>"\n       actionTarget="host">\n  </div>\n</div>\n\n\n\x3c!-- Bottom Host (Hardware Components)\n  ================================================== --\x3e\n\x3c!-- (BL) Hardare Host Component --\x3e\n<div class="node3 n-hardware-host-4-node">\n\n  \x3c!-- (BL) Host (Selectable) --\x3e\n  <div class="<%= model.node3 ? \'n-hardware-selectable\' : \'n-hardware-blank\'%>\n      n-hardware-host"\n    actionTargetId="<%= model.node3 ? model.node3.id : \'\' %>"\n    actionTargetName="<%= model.node3 ? model.node3.name : \'\' %>"\n    actionTarget="host"\n    title="<%= model.node3 ? model.node3.name : \'\' %>"\n    action="details">\n  </div>\n\n  <% if (model.disk3) { %>\n    \x3c!-- (TL) Disk in Host --\x3e\n    <div class="n-hardware-selectable  n-hardware-disk-in-host\n                n-alert-highlight-indicator"\n      actionTargetId="<%= model.disk3 ? model.disk3.id : \'\' %>"\n      actionTargetName="<%= model.disk3 ? model.disk3.name : \'\' %>"\n      actionTarget="disk"\n      action="details">\n    </div>\n  <% } %>\n\n  \x3c!-- (BL) Host Name --\x3e\n  <div class="lblNode3  n-hardware-host-label-4-node">\n    <%= alertWidget3 %>\n    <%= model.node3 ? AppUtil.truncateMiddle(model.node3.name, 8) : \'\'  %>\n  </div>\n\n  \x3c!-- (BL) Alert Widget will be placed here by the AlertManager. --\x3e\n  <div class="n-alert-diagram-indicator"\n       actionTargetId="<%= model.node3 ? model.node3.id : \'\' %>"\n       actionTargetName="<%= model.node3 ? model.node3.name : \'\' %>"\n       actionTarget="host">\n  </div>\n</div>\n\n\x3c!-- (BC) Hardware Power Supply Component --\x3e\n<div class="n-hardware-powersupply-4-node n-alert-highlight-indicator"\n     actionTarget="powerSupply" actionTargetId="<%= blockSerial %>"\n     position="<%= psPosBottom %>">\n  <i data-icon="N" aria-hidden="true" class="power-supply-icon"></i>\n</div>\n\n\x3c!-- (BR) Hardware Host Component --\x3e\n<div class="node4 n-hardware-host-4-node">\n\n  \x3c!-- (BR) Host (Selectable) --\x3e\n  <div class="<%= model.node4 ? \'n-hardware-selectable\' : \'n-hardware-blank\'%>\n      n-hardware-host"\n    actionTargetId="<%= model.node4 ? model.node4.id : \'\' %>"\n    actionTargetName="<%= model.node4 ? model.node4.name : \'\' %>"\n    actionTarget="host"\n    title="<%= model.node4 ? model.node4.name : \'\' %>"\n    action="details">\n  </div>\n\n  <% if (model.disk4) { %>\n    \x3c!-- (BR) Disk in Host --\x3e\n    <div class="n-hardware-selectable  n-hardware-disk-in-host\n                n-alert-highlight-indicator"\n      actionTargetId="<%= model.disk4 ? model.disk4.id : \'\' %>"\n      actionTargetName="<%= model.disk4 ? model.disk4.name : \'\' %>"\n      actionTarget="disk"\n      action="details">\n    </div>\n  <% } %>\n\n  \x3c!-- (BR) Host Name --\x3e\n  <div class="lblNode4  n-hardware-host-label-4-node">\n    <%= alertWidget4 %>\n    <%= model.node4 ? AppUtil.truncateMiddle(model.node4.name, 8) : \'\'  %>\n  </div>\n\n  \x3c!-- (BR) Alert Widget will be placed here by the AlertManager. --\x3e\n  <div class="n-alert-diagram-indicator"\n       actionTargetId="<%= model.node4 ? model.node4.id : \'\' %>"\n       actionTargetName="<%= model.node4 ? model.node4.name : \'\' %>"\n       actionTarget="host">\n  </div>\n</div>\n\n\n\x3c!-- (BC) Padding Power Supply --\x3e\n<div class="n-hardware-powersupply-label-4-node"></div>'}),define("text!templates/basecomponents/diagrams/hardware/DiskGroup2U2NodeView.html",[],function(){return'\x3c!-- Disk Group for 2U 2Node Block\n     (Front of Block)\n  ================================================== --\x3e\n<div class="n-hardware-disk-node-group-2-node"\n     ordinalPosition="<%= ordinalPosition %>">\n\n  <% // The array dictates the order of the disk\n     _.each( [ 5, 6, 3, 4, 1, 2 ], function(num) {\n       var diskModel = model[\'disk\' + num];\n   %>\n\n    <div class="n-hardware-disk-2-node">\n      \x3c!-- Disk (Selectable) --\x3e\n      <div class="<%=diskModel ? \'n-hardware-selectable\' : \'n-hardware-blank\'%>\n            n-hardware-disk  n-alert-highlight-indicator"\n          actionTargetId="<%= diskModel ? diskModel.id : \'\' %>"\n          actionTargetName="<%= diskModel ? diskModel.name : \'\' %>"\n          actionTarget="disk"\n          action="details"\n          hostId="<%= hostId %>"\n          position="<%= num %>">\n        \x3c!-- Disk Label --\x3e\n        <div class="n-hardware-disk-label">\n          <%= diskModel ? num : \'\' %>\n        </div>\n      </div>\n    </div>\n\n  <% }); %>\n\n</div>'}),define("text!templates/basecomponents/diagrams/hardware/HostGroup2U2NodeView.html",[],function(){return'\x3c!-- Host Group for 2U 2Node Block\n     (Front of Block)\n  ================================================== --\x3e\n\n\x3c!-- (TC) Padding Power Supply --\x3e\n<div class="n-hardware-powersupply-label-2-node"></div>\n\n\n\x3c!-- Top Host (Hardware Components)\n  ================================================== --\x3e\n\x3c!-- (TL) Hardare Host Component --\x3e\n<div class="node1 n-hardware-host-2-node">\n\n  \x3c!-- (TL) Host (Selectable) --\x3e\n  <div class="<%= model.node1 ? \'n-hardware-selectable\' : \'n-hardware-blank\'%>\n      n-hardware-host"\n    actionTargetId="<%= model.node1 ? model.node1.id : \'\' %>"\n    actionTargetName="<%= model.node1 ? model.node1.name : \'\' %>"\n    actionTarget="host"\n    title="<%= model.node1 ? model.node1.name : \'\' %>"\n    action="details">\n  </div>\n\n  \x3c!-- (TL) Host Name --\x3e\n  <div class="lblNode1 n-hardware-host-label-2-node">\n    <%= alertWidget1 %>\n    <%= model.node1 ? AppUtil.truncateMiddle(model.node1.name, 8) : \'\'  %>\n  </div>\n\n  \x3c!-- (TL) Alert Widget will be placed here by the AlertManager. --\x3e\n  <div class="n-alert-diagram-indicator"\n       actionTargetId="<%= model.node1 ? model.node1.id : \'\' %>"\n       actionTargetName="<%= model.node1 ? model.node1.name : \'\' %>"\n       actionTarget="host">\n  </div>\n</div>\n\n\x3c!-- Power Supply --\x3e\n<div class="n-hardware-powersupply-2-container">\n  \x3c!-- (TC) Hardware Power Supply Component --\x3e\n  <div class="n-hardware-powersupply-2-node n-alert-highlight-indicator"\n       actionTarget="powerSupply" actionTargetId="<%= blockSerial %>"\n       position="<%= psPosTop %>">\n    <i data-icon="N" aria-hidden="true" class="power-supply-icon"></i>\n  </div>\n  \x3c!-- (BC) Hardware Power Supply Component --\x3e\n  <div class="n-hardware-powersupply-2-node n-alert-highlight-indicator"\n       actionTarget="powerSupply" actionTargetId="<%= blockSerial %>"\n       position="<%= psPosBottom %>">\n    <i data-icon="N" aria-hidden="true" class="power-supply-icon"></i>\n  </div>\n</div>\n\n\n\x3c!-- (TR) Hardware Host Component --\x3e\n<div class="node2 n-hardware-host-2-node">\n\n  \x3c!-- (TR) Host (Selectable) --\x3e\n  <div class="<%= model.node2 ? \'n-hardware-selectable\' : \'n-hardware-blank\'%>\n      n-hardware-host"\n    actionTargetId="<%= model.node2 ? model.node2.id : \'\' %>"\n    actionTargetName="<%= model.node2 ? model.node2.name : \'\' %>"\n    actionTarget="host"\n    title="<%= model.node2 ? model.node2.name : \'\' %>"\n    action="details">\n  </div>\n\n  \x3c!-- (TR) Host Name --\x3e\n  <div class="lblNode2 n-hardware-host-label-2-node">\n    <%= alertWidget2 %>\n    <%= model.node2 ? AppUtil.truncateMiddle(model.node2.name, 8) : \'\'  %>\n  </div>\n\n  \x3c!-- (TR) Alert Widget will be placed here by the AlertManager. --\x3e\n  <div class="n-alert-diagram-indicator"\n       actionTargetId="<%= model.node2 ? model.node2.id : \'\' %>"\n       actionTargetName="<%= model.node2 ? model.node2.name : \'\' %>"\n       actionTarget="host">\n  </div>\n</div>'}),define("text!templates/basecomponents/diagrams/hardware/DiskGroup2U1NodeView.html",[],function(){return'\x3c!-- Disk Group for 2U 1Node Block\n     (Front of Block)\n  ================================================== --\x3e\n<div class="n-hardware-disk-node-group-1-node"\n  ordinalPosition="<%= ordinalPosition %>">\n\n  <% for (var ii=1; ii < (minDiskCount + 1); ii++) { %>\n    <% var diskModel = model[ \'disk\'+ii ]; %>\n    <div class="n-hardware-disk-1-node">\n      \x3c!-- Disk (selectable or blank) --\x3e\n      <div class="<%=diskModel ? \'n-hardware-selectable\' : \'n-hardware-blank\'%>\n            n-hardware-disk  n-alert-highlight-indicator"\n          actionTargetId="<%= diskModel ? diskModel.id : \'\' %>"\n          actionTargetName="<%= diskModel ? diskModel.name : \'\' %>"\n          actionTarget="disk"\n          action="details"\n          hostId="<%= hostId %>"\n          position="<%= ii %>">\n        \x3c!-- Disk Label --\x3e\n        <div class="n-hardware-disk-label">\n          <%= diskModel ? ii : \'\' %>\n        </div>\n      </div>\n    </div>\n  <% } %>\n\n</div>'}),define("text!templates/basecomponents/diagrams/hardware/HostGroup2U1NodeView.html",[],function(){return'\x3c!-- Host Group for 2U 1Node Block\n     (Front of Block)\n  ================================================== --\x3e\n\n\x3c!-- (TC) Padding Power Supply --\x3e\n<div class="n-hardware-powersupply-label-1-node"></div>\n\n\x3c!-- Top Host (Hardware Components)\n  ================================================== --\x3e\n\n\x3c!-- Power Supply --\x3e\n<div class="n-hardware-powersupply-2-container">\n  \x3c!-- (LEFT) Hardware Power Supply Component --\x3e\n  <div class="n-hardware-powersupply-1-node n-alert-highlight-indicator"\n       actionTarget="powerSupply" actionTargetId="<%= blockSerial %>"\n       position="<%= psPosLeft %>">\n    <i data-icon="N" aria-hidden="true" class="power-supply-icon"></i>\n  </div>\n  \x3c!-- (RIGHT) Hardware Power Supply Component --\x3e\n  <div class="n-hardware-powersupply-1-node n-alert-highlight-indicator"\n       actionTarget="powerSupply" actionTargetId="<%= blockSerial %>"\n       position="<%= psPosRight %>">\n    <i data-icon="N" aria-hidden="true" class="power-supply-icon"></i>\n  </div>\n</div>\n\n\x3c!-- (TL) Hardare Host Component --\x3e\n<div class="node1 n-hardware-host-1-node">\n\n  \x3c!-- (TL) Host (Selectable) --\x3e\n  <div class="<%= model.node1 ? \'n-hardware-selectable\' : \'n-hardware-blank\'%>\n      n-hardware-host"\n    actionTargetId="<%= model.node1 ? model.node1.id : \'\' %>"\n    actionTargetName="<%= model.node1 ? model.node1.name : \'\' %>"\n    actionTarget="host"\n    title="<%= model.node1 ? model.node1.name : \'\' %>"\n    action="details">\n  </div>\n\n  \x3c!-- (TL) Host Name --\x3e\n  <div class="lblNode1 n-hardware-host-label-1-node">\n    <%= alertWidget1 %>\n    <%= model.node1 ? AppUtil.truncateMiddle(model.node1.name, 8) : \'\'  %>\n  </div>\n\n  \x3c!-- (TL) Alert Widget will be placed here by the AlertManager. --\x3e\n  <div class="n-alert-diagram-indicator"\n       actionTargetId="<%= model.node1 ? model.node1.id : \'\' %>"\n       actionTargetName="<%= model.node1 ? model.node1.name : \'\' %>"\n       actionTarget="host">\n  </div>\n</div>'}),define("models/hardware/BlockModel",["models/BaseModel","data/DataProperties","utils/AppConstants","utils/BlockConstants"],function(e,t,i,n){"use strict";return e.extend({entityType:i.ENTITY_BLOCK,name:"BlockModel",defaults:{blockSerial:"",blockModel:"",blockModelName:null,blockLocation:null,hosts:[],disks:[],hwConfigs:[],options:{}},setComponents:function(e,i){if(e=e||[],i=i||[],this.set(t.BLOCK_HOSTS,e),e.length>0){var n=e[0];this.set(t.BLOCK_SERIAL,n[t.BLOCK_SERIAL]),this.set(t.BLOCK_MODEL,n[t.BLOCK_MODEL]),this.set(t.BLOCK_LOCATION,n[t.BLOCK_LOCATION]);var s=n[t.BLOCK_MODEL_NAME]||n[t.BLOCK_MODEL];this.set(t.BLOCK_MODEL_NAME,s)}var a=[],r=_.pluck(e,t.SERVICE_VM_ID),o=_.groupBy(i,function(e){return e[t.SERVICE_VM_ID]?e[t.SERVICE_VM_ID]:e[t.DISK_LAST_SERVICE_VM_ID]});_.each(r,function(e){o[e]&&(a=a.concat(o[e]))}),this.set(t.BLOCK_DISKS,a)},getDiskLocatedInHost:function(e){return _.find(this.get("disks"),function(i){return i[t.SERVICE_VM_ID]==e&&0===i[t.DISK_LOCATION]})},getMinHostsForNxModel:function(){return n.MIN_HOST_COUNT[this.get(t.BLOCK_MODEL)]}})}),define("models/hardware/BlockCollection",["models/BaseCollection","models/hardware/BlockModel","data/DataProperties"],function(e,t,i){"use strict";return e.extend({model:t,name:"BlockCollection",getBlockModelVersions:function(){var e,t={},n=[];return t=_.groupBy(this.toJSON(),function(e){return e[i.BLOCK_MODEL_NAME]||e[i.BLOCK_MODEL]}),_.each(_.keys(t),function(i){e=[],e[0]=i,e[1]=t[i].length,n.push(e)}),n}})}),define("utils/BlockUtil",["data/DataProperties","utils/AppConstants","utils/BlockConstants","utils/AppUtil","utils/AlertUtil","utils/CommonTemplates","text!templates/basecomponents/diagrams/hardware/DiskGroup2U4NodeView.html","text!templates/basecomponents/diagrams/hardware/DiskGroup2U4Node3DiskView.html","text!templates/basecomponents/diagrams/hardware/HostGroup2U4NodeView.html","text!templates/basecomponents/diagrams/hardware/DiskGroup2U2NodeView.html","text!templates/basecomponents/diagrams/hardware/HostGroup2U2NodeView.html","text!templates/basecomponents/diagrams/hardware/DiskGroup2U1NodeView.html","text!templates/basecomponents/diagrams/hardware/HostGroup2U1NodeView.html","models/hardware/BlockModel","models/hardware/BlockCollection","models/hardware/HostCollection","models/hardware/DiskCollection"],function(e,t,i,n,s,a,r,o,l,c,u,d,h,p,T,E,S){"use strict";return{tmplDiskGroup2U4NodeTemplate:_.template(r),tmplDiskGroup2U2NodeTemplate:_.template(c),tmplDiskGroup2U1NodeTemplate:_.template(d),tmplDiskGroup2U4Node3DiskTemplate:_.template(o),tmplHostGroup2U4NodeTemplate:_.template(l),tmplHostGroup2U2NodeTemplate:_.template(u),tmplHostGroup2U1NodeTemplate:_.template(h),createBlockCollection:function(t,i,n){t=t||new E,i=i||new S;var s=t.toJSON({includeAttribute:!0}),a=i.toJSON({includeAttribute:!0}),r=_.groupBy(s,e.BLOCK_SERIAL),o=null,l=null,c=new T;return _.each(_.keys(r),function(t){o=r[t],l=new p,l.set(e.ID,t),l.set(e.BLOCK_OPTIONS,n),l.setComponents(o,a),c.push(l)}),c},createDiskTemplateGroup:function(t){var n,s,a,r,o,l,c,u,d,h,p;n=t.get(e.BLOCK_MODEL),this.is4Node2U(n)?s=this.is3DiskPerNode(n)?this.tmplDiskGroup2U4Node3DiskTemplate:this.tmplDiskGroup2U4NodeTemplate:this.is2Node2U(n)?s=this.tmplDiskGroup2U2NodeTemplate:this.is1Node2U(n)&&(s=this.tmplDiskGroup2U1NodeTemplate),d=i.DISK_ON_HOST_COUNT[n],u=i.MIN_HOST_COUNT[n],a=_.groupBy(t.get(e.BLOCK_DISKS),e.SERVICE_VM_ID),r=t.get(e.BLOCK_HOSTS),o=new Array(parseInt(u,10)),_.each(r,function(t,i){if(t&&t[e.POSITION]){var n=t[e.POSITION][e.P_ORDINAL]-1;o[n]=t}}),p="";for(var T=0;T<o.length;T++){var E=o[T]||{};l=a[E[e.SERVICE_VM_ID]],c=_.groupBy(l,e.DISK_LOCATION),h={};for(var S=1;S<=d;S++)c[S]&&c[S].length>0&&(h["disk"+S]=c[S][0]);p+=s({ordinalPosition:T+1,hostId:E[e.SERVICE_VM_ID],model:h,minDiskCount:d})}return p},createHostTemplateGroup:function(t){var r,o,l,c,u,d,h;r=t.get(e.BLOCK_MODEL),this.is4Node2U(r)?o=this.tmplHostGroup2U4NodeTemplate:this.is2Node2U(r)?o=this.tmplHostGroup2U2NodeTemplate:this.is1Node2U(r)&&(o=this.tmplHostGroup2U1NodeTemplate),c=i.MIN_HOST_COUNT[r],h={},l=t.get(e.BLOCK_HOSTS)||[];for(var p=0;p<c;p++)p<l.length&&l[p]&&(u=this.getNodeKey(r,l[p],p),h[u]=l[p],(d=t.getDiskLocatedInHost(l[p][e.SERVICE_VM_ID]))&&(h[this.getDiskKey(u)]=d));return o({model:h,alertWidget1:s.isHostMetadataDetached(h.node1)?a.IMPORTANT_CRITICAL_ALERT:"",alertWidget2:s.isHostMetadataDetached(h.node2)?a.IMPORTANT_CRITICAL_ALERT:"",alertWidget3:s.isHostMetadataDetached(h.node3)?a.IMPORTANT_CRITICAL_ALERT:"",alertWidget4:s.isHostMetadataDetached(h.node4)?a.IMPORTANT_CRITICAL_ALERT:"",blockSerial:t.get(e.BLOCK_SERIAL),psPosTop:e.ALERT_POWER_SUPPLY_POSITION_TOP,psPosBottom:e.ALERT_POWER_SUPPLY_POSITION_BOTTOM,psPosLeft:e.ALERT_POWER_SUPPLY_POSITION_LEFT,psPosRight:e.ALERT_POWER_SUPPLY_POSITION_RIGHT,AppUtil:n})},getNodeKey:function(t,n,s){var a;if(null!==n&&void 0!==n[e.POSITION])if(this.is4Node2U(t))switch(n[e.POSITION][e.P_PHYS_POSITION]){case i.POSITION_TL:a=1;break;case i.POSITION_TR:a=2;break;case i.POSITION_BL:a=3;break;case i.POSITION_BR:a=4}else if(this.is2Node2U(t))switch(n[e.POSITION][e.P_PHYS_POSITION]){case i.POSITION_TL:case i.POSITION_BL:case i.POSITION_L:a=1;break;case i.POSITION_TR:case i.POSITION_BR:case i.POSITION_R:a=2}else this.is1Node2U(t)&&(a=1);return void 0===a&&(a=s+1),"node"+a},getDiskKey:function(e){return e.replace("node","disk")},is4Node2U:function(e){switch(e){case i.MODEL_DESKTOP:case i.MODEL_NULL:case i.MODEL_NX2000:case i.MODEL_NX3000:case i.MODEL_NX3050:case i.MODEL_NX3060:case i.MODEL_NX1050:case i.MODEL_NX1020:return!0;default:return!1}},is2Node2U:function(e){switch(e){case i.MODEL_NX6020:case i.MODEL_NX6050:case i.MODEL_NX6060:case i.MODEL_NX6070:case i.MODEL_NX6080:case i.MODEL_NX6220:case i.MODEL_NX6280:case i.MODEL_NX9040:return!0;default:return!1}},is1Node2U:function(e){switch(e){case i.MODEL_NX7010:case i.MODEL_NX7110:return!0;default:return!1}},is3DiskPerNode:function(e){switch(e){case i.MODEL_NX1020:return!0;default:return!1}},is1NodeModel:function(e){return e===t.BLOCK_NUM_NODES.ONE},is2NodeModel:function(e){return e===t.BLOCK_NUM_NODES.TWO},is4NodeModel:function(e){return e===t.BLOCK_NUM_NODES.FOUR},is8NodeModel:function(e){return e===t.BLOCK_NUM_NODES.EIGHT}}}),define("models/hardware/DiscoveredBlockModel",["models/BaseModel","models/genesis/GetIPModel","utils/AppConstants","utils/BlockConstants","utils/AppUtil","utils/BlockUtil"],function(e,t,i,n,s,a){"use strict";var r,o={BLOCK_ID:"blockId",HOST_NAMES:"hostNames",HOST_TYPE:"host_type",RACK_NODES:"rackNodes",MODEL_STRING:"model_string",RACKABLE_UNIT_MODEL:"rackable_unit_model",IS_MODEL_SUPPORTED:"is_model_supported",NOS_VERSION:"nos_version",ATTRIBUTES:"attributes",CURRENT_NETWORK_INTERFACE:"current_network_interface",MINIMAL_COMPUTE_NODE:"minimal_compute_node",ROBO_MIXED_HYPERVISOR:"robo_mixed_hypervisor",RACKABLE_UNIT_MAX_NODES:"rackable_unit_max_nodes",IS_XPRESS_NODE:"is_xpress_node",HOST_IPS:"HostIps",SUBNET_MASKS:"SubnetMasks",ENABLED_NODES:"enabledNodes",DISCOVERY_METHOD:"discoverMethod",AVAILABLE_NODES:"availableNodes",NODE:{IP:"node_ip",IPMI_IP:"ipmi_ip",HYPERVISOR_IP:"hypervisor_ip"}},l={AUTO:"auto",MANUAL:"manual"};return e.extend({NODE_POSITIONS:["00","01","10","11","20","21","30","31"],SORTED_NODE_POSITIONS:["10","00","11","01","31","21","30","20"],CONTROLLER_VM:"controllervm",HYPERVISOR:"hypervisor",IPMI:"ipmi",IP_GROUPS:["controllervm","hypervisor","ipmi"],name:"DiscoveredBlockModel",defaults:(r={blockId:0,rackNodes:null,hostNames:null,controllervmIP:null,hypervisorIP:null,impiIP:null,controllervmHostIPs:null,hypervisorHostIPs:null,impiHostIPs:null,controllervmSubnetMasks:null,hypervisorSubnetMasks:null,impiSubnetMasks:null,availableNodes:null,enabledNodes:null},_defineProperty(r,o.DISCOVERY_METHOD,l.AUTO),_defineProperty(r,"ipAddressChangeTrigger",!1),r),initialize:function(){s.debug("DiscoveredBlockModel : initialize:  | modelId     : ",this.cid),this.initializeBaseModel();var e={rackNodes:[]};_.each(this.IP_GROUPS,function(t){e[t+"IP"]=[0,0,0,0];var i={};_.each(this.NODE_POSITIONS,function(e){i[e]=[0,0,0,0]}),e[t+o.HOST_IPS]=i;var n={};_.each(this.NODE_POSITIONS,function(e){n[e]=[0,0,0,0]}),e[t+o.SUBNET_MASKS]=n},this),this.set(e),this.set(o.HOST_NAMES,{}),this._loadingDefaultAddresses=!1},loadDefaultAddresses:function(e){var i=this,n=this;if(!this._loadingDefaultAddresses){this._loadingDefaultAddresses=!0;var s=0,a=function(){0===--s&&(e(),n._triggerChangeEvent())},r=function(e,t,n){var s=n.getIPs(),r=n.getSubnetMasks();if(e&&s&&3===s.length)for(var o=0;o<3;o++)for(var l=i.IP_GROUPS[o],c=s[o]?s[o].split("."):[],u=r[o]?r[o].split("."):[],d=0;d<c.length;d++)i.updateNodeIP(l,e,d,c[d],!0),i.updateSubnetMask(l,e,d,u[d],!0);a()};_.each(this.NODE_POSITIONS,function(i){var o=this,l=this.getRackNodeIpsAt(i),c=this.getRackNodeLabelAt(i),u=this.getNodeIPV6Address(c);if(l.length&&this.isManualDiscover())_.each(l,function(e,t){return o.setNodeIp(e,t,i)}),e(),n._triggerChangeEvent();else if(u){s++;var d=new t;d.setProxyIpv6(u),d.fetch({success:function(e){r(i,0,e)},error:function(e,t){a()}})}},this)}},setBlockId:function(e){this.set({blockId:e})},getBlockId:function(){return this.get("blockId")},getHostName:function(e){return this.get(o.HOST_NAMES)[e]},getRackNodeIpGroups:function(e){return this.isRackNodeComputeOnly(e)?_.without(this.IP_GROUPS,this.CONTROLLER_VM):this.IP_GROUPS},setRackNodes:function(e){var t=this;this.set({rackNodes:e});var i={},n={};_.each(this.NODE_POSITIONS,function(e){var a=t.getRackNodeLabelAt(e);i[e]=Boolean(a),n[e]=!1,n[e]&&!t.getNodeUUIDOrSerial(a)&&s.log("ERROR: Node at position "+e+" on rack ["+t.getRackableUnitSerial()+"] does NOT have UUID and Serial Numbers.")}),this.set(_defineProperty({},o.AVAILABLE_NODES,i)),this.set(_defineProperty({},o.ENABLED_NODES,n))},updateMasterIP:function(e,t,i){var s=this,a=e+"IP",r=this.get(a);r[t]=i,this.set({attrName:r});var l=e+o.HOST_IPS,c=s.get(l),u=this.SORTED_NODE_POSITIONS;this.getRackableUnitModel()===n.MODEL_NX3000&&(u=this.NODE_POSITIONS);var d=0;_.each(u,function(e){var n=0;this.isNodeEnabled(e)&&(n=i,3===t&&0!==i&&(n=i+d,d++)),c[e][t]=n},this),this._triggerChangeEvent()},getMasterIpValue:function(e,t){var i=e+"IP";return this.get(i)[t]},updateNodeIP:function(e,t,i,n,s){var a=e+o.HOST_IPS;this.get(a)[t][i]=n,s||this._triggerChangeEvent()},setNodeIp:function(e,t,i){var n=this,s=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];_.isString(e)&&_.each(e.split("."),function(e,a){n.updateNodeIP(n.IP_GROUPS[t],i,a,e,s)})},updateSubnetMask:function(e,t,i,n,s){var a=e+o.SUBNET_MASKS;this.get(a)[t][i]=n,s||this._triggerChangeEvent()},updateHostName:function(e,t){var i=this.get(o.HOST_NAMES);i[t]=e,this.set(o.HOST_NAMES,i)},isNodeAvailable:function(e){return this.get(o.AVAILABLE_NODES)[e]},enableNode:function(e,t){this.get(o.ENABLED_NODES)[e]=t,this._triggerChangeEvent()},isNodeEnabled:function(e){return this.get(o.ENABLED_NODES)[e]},getNumberOfEnabledNodes:function(){return _.reduce(this.get(o.ENABLED_NODES),function(e,t){return t?e+=1:e},0)},getNodeIpAddress:function(e,t){var i=e+o.HOST_IPS;return this.get(i)[t]},getNodeSubnetMasks:function(e,t){var i=e+o.SUBNET_MASKS;return this.get(i)[t]},getRackableUnitSerial:function(){return this.get(o.RACK_NODES)[0].rackable_unit_serial},getRackableUnitModel:function(e){var t="";return t=this.get(o.RACK_NODES)[0][o.MODEL_STRING]?this.get(o.RACK_NODES)[0][o.MODEL_STRING]:this.get(o.RACK_NODES)[0][o.RACKABLE_UNIT_MODEL],e?t:t.replace("-","")},isModelSupported:function(){return!this.get(o.RACK_NODES)[0][o.ATTRIBUTES]||!1!==this.get(o.RACK_NODES)[0][o.ATTRIBUTES][o.IS_MODEL_SUPPORTED]},getNodeSerialNumber:function(e){var t=this._getNodeByPosition(e);return t?t.node_serial:null},getNodeUUID:function(e){var t=this._getNodeByPosition(e);return t?t.node_uuid:null},getNodeUUIDOrSerial:function(e){var t=this._getNodeByPosition(e),i=t?t.node_uuid:null;return i||(i=t.node_serial?t.node_serial:null),i},getNodeIPV6Address:function(e){var t=this._getNodeByPosition(e);return t?t.ip:null},getNodeIPV6AddressEncoded:function(e){var t=this._getNodeByPosition(e);return t&&t.ip?t.ip.replace("%","%25"):null},getRackNodeAt:function(e){var t=null;if(this.is2NodeModel())switch(e){case"00":t=["1","A"];break;case"01":t=["2","B"]}else if(this.is1NodeModel())switch(e){case"00":t=["1","A"]}else if(this.is8NodeModel())switch(e){case"00":t=["1","A"];break;case"01":t=["2","B"];break;case"10":t=["3","C"];break;case"11":t=["4","D"];break;case"20":t=["5","E"];break;case"21":t=["6","F"];break;case"30":t=["7","G"];break;case"31":t=["8","H"]}else switch(e){case"00":t=["1","B"];break;case"01":t=["3","D"];break;case"10":t=["2","A"];break;case"11":t=["4","C"]}var i=null;return t&&((i=this._getNodeByPosition(t[0]))||(i=this._getNodeByPosition(t[1]))),i},getRackNodeIpsAt:function(e){var t=this.getRackNodeAt(e),i=!this.isRackNodeComputeOnly(e);return t?[i&&t&&t[o.NODE.IP]||null,t&&t[o.NODE.HYPERVISOR_IP]||null,t&&t[o.NODE.IPMI_IP]||null]:[]},getRackNodeHypervisorAt:function(e){var t=this.getRackNodeAt(e);return{type:t?t.hypervisor:"",version:t?t.hypervisor_version:""}},getRackNodeNetworkInterface:function(e){var t=this.getRackNodeAt(e);return t?t[o.CURRENT_NETWORK_INTERFACE]:null},getNodeNOSVersion:function(e){return this.getRackNodeAt(e)[o.NOS_VERSION]},isRackNodeLightCompute:function(e){var t=this.getRackNodeAt(e);return!(!t||!t[o.ATTRIBUTES])&&(t[o.ATTRIBUTES][o.MINIMAL_COMPUTE_NODE]||!1)},isRackNodeComputeOnly:function(e){var t=this.getRackNodeAt(e),n=t&&(t[o.HOST_TYPE]||t.type);return"compute only"===n||n===i.HOST_TYPES.COMPUTE_ONLY},getRoboMixedHypervisor:function(e){var t=this.getRackNodeAt(e);return!(!t||!t[o.ATTRIBUTES])&&(t[o.ATTRIBUTES][o.ROBO_MIXED_HYPERVISOR]||!1)},getRackNodeLabelAt:function(e){var t=null;if(this.is2NodeModel())switch(e){case"00":t=["1","A"];break;case"01":t=["2","B"]}else if(this.is1NodeModel())switch(e){case"00":t=["1","A"]}else if(this.is8NodeModel())switch(e){case"00":t=["1","A"];break;case"01":t=["2","B"];break;case"10":t=["3","C"];break;case"11":t=["4","D"];break;case"20":t=["5","E"];break;case"21":t=["6","F"];break;case"30":t=["7","G"];break;case"31":t=["8","H"]}else switch(e){case"00":t=["1","B"];break;case"01":t=["3","D"];break;case"10":t=["2","A"];break;case"11":t=["4","C"]}var i=null;if(t){if(i=this._getNodeByPosition(t[0]))return t[0];if(i=this._getNodeByPosition(t[1]))return t[1]}return i},hasXPressNode:function(){return _.some(this.get(o.RACK_NODES),function(e){return e[o.ATTRIBUTES]&&!0===e[o.ATTRIBUTES][o.IS_XPRESS_NODE]})},getRackNodeCount:function(){return this.get(o.RACK_NODES).length},is1NodeModel:function(){return a.is1NodeModel(this.getMaxNumNodes())},is2NodeModel:function(){return a.is2NodeModel(this.getMaxNumNodes())},is4NodeModel:function(){return a.is4NodeModel(this.getMaxNumNodes())},is8NodeModel:function(){return a.is8NodeModel(this.getMaxNumNodes())},isManualDiscover:function(){return this.get(o.DISCOVERY_METHOD)===l.MANUAL},hasOnlyComputeNodes:function(){var e=this,t=this.getRackNodeCount(),i=0;return _.each(this.NODE_POSITIONS,function(t){e.isRackNodeComputeOnly(t)&&i++}),t>0&&t===i},getMaxNumNodes:function(){return this.get(o.RACK_NODES)[0][o.RACKABLE_UNIT_MAX_NODES]||i.BLOCK_NUM_NODES.DEFAULT},getDisplayedNodePositions:function(){return _.first(this.NODE_POSITIONS,this.getMaxNumNodes())},_getNodeByPosition:function(e){return _.find(this.get(o.RACK_NODES),function(t){return t.node_position===e})},_triggerChangeEvent:function(){this.set({ipAddressChangeTrigger:!this.get("ipAddressChangeTrigger")})}},{DISCOVERY_METHODS:l,DP:o})}),define("managers/NodeManager",["backbone","managers/BaseManager","models/genesis/ConfiguredNodesModel","models/hardware/DiscoveredBlockModel"],function(e,t,i,n){"use strict";return t.extend({DP:{ATTRIBUTES:"attributes",HYPERVISOR:"hypervisor",MINIMAL_COMPUTE_NODE:"minimal_compute_node"},name:"NodeManager",configuredNodeModel:null,hasLoaded:!1,isLoading:!1,isInit:!1,allNodes:new e.Collection,blocks:[],promise:null,initialize:function(){this.configuredNodeModel=new i,this.isInit=!0},startServices:function(){return this.hasLoaded||this.isLoading?this.promise:(this.promise=this.loadData(),this.promise)},loadData:function(){this.hasLoaded=!1,this.isLoading=!0;var e=this;return this.configuredNodeModel.fetch({success:function(){var t=e.configuredNodeModel.getReturnResponse();if(t.length){e.allNodes=t;var i={};t.each(function(e){e=e.toJSON();var t=e.rackable_unit_serial,n=i[t];n||(n=[],i[t]=n),n.push(e)});var s=(new Date).getTime();_.each(i,function(e){var t=new n;t.setBlockId(s),t.setRackNodes(e),this.blocks.push(t),s+=1},e),e.isLoading=!1,e.hasLoaded=!0}},error:function(){e.allNodes=[],e.isLoading=!1,e.hasLoaded=!0},force:!0})},stopServices:function(){this.isLoading=!1,this.hasLoaded=!1,this.promise=null},getAllNodes:function(){return this.allNodes}})}),define("text!extras/modules/ui_config_settings.json",[],function(){
return'{\n  "menuItems": [\n    {\n      "groupId": "GENERAL",\n      "items": [\n        {\n          "id": "licensing",\n          "action": "show",\n          "dataTest": "settings_menu_licensing",\n          "actionId": "show",\n          "actionTarget": "licensing",\n          "environment": [\n            "pe",\n            "pc"\n          ]\n        },\n        {\n          "id": "upgrade",\n          "action": "upgrade",\n          "dataTest": "settings_menu_upgrade_software",\n          "actionId": "upgrade",\n          "actionTarget": "upgrade",\n          "environment": [\n            "pe"\n          ]\n        },\n        {\n          "id": "upgrade_multicluster",\n          "action": "upgrade",\n          "dataTest": "settings_menu_upgrade",\n          "actionId": "upgrade",\n          "actionTarget": "upgrade",\n          "environment": [\n            "pc"\n          ]\n        },\n        {\n          "id": "migrate_ssp",\n          "action": "ssp_config",\n          "dataTest": "settings_menu_migrate_ssp",\n          "actionId": "ssp_config",\n          "actionTarget": "cluster",\n          "environment": [\n            "pc"\n          ]\n        },\n        {\n          "id": "prism_central_vm",\n          "action": "show",\n          "dataTest": "settings_menu_pc_management",\n          "actionId": "show",\n          "actionTarget": "prism_central_vm",\n          "environment": [\n            "pc"\n          ]\n        },\n        {\n          "id": "cp_alert_policy",\n          "action": "show",\n          "dataTest": "settings_menu_cp_alert_policies",\n          "actionId": "show",\n          "actionTarget": "cp_alert_policy",\n          "environment": [\n            "pc"\n          ]\n        },\n        {\n          "id": "hypervisor",\n          "action": "convert",\n          "dataTest": "settings_menu_convert_cluster",\n          "actionId": "convert",\n          "actionTarget": "cluster",\n          "environment": [\n            "pe"\n          ]\n        },\n        {\n          "id": "host",\n          "action": "create",\n          "dataTest": "settings_menu_expand_cluster",\n          "actionId": "create",\n          "actionTarget": "host",\n          "environment": [\n            "pe"\n          ]\n        },\n        {\n          "id": "reboot",\n          "action": "Hypervisor rolling restart",\n          "dataTest": "settings_menu_reboot_hosts",\n          "actionId": "Hypervisor rolling restart",\n          "actionTarget": "host",\n          "environment": [\n            "pe"\n          ]\n        },\n        {\n          "id": "cluster",\n          "action": "show",\n          "dataTest": "settings_menu_cluster_details",\n          "actionId": "show",\n          "actionTarget": "cluster",\n          "environment": [\n            "pe"\n          ]\n        },\n        {\n          "id": "remote_support",\n          "action": "show",\n          "dataTest": "settings_menu_remote_support",\n          "actionId": "show",\n          "actionTarget": "remote_support",\n          "environment": [\n            "pe"\n          ]\n        },\n        {\n          "id": "cvm_config",\n          "action": "cvm_config",\n          "dataTest": "settings_menu_cvm_config",\n          "actionId": "cvm_config",\n          "actionTarget": "cvm_config",\n          "environment": [\n            "pe"\n          ]\n        },\n        {\n          "id": "acropolis_image",\n          "action": "create",\n          "dataTest": "settings_menu_image",\n          "actionId": "create",\n          "actionTarget": "acropolis_image",\n          "environment": [\n            "pe"\n          ]\n        },\n        {\n          "id": "entity_sync",\n          "action": "show",\n          "dataTest": "entity_sync",\n          "actionId": "show",\n          "actionTarget": "entity_sync",\n          "environment": [\n            "pc"\n          ]\n        },\n        {\n          "id": "availability_zone",\n          "action": "create",\n          "actionId": "create",\n          "dataTest": "settings_menu_idp",\n          "actionRoute": "{\\"action\\":\\"broker_dynamic\\",\\"options\\":{\\"action\\":\\"create\\",\\"actionId\\":\\"connect\\",\\"actionTarget\\":\\"availability_zone\\",\\"subApp\\":\\"draas\\",\\"subAppRoute\\":\\"az\\",\\"plane_type\\":\\"XI\\"}}",\n          "environment": [\n            "pc"\n          ]\n        }\n      ]\n    },\n    {\n      "groupId": "NETWORK",\n      "items": [\n        {\n          "id": "http_proxy",\n          "action": "show",\n          "dataTest": "settings_menu_http_proxies",\n          "actionId": "show",\n          "actionTarget": "http_proxy",\n          "environment": [\n            "pe",\n            "pc"\n          ]\n        },\n        {\n          "id": "name_server",\n          "action": "show",\n          "dataTest": "settings_menu_name_servers",\n          "actionId": "show",\n          "actionTarget": "name_server",\n          "environment": [\n            "pe",\n            "pc"\n          ]\n        },\n        {\n          "id": "ntp_server",\n          "action": "show",\n          "dataTest": "settings_menu_ntp_servers",\n          "actionId": "show",\n          "actionTarget": "ntp_server",\n          "environment": [\n            "pe",\n            "pc"\n          ]\n        },\n        {\n          "id": "snmp",\n          "action": "show",\n          "dataTest": "settings_menu_snmp",\n          "actionId": "show",\n          "actionTarget": "snmp",\n          "environment": [\n            "pe",\n            "pc"\n          ]\n        },\n        {\n          "id": "network_switch",\n          "action": "show",\n          "dataTest": "settings_menu_network_switch_config",\n          "actionId": "show",\n          "actionTarget": "network_switch",\n          "environment": [\n            "pe"\n          ]\n        },\n        {\n          "id": "acropolis_network",\n          "action": "create",\n          "dataTest": "settings_menu_network",\n          "actionId": "create",\n          "actionTarget": "acropolis_network",\n          "environment": [\n            "pe"\n          ]\n        }\n      ]\n    },\n    {\n      "groupId": "FLOW",\n      "items": [\n        {\n          "id": "id_based_security",\n          "action": "show",\n          "dataTest": "settings_menu_id_based_security",\n          "actionId": "show",\n          "actionTarget": "id_based_security",\n          "environment": [\n            "pc"\n          ]\n        },\n         {\n          "id": "manage_microseg",\n          "action": "manage_microseg",\n          "dataTest": "settings_menu_manage_microseg",\n          "actionId": "manage_microseg",\n          "actionTarget": "directory_service",\n          "environment": [\n            "pc"\n          ]\n        },\n         {\n          "id": "manage_epoch",\n          "action": "manage_epoch",\n          "dataTest": "settings_menu_manage_epoch",\n          "actionId": "manage_epoch",\n          "actionTarget": "directory_service",\n          "environment": [\n            "pc"\n          ]\n        }\n      ]\n    },\n    {\n      "groupId": "SECURITY",\n      "items": [\n        {\n          "id": "cluster_lockdown",\n          "action": "show",\n          "dataTest": "settings_menu_cluster_lockdown",\n          "actionId": "show",\n          "actionTarget": "cluster_lockdown",\n          "environment": [\n            "pe",\n            "pc"\n          ]\n        },\n        {\n          "id": "encryption",\n          "action": "create",\n          "dataTest": "settings_menu_encryption",\n          "actionId": "create",\n          "actionTarget": "encryption",\n          "environment": [\n            "pe"\n          ]\n        },\n        {\n          "id": "nfs_whitelist",\n          "action": "show",\n          "dataTest": "settings_menu_filesystem_whitelists",\n          "actionId": "show",\n          "actionTarget": "nfs_whitelist",\n          "environment": [\n            "pe"\n          ]\n        },\n        {\n          "id": "prism_pem_key",\n          "action": "show",\n          "dataTest": "settings_menu_ssl_certificate",\n          "actionId": "show",\n          "actionTarget": "prism_pem_key",\n          "environment": [\n            "pe",\n            "pc"\n          ]\n        },\n        {\n          "id": "kerberos_config",\n          "action": "show",\n          "dataTest": "settings_menu_smb_kerberos",\n          "actionId": "show",\n          "actionTarget": "kerberos_config",\n          "environment": [\n            "pe"\n          ]\n        }\n      ]\n    },\n    {\n      "groupId": "USER_ROLES",\n      "items": [\n        {\n          "id": "role_mapping",\n          "action": "show",\n          "dataTest": "settings_menu_role_mapping",\n          "actionId": "show",\n          "actionTarget": "role_mapping",\n          "environment": [\n            "pe",\n            "pc"\n          ]\n        },\n        {\n          "id": "user",\n          "action": "show",\n          "dataTest": "settings_menu_user_mgmt",\n          "actionId": "show",\n          "actionTarget": "user",\n          "environment": [\n            "pe"\n          ]\n        },\n         {\n          "id": "abac_user_capability",\n          "action": "show",\n          "dataTest": "settings_menu_user_mgmt",\n          "actionId": "show",\n          "actionTarget": "abac_user_capability",\n          "environment": [\n            "pc"\n          ]\n        },\n        {\n          "id": "auth_config",\n          "action": "show",\n          "dataTest": "settings_menu_authentication",\n          "actionId": "show",\n          "actionTarget": "auth_config",\n          "environment": [\n            "pe",\n            "pc"\n          ]\n        }\n      ]\n    },\n    {\n      "groupId": "EMAIL_AND_ALERTS",\n      "items": [\n        {\n          "id": "smtp_server",\n          "action": "show",\n          "dataTest": "settings_menu_smtp",\n          "actionId": "show",\n          "actionTarget": "smtp_server",\n          "environment": [\n            "pe",\n            "pc"\n          ]\n        },\n        {\n          "id": "alert_configuration",\n          "action": "show",\n          "dataTest": "settings_menu_alert_services",\n          "actionId": "show",\n          "actionTarget": "alert_configuration",\n          "environment": [\n            "pe",\n            "pc"\n          ]\n        },\n        {\n          "id": "alert_policy",\n          "action": "summary",\n          "dataTest": "settings_menu_alert_policies",\n          "actionId": "summary",\n          "actionTarget": "alert_policy",\n          "environment": [\n            "pe",\n            "pc"\n          ]\n        },\n        {\n          "id": "syslog_server",\n          "action": "create",\n          "dataTest": "settings_menu_sys_log",\n          "actionRoute": "{\\"action\\":\\"broker_dynamic\\",\\"options\\":{\\"action\\":\\"create\\",\\"actionId\\":\\"connect\\",\\"subApp\\":\\"flow\\",\\"subAppRoute\\":\\"syslog\\"}}",\n          "environment": [\n            "pc"\n          ]\n        }\n      ]\n    },\n    {\n      "groupId": "DATA_RESILIENCY",\n      "items": [\n        {\n          "id": "witness_add",\n          "action": "show",\n          "actionId": "show",\n          "actionTarget": "witness_add",\n          "environment": [\n            "pe"\n          ]\n        },\n        {\n          "id": "redundancy_state",\n          "action": "show",\n          "dataTest": "settings_menu_redundancy_state",\n          "actionId": "show",\n          "actionTarget": "redundancy_state",\n          "environment": [\n            "pe"\n          ]\n        },\n        {\n          "id": "high_availability",\n          "action": "show",\n          "dataTest": "settings_high_availability",\n          "actionId": "show",\n          "actionTarget": "high_availability",\n          "environment": [\n            "pe"\n          ]\n        },\n        {\n          "id": "degraded_node",\n          "action": "show",\n          "dataTest": "settings_menu_degraded_node",\n          "actionId": "show",\n          "actionTarget": "degraded_node",\n          "environment": [\n            "pe"\n          ]\n        }\n      ]\n    },\n    {\n      "groupId": "APPEARANCE",\n      "items": [\n        {\n          "id": "language-settings",\n          "action": "update",\n          "dataTest": "settings_menu_ui",\n          "actionId": "update",\n          "skipI18nTranslation": true,\n          "label": "Language Settings",\n          "actionTarget": "language-settings",\n          "environment": [\n            "pe",\n            "pc"\n          ]\n        },\n        {\n          "id": "ui_settings",\n          "action": "update",\n          "dataTest": "settings_menu_ui",\n          "actionId": "update",\n          "actionTarget": "ui_settings",\n          "environment": [\n            "pe",\n            "pc"\n          ]\n        },\n        {\n          "id": "system_data_welcome_banner",\n          "action": "update",\n          "dataTest": "settings_menu_welcome_banner",\n          "actionId": "update",\n          "actionTarget": "system_data_welcome_banner",\n          "environment": [\n            "pe",\n            "pc"\n          ]\n        }\n      ]\n    },\n    {\n      "groupId": "SETUP",\n      "items": [\n        {\n          "id": "directory_service",\n          "action": "show",\n          "actionId": "show",\n          "environment": [\n            "pc"\n          ]\n        },\n        {\n          "id": "asup",\n          "action": "show",\n          "dataTest": "settings_menu_smart_support",\n          "actionId": "show",\n          "actionTarget": "asup",\n          "environment": [\n            "pe",\n            "pc"\n          ]\n        },\n        {\n          "id": "rack_config",\n          "action": "broker_dynamic",\n          "dataTest": "settings_menu_rack_config",\n          "actionRoute": "{\\"action\\":\\"broker_dynamic\\",\\"actionParentEntityType\\":\\"cluster\\",\\"options\\":{\\"isPE\\":\\"true\\",\\"subApp\\":\\"rackconfigurer\\",\\"action\\":\\"view\\"}}",\n          "environment": [\n            "pe"\n          ]\n        },\n        {\n          "id": "prism_central",\n          "action": "deploy",\n          "actionId": "deploy",\n          "actionTarget": "prism_central_vm",\n          "environment": [\n            "pe"\n          ]\n        },\n        {\n          "id": "management_server",\n          "action": "show",\n          "dataTest": "settings_menu_mgmt_servers",\n          "actionId": "show",\n          "actionTarget": "management_server",\n          "actionTargetId": "vCenter",\n          "environment": [\n            "pe",\n            "pc"\n          ]\n        },\n        {\n          "id": "citrix_connector",\n          "action": "show",\n          "dataTest": "citrix_connector",\n          "actionId": "show",\n          "actionTarget": "citrix_connector",\n          "environment": [\n            "pe"\n          ]\n        },\n        {\n          "id": "EnableAppOrchestration",\n          "action": "show",\n          "dataTest": "settings_menu_app_orchestration",\n          "actionId": "show",\n          "environment": [\n            "pc"\n          ]\n        },\n        {\n          "id": "EnableDrOrchestration",\n          "dataTest": "settings_menu_dr_orchestration",\n          "actionRoute": "{\\"action\\":\\"broker_dynamic\\",\\"options\\":{\\"actionTarget\\":\\"enable-disaster-recovery\\",\\"subApp\\":\\"draas\\",\\"subAppRoute\\":\\"enable-disaster-recovery\\",\\"actionSource\\":\\"settings\\"}}",\n          "environment": [\n            "pc"\n          ]\n        }\n      ]\n    }\n  ]\n}'}),define("text!extras/modules/ui_config_help.json",[],function(){return'{\n  "menuItems": [\n    {\n      "items": [\n        {\n          "id": "docs_help_page",\n          "attributes": {\n            "action": "show",\n            "actionId": "show",\n            "actionTarget": "docs_help_page",\n            "data-test": "user_menu_help_on_page"\n          },\n          "environment": [\n            "pe",\n            "pc"\n          ]\n        }\n      ]\n    },\n    {\n      "items": [\n        {\n          "id": "CLUSTER_HEALTH_INTRO",\n          "attributes": {\n            "pageId": "clusterh",\n            "action": "show",\n            "actionId": "show",\n            "actionTarget": "CLUSTER_HEALTH_INTRO",\n            "data-test": "user_tutorial_cluster_health"\n          },\n          "environment": [\n            "pe"\n          ]\n        }\n      ]\n    },\n    {\n      "items": [\n        {\n          "id": "docs_help",\n          "attributes": {\n            "action": "show",\n            "actionId": "show",\n            "actionTarget": "docs_help",\n            "data-test": "user_menu_help"\n          },\n          "environment": [\n            "pe",\n            "pc"\n          ]\n        },\n        {\n          "id": "supportportal",\n          "attributes": {\n            "action": "show",\n            "actionId": "show",\n            "actionTarget": "supportportal",\n            "data-test": "user_menu_support_portal"\n          },\n          "environment": [\n            "pe",\n            "pc"\n          ]\n        },\n        {\n          "id": "communitysite",\n          "attributes": {\n            "action": "show",\n            "actionId": "show",\n            "actionTarget": "communitysite"\n          },\n          "environment": [\n            "pe",\n            "pc"\n          ]\n        }\n      ]\n    }\n  ]\n}'}),define("text!extras/modules/ui_config_userlist.json",[],function(){return'{\n  "menuItems": [\n    {\n      "items": [\n        {\n          "id": "change_password",\n          "attributes": {\n            "action": "show",\n            "actionId": "show",\n            "actionTarget": "change_password",\n            "data-test": "user_menu_change_password"\n          },\n          "environment": [\n            "pe",\n            "pc"\n          ]\n        },\n        {\n          "id": "update_profile",\n          "attributes": {\n            "action": "show",\n            "actionId": "show",\n            "actionTarget": "update_profile",\n            "data-test": "user_menu_update_profile"\n          },\n          "environment": [\n            "pe",\n            "pc"\n          ]\n        }\n      ]\n    },\n    {\n      "items": [\n        {\n          "id": "CMDLETS-MSI",\n          "attributes": {\n            "action": "download",\n            "actionId": "download",\n            "actionTarget": "CMDLETS-MSI",\n            "data-test": "settings_menu_download_cmdlets_installer"\n          },\n          "environment": [\n            "pe",\n            "pc"\n          ]\n        },\n        {\n          "id": "ncli",\n          "attributes": {\n            "action": "download",\n            "actionId": "download",\n            "actionTarget": "ncli",\n            "data-test": "settings_menu_download_ncli"\n          },\n          "environment": [\n            "pe",\n            "pc"\n          ]\n        },\n        {\n          "id": "PRISM-CENTRAL-OVA",\n          "attributes": {\n            "action": "show",\n            "actionId": "show",\n            "actionTarget": "PRISM-CENTRAL-OVA",\n            "data-test": "settings_menu_download_prism_central_ova"\n          },\n          "environment": [\n            "pe"\n          ]\n        },\n        {\n          "id": "restapiexplorer",\n          "attributes": {\n            "action": "show",\n            "actionId": "show",\n            "actionTarget": "restapiexplorer",\n            "data-test": "user_menu_rest_api_explorer"\n          },\n          "environment": [\n            "pe",\n            "pc"\n          ]\n        }\n      ]\n    },\n    {\n      "items": [\n        {\n          "id": "version",\n          "attributes": {\n            "action": "show",\n            "actionId": "show",\n            "actionTarget": "version",\n            "data-test": "user_menu_about_nutanix"\n          },\n          "environment": [\n            "pe",\n            "pc",\n            "pe_pc_proxy"\n          ]\n        },\n        {\n          "id": "2048",\n          "attributes": {\n            "action": "show",\n            "actionId": "show",\n            "actionTarget": "2048",\n            "data-test": "user_menu_nothing_to_do"\n          },\n          "environment": [\n            "pe",\n            "pc"\n          ]\n        }\n      ]\n    },\n    {\n      "items": [\n        {\n          "id": "logout",\n          "attributes": {\n            "action": "logout",\n            "actionId": "logout",\n            "data-test": "user_menu_sign_out"\n          },\n          "environment": [\n            "pe",\n            "pc",\n            "pe_pc_proxy"\n          ]\n        }\n      ]\n    }\n  ]\n}'}),define("views/navigation/MenuDescriptor",["models/genesis/LaJollaClusterModel","models/genesis/AzureOnboardingStatusModel","data/DataProperties","utils/AppConstants","utils/AppUtil","utils/MenuConfigUtil","utils/HypervisorUtil","managers/AccessManager","managers/ClusterManager","managers/ExploreManager","managers/LicenseManager","managers/PrismElementManager","managers/CommunityEditionManager","managers/NodeManager","managers/I18nManager","managers/UITemplateManager","text!extras/modules/ui_config_settings.json","text!extras/modules/ui_config_help.json","text!extras/modules/ui_config_userlist.json"],function(e,t,i,n,s,a,r,o,l,c,u,d,h,p,T,E,S,g,A){"use strict";var m={};m[n.REST_API_EXPLORER]=1,m[n.EET]=4;var f=s.parseJSON(S),I=s.parseJSON(A),C=s.parseJSON(g),v={name:"MenuDescriptor",GROUP_BREAK:"group_break",GROUP_BREAK_HIDDEN:"group_break_hidden",LOADING:"loading",COL_BREAK:"colBreak",USER_MENU_TYPE:{MULTICLUSTER:"multicluster",SINGLE_CLUSTER:"singleCluster",SINGLE_CLUSTER_PROXY:"singleClsuterProxy"},initialize:function(){this.setupDescriptors(),this.setupDescriptorsUITemplate(),p.initialize()},getSettingsCategoryMapping:function(){return a.getCategoryMapping(f)},getDescriptor:function(e){var t=this[e];if(t){var i=e;t.attributes&&t.attributes[n.NAV_ACTION_TARGET_ID]&&(i=e+t.attributes[n.NAV_ACTION_TARGET_ID]),t.label=T.t(this.name,i,t.label||""),t.labelHint=T.t(this.name,i+"_hint","")}return t},getPageList:function(e){var t=E.getPageList();if(!_.isEmpty(t))return t;var i;if(e)i=[n.PAGE_MC_DASHBOARD,n.PAGE_MC_HEALTH,n.PAGE_VMS,n.PAGE_STORAGE,n.PAGE_HARDWARE,n.PAGE_ANALYSIS,n.PAGE_LCM,n.PAGE_ALERT_EXPLORER];else{var a=n.PAGE_ALERTS;o.isClusterFFEnabled(n.FFLAGS.ALERTS_IN_IDF)&&(a=n.PAGE_ALERT_EXPLORER),i=[n.PAGE_DASHBOARD,n.PAGE_CLUSTER_HEALTH,n.PAGE_VMS,n.PAGE_STORAGE,n.PAGE_NETWORK,n.PAGE_HARDWARE,n.PAGE_FILE_SERVER,n.PAGE_DR,n.PAGE_ANALYSIS,a,n.PAGE_TASKS,n.PAGE_LCM,n.PAGE_SETTINGS,n.PAGE_PRISMLETS],r.hasKVMOnly()&&u.canUseFeat(u.FEAT_MAP.SSP)&&!d.isLoadedFromPrismCentral()||(this._removeFromList(i,this.GROUP_BREAK),this._removeFromList(i,n.PAGE_SSP)),(u.hasXPressLicense()||!r.hasKVM()&&!r.hasESX()||l.isPowerPcCluster())&&this._removeFromList(i,n.PAGE_FILE_SERVER),r.hasKVMOnly()||this._removeFromList(i,n.PAGE_NETWORK),r.hasXen()&&this._removeFromList(i,n.PAGE_DR),s.hasLocalStorage()&&localStorage[n.LOCAL_STORAGE.APPS_FEATURE_FLAG]||this._removeFromList(i,n.PAGE_PRISMLETS)}o.isFFEnabled(n.FFLAGS.INSIGHTS)&&i.push(n.PAGE_INSIGHTS),e&&o.isClusterFFEnabled(n.FFLAGS.DELOS)&&(i=[n.PAGE_MC_DASHBOARD,n.PAGE_ENTITY_BROWSER,n.PAGE_ANALYSIS,n.PAGE_APPS,n.PAGE_PLANNING,n.PAGE_ALERT_EXPLORER],i=c.filterDefaultPageList(i));var h=[];return _.each(i,function(e){(e===this.GROUP_BREAK||this.canAccessPage(e)&&this.isFeatureSupported(e)&&o.isPageSupported(e))&&h.push(e)},this),h},getSettingsList:function(s,a,c){var d=this.getSettingsListBasedOnClusterType(s);d=o.filterSettingsList(d);var h=this,p=l.getCurrentClusterModel(),_=p&&p.get(i.CLUSTER_UUID),T=function(){var e=h.filterList(d),t=h.sortList(e);c(a,t)};if((!o.isClusterAdmin()||!s&&p&&(l.isOneNodeCluster()||r.hasXen(_)))&&this._removeFromList(d,n.ENTITY_LCM),s||!p||r.hasESXandKVMOnly(_)||h._removeFromList(d,n.ENTITY_NETWORK_SWITCH),o.isClusterViewerOnly()&&h._removeFromList(d,n.ENTITY_PC),this.isRackConfigurationSupported(p)||h._removeFromList(d,n.ENTITY_RACK_CONFIG),!o.isPageEnabledInReleaseManager(n.PAGE_SECURITY_PLANNING)&&this._removeFromList(d,n.ACTION_DIRECTORY_SERVICE.MANAGE_EPOCH),!s&&p&&r.hasHyperV(_)){var E=new e,S=new t;$.whenAll.apply($,[E.fetch(),S.fetch()]).done(function(){E.getReturnResponse()&&"Completed"!==S.getReturnResponse()&&d.push(n.ENTITY_AZURE_ONBOARDING),T()})}else s&&d.indexOf(n.ENTITY_CP_ALERT_POLICY)>0?(u.isPrismProFeaturesEnabled()&&!o.isClusterViewerOnly()||h._removeFromList(d,n.ENTITY_CP_ALERT_POLICY),T()):T()},getSettingsListBasedOnClusterType:function(e){var t=e?n.VIEW_MODULE.PC:n.VIEW_MODULE.PE;return a.getItemsByEnvironment(f,t)},getHypervClusterSetupSteps:function(){var e=[n.ENTITY_HYPERV_DOMAIN_JOIN,n.ENTITY_HYPERV_FAILOVER_CLUSTER];return this.filterList(e)},getUserList:function(e){var t=void 0;switch(e){case this.USER_MENU_TYPE.SINGLE_CLUSTER:t=n.VIEW_MODULE.PE;break;case this.USER_MENU_TYPE.MULTICLUSTER:t=n.VIEW_MODULE.PC;break;case this.USER_MENU_TYPE.SINGLE_CLUSTER_PROXY:t=n.VIEW_MODULE.PE_PC_PROXY;break;default:throw new Error("MenuDescriptor: getUserList: invalid user list type.")}var i=a.getItemsByEnvironment(I,t,this.GROUP_BREAK);if(l.isBrandingHX())for(var s=0;s<i.length;s++)-1!==i.indexOf(n.SYSTEM_VERSION)&&i.splice(i.indexOf(n.SYSTEM_VERSION),1,n.SYSTEM_LENOVO_VERSION);var r=this.filterList(i);return this.sortList(r)},getHelpMenuItems:function(e){return a.getItemsByEnvironment(C,e)},getHelpList:function(e){var t=this.getHelpMenuItems(n.VIEW_MODULE.PE);h.isCommunityEditionCluster()&&t.push(n.CONTACT_SALES_CE);var i=this.filterList(t);return this.sortList(i)},addAboutSearchMenuElement:function(e){c.isEnableSearchConvergence()&&!o.isSspOnlyUser()&&e.unshift(n.LEARN_ABOUT_SEARCH)},filterList:function(e){var t,i,s=[];return e=e||[],_.each(e,function(e){if(this.isSettingSupported(e)&&(t=this.getDescriptor(e),i=t&&t.attributes?t.attributes[n.NAV_ACTION]:null,e===this.GROUP_BREAK||o.canModifyByEntityType(e,i)||o.canViewByEntityType(e,i))){if(e===this.GROUP_BREAK&&(0===s.length||s[s.length-1]===this.GROUP_BREAK))return;if(!o.isFFEnabled(m[e]))return;s.push(e)}},this),this.removeItemsFromList(s)},removeItemsFromList:function(e){var t=l.getCurrentClusterId();r.isAcropolisEnabled(t)&&o.isFFEnabled(n.FFLAGS.UI_ACROPOLIS)||(this._removeFromList(e,n.ENTITY_ACROPOLIS_IMAGE),this._removeFromList(e,n.ENTITY_HA)),!t||r.hasXen(t)||r.hasXenAndKVMOnly(t)||this._removeFromList(e,n.ENTITY_CITRIX_CONNECTOR);var i=!1;return(t&&r.hasESX(t)||l.isMulticlusterUI())&&(i=!0),i||this._removeFromList(e,n.ENTITY_MANAGEMENT_SERVER),h.isCommunityEditionCluster()&&(this._removeFromList(e,n.ENTITY_LICENSING),this._removeFromList(e,n.SUPPORT_PORTAL)),e},sortList:function(e){var t=[];e=e||[];var i={},n=0,a={};_.each(e,function(e){if(e===this.GROUP_BREAK||e===this.GROUP_BREAK_HIDDEN)return a[n]=e,void n++;i[n]=i[n]||[],i[n].push(e)},this);var r=0;return _.each(i,function(e,i){t.length>0&&(t.push(a[r]||this.GROUP_BREAK),r++);var n=this;t=t.concat(e.sort(function(e,t){var i=n.getDescriptor(e),a=n.getDescriptor(t);if(!i||!a)return i?s.error(t+" do not have any descriptor"):s.error(e+" do not have any descriptor"),0;var r=n.getMenuItemDescriptorLabel(i),o=n.getMenuItemDescriptorLabel(a),l=r.toLocaleLowerCase(),c=o.toLocaleLowerCase();return l>c?1:l<c?-1:0}))},this),t},getMenuItemDescriptorLabel:function(e){var t=e.label;return!t&&e.viewClass&&(t=e.viewClass.getLabel()),t||""},isSettingSupported:function(e){if(-1!==[n.ENTITY_KERBEROS_CONFIG,n.ENTITY_HYPERV_FAILOVER_CLUSTER,n.ENTITY_HYPERV_DOMAIN_JOIN].indexOf(e)&&(l.isMulticlusterUI()||!r.hasHyperV()))return!1;switch(e){case n.ENTITY_KERBEROS_CONFIG:if(!l.getCurrentClusterModel().get(i.DOMAIN))return!1;break;case n.ENTITY_HYPERVISOR:if(!l.isMulticlusterUI()&&(h.isCommunityEditionCluster()||r.hasHyperV()||l.isOneOrTwoNodeCluster())&&!l.isPowerPcCluster())return!1;break;case n.ENTITY_HOST:if(l.isOneOrTwoNodeCluster())return!1;break;case n.ENTITY_REBOOT:if(l.isMulticlusterUI()||r.hasHyperV()||r.hasESX())return!1;break;case n.ENTITY_MIGRATE_SSP:if(!l.isMulticlusterUI()||!o.isClusterAdmin())return!1;break;case n.ENTITY_HA:case n.ENTITY_DEGRADED_NODE:case n.ENTITY_WITNESS_ADD:if(l.isOneNodeCluster())return!1}return!0},addNavAttributes:function(e,t,i,s,a,r,o){var l={};return e&&(l[n.NAV_PAGE_ID]=e),t&&(l[n.NAV_SUBPAGE_ID]=t),i&&(l[n.NAV_ACTION]=i,l[n.NAV_ACTION_ID]=i),s&&(l[n.NAV_ACTION_TARGET]=s),a&&(l[n.NAV_ACTION_TARGET_ID]=a),o&&(l[n.NAV_ACTION_INNER_TEMPLATE]=o),l},addDataTestAttribute:function(e,t){return e=e||{},e[n.DATA_TEST]=t,e},canAccessPage:function(e){return o.canModifyByPage(e)||o.canViewByPage(e)},isFeatureSupported:function(e){return e===n.PAGE_INSIGHTS?o.isFFEnabled(n.FFLAGS.INSIGHTS):e===n.PAGE_ALERTS?!l.isMulticlusterNavMode()&&!o.isClusterFFEnabled(n.FFLAGS.ALERTS_IN_IDF):e===n.PAGE_ALERT_EXPLORER?l.isMulticlusterNavMode()||o.isClusterFFEnabled(n.FFLAGS.ALERTS_IN_IDF):e!==n.PAGE_FILE_SERVER||!(u.hasXPressLicense()||!r.hasKVM()&&!r.hasESX()||l.isPowerPcCluster())},isRackConfigurationSupported:function(e){var t=e&&e.get(i.CLUSTER_UUID);return!r.hasHyperVOnly(t)&&!r.hasXenOnly(t)&&o.hasAccessToV3()},_removeFromList:function(e){for(var t,i=arguments.length,n=Array(i>1?i-1:0),s=1;s<i;s++)n[s-1]=arguments[s];var a=(t=_).without.apply(t,[e].concat(_toConsumableArray(n)));e.length=0,e.push.apply(e,_toConsumableArray(a))},addMenuDescriptor:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments[1],i=T.t(this.name,e.id);return(e.skipI18nTranslation||e.id===n.GROUP_BREAK)&&(i=e.label),i?(this[e.id]={label:i,attributes:t},e.id):void s.error(e.id+"  menu item missing I18N entry")},setupDescriptors:function(){var e=this;v[n.PAGE_MC_DASHBOARD]={label:"Home",attributes:v.addNavAttributes(n.PAGE_MC_DASHBOARD)},v[n.PAGE_DASHBOARD]={label:"Home",attributes:v.addDataTestAttribute(v.addNavAttributes(n.PAGE_DASHBOARD),"main_menu_home")},v[n.PAGE_ANALYSIS]={label:"Analysis",attributes:v.addDataTestAttribute(v.addNavAttributes(n.PAGE_ANALYSIS),"main_menu_analysis")},v[n.PAGE_SECURITY_PLANNING]={label:"Security planning",attributes:v.addDataTestAttribute(v.addNavAttributes(n.PAGE_SECURITY_PLANNING),"main_menu_security_planning")},v[n.PAGE_PLANNING]={label:"Planning",attributes:v.addDataTestAttribute(v.addNavAttributes(n.PAGE_PLANNING),"main_menu_planning")},v[n.PAGE_MC_HEALTH]={label:"Health",attributes:v.addDataTestAttribute(v.addNavAttributes(n.PAGE_MC_HEALTH),"main_menu_mc_health")},v[n.PAGE_MC_PE_IFRAME]={label:"",attributes:v.addDataTestAttribute(v.addNavAttributes(n.PAGE_MC_PE_IFRAME),"main_menu_mc_pe_iframe")},v[n.PAGE_APPS]={label:"Calm",attributes:v.addDataTestAttribute(v.addNavAttributes(n.PAGE_APPS),"main_menu_apps_iframe")},v[n.PAGE_CLUSTER_HEALTH]={label:"Health",attributes:v.addDataTestAttribute(v.addNavAttributes(n.PAGE_CLUSTER_HEALTH),"main_menu_health")},v[n.PAGE_ENTITY_BROWSER]={label:"Explore",attributes:v.addDataTestAttribute(v.addNavAttributes(n.PAGE_ENTITY_BROWSER),"main_menu_ebrowser")},c.isEnableSearchConvergence()&&(v[n.PAGE_EXPLORE]={label:"Explore",attributes:v.addDataTestAttribute(v.addNavAttributes(n.PAGE_EXPLORE),"main_menu_explore")},v[n.PAGE_SETTINGS]={label:"Settings",attributes:v.addDataTestAttribute(v.addNavAttributes(n.PAGE_SETTINGS),"main_menu_settings")}),v[n.PAGE_INSIGHTS]={label:"Insights",attributes:v.addDataTestAttribute(v.addNavAttributes(n.PAGE_INSIGHTS),"main_menu_insights")},v[n.PAGE_VMS]={label:"VM",attributes:v.addDataTestAttribute(v.addNavAttributes(n.PAGE_VMS),"main_menu_vm")},v[n.PAGE_DR]={label:"Data Protection",attributes:v.addDataTestAttribute(v.addNavAttributes(n.PAGE_DR),"main_menu_dr")},v[n.PAGE_ALERTS]={label:"Alerts",
attributes:v.addDataTestAttribute(v.addNavAttributes(n.PAGE_ALERTS),"main_menu_alerts")},v[n.PAGE_ALERT_EXPLORER]={label:"Alerts",attributes:v.addDataTestAttribute(v.addNavAttributes(n.PAGE_ALERT_EXPLORER),"main_menu_alert_explorer")},v[n.PAGE_LCM]={label:"LCM",attributes:v.addDataTestAttribute(v.addNavAttributes(n.PAGE_LCM),"main_menu_lcm")},v[n.PAGE_TASKS]={label:"Tasks",attributes:v.addDataTestAttribute(v.addNavAttributes(n.PAGE_TASKS),"main_menu_tasks")},v[n.PAGE_HARDWARE]={label:"Hardware",attributes:v.addDataTestAttribute(v.addNavAttributes(n.PAGE_HARDWARE),"main_menu_hardware")},v[n.PAGE_NETWORK]={label:"Network",attributes:v.addDataTestAttribute(v.addNavAttributes(n.PAGE_NETWORK),"main_menu_network")},v[n.PAGE_STORAGE]={label:"Storage",attributes:v.addDataTestAttribute(v.addNavAttributes(n.PAGE_STORAGE),"main_menu_storage")},v[n.PAGE_SETTINGS]={label:"Settings",attributes:v.addDataTestAttribute(v.addNavAttributes(n.PAGE_SETTINGS),"main_menu_settings")},v[n.PAGE_PRISMLETS]={label:"Extensions",attributes:v.addDataTestAttribute(v.addNavAttributes(n.PAGE_PRISMLETS),"main_menu_apps")},v[n.PAGE_SSP]={label:"Self Service",attributes:v.addDataTestAttribute(v.addNavAttributes(n.PAGE_SSP),"main_menu_ssp")},v[n.PAGE_ACCESS_DENIED]={label:"Access Denied",attributes:v.addNavAttributes(n.PAGE_ACCESS_DENIED)},v[n.PAGE_BROKER]={label:"Broker",attributes:v.addDataTestAttribute(v.addNavAttributes(n.PAGE_BROKER),"main_menu_broker")},v[n.PAGE_XI_DASHBOARD]={label:"Dashboard",attributes:v.addDataTestAttribute(v.addNavAttributes(n.PAGE_XI_DASHBOARD),"main_menu_xi_dashboard")},v[n.PAGE_XI_BILLING]={label:"Billing",attributes:v.addDataTestAttribute(v.addNavAttributes(null,null,n.ACTION_SHOW,n.PAGE_XI_BILLING),"main_menu_xi_billing")},v[n.PAGE_XI_ADMINISTRATION]={label:"Administration",attributes:v.addDataTestAttribute(v.addNavAttributes(null,null,n.ACTION_SHOW,n.PAGE_XI_ADMINISTRATION),"main_menu_xi_administration")},v[n.PAGE_XI_PROFILE]={label:"Profile",attributes:v.addDataTestAttribute(v.addNavAttributes(null,null,n.ACTION_SHOW,n.PAGE_XI_PROFILE),"main_menu_xi_profile")},_.each(f.menuItems,function(t){_.each(t.items,function(t){var i=v.addNavAttributes(null,null,t.action,t.actionTarget,t.actionTargetId);t.actionRoute&&(i.actionRoute=t.actionRoute),t.dataTest&&(i[n.DATA_TEST]=t.dataTest),e.addMenuDescriptor(t,i)})}),_.each(I.menuItems,function(t){_.each(t.items,function(t){e.addMenuDescriptor(t,t.attributes)})}),_.each(C.menuItems,function(t){_.each(t.items,function(t){e.addMenuDescriptor(t,t.attributes)})}),v[n.ENTITY_HYPERV_DOMAIN_JOIN]={label:"Join Cluster and Hosts to the Domain",attributes:v.addDataTestAttribute(v.addNavAttributes(null,null,n.ACTION_SHOW,n.ENTITY_HYPERV_DOMAIN_JOIN),"settings_menu_cluster_domain_join")},v[n.ENTITY_HYPERV_CPS_DEPLOYMENT]={label:"CPS Deployment",attributes:v.addDataTestAttribute(v.addNavAttributes(null,null,n.ACTION_SHOW,n.ENTITY_HYPERV_CPS_DEPLOYMENT),"settings_menu_cps_deployment")},v[n.ENTITY_HYPERV_FAILOVER_CLUSTER]={label:"Configure Failover Cluster",attributes:v.addDataTestAttribute(v.addNavAttributes(null,null,n.ACTION_SHOW,n.ENTITY_HYPERV_FAILOVER_CLUSTER),"settings_menu_cluster_failover")},v[n.ENTITY_AZURE_ONBOARDING]={label:"Azure Onboarding",attributes:v.addDataTestAttribute(v.addNavAttributes(null,null,n.ACTION_SHOW,n.ENTITY_AZURE_ONBOARDING),"settings_azure_onboarding")},v[n.CONTACT_SALES_CE]={label:"Contact Sales",attributes:v.addNavAttributes(null,null,n.ACTION_SHOW,n.CONTACT_SALES_CE)},v[n.SYSTEM_LENOVO_VERSION]={label:"About Lenovo",attributes:v.addDataTestAttribute(v.addNavAttributes(null,null,n.ACTION_SHOW,n.SYSTEM_VERSION),"user_menu_about_nutanix")},v[n.LEARN_ABOUT_SEARCH]={label:"Learn about search",attributes:v.addDataTestAttribute(v.addNavAttributes(n.PAGE_SEARCH_GUIDELINES),"learn_about_search")},v[n.CREATE_SUPPORT_CASE]={label:"Create support case",attributes:v.addDataTestAttribute(v.addNavAttributes(null,null,n.ACTION_CREATE,n.SUPPORT_CASE),"support_cases_menu_item")},v[n.CREATE_SUPPORT_CASE_LINK]={label:"Create support case",attributes:v.addDataTestAttribute(v.addNavAttributes(null,null,n.ACTION_SHOW,n.CREATE_SUPPORT_CASE_LINK),"support_cases_menu_item")},v[n.PAGE_FILE_SERVER]={label:"File Server",attributes:v.addDataTestAttribute(v.addNavAttributes(n.PAGE_FILE_SERVER),"main_menu_file_server")}},setupDescriptorsUITemplate:function(){var e=E.getPageList();_.each(e,function(e){if(!E.isPrismPage(e)){var t=E.getPageDescriptor(e);t&&!v[e]&&(v[e]={label:t.name,attributes:this.addNavAttributes(e)})}},this)}};return v}),define("views/basecomponents/navigation/MenuView",["views/basecomponents/BaseView","views/navigation/MenuDescriptor","managers/AppManager","managers/NavigationManager","managers/ActionManager","managers/HelpManager","managers/TaskManager","data/DataManager","data/DataURLConstants","data/Config","utils/AppConstants","utils/AppUtil","events/AppEvents"],function(e,t,i,n,s,a,r,o,l,c,u,d,h){"use strict";var p=_.template('<ul class="n-nav-col col<%= columnCount %>">');return e.extend({NEXT:"next",PREVIOUS:"prev",LEFT:"left",RIGHT:"right",MAX_COLUMNS:2,MIN_MULTIPLE_COLUMN_ITEMS:16,name:"MenuView",menuItemTemplate:'<li class="n-nav-menu-item"><a></a></li>',menuItemHintTemplate:_.template(' <span class="hint-text"><%= hint %></span>'),separatorTemplate:'<li class="sep"></li>',newFeatureTemplate:_.template('<span class="new-feature"><%= newFeature %></span>'),active:null,menuArray:null,events:{"mouseup  .n-nav-menu-item":"onMenuItemClick","keydown  .n-nav-menu-item":"onKeyDown"},viewFilters:[{targets:{selectors:['a[actionTarget="host"]','a[actionTarget="upgrade"]','a[actionTarget="citrix_connector"]','a[actionTarget="lcm_entity"]','.n-nav-menu-item a[actionTarget="container"]']},conditions:{logic:u.VIEW_FILTER.LOGICS.EVERY,groups:[{type:"clusterConvertInProgress",data:[!0],operator:u.FILTER_OPERATORS.EQUALS,reasonCode:"common.clusterConvertProgress"}]}}],render:function(e){var i=1;this.$(" > li").append(p({columnCount:i})),e||this.formatColumns(),_.each(this.menuArray,function(e,n){e===t.COL_BREAK?this.$(" > li").append(p({columnCount:++i})):this.addMenuItem(e,this.$(".col"+i))},this)},cleanColumns:function(e){if(!_.isNumber(e)||e<0)return void d.log("MenuView: Invalid columnSize parameter of "+e);if(this.menuArray[0]===t.GROUP_BREAK)return this.menuArray.splice(0,1),!0;if(this.menuArray[e-1]===t.GROUP_BREAK)return this.menuArray.splice(e-1,1),!0;if(this.menuArray[e]===t.GROUP_BREAK)return this.menuArray.splice(e,1),!0;if(this.menuArray[this.menuArray.length-1]===t.GROUP_BREAK)return this.menuArray.splice(this.menuArray.length-1),!0;var i=0;for(var n in this.menuArray){if(n===t.GROUP_BREAK&&i!==this.menuArray.length-1&&this.menuArray[i+1]===t.GROUP_BREAK)return this.menuArray.splice(i+1,1),!0;i++}return!1},formatColumns:function(){for(var e;;){if(this.menuArray.length<=this.MIN_MULTIPLE_COLUMN_ITEMS)return;if(e=Math.ceil(this.menuArray.length/this.MAX_COLUMNS),!this.cleanColumns(e))break}this.menuArray.splice(e,0,t.COL_BREAK)},setMenuWidth:function(){var e=0;this.$(".n-nav-col").each(function(){e+=this.offsetWidth})},open:function(){var e=this;this.refresh();this.$el.show({duration:0,complete:function(){e.setMenuWidth(),h.triggerAppEvent(h.NAV_MENU_OPEN,e.$el)}})},setMenuArray:function(e){this.menuArray=e},close:function(){this.$el.hide(),this.$el.parent().closest(".n-menu-active").removeClass("n-menu-active"),this.deactivate(),h.triggerAppEvent(h.NAV_MENU_CLOSE,this.$el)},addMenuItem:function(e,i){if(e===t.GROUP_BREAK)$(i).append($(this.separatorTemplate));else{var n=t.getDescriptor(e);if(!n)return;_.isObject(n.viewClass)?this.addMenuItemWithViewClass(i,n.viewClass):this.addMenuItemLink(i,e,n)}},addMenuItemLink:function(e,t,i){var n=$(this.menuItemTemplate);n.find("a").attr(i.attributes).html(i.label),$(e).append(n),i.labelHint&&n.find("a").append(this.menuItemHintTemplate({hint:i.labelHint})),i.hasNewTag&&!d.hasSeenFeature(t)&&n.append(this.newFeatureTemplate({newFeature:this.i18n("newFeature")}))},addMenuItemWithViewClass:function(e,t){t.setMenuView(this),$(e).append(t.render())},getColumnCount:function(){return this.$(".n-nav-col").length},move:function(e,t,i){if(!this.active)return void this.activate(i,this.$(t));if(e){var n=this.active[e+"All"](".n-nav-menu-item").eq(0);if(n.length)return void this.activate(i,n)}this.activate(i,this.$(t))},_keyMove:function(e,t){if(!this.$el.is(":visible"))return void this.search(null,t);var i;return t.stopPropagation(),this.isFirst()&&e===this.PREVIOUS?(i=this.active.closest(".n-nav-col").index()||this.getColumnCount(),this.deactivate(),void this.toLast(t,i)):this.isLast()&&e===this.NEXT?(i=this.active.closest(".n-nav-col").index()+2,i>this.getColumnCount()&&(i=1),this.deactivate(),void this.toFirst(t,i)):e===this.LEFT?void this.toLeft(t):e===this.RIGHT?void this.toRight():void this[e](t)},next:function(e){this.move(this.NEXT,".n-nav-col .n-nav-menu-item:first",e)},prev:function(e){this.move(this.PREVIOUS,".n-nav-col .n-nav-menu-item:last",e)},isFirst:function(){return this.active&&!this.active.prevAll(".n-nav-menu-item").length},isLast:function(){return this.active&&!this.active.nextAll(".n-nav-menu-item").length},toFirst:function(e,t){t=t||1,(!_.isNumber(t)||t<0||t>this.MAX_COLUMNS)&&d.log("MenuView: toFirst: invalid nextCol parameter of "+t),this.move(null,".col"+t+" .n-nav-menu-item:first",e)},toLast:function(e,t){t=t||this.getColumnCount(),(!_.isNumber(t)||t<0||t>this.MAX_COLUMNS)&&d.log("MenuView: toLast: invalid nextCol parameter of "+t),this.move(null,".col"+t+" .n-nav-menu-item:last",e)},toRight:function(e){if(this.active){var t=this.active.index(),i=this.active.closest(".n-nav-col").index()+1,n=".col"+(i+1)+" li:nth-child("+(t+1)+")";this.$(n).hasClass("sep")||this.move(null,n,e)}},toLeft:function(e){if(this.active){var t=this.active.index(),i=this.active.closest(".n-nav-col").index()+1,n=".col"+(i-1)+" li:nth-child("+(t+1)+")";this.$(n).hasClass("sep")||this.move(null,n,e)}},_keyEvent:function(e,t){var i=$(t.currentTarget).closest(".n-nav-col");$(i).hasClass("col1")&&e===this.LEFT||$(i).hasClass("col"+this.getColumnCount())&&e===this.RIGHT||this.$el.is(":visible")&&(this._keyMove(e,t),t.stopPropagation(),t.preventDefault())},activate:function(e,t){this.deactivate(),this.active=t.eq(0).find("a").addClass("n-hover").attr("id","n-active").focus().end()},deactivate:function(){this.active&&(this.active.find("a").removeClass("n-hover").removeAttr("id"),this.active=null)},refresh:function(){var e=this;this.renderViewFilter(),this.$(".n-nav-col").find("li:has(a)").addClass("n-nav-menu-item").find("a:not(.gray-out)").attr("tabindex",-1).mouseenter(function(t){e.activate(t,$(this).parent())}).mouseleave(function(){e.deactivate()})},getViewFeatures:function(){var e=r.getGlobalTasks();if(e&&_.isFunction(e.hasActiveClusterConvertTask))return{clusterConvertInProgress:!!e.hasActiveClusterConvertTask()}},onKeyDown:function(e){var t=$.ui.keyCode;switch(e.keyCode){case t.UP:this._keyEvent(this.PREVIOUS,e);break;case t.DOWN:this._keyEvent(this.NEXT,e);break;case t.LEFT:this._keyEvent(this.LEFT,e);break;case t.RIGHT:this._keyEvent(this.RIGHT,e);break;case t.ENTER:case t.NUMPAD_ENTER:this.onMenuItemClick(e,this.$(".n-hover")),$(".n-navigation").trigger(h.NAV_MENU_CLOSE),e.stopPropagation()}},getYesHandler:function(){var e=_.template(l.CONSOLE,{protocol:c.getServiceData(c.PRISM_GATEWAY).protocol,host:c.getServiceData(c.PRISM_GATEWAY).host,port:c.getServiceData(c.PRISM_GATEWAY).port});return function(){s.navigateToURL(o.appendSingleClusterProxyParam(e+l.REST_API_EXPLORER))}},onMenuItemClick:function(e,t){e.preventDefault();var r=t||$(e.currentTarget).find("a");if(!r.hasClass(u.VIEW_FILTER.STYLE_CLASS.GRAY_OUT)){if(r.attr(u.NAV_ACTION))if(r.attr(u.NAV_ACTION)===u.ACTION_LOG_OUT)n.navigateToRoute(u.ROUTE_LOGOUT);else switch(r.attr(u.NAV_ACTION_TARGET)){case u.SUPPORT_PORTAL:s.navigateToURL(l.SUPPORT_PORTAL);break;case u.COMMUNITY_SITE:s.navigateToURL(l.COMMUNITY_SITE);break;case u.CONTACT_SALES_CE:n.navigateToURL(l.CONTACT_SALES_CE);break;case u.CREATE_SUPPORT_CASE_LINK:n.navigateToURL(l.SUPPORT_PORTAL_NEW_CASE);break;case u.DOCS_HELP:a.navigateToGeneralHelp();break;case u.DOCS_HELP_ON_PAGE:a.navigateToHelpPageBasedOnCurrentPage();break;case u.PRISM_CENTRAL_OVA:s.navigateToURL(l.PRISM_CENTRAL_OVA);break;case u.REST_API_EXPLORER:var o=this.getYesHandler();o();break;case u.EET:i.showEE(u.EET);break;case u.ENTITY_ALERT:n.navigateToPageByElement(u.PAGE_ALERTS,u.SUBPAGE_TABLE,t);break;case u.TUTORIALS.CLUSTER_HEALTH_INTRO:d.hasLocalStorage()&&(localStorage[u.LOCAL_STORAGE.TUTORIAL_CLUSTER_HEALTH]=""),n.navigateToPage(u.PAGE_CLUSTER_HEALTH,u.SUBPAGE_ENTITIES);break;case u.DISPLAY_SETTINGS.SETTINGS:i.showDisplaySettings();break;case u.DRAAS.ENABLE_DR:var c={action:t.attr(u.NAV_ACTION),options:{subApp:t.attr("subapp"),subAppRoute:t.attr("subapproute")}};s.executeAction(c,c.options);break;case u.PAGE_XI_ADMINISTRATION:n.navigateToURL(i.getAdministrationURL());break;case u.PAGE_XI_PROFILE:n.navigateToURL(i.getProfileURL());break;case u.PAGE_XI_BILLING:n.navigateToURL(i.getXiBillingURL());break;default:s.executeActionElement(r)}else{var h,p=r.attr(u.NAV_PAGE_ID),_=r.attr(u.NAV_SUBPAGE_ID);switch(r.attr(u.NAV_ACTION_TARGET)&&(h=u.NAV_ACTION_TARGET+"="+r.attr(u.NAV_ACTION_TARGET)),p){case u.PAGE_SSP:d.setFeatureAsSeen(p),n.navigateToURL(l.SSP);break;default:n.navigateToPage(p,_,h)}}}}})}),define("views/header/alert/AlertMenuView",["scrollintoview","views/basecomponents/navigation/MenuView"],function(e,t){"use strict";return t.extend({events:{},close:function(){this.$el.parent().closest("ul").removeClass("n-menu-active"),this.deactivate()},open:function(){this.refresh()},move:function(e,t,i){if(!this.active)return this.activate(i,this.$(t)),void this.active.scrollIntoView(100);if(e){var n=this.active[e+"All"](".n-nav-menu-item").eq(0);if(n.length)return this.activate(i,n),void this.active.scrollIntoView(100)}this.activate(i,this.$el(t)),this.active.scrollIntoView(100)}})}),define("models/query/AlertStatsQueryModel",["models/query/BaseQueryModel","data/DataProperties","data/DataManager","utils/AppConstants","utils/AppUtil","utils/AlertUtil"],function(e,t,i,n,s,a){"use strict";var r=t.EB.CLUSTER_UUID,o={ID:"id",NAME:"name",TOTAL:"total",ALERT_STATS:"alertStats"};return e.extend({name:"AlertGroupModel",groupingAttribute:r,initialize:function(t,i){e.prototype.initialize.apply(this,arguments),this.set(this.DP.ENTITY_TYPE,n.ENTITY_ALERT);var s=i[this.DP.FILTER_EXPR]||{};a.setAlertResolvedFilter(s,!1),this.set(this.DP.FILTER_EXPR,s),this.setQueryOptions(i)},getDataSourceURL:function(){return i.getDataSourceURL(i.API_VERSION.V1)},setQueryOptions:function(e){var i=1;e&&(this.groupingAttribute=e.groupingAttribute||r,i=e[this.DP.GROUP_MEMBER_COUNT]||i,this.set(this.DP.GROUP_MEMBER_COUNT,i));var n=[this.groupingAttribute,t.ALERT_SEVERITY];this.setMultipleGroupByAttributes(n)},setDefaultGroupByTimeInterval:function(e){},getQueryResultAttributes:function(){var e=this,t={},i=this.get(this.DP.GROUP_RESULTS);return _.each(i,function(i){var n=i[e.DP.GROUP_BY_COLUMN_VALUE],a=n.split(","),r=i[e.DP.TOTAL_ENTITY_COUNT];if(r>=0&&a.length>=2){var o=a[0],l=a[1],c=t[o];c||(c={id:o,name:e.getAttributeName(o),alertStats:{total:0,critical:0,warning:0}},c[e.groupingAttribute]=o,t[o]=c),e.setSeverityCount(c,l,r)}else s.log("AlertStatsQueryModel: invalid result count returned by query model.")}),_.map(t,function(e){return e})},setSeverityCount:function(e,t,i){var n=e[o.ALERT_STATS];n[o.TOTAL]+=i,n[t]+=i},getAttributeName:function(e){var t;return this.groupingAttribute===r&&(t=this.clusterManager.getNameById(e)),t||e}})}),define("models/query/RunwayInfoQueryModel",["utils/AppConstants","utils/AppUtil","data/DataProperties","models/query/BaseQueryModel"],function(e,t,i,n){"use strict";var s={ID:"entity_id",DISK_RUNWAY:"capacity.storage_runway",DISK_MIN_RUNWAY:"capacity.storage_min_runway",CPU_RUNWAY:"capacity.cpu_runway",CPU_MIN_RUNWAY:"capacity.cpu_min_runway",MEMORY_RUNWAY:"capacity.memory_runway",MEMORY_MIN_RUNWAY:"capacity.memory_min_runway",CPU_CAPACITY_HZ:"capacity.cpu_capacity_hz",DISK_SIZE_BYTES:"storage.capacity_bytes",CLUSTER_CPU_RUNWAY_INFO:"capacity.cpu_min_runway_info",CLUSTER_MEMORY_RUNWAY_INFO:"capacity.memory_min_runway_info",CLUSTER_STORAGE_RUNWAY_INFO:"capacity.storage_min_runway_info",CPU_RUNWAY_INFO:"capacity.cpu_runway_info",MEMORY_RUNWAY_INFO:"capacity.memory_runway_info",STORAGE_RUNWAY_INFO:"capacity.storage_runway_info",CLUSTER_RUNWAY:"capacity.runway",CLUSTER_RUNWAY_INFO:"capacity.runway_info",CP_READY_FLAG_INSIGHTS:"capacity.ui_ready_flag_insights",CP_STORAGE_START_TIME:"capacity.storage_input_start_time_usec",CATEGORY:"category",RUNWAY:"runway",CLUSTER_NAME:"clusterName"},a={"capacity.cpu_min_runway":"CPU","capacity.storage_min_runway":"Storage","capacity.memory_min_runway":"Memory"};return n.extend({name:"RunwayInfoQueryModel",idAttribute:s.ID,initialize:function(t){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};n.prototype.initialize.apply(this,arguments),this.set(this.DP.ENTITY_TYPE,e.ENTITY_CLUSTER),this.set(this.DP.GROUP_MEMBER_OFFSET,0),this.set(this.DP.GROUP_MEMBER_SORT_ORDER,e.SORT_ASCENDING);var r;r=a.basicInfo?[s.CPU_MIN_RUNWAY,s.MEMORY_MIN_RUNWAY,s.DISK_MIN_RUNWAY]:[s.CPU_RUNWAY,s.DISK_RUNWAY,s.MEMORY_RUNWAY,s.CPU_CAPACITY_HZ,s.DISK_SIZE_BYTES,s.CPU_MIN_RUNWAY,s.MEMORY_MIN_RUNWAY,s.DISK_MIN_RUNWAY,s.CLUSTER_CPU_RUNWAY_INFO,s.CLUSTER_MEMORY_RUNWAY_INFO,s.CLUSTER_STORAGE_RUNWAY_INFO,s.CLUSTER_RUNWAY,s.CLUSTER_RUNWAY_INFO,s.MEMORY_RUNWAY_INFO,s.CPU_RUNWAY_INFO,s.STORAGE_RUNWAY_INFO,s.CP_READY_FLAG_INSIGHTS,i.CPU_MAX_RUNWAY,i.MEMORY_MAX_RUNWAY,i.STORAGE_MAX_RUNWAY,s.CP_STORAGE_START_TIME],this.setGroupMemberAttributesList(r);var o=Date.now()-7*e.MILLIS_PER_DAY,l=Date.now();this.setTimeInterval(o,l,e.SAMPLING_INTERVAL_IN_SECS_FOR_A_DAY),this.setQueryOptions(a)},setQueryOptions:function(e){},getQueryResultAttributes:function(){var e=[],t=this.get(this.DP.GROUP_RESULTS);return _.each(t,function(t){var i=this._rawResultsToEntities(t[this.DP.ENTITY_RESULTS]);_.each(i,function(t){this.appendUIAttributes(t),e.push(t)},this)},this),e},appendUIAttributes:function(e){var t=[];Number.MAX_VALUE;if(_.each(a,function(i,n){e[n]&&t.push({category:i,runway:e[n][0]})}),t.length){var i=_.min(t,function(e){var t=parseInt(e.runway,10);return 0===t?t:t||Number.MAX_VALUE});e[s.CATEGORY]=i.category,e[s.RUNWAY]=i.runway}else e[s.CATEGORY]=null,e[s.RUNWAY]=null;e[s.CLUSTER_NAME]=this.getClusterName(e[s.ID])},_rawResultsToEntities:function(e){var t=[];return _.each(e,function(e){var i={};i[s.ID]=e[s.ID],_.each(e.data,function(e){var t=e.name;if(0===e.values.length)i[t]=null;else{var n=[];_.each(e.values,function(e){_.isArray(e.values)&&e.values.length>=1&&n.push(e.values[0])}),i[t]=n}}),t.push(i)},this),t},getClusterName:function(e){var t=this.clusterManager.getNameById(e);return t||(t=e),t},parseRunwayInfo:function(e,i){try{return JSON.parse(e[i][0])}catch(e){t.log("RunwayInfoQueryModel: Failed to parse runway info: "+i)}return null}})}),define("models/query/GroupByQueryModel",["models/query/BaseQueryModel"],function(e){"use strict";return e.extend({name:"GroupByQueryModel",groupBys:null,initialize:function(t,i){e.prototype.initialize.apply(this,arguments),this.setQueryOptions(i)},setQueryOptions:function(e){var t=this;_.each(this.URL_ATTRIBUTES,function(i){var n=e[i];n&&t.set(i,n)},this),e.groupBys?(this.groupBys=e.groupBys,this.setMultipleGroupByAttributes(e.groupBys)):this.groupBys=[],e[this.DP.GROUP_MEMBER_ATTRIBUTES]&&this.setGroupMemberAttributesList(e[this.DP.GROUP_MEMBER_ATTRIBUTES]);var i=e[this.DP.GROUP_MEMBER_COUNT]||1e3;this.set(this.DP.GROUP_MEMBER_COUNT,i),e[this.DP.FILTER_EXPR]&&this.set(this.DP.FILTER_EXPR,e[this.DP.FILTER_EXPR])},getQueryResultAttributes:function(){var e=this,t=[],i=this.get(this.DP.TOTAL_ENTITY_COUNT),n=this.get(this.DP.FILTERED_ENTITY_COUNT),s=this.get(this.DP.GROUP_RESULTS);return _.each(s,function(s){var a=s[e.DP.TOTAL_ENTITY_COUNT],r=s[e.DP.GROUP_BY_COLUMN_VALUE],o=r.split(","),l=e._rawResultsToEntities(s[e.DP.ENTITY_RESULTS]),c={};c[e.DP.TOTAL_ENTITY_COUNT]=i,c[e.DP.FILTERED_ENTITY_COUNT]=n,c[e.DP.TOTAL_GROUP_COUNT]=a,o.length===e.groupBys.length&&_.each(e.groupBys,function(e,t){c[e]=o[t]},e),c[e.DP.ENTITY_RESULTS]=l,t.push(c)},this),t}})}),define("models/lcm/LCMModel",["models/BaseModel","utils/AppConstants"],function(e,t){"use strict";var i={ID:"id",UUID:"uuid",MODEL:"entity_model",VERSION:"version",LOCATION_ID:"location_id",ENTITY_CLASS:"entity_class",DESCRIPTION:"description",LAST_UPDATED_TIME:"last_updated_time_usecs",REQUEST_VERSION:"request_version",CLUSTER:"_master_cluster_uuid_"},n={AVAILABLE_VERSIONS:"available_version_list",UPGRADE:"upgrade",DEPENDENCY_LIST:"dependencies",AVAILABLE_VERSION:"available_version",MODEL_DISPLAY_NAME:"modelDisplayName",ENTITIES:"entities",ENTITY_ID:"entity_id",ENTITY_COUNTS:"entity_counts",UPDATE_COUNTS:"update_counts",LAST_UPDATED_TIME:"lastUpdateTime",UPDATED_ON:"updatedOn",SELECTED_VERSION:"selectedVersion",LOCATIONS:"locations",CHECKED:"checked",PROGRESS:"progress",IS_COMPLETED:"isCompleted",TASK_MESSAGE:"taskMessage",STATUS:"status",VERSIONS_BY_ENTITY:"versions_by_entity",VERSIONS:"versions",ENTITY_MODELS:"entity_models",ENTITY_IDS:"entity_ids",EXACT_DEPENDENCY:"exact",CLUSTER_WITH_UPGRADE:"cluster_with_upgrade",CLUSTER_WITHOUT_UPGRADE:"cluster_without_upgrade",ENTITY_COUNTS_WITHOUT_UPGRADE:"entity_count_without_upgrade"},s={critical:"Critical",recommended:"Recommended",latest:"Latest",up_to_date:"Up to Date"},a=["critical","recommended","latest","up_to_date"],r={CLUSTER:"cluster",NODE:"node"},o=function(e){var t=null;return e&&e.length>0&&(_.some(a,function(i){return t=_.find(e,function(e){return e.status===i})}),t||(t=_.first(e))),t},l="Cluster software component",c=t.ENTITY_LCM;return e.extend({DP:i,UIDP:n,VERSION_STATUS:s,idAttribute:i.UUID,nameAttribute:i.NAME,urlRoot:null,entityType:c,name:"LCMModel",toJSON:function(t){var i=e.prototype.toJSON.apply(this,arguments);return t&&t.includeAttribute&&(i[n.AVAILABLE_VERSION]=this.getValue(n.AVAILABLE_VERSION),i[n.ENTITY_COUNTS]=this.getValue(n.ENTITY_COUNTS),i[n.UPDATE_COUNTS]=this.getValue(n.UPDATE_COUNTS),i[n.MODEL_DISPLAY_NAME]=this.getValue(n.MODEL_DISPLAY_NAME)),i},getValue:function(t){switch(t){case n.AVAILABLE_VERSION:var a={version:"",icon:"",status:"",dependencyCount:0},r=this.get(n.AVAILABLE_VERSIONS),l=o(r);return l&&(a.version=l.version,a.icon=l.status||"",a.status=s[l.status]||"",l[n.DEPENDENCY_LIST]&&(a.dependencyCount=_.size(l[n.DEPENDENCY_LIST]))),a;case n.ENTITY_IDS:return this.getEntityAttributeList(i.UUID);case n.LOCATIONS:return this.getEntityAttributeList(i.LOCATION_ID);case n.VERSIONS:return this.getEntityAttributeList(i.VERSION);case n.ENTITY_MODELS:return this.getEntityAttributeList(i.MODEL);case n.ENTITY_COUNTS:var c=this.getEntityAttributeList(i.UUID);return c?c.length:0;case n.UPDATE_COUNTS:var u=this.get(n.VERSIONS_BY_ENTITY);return u?_.size(u):0;case n.MODEL_DISPLAY_NAME:return this.isLCMFrameworkModule()?this.get(i.MODEL):this.get(i.ID)?this.get(i.MODEL)+" - "+this.get(i.ID):this.get(i.MODEL);default:return e.prototype.getValue.apply(this,arguments)}},getClusters:function(e){var t=this.getEntities(e),n=this.clusterManager.getPrismCentralClusterUuid();return _.keys(_.groupBy(t,function(e){return e[i.CLUSTER]||n}))},getEntities:function(e){var t=this.get(n.VERSIONS_BY_ENTITY),s=t?_.size(t):0,a=this.get(n.ENTITIES);return!s&&e?[]:e||s!==a.length?(t&&(a=_.filter(a,function(n){return e?t[n[i.UUID]]:!t[n[i.UUID]]},this)),a):[]},getEntityAttributeList:function(e){var t=this.get(n.ENTITIES);return _.map(t,function(t){return t[e]})},findDependenciesByVersion:function(e){var t=_.find(this.get(n.AVAILABLE_VERSIONS),function(t){return t.version===e});return t?t[n.DEPENDENCY_LIST]:[]},_findDependenciesByMatchingSibling:function(e){var t=this.get(n.VERSIONS_BY_ENTITY),s=[];return t&&_.each(t,function(t){_.some(t,function(t){var a=t.entity_uuid,r=_.find(this.get(n.ENTITIES),function(e){return e[i.UUID]===a});if(r&&r[i.ENTITY_CLASS]===e[i.ENTITY_CLASS]&&r[i.MODEL]===e[i.MODEL]&&t[i.VERSION]===e[i.VERSION]){var o=t[n.DEPENDENCY_LIST]||[];if(_.size(o)>0)return Array.prototype.push.apply(s,o),!0}},this)},this),s},findChildDependenciesByLocation:function(e,t){var s=e[i.MODEL],a=this.getEntityAttributeList(i.MODEL),r=this.getEntityAttributeList(i.UUID),o=this.get(n.VERSIONS_BY_ENTITY);if(o&&_.size(o)){var l=this.getEntityAttributeList(i.LOCATION_ID),c=[];return _.each(a,function(a,u){if(a===s&&(!t||t===l[u])){var d=r[u],h=o[d];if(h){var p=this.findMatchingDependentVersion(h,e);p&&p[n.DEPENDENCY_LIST]&&Array.prototype.push.apply(c,p[n.DEPENDENCY_LIST])}else{var _=this.get(n.ENTITIES)[u];if(_&&_[i.VERSION]){var T=this._findDependenciesByMatchingSibling(_);T&&Array.prototype.push.apply(c,T)}}}},this),this.toUniqueDependencies(c)}return[]},findDependenciesByEntityClass:function(){var e=this.get(n.VERSIONS_BY_ENTITY);if(e){var t=[];return _.each(e,function(e){var i=o(e);i&&i[n.DEPENDENCY_LIST]&&Array.prototype.push.apply(t,i[n.DEPENDENCY_LIST])},this),this.toUniqueDependencies(t)}return[]},findCurrentVersionByEntityId:function(e){if(e===this.get(i.UUID))return this.get(i.VERSION);var t=this.getEntityAttributeList(i.UUID),s=this.getValue(n.VERSIONS),a=t.indexOf(e);return a>=0&&s[a]},toUniqueDependencies:function(e){return _.uniq(e,!0,function(e){return e[i.ENTITY_CLASS]+"-"+e[i.MODEL]+"-"+e[i.VERSION]})},findMatchingDependentVersion:function(e,s){if(e){var a=s[i.VERSION],r=!0===s[n.EXACT_DEPENDENCY]||s[n.EXACT_DEPENDENCY]===t.BOOLEAN_TRUE,o=_.find(e,function(e){return e.version===a});return o||r||(o=_.first(e)),o}},isLCMFrameworkModule:function(){if(this.get(i.ENTITY_CLASS))return l.toLowerCase()===this.get(i.ENTITY_CLASS).toLowerCase()}},{DP:i,UIDP:n,VERSION_HIERARCHY:a,LOCATION_PREFIX:r,LCM_FRAMEWORK:l,findVersionByHierarchy:o,ENTITY_TYPE:c})}),define("models/lcm/LCMQueryModel",["models/query/BaseQueryModel","models/lcm/LCMModel","utils/AppConstants","utils/FilterUtil"],function(e,t,i,n){"use strict";return e.extend({name:"LCMQueryModel",groupBys:null,initialize:function(t,i){e.prototype.initialize.apply(this,arguments),this.setQueryOptions(i)},setQueryOptions:function(e){_.each(this.URL_ATTRIBUTES,function(t){var i=e[t];i&&this.set(t,i)},this),this.set(this.DP.ENTITY_TYPE,t.ENTITY_TYPE),e.groupBys&&this.setMultipleGroupByAttributes(e.groupBys),this.groupBys=[],e.groupBys&&e.groupBys.indexOf(t.DP.VERSION)>=0&&(this.groupBys=[t.DP.LOCATION_ID]);var s=this.convertGroupMemberAttributesList(e[this.DP.GROUP_MEMBER_ATTRIBUTES]);this.set(this.DP.GROUP_MEMBER_ATTRIBUTES,s),this.set(this.DP.GROUP_MEMBER_COUNT,1e3);var a={};e[this.DP.FILTER_EXPR]&&(a=_.extend(a,e[this.DP.FILTER_EXPR])),this.clusterManager.isMulticlusterNavMode()&&n.addFilterCondition(a,t.DP.CLUSTER,n.createFilterCondition(i.ENTITY_LCM,t.DP.CLUSTER,i.FILTER_OPERATORS.EQUALS,i.FILTER_NULL_VALUE)),this.set(this.DP.FILTER_EXPR,a)},getQueryResultAttributes:function(){var t=[],i=this.get(this.DP.GROUP_RESULTS),n=this;return _.each(i,function(i){var s=i[e.DP.GROUP_BY_COLUMN_VALUE],a=this._rawResultsToEntities(i[this.DP.ENTITY_RESULTS]);if(_.size(this.groupBys)){var r=_.groupBy(a,function(e){return n.getGroupByValue(e)},this);_.each(r,function(e){var i=_.first(e);t.push(_.extend(i,this.getGroupedEntityResults(a)))},this)}else if(_.isEmpty(s))_.each(a,function(e){t.push(_.extend(e,{entities:[e]}))},this);else{var o=_.first(a);t.push(_.extend(o,this.getGroupedEntityResults(a)))}},this),t},getGroupedEntityResults:function(e){var i={};i[t.UIDP.ENTITIES]=e;var n=_.max(e,function(e){return e[t.DP.LAST_UPDATED_TIME]});return i[t.UIDP.LAST_UPDATED_TIME]=n?n[t.DP.LAST_UPDATED_TIME]:e[t.DP.LAST_UPDATED_TIME],i},getGroupByValue:function(e){return _.map(this.groupBys,function(t){return e[t]}).join("--")}})}),define("models/task/TaskEBQueryModel",["models/BaseModel","models/ebrowser/EBGroupModel","models/ebrowser/EBQueryModel","models/ebrowser/EBGroupsCollection","models/task/TaskServiceCollection","data/DataManager","data/DataURLConstants","data/DataProperties","utils/EntityUtil","utils/AppConstants","utils/FilterUtil"],function(e,t,i,n,s,a,r,o,l,c,u){"use strict";var d=i.extend({urlRoot:r.TASK,name:"TaskEBQueryModel",performQuery:function(e){e=e||{};var t=$.Deferred();e.data=e.data||{};var n=null,s=this.get(this.DP.FILTER_EXPR),a=null;s&&_.size(s)>0&&(n=this._getFilterByStatus(s),a=this._getFilterByOperation(s));var r=this.getTaskFilterCriteria();if(r)return e.data[o.META_FILTER_CRITERIA]=r,e.data[c.PARAM_COUNT]=c.TASK_MAX_TOTAL_COUNT,e.data[c.PARAM_PAGE]=1,i.prototype.fetch.apply(this,arguments);var l=this.getTaskManager().getGlobalTasks();return a&&(l=this.getFilteredExistingGlobalTasks(a,l)),n&&(l=this.getFilteredExistingGlobalTasks(n,l)),this.setWithFilteredTasks(l),t.resolve(),e.success&&e.success(this),t.promise()},getDataSourceURL:function(){return a.getDataSourceURL(a.API_VERSION.V1)},stopFetch:function(){},getTaskFilterCriteria:function(){var e,t={};return _.each(this.get(this.DP.FILTER_EXPR),function(e,i){i===o.TASK_NAME?t[o.TASK_PARENT_TASK_UUID]=e:i===o.TASK_TYPE?t[o.TASK_OPERATION_TYPE]=e:t[i]=e}),!_.isEmpty(t)&&t[o.TASK_PARENT_TASK_UUID]&&(e=this._filterExpressionToFilterCriteria(t)),e},parse:function(t,i){var n=e.prototype.parse.apply(this,arguments),s={};if(n){var a=n.metadata||{},r=_.isArray(n)?n:n.entities,c=this.get(this.DP.ENTITY_TYPE),u=this.getOldTasksWithEBFilter();r=this.removeOldTasksFromEBTasks(r),r=this.mergeOldTasksWithEBTasks(u,r),a[o.META_GRAND_TOTAL]=r.length,a[o.META_TOTAL_ENTITIES]=r.length;var d=l.createCollection(c,r);s=this.createEBResultObject(a,d)}return s},createEBResultObject:function(e,i){var s={};s[this.DP.TOTAL_ENTITY_COUNT]=e[o.META_GRAND_TOTAL],s[this.DP.FILTERED_ENTITY_COUNT]=e[o.META_TOTAL_ENTITIES],s[this.DP.TOTAL_GROUP_COUNT]=1;var a=this.get(this.DP.GROUPING_ATTR);s[this.DP.GROUP_RESULTS]=new n;var r=this.get(this.DP.ENTITY_TYPE),l={};return l[t.DP.ENTITY_TYPE]=r,l[t.DP.GROUPING_ATTR]=a,l[t.DP.NAME]=c.ALL_ENTITIES_GROUP,l[t.DP.MEMBERS_COL]=i,l[t.DP.TOTAL_ENTITY_COUNT]=e[o.META_GRAND_TOTAL],s[this.DP.GROUP_RESULTS].add(new t(l)),s},setWithFilteredTasks:function(e){var t={};t[o.META_GRAND_TOTAL]=e.length,t[o.META_TOTAL_ENTITIES]=e.length;var i=this.createEBResultObject(t,e);this.set(i)},getFilteredExistingGlobalTasks:function(e,t){var i=t,n=i.getSummarizedTasks();n=this._filterByType(e,n);var a=[];return _.each(n,function(e){a.push(e.toJSON())}),i=new s,i.isMulticlusterVMTask=!0,i.reset(a,{silent:!0}),i},getOldTasksWithEBFilter:function(){var e=[];this.operators||(this.operators=u.getFilterOperators());var t=this.getTaskManager().getOldTasksFromGlobalCollection();return _.each(t,function(t){var i=!1,n=!1;_.each(this.get(this.DP.FILTER_EXPR),function(e,s){!i&&e&&_.each(e,function(e){if(!i){var a=e.op,r=e.name,l=e.value1,u=t.getValue(s);if(r===c.FILTER_DRILLDOWN)return void(n=!0);s===o.TASK_STATUS&&(l=l.replace("k","").toLowerCase()),s===o.TASK_TYPE&&(l=l.toLowerCase(),u=u.toLowerCase());(0,this.operators[a])(l,u)&&(i=!0)}},this)},this),i&&!n&&e.push(t.toJSON())},this),e},mergeOldTasksWithEBTasks:function(e,t){return _.isEmpty(e)?t:(t=t.concat(e),t.sort(s.comparator),t)},removeOldTasksFromEBTasks:function(e){return _.filter(e,function(e){return!e[o.TASK_IS_OLD_TASK]})},toTaskStatus:function(e){var t=e;return t&&t.replace("k","").toLowerCase()},_getFilterByStatus:function(e){var t=this,i=e[o.TASK_STATUS],n=void 0;if(i&&_.size(i)){var s=[];_.each(i,function(e){s.push(t.toTaskStatus(e.value1))}),n={attribute:o.TASK_STATUS,values:s}}return n},_getFilterByOperation:function(e){var t=e[o.TASK_TYPE],i=void 0;if(t&&_.size(t)){var n=[];_.each(t,function(e){n.push(e.value1)}),i={attribute:o.TASK_TYPE,values:n}}return i},_filterByType:function(e,t){var i=void 0;switch(e.attribute){case o.TASK_STATUS:i=e.values;var n=e.attribute;t=_.filter(t,function(e){return i.indexOf(e.get(n))>=0});break;case o.TASK_TYPE:i=e.values
;var s=i.map(function(e){return e.toLowerCase&&e.toLowerCase()});t=_.filter(t,function(e){return _.some(s,function(t){return e.getTaskDisplayName().toLowerCase().indexOf(t)>-1})})}return t},getEBQueryModelInstance:function(e){return new d(e)}});return d}),define("models/query/PlaysQueryModel",["models/query/BaseQueryModel","models/query/GroupByQueryModel","data/DataProperties","utils/AppConstants","utils/FilterUtil"],function(e,t,i,n,s){"use strict";var a={COMPLETED:"completed",FAILED:"failed",PAUSED:"paused"};return t.extend({name:"PlaysQueryModel",initialize:function(a){var r,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};o.groupBys=[i.PLAYBOOK_RESULT_STATUS],this.set(this.DP.GROUP_MEMBER_COUNT,o[this.DP.GROUP_MEMBER_COUNT]),t.prototype.initialize.apply(this,arguments),this.set(this.DP.ENTITY_TYPE,n.ENTITY_PLAYBOOK_RESULT);var l=o[this.DP.FILTER_EXPR]||{};l=s.addFilterCondition(l,i.PLAY_EXECUTION_START_TIME,this.getTimeFilter()),this.set(this.DP.FILTER_EXPR,l),this.setGroupMemberAttributesList([i.PLAYBOOK_RESULT_STATUS,i.PLAY_EXECUTION_START_TIME]),this.playModel=new e((r={},_defineProperty(r,i.EB.ENTITY_TYPE,n.ENTITY_PLAYBOOK_RESULT),_defineProperty(r,e.DP.GROUP_MEMBER_COUNT,1),r));var c={};c=s.addFilterCondition(c,i.PLAYBOOK_RESULT_STATUS,s.createFilterCondition(n.ENTITY_PLAYBOOK_RESULT,i.PLAYBOOK_RESULT_STATUS,n.FILTER_OPERATORS.EQUALS,i.PLAYBOOK_RESULT_STATUS_MAP.PAUSED)),this.playModel.set(e.DP.FILTER_EXPR,c),this.playModel.set(e.DP.QUERY_NAME,"playbooks_widget:pause:action_rule_results")},getTimeFilter:function(){return s.createFilterCondition(n.ENTITY_PLAYBOOK_RESULT,i.PLAY_EXECUTION_START_TIME,n.FILTER_OPERATORS.GREATER_OR_EQUAL,1e3*(Date.now()-n.MILLIS_PER_DAY),null,this.i18n("last_24_hrs"))},getLinkFilter:function(e,t,a){var r=a||{};return t||(r=s.addFilterCondition(r,i.PLAY_EXECUTION_START_TIME,this.getTimeFilter())),r=s.addFilterCondition(r,i.PLAYBOOK_RESULT_STATUS,s.createFilterCondition(n.ENTITY_PLAYBOOK_RESULT,i.PLAYBOOK_RESULT_STATUS,n.FILTER_OPERATORS.EQUALS,e))},getStatusMap:function(){var e,t=i.PLAYBOOK_RESULT_STATUS_MAP;return e={},_defineProperty(e,a.PAUSED,{expr:this.getLinkFilter(t.PAUSED,!0),count:0}),_defineProperty(e,a.COMPLETED,{expr:this.getLinkFilter(t.COMPLETED_WITH_ERRORS,!0,this.getLinkFilter(t.SUCCEEDED)),count:0}),_defineProperty(e,a.FAILED,{expr:this.getLinkFilter(t.FAILED,!0,this.getLinkFilter(t.ABORTED,!0,this.getLinkFilter(t.TIMED_OUT))),count:0}),e},getQueryResultAttributes:function(){var e=this,n=t.prototype.getQueryResultAttributes.apply(this,arguments),s=this.getStatusMap(),r=i.PLAYBOOK_RESULT_STATUS_MAP;return this.playModel&&(s[a.PAUSED].count=this.playModel.get(this.DP.FILTERED_ENTITY_COUNT)),_.each(n,function(t){var n=t[i.PLAYBOOK_RESULT_STATUS],o="";n===r.SUCCEEDED||n===r.COMPLETED_WITH_ERRORS?o=a.COMPLETED:n===r.FAILED||n===r.ABORTED||n===r.TIMED_OUT?o=a.FAILED:n!==r.PAUSED||e.playModel||(o=a.PAUSED),o&&(s[o].count+=t.total_group_count)}),[s]},setDefaultGroupByTimeInterval:function(e){},save:function(){var e=[];return e.push(this.playModel.save()),e.push(t.prototype.save.apply(this,arguments)),$.whenAll.apply($,e)}})});define("models/query/QueryResultCollection",["models/BaseModel","models/query/BaseQueryModel","models/PollingCollection","models/query/AlertStatsQueryModel","models/query/RunwayInfoQueryModel","models/query/GroupByQueryModel","models/lcm/LCMQueryModel","models/task/TaskEBQueryModel","models/query/PlaysQueryModel","data/DataProperties","utils/AppConstants","utils/AppUtil"],function(e,t,i,n,s,a,r,o,l,c,u,d){"use strict";var h={ALERT:"alert",RUNWAY:"runway",LCM:"lcm",TASK:"task",GROUP_BY_ATTRIBUTES:"groupByAttributes",IMPACTED_CLUSTER:"impactedCluster",PLAYBOOK_RESULT:"playbook_result",CATEGORY_JOIN:"category_join"},p={ENTITY_RESULTS:t.DP.ENTITY_RESULTS,RESULT_MODELS:t.DP.RESULT_MODELS,TOTAL_ENTITY_COUNT:t.DP.TOTAL_ENTITY_COUNT,FILTERED_ENTITY_COUNT:t.DP.FILTERED_ENTITY_COUNT,FILTERED_GROUP_COUNT:t.DP.FILTERED_GROUP_COUNT,TOTAL_GROUP_COUNT:t.DP.TOTAL_GROUP_COUNT},T=t.extend({initialize:function(e,i){t.prototype.initialize.apply(this,arguments),this.idAttribute=c.EB.ENTITY_ID,i&&this.setQueryOptions(i)},setQueryOptions:function(e){var t=this;_.each(this.URL_ATTRIBUTES,function(i){var n=e[i];n&&t.set(i,n)}),e[this.DP.GROUP_MEMBER_ATTRIBUTES]&&this.set(this.DP.GROUP_MEMBER_ATTRIBUTES,this.convertGroupMemberAttributesList(e[this.DP.GROUP_MEMBER_ATTRIBUTES])),e.queryType===h.CATEGORY_JOIN&&(this.set(this.DP.GROUPING_ATTR,c.ABAC_CATEGORY_KEY),this.set(this.DP.GROUP_ATTRIBUTES,[{attribute:c.CAT_NAME,ancestor_entity_type:c.ABAC_CATEGORY_KEY}])),e[this.DP.FILTER_EXPR]&&this.set(this.DP.FILTER_EXPR,e[this.DP.FILTER_EXPR])}}),E=function(e,t){var i=void 0;switch(e){case h.IMPACTED_CLUSTER:i=new n(null,t);break;case h.PLAYBOOK_RESULT:i=new l(null,t);break;case h.RUNWAY:t.basicInfo=!0,i=new s(null,t);break;case h.LCM:i=new r(null,t);break;case h.TASK:i=new o(t),i.set(t);break;case h.GROUP_BY_ATTRIBUTES:i=new a(null,t);break;default:i=new T(null,t)}return i},S=function(t,i,n){return e.extend({idAttribute:t,nameAttribute:i,name:"QueryResultModel",entityType:n})},g=function(t,i,n){return e.extend({name:"GroupByQueryResultModel",DP:p,groupBys:t,entityType:i,EntityModel:n,initialize:function(t,i){if(e.prototype.initialize.apply(this,arguments),this.EntityModel){var s=this.get(this.DP.ENTITY_RESULTS),a=[];_.each(s,function(e){a.push(new n(e))},this),this.unset(this.DP.ENTITY_RESULTS,{silent:!0}),this.set(this.DP.RESULT_MODELS,a,{silent:!0})}},sync:function(e,t,i){throw new Error("Operation not supported")},idParserFunc:function(){return this.cid},nameParserFunc:function(){var e=this;return _.map(this.groupBys,function(t){return t+": "+e.get(t)},this).join(",")}})},A=i.extend({model:null,entityType:null,queryType:null,queryOptions:null,initialize:function(e,n){if(i.prototype.initialize.apply(this,arguments),n){this.entityType=n.entityType,this.queryType=n.queryType||null;var s=n.entityModel||null;this.queryOptions=n||{},this.queryOptions[t.DP.ENTITY_TYPE]||(this.queryOptions[t.DP.ENTITY_TYPE]=this.entityType);var a=this.queryOptions[t.DP.GROUP_MEMBER_ATTRIBUTES];!a&&s&&s.DP&&(a=_.map(s.DP,function(e){return e}),_.extend(this.queryOptions,{group_member_attributes:a})),this.queryType===h.GROUP_BY_ATTRIBUTES&&_.size(n.groupBys||[])?this.model=g(n.groupBys,this.entityType,s):this.model=s}else this.model=S(c.ID,c.NAME,this.entityType)},setQueryOption:function(e){this.queryOptions=_.extend(this.queryOptions,e)},setQueryModel:function(e){this.queryModel=e,this.model||(this.model=S(e?e.idAttribute:c.ID,e?e.nameAttribute:c.NAME,this.entityType))},getQueryModel:function(){return this.queryModel},preFetch:function(){this.queryModel?this.queryModel&&this.queryOptions&&this.queryType!==h.TASK&&this.queryModel.setQueryOptions(this.queryOptions):this.setQueryModel(E(this.queryType,this.queryOptions))},sync:function(e,t,i){var n=$.Deferred();if(this.queryType===A.QUERY_TYPES.RUNWAY){var s=this.clusterManager.getClusterCollection();if(s&&0===s.length)return d.debug("QueryResultCollection | "+this.name+" | Fetch Ignored: no registered clusters"),this.reset([]),this.updateState(u.STATE_SUCCESS),n.resolve(this,"success"),n.promise()}if(this.getState()!==u.STATE_PENDING){this.triggerPendingEvent(i),this.updateState(u.STATE_PENDING);var a=this;return this.queryModel?this.performQuery(this.queryModel).done(function(){a._processEntityResults(a.queryModel),a.updateState(u.STATE_SUCCESS),n.resolve(a,"success")}).fail(function(e){a.trigger("error",a,e),n.reject(a,e)}):(this.updateState(u.STATE_ERROR),n.reject(a,"Missing query model.")),n.promise()}d.debug("QueryResultCollection | "+this.name+" | Fetch Ignored. Current State is:"+this.stateMonitor.getState())},performQuery:function(e){return this.queryType===h.TASK?e.performQuery({}):e.save()},_processEntityResults:function(e){var t=e.get(e.DP.TOTAL_ENTITY_COUNT),i=e.get(e.DP.FILTERED_ENTITY_COUNT);this._metadata={totalEntities:i,grandTotalEntities:t};var n=e.getQueryResultAttributes();if(this.queryType===h.TASK){var s=e.getQueryResults(),a=s[e.DP.RESULT_MODELS];this.reset(a)}else this.queryType===h.CATEGORY_JOIN?this.reset(this._processCategoryResults(e,n)):this.reset(n)},_processCategoryResults:function(e,t){var i={},n=e.getQueryResultSummary();return _.each(n,function(e){var t=e.summary[c.CAT_NAME];_.each(e.entities,function(e){var n=e[c.ENTITY_ID_ATTR];i[n]=t+":"+e[c.CAT_VALUE]})}),_.each(t,function(e){var t=e[c.ENTITY_ID_ATTR];e[c.CAT_NAME]=i[t]}),t}},{QUERY_TYPES:h});return A}),define("models/alert/AlertDetailModel",["models/BaseModel","utils/AlertUtil"],function(e,t){"use strict";var i={ID:"id",NAME:"name",ALERT_TITLE:"alert_title",SEVERITY:"severity",CONTEXT_TYPES:"context_types",CONTEXT_VALUES:"context_values",MESSAGE:"message",RESOLVED:"resolved",CREATED_TIMESTAMP:"created_time_stamp",ALERT_TYPE_ID:"type_id"};return e.extend({DP:i,getDisplayName:function(){return t.getAlertDisplayName(this)},getCreatedTime:function(){return t.getAlertCreatedTime(this)},getAlertType:function(){return this.get(i.ALERT_TYPE_ID)}},{DP:i})}),define("models/alert/AlertSummaryCollection",["models/query/QueryResultCollection","models/alert/AlertDetailModel","data/DataProperties","utils/AppConstants"],function(e,t,i,n){"use strict";var s=n.ALERT_SEVERITY_NAMES;return e.extend({intervalTimeInMilliSec:n.LONG_POLLING_INTERVAL,name:"AlertQueryResultsCollection",alertCount:10,initialize:function(s){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};a=_.extend(a,{entityType:n.ENTITY_ALERT,entityModel:t,group_member_count:this.alertCount,group_member_sort_attribute:t.DP.CREATED_TIME_STAMP,group_member_attributes:[i.ALERT_TITLE_V3,i.ALERT_DEFAULT_MSG,i.ALERT_SEVERITY,i.ALERT_PARAM_NAMES,i.ALERT_PARAM_VALUES],group_member_sort_order:n.SORT_DESCENDING}),e.prototype.initialize.apply(this,arguments)},getAlertsBySeverity:function(e){if(this.isGroupedBySeverity()){var t=this.getAlertGroupBySeverity(e);return t&&t.get("models")||[]}},getAlertCountsBySeverity:function(e){if(this.isGroupedBySeverity()){var t=this.getAlertGroupBySeverity(e);return t&&t.get("total_group_count")||0}},getAlertGroupBySeverity:function(e){if(this.isGroupedBySeverity())return _.find(this.models,function(i){var n=i.get(t.DP.SEVERITY);return n===e||n===s[e]})},getAlertCount:function(){return this.getMetaDataTotalCount()},isGroupedBySeverity:function(){return this.queryModel&&this.queryModel.get(this.queryModel.DP.GROUPING_ATTR)===i.ALERT_SEVERITY},setCount:function(e){this.alertCount=e}})}),define("managers/AlertSummaryManager",["models/alert/AlertSummaryCollection","data/DataProperties","utils/AlertUtil"],function(e,t,i){"use strict";return{MAX_ALERTS_COUNT:10,alertCollection:null,initialize:function(){this.alertCollection=new e(null,{queryType:e.QUERY_TYPES.GROUP_BY_ATTRIBUTES,groupBys:[t.ALERT_SEVERITY]}),this.alertCollection.setCount(this.MAX_ALERTS_COUNT)},startServices:function(){var e={};i.setAlertResolvedFilter(e,!1),this.alertCollection.setQueryOption({filter_expression:e}),this.alertCollection.startPolling()},stopServices:function(){this.alertCollection.stopPolling()},getAlertCollection:function(){return this.alertCollection},fetchOnDemand:function(){this.alertCollection.fetch()}}}),define("views/header/alert/AlertView",["data/DataProperties","views/basecomponents/BaseView","views/header/alert/AlertTemplates","utils/CommonTemplates","views/header/alert/AlertMenuView","managers/NavigationManager","managers/ClusterManager","managers/AlertSummaryManager","managers/AccessManager","managers/ExploreManager","events/AppEvents","utils/AppConstants","utils/AppUtil","utils/AntiscrollUtil","utils/AlertUtil","utils/FilterUtil","utils/SubViewHelper"],function(e,t,i,n,s,a,r,o,l,c,u,d,h,p,T,E,S){"use strict";return t.extend({CONST_ALERT_DISPLAY_COUNT:3,model:null,subViewHelper:null,isMultiCluster:!1,events:{"click .n-alerts-dropdown":"onMenuClick","click .n-alert-type":"onAlertHeaderClick","click [alert^='k']":"onAlertHeaderClick"},modelEvents:{"reset model":"render"},initialize:function(){t.prototype.initialize.apply(this,arguments),this.subViewHelper=new S,_.each(this.$('[alert^="k"]'),function(e){var t=new s({el:$(e).find(".n-nav-menu")});this.subViewHelper.register(t.cid,t)},this),this.model=o.getAlertCollection(),this.isMultiCluster=this.clusterManager.isMulticlusterNavMode(),_.bindAll(this,"onEntityEvent"),u.onAppEvent(u.ENTITIES_UPDATED,this.onEntityEvent)},render:function(){var t,n,s,a,r=this.$('[alert^="k"]'),o=null;this.$(".n-alerts-iconography.svg-icon").attr("class","svg-icon n-alerts-iconography"),_.each(r,function(r){if(s=$(r).attr("alert"),a=d.ALERT_SEVERITY_NAMES[s],t=this.model.getAlertsBySeverity(s),t&&(t=t.slice(0,this.CONST_ALERT_DISPLAY_COUNT)),n=this.model.getAlertCountsBySeverity(s),null===o&&n>0){o=a;var l="n-"+o;h.addSVGClass(this.$(".n-alerts-iconography.svg-icon"),l)}var c=$(".n-header-alerts").find(".n-alerts-dropdown .n-"+a+" .n-nav-col");if(c.find(".n-nav-menu-item").remove(),$(c).find(".n-alert-show-all").closest("li").remove(),t.length>0){$(r).find("button").html(n||""),this.$(".n-alerts.n-"+a).show(),this.$(".n-alerts-dropdown .n-"+a+" .n-alert-qty").html(n),this.$(".n-alerts-dropdown").find(".n-"+a+" .n-alert-name").html(a),$(r).removeClass("n-no-alerts");for(var u in t){var p={};if(!this._findAlertItemById(c,t[u].getId())){switch(s){case e.ALERT_SEVERITY_INFO:p.boxClass="n-info-box";break;case e.ALERT_SEVERITY_WARNING:p.boxClass="n-warning-box";break;case e.ALERT_SEVERITY_CRITICAL:p.boxClass="n-critical-box"}p.time=h.getElapsedTime({timestamp:t[u].getCreatedTime(),includeAgo:!1}),p.message=t[u].getDisplayName(),$(c).append(i.ALERT_MENU_ITEM(p)),$(c).find("li:last-child a.n-alert-menuitem").attr(d.NAV_ACTION,d.ACTION_DETAILS).attr(d.NAV_ACTION_TARGET,d.ENTITY_ALERT).attr(d.NAV_ACTION_TARGET_ID,t[u].getId()).attr(d.NAV_ACTION_TARGET_NAME,t[u].getAlertType())}}}else $(r).find("button").off(),$(r).addClass("n-no-alerts"),this.$(".n-alerts.n-"+a).hide()},this),this.model.getAlertCount()>0?(h.removeSVGClass(this.$(".n-alerts-iconography.svg-icon"),"n-no-alerts"),this.$el.removeClass("n-no-alerts")):(h.removeSVGClass(this.$(".n-alerts-iconography.svg-icon"),"n-no-alerts"),this.$el.addClass("n-no-alerts")),$(".n-navigation").trigger(u.NAV_MENU_UPDATE);var l=this;this.$(".n-alert-menuitem").on("click",function(e){l.onAlertItemClick(e),l.collapseDropDown()})},destroy:function(){h.debug("AlertView  | destroy | ",this.cid),this.$(".n-alert-button").off(),this.$(".n-alert-menuitem").off(),u.offAppEvent(u.ENTITIES_UPDATED,this.onEntityEvent),this.subViewHelper.removeAll(),this.subViewHelper=null,this.$(".n-alert-antiscroll").empty(),t.prototype.destroy.apply(this,arguments)},collapseDropDown:function(){this.$(".n-alerts-dropdown").hide()},_findAlertItemById:function(e,t){return _.find($(e).find(".n-nav-menu-item"),function(e){return $(e).attr(d.NAV_ACTION_TARGET_ID)===t})},isDropDownVisible:function(){return this.$(".n-alert-antiscroll:visible").length>0},isButtonVisible:function(){return this.$(".n-alert-button:visible").length>0},_applyAntiScroll:function(e){var t=Math.min($(window).height()-100,$(e).find(".n-nav-menu")[0].scrollHeight);p.applyAntiScroll(e,"376px",t+"px",{autoHide:!0})},getSubViewByElement:function(e){return _.find(this.subViewHelper.subViews,function(t){return t.$el[0]===e[0]})},generateFormattedMessage:function(t,i){if(this.isMultiCluster){var s=r.getNameById(i[e.CLUSTER_UUID]);t=n.CLUSTER_NAME_PREFIX({clusterName:s})+t}return T.formatIssue(t,i)},onStartServices:function(){this.delegateModelEvents(),o.startServices()},onStopServices:function(){this.undelegateModelEvents(),o.stopServices()},showDropDown:function(e,t){if(c.isEnableSearchConvergence()||$(e.target).hasClass("n-alert-button"))return this;t=t||e.currentTarget;var i=$(t).find(".n-alerts-dropdown");return $(i).show(),this},onAlertItemClick:function(e){if(this.isMultiCluster||l.isClusterFFEnabled(d.FFLAGS.ALERTS_IN_IDF)){var t=$(e.currentTarget),i=t.attr(d.NAV_ACTION_TARGET),n=t.attr(d.NAV_ACTION_TARGET_ID),s=a.createNavigationContext(i,{});a.navigateToFullScreenDetailsPane(i,n,s)}else a.navigateToPageByElement(d.PAGE_ALERTS,d.SUBPAGE_TABLE,e.currentTarget)},onMenuClick:function(e){e.stopPropagation()},onAlertHeaderClick:function(e){if(this.isMultiCluster||l.isClusterFFEnabled(d.FFLAGS.ALERTS_IN_IDF)){var t,i=$(e.currentTarget);if(i.hasClass("n-alert-type")){var n=i.parent(".n-alerts");t=this.getSeverityFromElement(n)}else t=i.attr("alert")||"",t=t.replace(/^k/,"").toLowerCase();this.showAlertExplorerPage(t)}else a.navigateToPage(d.PAGE_ALERTS);this.collapseDropDown()},onEntityEvent:function(e,t){t.entityType===d.ENTITY_ALERT&&o.fetchOnDemand()},getSeverityFromElement:function(e){return e.hasClass("n-warning")?d.ALERT_SEVERITY_NAMES.kWarning:e.hasClass("n-info")?d.ALERT_SEVERITY_NAMES.kInfo:d.ALERT_SEVERITY_NAMES.kCritical},showAlertExplorerPage:function(t){var i=null;if(t){var n={};E.addFilterCondition(n,e.ALERT_SEVERITY,E.createFilterCondition(d.ENTITY_ALERT,e.ALERT_SEVERITY,d.FILTER_OPERATORS.EQUALS,t)),E.addFilterCondition(n,e.ALERT_RESOLVED,E.createFilterCondition(d.ENTITY_ALERT,e.ALERT_RESOLVED,d.FILTER_OPERATORS.EQUALS,d.BOOLEAN_FALSE));i={contextId:a.createNavigationContext(d.ENTITY_ALERT,{filter_expression:n})}}a.navigateToPage(d.PAGE_ALERT_EXPLORER,null,i)}})}),define("views/header/task/TaskTemplates",[],function(){"use strict";return{TASK_ICON_DEFAULT:'<i class="n-task-icon" aria-hidden="true" data-icon="D"></i>',TASK_IMAGE_DISK:'<img src="app/assets/images/icons/icon_disk.png"></img>',TASK_IMAGE_HOST:'<img src="app/assets/images/icons/icon_host.png"></img>',TASK_SEPARATOR:'<li class="sep"></li>',POPOVER:_.template('<div class="n-task-popover" style="display:none;"><div class="n-task-popover-body"><%= body %></div></div>'),POPOVER_CONTENT:_.template('<span class="n-label">Start:&nbsp;</span><span class="n-time"><%= start %></span><span class="n-label" style="padding:0 12px">-</span><span class="n-label">End:&nbsp;</span><span class="n-time"><%= end %></span>')}}),define("views/header/task/BaseTaskItemView",["datejs","views/basecomponents/BaseView","views/header/task/TaskTemplates","events/AppEvents","data/DataProperties","utils/AppUtil","utils/AppConstants","managers/TaskManager"],function(e,t,i,n,s,a,r,o){"use strict";return t.extend({DATE_FORMAT:"MMM d, hh:mm:ss tt",DISPLAYABLE_STATUS_COMPLETE:"done",tagName:"li",model:null,subViewHelper:null,firstPass:!0,events:{"click .n-delete-link":"deleteTask"},initialize:function(){this.render()},render:function(){},update:function(e){},updateIconVisibility:function(e){},animateWidth:function(e,t){var i=this.$("> .n-task-menuitem .n-visual-bar .bar"),r=0,o=this.model.get(s.TASK_PERCENT_COMPLETE);if(i.length&&(r=parseInt(i[0].style.width,10)),isNaN(o)||null===o)return void a.log("BaseTaskItemView: Invalid percent complete value for task item.");a.debug("BaseTaskItemView: Setting width of cid ",this.cid," to ",o);var l=this,c=function(){e&&$(".n-header-tasks").trigger(n.TASK_PULSE),l._setStatusText()};this._setStatusStyle(),this._checkAnimation()&&o>r?this.$("> .n-task-menuitem .n-visual-bar .bar").animate({width:o+"%",ease:"ease-in-out"},2e3,c):(this.$("> .n-task-menuitem .n-visual-bar .bar").css("width",o+"%"),c())},_checkAnimation:function(){return!this.firstPass&&this.$el.is(":visible")},_setStatusStyle:function(){switch(this.model.get(s.TASK_STATUS)){case r.TASK_STATUS_FAILED:case r.TASK_STATUS_CANCELED:case r.TASK_STATUS_ABORTED:this.$("> .n-task-menuitem").addClass("n-failed");break;case r.TASK_STATUS_COMPLETE:case r.TASK_STATUS_QUEUED:case r.TASK_STATUS_ACTIVE:default:this.$("> .n-task-menuitem").removeClass("n-failed")}},_setStatusText:function(){switch(this.model.get(s.TASK_STATUS)){case r.TASK_STATUS_FAILED:case r.TASK_STATUS_CANCELED:case r.TASK_STATUS_ABORTED:case r.TASK_STATUS_QUEUED:this.$("> .n-task-menuitem .n-status-text").html(this.model.get(s.TASK_STATUS)).show();break;case r.TASK_STATUS_COMPLETE:this.$("> .n-task-menuitem .n-status-text").html(this.DISPLAYABLE_STATUS_COMPLETE).show();break;case r.TASK_STATUS_ACTIVE:default:this.$("> .n-task-menuitem .n-status-text").hide()}},setPercentText:function(){this.$("> .n-task-menuitem .n-percent-text").html(this.model.getPercentageDisplay())},generatePopoverContent:function(){var e="&nbsp;",t="&nbsp;",n=this.model.get(s.TASK_END_TIME),o=this.model.get(s.TASK_START_TIME);switch(_.isNumber(o)?t=new Date(o/r.MICROS_PER_MILLI).toString(this.DATE_FORMAT):a.log("BaseTaskItemView: Invalid task start time of "+o+" for entity id "+this.getTaskEntityId()),this.model.get(s.TASK_STATUS)){case r.TASK_STATUS_FAILED:case r.TASK_STATUS_CANCELED:case r.TASK_STATUS_COMPLETE:case r.TASK_STATUS_SKIPPED:case r.TASK_STATUS_ABORTED:_.isNumber(n)?e=new Date(n/r.MICROS_PER_MILLI).toString(this.DATE_FORMAT):a.log("BaseTaskItemView: Invalid task end time of "+n+" for entity id "+this.getTaskEntityId());break;case r.TASK_STATUS_QUEUED:t="queued",e="";break;default:e="in progress"}return i.POPOVER_CONTENT({start:t,end:e})},addPopover:function(e){var t=this,n=function(){var n=a.getFixedPosition(e.el),s=i.POPOVER(e);$(e.attach).append(s);var r=$(e.attach).find(".n-task-popover"),o=($(e.attach).find(".n-task-popover-caret"),t.$el.is(".n-task-child")?59:42);r.css("left",n.left+o+"px").css("top",n.top-7+"px"),r.find(".n-task-popover-caret").css("left","-10px").css("top",e.el.height()/2-8+"px"),r.show()},s=function(){$(e.attach).find(".n-task-popover").remove()};e.trigger&&"hover"!==e.trigger?"click"===e.trigger&&e.el&&$(e.el).off("click").on("click",function(t){$(e.attach).find(".n-task-popover").length?s():n()}):e.el&&$(e.el).off("hover").hover(function(){"0"!==$(e.el).closest("li").css("opacity")&&n()},function(){s()})},getTaskId:function(){return this.model.getValue(s.TASK_ID)},getTaskEntityId:function(){return this.model.getValue(s.TASK_ENTITY_ID)},getTaskName:function(){return this.model.getTaskMessageSummary?this.model.getTaskMessageSummary():this.model.getValue(s.TASK_NAME)},getTaskType:function(){return this.model.getValue(s.TASK_TYPE)},getTaskEntityType:function(){return this.model.getValue(s.TASK_ENTITY_TYPE)},getPercentComplete:function(){return this.model.get(s.TASK_PERCENT_COMPLETE)},isDeleteEnabled:function(){return(!this.options||!this.options.isMulticluster)&&this.model.isDeleteEnabled()},deleteTask:function(){if(this.model.isDeleteEnabled()){var e=this;$.nutanixConfirm({msg:"Are you sure you want to remove this task?",yes:function(){e.model.destroy({success:function(){o.fetchOnDemand({force:!0}),o.hideProgressMonitorDropdown()},error:function(){o.hideProgressMonitorDropdown()}})},yesText:"Yes",noText:"No"})}},destroy:function(){a.debug("BaseTaskItemView  | destroy | ",this.cid),t.prototype.destroy.apply(this,arguments),this.subViewHelper&&(this.subViewHelper.removeAll(),this.subViewHelper=null),this.$el.remove()}})}),define("text!templates/header/task/TaskItemView.html",[],function(){return'<div id="n-task-menuitem"\n     class="n-task-menuitem  <%= subTask ? \'subtask-item\' : \'parent-item\' %>"\n     <%= navAttrs %> >\n  <div class="n-task-message">\n    <span class="n-task-message-text" title="<%= message %>">\n      <%= message %>\n    </span>\n    <span class="n-percent-text"></span>\n    <span class="n-status-text" style="display:none;"></span>\n    <span class="n-delete-link"\n          style="display: <%= showDelete ? \'inline-block\' : \'none\' %> ">\n      Clear\n    </span>\n    <i class="n-time-icon" aria-hidden="true" data-icon="E"></i>\n  </div>\n  <div class="n-widget">\n    <div class="n-visual-bar">\n      <div class="bar bar-good" style="width:0%"></div>\n    </div>\n    <% if (!subTask) { %>\n      <a class="n-parent-task-link closed" style="display:none;">\n        Open\n      </a>\n    <% } %>\n  </div>\n</div>\n<% if (!subTask) { %>\n<ul class="n-subtask-list"></ul>\n<% } %>'}),define("views/header/task/SubTaskItemView",["jquery","data/DataProperties","views/header/task/BaseTaskItemView","views/header/task/TaskTemplates","text!templates/header/task/TaskItemView.html","utils/AppUtil","utils/AppConstants"],function(e,t,i,n,s,a,r){"use strict";var o=_.template(s);return i.extend({DEFAULT_SUB_TASK_MESSAGE:"Sub task",render:function(){var e={};e.message=this.model.get(t.SUB_TASK_MESSAGE),e.message||(a.log("SubTaskItemView: Sub task message is null, displaying default message."),e.message=this.DEFAULT_SUB_TASK_MESSAGE);var i;switch(this.model.getValue(t.TASK_ENTITY_TYPE)){case r.ENTITY_HOST:i=n.TASK_IMAGE_HOST;break;case r.ENTITY_DISK:i=n.TASK_IMAGE_DISK;break;default:i=n.TASK_ICON_DEFAULT}e.navAttrs=t.TASK_ENTITY_ID+'="'+this.getTaskEntityId()+'"',e.navAttrs+=" "+t.TASK_TYPE+'="'+this.getTaskType()+'"',e.navAttrs+=" "+t.TASK_ENTITY_TYPE+'="'+this.getTaskEntityType()+'"',e.subTask=!0,e.showDelete=this.isDeleteEnabled(),this.$el.html(o(e)),this.$(".n-task-message").before(i),this.$el.addClass("n-task-child").attr("parentid",this.model.getValue(t.TASK_ENTITY_ID))},update:function(i){var n=this.isDeleteEnabled();i?(this.model.get(t.TASK_STATUS),i.get(t.TASK_STATUS)):("",this.model.get(t.TASK_STATUS)),this.model=i||this.model,this.animateWidth(!1),this.setPercentText(),this.setSubTaskMessage(),this.updateIconVisibility(n),this.firstPass=!1,this.addPopover({el:this.$("> .n-task-menuitem .n-time-icon"),body:this.generatePopoverContent(),trigger:"hover",attach:e("body")})},setSubTaskMessage:function(){var e=this.model.get(t.SUB_TASK_MESSAGE)||this.DEFAULT_SUB_TASK_MESSAGE;this.$(".n-task-message-text").text(e).attr("title",e)},isDeleteEnabled:function(){return!1},updateIconVisibility:function(e){e?this.$(".subtask-item  .n-delete-link").css("display","inline-block"):this.$(".subtask-item  .n-delete-link").hide()},destroy:function(){a.debug("SubTaskItemView  | destroy | ",this.cid),i.prototype.destroy.apply(this,arguments)}})}),define("views/header/task/TaskItemView",["views/header/task/BaseTaskItemView","views/header/task/SubTaskItemView","views/header/task/TaskTemplates","text!templates/header/task/TaskItemView.html","models/task/TaskModel","managers/ClusterManager","data/DataProperties","utils/AppUtil","utils/CommonTemplates","utils/AppConstants","utils/SubViewHelper"],function(e,t,i,n,s,a,r,o,l,c,u){"use strict";var d=_.template(n);return e.extend({render:function(){var e={};if(e.message=this.getTaskName(),this.options&&this.options.isMulticluster)if(this.model.isMulticlusterVMTask)e.message=c.MULTICLUSTER_NAME+": "+e.message;else{var t=a.getNameById(this.model[r.CLUSTER_UUID]);e.message=l.CLUSTER_NAME_PREFIX({clusterName:t})+e.message}var n;switch(this.getTaskEntityType()){case c.ENTITY_HOST:n=i.TASK_IMAGE_HOST;break;case c.ENTITY_DISK:n=i.TASK_IMAGE_DISK;break;default:n=i.TASK_ICON_DEFAULT}e.navAttrs=r.TASK_ENTITY_ID+'="'+this.getTaskEntityId()+'"',e.navAttrs+=" "+r.TASK_TYPE+'="'+this.getTaskType()+'"',e.navAttrs+=" "+r.TASK_ENTITY_TYPE+'="'+this.getTaskEntityType()+'"',e.subTask=!1,e.showDelete=this.isDeleteEnabled(),this.$el.html(d(e)),this.$el.addClass("n-task-parent"),this.$("> .n-task-menuitem .n-task-message").after(n)},update:function(e){var t,i,n=!1,s=this.isDeleteEnabled();if(e?(i=this.model.get(r.TASK_STATUS),t=e.get(r.TASK_STATUS)):(i="",t=this.model.get(r.TASK_STATUS)),t!==c.TASK_STATUS_FAILED&&t!==c.TASK_STATUS_COMPLETE&&t!==c.TASK_STATUS_CANCELED||i!==t&&(n=!0),this.model=e||this.model,this.subViewHelper){var a=this;_.each(this.subViewHelper.subViews,function(e){e.update(a._createSubTaskModel(a._getSubTaskData(e)))})}this._setExpandCollapseLink(),this.animateWidth(n),this.updateIconVisibility(s),this.setPercentText(),this.firstPass=!1},updateIconVisibility:function(e){e?this.$(".parent-item  .n-delete-link").css("display","inline-block"):this.$(".parent-item  .n-delete-link").hide()},_setExpandCollapseLink:function(){var e=this.model.get(r.TASK_SUB_TASKS);e&&e.length>0&&this.$el.addClass("n-task-parent").find(".n-parent-task-link").show()},createAllSubTasks:function(){var e=this.model.get(r.TASK_SUB_TASKS);if(e&&e.length>0)for(var t in e)this._createSubTask(e[t]);else this.$(".n-visual-bar").css("width","338px")},destroyAllSubTasks:function(){this.$(".n-subtask-list").empty(),this.subViewHelper&&this.subViewHelper.removeAll()},_createSubTask:function(e){this.subViewHelper||(this.subViewHelper=new u);var i=new t({model:this._createSubTaskModel(e)});this.$el.addClass("n-task-parent"),this.$(".n-subtask-list").append(i.$el),i.update(),this.subViewHelper.register(i.cid,i)},_createSubTaskModel:function(e){if(e)return e[r.TASK_ENTITY_TYPE]=this.getTaskEntityType(),e[r.TASK_ENTITY_ID]=this.getTaskEntityId(),new s(e);o.log("TaskItemView: Issue creating sub task model.")},_getSubTaskData:function(e){var t=null;return _.each(this.model.get(r.TASK_SUB_TASKS),function(i){i[r.SUB_TASK_TAG]===e.model.get(r.SUB_TASK_TAG)&&i[r.SUB_TASK_COMPONENT]===e.model.get(r.SUB_TASK_COMPONENT)&&(t=i)}),t},destroy:function(){o.debug("TaskItemView  | destroy | ",this.cid),e.prototype.destroy.apply(this,arguments)}})}),define("views/header/task/TaskView",["data/DataProperties","views/basecomponents/BaseView","views/header/task/TaskItemView","managers/TaskManager","managers/NavigationManager","events/AppEvents","utils/AppConstants","utils/AppUtil","utils/AntiscrollUtil","utils/SubViewHelper"],function(e,t,i,n,s,a,r,o,l,c){"use strict";var u=_.template('<li class="no-activity"><%= msg %><li>');return t.extend({MAX_TASKS_DISPLAYED_QUICK_VIEW:100,MAX_TASK_DROPDOWN_HEIGHT:300,subViewHelper:null,taskCollection:null,processingClick:!1,isMulticluster:!1,events:{"click .n-task-antiscroll":"onMenuClick","click .n-parent-task-link":"onParentTaskLinkClick","click .n-view-tasks":"onViewAllTasks","click #linkClearTask":"onClearTaskClick"},initialize:function(){_.bindAll(this,"onParentTaskLinkClick","_startPercentDisplay","showPulse","_applyAntiScroll","onTaskChanges"),this.subViewHelper=new c,this.$el.on(a.TASK_PULSE,this.showPulse)},render:function(e,t){if(o.hasLocalStorage()&&localStorage[r.LOCAL_STORAGE.NO_TASKS])return void o.log("TaskView: Rendering of tasks has been disabled.");n.unregisterHandlerResetStructure(this.render,this),this.taskCollection=n.getGlobalTasks(),this.taskCollection.restructureModels({silent:!0});var i=this.$(".btn-group"),s=this.taskCollection.getSummarizedTasks()||[],l=n.getQuickViewTasks()||[],c=(this.taskCollection.getMetaDataGrandTotalCount(),l.length),d=this.$(".n-task-menu");i.removeClass("hide"),this._clearTasks(this.taskCollection,t);var h,p;if(c>0){h=l,p=Math.min(this.MAX_TASKS_DISPLAYED_QUICK_VIEW,c);for(var _=0;_<p;_++)this._renderTask(h[_],d)}else d.html(u({msg:n.getNoTaskActivityMessage()}));this._setHeaderProgress(l,s),$(".n-navigation").trigger(a.NAV_MENU_UPDATE)},onStartServices:function(){n.registerHandlerForChangedTasks(this.onTaskChanges),n.registerHandlerResetStructure(this.render,this)},onStopServices:function(){n.unregisterHandlerForChangedTasks(this.onTaskChanges),n.unregisterHandlerResetStructure(this.render,this),this._clearTasks(null,!0)},_renderTask:function(t,i){if(!t)return void o.log("TaskView: invalid task model.");var n=this.$(this._getTaskSelector(t));if(n.length){var s=this._getSubView({el:n});s?s.update(t):o.log("TaskView: Issue finding subview for entity id: "+t.getValue(e.TASK_ENTITY_ID)+" and task type: "+t.getValue(e.TASK_TYPE)+" and entity type: "+t.getValue(e.TASK_ENTITY_TYPE))}else{var a=this.renderMenuItem(t);$(i).append(a.$el),function(e){setTimeout(function(){e.update()},500)}(a),this.subViewHelper.register(a.cid,a)}},_renderSubTask:function(t,i){var n=this.$(this._getTaskSelector(i));if(n.length){var s=this.renderMenuItem(t);this._appendDependent(n,s,i.getValue(e.TASK_ENTITY_ID)),function(e){setTimeout(function(){e.update()},500)}(s),this.subViewHelper.register(s.cid,s)}else o.log("TaskView: Issue finding parent task for entity id: "+i.getValue(e.TASK_ENTITY_ID)+" and task type: "+i.get(e.TASK_TYPE)+" and entity type: "+i.getValue(e.TASK_ENTITY_TYPE))},_appendDependent:function(e,t,i){
$(e).find(".n-parent-task-link").show(),$(e).closest("li").addClass("n-task-parent"),$(e).closest("li").after(t.$el.addClass("n-task-child").attr("parentid",i))},_clearTasks:function(e,t){this.$(".no-activity").remove(),this.subViewHelper&&_.each(this.subViewHelper.subViews,function(i){var n=null;t||(n=this._getModelBySubView(i,e)),n||(i.$el.is(":first-child")?i.$el.next().is(".sep")&&i.$el.next().remove():i.$el.prev().remove(),this.subViewHelper.remove(i.cid))},this)},clearAndHideWidget:function(){this.$(".btn-group").hide(),this.subViewHelper.removeAll(),this.$("n-task-menu").hide(),this.$("n-task-menu").find(".n-task-antiscroll").hide(),this.$("n-task-menu").find(".n-task-wrapper").off(),$("body .n-task-popover").remove()},renderMenuItem:function(e){return new i({model:e,isMulticluster:this.isMulticluster})},showPulse:function(){var e=this;e.$(".n-task-button").addClass("n-pulsate"),setTimeout(function(){e.$(".n-task-button").removeClass("n-pulsate")},r.TASK_PULSE_ANIMATION_TIMEOUT)},destroy:function(){o.debug("TaskView  | destroy | ",this.cid),n.unregisterHandlerForChangedTasks(this.onTaskChanges),n.unregisterHandlerResetStructure(this.render,this),this.$el.off(a.TASK_PULSE),this.$(".n-task-wrapper").off(),this.$(".n-task-antiscroll").empty(),this.subViewHelper.removeAll(),this.subViewHelper=null,t.prototype.destroy.apply(this,arguments)},_getModelBySubView:function(t,i){var n=t.getTaskEntityId(),s=t.getTaskEntityType(),a=t.getTaskType();return _.find(i.getSummarizedTasks(),function(t){return t.getValue(e.TASK_ENTITY_ID)===n&&t.getValue(e.TASK_ENTITY_TYPE)===s&&t.get(e.TASK_TYPE)===a})},_getSubView:function(t){return t.el&&(t.id=$(t.el).attr(e.TASK_ENTITY_ID),t.type=$(t.el).attr(e.TASK_TYPE),t.entityType=$(t.el).attr(e.TASK_ENTITY_TYPE)),_.find(this.subViewHelper.subViews,function(e,i){return e.getTaskEntityId()==t.id&&e.getTaskEntityType()===t.entityType&&e.getTaskType()===t.type})},_setHeaderProgress:function(e,t){var i={running:[],failed:[],success:[]};_.each(e,function(e){e.isStatusCategoryFailed()?i.failed.push(e):e.isStatusCategoryRunning()?i.running.push(e):e.isStatusCategorySucceeded()&&i.success.push(e)});var n=[];i.running.length?n=_.filter(this.subViewHelper.subViews,function(e){return e.model.isStatusCategoryRunning()}):i.failed.length?n=_.filter(this.subViewHelper.subViews,function(e){return e.model.isStatusCategoryFailed()}):_.each(this.subViewHelper.subViews,function(e){n.push(e)});var s=parseInt($(".n-task-wrapper > .radial").data("class"),10);s=isNaN(s)?0:s;var a=0;_.each(n,function(e){e.firstPass&&(a+=parseInt(e.getPercentComplete(),10))});var r,o;a>0&&(a=Math.min(s+a/n.length,100),r=this.$(".n-task-wrapper > .radial").data("class"),o=Math.floor(a),r>o?this.$(".n-task-wrapper > .radial").addClass("decreasing"):this.$(".n-task-wrapper > .radial").removeClass("decreasing"),this.$(".n-task-wrapper > .radial").removeClass("percent"+r).addClass("percent"+o),this.$(".n-task-wrapper > .radial").data("class",o));var l=0;_.each(n,function(e){l+=parseInt(e.getPercentComplete(),10)}),l=Math.min(l/n.length,100),r=this.$(".n-task-wrapper > .radial").data("class"),o=Math.floor(l),r>o?this.$(".n-task-wrapper > .radial").addClass("decreasing"):this.$(".n-task-wrapper > .radial").removeClass("decreasing"),this.$(".n-task-wrapper > .radial").removeClass("percent"+r).addClass("percent"+o),this.$(".n-task-wrapper > .radial").data("class",o),this.$(".n-task-wrapper > .radial").removeClass("failed succeeded no-activity"),this.$(".n-task-button").removeClass("failed  succeeded  none  no-activity"),this.$("#taskDotFailed").removeClass("show");var c=this.$(".n-task-button");i.running.length&&c.text(i.running.length),i.failed.length?0===i.running.length?(c.text(i.failed.length),this.$(".n-task-wrapper > .radial").addClass("failed"),this.$(".n-task-button").addClass("failed")):this.$("#taskDotFailed").addClass("show"):i.success.length&&0===i.failed.length&&0===i.running.length?(c.text(i.success.length),this.$(".n-task-button").addClass("succeeded"),this.$(".n-task-wrapper > .radial").addClass("succeeded")):0===i.success.length&&0===i.failed.length&&0===i.running.length&&(c.text(""),this.$(".n-task-button").addClass("none"),this.$(".n-task-wrapper > .radial").addClass("none")),this._updateCleanUp(i),this._updateFooter(i)},_updateCleanUp:function(e){var t=this.$("#linkClearTask");t.hasClass("hide")||t.addClass("hide"),(e.failed.length||e.success.length)&&t.removeClass("hide")},_updateFooter:function(e){e.running.length?(this.$("#countGroupRunning").show(),this.$("#countGroupRunning .labelCount").text(e.running.length)):this.$("#countGroupRunning").hide(),e.failed.length?(this.$("#countGroupFailed").show(),this.$("#countGroupFailed .labelCount").text(e.failed.length)):this.$("#countGroupFailed").hide(),e.success.length?(this.$("#countGroupSuccess").show(),this.$("#countGroupSuccess .labelCount").text(e.success.length)):this.$("#countGroupSuccess").hide()},_startPercentDisplay:function(){this.intervalId=setInterval(function(){var e=this.$(".n-task-parent");_.each(e,function(e){var t=$(e).closest("li"),i=parseInt($(t).find(".bar")[0].style.width,10);$(t).find(".n-percent-text").html(i+"%")})},1e3)},_applyAntiScroll:function(){var e=this.$(".n-task-antiscroll"),t=Math.min(this.MAX_TASK_DROPDOWN_HEIGHT,this.$(".n-task-menu")[0].scrollHeight);l.applyAntiScroll(e,"404px",t+"px",{autoHide:!1})},_getTaskSelector:function(t){return t||o.log("TaskView: invalid task model."),"li ["+e.TASK_ENTITY_ID+'="'+t.getValue(e.TASK_ENTITY_ID)+'"]['+e.TASK_TYPE+'="'+t.get(e.TASK_TYPE)+'"]['+e.TASK_ENTITY_TYPE+'="'+t.getValue(e.TASK_ENTITY_TYPE)+'"]['+e.TASK_UI_TASK_ID+'="'+t.get(e.TASK_ID)+'"]'},showDropDown:function(e){return this.$(".n-tasks-dropdown").removeClass("hide"),this._applyAntiScroll(),this},collapseDropDown:function(){this.$(".n-tasks-dropdown").addClass("hide"),$("body .n-task-popover").remove(),this._applyAntiScroll()},isDropDownVisible:function(){return this.$(".n-task-antiscroll").is(":visible")},isButtonVisible:function(){return this.$(".n-task-button").is(":visible")},setMulticluster:function(e){this.isMulticluster=e},onViewAllTasks:function(){s.navigateToPage(r.PAGE_TASKS)},onMenuClick:function(e){e.stopPropagation()},onParentTaskLinkClick:function(e){if(e.preventDefault(),!0!==this.processingClick){this.processingClick=!0;var t=$(e.currentTarget).closest(".n-task-parent").find(".n-subtask-list"),i=this._getSubView({el:$(e.currentTarget).closest(".n-task-menuitem")});this.$(".antiscroll-scrollbar").hide();var n,s,a,r=this;$(e.currentTarget).hasClass("closed")?(n=1,a=function(){r._applyAntiScroll(),r.$(".antiscroll-scrollbar").show(),r.processingClick=!1},s=function(){t.css("overflow","visible"),$(t).animate({opacity:n},200,a)},i.createAllSubTasks(),$(t).css("height","auto"),$(t).animate({"padding-top":"10px","padding-bottom":"16px","padding-right":"10px","padding-left":"14px","margin-top":"15px","margin-left":"10px","margin-right":"5px","margin-bottom":"22px",display:"block"},200,s),$(e.currentTarget).html("Close"),$(e.currentTarget).removeClass("closed")):(n=0,a=function(){r._applyAntiScroll(),r.$(".antiscroll-scrollbar").show(),r.processingClick=!1,i.destroyAllSubTasks()},s=function(){t.css({overflow:"hidden",margin:"0px",padding:"0px"}),$(t).animate({height:"0px"},200,a)},$(t).animate({opacity:n},200,s),$(e.currentTarget).html("Open"),$(e.currentTarget).addClass("closed"))}},onTaskChanges:function(e,t){this.showPulse(),this.render(null,t)},onClearTaskClick:function(){n.cleanUpCompletedQuickViewTasks(!0)}})}),define("text!templates/header/task/TaskServiceItemView.html",[],function(){return'<div id="n-task-menuitem"\n     class="n-task-menuitem  <%= subTask ? \'subtask-item\' : \'parent-item\' %>"\n     <%= navAttrs %> >\n  <div class="n-task-message">\n    <div class="n-task-message-text" title="<%= message %>">\n      <span class="n-cluster-name">\n        <%- _.isNull(clusterName)? \'\' : clusterName %>\n      </span>\n      <span class="n-message">\n        <%- message %>\n      </span>\n    </div>\n    <span class="n-percent-text"></span>\n  </div>\n  <div class="n-widget">\n    \x3c!-- Radial progress to be filled by the DataRendererUtil. --\x3e\n  </div>\n</div>'}),define("utils/renderers/TaskRenderers",["data/DataProperties","managers/AccessManager","managers/ClusterManager","managers/I18nManager","utils/CommonTemplates","utils/AppConstants","utils/I18nMixin","utils/ManagerMixin","utils/AppUtil","utils/TimeUtil","utils/SVG"],function(e,t,i,n,s,a,r,o,l,c,u){"use strict";var d=u.SVGIcon("Exclamation_Mark","-inline -micro"),h={ENTITY_NAME:"entityName",SCHEDULE_START_TIME:"start_time",SCHEDULE_TIME_ZONE:"time_zone"},p=_.template('<a class="entityDetails persisted-link" data-id="<%= taskId %>"><%= taskEntity %> </a>'),T=_.template('<span class="entityDetailsText capitalize-first-char"data-id="<%= taskId %>"><%= taskEntity %> </span>'),E=_.template('<span class="entityDetailsTooltip" actionTarget="<%= entityType %>" actionTargetId="<%= entityIds %>"><%= entityName %></span>'),S=_.template('<a class="taskNameDetails persisted-link" data-id="<%= taskId %>"><%= taskMsg %> </a>'),g=_.template('<a class="taskUpgradeDetails persisted-link" data-id="<%= taskId %>">'+a.TASK_LABEL_DETAILS+"</a>"),A=_.template('<a class="taskUpgradeDetails persisted-link" data-id="<%= taskId %>">'+a.TASK_LABEL_VERSION+"</a>"),m=_.template('<a class="taskStatusDetails persisted-link  capitalize-first-char eb-tooltip"  data-id="<%= taskId %>"><%= status %> </a>'),f=_.template('<a class="details-link <%= classes %>" data-id="<%= id %>" title="<%= title %>"><%= displayValue %> </a>'),I=_.template('<a class="n-link-action details-link <%= classes %>" action="<%= action %>" actionTarget="<%= actionTarget %>" actionTargetId="<%= actionTargetId %>" <% if (targetTabId) { %> targetTabId="<%= targetTabId %>" <% } %> actionTargetName="<%= actionTargetName %>"><%= displayValue %> </a>'),C=_.template("<% if (errorMessage) { %><p><strong><%= errorMessage %></strong></p><% } %><%= downloadMessage %>"),v=_.template('<span class="capitalize-first-char eb-tooltip" data-id="<%= taskId %>"><%= status %> </span>'),R=_.template('<a class="schedule-link n-link-action persisted-link" action="<%= action %>" actionTarget="<%= entityType %>" actionTargetId="<%= id %>" title="<%= title %>"><%= displayValue %> </a>'),N=_.template('<br><span class="schedule-start-time" title="<%= timeString %>"><%= I18nMixin.i18nsStatic("ScheduleJobModel","scheduledOn", timeString) %></span>'),P=_.template('<span class="tooltip-wrapper"\n        data-toogle=“tooltip” title="<%= reason %>"><%= icon %>\n      </span>'),O=_.template("<div class='custom-task-tooltip test_task_widget_status_tooltip'>\n        <div class='failed-count task-status'>\n          <span class='task-status-name'><%= taskFailed %></span>\n          <span class='task-status-count'>\n            <span class = 'count-icon -error'></span>\n            <span class = 'count-val test_task_widget_status_failed_count'>\n              <%= failedCount %></span>\n          </span>\n        </div>\n        <div class='warn-count task-status'>\n          <span class='task-status-name'><%= taskWarn %></span>\n          <span class='task-status-count'>\n            <span class = 'count-icon -warn'></span>\n            <span class = 'count-val test_task_widget_status_warning_count'>\n              <%= warnCount %></span>\n          </span>\n        </div>\n      </div>"),y=_.template('<span class="text test_task_widget_task_percentage""title="<%= percent %>"><%= percent %></span>'),D=_.template('<div class="custom-warning-icon test_task_widget_task_status_icon">\n        '+d+"\n      </div>"),M=/delete_(.*)_intentful/;return _.extend({},r,o,{name:"TaskRenderers",renderTaskDetails:function(t){var i=t.get(e.TASK_STATUS),r=i,o="",l=t.get(e.TASK_PERCENT_COMPLETE);if(i===a.TASK_STATUS_ACTIVE&&(r=t.get(e.TASK_PERCENT_COMPLETE)+"%"),t.isTaskCompleted()&&(o=i.toLowerCase()+"-",l=l||100),t.get(a.ENTITY_GENERIC)&&t.get(a.ENTITY_GENERIC)[0]===a.ENTITY_RECOVERY_PLAN_JOB){var c=e.EB.RECOVERY_PLAN_JOB.WARN_COUNT,d=e.EB.RECOVERY_PLAN_JOB.ERR_COUNT,h=t.get(c),p=t.get(d);if(parseInt(p,10)||parseInt(h,10)){var _=O({taskFailed:n.t("TableVantagePointView","tasks_failed"),taskWarn:n.t("TableVantagePointView","tasks_warning"),failedCount:p,warnCount:h}),T=D({SVG:u});return P({icon:T,reason:_})+" "+y({percent:l+"%"})}}return s.RADIAL_TEMPLATE({className:o,displayValue:r,percent:l})},renderTaskRadial:function(t){var i=t.get(e.TASK_STATUS),n="",a=t.get(e.TASK_PERCENT_COMPLETE);return t.isTaskCompleted()&&(n=i.toLowerCase()+" ",a=a||100),s.RADIAL_TEMPLATE({className:n,displayValue:"",percent:a})},renderTaskName:function(t,i){if(i){var n=t.get(a.ENTITY_GENERIC),s=t.get(e.EB.RECOVERY_PLAN_JOB.RECOVERY_PLAN_UUID);return n&&n[0]===a.ENTITY_RECOVERY_PLAN_JOB?'<span class="n-click-rpj-task" data-rpId="'+s+'"\n              data-test="rpj-task">'+i+"</span>":i}},renderTaskNameDetails:function(t){return t.isClusterUpgradeTask()||t.isScheduleJob()?g({taskId:t.getId()}):t.hasDrilldown()?S({taskId:t.getId(),taskMsg:t.getValue(e.TASK_NAME)}):t.getValue(e.TASK_NAME)},renderTaskEntityDetails:function(i,n){var s="",r=void 0;if(i.isFileServerUpgradeTask())return s=n?a.TASK_LABEL_VERSION:A({taskId:i.getId()}),i.hasDrilldown()&&(r=n?a.TASK_LABEL_DETAILS:p({taskId:i.getId(),taskEntity:a.TASK_LABEL_DETAILS}),s=s+" | "+r),s;if(i.isScheduleJob())return this.renderScheduleJobClusterDetails(i,n);if(i.isClusterUpgradeTask())return n?a.TASK_LABEL_DETAILS:g({taskId:i.getId()});if(i.get(e.TASK_TYPE)===a.TASK_OPERATION_RESTART_VM_GROUP){var o=i.get(e.TASK_ENTITY_TYPE);_.isArray(o)||(o=[o]);var c=i.get(e.TASK_ENTITY_ID);_.isArray(c)||(c=[c]);for(var u=[],d=0;d<o.length;d++)o[d]===a.ENTITY_VM&&u.push(c[d]);return E({entityType:a.ENTITY_VM,entityIds:u.join("|"),entityName:l.getPluralEntityName(a.ENTITY_VM)})+" | "+p({taskId:i.getId(),taskEntity:i.getTaskEntityDetails()})}if(i.hasDrilldown()&&i.getNumberOfEntities()>1)return n?i.getTaskEntityDetails():p({taskId:i.getId(),taskEntity:i.getTaskEntityDetails()});var h=_.isArray(i.get(e.TASK_ENTITY_TYPE));if((i.get(e.TASK_COMPONENT)===a.TASK_COMPONENTS.NCC||i.get(e.TASK_COMPONENT)===a.TASK_COMPONENTS.LOG_COLLECTOR)&&!h)return n?l.getSingularEntityName(a.ENTITY_CLUSTER):T({taskId:i.getId(),taskEntity:l.getSingularEntityName(a.ENTITY_CLUSTER)});if(n)return this.exportEntityTypes(i,e.TASK_ENTITY_TYPE,1);if(h){var S="";if((_.contains(this.getTaskManager().TRIGGER_APP_EVENT_OPERATIONS.entitiesDeleted,i.get(e.TASK_TYPE))||M.test(i.get(e.TASK_TYPE)))&&i.isStatusComplete()){var m=this.getAppManger&&this.getAppManager(),f=m&&m.isOnprem();S=T({taskId:i.getId(),taskEntity:l.getSingularEntityName(l.getEntityTypeBasedOnEnvironment(i.getValue(e.TASK_ENTITY_TYPE),f))})}else S=l.renderEntityDetailsLink(this.getClusterManager(),t.getEntityTypeViewPrivileges(i.get(e.TASK_ENTITY_TYPE)),i,e.TASK_ENTITY_TYPE,e.TASK_ENTITY_ID,"persisted-link",1);s+=S}return i.hasDrilldown()&&(r=p({taskId:i.getId(),taskEntity:a.TASK_LABEL_DETAILS}),s=""===s?r:s+" | "+r),""!==s?s:a.INVALID_STRING},renderTaskStatusDetails:function(t){var n=!i.isMulticlusterUI();if((t.get(e.TASK_COMPONENT)!==a.TASK_COMPONENTS.LOG_COLLECTOR||-1!==t.getErrorCode())&&t.isStatusCategoryFailed()&&t.getErrorMessage())return m({taskId:t.getId(),status:t.get(e.TASK_STATUS)});if(t.get(e.TASK_COMPONENT)===a.TASK_COMPONENTS.NCC&&(n||!t.getClusterName(!0))&&(t.isStatusComplete()||t.isStatusAborted()))return I({action:a.NCC_TASK_SUMMARY,actionTargetId:t.getId(),actionTarget:a.ENTITY_NCC,actionTargetName:a.NCC_TASK_SUMMARY,targetTabId:null,displayValue:t.get(e.TASK_STATUS),classes:"persisted-link capitalize-first-char eb-tooltip"});var s=i.getCurrentClusterModel(),r=s.isNewLogCollectorEnabled();if(this.isLogCollectorTaskComponent(r,t)&&n&&!l.isIFrameModeActivated()&&this.enableLink(t)&&(t.isStatusComplete()||t.isStatusFailed()&&-1===t.getErrorCode())){var o=C({errorMessage:t.getErrorMessage(),downloadMessage:t.isStatusComplete()?"Click to download the complete log bundle.":"Click to download the complete error report."});return f({id:t.getId(),displayValue:t.get(e.TASK_STATUS),classes:"persisted-link capitalize-first-char eb-tooltip enableTooltip",title:o})}return v({taskId:t.getId(),status:t.get(e.TASK_STATUS)})},filterCollection:function(t){var n=this,s=i.getCurrentClusterModel(),a=s.isNewLogCollectorEnabled(),r=_.filter(t.models,function(e){return n.isLogCollectorTaskComponent(a,e)&&(e.isStatusComplete()||e.isStatusFailed())})||[];return r=_.sortBy(r,function(t){return-t.get(e.TASK_START_TIME)})||[],r.slice(0,e.TASK_LOG_COLLECTOR_DOWNLOAD)},enableLink:function(e){var t=this.filterCollection(e.collection);return 1===(_.filter(t,function(t){return e.get("id")===t.get("id")})||[]).length},renderTaskActions:function(t){if(t.isScheduleJob()){var i=t.get(e.TASK_STATUS),n=[];if(i===a.TASK_STATUS_SCHEDULED){var s=this.i18nStatic("Common","edit");n.push(R({entityType:a.ENTITY_MULTICLUSTER_CONFIG_SPEC,id:t.getId(),title:s,displayValue:s,action:a.ACTION_UPDATE_CLUSTER}))}if(i===a.TASK_STATUS_PAUSED){var r=this.i18nStatic("Common","resume");n.push(R({entityType:a.ENTITY_MULTICLUSTER_CONFIG_SPEC,id:t.getId(),title:r,displayValue:r,action:a.ACTION_RESUME}))}if(i===a.TASK_STATUS_ACTIVE){var o=this.i18nStatic("Common","pause");n.push(R({entityType:a.ENTITY_MULTICLUSTER_CONFIG_SPEC,id:t.getId(),title:o,displayValue:o,action:a.ACTION_PAUSE}))}if(i===a.TASK_STATUS_SCHEDULED||i===a.TASK_STATUS_ACTIVE||i===a.TASK_STATUS_PAUSED){var l=this.i18nStatic("Common","cancel");n.push(R({entityType:a.ENTITY_MULTICLUSTER_CONFIG_SPEC,id:t.getId(),title:l,displayValue:l,action:a.ACTION_CANCEL}))}if(n)return n.join(" | ")}return""},renderTaskCreateTimeDetails:function(e,t){if(e.isScheduleJob()){var i=e.get(h.SCHEDULE_START_TIME);if(i){var n=e.get(h.SCHEDULE_TIME_ZONE),s=c.formatDateTimeWithTimeZone(i,n);t+=N({timeString:s,I18nMixin:r})}return t}return t},renderScheduleJobClusterDetails:function(i,n){var s=i.get(e.TASK_ENTITY_TYPE),a=i.get(h.ENTITY_NAME)||[],r=_.map(i.get(e.TASK_ENTITY_ID),function(e,t){return{uuid:e,entityName:a[t],entity:s[t]}});return l.renderAffectedEntitiesLink(this.getClusterManager(),t.getEntityTypeViewPrivileges(s),i,r,e.TASK_ENTITY_TYPE,h.ENTITY_NAME,"persisted-link",n)},isLogCollectorTaskComponent:function(t,i){return t?i.get(e.TASK_COMPONENT)===a.TASK_COMPONENTS.LOGBAY&&i.get(e.TASK_TYPE)===a.TASK_OPERATION_LOGBAY.LOG_COLLECTION_DOWNLOAD:i.get(e.TASK_COMPONENT)===a.TASK_COMPONENTS.LOG_COLLECTOR}})}),define("views/header/task/TaskServiceItemView",["views/header/task/BaseTaskItemView","text!templates/header/task/TaskServiceItemView.html","data/DataProperties","utils/renderers/TaskRenderers","utils/CommonTemplates","utils/AppConstants"],function(e,t,i,n,s,a){"use strict";var r=_.template(t);return e.extend({render:function(){var e={};if(e.message=this.getTaskName(),this.options&&this.options.isMulticluster){var t=this.model.getClusterName(!0);this.model.isPublisherPrismCentral()?e.clusterName=s.MULTICLUSTER_NAME_PREFIX({clusterName:t}):e.clusterName=s.CLUSTER_NAME_PREFIX({clusterName:t})}else e.clusterName=null;e.navAttrs=i.TASK_ENTITY_ID+'="'+this.getTaskEntityId()+'"',e.navAttrs+=" "+i.TASK_TYPE+'="'+this.getTaskType()+'"',e.navAttrs+=" "+i.TASK_ENTITY_TYPE+'="'+this.getTaskEntityType()+'"',e.navAttrs+=" "+i.TASK_UI_TASK_ID+'="'+this.getTaskId()+'"',e.subTask=!1,e.showDelete=this.isDeleteEnabled(),this.$el.html(r(e)),this.$el.addClass("n-task-parent"),this.updateRadial()},update:function(e){var t,n,s=!1;this.isDeleteEnabled();e?(n=this.model.get(i.TASK_STATUS),t=e.get(i.TASK_STATUS)):(n="",t=this.model.get(i.TASK_STATUS)),t!==a.TASK_STATUS_FAILED&&t!==a.TASK_STATUS_COMPLETE&&t!==a.TASK_STATUS_CANCELED||n===t||(s=!0),this.model=e||this.model,this.updateRadial(s),this.setPercentText(),this.firstPass=!1},updateRadial:function(e,t){var i=this.$(".radial");if(0===i.length){var s=n.renderTaskRadial(this.model);this.$(".n-widget").html(s),i=this.$(".radial")}var a=i.data("class"),r=this.model.getPercentage();i.removeClass("percent"+a).addClass("percent"+r)}})}),define("views/header/task/TaskServiceView",["views/header/task/TaskView","views/header/task/TaskServiceItemView"],function(e,t){"use strict";return e.extend({renderMenuItem:function(e){return new t({model:e,isMulticluster:this.isMulticluster})}})}),define("views/basecomponents/spotlight/CommandDictionary",["utils/AppConstants","utils/AppUtil","managers/AccessManager"],function(e,t,i){"use strict";return{entityCommandMap:null,dictionary:null,commandTypeMap:null,commandList:[],initialize:function(){this.dictionary||(this.entityCommandMap=this._getEntityCommandMap(),this.dictionary=this._getDictionary(),this.commandTypeMap=this._getCommandTypeMap(),_.each(this.entityCommandMap,function(e){this.commandList=_.union(e,this.commandList)},this))},_getEntityCommandMap:function(){var t={};return t[e.ENTITY_ALERT]=[e.ACTION_UPDATE,e.ACTION_SHOW,e.ACTION_ACKNOWLEDGE,e.ACTION_RESOLVE,e.ACTION_LIST,e.ACTION_LS,e.ACTION_EDIT],t[e.ENTITY_CLUSTER]=[e.ACTION_UPDATE,e.ACTION_SHOW,e.ACTION_EXPAND,e.ACTION_LIST,e.ACTION_LS,e.ACTION_EDIT],t[e.ENTITY_CONTAINER]=[e.ACTION_CREATE,e.ACTION_UPDATE,e.ACTION_SHOW,e.ACTION_DELETE,e.ACTION_ADD,e.ACTION_LIST,e.ACTION_LS,e.ACTION_EDIT],t[e.ENTITY_DISK]=[e.ACTION_SHOW,e.ACTION_REMOVE,e.ACTION_LIST,e.ACTION_LS],t[e.ENTITY_HOST]=[e.ACTION_SHOW,e.ACTION_ADD,e.ACTION_REMOVE,e.ACTION_LIST,e.ACTION_LS],t[e.ENTITY_EVENT]=[e.ACTION_SHOW,e.ACTION_LS,e.ACTION_LIST],t[e.ENTITY_STORAGE_POOL]=t[e.ENTITY_CONTAINER],t[e.ENTITY_PROTECTION_DOMAIN]=t[e.ENTITY_CONTAINER],t[e.ENTITY_REMOTE_SITE]=t[e.ENTITY_CONTAINER],t[e.ENTITY_VM]=t[e.ENTITY_EVENT],t},_getCommandTypeMap:function(){var t={};return t[e.ACTION_SHOW]={type:1,plural:!0,destructive:!1,entityOrGeneric:e.SPOTLIGHT_COMMAND_BOTH},t[e.ACTION_LIST]={type:1,plural:!0,destructive:!1,entityOrGeneric:e.SPOTLIGHT_COMMAND_BOTH},t[e.ACTION_LS]={type:1,plural:!0,destructive:!1,entityOrGeneric:e.SPOTLIGHT_COMMAND_BOTH},t[e.ACTION_EDIT]={type:2,plural:!1,destructive:!0,entityOrGeneric:e.SPOTLIGHT_COMMAND_ENTITY},t[e.ACTION_UPDATE]={type:2,plural:!1,destructive:!0,entityOrGeneric:e.SPOTLIGHT_COMMAND_ENTITY},t[e.ACTION_DELETE]={type:3,plural:!1,destructive:!0,entityOrGeneric:e.SPOTLIGHT_COMMAND_ENTITY},t[e.ACTION_REMOVE]={type:3,plural:!1,destructive:!0,entityOrGeneric:e.SPOTLIGHT_COMMAND_ENTITY},t[e.ACTION_CREATE]={type:4,plural:!1,destructive:!0,entityOrGeneric:e.SPOTLIGHT_COMMAND_GENERIC},t[e.ACTION_ADD]={type:4,plural:!1,destructive:!0,entityOrGeneric:e.SPOTLIGHT_COMMAND_GENERIC},t[e.ACTION_EXPAND]={type:5,plural:!1,destructive:!0,entityOrGeneric:e.SPOTLIGHT_COMMAND_BOTH},t[e.ACTION_SHRINK]={type:6,plural:!1,destructive:!0,entityOrGeneric:e.SPOTLIGHT_COMMAND_BOTH},t[e.ACTION_ACKNOWLEDGE]={type:7,plural:!0,destructive:!0,entityOrGeneric:e.SPOTLIGHT_COMMAND_GENERIC},t[e.ACTION_RESOLVE]={type:8,plural:!0,destructive:!0,entityOrGeneric:e.SPOTLIGHT_COMMAND_GENERIC},t},_getDictionary:function(){var e={};return _.each(this.entityCommandMap,function(t,i){for(var n in t){var s=t[n]+" "+i,a={};a.command=t[n],a.entity=i,e[s]=a}}),e},_isDestructive:function(e){return this.commandTypeMap[e]?this.commandTypeMap[e].destructive:(t.log("CommandDictionary: Issue retrieving command "+e+"from the commandTypeMap."),!0)},_getCommandProps:function(e){return this.commandTypeMap[e]?this.commandTypeMap[e]:(t.log("CommandDictionary: Issue retrieving command properties from the commandTypeMap for command:"+e),null)},getSearchResultObject:function(e){if(!e)return t.log("CommandDictionary.getSearchResultObject: Invalid options object passed. Exiting"),null;var i,n={};return n.entityId=e.entityId||"",n.entityName=e.entityName||"",n.entityType=e.entityType||"",n.fieldName=e.fieldName,n.command=e.command,n.entityOrGeneric=e.entityOrGeneric,i=this._getCommandProps(e.command),n.commandType=i.type,"fieldValue"in e?n.fieldValue=e.fieldValue:(n.fieldValue=e.command+" "+n.entityType.replace("/_/g"," "),i.plural&&(n.fieldValue+="s")),n},hasAccess:function(e,t){return t&&this._isDestructive(t)?i.canModifyByEntityType(e):i.canViewByEntityType(e)},isGeneric:function(t){return t.entityOrGeneric===e.SPOTLIGHT_COMMAND_GENERIC||t.entityOrGeneric===e.SPOTLIGHT_COMMAND_BOTH&&(!t.entityId&&!t.entityName||void 0)},search:function(t,i){var n,s=[];if(i)for(var a=0;a<this.commandList.length;a++)0===this.commandList[a].indexOf(t)&&(n=this._getCommandProps(this.commandList[a]),n.entityOrGeneric!==e.SPOTLIGHT_COMMAND_GENERIC&&s.push(this.getSearchResultObject({command:this.commandList[a],fieldValue:this.commandList[a],entityOrGeneric:e.SPOTLIGHT_COMMAND_ENTITY})));else for(var r,o,l,c=_.keys(this.dictionary),u=0;u<c.length;u++)r=this.dictionary[c[u]].entity,o=this.dictionary[c[u]].command,n=this._getCommandProps(o),n.entityOrGeneric!==e.SPOTLIGHT_COMMAND_ENTITY&&(l=c[u].replace(/_/g," "),n.plural&&(l+="s"),0===l.indexOf(t)&&s.push(this.getSearchResultObject({entityType:r,command:o,entityOrGeneric:e.SPOTLIGHT_COMMAND_GENERIC})));return s}}}),define("views/basecomponents/spotlight/SpotlightResultsView",["views/basecomponents/BaseView","views/basecomponents/spotlight/CommandDictionary","managers/NavigationManager","managers/ActionManager","managers/NotificationManager","managers/ClusterManager","utils/AppConstants","utils/AppUtil","utils/AntiscrollUtil","utils/CommonTemplates","events/AppEvents"],function(e,t,i,n,s,a,r,o,l,c,u){"use strict";var d=_.template('<a class="btnPageAction"><span id="n-spotlight-result" title="<%= titleText %>"class="n-spotlight-search"><%= result %></span></a>'),h=_.template('<li class="n-spotlight-no-results"> <%= i18n("no_results", "No results") %></li>'),p=_.template('<li class="n-spotlight-group-heading"><span><%= AppUtil.getPluralEntityName(obj.entityType).toUpperCase() %></span><span class="n-spotlight-section-count  n-spotlight-section<%= sectionIndex %>"></span></li>'),T=_.template('<li class="n-spotlight-cutoff"><span title="Please refine the search further."><%= cutoffCount %> more <%= AppUtil.getPluralEntityName(obj.entityType) %></span></li>');return e.extend({NEXT:"next",PREVIOUS:"prev",SCROLL_INTO_VIEW_DELAY:10,name:"SpotlightResultsView",cssPosition:"fixed",parentEl:null,active:!1,resultSelected:!1,isMulticluster:!1,useInnerWidth:!1,considerWindowSize:!1,events:{"mousedown .n-menu-item":"onSelect",click:"onResultsViewClick"},initialize:function(e){if(_.bindAll(this,"onSelect"),e){if(!e.parentEl)return void o.log("SpotlightResultsView: parentEl and className options required.");this.parentEl=e.parentEl,this.selectHandler=e.selectHandler||this.selectHandler,this.wrapperEl=e.wrapperEl||$("body"),this.containerEl=e.containerEl,this.cssPosition=e.cssPosition||this.cssPosition,this.useInnerWidth=e.useInnerWidth||this.useInnerWidth,this.considerWindowSize=e.considerWindowSize||this.considerWindowSize}this.render()},render:function(){var e=$("<ul>").addClass("n-spotlight-list");this.$el.addClass("n-spotlight-results"),this.$el.append(c.ANTISCROLL),this.$(".box-inner").append(e),this.wrapperEl.append(this.$el),this._resizeMenu(),this.$el.hide()},close:function(){this.term="",this.closing&&(clearTimeout(this.closing),this.closing=null),this.$el.is(":visible")&&(this.$el.hide(),this.parentEl.removeClass("active"),this.deactivate())},suggest:function(e){this.$(".n-spotlight-list").empty();if(this.parentEl.addClass("active"),this.$el.zIndex(this.parentEl.find("input").zIndex()+1),"fixed"===this.cssPosition){var t=o.getFixedPosition(this.parentEl.find("input"));this.$el.css({top:t.top+this.parentEl.outerHeight()+10,left:t.left})}else this.$el.css({top:this.parentEl.outerHeight()+10,left:"0"});this._renderMenu(e),this.deactivate(),this.refresh(),this.$el.css("display","inline-block").css("position",this.cssPosition),this._resizeMenu()},_createSectionHeader:function(e,t,i){$(t).append(p(this.vtOptions({entityType:e,sectionIndex:i})))},_createSectionCutoff:function(e,t,i){$(e).append(T(this.vtOptions({entityType:t,cutoffCount:i})))},_renderMenu:function(e){var t="",i=this.$(".n-spotlight-list");e&&e[0]&&e[0].searchString&&(t=e[0].searchString),0!==e.length&&"No results"!==e[0].fieldValue||($(i).append(h(this.vtOptions())),e=[],t=null);var n=this,s=null,a=0,r=0;$.each(e,function(e,o){s!==o.entityType&&(r>20&&n._createSectionCutoff(i,s,r-20),n._createSectionHeader(o.entityType,i,a),0!==a&&$(i).find(".n-spotlight-section"+(a-1)).html(r),a++,r=0),s=o.entityType,r<=20&&n._renderItem(i,o,t),r++}),r>20&&this._createSectionCutoff(i,s,r-20),$(i).find(".n-spotlight-section"+(a-1)).html(r),setTimeout(function(){$(i).slideDown("fast")},250)},_highlightWordsNoCase:function(e,t){if(!e)return"";var i=e.toUpperCase(),n=t.toUpperCase(),s=/[.*+?|()\[\]{}\$\^]/g,a=new RegExp("("+n.replace(s,"\\$&")+")","gi"),r=i.search(a);if(-1===r)return e;var o='<span class="n-spotlight-search-hit">'+_.escape(e.substr(r,t.length))+"</span>";return _.escape(e.substr(0,r))+o+_.escape(e.substr(r+t.length))},_renderItem:function(e,t,i){t.displayString=t.fieldValue;var n={};if(t.command?(n.titleText="action=&#34;"+t.fieldValue+"&#34;","id"===t.fieldName?n.titleText+=" \n("+t.entityId+" is the id)":t.fieldName&&-1!==t.fieldName.indexOf("_name")&&(n.titleText+=" \n("+t.entityName+" is the "+t.fieldName+")"),t.entityOrGeneric===r.SPOTLIGHT_COMMAND_GENERIC&&(t.displayString=t.displayString.replace(/_/g," "))):(n.titleText=t.fieldName+"="+t.fieldValue,a.isMulticlusterNavMode()&&t.entityType!==r.ENTITY_CLUSTER&&(n.titleText+="("+t.clusterName+")")),n.result=this._highlightWordsNoCase(t.displayString,i),this.isMulticluster&&t.entityOrGeneric!==r.SPOTLIGHT_COMMAND_GENERIC&&t.entityType!==r.ENTITY_CLUSTER){var s=t.clusterName;n.result=c.CLUSTER_NAME_PREFIX({clusterName:s})+n.result}return n.resultAfter="",n.entityResult=!1,t.entityOrGeneric===r.SPOTLIGHT_COMMAND_ENTITY&&(n.resultAfter=t.entityName?"Name = "+t.entityName:"Id = "+t.entityId),$("<li>").append(d(n)).data("item.autocomplete",t).appendTo(e)},refresh:function(){var e=this;this.$(".n-spotlight-list").children("li:not(.n-menu-item):has(a)").addClass("n-menu-item").children("a").attr("tabindex",-1).mouseenter(function(t){e.activate(t,$(this).parent())}).mouseleave(function(){e.deactivate()})},_resizeMenu:function(){var e,t=this.$(".n-spotlight-list"),i=this;o.getFixedPosition(this.parentEl.find("input"));e=this.getVerticalSpace(this.considerWindowSize),this.$el.css("visibility","hidden");var n=Math.min(e,t.height()+10),s=this.parentEl.find("input"),a=this.useInnerWidth?s.innerWidth():s.outerWidth();this.$(".box-wrap, .antiscroll-inner, .box-inner").css("height",n).css("width",a),setTimeout(function(){l.applyAntiScroll(i.$el,a+"px",n+"px",{autoHide:!0}),this.$(".n-menu-item").length>0&&i.next(),i.$el.css("visibility","visible")},100)},destroy:function(){o.log("SpotlightResultsView : destroy:  | viewid : "+this.cid),this.$el.remove(),e.prototype.destroy.apply(this,arguments)},selectHandler:function(e,s){var l=s.entityType.toLowerCase(),c={};switch(l){case"node":l=r.ENTITY_HOST;case r.ENTITY_HOST:case r.ENTITY_DISK:c.page=r.PAGE_HARDWARE;break;case r.ENTITY_VM:c.page=r.PAGE_VMS;break;case r.ENTITY_CONTAINER:case r.ENTITY_STORAGE_POOL:case r.ENTITY_ACROPOLIS_VOLUME_GROUP:c.page=r.PAGE_STORAGE;break;case r.ENTITY_CLUSTER:if(!a.isMulticlusterNavMode())return c={},c[r.NAV_ACTION]=r.ACTION_SHOW,c[r.NAV_ACTION_TARGET]=r.ENTITY_CLUSTER,n.executeAction(c),void this.selectCleanUp(e);c.page=r.PAGE_MC_DASHBOARD;break;case r.ENTITY_PROTECTION_DOMAIN:case r.ENTITY_REMOTE_SITE:c.page=r.PAGE_DR;break;case r.ENTITY_ALERT:case r.ENTITY_EVENT:c.page=r.PAGE_ALERT_EXPLORER;break;default:return void o.log("SpotlightView: Page for entity type "+s.entityType+" not specified.")}if(c.subPage=r.SUBPAGE_TABLE,c[r.NAV_ACTION_TARGET_NAME]=s.entityName,c[r.NAV_ACTION_TARGET_ID]=s.entityId,a.isMulticlusterNavMode()&&(c[r.NAV_ACTION_TARGET_ID]=s.entityUuid),c[r.NAV_ACTION_TARGET]=l,c[r.NAV_ACTION]=r.ACTION_DETAILS,c[r.NAV_ACTION_SPOTLIGHT]="true",
s.command)switch(s.command){case r.ACTION_SHRINK:s.entityType===r.ENTITY_CLUSTER&&(c[r.NAV_ACTION_TARGET]=r.ENTITY_HOST,this._pageNavigationWithMessage(c));break;case r.ACTION_EXPAND:s.entityType===r.ENTITY_CLUSTER&&(c[r.NAV_ACTION_TARGET]=r.ENTITY_HOST,n.executeAction(c));break;case r.ACTION_ADD:case r.ACTION_CREATE:s.entityType===r.ENTITY_DISK?(c[r.NAV_ACTION_TARGET]=r.ENTITY_STORAGE_POOL,c.page=r.PAGE_STORAGE,this._pageNavigationWithMessage(c)):(s.entityType,r.ENTITY_PROTECTION_DOMAIN,c[r.NAV_ACTION]=s.command,n.executeAction(c));break;case r.ACTION_ACKNOWLEDGE:case r.ACTION_RESOLVE:this._pageNavigationWithMessage(c);break;case r.ACTION_DELETE:case r.ACTION_REMOVE:t.isGeneric(s)||l===r.ENTITY_PROTECTION_DOMAIN?this._pageNavigationWithMessage(c):(c[r.NAV_ACTION]=s.command,c[r.NAV_ACTION_TARGET_ID]=s.entityId,c[r.NAV_ACTION_TARGET]=s.entityType,n.executeAction(c));break;case r.ACTION_UPDATE:case r.ACTION_EDIT:s.entityOrGeneric!==r.SPOTLIGHT_COMMAND_GENERIC&&(c[r.NAV_ACTION]=r.ACTION_UPDATE,c[r.NAV_ACTION_TARGET_ID]=s.entityId,c[r.NAV_ACTION_TARGET]=s.entityType,n.executeAction(c));break;case r.ACTION_SHOW:case r.ACTION_LIST:case r.ACTION_LS:t.isGeneric(s)?s.entityType===r.ENTITY_CLUSTER?(c[r.NAV_ACTION]=r.ACTION_SHOW,n.executeAction(c)):this._pageNavigationWithMessage(c):i.navigateToPageByObject(c.page,c.subPage,c);break;default:o.log("SpotlightView: issue processing search result command.")}else c[r.NAV_ACTION]=r.ACTION_DETAILS,this._pageNavigationWithMessage(c);this.selectCleanUp(e)},isResultSelected:function(){return this.resultSelected},_pageNavigationWithMessage:function(e){var t=i.getCurrentPageRoute();t[r.NAV_PAGE_ID]!==e.page||t[r.NAV_SUBPAGE_ID]!==e.subPage||e[r.NAV_ACTION_TARGET_ID]?a.isMulticlusterNavMode()?i.navigateToFullScreenDetailsPane(e[r.NAV_ACTION_TARGET],e[r.NAV_ACTION_TARGET_ID]):i.navigateToPageByNavObject(e):s.showClientNotification(r.NOTIFY_INFO,"You are already viewing the selected page.")},selectCleanUp:function(e){$(".n-spotlight-control").trigger(u.SPOTLIGHT_CLEANUP),this.close(e)},move:function(e,t,i){var n=this.$(".n-spotlight-list");if(0!==n.find(".n-menu-item").length){if(!this.active)return this.activate(i,n.children(t)),void this.active.scrollIntoView(this.SCROLL_INTO_VIEW_DELAY);var s=this.active[e+"All"](".n-menu-item").eq(0);s.length?this.activate(i,s):this.activate(i,n.children(t)),this.active.scrollIntoView(this.SCROLL_INTO_VIEW_DELAY)}},hasScroll:function(){return this.$(".box-wrap").height()<this.$(".antiscroll-inner").height()},_keyMove:function(e,t){return this.isFirst()&&e===this.PREVIOUS?(this.deactivate(),void this.prev()):this.isLast()&&e===this.NEXT?(this.deactivate(),void this.next()):void this[e](t)},next:function(e){this.move(this.NEXT,".n-menu-item:first",e)},prev:function(e){this.move(this.PREVIOUS,".n-menu-item:last",e)},isFirst:function(){return this.active&&!this.active.prevAll(".n-menu-item").length},isLast:function(){return this.active&&!this.active.nextAll(".n-menu-item").length},_keyEvent:function(e,t){this.isMultiLine&&!this.$el.is(":visible")||(this._keyMove(e,t),t.preventDefault())},activate:function(e,t){this.deactivate();var i=this.$(".n-spotlight-list");if(this.hasScroll()){var n=t.offset().top-$(i).offset().top,s=$(i).scrollTop(),a=$(i).height();n<0?$(i).scrollTop(s+n):n>=a&&$(i).scrollTop(s+n-a+t.height())}this.active=t.eq(0).children("a").addClass("n-hover").attr("id","n-active").end()},deactivate:function(){this.active&&(this.active.children("a").removeClass("n-hover").removeAttr("id"),this.active=null)},getVerticalSpace:function(e){var t,i,n=o.getFixedPosition(this.parentEl.find("input")),s=100,a=this.$el.closest(".n-modal-wrapper").find(".n-modal-footer");if(e)t=$(window).height(),i=n.top;else if(this.containerEl){var r=o.getFixedPosition(this.containerEl);t=this.containerEl.height(),i=n.top-r.top}else if(a.length>0){var l=o.getFixedPosition(a);i=l.top-n.top,s=50}else t=$(window).height(),i=n.top;return t-(i+s)},onKeyDown:function(e){this.suppressKeyPress=!1;var t=$.ui.keyCode;switch(e.keyCode){case t.PAGE_UP:this.move("previousPage",e);break;case t.PAGE_DOWN:this.move("nextPage",e);break;case t.UP:this._keyEvent(this.PREVIOUS,e);break;case t.DOWN:this._keyEvent(this.NEXT,e);break;case t.ENTER:case t.NUMPAD_ENTER:this.active&&e.preventDefault();case t.TAB:if(!this.active)return;this.onSelect(e,this.active);break;case t.ESCAPE:default:o.log("SpotlightResultsView: Issue handling keyDown event.Event should be handled in parent SpotlightView.")}},onResultsViewClick:function(e){e.stopPropagation()},onSelect:function(e,t){if(3!==e.which){this.resultSelected=!0;var i=t?t.data("item.autocomplete"):$(e.currentTarget).data("item.autocomplete");i&&_.isString(i.entityType)||o.log("SpotlightResultsView: invalid format for search result."),this.selectHandler(e,i),this.resultSelected=!1}}})}),define("text!templates/basecomponents/spotlight/SpotlightView.html",[],function(){return'<div id="searchForm" class="spotlight-wrapper">\n  \x3c!-- Placed search icon inside the input --\x3e\n  \x3c!-- TODO: Convert this to SVG icon --\x3e\n  <i aria-hidden="true" data-icon="B" class="n-icon-search"></i>\n  \x3c!-- Spotlight --\x3e\n  <input id="searchText" type="text" class="search-query dropdown-toggle"\n    spellcheck="false"\n    placeholder="<%= searchStr || i18n(\'Actions.search\', \'Search\') %>"\n    autocomplete="off">\n</div>'}),define("models/spotlight/SpotlightCollection",["models/BaseCollection","data/DataURLConstants","utils/AppConstants","data/DataProperties","views/basecomponents/spotlight/CommandDictionary"],function(e,t,i,n,s){"use strict";return e.extend({url:t.SPOTLIGHT_SEARCH,entityTypesParam:"entityTypes",fieldNamesParam:"fieldNames",queryString:"searchString",name:"SpotlightCollection",commandData:[],entityData:[],commandSearchTerm1:null,commandSearchTerm2:null,primaryQueryObject:{},localCommands:!1,isMulticluster:!1,supportedEntityTypes:null,initialize:function(t){_.bindAll(this,"ajaxCommandHandler","responseWrapper"),this.localCommands=t.localCommands||this.localCommands,e.prototype.initialize.apply(this,arguments)},ajaxPrimary:function(){this.fetch({data:this.primaryQueryObj,success:this.responseWrapper})},multiFetch:function(){var e={},t=this.primaryQueryObj[this.queryString];if(this.localCommands&&(-1!==t.indexOf(" ")?(this.commandSearchTerm1=t.substring(0,t.indexOf(" ")),this.commandSearchTerm2=t.substring(t.indexOf(" ")+1,t.length)):(this.commandSearchTerm1=t,this.commandSearchTerm2=""),this.commandData=s.search(this.commandSearchTerm1,!0),this.commandData.length>0))return e[this.queryString]=this.commandSearchTerm2,void this.fetch({data:e,success:this.ajaxCommandHandler});this.ajaxPrimary()},fetchResults:function(e,t){this._searchInitialize(),this.response=t,this.primaryQueryObj[this.queryString]=e.term,e.entityType&&(this.primaryQueryObj[this.entityTypesParam]=e.entityType.toLowerCase()),e.fieldName&&(this.primaryQueryObj[this.fieldNamesParam]=e.fieldName.toLowerCase(),this.primaryQueryObj[this.fieldNamesParam]===i.SPOTLIGHT_FN_HOST_NAME&&(this.primaryQueryObj[this.fieldNamesParam]="node_name")),this.multiFetch()},responseWrapper:function(e,t){this.localCommands&&(t=s.search(this.primaryQueryObj.searchString,!1).concat(t),t=this.commandEntityResults.concat(t)),t=this._preProcessResults(t),t=this._sortResults(t),t=this._filterResults(t),t&&0!==t.length||(t=[],t[0]={},t[0].fieldValue="No results"),t[0].searchString=this.primaryQueryObj.searchString,this.response(t,e)},getMultiClusterSupportedEntityTypes:function(){if(this.supportedEntityTypes){var e=[];return _.each(this.supportedEntityTypes,function(t){e.push(t.id)}),e}return[i.ENTITY_CLUSTER,i.ENTITY_VM,i.ENTITY_HOST,i.ENTITY_DISK,i.ENTITY_CONTAINER]},_preProcessResults:function(e){return e},_searchInitialize:function(){this.primaryQueryObj={},this.commandData=[],this.entityData=[],this.stopFetch(),this.commandSearchTerm1=null,this.commandSearchTerm2=null,this.commandEntityResults=[]},_filterResults:function(e){if(!_.isArray(e)||0===e.length)return e;var t={};t[i.SPOTLIGHT_FN_NCC_VERSION]=1,t[i.SPOTLIGHT_FN_CONTAINER_NAME]=1,t[i.SPOTLIGHT_FN_MOUNT_PATH]=1,t[i.SPOTLIGHT_FN_NODE_NAME]=1,t[i.SPOTLIGHT_FN_SWITCH_HARDWARE_PLATFORM]=1,t[i.SPOTLIGHT_FN_SWITCH_PORT_DESCR]=1,t[i.SPOTLIGHT_FN_SWITCH_PORT_NAME]=1,t[i.SPOTLIGHT_FN_SWITCH_NAME]=1,t[i.SPOTLIGHT_FN_ID]=1,t[i.SPOTLIGHT_FN_NUTANIX_PIN_NFS_FILE_PATH]=1,t[i.SPOTLIGHT_FN_ALL_VIRTUAL_DISK_FILE_PATHS]=1,t[i.SPOTLIGHT_FN_NFS_FILE_PATH]=1,t[i.SPOTLIGHT_FN_ALL_VIRTUAL_DISK_FILE_PATHS]=1,t[i.SPOTLIGHT_FN_NAME]=1,t[i.SPOTLIGHT_FN_ADAPTOR_TYPE]=1,t[i.SPOTLIGHT_FN_VM_ANNOTATION]=1,t[i.SPOTLIGHT_FN_VM_NAME]=1,t[i.SPOTLIGHT_FN_VIRTUAL_NIC_IDS]=1,t[i.SPOTLIGHT_FN_CLUSTER_NAME]=1,t[i.SPOTLIGHT_FN_DISK_UUID]=1,t[i.SPOTLIGHT_FN_REMOTE_NAME]=1,t[i.SPOTLIGHT_FN_CAPACITY_CLUSTER_UPGRADE_HISTORY]=1,t[i.SPOTLIGHT_FN_VM_UUID]=1,t[i.SPOTLIGHT_FN_BIOS_UUID]=1,t[i.SPOTLIGHT_FN_STORAGE_POOL_NAME]=1,t[i.SPOTLIGHT_FN_EMPTY_CDROM_DISK_ADDRESSES]=1,t[i.SPOTLIGHT_FN_VIRTUAL_SWITCH_NAME]=1,t[i.SPOTLIGHT_FN_DISK_ADDRESS]=1,t[i.SPOTLIGHT_FN_DISK_SERIAL]=1,t[i.SPOTLIGHT_FN_DISCOVERY_PROTOCOL]=1,t[i.SPOTLIGHT_FN_CURRENT_SNAPSHOT_ID]=1,t[i.SPOTLIGHT_FN_LAST_REPLICATED_SNAPSHOT_ID]=1,t[i.SPOTLIGHT_FN_IPV4_ADDRESSES]=1,t[i.SPOTLIGHT_FN_SERVICE_VM_IPV4_ADDRESS]=1,t[i.SPOTLIGHT_FN_SWITCH_MGMT_IP_ADDRESS]=1,t[i.SPOTLIGHT_FN_IP_ADDRESSES]=1,t[i.SPOTLIGHT_FN_IPV6_ADDRESSES]=1,t[i.SPOTLIGHT_FN_MAC_ADDRESS]=1,t[i.SPOTLIGHT_FN_SWITCH_MAC_ADDR]=1,t[i.SPOTLIGHT_FN_CONTAINER_IDS]=1,t[i.SPOTLIGHT_FN_VIRTUAL_DISK_UUID]=1,t[i.SPOTLIGHT_FN_VIRTUAL_NETWORK]=1,t[i.SPOTLIGHT_FN_VM_ID]=1,t[i.SPOTLIGHT_FN_VIRTUAL_NIC_UUID]=1,t[i.SPOTLIGHT_FN_VLAN_ID]=1,t[i.SPOTLIGHT_FN_HOST_NIC_UUID]=1,t[i.SPOTLIGHT_FN_SWITCH_PORT_NATIVE_VLAN]=1,t[i.SPOTLIGHT_FN_HOST_NIC_UUIDS]=1,t[i.SPOTLIGHT_FN_NGT_ENABLED_APPLICATIONS]=1,t[n.VG_NAME]=1;for(var a,r,o,l,c=e.slice(0),u=this.getMultiClusterSupportedEntityTypes(),d=e.length-1;d>=0;d--)a=!1,r=null,l="",e[d]&&(r=e[d],l=r.entityType.toLowerCase()),r?this.isMulticluster&&r.command?a=!0:this.isMulticluster&&!_.contains(u,r.entityType)?a=!0:s.hasAccess(r.entityType,r.command)?this._isEntityTypeExcluded(r.entityType)?a=!0:r.fieldName&&!t[r.fieldName]?a=!0:r.entityType&&i.SPOTLIGHT_ID_ENTITY_TYPES.indexOf(l)<0&&r.fieldName===i.SPOTLIGHT_FN_ID?a=!0:r.entityType&&l!==i.ENTITY_HOST&&r.fieldName===i.SPOTLIGHT_FN_NODE_NAME?a=!0:o&&r&&s.isGeneric(r)&&s.isGeneric(o)&&r.entityType===o.entityType&&r.commandType===o.commandType?a=!0:o=r:a=!0:a=!0,a&&c.splice(d,1);return c},_isEntityTypeExcluded:function(e){return e!==this.primaryQueryObj[this.entityTypesParam]&&-1!==i.SPOTLIGHT_DEFAULT_EXCLUDED_ENTITY_TYPES.indexOf(e)},_sortResults:function(e){return e.sort(function(e,t){return e.commandType||(e.commandType=0),t.commandType||(t.commandType=0),e.entityOrGeneric||(e.entityOrGeneric=i.SPOTLIGHT_COMMAND_ENTITY),t.entityOrGeneric||(t.entityOrGeneric=i.SPOTLIGHT_COMMAND_ENTITY),e.entityType>t.entityType?1:e.entityType<t.entityType?-1:!e.command&&t.command?1:e.command&&!t.command?-1:!s.isGeneric(e)&&s.isGeneric(t)?1:s.isGeneric(e)&&!s.isGeneric(t)?-1:e.fieldValue.localeCompare(t.fieldValue)}),e},ajaxCommandHandler:function(e,t){if(this.entityData=t,this.ajaxPrimary(),this.entityData.length>0)for(var i in this.commandData){var n=this.commandData[i];for(var a in this.entityData){var r=this.entityData[a];if((-1!==r.fieldName.indexOf("_name")||"id"===r.fieldName)&&0===r.fieldValue.toLowerCase().indexOf(this.commandSearchTerm2.toLowerCase())){var o=s.entityCommandMap[r.entityType];o&&-1!==o.indexOf(n.command)&&this.commandEntityResults.push(s.getSearchResultObject({entityType:r.entityType,command:n.fieldValue,fieldValue:n.fieldValue+" "+r.fieldValue,entityId:r.entityId,entityName:r.entityName,fieldName:r.fieldName,entityOrGeneric:n.entityOrGeneric}))}}}}})}),define("views/basecomponents/spotlight/SpotlightView",["views/basecomponents/BaseView","views/basecomponents/spotlight/SpotlightResultsView","text!templates/basecomponents/spotlight/SpotlightView.html","views/basecomponents/spotlight/CommandDictionary","models/spotlight/SpotlightCollection","data/DataProperties","utils/AppConstants","utils/AppUtil"],function(e,t,i,n,s,a,r,o){"use strict";var l=_.template(i);return e.extend({DELAY:200,name:"SpotlightView",entityType:null,fieldName:null,minLength:0,clearOnSelect:!1,localCommands:!1,spinnerTemplate:'<div class="donut-loader-blue n-spinner-search-img" style="display:none;position:absolute;"></div>',spotlightResultsView:null,spotlightCollection:null,requestIndex:0,emptyHandler:null,events:{"keydown input":"onKeyDown","blur    input":"onInputBlur"},initialize:function(e,t){_.bindAll(this,"onResize","resetInput","onKeyDown"),n.initialize(),t&&(this.onSelect=t.onSelect||this.onSelect,this.minLength=t.minLength||this.minLength,this.localCommands=t.localCommands||this.localCommands,this.clearOnSelect=t.clearOnSelect||this.clearOnSelect,this.resetOnBlur=t.resetOnBlur||this.resetOnBlur,this.searchStr=t.searchStr||"",this.resetInputOnBlur=!!_.isUndefined(t.resetInputOnBlur)||t.resetInputOnBlur,this.emptyHandler=t.emptyHandler||this.emptyHandler,this.entityType=t.entityType),this.initializeDataModel(t),this.render(t)},initializeDataModel:function(e){this.spotlightCollection=this._createSpotlightCollection(),e&&e.supportedEntityTypes&&(this.spotlightCollection.supportedEntityTypes=e.supportedEntityTypes)},render:function(e){this.$el.html(l(this.vtOptions({searchStr:this.searchStr}))),this.spotlightResultsView=this._createResultsView(e),this.$(".n-icon-search").before($(this.spinnerTemplate)),$(window).on("resize",this.onResize)},_createSpotlightCollection:function(){return new(s.extend({_preProcessResults:function(e){return e.map(function(e){return e.entityType===r.ENTITY_VOLUME_GROUP_IN_RESP&&(e.entityType=r.ENTITY_ACROPOLIS_VOLUME_GROUP),e})}}))({localCommands:this.localCommands})},_createResultsView:function(e){return e=e||{},new t({parentEl:this.$el,selectHandler:e.selectHandler,wrapperEl:e.wrapperEl,containerEl:e.containerEl,cssPosition:e.cssPosition,isMulticluster:this.isMulticluster,useInnerWidth:e.useInnerWidth,considerWindowSize:e.considerWindowSize})},setEntityType:function(e){this.entityType=e},setFieldName:function(e){this.fieldName=e},setFieldNameByEntityType:function(e){var t=e?e.toLowerCase():"";this.spotlightResultsView.isMulticluster&&e===r.ENTITY_DISK?this.fieldName=a.EB.DISK.SERIAL_NUMBER:r.SPOTLIGHT_ID_ENTITY_TYPES.indexOf(t)>=0?this.fieldName="id":e===r.ENTITY_VIRTUAL_DISK?this.fieldName=r.SPOTLIGHT_FN_NFS_FILE_PATH:e===r.ENTITY_ACROPOLIS_VOLUME_GROUP?this.fieldName=a.VG_NAME:this.fieldName=e+"_name"},show:function(){this.$el.show()},hide:function(){this.$el.hide()},destroy:function(){o.log("SpotlightView : destroy:  | viewid : "+this.cid),this.$("#searchText").off(null),$(window).off("resize",this.onResize),this.spotlightResultsView&&this.spotlightResultsView.destroy(),e.prototype.destroy.apply(this,arguments)},resetInput:function(e){(this.clearOnSelect||!this.spotlightResultsView.isResultSelected||e)&&this.$("#searchText").val(""),this.term=null},onInputBlur:function(){this.resetOnBlur&&(this.spotlightResultsView&&this.spotlightResultsView.close(),this.resetInputOnBlur&&this.resetInput(!0))},clearInput:function(){this.$("#searchText").val("")},_showSpinner:function(){if(!this.$(".n-spinner-search-img").is(":visible")){this.$(".n-icon-search").position();this.$(".n-icon-search").hide(),this.$(".n-spinner-search-img").show()}},_hideSpinner:function(){this.$(".n-spinner-search-img").hide(),this.$(".n-icon-search").show()},search:function(e,t){if(e=null!==e?e:this.$("input").val(),this.term=this.$("input").val(),e.length<this.minLength)return void this.stopSearch();this._showSpinner(),this.pending++,this.spotlightCollection.fetchResults({term:e,entityType:this.entityType,fieldName:this.fieldName},this.onSuccess())},stopSearch:function(){this.spotlightCollection.stopFetch(),this.spotlightResultsView&&this.spotlightResultsView.close(),this._hideSpinner(),this.resetInput()},setMulticluster:function(e){this.spotlightResultsView.isMulticluster=e,this.spotlightCollection.isMulticluster=e},onSuccess:function(){var e=this,t=++this.requestIndex;return function(i){t===e.requestIndex&&e.spotlightResultsView.suggest(i),--e.pending||e._hideSpinner()}},onResize:function(){this.spotlightResultsView&&this.spotlightResultsView.close(),this.resetInput()},onKeyDown:function(e){var t=$.ui.keyCode;switch(e.keyCode){case t.LEFT:case t.RIGHT:0!==this.$("#searchText").val().length&&e.stopPropagation();break;case t.PAGE_UP:case t.PAGE_DOWN:case t.UP:case t.DOWN:case t.ENTER:case t.NUMPAD_ENTER:case t.TAB:this.spotlightResultsView&&this.spotlightResultsView.onKeyDown(e);break;case t.ESCAPE:this.$("input").val(this.term),this.spotlightResultsView&&this.spotlightResultsView.close(e);break;default:clearTimeout(this.searching);var i=this;this.searching=setTimeout(function(){i.term!==i.$("input").val()&&(i.selectedItem=null,i.search(null,e))},this.DELAY),e.keyCode===t.BACKSPACE&&1===this.$("input").val().length&&this.emptyHandler&&_.isFunction(this.emptyHandler)&&this.emptyHandler(e)}}})}),define("managers/AjaxManager",["jquery","utils/AppUtil","utils/AppConstants","data/DataManager","data/DataURLConstants","managers/PrismElementManager"],function(e,t,i,n,s,a){"use strict";var r=null,o=!1,l=[],c=["disks/31/stats?metrics=check.1003.score","disks/39/stats?metrics=check.1003.score","stats?metrics=check.1003.score","stats?metrics=check.1003.disk_usage"],u=localStorage[i.LOCAL_STORAGE.AJAX_DURATION_LOG],d={initialize:function(){t.debug("AjaxManager | initialize"),r||(r=e.ajax,e.ajax="true"===u?this.ajaxWrapperWithDurationLog:this.ajaxWrapper)},startSimulation:function(e){l=s.TUTORIAL_DATA[e],t.debug("AjaxManager |  Simulating Ajax Started  | ",e),o=!0},stopSimulation:function(e){t.debug("AjaxManager |  Simulating Ajax Stopped  | ",e),o=!1},getSimulationState:function(){return o},ajaxWrapperWithDurationLog:function(e,i){var n=(new Date).getTime(),s="string"==typeof e?i:e;s=s||{};var a=s.complete;return s.complete=function(e,i){var r=_.template("AJAX_DURATION,<%= url %>,<%= type %>,<%= statusText %>,<%= duration %>",{url:s.url,type:s.type,statusText:e.statusText,duration:(new Date).getTime()-n});t.log(r),a&&a(e,i)},d.ajaxWrapper(e,i)},ajaxWrapper:function(i,s){if(!o)return a.isLoadedFromPrismCentral()?a.applyPrismCentralProxyAjax(i,s):r(i,s);"object"==typeof i&&(s=i),t.debug("AjaxManager::AjaxWrapper ",s);if("GET"===s.type)for(var u=s.url||i,d=0;d<l.length;d++){var h=l[d][0];if(u.indexOf(h)>=0){if(c.indexOf(h)>=0)return function(i,s,a){var r=t.parseQueryToObject(s),o=n.getRootURL()+"/"+a;e.getJSON(o,function(e){e.statsSpecificResponses[0].startTimeInUsecs=r.startTimeInUsecs,i.success(e)})}(s,u,l[d][1]);s.url=n.getRootURL()+"/"+l[d][1],t.debug("AjaxManager::AjaxWrapper: override URL",s.url);break}}else t.debug("AjaxManager::AjaxWrapper: request is not a GET: ",s.url);return r(s)}};return d}),define("managers/TutorialManager",["managers/AjaxManager","utils/AppConstants","utils/AppUtil","data/DataURLConstants","events/AppEvents"],function(e,t,i,n,s){"use strict";var a,r,o,l,c,u={},d=0,h=0,p={},_=0,T=0,E=!1;return{isTutorialInProgress:function(){return E},hasSeenTutorial:function(e){if(i.hasLocalStorage()){var t=localStorage.getItem(e);return i.parseJSON(t)}return!1},startTutorial:function(e){a=e.context,l=e.simulationStartCB||function(){},c=e.simulationCompleteCB||function(){},r=e.tutorialStartCB||function(){},o=e.tutorialCompleteCB||function(){};var s=this,u=n.TUTORIAL_PATH+n.TUTORIALS[t.TUTORIALS[e.name]];$.ajax({url:i.cacheBustURL(u),dataType:"json",type:"GET",success:function(e){s.processTutorial(e)},error:function(e,t,n){i.log("ERROR: Cannot load "+u+" "+i.processAjaxError(e.responseText)+" | "+t+" | "+i.safeStringify(n))}})},processTutorial:function(e){E=!0,u=e,d=0,p=u.steps[0],h=this.countSteps(),T=0,_=this.countTooltipSteps();void 0===u.delay?u.delay=1500:u.delay=u.delay,p.tSteps=_,p.tCurrStep=T;var t=this;$("body").on(s.TUTORIAL_STEP_FINISH,function(){t.runStep()}),$("body").on(s.TUTORIAL_TOOLTIP_CLOSE,function(){t.endTutorial()}),$("body").on(s.PROMPT_TUTORIAL_CLOSE,function(){t.promptEndTutorial()}),$("body").addClass("n-tutorial n-app-noscroll"),setTimeout(function(){t.runStep(),r()},void 0)},prepareStep:function(){p=u.steps[d],p.tSteps=_,p.tCurrStep=T,d<h-1&&(p.tBtnNext=!0)},runStep:function(){if(d===h)return void this.endTutorial();if(d<h&&(this.prepareStep(),"simulated_data"===p.mode?this.toggleSimulatedData(p.simulated_data):$.nutanixTutorial(p)),"tooltip"===p.mode&&!1!==p.show){var e=this,t=$("body .n-tutorial-tooltip");t.find(".btn-next-step").off(),t.find(".btn-next-step").on("click",function(){e.runStep()}),T++}d++},showLoader:function(e){i.addFullPageLoader(e),setTimeout(function(){i.removeFullPageLoader()},2500),setTimeout(function(){$("body").trigger(s.TUTORIAL_STEP_FINISH)},3500)},countSteps:function(){return u.steps.length},countTooltipSteps:function(){for(var e=0,t=0;t<u.steps.length;t++)"tooltip"===u.steps[t].mode&&!1!==u.steps[t].show&&e++;return e},endTutorial:function(){var t=["n-tutorial-mouse","n-tutorial-highlight","n-tutorial-tooltip"];$("body").removeClass(t.join(" ")),setTimeout(function(){$("body").removeClass("n-tutorial n-app-noscroll")},300),$("body > ."+t.join(", body > .")).hide(),$("body .n-tutorial-tooltip").find(".btn-next-step").off(),$("body .n-tutorial-tooltip").find(".n-close-icon").off(),$("body").off(s.TUTORIAL_STEP_FINISH+" "+s.TUTORIAL_TOOLTIP_CLOSE+" "+s.PROMPT_TUTORIAL_CLOSE),e.getSimulationState()&&this.toggleSimulatedData("end"),E=!1,o()},promptEndTutorial:function(){var e=this;$.nutanixConfirm({title:"Nutanix Tutorial",msg:"Are you sure you want to exit this tutorial?",yesText:"Yes",noText:"No",hideNo:!1,yes:function(){e.endTutorial()}})},toggleSimulatedData:function(e){"start"===e?(this.showLoader("Loading simulation..."),l()):"end"===e&&(this.showLoader("Exiting simulation..."),c())}}}),define("managers/AlertManager",["backbone","data/DataProperties","models/alert/AlertCollection","managers/NamespaceManager","managers/NavigationManager","managers/ClusterManager","utils/AlertUtil","utils/AppUtil","utils/AppConstants"],function(e,t,i,n,s,a,r,o,l){"use strict";var c=function(){return{collection:null,initialize:function(){this.collection=new i,this.collection.on("reset",this.render,this),this.collection.setIntervalTime(l.ALERT_POLLING_INTERVAL),this.collection.comparator=r.comparatorHighPriorityUnresolved},render:function(){a.isMulticlusterNavMode()||(this.renderAlertWidgets(l.ALERT_TYPE_TABLE),this.renderAlertWidgets(l.ALERT_TYPE_DIAGRAM),this.renderAlertHighlight())},renderAlertWidgets:function(e){var t,i,n,s;this.alertWidgetView=require("views/basecomponents/alerts/AlertWidgetView"),e===l.ALERT_TYPE_TABLE?s=$("td."+l.STYLE_ALERT_TABLE_INDICATOR):e===l.ALERT_TYPE_DIAGRAM&&(s=$("div."+l.STYLE_ALERT_DIAGRAM_INDICATOR)),_.each(s,function(s){var a,c,u,d=!1;if(l.ALERT_TYPE_DIAGRAM===e?(c=$(s),u=c.attr(l.ALERT_DIAGRAM_TYPE_ATTRIBUTE)):l.ALERT_TYPE_TABLE===e&&(c=$(s).closest("tr")),i=c.attr(l.NAV_ACTION_TARGET_ID),n=c.attr(l.NAV_ACTION_TARGET),!i||0===i)return void o.debug("Problem rendering alerts. Invalid entityId.");$(s).find(".n-alert-widget").length>0?a=$(s).find(".n-alert-widget"):(d=!0,a=new this.alertWidgetView({alertDiagramType:u}).el,$(a).attr(l.NAV_ACTION_TARGET_ID,i),$(a).attr(l.NAV_ACTION_TARGET,n));var h=$('[alert^="k"]',a);t=this.collection.getAlertsByEntityId(i,!0),_.each(h,function(e){var i=$(e),n=_.filter(t,function(e){return e.attributes.severity===i.attr("alert")});n.length>0?(u===l.ALERT_DIAGRAM_TYPE.NONSKEUOMORPHIC?i.html("&nbsp;"):i.html(n.length),i.attr(l.NAV_ACTION,l.ACTION_DETAILS).attr(l.NAV_ACTION_TARGET,l.ENTITY_ALERT).attr(l.NAV_ACTION_TARGET_ID,n[0].attributes.id).attr(l.NAV_ACTION_TARGET_NAME,n[0].attributes.alertType).show()):i.hide()}),d&&$(s).append(a),r.renderAlertPopOver(a,t,e)},this)},renderAlertHighlight:function(){var e,i,n=$("."+l.STYLE_ALERT_HIGHLIGHT_INDICATOR);_.each(n,function(n){if(!(e=$(n).attr(l.NAV_ACTION_TARGET_ID))||0===e)return void o.debug("Problem rendering alerts. Invalid entityId.");i=this.collection.getAlertsByEntityId(e);var s=$(n).attr("position"),a=$(n).attr(l.NAV_ACTION_TARGET_NAME),c=this.collection.getPowerSupplyAlerts(e,s,a);if(c&&c.length&&(i=i.concat(c)),$(n).removeClass("n-alert-highlight-critical"),$(n).removeClass("n-alert-highlight-warning"),$(n).removeClass("n-alert-highlight-info"),i&&i.length>0){var u;i.every(function(e){return e.get(t.ALERT_SEVERITY)===t.ALERT_SEVERITY_CRITICAL?(u="critical",!1):(e.get(t.ALERT_SEVERITY)===t.ALERT_SEVERITY_WARNING?u="warning":e.get(t.ALERT_SEVERITY)===t.ALERT_SEVERITY_INFO&&(u="info"),!0)}),$(n).addClass("n-alert-highlight-"+u)}r.renderAlertPopOver(n,i,l.ALERT_TYPE_HIGHLIGHT)},this)}}};return{initialize:function(){n.set(n.ALERT_CONTROLLER,new c),n.get(n.ALERT_CONTROLLER).initialize()},refreshViews:function(){n.get(n.ALERT_CONTROLLER).render()},refreshAlertsOnTable:function(){a.isMulticlusterNavMode()||n.get(n.ALERT_CONTROLLER).renderAlertWidgets(l.ALERT_TYPE_TABLE)},fetchOnDemand:function(){return n.get(n.ALERT_CONTROLLER).collection.fetch({force:!0,data:{resolved:!1}})},clearAlertCollection:function(){this.getGlobalAlerts().clearCollection({silent:!0})},selectAlertIndicatorView:function(e){s.navigateToPageByElement(l.PAGE_ALERT_EXPLORER,l.SUBPAGE_TABLE,e.currentTarget)},getGlobalAlerts:function(){return n.get(n.ALERT_CONTROLLER).collection},startServices:function(){if(a.isMulticlusterUI()||this.loadAlertPolicyMetadata(),!a.isClusterFFEnabled(l.FFLAGS.SUPPORT_PAGINATION)){n.get(n.ALERT_CONTROLLER).collection.isPolling()||n.get(n.ALERT_CONTROLLER).collection.startPolling({data:{resolved:!1}})}},stopServices:function(){n.get(n.ALERT_CONTROLLER).collection.stopPolling()},destroyAllPopOvers:function(e){$(e).find(".n-alert-widget").popover("destroy"),$(e).find(".n-alert-highlight-indicator").popover("destroy")},loadAlertPolicyMetadata:function(){return r.loadAlertTypeMetadata()}}}),define("models/eula/EulaAgreementModel",["models/BaseModel","data/DataURLConstants"],function(e,t){"use strict";var i={USERNAME:"username",COMPANY_NAME:"companyName",JOB_TITLE:"jobTitle",CONTENT:"content"};return e.extend({name:"EulaAgreementModel",urlRoot:t.EULA_ACCEPTED,DP:i,defaults:{username:null,companyName:null,jobTitle:null,content:null},toJSON:function(){return{username:this.get(this.DP.USERNAME),companyName:this.get(this.DP.COMPANY_NAME),jobTitle:this.get(this.DP.JOB_TITLE)}}},{DP:i})}),define("text!templates/eula/EulaAgreementView.html",[],function(){return'<header class="n-eula-header">\n  Nutanix End User License Agreement (EULA) and Terms of Use\n</header>\n<div class="n-eula-container">\n  \x3c!--Left Side--\x3e\n  <div class="n-eula-agreement">\n    <div class="antiscroll-wrap">\n      <div class="box-wrap">\n        <div class="antiscroll-inner">\n          <div class="box-inner">\n            <%= eulaAgreement %>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n\n  \x3c!--Right Side--\x3e\n  <div class="n-eula-input-container">\n    <div class="n-message-header">\n      \x3c!-- Error goes here --\x3e\n    </div>\n\n    <div class="n-row">\n      <input type="text" class="n-username" placeholder="Name">\n    </div>\n    <div class="n-row">\n      <input type="text" class="n-company" placeholder="Company">\n    </div>\n    <div class="n-row">\n      <input type="text" class="n-job-title" placeholder="Job Title">\n    </div>\n    <div class="n-row n-terms-conditions-container">\n      <%= Components.checkbox({\n        id: \'termsConditions\',\n        jsClasses: \'n-terms-conditions\'\n      }) %>\n      <label for="termsConditions" class="n-terms-conditions-label">\n        I have read and agree to the terms and conditions.\n      </label>\n    </div>\n    <div class="n-row n-btn-container">\n      <button class="btn n-button n-decline">Decline</button>\n      <button class="btn n-button n-accept n-blue">Accept</button>\n    </div>\n  </div>\n</div>\n'}),define("views/eula/EulaAgreementView",["views/basecomponents/BaseView","managers/AccessManager","views/utils/ParticleView","utils/AppUtil","utils/AntiscrollUtil","utils/SubViewHelper","text!templates/eula/EulaAgreementView.html"],function(e,t,i,n,s,a,r){"use strict";r=_.template(r);var o=_.template('<div class="n-error-message"><%= msg %></div>');return e.extend({model:null,className:"n-eula-agreement-container",events:{"click .n-accept":"onClickAccept","click .n-decline":"onClickDecline","change .n-terms-conditions":"onCheckTermsAndConditions"},EULA_ACCEPT:"eulaAccept",EULA_DECLINE:"eulaDecline",initialize:function(e){this.model=e.model,this.el=e.el,this.subViewHelper=new a},render:function(){var e=this.model.get(this.model.DP.CONTENT);return this.$el.html(r(this.vtOptions({eulaAgreement:n.unescapeHTMLString(e)}))),this.$(".n-accept").prop("disabled",!0),this.applyNutanixInput({types:["checkbox"]}),this._applyAntiScroll(),this._renderParticleView(),this.$(".n-eula-agreement a").attr("tabindex",-1),this},reset:function(){this.$(".n-username").val(""),this.$(".n-company").val(""),this.$(".n-job-title").val(""),this.$(".n-terms-conditions").prop("checked",!1)},destroy:function(){this.subViewHelper.removeAll(),this.subViewHelper=null,e.prototype.destroy.apply(this,arguments)},onClickAccept:function(){this.$(".n-eula-input-container").find(".n-error-message").remove(),this._validateFields()||this._saveEulaAgreement()},onClickDecline:function(){var e=this;this.$el.fadeOut("fast",function(){e.trigger(e.EULA_DECLINE)})},onCheckTermsAndConditions:function(){this.$(".n-terms-conditions").is(":checked")?this.$(".n-accept").removeAttr("disabled"):this.$(".n-accept").attr("disabled","")},_applyAntiScroll:function(){var e=this.$(".n-eula-agreement"),t=e.width()+"px",i=e.height()+"px";s.applyAntiScroll(e,t,i,{x:!1,y:!0,autoHide:!1,track:!0})},_renderParticleView:function(){var e=new i({el:$("#loginBackground"),manager:{continueLoop:function(){return!0}}});this.subViewHelper.register("particleView",e),e.renderParticles()},_saveEulaAgreement:function(){var e=this._getDirtyObject(),i=this;this.model.save(e,{success:function(){i.$el.fadeOut("fast",function(){i.trigger(i.EULA_ACCEPT)})},error:function(){var e;e=t.isAdminUser()?"Failed to save changes. Please retry.":"The EULA can only be accepted by a cluster administrator.",i.$(".n-eula-input-container .n-message-header").html(o({msg:e}))}})},_validateFields:function(){var e=!1;return _.each(this.$(".n-eula-input-container input:not(:disabled)"),function(t){this._checkEmpty($(t))?($(t).addClass("n-error"),e=!0):$(t).removeClass("n-error")},this),e},_getDirtyObject:function(){var e={},t=this.model.DP;return e[t.USERNAME]=this.$(".n-username").val(),e[t.COMPANY_NAME]=this.$(".n-company").val(),e[t.JOB_TITLE]=this.$(".n-job-title").val(),e},_checkEmpty:function(e){var t=e.prop("type");return"text"===t&&""===e.val()||"checkbox"===t&&!1===e.prop("checked")}})}),define("managers/prechecks/EulaPreCheckManager",["managers/NamespaceManager","managers/NavigationManager","models/eula/EulaAgreementModel","data/DataProperties","utils/AppConstants","views/eula/EulaAgreementView"],function(e,t,i,n,s,a){"use strict";return{eulaView:null,_deferred:null,initialize:function(){this._deferred=$.Deferred()},startPrechecks:function(e){if(this.isEulaAccepted())this._deferred.resolve();else{var t=$(e.el)||$("body"),i=$('<div class="n-eula-agreement-container"></div>');t.append(i),this.setEulaAgreementModel(),this.eulaView?this.eulaView.showView():(this.eulaView=new a({model:this.eulaAgreementModel,el:t.find(".n-eula-agreement-container")}),this.eulaView.render(),this.eulaView.on(this.eulaView.EULA_ACCEPT,this.handleEulaAccepted,this),this.eulaView.on(this.eulaView.EULA_DECLINE,this.handleEulaDeclined,this))}return this._deferred.promise()},handleEulaAccepted:function(){e.set(e.EULA_STATUS,!0),this._deferred.resolve(),this.destroyPrechecks()},
handleEulaDeclined:function(){t.navigateToRoute(s.ROUTE_LOGOUT)},destroyPrechecks:function(){this._deferred=null,this.eulaView&&(this.eulaView.off(),this.eulaView.destroy(),this.eulaView=null),$(".n-eula-agreement-container").remove()},isEulaAccepted:function(){var t,i,s=e.get(e.EULA_STATUS);return void 0===s?(t=e.get(e.SESSION_INFO)[n.EULA],i=void 0===t,e.set(e.EULA_STATUS,i),i):s},setEulaAgreementModel:function(){if(!this.eulaAgreementModel){var t=e.get(e.SESSION_INFO)[n.EULA];this.eulaAgreementModel=new i,this.eulaAgreementModel.set({content:t[this.eulaAgreementModel.DP.CONTENT]})}}}}),define("models/pulse/AutoSupportModel",["models/BaseModel","data/DataURLConstants","data/DataProperties","utils/AppConstants"],function(e,t,i,n){"use strict";return e.extend({idAttribute:i.PULSE_PROMPT_NEEDED,urlRoot:t.AUTOSUPPORT,entityType:n.ENTITY_GROUP,defaults:{emailContactList:null,enable:null,verbosityType:null,enableDefaultNutanixEmail:null,defaultNutanixEmail:null,nosVersion:null},getURL:function(){return this.urlRoot}})}),define("models/alert/AlertConfigModel",["models/BaseModel","data/DataURLConstants","utils/AppConstants"],function(e,t,i){"use strict";var n={EMAIL_CONFIG_RULE:"emailConfigRules",RECIPIENTS:"recipients",CATEGORIES:"categories",SEVERITIES:"severities",CLUSTER_UUIDS:"clusterUuids",EMAIL_TEMPLATE:"emailTemplate",MATCH_PHRASES:"matchPhrases",INCLUDE_GLOBAL_EMAIL_CONTACT_LIST:"includeGlobalEmailContactList",SUBJECT_PREFIX:"subjectPrefix",BODY_PREFIX:"bodySuffix",RULE_ATTRIBUTE_I18N_KEYS:{recipients:"email_addresses_label",categories:"impact_type_label",severities:"severity_label",clusterUuids:"cluster_label",matchPhrases:"match_phrase_label"}};return e.extend({urlRoot:t.ALERT_CONFIGURATION,entityType:i.ENTITY_ALERT_CONFIGURATION,name:"AlertConfigModel",DP:n,hasEmailConfigChanged:function(e){var t=this.get(n.EMAIL_CONFIG_RULE);return!t||!e||(t.length!==e.length||_.some(t,function(t,i){var n=e[i];return Object.keys(n).length!==Object.keys(t).length||_.some(t,function(e,t){var i=n[t];if(_.isArray(i)){var s=e||[];return i.length!==s.length||!i.every(function(e){return _.contains(s,e)})}return i!==e})}))},getTemplateSubjectPrefix:function(e){var t=this.get(n.EMAIL_TEMPLATE);return t?t[n.SUBJECT_PREFIX]:""},getTemplateBodyPrefix:function(e){var t=this.get(n.EMAIL_TEMPLATE);return t?t[n.BODY_PREFIX]:""},hasEmailTemplateChanged:function(e,t){return this.getTemplateSubjectPrefix()!==e||this.getTemplateBodyPrefix()!==t},isNew:function(){return this._updateCall?(this._updateCall=null,!1):e.prototype.isNew.apply(this,arguments)},doPartialSave:function(e,t){return this._updateCall=!0,this.save(e,t)},showLatencyNotification:function(e,t){},showSuccessNotification:function(e,t,i){},triggerAppViewRefresh:function(){}},{DP:n})}),define("text!templates/pulse/PulseEnableView.html",[],function(){return'<header class="n-pulse-header">\n  Pulse will be enabled\n</header>\n<div class="n-message-header"></div>\n<div class="n-pulse-content">\n  <p>\n    Pulse continuously monitors cluster health and periodically sends machine\n    data to Nutanix’s cloud based analytics engine. It automatically takes action\n    when a problem has occurred, or is about to occur.\n    <a tabindex="-1" href="<%= pulseURL %>"\n       target="_blank">\n      Learn more.\n    </a>\n    <br><br>\n    Nutanix strongly recommends not disabling this feature to improve your\n    support experience in the event of a failure or critical system issue.\n    <br><br>\n    <span class="n-pulse-warning">\n      If you disable Pulse, Nutanix will not be able to proactively reach out to\n      you in the event of failures, and your issue resolution time may increase significantly.\n    </span>\n  </p>\n</div>\n<div class="n-pulse-input-container">\n  <div class="n-checkbox-container">\n    <%= Components.checkbox({\n      jsClasses: \'n-disable-pulse\'\n    }) %>\n    <span>Disable Pulse (not recommended)</span>\n  </div>\n  <div class="n-button-container">\n    <button type="button" class="n-pulse-action btn -blue">\n      Continue\n    </button>\n  </div>\n</div>\n<div class="n-pulse-disclaimer">\n  <p>\n    By enabling Pulse, you elect and authorize Nutanix to electronically collect\n    Pulse diagnostic data, including system alerts via e-mail, in accordance with\n    the terms and conditions set forth in EULA.\n  </p>\n</div>'}),define("views/pulse/PulseEnableView",["views/basecomponents/BaseView","models/pulse/AutoSupportModel","models/alert/AlertConfigModel","managers/LoginManager","managers/UserBehaviorManager","views/utils/ParticleView","data/DataURLConstants","utils/SubViewHelper","text!templates/pulse/PulseEnableView.html"],function(e,t,i,n,s,a,r,o,l){"use strict";l=_.template(l);var c={REMIND:{action:"REMIND",values:{enable:null,email:!1,remind:!0}},DISABLE:{action:"DISABLE",values:{enable:!1,email:!1,remind:null}},ENABLE:{action:"ENABLE",values:{enable:!0,email:!0,remind:null}}};return e.extend({model:null,alertConfigModel:null,containerCreated:!1,events:{"click .n-pulse-action":"onClickAction"},PULSE_DONE:"pulseDone",initialize:function(e){this.model=new t,this.alertConfigModel=new i,this.el=e.el,this.subViewHelper=new o},render:function(){return this.$el.addClass("pre-app-wrapper"),this.$el.html(l(this.vtOptions({pulseURL:r.PULSE_URL,Constants:c}))),this._renderParticleView(),this},destroy:function(){this.containerCreated&&$("#globalModalWrapper").remove(),this.subViewHelper.removeAll(),this.subViewHelper=null,e.prototype.destroy.apply(this,arguments)},onClickAction:function(e){this.$(".n-error-message").remove();var t,i=this.$(".n-disable-pulse").prop("checked");t=i?c.DISABLE.action:c.ENABLE.action,this._savePulseDecision(c[t])},_renderParticleView:function(){n.updateLoginParticlesState();var e=new a({el:$("#loginBackground"),manager:{continueLoop:function(){return!0}},enableParticles:n.isShowVideo()});this.subViewHelper.register("particleView",e),e.renderParticles()},_savePulseDecision:function(e){var t=this,i={enable:e.values.enable,enableDefaultNutanixEmail:e.values.email,isPulsePromptNeeded:!1,remindLater:e.values.remind},n={enableDefaultNutanixEmail:e.values.email},a=[this.model.save(i),this.alertConfigModel.doPartialSave(n)];s.recordUserActivities({action:e.action,actionTarget:"PULSE"}),$.when.apply($,a).done(function(){t.$el.fadeOut("fast",function(){t.trigger(t.PULSE_DONE)})}).fail(function(){t.$(".n-pulse-info-container .n-message-header").html('<div class="n-error-message">Failed to save changes. Please retry.</div>')})}})}),define("managers/prechecks/PulsePreCheckManager",["managers/NamespaceManager","data/DataProperties","views/pulse/PulseEnableView"],function(e,t,i){"use strict";return{pulseView:null,_deferred:null,initialize:function(){this._deferred=$.Deferred()},isPulsePromptNeeded:function(){return e.get(e.SESSION_INFO)[t.PULSE_PROMPT_NEEDED]},startPrechecks:function(e){if(this.isPulsePromptNeeded()){var t=e&&$(e.el)||$("body"),n=$('<div class="n-pulse-info-container"></div>');t.append(n),this.pulseView?this.pulseView.showView():(this.pulseView=new i({el:n}),this.pulseView.render(),this.pulseView.on(this.pulseView.PULSE_DONE,this.handlePulseWorkflowDone,this))}else this._deferred.resolve();return this._deferred.promise()},handlePulseWorkflowDone:function(){this._deferred.resolve(),this.destroyPrechecks()},destroyPrechecks:function(){this._deferred=null,this.pulseView&&(this.pulseView.off(),this.pulseView.destroy(),this.pulseView=null),$(".n-pulse-info-container").remove()}}}),define("managers/prechecks/PCCompatibilityManager",["managers/ClusterManager","managers/NotificationManager","managers/NavigationManager","utils/AppConstants","events/AppEvents","data/DataProperties"],function(e,t,i,n,s,a){"use strict";var r=_.template('<div class="n-pc-incompatibility-msg"><a class="n-pc-incompatibility-popup"><%= numberOfClusters %> incompatible clusters</a> detected. Please un-register or upgrade to resolve the issue.</div>'),o=_.template('The cluster(s), \'<%= clusterNames %>\' <%= (cnt === 1) ? "is" : "are"%> not compatible with the current version of Prism Central. Please un-register or upgrade to resolve the issue.');return{initialize:function(){this._incompatibleClusterUuids=[],_.bindAll(this,"_displayIncompatibleClusters","_onHide","_onClusterCollectionLoad")},isMultiCluster:function(){return e.isMulticlusterUI()},startPrechecks:function(){var t=e.getClusterCollection();this._addListener(t,this._onClusterCollectionLoad)},getPEs:function(t,i){var n=e.getClusterCollection();return _.filter(n.models,function(e){return i?e.get(a.VERSION)>=t:e.get(a.VERSION)<t})},getIncompatiblePEWarningMessage:function(e){var t=this.getPEs(e,!1);if(t.length){var i=_.map(t,function(e){return e.getName()}).join(",");return o({clusterNames:i,cnt:t.length})}return null},_onClusterCollectionLoad:function(t){var i=this;this._removeListener(t,this._onClusterCollectionLoad);var n=e.getPrismCentralVersion();t.each(function(e){e.isNOSIncompatibleWithPC(n)&&i._incompatibleClusterUuids.push(e.get(a.CLUSTER_UUID))}),this._showBanner()},_showBanner:function(){this._incompatibleClusterUuids.length>0&&(s.onAppEvent(s.BANNER_CLOSE,this._onHide),t.showNotificationBar(r({numberOfClusters:this._incompatibleClusterUuids.length}),n.NOTIFICATION_BAR.PC_INCOMPATIBILITY,!0),$(document).on("click",".n-pc-incompatibility-popup",this._displayIncompatibleClusters))},_displayIncompatibleClusters:function(){var e=i.createNavigationContext(null,{entity_ids:_.clone(this._incompatibleClusterUuids),entity_type:n.ENTITY_CLUSTER});i.navigateToPage(n.PAGE_ENTITY_BROWSER,null,{contextId:e})},_onHide:function(e,t){t.type===n.NOTIFICATION_BAR.PC_INCOMPATIBILITY&&($(document).off("click",".n-pc-incompatibility-popup",this._displayIncompatibleClusters),s.offAppEvent(s.BANNER_CLOSE,this._onHide),this._incompatibleClusterUuids=[])},_addListener:function(e,t){e.on("load",t)},_removeListener:function(e,t){e.off("load",t)}}}),define("managers/prechecks/TechPreviewPreCheckManager",["managers/ClusterManager","managers/NotificationManager","managers/ActionManager","utils/AppUtil","utils/AppConstants"],function(e,t,i,n,s){"use strict";var a=_.template('<div class="n-tech-preview-msg -blue"><%= techPreviewText %><a class="n-about-popup">Please see details.</a></div>');return{TP_BANNER_TIME_INTERVAL:24,initialize:function(){},startPrechecks:function(){var t=e.getClusterCollection();this._addListener(t,this._onClusterCollectionLoad)},checkPrismCentralTechPreview:function(){var t=e.getPrismCentralVersion(),i=s.PC_TECH_PREVIEW_VERSIONS;n.isVersionInRange(t,i)&&this._checkShowBanner(t)&&(this._showBanner("This version of Prism Central includes features in tech preview mode which are not intended for production use. "),$(".n-tech-preview-msg .n-about-popup").on("click",{version:t},this._openAboutPopup))},_onClusterCollectionLoad:function(t){this._removeListener(t,this._onClusterCollectionLoad),e.isMulticlusterUI()&&this.checkPrismCentralTechPreview()},_addListener:function(e,t){e.on("load",t,this)},_removeListener:function(e,t){e.off("load",t,this)},_checkShowBanner:function(e){if(n.hasLocalStorage()){if(this._tpAboutLinkClicked(e)||this._tpBannerShownLately(e))return!1;var t={};t[e]=Date.now(),localStorage[s.LOCAL_STORAGE.TECH_PREVIEW_SHOWN]=JSON.stringify(t)}return!0},_tpAboutLinkClicked:function(e){var t=s.LOCAL_STORAGE.TP_ABOUT_LINK_CLICKED;if(n.hasLocalStorage()&&n.isLocalStorageProperty(t))try{return JSON.parse(localStorage[t])[e]}catch(e){return n.log('Error in parsing localStorage["tp_about_link_clicked"]: '+e),!1}return!1},_tpBannerShownLately:function(e){var t=s.LOCAL_STORAGE.TECH_PREVIEW_SHOWN,i=!1;if(n.hasLocalStorage()&&n.isLocalStorageProperty(t))try{i=JSON.parse(localStorage[t])[e]}catch(e){return n.log('Error in parsing localStorage["tech_preview_shown"]: '+e),!1}if(i){return(Date.now()-JSON.parse(localStorage[t])[e])/s.MILLIS_PER_HOUR<this.TP_BANNER_TIME_INTERVAL}return!1},_showBanner:function(e){t.showNotificationBar(a({techPreviewText:e}),s.NOTIFICATION_BAR.TECH_PREVIEW,!0)},_openAboutPopup:function(e){i.executeAction({action:s.ACTION_SHOW,actionTarget:s.SYSTEM_VERSION});var t={};t[e.data.version]=!0,localStorage[s.LOCAL_STORAGE.TP_ABOUT_LINK_CLICKED]=JSON.stringify(t)}}}),define("text!templates/popups/witnessregister/WitnessVMRegisterPopupView.html",[],function(){return'\x3c!-- The parent div modal is #popupWitnessVMRegister --\x3e\n<div class="modal-header">\n  <button type="button" class="close" data-dismiss="modal">\n    <i data-icon="v" aria-hidden="true"></i>\n  </button>\n  <h4 class="n-title"><%= i18n(\'title\') %></h4>\n</div>\n<div class="n-modal-wrapper">\n  <div class="n-modal-body">\n    <div class="n-modal-content-wrapper">\n      <div class="n-modal-alert-header">\n        \x3c!-- @view: update message goes here --\x3e\n      </div>\n      <div class="n-popup-description">\n        <% if (onboarding) { %>\n          <p><%= i18n(\'witness_required\') %></p>\n        <% } %>\n        <% if (canModify) { %>\n          <p>\n            <%= i18n(\'witness_description\') %>\n          </p>\n          <p>\n            <%= i18n(\'witness_form_instructions\') %>\n          </p>\n        <% } %>\n      </div>\n      <div class="alert alert-info">\n        <%= i18n(\'witness_compatability_msg\') %>\n      </div>\n      <div class="n-popup-registered n-popup-status" style="display:none">\n        <%= Components.icon(\'check-thick\',\'-inline icon-check\') %>\n        <span>\n          <%= i18ns(\'witness_registered_ip\', \'<span class="witnessIp"></span>\') %>\n        </span>\n      </div>\n      <div class="n-popup-unregistered n-popup-status" style="display:none">\n        <span class="n-popup-description">\n          <%= i18n(\'not_registered\') %>\n        </span>\n      </div>\n      <% var sDisabled = canModify ? \'\' : \'disabled\' ; %>\n      \x3c!-- WitnessVM register form --\x3e\n      <form id="WitnessVMRegisterPopupForm">\n        <div class="control-group">\n          <label class="control-label"><%= i18n(\'address\') %></label>\n          <div class="controls">\n            <input type="text"\n              class="inputAddress <%= onboarding ? \'-translucent\' : \'\'%>"\n              <%= sDisabled %>\n              <%= elModelKey %>="<%= inputModelKeys.ipAddresses %>"\n            >\n          </div>\n        </div>\n        <% if (onboarding) { %>\n          <div class="control-group">\n            <div class="controls">\n            <label class="control-label"><%= i18n(\'cluster_name\') %></label>\n            <div class="controls clusterNameInput hide">\n              <input type="text" autocomplete="off"\n                class="clusterName <%= onboarding ? \'-translucent\' : \'\' %>"\n                <%= sDisabled %>\n                <%= elModelKey %>="<%= inputModelKeys.clusterName %>"\n                value="<%= inputModel[inputModelKeys.clusterName] %>"\n                placeholder="<%= i18n(\'optional_parentheses\') %>"\n              >\n            </div>\n          </div>\n        <% } %>\n        <div class="credentialInput credential-inputs hide">\n          <p class="section-description"><%= i18n(\'credentials\') %></p>\n          <div class="control-group credential-input">\n            <label class="control-label"><%= i18n(\'user\') %></label>\n            <div class="controls">\n              <input type="text" class="inputUsername <%= onboarding ? \'-translucent\' : \'\' %>"\n                <%= sDisabled %>\n                <%= elModelKey %>="<%= inputModelKeys.username %>">\n            </div>\n          </div>\n          <div class="control-group credential-input">\n            <label class="control-label"><%= i18n(\'pass\') %></label>\n            <div class="controls">\n              <input type="password" autocomplete="off"\n                class="inputPassword <%= onboarding ? \'-translucent\' : \'\' %>"\n                <%= sDisabled %>\n                <%= elModelKey %>="<%= inputModelKeys.password %>">\n            </div>\n          </div>\n        </div>\n      </form>\n    </div>\n  </div>\n  <div class="n-modal-footer">\n    <% if (onboarding) { %>\n      <div class="pull-left checkbox-wrapper">\n        <%= Components.checkbox({\n          jsClasses: \'skip pull-left\',\n          labelText: i18n(\'skip_text\')\n        }) %>\n      </div>\n\n      <button class="btnUpdate btn btn-primary n-btn-list pull-right"\n        disabled="disabled"\n        data-loading-text="<%= i18n(\'saving\') %>">\n        <%= i18n(\'apply_and_continue\') %>\n      </button>\n    <% } else { %>\n      <button class="btnUnregister btn btn-default hide pull-left">\n        <%= i18n(\'unregister\') %>\n      </button>\n      <% if (canModify) { %>\n        <span class="n-button-tooltip">\n          <button class="btnUpdate btn btn-primary n-btn-list"\n          disabled="disabled"\n          data-loading-text="<%= i18n(\'saving\') %>">\n            <%= i18n(\'save\') %>\n          </button>\n        </span>\n      <% } %>\n    <% } %>\n  </div>\n\n</div>'}),define("models/witnessregister/WitnessVMRegisterModel",["models/BaseModel","data/DataURLConstants","data/DataManager","data/DataProperties","utils/AppConstants"],function(e,t,i,n,s){"use strict";var a;return e.extend({idAttribute:n.UUID,urlRoot:t.WITNESS_ADD,entityType:s.ENTITY_WITNESS,actionMode:s.ACTION_UPDATE,defaults:(a={},_defineProperty(a,n.V2.CLUSTER_EXTERNAL_STATE_IP_ADDYS,null),_defineProperty(a,"username",null),_defineProperty(a,"password",null),a),name:"WitnessVMRegisterModel",getDataSourceURL:function(){return i.getV2DataSourceURL()},getWitnessIp:function(){var e=this.get(n.V2.CLUSTER_EXTERNAL_STATE_IP_ADDYS);return e.length>0?e[0]:e},hasWitnessRegistered:function(){return this.get(n.V2.CLUSTER_EXTERNAL_STATE_IP_ADDYS)&&this.get(n.V2.CLUSTER_EXTERNAL_STATE_IP_ADDYS).length>0},canUpdateWith:function(e){if(this.hasWitnessRegistered()){if(this.getWitnessIp()===e[n.V2.CLUSTER_EXTERNAL_STATE_IP_ADDYS])return!1}return e&&e[n.V2.CLUSTER_EXTERNAL_STATE_IP_ADDYS]&&e.username&&e.password}})}),define("models/witnessregister/MAWitnessCollection",["models/BaseCollection","models/witnessregister/WitnessVMRegisterModel","data/DataURLConstants","data/DataManager"],function(e,t,i,n){"use strict";return e.extend({url:i.WITNESS_ADD,model:t,name:"WitnessSiteCollection",getDataSourceURL:function(){return n.getV2DataSourceURL()}})}),define("views/popups/witnessregister/WitnessVMRegisterPopupView",["backbone","views/basecomponents/popups/BasePopupView","text!templates/popups/witnessregister/WitnessVMRegisterPopupView.html","models/witnessregister/WitnessVMRegisterModel","models/cluster/ClusterModel","models/witnessregister/MAWitnessCollection","managers/NodeManager","views/utils/ParticleView","data/DataProperties","data/DataURLConstants","utils/AppConstants","utils/SubViewHelper","utils/ManagerMixin","utils/AppUtil"],function(e,t,i,n,s,a,r,o,l,c,u,d,h,p){"use strict";var T,E=_.template(i),S=u.FORM_SELECTORS.DATA_MODEL_ATTR,g=_.extend({},h,{name:"WitnessVMRegisterPopupView",el:"#popupWitnessVMRegister",witnessVMRegisterModel:null,WITNESS_REGISTER_FINISHED:"witnessRegisterFinished",onboarding:!1,skipOnboarding:!1,inputModel:(T={},_defineProperty(T,l.V2.CLUSTER_EXTERNAL_STATE_IP_ADDYS,null),_defineProperty(T,l.V2.CLUSTER_EXTERNAL_STATE_NAME,null),_defineProperty(T,l.V2.CLUSTER_EXTERNAL_STATE_USER,null),_defineProperty(T,l.V2.CLUSTER_EXTERNAL_STATE_PASS,null),T),clusterModel:null,events:{"click  .btnUpdate":"onUpdateClick","click  .skip":"onSkipClick","click  .btnCancel":"hide","click  .modal-header .close":"hide","keypress input":"onKeyPress","input input":"onInput","click input":"clearHeader","click .btnUnregister":"unregister","input .inputAddress":"onAddressChange"},initialize:function(e){this.witnessVMRegisterModel=new n,this.witnessSiteCollection=new a,this.subViewHelper=new d,e=e||{},e.el&&(this.el=e.el),this.onboarding=e.onboarding,t.prototype.initialize.apply(this,arguments)},validate:function(e){var t="",i=e[l.V2.CLUSTER_EXTERNAL_STATE_IP_ADDYS];if(0!==i.length&&0!==i[0].length&&!p.isValidIP(i[0])&&e.username&&0!==e.username.length&&e.password&&0!==e.password.length||(t="Host/IP, username and password are required fields."),$.trim(t).length>0)return t},render:function(){if(this.fetchCompleted){var e=this.vtOptions({canModify:this.canModifyByEntityType(u.ENTITY_WITNESS),witnessVMName:u.WITNESS_NAME,onboarding:this.onboarding,elModelKey:S,inputModel:this.inputModel,inputModelKeys:{username:l.V2.CLUSTER_EXTERNAL_STATE_USER,password:l.V2.CLUSTER_EXTERNAL_STATE_PASS,clusterName:l.V2.CLUSTER_EXTERNAL_STATE_NAME,ipAddresses:l.V2.CLUSTER_EXTERNAL_STATE_IP_ADDYS}});this.$el.html(E(e)),this.onboarding&&this._renderParticleView()}return this},show:function(){var e,i=this,n=this.getNotificationManager().showLatencyMessage(this.i18n("check_witness_availability")),a=[];if(this.clusterModel=h.getClusterManager().getCurrentClusterModel(),this.onboarding&&!this.clusterModel){var o=s.extend({urlRoot:c.CLUSTER});this.clusterModel=new o;var d=this.clusterModel.fetch({success:function(){i.inputModel[l.V2.CLUSTER_EXTERNAL_STATE_NAME]=i.clusterModel.get(l.CLUSTER_NAME),i.updateClusterNameInput()}});a.push(d)}r.isInit||r.initialize();var p=r.startServices().always(function(){i.getNotificationManager().hideLatencyMessage(n)}).error(function(){i.getNotificationManager().showClientNotification(u.NOTIFY_ERROR,i.i18n("cluster_details_not_found"))});a.push(p),t.prototype.show.apply(this,arguments),(e=$).whenAll.apply(e,a).done(function(){if(i.fetchCompleted=!0,!i.onboarding){if(!h.getClusterManager().isTwoNodeCluster()){var e=r.getAllNodes()||[],t=r.DP;if(e.find(function(e){var i=e.get(t.HYPERVISOR)===u.SOFTWARE_RELEASES_HYP_TYPE.ESXI,n=e.get(t.ATTRIBUTES)[t.MINIMAL_COMPUTE_NODE];return!i&&!n}))return void i.getNotificationManager().showClientNotification(u.NOTIFY_INFO,i.i18n("witness_not_available"))}i.render()}i.witnessSiteCollection.fetch({success:function(){i.witnessSiteCollection.length&&(i.witnessVMRegisterModel=i.witnessSiteCollection.at(0)),i.onboarding&&i.showOnboardingPopup(),i.showForm(),i.$(".inputAddress").focus()},error:function(e,t){i.showHeaderError(t.responseText),i.onboarding&&i.onSkipOnboarding()}})})},showOnboardingPopup:function(){this.witnessSiteCollection.length?this.onSkipOnboarding():this.render()},reset:function(){this.clearForm(),this.clearHeader(),this.undelegateEvents()},showForm:function(){this.$(".n-popup-status").hide();var e=this.witnessVMRegisterModel.hasWitnessRegistered();if(!this.onboarding&&e){var t=this.witnessVMRegisterModel.getWitnessIp();this.$(".inputAddress").val(t),this.hideCredentialInputs(),this.$(".n-popup-registered").show().find(".witnessIp").html(t),this.showUnregisterButton(),this.disableUpdateButton()}else this.clearForm(),this.hideUnregisterButton(),this.disableUpdateButton();this.onboarding&&this.showClusterNameInput()},clearForm:function(){this.showCredentialInputs(),this.$(".inputAddress").val(""),this.$(".inputUsername").val(""),this.$(".inputPassword").val(""),this.disableUpdateButton()},validateInputs:function(){this.witnessVMRegisterModel.canUpdateWith(this.inputModel)?this.enableUpdateButton():this.disableUpdateButton()},onInput:function(e){if(!$(e.currentTarget).hasClass("skip")){var t=e.currentTarget.value;this.inputModel[e.currentTarget.getAttribute(S)]=t,this.validateInputs()}},hideCredentialInputs:function(){this.$(".credentialInput").addClass("hide")},showCredentialInputs:function(){this.$(".credentialInput").removeClass("hide")},showClusterNameInput:function(){this.$(".clusterNameInput").removeClass("hide")},updateClusterNameInput:function(){var e=this.inputModel[l.V2.CLUSTER_EXTERNAL_STATE_NAME];this.$(".clusterName").val(e)},enableUpdateButton:function(){this.$(".btnUpdate").prop("disabled",!1)},disableUpdateButton:function(){this.$(".btnUpdate").prop("disabled",!0)},showUnregisterButton:function(){this.$(".btnUnregister").removeClass("hide")},hideUnregisterButton:function(){this.$(".btnUnregister").addClass("hide")},destroy:function(){this.witnessVMRegisterModel&&this.witnessVMRegisterModel.off(),this.clusterModel&&this.clusterModel.off(),t.prototype.destroy.apply(this,arguments)},onUpdateClick:function(){if(this.skipOnboarding)return void this.onSkipOnboarding();var e=_.clone(this.inputModel),t=e[l.V2.CLUSTER_EXTERNAL_STATE_IP_ADDYS];e[l.V2.CLUSTER_EXTERNAL_STATE_IP_ADDYS]=[t],this.onboarding?this.onboardingUpdateWitnessServer(e,!0):(e[l.V2.CLUSTER_EXTERNAL_STATE_NAME]=h.getClusterManager().getCurrentClusterModel().get(l.NAME),this.updateWitnessServer(e,!0))},onSkipClick:function(e){this.skipOnboarding=$(e.currentTarget).is(":checked"),this.skipOnboarding?this.enableUpdateButton():this.validateInputs()},onSkipOnboarding:function(){this.hide(),this.trigger(this.WITNESS_REGISTER_FINISHED)},onEnterKeyPress:function(){this.onUpdateClick()},onAddressChange:function(e){if(this.witnessVMRegisterModel.hasWitnessRegistered()){this.witnessVMRegisterModel.getWitnessIp()===e.currentTarget.value?this.hideCredentialInputs():this.showCredentialInputs()}},onboardingUpdateWitnessServer:function(e,t){var i=this,n=_defineProperty({},l.CLUSTER_NAME,this.inputModel[l.V2.CLUSTER_EXTERNAL_STATE_NAME]),s={success:function(t,n){i.updateWitnessServer(e,!0)},error:function(e,t){var n=i.i18n("WITNESS_REGISTER_ERROR");i.showHeaderErrorWithDetails(n,t.responseText)}};this.clusterModel.save(n,s)},updateWitnessServer:function(e,t){var i=this;this.$(".btnUpdate").button("loading");var n=this.witnessVMRegisterModel,s=this.i18n("WITNESS_REGISTER_ERROR","Error registering witness site.");n.on("error",function(e,t){i.showHeaderError(t),i.$(".btnUpdate").button("reset")}),!1!==n.set(e)&&n.save(null,{success:function(e,t){i.hide(),i.$(".btnUpdate").button("reset"),i.trigger(i.WITNESS_REGISTER_FINISHED)},error:function(e,t){i.showHeaderErrorWithDetails(s,t.responseText),i.$(".btnUpdate").button("reset")}})},unregister:function(){this.$(".btnUnregister").button("loading"),this.witnessVMRegisterModel.destroy({success:_.bind(function(){this.witnessVMRegisterModel=new n,this.$(".btnUnregister").button("reset"),this.$(".btnUnregister").toggleClass("hide"),this.showForm(),this.enableUpdateButton()},this),error:_.bind(function(e,t){var i=this.i18n("witness_unregister_error","Error unregistering witness site. ");this.showHeaderError(i+(p.processAjaxError(t.responseText)||"")),this.$(".btnUnregister").button("reset")},this)})},_renderParticleView:function(){var e=new o({el:$(".login-background"),manager:{continueLoop:function(){return!0}}});this.subViewHelper.register("particleView",e),e.renderParticles()}});return t.extend(g)}),define("managers/prechecks/WitnessVMPreCheckManager",["managers/NamespaceManager","data/DataProperties","views/popups/witnessregister/WitnessVMRegisterPopupView"],function(e,t,i){"use strict";return{witnessVMRegisterView:null,_deferred:null,initialize:function(){this._deferred=$.Deferred()},isTwoNodeWitnessVMPromptNeeded:function(){return e.get(e.SESSION_INFO)[t.TWO_NODE_WITNESS_PROMPT_NEEDED]},startPrechecks:function(e){if(this.isTwoNodeWitnessVMPromptNeeded()){var t=e&&$(e.el)||$("body"),n=$('<div class="witness-vm-info-container popup-onboarding"></div>');t.append(n),this.witnessVMRegisterView=new i({el:n,onboarding:!0,canModify:!0}),this.witnessVMRegisterView.render().show(),this.witnessVMRegisterView.on(this.witnessVMRegisterView.WITNESS_REGISTER_FINISHED,this.handleWitnessVMWorkflowDone,this)}else this._deferred.resolve();return this._deferred.promise()},handleWitnessVMWorkflowDone:function(){this._deferred.resolve(),this.destroyPrechecks()},destroyPrechecks:function(){this._deferred=null,this.witnessVMRegisterView&&(this.witnessVMRegisterView.off(),this.witnessVMRegisterView.destroy(),this.witnessVMRegisterView=null),$(".witness-vm-info-container").remove()}}}),define("managers/prechecks/PreCheckManager",["managers/NotificationManager","managers/CommunityEditionManager","managers/NamespaceManager","managers/PrismElementManager","managers/prechecks/EulaPreCheckManager","managers/prechecks/PulsePreCheckManager","managers/prechecks/PCCompatibilityManager","managers/prechecks/TechPreviewPreCheckManager","managers/prechecks/WitnessVMPreCheckManager","managers/BaseManager","events/AppEvents","utils/AppConstants","utils/AppUtil","data/DataProperties"],function(e,t,i,n,s,a,r,o,l,c,u,d,h,p){"use strict";return c.extend({preChecks:null,name:d.MANAGER.PRECHECK,initialize:function(){this.preChecks=[t,a,s,r,o,l],_.each(this.preChecks,function(e){e.initialize&&e.initialize()}),this.addToManagerHelper()},startServices:function(){this.preChecks&&($("body").on(u.SHOW_PRE_CHECK_NOTIFICATION,this.showNotifications),_.each(this.preChecks,function(e){e.startServices&&e.startServices()}))},stopServices:function(){this.preChecks&&($("body").off(u.SHOW_PRE_CHECK_NOTIFICATION),_.each(this.preChecks,function(e){e.stopServices&&e.stopServices()}))},showNotifications:function(t,i){i.show&&e.showNotificationBar(i.message,i.type,i.isShowClose),i.hide&&e.hideNotificationBar(i.type)},hasPrechecksPreRender:function(){return!s.isEulaAccepted()||a.isPulsePromptNeeded()||l.isTwoNodeWitnessVMPromptNeeded()},executePreRenderPrechecks:function(e){var t=_.bind(s.startPrechecks,s),i=_.bind(a.startPrechecks,a),n=_.bind(l.startPrechecks,l),r=e.successCallback;h.runAsyncTasksSequentially([t,i,n,r],e)},executeNonBlockingChecks:function(){r.isMultiCluster()&&r.startPrechecks(),o.startPrechecks()},hasPrechecksPostRender:function(){return t.isCommunityEditionCluster()},isValidPostRenderPrechecks:function(){return t.isValidCommunityEdition()},executePostRenderPrechecks:function(e){t.isCommunityEditionCluster()&&(t.registerCallbackSuccessfulPrechecks(e.successCallback),t.startPrechecks())},isUsingDefaultPassword:function(){var e=i.get(i.USER_DETAILS),t=i.get(i.SESSION_INFO);if(!n.isLoadedFromPrismCentral()&&e&&t){var s=e.profile.username,a=t[p.IS_USING_DEFAULT_PASSWORD];if(s===d.ROOT_USERNAME&&a)return!0}return!1}})}),define("models/cluster/ClusterHealthStatsModel",["models/PollingModel","data/DataURLConstants","data/DataProperties","utils/AppUtil","utils/AppConstants"],function(e,t,i,n,s){"use strict";return e.extend({urlRoot:t.NCC_RUN_SUMMARY,detailedStats:!1,intervalTimeInMilliSec:6e4,nameAttribute:i.CLUSTER_UUID,idAttribute:i.ID,entityTypes:[s.ENTITY_VM,s.ENTITY_DISK,s.ENTITY_HOST,s.ENTITY_PROTECTION_DOMAIN,s.ENTITY_REMOTE_SITE,s.ENTITY_STORAGE_POOL,s.ENTITY_CONTAINER,s.ENTITY_CLUSTER],name:"ClusterHealthStatsModel",defaults:{vm:{},host:{},disk:{},remote_site:{},protection_domain:{},storage_pool:{},container:{},cluster:{},lastUpdated:null,erredCheckDetails:[],clusterUuid:null},setRequestDetailedStats:function(e){this.detailedStats=e},getURL:function(){return this.detailedStats?this.urlRoot+"?detailedSummary=true":this.urlRoot},parse:function(e){var t=this,n={};e.length>0?(this.clusterUuid?n[i.CLUSTER_UUID]=this.clusterUuid:n[i.CLUSTER_UUID]=this.clusterManager.getCurrentClusterId(),n.entities=e):n=e;var s={};return _.each(n.entities,function(e){var i=(e.entityType||"").toLowerCase();i&&t.entityTypes.indexOf(i)>-1?s[i]={healthSummary:e.healthSummary,detailedCheckSummary:e.detailedCheckSummary}:!i&&e.checksInError&&(s.erredCheckDetails=e.checksInError)}),s[i.CLUSTER_UUID]=n[i.CLUSTER_UUID],s.lastUpdated=(new Date).getTime(),s},getClusterHealthStatus:function(){for(var e=s.HEALTH_STATUS.GOOD,t=0;t<this.entityTypes.length;t++){var a=this.entityTypes[t],r=this.get(a).healthSummary;if(r){var o=r[s.HEALTH_STATUS.CRITICAL]&&r[s.HEALTH_STATUS.CRITICAL]>0,l=r[s.HEALTH_STATUS.WARNING]&&r[s.HEALTH_STATUS.WARNING]>0;if(o){e=s.HEALTH_STATUS.CRITICAL;break}l&&(e=s.HEALTH_STATUS.WARNING)}else{var c="ClusterHealthStatsModel.getClusterHealthStatus:  No healthSummary for entityType "+a;this[i.CLUSTER_UUID]&&(c+=" on cluster "+this[i.CLUSTER_UUID]),n.log(c)}}return e},getHealthStats:function(e){if(this.get(e)){var t=this.get(e).healthSummary;if(t)return t}var i={};return _.each(_.values(s.HEALTH_STATUS),function(e){i[e]=0}),i},
updateHealthStats:function(e,t){if(this.get(e)){var i=this.get(e).healthSummary;i&&_.each(t,function(e,t){i[t]=e})}},getTestStatus:function(e){if(!this.detailedStats)return n.log("ClusterHealthStatsModel   : Bad request : no detailed stats available"),null;if(!this.get("lastUpdated"))return null;for(var t=n.getDisplayableId(e),i=s.HEALTH_STATUS.GOOD,a=0;a<this.entityTypes.length;a++){var r=this.entityTypes[a],o=this.get(r).detailedCheckSummary,l=o?o[t]:null;if(l){var c=l[s.HEALTH_STATUS.CRITICAL]&&l[s.HEALTH_STATUS.CRITICAL]>0,u=l[s.HEALTH_STATUS.WARNING]&&l[s.HEALTH_STATUS.WARNING]>0,d=l[s.HEALTH_STATUS.ERROR]&&l[s.HEALTH_STATUS.ERROR]>0||this.getErredTestDetails()[t];if(c){i=s.HEALTH_STATUS.CRITICAL;break}if(d){i=s.HEALTH_STATUS.ERROR;break}u&&(i=s.HEALTH_STATUS.WARNING)}}return i},getTestEntityCounts:function(e){if(!this.get("lastUpdated"))return null;var t={total:0};return _.each(s.HEALTH_STATUS,function(e){t[e]=0}),_.each(this.entityTypes,function(i){var n=this.get(i).detailedCheckSummary,s=n?n[e]:null;s&&_.each(s,function(e,i){t[i]+=e,t.total+=e})},this),t},getErredTestDetails:function(){return this.get("erredCheckDetails")},getFailedTestIds:function(){return this.getStatusBasedTestIds(i.HEALTH_STATUS_VALUES.CRITICAL)},getWarningTestIds:function(){return this.getStatusBasedTestIds(i.HEALTH_STATUS_VALUES.WARNING)},getStatusBasedTestIds:function(e){var t=[];return _.each(this.entityTypes,function(i){var n=this.get(i).detailedCheckSummary;n&&_.each(n,function(i,n){i[e]>0&&t.push(n)},this)},this),t},deepClone:function(e){this.attributes=_.clone(e.attributes),_.each(this.entityTypes,function(t){e.attributes[t][i.HEALTH_SUMMARY]&&(this.attributes[t][i.HEALTH_SUMMARY]=_.clone(e.attributes[t][i.HEALTH_SUMMARY]))},this),this.attributes.lastUpdated=e.attributes.lastUpdated}})}),define("managers/HealthManager",["models/cluster/ClusterHealthStatsModel","managers/NamespaceManager"],function(e,t){"use strict";return{healthStatsModel:null,healthDocumentation:null,XML_NODE_CHECK:"check",initialize:function(){this.healthStatsModel=new e,t.set(t.HEALTH_MANAGER,this)},fetchOnDemand:function(){this.healthStatsModel.fetch()},registerHealthListener:function(e,t,i){this.healthStatsModel.on(e,t,i)},unregisterHealthListener:function(e,t,i){this.healthStatsModel.off(e,t,i)},getClusterHealthStatus:function(){return this.healthStatsModel.getClusterHealthStatus()},getClusterHealthStatsModel:function(){return this.healthStatsModel},startServices:function(){this.healthStatsModel.isPolling()||this.healthStatsModel.startPolling()},stopServices:function(){this.healthStatsModel.stopPolling()}}}),define("text!templates/popups/iq/IQCheatSheetPopUpView.html",[],function(){return'\x3c!-- The parent div modal is .popupIQSearchSuggestions --\x3e\n<div class="modal-header">\n  <button type="button" class="close">\n    <i data-icon="K" aria-hidden="true"></i>\n  </button>\n  <h4 class="n-title">Search Cheat Sheet</h4>\n</div>\n<div class="n-modal-wrapper">\n  <div class="n-modal-body">\n    <div class="n-modal-content-wrapper cheat-sheet-popup">\n      <div class="n-modal-header">\n        <div class="cheat-sheet-view n-clearfix">\n          <div class="cs-header n-title">\n            Try searching with these keywords\n          </div>\n          <div class="cheat-sheet-container">\n            <div id="examplesInPopup" class="search-examples"></div>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n</div>'}),define("text!templates/iq/IQCheatSheetTemplate.html",[],function(){return'<div class="cheat-sheet-section">\n  <div class="section-heading"><%= cheatSheetSection.description %></div>\n  <div class="section-rows">\n    <% _.each(cheatSheetSection.queries, function(query) { %>\n    <div class="query-row searchQuery\n      <%= query.isTemplatized ? \'\' : \'clickable\' %> ">\n      <%= query.text %>\n      <% if (query.description) { %>\n      <span class="query-help" title="<%= query.description %>"><%= helpIcon %></span>\n      <% } %>\n    </div>\n    <% }); %>\n  </div>\n</div>\n\n'}),define("views/popups/iq/IQCheatSheetPopupView",["views/basecomponents/popups/BasePopupView","components/Components","text!templates/popups/iq/IQCheatSheetPopUpView.html","text!templates/iq/IQCheatSheetTemplate.html","events/AppEvents","managers/HelpManager"],function(e,t,i,n,s,a){"use strict";var r=_.template(n);return e.extend({el:"#popupIQCheatSheet",template:null,entitySchemaCollection:null,queryCategoryCollection:null,ADVANCED_QUERIES:"Advanced queries",events:{"click .modal-header .close":"hide","click .searchQuery.clickable":"onClickSearchQuery"},initialize:function(t){this.cheatSheetCollection=t.model,_.bindAll(this,"queryCheatSheet"),e.prototype.initialize.apply(this,arguments)},render:function(){this.$el.html(i),this.queryCheatSheet()},updateHelpButton:function(){e.prototype.updateHelpButton.apply(this,arguments),this.$(".modal-header .help-icon").off("click").click(this.onClickHelp.bind(this))},queryCheatSheet:function(){var e=this;this.cheatSheetCollection.fetch({success:function(t,i,n){e.renderCheatSheet(e.cheatSheetCollection.toJSON())},error:function(t,i){e.showHeaderError("Error fetching data.")}})},renderCheatSheet:function(e){this.$("#searchExamples").empty(),_.each(e,function(e){e.description!==this.ADVANCED_QUERIES&&this.$("#examplesInPopup").append(r({cheatSheetSection:e,helpIcon:t.icon("question-tooltip","-inline")}))},this)},onClickHelp:function(){a.navigateToSearchHelp()},onClickSearchQuery:function(e){var t=e.currentTarget.textContent.trim();this.trigger(s.QUERY_EXAMPLE,t),this.hide()}})}),define("models/iq/IQSearchQueryModel",["backbone","models/BaseModel","data/DataURLConstants"],function(e,t,i){"use strict";var n={REQUEST:{USER_QUERY:"userQuery",QUERY_ID:"queryId",QUERY_TERMS:"queryTerms",AUTO_SUGGEST:"generateAutoCompletionsOnly",EXPLICIT_QUERY:"explicitQuery"},RESULT:{RESULTS:"results",AUTO_SUGGESTIONS:"autoCompletions",QUERY_TERMS:"queryTerms",KEYWORDS:"keywords",TOP_HIT:"topHit",TIME_TAKEN:"timeTaken",USER_QUERY:"userQuery",QUERY_ID:"queryId"},PROVIDERS:{ACTIONS:"Actions",ALERTS:"Alerts",ENTITIES:"Entities",HELP:"Help",CADMUS:"Cadmus",SP_ENTITIES:"SpotlightEntities"}};return t.extend({name:"IQSearchQueryModel",urlRoot:i.IQ_SEARCH,searchUrl:null,queryResult:null,methodForSearch:"create",isUsedForAutoSuggest:!1,initialize:function(e,i){t.prototype.initialize.apply(this,arguments),i&&void 0!==i.isUsedForAutoSuggest&&(this.isUsedForAutoSuggest=i.isUsedForAutoSuggest),this.searchUrl=this.getDataSourceURL()+this.urlRoot},destroy:function(){},sync:function(t,i,n){var s=n.success;n.success=function(e,t,a){i.queryResult=i.parse(e,a),s?s(i.queryResult):i.trigger("sync",i,e,n)};var a=n.error;return n.error=function(e,t,s){a?a():i.trigger("error",i,e,n)},n.url=this.searchUrl,n.contentType="application/json",n.data=JSON.stringify(n.data),this._jqXHR=e.sync(t,i,n),this._jqXHR},search:function(e,t,i,n){return t=t||{},t.data=this.formSearchQueryObject(e,i,n),this.sync(this.methodForSearch,this,t)},formSearchQueryObject:function(e,t,i){var s={};return s[n.REQUEST.USER_QUERY]=e,s[n.REQUEST.AUTO_SUGGEST]=i,s[n.REQUEST.EXPLICIT_QUERY]=t,s[n.REQUEST.QUERY_TERMS]=null,s},getQueryResultValue:function(e){return this.queryResult?this.queryResult[e]:null},getResults:function(){return this.getQueryResultValue(n.RESULT.RESULTS)},getQueryResult:function(){return this.queryResult}},{DP:n})}),define("views/iq/IQTemplates",["utils/SVG"],function(e){"use strict";return{DEFAULT:"No Search Results",NO_SAVED_SEARCHES:_.template('<div class="no-results"><h1 class="title">No saved searches</h1><p class="description">Click the star <%= SVG.SVGIcon("Star_Empty") %> on the search box to save your search keywords.</p></div>'),NO_HISTORY_SEARCHES:_.template('<div class="no-results"><h1 class="title">No recent searches</h1></div>'),NO_RESULT_TEMPLATE:_.template('<div class="no-result-message"><%= noResultMessage %></div>'),ALERT_SUMMARY:_.template('<li class="result detail-row"><div class="iq-alert-summary"><div class="title"><%= title %></div><% _.each(alertSummary, function(count, alertType){ %><div class="key-value"><div class="keyword-row"><%= alertType %></div><div class="result-row"><%= count %></div></div><% }) %></div></li>'),COMMON_KEY_VALUE:_.template('<li class="focusable result detail-row -thin" vIndex="<%=vIndex%>"><% if (title) { %><div class="title"><%= title %></div><% } %><% _.each(keyValues, function (keyValue) { %><div class="key-value"><div class="keyword-row"><%= keyValue.key %></div><div class="result-row"><% if ( _.isArray(keyValue.val) ) { %><ul class="no-list-style"><% _.each(keyValue.val, function(value) { %><li><%= value %></li><% }) %></ul><% } else { %><%= keyValue.val %><% } %></div></div><% }) %></li>'),CAPACITY_FORMAT:_.template('<li class="key-value-section focusable result detail-row -thin" actionRoute="<%= actionRoute %>" vIndex="<%= vIndex %>"><% if (title) { %><div class="title"><%= title %></div><% } %><div class="key-value clearfix"><div class="keyword-row" title="<%= name %>" ><%= name %></div><div class="result-row"><%= value %></div></div></li>'),COUNT_KEY_VALUE:_.template('<li class="focusable result detail-row"  vIndex="<%=vIndex%>"><div class="key-value"><div class="keyword-row"><%= keyValues.title %></div><div class="result-row"><%= keyValues.count %></div></div></li>'),COMMON_HEADER:_.template('<th class="result table-header" colspan="2"><div class="title"><%= header %> </div><% if (showCount) { %><div class="count-badge -visible"><%= description %></div><% } %></th>'),COMMON_TABLE_ROW:_.template('<tr class="detail-row <%= navClass %><% if (actionRoute && isRowNavigable) { %> focusable dataTest-eb" actionRoute="<%= actionRoute %>" title="<%= rowData[0] %> <% } %>"><td class="table-row row-left<% if (actionRoute && !isRowNavigable) { %> focusable" actionRoute="<%= actionRoute %>" title="<%= rowData[0] %> <% } %>" <% if (_.isUndefined(rowData[1])) { %>colspan="2"<% } %>><%= rowData[0] %> <% if ( unit && unit[0] ) { %><%= unit[0] %><% } %></td><% if (!_.isUndefined(rowData[1])) { %><td class="table-row row-right" title="<%= rowData[1] %>"><%= rowData[1] %></td><% } %></tr>'),AUTO_SUGGESTION_ROW:_.template('<div id="iq-auto-suggestion" class="focusable result search-suggestion" vIndex="<%=index%>"><span class="query"><%= query %></span></div>'),HISTORY_LIST_ITEM:_.template('<ul class="history-list item-list"><% _.each(array, function (history) { %><li class="history-list-item item-wrapper"><% if(history) {%><div id="iqHistoryRow"class="keyword-row iq-history-row item-group"><span class="list-text-alignment item" title="<%= _.escape(history) %>" ><%= _.escape(history) %></span></div><% } %></li><% }) %></ul>'),HEADER_COUNT:_.template('<%= filteredCount ? (filteredCount + " OF ") : " " %><%= totalCount ? totalCount : "" %>'),FAVORITE_LIST_ITEM:_.template('<ul class="favorite-list item-list"><% _.each(array, function (favorite) { %><li class="favorite-list-item item-wrapper"><% if(favorite) {%><div id="iqFavoritesRow"class="result-row iq-favorites-row item-group"><span class="list-text-alignment item" title="<%= _.escape(favorite) %>" ><%= _.escape(favorite) %><div class="iq-favorite-star">'+e.SVGIcon("K")+"</div></span></div><% } %></li><% }) %></ul>"),ALERT_TABLE:_.template('<table class="top-hit-table alert-table" vIndex="<%=index%>"><th class="result table-header" colspan="2"><div class="title"><%= options.tableTitle %> </div><% if (options.showCount) { %><div class="count-badge -visible"><%= options.description %></div><% } %></th><% _.each(rowsInfo, function(rowInfo) { %><tr class="detail-row<% if ( rowInfo.actionRoute ) { %> focusable navigable dataTest-alert" actionRoute="<%= rowInfo.actionRoute %>"<% } %> ><td class="table-row row-left" title="<%= rowInfo.columnData %>" ><%= rowInfo.columnData %> </td><td class="table-row alert-counts"><% if (! _.isUndefined(rowInfo.critical)) { %><div class="alert_container"><div class="alert-icon-container"><span class="n-count text-danger"><%= rowInfo.critical %></span><span class="circle-alert-icon kCritical"></span></div></div><% } %><% if (! _.isUndefined(rowInfo.warning)) { %><div class="alert_container"><div class="alert-icon-container"><span class="n-count text-warning"><%= rowInfo.warning %></span><span class="circle-alert-icon kWarning"></span></div></div><% } %><% if (! _.isUndefined(rowInfo.info)) { %><div class="alert_container"><div class="alert-icon-container"><span class="n-count text-info"><%= rowInfo.info %></span><span class="circle-alert-icon kInfo"></span></div></div><% } %></td></tr><% }) %></table>')}}),define("utils/IQUtil",["d3","utils/AlertUtil","utils/AppUtil","utils/FilterUtil","utils/AppConstants","utils/EntityUtil","data/DataProperties"],function(e,t,i,n,s,a,r){"use strict";var o=_.template('<span class="highlighted"><%= matchVal %></span>'),l=_.template('<span class="query-gray"><%= text %></span>');return{QUOTE_STATUS:{HAS_OPENING_QUOTE:"hasOpeningQuote",HAS_CLOSING_QUOTE:"hasClosingQuote",HAS_ENCLOSING_QUOTES:"hasEnclosingQuotes"},quoteStatus:null,highlightMatchedWords:function(e,t){var i;if(!t)return e;t=_.map(t,function(e){return e.replace(/['"]+/g,"")}),i=e||"";var n=_.map(t,function(e){return e.replace(/([^\w\s])/g,"\\$1")}).join("|");return i.replace(new RegExp(n,"gi"),function(e){return o({matchVal:e})})},getTranslatedEntitytype:function(e){var t=s.ENTITY_NAMES[e.toLowerCase()];return t||e},checkForNoVal:function(e){return _.isEmpty(e)||_.isNull(e)||_.isUndefined(e)?s.FILTER_NULL_VALUE:e},getDisplayIPAddresses:function(e){var t=e.split("|"),i=[];return _.each(t,function(e){e=e.split("/")[0],-1===e.indexOf(":")&&i.push(e)}),i},checkEntityType:function(e){return e=e.toLowerCase(),i.getEntityTypeForUI(e)},autoSuggestionParser:function(e,t){if(t){t=t.trim(),t=this._removeSurroundingQuotes(t);var i=t.split(" "),n=[];return _.each(e,function(e){var t=e.split(" "),s=[];_.each(t,function(e){var t=e;this.quoteStatus=null,e=this._removeQuotesAndSetStatus(e),_.contains(i,e)?t=l({text:this._reconstructQueryQuotes(e)}):_.each(i,function(i){var n=new RegExp("^"+i);if(e.match(n)){var s=l({text:i}),a=e.split(i);if(a.length>2){var r=a[1],o=_.map(_.rest(a,2),function(e){return i+e});a=r.concat(o.join())}else a=a[1];t=this._reconstructQueryQuotes(s+a)}},this),s.push(t)},this);var a;s&&s.length&&(a=s.join(" ")),n.push(a)},this),n}return null},_removeSurroundingQuotes:function(e){return e.replace(/"/g,"")},_hasEnclosingQuotes:function(e){return/^".*"$/.test(e)},_reconstructQueryQuotes:function(e){var t;switch(this.quoteStatus){case this.QUOTE_STATUS.HAS_ENCLOSING_QUOTES:t='"'+e+'"';break;case this.QUOTE_STATUS.HAS_CLOSING_QUOTE:t=e+'"';break;case this.QUOTE_STATUS.HAS_OPENING_QUOTE:t='"'+e;break;default:t=e}return t},_removeQuotesAndSetStatus:function(e){var t=e;return this._hasEnclosingQuotes(e)?(this.quoteStatus=this.QUOTE_STATUS.HAS_ENCLOSING_QUOTES,t=this._removeSurroundingQuotes(e)):'"'===e.charAt(0)?(this.quoteStatus=this.QUOTE_STATUS.HAS_OPENING_QUOTE,t=e.replace(/^"/,"")):'"'===e.charAt(e.length-1)&&(t=e.replace(/"$/,""),this.quoteStatus=this.QUOTE_STATUS.HAS_CLOSING_QUOTE),t},toTitleCase:function(e){var t=i.toTitleCase(e);return t&&0===t.toLowerCase().indexOf(s.ENTITY_VM)&&(t=t.toLowerCase())===s.ENTITY_VM&&(t=t.toUpperCase()),t},createFilterExpression:function(e,t,i,s,a){s=s,a=a;var r={},o=n.createFilterCondition(e,t,i,s,a);return n.addFilterCondition(r,t,o)},createFilterExpressionFromFilter:function(e,t){var i={};return _.size(t)<=0?i:(_.each(t,function(t){var o=t[r.SEARCH.FILTER_ATTR],l=t[r.SEARCH.FILTER_VALUE],c=t[r.SEARCH.FILTER_CUSTOM_RHS],u=t[r.SEARCH.FILTER_OPERATOR];u=s.FILTER_OPERATOR_REVERSE_MAPPING[u];var d=null;if(c){var h=this.checkEntityType(e);d=a.getAttributeDisplayName(h,o)+" contains "+c}n.addFilterCondition(i,o,n.createFilterCondition(e,o,u,l,null,d))},this),i)},createFilterExpressionForAlert:function(e,i){var a={};return _.size(e)<=0?a:(_.each(e,function(e){var o=e[r.SEARCH.FILTER_ATTR],l=e[r.SEARCH.FILTER_VALUE],c=e[r.SEARCH.FILTER_OPERATOR];if(c=s.FILTER_OPERATOR_REVERSE_MAPPING[c],o===r.ALERT_RESOLVED&&"true"===l)_.each([s.ALERT_RESOLVED.MANUAL,s.ALERT_RESOLVED.AUTO],function(e){n.addFilterCondition(a,o,n.createFilterCondition(s.ENTITY_ALERT,o,c,e,null,null))});else{var u,d,h=null;if(o===r.SEARCH.ENTITY_TYPE_FILTER)u=l,h=this._toCustomEntityLabel(s.ENTITY_GENERIC,s.ENTITY_NAMES[u]||u);else if(o===r.SEARCH.ENTITY_ID_FILTER){var p=l,T=this._getEntityInfoById(i,p);d=T&&T[r.SEARCH.ENTITY_NAME],u=T&&T[r.SEARCH.ENTITY_TYPE],h=this._toCustomEntityLabel(s.ENTITY_NAMES[u.toLowerCase()],d)}else if(o===r.SEARCH.ALERT_ID_FILTER){var E=l,S=t.getAlertTypeMetadata(E);h=this._toCustomEntityLabel(s.ENTITY_ALERT,S?S.title:null)}n.addFilterCondition(a,o,n.createFilterCondition(s.ENTITY_ALERT,o,c,l,null,h))}},this),a)},caseInsensitiveContains:function(e,t){var i=_.map(e,function(e){return e.toLowerCase()});return t=t.toLowerCase(),_.contains(i,t)},prettifySnakeCase:function(e){if(e){var t=e.split("_");return t=_.map(t,function(e){return i.toUpperCaseFirstChar(e)}),t.join(" ")}},_getEntityInfoById:function(e,t){return _.find(e,function(e){return e[r.SEARCH.ENTITY_ID]===t})},_toCustomEntityLabel:function(e,t){return t?(s.ENTITY_NAMES[e]||e)+" = "+t:null}}}),define("views/iq/results/BaseResultsView",["views/basecomponents/BaseView","views/iq/IQTemplates","data/DataProperties","managers/ClusterManager","managers/NavigationManager","managers/AccessManager","models/query/BaseQueryModel","utils/AppConstants","utils/EntityUtil","utils/VMUtil","utils/StyleDescriptor","utils/FilterUtil","utils/AppUtil","utils/AntiscrollUtil","utils/SVG","utils/IQUtil"],function(e,t,i,n,s,a,r,o,l,c,u,d,h,p,T,E){"use strict";var S=_.template('<div class="antiscroll-wrap"><div class="box-wrap"><div class="antiscroll-inner"><div class="antiscroll-result box-inner n-content-inner"><%= results %></div></div></div></div>'),g=_.template("<%= attribute %> per <%= entityType %>"),A=_.template("Number of <%= entityType %> by <%= attribute %>"),m=_.template("Alerts Per <%= groupBy %>"),f=_.template("<%= attribute %> of filtered <%= entityType %>");return e.extend({DP:{METADATA_CLUSTER_UUID:"clusterUuid",FILTERED_ENTITY_COUNT:"filtered_entity_count",TOTAL_ENTITY_COUNT:"total_entity_count",MAX_COUNT:"maxCount",HEADERS:"headers",TITLE:"title",NAME:"name",ACTION_NAME:"actionName",ENTITY_DATA:"entityData",ENTITY_TYPE:"entityType",ENTITY_METADATA_LIST:"entityMetadataList",FILTERED_DATA:"filteredData",RANGED_DATA:"rangedData",METADATA:"metadata",RESULT:"result",FILTERS:"filters",RESULT_TYPE:"resultType",ROW_ID:"rowId",ROW_DATA:"rowData",ROWS:"rows",COLUMN_NAME:"columnName",ACTION_ROUTE_CLASS:"actionRouteClass",ACTION_ROUTE:"actionRoute",TITLE_INFO:"titleInfo",TOOLTIP:"tooltip",WEIGHTED_TEXT:"weightedText",INSTANCES:"instances",FILTER_NAME:"filterName",VALUES:"values",HYPERVISOR_TYPE:"hypervisor_type",VM_HYPERVISOR_TYPE:"hypervisorType",VM_ANNOTATION:"vm_annotation",VM_TYPE:"vm_type"},RESULT_TYPE:{ACTION:"Actions",ENTITIES:"Entities",ALERTS:"Alerts",HELP:"Help"},ALERT_STATUS:{ACKNOWLEDGED:"Acknowledged",UNACKNOWLEDGED:"Unacknowledged",RESOLVED:"Resolved",UNRESOLVED:"Unresolved"},ACTIONS_SUPPORTED_FOR_ADMINS:["launch_console","pause","power_off","power_on","resume","migrate","affinity"],NO_RESULTS:"-",UNKNOWN:"unknown",RANGE_DATA_SEPARATOR:"||",SYNONYM_ACTION_TITLE:{New:"Create"},IS_ENTITY_INSTANCE:null,ACTION_ROUTE_CLASS:"focusable",ACTION_EB_FILTER:"navigable",TOTAL_COUNT:"Total",CHART_HEIGHT:90,IP_ADDRESS_ATTR:{ip_addresses:"IP Address",ipv4_addresses:"Host IP"},FANOUT_ACTION_NOT_SUPPORTED_MSG:"VM Actions are only available on AHV clusters with AOS versions 4.6 or later and on VMWare ESXi clusters with AOS versions 5.0 or later. In case of ESXi, some actions need the cluster to be registered to a vCenter instance.",keywords:null,hasIPaddressInTable:!1,convertClusterUuidToName:!1,navigableContextIdList:[],topHitResultType:null,topHitFilter:null,renderResults:function(e,i){this.clusterManager=n,this.keywords=i,this.$el.removeClass("no-result"),this.$(".no-result-message").remove(),this.hasResults(e)||(this.$el.addClass("no-result"),this.$el.append(t.NO_RESULT_TEMPLATE({noResultMessage:this.getNoResultMessage()}))),this.displayResults(e)},displayResults:function(e){},hasResults:function(e){return e&&e.length},getNoResultMessage:function(){return"No results found"},getResultEl:function(){return this.$(".results")},getHeaderEl:function(){return this.$(".header")},renderKeyValueView:function(e,i){var n="";return e.descriptorTypes.length>0&&_.each(e.descriptorTypes,function(s){var a=s.keyValues,r=s.title;a=this.processIPAddressForKeyValueDisplay(a),n+=t.COMMON_KEY_VALUE({title:r,keyValues:a,vIndex:i,actionRoute:e.actionRoutes})},this),n},processIPAddressForKeyValueDisplay:function(e){return _.each(e,function(e){if(_.contains(this._getIPAddressDisplayNames(),e.key)){var t=e.val;e.val=E.getDisplayIPAddresses(t)}},this),e},_getIPAddressDisplayNames:function(){var e=[];return _.each(_.keys(this.IP_ADDRESS_ATTR),function(t){e.push(this.IP_ADDRESS_ATTR[t])},this),_.uniq(e)},renderCapacityValueView:function(e,i){var n="",s=h.processRunwayNumber(e.value);return n+=t.CAPACITY_FORMAT({title:e.title,name:e.entityName,value:s,vIndex:i,actionRoute:e.actionRoute})},getEntityCountsForDisplay:function(e,t){var i=[];return _.isEmpty(e.count)||_.each(e.count,function(e){var n=t?h.getPluralEntityName(e.title):this.TOTAL_COUNT;i.push({title:n,count:e.count})},this),i},renderBarChartView:function(e,t){var i="";return _.isEmpty(e.barChartTable)||(i=this.constructTable(e.barChartTable,t)),i},getAlertTableTemplate:function(e,t){var i="";return _.isEmpty(e)||(i=this.constructAlertTable(e,t)),i},renderTableView:function(e,t){var i="",n=e.rows,s=e.maxCount;return _.isEmpty(n)||(i=this.constructTable(n,t,s)),i},constructAlertTable:function(e,i){var n=e.maxCount,s=e.tableTitle||"",a=e.rows,r=a.length,o=this.getTableHeaderOptions(s,r,n);return t.ALERT_TABLE({index:i,options:o,SVG:T,rowsInfo:a})},constructTable:function(e,i,n){var s="";return _.each(e,function(e){var a=e.rowUnits,r=e.rowData,o=e.tableTitle,l=e.isRowNavigable,c=e.isFilteredData;s+='<table class="top-hit-table">',s+=this.getTableHeaderForDisplay(o,r,n,c);var u=this;_.each(r,function(e){s+=t.COMMON_TABLE_ROW({rowData:e.rowData,vIndex:i,actionRoute:e.actionRoute,navClass:u.ACTION_EB_FILTER,unit:a,isRowNavigable:l})},i),s+="</table>"},this),s},getTableHeaderForDisplay:function(e,i,n,s){var a=i&&i.length,r=n,o={header:e||"",showCount:!1,description:""};return a&&r&&r>a?(o.description=a+" of "+r,o.showCount=!0):s&&(o.description=r?a+" of "+r:a,o.showCount=!0),t.COMMON_HEADER(o)},getActionRouteForAttr:function(e){var t;return e&&e.actions&&e.actions.length&&(t=e.actions[0]),_.escape(JSON.stringify(t||""))},getTableInfoForEntity:function(e,t,i){var n={},s=[],a=[],r=[];return _.each(e,function(e){s.push(e.columnName),r.push(e.unit),_.contains(_.keys(this.IP_ADDRESS_ATTR),e.columnName)&&(this.hasIPaddressInTable=!0),i&&(i=E.checkEntityType(i),a.push(this.getAttributeDisplayName(i,e.columnName)))},this),n.tableTitle=this.getTableTitle(a,t,i),n.rowHeaders=s,n.rowUnits=r,n},getTableHeaderOptions:function(e,t,i){var n=t,s=i,a={tableTitle:e,showCount:!1,description:""};return n&&s&&s>n&&(a.description=n+" of "+s,a.showCount=!0),a},getTableTitle:function(e,t,i){return i=E.getTranslatedEntitytype(i),t?f({attribute:this.highlightMatchedWords(e[1]||e[0]),entityType:h.getPluralEntityName(i)}):E.caseInsensitiveContains(e,"count")?A({attribute:this.highlightMatchedWords(e[0]),entityType:h.getPluralEntityName(i)}):g({attribute:this.highlightMatchedWords(e[1]||e[0]),entityType:i})},_mapColumnNameToIndex:function(e){var t={};return _.each(e,function(e,i){var n=e[this.DP.COLUMN_NAME].toLowerCase();t[n]=i},this),t},parseTableForAlerts:function(e){var t=e[this.DP.RESULT],i=t[this.DP.HEADERS],n=i&&this._mapColumnNameToIndex(i),s=e[this.DP.METADATA],a=s&&s[this.DP.FILTERS],r=s&&s[this.DP.INSTANCES],l=this.getAlertTableTitle(t),c=this.getFilterByAttributeForTable(i);this.setConvertClusterUuidToName(t);var u=[];return _.each(t.rows,function(e){var t="",i=e[this.DP.ROW_DATA],s=i[0];_.contains(_.keys(o.ALERT_IMPACT_TYPES),s)&&(s=_.first(o.ALERT_IMPACT_TYPES[s]));var l=n.critical,d=l&&i[l],h=n.warning,p=h&&i[h],T=n.info,E=T&&i[T],S={};if(S[c]=s,this.convertClusterUuidToName&&s!==this.UNKNOWN){t=s;var g=this.clusterManager.getNameById(t);s=g||this.UNKNOWN}var A=this.getActionRouteForAlertRow(S,a,r);u.push({columnData:s,actionRoute:A,critical:d,warning:p,info:E})},this),{tableTitle:l,rows:u}},getActionRouteForAlertRow:function(e,t,n){var a=E.createFilterExpressionForAlert(t,n),r=_.keys(e)[0],l=e[r],c=!_.isEmpty(_.find(t,function(e){return e[i.SEARCH.FILTER_ATTR]===i.SEARCH.ENTITY_TYPE_FILTER})),u=this.getFilterAttributeLabel(r,l,c);d.addFilterCondition(a,r,d.createFilterCondition(o.ENTITY_ALERT,r,o.FILTER_OPERATORS.EQUALS,this.getAlertCategoryFromMap(l),null,u));var h;_.each(t,function(e){e[i.SEARCH.FILTER_ATTR]===i.SEARCH.ENTITY_TYPE_FILTER&&(h=e[i.SEARCH.FILTER_VALUE])},this);var p=s.createNavigationContext(o.ENTITY_ALERT,{filter_expression:a});return this.getActionRouteForFilters(p,!0)},getFilterAttributeLabel:function(e,t,i){var s=null;return i&&(s=n.getNameById(t)||t)!==o.MULTICLUSTER_NAME&&(s=o.ENTITY_NAMES[o.ENTITY_CLUSTER]+" = "+s),s},getAlertCategoryFromMap:function(e){var t=e;return _.each(o.ALERT_IMPACT_TYPES,function(i,n){_.values(i)[0]===e&&(t=n)}),t},setConvertClusterUuidToName:function(e){var t=_.first(e[this.DP.HEADERS]),i=t&&t[this.DP.COLUMN_NAME];this.convertClusterUuidToName=i===o.ENTITY_CLUSTER},getFilterByAttributeForTable:function(e){var t=_.find(e,function(e){return e[this.DP.FILTER_NAME]},this);return t&&t[this.DP.FILTER_NAME]},getAlertTableTitle:function(e){var t=_.first(e[this.DP.HEADERS]),i=t&&t[this.DP.COLUMN_NAME];if(!i)return"";var n=E.prettifySnakeCase(i);return m({groupBy:n})},getFilterOperator:function(){return o.FILTER_OPERATORS.EQUALS},parseTableForEntity:function(e){var t,i,n=[],a={},r=e[this.DP.METADATA];r&&(i=E.checkEntityType(r.entityType));var l;if(e.format!==o.IQ_FORMAT_TYPES.TABLE)return h.log("BaseResultsView: Invalid format for the table data."),"";var c=e.result,u=c[this.DP.ENTITY_DATA],d=c[this.DP.FILTERED_DATA],p=c[this.DP.HEADERS];t=c[this.DP.MAX_COUNT];var T=this.getFilterByAttributeForTable(p),S=Boolean(T),g=this.getFilterOperator(!1),A=this.getTableInfoForEntity(p,d,i),m=A.rowHeaders;return a.tableTitle=A.tableTitle,a.isFilteredData=d,a.rowUnits=A.rowUnits,a.isRowNavigable=S,_.each(e.result.rows,function(t){var r,o={},c=t.rowData,d=E.checkForNoVal(c[0]);if(u&&(l=this.getActionRouteObjectForEntityInstance(t.rowId,e)),o.rowData=this._getRowDataForEntityTable(i,c,m),S){var h=E.createFilterExpression(i,T,g,d);_.isEmpty(this.topHitFilter)||_.extend(h,E.createFilterExpressionFromFilter(i,this.topHitFilter)),r=s.createNavigationContext(i,{filter_expression:h}),l=this.getActionRouteForFilters(r,!1)}o.actionRoute=l||"",n.push(o),a.rowData=n},this),{rows:a,maxCount:t}},_getRowDataForEntityTable:function(e,t,i){var n=[];return _.each(t,function(t,s){var a=this.getAttributeDisplayValue(e,i[s],t,!1);a?(this.hasIPaddressInTable&&(a=this.formatDisplayIPAddresses(a)),n.push(a)):n.push("-")},this),n},parseBarChartTable:function(e,t){var i={},n=[],s=t.metadata.entityType.toLowerCase();if(e.format!==o.IQ_FORMAT_TYPES.BAR_CHART)return h.log("BaseResultsView: Invalid format for the table data."),"";var a=e.result[this.DP.FILTERED_DATA],r=e.result,l=r[this.DP.HEADERS],c=_.first(l),u=c[this.DP.COLUMN_NAME],d=this.getFilterByAttributeForTable(l),p=Boolean(d),T=this.getTableInfoForEntity(l,a,s),E=r[this.DP.RANGED_DATA],S=T.rowHeaders;return i.tableTitle=T.tableTitle,i.isRowNavigable=p,_.each(r.rows,function(e){var t={};t.actionRoute="";var i=_.first(e[this.DP.ROW_DATA]);t.rowData=this._getRowDataForBarChartTable(s,e,E,S,u),p&&(t.actionRoute=this._getActionRouteForRangedData(s,i,d)),n.push(t)},this),i.rowData=n,i},_getActionRouteForRangedData:function(e,t,i){var n,a,r;t.indexOf(">")>=0?(r=o.FILTER_OPERATORS.GREATER_THAN,t=t.split(">"),n=t[1]&&t[1].trim(),a=null):(t=t.split("||"),r=o.FILTER_OPERATORS.RANGE,n=t[0]&&t[0].trim(),a=t[1]&&t[1].trim()),n=E.checkForNoVal(n),a=E.checkForNoVal(a);var l=E.createFilterExpression(e,i,r,parseFloat(n),parseFloat(a));_.isEmpty(this.topHitFilter)||_.extend(l,E.createFilterExpressionFromFilter(e,this.topHitFilter));var c=s.createNavigationContext(e,{filter_expression:l});return this.getActionRouteForFilters(c,!1)},_getRowDataForBarChartTable:function(e,t,i,n,s){var a=[];return _.each(t.rowData,function(t,r){var o=t.indexOf(this.RANGE_DATA_SEPARATOR)>=0,l=t.indexOf(">")>=0;if(i&&(o||l)){var c,u;if(o){u=t.split(this.RANGE_DATA_SEPARATOR);var d=u[0].trim();"-1"===d&&(d=0),d=this.getAttributeDisplayValue(e,s,parseInt(d));c=d+" - "+this.getAttributeDisplayValue(e,s,parseInt(u[1]))}else l&&(u=t.split(">"),c="> "+this.getAttributeDisplayValue(e,s,parseInt(u[1])));a.push(c)}else a.push(this.getAttributeDisplayValue(e,n[r],t,!1))},this),a},getActionRouteForFilters:function(e,t){this.navigableContextIdList.push(e);var i={},n=t?o.PAGE_ALERT_EXPLORER:o.PAGE_ENTITY_BROWSER;return i[o.NAV_ACTION]=o.ACTION_NAVIGATE_PAGE,i[o.NAV_PAGE_ID]=n,i[o.NAV_SUBPAGE_ID]=null,i[o.NAV_OPTIONS]={contextId:e},_.escape(JSON.stringify(i))},getActionRouteObjectForEntityInstance:function(e,t){var i={};if(i[o.NAV_ACTION]=o.ACTION_DETAILS,e&&t&&t.metadata){var n=t.metadata.entityType;n=E.checkEntityType(n),i[o.NAV_ACTION_TARGET_ID]=e,i[o.NAV_ACTION_TARGET]=n,i[o.NAV_ACTION_CONTEXT_ID]=""}return i=_.escape(JSON.stringify(i))},getActionRouteObject:function(e,t){var i={};if(i[o.NAV_ACTION]=o.ACTION_DETAILS,!_.isEmpty(e.metadata.instances)&&!_.isEmpty(t.metadata)){var n=t.metadata.entityType;n=E.checkEntityType(n),i[o.NAV_ACTION_TARGET_ID]=e.metadata.instances[0].entityId,i[o.NAV_ACTION_TARGET]=n,i[o.NAV_ACTION_CONTEXT_ID]=""}return i=_.escape(JSON.stringify(i))},getResultDisplayObject:function(e,t){return{index:t,title:e.title||"",actionRoute:this.getActionRouteForAttr(e)}},highlightMatchedWords:function(e){return E.highlightMatchedWords(e,this.keywords)},renderResult:function(e){this.getResultEl().html(e),this.applyAntiScrollForColumn(".content-fluid")},applyTmplAntiScroll:function(e){return S({results:e})},renderResultColumnWithAntiScroll:function(e){this.getResultEl().html(S({results:e})),this.applyAntiScrollForColumn()},applyAntiScrollForColumn:function(e){e=_.isUndefined(e)?this.getResultEl():this.$(e),p.applyAntiScroll(this.$(".antiscroll-wrap"),null,e.height(),{classnames:"-light -spaced"})},formatDisplayIPAddresses:function(e){var t=[];if(this.hasIPaddressInTable){var i=e.split(",");return i&&i.length&&_.each(i,function(e){e=e.split("/")[0],-1===e.indexOf(":")&&t.push(e)}),t.join(", ")}return e},checkActionSupport:function(e,t,i){var n=e[this.DP.ENTITY_METADATA_LIST],s=e[this.DP.NAME],a=this.getMetadataEntityType(n),r=this.getMetadataClusterUuid(n);return!r||(!a||a!==o.ENTITY_VM||this.isVMActionSupported(r,t,s,i))},isVMActionSupported:function(e,t,i,n){var s=!0,r=this.clusterManager.getClusterModelByClusterUuid(e);return s=r&&r.isEntityActionSupportFanout(null,o.ENTITY_VM)&&this.clusterManager.isMulticlusterNavMode(),t===o.HYPERVISOR_TYPE.ESXI&&(s=r&&r.isAmfOverEsxBasicSupported()&&this.clusterManager.isMulticlusterNavMode()&&this.isESXActionSupportedOnCurrentCluster(r,i)),this.isPCVM(n)&&(s=!1,a.isV1Admin()&&_.contains(this.ACTIONS_SUPPORTED_FOR_ADMINS,i)&&(s=!0)),s},isESXActionSupportedOnCurrentCluster:function(e,t){if(t)return!(_.indexOf(c.getActionsRequiringMgmtServerRegistration(),t.toLowerCase())>=0)||e.isManagementServerRegistered()},displayColumnCount:function(e){var t,i;_.each(e.descriptors,function(e){e.perspectives&&(i=this.getTotalEntityCount(e.perspectives),t=this.getFilteredEntityCount(e.perspectives))},this),this.updateColumnCount(t,i)},updateColumnCount:function(e,i){var n=this.getHeaderEl().find(".count")
;!_.isUndefined(e)&&e>1||!_.isUndefined(i)&&i>1?n.addClass("-visible").html(t.HEADER_COUNT({filteredCount:e,totalCount:i})):n.removeClass("-visible")},hideEntityHeaderCount:function(){var e=this.$(".count");e.empty(),e.removeClass("-visible")},getTotalEntityCount:function(e){var t=_.find(e,function(e){return e.format===o.IQ_FORMAT_TYPES.COUNT});return t&&t.result?t.result[r.DP.TOTAL_ENTITY_COUNT]:null},getFilteredEntityCount:function(e){var t=_.find(e,function(e){return e.format===o.IQ_FORMAT_TYPES.COUNT});return t&&t.result?t.result[r.DP.FILTERED_ENTITY_COUNT]:null},getAttributeDisplayName:function(e,t){e=E.checkEntityType(e);var i=l.getAttributeDisplayName(e,t);return i=h.getAttributeKey(i),i=this.checkMetricType(i)},getAttributeDisplayValue:function(e,t,i){return e=E.checkEntityType(e),l.getAttributeDisplayValue(e,t,i)||this.NO_RESULTS},getActionTitle:function(e,t,i){var n;return _.isUndefined(i)&&(i=!1),n=l.getEntityActionTitle(e,t,i)||"",_.each(this.SYNONYM_ACTION_TITLE,function(e,t){n=n.replace(t,e)},this),n},checkMetricType:function(e){return e&&(e.indexOf("_")>=0||e.indexOf(".")>=0)&&(e=E.toTitleCase(e)),e},isPCVM:function(e){var t=e&&e.vmType,i=e&&e.vmAnnotation;return t===o.VM_TYPES.PCVM||i===o.NUTANIX_PRISM_CENTRAL},getMetadataHypervisorType:function(e){if(e&&e.length){var t=e[0].additionalFields;if(!_.isEmpty(t))return t[this.DP.HYPERVISOR_TYPE]}},getMetadataVMType:function(e){if(e&&e.length){var t=e[0].additionalFields;if(!_.isEmpty(t))return t[this.DP.VM_TYPE]}},getMetadataVMAnnotation:function(e){if(e&&e.length){var t=e[0].additionalFields;if(!_.isEmpty(t))return t[this.DP.VM_ANNOTATION]}},getMetadataClusterUuid:function(e){if(e&&e.length)return e[0].clusterUuid},getMetadataEntityType:function(e){if(e&&e.length)return e[0].entityType.toLowerCase()},getMetadataEntityId:function(e){if(e&&e.length)return e[0].entityId},getMetadataEntityName:function(e){if(e&&e.length)return e[0].entityName},onResize:function(){this.applyAntiScrollForColumn()},formatSparkLine:function(e,t){_.each(e.descriptors,function(e){_.each(e.perspectives,function(e){e&&e.format===o.IQ_FORMAT_TYPES.TIME_SERIES&&_.each(e.result,function(e,i){var n=i;t=E.checkEntityType(t),i=i.replace(".","_");var s="."+i;if(!_.isEmpty(e)){var a=u.getChartColor(n),r=_.first(e),o=_.first(r[this.DP.VALUES]),l=this.getAttributeDisplayValue(t,n,o);e=this.formatResultTimeForChart(e),e=e.reverse();var c=this.$(".content-fluid").width()-40;this.renderDetailSparkLine(s,e,c,this.CHART_HEIGHT,a,!0,l)}},this)},this)},this)},renderDetailSparkLine:function(e,t,i,n,s,a,r,o){var l={top:30,right:0,bottom:0,left:0},c=n-l.top-l.bottom,u=this;if(t&&t.length){var d=d3.select(e).append("svg").attr("width",i).attr("height",n).style("width",i).style("height",n),h=new Date(t[0].time),p=new Date(t[t.length-1].time),T=d3.time.scale().domain([h,p]).nice().range([0,i]),E=d3.max(t,function(e){return parseInt(u._getTimeSeriesDataValue(e))}),S=d3.scale.linear().domain([0,E]).range([c,0]),g=d3.svg.line().interpolate("basis").x(function(e){return T(new Date(e.time))}).y(function(e){return S(u._getTimeSeriesDataValue(e))});d.append("path").attr("d",g(t)).attr("class","sparkline").attr("stroke",s[0]).attr("transform","translate(0,10)");var A=d3.svg.axis().scale(T).orient("bottom").tickValues([h,p]).tickPadding(5).outerTickSize(0).tickFormat(d3.time.format("%I:%M %p")),m=function(e){var t=-20;e.selectAll(".tick text").attr("transform","translate("+t+", 0)"),t=20,e.select(".tick text").attr("transform","translate("+t+", 0)")},f=c+10;d.append("g").attr("transform","translate(0, "+f+" )").attr("class","iq-x-axis").call(A).call(m);var I=d3.svg.area().interpolate("basis").x(function(e){return T(new Date(e.time))}).y0(c).y1(function(e){return S(u._getTimeSeriesDataValue(e))});if(a){var C=this._getFillColor(s);d.append("path").datum(t).attr("class","area").attr("d",I).style("fill",C).attr("transform","translate(0,10)")}_.isUndefined(r)||d.append("text").style("font-size","11px").attr("text-anchor","end").attr("x",.98*i).attr("y",.15*n).text(r)}},formatResultTimeForChart:function(e){return _.each(e,function(e){e.time=e.time/o.MICROS_PER_MILLI}),e},_getFillColor:function(e){var t=e[1];return e[0]===e[1]&&(t=d3.rgb(e[1]).brighter()),t},_getTimeSeriesDataValue:function(e){var t=e.values;return t&&t.length?_.first(e.values):""}})}),define("text!templates/iq/results/topresults/EntityTypeTitleTemplate.html",[],function(){return'<li class="result summary detail-row bottom-border">\n  <div class="top-title">\n    <div class="entity-type -type">\n      <span class="n-type">\n        <%= rTitle.titleInfo %>\n      </span>\n    </div>\n    <div class="entity-title-section -type -large">\n      <div class="top-hit-title col-left <%= rTitle.actionRouteClass %>"\n        title="<%= rTitle.tooltip %>">\n        <%= rTitle.title %>\n        <% _.each(entitiesCount, function(entityCount) { %>\n          <span class="entity-count count-badge -visible">\n            <%= entityCount.count %> <%= entityCount.title %>\n          </span>\n        <% }); %>\n      </div>\n    <div class="col-right">\n      <% if ( !_.isUndefined(critical) ) { %>\n        <span class="n-icon">\n          <%= SVG.SVGIcon("D", "-text critical")%>\n        </span>\n        <span class="n-count text-danger">\n          <%= critical %>\n        </span>\n      <% } %>\n      <% if (!_.isUndefined(warning) ) { %>\n        <span  class="n-icon">\n          <%= SVG.SVGIcon("D", "-text warning")%>\n        </span>\n        <span class="n-count text-warning">\n          <%= warning %>\n        </span>\n      <% } %>\n      </div>\n    <div class="col-clear"></div>\n    </div>\n  </div>\n</li>\n'}),define("text!templates/iq/results/topresults/EntityInstanceTitleTemplate.html",[],function(){return'<li class="result summary detail-row bottom-border">\n  <div class="top-title">\n    <div class="entity-type">\n      <div class="n-type col-left entityTitle">\n        <%= rTitle.titleInfo %>\n      </div>\n      <div class="col-right n-entity-instance">\n        <% if ( !_.isUndefined(critical) ) { %>\n          <span class="n-icon">\n            <%= SVG.SVGIcon("D", "-text critical")%>\n          </span>\n          <span class="n-count text-danger">\n            <%= critical %>\n          </span>\n        <% } %>\n        <% if ( !_.isUndefined(warning) ) { %>\n          <span  class="n-icon">\n            <%= SVG.SVGIcon("D", "-text warning")%>\n          </span>\n          <span class="n-count text-warning">\n            <%= warning %>\n          </span>\n        <% } %>\n      </div>\n      <div class="col-clear"></div>\n    </div>\n    <div class="entity-title-section -instance">\n      <div class="col-left n-entity-instance <%= rTitle.actionRouteClass %>"\n        title="<%= rTitle.tooltip %>">\n        <div class="top-hit-title n-entity-instance -small">\n          <%= rTitle.title %>\n        </div>\n        <% _.each(entitiesCount, function(entityCount) { %>\n          <span class="entity-count count-badge -visible">\n            <%= entityCount.count %> <%= entityCount.title %>\n          </span>\n        <% }); %>\n      </div>\n    </div>\n  </div>\n</li>\n'}),define("text!templates/iq/results/topresults/AlertTitleTemplate.html",[],function(){return'<li class="result summary detail-row bottom-border ">\n  <div class="top-title">\n\n    \x3c!-- Alert bells --\x3e\n    <div class="alert-top-title-section -large">\n      <div class="col-left top-title">\n        Alerts\n      </div>\n      <div class="col-right alert-icons">\n        <% if ( !_.isUndefined(critical) ) { %>\n          <span class="n-icon">\n            <%= SVG.SVGIcon("D", "-text critical")%>\n          </span>\n          <span class="n-count text-danger">\n            <%= critical %>\n          </span>\n        <% } %>\n        <% if (!_.isUndefined(warning) ) { %>\n          <span  class="n-icon">\n            <%= SVG.SVGIcon("D", "-text warning")%>\n          </span>\n          <span class="n-count text-warning">\n            <%= warning %>\n          </span>\n        <% } %>\n        <% if ( !_.isUndefined(info) ) { %>\n          <span class="n-icon">\n            <%= SVG.SVGIcon("D", "-text info")%>\n          </span>\n          <span class="n-count text-info">\n            <%= info %>\n          </span>\n        <% } %>\n      </div>\n      <div class="col-clear"></div>\n    </div>\n\n    \x3c!-- Alert Titles --\x3e\n    <% if (titles && titles.length) { %>\n    <div class="title-section">\n      <div class="match-criteria">Matched alert policies</div>\n      <div class="alert-titles detail-row-unclickable">\n        <% _.each(titles, function(title) { %>\n        <div><%= title %></div>\n        <% }); %>\n      </div>\n    </div>\n    <% } %>\n\n    <div class="alert-info-container">\n      <div class="match-criteria">Matched criteria</div>\n      \x3c!-- Entity Type --\x3e\n      <div class="alert-entity-type key-value">\n        <div class="keyword-row">Entity Type</div>\n        <div class="result-row"><%= alertInfo.entityType %></div>\n      </div>\n\n      \x3c!-- Entity Name --\x3e\n      <% if (alertInfo.entityName) { %>\n      <div class="alert-entity-name key-value">\n        <div class="keyword-row">Entity Name</div>\n        <div class="result-row <%= rTitle.actionRouteClass %>"\n             title="<%= rTitle.tooltip %>"\n             actionRoute="<%= rTitle.actionRoute %>">\n          <%= alertInfo.entityName %>\n        </div>\n      </div>\n      <% } %>\n\n      \x3c!-- Category --\x3e\n      <% if (categories) { %>\n      <div class="alert-category key-value">\n        <div class="keyword-row">Impact Type</div>\n        <div class="result-row" title="<%= categories %>">\n          <%= categories %>\n        </div>\n      </div>\n      <% } %>\n\n      \x3c!-- Status --\x3e\n      <% if (status) { %>\n      <div class="alert-status key-value">\n        <div class="keyword-row">Status</div>\n        <div class="result-row"><%= status %></div>\n      </div>\n      <% } %>\n    </div>\n\n\n  </div>\n</li>'}),define("views/iq/results/TopResultView",["views/iq/results/BaseResultsView","managers/NavigationManager","data/DataProperties","utils/AppConstants","utils/AppUtil","utils/SVG","utils/IQUtil","utils/AlertUtil","text!templates/iq/results/topresults/EntityTypeTitleTemplate.html","text!templates/iq/results/topresults/EntityInstanceTitleTemplate.html","text!templates/iq/results/topresults/AlertTitleTemplate.html"],function(e,t,i,n,s,a,r,o,l,c,u){"use strict";var d=_.template(l),h=_.template(c),p=_.template(u),T=_.template('<li class="focusable result detail-row -thin top-hit-chart" vIndex="<%=vIndex%>"><div class="title"><%= chartTitle %></div><div class="row-3 <%= chartCssId %>" id="top-graph"></div></li>'),E=_.template('<div><button class="focusable result actionBtn btn -wide <%= index > 0 ? "" : "-blue" %> " vIndex="<%=vIndex%>" actionRoute="<%=route.actionRoute%>"><%= route.action %></button></div>'),S=_.template('<div class="btn-wrapper"><button class="focusable result actionBtn btn -inline" vIndex="<%=vIndex%>" actionRoute="<%= route.actionRoute %>" ><%= route.action %></button></div>'),g=_.template('<tr><td><ul class="column"><%= template %></ul></td></tr>'),A=_.template("<tr><td><%= template %></td></tr>"),m=_.template('Explore <%= label || "" %>');_.template("<%= title %>");return e.extend({numActionButtons:2,hasIPAddresses:!1,entityType:null,entityTitle:null,NUM_SINGLE_ACTION_DISPLAY:2,ENTITY_TYPE:"Entity type",WARNING_COUNT:"warningCount",CRITICAL_COUNT:"criticalCount",INFO_COUNT:"infoCount",ENTITY_ALERT:"Alerts",IS_ENTITY_INSTANCE:null,displayResults:function(e){this.clearNavigationContexts();var t,i,n=this.getResultDisplayObject(e),s=0,a='<table class="fixed-fluid">';t=this.renderTopHitTitle(e,n),_.isEmpty(t)||(a+=g({template:t}),s++),a+="<tr><td>",a+='<div class="content-wrapper"><div class="content-fluid">',i='<ul class="column">',t=this.renderKeyValueView(n,s,this.hasIPAddresses),_.isEmpty(t)||(i+=t,s++),n.tables&&_.each(n.tables,function(e){i+=this.renderTableView(e,s),s++},this),n.alertTables&&_.each(n.alertTables,function(e){i+=this.getAlertTableTemplate(e,s),s++},this),n.capacity&&_.each(n.capacity,function(e){i+=this.renderCapacityValueView(e,s),s++},this),i+=this.renderBarChartView(n,s),!0===this.timeSeries&&(i+=this.renderTimeSeriesChartContainer(e,s)),i+="</ul>",a+=this.applyTmplAntiScroll(i),a+="</div></div>",a+="</td></tr>";var r=this.renderActionsView(n,s);a+=A({template:r}),a+="</table>",this.renderResult(a),this.timeSeries&&this.formatSparkLine(e,this.entityType),this.attachActionBtnTooltip()},clearNavigationContexts:function(){_.isEmpty(this.navigableContextIdList)||_.each(this.navigableContextIdList,function(e){t.clearNavigationContext(e)}),this.navigableContextIdList=[]},attachActionBtnTooltip:function(){var e=this.$(".iq-action-buttons .actionBtn:disabled");_.isEmpty(e)||_.each(e,function(e){$(e).parent().tooltip({title:this.FANOUT_ACTION_NOT_SUPPORTED_MSG,placement:"right",trigger:"hover",html:!0,container:$("body")})},this)},renderTimeSeriesChartContainer:function(e,t){var i="",s=this;return _.each(e.descriptors,function(e){_.each(e.perspectives,function(e){e&&e.format===n.IQ_FORMAT_TYPES.TIME_SERIES&&_.each(e.result,function(e,n){var a=r.checkEntityType(s.entityType),o=s.getAttributeDisplayName(a,n);n=n.replace(".","_"),i+=T({vIndex:t,chartTitle:o,chartCssId:n}),t++})})}),i},hasResults:function(e){return Boolean(e.descriptors&&e.metadata)},renderTopHitTitle:function(e,t){var i="",n=e.metadata;return this.topHitResultType===this.RESULT_TYPE.ENTITIES||this.topHitResultType===this.RESULT_TYPE.ACTION?i=this._getResultTitleForEntities(n,t):this.topHitResultType===this.RESULT_TYPE.ALERTS&&(i=this._getResultTitleForAlerts(n,t)),i},getHealthSummary:function(e){var t,n,s={};return _.isUndefined(e[i.ALERT_SUMMARY])?_.isUndefined(e[i.HEALTH_SUMMARY])||(n=i.HEALTH_STATUS_VALUES,t=e.healthSummary):(n=i.ALERT_STATUS_VALUES,t=e[i.ALERT_SUMMARY]),s[this.WARNING_COUNT]=t?t[n.WARNING]:null,s[this.CRITICAL_COUNT]=t?t[n.CRITICAL]:null,s[this.INFO_COUNT]=t?t[n.INFO]:null,s},renderActionsView:function(e,t){var i="",n=e.actionRoutes.action;if(n&&n.length){if(e.resultType===this.RESULT_TYPE.ACTION&&(n[0]=n.splice(1,1,n[0])[0]),i='<div class="iq-action-buttons">',n.length<=this.NUM_SINGLE_ACTION_DISPLAY)_.each(n,function(e,n){i+=E({route:e,vIndex:t++,index:n})},this);else{var s=n[0];i+=E({route:s,vIndex:t++,index:0}),n.shift(),_.each(n,function(e){i+=S({route:e,vIndex:t++})},this)}i+="</div>"}return i},getResultDisplayObject:function(e){var t={};t.actionRoutes={},t.keyValues=[],t.count=[],t.healthSummary={},t.descriptorTypes=[],t.timeSeries={},t.tables=[],t.capacity=[];var i,s,a=[],r=[],o=[],l=!1,c=[],u=[];if(this.timeSeries=!1,this.entityType="",this.topHitFilter=[],e.metadata&&e.metadata.entityType&&(this.entityType=e.metadata.entityType.toLowerCase()),e.metadata&&e.metadata.title&&(this.entityTitle=e.metadata.title.toLowerCase()),this.topHitResultType=e.resultType,e.metadata&&e.metadata.filters&&(this.topHitFilter=e.metadata.filters),e.descriptors&&e.descriptors.length&&_.each(e.descriptors,function(d){c=[],_.each(d.perspectives,function(i){var h=this._getResultEntityType(i);if(i&&i.type===n.IQ_PERSPECTIVE_TYPES.ENTITY&&i.result){if(i.format===n.IQ_FORMAT_TYPES.KEY_VALUE)_.each(i.result,function(e,t){if(_.contains(_.keys(this.IP_ADDRESS_ATTR),t)&&(this.hasIPAddresses=!0),t.indexOf(":")>0){t=t.split(":")[1]}c.push({key:this.getAttributeDisplayName(h,t),val:this.getAttributeDisplayValue(h,t,e)})},this),t.actionRoutes.keyValue=this.getActionRouteObject(i,e);else if(i.format===n.IQ_FORMAT_TYPES.TIME_SERIES){var p=_.keys(i.result)[0];_.isEmpty(i.result[p])||(this.timeSeries=!0,t.timeSeries.chartTitle=this.getAttributeDisplayName(h,p))}else if(i.format===n.IQ_FORMAT_TYPES.TABLE){var T=this._getTableForEntity(i);_.isEmpty(T)||a.push(T)}else if(i.format===n.IQ_FORMAT_TYPES.BAR_CHART){var E=this.parseBarChartTable(i,e);E&&r.push(E)}else if(i.format===n.IQ_FORMAT_TYPES.COUNT){var S=this._getResultCount(i);t.count.push(S)}else if(i.format===n.IQ_FORMAT_TYPES.HEALTH_SUMMARY)t.healthSummary=i.result.healthSummary;else if(i.format===n.IQ_FORMAT_TYPES.CAPACITY){var g=this._getCapacityInfo(i,d);t.capacity.push(g)}}else if(i&&i.type===n.IQ_PERSPECTIVE_TYPES.ACTION){l=!0;var A=i.result;_.each(A,function(e,t){var i=e[this.DP.ENTITY_METADATA_LIST],n=e[this.DP.NAME],a=this.getMetadataHypervisorType(i),r=this.getMetadataVMType(i),o=this.getMetadataVMAnnotation(i),l={vmAnnotation:o,vmType:r};if(this.checkActionSupport(e,a,l)&&!_.isNull(i)&&u.length<this.numActionButtons){var c=this._getActionRouteObject(e,t);_.extend(c,{hypervisorType:a,actionName:n}),u.push(c)}s||(s=this.getActionRoute(e,!1))},this)}else if(i&&i.type===n.IQ_PERSPECTIVE_TYPES.ALERT)if(i.format===n.IQ_FORMAT_TYPES.OTHER){var m=i.result;t.alertSummary=this._getAlertSummary(m)}else if(i.format===n.IQ_FORMAT_TYPES.TABLE){var f=this.parseTableForAlerts(i);_.isEmpty(f[this.DP.ROWS])||o.push(f)}},this),i=this._getTitle(d),l||_.isEmpty(c)||t.descriptorTypes.push({title:this.highlightMatchedWords(i),keyValues:c})},this),t){t.tables=a,t.barChartTable=r,t.alertTables=o;var d=this._getExploreAction(s,e);d&&(u=[d].concat(u)),t.actionRoutes.action=u}return t},getActionRouteObjectForEntityInstanceInTitle:function(e,t){var i={};if(i[n.NAV_ACTION]=n.ACTION_DETAILS,e&&!_.isEmpty(t)&&!_.isEmpty(t.instances)){var s=t.instances[0].entityType;s=r.checkEntityType(s),i[n.NAV_ACTION_TARGET_ID]=e,i[n.NAV_ACTION_TARGET]=s}return i=_.escape(JSON.stringify(i))},getActionRoute:function(e,t){var i={},s=e.entityMetadataList;return i[n.NAV_ACTION]=e.name,i[n.NAV_ACTION_TARGET_ID]=this.getMetadataEntityId(s),i[n.NAV_ACTION_TARGET]=this.getMetadataEntityType(s),i[this.DP.METADATA_CLUSTER_UUID]=this.getMetadataClusterUuid(s),_.isUndefined(t)?_.escape(JSON.stringify(i||"")):i},getExploreEntityInstanceMetadata:function(e){var t={};return e.metadata&&e.metadata.instances&&(t=_.first(e.metadata.instances)),t},_getResultTitleForAlerts:function(e,t){var i=this.getHealthSummary(t),n=this._getAlertInfo(e),s=this._getResultTitleObject(e,t);return p(this.vtOptions({rTitle:s,alertInfo:n,titles:n.titles,status:this._getAlertStatus(n),categories:this._getAlertCategories(n.categories),warning:i[this.WARNING_COUNT],critical:i[this.CRITICAL_COUNT],info:i[this.INFO_COUNT]}))},_getAlertCategories:function(e){return e.join(", ")},_getAlertStatus:function(e){var t="",i=e.resolution,n=e.acknowledgment;return(i.length<=1||n.length<=1)&&(t=i.concat(n)),t.toString()},_getAlertInfo:function(e){var t={};t.titles=[],t.categories=[],t.resolution=[],t.acknowledgment=[];var a=e[this.DP.FILTERS],l=e[this.DP.INSTANCES];return _.each(a,function(e){var a=e[i.SEARCH.FILTER_ATTR],c=e[i.SEARCH.FILTER_VALUE];if(a===i.SEARCH.ENTITY_TYPE_FILTER){var u=r.getTranslatedEntitytype(c);t.entityType=s.toUpperCaseFirstChar(u)}else if(a===i.SEARCH.ENTITY_ID_FILTER){var d=r._getEntityInfoById(l,c);t.entityName=d&&d[i.SEARCH.ENTITY_NAME]}else if(a===i.SEARCH.ALERT_ID_FILTER){var h=c,p=o.getAlertTypeMetadata(h);p&&p.title&&t.titles.push(p.title)}else if(a===i.SEARCH.ALERT_IMPACT_TYPE)t.categories.push(c);else if(a===i.ALERT_RESOLVED){var T=[];c===n.ALERT_RESOLVED.MANUAL||c===n.ALERT_RESOLVED.AUTO?T.push(this.ALERT_STATUS.RESOLVED):"false"===c&&T.push(this.ALERT_STATUS.UNRESOLVED),t.resolution=_.uniq(T)}else a===i.ALERT_ACKNOWLEDGED&&("true"===c?t.acknowledgment.push(this.ALERT_STATUS.ACKNOWLEDGED):"false"===c&&t.acknowledgment.push(this.ALERT_STATUS.UNACKNOWLEDGED))},this),t},_getResultTitleForEntities:function(e,t){var i="",n=this.getHealthSummary(t),s=this._getResultTitleObject(e,t),r={rTitle:s,entitiesCount:s.entityCount||[],warning:n[this.WARNING_COUNT],critical:n[this.CRITICAL_COUNT],SVG:a};return _.isEmpty(s.titleInfo)||(i=this.IS_ENTITY_INSTANCE?h(r):d(r)),i},_getResultTitleObject:function(e,t){var i,n={};if(e.instances&&!_.isEmpty(e.instances)){var s,a=_.first(e.instances),o=a.entityId;n.actionRoute=this.getActionRouteObjectForEntityInstanceInTitle(o,e),n.actionRouteClass=this.ACTION_ROUTE_CLASS,s=r.toTitleCase(e.entityType),s=r.getTranslatedEntitytype(s),n.titleInfo=this.highlightMatchedWords(s),i=e.title,n.tooltip=i,n.title=this.highlightMatchedWords(i),this.IS_ENTITY_INSTANCE=!0}else{n[this.DP.ACTION_ROUTE_CLASS]="",n[this.DP.ACTION_ROUTE]="",n[this.DP.TITLE_INFO]=this.ENTITY_TYPE;var l=e.entityType;l=r.getTranslatedEntitytype(l),i=r.toTitleCase(l);var c=i;n[this.DP.TOOLTIP]=c,i=this.highlightMatchedWords(i),n[this.DP.TITLE]=i,this.IS_ENTITY_INSTANCE=!1}return n.entityCount=this.getEntityCountsForDisplay(t,this.IS_ENTITY_INSTANCE),n},_getCapacityInfo:function(e,t){var i=e.result,n=i[this.DP.ROWS],s=t.metadata,a=s[this.DP.TITLE],r=this._getLeastRunwayEntity(n),o=r[this.DP.ROW_DATA],l=r[this.DP.ROW_ID],c=this.getActionRouteObjectForEntityInstance(l,e);return{title:a,entityName:o[0],value:o[1],entityId:l,actionRoute:c}},_getTitle:function(e){return null===e.metadata?"":e.metadata.title},_getResultEntityType:function(e){return _.isEmpty(e.metadata&&e.metadata.entityType)?this.entityType:e.metadata.entityType.toLowerCase()},_getTableForEntity:function(e){var t={},i=this.parseTableForEntity(e),n=[];return i&&n.push(i.rows),t.rows=n,t.maxCount=i.maxCount,t},_getAlertSummary:function(e){var t={};return _.each(e.alertSummaries,function(i,n){var s=e.alertSummaries[n],a=s.metadata.grandTotalEntities;t[n]=a},this),t},_getResultCount:function(e){var t,i=e.result;t=_.keys(i).length>1?this.DP.FILTERED_ENTITY_COUNT:this.DP.TOTAL_ENTITY_COUNT;var n=this._getResultEntityType(e),s=r.toTitleCase(n);return{count:i&&i[t],title:s}},_getLeastRunwayEntity:function(e){return e.sort(function(e,t){var i=e.rowData[1],n=t.rowData[1];return s.sortRunwayNumbers(i,n)})[0]},_getActionRouteObject:function(e,t){var i={};i.index=t;var s=e[this.DP.ENTITY_METADATA_LIST][0],a=s.entityType.toLowerCase(),o=s.entityName;i.action=this.getActionTitle(a,e.name,!1),o?a!==n.ENTITY_CLUSTER&&(i.name=r.toTitleCase(name)):a===n.ENTITY_VM?i.name=a.toUpperCase():i.name=r.toTitleCase(a),i.actionRoute=this.getActionRoute(e);var l=this.getActionRoute(e,!1);return i.clusterUuid=l[this.DP.METADATA_CLUSTER_UUID],i},_getExploreAction:function(e,t){if(!this.entityType)return null;var i={};if(e&&(i=this._buildExploreAction(e)),_.isEmpty(i)){var n=t[this.DP.METADATA],s=n[this.DP.FILTERS],a=this.getExploreEntityInstanceMetadata(t);if(s&&s.length){if(this.topHitResultType===this.RESULT_TYPE.ENTITIES)i=this._getExploreActionForFilteredEntities(s);else if(this.topHitResultType===this.RESULT_TYPE.ALERTS){var r=n[this.DP.INSTANCES];i=this._getExploreActionForFilteredAlerts(s,r)}}else i=_.isEmpty(a)?this._getGenericExploreAction():this._getExploreActionForEntityInstance(a)}return _.isEmpty(i)||(i.actionRoute=_.escape(JSON.stringify(i.actionRoute||""))),i},_getExploreActionForEntityInstance:function(e){var t={};return t[n.NAV_ACTION_TARGET_ID]=e.entityId,t[n.NAV_ACTION_TARGET]=r.checkEntityType(e.entityType),this._buildExploreAction(t)},_getExploreActionForFilteredAlerts:function(e,i){var s={};s.action=this._getExploreActionLabel("Filtered Alerts");var a=r.createFilterExpressionForAlert(e,i),o=t.createNavigationContext(n.ENTITY_ALERT,{filter_expression:a});return s.actionRoute={pageId:n.PAGE_ALERT_EXPLORER,action:n.ACTION_NAVIGATE_PAGE,options:{contextId:o}},s},_getExploreActionForFilteredEntities:function(e){var i={},a="Filtered "+s.getPluralEntityName(this.entityType);i.action=this._getExploreActionLabel(a);var o=r.checkEntityType(this.entityType),l=r.createFilterExpressionFromFilter(o,e),c=t.createNavigationContext(o,{filter_expression:l});return i.actionRoute={pageId:n.PAGE_ENTITY_BROWSER,action:n.ACTION_NAVIGATE_PAGE,options:{contextId:c}},i},_getGenericExploreAction:function(){var e={},i=s.getPluralEntityName(this.entityType);e.action=this._getExploreActionLabel(i);var a=r.checkEntityType(this.entityType),o={entity_type:a,filter_expression:{}},l=t.createNavigationContext(a,o);return e.actionRoute={pageId:n.PAGE_ENTITY_BROWSER,action:n.ACTION_NAVIGATE_PAGE,options:{contextId:l}},e},_buildExploreAction:function(e){var t={},i=e[n.NAV_ACTION_TARGET_ID],s=e[n.NAV_ACTION_TARGET];if(i){var a=r.checkEntityType(this.entityTitle);t.action=this._getExploreActionLabel(a),t.actionRoute={action:n.ACTION_DETAILS,actionTargetId:i,actionTarget:s,contextId:""}}return t},_getExploreActionLabel:function(e){return m({label:e})},destroy:function(){this.$(".iq-action-buttons .actionBtn").tooltip("destroy")},onResize:function(){this.applyAntiScrollForColumn(".content-fluid")}})}),define("views/iq/results/ActionsResultsView",["views/iq/results/BaseResultsView","utils/AppConstants","utils/IQUtil"],function(e,t,i){"use strict";var n=_.template('<li class="focusable detail-row action-detail" vIndex="<%= index %>" actionRoute="<%= actionRoute %>"><%= action %> <% if(name) {%><%=name %><% } %></li>');return e.extend({numActionResultsDisplayed:0,sortActionResults:function(e){var t=[],i=[];return _.each(e,function(e){t.push(this.getResultDisplayObject(e))},this),t=_.groupBy(t,"sortName"),_.each(t,function(e,t){var n=_.sortBy(e,"action");i.push(n)}),i=_.flatten(i,!0),this.numActionResultsDisplayed=i.length,i},displayResults:function(e){var t='<ul class="column">',i=this.parseResults(e),s=this.sortActionResults(i);_.each(s,function(e,i){t+=n({action:e.action,name:e.name,index:i,actionRoute:e.actionRoute})},this),t+="</ul>",this.renderResultColumnWithAntiScroll(t),i&&i.length?this.displayColumnCount(e):this.hideEntityHeaderCount()},displayColumnCount:function(e){var t=this.numActionResultsDisplayed;this.updateColumnCount(null,t)},getNoResultMessage:function(){return"No actions found"},parseResults:function(e){var t=[],i=this;return _.each(e,function(e){e.descriptors&&e.descriptors.length&&_.each(e.descriptors,function(e){_.each(e.perspectives,function(e){var n=e.result[0],s=n[i.DP.ENTITY_METADATA_LIST],a=i.getMetadataHypervisorType(s),r=i.getMetadataVMType(s),o=i.getMetadataVMAnnotation(s),l={vmAnnotation:o,vmType:r};i.checkActionSupport(n,a,l)&&t.push(n)})})}),t},getResultDisplayObject:function(e){var n={},s=e.entityMetadataList,a=this.getMetadataEntityType(s),r=this.getMetadataEntityName(s);return n.action=this.getActionTitle(a,e.name,!0),r?n.name=r:a===t.ENTITY_VM?n.name=a.toUpperCase():n.name=i.toTitleCase(a),n.sortName=n.name,n.name=this.highlightMatchedWords(n.name),n.action=this.highlightMatchedWords(n.action),n.actionRoute=this.getActionRoute(e),n},getTotalActionCount:function(e){var i=0;return _.each(e,function(e){_.each(e.descriptors,function(e){_.each(e.perspectives,function(e){e.type===t.IQ_PERSPECTIVE_TYPES.ACTION&&i++},this)},this)},this),i},getActionRoute:function(e){var i={},n=e.entityMetadataList;return i[t.NAV_ACTION]=e.name,i[t.NAV_ACTION_TARGET_ID]=this.getMetadataEntityId(n),i[t.NAV_ACTION_TARGET]=this.getMetadataEntityType(n),i[this.DP.METADATA_CLUSTER_UUID]=this.getMetadataClusterUuid(n),_.escape(JSON.stringify(i||""))}})}),define("views/iq/results/EntityResultsView",["views/iq/results/BaseResultsView","utils/AppConstants","utils/IQUtil"],function(e,t,i){"use strict";var n=_.template('<li class="focusable result detail-row" vIndex="<%=index%>" actionRoute="<%=actionRoute%>"><div class="key-value entity-detail"><div class="keyword-row"><%= entityName %></div><div class="result-row"><%= entityType %></div><% if (isHint) { %><div class="hint"><%= contextHintField + " : " + contextHintValue %></div><% } %></div></li>');return e.extend({displayResults:function(e){var t='<ul class="column">';_.each(e,function(e,i){var s=this.getResultDisplayObject(e,i);_.each(s,function(e){_.isEmpty(s)||(t+=n(e))},this)},this),t+="</ul>",this.renderResultColumnWithAntiScroll(t),e&&e.length?this.displayColumnCount(e[0]):this.hideEntityHeaderCount()},getNoResultMessage:function(){return"No entities found"},getResultDisplayObject:function(e,i){var n=[];return _.each(e.descriptors,function(e){var s={};e.metadata&&_.each(e.metadata.instances,function(e){s.index=i,this.entityType=e.entityType.toLowerCase(),s.entityType=this.highlightMatchedWords(t.ENTITY_NAMES[this.entityType]),s.entityName=this.highlightMatchedWords(e.entityName),s.actionRoute=this.getActionRouteObject(e),s.contextHintField=this.getAttributeDisplayName(this.entityType,e.contextHintField),s.contextHintValue=this.highlightMatchedWords(e.contextHintValue),s.isHint=!_.isUndefined(e.contextHintValue),n.push(s)},this),i++},this),n},getActionRouteObject:function(e){var n={};return n[t.NAV_ACTION]=t.ACTION_DETAILS,e&&(n[t.NAV_ACTION_TARGET_ID]=e.entityId,n[t.NAV_ACTION_TARGET]=i.checkEntityType(this.entityType),n.contextId=""),n=_.escape(JSON.stringify(n))}},null)}),define("views/iq/results/AlertsResultsView",["views/iq/results/BaseResultsView","data/DataProperties","utils/TimeUtil","utils/AlertUtil","utils/IQUtil","utils/AppConstants"],function(e,t,i,n,s,a){"use strict";var r=_.template('<li class="focusable result detail-row" vIndex="<%= index %>" actionRoute="<%= actionRoute %>"><div class="header-severity"> <div class="circle-alert-icon <%= severity %>"></div><div class="timestamp"><%= timeStamp %></div><div class="alert-entity-type" title="<%= entityType%>"><%= entityType %></div></div><div class="header-message"><%= message %></div></li>'),o={GRAND_TOTAL_ENTITIES:"grandTotalEntities",TOTAL_ENTITIES:"totalEntities"};return e.extend({NUM_ENTITIES_SHOW:2,displayResults:function(e){var t='<ul class="column">',i=this.parseResults(e);_.each(i,function(e,i){e.index=i,t+=r(this.getResultDisplayObject(e,i))},this),t+="</ul>",this.renderResultColumnWithAntiScroll(t),i&&i.length?this.displayColumnCount(e,i.length):this.hideEntityHeaderCount()},displayColumnCount:function(e,t){var i=this.getTotalAlertCount(e);this.updateColumnCount(t,i)},hasResults:function(e){var t=this.parseResults(e);return t&&t.length},getNoResultMessage:function(){return"No alerts found"},parseResults:function(e){var t=[];return _.each(e,function(e){_.each(e.descriptors,function(e){_.each(e.perspectives,function(e){if(e.type===a.IQ_PERSPECTIVE_TYPES.ALERT){var i=e.result.alertSummaries;_.each(i,function(e,i,n){t=t.concat(e.entities)},this)}},this)},this)},this),t},getTotalAlertCount:function(e){var t=0;return _.each(e,function(e){_.each(e.descriptors,function(e){_.each(e.perspectives,function(e){if(e.type===a.IQ_PERSPECTIVE_TYPES.ALERT){var i=e.result.alertSummaries;_.each(i,function(e,i,n){var s=e.metadata,a=s[o.GRAND_TOTAL_ENTITIES];t+=a},this)}},this)},this)},this),t},getResultDisplayObject:function(e,t){var i={};i.index=t,i.timeStamp=this.getTimeStamp(e);var s=this.getMessage(e);return i.message=n.formatIssue(s,e),i.severity=this.getSeverity(e),i.actionRoute=this.getActionRoute(e),i.entityType=this.getAlertEntityType(e),i},getActionRoute:function(e){var t={};return t[a.NAV_ACTION]=a.ACTION_DETAILS,t[a.NAV_ACTION_TARGET_ID]=e.id,t[a.NAV_ACTION_TARGET]=a.ENTITY_ALERT,t.contextId="",t[a.NAV_TARGET_TAB_ID]=a.FULLPAGE_ALERT_DETAILS,_.escape(JSON.stringify(t||""))},getTimeStamp:function(e){var t=e.createdTimeStampInUsecs/1e3;return i.formatDateTime(t)},getMessage:function(e){return e[t.ALERT_TITLE]||e[t.ALERT_MESSAGE]},getSeverity:function(e){return e.severity},getAlertEntityType:function(e){for(var t=[],i=e.entityTypes&&e.entityTypes.length,n=_.min([this.NUM_ENTITIES_SHOW,i]),a=0;a<n;a++){var r=e.entityTypes[a];r=s.toTitleCase(r),r&&t.push(r)}return t=t.length>1?t.join():t[0]}})}),define("views/iq/results/KBResultsView",["views/iq/results/BaseResultsView","utils/AppConstants"],function(e,t){"use strict";var i=_.template('<li class="focusable detail-row" vIndex="<%= index %>" actionRoute="<%=actionRoute%>"><div class="ancestor-title"><%= ancestorTitle %></div><div class="title"><%= title %></div></li>');return e.extend({TITLE_WEB_CONSOLE:"Web Console Guide",displayResults:function(e){var t='<ul class="column">';_.each(e,function(e,n){var s=this.getResultDisplayObject(e,n);_.isEmpty(s)||(t+=i(s))},this),t+="</ul>",
this.renderResultColumnWithAntiScroll(t),e&&e.length?this.displayColumnCount(e.length):this.hideEntityHeaderCount()},displayColumnCount:function(e){this.updateColumnCount(null,e)},getNoResultMessage:function(){return"No help found"},getResultDisplayObject:function(e,i){var n={};if(!_.isNull(e.descriptors)&&!_.isNull(e.descriptors[0].perspectives)&&e.descriptors[0].perspectives[0].type===t.IQ_PERSPECTIVE_TYPES.HELP){n.ancestorTitle="";var s=e.descriptors[0].perspectives[0].result,a=_.size(s.ancestorTitles);_.each(s.ancestorTitles,function(e,t){e!==this.TITLE_WEB_CONSOLE&&a>1&&(n.ancestorTitle+=e,t!==a-1&&(n.ancestorTitle+=" > "))},this),n.index=i,n.ancestorTitle=this.highlightMatchedWords(n.ancestorTitle),n.title=this.highlightMatchedWords(s.title),n.actionRoute=this.getActionRouteObject(s.url,_.first(s.ancestorUrls),!0)}return n},getActionRouteObject:function(e,i,n){var s={},a="https://portal.nutanix.com/#/page/docs/details?targetId="+i+":";return s[t.NAV_ACTION]=t.ACTION_NAVIGATE_URL,s[t.NAV_ACTION_TARGET]=a+e,s.isNewWindow=n,_.escape(JSON.stringify(s))}})}),function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define("d3-array",["exports"],t):t(e.d3=e.d3||{})}(this,function(e){"use strict";function t(e){return function(t,i){return a(e(t),i)}}function i(e,t){return[e,t]}function n(e,t,i){var n=Math.abs(t-e)/Math.max(0,i),s=Math.pow(10,Math.floor(Math.log(n)/Math.LN10)),a=n/s;return a>=C?s*=10:a>=v?s*=5:a>=R&&(s*=2),t<e?-s:s}function s(e){return e.length}var a=function(e,t){return e<t?-1:e>t?1:e>=t?0:NaN},r=function(e){return 1===e.length&&(e=t(e)),{left:function(t,i,n,s){for(null==n&&(n=0),null==s&&(s=t.length);n<s;){var a=n+s>>>1;e(t[a],i)<0?n=a+1:s=a}return n},right:function(t,i,n,s){for(null==n&&(n=0),null==s&&(s=t.length);n<s;){var a=n+s>>>1;e(t[a],i)>0?s=a:n=a+1}return n}}},o=r(a),l=o.right,c=o.left,u=function(e,t){null==t&&(t=i);for(var n=0,s=e.length-1,a=e[0],r=new Array(s<0?0:s);n<s;)r[n]=t(a,a=e[++n]);return r},d=function(e,t,n){var s,a,r,o,l=e.length,c=t.length,u=new Array(l*c);for(null==n&&(n=i),s=r=0;s<l;++s)for(o=e[s],a=0;a<c;++a,++r)u[r]=n(o,t[a]);return u},h=function(e,t){return t<e?-1:t>e?1:t>=e?0:NaN},p=function(e){return null===e?NaN:+e},_=function(e,t){var i,n,s=e.length,a=0,r=0,o=-1,l=0;if(null==t)for(;++o<s;)isNaN(i=p(e[o]))||(n=i-a,a+=n/++l,r+=n*(i-a));else for(;++o<s;)isNaN(i=p(t(e[o],o,e)))||(n=i-a,a+=n/++l,r+=n*(i-a));if(l>1)return r/(l-1)},T=function(e,t){var i=_(e,t);return i?Math.sqrt(i):i},E=function(e,t){var i,n,s,a=-1,r=e.length;if(null==t){for(;++a<r;)if(null!=(n=e[a])&&n>=n){i=s=n;break}for(;++a<r;)null!=(n=e[a])&&(i>n&&(i=n),s<n&&(s=n))}else{for(;++a<r;)if(null!=(n=t(e[a],a,e))&&n>=n){i=s=n;break}for(;++a<r;)null!=(n=t(e[a],a,e))&&(i>n&&(i=n),s<n&&(s=n))}return[i,s]},S=Array.prototype,g=S.slice,A=S.map,m=function(e){return function(){return e}},f=function(e){return e},I=function(e,t,i){e=+e,t=+t,i=(s=arguments.length)<2?(t=e,e=0,1):s<3?1:+i;for(var n=-1,s=0|Math.max(0,Math.ceil((t-e)/i)),a=new Array(s);++n<s;)a[n]=e+n*i;return a},C=Math.sqrt(50),v=Math.sqrt(10),R=Math.sqrt(2),N=function(e,t,i){var s=n(e,t,i);return I(Math.ceil(e/s)*s,Math.floor(t/s)*s+s/2,s)},P=function(e){return Math.ceil(Math.log(e.length)/Math.LN2)+1},O=function(){function e(e){var s,a,r=e.length,o=new Array(r);for(s=0;s<r;++s)o[s]=t(e[s],s,e);var c=i(o),u=c[0],d=c[1],h=n(o,u,d);Array.isArray(h)||(h=N(u,d,h));for(var p=h.length;h[0]<=u;)h.shift(),--p;for(;h[p-1]>=d;)h.pop(),--p;var _,T=new Array(p+1);for(s=0;s<=p;++s)_=T[s]=[],_.x0=s>0?h[s-1]:u,_.x1=s<p?h[s]:d;for(s=0;s<r;++s)a=o[s],u<=a&&a<=d&&T[l(h,a,0,p)].push(e[s]);return T}var t=f,i=E,n=P;return e.value=function(i){return arguments.length?(t="function"==typeof i?i:m(i),e):t},e.domain=function(t){return arguments.length?(i="function"==typeof t?t:m([t[0],t[1]]),e):i},e.thresholds=function(t){return arguments.length?(n="function"==typeof t?t:m(Array.isArray(t)?g.call(t):t),e):n},e},y=function(e,t,i){if(null==i&&(i=p),n=e.length){if((t=+t)<=0||n<2)return+i(e[0],0,e);if(t>=1)return+i(e[n-1],n-1,e);var n,s=(n-1)*t,a=Math.floor(s),r=+i(e[a],a,e);return r+(+i(e[a+1],a+1,e)-r)*(s-a)}},D=function(e,t,i){return e=A.call(e,p).sort(a),Math.ceil((i-t)/(2*(y(e,.75)-y(e,.25))*Math.pow(e.length,-1/3)))},M=function(e,t,i){return Math.ceil((i-t)/(3.5*T(e)*Math.pow(e.length,-1/3)))},b=function(e,t){var i,n,s=-1,a=e.length;if(null==t){for(;++s<a;)if(null!=(n=e[s])&&n>=n){i=n;break}for(;++s<a;)null!=(n=e[s])&&n>i&&(i=n)}else{for(;++s<a;)if(null!=(n=t(e[s],s,e))&&n>=n){i=n;break}for(;++s<a;)null!=(n=t(e[s],s,e))&&n>i&&(i=n)}return i},L=function(e,t){var i,n=0,s=e.length,a=-1,r=s;if(null==t)for(;++a<s;)isNaN(i=p(e[a]))?--r:n+=i;else for(;++a<s;)isNaN(i=p(t(e[a],a,e)))?--r:n+=i;if(r)return n/r},w=function(e,t){var i,n=[],s=e.length,r=-1;if(null==t)for(;++r<s;)isNaN(i=p(e[r]))||n.push(i);else for(;++r<s;)isNaN(i=p(t(e[r],r,e)))||n.push(i);return y(n.sort(a),.5)},U=function(e){for(var t,i,n,s=e.length,a=-1,r=0;++a<s;)r+=e[a].length;for(i=new Array(r);--s>=0;)for(n=e[s],t=n.length;--t>=0;)i[--r]=n[t];return i},V=function(e,t){var i,n,s=-1,a=e.length;if(null==t){for(;++s<a;)if(null!=(n=e[s])&&n>=n){i=n;break}for(;++s<a;)null!=(n=e[s])&&i>n&&(i=n)}else{for(;++s<a;)if(null!=(n=t(e[s],s,e))&&n>=n){i=n;break}for(;++s<a;)null!=(n=t(e[s],s,e))&&i>n&&(i=n)}return i},k=function(e,t){for(var i=t.length,n=new Array(i);i--;)n[i]=e[t[i]];return n},x=function(e,t){if(i=e.length){var i,n,s=0,r=0,o=e[r];for(t||(t=a);++s<i;)(t(n=e[s],o)<0||0!==t(o,o))&&(o=n,r=s);return 0===t(o,o)?r:void 0}},F=function(e,t,i){for(var n,s,a=(null==i?e.length:i)-(t=null==t?0:+t);a;)s=Math.random()*a--|0,n=e[a+t],e[a+t]=e[s+t],e[s+t]=n;return e},Y=function(e,t){var i,n=0,s=e.length,a=-1;if(null==t)for(;++a<s;)(i=+e[a])&&(n+=i);else for(;++a<s;)(i=+t(e[a],a,e))&&(n+=i);return n},G=function(e){if(!(a=e.length))return[];for(var t=-1,i=V(e,s),n=new Array(i);++t<i;)for(var a,r=-1,o=n[t]=new Array(a);++r<a;)o[r]=e[r][t];return n},B=function(){return G(arguments)};e.bisect=l,e.bisectRight=l,e.bisectLeft=c,e.ascending=a,e.bisector=r,e.cross=d,e.descending=h,e.deviation=T,e.extent=E,e.histogram=O,e.thresholdFreedmanDiaconis=D,e.thresholdScott=M,e.thresholdSturges=P,e.max=b,e.mean=L,e.median=w,e.merge=U,e.min=V,e.pairs=u,e.permute=k,e.quantile=y,e.range=I,e.scan=x,e.shuffle=F,e.sum=Y,e.ticks=N,e.tickStep=n,e.transpose=G,e.variance=_,e.zip=B,Object.defineProperty(e,"__esModule",{value:!0})}),function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define("d3-path",["exports"],t):t(e.d3=e.d3||{})}(this,function(e){"use strict";function t(){this._x0=this._y0=this._x1=this._y1=null,this._=""}function i(){return new t}var n=Math.PI,s=2*n,a=s-1e-6;t.prototype=i.prototype={constructor:t,moveTo:function(e,t){this._+="M"+(this._x0=this._x1=+e)+","+(this._y0=this._y1=+t)},closePath:function(){null!==this._x1&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")},lineTo:function(e,t){this._+="L"+(this._x1=+e)+","+(this._y1=+t)},quadraticCurveTo:function(e,t,i,n){this._+="Q"+ +e+","+ +t+","+(this._x1=+i)+","+(this._y1=+n)},bezierCurveTo:function(e,t,i,n,s,a){this._+="C"+ +e+","+ +t+","+ +i+","+ +n+","+(this._x1=+s)+","+(this._y1=+a)},arcTo:function(e,t,i,s,a){e=+e,t=+t,i=+i,s=+s,a=+a;var r=this._x1,o=this._y1,l=i-e,c=s-t,u=r-e,d=o-t,h=u*u+d*d;if(a<0)throw new Error("negative radius: "+a);if(null===this._x1)this._+="M"+(this._x1=e)+","+(this._y1=t);else if(h>1e-6)if(Math.abs(d*l-c*u)>1e-6&&a){var p=i-r,_=s-o,T=l*l+c*c,E=p*p+_*_,S=Math.sqrt(T),g=Math.sqrt(h),A=a*Math.tan((n-Math.acos((T+h-E)/(2*S*g)))/2),m=A/g,f=A/S;Math.abs(m-1)>1e-6&&(this._+="L"+(e+m*u)+","+(t+m*d)),this._+="A"+a+","+a+",0,0,"+ +(d*p>u*_)+","+(this._x1=e+f*l)+","+(this._y1=t+f*c)}else this._+="L"+(this._x1=e)+","+(this._y1=t);else;},arc:function(e,t,i,r,o,l){e=+e,t=+t,i=+i;var c=i*Math.cos(r),u=i*Math.sin(r),d=e+c,h=t+u,p=1^l,_=l?r-o:o-r;if(i<0)throw new Error("negative radius: "+i);null===this._x1?this._+="M"+d+","+h:(Math.abs(this._x1-d)>1e-6||Math.abs(this._y1-h)>1e-6)&&(this._+="L"+d+","+h),i&&(_<0&&(_=_%s+s),_>a?this._+="A"+i+","+i+",0,1,"+p+","+(e-c)+","+(t-u)+"A"+i+","+i+",0,1,"+p+","+(this._x1=d)+","+(this._y1=h):_>1e-6&&(this._+="A"+i+","+i+",0,"+ +(_>=n)+","+p+","+(this._x1=e+i*Math.cos(o))+","+(this._y1=t+i*Math.sin(o))))},rect:function(e,t,i,n){this._+="M"+(this._x0=this._x1=+e)+","+(this._y0=this._y1=+t)+"h"+ +i+"v"+ +n+"h"+-i+"Z"},toString:function(){return this._}},e.path=i,Object.defineProperty(e,"__esModule",{value:!0})}),function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("d3-array"),require("d3-path")):"function"==typeof define&&define.amd?define("d3chord",["exports","d3-array","d3-path"],t):t(e.d3=e.d3||{},e.d3,e.d3)}(this,function(e,t,i){"use strict";function n(e){return function(t,i){return e(t.source.value+t.target.value,i.source.value+i.target.value)}}function s(e){return e.source}function a(e){return e.target}function r(e){return e.radius}function o(e){return e.startAngle}function l(e){return e.endAngle}var c=Math.cos,u=Math.sin,d=Math.PI,h=d/2,p=2*d,_=Math.max,T=function(){function e(e){var n,o,l,c,u,d,h=e.length,T=[],E=t.range(h),S=[],g=[],A=g.groups=new Array(h),m=new Array(h*h);for(n=0,u=-1;++u<h;){for(o=0,d=-1;++d<h;)o+=e[u][d];T.push(o),S.push(t.range(h)),n+=o}for(s&&E.sort(function(e,t){return s(T[e],T[t])}),a&&S.forEach(function(t,i){t.sort(function(t,n){return a(e[i][t],e[i][n])})}),n=_(0,p-i*h)/n,c=n?i:p/h,o=0,u=-1;++u<h;){for(l=o,d=-1;++d<h;){var f=E[u],I=S[f][d],C=e[f][I],v=o,R=o+=C*n;m[I*h+f]={index:f,subindex:I,startAngle:v,endAngle:R,value:C}}A[f]={index:f,startAngle:l,endAngle:o,value:T[f]},o+=c}for(u=-1;++u<h;)for(d=u-1;++d<h;){var N=m[d*h+u],P=m[u*h+d];(N.value||P.value)&&g.push(N.value<P.value?{source:P,target:N}:{source:N,target:P})}return r?g.sort(r):g}var i=0,s=null,a=null,r=null;return e.padAngle=function(t){return arguments.length?(i=_(0,t),e):i},e.sortGroups=function(t){return arguments.length?(s=t,e):s},e.sortSubgroups=function(t){return arguments.length?(a=t,e):a},e.sortChords=function(t){return arguments.length?(null==t?r=null:(r=n(t))._=t,e):r&&r._},e},E=Array.prototype.slice,S=function(e){return function(){return e}},g=function(){function e(){var e,s=E.call(arguments),a=t.apply(this,s),r=n.apply(this,s),o=+d.apply(this,(s[0]=a,s)),l=p.apply(this,s)-h,S=_.apply(this,s)-h,g=o*c(l),A=o*u(l),m=+d.apply(this,(s[0]=r,s)),f=p.apply(this,s)-h,I=_.apply(this,s)-h;if(T||(T=e=i.path()),T.moveTo(g,A),T.arc(0,0,o,l,S),l===f&&S===I||(T.quadraticCurveTo(0,0,m*c(f),m*u(f)),T.arc(0,0,m,f,I)),T.quadraticCurveTo(0,0,g,A),T.closePath(),e)return T=null,e+""||null}var t=s,n=a,d=r,p=o,_=l,T=null;return e.radius=function(t){return arguments.length?(d="function"==typeof t?t:S(+t),e):d},e.startAngle=function(t){return arguments.length?(p="function"==typeof t?t:S(+t),e):p},e.endAngle=function(t){return arguments.length?(_="function"==typeof t?t:S(+t),e):_},e.source=function(i){return arguments.length?(t=i,e):t},e.target=function(t){return arguments.length?(n=t,e):n},e.context=function(t){return arguments.length?(T=null==t?null:t,e):T},e};e.chord=T,e.ribbon=g,Object.defineProperty(e,"__esModule",{value:!0})}),define("models/BaseStreamingModel",["models/BaseModel","utils/I18nMixin"],function(e,t){"use strict";var i=function(e,t){this.initialize.apply(this,arguments)},n={PROTOCOL_WS:"ws://",PROTOCOL_WSS:"wss://",SECURE_HTTPS:"https:"};return i.extend=e.extend,_.extend(i.prototype,Backbone.Events,t,{binaryType:null,initialize:function(e){e=e||{},e.binaryType&&(this.binaryType=e.binaryType),e.urlRoot&&(this.urlRoot=e.urlRoot)},connect:function(){return this.ws?this.ws:(this.ws=new WebSocket(this._getFullUrl()),this.binaryType&&(this.ws.binaryType=this.binaryType),this._setupEvents(),this.ws)},_setupEvents:function(){if(!this.ws)throw"Need to be connected before setting up events!";var e=this;this.ws.onopen=function(){e.trigger("connect",this.ws),e.connected=!0},this.ws.onmessage=function(t){var i=e.parseMessage(t.data);e.trigger("message",i)},this.ws.onclose=function(){e.trigger("close",event),e.connected=!1},this.ws.onerror=this.onError()},onError:function(e){this.trigger("error",e),this.connected&&this.reconnect()},reconnect:function(){this.destroy(),this.ws=void 0,this.connect()},parseMessage:function(e){return e},destroy:function(){if(!this.ws)throw"No existing connection to close";this.ws.onopen=this.ws.onmessage=this.ws.onerror=this.ws.onclose=void 0,this.ws.close()},getUrl:function(){if(!this.urlRoot)throw"Error! Subclasses should have urlRoot";return this.urlRoot},getDataSourceURL:function(){return""},_getFullUrl:function(){return this._getProtocol()+this._getHost()+this.getDataSourceURL()+this.getUrl()},_getHost:function(){return this._host?this._host:location.host},_getProtocol:function(){var e=n.PROTOCOL_WS;return location.protocol===n.SECURE_HTTPS&&(e=n.PROTOCOL_WSS),e}}),i}),define("models/CadmusModel",["models/BaseStreamingModel","data/DataURLConstants","utils/AppUtil","utils/AppConstants","utils/TimeUtil"],function(e,t,i,n,s){"use strict";var a={inbound:!1,outbound:!1,isolation:!1};return e.extend({name:"CadmusModel",fetchCheck:JSON.parse(JSON.stringify(a)),promises:{},connected:!1,retries:0,suddenDisconnected:!1,reconnectLoopId:null,MsgType:{ReadFlows:"read_flows",StreamFlows:"stream_flows"},PERMISSIONS:["UnaccountedAndAllowed","AccountedAndAllowed","UnaccountedAndDenied"],STAT_TYPES:["NumFlows","NumBytes","NumPackets"],connect:function(){this.fetchCheck=JSON.parse(JSON.stringify(a)),this.cadmus_event_cb={},this.off(),this.on("message",this._onMsg),this.on("connect",this._onOpen),this.on("close",this._onClose),this._host=window.location.host,this.urlRoot=t.MGMT_NETWORK_FLOW_MONITORING,e.prototype.connect.apply(this,arguments)},sendJSON:function(e){this.ws.send(JSON.stringify(e))},onCadmusMsg:function(e,t){void 0!==this.cadmus_event_cb[e]&&i.warn(e+"' already has callback func"),this.cadmus_event_cb[e]=t},doQueries:function(e,t){var n=this,s=e[0].Metadata;if(!this.connected){var a=this.promises[s],r=a?a.retries+1:0;if(r>=30)return void i.error("Websocket retries exceeded for queries",e);var o=setTimeout(function(){return n.doQueries(e,t)},1e3);return void(this.promises[s]={timeout:o,retries:r})}delete this.promises[s],this.doQueriesInternal(e,t)},doQueriesInternal:function(e,t){for(var n=function(t,n){for(var s={},a=0;a<e.length;++a){var r=e[a],o=r.Metadata;s[o]={query:r}}var l={};return function(e){var a=e.Metadata,r=s[a];r||i.error("CadmusModel","Should have found result with eventId",e),r.data=e,l[a]=!0,Object.keys(l).length<t.length||n(s)}}(e,t),s=0;s<e.length;++s){var a=e[s],r=a.Metadata;this.onCadmusMsg(r,n),this.sendJSON(a)}},destroy:function(){for(var t=_.values(this.timeout),i=0;i<t.length;++i)clearTimeout(t[i]);this.fetchCheck=JSON.parse(JSON.stringify(a)),this.cadmus_event_cb={},e.prototype.destroy.apply(this,arguments)},fetchIsolationStats:function(e,t){var n=this;if(!this.fetchCheck.isolation){this.fetchCheck.isolation=!0;var s=i.categoryFromString(e[0]),a=i.categoryFromString(e[1]),r=i.categoryFromString(e[2]),o=[this._makeQueryEndpoint([s,r])],l=[this._makeQueryEndpoint([a,r])],c=this._makeQuery(o,l,!0),u=this._makeQuery(l,o,!0),d=[c,u],h={s2d:c.Metadata,d2s:u.Metadata};this.doQueries(d,function(i){return n.summarizeIsolationStats(h,i,e,t)})}},summarizeIsolationStats:function(e,t,n,s){if(this.fetchCheck.isolation=!1,0===_.values(t).length)return void s(null);var a=t[e.s2d],r=t[e.d2s],o=i.isolationRuleHash(n,!0),l=i.isolationRuleHash(n,!1),c={};c[o]=this._calcIsolationStats(a),c[l]=this._calcIsolationStats(r),s(c)},fetchUnaccountedTraffic:function(e){var t=this,i=e.primarySecondaryCats,n=e.tiers,s=e.rules,a=e.direction,r=e.monitorMode,o=e.cb;if(n&&n.length&&!this.fetchCheck[a]){this.fetchCheck[a]=!0;var l=i&&i.primary,c=i&&i.secondary,u="inbound"===a,d=n.map(function(e){var i=t._makeQueryEndpoint([e]);l&&i.Categories.push({Name:l.name,Value:l.value}),c&&i.Categories.push({Name:c.name,Value:c.value});var n=u?[]:[i],a=u?[i]:[];return t._makeQuery(n,a,!1,s,r)});s.tiers=n,this.doQueries(d,function(e){return t.fetchUnaccountedTrafficDone(e,s,a,o)})}},fetchUnaccountedTrafficDone:function(e,t,i,n){this.fetchCheck[i]=!1;var s="inbound"===i?"Src":"Dest";n(this.parseUnaccountedAndDenied(e,s,t))},parseUnaccountedAndDenied:function(e,t,i){for(var n=this,s=[],a=[],r=Object.keys(e),o=0;o<r.length;++o){(function(o){var l=e[r[o]].data;if(!l.Contents)return"continue";var c=l.Contents.FlowMap,u=_.pluck(c,"UnaccountedAndAllowed"),d={};_.each(u,function(e){return n.addEndpointInfo(d,e,t,i)});var h=_.pluck(c,"UnaccountedAndDenied"),p={};_.each(h,function(e){return n.addEndpointInfo(p,e,t,i)}),_.each(d,function(e){e.classes=["yellow"]}),_.each(p,function(e){e.classes=["red"]}),_.each(d,function(e){return s.push([e])}),_.each(p,function(e){return a.push([e])}),n.markNumPorts(s,l.Contents.NextFlow,l.Contents.NumNext)})(o)}return s.sort(function(e,t){return e[0].value.localeCompare(t[0].value)}),a.sort(function(e,t){return e[0].value.localeCompare(t[0].value)}),s=this.filterOutQuarantine(this.filterOutProjects(s)),{unaccounted:s,denied:a}},markNumPorts:function(e,t,i,n){if(t)for(var s=this.endpointToArray(t.Src),a=this.endpointToArray(t.Dest),r="Src"===i?s:a,o="Src"===i?a:s,l=0;l<e.length;++l)for(var c=e[l][0],u=0;u<r.length;++u)if(this._isNvPairEqual(c,r[u]))for(var d=0;d<c.other.length;++d)for(var h=0;h<o.length;++h)if(this._isEndpointEqual(c.other[d],o[h]))return c.other[d].totalNumPorts=n,void(c.other[d].numMorePorts=n-c.other[d].ports.length)},filterOutProjects:function(e){return _.filter(e,function(e){return e[0].name!==n.SYSTEM_CATEGORIES.PROJECT_NAME})},filterOutQuarantine:function(e){return _.filter(e,function(e){return e[0].name!==n.SYSTEM_CATEGORIES.QUARANTINE_NAME})},fixRules:function(e){for(var t=JSON.parse(JSON.stringify(e||[])),i=0;i<t.length;++i)Array.isArray(t[i].from)||(t[i].from=[t[i].from]),Array.isArray(t[i].to)||(t[i].to=[t[i].to]);return t},addEndpointInfo:function(e,t,i,n){if(t){var s="Src"===i?"from":"to",a="Src"===i?"Dest":"Src",r=this.endpointToArray(t[i]);if(r)for(var o=0;o<r.length;++o)if(!this._isProjectDefault(r[o])){var l=function(e){return(e.Category&&e.Category.Name||"")+","+(e.Category&&e.Category.Value||"")+","+(e.Cidr||"")+","+(e.Vm||"")}(r[o]),c=e[l]||{other:[]},u=this._findMatchingRules(n,s,r[o]);if(this.appendToOther(c,t,a,{matches:u,tiers:n.tiers}),!c.name&&!c.value){var d=this._inboundToNvPair(r[o]);c.name=d.name,c.value=d.value,c.type=r[o].type}c.other&&c.other.length>0&&(e[l]=c)}}},endpointToArray:function(e){var t=this._getNsrAddType(e);switch(t){case n.NSR_ADD_TYPE.SUBNETIP:return e.type=t,[e];case n.NSR_ADD_TYPE.CATEGORY:for(var i=[],s=0;s<e.Categories.length;++s){var a=e.Categories[s];i.push({Category:{Name:a.Name,Value:a.Value},type:t})}return i;default:return null}},appendToOther:function(e,t,i,s){var a=this,r=""+t.DestPort,o=t.IcmpCode,l=t.IcmpType,c=n.NSR_PROTOCOLS_ENUMS[t.Protocol],u=this.endpointToArray(t[i]);_.each(u,function(n){if(!a._portAccountedByRules(s.matches,n,i,t)&&a._isTargetConnectable(s.tiers,n)){var u=_.find(e.other,function(e){return a._isEndpointEqual(e,n)});u||(u=n,u.ports=[],e.other.push(u));_.find(u.ports,function(e){return e.protocol===c&&(e.port===r||-1!==o&&-1!==l&&e.icmpCode===o&&e.icmpType===l)})||u.ports.push({protocol:c,port:r,icmpCode:o,icmpType:l})}})},_findMatchingRules:function(e,t,i){var n=this;return _.filter(e,function(e){return _.some(_.flatten(e[t],!0),function(e){return n._isNvPairEqual(e,i)})})},_isTargetConnectable:function(e,t){var i=this;return _.some(e,function(e){return e.type=n.NSR_ADD_TYPE.CATEGORY,i._isNvPairEqual(e,t)})},_portAccountedByRules:function(e,t,i,s){var a=this,r=""+s.DestPort,o=""+s.IcmpCode,l=""+s.IcmpType,c=n.NSR_PROTOCOLS_ENUMS[s.Protocol],u="Src"===i?"from":"to";return _.some(e,function(e){if(a._isNvPairEqual(e[u],t)){return _.some(e.ports,function(e){var t=""===e.port||e.port===r,i=e.icmpCode===o&&e.icmpType===l;return(t||i)&&e.protocol===c})}})},_isProjectDefault:function(e){return this._isNvPairEqual({name:"Project",value:"default",type:n.NSR_ADD_TYPE.CATEGORY},e)},_isNvPairEqual:function(e,t){var i=e,s=t;if(s.type!==i.type)return!1;switch(s.type){case n.NSR_ADD_TYPE.SUBNETIP:return s.Cidr===i.value;case n.NSR_ADD_TYPE.CATEGORY:return s.Category.Name===i.name&&s.Category.Value===i.value;default:return!1}},_isEndpointEqual:function(e,t){if(e.type!==t.type)return!1;switch(e.type){case n.NSR_ADD_TYPE.SUBNETIP:return e.Cidr===t.Cidr;case n.NSR_ADD_TYPE.CATEGORY:return e.Category.Name===t.Category.Name&&e.Category.Value===t.Category.Value;default:return i.error("CadmusModel","Invalid type",e),!0}},_inboundToNvPair:function(e){var t={};switch(e.type){case n.NSR_ADD_TYPE.SUBNETIP:t.name=this.i18n("subnetIP"),t.value=e.Cidr;break;case n.NSR_ADD_TYPE.CATEGORY:t.name=e.Category.Name,t.value=e.Category.Value;break;default:return null}return t},_getNsrAddType:function(e){return""!==e.Cidr?n.NSR_ADD_TYPE.SUBNETIP:e.Categories&&e.Categories.length?n.NSR_ADD_TYPE.CATEGORY:""},_onMsg:function(e){var t=this,i=new FileReader;i.onload=function(){var e=JSON.parse(i.result),n=e.Metadata;(0,t.cadmus_event_cb[n])(e)},i.readAsText(e)},_onOpen:function(){clearInterval(this.reconnectLoopId),this.reconnectLoopId=null,this.suddenDisconnected=!1},_onClose:function(){var e=this;this.suddenDisconnected=!0,this.reconnectLoopId||(this.reconnectLoopId=setInterval(function(){e.reconnect()},5e3))},_makeQueryEndpoint:function(e){for(var t={Categories:[]},i=0;i<e.length;++i){var n=e[i];0===n.name.length&&0===n.value.length||t.Categories.push({Name:n.name,Value:n.value})}return t},_makeQuery:function(e,t,i,a,r){var o=s.USECS.now(),l=o-24*s.USECS.hr,c=o-2*s.USECS.min,u=this.fixRules(a);return{Type:this.MsgType.ReadFlows,Metadata:Math.random()+"",Contents:{SrcList:e,DestList:t,SinceTime:l,UntilTime:c,StatInterval:s.USECS.min,StreamLive:!1,Limit:20,IgnoreStats:!i,rules:u,return_type:r?n.NSR_FLOW_PERMISSIONS.UNACCOUNTED_AND_ALLOWED:n.NSR_FLOW_PERMISSIONS.UNACCOUNTED_AND_DENIED}}},_calcIsolationStats:function(e){if(!e.data.Contents)return null;for(var t=0,i=0,n=_.values(e.data.Contents.FlowMap),s=0;s<n.length;++s)for(var a=_.values(n[s]),r=0;r<a.length;++r){var o=a[r];o&&(t+=a[r].NumFlows.reduce(function(e,t){return e+t},0),i+=a[r].NumBytes.reduce(function(e,t){return e+t},0))}return{numFlows:t,numBytes:i}},addFlowStats:function(e,t,i){for(var n=0;n<t[i].length&&n<e[i].length;++n)e[i][n]+=t[i][n]}})}),define("views/iq/results/NetworkVizView",["d3","d3chord","utils/AppUtil","utils/StyleDescriptor","views/iq/results/BaseResultsView","models/CadmusModel","models/iq/IQSearchQueryModel"],function(e,t,i,n,s,a,r){"use strict";function o(){return Math.floor((new Date).getTime())}var l={CHORD_OUTERMOST_RING_WIDTH:30,CHORD_MARGIN:105,TEXT_MARGIN:95},c=void 0,u=void 0;return s.extend({name:"NetworkVizView",hasResults:function(){return!0},displayResults:function(e){function t(e,t){for(var s={},a=0;a<t.length;++a){var r=t[a];r.Type===n.cadmus.MsgType.ReadFlows&&_.extend(s,r.Contents.FlowMap)}c=o();var l=(c-u)/1e3,d="Query took "+l+" seconds.";i.log("NetworkVizView: "+d),n.drawTierCentricChord(s)}var n=this;this.cadmus||(this.cadmus=new a);var s=e[r.DP.PROVIDERS.CADMUS],l=s[0].descriptors[0].perspectives[0].result.entities;this.cadmus.on("connect",function(){u=o();i.log("NetworkVizView: Query started...");var e=l[0],s=l[1],a={AppTier:{App:e,Tier:s}};n.cadmus.doQueries(n._queryAppTierCentric(a),t)}),this.cadmus.connect()},drawTierCentricChord:function(e){var t=this;this.setupChordSvg();var i=this.makeFlowMatrix(e,function(){return t.endpointToString.apply(t,Array.prototype.slice.call(arguments).concat(["Src"]))},function(){return t.endpointToString.apply(t,Array.prototype.slice.call(arguments).concat(["Dest"]))});this.diagramChords(i)},endpointToString:function(e,t){var i=this.pickSomeValidFlowGroup(e),n=i[t];return""===n.AppTier.Tier||void 0===n.AppTier.Tier?n.Cidr:n.AppTier.Tier},pickSomeValidFlowGroup:function(e){return e?_.find(e,function(e){return!!e}):(console.error("Should not happen"),null)},sumBytes:function(e){var t=0;return _.each(e,function(e){e&&(t+=e.NumBytes.reduce(function(e,t){return e+t},0))}),t},getResultDescription:function(){return this.i18n("Showing Network Visualization Results")},setupChordSvg:function(){this.renderResultColumnWithAntiScroll('<svg class="chord-netviz"></svg>')},makeFlowMatrix:function(e,t,i){var n={},s={},a=0;_.each(e,function(e){var r=t(e),o=i(e);""!==r&&""!==o&&(void 0===n[r]&&(n[r]=a,s[a]=r,++a),void 0===n[o]&&(n[o]=a,s[a]=o,++a))});for(var r=a,o=[],l=0;l<r;++l){for(var c=[],u=0;u<r;++u)c.push(0);o.push(c)}var d=this;return _.each(e,function(e){var s=t(e),a=i(e);if(""!==s&&""!==a){var r=n[s],l=n[a];o[r][l]=d.sumBytes(e)}}),o.idxToKey=s,o},diagramChords:function(i){function s(e){return 180*e/Math.PI}function a(e){return e-90}function r(t){e.event.preventDefault(),e.event.stopPropagation(),C.selectAll("path.chord").style("opacity",function(e){return t.source?e.source.index===t.source.index&&e.target.index===t.target.index?.8:.1:e.source._id===t._id||e.target._id===t._id?.8:.1})}function o(t){e.event.preventDefault(),e.event.stopPropagation(),r(t)}function c(){e.event.preventDefault(),e.event.stopPropagation(),C.selectAll("path.chord").style("opacity",.8)}var u=this.getResultEl(),d=Math.min(u.width(),u.height()),h=d/2,p=d,_=d,T=e.select(".chord-netviz"),E=h-l.CHORD_MARGIN,S=E-l.CHORD_OUTERMOST_RING_WIDTH,g=h-l.TEXT_MARGIN;$(".chord-netviz")[0].setAttribute("width",p),$(".chord-netviz")[0].setAttribute("height",_);var A=t.chord().padAngle(.05).sortSubgroups(e.descending),m=e.svg.arc().innerRadius(S).outerRadius(E),f=n.NETVIZ.VLAN_COLORS,I=e.scale.ordinal().domain(e.range(f.length)).range(f),C=T.append("g").attr("transform","translate("+h+","+h+")").datum(A(i)),v=C.append("g").attr("class","groups").selectAll("g").data(function(e){return e.groups}).enter().append("g");v.append("path").style("fill",function(e){return I(e.index)}).style("stroke",function(e){return I(e.index)}).attr("d",m),v.append("svg:text").each(function(e){return e.angle=(e.startAngle+e.endAngle)/2}).attr("dy",".35em").attr("text-anchor",function(e){return e.angle>Math.PI?"end":null}).attr("transform",function(e){return"rotate("+a(s(e.angle))+")translate("+g+")"+(e.angle>Math.PI?"rotate(180)":"")}).text(function(e){return i.idxToKey[e.index]}),v.append("svg:path").style("pointer-events","none").style("fill",function(e){return I(i.idxToKey[e.index])}).attr("d",m),v.append("text").attr("dy",".35em").on("mouseover",r).on("mouseout",c).text(function(e){return e._id}),C.append("g").attr("class","ribbons").selectAll("path").data(function(e){return e}).enter().append("path").attr("class","chord").style("opacity",.8).style("fill",function(e){return I(e.target.index)}).style("stroke",function(t){return e.rgb(I(t.target.index)).darker()}).attr("d",e.svg.chord().radius(S).startAngle(function(e){return e.startAngle}).endAngle(function(e){return e.endAngle})).on("mouseover",o).on("mouseout",c)},_queryAppTierCentric:function(e){var t=o(),i=1e3*Math.floor(t),n=i-36e8,s=i;return[{Type:this.cadmus.MsgType.ReadFlows,Metadata:Math.random()+"",Contents:{Src:[e],Dest:[],SinceTime:n,UntilTime:s,StatInterval:6e7,StreamLive:!1}},{Type:this.cadmus.MsgType.ReadFlows,Metadata:Math.random()+"",Contents:{Src:[],Dest:[e],SinceTime:n,UntilTime:s,StatInterval:6e7,StreamLive:!1}}]}})}),define("text!templates/iq/results/IQSearchResultsView.html",[],function(){return'<div class="search-results-wrapper">\n  \x3c!-- Default Search Skill --\x3e\n  <table class="search-results-table default-skill">\n    <tr>\n      <td class="search-result-cell  no-split" rowspan="2" valign="top">\n        <div class="result-column top-result focusable-column">\n          <div class="header">\n            <div class="column-label">\n              Top Result\n            </div>\n          </div>\n          <div class="results"></div>\n        </div>\n      </td>\n      <td class="search-result-cell  v-split" valign="top">\n        <div class="result-column entity-results focusable-column">\n          <div class="header">\n            <div class="column-label">\n              Entities\n            </div>\n            <div class="count-badge count">\n            </div>\n          </div>\n          <div class="results"></div>\n        </div>\n      </td>\n      <td class="search-result-cell  no-split" rowspan="2" valign="top">\n        <div class="result-column alert-results focusable-column">\n          <div class="header">\n            <div class="column-label">\n              Alerts\n            </div>\n            <div class="count-badge count">\n            </div>\n          </div>\n          <div class="results"></div>\n        </div>\n      </td>\n      <td class="search-result-cell  no-split" rowspan="2" valign="top">\n        <div class="result-column kb-results focusable-column">\n          <div class="header">\n            <div class="column-label">\n              Help\n            </div>\n            <div class="count-badge count">\n            </div>\n          </div>\n          <div class="results"></div>\n        </div>\n      </td>\n    </tr>\n    <tr>\n      <td class="search-result-cell  v-split" valign="top">\n        <div class="result-column action-results focusable-column">\n          <div class="header">\n            <div class="column-label">\n              Actions\n            </div>\n            <div class="count-badge count">\n            </div>\n          </div>\n          <div class="results"></div>\n        </div>\n      </td>\n    </tr>\n  </table>\n\n  \x3c!-- Network Visualization Skill --\x3e\n  <table class="search-results-table networkviz-skill">\n    <tr>\n      <td class="search-result-cell  no-split" valign="top">\n        <div class="result-column networkviz-results focusable-column">\n          <div class="header">\n            <div class="column-label">\n              Network Visualization\n            </div>\n          </div>\n          <div class="results"></div>\n        </div>\n      </td>\n    </tr>\n  </table>\n</div>\n'}),define("views/iq/results/IQSearchResultsView",["views/basecomponents/BaseView","managers/NotificationManager","models/iq/IQSearchQueryModel","utils/SubViewHelper","utils/AppConstants","views/iq/results/TopResultView","views/iq/results/ActionsResultsView","views/iq/results/EntityResultsView","views/iq/results/AlertsResultsView","views/iq/results/KBResultsView","views/iq/results/NetworkVizView","text!templates/iq/results/IQSearchResultsView.html"],function(e,t,i,n,s,a,r,o,l,c,u,d){"use strict";var h=_.template(d);return e.extend({events:{"click  .search-results-table":"onClickSearchResultsTable"},HIDE_AUTO_SUGGESTION:"hideAutoSuggestion",initialize:function(){e.prototype.initialize.apply(this,arguments),this.subViewHelper=new n,this.render(),this._initializeSubViews()},render:function(){this.$el.html(h())},showView:function(){this.$el.addClass("-visible")},hideView:function(){this.$el.removeClass("-visible")},destroy:function(){this.subViewHelper.destroy(),this.subViewHelper=null,e.prototype.destroy.apply(this,arguments)},onStartServices:function(){this.subViewHelper.iterate("onStartServices")},onStopServices:function(){this.subViewHelper.iterate("onStopServices")},onResize:function(){this.subViewHelper.iterate("onResize")},onClickSearchResultsTable:function(){this.trigger(this.HIDE_AUTO_SUGGESTION)},clearNavigationContexts:function(){this.subViewHelper.get("topResultView").clearNavigationContexts()},maybeGetResultDescription:function(e){var t=e.results;if(t[i.DP.PROVIDERS.CADMUS]&&t[i.DP.PROVIDERS.CADMUS].length>0)return this.subViewHelper.get("networkvizResultsView").getResultDescription()},displayResults:function(e){var t=e[i.DP.RESULT.RESULTS],n=e[i.DP.RESULT.KEYWORDS];if(this.$(".default-skill").removeClass("-visible"),this.$(".networkviz-skill").removeClass("-visible"),
t[i.DP.PROVIDERS.CADMUS].length>0)return void this.displayNetworkVizSkill(t);this.displayDefaultSkill(e,t,n)},displayDefaultSkill:function(e,t,n){this.$(".default-skill").addClass("-visible"),this._renderTopResult(e[i.DP.RESULT.TOP_HIT],n),this.subViewHelper.get("actionsResultsView").renderResults(t[i.DP.PROVIDERS.ACTIONS],n),this.subViewHelper.get("entityResultsView").renderResults(t[i.DP.PROVIDERS.SP_ENTITIES],n),this.subViewHelper.get("alertResultsView").renderResults(t[i.DP.PROVIDERS.ALERTS],n),this.subViewHelper.get("kbResultsView").renderResults(t[i.DP.PROVIDERS.HELP],n)},displayNetworkVizSkill:function(e){this.$(".networkviz-skill").addClass("-visible"),this.subViewHelper.get("networkvizResultsView").renderResults(e)},displayError:function(e){t.showClientNotification(s.NOTIFY_ERROR,e)},_renderTopResult:function(e,t){this.subViewHelper.get("topResultView").renderResults(e,t)},_initializeSubViews:function(){var e=new a({el:this.$(".top-result")}),t=new r({el:this.$(".action-results")}),i=new o({el:this.$(".entity-results")}),n=new l({el:this.$(".alert-results")}),s=new c({el:this.$(".kb-results")}),d=new u({el:this.$(".networkviz-results")});this.subViewHelper.register("topResultView",e),this.subViewHelper.register("actionsResultsView",t),this.subViewHelper.register("entityResultsView",i),this.subViewHelper.register("alertResultsView",n),this.subViewHelper.register("kbResultsView",s),this.subViewHelper.register("networkvizResultsView",d)}})}),define("text!templates/iq/IQSearchView.html",[],function(){return'<div id="searchContainer" class="iq-search-container">\n  \x3c!-- Search bar --\x3e\n  <div class="search-bar <%= showHelpUrl ? \'show-help\' : \'no-help\' %>">\n    <div class="input-container">\n      <input id="searchInput" class="iq-search" type="text"\n             placeholder="Search for clusters, vm names, actions..."\n             spellcheck="false">\n\n      \x3c!-- Search bar actions --\x3e\n      \x3c!--<div class="iq-search-overlay"></div>--\x3e\n\n      <div class="input-action">\n        <div class="clear-input">\n          <a href="#">Clear</a>\n        </div>\n        <div class="btnIqFavorite favorite-star">\n          <%= SVG.SVGIcon("Star_Empty", "iq-star") %>\n          <%= SVG.SVGIcon("Star", "iq-star-favorite") %>\n        </div>\n      </div>\n      <div class="hidden-input"></div>\n    </div>\n\n    \x3c!-- Auto suggest dropdown --\x3e\n    <div id="searchSuggestion" class="search-suggestions"></div>\n\n    \x3c!-- Page close button --\x3e\n    <div class="close-container">\n      <% if (showHelpUrl) { %>\n        <div class="helpIcon help-icon">\n          <%= Components.icon(\'Question_Mark\', \'question-mark -large\') %>\n        </div>\n      <% } %>\n      <div class="btnCloseSearch btn-close-wrapper">\n        <%= SVG.SVGIcon("K", "iq-btn-close") %>\n      </div>\n    </div>\n  </div>\n  <div id="searchDescription" class="search-description"></div>\n\n  <div class="iq-search-separator"></div>\n\n  \x3c!-- Results --\x3e\n  <div class="search-results">\n  </div>\n\n  \x3c!-- Loader --\x3e\n  <div id="searchLoader" class="n-search-loader">\n    <div class="loader-container">\n      <div class="donut-loader"></div>\n      Searching...\n    </div>\n  </div>\n\n  \x3c!-- Recorded Searches --\x3e\n  <div id="iqRecorded" class="iq-recorded">\n    <div id="iqRecordedResults" class="iq-recorded-results">\n      <div class="iq-container n-clearfix">\n\n        \x3c!-- Cheatsheet examples --\x3e\n        <div class="cheat-sheet-view n-clearfix">\n          <div class="cs-header n-title">\n            Try searching with these keywords\n          </div>\n          <div class="cheat-sheet-container">\n            <div id="searchExamples" class="search-examples"></div>\n          </div>\n          <div id="advancedExamples" class="advanced-examples"></div>\n        </div>\n\n        \x3c!-- Quick links view --\x3e\n        <div class="quick-links-view">\n          <div class="cs-header n-title">\n            Shortcut links\n          </div>\n          \x3c!-- Recent searches --\x3e\n          <div id="recentSearches" class="results-container">\n            <div class="results-title">\n              <span><%= SVG.SVGIcon("Clock", "recent-search-icon -inline") %></span>\n              Recent Searches\n            </div>\n            <div class="recorded-searches">\n              <div id="listRecentSearches" class="box-inner n-content-inner">\n                \x3c!-- Place content here --\x3e\n              </div>\n            </div>\n          </div>\n          \x3c!-- Saved searches --\x3e\n          <div id="savedSearches" class="results-container">\n            <div class="results-title">\n              <span><%= SVG.SVGIcon("Star", "saved-search-icon -inline") %></span>\n              Saved Searches\n            </div>\n            <div class="recorded-searches">\n              <div id="listSavedSearches" class="box-inner n-content-inner">\n                  \x3c!-- Place content here --\x3e\n              </div>\n            </div>\n          </div>\n        </div>\n\n      </div>\n    </div>\n  </div>\n\n</div>'}),define("views/iq/IQSearchView",["views/basecomponents/BaseView","views/popups/iq/IQCheatSheetPopupView","components/Components","managers/NavigationManager","managers/ActionManager","managers/AccessManager","managers/NotificationManager","managers/HelpManager","managers/PopupManager","views/iq/results/IQSearchResultsView","events/AppEvents","utils/SubViewHelper","utils/SVG","utils/AppUtil","utils/AlertUtil","utils/AntiscrollUtil","utils/AppConstants","utils/IQUtil","text!templates/iq/IQSearchView.html","text!templates/iq/IQCheatSheetTemplate.html","views/iq/IQTemplates","models/iq/IQSearchQueryModel"],function(e,t,i,n,s,a,r,o,l,c,u,d,h,p,T,E,S,g,A,m,f,I){"use strict";var C=_.template(A),v=_.template(m),R="",N=0,P=0,O=0;return e.extend({VINDEX_SEARCH_INPUT_ACTIVE:-1,VINDEX_SEARCH_INPUT_LOOP_BACK:-2,CHEAT_SHEET_LINK:'Not finding what you are looking for? Check out our <span id="iqCheatsheetLinkOuter" class="cheat-sheet-link">Cheat Sheet</span>.',ADVANCED_QUERIES_ID:"advanced queries",NUM_HISTORY:10,searchTimer:null,pauseTimer:null,query:null,queryAutoSuggest:null,searchInput:null,explicitQuery:!1,pause:!1,minLength:1,popupView:null,PAUSE_DELAY:1e3,DELAY:100,numDropdown:3,queryInTransit:null,model:null,cheatSheetView:null,events:{"click  .btnCloseSearch":"onClickBtnClose","click  #searchContainer":"onClickSearchContainer","click  .focusable":"onClickSearchItem","click  #iqFavoritesRow":"onClickRecordedResults","click  #iqHistoryRow":"onClickRecordedResults","click  .searchQuery.clickable":"onClickRecordedResults","click  .iq-favorite-star":"onClickStarFavorite","click  .btnIqFavorite":"onClickStar","click  .cheat-sheet-link":"onClickCheatSheet","click  .helpIcon":"onClickHelp","click  #searchSuggestion":"onClickSearchSuggestion","click  .clear-input":"onClickClearSearchInput"},initialize:function(t){e.prototype.initialize.apply(this,arguments),this.model=t.model,this.historyCollection=t.historyCollection,this.favoriteCollection=t.favoriteCollection,this.cheatSheetCollection=t.cheatsheetCollection,this.subViewHelper=new d,_.bindAll(this,"searchQueryNow","onResize","triggerSearchQuery")},render:function(){this.$el.html(C({SVG:h,Components:i,showHelpUrl:this.isClusterFFEnabled(S.FFLAGS.HELP_DOC)})),this._initializeSubViews(),this.searchInput=this.$("#searchInput")},destroy:function(){var t=this.subViewHelper.get("iqSearchResultsView");t&&t.off(),this.cheatSheetView.off(),this.subViewHelper.destroy(),this.subViewHelper=null,e.prototype.destroy.apply(this,arguments)},onStartServices:function(){var e=this;setTimeout(function(){e.searchInput.focus()},200),this.model.on(this.model.CHANGE_EVENTS.QUERY_RESULTS,this.onSearchResults,this),this.model.on(this.model.CHANGE_EVENTS.QUERY_SUGGESTIONS,this.onSearchSuggestions,this),this.model.on(this.model.CHANGE_EVENTS.ERROR_MSG,this.onSearchError,this),this.subViewHelper.iterate("startServices"),this.activateRecordedSearchComponents(),T.loadAlertTypeMetadata(),$(window).on("resize.app",this.onResize)},onStopServices:function(){this.removeFocusOnSearchItems(),this.model.off(this.model.CHANGE_EVENTS.QUERY_RESULTS,this.onSearchResults,this),this.model.off(this.model.CHANGE_EVENTS.QUERY_SUGGESTIONS,this.onSearchSuggestions,this),this.model.off(this.model.CHANGE_EVENTS.ERROR_MSG,this.onSearchError,this),this.subViewHelper.iterate("stopServices"),$(window).off("resize.app",this.onResize)},queryBasePageResults:function(){var e=this,t=[];_.each([this.historyCollection,this.favoriteCollection,this.cheatSheetCollection],function(e){t.push(e.fetch())},this),$.when.apply($,t).done(function(){e.renderSearchHistory(),e.renderSearchFavorites(),e.renderSearchExamples(),e.formatBasePageResults()}).fail(function(){p.log("Error in fetching History/ Favorites/ Examples/ collections.")})},renderSearchExamples:function(){this.$("#advancedExamples").empty(),this.$("#searchExamples").empty(),_.each(this.cheatSheetCollection.toJSON(),function(e){(e.description||"").toLowerCase()===this.ADVANCED_QUERIES_ID?this.$("#advancedExamples").append(v({cheatSheetSection:e,helpIcon:i.icon("question-tooltip","-inline")})):this.$("#searchExamples").append(v({cheatSheetSection:e,helpIcon:i.icon("question-tooltip","-inline")}))},this)},renderSearchFavorites:function(){var e=[];this.$("#listSavedSearches").empty(),this.favoriteCollection.each(function(t){var i=t.get("value");e.push(i.query)}),this.createSearchFavorites(e)},renderSearchHistory:function(){var e=[];this.$("#listRecentSearches").empty(),this.historyCollection.each(function(t){e.push(t.get("value"))}),this.createSearchHistory(_.first(e,this.NUM_HISTORY))},formatBasePageResults:function(){E.applyAntiScroll(this.$(".recorded-searches .antiscroll-wrap"),null,null,{ntnxShowFirstTime:!0,classnames:"-light -spaced"}),0===this.getSearchInputLength()&&this._showBasePage()},createSearchHistory:function(e){var t=this.$("#listRecentSearches"),i="";e&&e.length?i+=f.HISTORY_LIST_ITEM({array:e}):i+=f.NO_HISTORY_SEARCHES({}),t.html(i)},createSearchFavorites:function(e){var t=this.$("#listSavedSearches"),i="";e&&e.length?i+=f.FAVORITE_LIST_ITEM({array:e}):i+=f.NO_SAVED_SEARCHES({SVG:h}),t.html(i)},show:function(e){n.getCurrentPageRoute();this.render()},hide:function(){require(["managers/IQSearchManager"],function(e){e.hideSearch()})},searchQueryNow:function(e,t,i,n){var s=this.searchInput.val().trim();if(_.isEmpty(s)&&(this.query=s),s){var a=s!==this.query;if(a||i||n&&a)t?this.search(s,e,t,i,n):e&&s!==this.queryAutoSuggest&&this.search(s,e,t,i,n);else if(!a&&e){var r=this.searchInput.val();r.length-1===s.length&&r.trim()===s&&this.search(s,!0,!1,i,n)}}else this._clearCurrentSearchView()},search:function(e,t,i,n,s){if(e.length<this.minLength)return void this.stopSearch();if(t&&(this._showSpinner(),this.queryAutoSuggest=e,P++,this.model.performAutoSuggestSearch(e,P,n)),i){if(this.query=e,N++,this._showSpinner(),this.queryInTransit===this.query)return;this.queryInTransit=this.query,s&&O++,this.model.performAutoResultSearch(this.query,N,O,n)}},stopSearch:function(){this.model.stopSearch(),this._hideSpinner(),this.queryInTransit=null,this._hideSearchResultsView(),this._clearResultDescription()},onResize:function(){var e=this;clearTimeout(this.resizeTimer),this.resizeTimer=setTimeout(function(){e.subViewHelper.iterate("onResize")},50)},onClickBtnClose:function(){this.hide(),$("#n-ctr-notification .n-notification-msg").removeClass("n-show").addClass("n-hide")},onClickSearchContainer:function(e){var t=this.getFocusedSearchItem(),i=$(e.target);0===t.length&&!this.searchInput.is(":focus")&&i.hasClass("iq-btn-close")&&this.searchInput.focus()},onClickSearchItem:function(e){this.selectSearchItem(e.currentTarget)},onClickRecordedResults:function(e){this.triggerSearchQuery(e.currentTarget.textContent.trim())},triggerSearchQuery:function(e){this.searchInput.val(e),this._hideBasePage(),this.searchQueryNow(!1,!0,!0,!1),this.searchInput.focus(),"iqFavoritesRow"!==event.target.id&&"iqFavoritesRow"!==event.target.parentElement.id||p.addSVGClass(this.$(".btnIqFavorite"),"favorite")},addQueryToFavorites:function(e,t){return e.length&&this.favoriteCollection.addAndSaveQuery(e,t),!1},deleteQuery:function(e){var t=this;this.favoriteCollection.deleteQuery({success:function(){t.renderSearchFavorites()}})},deleteQueryFromFavorites:function(e){var t=this;this.$(".btnIqFavorite").prop("disabled",!0),this.favoriteCollection.fetch({success:function(){t.deleteQuery(e),t.$(".btnIqFavorite").prop("disabled",!1)},error:function(){p.log("IQSearchView: Unable to fetch the favorite collection")}})},onClickStarFavorite:function(e){var t=$(e.target),i=$(t).parent(),n=$(i).parent().text();return _.isEmpty(n)||this.deleteQueryFromFavorites(n),!1},onClickStar:function(e){var t=this.searchInput.val().trim(),i=this.$(".btnIqFavorite");return p.svgHasClass(i,"favorite")?(p.removeSVGClass(i,"favorite"),this.deleteQueryFromFavorites(t)):this.addQueryToFavorites(t,{success:function(e,t){p.addSVGClass(i,"favorite")}}),!1},onClickHelp:function(){o.navigateToSearchHelp()},onClickCheatSheet:function(e){var i;this.cheatSheetView=l.renderPopupView(t,(i={},_defineProperty(i,S.NAV_ACTION_ROUTE,S.SEARCH_PORTAL),_defineProperty(i,"model",this.cheatSheetCollection),i)),this.cheatSheetView.on(u.QUERY_EXAMPLE,this.triggerSearchQuery,this)},onClickSearchSuggestion:function(){this.queryAndHideAutoComplete(!0)},onClickClearSearchInput:function(){this._clearCurrentSearchView(),p.svgHasClass(this.$(".btnIqFavorite"),"favorite")&&p.removeSVGClass(this.$(".btnIqFavorite"),"favorite")},onSearchResults:function(e,t,i){if((t===N||O===i)&&(this._hideSpinner(),this.queryInTransit=null,0!==this.searchInput.val().length)){this._showActionItems();var n=this.subViewHelper.get("iqSearchResultsView");n.showView(),this.displayResultDescription(e),n.displayResults(e)}},displayResultDescription:function(e){var t=this.subViewHelper.get("iqSearchResultsView"),i=t.maybeGetResultDescription(e);if(i)return void this.$("#searchDescription").html(i);var n=e.queryExplanation,s=e.keywords;n?this.$("#searchDescription").html(g.highlightMatchedWords(n,s)):this.$("#searchDescription").html(this.CHEAT_SHEET_LINK)},onSearchSuggestions:function(e,t){this.queryInTransit||this._hideSpinner();var i=e[I.DP.RESULT.AUTO_SUGGESTIONS];_.isEmpty(i)&&this.hideSearchSuggestions(),_.isEmpty(i)||t!==P||(this._hideBasePage(),this.showAutoComplete(i),this.getSearchInputLength()<this.minLength&&this.hideSearchSuggestions())},onUserInput:function(){this.$(".iq-search-overlay").empty();var e=this;clearTimeout(this.pauseTimer),this.getSearchInputLength()<this.minLength?(this.hideSearchSuggestions(),this.activateRecordedSearchComponents()):(this._hideBasePage(),clearTimeout(this.searchTimer),this.searchTimer=setTimeout(function(){e.searchQueryNow(!0,!1,!1,!1)},this.DELAY),clearTimeout(this.pauseTimer),this.pauseTimer=setTimeout(function(){e.searchQueryNow(!1,!0,!1,!0)},this.PAUSE_DELAY)),p.svgHasClass(this.$(".btnIqFavorite"),"favorite")&&p.removeSVGClass(this.$(".btnIqFavorite"),"favorite")},activateRecordedSearchComponents:function(){0===this.getSearchInputLength()&&(this._hideSpinner(),this.queryInTransit=null,this._hideActionItems(),this._hideSearchResultsView(),this.queryBasePageResults(),this._showBasePage(),this._clearResultDescription())},onSearchError:function(){this._hideSpinner(),this.queryInTransit=null,this.subViewHelper.get("iqSearchResultsView").displayError(this.model.getErrorMsg())},isSearchSuggestionVisible:function(){return this.$(".input-container").hasClass("-show-suggestion")},showSearchSuggestions:function(){this.$(".input-container").addClass("-show-suggestion")},hideSearchSuggestions:function(e){"clear"===e&&this.$("#searchSuggestion").empty(),this.$(".input-container").removeClass("-show-suggestion")},showAutoComplete:function(e){var t=this.$("#searchSuggestion"),i=this.searchInput.val().trim(),n=[];_.each(e,function(e){n.push(e.completeQuery)});var s=g.autoSuggestionParser(n,i),a=this.$(".iq-search-overlay");a.empty();var r=_.first(e);r?r.completeQuery.indexOf(i)>-1&&r.completeQuery[0]===i[0]&&a.html(r.completeQuery):a.html(""),s&&!this.explicitQuery?(t.empty(),_.each(s,function(e,i){i<this.numDropdown&&(t.append(f.AUTO_SUGGESTION_ROW({query:e,index:i})),this.showSearchSuggestions())},this)):this.hideSearchSuggestions("clear")},handleKeyUpEvent:function(e){var t=$.ui.keyCode,i=this.isAutoSuggestionActive();this.explicitQuery=!1,this._isAutoSuggestionSelected()||(R=this.searchInput.val().trim());var n=this._isPopupOverlayed();switch(e){case t.LEFT:case t.RIGHT:n||(i?(this.removeFocusOnSearchItems(),this.searchInput.focus()):this.updateResultHighlightOnKey(e));break;case t.PAGE_UP:case t.PAGE_DOWN:case t.TAB:break;case t.UP:case t.DOWN:n||(i?this.getSuggestionElements(e):this.updateResultHighlightOnKey(e));break;case t.ENTER:case t.NUMPAD_ENTER:this.handleEnterKeyUp(i);break;default:n||this.onUserInput()}},isAutoSuggestionActive:function(){var e=this.$("#searchSuggestion");return this.isSearchSuggestionVisible()&&e.children().length>0},getSuggestionElements:function(e){if(this.isAutoSuggestionActive()){this.updateSuggestionDropdownHighlightOnKey(e);var t=this.$(".focusable.active");t.text()?(this.searchInput.val(t.text()),this.$(".iq-search-overlay").empty()):this.searchInput.val(R),this.searchQueryNow(!1,!0,!1,!1),this.searchInput.focus()}else this.updateResultHighlightOnKey(e)},getSearchInputLength:function(e){return this.$("#searchInput").val().length},handleEnterKeyUp:function(e){this._isPopupOverlayed()||this.queryAndHideAutoComplete(e)},queryAndHideAutoComplete:function(e){if(clearTimeout(this.pauseTimer),this.hideSearchSuggestions(),!this.getFocusedSearchItem()||e||this.searchInput.is(":focus")){var t=this;clearTimeout(this.searchTimer),this.searchTimer=setTimeout(function(){t.searchQueryNow(!1,!0,!0,!1)},this.DELAY),this.explicitQuery=!0}else this.selectSearchItem()},updateSuggestionDropdownHighlightOnKey:function(e){if(!this._isPopupOverlayed()){var t=this.$(".focusable.active"),i=this.$(".search-suggestions"),n=i.find(".focusable").length,s=Number(t.attr("vIndex"));isNaN(s)&&(s=this.VINDEX_SEARCH_INPUT_ACTIVE);var a=$.ui.keyCode;if(e===a.UP?(this.searchInput.blur(),s--):e===a.DOWN&&(this.searchInput.blur(),t.length&&s<n-1?s++:t.length&&s===n-1?(s=this.VINDEX_SEARCH_INPUT_ACTIVE,this.removeFocusOnSearchItems(),this.searchInput.focus()):0===t.length&&s===this.VINDEX_SEARCH_INPUT_ACTIVE&&s++),!this.searchInput.is(":focus")){var r=this.$(".focusable").length;if(this.removeFocusOnSearchItems(),s===this.VINDEX_SEARCH_INPUT_ACTIVE)this.searchInput.focus();else{s===this.VINDEX_SEARCH_INPUT_LOOP_BACK&&(s=n-1);for(var o,l=!0,c=0;l;)o=i.find('[vIndex="'+s+'"]'),o.length>0||c++>r?l=!1:s--;o.addClass("active")}}}},updateResultHighlightOnKey:function(e){if(!this._isPopupOverlayed()){var t=this.$(".focusable.active"),i=t.closest(".focusable-column"),n=this.$(".focusable-column").length,s=i.find(".focusable").length,a=Number(t.attr("vIndex")),r=this.$(".focusable-column").index(i);a||(a=0),-1===r&&(r=0);var o=$.ui.keyCode;e===o.UP?a--:e===o.DOWN?(this.searchInput.blur(),t.length&&a<s-1&&a++):e===o.RIGHT?(0===r&&(a=0),r+1<n&&r++):e===o.LEFT&&(1===r&&(a=0),r-1>-1&&r--),this.searchInput.is(":focus")||this.focusOnItem(r,a,e)}},focusOnItem:function(e,t,i){var n=this.$(".focusable").length;if(this.removeFocusOnSearchItems(),-1===t)this.searchInput.focus();else{for(var s,a=!0,r=0;a;)s=this.getFocusableItem(e,t),s.length>0||r++>n?a=!1:0===t&&i===$.ui.keyCode.RIGHT?e++:0===t&&i===$.ui.keyCode.LEFT?e--:t--;s.addClass("active")}},getFocusableItem:function(e,t){return $(this.$(".focusable-column")[e]).find('[vIndex="'+t+'"]')},getFocusedSearchItem:function(){return this.$(".focusable.active")},removeFocusOnSearchItems:function(){this.searchInput.blur(),this.$(".focusable.active").removeClass("active")},selectSearchItem:function(e){if(e||(e=this.getFocusedSearchItem()),"iq-auto-suggestion"===e.id)this.searchInput.val(e.textContent),this.searchQueryNow(!1,!0,!0,!1),this.searchInput.focus();else{var t=$(e).attr(S.NAV_ACTION_ROUTE);try{if(t=JSON.parse(t),$(e).hasClass("navigable")||$(e).hasClass("actionBtn")){var i=t.options;if(i){var s=i.contextId,a=n.cloneNavigationContext(s);t.options.contextId=a}}}catch(e){return void p.log("Error in parsing action route: "+e)}this.executeActionRoute(t)}},executeActionRoute:function(e){var t=!0;if(s.isNavigationAction(e.action))e.action===S.ACTION_NAVIGATE_PAGE&&this.hide(),e.isNewWindow&&(t=!1),s.executeAction(e,{changeUrl:t});else{if(a.isClusterViewerOnly())return void r.showClientNotification(S.NOTIFY_ERROR,a.ACCESS_DENIED_MSG);var i=e.actionTarget,n=e.action,o=[e.actionTargetId],l=e.clusterUuid;s.onEntityAction(i,n,o,l)}},_isPopupOverlayed:function(){return Boolean($("#globalModalWrapper .modal:visible").length)},_isAutoSuggestionSelected:function(){return this.$("#searchSuggestion").children().hasClass("active")},_clearCurrentSearchView:function(){this.searchInput.val(""),this.hideSearchSuggestions(),this.$(".iq-search-overlay").empty(),this.activateRecordedSearchComponents(),this.searchInput.focus(),this.subViewHelper.get("iqSearchResultsView").clearNavigationContexts()},_hideSearchResultsView:function(){this.subViewHelper.get("iqSearchResultsView").clearNavigationContexts(),this.subViewHelper.get("iqSearchResultsView").hideView()},_clearResultDescription:function(){this.$("#searchDescription").empty()},_showSpinner:function(){this.$("#searchLoader").addClass("n-show")},_hideSpinner:function(){this.$("#searchLoader").removeClass("n-show")},_showBasePage:function(){this.$("#iqRecorded").addClass("-show")},_hideBasePage:function(){this.$("#iqRecorded").removeClass("-show")},_showActionBar:function(){this.$(".input-action").addClass("-show")},_hideActionBar:function(){this.$(".input-action").removeClass("-show")},_showSeparator:function(){this.$(".iq-search-separator").addClass("-show")},_hideSeparator:function(){this.$(".iq-search-separator").removeClass("-show")},_showActionItems:function(){this._showSeparator(),this._showActionBar()},_hideActionItems:function(){this._hideSeparator(),this._hideActionBar()},_initializeSubViews:function(){var e=this;if(!this.subViewHelper.get("iqSearchResultsView")){var t=new c({el:this.$(".search-results")});t.on(t.HIDE_AUTO_SUGGESTION,function(){e.hideSearchSuggestions()}),this.subViewHelper.register("iqSearchResultsView",t)}}})}),define("models/iq/IQSearchModel",["models/BaseModel","utils/AppUtil","utils/SubModelHelper","models/iq/IQSearchQueryModel"],function(e,t,i,n){"use strict";var s={QUERY_RESULTS:"change:queryResultsTrigger",QUERY_SUGGESTIONS:"change:querySuggestionsTrigger",ERROR_MSG:"change:errorMessageTrigger"};return e.extend({name:"IQSearchModel",subModelHelper:null,CHANGE_EVENTS:s,defaults:{userQuery:null,errorMessage:null},initialize:function(){e.prototype.initialize.apply(this,arguments);var t=new n,s=new n({isUsedForAutoSuggest:!0});this.subModelHelper=new i,this.subModelHelper.register("queryResult",t),this.subModelHelper.register("querySuggest",s)},destroy:function(){this.subModelHelper.destroy(),this.subModelHelper=null},performAutoSuggestSearch:function(e,i,n){this.resetError(),this.set("userQuery",e);var a=this,r=this.subModelHelper.get("querySuggest");r.search(e,{success:function(){a._triggerChangeEvent(s.QUERY_SUGGESTIONS,r.getQueryResult(),i)},error:function(e,i){t.log("IQSearchModel : Error on query suggestion :"+i)}},n,!0)},performAutoResultSearch:function(e,t,i,n){this.resetError(),this.set("userQuery",e);var a=this,r=this.subModelHelper.get("queryResult");r.search(e,{success:function(){a._triggerChangeEvent(s.QUERY_RESULTS,r.getQueryResult(),t,i)},error:function(){a._setError("Error performing query.")}},n,!1)},stopSearch:function(){var e=this.subModelHelper.get("queryResult"),t=this.subModelHelper.get("querySuggest");e.stopFetch(),t.stopFetch()},getResults:function(){return this.subModelHelper.get("queryResult").getResults()},getSuggestions:function(){return this.subModelHelper.get("querySuggest").getResults()},getErrorMsg:function(){return this.get("errorMessage")},resetError:function(){this.set("errorMessage",null)},_setError:function(e){this.set("errorMessage",e),this._triggerChangeEvent(s.ERROR_MSG)},_triggerChangeEvent:function(e,t,i,n){this.trigger(e,t,i,n)}})}),define("models/iq/IQSearchHistoryModel",["models/BaseModel"],function(e){"use strict";return e.extend({name:"IQSearchHistoryModel",nameAttribute:"name",defaults:{value:""}})}),define("models/iq/IQSearchHistoryCollection",["models/iq/IQSearchHistoryModel","models/BaseCollection","data/DataURLConstants"],function(e,t,i){"use strict";return t.extend({model:e,name:"IQSearchHistoryCollection",url:i.IQ_HISTORY,parse:function(e){var t=[];return _.each(e,function(e){t.push({value:e})}),t}})}),define("models/iq/IQSearchFavoriteModel",["models/BaseModel","managers/NotificationManager","data/DataURLConstants","utils/AppConstants","utils/AppUtil"],function(e,t,i,n,s){"use strict";return e.extend({name:"IQSearchFavoriteModel",urlRoot:i.IQ_FAVORITE,nameAttribute:"name",defaults:{value:""},getURL:function(){return this.url()},showErrorNotification:function(e,i,a){a=a||{};var r=s.processAjaxError(a.responseText),o=r||"An unknown error occurred";r===a.responseText&&(i===n.ACTION_DELETE?o="Unable to delete the query from Saved Searches.":i===n.ACTION_CREATE&&(o="Unable to add the query to Saved Searches.")),t.hideLatencyAction(e,i),t.showClientNotification(n.NOTIFY_ERROR,o)},showSuccessNotification:function(e,i,s){var a="Success!";i===n.ACTION_DELETE?a="Query has been successfully deleted from Saved Searches.":i===n.ACTION_CREATE&&(a="Query has been successfully saved."),t.hideLatencyAction(e,i),t.showClientNotification(n.NOTIFY_SUCCESS,a)}})}),define("models/iq/IQSearchFavoriteCollection",["models/iq/IQSearchFavoriteModel","models/BaseCollection","utils/AppConstants","data/DataURLConstants"],function(e,t,i,n){"use strict";return t.extend({model:e,name:"IQSearchFavoriteCollection",url:n.IQ_FAVORITE,parse:function(e){var t=[];return _.each(e,function(e){t.push({value:e})}),t},getQueryModel:function(e){return _.filter(this.models,function(t){var i=t.get("value");if(i&&!_.isEmpty(i))return t.get("value").query===e})[0]},addAndSaveQuery:function(e,t){t=_.extend({},t,{wait:!0}),this.create({value:e},t)},deleteQuery:function(t,n){var s=this.getQueryModel(t);if(this.remove(s),s){var a=s.get("value").id,r=s.get("value").query,o=new e;o.actionMode=i.ACTION_DELETE,o.nameAttribute=r,o.set(o.idAttribute,a),o.destroy(n)}}})}),define("models/iq/IQCheatSheetModel",["models/BaseModel"],function(e){"use strict";var t={DESCRIPTION:"description",QUERIES:"queries",TEXT:"text",TEMPLATIZED:"isTemplatized"};return e.extend({name:"IQCheatSheetModel",nameAttribute:"name",DP:t,defaults:{value:""}},{DP:t})}),define("models/iq/IQCheatSheetCollection",["models/BaseCollection","models/iq/IQCheatSheetModel","data/DataURLConstants"],function(e,t,i){"use strict";return e.extend({model:t,name:"IQCheatSheetCollection",url:i.IQ_CHEAT_SHEET,DP:{SCENARIOS:"scenarios"},parse:function(){return e.prototype.parse.apply(this,arguments)[this.DP.SCENARIOS]}})}),define("managers/IQSearchManager",["views/iq/IQSearchView","models/iq/IQSearchModel","managers/AppManager","managers/PopupManager","models/iq/IQSearchHistoryCollection","models/iq/IQSearchFavoriteCollection","models/iq/IQCheatSheetCollection"],function(e,t,i,n,s,a,r){"use strict";return{iqSearchView:null,initialize:function(){_.bindAll(this,"onKeyUp")},_initializeViewAndModel:function(){$("body").append('<div id="globalIQWrapper" class="iq-global-wrapper"></div>'),this.iqSearchView=new e({el:$("#globalIQWrapper"),model:new t,historyCollection:new s,favoriteCollection:new a,cheatsheetCollection:new r}),this.iqSearchView.render()},showSearch:function(){this.iqSearchView||this._initializeViewAndModel(),this.updateSearchKeyEvent(!0),i.updateGlobalKeyEvent(!1),$("body").addClass("full-page-overlay"),$("#globalIQWrapper").addClass("shown"),this.iqSearchView.startServices(),i.currentPageStopServices()},hideSearch:function(){this.updateSearchKeyEvent(!1),i.updateGlobalKeyEvent(!0),$("body").removeClass("full-page-overlay"),$("#globalIQWrapper").removeClass("shown"),this.iqSearchView&&this.iqSearchView.stopServices(),i.currentPageStartServices()},updateQueryBasedOnRoute:function(e){},updateSearchKeyEvent:function(e){e?$(document).on("keyup",this.onKeyUp):$(document).off("keyup",this.onKeyUp)},isEntityDetailView:function(){return Boolean($("#containerDetails.active").length)},onKeyUp:function(e){var t=$.ui.keyCode;if(e.keyCode===t.ESCAPE)if(this.iqSearchView&&this.iqSearchView.isSearchSuggestionVisible())this.iqSearchView.hideSearchSuggestions();else if(n.isPopupVisible())n.hidePopup();else{if(this.isEntityDetailView())return;this.hideSearch()}else e.stopPropagation(),this.iqSearchView&&this.iqSearchView.handleKeyUpEvent(e.keyCode)}}}),define("views/basecomponents/vantagepoints/VantagePointLayoutDescriptor",["jquery","utils/AppUtil"],function(e,t){"use strict";return{SIZE_SMALL:"s",SIZE_MEDIUM:"m",SIZE_LARGE:"l",SIZE_XLARGE:"xl",SIZE_XXLARGE:"xxl",SIZE_XXLARGE_HORIZONTAL:"xxlr",SIZE_XXXLARGE:"xxxl",VP_SIZE_DISPLAY_NAMES:{s:"1 x 1",m:"2 x 1",l:"2 x 2",xl:"2 x 3",xxl:"2 x 4",xxlr:"4 x 2",xxxl:"4 x 4"},BLOCK_WIDTH_MAX:550,BLOCK_WIDTH_MIN:110,BLOCK_HEIGHT_MAX:156,BLOCK_HEIGHT_MIN:135,BLOCK_COL_MIN:8,BLOCK_ROW_MIN:100,ADD_VANTAGE_POINT_BLOCK_COL_MIN:4,ADD_VANTAGE_POINT_BLOCK_ROW_MIN:4,BLOCK_MARGIN_HORIZONTAL:8,BLOCK_MARGIN_VERTICAL:8,PERSPECTIVE_WIDTH:null,getDashboardGridsterLayout:function(e){var t,i=this.BLOCK_COL_MIN,n=this.BLOCK_ROW_MIN;return t=this.getBlockDimension(e),{margin_horizontal:this.BLOCK_MARGIN_HORIZONTAL,margin_vertical:this.BLOCK_MARGIN_VERTICAL,block_width:t.width,block_height:t.height,min_cols:i,min_rows:n}},getAddVantagePointLayout:function(e){var t;return t=this.getBlockDimension(e),{margin_horizontal:this.BLOCK_MARGIN_HORIZONTAL,margin_vertical:this.BLOCK_MARGIN_VERTICAL,block_width:t.width,block_height:t.height,min_cols:this.ADD_VANTAGE_POINT_BLOCK_COL_MIN,min_rows:this.ADD_VANTAGE_POINT_BLOCK_ROW_MIN}},getVantagePointLayout:function(e){var t,i,n;switch(e.get("size")){case this.SIZE_XXXLARGE:t=4,i=4;break;case this.SIZE_XXLARGE:t=2,i=4;break;case this.SIZE_XLARGE:t=2,i=3;break;case this.SIZE_LARGE:t=2,i=2;break;case this.SIZE_MEDIUM:t=2,i=1;break;case this.SIZE_XXLARGE_HORIZONTAL:t=4,i=2;break;default:t=1,i=1}return n={size_x:t,size_y:i},e.get("position")&&(e.get("position").x&&(n.col=e.get("position").x),e.get("position").y&&(n.row=e.get("position").y)),n},getBlockDimension:function(i){var n=t.hasScrollBar()||this.PERSPECTIVE_WIDTH?13:9;this.PERSPECTIVE_WIDTH=e(i).width()||this.PERSPECTIVE_WIDTH;var s={},a=this.BLOCK_COL_MIN,r=this.BLOCK_ROW_MIN,o=Math.floor(this.PERSPECTIVE_WIDTH/a)-n,l=Math.floor(e(i).height()/r)-4;return s.width=Math.max(this.BLOCK_WIDTH_MIN,Math.min(this.BLOCK_WIDTH_MAX,o)),s.height=Math.max(this.BLOCK_HEIGHT_MIN,Math.min(this.BLOCK_HEIGHT_MAX,l)),s}}}),define("models/dashboard/VantagePointModel",["models/BaseModel","views/basecomponents/vantagepoints/VantagePointLayoutDescriptor"],function(e,t){"use strict";var i={ASPECTS:"aspects",ACTIONS:"actions",POSITION:"position",IS_CUSTOM_VP:"isCustomVP",AUTO_ADD:"autoAdd"};return e.extend({DEFAULT_POSITION:{x:"1",y:"1"},name:"VantagePointModel",nameAttribute:"name",DP:i,defaults:{id:"",name:"",type:"",aspects:null,size:t.SIZE_SMALL,importance:1,actions:null,position:null,isCustomVP:!1},initialize:function(t,i){e.prototype.initialize.apply(this,arguments),t=t||{},this.set(this.DP.ASPECTS,t[this.DP.ASPECTS]||{}),this.set(this.DP.ACTIONS,t[this.DP.ACTIONS]||[]),this.set(this.DP.POSITION,t[this.DP.POSITION]||this.DEFAULT_POSITION)}})}),define("models/dashboard/VantagePointCollection",["models/BaseCollection","models/dashboard/VantagePointModel"],function(e,t){"use strict"
;return e.extend({model:t,name:"VantagePointCollection"})}),define("models/dashboard/DashboardModel",["models/BaseModel","models/userdata/UserDataModel","models/dashboard/VantagePointCollection","managers/NotificationManager","managers/LicenseManager","utils/AppConstants","utils/AppUtil","data/DataProperties"],function(e,t,i,n,s,a,r,o){"use strict";var l=(_.template("<%=msg%> <%-title%>."),{VANTAGE_POINTS:"vantagePoints",CUSTOMIZABLE:"customizable",GRID_ID:"gridId",CREATE:"create",UPDATE:"update",TITLE:"title",DISABLE_LAUNCH_APPS_AUTO_ADD:"disableLaunchAppsAutoAdd"});return t.extend({DP:l,name:"DashboardModel",defaults:{gridId:null,vantagePoints:null,customizable:!1,id:null,title:"",createdTimeUsecs:"",updatedTimeInUsecs:null},enableNotifications:!1,initialize:function(e,i){t.prototype.initialize.apply(this,arguments),this.get(o.ID)||(this.set(l.GRID_ID,r.randomId("grid")),this.set(o.ID,r.randomId("id"))),this.set(o.USER_DATA_TYPE,o.USER_DATA_TYPE_DASHBOARDS),this.set(o.USER_DATA_KEY,this.get(o.ID))},save:function(e,i,s){var r=this;e===l.CREATE?(this.isNew(!0),this.set(o.CREATED_TIME,Date.now())):(this.isNew(!1),this.set(o.USER_DATA_UPDATED_TIME,Date.now())),this.set(o.USER_DATA_KEY,this.get(o.ID)),this.set(o.USER_DATA_VALUE,JSON.stringify(this)),i=i||{};var c=i.success,u=i.error;return _.isUndefined(s)&&(s=!0),i={success:function(t,i){if(s){var o=r.getNotificationMessage(e,a.NOTIFY_SUCCESS);n.showClientNotification(a.NOTIFY_SUCCESS,o)}c&&c(r,i)},error:function(t,i,o){if(s){var l=r.getNotificationMessage(e,a.NOTIFY_ERROR);n.showClientNotification(a.NOTIFY_ERROR,l)}u&&u(r,i,o)}},t.prototype.save.call(this,null,i)},parse:function(t,n){var s=e.prototype.parse.apply(this,arguments);if(s[o.USER_DATA_TYPE])try{s=JSON.parse(s[o.USER_DATA_VALUE])}catch(e){r.logDebug("Error while parsing dashboard data from server "+e)}var a=s[l.VANTAGE_POINTS],c=(new i).reset(a);return s[l.VANTAGE_POINTS]=c,s},getNotificationMessage:function(e,t){var i="",n=this.getTitle();return e===a.ACTION_DELETE?(t===a.NOTIFY_SUCCESS&&(i=this.i18ns("success_delete",n)),t===a.NOTIFY_ERROR&&(i=this.i18ns("error_delete",n))):e===a.ACTION_CREATE?(t===a.NOTIFY_SUCCESS&&(i=this.i18ns("success_create",n)),t===a.NOTIFY_ERROR&&(i=this.i18ns("error_create",n))):e===a.ACTION_UPDATE&&(t===a.NOTIFY_SUCCESS&&(i=this.i18ns("success_update",n)),t===a.NOTIFY_ERROR&&(i=this.i18ns("error_update",n))),i},showSuccessNotification:function(t,i,n){s.isPrismProFeaturesEnabled()?e.prototype.showSuccessNotification.apply(this,arguments):r.log("DashboardModel: showSuccessNotification: Called for dashboard "+this.getTitle())},showErrorNotification:function(t,i,n){s.isPrismProFeaturesEnabled()?e.prototype.showErrorNotification.apply(this,arguments):r.log("DashboardModel: showErrorNotification: Called for dashboard "+this.getTitle())},showLatencyNotification:function(t,i){s.isPrismProFeaturesEnabled()?e.prototype.showLatencyNotification.apply(this,arguments):r.log("DashboardModel: showLatencyNotification: Called for dashboard "+this.getTitle())},getValue:function(t){var i;switch(t){case o.NAME:i=this.getTitle();break;default:i=e.prototype.getValue.apply(this,arguments)}return i},disableVantagePointAutoAdd:function(e){e.get(o.VP_TYPE)===a.VP_TYPE.LAUNCH_APPS&&this.set(l.DISABLE_LAUNCH_APPS_AUTO_ADD,!0)},resetDisableVantagePointAutoAdd:function(){this.unset(l.DISABLE_LAUNCH_APPS_AUTO_ADD)},addVantagePoint:function(e,t){var i=this.get(l.VANTAGE_POINTS);return i.add(e),this.set(l.VANTAGE_POINTS,i.toJSON()),this.save(l.UPDATE,t)},isDefaultDashboard:function(){var e=this.get(o.USER_DATA_KEY);return e===a.PERSPECTIVE_DASHBOARD||e===a.PERSPECTIVE_DELOS},getTitle:function(){return this.isDefaultDashboard()?this.i18nStatic("DashboardLinksMenuView","main_dashboard"):this.get(this.DP.TITLE)}})}),define("models/dashboard/DashboardCollection",["backbone","models/userdata/UserDataCollection","models/dashboard/DashboardModel","data/DataProperties"],function(e,t,i,n){"use strict";return t.extend({model:i,name:"DashboardCollection",type:n.USER_DATA_TYPE_DASHBOARDS,comparator:function(e){return e.get(n.CREATED_TIME)}})}),define("text!extras/dashboard/dashboard-layouts.json",[],function(){return'{\n  "dashboard"  : {\n      "title"         : "Dashboard.Dashboard",\n      "vantagePoints" : [\n        { "id"         : "hypervisor_summary_home",\n          "size"       : "s",\n          "importance" : 1,\n          "position"   : {\n            "x" : "1",\n            "y" : "1"\n          }\n        },\n\n        { "id"         : "pc_deployment_status",\n          "size"       : "s",\n          "importance" : 1,\n          "position"   : {\n            "x" : "2",\n            "y" : "1"\n          }\n        },\n        { "id"         : "storage_summary",\n          "size"       : "m",\n          "importance" : 1,\n          "position"   : {\n            "x" : "1",\n            "y" : "2"\n          }\n        },\n        { "id"         : "vm_summary",\n          "size"       : "m",\n          "importance" : 2,\n          "position"   : {\n            "x" : "1",\n            "y" : "3"\n          }\n        },\n        { "id"         : "hardware_summary",\n          "size"       : "m",\n          "importance" : 3,\n          "position"   : {\n            "x" : "1",\n            "y" : "4"\n          }\n        },\n        { "id"         : "cluster_iops",\n          "size"       : "m",\n          "importance" : 1,\n          "position"   : {\n            "x" : "3",\n            "y" : "1"\n          }\n      },\n        { "id"         : "cluster_io_bandwidth",\n          "size"       : "m",\n          "importance" : 2,\n          "position"   : {\n            "x" : "3",\n            "y" : "2"\n          }\n      },\n        { "id"         : "cluster_avg_io_latency",\n        "size"       : "m",\n        "importance" : 3,\n        "position"   : {\n          "x" : "3",\n          "y" : "3"\n        }\n      },\n        { "id"         : "cluster_cpu_usage",\n\n          "size"       : "s",\n          "importance" : 4,\n          "position"   : {\n            "x" : "3",\n            "y" : "4"\n          }\n        },\n        { "id"         : "cluster_memory_usage",\n\n          "size"       : "s",\n          "importance" : 5,\n          "position"   : {\n            "x" : "4",\n            "y" : "4"\n          }\n        },\n        { "id"         : "health",\n          "size"       : "l",\n          "importance" : 1,\n          "position"   : {\n            "x" : "5",\n            "y" : "1"\n          }\n        },\n        { "id"         : "data_resiliency_status",\n          "size"       : "l",\n          "importance" : 1,\n          "position"   : {\n            "x" : "5",\n            "y" : "3"\n          }\n        },\n        { "id"         : "critical_alerts",\n          "size"       : "l",\n          "importance" : 1,\n          "position"   : {\n            "x" : "7",\n            "y" : "1"\n          }\n        },\n        { "id"         : "warning_alerts",\n          "size"       : "m",\n          "importance" : 1,\n          "position"   : {\n            "x" : "7",\n            "y" : "3"\n          }\n        },\n        { "id"         : "info_alerts",\n          "size"       : "s",\n          "importance" : 1,\n          "position"   : {\n            "x" : "7",\n            "y" : "4"\n          }\n        },\n        { "id"         : "events",\n          "size"       : "s",\n          "importance" : 1,\n          "position"   : {\n            "x" : "8",\n            "y" : "4"\n          }\n        }\n      ]\n    },\n  "storage"  : {\n      "title"         : "Storage",\n      "vantagePoints" : [\n        { "id"         : "storage_summary",\n          "size"       : "m",\n          "importance" : 1,\n          "position"   : {\n            "x" : "1",\n            "y" : "1"\n          }\n        },\n        { "id"         : "container",\n          "size"       : "m",\n          "importance" : 3,\n          "position"   : {\n            "x" : "1",\n            "y" : "2"\n          }\n        },\n        { "id"         : "compression_savings",\n          "size"       : "l",\n          "importance" : 4,\n          "position"   : {\n            "x" : "1",\n            "y" : "3"\n          }\n        },\n        { "id"         : "cluster_iops",\n          "size"       : "m",\n          "importance" : 2,\n          "position"   : {\n            "x" : "3",\n            "y" : "1"\n          }\n      },\n        { "id"         : "cluster_io_bandwidth",\n          "size"       : "m",\n          "importance" : 3,\n          "position"   : {\n            "x" : "3",\n            "y" : "2"\n          }\n      },\n        { "id"         : "cluster_avg_io_latency",\n        "size"       : "m",\n        "importance" : 4,\n        "position"   : {\n          "x" : "3",\n          "y" : "3"\n        }\n      },\n        { "id"         : "performance_tier_deduplication",\n          "size"       : "m",\n          "importance" : 4,\n          "position"   : {\n            "x" : "3",\n            "y" : "4"\n          }\n        },\n        { "id"         : "storage_critical_alerts",\n          "size"       : "l",\n          "importance" : 1,\n          "position"   : {\n            "x" : "5",\n            "y" : "1"\n          }\n        },\n        { "id"         : "storage_warning_alerts",\n          "size"       : "l",\n          "importance" : 2,\n          "position"   : {\n            "x" : "5",\n            "y" : "3"\n          }\n        },\n        { "id"         : "storage_events",\n          "size"       : "xxl",\n          "importance" : 1,\n          "position"   : {\n            "x" : "7",\n            "y" : "1"\n          }\n        }\n      ]\n    },\n  "vm"  : {\n\n      "title"         : "VMs",\n      "vantagePoints" : [\n        { "id"         : "hypervisor_summary",\n          "size"       : "m",\n          "importance" : 1,\n          "position"   : {\n            "x" : "1",\n            "y" : "1"\n          }\n        },\n        { "id"         : "vm_summary",\n          "size"       : "m",\n          "importance" : 1,\n          "position"   : {\n            "x" : "1",\n            "y" : "2"\n          }\n        },\n        { "id"         : "vm_cpu",\n          "size"       : "m",\n          "importance" : 2,\n          "position"   : {\n            "x" : "1",\n            "y" : "3"\n          }\n        },\n        { "id"         : "vm_memory",\n          "size"       : "m",\n          "importance" : 2,\n          "position"   : {\n            "x" : "1",\n            "y" : "4"\n          }\n        },\n        { "id"         : "top_user_vms_by_iops",\n          "size"       : "m",\n          "importance" : 1,\n          "position"   : {\n            "x" : "3",\n            "y" : "1"\n          }\n        },\n        { "id"         : "top_user_vms_by_io_latency",\n          "size"       : "m",\n          "importance" : 2,\n          "position"   : {\n            "x" : "3",\n            "y" : "2"\n          }\n        },\n        { "id"         : "top_user_vms_by_memory_usage",\n          "size"       : "m",\n          "importance" : 3,\n          "position"   : {\n            "x" : "3",\n            "y" : "3"\n          }\n        },\n        { "id"         : "top_user_vms_by_cpu_usage",\n          "size"       : "m",\n          "importance" : 4,\n          "position"   : {\n            "x" : "3",\n            "y" : "4"\n          }\n        },\n        { "id"         : "vm_critical_alerts",\n          "size"       : "l",\n          "importance" : 1,\n          "position"   : {\n            "x" : "5",\n            "y" : "1"\n          }\n        },\n        { "id"         : "vm_warning_alerts",\n          "size"       : "l",\n          "importance" : 2,\n          "position"   : {\n            "x" : "5",\n            "y" : "3"\n          }\n        },\n        { "id"         : "vm_events",\n          "size"       : "xxl",\n          "importance" : 1,\n          "position"   : {\n            "x" : "7",\n            "y" : "1"\n          }\n        }\n      ]\n    },\n  "hardware"  : {\n      "title"         : "Hardware",\n      "vantagePoints" : [\n        { "id"         : "hardware_summary",\n          "size"       : "m",\n          "importance" : 1,\n          "position"   : {\n            "x" : "1",\n            "y" : "1"\n          }\n        },\n        { "id"         : "host",\n          "size"       : "m",\n          "importance" : 2,\n          "position"   : {\n            "x" : "1",\n            "y" : "2"\n          }\n        },\n        { "id"         : "disk",\n          "size"       : "m",\n          "importance" : 3,\n          "position"   : {\n            "x" : "1",\n            "y" : "3"\n          }\n        },\n        { "id"         : "host_cpu",\n          "size"       : "s",\n          "importance" : 4,\n          "position"   : {\n            "x" : "1",\n            "y" : "4"\n          }\n        },\n        { "id"         : "host_memory",\n          "size"       : "s",\n          "importance" : 5,\n          "position"   : {\n            "x" : "2",\n            "y" : "4"\n          }\n        },\n        { "id"         : "top_hosts_by_disk_iops",\n          "size"       : "m",\n          "importance" : 1,\n          "position"   : {\n            "x" : "3",\n            "y" : "1"\n          }\n        },\n        { "id"         : "top_hosts_by_disk_io_bandwidth",\n          "size"       : "m",\n          "importance" : 2,\n          "position"   : {\n            "x" : "3",\n            "y" : "2"\n          }\n        },\n        { "id"         : "top_hosts_by_memory_usage",\n          "size"       : "m",\n          "importance" : 3,\n          "position"   : {\n            "x" : "3",\n            "y" : "3"\n          }\n        },\n        { "id"         : "top_hosts_by_cpu_usage",\n          "size"       : "m",\n          "importance" : 4,\n          "position"   : {\n            "x" : "3",\n            "y" : "4"\n          }\n        },\n\n        { "id"         : "hardware_critical_alerts",\n          "size"       : "l",\n          "importance" : 1,\n          "position"   : {\n            "x" : "5",\n            "y" : "1"\n          }\n        },\n        { "id"         : "hardware_warning_alerts",\n          "size"       : "l",\n          "importance" : 2,\n          "position"   : {\n            "x" : "5",\n            "y" : "3"\n          }\n        },\n\n        { "id"         : "hardware_events",\n          "size"       : "xxl",\n          "importance" : 1,\n          "position"   : {\n            "x" : "7",\n            "y" : "1"\n          }\n        }\n      ]\n    },\n  "dr"  : {\n      "title"         : "DR",\n      "vantagePoints" : [\n\n        { "id"         : "data_protection_summary",\n          "size"       : "m",\n          "importance" : 1,\n          "position"   : {\n            "x" : "1",\n            "y" : "1"\n          }\n        },\n        { "id"         : "ongoing_replication",\n          "size"       : "m",\n          "importance" : 2,\n          "position"   : {\n            "x" : "1",\n            "y" : "2"\n          }\n        },\n        { "id"         : "pending_replication",\n          "size"       : "m",\n          "importance" : 3,\n          "position"   : {\n            "x" : "1",\n            "y" : "3"\n          }\n        },\n        { "id"         : "last_successful_replication",\n          "size"       : "m",\n          "importance" : 4,\n          "position"   : {\n            "x" : "1",\n            "y" : "4"\n          }\n        },\n        { "id"         : "bandwidth_tx",\n          "size"       : "m",\n          "importance" : 1,\n          "position"   : {\n            "x" : "3",\n            "y" : "1"\n          }\n        },\n        { "id"         : "bandwidth_rx",\n          "size"       : "m",\n          "importance" : 1,\n          "position"   : {\n            "x" : "3",\n            "y" : "2"\n          }\n        },\n        { "id"         : "top_remote_sites_by_bandwidth_tx",\n          "size"       : "m",\n          "importance" : 4,\n          "position"   : {\n            "x" : "3",\n            "y" : "3"\n          }\n        },\n        { "id"         : "top_remote_sites_by_bandwidth_rx",\n          "size"       : "m",\n          "importance" : 4,\n          "position"   : {\n            "x" : "3",\n            "y" : "4"\n          }\n        },\n        { "id"         : "protection_critical_alerts",\n          "size"       : "l",\n          "importance" : 1,\n          "position"   : {\n            "x" : "5",\n            "y" : "1"\n          }\n        },\n        { "id"         : "protection_warning_alerts",\n          "size"       : "l",\n          "importance" : 2,\n          "position"   : {\n            "x" : "5",\n            "y" : "3"\n          }\n        },\n        { "id"         : "protection_events",\n          "size"       : "xxl",\n          "importance" : 1,\n          "position"   : {\n            "x" : "7",\n            "y" : "1"\n          }\n        }\n      ]\n    },\n  "delos": {\n      "title": "Multicluster",\n      "vantagePoints": [\n        {\n          "id": "ImpactedCluster",\n          "size": "l",\n          "importance": 1,\n          "position": {\n            "x": "1",\n            "y": "1"\n          }\n        },\n        {\n          "id": "clusterQuickAccess",\n          "size": "l",\n          "importance": 1,\n          "position": {\n            "x": "5",\n            "y": "3"\n          }\n        },\n        {\n          "id": "clusterStorage",\n          "size": "l",\n          "importance": 1,\n          "position": {\n            "x": "5",\n            "y": "1"\n          }\n        },\n        {\n          "id": "Tasks",\n          "size": "l",\n          "importance": 1,\n          "position": {\n            "x": "7",\n            "y": "3"\n          }\n        },\n        {\n          "id": "clusterRunway",\n          "size": "l",\n          "importance": 1,\n          "position": {\n            "x": "1",\n            "y": "3"\n          }\n        },\n        {\n          "id": "clusterCPUUsage",\n          "size": "m",\n          "importance": 1,\n          "position": {\n            "x": "3",\n            "y": "3"\n          }\n        },\n        {\n          "id": "clusterMemoryUsage",\n          "size": "m",\n          "importance": 1,\n          "position": {\n            "x": "3",\n            "y": "4"\n          }\n        },\n        {\n          "id": "vm_efficiency",\n          "size": "l",\n          "importance": 1,\n          "position": {\n            "x": "3",\n            "y": "1"\n          }\n        },\n        {\n          "id": "clusterLatency",\n          "size": "m",\n          "importance": 1,\n          "position": {\n            "x": "7",\n            "y": "5"\n          }\n        },\n        {\n          "id": "controllerIOPS",\n          "size": "m",\n          "importance": 1,\n          "position": {\n            "x": "7",\n            "y": "6"\n          }\n        },\n        {\n          "id": "recoveryPlanStatus",\n          "size": "l",\n          "importance": 1,\n          "position": {\n            "x": "1",\n            "y": "5"\n          }\n        },\n        {\n          "id": "protectionStatus",\n          "size": "l",\n          "importance": 1,\n          "position": {\n            "x": "3",\n            "y": "5"\n          }\n        },\n        {\n          "id": "launchApps",\n          "size": "l",\n          "importance": 1,\n          "autoAdd": false\n        },\n        {\n          "id": "reports",\n          "size": "m",\n          "importance": 1,\n          "position" : {\n            "x" : "5",\n            "y" : "5"\n          }\n        },\n        {\n          "id": "xplay_summary",\n          "size": "l",\n          "importance": 1,\n          "position" : {\n            "x" : "7",\n            "y" : "1"\n          }\n        }\n      ]\n    },\n  "pc": {\n    "title": "PrismCentral",\n    "vantagePoints": [\n      { "id"         : "prism_central_cluster",\n        "size"       : "l",\n        "importance" : 1,\n        "position"   : {\n           "x" : "1",\n           "y" : "1"\n        }\n      },\n      { "id"         : "prism_central_capacity",\n        "size"       : "l",\n        "importance" : 1,\n        "position"   : {\n           "x" : "1",\n           "y" : "3"\n        }\n      },\n      { "id"         : "prism_central_vms",\n        "size"       : "xxxl",\n        "importance" : 1,\n        "position"   : {\n          "x" : "3",\n          "y" : "1"\n        }\n      },\n      {\n        "id"         : "prism_central_critical_alerts",\n        "size"       : "l",\n        "importance" : 1,\n        "position"   : {\n          "x" : "7",\n          "y" : "1"\n        }\n      },\n      {\n        "id"         : "prism_central_warning_alerts",\n        "size"       : "m",\n        "importance" : 1,\n        "position"   : {\n          "x" : "7",\n          "y" : "3"\n        }\n      },\n      {\n        "id"         : "prism_central_info_alerts",\n        "size"       : "m",\n        "importance" : 1,\n        "position"   : {\n          "x" : "7",\n          "y" : "4"\n        }\n      }\n    ]\n  },\n  "default" : {\n    "vantagePoints" : []\n  }\n}\n'}),define("text!extras/dashboard/vantagepoints.json",[],function(){
return'{\n  "hypervisor_summary": {\n    "name": "hypervisor_summary",\n    "type": "summary",\n    "aspects": {\n      "type": "hypervisor"\n    }\n  },\n  "hypervisor_summary_home": {\n    "name"       : "hypervisor_summary",\n    "type"       : "summary_home",\n    "aspects"    : {\n      "type": "hypervisor-home"\n    }\n  },\n  "pc_deployment_status": {\n    "name"       : "prism_central",\n    "type"       : "action",\n    "aspects"    : {\n      "type": "one_click_pc_deployment"\n    }\n  },\n  "storage_summary": {\n    "name"       : "storage_summary",\n    "type"       : "summary",\n    "aspects"    : {\n      "type" :"storage"\n    }\n  },\n  "vm_summary": {\n    "name": "vm_summary",\n    "type": "summary",\n    "aspects": {\n      "type": "vm"\n    }\n  },\n  "vm_efficiency": {\n    "name": "vm_efficiency",\n    "type": "vm_efficiency",\n    "size": "l"\n  },\n  "hardware_summary": {\n    "name": "hardware_summary",\n    "type": "summary",\n    "aspects": {\n      "type": "hardware"\n    }\n  },\n  "cluster_iops"          :   {\n    "name": "cluster_iops",\n    "type"       : "performance",\n    "aspects"    : {\n      "entity" : "cluster",\n      "metric" : "controller_num_iops"\n    },\n    "actions"    : [ "chartRedirect" ]\n  },\n  "cluster_io_bandwidth"  : {\n    "name"       : "cluster_io_bandwidth",\n    "type"       : "performance",\n    "aspects"    : {\n      "entity" : "cluster",\n      "metric" : "controller_io_bandwidth_kBps"\n    },\n    "actions"    : [ "chartRedirect" ]\n  },\n  "cluster_avg_io_latency":   {\n    "name"       : "cluster_avg_io_latency",\n    "type"       : "performance",\n    "aspects"    : {\n      "entity" : "cluster",\n      "metric" : "controller_avg_io_latency_usecs"\n    },\n    "actions": [\n      "chartRedirect"\n    ]\n  },\n  "cluster_cpu_usage": {\n    "name": "cluster_cpu_usage",\n    "type": "performance",\n    "aspects": {\n      "entity": "cluster",\n      "metric": "cpuUsage"\n    },\n    "actions": [\n      "metricRedirect"\n    ]\n  },\n  "cluster_memory_usage": {\n    "name": "cluster_memory_usage",\n    "type": "performance",\n    "aspects": {\n      "entity": "cluster",\n      "metric": "memoryUsage"\n    },\n    "actions": [\n      "metricRedirect"\n    ]\n  },\n  "health": {\n    "name": "health",\n    "type": "summary",\n    "aspects": {\n      "type": "health"\n    }\n  },\n  "data_resiliency_status": {\n    "name": "data_resiliency_status",\n    "type": "summary",\n    "aspects": {\n      "type": "resiliency-status"\n    }\n  },\n  "critical_alerts": {\n    "name": "critical_alerts",\n    "type": "alert",\n    "aspects": {\n      "perspective": "cluster",\n      "severity": "kCritical"\n    }\n  },\n  "warning_alerts": {\n    "name": "warning_alerts",\n    "type": "alert",\n    "aspects": {\n      "perspective": "cluster",\n      "severity": "kWarning"\n    }\n  },\n  "info_alerts": {\n    "name": "info_alerts",\n    "type": "alert",\n    "aspects": {\n      "perspective": "cluster",\n      "severity": "kInfo"\n    }\n  },\n  "events": {\n    "name": "events",\n    "type": "event",\n    "aspects": {\n      "perspective": "cluster"\n    }\n  },\n  "container": {\n    "name": "container",\n    "type": "entity",\n    "aspects": {\n      "entity": "container"\n    }\n  },\n  "compression_savings": {\n    "name": "capacity_optimization",\n    "type": "feature",\n    "aspects": {\n      "type": "totalCompressionSavings"\n    }\n  },\n  "performance_tier_deduplication": {\n    "name": "performance_tier_deduplication",\n    "type": "feature",\n    "aspects": {\n      "type": "deduplication"\n    }\n  },\n  "storage_critical_alerts": {\n    "name": "storage_critical_alerts",\n    "type": "alert",\n    "aspects": {\n      "perspective": "storage",\n      "severity": "kCritical"\n    }\n  },\n  "storage_warning_alerts": {\n    "name": "storage_warning_alerts",\n    "type": "alert",\n    "aspects": {\n      "perspective": "storage",\n      "severity": "kWarning"\n    }\n  },\n  "storage_events": {\n    "name": "storage_events",\n    "type": "event",\n    "aspects": {\n      "perspective": "storage"\n    }\n  },\n  "host": {\n    "name": "host",\n    "type": "entity",\n    "aspects": {\n      "entity": "host"\n    }\n  },\n  "disk": {\n    "name": "disk",\n    "type": "entity",\n    "aspects": {\n      "entity": "disk"\n    }\n  },\n  "host_cpu": {\n    "name": "cpu",\n    "type": "resource",\n    "aspects": {\n      "entity": "host",\n      "type": "cpu"\n    }\n  },\n  "host_memory": {\n    "name": "memory",\n    "type": "resource",\n    "aspects": {\n      "entity": "host",\n      "type": "memory"\n    }\n  },\n  "vm_cpu": {\n    "name": "cpu",\n    "type": "resource",\n    "aspects": {\n      "entity": "vm",\n      "type": "cpu"\n    }\n  },\n  "vm_memory": {\n    "name": "memory",\n    "type": "resource",\n    "aspects": {\n      "entity": "vm",\n      "type": "memory"\n    }\n  },\n  "top_hosts_by_disk_iops": {\n    "name": "top_hosts_by_disk_iops",\n    "type": "topmetric",\n    "aspects": {\n      "entity": "host",\n      "metric": "iops",\n      "count": 10\n    }\n  },\n  "top_hosts_by_disk_io_bandwidth": {\n    "name": "top_hosts_by_disk_io_bandwidth",\n    "type": "topmetric",\n    "aspects": {\n      "entity": "host",\n      "metric": "bandwidth",\n      "count": 10\n    }\n  },\n  "top_hosts_by_memory_usage": {\n    "name": "top_hosts_by_memory_usage",\n    "type": "topmetric",\n    "aspects": {\n      "entity": "host",\n      "metric": "memoryUsage",\n      "count": 10\n    }\n  },\n  "top_hosts_by_cpu_usage": {\n    "name": "top_hosts_by_cpu_usage",\n    "type": "topmetric",\n    "aspects": {\n      "entity": "host",\n      "metric": "cpuUsage",\n      "count": 10\n    }\n  },\n  "hardware_critical_alerts": {\n    "name": "hardware_critical_alerts",\n    "type": "alert",\n    "aspects": {\n      "perspective": "hardware",\n      "severity": "kCritical"\n    }\n  },\n  "hardware_warning_alerts": {\n    "name": "hardware_warning_alerts",\n    "type": "alert",\n    "aspects": {\n      "perspective": "hardware",\n      "severity": "kWarning"\n    }\n  },\n  "hardware_events": {\n    "name": "hardware_events",\n    "type": "event",\n    "aspects": {\n      "perspective": "hardware"\n    }\n  },\n  "top_user_vms_by_iops" : {\n    "name"       : "top_user_vms_by_iops",\n    "type"       : "topmetric",\n    "aspects"    : {\n      "entity" : "vm",\n      "metric" : "iops",\n      "count"  : 10\n    }\n  },\n  "top_user_vms_by_io_latency" : {\n    "name"       : "top_user_vms_by_io_latency",\n    "type"       : "topmetric",\n    "aspects"    : {\n      "entity" : "vm",\n      "metric" : "latency",\n      "count"  : 10\n    }\n  },\n  "top_user_vms_by_memory_usage": {\n    "name": "top_user_vms_by_memory_usage",\n    "type": "topmetric",\n    "aspects": {\n      "entity": "vm",\n      "metric": "memoryUsage",\n      "count": 10\n    }\n  },\n  "top_user_vms_by_cpu_usage": {\n    "name": "top_user_vms_by_cpu_usage",\n    "type": "topmetric",\n    "aspects": {\n      "entity": "vm",\n      "metric": "cpuUsage",\n      "count": 10\n    }\n  },\n  "vm_critical_alerts": {\n    "name": "vm_critical_alerts",\n    "type": "alert",\n    "aspects": {\n      "perspective": "vm",\n      "severity": "kCritical"\n    }\n  },\n  "vm_warning_alerts": {\n    "name": "vm_warning_alerts",\n    "type": "alert",\n    "aspects": {\n      "perspective": "vm",\n      "severity": "kWarning"\n    }\n  },\n  "vm_events": {\n    "name": "vm_events",\n    "type": "event",\n    "aspects": {\n      "perspective": "vm"\n    }\n  },\n  "data_protection_summary": {\n    "name": "data_protection_summary",\n    "type": "summary",\n    "aspects": {\n      "type": "dr"\n    }\n  },\n  "ongoing_replication": {\n    "name": "ongoing_replication",\n    "type": "entity",\n    "aspects": {\n      "entity": "replication",\n      "type": "ongoing"\n    }\n  },\n  "pending_replication": {\n    "name": "pending_replication",\n    "type": "entity",\n    "aspects": {\n      "entity": "replication",\n      "type": "pending"\n    }\n  },\n  "last_successful_replication": {\n    "name": "last_successful_replication",\n    "type": "entity",\n    "aspects": {\n      "entity": "replication",\n      "type": "lastSuccess"\n    }\n  },\n  "bandwidth_tx": {\n    "name": "bandwidth_tx",\n    "type": "performance",\n    "aspects": {\n      "entity": "cluster",\n      "metric": "bandwidthTransferred"\n    },\n    "actions": [\n      "chartRedirect"\n    ]\n  },\n  "bandwidth_rx": {\n    "name": "bandwidth_rx",\n    "type": "performance",\n    "aspects": {\n      "entity": "cluster",\n      "metric": "bandwidthReceived"\n    },\n    "actions": [\n      "chartRedirect"\n    ]\n  },\n  "top_remote_sites_by_bandwidth_tx": {\n    "name": "top_remote_sites_by_bandwidth_tx",\n    "type": "topmetric",\n    "aspects": {\n      "entity": "remote_site",\n      "metric": "bandwidthTransferred",\n      "count": 5\n    }\n  },\n  "top_remote_sites_by_bandwidth_rx": {\n    "name": "top_remote_sites_by_bandwidth_rx",\n    "type": "topmetric",\n    "aspects": {\n      "entity": "remote_site",\n      "metric": "bandwidthReceived",\n      "count": 5\n    }\n  },\n  "protection_critical_alerts": {\n    "name": "protection_critical_alerts",\n    "type": "alert",\n    "aspects": {\n      "perspective": "dr",\n      "severity": "kCritical"\n    }\n  },\n  "protection_warning_alerts": {\n    "name": "protection_warning_alerts",\n    "type": "alert",\n    "aspects": {\n      "perspective": "dr",\n      "severity": "kWarning"\n    }\n  },\n  "protection_events": {\n    "name": "protection_events",\n    "type": "event",\n    "aspects": {\n      "perspective": "dr"\n    }\n  },\n  "ImpactedCluster": {\n    "name": "impacted_cluster",\n    "type": "table",\n    "size": "l",\n    "aspects": {\n      "type": "ClusterStats",\n      "entity": "cluster"\n    }\n  },\n  "ClusterInfo": {\n    "name": "cluster_info",\n    "type": "table",\n    "size": "l",\n    "aspects": {\n      "type": "ClusterStats",\n      "entity": "cluster",\n      "entityId": ""\n    }\n  },\n  "clusterRunway": {\n    "name": "cluster_runway",\n    "type": "table",\n    "size": "l",\n    "aspects": {\n      "type": "Runway",\n      "entity": "cluster"\n    }\n  },\n  "clusterStorage": {\n    "name": "cluster_storage",\n    "type": "table",\n    "size": "l",\n    "aspects": {\n      "type": "Storage",\n      "entity": "cluster"\n    }\n  },\n  "clusterCPUUsage": {\n    "name": "cluster_cpu_usage",\n    "type": "table",\n    "size": "l",\n    "aspects": {\n      "type": "CPUUsage",\n      "entity": "cluster"\n    }\n  },\n  "controllerIOPS": {\n    "name": "controller_iops",\n    "type": "table",\n    "size": "l",\n    "aspects": {\n      "type": "IOPS",\n      "entity": "cluster"\n    }\n  },\n  "clusterLatency": {\n    "name": "cluster_latency",\n    "type": "table",\n    "size": "l",\n    "aspects": {\n      "type": "Latency",\n      "entity": "cluster"\n    }\n  },\n  "clusterMemoryUsage": {\n    "name": "cluster_memory_usage",\n    "type": "table",\n    "size": "l",\n    "aspects": {\n      "type": "MemoryUsage",\n      "entity": "cluster"\n    }\n  },\n  "Performance": {\n    "name": "performance",\n    "type": "table",\n    "size": "l",\n    "aspects": {\n      "type": "Performance",\n      "entity": "cluster"\n    }\n  },\n  "Tasks": {\n    "name": "tasks",\n    "type": "table",\n    "size": "l",\n    "aspects": {\n      "type": "Tasks",\n      "entity": "task"\n    }\n  },\n  "clusterQuickAccess": {\n    "name": "cluster_quick_access",\n    "type": "quickaccess",\n    "size": "l",\n    "aspects": {\n      "entity": "cluster"\n    }\n  },\n  "recoveryPlanStatus": {\n    "name": "recovery_plan_status",\n    "type": "rp_status",\n    "size": "l",\n    "aspects": {\n      "entity": "recovery_plan"\n    }\n  },\n  "protectionStatus": {\n    "name": "protection_status",\n    "type": "protection_status",\n    "size": "l",\n    "aspects": {\n      "entity": "protection_rule"\n    }\n  },\n  "prism_central_capacity": {\n    "name": "prism_central_capacity",\n    "type": "summary",\n    "size": "l",\n    "aspects": {\n      "entity": "cluster",\n      "type": "pc-capacity"\n    }\n  },\n  "prism_central_cluster": {\n    "name": "prism_central_cluster",\n    "type": "summary",\n    "size": "l",\n    "aspects": {\n      "entity": "cluster",\n      "type": "pc-cluster"\n    }\n  },\n  "prism_central_vms": {\n    "name": "prism_central_vms",\n    "type": "summary",\n    "size": "xxxl",\n    "aspects": {\n      "entity": "cluster",\n      "type": "pc-vms"\n    }\n  },\n  "prism_central_critical_alerts": {\n    "name": "prism_central_critical_alerts",\n    "type": "pc_alert",\n    "size": "l",\n    "aspects": {\n      "entity": "cluster",\n      "severity": "kCritical"\n    }\n  },\n  "prism_central_warning_alerts": {\n    "name": "prism_central_warning_alerts",\n    "type": "pc_alert",\n    "aspects": {\n      "entity": "cluster",\n      "severity": "kWarning"\n    }\n  },\n  "prism_central_info_alerts": {\n    "name": "prism_central_info_alerts",\n    "type": "pc_alert",\n    "size": "l",\n    "aspects": {\n      "entity": "cluster",\n      "severity": "kInfo"\n    }\n  },\n  "launchApps": {\n    "name": "launch_apps",\n    "type": "launch_apps",\n    "size": "l",\n    "aspects": {\n    }\n  },\n  "reports" : {\n    "name" : "reports",\n    "type" : "reports",\n    "size" : "m",\n    "aspects": {\n      "entity": "report_config"\n    }\n  },\n  "xplay_summary": {\n    "name": "xplay_summary",\n    "type": "table",\n    "size": "l",\n    "aspects": {\n      "type": "xplay_summary",\n      "entity": "action_rule_result"\n    }\n  }\n}\n'}),define("models/dashboard/DashboardLayoutUtil",["text!extras/dashboard/dashboard-layouts.json","text!extras/dashboard/vantagepoints.json","utils/AppConstants","utils/AppUtil","data/DataProperties"],function(e,t,i,n,s){"use strict";var a=function(){var i,a;try{i=JSON.parse(e),a=JSON.parse(t),_.each(i,function(e){var t=e.vantagePoints;t&&t.length&&_.each(t,function(e,i){var n=e[s.ID];if(n){var r=a[n];r&&(t[i]=$.extend({},r,e))}})})}catch(e){n.log("DashboardLayoutUtil: Failed to read json files for dashboard layouts"+e),i={}}return i}();return{getDashboardLayout:function(e){var t;if(a[e])t=a[e];else{t=a[i.PERSPECTIVE_DEFAULT]}return t=$.extend(!0,{},t),this._customizeDashbaordLayout(e,t)},_customizeDashbaordLayout:function(e,t){return t}}}),define("models/genesis/DiscoverNdpV2NodesModel",["models/genesis/GenesisBaseModel","utils/AppConstants"],function(e,t){"use strict";return e.extend({name:"DiscoverNdpV2NodesModel",methodName:t.NODE_MANAGER_METHODS.DISCOVER_NDP_V2_NODES,managerName:t.GENESIS.NODE_MANAGER,DP:{ENTITY_TYPE:"entity_type"},APP_ENTITY_TYPES:["ptvm","lenovo_lxcivm"],DELL_ENTITY_TYPES:["ptvm"],getApps:function(){var e=this;return _.filter(this.getReturnResponse(),function(t){return e.APP_ENTITY_TYPES.indexOf(t[e.DP.ENTITY_TYPE])>-1})},hasDellApp:function(){var e=this;return _.some(this.getApps(),function(t){return e.DELL_ENTITY_TYPES.indexOf(t[e.DP.ENTITY_TYPE])>-1})}})}),define("managers/DashboardManager",["models/dashboard/DashboardModel","models/dashboard/DashboardCollection","models/dashboard/DashboardLayoutUtil","models/genesis/DiscoverNdpV2NodesModel","data/DataProperties","managers/BaseManager","managers/ClusterManager","managers/AccessManager","managers/NotificationManager","managers/NavigationManager","utils/AppConstants","utils/AppUtil"],function(e,t,i,n,s,a,r,o,l,c,u,d){"use strict";var h=_.template('Failed to <%=action%> dashboard <%=name || "" %>.');return a.extend({MAX_VANTAGE_POINTS:32,MAX_TITLE_LENGTH:255,EVENTS:{FETCH_DASHBOARDS:"dashboards:fetch",ERROR:"dashboard:error",SUCCESS:"dashboard:success",REFRESH_DASHBOARD:"dashboard:reset",DELETE_DASHBOARD:"dashboard:delete",ADD_VANTAGEPOINT:"dashboard:addvantagepoint"},name:"DashboardManager",dashboardCollection:null,discoverNdpV2NodesModel:null,currentDashboard:null,initialFetchComplete:!1,initialize:function(){this.dashboardCollection=new t,this.discoverNdpV2NodesModel=new n},startServices:function(){var e=this;if(this.isCustomDashboardsEnabled())return void this.fetchOnDemand().done(function(){e.checkAndCreatePreDefinedDashboard()}).fail(function(){l.showClientNotification(u.NOTIFY_ERROR,e.i18n("error_dashboard_initial_fetch"),{temporary:!1})}).always(function(){e.initialFetchComplete=!0});this.initialFetchComplete=!0},stopServices:function(){},fetchOnDemand:function(e){var t=this,i={success:function(){e||t.triggerEvent(t.EVENTS.FETCH_DASHBOARDS,t.dashboardCollection)},error:function(){e||t.triggerErrorMsg(t.i18n("error_dashboards_retrieve")),d.logDebug("DashboardManager | fetchOnDemand | Failed to fetch dashboards.")},parse:!0};return this.dashboardCollection.fetch(i)},registerDashboardListener:function(e,t,i){this.dashboardCollection.on(e,t,i)},unregisterDashboardListener:function(e,t,i){this.dashboardCollection.off(e,t,i)},getDashboards:function(){return _.reject(this.dashboardCollection.models,function(e){return e.isDefaultDashboard()})},getAllDashboards:function(){return this.dashboardCollection?this.dashboardCollection.models:[]},deleteDashboard:function(e){var t=this,i=function(){var i=t.getCustomDashboardById(e);if(!i)return void d.logDebug("DashboardManager : deleteDashboard : The dashboard with id "+e+" does not exist.");var n={success:function(){i.getId()===t.getCurrentDashboard().getId()&&t.triggerEvent(t.EVENTS.DELETE_DASHBOARD,i),t.dashboardCollection.remove(i),t.triggerEvent(t.EVENTS.FETCH_DASHBOARDS)},error:function(){t.triggerErrorMsg(h({action:"remove",name:i.getTitle()}))}};i.destroy(n)};this.fetchOnDemand(!0).done(i)},addDashboard:function(t,i){var n=this,s=function(){if(n._validateDashboardTitle(t)){var s=new e;s.set({title:t});var a={success:function(){n.dashboardCollection.add(s),n.triggerEvent(n.EVENTS.FETCH_DASHBOARDS),i&&i(),c.navigateToPage(u.PAGE_MC_DASHBOARD,s.getId())},error:function(){n.triggerErrorMsg(h({action:"add"}))}};s.save(s.DP.CREATE,a)}};this.fetchOnDemand(!0).done(s)},getDashboard:function(e){var t=this.getCustomDashboardById(e);return t||(t=this.getPreDefinedDashboard(e)),d.debugObject("DashboardManager getDashboard ",t),t},getDashboardByName:function(e){return this.dashboardCollection.find(function(t){if(t.get(t.DP.TITLE)===e)return!0})},getCustomDashboardById:function(e){var t;return this.dashboardCollection&&(t=this.dashboardCollection.findModelById(e)),t},getPreDefinedDashboard:function(t){var n,a=i.getDashboardLayout(t);return n=new e(a,{parse:!0}),n.set(s.ID,t),n},editDashboard:function(e,t){var i=this,n=function(){var n=i.getCustomDashboardById(e);n||i.triggerErrorMsg(i.i18n("error_dashboard_not_found"));var s=n?n.getTitle():null;if(i._validateDashboardTitle(t,s)){n.set(n.DP.TITLE,t);var a={success:function(){n.getId()===i.getCurrentDashboard().getId()&&i.triggerEvent(i.EVENTS.REFRESH_DASHBOARD),i.triggerEvent(i.EVENTS.FETCH_DASHBOARDS)},error:function(){i.triggerErrorMsg(h({action:"update",name:n.getTitle()}))}};n.save(n.DP.UPDATE,a)}};this.fetchOnDemand(!0).done(n)},resetDashboardToDefault:function(e){var t=this.getDashboard(e),n=i.getDashboardLayout(e);t.set(n),t.resetDisableVantagePointAutoAdd();var s=this,a={success:function(){t.fetch().done(function(){s.dashboardCollection.add(t),s.setCurrentDashboard(e),s.triggerEvent(s.EVENTS.REFRESH_DASHBOARD),s._checkAndAddLaunchAppWidget()}).fail(function(){s.triggerErrorMsg(s.i18n("error_dashboard_fetch_reset"))})},error:function(){s.triggerErrorMsg(h({action:"reset",name:t.getTitle()}))}};this.getCustomDashboardById(e)?t.save(t.DP.UPDATE,a):t.save(t.DP.CREATE,a)},resetAllDashboardsToDefault:function(){var e=new $.Deferred,t=this;return this.fetchOnDemand(!0).done(function(){for(var i,n=t.dashboardCollection,s=[];i=n.first();)s.push(i.destroy());$.whenAll.apply($,s).done(function(){_.every(s,function(e){return e.isResolved()})?e.resolve():e.reject()})}),e.promise()},savePreDefinedDashboard:function(e){var t=this.getPreDefinedDashboard(e),i=this,n={success:function(){t.fetch().done(function(){i.dashboardCollection.add(t),i.triggerEvent(i.EVENTS.FETCH_DASHBOARDS)})},error:function(){d.logDebug(h({action:"save pre-defined",name:t.getTitle()}))}};t.save(t.DP.CREATE,n,!1)},setCurrentDashboard:function(e){this.currentDashboard=e},getCurrentDashboard:function(){return this.getDashboard(this.currentDashboard)},getVantagePoints:function(){var e=this.getCurrentDashboard();return e.get(e.DP.VANTAGE_POINTS)},addVantagePoint:function(e,t){var i=this,n=i.getCurrentDashboard(),s=_.defaults({},t,{success:function(){},error:function(){},always:function(){}}),a=function(){var t=i.getVantagePoints();if(t&&t.length>=i.MAX_VANTAGE_POINTS)return i.triggerErrorMsg(i.i18ns("error_max_vantage_points",i.MAX_VANTAGE_POINTS)),void s.error();n.addVantagePoint(e).done(function(){n.fetch().done(function(){i.dashboardCollection.add(n),i.triggerEvent(i.EVENTS.ADD_VANTAGEPOINT,e),s.success()}).fail(function(){i.triggerErrorMsg(i.i18n("error_dashboard_fetch")),s.error()}).always(function(){s.always()})}).fail(function(){i.triggerErrorMsg(h({action:"add widget to",name:n.getTitle()}))})};n.fetch().done(a).fail(function(){i.triggerErrorMsg(i.i18n("error_dashboard_fetch"))})},saveVantagePoints:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=this,n=i.getCurrentDashboard(),a=n.get(s.USER_DATA_UPDATED_TIME);d.showLoader(" ");var r=function(){var r=n.get(s.USER_DATA_UPDATED_TIME);if(a!==r)return i.triggerEvent(i.EVENTS.REFRESH_DASHBOARD),i.triggerErrorMsg(i.i18n("error_dashboard_collision")),i.dashboardCollection.add(n),void d.hideLoader();n.set(n.DP.VANTAGE_POINTS,e),n.save(n.DP.UPDATE,null,t).fail(function(){i.triggerErrorMsg(h({action:"save",name:n.getTitle()}))}).always(function(){d.hideLoader()})};n.fetch().done(r).fail(function(){i.triggerErrorMsg(i.i18n("error_dashboard_fetch")),d.hideLoader()})},isInitialFetchComplete:function(){return this.initialFetchComplete},isCustomDashboardsEnabled:function(){return o.isFFEnabled(u.FFLAGS.CUSTOM_DASHBOARDS)&&!o.isSspOnlyUser()},checkAndCreatePreDefinedDashboard:function(){var e=u.PERSPECTIVE_DASHBOARD;r.isMulticlusterNavMode()&&(e=u.PERSPECTIVE_DELOS),this.isCustomDashboardsEnabled()&&!this.getCustomDashboardById(e)&&this.savePreDefinedDashboard(e),this._checkAndAddLaunchAppWidget()},_checkAndAddLaunchAppWidget:function(){var e=this;if(!o.isClusterViewerOnly()){var t=this.getDashboard(u.PERSPECTIVE_DELOS);t.get(t.DP.DISABLE_LAUNCH_APPS_AUTO_ADD)||this.discoverNdpV2NodesModel.fetch().done(function(){e.discoverNdpV2NodesModel.hasDellApp()&&e._autoAddLaunchAppWidget(t)})}},_autoAddLaunchAppWidget:function(e){var t=this;this.fetchOnDemand(!0).done(function(){var i=void 0,n=e.get(e.DP.VANTAGE_POINTS);if(!(i=_.find(n.models,function(e){if(e.get(s.VP_TYPE)===u.VP_TYPE.LAUNCH_APPS)return!0}))){var a=t.getPreDefinedDashboard(u.PERSPECTIVE_DELOS),r=a.get(a.DP.VANTAGE_POINTS);i=_.find(r.models,function(e){if(e.get(s.VP_TYPE)===u.VP_TYPE.LAUNCH_APPS)return!0}),n.add(i)}i.set(i.DP.AUTO_ADD,!0),i.unset(i.DP.POSITION);var o=t.getCustomDashboardById(u.PERSPECTIVE_DELOS);o?o.set(e):t.dashboardCollection.add(e),e.set(e.DP.DISABLE_LAUNCH_APPS_AUTO_ADD,!0),t.triggerEvent(t.EVENTS.REFRESH_DASHBOARD)})},_validateDashboardTitle:function(e,t){return e&&0!==e.length?e.length>this.MAX_TITLE_LENGTH?(this.triggerErrorMsg(this.i18ns("error_dashboard_max_title",this.MAX_TITLE_LENGTH)),!1):t===e||!this.getDashboardByName(e)||(this.triggerErrorMsg(this.i18n("error_dashboard_name_same")),!1):(this.triggerErrorMsg(this.i18n("error_dashboard_name_empty")),!1)},triggerEvent:function(e,t,i){_.isString(t)&&(i=t,t=this.dashboardCollection),this.dashboardCollection.trigger(e,t,i)},triggerErrorMsg:function(e){this.triggerEvent(this.EVENTS.ERROR,e)}})}),define("text!templates/navigation/MenuSetupView.html",[],function(){return'<div class="n-setup-menu">\n  <div class="n-header">\n    <%= header %> (<%=current%> of <%=total%> steps)\n  </div>\n  <div\n      class="n-cps-pre-deployment-notification n-menu-setup-loading">\n    \x3c!-- Display copy of CPS bits in case of laJolla cluster. --\x3e\n  </div>\n  <div class="n-setup-list">\n    <ul class="n-menu-setup-list">\n      <% _.each(steps, function(step, index) { %>\n        <li class="n-nav-menu-setup-item">\n          \x3c!-- Display the checkmark or index for the steps. --\x3e\n          <% if (current > (index+1)) { %>\n            <%=SVG.SVGIcon(\'J\', \'n-complete-icon\')%>\n          <% } else { %>\n            <span class="index-count"> <%=index+1%>. </span>\n          <% } %>\n          \x3c!-- Display the step --\x3e\n          <%=step%>\n          \x3c!-- Display dot for the current step. --\x3e\n          <% if (current === (index+1)) { %>\n            <span class="curr-step"/>\n          <% } %>\n        </li>\n      <% }) %>\n    </ul>\n  </div>\n</div>\n'}),define("views/basecomponents/navigation/MenuSetupView",["views/basecomponents/navigation/MenuView","views/navigation/MenuDescriptor","text!templates/navigation/MenuSetupView.html","utils/SVG"],function(e,t,i,n){"use strict";return e.extend({menuItemTemplate:'<li class="n-nav-menu-item"><a></a></li>',menuTemplate:_.template(i),currIndex:0,totalSteps:0,name:null,HEADER_LABEL:"",events:{"click     .n-nav-menu-setup-item":"onMenuItemClick","mouseover .n-nav-menu-setup-item a":"onMouseOverMenuItem","mouseout  .n-nav-menu-setup-item a":"onMouseOutMenuItem"},render:function(){this.isDisplayMenu()&&this.showMenu()},showMenu:function(){var e=this.getMenuSteps();this.populateIndexAttributes(e);var i=this,s=[];_.each(e,function(e){var n=t[e],a=$(i.menuItemTemplate);_.each(n.attributes,function(e,t){$(a).find("a").attr(t,e)}),$(a).find("a").html(n.label),s.push(a.html())}),this.$el.prepend(this.menuTemplate({header:this.HEADER_LABEL,steps:s,total:this.totalSteps,current:this.currIndex+1,SVG:n}))},isDisplayMenu:function(){return!1},getMenuSteps:function(){return[]},isStepComplete:function(e){return!1},getName:function(){return this.name},onMenuItemClick:function(t,i){t.preventDefault();var n=i||$(t.currentTarget).find("a");$(n).closest(".n-nav-menu-setup-item").find(".curr-step").length&&e.prototype.onMenuItemClick.apply(this,arguments)},onMouseOverMenuItem:function(e){$(e.currentTarget).addClass("n-hover")},onMouseOutMenuItem:function(e){$(e.currentTarget).removeClass("n-hover")},populateIndexAttributes:function(e){this.totalSteps=e.length,this.currIndex=0;for(var t=0;t<e.length&&this.isStepComplete(e[t]);t++)this.currIndex++}})}),define("models/genesis/LajollaGetDvmDeploymentStatus",["models/genesis/LajollaGenesisBaseModel","utils/AppConstants"],function(e,t){"use strict";return e.extend({ERROR_MSG:"Failed to get DVM deployment status",name:"LajollaGetDvmDeploymentStatus",methodName:t.CLUSTER_MANAGER_METHODS.GET_DVM_DEPLOYMENT_STATUS,getReturnResponse:function(){return this.get(e.DP.GENESIS_RETURN)||[]}})}),define("views/navigation/HypervMenuSetupView",["managers/ClusterManager","managers/TaskManager","views/basecomponents/navigation/MenuSetupView","views/navigation/MenuDescriptor","models/genesis/LaJollaClusterModel","models/genesis/LajollaGetDvmDeploymentStatus","data/DataProperties","utils/HypervisorUtil","utils/AppUtil","utils/AppConstants","events/AppEvents"],function(e,t,i,n,s,a,r,o,l,c,u){"use strict";var d={IS_FAILOVER_CLUSTER_COMPLETE:"allHypervNodesInFailoverCluster",IS_DOMAIN_JOIN_COMPLETE:"nosClusterAndHostsDomainJoined"};return i.extend({name:"HypervSetup",DP:d,clusterModel:null,isFailoverClusterComplete:!1,isDomainJoinComplete:!1,isCpsDeploymentComplete:!1,isLajollaCluster:!1,isEventAttached:!1,HEADER_LABEL:"Complete Cluster Setup",render:function(){if(this.isDisplayMenu()){this.showMenu();var e=t.getGlobalTasks().getLaJollaPreDeploymentTask();e&&(e.isStatusQueued()||e.isStatusActive())?(this.hideMenuSteps(),this.showPreDeploymentTemplate(),this.applyNutanixInput()):this.checkDvmStatus()}},onStartServices:function(){if(this.clusterModel=e.getCurrentClusterModel(),this.clusterModel){this.isFailoverClusterComplete=this.clusterModel.get(d.IS_FAILOVER_CLUSTER_COMPLETE),this.isDomainJoinComplete=this.clusterModel.get(d.IS_DOMAIN_JOIN_COMPLETE);o.hasHyperV(this.clusterModel.get(r.CLUSTER_UUID))?(this.checkLaJollaCapability(),e.attachEventHandler("reset",this.checkLaJollaCapability,this)):e.attachEventHandler("reset",this.checkAndRefreshMenu,this)}else e.attachEventHandler("reset",this.checkAndRefreshMenu,this)},onStopServices:function(){this.clusterModel=null,this.isFailoverClusterComplete=!1,this.isDomainJoinComplete=!1,this.isCpsDeploymentComplete=!1,e.detachEventHandler("reset",this.checkAndRefreshMenu,this)},checkDvmStatus:function(){var e=this;if(this.isLajollaCluster){var t=new a;t.fetch({success:function(i,n){var s=t.getReturnResponse(),a=e.$('[actiontarget="hyperv_cps_deployment"]');if(s)switch(s){case"Running":a.prop("disabled",!0),a.prop("title","CPS Deployment in progress");break;case"Completed":e.isCpsDeploymentComplete=!0,e.clusterModel.get(d.IS_FAILOVER_CLUSTER_COMPLETE)&&e.checkAndRefreshMenu();break;case"Failed":a.prop("disabled",!1),a.removeProp("title")}}})}},checkLaJollaCapability:function(){var t=this,i=new s;i.fetch({success:function(n,s){!0===i.getReturnResponse()&&(t.isLajollaCluster=!0,e.detachEventHandler("reset",t.checkLaJollaCapability,t)),t.isEventAttached||(t.isEventAttached=!0,e.attachEventHandler("reset",t.checkAndRefreshMenu,t))},error:function(e,t){l.log("Error in fetching LaJolla model")}})},isStepComplete:function(e){return e===c.ENTITY_HYPERV_FAILOVER_CLUSTER?this.clusterModel.get(d.IS_FAILOVER_CLUSTER_COMPLETE):e===c.ENTITY_HYPERV_DOMAIN_JOIN&&this.clusterModel.get(d.IS_DOMAIN_JOIN_COMPLETE)},hideMenuSteps:function(){var e=$(".n-setup-menu");e.find(".n-header").remove(),e.find(".n-setup-list").remove(),e.find(".n-steps").remove()},showPreDeploymentTemplate:function(){this.$(".n-cps-pre-deployment-notification").html('<div class="n-menu-setup-list control-group"><div class="controls loader"><div class="no-data page-loading-message"><div class="donut-loader-gray-background"></div>  Copying CPS bits. This may take few minutes...</div></div></div>')},getMenuSteps:function(){var e=n.getHypervClusterSetupSteps();return this.isLajollaCluster&&e.push(c.ENTITY_HYPERV_CPS_DEPLOYMENT),e},isDisplayMenu:function(){if(!e.isMulticlusterNavMode()&&this.clusterModel&&o.hasHyperV(this.clusterModel.get(r.CLUSTER_UUID))){var t=this.clusterModel.get(d.IS_FAILOVER_CLUSTER_COMPLETE);if(this.isLajollaCluster){var i=this.isCpsDeploymentComplete;if(void 0!==t)return!(i&&t)}else if(void 0!==t)return!t}return!1},checkAndRefreshMenu:function(){var t=e.getCurrentClusterModel();if(t){var i=t.get(d.IS_FAILOVER_CLUSTER_COMPLETE),n=t.get(d.IS_DOMAIN_JOIN_COMPLETE);this.clusterModel=t,this.isFailoverClusterComplete=i,this.isDomainJoinComplete=n,u.triggerAppEvent(u.REFRESH_SETUP_MENU,this.name),(n||i)&&u.triggerAppEvent(u.REFRESH_SETTINGS_MENU)}}})}),define("managers/SetupMenuManager",["views/navigation/HypervMenuSetupView","views/basecomponents/navigation/MenuView","utils/SubViewHelper","utils/AppUtil","events/AppEvents"],function(e,t,i,n,s){"use strict";return{subViewHelper:null,initialize:function(){this.subViewHelper=new i,this.subViewHelper.register("HypervSetup",new e),this.subViewHelper.iterate("initialize")},startServices:function(){this.subViewHelper.iterate("startServices"),$("body").on(s.REFRESH_SETUP_MENU,$.proxy(this.renderMenu,this))},stopServices:function(){this.subViewHelper.iterate("stopServices"),$("body").off(s.REFRESH_SETUP_MENU,$.proxy(this.renderMenu,this))},renderMenu:function(){var e=this.getMenu(),t=$(".n-navigation .n-help-menu");t.find(".n-setup-menu").remove(),e&&(e.setElement(t),e.render()),this.renderStyles()},getMenu:function(){var e=this.subViewHelper.getIds(),t=null;return _.each(e,function(e){var i=this.subViewHelper.get(e);i.isDisplayMenu()&&(t=i)},this),t},renderStyles:function(){
var e=$(".n-navigation .n-help"),i=e.find(".gear-icon"),s=e.find(".n-help-menu");if(this.getMenu()){e.addClass("n-menu-active"),n.addSVGClass(i,"settings-to-do");var a=new t({el:s});s.addClass("cluster-setup"),a.undelegateEvents(),a.open()}else n.removeSVGClass(i,"settings-to-do")}}}),define("views/navigation/BaseNavigationView",["views/header/alert/AlertView","views/header/task/TaskServiceView","views/basecomponents/spotlight/SpotlightView","views/basecomponents/BaseView","views/basecomponents/navigation/MenuView","managers/TutorialManager","managers/NavigationManager","managers/NamespaceManager","managers/ActionManager","managers/PopupManager","managers/ClusterManager","managers/AlertManager","managers/TaskManager","managers/LicenseManager","managers/prechecks/PreCheckManager","managers/HealthManager","managers/PrismElementManager","managers/IQSearchManager","managers/DashboardManager","managers/SetupMenuManager","managers/CommunityEditionManager","managers/ExploreManager","data/DataProperties","utils/AppConstants","utils/AppUtil","events/AppEvents","utils/SubViewHelper","utils/SVG","components/Components","views/navigation/MenuDescriptor","models/systemdata/SystemDataModel"],function(e,t,i,n,s,a,r,o,l,c,u,d,h,p,T,E,S,g,A,m,f,I,C,v,R,N,P,O,y,D,M){"use strict";return n.extend({LEFT:"left",RIGHT:"right",KEYS:{A:65,D:68,F:70,H:72,I:73,M:77,N:78,O:79,P:80,S:83,T:84,U:85,FWD_SLASH:191},headerAlertView:null,headerTaskView:null,activeNavObject:null,lastHighlightNavObject:null,subViewHelper:null,settingsPage:!1,currentPageId:null,events:{"click .n-main-menu-btn":"onMenuClick","click .n-settings-btn":"onMenuClick","click .n-user-btn":"onMenuClick","click .n-help-btn":"onMenuClick","click .n-spotlight-btn":"onSpotlightClick","click .search-tutorial":"onSearchTutorialIconClick","click .n-logo-link":"onLogoClick","click .n-header-alerts":"onButtonClick","click .n-task-wrapper":"onButtonClick","click .n-header-cluster-health":"onClusterHealthClick"},initialize:function(){n.prototype.initialize.apply(this,arguments),_.bindAll(this,"onMenuClick","onDocumentClick","onSpotlightClick","onSpotlightCleanup","spotlightHide","onNavMenuUpdate","onGlobalKeyDown","_closeCurrentMenu","onMulticlusterMenuClick","onRefreshSettingMenu","onRefreshUserMenu","populateSettingsMenuCallback"),this.subViewHelper=new P,D.initialize(),this.render()},render:function(){this.$el.html(this.template),this.headerAlertView=new e({el:this.$(".n-header-alerts")}),this.headerTaskView=this.getHeaderTasksView();var t={};t.position={my:"right top",at:"right bottom",collision:"none"},t.minLength=1,t.localCommands=!0,t.className="n-spotlight-header-results",t.clearOnSelect=!0;var n=new i({el:this.$(".n-spotlight-control")},t);this.subViewHelper.register("spotlight",n),this.$el.on(N.NAV_MENU_UPDATE,this.onNavMenuUpdate),this.$el.on(N.NAV_MENU_CLOSE,this._closeCurrentMenu),this.setNavigationTips(),this.refreshUsername()},getViewTemplateObject:function(e){return _.extend({this:this,SVG:O,Components:y,isBrandingHX:u.isBrandingHX(),isCE:f.isCommunityEditionCluster()},e)},getHeaderTasksView:function(){return new t({el:this.$(".n-header-tasks")})},updateGlobalKeyEvent:function(e){$(document).off("keydown",this.onGlobalKeyDown),e&&$(document).on("keydown",this.onGlobalKeyDown)},onStartServices:function(){u.hasClusterData()?(u.isMulticlusterUI()?this.$(".n-multi-nav-bar a").on("click",this.onMulticlusterMenuClick):this.$(".n-multi-nav-bar a").not(".n-logo-link").on("click",this.onSingleClusterLinkClick),this.$el.on(N.NAV_MENU_CLOSE,this._closeCurrentMenu),this.updateGlobalKeyEvent(!0),u.isPrismElementIFrameMode()||(this.headerAlertView.startServices(),this.startUniversalManagers()),this.onNavMenuUpdate(),this.setClusterId(u.getCurrentClusterId()),this.resetAllMenus(),this.populateAllMenus(),N.onAppEvent(N.REFRESH_SETTINGS_MENU,this.onRefreshSettingMenu),N.onAppEvent(N.REFRESH_USER_MENU,this.onRefreshUserMenu)):R.log("BaseNavigationView: onStartServices: Failed to start services on the navigation view because the cluster data  has not been received.")},onStopServices:function(){this.headerAlertView.stopServices(),this.stopUniversalManagers(),this._closeCurrentMenu(null,this.$el),this.$(".n-multi-nav-bar a").off("click"),this.$(".n-spotlight-control").off(N.SPOTLIGHT_CLEANUP),this.$el.off(N.NAV_MENU_CLOSE),$(document).off("click",this.onDocumentClick),N.offAppEvent(N.REFRESH_SETTINGS_MENU,this.onRefreshSettingMenu),N.offAppEvent(N.REFRESH_USER_MENU,this.onRefreshUserMenu),this.updateGlobalKeyEvent(!1)},destroy:function(){R.debug("BaseNavigationView  | destroy | ",this.cid),o.get(o.HEALTH_MANAGER).unregisterHealthListener("change",this.updateHealthIcon,this),this.$(".n-spotlight-control").off(N.SPOTLIGHT_CLEANUP),this.$el.off(N.NAV_MENU_UPDATE),this.$el.off(N.NAV_MENU_CLOSE),$(document).off("click",this.onDocumentClick),this.updateGlobalKeyEvent(!1),this.$(".n-multi-nav-bar a").off("click"),$("body .container-fluid .nav-backdrop").off("click"),this.isInitialized=!1,this.subViewHelper.removeAll(),this.subViewHelper=null,n.prototype.destroy.apply(this,arguments)},refreshView:function(){this.destroy(),this.render(),this.delegateEvents(),this.refreshUsername()},setNavigationTips:function(){var e=p.getLicenseModel(),t=function(){var e=p.isPrismProFeaturesEnabled();a.hasSeenTutorial(v.LOCAL_STORAGE.TUTORIAL_SEARCH)||!e?this.deactivateTutorialTips():this.activateTutorialTips(),p.unregisterListener("change",t,this)}.bind(this);e&&e.getState()===v.STATE_SUCCESS?t():p.registerListener("change",t,this)},activateTutorialTips:function(){this.$(".search-tutorial").removeClass("hide")},deactivateTutorialTips:function(){this.$(".search-tutorial").addClass("hide")},setClusterId:function(e){this.$el.data(C.CLUSTER_ID,e)},getClusterId:function(){return this.$el.data(C.CLUSTER_ID)},getSpotlightView:function(){if(this.subViewHelper)return this.subViewHelper.get("spotlight")},startUniversalManagers:function(){d.startServices(),A.startServices()},stopUniversalManagers:function(){d.stopServices(),d.clearAlertCollection(),A.stopServices()},startSingleClusterManagers:function(){h.startServices(),E.startServices(),T.startServices(),m.startServices()},stopSingleClusterManagers:function(){h.stopServices(),E.stopServices(),T.stopServices(),m.stopServices()},populateAllMenus:function(){var e=u.isMulticlusterNavMode();this._populateMainMenu(e);var t;t=u.isMulticlusterUI()||S.isLoadedFromPrismCentral()?D.USER_MENU_TYPE.SINGLE_CLUSTER_PROXY:D.USER_MENU_TYPE.SINGLE_CLUSTER,this._populateUserMenu(t),this.populateMenu(".n-help-menu",D.getHelpList(t)),this.populateSettingsMenu(e)},_populateMainMenu:function(e){this.populateMenu(".n-main-menu",D.getPageList(e)),this.currentPageId&&this.updateSelectedPage(this.currentPageId)},_populateUserMenu:function(e){var t=new M({type:C.SYSTEM_DATA_TYPE_UI_CONFIG},{enableNotifications:!1}),i=this,n=!0;t.fetch().done(function(){n=t.is2048Disabled()}).always(function(){var t=D.getUserList(e);if(n){var s=t.indexOf(v.EET);s>-1&&t.splice(s,1)}i.$(".n-user-menu > li").empty(),i.populateMenu(".n-user-menu",t)})},populateSettingsMenu:function(e){e=e||!1,D.getSettingsList(e,".n-settings-menu",this.populateSettingsMenuCallback)},populateSettingsMenuCallback:function(e,t){this.$(".n-settings-menu > li").empty(),this.populateMenu(e,t),this.populateSetupMenu()},onRefreshSettingMenu:function(){this.populateSettingsMenu(!1)},onRefreshUserMenu:function(){var e;e=u.isMulticlusterUI()||S.isLoadedFromPrismCentral()?D.USER_MENU_TYPE.SINGLE_CLUSTER_PROXY:D.USER_MENU_TYPE.SINGLE_CLUSTER,this._populateUserMenu(e)},populateMenu:function(e,t){var i=this.subViewHelper.get(e);i||(i=new s({el:this.$(e)}),this.subViewHelper.register(e,i));var n=".n-user-menu"===e;i.setMenuArray(t),i.render(n)},populateSetupMenu:function(){m.renderMenu()},resetAllMenus:function(){this.$(".n-main-menu").children().empty(),this.$(".n-user-menu").children().empty(),this.$(".n-help-menu").children().empty(),this.$(".n-settings-menu").children().empty()},updateSelectedPage:function(e){e&&(this.currentPageId=e);var t=D.getDescriptor(e);this.$el.find("span.n-nav-label").html(t&&t.label?t.label:"&nbsp;"),this.$(".n-main-menu li.active").removeClass("active"),this.$('.n-main-menu li a[pageid="'+e+'"]').parent().addClass("active")},refreshUsername:function(){var e,t=o.get(o.USER_DETAILS);t.userData&&t.userData.status&&t.userData.status.resources&&t.userData.status.resources.display_name?e=t.userData.status.resources.display_name:t.profile&&(e=t.profile.username),e?(this.$(".n-username").html(e.replace(/@.*$/g,"")),this.$(".n-username").attr("title",e)):this.$(".n-username").empty()},spotlightHide:function(e){this.$(".n-spotlight-control input").blur(),this.$(".n-spotlight-control").off(N.SPOTLIGHT_CLEANUP),this.$(".n-spotlight-control").hide(),this.$(".n-spotlight a").show(),this.$(".n-spotlight-control").removeClass("n-spotlight-active")},_closeCurrentMenu:function(e,t){var i=this.$(".n-menu-active"),n=!1;if(t=t||$(e.currentTarget),this.headerAlertView.isDropDownVisible()){this.$("div.n-header-alerts")[0]===$(t)[0]&&(n=!0),this.activeNavObject.close&&this.activeNavObject.close(),this.headerAlertView.collapseDropDown(),this.activeNavObject=null}if(this.headerTaskView.isDropDownVisible()&&(this.$(".n-task-wrapper")[0]===$(t)[0]&&(n=!0),this.headerTaskView.collapseDropDown(),this.activeNavObject=null),this.$(".n-spotlight-control").is(".n-spotlight-active"))if(0!==$(t).parent().length&&$(t).closest(".n-spotlight").length>0)n=!0;else{var s=this.getSubViewByElement(this.$(".n-spotlight-control"));s&&(s.stopSearch(),this.activeNavObject=null),this.spotlightHide(e)}return this.$(".n-cluster-name").hasClass("n-link-active")&&($(i)[0]===$(t)[0]&&(n=!0),this._deactivateClusterLink()),this.$(".n-multicluster-name").hasClass("n-link-active")&&($(i)[0]===$(t)[0]&&(n=!0),this._deactivateMulticlusterLink()),this.$(".n-header-cluster-health").hasClass("n-link-active")&&($(i)[0]===$(t)[0]&&(n=!0),this._deactivateClusterHealthIcon()),this.activeNavObject&&($(i)[0]===$(t)[0]&&(n=!0),this.activeNavObject.close&&this.activeNavObject.close(),this.activeNavObject=null,this.$(".n-menu-active").find(".n-nav-menu").removeClass("n-reveal-hidden n-preview-hidden"),this.$(".n-menu-active").removeClass("n-menu-active")),n},showMulticlusterPane:function(){if(!$("body .container-fluid .nav-backdrop").length){$("body .container-fluid").append('<div class="nav-backdrop"></div>'),$("body").css("overflow-x","hidden"),$("body .container-fluid").css("overflow","hidden"),$("body .container-fluid .nav-backdrop").on("click",this.onMulticlusterMenuClick),$(".navbar-fixed-top, body").addClass("sidebar-open"),$(".n-multicluster").addClass("open"),setTimeout(function(){$("body .container-fluid .nav-backdrop").addClass("sidebar-open")},20),setTimeout(function(){$("body").trigger(N.MULTICLUSTER_PANE_UPDATE)},200)}},hideMulticlusterPane:function(e){$("body .container-fluid .nav-backdrop").off("click"),"function"==typeof e&&e(),$(".container-fluid").removeClass("modal-backdrop"),$(".navbar-fixed-top, body, .nav-backdrop").removeClass("sidebar-open"),$(".n-multicluster").removeClass("open"),$("body .container-fluid").css("overflow","visible"),setTimeout(function(){$("body .container-fluid .nav-backdrop").remove()},200)},_getNosVersion:function(){return o.get(o.USER_SETTINGS).getUserSetting(C.CLUSTER_NOS_VERSION)},_shouldHighlightNetworkConfig:function(){if(o.get(o.USER_SETTINGS)){return!this._getNosVersion()&&(o.get(o.USER_SETTINGS).setUserSetting(C.CLUSTER_NOS_VERSION,u.getCurrentClusterFullVersion()),!0)}return!1},_checkForNetworkSeparation:function(){this._shouldHighlightNetworkConfig()?(this.activeNavObject.$('.n-nav-menu-item a:contains("Network Configuration")').find("div.segmentation-badge").length||(this.activeNavObject.$('.n-nav-menu-item :contains("Network Configuration")').prepend('<div class="segmentation-badge">&nbsp;</div>'),this.activeNavObject.$('.n-nav-menu-item a:contains("Network Configuration")').addClass("nw-segmentation")),this.activeNavObject.$(".segmentation-badge").show()):this.activeNavObject.$(".segmentation-badge").hide()},_openMenu:function(e,t){t=t||$(e.currentTarget),$(document).off("click",this.onDocumentClick),$(document).on("click",this.onDocumentClick);this.$(".n-menu-active");this.activeNavObject&&this._closeCurrentMenu(e,t)||($(t).addClass("n-menu-active"),this.activeNavObject=this.getSubViewByElement($(t).find("ul")),this.activeNavObject&&(this.activeNavObject.open(),this._checkForNetworkSeparation(),this.activeNavObject.$el.hasClass("n-main-menu")?this.activeNavObject.move(null,".active",e):"keydown"===e.type&&this.activeNavObject.toFirst(e)))},_highlightMenuElement:function(e){e.addClass("n-menu-active"),this.activeNavObject=this.lastHighlightNavObject={$el:e}},activateHighlightedMenuElement:function(e){if(e.stopPropagation(),this.activeNavObject!==this.lastHighlightNavObject)return void(this.lastHighlightNavObject=null);this.activeNavObject&&this.activeNavObject.$el&&this.activeNavObject.$el.click()},activateSpotlight:function(e){I.isEnableSearchConvergence()?this.$(".exp-search-input").focus():(this.onSpotlightClick(e),this.$(".n-spotlight input").val(""))},_activateClusterLink:function(){this.$(".n-cluster-name").addClass("n-link-active"),this.activeNavObject={$el:this.$(".n-cluster-name")}},_deactivateClusterLink:function(){this.$(".n-cluster-name").removeClass("n-link-active"),this.activeNavObject=null},_activateMulticlusterLink:function(){this.$(".n-multicluster-name").addClass("n-link-active"),this.activeNavObject={$el:this.$(".n-multicluster-name")}},_deactivateMulticlusterLink:function(){this.$(".n-multicluster-name").removeClass("n-link-active"),this.activeNavObject=null},_activateClusterHealthIcon:function(){this.$(".n-header-cluster-health").addClass("n-link-active"),this.activeNavObject={$el:this.$(".n-header-cluster-health")}},_deactivateClusterHealthIcon:function(){this.$(".n-header-cluster-health").removeClass("n-link-active"),this.activeNavObject=null},getSubViewByElement:function(e){return _.find(this.subViewHelper.subViews,function(t){return t.$el[0]===e[0]})},toggleMenu:function(e,t){if(!this.activeNavObject)return void this._openMenu(t,this.$(".n-main-menu-btn"));var i,n=this.$(".n-nav-toggle").get();e===this.LEFT&&n.reverse();var s,a,o=0;for(o=0;o<n.length&&(s=n[o]===this.activeNavObject.$el[0],a=$(n[o]).find(this.activeNavObject.$el).length>0,!s&&!a);o++);if(o===n.length)return void R.log("BaseNavigationView: Issue finding next available navigation object.");for(var l,c,u,d=o+1;;){if(d===n.length&&(d=0),l=0===$(n[d]).closest(".n-header-alerts").length&&0===$(n[d]).closest(".n-header-tasks").length,c=$(n[d]).closest(".n-header-alerts").length&&$(n[d]).find(".n-alert-button").is(":visible"),u=$(n[d]).closest(".n-header-tasks").length,l||c||u)break;if(d++,o===d)return void R.log("BaseNavigationView: Issue finding next navigation object")}i=n[d],this._closeCurrentMenu(t),$(i).hasClass("n-multicluster-name")?this._activateMulticlusterLink():$(i).hasClass("n-main-menu-link")?this._highlightMenuElement($(i)):$(i).hasClass("n-main-menu")?this._openMenu(t,this.$(".n-main-menu-btn")):$(i).hasClass("n-header-cluster-health")?this._activateClusterHealthIcon():$(i).hasClass("n-header-alerts")?this.onButtonClick(t,this.$(".n-header-alerts")):$(i).closest(".n-header-tasks").length?this.onButtonClick(t,this.$(".n-task-wrapper")):$(i).closest(".n-spotlight").length?this.activateSpotlight(t):$(i).hasClass("n-cluster-name")?this._activateClusterLink():$(i).hasClass("n-settings-menu")?r.navigateToPage(v.PAGE_SETTINGS):$(i).hasClass("n-user-menu")?this._openMenu(t,this.$(".n-user-btn")):$(i).hasClass("n-help-menu")&&this._openMenu(t,this.$(".n-help-btn"))},updateHealthIcon:function(){this.clearHealthIcon();var e=this.getClusterHealthStatus();e&&(this.$("i.n-health-icon").addClass("n-health-status-"+e.toLowerCase()),R.addSVGClass(this.$(".n-header-cluster-health > .svg-icon"),"n-health-status-"+e.toLowerCase()))},clearHealthIcon:function(){var e="";_.each(_.keys(v.HEALTH_STATUS),function(t){e+=" n-health-status-"+t.toLowerCase()}),this.$("i.n-health-icon").removeClass(e),R.removeSVGClass(this.$(".n-header-cluster-health > .svg-icon"),e)},getClusterHealthStatus:function(){},onMenuClick:function(e){var t=$(e.currentTarget);if(e.stopPropagation(),$(document).off("click",this.onDocumentClick).on("click",this.onDocumentClick),this.settingsPage&&t.hasClass("n-settings-btn"))this._closeCurrentMenu(e),r.navigateToPage(v.PAGE_SETTINGS);else{if(this._closeCurrentMenu(e))return;this._openMenu(e),t.find(".n-nav-menu").show().end().addClass("n-menu-active")}e.stopPropagation()},onMulticlusterMenuClick:function(e){$(".n-multicluster").hasClass("open")?this.hideMulticlusterPane():this.showMulticlusterPane()},onSingleClusterLinkClick:function(e){var t={};t[v.NAV_ACTION]=v.ACTION_SHOW,t[v.NAV_ACTION_TARGET]=v.ENTITY_CLUSTER,l.executeAction(t)},onDocumentClick:function(e){this._closeCurrentMenu(e),$(document).off("click",this.onDocumentClick)},onClusterHealthClick:function(){},onLogoClick:function(){u.isMulticlusterNavMode()?r.navigateToPage(v.PAGE_MC_DASHBOARD):r.navigateToPage(v.PAGE_DASHBOARD)},isIQSearch:function(){return u.isMulticlusterUI()&&p.isPrismProFeaturesEnabled()},onSpotlightClick:function(e){if(e.stopPropagation(),this.isIQSearch())return void g.showSearch();if(this.$(".n-spotlight-control").is(".n-spotlight-active")||!this._closeCurrentMenu(e)){var t=this.getSubViewByElement(this.$(".n-spotlight-control"));$(document).off("click",this.onDocumentClick),$(document).on("click",this.onDocumentClick),t.resetInput(),this.$(".n-spotlight-control").show().css("display","inline-block"),this.$(".n-spotlight a").hide(),this.$(".n-spotlight-control input").focus(),this.$(".n-spotlight-control").on(N.SPOTLIGHT_CLEANUP,this.onSpotlightCleanup),this.activeNavObject=t,this.$(".n-spotlight-control").addClass("n-spotlight-active")}},onSearchTutorialIconClick:function(e){e.stopPropagation(),this._onStartSearchTutorial()},onButtonClick:function(e,t){t=t||e.currentTarget,$(document).off("click",this.onDocumentClick),$(document).on("click",this.onDocumentClick),this._closeCurrentMenu(e,t)||($(t).is(".n-task-wrapper")?this.activeNavObject=this.headerTaskView.showDropDown(e):this.activeNavObject=this.headerAlertView.showDropDown(e,t),e.stopPropagation())},onSpotlightCleanup:function(e){this.spotlightHide(e),e.stopPropagation()},onNavMenuUpdate:function(e){var t=e?e.currentTarget:this.$el;this.headerAlertView&&this.headerTaskView&&this.headerAlertView.isButtonVisible()&&this.headerTaskView.isButtonVisible()?this.$(".n-task-separator").show():this.$(".n-task-separator").hide(),_.each($(t).find(".btn-group:visible"),function(e,t){var i=$(e).find("button").offset().left-this.$el.offset().left,n=$(e).find("button").width(),s=parseInt($(e).find(".n-caret").css("border-top-width"),10);(isNaN(s)||null===s)&&(s=0),$(e).find(".n-caret").css("left",i+s+n/2+"px")},this),this.isIQSearch()?this.$(".n-spotlight-btn").addClass("n-main-menu-link"):this.$(".n-spotlight-btn").removeClass("n-main-menu-link")},navigateToLegacySubPage:function(e){var t=r.getCurrentPageRoute()||{},i=t[v.NAV_PAGE_ID];-1!==[v.PAGE_VMS,v.PAGE_STORAGE,v.PAGE_DR,v.PAGE_HARDWARE].indexOf(i)&&r.navigateToSubPageByElement(e)},onGlobalKeyDown:function(e){o.get(o.IDLE_MANAGER).restartTimer();var t=$.ui.keyCode,i=$(document.activeElement);if(!R.isLocalStorageProperty(v.LOCAL_STORAGE.NO_HOTKEYS)){if(c.isPopupVisible())return void(e.keyCode===t.ESCAPE&&c.hidePopup());if(!(e.ctrlKey||e.altKey||e.shiftKey||e.metaKey||i.is("select")||i.is("input")&&!this.$(".n-spotlight input").is(":focus")||i.is("textarea")||this.$(".n-spotlight input").is(":focus")&&e.keyCode!==t.ESCAPE&&e.keyCode!==t.LEFT&&e.keyCode!==t.RIGHT))switch(e.keyCode){case this.KEYS.M:this._openMenu(e,this.$(".n-main-menu-btn"));break;case this.KEYS.S:r.navigateToPage(v.PAGE_SETTINGS);break;case this.KEYS.U:this._openMenu(e,this.$(".n-user-btn"));break;case this.KEYS.H:this._openMenu(e,this.$(".n-help-btn"));break;case this.KEYS.F:case this.KEYS.FWD_SLASH:e.preventDefault(),this.activateSpotlight(e);break;case this.KEYS.A:this.onButtonClick(e,this.$(".n-header-alerts"));break;case this.KEYS.P:this.onButtonClick(e,this.$(".n-task-wrapper"));break;case t.ESCAPE:$("body").hasClass("n-tutorial")?$("body").trigger(N.PROMPT_TUTORIAL_CLOSE):$("body").hasClass("sidebar-open")?this.onMulticlusterMenuClick():this._closeCurrentMenu(e);break;case t.LEFT:this.toggleMenu(this.LEFT,e);break;case t.RIGHT:this.toggleMenu(this.RIGHT,e);break;case this.KEYS.O:this.navigateToLegacySubPage(v.SUBPAGE_PERSPECTIVE);break;case this.KEYS.D:this.navigateToLegacySubPage(v.SUBPAGE_DIAGRAM);break;case this.KEYS.T:this.navigateToLegacySubPage(v.SUBPAGE_TABLE);break;case t.ENTER:if(e.stopPropagation(),this.activateHighlightedMenuElement(e),this.$(".n-cluster .n-link-active").length)return this.onSingleClusterLinkClick(),void this._closeCurrentMenu(e);if(this.$(".n-multicluster-btn .n-link-active").length)return this.onMulticlusterMenuClick(e,this.$(".n-cluster-name a")),void this._closeCurrentMenu(e);default:this.activeNavObject&&this.activeNavObject.onKeyPress&&this.activeNavObject.onKeyPress(e)}}},_onStartSearchTutorial:function(){if(!R.hasLocalStorage())return!1;if(!a.isTutorialInProgress()){var e=this,t=function(){R.debug("ClusterHealthPageView |  Starting Tutorial"),localStorage[v.LOCAL_STORAGE.TUTORIAL_SEARCH]=!0,e.setNavigationTips()},i=function(){};return a.startTutorial({name:v.TUTORIALS.SEARCH,context:e,tutorialStartCB:t,tutorialCompleteCB:i}),!0}return!1}})}),define("text!templates/navigation/NavigationView.html",[],function(){return'\x3c!-- Header: Left-Side\n================================================== --\x3e\n\n<div class="n-navigation -hide">\n\n    \x3c!--  Inter-cluster navigation\n    ================================================== --\x3e\n\n    <div class="n-multi-nav-bar">\n      \x3c!-- Logo\n      ================================================== --\x3e\n      <div class="header-logo">\n        <a class="n-logo-link">\n          <% if(isBrandingHX) { %>\n            <%= SVG.loadSVG(SVG.HXLOGO) %>\n          <% } else { %>\n            <%= SVG.nutanixXLogo %>\n          <% } %>\n        </a>\n      </div>\n      <ul class="n-multicluster-btn n-top-menu">\n        <li>\n          <a class="n-nav-toggle n-main-menu-link">\n            <span class="n-multicluster-name"></span>\n          </a>\n        </li>\n      </ul>\n    </div>\n\n    \x3c!--  Intra-cluster navigation\n    ================================================== --\x3e\n\n    <div class="n-nav-bar left-nav-menu">\n      <ul class="n-main-menu-btn n-top-menu">\n        <li class="n-vertical-line"></li>\n        <li>\n          <a>\n            <span class="n-nav-label">Home</span>\n            <%= SVG.SVGIcon("z") %>\n          </a>\n          <ul class="n-main-menu n-nav-menu n-nav-toggle">\n            <li></li>\n          </ul>\n        </li>\n        <li class="n-vertical-line"></li>\n      </ul>\n    </div>\n\n    \x3c!-- Cluster Health\n    ================================================== --\x3e\n\n    <div class="n-header-cluster-health n-nav-toggle n-main-menu-link">\n      <%= SVG.SVGIcon("I", "n-health-icon") %>\n    </div>\n\n    \x3c!-- Alerts\n    ================================================== --\x3e\n\n    <div class="n-header-alerts n-nav-toggle n-no-alerts" stream-action="show"\n         stream-target="alert header">\n      <%= SVG.SVGIcon("D", "n-alerts-iconography") %>\n\n      <ul class="n-alert-buttons">\n        \x3c!-- Critical --\x3e\n        <li class="btn-group pull-left n-no-alerts" alert="kCritical">\n          <button class="n-alert-button"></button>\n        </li>\n\n        \x3c!-- Warning --\x3e\n        <li class="btn-group pull-left n-no-alerts" alert="kWarning">\n          <button class="n-alert-button"></button>\n        </li>\n\n        \x3c!-- Info --\x3e\n        <li class="btn-group pull-left n-no-alerts" alert="kInfo">\n          <button class="n-alert-button"></button>\n        </li>\n      </ul>\n\n      <div class="n-alerts-dropdown" style="display:none;">\n\n        \x3c!-- Alerts - Critical --\x3e\n        <div class="n-alerts n-critical" style="display:none;">\n          <div class="n-alert-type">\n            <div class="n-alert-name-text">Recent <span class="n-alert-name"></span> Alerts</div>\n            <div class="badge -new -danger n-alert-qty"></div>\n          </div>\n          <div class="antiscroll-wrap n-alert-antiscroll">\n            <div class="box-wrap">\n              <div class="antiscroll-inner">\n                <div class="box-inner n-content-inner">\n                  <ul class="n-nav-menu n-nav-toggle">\n                    <li>\n                      <ul class="n-nav-col col1"></ul>\n                    </li>\n                  </ul>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n\n        \x3c!-- Alerts - Warning --\x3e\n        <div class="n-alerts n-warning" style="display:none;">\n          <div class="n-alert-type">\n            <div class="n-alert-name-text">Recent <span class="n-alert-name"></span> Alerts</div>\n            <div class="badge -new -warning n-alert-qty"></div>\n          </div>\n          <div class="antiscroll-wrap n-alert-antiscroll">\n            <div class="box-wrap">\n              <div class="antiscroll-inner">\n                <div class="box-inner n-content-inner">\n                  <ul class="n-nav-menu n-nav-toggle">\n                    <li>\n                      <ul class="n-nav-col col1"></ul>\n                    </li>\n                  </ul>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n\n        \x3c!-- Alerts - Info --\x3e\n        <div class="n-alerts n-info" style="display:none;">\n          <div class="n-alert-type">\n            <div class="n-alert-name-text">Recent <span class="n-alert-name"></span> Alerts</div>\n            <div class="badge -new -info n-alert-qty"></div>\n          </div>\n          <div class="antiscroll-wrap n-alert-antiscroll">\n            <div class="box-wrap">\n              <div class="antiscroll-inner">\n                <div class="box-inner n-content-inner">\n                  <ul class="n-nav-menu n-nav-toggle">\n                    <li>\n                      <ul class="n-nav-col col1"></ul>\n                    </li>\n                  </ul>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n\n      </div>\n\n    </div>\n\n    \x3c!-- Tasks\n    ================================================== --\x3e\n    <%= taskHeaderDropdownViewTemplate %>\n    <div class="n-dots-loading-wrapper">\n      <div class="n-dots-loading"></div>\n    </div>\n\n\n    \x3c!-- Header: Right-Side\n    ================================================== --\x3e\n    <div class="pull-right">\n      <ul class="right-menu n-top-menu">\n\n        \x3c!-- Search\n        ================================================== --\x3e\n        <li class="n-spotlight n-spotlight-btn">\n          <a>\n            <%= SVG.SVGIcon("B") %>\n          </a>\n          <span class="n-spotlight-control n-nav-toggle"\n            style="display:none;">\n          </span>\n        </li>\n\n        \x3c!-- Help\n        ================================================== --\x3e\n        <li class="n-help n-help-btn">\n          <a>\n            <%= SVG.SVGIcon("Question_Mark", "help-icon") %>\n            <%= SVG.SVGIcon("z", "-down-arrow") %>\n          </a>\n          <ul class="n-help-menu  n-nav-menu n-nav-toggle">\n            <li></li>\n          </ul>\n        </li>\n\n        \x3c!-- Settings\n        ================================================== --\x3e\n        <li class="n-settings n-settings-btn">\n          <a>\n            <%= SVG.SVGIcon("C", "gear-icon") %>\n          </a>\n          <ul class="n-settings-menu  n-nav-menu n-nav-toggle">\n            <li></li>\n          </ul>\n        </li>\n\n        <li class="n-vertical-line"></li>\n\n        \x3c!-- Username\n        ================================================== --\x3e\n        <li class="n-user n-user-btn">\n          <a>\n            <span class="n-username"></span>\n            <%= SVG.SVGIcon("z", "-down-arrow") %>\n          </a>\n          <ul class="n-user-menu  n-nav-menu n-nav-toggle">\n            <li></li>\n          </ul>\n        </li>\n      </ul>\n    </div>\n </div>\n'}),define("text!templates/navigation/TaskHeaderDropdownView.html",[],function(){return'<% var pending = typeof usePending !== \'undefined\' ? usePending : false; %>\n<div class="n-header-tasks n-nav-toggle">\n  <ul>\n    <li class="btn-group pull-left hide">\n      <div class="n-task-wrapper">\n        <div class="radial percent0" data-class="0">\n          <b><i></i></b><b><i></i></b>\n        </div>\n        <button class="n-task-button" stream-action="show"\n          stream-target="progress monitor"></button>\n        <button id="taskDotFailed"\n                class="n-task-dot-failed hide explore-remove">\n        </button>\n        <a class="task-dropdown-icon explore-remove">\n          <%= SVG.SVGIcon("z") %>\n        </a>\n      </div>\n      <div class="n-tasks-dropdown hide">\n        <div class="n-task-dropdown-header">\n          <span class="n-task-header-text">\n            <%= pending ? i18n(\'pending.tasks_header\') : i18n(\'task.tasks_header\') %>\n          </span>\n          <a id="linkClearTask"\n             class="n-task-clear-link hide"\n             title="<%= pending ? i18n(\'pending.clear_title\') : i18n(\'task.clear_title\') %>">\n            <%= pending ? i18n(\'pending.clean_up\') : i18n(\'task.clean_up\') %>\n          </a>\n        </div>\n        <div class="antiscroll-wrap n-task-antiscroll">\n          <div class="box-wrap" >\n            <div class="antiscroll-inner" >\n              <div class="box-inner  n-content-inner" >\n                <ul class="n-task-menu"></ul>\n              </div>\n            </div>\n          </div>\n        </div>\n        <div class="n-tasks-footer">\n          <div class="n-view-tasks">\n            <%= pending ? i18n(\'pending.view_all\') : i18n(\'task.view_all\') %>\n            <span id="totalTaskCount"></span>\n            <%= pending ? i18n(\'pending.tasks\') : i18n(\'task.tasks\') %>\n            <a class="task-view-all-icon">\n              <%= SVG.SVGIcon("y") %>\n            </a>\n            <div class="n-tasks-count">\n              <a id="countGroupRunning" class="n-task-count-group">\n                <button class="n-task-count-running">\n                </button>\n                <span class="labelCount"></span>\n              </a>\n              <a id="countGroupFailed" class="n-task-count-group">\n                <button class="n-task-count-failed">\n                </button>\n                <span class="labelCount"></span>\n              </a>\n              <a id="countGroupSuccess" class="n-task-count-group">\n                <button class="n-task-count-success">\n                </button>\n                <span class="labelCount"></span>\n              </a>\n            </div>\n          </div>\n        </div>\n      </div>\n    </li>\n  </ul>\n</div>'}),define("models/encryption/EncryptionModel",["models/BaseModel","models/PollingModel","models/PollingCollection","models/hardware/HostCollection","models/hardware/DiskCollection","data/DataURLConstants","data/DataProperties","utils/AppConstants","utils/SubModelHelper","utils/AppUtil","utils/DataExportUtil"],function(e,t,i,n,s,a,r,o,l,c,u){"use strict";var d=_.template(a.ENCRYPT_DELETE_CERTIFICATES),h=t.extend({urlRoot:a.ENCRYPT_CERTI_INFO,entityType:o.ENTITY_ENCRYPTION,defaults:{organizationName:null,organizationalUnitList:null,countryCode:null,city:null,state:null,emailAddress:null},
name:"CertificateInfoModel",getURL:function(e){return this.urlRoot},isCertificateInfoChanged:function(e){for(var t in this.attributes)if(this.attributes[t]!==e[t])return!0;return!1}}),p=t.extend({urlRoot:a.ENCRYPT_CA_UPLOAD,entityType:o.ENTITY_ENCRYPTION,defaults:{name:null,certificate:null},idAttribute:r.ENCRYPTION_PROP.NAME,name:"CACertificateModel",containsCACertificate:function(e){return _.some(this.attributes,function(t){return _.some(t,function(t){return t===e})})}}),T=t.extend({urlRoot:a.ENCRYPT_KEY_BACKUP,entityType:o.ENTITY_ENCRYPTION,idAttribute:r.ENCRYPTION_PROP.NAME,name:"EncryptionKeyBackup",_getFileGenDate:function(){var e=new Date;return e=e.getFullYear()+"_"+("0"+(e.getMonth()+1)).slice(-2)+"_"+("0"+e.getDate()).slice(-2)+"_"+("0"+e.getHours()).slice(-2)+"_"+("0"+e.getMinutes()).slice(-2)+"_"+("0"+e.getSeconds()).slice(-2)},download:function(e){var t=c.convertB64ToByteArray(e);u.exportData(t,"encryption_key_backup_"+this._getFileGenDate(),"")},save:function(e,t){var i=this;$.ajax({url:this.getDataSourceURL()+this.urlRoot,type:"POST",data:JSON.stringify(e),contentType:"application/json;",dataType:"json",async:!0}).done(function(e){i.download(e[r.ENCRYPTION_PROP.BACKUP_DATA]),t&&_.isFunction(t.success)&&t.success(e)}).fail(function(e,i,n){c.log("\n              EncryptionModel: Error downloading encryption backup key:\n              "+n+"\n            "),t&&_.isFunction(t.error)&&t.error(e,i,n)})}}),E=i.extend({url:a.ENCRYPT_CA_UPLOAD,model:p,name:"CAModelCollection",isSameFetchCall:function(){return!1}}),S=t.extend({urlRoot:a.ENCRYPT_KMIP,entityType:o.ENTITY_ENCRYPTION,name:"KMIPModel",defaults:{name:null,uuid:null,ipAddressPortMap:null},idAttribute:r.ENCRYPTION_PROP.NAME}),g=i.extend({url:a.ENCRYPT_KMIP,model:S,activeKMIP:null,name:"KMIPModelCollection",parse:function(e,t){return this.activeKMIP=[],this.populateActiveKMIPs(e),e},populateActiveKMIPs:function(e){_.each(e,function(e){e.active&&this.activeKMIP.push(e.name)},this)},checkActiveKMIPs:function(e){return{activeKMIPSize:this.activeKMIP.length,present:-1!==this.activeKMIP.indexOf(e)}}}),A=e.extend({urlRoot:a.ENCRYPT_CSR_MULTI_UPLOAD,entityType:o.ENTITY_ENCRYPTION,defaults:{keyManagementServerName:null,certificateMap:null},name:"CSRMultiCertificateModel",parse:function(e,t){}}),m=e.extend({urlRoot:a.ENCRYPT_TEST,entityType:o.ENTITY_ENCRYPTION,enableNotifications:!1,defaults:{serverList:null,nodeIdList:null},name:"TestCertificateModel",parse:function(e,t){}}),f=t.extend({urlRoot:a.ENCRYPT_RECENT_TEST,entityType:o.ENTITY_ENCRYPTION,defaults:{},name:"RecentTestResultModel",parse:function(e,t){this.recentTestResponse=e},getTestResults:function(e,t){var i=this.recentTestResponse,n=_.find(i,function(i){return i[r.ENCRYPTION_PROP.KMIP_NAME]===e&&i[r.ENCRYPTION_PROP.NODE_ID]===t});return n?n[r.ENCRYPTION_PROP.RESULT_LIST]:[]}}),I=e.extend({urlRoot:a.ENCRYPT_INTENT,entityType:o.ENTITY_ENCRYPTION,defaults:{value:null},enableNotifications:!1,name:"EncryptionIntentModel",parse:function(e,t){}}),C=t.extend({urlRoot:a.CURRENT_ENCRYPT_STATUS,entityType:o.ENTITY_ENCRYPTION,name:"EncryptionCurrentStateModel",state:null,initialize:function(t){e.prototype.initialize.apply(this,arguments),this.state={isEncryptionOn:null,isSEDProtectionOn:null,isSoftwareEncryptionOn:null,softwareEncryptionScope:null,isReadyForPasswordProtection:null,isReadyForSoftwareEncryption:null}},updateEncryptionState:function(e){var t=e.desiredPasswordProtection,i=e.softwareEncryptionScope;this.state.isEncryptionOn=Boolean(t||i),this.state.isSoftwareEncryptionOn=Boolean(i),this.state.softwareEncryptionScope=i,this.state.isSEDProtectionOn=t},getSoftwareEncryptionScope:function(){return this.state&&this.state.softwareEncryptionScope},isEncryptionOn:function(){return this.state&&this.state.isEncryptionOn},parse:function(e,t){this.currentEncryptionState=e.desiredPasswordProtection,this.diskEncryptionStatus=e.diskEncryptionStatus,this.isReadyForPasswordProtection=e.isReadyForPasswordProtection,this.isReadyForSoftwareEncryption=e.isReadyForSoftwareEncryption,this.state.diskEncryptionStatus=e.diskEncryptionStatus,this.state.isReadyForPasswordProtection=e.isReadyForPasswordProtection,this.state.isReadyForSoftwareEncryption=e.isReadyForSoftwareEncryption,this.updateEncryptionState(e)}}),v=e.extend({urlRoot:a.ENCRYPT_KMS_TYPE,entityType:o.ENTITY_ENCRYPTION,defaults:{kmsType:null},name:"EncryptionKMSTypeModel",enableNotifications:!1}),R=e.extend({urlRoot:a.ENCRYPT_REKEY,entityType:o.ENTITY_ENCRYPTION,enableNotifications:!1,name:"EncryptionRekeyModel",toJSON:function(){return[]}}),N=e.extend({urlRoot:a.ENCRYPT_SW_REKEY,entityType:o.ENTITY_ENCRYPTION,enableNotifications:!1,name:"EncryptionSoftwareRekeyModel"}),P=e.extend({entityType:o.ENTITY_ENCRYPTION,name:"EncryptionDelCertModel",getURL:function(){return d({nodeId:this[r.ENCRYPTION_PROP.NODE_ID],serverName:this[r.ENCRYPTION_PROP.SERVER_NAME]})}});return e.extend({urlRoot:a.ENCRYPT_CA_UPLOAD,entityType:o.ENTITY_ENCRYPTION,subModelHelper:null,name:"EncryptionModel",initialize:function(t){e.prototype.initialize.apply(this,arguments),this.subModelHelper=new l,this.subModelHelper.register("certiInfo",new h),this.subModelHelper.register("caCerti",new p),this.subModelHelper.register("csrMulti",new A),this.subModelHelper.register("kmipServer",new S),this.subModelHelper.register("kmipCollection",new g),this.subModelHelper.register("caCollection",new E),this.subModelHelper.register("nodeCollection",new n),this.subModelHelper.register("diskCollection",new s),this.subModelHelper.register("testCertiNode",new m),this.subModelHelper.register("recentTestResultModel",new f),this.subModelHelper.register("encryptionIntent",new I),this.subModelHelper.register("download_encryption_key",new T),this.subModelHelper.register("encryptionCurrentState",new C),this.subModelHelper.register("kmsType",new v),this.subModelHelper.register("encryptionRekey",new R),this.subModelHelper.register("encryptionSoftwareRekey",new N),this.subModelHelper.register("encryptionDelCertificate",new P),_.bind(this._onErrorSubModel,this),this.subModelHelper.attachEventHandler("error",this._onErrorSubModel)},_onErrorSubModel:function(e,t,i){var n="";_.isString(t)?n=t:_.isObject(t)&&t.responseText&&(n=c.processAjaxError(t.responseText)),this.trigger("error",n)},destroy:function(){this.subModelHelper.destroy(),e.prototype.initialize.destroy(this,arguments)},getSubModelById:function(e){return this.subModelHelper.get(e)},saveCertiInfo:function(e,t){var i=this.getSubModelById("certiInfo");i.isNew(!1),i.save(e,t)},fetchCertiInfo:function(e){return this.getSubModelById("certiInfo").fetch(e)},getCertiInfo:function(){return this.getSubModelById("certiInfo")},getCAUploadURL:function(){return this.getSubModelById("caCerti").urlRoot},fetchCACertificateModel:function(e){this.getSubModelById("caCerti").fetch(e)},deleteCAEntry:function(e,t){var i=this.getSubModelById("caCerti");i.id=e.id,i.isNew(!1),i.destroy(t)},getCAEntries:function(){return this.getSubModelById("caCollection")},saveKMIPDetails:function(e,t,i){var n=this.getSubModelById("kmipServer");n.isNew(i),i&&n.clear(),n.save(e,t)},deleteKMIP:function(e,t){var i=this.getSubModelById("kmipServer");i.id=e.id,i.isNew(!1),i.destroy(t)},fetchNodeDetails:function(e){this.getSubModelById("nodeCollection").fetch(e)},fetchDiskDetails:function(e){this.getSubModelById("diskCollection").fetch(e)},saveMultiFileUpload:function(e,t){this.getSubModelById("csrMulti").save(e,t)},doTestResult:function(e,t){var i=this.getSubModelById("testCertiNode");i.isNew(!0),i.save(e,t)},getRecentTestDetails:function(){return this.getSubModelById("recentTestResultModel")},setEncryptionIntent:function(e,t){var i=this.getSubModelById("encryptionIntent");i.clear({silent:!0}),i.save(e,t)},fetchCurrentEncryptionStatus:function(e){return this.getSubModelById("encryptionCurrentState").fetch(e)},fetchKMSType:function(e){return this.getSubModelById("kmsType").fetch(e)},saveKMSType:function(e,t){var i=this.getSubModelById("kmsType");i.isNew(!1),i.save({kmsType:e},t)},getKMIPCollection:function(){return this.getSubModelById("kmipCollection")},getNodeDetails:function(){return this.getSubModelById("nodeCollection")},getCurrentEncryptionStatusModel:function(){return this.getSubModelById("encryptionCurrentState")},deleteCertificate:function(e,t,i){var n=this.getSubModelById("encryptionDelCertificate");n[r.ENCRYPTION_PROP.NODE_ID]=e,n[r.ENCRYPTION_PROP.SERVER_NAME]=t,n.isNew(!1),n.destroy(i)},downloadKeyBackup:function(e,t){var i=this.getSubModelById("download_encryption_key");i.isNew(!0),i.save({password:e},t)},doRekey:function(e){var t=this.getSubModelById("encryptionRekey");t.isNew(!0),t.save(null,e)},doSWRekey:function(e){var t=this.getSubModelById("encryptionSoftwareRekey");t.isNew(!0),t.save({change_wrapping_key:!0},e)}})}),define("views/navigation/NavigationView",["views/navigation/BaseNavigationView","text!templates/navigation/NavigationView.html","text!templates/navigation/TaskHeaderDropdownView.html","models/encryption/EncryptionModel","managers/ClusterManager","managers/HealthManager","managers/NavigationManager","utils/AppConstants","utils/AppUtil"],function(e,t,i,n,s,a,r,o,l){"use strict";var c=_.template(i),u=_.template(t);return e.extend({name:"NavigationView",settingsPage:!0,initialize:function(){_.bindAll(this,"updateClusterName"),e.prototype.initialize.apply(this,arguments),this.encryptionModel=new n},render:function(){this.template=u(this.getViewTemplateObject({taskHeaderDropdownViewTemplate:c(this.vtOptions())})),e.prototype.render.apply(this,arguments)},onStartServices:function(){s.isPrismElementIFrameMode()||(this.headerTaskView.startServices(),this.startSingleClusterManagers()),s.getClusterCollection().on("reset",this.updateClusterName),a.registerHealthListener("change",this.updateHealthIcon,this),e.prototype.onStartServices.apply(this,arguments)},onStopServices:function(){s.isPrismElementIFrameMode()||(this.headerTaskView.stopServices(),this.stopSingleClusterManagers()),s.getClusterCollection().off("reset",this.updateClusterName),a.unregisterHealthListener("change",this.updateHealthIcon,this),e.prototype.onStopServices.apply(this,arguments)},updateClusterName:function(){var e=s.getCurrentClusterModel(),t="",i="";if(null!==e&&e.get(e.nameAttribute)){if(t=e.get(e.nameAttribute),i=l.truncateMiddle(t,20),e.isFFEnabled(o.FFLAGS.ENCRYPTION)){var n=this,a={success:function(e,s){e.currentEncryptionState&&(t+=" (Protected)"),n.$(".n-multicluster-name").attr({title:t}).html(i)},error:function(e,t){l.log("NavigationView: updateClusterName: "+t.responseText)}};this.encryptionModel.fetchCurrentEncryptionStatus(a)}this.$(".n-multicluster-name").attr({title:t}).html(i)}else l.log("NavigationView: updateClusterName: Issue retrieving cluster name.")},getClusterHealthStatus:function(){return a.getClusterHealthStatus()},onClusterHealthClick:function(e,t){r.navigateToPage(o.PAGE_CLUSTER_HEALTH)}})}),define("text!templates/navigation/PCNavigationView.html",[],function(){return'\x3c!-- Header: Left-Side\n================================================== --\x3e\n\n\x3c!-- This is the new header --\x3e\n\n<div class="n-navigation -hide">\n  <div class="left-nav">\n    <div class="header hamburger explore-show">\n      <div class="header-hamburger-button" data-test="header-hamburger-button">\n        <div class="header-hamburger-button-slice"></div>\n      </div>\n    </div>\n\n    \x3c!-- <div class="n-dots-loading"></div> --\x3e\n\n    \x3c!--  Intra-cluster navigation\n    ================================================== --\x3e\n\n    <div class="n-nav-bar">\n      <ul class="n-main-menu n-nav-menu">\n      </ul>\n    </div>\n\n\n    \x3c!-- explore search bar --\x3e\n    <div class="search-cnvg-qb-wrapper">\n      <div class="search-box">\n        <div class="icon-search">\n          <a>\n            <%= SVG.SVGIcon("B") %>\n          </a>\n        </div>\n        <div class="search-container">\n          <div class="search-bubbles-container"></div>\n          <input class="exp-search-input" placeholder="" type="text"\n            data-test="exp-search-input" tabindex="0">\n        </div>\n        <div class="search-sgst"></div>\n        <div class="search-loader"><div class="donut-loader-blue"></div></div>\n        <div class="icon-star icon-star-empty hide" title="Add Bookmark"></div>\n      </div>\n    </div>\n\n    \x3c!-- Alerts\n    ================================================== --\x3e\n\n    \x3c!-- Tasks\n    ================================================== --\x3e\n  </div>\n \x3c!-- Logo\n  ================================================== --\x3e\n  <div class="header-logo">\n    <a class="n-logo-link" data-test="n_logo_link">\n      <% if (isCE) { %>\n        <img class="cepc-header-logo"\n          src="./app/assets/images/common/header-logo-ce.png">\n      <% } else if(isBrandingHX) { %>\n        <%= SVG.loadSVG(SVG.HXLOGO) %>\n      <% } else if(isLeap) { %>\n        <%= SVG.leapLogo %>\n      <% } else if(isPrism) { %>\n        <%= SVG.prismLogo %>\n      <% } else { %>\n        <%= SVG.nutanixXLogo %>\n      <% } %>\n      <span class="env-text"><%= environmenntText %></span>\n    </a>\n  </div>\n  \x3c!-- Header: Right-Side\n  ================================================== --\x3e\n  <div class="pull-right">\n    <div class="n-header-alerts n-no-alerts"\n         stream-action="show" stream-target="alert header">\n\n      <ul class="n-alert-buttons">\n        \x3c!-- Critical --\x3e\n        <li class="btn-group pull-left n-no-alerts n-nav-toggle n-main-menu-link"\n            alert="kCritical">\n          <%= Components.icon(\'bell\', \'-critical -huge alert-bell\') %>\n          <button class="n-alert-button"></button>\n        </li>\n\n        \x3c!-- Warning --\x3e\n        <li class="btn-group pull-left n-no-alerts n-nav-toggle n-main-menu-link"\n            alert="kWarning">\n          <%= Components.icon(\'bell\', \'-warning -huge alert-bell\') %>\n          <button class="n-alert-button"></button>\n        </li>\n\n        \x3c!-- Info --\x3e\n        <li class="btn-group pull-left n-no-alerts n-nav-toggle n-main-menu-link"\n            alert="kInfo">\n          <%= Components.icon(\'bell\', \'-info -huge alert-bell\') %>\n          <button class="n-alert-button"></button>\n        </li>\n      </ul>\n    </div>\n\n    <%= taskHeaderDropdownViewTemplate %>\n\n    <ul class="right-menu n-top-menu">\n\n      \x3c!-- Search\n      ================================================== --\x3e\n      <li class="n-spotlight n-spotlight-btn n-nav-toggle hidden">\n        <a class="search-tutorial hide tutorial-icon"></a>\n        <a>\n          <%= SVG.SVGIcon("B") %>\n        </a>\n        <span class="n-spotlight-control" style="display:none;">\n        </span>\n      </li>\n\n      \x3c!-- Help\n      ================================================== --\x3e\n      <li class="n-help n-help-btn">\n        <a>\n          <%= SVG.SVGIcon("Question_Mark") %>\n        </a>\n        <ul class="n-help-menu n-nav-menu n-nav-toggle">\n          <li></li>\n        </ul>\n      </li>\n\n      \x3c!-- Settings\n      ================================================== --\x3e\n      <li class="n-settings n-settings-btn">\n        <a>\n          <%= SVG.SVGIcon("C") %>\n        </a>\n        <ul class="n-settings-menu n-nav-menu n-nav-toggle">\n          <li></li>\n        </ul>\n      </li>\n\n      \x3c!-- Username\n      ================================================== --\x3e\n      <li class="n-user n-user-btn">\n        <a>\n          <span class="n-username"></span>\n          <%= SVG.SVGIcon("z", "-down-arrow") %>\n        </a>\n        <ul class="n-user-menu n-nav-menu n-nav-toggle">\n          <li></li>\n        </ul>\n      </li>\n    </ul>\n  </div>\n</div>'}),define("views/navigation/PCNavigationView",["views/navigation/MenuDescriptor","views/navigation/BaseNavigationView","managers/NavigationManager","text!templates/navigation/PCNavigationView.html","text!templates/navigation/TaskHeaderDropdownView.html","utils/AppUtil","utils/AppConstants","utils/ManagerMixin"],function(e,t,i,n,s,a,r,o){"use strict";var l=_.template(s),c=_.template(n);return t.extend({name:"PCNavigationView",additionalEvents:{"click .n-nav-menu-item":"onMenuItemClick"},className:"n-pc-navigation",settingsPage:!0,clusterCollection:null,initialize:function(e){t.prototype.initialize.apply(this,arguments),this.addExtraEvents(this.additionalEvents),this.onXiPortalPopupOpen=this.onXiPortalPopupOpen.bind(this),this.onXiPortalPopupClose=this.onXiPortalPopupClose.bind(this);var i=o.getAppManager(),n=o.getAccessManager();if(i.isXi()){var s=o.getWindowMessagesManager();s.registerCallback({service:r.XI_IFRAME_MESSAGE_SERVICES.PORTAL_MYNUTANIX,target:r.XI_IFRAME_MESSAGE_TARGETS.POPUP,state:r.XI_IFRAME_MESSAGE_STATES.POPUP_OPEN},this.onXiPortalPopupOpen),s.registerCallback({service:r.XI_IFRAME_MESSAGE_SERVICES.PORTAL_MYNUTANIX,target:r.XI_IFRAME_MESSAGE_TARGETS.POPUP,state:r.XI_IFRAME_MESSAGE_STATES.POPUP_CLOSE},this.onXiPortalPopupClose),s.registerCallback({service:r.XI_IFRAME_MESSAGE_SERVICES.PORTAL_BILLING,target:r.XI_IFRAME_MESSAGE_TARGETS.POPUP,state:r.XI_IFRAME_MESSAGE_STATES.POPUP_OPEN},this.onXiPortalPopupOpen),s.registerCallback({service:r.XI_IFRAME_MESSAGE_SERVICES.PORTAL_BILLING,target:r.XI_IFRAME_MESSAGE_TARGETS.POPUP,state:r.XI_IFRAME_MESSAGE_STATES.POPUP_CLOSE},this.onXiPortalPopupClose)}n.isXiUserType()&&(this.settingsPage=!1)},render:function(){this.template=c(this.getViewTemplateObject({taskHeaderDropdownViewTemplate:l(this.vtOptions())})),t.prototype.render.apply(this,arguments),this.headerAlertView.isMulticluster=!0,this.getSpotlightView().setMulticluster(!0),this.headerTaskView.setMulticluster(!0),this.headerTaskView.startServices()},populateAllMenus:function(){this.populateMainMenu(".n-main-menu",e.getPageList(!0)),this._populateUserMenu(e.USER_MENU_TYPE.MULTICLUSTER),this.populateSettingsMenu(!0),this.populateMenu(".n-help-menu",e.getHelpList(e.USER_MENU_TYPE.MULTICLUSTER))},destroy:function(){if(o.getAppManager().isXi()){var e=o.getWindowMessagesManager();e.unregisterCallback({service:r.XI_IFRAME_MESSAGE_SERVICES.PORTAL_MYNUTANIX,target:r.XI_IFRAME_MESSAGE_TARGETS.POPUP,state:r.XI_IFRAME_MESSAGE_STATES.POPUP_OPEN},this.onXiPortalPopupOpen),e.unregisterCallback({service:r.XI_IFRAME_MESSAGE_SERVICES.PORTAL_MYNUTANIX,target:r.XI_IFRAME_MESSAGE_TARGETS.POPUP,state:r.XI_IFRAME_MESSAGE_STATES.POPUP_CLOSE},this.onXiPortalPopupClose),e.unregisterCallback({service:r.XI_IFRAME_MESSAGE_SERVICES.PORTAL_BILLING,target:r.XI_IFRAME_MESSAGE_TARGETS.POPUP,state:r.XI_IFRAME_MESSAGE_STATES.POPUP_OPEN},this.onXiPortalPopupOpen),e.unregisterCallback({service:r.XI_IFRAME_MESSAGE_SERVICES.PORTAL_BILLING,target:r.XI_IFRAME_MESSAGE_TARGETS.POPUP,state:r.XI_IFRAME_MESSAGE_STATES.POPUP_CLOSE},this.onXiPortalPopupClose)}this.headerTaskView.stopServices(),t.prototype.destroy.apply(this,arguments)},populateMainMenu:function(t,i){var n=this.$(t);_.each(i,function(t){var i=e.getDescriptor(t),s=$('<li class="n-nav-menu-item n-nav-toggle n-main-menu-link"><a></a></li>');if(!i)return void a.error("No descriptor found for "+t);_.each(i.attributes,function(e,t){s.find("a").attr(t,e)}),s.find("a").html(i.label),n.append(s)},this);var s=this.$(".n-nav-menu-item")[0];$(s).find("a").addClass("n-hover")},getClusterHealthStatus:function(){return this.clusterCollection.getMulticlusterHealthStatus()},updateSelectedPage:function(e){t.prototype.updateSelectedPage.apply(this,arguments),this.$(".n-main-menu").find("a").removeClass("n-hover"),this.$('.n-main-menu li a[pageid="'+e+'"]').addClass("n-hover")},onMenuItemClick:function(e,t){e.preventDefault();var n,s=t||$(e.currentTarget).find("a"),a=s.attr(r.NAV_PAGE_ID),o=s.attr(r.NAV_SUBPAGE_ID);s.attr(r.NAV_ACTION_TARGET)&&(n=r.NAV_ACTION_TARGET+"="+s.attr(r.NAV_ACTION_TARGET)),a&&i.navigateToPage(a,o,n)},onLogoClick:function(){var e=this.$(".n-main-menu").find('a[pageid="pc_dashboard"]');this.$(".n-main-menu").find("a").removeClass("n-hover"),e.addClass("n-hover"),t.prototype.onLogoClick.apply(this,arguments)},onRefreshUserMenu:function(){this._populateUserMenu(e.USER_MENU_TYPE.MULTICLUSTER)},onXiPortalPopupOpen:function(){this.$(".n-navigation").addClass("modal-overlay")},onXiPortalPopupClose:function(){this.$(".n-navigation").removeClass("modal-overlay")}})}),define("models/cluster/ClusterExternalStateModel",["models/BaseModel","data/DataURLConstants","data/DataProperties","utils/AppUtil"],function(e,t,i,n){"use strict";var s=null,a=e.extend({urlRoot:t.MULTICLUSTER_EXTERNAL_STATE,name:"ClusterExternalStateModel",defaults:{clusters:null},alwaysTriggerChange:!0,toJSON:function(){return this.get(i.CLUSTER_EXTERNAL_STATE)},getURL:function(t,i){return"read"===t?this.urlRoot:e.prototype.getURL.apply(arguments)},parse:function(e){var t={};return t[i.CLUSTER_EXTERNAL_STATE]=e,_.isEmpty(e)||(t[i.ID]=e[0][i.CLUSTER_UUID]),t},isRegisteredToPC:function(){return!_.isEmpty(this.get(i.CLUSTER_EXTERNAL_STATE))},isDataLoaded:function(){return!_.isNull(this.get(i.CLUSTER_EXTERNAL_STATE))},remoteConnectionExists:function(){var e=_.first(this.get(i.CLUSTER_EXTERNAL_STATE)||[]);return e&&!!e[i.CLUSTER_EXTERNAL_REMOTE_CONNECTION_EXISTS]},getMulticlusterIpAddresses:function(){var e=this.get(i.CLUSTER_EXTERNAL_STATE);if(e.length){var t=e[0][i.CLUSTER_EXTERNAL_STATE_DETAILS];if(t)return t[i.CLUSTER_EXTERNAL_STATE_IP_ADDYS];n.log("ClusterExternalStateModel: getMulticlusterIpAddresses: Issue with cluster external state details format: "+JSON.stringify(t))}return[]},getVirtualIpAddress:function(){var e=this.get(i.CLUSTER_EXTERNAL_STATE);if(e.length){var t=e[0][i.CLUSTER_EXTERNAL_STATE_CONFIG];if(t){var s=n.get(t,i.CLUSTER_EXTERNAL_STATE_EXT_ADDR+"."+i.CLUSTER_EXTERNAL_STATE_EXT_ADDR_IP);if(!_.isEmpty(s))return s}else n.log("ClusterExternalStateModel: getMulticlusterIpAddresses: Issue with cluster external state details format: "+JSON.stringify(t))}return!1}},{getSharedInstance:function(){return null===s&&(s=new a),s}});return a}),define("models/alert/AlertSummaryModel",["models/PollingModel","models/alert/AlertModel","data/DataURLConstants","data/DataProperties","utils/AppConstants"],function(e,t,i,n,s){"use strict";var a=s.ALERT_SUMMARY_SEVERITY_MAPPING;return e.extend({urlRoot:i.ALERT_SUMMARY,intervalTimeInMilliSec:s.LONG_POLLING_INTERVAL,name:"AlertSummaryModel",entityType:null,alertCount:3,parse:function(i,n){var s=e.prototype.parse.apply(this,arguments);return s.alertSummaries&&_.each(a,function(e,i){var n=[];s.alertSummaries[e]?_.each(s.alertSummaries[e].entities,function(e){n.push(new t(e))}):s.alertSummaries[e]={metadata:{grandTotalEntities:0,totalEntities:0}},s.alertSummaries[e].entities=n}),s},parseOptions:function(t,i,n){return n=e.prototype.parseOptions.apply(this,arguments),"read"===t&&(this.entityType&&_.extend(n.data,{entityType:this.entityType}),this.alertCount&&_.extend(n.data,{count:this.alertCount})),n},getAlertSummaries:function(){return this.get("alertSummaries")},getAlertsBySeverity:function(e){if("all"===e){var t=[];return _.each(a,function(e,i){t=t.concat(this.getAlertsBySeverity(i))},this),t}var i=a[e];return((this.getAlertSummaries()||{})[i]||{}).entities||[]},getAlertCountsBySeverity:function(e){var t=this.getAlertSummaries();if(t)return t[a[e]].metadata.grandTotalEntities},setEntityType:function(e){e===s.ENTITY_CLUSTER?this.entityType=null:this.entityType=e},setCount:function(e){this.alertCount=e},hasAlert:function(e){return _.any(this.getAlertsBySeverity("all"),function(t){return t.get(n.ALERT_METADATA_ID)===e})}})}),define("utils/InsightsUtil",["managers/NavigationManager","models/cluster/ClusterCollection","data/DataProperties","utils/AppConstants","utils/AppUtil"],function(e,t,i,n,s){"use strict";var a=t.extend({url:"insights/search/entities?queryEntityType=cluster",parse:function(e,n){var s=t.prototype.parse.apply(this,arguments);return _.each(s,function(e){e[i.ID]=e.entityId,e[i.NAME]=e.entityName,e[i.CLUSTER_UUID]=e.entityId}),s}});return{_insightsClusterCollection:null,entityDisplayName:function(e){return e.title&&e.title.length?e.title:e.id&&e.id.length?e.id:"All "+s.getPluralEntityName(e.type)},metricDisplayName:function(e){return e.title||e.id},fullMetricDisplayName:function(e){return e.id},uniqueEntityIdentifier:function(e){return e.id&&e.id.length?e.id:e.type+":*"},getClusterCollection:function(){return this._insightsClusterCollection||(this._insightsClusterCollection=new a),this._insightsClusterCollection},loadDashboard:function(t,i){var a={};a[n.NAV_PAGE_ID]=n.PAGE_INSIGHTS;var r={entityType:t,entityId:i};a.options=s.formatObjectToQuery(r),e.navigateToPageRouteObject(a,!0)}}}),define("views/navigation/BaseMulticlusterView",["views/basecomponents/BaseView","models/cluster/ClusterExternalStateModel","models/alert/AlertSummaryModel","managers/NavigationManager","managers/ClusterManager","utils/AppUtil","utils/AntiscrollUtil","utils/AppConstants","utils/CommonTemplates","utils/InsightsUtil","data/DataProperties","data/DataURLConstants","events/AppEvents"],function(e,t,i,n,s,a,r,o,l,c,u,d,h){"use strict";var p=_.template('\x3c!-- Multicluster title link --\x3e<div class="mc-title-link"><a class="mc-link"><%= multiclusterName %></a></div><div class="mc-antiscroll"><div class="antiscroll-wrap"><div class="box-wrap"><div class="antiscroll-inner"><div class="box-inner  n-content-inner"><ul class="n-cluster-list"></ul></div></div></div></div></div>');return e.extend({isProcessingClick:!1,events:{"click .mc-title-link":"onClickMulticlusterTitle","click .n-cluster-item":"onClickSingleClusterItem","click .n-unreg-cluster":"onClickUnregCluster"},initialize:function(){this.appModel=this.options.appModel,this.healthCollection=this.options.healthCollection,this.taskCollection=this.options.taskCollection,this.collection=this.options.clusterCollection},render:function(){this.$el.html(p({cssClass:this.cssClass,multiclusterName:o.MULTICLUSTER_NAME})),this.$el.addClass("mc-list-wrapper "+this.cssClass),_.bindAll(this,"onAdjustView"),$("body").on(h.MULTICLUSTER_PANE_UPDATE,this.onAdjustView)},destroy:function(){$(".n-cluster-popover").remove(),this.$(".n-cluster-item").off(),$("body").off(h.MULTICLUSTER_PANE_UPDATE,this.onAdjustView),e.prototype.destroy.apply(this,arguments)},_clearClusterItems:function(){var e=this;this.$(".n-cluster-item").each(function(t,i){e._getModelByEl(i)||$(i).remove()})},_getModelByEl:function(e){return this.collection.find(function(t){return t.getClusterUuid()===$(e).attr(u.CLUSTER_UUID)})},_getElByModel:function(e){var t=".n-cluster-item["+u.CLUSTER_UUID+'="'+e.getClusterUuid()+'"]';return this.$(t)},getAlertCounts:function(e){var t={},n=e.getAlertSummary();if(!n)return a.log("BaseMulticlusterView: ERROR: cannot find alertSummary in ClusterModel"),t;var s=new i(n);return _.each(o.ALERT_SEVERITY_NAMES,function(e,i){t[i]=s.getAlertCountsBySeverity(i)}),t},getHealthStatus:function(e){return e.getClusterHealthStatus()},getTaskInfo:function(e){return this.taskCollection.filter(function(t){return t[u.CLUSTER_UUID]===e.getClusterUuid()})},addPopover:function(e){if("object"!=typeof e||!e.el||!e.body)return void a.log("BaseMulticlusterView: addPopover: Invalid options argument.");var t=this,i=function(i){var n=t._getModelByEl(i.currentTarget),r=$(e.body());if(n.isAvailable()&&t._isClusterSupported(n))$(r).find(".n-cluster-available").show(),$(r).find(".n-cluster-unavailable").hide(),t.updatePopoverAlertData(r,i.currentTarget),t.updatePopoverTaskData(r,i.currentTarget),t.updatePopoverHealthData(r,i.currentTarget);else if($(r).find(".n-cluster-available").hide(),$(r).find(".n-cluster-unavailable").show(),n.isAvailable()){var o=t.getPopoverNotSupportedMessage(n);$(r).find(".n-cluster-unavailable").empty().append(o)}if($(r).find(".n-cluster-version").html("Version "+n.get(u.CLUSTER_NOS_VERSION)),e.attach){$(r).appendTo(e.attach).css({visibility:"hidden"});try{a.compareVersions(s.getPrismCentralVersion(),n.get(u.CLUSTER_NOS_VERSION),3)<0&&($(r).find(".n-cluster-incompatible").html("This software combination may result in inconsistencies in the UI. Please upgrade Prism Central to version "+n.get(u.CLUSTER_NOS_VERSION)+" or later."),$(r).css({width:"210px",right:"-210px",height:"135px"}))}catch(e){a.log("BaseMulticlusterView: "+e.error)}var l=1.5*$(i.currentTarget).outerHeight()+$(i.currentTarget).position().top-$(r).outerHeight()/2,c=$(r).outerHeight()/2-5;$(r).find(".n-caret").css("top",c),$(r).css("top",l);var d=$(r).offset().top+$(r).outerHeight()-$(window).height();d>0&&(l-=d,c+=d,$(r).find(".n-caret").css("top",c),$(r).css("top",l)),$(r).css({visibility:"visible"})}else $(r).appendTo(e.el);$(r).addClass(t._getModelByEl(i.currentTarget).getClusterUuid())},n=function(t){e.attach?$(e.attach).find(".n-cluster-popover").remove():$(e.el).find(".n-cluster-popover").remove()};e.trigger&&"hover"!==e.trigger?"click"===e.trigger&&e.el&&$(e.el).on("click",function(t){$(e.el).find(".n-cluster-popover").length?n():i(t)}):e.el&&$(e.el).hover(i,n)},getPopoverNotSupportedMessage:function(e){return"This Prism Central version no longer supports this Prism Element (Version "+e.get(u.CLUSTER_NOS_VERSION)+"). Please upgrade the cluster to version 4.0.3 (or later)."},getItemTemplate:function(){},getPopoverContentTemplate:function(){},generateFilteredList:function(e){var t=this.$el.closest(".mc-wrapper").find(".mc-search input"),i=t.val().toLowerCase().trim(),n=this.$el.closest(".mc-wrapper").find(".critical");return _.filter(e.models,function(e){var t=!0;if(""!==i){var s=e.get(e.nameAttribute)||"";s&&s.length?t=-1!==s.toLowerCase().indexOf(i):a.log("BaseMulticlusterView: generateFilteredList: Issue with retrieving cluster name for cluster "+e.getClusterUuid())}return n.hasClass("selected")&&(t=this.getHealthStatus(e)===o.HEALTH_STATUS.CRITICAL),t},this)},updateAlertData:function(e){var t=this.getAlertCounts(e),i=this._getElByModel(e);_.each(o.ALERT_SEVERITY_NAMES,function(e,n){t[n]>0?i.find(".n-badge."+n).show():i.find(".n-badge."+n).hide()})},updateTaskData:function(e){var t=this.getTaskInfo(e);this._setRadialTaskProgress(t,e)},updateHealthData:function(e){var t=this.getHealthStatus(e),i=this._getElByModel(e),n=i.find(".n-health-icon");n.removeClass(),n.addClass("n-health-icon"),t?n.addClass(t.toLowerCase()):a.debug("BaseMulticlusterView: updateHealthData: Issue ","retrieving health status for cluster id ",e.getClusterUuid())},_setRadialTaskProgress:function(e,t){var i=this._getElByModel(t),n=i.find(".radial");if(0===e.length)return void n.hide();n.show();var s=parseInt(i.find(".n-task-wrapper .radial").data("class"),10);s=isNaN(s)?0:s;var a=0;_.each(e,function(e){this.taskCollection.isFirstPass(e)&&(a+=parseInt(e.get(u.TASK_PERCENT_COMPLETE),10))},this);var r,o;a>0&&(a=Math.min(s+a/e.length,100),r=n.data("class"),o=Math.floor(a),r>o?n.addClass("decreasing"):n.removeClass("decreasing"),n.removeClass("percent"+r).addClass("percent"+o),n.data("class",o));var l=0;_.each(e,function(e){l+=parseInt(e.get(u.TASK_PERCENT_COMPLETE),10)}),l=Math.min(l/e.length,100),r=this.$(".radial").data("class"),o=Math.floor(l),r>o?n.addClass("decreasing"):n.removeClass("decreasing"),n.removeClass("percent"+r).addClass("percent"+o),n.data("class",o)},updatePopoverAlertData:function(e,t){var i=this._getModelByEl(t),n=this.getAlertCounts(i);e.find(".n-icon").hide(),_.each(o.ALERT_SEVERITY_NAMES,function(t,i){n[i]>0?(e.find(".n-badge."+i).parent().show(),e.find(".n-badge-number."+i).html(n[i]),e.find(".n-icon").show()):e.find(".n-badge."+i).parent().hide()})},updatePopoverTaskData:function(e,t){var i=this._getModelByEl(t),n=this.getTaskInfo(i);if(0===n.length)return void e.find(".n-progress-text").html("No Tasks");var s=0,r=n.length;_.each(n,function(e){var t=parseInt(e.get(u.TASK_PERCENT_COMPLETE),10)
;_.isNumber(t)?s+=t:(a.log("BaseMulticlusterView: updatePopoverTaskData:  Invalid progress calculated for task "+e.getValue(u.TASK_ENTITY_ID)+" and task type: "+e.get(u.TASK_TYPE)+" and entity type: "+e.getValue(u.TASK_ENTITY_TYPE)),r--)}),s=Math.round(Math.min(s/r,100)),a.isDisplayableNumber(s)?s+="% progress":(s="",a.log("BaseMulticlusterView: updatePopoverTaskData:  Invalid task progress for cluster "+this._getModelByEl(t).getClusterUuid())),e.find(".n-progress-text").html(s)},updatePopoverHealthData:function(e,t){var i=this._getModelByEl(t),n=this.getHealthStatus(i),s=e.find(".n-health-text");if(n){s.html("Health "+n.toLowerCase());var r=_.keys(o.HEALTH_STATUS).join(" ").toLowerCase();s.removeClass(r),n&&s.addClass(n.toLowerCase())}else e.find(".n-health-text").html(""),a.log("BaseMulticlusterView: updatePopoverHealthData:  Issue retrieving health for cluster id "+i.getClusterUuid())},updateItem:function(e){this.updateAlertData(e),this.updateHealthData(e),this.updateTaskData(e);var t=$("body .n-cluster-popover."+e.getClusterUuid()),i=this._getElByModel(e);i.find(".n-cluster-name").text(e.get(e.nameAttribute)).attr("title",e.get(e.nameAttribute)),e.isAvailable()&&this._isClusterSupported(e)?(i.removeClass("unavailable"),i.find(".n-unreg-cluster").hide()):(i.addClass("unavailable"),i.find(".n-unreg-cluster").show()),t.length&&(e.isAvailable()&&this._isClusterSupported(e)?($(t).find(".n-cluster-available").show(),$(t).find(".n-cluster-unavailable").hide(),this.updatePopoverAlertData(t,i),this.updatePopoverTaskData(t,i),this.updatePopoverHealthData(t,i)):($(t).find(".n-cluster-available").hide(),$(t).find(".n-cluster-unavailable").show()))},addItem:function(e,t){var i=e.toJSON(e.attributes);i[u.NAME]=i[u.NAME],_.extend(i,this.getHealthStatus(e),this.getAlertCounts(e),this.getTaskInfo(e));var n=$(this.getItemTemplate()(i));return $(n).attr(u.CLUSTER_UUID,e.getClusterUuid()),$(n).attr("clusterName",i[u.NAME]),this.addPopoverToItem(n),t?this._getElByModel(t).after(n):this.$(".n-cluster-list").append(n),this.updateItem(e),n},update:function(){if(!this.isProcessingClick){this.cleanItems();var e=null,t=this.generateFilteredList(this.collection);this.$(".n-cluster-item").show(),this.collection.each(function(i,n){var a=this._getElByModel(i);a.length?this.updateItem(i):a=this.addItem(i,0===n?null:t[n-1]),_.find(t,function(e){return e.getClusterUuid()===i.getClusterUuid()})||a.hide(),s.getCurrentClusterId()===i.getClusterUuid()&&(e=i)},this),this.updateSelected(e),this.onAdjustView()}},updateSelected:function(e,t){if(this.$(".n-cluster-item").removeClass("selected"),this.$(".mc-title-link").removeClass("selected"),e){var i=this._getElByModel(e);$(i).addClass("selected")}else(s.getCurrentClusterId()===o.MULTICLUSTER_CLUSTER_ID||t)&&this.$(".mc-title-link").addClass("selected")},cleanItems:function(){var e=this;this.$(".n-cluster-item").each(function(t,i){if(!e._getModelByEl(i)){if(s.getCurrentClusterId()===$(i).attr(u.CLUSTER_UUID)){var n=$(i).attr("clusterName"),a="You were viewing cluster "+n+" but it has been unregistered. Click OK to navigate to the Prism Central page.";$.nutanixConfirm({msg:a,yes:function(){e.onClickMulticlusterTitle()},yesText:"OK",hideNo:!0,defaultNo:!1})}i.remove()}})},_isClusterSupported:function(e){return!!e.isFFEnabled(o.FFLAGS.IFRAME)},onClickMulticlusterTitle:function(e){this.isProcessingClick=!0,this.updateSelected(null,!0);var t=this.appModel.getMulticlusterPageRoute()||{};t.pageId||(t.pageId=o.PAGE_MC_DASHBOARD),$(document).trigger(h.NAV_TOGGLE_MODE),$(".n-page").css({display:"none"}),a.showLoader();var i=this;setTimeout(function(){i.isProcessingClick=!1,n.navigateToPageRouteObject(t,!0)},300)},onClickSingleClusterItem:function(e){var t=$(e.currentTarget).attr(u.CLUSTER_UUID);if(this.isFFEnabled(o.FFLAGS.INSIGHTS))return this.updateSelected(this._getModelByEl(e.currentTarget)),void c.loadDashboard(o.ENTITY_CLUSTER,t);if(!$(e.currentTarget).hasClass("unavailable")){this.isProcessingClick=!0,this.updateSelected(this._getModelByEl(e.currentTarget));var i=!1,r=this.appModel.getSingleClusterPageRoute(t)||{},p=s.getClusterModelByClusterUuid(t);r.pageId||(r.pageId=o.PAGE_DASHBOARD,p.supportsPrismElementIFrame()&&(i=!0,$(".container-fluid").append(l.PRELOADER_PRISM_ELEMENT_IFRAME)));var _=a.parseQueryToObject(r.options)||{};_[d.CLUSTER_ID]=t,r.options=a.formatObjectToQuery(_),$(document).trigger(h.NAV_TOGGLE_MODE),$(".n-page").css({display:"none"}),i||a.showLoader();var T=this;setTimeout(function(){T.isProcessingClick=!1,n.navigateToPageRouteObject(r,!0)},300)}},onAdjustView:function(){var e=$(window).height();r.applyAntiScroll(this.$(".antiscroll-wrap"),null,e-160+"px",{x:!1})},onClickUnregCluster:function(e){var i=$(e.currentTarget).closest(".n-cluster-item").attr("clusterUuid");$.nutanixConfirm({msg:"This should only be performed on a cluster that has been destroyed.  If this cluster is just temporarily down then one should wait for this cluster to come back online and use the Prism Central Registration dialog page to perform the proper unregistration.  Are you sure you want to continue?",yes:function(){var e=new t({id:i});e.isAlwaysMulticluster=!0,e.on("destroy",function(){this.collection.fetch()},this),e.destroy()},yesText:"Yes",noText:"No",context:this}),e.stopPropagation()}})}),define("views/navigation/ListMulticlusterView",["views/navigation/BaseMulticlusterView"],function(e){"use strict";var t=_.template('<li class="n-cluster-item"><div class="n-cluster-snapshot"><i class="n-health-icon" aria-hidden="true" data-icon="I"></i><div class="radial percent0" style="display:none"><b><i></i></b><b><i></i></b></div><div class="n-badges"><div class="n-badge kCritical" style="display:none"></div><div class="n-badge kWarning" style="display:none"></div><div class="n-badge kInfo" style="display:none"></div></div></div><i class="n-unreg-cluster" aria-hidden="true" data-icon="K" title="Unregister Cluster"></i><span class="n-cluster-name" title="<%= name %>"><%= name %></span></li>'),i=_.template('<div class="n-cluster-popover n-list"><div class="n-caret"></div><div class="n-cluster-available"><div class="n-cluster-version"></div><div class="n-cluster-incompatible"></div><div class="n-health-text"></div><i class="n-icon" aria-hidden="true" data-icon="D"></i><div class="n-badges"><div class="n-popover-badge-item" style="display:none"><div class="n-badge kCritical"></div><div class="n-badge-number kCritical"></div></div><div class="n-popover-badge-item" style="display:none"><div class="n-badge kWarning"></div><div class="n-badge-number kWarning"></div></div><div class="n-popover-badge-item" style="display:none"><div class="n-badge kInfo"></div><div class="n-badge-number kInfo"></div></div></div><div class="n-progress-text"></div></div><div class="n-cluster-unavailable" style="display:none;">This cluster is currently not accessible.</div></div>');return e.extend({cssClass:"mc-list",getItemTemplate:function(){return t},getPopoverContentTemplate:function(){return i},addPopoverToItem:function(e){this.addPopover({el:$(e),body:this.getPopoverContentTemplate(),trigger:"hover",attach:this.$el.closest(".subview-wrapper")})}})}),define("views/navigation/TileMulticlusterView",["views/navigation/BaseMulticlusterView"],function(e){"use strict";var t=_.template('<li class="n-cluster-item"><div class="n-cluster-snapshot"><i class="n-health-icon" aria-hidden="true" data-icon="I"></i><br><div class="n-badges"><div class="n-badge kCritical" style="display:none"></div><div class="n-badge kWarning" style="display:none"></div><div class="n-badge kInfo" style="display:none"></div><div class="radial percent0" style="display:none"><b><i></i></b><b><i></i></b></div><div class="n-badges"></div><span class="n-cluster-name" title="<%= name %>"><%= name %></span></li>'),i=_.template('<div class="n-cluster-popover n-tile"><div class="n-cluster-available"><div class="n-cluster-version"></div><div class="n-health-text"></div><div class="n-badges"><div class="n-popover-badge-item" style="display:none"><div class="n-badge kCritical"></div><div class="n-badge-number kCritical"></div></div><div class="n-popover-badge-item" style="display:none"><div class="n-badge kWarning"></div><div class="n-badge-number kWarning"></div></div><div class="n-popover-badge-item"  style="display:none"><div class="n-badge kInfo"></div><div class="n-badge-number kInfo"></div></div></div><div class="n-progress-text"></div></div><div class="n-cluster-unavailable" style="display:none;">This cluster is currently not accessible<i class="n-unreg-cluster" aria-hidden="true" data-icon="K"></i></div></div>');return e.extend({cssClass:"mc-tile",getItemTemplate:function(){return t},getPopoverNotSupportedMessage:function(e){return"Prism Element not supported. Please upgrade cluster."},getPopoverContentTemplate:function(){return i},addPopoverToItem:function(e){this.addPopover({el:$(e),body:this.getPopoverContentTemplate(),trigger:"hover"})}})}),define("text!templates/navigation/MulticlusterPaneView.html",[],function(){return'\x3c!-- Multicluster side pane view\n================================================== --\x3e\n\n<div class="mc-wrapper">\n\n  \x3c!-- Header --\x3e\n  <div class="mc-header">\n    <ul class="filters">\n      <li><a class="all selected">All</a></li>\n      <li class="n-sep">&middot;</li>\n      <li><a class="critical">Critical</a></li>\n      \x3c!-- TODO: Put this back in when the back end is ready.\n      <li class="n-sep">&middot;</li>\n      <li><a class="modified">Recently Modified</a></li> --\x3e\n    </ul>\n    <ul class="format">\n      <li>\n        <span class="list-icon selected">\n          <span class="bar one"></span>\n          <span class="bar two"></span>\n          <span class="bar three"></span>\n        </span>\n      </li>\n      <li>\n        <span class="tile-icon">\n          <div class="tilerow one">\n            <span class="tilecell one"></span>\n            <span class="tilecell two"></span>\n          </div>\n          <div class="tilerow two">\n            <span class="tilecell one"></span>\n            <span class="tilecell two"></span>\n          </div>\n        </span>\n      </li>\n    </ul>\n  </div>\n\n  \x3c!-- Search --\x3e\n  <div class="mc-search">\n    <div class="mc-search-wrapper">\n      <i aria-hidden="true" data-icon="B" class="n-icon-search"></i>\n      <input id="searchText" type="text" class="search-query dropdown-toggle"\n        spellcheck="false" placeholder="Search for a specific cluster"\n        autocomplete="off">\n     </div>\n  </div>\n\n  <div class="subview-wrapper list"></div>\n</div>'}),define("views/navigation/MulticlusterPaneView",["views/basecomponents/BaseView","views/navigation/ListMulticlusterView","views/navigation/TileMulticlusterView","text!templates/navigation/MulticlusterPaneView.html","managers/ClusterManager","managers/TaskManager","utils/AppConstants","utils/SubViewHelper","utils/InsightsUtil"],function(e,t,i,n,s,a,r,o,l){"use strict";return e.extend({collection:null,alertCollection:null,subViewHelper:null,appModel:null,isTileMode:!1,filterClustersBy:null,events:{"click .list-icon":"onToggleViewMode","click .tile-icon":"onToggleViewMode","keydown #searchText":"onKeyDownSearch","click .filters .all":"onClickHealthSelector","click .filters .critical":"onClickHealthSelector"},initialize:function(){this.taskCollection=a.getTaskMulticlusterCollection(),this.clusterCollection=this.getClusterCollection();var e={appModel:this.options.appModel,clusterCollection:this.clusterCollection,taskCollection:this.taskCollection};this.subViewHelper=new o,this.subViewHelper.register("tileView",new i(e)),this.subViewHelper.register("listView",new t(e)),this.render()},render:function(){this.appModel=this.options.appModel,0===this.$el.children().length&&(this.$el.html(_.template(n)).addClass("n-multicluster"),this.subViewHelper.get("tileView").render(),this.subViewHelper.get("listView").render(),this.$(".subview-wrapper").append(this.getCurrentSubView().$el)),this.update()},getClusterCollection:function(){var e;return this.isFFEnabled(r.FFLAGS.INSIGHTS)?(e=l.getClusterCollection(),e.fetch()):e=s.getClusterCollection(),e},update:function(){this.clusterCollection.specialSort(),this.getCurrentSubView().update()},switchToTileMode:function(){this.getCurrentSubView().$el.detach(),this.isTileMode=!0,this.$(".list-icon").removeClass("selected"),this.$(".tile-icon").addClass("selected"),this.$(".subview-wrapper").append(this.getCurrentSubView().$el),this.$(".subview-wrapper").addClass("tile"),this.$(".subview-wrapper").removeClass("list"),this.update()},switchToListMode:function(){this.getCurrentSubView().$el.detach(),this.isTileMode=!1,this.$(".list-icon").addClass("selected"),this.$(".tile-icon").removeClass("selected"),this.$(".subview-wrapper").append(this.getCurrentSubView().$el),this.$(".subview-wrapper").addClass("list"),this.$(".subview-wrapper").removeClass("tile"),this.update()},getCurrentSubView:function(){return this.isTileMode?this.subViewHelper.get("tileView"):this.subViewHelper.get("listView")},destroy:function(){this.stopServices(),e.prototype.destroy.apply(this,arguments)},onStartServices:function(){this.clusterCollection.on("reset",this.update,this),this.taskCollection.on("reset",this.update,this)},onStopServices:function(){this.clusterCollection.off("reset",this.update,this),this.taskCollection.off("reset",this.update,this)},onToggleViewMode:function(e){$(e.currentTarget).hasClass("list-icon")&&this.isTileMode?this.switchToListMode():$(e.currentTarget).hasClass("tile-icon")&&!this.isTileMode&&this.switchToTileMode()},onClickHealthSelector:function(e){$(e.currentTarget).hasClass("selected")||(this.$(".filters .critical").toggleClass("selected"),this.$(".filters .all").toggleClass("selected"),this.update())},onKeyDownSearch:_.debounce(function(){this.update()},100)})}),define("views/header/HeaderView",["views/basecomponents/BaseView","text!templates/header/HeaderView.html","views/navigation/NavigationView","views/navigation/PCNavigationView","views/navigation/MulticlusterPaneView","managers/ClusterManager","managers/NotificationManager","managers/TaskManager","managers/PrismElementManager","utils/AppConstants","utils/AppUtil","utils/SubViewHelper","events/AppEvents"],function(e,t,i,n,s,a,r,o,l,c,u,d,h){"use strict";return e.extend({appModel:null,subViewHelper:null,isInitialized:!1,initialize:function(){this.subViewHelper=new d,this.render()},render:function(){this.$el.html(t),this.appModel=this.options.appModel;var e=new i({appModel:this.appModel});this.subViewHelper.register("singleClusterNavigationView",e),a.getClusterCollection().length&&a.isMulticlusterUI()?this.switchToMulticlusterMode():this.switchToSingleClusterMode()},updateSelectedPage:function(e,t){a.isMulticlusterNavMode()?this.getMulticlusterNavigationView().updateSelectedPage(e,t):this.getSingleClusterNavigationView().updateSelectedPage(e,t)},showNavBar:function(e){this.$(".n-header-level-1").append(e.$el),this.isInitialized&&e.startServices()},hideNavBar:function(e){e.stopServices(),e.$el.detach()},switchToMulticlusterMode:function(){this.getMulticlusterNavigationView().$el.is(":visible")||(this.hideNavBar(this.getSingleClusterNavigationView()),this.showNavBar(this.getMulticlusterNavigationView())),this.getMulticlusterNavigationView().hideMulticlusterPane()},switchToSingleClusterMode:function(){var e=this.getSingleClusterNavigationView();this.getMulticlusterNavigationView()&&this.getMulticlusterNavigationView().$el.is(":visible")?(this.hideNavBar(this.getMulticlusterNavigationView()),this.showNavBar(e)):e.getClusterId()!==a.getCurrentClusterId()&&(e.$el.is(":visible")?(r.hideNotificationBar(),e.stopServices(),e.startServices()):this.showNavBar(e)),this.getSingleClusterNavigationView().hideMulticlusterPane()},destroy:function(){u.debug("HeaderView | destroy | ",this.cid),this.subViewHelper.removeAll(),e.prototype.destroy.apply(this,arguments)},prepareForClusterSwitch:function(){l.isLoadedFromPrismCentral()&&this.$(".n-multicluster-name").empty()},updateClusterName:function(){a.isMulticlusterUI()||this.getSingleClusterNavigationView().updateClusterName()},refreshClusterName:function(){a.fetchOnDemand()},instantiateMulticlusterPaneView:function(){if(a.isMulticlusterUI()&&!this.getMulticlusterPaneView()){var e=new s({appModel:this.appModel});e.startServices(),this.subViewHelper.register("multiclusterPaneView",e),$("#n-content-wrapper").after(this.getMulticlusterPaneView().$el)}},onStartServices:function(){var e=!1;if(a.isMulticlusterUI()){if(void 0===a.getCurrentClusterModel()){u.log("Invalid cluster id parameter in the url: "+a.getClusterIdFromPageRoute());return void r.showClientNotification(c.NOTIFY_ERROR,"The clusterid parameter in the url appears to  be invalid. Please adjust the url and refresh the browser.",{temporary:!1})}o.initializeMulticlusterTask();var t;t=new n({appModel:this.appModel,clusterCollection:a.getClusterCollection(),taskCollection:o.getTaskMulticlusterCollection()}),this.subViewHelper.register("multiclusterNavigationView",t),e=!0}e&&this.$el.addClass("n-multicluster-header-ui"),a.isMulticlusterNavMode()?this.getMulticlusterNavigationView().startServices():this.getSingleClusterNavigationView().startServices(),this.updateClusterName(),this.isInitialized=!0},onStopServices:function(){$(document).off(h.NAV_TOGGLE_MODE),a.isMulticlusterNavMode()?this.getMulticlusterNavigationView().stopServices():this.getSingleClusterNavigationView().stopServices()},getMulticlusterPaneView:function(){return this.subViewHelper.get("multiclusterPaneView")},getSingleClusterNavigationView:function(){return this.subViewHelper.get("singleClusterNavigationView")},getMulticlusterNavigationView:function(){return this.subViewHelper.get("multiclusterNavigationView")},updateGlobalKeyEvent:function(e){var t;(t=a.isMulticlusterNavMode()?this.getMulticlusterNavigationView():this.getSingleClusterNavigationView())&&t.updateGlobalKeyEvent&&t.updateGlobalKeyEvent(e)},refreshNavigationView:function(){this.navigationView&&this.navigationView.refreshView()}})}),define("views/basecomponents/pages/fulldetails/FullDetailsNavHeaderView",["views/basecomponents/BaseView","utils/SVG","managers/NavigationManager"],function(e,t,i){"use strict";var n=_.template('<span class="header-left"><span class="header-name"><span class="name entityName n-title"></span></span><span class="entity-dropdown"></span></span>');return e.extend({entityId:null,entityType:null,contextId:null,entities:null,events:{"click .fulldetail-close-button":"onClickCloseButton","click .action-header > .help-icon":"onClickHelpIcon"},EVENTS:{ENTITY_DROPDOWN_CLICKED:"onEntityItemSelected",CLOSE_BUTTON_CLICKED:"closeButtonClicked",HELP_ICON_CLICKED:"helpIconClicked"},HOTKEYS:{PREVIOUS_ENTITY:37,NEXT_ENTITY:39,ESCAPE:27},initialize:function(t){e.prototype.initialize.apply(this,arguments),this.reInitialize(t||{}),_.bindAll(this,"onKeyDown","selectEntityItemById")},reInitialize:function(e){this.contextId=e.contextId,this.entityId=e.entityId,this.entityType=e.entityType,this.model=e.model,this.entities=null;var t=i.getNavigationContext(this.contextId);t&&(this.entities=t.options&&t.options.entities),this.render()},render:function(){this.$(".title-header").html(n()),this.$(".fulldetail-close-button").html(t.SVGIcon("K")),this.renderDropDownList(),this.applyNutanixInput({types:["select"]})},renderDropDownList:function(){var e=this;if(this.$(".entity-dropdown").nutanixListDropdown({source:this._getAutocompleteSource(),currentEntityValue:this.entityId,button:this.$(".header-name"),onSelect:this.selectEntityItemById.bind(this),footerElements:[{caption:"Go back to table",svgIcon:"x",onClick:this.onClickCloseButton.bind(this)}]}),this.entities){var t=_.find(this.entities,function(t){return t.id===e.entityId});if(t){var i=this.getFormattedName(t);this.$(".entityName").html(i)}}else if(this.model){var n=this.getFormattedName(this.model);this.$(".entityName").html(n)}},_getAutocompleteSource:function(){var e=[];return _.each(this.entities,function(t){var i=this.getFormattedName(t);e.push({label:i,value:t.getId()})},this),e},selectEntityItemById:function(e){this.trigger(this.EVENTS.ENTITY_DROPDOWN_CLICKED,e)},getEntityIdWithOffset:function(e){var t=this._getAutocompleteSource(),i=-1,n=this.entityId,s=0;if(_.find(t,function(e,t){return!(!e.value||e.value!==n)&&(i=t,!0)}),i>=0&&(s=((i+e)%t.length+t.length)%t.length),t[s]&&t[s].value)return t[s].value},getNextEntityId:function(){return this.getEntityIdWithOffset(1)},getPreviousEntityId:function(){return this.getEntityIdWithOffset(-1)},getFormattedName:function(e){return e&&e.getFormattedEntityName?e.getFormattedEntityName(e):e.getName()},onDataChange:function(e){this.$(".entityName").html(this.model.getName())},onKeyDown:function(e){if(e.keyCode===this.HOTKEYS.ESCAPE)return void this.trigger(this.EVENTS.CLOSE_BUTTON_CLICKED);var t=$(document.activeElement);t.is("input")||t.is("textarea")||(e&&e.keyCode===this.HOTKEYS.PREVIOUS_ENTITY?this.selectEntityItemById(this.getPreviousEntityId()):e&&e.keyCode===this.HOTKEYS.NEXT_ENTITY&&this.selectEntityItemById(this.getNextEntityId()))},onClickCloseButton:function(e){this.trigger(this.EVENTS.CLOSE_BUTTON_CLICKED)},onClickHelpIcon:function(e){this.trigger(this.EVENTS.HELP_ICON_CLICKED)},onStartServices:function(){this.model.on("change",this.onDataChange,this),$("body").on("keydown",this.onKeyDown)},onStopServices:function(){this.model.off("change",this.onDataChange,this),$("body").off("keydown",this.onKeyDown)}})}),define("text!templates/basecomponents/details/FullDetailsPageView.html",[],function(){return'<section class="top-header">\n  <header class="navHeader page-header full-page-loader">\n    <section class="title-header">\n    </section>\n    <section class="action-header">\n      <div class="action-bar actionBar"></div>\n      <% if (showHelpUrl) { %>\n        <div class="help-icon">\n          <i aria-hidden="true" data-icon="O"></i>\n        </div>\n      <% } %>\n      <i class="fulldetail-close-button" title="Back">\n        <a></a>\n      </i>\n    </section>\n  </header>\n  <header class="tab-header">\n    <nav class="header-tabs -inline -separators">\n      \x3c!-- This is where FullDetails(VM, Host..etc)TabView operates --\x3e\n    </nav>\n  </header>\n</section>\n<section class="tabBody tab-content">\n  \x3c!-- This is where FullDetails(VM Host..etc)TabView operates --\x3e\n</section>\n'}),define("views/basecomponents/pages/fulldetails/FullDetailsPageView",["views/basecomponents/BaseView","views/basecomponents/pages/fulldetails/FullDetailsNavHeaderView","utils/AppConstants","utils/SubViewHelper","events/AppEvents","managers/NavigationManager","managers/EntityManager","managers/ActionManager","managers/HelpManager","text!templates/basecomponents/details/FullDetailsPageView.html"],function(e,t,i,n,s,a,r,o,l,c){"use strict";var u=_.template(c),d=_.template("The <%= entityType %> you are viewing has been deleted.  This view will now be closed."),h={ACTION_VIEW:"actionView",TAB_VIEW:"tabView",NAV_HEADER_VIEW:"navHeaderView"};return e.extend({subViewHelper:null,detailPaneRoute:null,entityId:null,entityType:null,contextId:null,model:null,EVENT:{FULL_DETAILS_CLOSED:"fullDetailPageClosed"},initialize:function(t){e.prototype.initialize.apply(this,arguments),this.subViewHelper=new n,_.bindAll(this,"_renderPageContents")},render:function(){return this.$el.html(u({showHelpUrl:this.isClusterFFEnabled(i.FFLAGS.HELP_DOC)})),this.isViewRendered=!0,this},refreshView:function(e){e&&e.detailPaneRoute&&(this.$(".full-page-loader").addClass("loading"),this.isViewRendered&&this.stopServices(),this.reInitRoute(e.detailPaneRoute),r.loadEntityDetailsViewContents(this.entityType,this._renderPageContents))},onEntityEvent:function(e,t){t.entityType===this.entityType&&_.contains(t.entityIds,this.entityId)&&(e.type===s.ENTITIES_UPDATED?(this.refreshSubViews(),this.model&&this.model.fetch()):e.type===s.ENTITIES_DELETED&&$.nutanixConfirm({msg:d({entityType:i.ENTITY_NAMES[this.entityType]||"entity"}),yes:function(){this.onCloseBtnClicked()},yesText:"OK",hideNo:!0,context:this}))},_renderPageContents:function(e,t,i){this.initializeModel(e),this.isViewRendered||this.render(),this.initializeSubViews(t,i),this.startServices()},reInitRoute:function(e){this.contextId=e.contextId,this.entityId=e.entityId,this.entityType=e.entityType,this.targetTabId=e.targetTabId},updateTabId:function(e){this.targetTabId=e},initializeModel:function(e){var t=[];if(this._shouldUseBasicInfoProjection()&&t.push(i.PROJECTION.BASIC_INFO),this.entityType===i.ENTITY_CLUSTER&&t.push(i.PROJECTION.HEALTH),this.model=r.createEntityModelInstance(e,{projections:t}),!this.model)throw new Error("The model on FullDetailsPageView has not been initialized.  Entity: "+this.entityType);this.model.setId(this.entityId)},initializeSubViews:function(e,i){this.subViewHelper.get(h.TAB_VIEW)&&this.subViewHelper.remove(h.TAB_VIEW),this.subViewHelper.get(h.ACTION_VIEW)&&this.subViewHelper.remove(h.ACTION_VIEW);var n=this.subViewHelper.get(h.NAV_HEADER_VIEW);n?n.reInitialize({entityId:this.entityId,entityType:this.entityType,contextId:this.contextId,model:this.model}):(n=new t({el:this.$(".navHeader"),entityId:this.entityId,entityType:this.entityType,contextId:this.contextId,model:this.model}),this.subViewHelper.register(h.NAV_HEADER_VIEW,n));var s={el:this.$(".header-tabs"),entityType:this.entityType,entityId:this.entityId,targetTabId:this.targetTabId,currentModel:this.model,tabBodyElement:this.$(".tabBody").empty()},a={el:this.$(".action-bar"),model:this.model};i&&this.subViewHelper.register(h.ACTION_VIEW,new i(a)),this.subViewHelper.register(h.TAB_VIEW,new e(s))},refreshSubViews:function(){var e={entityId:this.entityId,entityType:this.entityType,contextId:this.contextId,model:this.model},t=this.subViewHelper.get(h.NAV_HEADER_VIEW);t&&t.refreshView();var i=this.subViewHelper.get(h.TAB_VIEW);i&&i.refreshView(e);var n=this.subViewHelper.get(h.ACTION_VIEW);n&&n.refreshView(e)},show:function(){this.onResize()},destroy:function(){this.subViewHelper.removeAll(),this.$el.empty(),e.prototype.destroy.apply(this,arguments)},onResize:function(){this.subViewHelper.iterate("onResize")},onEntityItemSelected:function(e){e!==this.entityId&&a.navigateToFullScreenDetailsPane(this.entityType,e,this.contextId,this.targetTabId,!0)},onHelpIconClicked:function(){l.navigateToHelpPageForDetails(this.entityType)},onCloseBtnClicked:function(){this.stopServices();var e=this.subViewHelper.get(h.ACTION_VIEW);e&&e.resetViewFilter(),$("#n-ctr-notification .n-notification-msg").removeClass("n-show").addClass("n-hide"),this.trigger(this.EVENT.FULL_DETAILS_CLOSED)},onModelChange:function(){this.$(".full-page-loader").removeClass("loading")},onStartServices:function(){this.onResize(),this.subViewHelper.iterate("startServices");var e=this.subViewHelper.get(h.NAV_HEADER_VIEW);if(e.on(e.EVENTS.ENTITY_DROPDOWN_CLICKED,this.onEntityItemSelected,this),e.on(e.EVENTS.CLOSE_BUTTON_CLICKED,this.onCloseBtnClicked,this),e.on(e.EVENTS.HELP_ICON_CLICKED,this.onHelpIconClicked,this),o.hasDeleteAction(this.entityType)){var t=this.subViewHelper.get(h.ACTION_VIEW);t.on(t.EVENTS.DELETED,this.onCloseBtnClicked,this)}var i=this.subViewHelper.get(h.TAB_VIEW);i.on(i.TAB_CHANGED_EVENT,this.updateTabId,this),this.model&&(this.model.on("change",this.onModelChange,this),"function"==typeof this.model.startPolling?this.model.startPolling():this.model.fetch())},onStopServices:function(){if(this.subViewHelper.iterate("stopServices"),this.subViewHelper.get(h.NAV_HEADER_VIEW).off(),o.hasDeleteAction(this.entityType)){var e=this.subViewHelper.get(h.ACTION_VIEW);e.off(e.EVENTS.DELETED,this.onCloseBtnClicked,this)}this.model&&(this.model.off("change",this.onModelChange),"function"==typeof this.model.stopPolling?this.model.stopPolling():this.model.stopFetch())},_shouldUseBasicInfoProjection:function(){return this.entityType===i.ENTITY_VM||this.entityType===i.ENTITY_CLUSTER||this.entityType===i.ENTITY_HOST||this.entityType===i.ENTITY_DISK}})}),define("managers/IdleManager",["models/userdata/UserDataCollection","managers/NamespaceManager","managers/NavigationManager","managers/PrismElementManager","managers/AccessManager","utils/AppConstants","data/DataProperties","utils/AppUtil"],function(e,t,i,n,s,a,r,o){"use strict";return{warningTimer:null,warningTimeoutMillisecs:null,logoutTimer:null,logoutTimeoutMillisecs:null,lastIdleTime:null,skipAutoLogout:!1,isLoggingOut:!1,initialize:function(){if(t.set(t.IDLE_MANAGER))throw"Attempting to initialize IdleManager twice ?";n.isLoadedFromPrismCentral()?t.set(t.IDLE_MANAGER,PrismCentral[t.IDLE_MANAGER]):t.set(t.IDLE_MANAGER,this);var i,l,c,u=t.get(t.SESSION_INFO),d=u[r.USER_SETTINGS];if(d&&d[r.USER_DATA_TYPE_UI_CONFIG]){var h=new e(d[r.USER_DATA_TYPE_UI_CONFIG]);h.getAutoLogoutTimeModel()&&(i=h.getAutoLogoutTime()),h.getAutoLogoutGlobalModel()&&(l=h.getAutoLogoutGlobal()),h.getAutoLogoutOverrideModel()&&(c=h.getAutoLogoutOverride())}var p=o.getEffectiveSessionTimeoutSettings({userTimeout:i,globalTimeout:l,overrideTimeout:c},s.isClusterAdmin());if(this.setAutoLogoutTime(o.minutesToMilliseconds(p.userTimeout)),o.isLocalStorageProperty(a.LOCAL_STORAGE.DISABLE_AUTO_LOGOUT))return void(this.skipAutoLogout=!0);t.get(t.IDLE_MANAGER).restartTimer()},restartTimer:function(e){if(clearInterval(this.warningTimer),clearInterval(this.logoutTimer),this.lastIdleTime=e||Date.now(),localStorage[a.LOCAL_STORAGE.UI_IDLE_TIME]=this.lastIdleTime,0!==this.warningTimeoutMillisecs){var t=this;this.warningTimer=setTimeout(function(){if(t._hasLastIdleTimeChanged())return void t.restartTimer(Number(localStorage[a.LOCAL_STORAGE.UI_IDLE_TIME]));t.skipAutoLogout?t.restartTimer():$.nutanixConfirm({msg:"You are about to be signed out due to inactivity",yesText:"Stay Logged In",hideNo:!0,yes:function(){t.restartTimer()}})},this.warningTimeoutMillisecs),this.logoutTimer=setTimeout(function(){if(t._hasLastIdleTimeChanged())return void t.restartTimer(Number(localStorage[a.LOCAL_STORAGE.UI_IDLE_TIME]));t.skipAutoLogout||(t.isLoggingOut=!0,i.navigateToRoute(a.ROUTE_LOGOUT))},this.logoutTimeoutMillisecs)}},setAutoLogoutTime:function(e){0===e&&(clearInterval(this.warningTimer),clearInterval(this.logoutTimer)),this.warningTimeoutMillisecs=e,this.logoutTimeoutMillisecs=this.warningTimeoutMillisecs+6e4,this.restartTimer()},getAutoLogoutTime:function(){return this.logoutTimeoutMillisecs},reset:function(e){t.get(t.IDLE_MANAGER).restartTimer(e)},_hasLastIdleTimeChanged:function(){return Number(localStorage[a.LOCAL_STORAGE.UI_IDLE_TIME])!==this.lastIdleTime}}}),define("text!templates/pages/common/DefaultPageView.html",[],function(){return'\x3c!-- Page Subnavigation --\x3e\n<div class="n-page-nav">\n  \x3c!-- @view: Subnavigation View goes here... --\x3e\n</div>\n\n\x3c!-- Page Body --\x3e\n<div class="n-page-body">\n\n  \x3c!-- Master --\x3e\n  <div class="n-page-master">\n\n    <% _.each(subpageMap, function(key) { %>\n      <div class="n-subpage  n-subpage-<%= key %>"\n        subpage="<%= key %>">\n        \x3c!-- @view: Subpage view goes here... --\x3e\n      </div>\n    <% }); %>\n\n  </div>\n\n  \x3c!-- Detail --\x3e\n  <% if (typeof subpageMap.detail !== \'undefined\') { %>\n    <div class="n-page-detail">\n    </div>\n  <% } %>\n\n</div>'}),define("views/basecomponents/pages/PageTemplateRenderer",["text!templates/pages/common/DefaultPageView.html","utils/AppConstants","managers/ClusterManager","managers/CommunityEditionManager"],function(e,t,i,n){"use strict";var s=_.template(e);return{getPageTemplate:function(e){var t,i;return t=s,i=this.getSubpageMapping(e),t({subpageMap:i})},getSubpageMapping:function(e){var s={};switch(i.getPageIdFromPageUuid(e)){case t.PAGE_DASHBOARD:case t.PAGE_SETUP:case t.PAGE_ACCESS_DENIED:s={perspective:t.SUBPAGE_PERSPECTIVE};break;case t.PAGE_MC_DASHBOARD:s={perspective:t.SUBPAGE_PERSPECTIVE,detail:!0};break;case t.PAGE_VMS:case t.PAGE_DR:s=i.isMulticlusterPageUuid(e)?{table:t.SUBPAGE_TABLE,detail:!0}:{
perspective:t.SUBPAGE_PERSPECTIVE,table:t.SUBPAGE_TABLE,detail:!0};break;case t.PAGE_ANALYSIS:s={timeline:t.SUBPAGE_TIMELINE};break;case t.PAGE_INSIGHTS:s={perspective:t.SUBPAGE_PERSPECTIVE,chart:t.SUBPAGE_CHART};break;case t.PAGE_CLUSTER_HEALTH:s={entities:t.SUBPAGE_ENTITIES,tests:t.SUBPAGE_TESTS};break;case t.PAGE_ENTITY_BROWSER:s={entities:t.SUBPAGE_ENTITIES};break;case t.PAGE_LCM:s={perspective:t.SUBPAGE_PERSPECTIVE};break;case t.PAGE_NETWORK:s={vlanviz:t.SUBPAGE_VLAN_VIZ};break;case t.PAGE_ALERT_EXPLORER:case t.PAGE_TASKS:s={perspective:t.SUBPAGE_PERSPECTIVE,entities:t.SUBPAGE_ENTITIES};break;case t.PAGE_ALERTS:case t.PAGE_MC_HEALTH:s={table:t.SUBPAGE_TABLE};break;case t.PAGE_STORAGE:s=i.isMulticlusterPageUuid(e)?{table:t.SUBPAGE_TABLE,detail:!0}:{perspective:t.SUBPAGE_PERSPECTIVE,diagram:t.SUBPAGE_DIAGRAM,table:t.SUBPAGE_TABLE,detail:!0};break;case t.PAGE_HARDWARE:i.isMulticlusterPageUuid(e)?s={table:t.SUBPAGE_TABLE,detail:!0}:(s={perspective:t.SUBPAGE_PERSPECTIVE,table:t.SUBPAGE_TABLE,detail:!0},n.isCommunityEditionCluster()||(s[t.SUBPAGE_DIAGRAM]=t.SUBPAGE_DIAGRAM));break;case t.PAGE_PRISMLETS:s={app:t.SUBPAGE_PRISMLET};break;case t.PAGE_PLANNING:s={runway:t.SUBPAGE_RUNWAY,scenario:t.SUBPAGE_SCENARIO,detail:!0};break;case t.PAGE_SECURITY_PLANNING:s={app:t.SUBPAGE_TABLE};break;case t.PAGE_FILE_SERVER:s={table:t.SUBPAGE_TABLE,detail:!0};break;default:s={perspective:t.SUBPAGE_PERSPECTIVE,diagram:t.SUBPAGE_DIAGRAM,table:t.SUBPAGE_TABLE,runway:t.SUBPAGE_RUNWAY,scenario:t.SUBPAGE_SCENARIO,timeline:t.SUBPAGE_TIMELINE,vlanviz:t.SUBPAGE_VLAN_VIZ,detail:!0}}return s}}}),define("views/basecomponents/pages/PageActionTemplates",[],function(){"use strict";return{RESET_DASHBOARD:'<a class="btnPageAction" data-test="reset_dashboard_btn" <%= actionAttributes %> stream-action="Dashboards: Reset" stream-target="Dashboard">  <span><%= linkText %></span></a>',RESET_ALL_DASHBOARDS:'<a class="btnPageAction" data-test="reset_all_dashboards_btn" <%= actionAttributes %> stream-action="Dashboards: ResetAll" stream-target="Dashboard">  <span class="n-icon plus-icon css-icon icon-left -small"></span>  <span>Reset All</span></a>',ADD_WIDGET:'<a class="btnPageAction" stream-action="Dashboards: AddWidgets" stream-target="Dashboard"<%= actionAttributes %> >  <span class="n-icon plus-icon css-icon icon-left -small"></span>  <span><%= linkText %></span></a>',MANAGE_DASHBOARDS:'<a class="btnPageAction action" data-test="manage_dashboards_btn" stream-action="Dashboards: Manage" stream-target="Dashboard"<%= actionAttributes %> >  <%=SVG.SVGIcon("C") %>  <span class="name">    <%= I18nManager.t("DashboardLinksMenuView",    "manage_dashboards", "Manage Dashboards") %></span></a>',CREATE_CONTAINER:'<a class="btnPageAction" data-test="create_container_pool_btn" <%= actionAttributes %> >  <span class="n-icon plus-icon css-icon icon-left -small"></span>  <span><%= linkText %></span></a>',CREATE_STORAGE_POOL:'<a class="btnPageAction" data-test="create_storage_pool_btn"   <%= actionAttributes %> >  <span class="n-icon plus-icon css-icon icon-left -small"></span>  <span><%= linkText %></span></a>',CREATE_VOLUME_GROUP:'<a class="btnPageAction" data-test="create_volume_group_btn"   <%= actionAttributes %> >  <span class="n-icon plus-icon css-icon icon-left -small"></span>  <span><%= linkText %></span></a>',ADD_HOST:'<a class="btnPageAction btnExpandCluster"  data-test="expand_cluster_btn"  <%= actionAttributes %> >  <span class="n-icon plus-icon css-icon icon-left -small"></span>  <span><%= linkText %></span></a>',REMOVE_HOST:'<a class="btnPageAction"  data-test="shrink_cluster_btn"   <%= actionAttributes %> >  <span class="n-icon plus-icon css-icon icon-left -small"></span>  <span>Shrink cluster</span></a>',CREATE_PD_WIZARD:'<a class="btnWizard"  data-test="create_protection_domain_btn"   <%= actionAttributes %>" >  <span class="n-icon plus-icon css-icon icon-left -small"></span>  <span>Protection Domain</span></a>',CREATE_PDS_WIZARD:'<div class="dropdown -actions"><a class="dropdown-toggle pd-dropdown" data-toggle="dropdown" data-test="dr_protection_domain_btn">  <span class="n-icon plus-icon css-icon icon-left -small"></span>  <span><%= linkText %></span></a><ul class="dropdown-menu"><li><a class="btnWizard" data-test="dr_protection_domain_async" <%= asyncActionAttributes %>" ><%= asyncActionLabel%></a></li><% if ( metroAvailability) { %><li><a class="btnWizard" data-test="dr_protection_domain_metro_availability" <%= metroAvailActionAttributes %>" ><%= metroAvailActionLabel%></a></li><% } %></ul></div>',CREATE_REMOTE_SITE:'<a class="btnPageAction"  data-test="create_remote_site_btn" <%= actionAttributes %> ><span class="n-icon plus-icon css-icon icon-left -small"></span><span><%= linkText %></span></a>',CREATE_REMOTE_SITE_WIZARD:'<div class="dropdown -actions"><a class="dropdown-toggle" data-toggle="dropdown" data-test="dr_remote_site_btn"><span class="n-icon plus-icon css-icon icon-left -small"></span><span><%= linkText %></span></a><ul class="dropdown-menu"><li><a class="btnPageAction" data-test="dr_remote_site_physical_cluster"<%= nosClusterActionAttributes %>" >Physical Cluster</a></li><li><a class="btnWizard" data-test="dr_remote_site_aws"<%= amazonActionAttributes %>" >Cloud</a></li></ul></div>',ALERT_POLICIES:'<a class="btnPageAction"  data-test="create_alert_policies_btn"   <%= actionAttributes %> >  <span class="n-icon plus-icon css-icon icon-left -small"></span>  <span>Alert Policies</span></a>',ALERT_EMAIL_CONTACTS:'<a class="btnPageAction"   data-test="create_alert_email_contacts_btn"   <%= actionAttributes %> >  <span class="n-icon plus-icon css-icon icon-left -small"></span>  <span>Alert Email Configuration</span></a>',CREATE_VM:'<a class="btnPageAction"   data-test="create_vm_btn"   <%= actionAttributes %> >  <span class="n-icon plus-icon css-icon icon-left -small"></span>  <span><%= linkText %></span></a>',UPLINK_CONFIG:'<a class="btnPageAction"   data-test="uplink_config_btn"   <%= actionAttributes %> >  <span class="n-icon plus-icon css-icon icon-left -small"></span>  <span><%= linkText %></span></a>',PINNED_VMS:'<a class="btnPageAction"  data-test="pinned_vms_btn"   <%= actionAttributes %> >  <span>All Pinned VMs</span></a>',MANAGE_NETWORKS:'<a class="btnPageAction"   data-test="manage_networks_btn"   <%= actionAttributes %> >  <span><%= linkText %></span></a>',REPAIR_NODE:'<a class="btnPageAction btnRepairNode"   data-test="node_repair_btn"   <%= actionAttributes %> >  <span>Repair Host Boot Device</span></a>',ADD_FILE_SERVER:'<a class="btnPageAction" data-test="create_file_server_btn"   <%= actionAttributes %> >  <span class="n-icon plus-icon css-icon icon-left -small"></span>  <span>File Server</span></a>',ADD_SHARE_EXPORT:'<a class="btnPageAction" data-test="create_share_btn"   <%= actionAttributes %> >  <span class="n-icon plus-icon css-icon icon-left -small"></span>  <span><%= linkText %></span></a>',DEPLOY_FILE_INSIGHTS:'<a class = "btnPageAction"   data-test = "deploy_file_insights"   <%= actionAttributes %> >  <span><%= linkText %></span></a>'}}),define("models/dataprotection/RemoteSiteModel",["models/BaseModel","models/PollingModel","data/DataURLConstants","data/DataProperties","utils/AppConstants","utils/AppUtil"],function(e,t,i,n,s,a){"use strict";return t.extend({idAttribute:n.NAME,nameAttribute:n.NAME,urlRoot:i.REMOTE_SITE,name:"RemoteSiteModel",entityType:s.ENTITY_REMOTE_SITE,toJSON:function(e){var i=t.prototype.toJSON.apply(this,arguments);return e&&e.includeCustomAttributes&&(i[n.RS_CAPABILITY_NAMES]=this.getCapabilityNames(),i[n.RS_USER_CAPABILITIES]=this.getUserCapabilities(", "),i[n.RS_IP_ADDRESS]=this._getIPAddress(),this.get(n.RS_STATUS)===s.RS_STATUS.DEPLOYING&&(i[n.DATA_NO_READY]=!0)),i},getLastSuccessfulReplicationLinks:function(){return(this.get(n.RS_REPLICATION_LINKS)||[]).filter(function(e){return null!==e[n.REP_LAST_REPLICATION_START_TIME]&&null!==e[n.REP_LAST_REPLICATION_END_TIME]})},getCapabilityNames:function(){return(this.get(n.RS_CAPABILITIES)||[]).map(function(e){return s.RS_CAPABILITY_NAMES[e]||a.toTitleCase(e)}).join(", ")},getUserCapabilities:function(e){return _.filter(this.get(n.RS_CAPABILITIES)||[],function(e){return-1!==s.RS_USER_EDITABLE_CAPABILITIES.indexOf(e)}).map(function(e){return s.RS_CAPABILITY_NAMES[e]||a.toTitleCase(e)}).join(e||", ")},isCompatibleByVStore:function(e,t){var i=this.get(n.RS_VSTORE_INFO),a=this.get(n.RS_LATENCY),r=this.get(n.RS_METRO_READY),o=i?i[e]:null,l=o&&(null===o[n.RS_VSTORE_IS_STRETCH_EMPTY]||o[n.RS_VSTORE_IS_STRETCH_EMPTY])&&o[n.MAX_CAPACITY]>=t&&!o[n.RS_VSTORE_IS_PROTECTED]&&!o[n.RS_VSTORE_METRO_PD];return r&&l&&a&&a<=s.RS_BAD_LATENCY_THRESHOLD},getCompatibilityByVStore:function(e,t){return this.isCompatibleByVStore(e,t)?s.RS_COMPATIBILITIES.COMPATIBLE:s.RS_COMPATIBILITIES.NON_COMPATIBLE},getValue:function(t){var i=void 0;switch(t){case n.NUM_VMS:i=this.getVMCount();break;case n.RS_CAPABILITY_NAMES:i=this.getCapabilityNames();break;case n.RS_IP_ADDRESS:i=this._getIPAddress();break;default:i=e.prototype.getValue.apply(this,arguments)}return i},_getIPAddress:function(){var e=this.get(n.RS_REMOTE_ADDRESS)||{};return _.map(e,function(e,t){return t+(e?": "+e:"")}).join(", ")}})}),define("models/dataprotection/RemoteSiteCollection",["models/PollingCollection","models/dataprotection/RemoteSiteModel","data/DataURLConstants"],function(e,t,i){"use strict";return e.extend({model:t,url:i.REMOTE_SITE,name:"RemoteSiteCollection",getCompatibleRemoteSites:function(e,t){return this.models.filter(function(i){return i.isCompatibleByVStore(e,t)})},getNonCompatibleRemoteSites:function(e,t){return this.models.filter(function(i){return!i.isCompatibleByVStore(e,t)})}})}),define("views/basecomponents/pages/PageActionView",["views/basecomponents/BaseView","views/basecomponents/pages/PageActionTemplates","managers/ActionManager","managers/AccessManager","managers/ClusterManager","managers/LicenseManager","managers/DashboardManager","managers/I18nManager","managers/NotificationManager","managers/TaskManager","models/dataprotection/RemoteSiteCollection","data/DataProperties","utils/AppConstants","utils/HypervisorUtil","utils/AppUtil","utils/ManagerMixin","events/AppEvents"],function(e,t,i,n,s,a,r,o,l,c,u,d,h,p,T,E,S){"use strict";return e.extend({currentPageId:null,name:"PageActionView",resetDashboard:_.template(t.RESET_DASHBOARD),resetAllDashboards:_.template(t.RESET_ALL_DASHBOARDS,{actionAttributes:T.createActionAttr(h.ENTITY_DASHBOARD,h.ACTION_RESET_ALL)}),addWidget:_.template(t.ADD_WIDGET),createContainer:_.template(t.CREATE_CONTAINER,{actionAttributes:T.createActionAttr(h.ENTITY_CONTAINER,h.ACTION_CREATE),linkText:o.t("PageActionView","storage_container")}),createVolumeGroup:_.template(t.CREATE_VOLUME_GROUP,{actionAttributes:T.createActionAttr(h.ENTITY_ACROPOLIS_VOLUME_GROUP,h.ACTION_CREATE),linkText:o.t("PageActionView","volume_group","Volume Group")}),addHost:_.template(t.ADD_HOST,{actionAttributes:T.createActionAttr(h.ENTITY_HOST,h.ACTION_ADD),linkText:o.t("PageActionView","expand_cluster","Expand cluster")}),repairNode:_.template(t.REPAIR_NODE,{actionAttributes:T.createActionAttr(h.ENTITY_HOST,h.ACTION_REPAIR)}),addProtectionDomain:_.template(t.CREATE_PD_WIZARD,{actionAttributes:T.createActionAttr(h.ENTITY_PROTECTION_DOMAIN,h.ACTION_CREATE),linkText:o.t("PageActionView","protection_domain","Protection Domain")}),addProtectionDomains:s.isMulticlusterNavMode()?null:_.template(t.CREATE_PDS_WIZARD,{asyncActionAttributes:T.createActionAttr(h.ENTITY_ASYNC_PD,h.ACTION_CREATE),asyncActionLabel:h.ENTITY_NAMES[h.ENTITY_ASYNC_PD],metroAvailActionAttributes:T.createActionAttr(h.ENTITY_METRO_AVAILABILITY_PD,h.ACTION_CREATE),metroAvailActionLabel:h.ENTITY_NAMES[h.ENTITY_METRO_AVAILABILITY_PD],metroAvailability:!p.hasKVMOnly()&&!s.isOneNodeCluster(),linkText:o.t("PageActionView","protection_domain","Protection Domain")}),createRemoteSite:_.template(t.CREATE_REMOTE_SITE,{actionAttributes:T.createActionAttr(h.ENTITY_REMOTE_SITE,h.ACTION_CREATE),linkText:o.t("PageActionView","remote_site","Remote Site")}),createRemoteSiteWizard:_.template(t.CREATE_REMOTE_SITE_WIZARD,{nosClusterActionAttributes:T.createActionAttr(h.ENTITY_REMOTE_SITE,h.ACTION_CREATE),amazonActionAttributes:T.createActionAttr(h.ENTITY_CLOUD_AWS,h.ACTION_CREATE),linkText:o.t("PageActionView","remote_site","Remote Site")}),invokeAlertPolicies:_.template(t.ALERT_POLICIES,{actionAttributes:T.createActionAttr(h.ENTITY_ALERT_POLICY,h.ACTION_SUMMARY)}),invokeAlertEmailContacts:_.template(t.ALERT_EMAIL_CONTACTS,{actionAttributes:T.createActionAttr(h.ENTITY_ALERT_CONFIGURATION,h.ACTION_SHOW)}),insightsClusterSelector:'<div class="n-spotlight"></div>',createVm:_.template(t.CREATE_VM,{actionAttributes:T.createActionAttr(h.ENTITY_VM,h.ACTION_CREATE),linkText:o.t("PageActionView","create_vm","Create VM")}),uplinkConfiguration:_.template(t.UPLINK_CONFIG,{actionAttributes:T.createActionAttr(h.ENTITY_CLUSTER,h.ACTION_UPLINK_CONFIG),linkText:o.t("PageActionView","uplink_config","Uplink Configuration")}),manageNetworks:_.template(t.MANAGE_NETWORKS,{actionAttributes:T.convertObjToHTMLAttr(_defineProperty({},h.NAV_ACTION_CONTEXT_ID,h.DOCS_HELP_SOFTWARE_TYPE_AFS))+T.createActionAttr(h.ENTITY_ACROPOLIS_NETWORK,h.ACTION_CREATE),linkText:o.t("PageActionView","network_config","Network Config")}),addFileServer:_.template(t.ADD_FILE_SERVER,{actionAttributes:T.convertObjToHTMLAttr(_defineProperty({},h.NAV_ACTION_CONTEXT_ID,h.DOCS_HELP_SOFTWARE_TYPE_AFS))+T.createActionAttr(h.ENTITY_FILE_SERVER,h.ACTION_CREATE)}),addShareExport:_.template(t.ADD_SHARE_EXPORT,{actionAttributes:T.convertObjToHTMLAttr(_defineProperty({},h.NAV_ACTION_CONTEXT_ID,h.DOCS_HELP_SOFTWARE_TYPE_AFS))+T.createActionAttr(h.ENTITY_SHARE,h.ACTION_CREATE),linkText:o.t("PageActionView","share_export","Share/Export")}),deployFileInsights:_.template(t.DEPLOY_FILE_INSIGHTS,{actionAttributes:T.convertObjToHTMLAttr(_defineProperty({},h.NAV_ACTION_CONTEXT_ID,h.DOCS_HELP_SOFTWARE_TYPE_FA))+T.createActionAttr(h.ENTITY_FILE_SERVER,h.DEPLOY_FILE_INSIGHTS),linkText:o.t("PageActionView","deploy_file_insights")}),events:{"click      .btnPageAction:not(.gray-out)":"onClickBtnPageAction","mouseenter .btnRepairNode":"onHoverRepairNodeBtn","mouseleave .btnRepairNode":"onMouseOutRepairNodeBtn","click      .btnWizard":"onClickBtnWizard"},viewFilters:[{targets:{selectors:['a[data-test="dr_remote_site_physical_cluster"]','a[data-test="create_remote_site_btn"]']},conditions:{logic:h.VIEW_FILTER.LOGICS.EVERY,groups:[{type:"isStarterLicense",data:[!0],operator:h.FILTER_OPERATORS.EQUALS},{type:"isXpressClass",data:[!0],operator:h.FILTER_OPERATORS.EQUALS},{type:"multipleRemoteSiteAllowed",data:[!1],operator:h.FILTER_OPERATORS.EQUALS},{type:"remoteSiteExists",data:[!0],operator:h.FILTER_OPERATORS.EQUALS,reasonCode:"dr.remoteSite",reason:"Your current license doesn't allow adding multiple remote sites."}]}},{targets:{selectors:['.btnPageAction[actiontarget="container"]',".btnPageAction.btnExpandCluster",".btnPageAction.btnRepairNode",'.btnPageAction[actionTarget="file_server"]','.btnPageAction[actionTarget="acropolis_volume_group"]','.btnPageAction[actionTarget="storage_pool"]','.btnPageAction[actionTarget="vm"]']},conditions:{logic:h.VIEW_FILTER.LOGICS.EVERY,groups:[{type:"clusterConversionInProgress",data:[!0],operator:h.FILTER_OPERATORS.EQUALS,reasonCode:"common.clusterConvertProgress"}]}}],initialize:function(t){e.prototype.initialize.apply(this,arguments),_.bindAll(this,"renderViewFilter"),S.onAppEvent(S.NODE_CONVERSION_IN_PROGRESS,this.renderViewFilter)},updateSelectedItem:function(e,t){if(e!==h.PAGE_DASHBOARD&&e!==h.PAGE_MC_DASHBOARD&&this.currentPageId===e)return void this.fetchAndRenderViewFilters(e);this.currentPageId=e,this.undelegateEvents(),this.$el.empty(),this.checkAccessAndAppendItems(e,t),this.fetchAndRenderViewFilters(e),this.delegateEvents()},checkAccessAndAppendItems:function(e,t){var i=s.getCurrentClusterModel(),o=c.getGlobalTasks().hasActiveClusterConvertTask();switch(e){case h.PAGE_MC_DASHBOARD:case h.PAGE_DASHBOARD:n.isFFEnabled(h.FFLAGS.CUSTOM_DASHBOARDS)&&this.canModifyByEntityType(h.ENTITY_DASHBOARD)&&(a.isPrismProFeaturesEnabled()?(t===h.SUBPAGE_PERSPECTIVE&&this.$el.append(this.resetDashboard({actionAttributes:T.createActionAttr(h.ENTITY_DASHBOARD,h.ACTION_RESET),linkText:this.i18n("reset_dashboard")})),this.$el.append(this.addWidget({actionAttributes:T.createActionAttr(h.ENTITY_DASHBOARD_VP_ADD,h.ACTION_ADD_WIDGET),linkText:this.i18n("add_widgets")}))):r.getAllDashboards().length&&this.$el.append(this.resetAllDashboards));break;case h.PAGE_STORAGE:this.canModifyByEntityType(h.ENTITY_CONTAINER)&&this.$el.append(this.createContainer),a.canUseFeat("abs_internal")&&this.canModifyByEntityType(h.ENTITY_ACROPOLIS_VOLUME_GROUP)&&this.$el.append(this.createVolumeGroup);break;case h.PAGE_HARDWARE:!this.canModifyByEntityType(h.ENTITY_HOST)||p.hasXen()||E.getClusterManager().isOneNodeCluster()?this.$el.append(this.repairNode):(this.$el.append(this.addHost),this.$el.append(this.repairNode));i.isRepairBootDiskSupported()||this.$(".btnRepairNode").addClass(h.VIEW_FILTER.STYLE_CLASS.GRAY_OUT);i.isExpandClusterSupported()||(this.$(".btnExpandCluster").addClass(h.VIEW_FILTER.STYLE_CLASS.GRAY_OUT),this.$(".btnExpandCluster").tooltip({placement:"bottom",title:i.getExpandClusterSupportMessage()}));break;case h.PAGE_DR:if(o)return;(this.canModifyByEntityType(h.ENTITY_ASYNC_PD)||this.canModifyByEntityType(h.ENTITY_PROTECTION_DOMAIN))&&this.canModifyByEntityType(h.ENTITY_METRO_AVAILABILITY_PD)?this.$el.append(this.addProtectionDomains):this.canModifyByEntityType(h.ENTITY_PROTECTION_DOMAIN)&&this.$el.append(this.addProtectionDomain),this.canModifyByEntityType(h.ENTITY_REMOTE_SITE)&&this.canModifyByEntityType(h.ENTITY_CLOUD_AWS)?this.$el.append(this.createRemoteSiteWizard):this.canModifyByEntityType(h.ENTITY_REMOTE_SITE)&&this.$el.append(this.createRemoteSite);break;case h.PAGE_ALERTS:this.$el.append(this.invokeAlertPolicies),this.$el.append(this.invokeAlertEmailContacts);break;case h.PAGE_VMS:if(!o){var l=!1;this.canModifyByEntityType(h.ENTITY_VM)&&(l=!0),l&&p.hasHyperV()&&!this.isFFEnabled(h.FFLAGS.AMF_HYPERV)&&(l=!1),l&&this.$el.append(this.createVm)}p.isAcropolisEnabled()&&this.isFFEnabled(h.FFLAGS.UI_ACROPOLIS)&&this.canModifyByEntityType(h.ENTITY_VM)&&this.$el.append(this.manageNetworks);break;case h.PAGE_NETWORK:p.isAcropolisEnabled()&&s.isClusterFFEnabled(h.FFLAGS.UPLINK_MANAGEMENT,!0)&&n.isClusterAdmin()&&this.$el.append(this.uplinkConfiguration);break;case h.PAGE_FILE_SERVER:this.$el.append(this.addFileServer),this.$el.append(this.addShareExport),this.$el.append(this.deployFileInsights),p.hasKVMOnly()&&this.$el.append(this.manageNetworks)}},fetchAndRenderViewFilters:function(e){e===h.PAGE_DR&&this.canModifyByEntityType(h.ENTITY_REMOTE_SITE)?(this.remoteSiteCollection||(this.remoteSiteCollection=new u),this.remoteSiteCollection.fetch({success:this.renderViewFilter,error:function(){var e="Unable to retrieve remote site";l.showClientNotification(h.NOTIFY_ERROR,e),T.logDebug("PageActionView : Error : "+e)}})):this.renderViewFilter()},getViewFeatures:function(){var e=a.getLicenseModel();return{isStarterLicense:!!e&&e.get(d.LICENSE_TYPE)===h.LICENSE_TYPES.STARTER,isXpressClass:!!e&&e.getLicenseClass()===h.LICENSE_CLASSES.XPRESS,multipleRemoteSiteAllowed:!!e&&!a.violatedFeatureLicense(a.FEATURE_MAP.LICENSE_DR_MULTIPLE_REMOTE_SITES),remoteSiteExists:this.remoteSiteCollection&&1===this.remoteSiteCollection.length,clusterConversionInProgress:!!c.getGlobalTasks().hasActiveClusterConvertTask()}},onClickBtnPageAction:function(e){var t=$(e.currentTarget),n=t.attr(h.NAV_ACTION_TARGET),s=t.attr(h.NAV_ACTION);n===h.ENTITY_DASHBOARD&&s===h.ACTION_RESET?S.triggerAppEvent(S.RESET_TO_DEFAULT):n===h.ENTITY_DASHBOARD&&s===h.ACTION_RESET_ALL?S.triggerAppEvent(S.RESET_ALL_TO_DEFAULT):i.executeActionElement(e.currentTarget)},onClickBtnWizard:function(e){i.executeActionElement(e.currentTarget)},onHoverRepairNodeBtn:function(e){var t=$(e.currentTarget);if(t.hasClass("gray-out")){var i=E.getClusterManager().getCurrentClusterModel(),n=i.getRepairBootDiskRequirements();this.$(".btnRepairNode").tooltip({placement:"bottom",title:i.getRepairBootDiskSupportMessage(n),trigger:"manual"}),t.tooltip("show")}},onMouseOutRepairNodeBtn:function(e){$(e.currentTarget).hasClass("gray-out")&&$(e.currentTarget).tooltip("destroy")}})}),define("text!templates/basecomponents/subnavigation/SubPageNavigationView.html",[],function(){return'<span class="nav-links">\n  <% if (typeof perspective !== \'undefined\') { %>\n    <li  navsubpage="<%= perspective %>" style="display:none">\n      <%= i18n(\'overview\') %>\n    </li>\n    <li class="sep" style="display:none">&middot;</li>\n  <% } %>\n\n  <% if (typeof diagram !== \'undefined\') { %>\n    <li navsubpage="<%= diagram %>" style="display:none">\n      <%= i18n(\'diagram\') %>\n    </li>\n    <li class="sep" style="display:none">&middot;</li>\n  <% } %>\n\n  <% if (typeof table !== \'undefined\') { %>\n    <li navsubpage="<%= table %>" style="display:none">\n      <%= i18n(\'table\') %>\n    </li>\n    <li class="sep" style="display:none">&middot;</li>\n  <% } %>\n\n  <% if (typeof scenario !== \'undefined\') { %>\n    <li navsubpage="<%= scenario %>" style="display:none">\n      <%= i18n(\'scenarios\') %>\n    </li>\n    <li class="sep" style="display:none">&middot;</li>\n  <% } %>\n\n  <% if (typeof runway !== \'undefined\') { %>\n    <li navsubpage="<%= runway %>" style="display:none">\n      <%= i18n(\'capacity\') %>\n    </li>\n    <li class="sep" style="display:none">&middot;</li>\n  <% } %>\n\n  <% if (typeof timeline !== \'undefined\') { %>\n    <li navsubpage="<%= timeline %>" style="display:none">\n      <%= i18n(\'timeline\') %>\n    </li>\n    <li class="sep" style="display:none">&middot;</li>\n  <% } %>\n\n  <% if (typeof vlanviz !== \'undefined\') { %>\n    <li navsubpage="<%= vlanviz %>" style="display:none">\n      <%= i18n(\'vlans\') %>\n    </li>\n    <li class="sep" style="display:none">&middot;</li>\n  <% } %>\n\n  <% if (typeof hostviz !== \'undefined\') { %>\n    <li navsubpage="<%= hostviz %>" style="display:none">\n      <%= i18n(\'hostConfiguration\') %>\n    </li>\n    <li class="sep" style="display:none">&middot;</li>\n  <% } %>\n</span>\n<span class="manage-dashboards" style="display: none">\n</span>\n'}),define("views/widgets/DynamicButtonsGroupWidgetView",["views/basecomponents/BaseView","utils/AntiscrollUtil","events/AppEvents"],function(e,t,i){"use strict";var n=_.template('<div class="btn-group btnBar"></div>'),s=_.template('<button type="button" class="btn action-btn <%= btnClass %>" data-btn-id="<%= id %>" name-id="<%= label %>" action-id="<%= actionId %>" data-test="dynamicbuttonsgroupwidgetview_btn_action_<%= actionId %>"><%= icon %><span class="button-label"><%= label %></span></button>'),a=_.template('<div class="btn-group"><button type="button" class="btn -default dropdown-toggle action-btn" data-toggle="dropdown" data-test="dynamicbuttonsgroupwidgetview_btn_action_more"><span class="button-label"><%= label %></span><%= SVG.SVGIcon("z", "-down-arrow-large") %></button><div class="overflow-dropdown-menu dropdown-menu"><div class="antiscroll-wrap"><div class="box-wrap"><div class="antiscroll-inner"><div class="box-inner"><div class="overflow-menu -right" role="menu"></div></div></div></div></div></div></div>');return e.extend({name:"DynamicButtonsGroupWidgetView",maxButtons:null,minButtons:null,maxWidth:null,buttonsMap:null,idCounter:null,events:{"click .action-btn:not(.dropdown-toggle,.gray-out)":"onClick"},initialize:function(t){if(e.prototype.initialize.apply(this,arguments),this.maxButtons=t.maxButtons||5,this.minButtons=t.minButtons||3,this.maxWidth=this.$el.width(),this.maxWidth<=0)throw new Error("DynamicButtonsGroupWidgetView: $el.width() is 0");this.buttonsMap={},this.idCounter=1,this.render(this.maxButtons)},render:function(e,i){for(var r=this,o=$(n()),l=0,c=this.getSingleButtons(),u=this.getDropdowns(),d=0;d<c.length;d++){l++;var h=c[d];if(!(l<=e)){var p=c.slice(d);p.length&&u.push({label:this.i18n("moreActions"),groups:p});break}var T=$(s(h));T.addClass(i),o.append(T)}return _.each(u,function(e){var t=$(a(r.vtOptions(e))),i=t.find(".overflow-menu");_.each(e.groups,function(e){return i.append($(s(e)))}),o.append(t)}),$(".action-bar .btn").tooltip("destroy"),this.$el.html(o),t.applyAntiScroll(this.$(".overflow-dropdown-menu .antiscroll-wrap")),i?this:(this.isTooBig()&&this.render(e-1),this)},isTooBig:function(){return this.$(".btnBar").width()>this.maxWidth},addButton:function(e){var t=_.extend(e,{label:e.label||"",labelClass:e.labelClass||"",icon:e.icon||"",iconClass:e.iconClass||"",btnClass:(e.btnClass||"")+[e.disable?"-disable":""].join(" "),options:e});t.id=this.idCounter++,this.buttonsMap[t.id]=t},clearButtonsMap:function(){this.buttonsMap={}},getButtons:function(){return _.sortBy(_.values(this.buttonsMap),"id")},getSingleButtons:function(){return _.filter(this.getButtons(),function(e){return!e.groupId})},getDropdowns:function(){var e=this,t=[];return _.each(this.getButtons(),function(i){if(i.groupId){var n=_.find(t,function(e){return e.actionId===i.groupId});n?n.groups.push(i):t.push({actionId:i.groupId,btnClass:i.btnClass||"",groups:[i],label:e.i18n("action_btn."+i.groupId)})}}),t},getButtonOptionsByElement:function(e){if(this.buttonsMap&&this.buttonsMap[$(e).data("btn-id")])return this.buttonsMap[$(e).data("btn-id")].options},onClick:function(e){this.trigger(i.DYNAMIC_BUTTON_GROUP_CLICK,this.getButtonOptionsByElement(e.currentTarget))},onResize:function(){this.maxWidth=this.$el.width(),this.render(this.maxButtons)}})}),define("views/basecomponents/subnavigation/DashboardLinksMenuView",["views/widgets/DynamicButtonsGroupWidgetView","utils/AppUtil","utils/SVG","data/DataProperties","utils/AppConstants"],function(e,t,i,n,s){"use strict";var a=_.template('<li navsubpage="<%= id %>" title="<%-title%>" data-id="<%= id %>"stream-action="Dashboards: ShowDashboard"stream-target="<%- title %>"><%-title%> </li>'),r=_.template('<li navsubpage="<%= id %>" title="<%-title%>" data-id="<%= id %>"stream-action="Dashboards: ShowDashboard"stream-target="<%- title %>"><a role="menuitem" tabindex="-1"><%-title%> </a></li>'),o=_.template('<li class="sep" data-id="<%= id %>"></li> '),l=_.template('<div class="dashboardMenuDropDown dropdown dropdown-menu-right"><a data-toggle="dropdown" class="btn dropdown-toggle"><%= title %> '+i.SVGIcon("z","-down-arrow-large animate")+'</a><ul class="dropdown-menu"></ul></div>');return e.extend({MENU_EXPANDED:"EXPANDED",MENU_COLLAPSED:"COLLAPSED",name:"DashboardLinksMenuView",dashboards:null,currentSubPageId:null,subPageMenuState:null,initialize:function(e){this.dashboards=e.dashboards||[],this.maxWidth=this.$el.width(),this.currentSubPageId=e.currentSubPageId},render:function(){this._renderDashboardsSequential(),this.subPageMenuState=this.MENU_EXPANDED;this.el;this._isElementOverflowing()&&(this._renderDashboadsDropdown(),this.subPageMenuState=this.MENU_COLLAPSED)},onResize:_.debounce(function(){this.maxWidth=this.$el.width(),this.subPageMenuResizeCheck()},200),subPageMenuResizeCheck:function(){this.subPageMenuState===this.MENU_COLLAPSED&&this._renderDashboardsSequential();var e=this.el;if(this._isElementOverflowing()){this._renderDashboadsDropdown(),$(e).find(".dropdown").addClass("disable-animation");var i=$(e).find(".dropdown-toggle > .svg-icon");this.subPageMenuState===this.MENU_COLLAPSED?t.removeSVGClass(i,"animate"):t.onAnimationEnd(i,function(){t.removeSVGClass(i,"animate")}),this.subPageMenuState=this.MENU_COLLAPSED}else this.subPageMenuState===this.MENU_COLLAPSED&&$(e).find("li.active").addClass("disable-animation"),this.subPageMenuState=this.MENU_EXPANDED},_renderDashboardsSequential:function(){var e=this;this.$el.addClass("sequential");var t=0;this.$el.siblings().each(function(){var e=$(this).width();t+=e}),this.$el.css("padding-right",t);var i=s.SUBPAGE_MAIN_DASHBOARD,r=a({title:this.i18n(i,"Main Dashboard"),id:s.SUBPAGE_PERSPECTIVE});this.$(".nav-links").html(r),_.each(this.dashboards,function(t){var i=o({id:t.get(n.ID)});i+=a({title:t.get(t.DP.TITLE),id:t.get(n.ID)}),e.$(".nav-links").append(i)}),this.$('li[navsubpage="'+e.currentSubPageId+'"]').addClass("active")},_renderDashboadsDropdown:function(){this.$el.removeClass("sequential");var e=this.$('li[navsubpage="'+this.currentSubPageId+'"]').text(),t=$(l({SVG:i,title:e})),n=r({title:s.SUBPAGE_MAIN_DASHBOARD,id:s.SUBPAGE_PERSPECTIVE});t.find(".dropdown-menu").append(n),_.each(this.dashboards,function(e){var i=r({title:e.get("title"),id:e.get("id")});t.find(".dropdown-menu").append(i)}),this.$(".nav-links").html(t),this.$('.dropdown-menu > li[navsubpage="'+this.currentSubPageId+'"]').addClass("selected")},_isElementOverflowing:function(){var e=this.el,i=0;return t.isIEBrowser()&&(i=4),!!(e.offsetWidth<e.scrollWidth||e.offsetHeight+i<e.scrollHeight)}})}),define("views/basecomponents/subnavigation/SubPageNavigationView",["views/basecomponents/BaseView","views/basecomponents/pages/PageTemplateRenderer","text!templates/basecomponents/subnavigation/SubPageNavigationView.html","views/basecomponents/pages/PageActionTemplates","views/basecomponents/subnavigation/DashboardLinksMenuView","managers/NavigationManager","managers/ClusterManager","managers/DashboardManager","managers/ActionManager","managers/AccessManager","managers/I18nManager","utils/AppConstants","utils/AppUtil","utils/SVG","events/AppEvents"],function(e,t,i,n,s,a,r,o,l,c,u,d,h,p,T){"use strict";var E=_.template(i),S=_.template(n.MANAGE_DASHBOARDS,{actionAttributes:h.createActionAttr(d.ENTITY_DASHBOARD,d.ACTION_CREATE),SVG:p,I18nManager:u});return e.extend({name:"SubPageNavigationView",currentPageUuid:null,currentPageId:null,currentSubPageId:null,currentSubPageMap:{},dashboardLinks:null,events:{"click  .n-subpage-btn-group li":"onClickBtnSubpage","click  .btnPageAction":"onClickBtnPageAction"},initialize:function(){this.render(),o.registerDashboardListener(o.EVENTS.FETCH_DASHBOARDS,this.displayCustomDashboards,this)},render:function(){var e=t.getSubpageMapping();this.$el.html(E(this.vtOptions(e)))},destroy:function(){o.unregisterDashboardListener(o.EVENTS.FETCH_DASHBOARDS,this.displayCustomDashboards,this),e.prototype.destroy.apply(this,arguments)},updateSelectedItem:function(e,i){this.$(".manage-dashboard").hide();var n=t.getSubpageMapping(e);return this.currentPageUuid=e,i=i||this.currentSubPageMap[e]||_.values(n)[0],!!(this._isCustomDashboardPage()||this._isPrismElementPage()||_.contains(_.values(n),i))&&(this.currentSubPageId=i,this.$(".nav-links li").removeClass("active").hide(),this.$("li[navsubpage='"+i+"']").addClass("active"),delete n.detail,this.currentPageId=r.getPageIdFromPageUuid(this.currentPageUuid),_.values(n).length>1?(_.each(_.values(n),function(e){this.$("li[navsubpage='"+e+"']").show(),this.$("li[navsubpage='"+e+"'] + li").show()},this),this.$("li:visible").last().hide()):this.currentPageId!==d.PAGE_ALERTS&&this.currentPageId!==d.PAGE_FILE_SERVER&&this.currentPageId!==d.PAGE_NETWORK&&this.$el.closest(".n-page-nav").hide(),this.displayCustomDashboards(),this.currentSubPageMap[e]=i,a.updateGlobalPageRoute(this.currentPageId,i,null),!0)},displayCustomDashboards:function(){if(this._isCustomDashboardPage()){this.$el.closest(".n-page-nav").show();var e=o.getDashboards();this.appendDashboardLinks(e),c.isFFEnabled(d.FFLAGS.CUSTOM_DASHBOARDS)&&this.canModifyByEntityType(d.ENTITY_DASHBOARD)&&(this.$(".manage-dashboards").html(S),this.$(".manage-dashboards").show())}},appendDashboardLinks:function(e){this.dashboardLinks=new s({el:this.$el,dashboards:e,currentSubPageId:this.currentSubPageId}),this.dashboardLinks.render()},onClickBtnSubpage:function(e){var t=$(e.currentTarget).attr("navsubpage"),i=$(e.currentTarget).attr("navsubpageOption");h.setLocalStorageProperty(""+d.SUBNAV_LAST_ACCESSED_PREFIX+this.currentPageId,t),
a.navigateToPage(r.getPageIdFromPageUuid(this.currentPageUuid),t,i)},onClickBtnPageAction:function(e){var t=$(e.currentTarget),i=t.attr(d.NAV_ACTION_TARGET),n=t.attr(d.NAV_ACTION);i===d.ENTITY_DASHBOARD_VP_ADD&&n===d.ACTION_RESET?T.triggerAppEvent(T.RESET_TO_DEFAULT):l.executeActionElement(e.currentTarget)},onResize:function(){this.dashboardLinks&&this.dashboardLinks.onResize()},_isCustomDashboardPage:function(){return(this.currentPageId===d.PAGE_MC_DASHBOARD||this.currentPageId===d.PAGE_DASHBOARD)&&c.isFFEnabled(d.FFLAGS.CUSTOM_DASHBOARDS)},_isPrismElementPage:function(){return this.currentPageId===d.PAGE_MC_PE_IFRAME}})}),define("text!templates/basecomponents/subnavigation/SubNavigationView.html",[],function(){return'  \x3c!-- Subpage Navigation --\x3e\n  <ul class="n-subpage-btn-group nav pull-left">\n    \x3c!-- @view: Subpage navigation goes here... --\x3e\n  </ul>\n\n  \x3c!-- Page Action --\x3e\n  <div class="n-page-action-group  pull-right">\n    \x3c!-- @view: Page action goes here... --\x3e\n  </div>'}),define("views/basecomponents/subnavigation/SubNavigationView",["views/basecomponents/BaseView","views/basecomponents/pages/PageActionView","views/basecomponents/subnavigation/SubPageNavigationView","text!templates/basecomponents/subnavigation/SubNavigationView.html","managers/ClusterManager","utils/AppConstants"],function(e,t,i,n,s,a){"use strict";return e.extend({subPageNavigationView:null,pageActionView:null,pageId:null,subPageId:null,defaultSubPageId:null,initialize:function(e){if(!e||!e.pageUuid)throw new Error("SubNavigationView requires pageUuid option");this.pageUuid=e.pageUuid,this.subPageId=e.subPageId,this.defaultSubPageId=e.defaultSubPageId,this.render()},render:function(){if(this.defaultSubPageId===a.SUBPAGE_BLANK)return void this.$el.hide();this.$el.html(n),this.subPageNavigationView=new i({el:this.$(".n-subpage-btn-group")}),this.pageActionView=new t({el:this.$(".n-page-action-group")}),this.updateSelectedPage(this.pageUuid,this.subPageId)},updateSelectedPage:function(e,t,i){return this.defaultSubPageId===a.SUBPAGE_BLANK||(this.pageActionView.updateSelectedItem(s.getPageIdFromPageUuid(e),t),this.subPageNavigationView.updateSelectedItem(e,t))},onResize:function(){this.subPageNavigationView.onResize()}})}),define("views/basecomponents/pages/BasePageView",["views/basecomponents/BaseView","views/basecomponents/pages/PageTemplateRenderer","views/basecomponents/subnavigation/SubNavigationView","managers/ClusterManager","managers/TutorialManager","managers/NavigationManager","utils/AppConstants","utils/AppUtil","utils/SubViewHelper","data/DataProperties"],function(e,t,i,n,s,a,r,o,l,c){"use strict";return e.extend({pageUuid:null,pageId:null,defaultSubPageId:null,currentSubPageId:null,currentOptions:null,currentSubPageView:null,subViewHelper:null,subNavigationView:null,lastAccessTime:null,eventBus:null,tmplSubPage:_.template('<div class="n-subpage  n-subpage-<%= key %>" subpage="<%= key %>"></div>'),usePageTemplateRenderer:!0,initialize:function(e){if(!e||!e[c.PAGEUUID])throw new Error("BasePageView: Unable to instantiate page without a pageUuid.");this.setPageUuid(e[c.PAGEUUID]),this.eventBus=_.extend({},Backbone.Events),this.$el.addClass("n-page page-"+this.pageId)},hasCustomLoader:function(){return!1},render:function(){return this.$el.attr("id",this.pageUuid),this.usePageTemplateRenderer?this.template=t.getPageTemplate(this.pageUuid):this.template="",this.$el.html(this.template),this.subViewHelper=new l,this.createSubNavigationView(),this.$el},createSubNavigationView:function(){this.subNavigationView=new i({el:this.$(".n-page-nav"),pageUuid:this.pageUuid,subPageId:this.currentSubPageId,defaultSubPageId:this.defaultSubPageId})},show:function(e){this.$el.show(),this.showSubPage(e)},hide:function(){this.stopServices(),this.$el.hide(),this.onHideSubPage()},updateBodyStyle:function(e){var t=$("body")[0].className.replace(/\bnav_.*?\b/g,"");$("body").attr("class",t).addClass("nav_"+this.pageId).addClass("nav_"+e)},onResize:function(){var e=this.getCurrentSubpageId();this.subViewHelper&&this.subViewHelper.get(e)&&_.isFunction(this.subViewHelper.get(e).onResize)&&this.subViewHelper.get(e).onResize()},getCurrentSubpageId:function(){return this.currentSubPageId},showSubPage:function(e){var t=e.subPageId,i=e.options,n=""+r.SUBNAV_LAST_ACCESSED_PREFIX+e.pageId;!t&&o.isLocalStorageProperty(n)&&(t=o.getLocalStorageProperty(n)),t=t||this.defaultSubPageId;var s=this.subNavigationView.updateSelectedPage(this.pageUuid,t,i),a=this.$(".n-page-master");if(this.currentSubPageId!==t&&this.currentSubPageView&&$(a).find("[subpage='"+this.currentSubPageId+"']").hide(),$(a).find("[subpage='"+t+"']").show(),this.currentSubPageView=$(a).find("[subpage='"+t+"']"),!s)return void this.handleSubPageNotFound();switch(this.updateBodyStyle(t),this.currentSubPageId=t,t){case r.SUBPAGE_DIAGRAM:case r.SUBPAGE_TABLE:this.getDetailsElement().show(),this.currentOptions!==i&&(this.onChangeDetailsPane(i),this.currentOptions=i);break;default:this.getDetailsElement().hide()}this.onShowSubPage(t,i),this.startServices(),o.debug("BasePageView : pageUuid: "+this.pageUuid+"\t subPageId: "+this.currentSubPageId+"\t options: "+i)},handleSubPageNotFound:function(){a.navigateToPage(this.pageId,this.defaultSubPageId,null)},getSubPageElement:function(e){return e=e||this.currentSubPageId,this.$(".n-page-master").find("[subpage='"+e+"']")},addSubPageElement:function(e){e=e||this.currentSubPageId;var t=this.$(".n-page-master");return t.append(this.tmplSubPage({key:e})),t.find("[subpage='"+e+"']").show(),t.find("[subpage='"+e+"']")},destroy:function(){o.debug("BasePageView : destroy | pageUuid : "+this.pageUuid),this.subViewHelper&&(this.subViewHelper.removeAll(),this.subViewHelper=null),this.$el.remove(),e.prototype.destroy.apply(this,arguments)},setPageUuid:function(e){this.pageUuid=e},setPageViewOptions:function(e){},setLastAccessTime:function(e){o.debug("BasePageView: Setting last access time for page ",this.pageUuid," to ",e),this.lastAccessTime=e},getLastAccessTime:function(){return this.lastAccessTime},isMulticlusterPageUuid:function(){return n.isMulticlusterPageUuid(this.pageUuid)},getDetailsElement:function(){return this.$(".n-page-detail")},onChangeDetailsPane:function(e){},onShowSubPage:function(e,t){},onHideSubPage:function(){s.isTutorialInProgress()&&s.endTutorial()},startServices:function(){this.startAndStopSubViewServices(),e.prototype.startServices.apply(this,arguments)},startAndStopSubViewServices:function(){if(!_.isEmpty(this.subViewHelper)){_.each(this.subViewHelper.getIds(),function(e){this.subViewHelper.get(e)&&e!==r.SUBPAGE_COMPONENT_DETAILS&&(e===this.currentSubPageId?(o.debug("BasePageView : pageUuid: "+this.pageUuid+" | start services on subViewId: "+e),this.subViewHelper.get(e).startServices()):(o.debug("BasePageView : pageUuid: "+this.pageUuid+" | stop services on subViewId: "+e),this.subViewHelper.get(e).stopServices()))},this);var e=r.SUBPAGE_COMPONENT_DETAILS;this.subViewHelper.get(e)&&(this.currentSubPageId===r.SUBPAGE_DIAGRAM||this.currentSubPageId===r.SUBPAGE_TABLE?(o.debug("BasePageView : pageUuid: "+this.pageUuid+" | start services on subViewId: "+e),this.subViewHelper.get(e).startServices()):(o.debug("BasePageView : pageUuid: "+this.pageUuid+" | stop services on subViewId: "+e),this.subViewHelper.get(e).stopServices()))}},onStartServices:function(){this.delegateSubViewEvents()},onStopServices:function(){this.undelegateSubViewEvents(),_.isEmpty(this.subViewHelper)||_.each(this.subViewHelper.getIds(),function(e){this.subViewHelper.get(e)&&(o.debug("BasePageView : pageUuid: "+this.pageUuid+" | stop services on subViewId: "+e),this.subViewHelper.get(e).stopServices())},this)},undelegateSubViewEvents:function(){this.undelegateEvents();var e=this.getSubView(r.SUBPAGE_COMPONENT_DETAILS);e&&e.undelegateEvents()},delegateSubViewEvents:function(){this.delegateEvents();var e=this.getSubView(r.SUBPAGE_COMPONENT_DETAILS);e&&e.delegateEvents()},refreshView:function(e){_.isEmpty(this.subViewHelper)||(_.each(this.subViewHelper.getIds(),function(t){this.subViewHelper.get(t)&&(o.debug("BasePageView : pageUuid: "+this.pageUuid+" | refreshView on subViewId: "+t),this.subViewHelper.get(t).refreshView(e))},this),this.subNavigationView.updateSelectedPage(this.pageUuid,this.currentSubPageId))}})}),define("views/basecomponents/details/breadcrumb/DetailsBreadCrumbTemplates",[],function(){"use strict";return{SEPARATOR:'<div class="n-separator">                        <i aria-hidden="true" data-icon="y"></i>                     </div>',LABEL_SUMMARY:"Summary",LINK_SUMMARY:'<a class="linkBreadCrumb" action="details" actionTargetId="summary" actionTarget="<%= actionTarget %>">Summary</a>',LABEL_ENTITY:'<%= _.escape(entityName) || "" %>',LINK_ENTITY:'<a class="linkBreadCrumb"                            action="details"                            actionTarget="<%= model.actionTarget %>"                            actionTargetId="<%= model.actionTargetId %>"                            actionTargetName="<%= model.actionTargetName %>" >                           <%= _.escape(model.actionTargetName) %></a>',ICON_CONTAINER:'<i class="glyphicon glyphicon-folder-close"></i>',ICON_STORAGE_POOL:'<i class="glyphicon glyphicon-folder-close"></i>',ICON_HOST:'<i class="glyphicon glyphicon-hdd"></i>',ICON_DISK:'<i class="glyphicon glyphicon-hdd"></i>',ICON_ALERT:'<i class="glyphicon glyphicon-warning-sign"></i>',ICON_EVENT:'<i class="glyphicon glyphicon-warning-sign"></i>',ICON_VM:'<i class="glyphicon glyphicon-stop"></i>',ICON_DEFAULT:'<i class="glyphicon glyphicon-asterisk"></i>'}}),define("views/basecomponents/details/breadcrumb/DetailsBreadCrumbView",["views/basecomponents/BaseView","views/basecomponents/details/breadcrumb/DetailsBreadCrumbTemplates","managers/NavigationManager","managers/ClusterManager","utils/AppConstants"],function(e,t,i,n,s){"use strict";return e.extend({pageId:null,tmplBreadCrumb:_.template(t.LINK_SUMMARY+t.SEPARATOR+t.LABEL_ENTITY),events:{"click  .linkBreadCrumb":"onClickLinkBreadCrumb"},initialize:function(){n.isMulticlusterNavMode()&&(this.tmplBreadCrumb=_.template(t.LABEL_ENTITY))},updateTrail:function(e,t,i){i=i||{},this.setOptionsObject(e);var n="";switch(this.pageId){case s.PAGE_VMS:case s.PAGE_STORAGE:case s.PAGE_HARDWARE:case s.PAGE_DR:case s.PAGE_ALERTS:case s.PAGE_FILE_SERVER:n=this.getGeneralBreadCrumb(t,i)}this.$el.html(n)},getGeneralBreadCrumb:function(e,i){if(this.isSummaryView())return t.LABEL_SUMMARY;var n,a=this.currentEntityType();switch(a){case s.ENTITY_CONTAINER:n=t.ICON_CONTAINER;break;case s.ENTITY_STORAGE_POOL:n=t.ICON_STORAGE_POOL;break;case s.ENTITY_HOST:n=t.ICON_HOST;break;case s.ENTITY_DISK:n=t.ICON_DISK;break;case s.ENTITY_VM:n=t.ICON_VM;break;case s.ENTITY_ALERT:n=t.ICON_ALERT;break;case s.ENTITY_EVENT:n=t.ICON_EVENT;break;case s.ENTITY_FILE_SERVER:n=t.ICON_FILE_SERVER;break;case s.ENTITY_SHARE:n=t.ICON_SHARE;break;default:n=t.ICON_DEFAULT}var r=this.currentEntityName();return i.error===s.ERROR_ENTITY_NOT_FOUND?r=(s.ENTITY_NAMES[e.entityType]||"Entity")+" not found":e&&!_.isEmpty(e.attributes)&&(r=e.toJSON({includeAttribute:!0}).name),r=r||s.ERROR_ENITY_NAME_NOT_FOUND,this.tmplBreadCrumb({entityName:r,entityIcon:n,actionTarget:a})},onClickLinkBreadCrumb:function(e){i.updateRouteOption(e.currentTarget)}})}),define("views/basecomponents/details/detailsaction/DetailsActionTemplates",["managers/I18nManager"],function(e){"use strict";return{DETAILS_ACTION:'<a class="btnDetailsAction"    action="<%= action %>"     actionTarget="<%= model.actionTarget %>"    actionTargetId="<%= model.actionTargetId %>"    actionTargetName="<%= model.actionTargetName %>">   <%= content %> </a>',DISABLED_DETAILS_ACTION:'<a class="btnDetailsAction btnDisabled"    title="<%= tooltip %>"    action="<%= action %>"     actionTarget="<%= model.actionTarget %>"    actionTargetId="<%= model.actionTargetId %>"    actionTargetName="<%= model.actionTargetName %>">   <%= content %> </a>',DETAILS_WIZARD_ACTION:'<a class="btnDetailsAction btnWizardAction"    action="<%= action %>"     actionTarget="<%= model.actionTarget %>"    actionTargetId="<%= model.actionTargetId %>"    actionTargetName="<%= model.actionTargetName %>">   <%= content %> </a>',DETAILS_CUSTOM_ACTION:'<a class="btnDetailsAction btnCustomAction"    action="<%= action %>"     actionTarget="<%= model.actionTarget %>"    actionTargetId="<%= model.actionTargetId %>"    actionTargetName="<%= model.actionTargetName %>">   <%= content %> </a>',DROPDOWN_CUSTOM_ACTION:'<span class="update-action-wrapper"><%= content %></span>',DELETE:'<i aria-hidden="true" data-icon="v" class="n-delete-icon"></i>Delete',UPDATE:'<i aria-hidden="true" data-icon="F" class="n-pencil-icon"></i>Update',MANAGE_NGT:"Manage Guest Tools",LAUNCH_CONSOLE:'<i aria-hidden="true" data-icon="M"></i>Launch Console',TOGGLE_POWER:"\x3c!-- TODO: Place icon here --\x3e<%= actionText %>",CLONE:"\x3c!-- TODO: Place icon here --\x3eClone",TOGGLE_PAUSE:"\x3c!-- TODO: Place icon here --\x3e<%= actionText %>",SNAPSHOT:"\x3c!-- TODO: Place icon here --\x3eTake Snapshot",SAVE:"<%= actionText %>",ACKNOWLEDGE_ALERT:'<i class="glyphicon glyphicon-ok"></i> Acknowledge',RESOLVE_ALERT:'<i class="glyphicon glyphicon-ok"></i> Resolve',SYSTEM_CONTAINER:e.t("DetailsActionTemplates","system_container"),REMOVE_DISK:'<i aria-hidden="true" data-icon="v" class="n-delete-icon"></i>Remove Disk',ENABLE_METADATA_STORE:"\x3c!-- TODO: Place icon here --\x3eEnable Metadata Store",REMOVE_HOST:'<i aria-hidden="true" data-icon="v" class="n-delete-icon"></i>Remove Host',TURN_ON_LED:"\x3c!-- TODO: Place icon here --\x3eTurn On LED",TURN_OFF_LED:"\x3c!-- TODO: Place icon here --\x3eTurn Off LED",MARK_AS_FIXED:"\x3c!-- TODO: Place icon here --\x3eMark as Fixed",PREPARE_ADD:'<i aria-hidden="true" data-icon="H" class="n-prepare-add-icon"></i>Repartition and Add',ADD_BACK:'<i aria-hidden="true" data-icon="H" class="n-add-back-icon"></i>Add Back',REPLACE_DISK:e.t("DetailsActionTemplates","replace_drive"),SSD_BREAKFIX:"Repair Disk",REPAIR_NODE:"Repair Host Boot Device",TEST_CONNECTION:'<div class="test-connection-status">&nbsp;</div><div class="test-connection-text">Test Connection</div>',ACTIVATE:"\x3c!-- TODO: Place icon here --\x3eActivate",INACTIVATE:"\x3c!-- TODO: Place icon here --\x3eInactivate",MIGRATE:"\x3c!-- TODO: Place icon here --\x3eMigrate",REPLICATE:"\x3c!-- TODO: Place icon here --\x3eReplicate",ABORT:"\x3c!-- TODO: Place icon here --\x3eAbort",PAUSE:"\x3c!-- TODO: Place icon here --\x3ePause",RESUME:"\x3c!-- TODO: Place icon here --\x3eResume",DEMOTE:"\x3c!-- TODO: Place icon here --\x3eDemote",PROMOTE:"\x3c!-- TODO: Place icon here --\x3ePromote",DISABLE:"\x3c!-- TODO: Place icon here --\x3eDisable",ENBLE:"\x3c!-- TODO: Place icon here --\x3eEnable",RE_ENABLE:"\x3c!-- TODO: Place icon here --\x3eRe-enable",JOIN_DOMAIN:"\x3c!-- TODO: Place icon here --\x3eJoin Domain",UNJOIN_DOMAIN:"\x3c!-- TODO: Place icon here --\x3eLeave Domain",UPGRADE_FILE_SERVER:"\x3c!-- TODO: Place icon here --\x3eUpgrade",PROTECT_FILE_SERVER:'<i aria-hidden="true" data-icon="H" class="n-prepare-add-icon"></i>Setup Protection Domain',PROTECTION_DOMAIN_CREATED:"Protection Domain Created",ACTIVATE_FILE_SERVER:"Activate",ADD_SHARE_EXPORT:'<i aria-hidden="true" data-icon="H" class="n-prepare-add-icon"></i>'+e.t("DetailsActionTemplates","share_export"),ADD_ADMINS:e.t("FileServerAddAdminsPopupView","manage_roles"),DIRECTORY_SERVICES:"<span>"+e.t("DetailsActionTemplates","directory_services")+"</span>",DNS:e.t("DetailsActionTemplates","dns"),ANTIVIRUS_SETUP:"\x3c!-- TODO: Place icon here --\x3eAntivirus settings",ADD_QUOTA_POLICY:'<i aria-hidden="true" data-icon="H" class="n-prepare-add-icon"></i>Add Quota Policy',MANAGE_INITIATORS:"Manage Initiators",MSG_BEING_REMOVED:'<span class="n-details-message">Being Removed</span>',SCHEDULE_FILE_SERVER_SNAPSHOTS:"Protect",FILE_INSIGHTS_TAG:'<span><%= text %> &nbsp;</span><span class="new-tag <%=isNewAction ? "" : "hidden" %>"  title="<%= newTooltip %>"> <%= tagName %></span>',FILE_ANALYTICS_DETAILS_ACTION:'<a class="btnDetailsAction"    action="<%= action %>"     actionId="<%= actionId %>"     actionTarget="<%= model.actionTarget %>"    actionTargetId="<%= model.actionTargetId %>"    actionTargetName="<%= model.actionTargetName %>"             data-test="detailsactiontemplates_a_file_analytics_detail_action"           >   <%= content %> </a>'}}),define("models/hardware/HardwareConfigurationModel",["models/BaseModel","data/DataURLConstants","utils/AppConstants"],function(e,t,i){"use strict";return e.extend({urlRoot:t.HARDWARE_CONFIGURATION,entityType:i.ENTITY_HARDWARE_CONFIGURATION,name:"HardwareConfigurationModel",defaults:{blockSerial:"",layoutJSON:[]}})}),define("models/hardware/HardwareConfigurationCollection",["models/BaseCollection","models/hardware/HardwareConfigurationModel","data/DataURLConstants"],function(e,t,i){"use strict";return e.extend({model:t,url:i.HARDWARE_CONFIGURATION,name:"HardwareConfigurationCollection"})}),define("views/basecomponents/details/detailsaction/DetailsActionView",["views/basecomponents/BaseView","views/basecomponents/details/detailsaction/DetailsActionTemplates","data/DataProperties","models/hardware/HardwareConfigurationCollection","models/hardware/DiskCollection","managers/ActionManager","managers/ClusterManager","managers/TaskManager","utils/SubModelHelper","utils/AppConstants","utils/AppUtil"],function(e,t,i,n,s,a,r,o,l,c,u){"use strict";return e.extend({DISK_HAS_NO_LED:"DISK_HAS_NO_LED",DISK_REMOVE_ALLOWED:"DISK_REMOVE_ALLOWED",name:"DetailsActionView",pageId:null,tmplDetailsAction:_.template(t.DETAILS_ACTION),tmplDetailsWizardAction:_.template(t.DETAILS_WIZARD_ACTION),tmplDetailsCustomAction:_.template(t.DETAILS_CUSTOM_ACTION),tmplDropdownCustomAction:_.template(t.DROPDOWN_CUSTOM_ACTION),tmplDisabledDetailsAction:_.template(t.DISABLED_DETAILS_ACTION),tmplFileAnalyticsDetailsAction:_.template(t.FILE_ANALYTICS_DETAILS_ACTION),subModelHelper:null,detailsView:null,events:{"click  .btnDetailsAction":"_onClickLinkAction"},initialize:function(e){this.detailsView=e.detailsView,this.subModelHelper=new l},destroy:function(){this.$(".btnDisabled").tooltip("destroy"),this.$(".new-label").tooltip("destroy"),e.prototype.destroy.apply(this,arguments)},updateButtons:function(e,t,i){this.undelegateEvents(),this.$el.hide();var n="";if(i=i||{},i.error!==c.ERROR_ENTITY_NOT_FOUND){e&&e[c.NAV_ACTION_TARGET_ID]===c.ACTION_SUMMARY&&(n=this.getSummaryActions($.extend({},e),t));var s=!1;if(e&&e[c.NAV_ACTION_TARGET_ID]&&e[c.NAV_ACTION_TARGET_ID]!==c.ACTION_SUMMARY)switch(this.pageId){case c.PAGE_ALERTS:n=this.getAlertActions(e,t);break;case c.PAGE_HARDWARE:e[c.NAV_ACTION_TARGET]!==c.ENTITY_DISK?n=this.getHardwareActions(e,t):(s=!0,this.updateDiskActionButtons(e,t));break;case c.PAGE_STORAGE:n=this.getStorageActions(e,t);break;case c.PAGE_DR:case c.PAGE_VMS:case c.PAGE_FILE_SERVER:n=this.getActions(e,t);break;default:n=""}s||this.renderButtons(n),!t||this.pageId!==c.PAGE_FILE_SERVER&&this.pageId!==c.PAGE_VMS||this.detailsView.checkFileInsightsVm(t)}},renderButtons:function(e){this.canModifyByPage(this.pageId)&&(this.$(".btnDisabled").tooltip("destroy"),this.$(".new-label").tooltip("destroy"),this.$el.html(e),this.$el.show(),this.delegateEvents(),this.$(".btnDisabled").tooltip({placement:"bottom",trigger:"hover",html:!1,container:"body"}),this.$(".new-label").tooltip({placement:"bottom",trigger:"hover",html:!1,container:"body"}))},hideDetailActionButtons:function(){this.$el.hide()},getSummaryActions:function(e,i){var n="";switch(e[c.NAV_ACTION_TARGET]){case c.ENTITY_ACROPOLIS_VOLUME_GROUP:e[c.NAV_ACTION]=c.ACTION_UPDATE,e[c.NAV_ACTION_TARGET]=c.ENTITY_ISCSI_CLIENT,n+=this.tmplDetailsAction({model:e,action:c.ACTION_UPDATE,content:t.MANAGE_INITIATORS})}return n},getActions:function(e,t){var i=this.detailsView.getDetailsAction(e,t),n="";return _.each(i,function(t,i){t.wizard?n+=this.tmplDetailsWizardAction({model:t.model||e,action:t.action,content:t.content}):t.custom?n+=this.tmplDetailsCustomAction({model:t.model||e,action:t.action,content:t.content}):t.dropdownEnabled?n+=this.tmplDropdownCustomAction({model:t.model||e,content:t.content}):t.disabled?n+=this.tmplDisabledDetailsAction({model:t.model||e,action:t.action,content:t.content,tooltip:t.tooltip||""}):t.actionId?n+=this.tmplFileAnalyticsDetailsAction({model:t.model||e,action:t.action,actionId:t.actionId,isNewAction:t.isNewAction||!1,content:t.content,newTooltip:t.newTooltip||""}):n+=this.tmplDetailsAction({model:t.model||e,action:t.action,isNewAction:t.isNewAction||!1,content:t.content,newTooltip:t.newTooltip||""})},this),n},getAlertActions:function(e,i){switch(e[c.NAV_ACTION_TARGET]){case c.ENTITY_ALERT:return this.tmplDetailsAction({model:e,action:c.ACTION_ACKNOWLEDGE,content:t.ACKNOWLEDGE_ALERT})+this.tmplDetailsAction({model:e,action:c.ACTION_RESOLVE,content:t.RESOLVE_ALERT});default:return""}},isBootDiskRepairTaskRunning:function(e){return o.getGlobalTasks().find(function(t){var n=t.get(i.TASK_ENTITY_ID);return n&&"string"!=typeof n&&(n=n[0]),t.get(i.TASK_TYPE)===c.TASK_OPERATION_BOOT_DISK_REPAIR&&n===e&&(t.isStatusActive()||t.isStatusQueued())})},updateDiskActionButtons:function(e,t){var a=new n,o=new s,l=r.getCurrentClusterModel().get(i.CLUSTER_NUM_NODES),c=t.get(i.SERVICE_VM_ID);e[this.DISK_REMOVE_ALLOWED]=!0;var d=[];d.push(a.fetch()),d.push(o.fetch());var h=this;$.whenAll.apply($,d).done(function(){var i=o.getDisksFromHost(c).length;l<3&&i<3&&(e[h.DISK_REMOVE_ALLOWED]=!1);var n=_.clone(e);n[h.DISK_HAS_NO_LED]=!u.hasDiskLed(t,a),h.renderButtons(h.getHardwareActions(n,t))}).fail(function(){h.renderButtons(h.getHardwareActions(e,t))})},getHardwareActions:function(e,n){switch(e[c.NAV_ACTION_TARGET]){case c.ENTITY_DISK:var s="";if(n&&this.isClusterFFEnabled(c.FFLAGS.BREAKFIX)){if(n.get(i.DISK_HW_CONFIG)&&!e[this.DISK_HAS_NO_LED]&&(s+=this.tmplDetailsCustomAction({model:e,action:c.ACTION_TURN_ON_LED,content:t.TURN_ON_LED}),s+=this.tmplDetailsCustomAction({model:e,action:c.ACTION_TURN_OFF_LED,content:t.TURN_OFF_LED})),n.isUnmounted()&&!n.isUnmountedDiskStateBad()){var a=n.getBackgroundOperation(),o=n.isBootDiskOnly();a||o||(n.isUnmountedDiskStatePulledOut()&&(s+=this.tmplDetailsCustomAction({model:e,action:c.ACTION_ADD_BACK,content:t.ADD_BACK})),s+=this.tmplDetailsCustomAction({model:e,action:c.ACTION_PREPARE_ADD,content:t.PREPARE_ADD}))}if(!n.isUnmounted())if(n.isNormal()&&e[this.DISK_REMOVE_ALLOWED]){var l=n.getStorageTierName()===c.DISK_TIER.PCIE?c.ACTION_REPLACE:c.ACTION_REMOVE;s+=this.tmplDetailsAction({model:e,action:l,content:l===c.ACTION_REPLACE?t.REPLACE_DISK:t.REMOVE_DISK})}else n.isBeingRemoved()&&(s+=t.MSG_BEING_REMOVED);return n.isSSD()&&n.isUnmounted()&&n.isHostMetadataStoreDisabled()&&(s+=this.tmplDetailsCustomAction({model:_.extend(e,{actionTargetId:n.getHostIp()}),action:c.ACTION_REPAIR,content:t.SSD_BREAKFIX})),s}break;case c.ENTITY_HOST:var u="",d=r.getClusterModelByClusterUuid(n.get(i.UUID)),h=n.isComputeOnly(),p=!h&&d.isRepairBootDiskSupported(),T=d.getRepairBootDiskRequirements(),E=this.isBootDiskRepairTaskRunning(n.get(i.UUID)),S=this.tmplDetailsCustomAction,g={model:e,action:c.ACTION_MARK_AS_FIXED,content:t.MARK_AS_FIXED},A={model:e,action:c.ACTION_ENABLE_METADATA_STORE,content:t.ENABLE_METADATA_STORE,tooltip:this.i18n("boot_disk_repair_disabled_msg")},m={model:e,action:c.ACTION_TURN_ON_LED,content:t.TURN_ON_LED,tooltip:this.i18n("boot_disk_repair_disabled_msg")},f={model:e,action:c.ACTION_TURN_OFF_LED,content:t.TURN_OFF_LED,tooltip:this.i18n("boot_disk_repair_disabled_msg")},I={model:{action:e[c.NAV_ACTION],actionTarget:e[c.NAV_ACTION_TARGET],actionTargetId:n.get(i.UUID),actionTargetName:n.get(i.HYPERVISOR_TYPE)},action:c.ACTION_REPAIR,content:t.REPAIR_NODE,tooltip:h?this.i18n("boot_disk_repair_disabled_compute_only"):d.getRepairBootDiskSupportMessage(T)},C={model:{action:e[c.NAV_ACTION],actionTarget:e[c.NAV_ACTION_TARGET],actionTargetId:n.get(i.UUID),actionTargetName:n.get(i.NAME)},action:c.ACTION_REMOVE,content:t.REMOVE_HOST,tooltip:this.i18n("boot_disk_repair_disabled_msg")};if(n&&n.get(i.IS_DEGRADED)&&(u+=S(g)),n&&this.isClusterFFEnabled(c.FFLAGS.BREAKFIX)){S=E?this.tmplDisabledDetailsAction:this.tmplDetailsCustomAction,n&&n.get(i.METADATA_STORE_STATUS)===c.METADATA_STORE_STATUS.PRELIMBO&&(u+=S(A)),u+=S(m),u+=S(f);var v=this.detailsView.getHostCollection().getNodeCountByType(c.HOST_TYPES.HYPER_CONVERGED),R=h||v>c.MIN_NODES&&r.getCurrentClusterModel().isRemoveHostSupported();return n.isBeingRemoved()?u+=t.MSG_BEING_REMOVED:(E||(S=this.tmplDetailsAction),u+=p?S(I):this.tmplDisabledDetailsAction(I),R&&(u+=S(C))),u}break;default:return""}},getStorageActions:function(e,i){switch(e[c.NAV_ACTION_TARGET]){case c.ENTITY_STORAGE_POOL:return this.tmplDetailsAction({model:e,action:c.ACTION_UPDATE,content:t.UPDATE});case c.ENTITY_CONTAINER:return i.isSystemContainer()?this.tmplDisabledDetailsAction({model:e,action:c.ACTION_UPDATE,content:t.UPDATE,tooltip:t.SYSTEM_CONTAINER})+this.tmplDisabledDetailsAction({model:e,action:c.ACTION_DELETE,content:t.DELETE,tooltip:t.SYSTEM_CONTAINER}):this.tmplDetailsAction({model:e,action:c.ACTION_UPDATE,content:t.UPDATE})+this.tmplDetailsAction({model:e,action:c.ACTION_DELETE,content:t.DELETE});case c.ENTITY_ACROPOLIS_VOLUME_GROUP:return this.tmplDetailsAction({model:e,action:c.ACTION_CLONE,content:t.CLONE})+this.tmplDetailsAction({model:e,action:c.ACTION_UPDATE,content:t.UPDATE})+this.tmplDetailsAction({model:e,action:c.ACTION_DELETE,content:t.DELETE});default:return""}},_onClickLinkAction:function(e){var t=$(e.currentTarget),i=t.hasClass("btnWizardAction"),n=t.hasClass("btnCustomAction"),s=t.find(".new-label");s.length&&s.hide();var r={action:t.attr(c.NAV_ACTION),actionTarget:t.attr(c.NAV_ACTION_TARGET),actionTargetId:t.attr(c.NAV_ACTION_TARGET_ID),actionTargetName:t.attr(c.NAV_ACTION_TARGET_NAME)},o=!1;this.detailsView&&(o=this.detailsView.handleDetailsViewAction(e,r)),o||(i?a.executeAction(r):n?u.log("Error: Custom Details Event Handler not defined."):a.executeActionElement(e.currentTarget))}})}),define("utils/TooltipContent",["managers/ClusterManager","data/DataProperties","utils/AppConstants","utils/StatsUtil","utils/AppUtil","utils/I18nMixin"],function(e,t,i,n,s,a){"use strict";return _.extend({},a,{name:"TooltipContent",initialize:function(){var e,t="\n          <p>"+this.i18n("common_chart_msg_title")+'</p>\n          <ol class="tooltip-list">\n            <li>'+this.i18n("common_chart_msg_li1")+"</li>\n            <li>"+this.i18n("common_chart_msg_li2")+"</li>\n          </ol>\n          <div>"+this.i18n("common_chart_msg_footer")+"</div>";_.extend(this,(e={TEMPLATE:'<span class="n-tooltip" style="display:none;"></span>',ALERT_SORTING:this.i18n("alert_sorting"),ALERT_INCLUDE_CONTACT_LIST:this.i18n("alert_include_contact_list"),HARDWARE_DIAGRAM_NONSKEUOMORPHIC:this.i18n("hardware_diagram_nonskeuomorphic"),ACTION_DISABLED_PRISM_ELEMENT_ALERTS:this.i18n("action_disabled_prism_element_alerts")},_defineProperty(e,i.ENTITY_KERBEROS_CONFIG,{CREDENTIALS_HELP:this.i18n("kerberos_credentials_help")}),_defineProperty(e,i.ENTITY_BOOT_DEVICE,{BOOT_DEVICE_MSG:this.i18n("boot_device_msg")}),_defineProperty(e,i.ENTITY_AUTH_CONFIG,{ROLE_MAP_MESSAGE:_.template("\n              <p>"+this.i18n("auth_config_no_role_mapping")+'</p>\n              <a class="role-mapping-link" <%= actionAttributes %> >\n                '+this.i18n("auth_config_link1")+"\n              </a>\n              "+this.i18n("auth_config_link2"))}),_defineProperty(e,i.PAGE_STORAGE,{USAGE:{TEXT:t,SELECTOR:'.n-tab-details-button[data-target="'+i.TAB_DETAILS.USAGE+'"]'},METRICS:{TEXT:t,SELECTOR:'.n-tab-details-button[data-target="'+i.TAB_DETAILS.METRICS+'"]'},CAPACITY_DEDUP:'\n              <div class="n-savings-info">\n                '+this.i18n("storage_capacity_dedup")+"\n              </div>",PERF_DEDUP:'\n              <div class="n-savings-info">\n                '+this.i18n("storage_perf_dedup")+"\n              </div>",DEDUP_UNSUPPORTED_NODE_COUNT:'\n              <div class="n-savings-info">\n                '+this.i18n("storage_dedup_unsupported_node_count")+"\n              </div>",ERASURE_CODING:'\n              <div class="n-savings-info">\n                '+this.i18n("storage_erasure_coding")+"\n              </div>",REPLICATION_FAC:'\n              <div class="n-savings-info">\n                '+this.i18n("storage_redundancy_factor")+"\n              </div>"}),_defineProperty(e,i.PAGE_VMS,{METRICS:{TEXT:t,SELECTOR:'.n-tab-details-button[data-target="'+i.TAB_DETAILS.METRICS+'"]'},VM_NICS:{TEXT:this.i18n("vms_nics_best_effort"),SELECTOR:'.n-tab-details-button[data-target="'+i.TAB_DETAILS.VIRTUAL_NICS+'"]'}}),_defineProperty(e,i.PAGE_HARDWARE,{USAGE:{TEXT:t,SELECTOR:'.n-tab-details-button[data-target="'+i.TAB_DETAILS.USAGE+'"]'},METRICS:{TEXT:t,SELECTOR:'.n-tab-details-button[data-target="'+i.TAB_DETAILS.METRICS+'"]'}}),_defineProperty(e,"CONTAINER_INFO",{CONTAINER_FILESYSTEM_WHITELISTS:{ID:"CONTAINER_FILESYSTEM_WHITELISTS",INFO:_.template('\n                <div class="n-breakdown">\n                  <div class="n-info-title">\n                    '+this.i18n("container_whitelists")+'\n                  </div>\n                  <div class="n-new-row">\n                    <% for (var entry in nfsWhitelist) { %>\n                      <div><%= nfsWhitelist[entry] %></div>\n                    <% } %>\n                  </div>\n                </div>')}}),_defineProperty(e,"STORAGE_STATS",{NO_STATS_BREAKDOWN:_.template(this.i18n("storage_stats_no_stats_breakdown")),CLUSTER_PROVISIONED:{ID:"CLUSTER_PROVISIONED",INFO:"\n                <div class=\"n-storage-info\">\n                  <%= i18n('tt_total_provisioned') %>\n                </div>"},CLUSTER_FREE:{ID:"CLUSTER_FREE",INFO:_.template("\n                <div class=\"n-storage-info\">\n                  <div class=\"n-storage-info-title\">\n                    <%= i18ns('tt_free_space_title', free) %>\n                  </div>\n                  <ul>\n                    <li><%= i18n('tt_free_space') %></li>\n                  </ul>\n                </div>")},RESERVED_FREE:{ID:"RESERVED_FREE",INFO:_.template("\n                <div class=\"n-storage-info\">\n                  <div class=\"n-storage-info-title\">\n                    <%= i18ns('tt_reserved_title', reservedFree) %>\n                  </div>\n                  <ul>\n                    <li><%= i18n('tt_reserved_free_info') %></li>\n                  </ul>\n                </div>")},CLUSTER_USED:{ID:"CLUSTER_USED",INFO:_.template("\n                <div class=\"n-storage-info\">\n                  <div class=\"n-storage-info-title\">\n                  <%= i18ns('tt_total_used_title', used) %>\n                  </div>\n                  <ol>\n                    <li><%= i18n('tt_total_used') %></li>\n                    <li><%= i18n('tt_thick') %></li>\n                  </ol>\n                </div>")},CLUSTER_CAPACITY:{ID:"CLUSTER_CAPACITY",INFO:_.template("\n                <div class=\"n-storage-info\">\n                  <%= i18n('tt_capacity') %>\n                </div>")},CLUSTER_UNALLOCATED:{ID:"CLUSTER_UNALLOCATED",INFO:_.template("\n                <div class=\"n-storage-info\">\n                  <%= i18n('tt_not_part_of_sp') %>\n                </div>")},COMPRESSION_SAVINGS:{ID:"COMPRESSION_SAVINGS",
BREAKDOWN:_.template('\n                <div class="n-storage-breakdown">\n                  <div class="n-row">\n                    <div class="n-row-label">\n                      '+this.i18n("storage_stats_compression_ratio")+'\n                    </div>\n                    <div class="n-row-value">\n                      <%= lblCompressionSavingsRatio %>\n                    </div>\n                  </div>\n                  <div class="n-row">\n                    <div class="n-row-label">\n                      '+this.i18n("storage_stats_usage_savings")+'\n                    </div>\n                    <div class="n-row-value">\n                      <%= lblCompressionSavedBytes %>\n                    </div>\n                  </div>\n                </div>')},ERASURE_CODING_SAVINGS:{ID:"ERASURE_CODING_SAVINGS",BREAKDOWN:_.template('\n                <div class="n-storage-breakdown">\n                  <div class="n-row">\n                    <div class="n-row-label">\n                      '+this.i18n("storage_stats_erasure_coding_ratio")+'\n                    </div>\n                    <div class="n-row-value">\n                      <%= lblErasureSavingsRatio %>\n                    </div>\n                  </div>\n                  <div class="n-row">\n                    <div class="n-row-label">\n                      '+this.i18n("storage_stats_usage_savings")+'\n                    </div>\n                    <div class="n-row-value">\n                      <%= lblErasureSavedBytes %>\n                    </div>\n                  </div>\n                </div>')},DEDUP_SAVINGS:{ID:"DEDUP_SAVINGS",BREAKDOWN:_.template('\n                <div class="n-storage-breakdown">\n                  <div class="n-row">\n                    <div class="n-row-label">\n                      '+this.i18n("storage_stats_dedup_ratio")+'\n                    </div>\n                    <div class="n-row-value">\n                      <%= lblDedupSavingsRatio %>\n                    </div>\n                  </div>\n                  <div class="n-row">\n                    <div class="n-row-label">\n                      '+this.i18n("storage_stats_usage_savings")+'\n                    </div>\n                    <div class="n-row-value">\n                      <%= lblDedupSavedBytes %>\n                    </div>\n                  </div>\n                </div>')},OVERALL_EFFICIENCY:{ID:"OVERALL_EFFICIENCY",BREAKDOWN:_.template('\n                <div class="n-storage-info">\n                  <div>\n                    '+this.i18n("storage_stats_overall_efficiency")+"\n                  </div>\n                </div>")},DATAREDUCTION_RATIO:{ID:"DATAREDUCTION_RATIO",BREAKDOWN:_.template('\n                <div class="n-storage-info">\n                  <div>\n                    '+this.i18n("storage_stats_data_reduction_ratio")+"\n                  </div>\n                </div>")},EFFECTIVE_FREE:{ID:"EFFECTIVE_FREE",BREAKDOWN:_.template('\n                <div class="n-storage-info">\n                  <p class="n-storage-info-title">\n                    '+this.i18n("storage_stats_effective_p1")+"\n                  </p>\n                  <p>\n                    "+this.i18n("storage_stats_effective_p2")+"\n                  </p>\n                </div>")},CONTAINER_FREE:{ID:"CONTAINER_FREE",INFO:'\n                <div class="n-storage-info">\n                  <div class="n-storage-info-title">\n                    '+this.i18n("storage_stats_container_free_breakdown")+"\n                  </div>\n                  "+this.i18n("storage_stats_container_free_desc")+"\n                </div>",BREAKDOWN:_.template('\n                <div class="n-storage-breakdown  n-breakdown-used">\n                  <div class="n-storage-info-title">\n                    '+this.i18n("storage_stats_container_free_breakdown")+'\n                  </div>\n                  <div class="n-row">\n                    <div class="n-row-label">\n                      '+this.i18n("storage_stats_container_logical_capacity")+'\n                    </div>\n                    <div class="n-row-value">\n                      <%= capacity %>\n                    </div>\n                  </div>\n                  <div class="n-row">\n                    <div class="n-row-label">\n                      '+this.i18n("storage_stats_container_logical_used")+'\n                    </div>\n                    <div class="n-row-value">\n                      –&nbsp;&nbsp;<%= used %>\n                    </div>\n                  </div>\n                  <div class="n-row equation-bar">\n                  </div>\n                  <div class="n-row">\n                    <div class="n-row-label">\n                      '+this.i18n("storage_stats_container_logical_free")+'\n                    </div>\n                    <div class="n-row-value">\n                      <%= free %>\n                    </div>\n                  </div>\n                </div>')},CONTAINER_USED:{ID:"CONTAINER_USED",INFO:'\n                <div class="n-storage-info">\n                  <div class="n-storage-info-title">\n                    '+this.i18n("storage_stats_container_used_breakdown")+"\n                  </div>\n                  <ol>\n                    <li>"+this.i18n("storage_stats_container_logical_used_by_container")+"</li>\n                    <li>"+this.i18n("storage_stats_container_thick_provisioned")+"</li>\n                  </ol>\n                </div>",BREAKDOWN:_.template('\n                <div class="n-storage-breakdown">\n                  <div class="n-storage-info-title">\n                    '+this.i18n("storage_stats_container_used_breakdown")+'\n                  </div>\n                  <div class="n-row">\n                    <div class="n-row-label">'+this.i18n("storage_stats_container_used_capacity")+'</div>\n                    <div class="n-row-value"><%= realUsed %></div>\n                  </div>\n                  <div class="n-row">\n                    <div class="n-row-label">'+this.i18n("storage_stats_container_unused_thick_provisioned")+'</div>\n                    <div class="n-row-value"><%= reservedNotUsed %></div>\n                  </div>\n                </div>')},CONTAINER_TOTAL_USED:{ID:"CONTAINER_TOTAL_USED",INFO:'\n                <div class="n-storage-info">\n                  <div class="n-storage-info-title">\n                    '+this.i18n("storage_stats_container_total_breakdown")+"\n                  </div>\n                  <ol>\n                    <li>"+this.i18n("storage_stats_container_logical_used_by_container")+"</li>\n                    <li>"+this.i18n("storage_stats_container_thick_provisioned")+"</li>\n                    <li>"+this.i18n("storage_stats_container_used_by_other_long")+"</li>\n                  </ol>\n                </div>",BREAKDOWN:_.template('\n                <div class="n-storage-breakdown">\n                  <div class="n-storage-info-title">\n                    '+this.i18n("storage_stats_container_total_breakdown")+'\n                  </div>\n                  <div class="n-row">\n                    <div class="n-row-label">'+this.i18n("storage_stats_container_used_capacity")+'</div>\n                    <div class="n-row-value"><%= realUsed %></div>\n                  </div>\n                  <div class="n-row">\n                    <div class="n-row-label">'+this.i18n("storage_stats_container_unused_thick_provisioned")+'</div>\n                    <div class="n-row-value"><%= reservedNotUsed %></div>\n                  </div>\n                  <div class="n-row">\n                    <div class="n-row-label">'+this.i18n("storage_stats_container_used_by_other")+'</div>\n                    <div class="n-row-value"><%= usedByOthers %></div>\n                  </div>\n                </div>')},CONTAINER_MAX:{ID:"CONTAINER_MAX",INFO:'\n                <div class="n-storage-info">\n                  <div class="n-storage-info-title">\n                    '+this.i18n("storage_stats_container_max_breakdown")+"\n                  </div>\n                  "+this.i18n("storage_stats_container_max_explanation")+"\n                </div>",BREAKDOWN:_.template("\n                <% if (isAdvUsedAsMax) { %>\n                  "+this.i18n("storage_stats_container_advertised_p1")+"\n                  (<%= advCapacity %>)\n                  "+this.i18n("storage_stats_container_advertised_p2")+'\n                <% } else { %>\n                  <div class="n-storage-breakdown">\n                    <div class="n-storage-info-title">\n                      '+this.i18n("storage_stats_container_max_breakdown")+'\n                    </div>\n                    <div class="n-row">\n                      <div class="n-row-label">\n                        '+this.i18n("storage_stats_container_total_pool_capacity")+'\n                      </div>\n                      <div class="n-row-value"><%= ownMax %></div>\n                    </div>\n                    <div class="n-row">\n                      <div class="n-row-label">\n                        '+this.i18n("storage_stats_container_total_reserved_for_others")+'\n                      </div>\n                      <div class="n-row-value">\n                        – &nbsp;&nbsp; <%= totResCapacity %>\n                      </div>\n                    </div>\n                    <% if (isUsedByOthersShown) { %>\n                      <div class="n-row">\n                        <div class="n-row-label">\n                          '+this.i18n("storage_stats_container_total_used_by_others")+'\n                        </div>\n                        <div class="n-row-value">\n                          – &nbsp;&nbsp; <%= usedByOtherCtrs %>\n                        </div>\n                      </div>\n                    <% } %>\n                    <div class="n-row equation-bar">\n                    </div>\n                    <div class="n-row">\n                      <div class="n-row-label">\n                        '+this.i18n("storage_stats_container_max_capacity")+'\n                      </div>\n                      <div class="n-row-value">\n                        <%= max %>\n                      </div>\n                    </div>\n                  </div>\n                <% } %>')},IQN_PREFIX:{ID:"IQN_PREFIX",BREAKDOWN:_.template('\n                <div class="n-storage-breakdown  n-breakdown-used">\n                  <div class="n-row"><%= prefix %></div>\n                </div>')},STORAGE_POOL_FREE:{ID:"STORAGE_POOL_FREE",INFO:'\n                <div class="n-storage-info">\n                  <div class="n-storage-info-title">\n                    '+this.i18n("storage_stats_pool_free_breakdown")+"\n                  </div>\n                  "+this.i18n("storage_stats_pool_free_desc")+"\n                </div>",BREAKDOWN:_.template('\n                <div class="n-storage-breakdown  n-breakdown-used">\n                  <div class="n-storage-info-title">\n                    '+this.i18n("storage_stats_pool_free_breakdown")+'\n                  </div>\n                  <div class="n-row">\n                    <div class="n-row-label">'+this.i18n("storage_stats_pool_physical_capacity")+'</div>\n                    <div class="n-row-value"><%= capacity %></div>\n                  </div>\n                  <div class="n-row">\n                    <div class="n-row-label">\n                      '+this.i18n("storage_stats_pool_physical_used")+'\n                      <div class="minus">–</div>\n                    </div>\n                    <div class="n-row-value"><%= used %></div>\n                  </div>\n                </div>')},STORAGE_POOL_USED:{ID:"STORAGE_POOL_USED",INFO:'\n                <div class="n-storage-info">\n                  <div class="n-storage-info-title">\n                    '+this.i18n("storage_stats_pool_used_breakdown")+"\n                  </div>\n                  <ol>\n                    <li>"+this.i18n("storage_stats_pool_used_by_this")+"</li>\n                    <li>"+this.i18n("storage_stats_pool_thick_provisioned")+"</li>\n                    <li>"+this.i18n("storage_stats_pool_reserved_capacity")+"</li>\n                  </ol>\n                </div>",BREAKDOWN:_.template('\n                <div class="n-storage-breakdown">\n                  <div class="n-storage-info-title">\n                    '+this.i18n("storage_stats_pool_used_breakdown")+'\n                  </div>\n                  <div class="n-row">\n                    <div class="n-row-label">'+this.i18n("storage_stats_pool_used_by_this")+':</div>\n                    <div class="n-row-value"><%= realUsed %></div>\n                  </div>\n                  <div class="n-row">\n                    <div class="n-row-label">'+this.i18n("storage_stats_pool_thick_provisioned")+':</div>\n                    <div class="n-row-value"><%= implicitReservedFree %></div>\n                  </div>\n                  <div class="n-row">\n                    <div class="n-row-label">'+this.i18n("storage_stats_pool_reserved_capacity_short")+'</div>\n                    <div class="n-row-value"><%= reservedNotUsed %></div>\n                  </div>\n                </div>')},STORAGE_POOL_MAX:{ID:"STORAGE_POOL_MAX",INFO:'\n                <div class="n-storage-info">\n                  <div class="n-storage-info-title">\n                    '+this.i18n("storage_stats_pool_max_breakdown")+"\n                  </div>\n                  "+this.i18n("storage_stats_pool_max_desc")+"\n                </div>",BREAKDOWN:_.template('\n                <div class="n-storage-breakdown">\n                  <div class="n-storage-info-title">\n                    '+this.i18n("storage_stats_pool_max_breakdown")+'\n                  </div>\n                  <div class="n-row">\n                    '+this.i18n("storage_stats_pool_max_p1")+"\n                    <%= diskCount %>\n                    "+this.i18n("storage_stats_pool_max_p2")+"\n                    <%= capacity %>\n                  </div>\n                </div>")},FILE_SERVER_USED:{ID:"FILE_SERVER_USED",INFO:'\n                <div class="n-storage-info">\n                  '+this.i18n("storage_stats_file_server_used")+"\n                </div>"},FILE_SERVER_LOGICAL_SPACE_USED:{ID:"FILE_SERVER_LOGICAL_SPACE_USED",INFO:'\n                <div class="n-storage-info">\n                  '+this.i18n("storage_stats_file_server_logical")+"\n                </div>"}}),e))},getRoleMappingLink:function(){return this[i.ENTITY_AUTH_CONFIG].ROLE_MAP_MESSAGE({actionAttributes:s.createActionAttr(i.ENTITY_ROLE_MAPPING,i.ACTION_SHOW)})},getStorageStatsInfo:function(e){return this._getTmplStorageStats("INFO",e)},getStorageStatsBreakdown:function(e,s){var a=this._getTmplStorageStats("BREAKDOWN",e,s);if(a===this.STORAGE_STATS.NO_STATS_BREAKDOWN)return a;switch(e){case this.STORAGE_STATS.CONTAINER_USED.ID:case this.STORAGE_STATS.CONTAINER_TOTAL_USED.ID:return a({realUsed:n.storageFormat(s.getRealUsed()),reservedNotUsed:n.storageFormat(s.getReservedButNotUsed()),usedByOthers:n.storageFormat(s.getTotalUsedByOtherContainers())});case this.STORAGE_STATS.CONTAINER_FREE.ID:return a({used:n.storageFormat(s.getTotalUsedLogical()),capacity:n.storageFormat(s.getMaxCapacityLogical()),free:n.storageFormat(s.getTotalAvailableLogical())});case this.STORAGE_STATS.CONTAINER_MAX.ID:return a({isAdvUsedAsMax:s.isAdvertisedUsedAsMaxCapacity(),advCapacity:n.storageFormat(s.get(t.ADVERTISED_CAPACITY)),ownMax:n.storageFormat(s.getOwnMaxCapacity()),totResCapacity:n.storageFormat(s.getOtherContainersTotalReservedCapacity()),usedByOtherCtrs:n.storageFormat(s.getTotalUsedByOtherContainers()),isUsedByOthersShown:s.getTotalUsedByOtherContainers()!==i.STATS_NO_VALUE,max:n.storageFormat(s.getMaxCapacityLogical())});case this.STORAGE_STATS.IQN_PREFIX.ID:return a({prefix:i.NUTANIX_IQN_PREFIX+s.get(s.DP.ISCSI_TARGET_NAME)});case this.STORAGE_STATS.STORAGE_POOL_USED.ID:return a({realUsed:n.storageFormat(s.getRealUsed()),reservedNotUsed:n.storageFormat(s.getReservedButNotUsed()),implicitReservedFree:n.storageFormat(s.getImplicitReservedButNotUsed())});case this.STORAGE_STATS.STORAGE_POOL_FREE.ID:return a({used:n.storageFormat(s.getUsedPhysical()),capacity:n.storageFormat(s.getTotalCapacity())});case this.STORAGE_STATS.STORAGE_POOL_MAX.ID:return a({diskCount:s.getDiskCount(),capacity:n.storageFormat(s.getTotalCapacity())});case this.STORAGE_STATS.COMPRESSION_SAVINGS.ID:return a({lblCompressionSavingsRatio:s.getEffectiveCompressionRatio(),lblCompressionSavedBytes:s.getActualSpaceSavedCompressionLabel()});case this.STORAGE_STATS.ERASURE_CODING_SAVINGS.ID:return a({lblErasureSavingsRatio:s.getErasureCodeRatio(),lblErasureSavedBytes:s.getErasureCodeSpaceSaved()});case this.STORAGE_STATS.DEDUP_SAVINGS.ID:return a({lblDedupSavingsRatio:s.getEffectiveOnDiskDedupRatio(),lblDedupSavedBytes:s.getActualSpaceSavedOnDiskDedupLabel()});case this.STORAGE_STATS.OVERALL_EFFICIENCY.ID:return a({lblDataReductionRatio:s.getDataReductionRatio(),lblThinProvSavingRatio:s.getThinProvSavingRatio(),lblIntCloneSavingRatio:s.getIntCloneSavingRatio()});case this.STORAGE_STATS.DATAREDUCTION_RATIO.ID:return a({compressionRatio:s.getEffectiveCompressionRatio(),erasureCodingRatio:s.getErasureCodeRatio(),capacityDedupRatio:s.getEffectiveOnDiskDedupRatio()});case this.STORAGE_STATS.EFFECTIVE_FREE.ID:return a({lblDedupSavingsRatio:s.getEffectiveOnDiskDedupRatio(),lblDedupSavedBytes:s.getActualSpaceSavedOnDiskDedupLabel()});default:throw new Error("Unrecognized storage tooltip id")}},_getTmplStorageStats:function(t,n,s){var a=!1;return a=s&&s.hasNewStorageStats?s.hasNewStorageStats():e.isClusterFFEnabled(i.FFLAGS.ARITHMOS_NEW_STORAGE_STATS),"INFO"===t||a?this.STORAGE_STATS[n][t]:this.STORAGE_STATS.NO_STATS_BREAKDOWN}})}),define("text!templates/basecomponents/details/BaseDetailsView.html",[],function(){return'\x3c!-- Details Head --\x3e\n<div class="n-details-head">\n  \x3c!-- Breadcrumb --\x3e\n  <div class="n-breadcrumb pull-left">\n    \x3c!-- @view: Breadcrumb goes here... --\x3e\n  </div>\n  \x3c!-- Details Action --\x3e\n   <div class="n-details-action pull-right">\n    \x3c!-- @view: Detail action goes here... --\x3e\n  </div>\n  <div class="n-clearfix"></div>\n</div>\n\x3c!-- Details Body --\x3e\n<div class="n-details-content-holder">\n  \x3c!-- 1) Summary details of the page --\x3e\n  <div class="n-details-content">\n    <div class="n-details-content-summary  detailsSummaryContainer">\n      \x3c!-- @view: Summary details goes here... --\x3e\n    </div>\n  </div>\n  \x3c!-- 2) Selected entity details --\x3e\n  <div class="n-details-content  detailsEntityContainer">\n    \x3c!-- @view: Details entity views goes here... --\x3e\n  </div>\n</div>'}),define("views/basecomponents/details/BaseDetailsView",["views/basecomponents/BaseView","views/basecomponents/details/breadcrumb/DetailsBreadCrumbView","views/basecomponents/details/detailsaction/DetailsActionView","events/AppEvents","managers/ClusterManager","utils/AppUtil","utils/AppConstants","utils/TooltipContent","utils/SubViewHelper","text!templates/basecomponents/details/BaseDetailsView.html"],function(e,t,i,n,s,a,r,o,l,c){"use strict";return e.extend({pageId:null,breadCrumbView:null,detailsActionView:null,subViewHelperEntity:null,resizeTimer:null,tabDetailsView:null,eventBus:null,detailsBaseTemplate:_.template(c),summaryTemplate:null,detailsEntityTemplate:_.template('<div class="details-<%= entity %> n-details-content-entity"></div>'),initialize:function(n){e.prototype.initialize.apply(this,arguments),this.initializeProperties(n),n&&(this.eventBus=n.eventBus),this.subViewHelperEntity=new l,_.bindAll(this,"onResize","customDetailsEventHandler"),this.eventBus&&this.eventBus.bind("showTab",this.updateDetailsActionView.bind(this)),this.$el.html(this.detailsBaseTemplate),this.$(".detailsSummaryContainer").html(this.summaryTemplate(this.vtOptions())),this.breadCrumbView=new t({el:this.getBreadCrumbElement()}),this.breadCrumbView.pageId=this.pageId,s.isMulticlusterNavMode()||(this.detailsActionView=new i({el:this.getDetailsActionElement(),detailsView:this}),this.detailsActionView.pageId=this.pageId),this.render()},initializeProperties:function(e){},show:function(e){this.isValidForUpdate(e)&&(this.parseOptions(e),this.breadCrumbView&&this.breadCrumbView.updateTrail(this.getOptionsObject()),this.updateDetailsActionView(this.getOptionsObject()),this.isValidOptionsObject()&&!this.isSummaryView()&&(this.$(".detailsSummaryContainer").hide(),this.$(".detailsEntityContainer").show(),this._activateDetails()),this.isSummaryView()&&(this.$(".detailsEntityContainer").hide(),this.$(".detailsSummaryContainer").show(),this._activateSummary(),this.getDataAndRender()),this.onResize())},updateDetailsActionView:function(e){this.detailsActionView&&this.isSummaryView()&&this.updateActionButtons(e)},_delegateTooltips:function(){_.each(o[this.pageId],function(e){var t=this;this.$(e.SELECTOR).append(o.TEMPLATE),this.$(e.SELECTOR+" .n-tooltip").nutanixMoreInfo({classes:["-nudge-up"],title:e.TEXT}),this.$(e.SELECTOR).on("hover",function(i){$("body.nav_table").is(":visible")&&("mouseenter"===i.type?t.$(e.SELECTOR+" .n-tooltip").css("display","inline"):t.$(e.SELECTOR+" .n-tooltip").hide())})},this)},_undelegateTooltips:function(){_.each(o[this.pageId],function(e){this.$(e.SELECTOR+" .n-tooltip").nutanixMoreInfo("destroy"),this.$(e.SELECTOR+" .n-tooltip").remove(),this.$(e.SELECTOR).off("mouseenter mouseleave")},this)},getDataAndRender:function(){throw new Error("BaseDetailsView.getDataAndRender() must be overridden.")},getBreadCrumbElement:function(){return this.$(".n-breadcrumb")},getDetailsActionElement:function(){return this.$(".n-details-action")},getDetailsAction:function(e,t){return[]},handleDetailsViewAction:function(e,t){var i=$(e.currentTarget),n=i.hasClass("btnCustomAction");return!!i.hasClass("btnDisabled")||!!n&&(this.customDetailsEventHandler(e,t),!0)},updateActionButtons:function(e,t,i){this.detailsActionView&&this.detailsActionView.updateButtons(e,t,i)},_activateSummary:function(){this._deactivateDetails(),this.tabDetailsView&&(this.tabDetailsView.hasTabSelected()||this.tabDetailsView.selectFirstTab(),this.tabDetailsView.startServices()),this.postActivateSummary()},_deactivateSummary:function(){this.tabDetailsView&&this.tabDetailsView.stopServices(),this.postDeactivateSummary()},postActivateSummary:function(){},postDeactivateSummary:function(){},getDetailsEntityElement:function(e){return 0===this.$(".details-"+e).length&&this.$(".detailsEntityContainer").append(this.detailsEntityTemplate({entity:e})),this.$(".details-"+e)},_activateDetails:function(){this._deactivateSummary(),this.detailsActionView&&this.detailsActionView.hideDetailActionButtons(),this.currentEntityType()&&(this.$(".n-details-content-entity").hide(),this.getDetailsEntityElement(this.currentEntityType()).show(),_.each(this.subViewHelperEntity.getIds(),function(e){e===this.currentEntityType()&&this.subViewHelperEntity.get(e)&&this.currentEntityId()?(this.subViewHelperEntity.get(e).getDataAndRender(this.currentEntityId(),this.currentEntityType(),this.currentClusterUuid()),this.subViewHelperEntity.get(e).startServices()):this.subViewHelperEntity.get(e).stopServices()},this))},_deactivateDetails:function(){this.subViewHelperEntity.iterate("stopServices")},storeToDetailsEntityMap:function(e,t){this.subViewHelperEntity.register(e,t);var i=this;t.on(n.DETAILS_MODEL_UPDATE,function(e,t){i.breadCrumbView.updateTrail(i.getOptionsObject(),e,t),i.updateActionButtons(i.getOptionsObject(),e,t)})},getDetailsEntityView:function(e){return this.subViewHelperEntity.get(e)},stopDetailsEntityViewServices:function(e){var t=this.subViewHelperEntity.get(e);t&&t.onStopServices()},startDetailsEntityViewServices:function(e){var t=this.subViewHelperEntity.get(e);t&&t.onStartServices()},isSkipRefreshModelAction:function(e){return e.actionMode===r.ACTION_DELETE},refreshView:function(e){e&&!this.isSummaryView()&&this.isSkipRefreshModelAction(e)&&e.get(e.idAttribute)===this.currentEntityId()||(this.getDataAndRender(),this.subViewHelperEntity.iterate("refreshView"))},destroy:function(){a.debug("BaseDetailsView : destroy: "," | viewid     : "+this.cid),this.subViewHelperEntity.removeAll(),this.tabDetailsView&&this.tabDetailsView.destroy(),e.prototype.destroy.apply(this,arguments)},onResize:function(){var e=this;clearTimeout(this.resizeTimer),this.resizeTimer=setTimeout(function(){var t=e.$(".n-details-content-holder"),i=e.$(".n-details-content-slider");if(!e.isSummaryView()){var n="-"+$(t).css("width");$(i).css("left",n)}},10)},customDetailsEventHandler:function(e,t){},onStartServices:function(){this.onResize(),$(window).on("resize n-slidedown",this.onResize),this._delegateTooltips(),this.delegateModelEvents(),this.isSummaryView()?this._activateSummary():this._activateDetails()},onStopServices:function(){$(window).off("resize n-slidedown",this.onResize),this._undelegateTooltips(),this.undelegateModelEvents(),this._deactivateDetails(),this._deactivateSummary()}})}),define("text!templates/pages/multicluster/home/details/ClusterTabDetailsView.html",[],function(){return'\x3c!-- TODO: We are still working out which details to display. --\x3e\n\x3c!-- Wrap --\x3e\n<div class="n-unit-wrap">\n  \x3c!-- Fixed unit --\x3e\n  <div class="n-unit-fixed">\n    \x3c!-- Column 1: Summary --\x3e\n    <div class="n-details-unit">\n      <div class="title">CLUSTER SUMMARY</div>\n      <ul class="n-list-info">\n        \x3c!-- Clusters --\x3e\n      </ul>\n    </div>\n  </div>\n  \x3c!-- Fluid unit --\x3e\n  <div class="n-unit-fluid  n-tab-details-unit">\n    \x3c!-- @view: Tab details view goes here... --\x3e\n  </div>\n</div>'}),define("views/basecomponents/details/BaseDetailsEntityView",["views/basecomponents/BaseView","events/AppEvents","utils/AppConstants","utils/AppUtil","utils/CommonTemplates","managers/ClusterManager","data/DataProperties"],function(e,t,i,n,s,a,r){"use strict";var o=_.template('<li>         <div class="n-info-block">            <span class="n-label">Cluster Name</span>           <span class="lblClusterName n-value n-resettable"             title=<%= clustName %>>              \x3c!-- @value: name used goes here... --\x3e             <%= clustName %>            </span>         </div>        </li>');return e.extend({entityType:null,tabDetailsView:null,isEntityWithoutModel:!1,modelEvents:{"change   model":"renderDetails","error    model":"renderError","pending  model":"reset"},initialize:function(t){e.prototype.initialize.apply(this,arguments),this.initializeProperties(t)},initializeProperties:function(e){},getDataAndRender:function(e){if(!e)throw new Error("Provide a modelId to update the details.");if(n.isEntityWithoutModelId(e)){var t=n.getTargetIdFromEntityWithoutModelId(e);return this.isEntityWithoutModel=!0,this.stopModelPolling(),this.renderEntityWithoutModel(t),void(this.tabDetailsView&&this.tabDetailsView.hideContent())}this.model.on("change",this.updateTabView,this),this.isEntityWithoutModel=!1,this.entityType===i.ENTITY_CLUSTER?(this.model=a.getClusterCollection().findModelById(e),this.delegateModelEvents(),this.model&&this.model.triggerUpdate()):this.startModelPolling(e)},updateTabView:function(e){this.model.off("change",this.updateTabView,this);var t=e.getId();this.tabDetailsView&&(this.tabDetailsView.showContent(),this.checkTabsupported(),this.tabDetailsView.setModel(this.model),this.tabDetailsView.setModelId(t),this.tabDetailsView.refreshCurrentTab(),this.tabDetailsView.hasTabSelected()||this.tabDetailsView.selectFirstTab())},checkTabsupported:function(){return!0},renderDetails:function(){var e,t;this.triggerModelUpdate(this.model),this.$(".n-unit-fixed > .n-details-unit .n-error-no-entity").remove(),this.$(".n-list-info").show(),a.isMulticlusterNavMode()&&(e=a.getNameById(this.model.get(r.CLUSTER_UUID)),this.$(".lblClusterName").length?this.$(".lblClusterName").html(e).attr("title",e):(t=o({clustName:e}),this.$(".n-list-info").prepend(t)))},renderError:function(e,t,a){if(e.stateMonitor.getState()!==i.STATE_CANCELED){var r=this.getEntityTypeName(e.entityType);n.log(r+" Not Found, with id "+e.getId()),this.reset(),this.triggerModelUpdate(this.model,{error:i.ERROR_ENTITY_NOT_FOUND});var o=s.DETAILS_NO_ENTITY({entityType:r,entityId:e.getId(),entityIdAttribute:this.getEntityIdAttribute(e.idAttribute)});this.$(".n-list-info").hide(),this.$(".n-unit-fixed > .n-details-unit .n-error-no-entity").remove(),this.$(".n-unit-fixed > .n-details-unit").append(o)}},renderEntityWithoutModel:function(e){this.$(".n-unit-fixed > .n-details-unit .n-error-no-entity").remove(),this.$(".n-list-info").show()},triggerModelUpdate:function(e,i){this.trigger(t.DETAILS_MODEL_UPDATE,e,i)},reset:function(e){(this.model.previous(this.model.idAttribute)!==this.model.getId()||e)&&this.$(".n-resettable").empty()},startModelPolling:function(e){this.entityType!==i.ENTITY_CLUSTER&&(this.model&&void 0!==e&&this.model.get(this.model.idAttribute)!==e&&(this.model.stopFetch(),this.model.clear({silent:!0}),this.model.set(this.model.idAttribute,e,{silent:!0}),this.reset()),this.model.getState()===i.STATE_PENDING||this.isEntityWithoutModel||void 0===this.model.getId()||this.model.startPolling({alwaysTriggerChange:!0,alwaysTriggerPending:!0}))},stopModelPolling:function(){this.model&&this.model.stopPolling()},getEntityTypeName:function(e){return i.ENTITY_NAMES[e]||"Entity"},getEntityIdAttribute:function(e){return e||r.ID},refreshView:function(){!this.isEntityWithoutModel&&this.model&&this.model.getId()?this.getDataAndRender(this.model.getId()):this.isEntityWithoutModel&&this.renderEntityWithoutModel()},destroy:function(){n.debug("BaseDetailsEntityView : destroy: "," | viewid     : "+this.cid),this.tabDetailsView&&this.tabDetailsView.destroy(),e.prototype.destroy.apply(this,arguments)},onStartServices:function(){this.delegateModelEvents(),this.tabDetailsView&&this.tabDetailsView.startServices()},onStopServices:function(){this.undelegateModelEvents(),this.stopModelPolling(),this.tabDetailsView&&this.tabDetailsView.stopServices()}})}),define("text!templates/pages/multicluster/home/details/ClusterTabDetailsEntityView.html",[],function(){
return'\x3c!-- TODO: We are still working out which details to display. --\x3e\n\x3c!-- Wrap --\x3e\n<div class="n-unit-wrap">\n  \x3c!-- Fixed unit --\x3e\n  <div class="n-unit-fixed">\n    \x3c!-- Column 1: Summary --\x3e\n    <div class="n-details-unit">\n      <div class="title">CLUSTER DETAILS</div>\n      <ul class="n-list-info">\n        \x3c!-- Show the most important critical alert message here --\x3e\n        <li class="n-alert-very-important-row" style="display:none">\n          <div class="n-info-block">\n            <div class="n-label">\n              <div class="n-alert-very-important-widget n-resettable">\n                \x3c!-- very important alert icon and message goes here... --\x3e\n              </div>\n            </div>\n          </div>\n        </li>\n        <li>\n          <div class="n-info-block">\n            <span class="n-label">Hypervisor Type</span>\n            <span class="lblHypervisorType n-value n-resettable">\n              \x3c!-- @value: hypervisor goes here... --\x3e\n            </span>\n          </div>\n        </li>\n        <li>\n          <div class="n-info-block">\n            <span class="n-label">Health</span>\n            <span class="lblHealth n-value n-resettable">\n              \x3c!-- @value: hypervisor goes here... --\x3e\n            </span>\n          </div>\n        </li>\n        <li>\n          <div class="n-info-block">\n            <span class="n-label">Number of Hosts</span>\n            <span class="lblHosts n-value n-resettable">\n              \x3c!-- @value: value goes here... --\x3e\n            </span>\n          </div>\n        </li>\n        <li>\n          <div class="n-info-block">\n            <span class="n-label">External Subnet</span>\n            <span class="lblExternalSubnet n-value n-resettable">\n              \x3c!-- @value: value goes here... --\x3e\n            </span>\n          </div>\n        </li>\n        <li>\n          <div class="n-info-block">\n            <span class="n-label">Internal Subnet</span>\n            <span class="lblInternalSubnet n-value n-resettable">\n              \x3c!-- @value: value goes here... --\x3e\n            </span>\n          </div>\n        </li>\n      </ul>\n    </div>\n  </div>\n  \x3c!-- Fluid unit --\x3e\n  <div class="n-unit-fluid  n-tab-details-unit">\n    \x3c!-- @view: Tab details view goes here... --\x3e\n  </div>\n</div>'}),define("views/pages/multicluster/home/details/ClusterTabDetailsEntityView",["views/basecomponents/details/BaseDetailsEntityView","text!templates/pages/multicluster/home/details/ClusterTabDetailsEntityView.html","managers/ClusterManager","data/DataProperties","utils/AppConstants","utils/AlertUtil","utils/CommonTemplates","utils/VisualizationUtil"],function(e,t,i,n,s,a,r,o){"use strict";return e.extend({entityType:s.ENTITY_CLUSTER,selectedESX:!1,modelEvents:{"change    model":"renderDetails","error     model":"renderError","pending   model":"reset"},initializeProperties:function(){this.model=i.getClusterCollection(),this.render()},render:function(){this.$el.html(t);var e={};e[s.TAB_DETAILS.METRICS]="Cluster Performance",e[s.TAB_DETAILS.USAGE]="Cluster Usage",e[s.TAB_DETAILS.ALERTS]="Cluster Alerts",this.clusterManager.isMulticlusterNavMode()?e[s.TAB_DETAILS.CAPACITY]="Cluster Capacity":e[s.TAB_DETAILS.EVENTS]="Cluster Events",this.tabDetailsView=o.renderTabDetailsView(this.$(".n-tab-details-unit"),e,this.entityType,s.PAGE_MC_DASHBOARD)},renderDetails:function(){e.prototype.renderDetails.apply(this,arguments);var t=this.model,i=t.get(n.CLUSTER_HYPERVISORS)||[],a=_.reduce(i,function(e,t){return t?(t=s.HYPERVISOR_LABEL[t],e.length?e+=", "+t:t):e},"");this.$(".lblHypervisorType").html(a),this.$(".lblHealth").html(this.model.getClusterHealthStatus()),this.$(".lblHosts").html(t.get(n.CLUSTER_HOSTS)),this.$(".lblExternalSubnet").html(t.get(n.CLUSTER_EXTERNAL_SUBNET)),this.$(".lblInternalSubnet").html(t.get(n.CLUSTER_INTERNAL_SUBNET)),this.showVeryCriticalAlert()},showVeryCriticalAlert:function(){a.isHostMetadataDetached(this.model.toJSON())?(this.$(".n-alert-very-important-row").show(),this.$(".n-alert-very-important-widget").html(r.IMPORTANT_CRITICAL_ALERT+" "+this.model.get(n.METADATA_STORE_STATUS_MSG))):(this.$(".lblAlertMessage").empty(),this.$(".n-alert-very-important-row").hide())},reset:function(){e.prototype.reset.apply(this,arguments),this.$(".n-alert-very-important-row").hide()}})}),define("views/pages/multicluster/home/details/ClusterTabDetailsView",["views/basecomponents/details/BaseDetailsView","text!templates/pages/multicluster/home/details/ClusterTabDetailsView.html","managers/NavigationManager","managers/ClusterManager","views/pages/multicluster/home/details/ClusterTabDetailsEntityView","data/DataProperties","utils/AppConstants","utils/AppUtil","utils/StatsUtil","utils/VisualizationUtil"],function(e,t,i,n,s,a,r,o,l,c){"use strict";return e.extend({pageId:r.PAGE_MC_DASHBOARD,summaryTemplate:_.template(t),clusterCollection:null,events:{"click  .linkRowItem":"onClickLinkRowItem"},initializeProperties:function(){this.clusterCollection=n.getClusterCollection(),n.attachEventHandler("reset",this.renderClusterDetails,this)},customDetailsEventHandler:function(e,t){if(t&&t.action===r.ACTION_ENABLE_METADATA_STORE){this.getDetailsEntityView(r.ENTITY_CLUSTER).enableMetadataStore(e,t.actionTargetId)}},render:function(){var e={};e[r.TAB_DETAILS.METRICS]="Performance Summary",e[r.TAB_DETAILS.ALERTS]="Cluster Alerts",this.clusterManager.isMulticlusterNavMode()||(e[r.TAB_DETAILS.EVENTS]="Cluster Events"),this.tabDetailsView=c.renderTabDetailsView(this.$(".n-tab-details-unit"),e,r.ENTITY_CLUSTER,this.pageId),this.storeToDetailsEntityMap(r.ENTITY_CLUSTER,new s({el:this.getDetailsEntityElement(r.ENTITY_CLUSTER)}))},getDataAndRender:function(){this.clusterCollection.fetch()},destroy:function(){o.debug("ClusterTabDetailsView : destroy: "," | viewid     : "+this.cid),n.detachEventHandler("reset",this.renderClusterDetails,this),e.prototype.destroy.apply(this,arguments)},renderClusterDetails:function(){this.clusterCollection.toJSON();this.$(".lblNumberClusters").html(this.clusterCollection.getMetaData()?this.clusterCollection.getMetaData()[a.META_TOTAL_ENTITIES]:this.clusterCollection.length);var e=l.aggregate(this.clusterCollection,a.MEM_CAPACITY);this.$(".lblMemory").html(e),this.$(".lblCpuCapacity").html(l.aggregate(this.clusterCollection,a.CPU_CAPACITY,!0,a.CPU_CORES));var t=this.tabDetailsView.getTabContent(r.TAB_DETAILS.METRICS);t&&t.showResource(this.clusterCollection)},onClickLinkRowItem:function(e){i.updateRouteOption(e.currentTarget)}})}),define("views/basecomponents/vantagepoints/VantagePointTemplates",[],function(){"use strict";return{DASHBOARD:_.template('<div id="<%= gridId %>" class="n-dashboard  gridster">             <ul class="n-vantage-grid            <%= isCustomizable ? "customizable" : "" %>">               \x3c!-- Vantage points go here --\x3e             </ul>           </div>'),VANTAGE_POINT_CONTENT:_.template('\n        <div class="n-title">\n          <span class="lblTitle title" title="<%- title %>">\n            <%- title %>\n          </span>\n          <div class="vp-title-options-container vpTitleOptionsContainer">\n            <div class="vp-title-options vpTitleOptions"></div>\n          </div>\n        </div>\n        <div class="n-content">\n          <%= content %>\n        </div>'),VANTAGE_POINT_CONTENT_TOOL_TIP:_.template('<div class="n-title">             <span class="lblTitle title" title="<%- i18n(model.name) %>">              <%- i18n(model.name) %>            </span>           </div>           <div class="n-content">             <%= content %>           </div>'),VANTAGE_POINT_TITLE_COUNT:_.template('<span class="n-title lblTitle">            <%= (count > 0 ? "" : "No ") + title %>           </span>           <% if (count > 0) { %>             <div class="n-count"><%= count %></div>           <% } %>'),VANTAGE_POINT_WIDGET:'<li class="n-vantage-point-holder">           </li>',TITLE:_.template('<div class="n-title" title="<%= title %> ">             <%= title %>           </div>'),TITLE_WITH_COUNT:_.template('<%= (count || "0") + " " + name %>'),ERROR:_.template('<div class="n-error-wrapper">           <div class="n-error">             <i class="n-icon n-vantage-point-error-icon"></i>             <%= errorMessage %>             <% if (typeof errorDetails !== "undefined") { %>                <a title="<%= errorDetails %>" class="n-error-details"                 tooltip="<%= errorDetails %>" >                 <%= errorSubtitle || "Show me why" %>               </a>             <% } %>           </div>          </div>'),LOADING:'<div class="n-loading">             Loading...          </div>',EMPTY_VANTAGE_POINT_CONTENT:'<div class="vp-no-data">          <%= i18n("no_data_available", "No data available") %>         </div>',VANTAGE_POINT_CUSTOM_EMPTY_MSG:'<div class="vp-no-data"><%= msg %></div>',CLUSTER_UNREGISTERED_CONTENT:'<div class="vp-no-data"><%= msg %></div>'}}),define("views/basecomponents/actionmenu/ActionMenuView",["views/basecomponents/BaseView","managers/AccessManager","utils/AppConstants"],function(e,t,i){"use strict";var n=_.template('<%= Components.icon("caret-down", "-down-arrow -inline") %>          <ul class="n-list-options">            <% _.each( actionMenuList, function(option) { %>              <li class="n-action-menu-option"                  actionTarget="<%= option.actionTarget %>">                <%= option.label %>             </li>            <% }); %>          </ul>');return e.extend({className:"n-action-menu",name:"ActionMenuView",actionList:null,actionCallBacks:null,events:{"click  .n-action-menu-option":"onClickActionMenuOption"},actionsAccessMap:null,initialize:function(e){var t=this;if(!e.parentEl)throw new Error("options.parentEl should not be empty.");if(!e.actionList||0===e.actionList.length)throw new Error("options.actionList should not be empty.");this.actionList=_.filter(e.actionList,function(e){return t.hasAccessToAction(e)}),this.actionCallBacks={},this.render(e.parentEl,e.position)},getActionAccessMap:function(){if(_.isEmpty(this.actionsAccessMap)){var e=i.ACTION_MENU;this.actionsAccessMap=_defineProperty({},e.CHART_REDIRECT,t.hasAccessV1())}return this.actionsAccessMap},hasAccessToAction:function(e){var t=this.getActionAccessMap()||{},i=t[e];return!_.isBoolean(i)||!0===i},render:function(e,t){if(!_.isEmpty(this.actionList)){var i=[];_.each(this.actionList,function(e){i.push({actionTarget:e,label:this.i18n(e)})},this),this.$el.html(n(this.vtOptions({actionMenuList:i}))),t=t||"right",this.$el.addClass("position-"+t),$(e).addClass("n-action-enabled position-"+t),$(e).append(this.$el)}},onClickActionMenuOption:function(e){var t=$(e.currentTarget).attr(i.NAV_ACTION_TARGET);this.actionCallBacks&&_.isFunction(this.actionCallBacks[t])&&this.actionCallBacks[t]()},registerActionCallback:function(e,t,i){this.actionCallBacks[e]=_.bind(t,i)}})}),define("views/basecomponents/vantagepoints/elements/BaseVantagePointView",["views/basecomponents/BaseView","views/basecomponents/actionmenu/ActionMenuView","views/basecomponents/vantagepoints/VantagePointLayoutDescriptor","utils/AppConstants","utils/AppUtil","utils/AntiscrollUtil","utils/VisualizationUtil","utils/FilterUtil","data/DataProperties","data/DataURLConstants","managers/ActionManager","managers/TaskManager","views/basecomponents/vantagepoints/VantagePointTemplates","utils/CommonTemplates","utils/SVG"],function(e,t,i,n,s,a,r,o,l,c,u,d,h,p,T){"use strict";var E=_.template('<span class="n-widget-close"stream-action="Dashboards: CloseWidget" stream-target="<%= name %>" >'+T.SVGIcon("v","btnVantagePointClose")+"</span>"),S=_.template(h.EMPTY_VANTAGE_POINT_CONTENT),g=_.template(h.CLUSTER_UNREGISTERED_CONTENT),A=_.template(h.VANTAGE_POINT_CUSTOM_EMPTY_MSG),m="BaseVantagePointView";return e.extend({className:"n-vantage-point",name:m,vantagePointCSS:null,gridId:null,_dataModelsMap:null,subView:null,enableColumn:!1,numberOfColumns:1,isCustomizable:!1,isPreviewMode:!1,enableAntiscroll:!0,_isSuccessCalled:!1,sizeMap:null,_resizeCallBack:null,actionMenuView:null,isEmptyContent:!1,events:{click:"onClick","click  .n-link-action":"onClickAction"},initialize:function(t){e.prototype.initialize.apply(this,arguments),this.isCustomizable=t.customizable||!1,"function"==typeof this.model.get(l.NAME)&&this.model.set(l.NAME,this.model.get(l.NAME)()),"function"==typeof this.getAspectsValue(n.VP_ASPECT_METRIC)&&this.setAspectsValue(n.VP_ASPECT_METRIC,this.getAspectsValue(n.VP_ASPECT_METRIC)()),this.initializeVantagePoint(),this._delegateModelEvents(),this.updateStyle(),this.vantagePointCSS&&this.$el.addClass(this.vantagePointCSS),this.enableColumn&&(this.enableAntiscroll=!1),this.updateTemplate(),this.updateDataModels(),this.updateSubView()},render:function(){return this.$el.html(h.LOADING),this._dataModelsMap||this._renderView(),this},_renderView:function(){var e=$(this.template||this.getDefaultTemplate());this.enableColumn&&!e.closest(".n-content").children().length&&e.closest(".n-content").html(r.renderColumnContent(this.numberOfColumns)).end(),this.$el.html(e),this.isCustomizable&&this.$(".n-title").append(E({name:_.escape(this.model.getName())})),this.titleOptions&&this.updateTitleOptions(),this.isEmptyContent?this.renderEmptyContent():this._isUnregisteredCluster()?this.renderClusterUnregisterContent():(this.renderVantagePoint(),this.subView&&(this.subView.updateColumnContent=_.bind(this.updateColumnContent,this.subView),this.$(".n-content-inner").length?this.$(".n-content-inner").html(this.subView.render().el):this.$(".n-content").length&&this.$(".n-content").html(this.subView.render().el)),this.enableAntiscroll&&this.applyAntiScroll(),this.createActionMenu())},createActionMenu:function(){var e=this.model.get(l.VP_ACTIONS);e&&e.length&&(this.actionMenuView=new t({parentEl:this.$el,actionList:e,position:"left"}),this.registerActionMenuCallbacks())},registerActionMenuCallbacks:function(){},_delegateModelEvents:function(){this._undelegateModelEvents(),this.model.on("change:size",this._onChangeSize,this)},_undelegateModelEvents:function(){this.model.off("change:size")},getSize:function(){return this.model.get(l.VP_SIZE)},getAspectsValue:function(e){return this.model.get(l.VP_ASPECTS)?this.model.get(l.VP_ASPECTS)[e]:null},getClusterUuid:function(){return this.model.getClusterUuid()},getClusterId:function(){return this.model.get(l.CLUSTER_ID)},isMulticlusterNavMode:function(){return this.clusterManager.isMulticlusterNavMode()},isInPreviewMode:function(){return this.isPreviewMode},setPreviewMode:function(e){this.isPreviewMode=e},setAspectsValue:function(e,t){this.model.get(l.VP_ASPECTS)&&(this.model.get(l.VP_ASPECTS)[e]=t)},getDefaultTemplate:function(){var e=this.model.toJSON(),t=e.name,i=this.i18n(t)||t;return h.VANTAGE_POINT_CONTENT({model:e,title:i,content:this.enableAntiscroll?p.ANTISCROLL:"",SVG:T,customizable:this.isCustomizable})},getEmptyContentTemplate:function(){return S(this.vtOptions())},getClusterUnregisterTemplate:function(){return g(this.vtOptions({msg:this.i18nStatic("BaseVantagePointView","pc_unregistered_msg")}))},initializeVantagePoint:function(){},renderVantagePoint:function(){},updateStyle:function(){},updateTemplate:function(){},updateDataModels:function(){},updateSubView:function(){},updateTitle:function(e){if(!e){var t=this.model.get(l.NAME);e=this.i18n(t,t)}this.$(".n-title .lblTitle").html(e)},updateTitleOptions:function(){},registerDataModel:function(e,t,i,a,r,c){if(!this._isUnregisteredCluster()){var u,d=this;if(this._dataModelsMap=this._dataModelsMap||{},i=i||this.renderSuccess,a=a||this.renderError,_.isObject(e)&&t){if(u={success:function(e,n,s){d._isSuccessCalled||d._renderView(),d.containsEmptyContent(e)?d.renderEmptyContent():i.call(t,e,n,s),d._isSuccessCalled=!0},error:function(e,i,n){var r;d.clusterManager.isMulticlusterNavMode()&&(e.get(l.CLUSTER_UUID)||e.get(l.ENTITY_ID))&&(r=e.get(l.CLUSTER_UUID)?e.get(l.CLUSTER_UUID):s.getClusterUuid(e.get(l.ENTITY_ID))),r&&!d.clusterManager.isClusterRegistered(r)?(d._renderView(),d.renderClusterUnregisterContent(),d._isSuccessCalled=!1):a.call(t,e,i,n)}},c&&_.extend(u,c),r&&e.setIntervalTime&&r!==n.NO_INTERVAL&&!this.sharedCollection&&e.setIntervalTime(r),this.getClusterUuid()){var h=o.getEqualsFIQL(l.FILTER_CLUSTER_UUID,this.getClusterUuid());e.setFilterCriteria(h)}this._dataModelsMap[e.cid]={model:e,options:u,interval:r}}else s.log("BaseVantagePointView: registerDataModel: Issue registering handlers for vantage point: "+this.model.get(this.model.nameAttribute))}},_startDataModelServices:function(){_.each(_.values(this._dataModelsMap),function(e){if(!e.model.name||-1===e.model.name.indexOf("Model")&&-1===e.model.name.indexOf("Collection"))return void s.log("BaseVantagePointView: _startDataModelServices:  Issue delegating handler for vantage point "+this.model.get(this.model.nameAttribute)+". Invalid name property - skipping.");var t={data:e.options.data};this.sharedCollection&&e.model.url===c.TASK?d.registerHandlerResetStructure(e.options.success,this):(t.error=e.options.error,-1!==e.model.name.indexOf("Model")?e.model.on("change",e.options.success,this):e.model.on("reset",e.options.success,this)),this.sharedCollection?e.options.success&&e.options.success(e.model):e.interval!==n.NO_INTERVAL&&e.model.startPolling?e.model.startPolling(t):e.model.fetch(t)},this)},_stopDataModelServices:function(){_.each(_.values(this._dataModelsMap),function(e){if(!e.model.name||-1===e.model.name.indexOf("Model")&&-1===e.model.name.indexOf("Collection"))return void s.log("BaseVantagePointView: _stopDataModelServices:  Issue undelegating handler for vantage point "+this.model.get(this.model.nameAttribute)+". Invalid name property - skipping.");this.sharedCollection&&e.model.url===c.TASK?d.unregisterHandlerResetStructure(e.options.success,this):(e.model.off("error",e.options.error,this),e.model.name&&-1!==e.model.name.indexOf("Model")?e.model.off("change",e.options.success,this):e.model.off("reset",e.options.success,this)),this.sharedCollection||(e.interval!==n.NO_INTERVAL&&e.model.stopPolling?e.model.stopPolling():e.model.stopFetch())},this)},_isUnregisteredCluster:function(){if(!this.isMulticlusterNavMode())return!1;var e=this.model.get("clusterUuid");return e&&!this.clusterManager.isClusterRegistered(e)},fetchOnDemand:function(e){var t;this._dataModelsMap&&this._dataModelsMap[e]&&(t=this._dataModelsMap[e].model,t.fetch(this._dataModelsMap[e].options))},refreshDataModels:function(){this._dataModelsMap&&_.each(_.keys(this._dataModelsMap),function(e){this.fetchOnDemand(e)},this)},_startSubViewServices:function(){this.subView&&(this.subView.startServices(),this.subView.on("onantiscroll",this.applyAntiScroll,this))},_stopSubViewServices:function(){this.subView&&(this.subView.stopServices(),this.subView.off("onantiscroll"))},onClick:function(){},onClickAction:function(e){u.executeActionElement(e.currentTarget)},_onChangeSize:function(){_.isFunction(this._resizeCallBack)&&this._resizeCallBack()},renderSuccess:function(e,t,i){},renderError:function(e,t,i){if(!this._isSuccessCalled&&e.stateMonitor.getState()!==n.STATE_CANCELED){var a=this.model.get("name");this.$el.html(h.TITLE({title:this.i18n(a)||a})),this.isCustomizable&&this.$(".n-title").append(E({name:_.escape(this.model.getName())}));var r="";r=s.isConnectionError(t)?"Unable to connect to the server.":s.isHttp404Error(t)?"Requested resource not available":(s.processAjaxError(t.responseText)||"").replace(/(<([^>]+)>)/gi,""),this.$el.append(h.ERROR({errorMessage:this.i18n("error_occurred"),errorDetails:r,errorSubtitle:this.i18n("show_why")})),this.$(".n-error-details").tooltip({placement:"top",trigger:"hover",html:!0})}},renderClusterUnregisterContent:function(){this.$(".n-content").html(this.getClusterUnregisterTemplate())},renderEmptyContent:function(){this.$(".n-content").html(_.template(this.getEmptyContentTemplate())(this.vtOptions()))},renderOnlySupportedInPrismPro:function(){this.renderUnsupportedMessage(this.i18nStatic(m,"onlyAvailableinPrismPro"))},renderUnsupportedMessage:function(e){this.$(".n-content").html(A(this.vtOptions({msg:e})))},renderResize:function(e,t){if(_.isEmpty(this.sizeMap))throw new Error("sizeMap should not be empty");if(!_.isFunction(t))throw new Error("renderCallBack should be a function and not empty");this._resizeCallBack||(this._resizeCallBack=t);var i=this.getSize();_.each(_.keys(this.sizeMap),function(t){Number(t)<=e&&(i=this.sizeMap[t])},this),i!==this.getSize()?this.trigger("changesize",i,this):t.call(this)},onResize:function(){var e=this;clearTimeout(this.resizeTimer),this.resizeTimer=setTimeout(function(){e.applyAntiScroll()},250)},containsEmptyContent:function(e){return!this.sharedCollection&&e&&e.isEmpty&&e.isEmpty()},isSizeSmall:function(){return this.getSize()===i.SIZE_SMALL},isSizeMedium:function(){return this.getSize()===i.SIZE_MEDIUM},isSizeLarge:function(){return this.getSize()===i.SIZE_LARGE},isSizeExtraLarge:function(){return this.getSize()===i.SIZE_XLARGE},isSizeDoubleExtraLarge:function(){return this.getSize()===i.SIZE_XXLARGE},onStartServices:function(){this.delegateEvents(),this._delegateModelEvents(),this._startDataModelServices(),this._startSubViewServices(),this.postStartServies()},onStopServices:function(){this.undelegateEvents(),this._undelegateModelEvents(),this._stopDataModelServices(),this._stopSubViewServices(),this.postStopServies()},postStartServies:function(){},postStopServies:function(){},applyAntiScroll:function(){if(this.$(".antiscroll-wrap"))if(this._resizeCallBack){var e=this;setTimeout(function(){a.applyAntiScroll(e.$(".antiscroll-wrap"),null,null,{ntnxClearWidth:!0})},50)}else a.applyAntiScroll(this.$(".antiscroll-wrap"),null,null,{ntnxClearWidth:!0})},refreshView:function(){this.refreshDataModels()},destroy:function(){this.actionMenuView&&(this.actionMenuView.destroy(),this.actionMenuView=null),this.subView&&(this.subView.destroy(),this.subView=null),this.$(".n-error-details").tooltip("destroy"),e.prototype.destroy.apply(this,arguments),this._dataModelsMap=null},updateColumnContent:function(e,t,i){r.updateColumnContent(this.$el,i,e,t)},getSharedCollectionByURL:function(e){return e===c.CLUSTERS?this.clusterManager.getClusterCollection():e===c.TASK?d.getGlobalTasks():void 0},getSharedCollectionByType:function(e){return e===n.ENTITY_CLUSTER?this.clusterManager.getClusterCollection():e===n.ENTITY_TASK?d.getGlobalTasks():void 0}})}),define("text!templates/basecomponents/vantagepoints/elements/metric/UsageSmallView.html",[],function(){return'<div class="n-vantage-point-metric-small">\n  <div class="n-title">\n    <span class="lblTitle"><%- model.name %></span>\n  </div>\n  <div class="n-content">\n    <div>\n      <h4>\n        <span class="lblPercentFree">...</span> Free\n      </h4>\n    </div>\n    <div>\n      <span class="lblUsed">0</span> used of\n      <span class="lblCapacity">0TB</span>\n    </div>\n  </div>\n</div>'}),define("text!templates/basecomponents/vantagepoints/elements/metric/UsageMediumView.html",[],function(){return'<div class="n-vantage-point-metric-medium">\n  <div class="n-title">\n    <span class="lblTitle"><%- model.name %></span>\n  </div>\n  <div class="n-content">\n    <div>\n      <h4>\n        <span class="lblPercentFree">...</span> Free\n      </h4>\n    </div>\n    <div>\n      <span class="lblUsed">...</span> used of\n      <span class="lblCapacity">...</span>\n    </div>\n  </div>\n</div>'}),define("models/storage/StoragePoolModel",["models/BaseModel","models/PollingModel","data/DataURLConstants","data/DataProperties","utils/AppConstants","utils/StatsUtil"],function(e,t,i,n,s,a){"use strict";return t.extend({urlRoot:i.STORAGEPOOL,entityType:s.ENTITY_STORAGE_POOL,name:"StoragePoolModel",hasArithmosStats:!0,defaults:{id:null,name:"",disks:[]},initialize:function(e,i){t.prototype.initialize.apply(this,arguments),this.hasArithmosStats=this.clusterManager.isClusterFFEnabled(s.FFLAGS.ARITHMOS_USAGE_STATS)},getURL:function(e){return"update"===e?this.urlRoot+"?"+n.SP_FORCE+"=true":"create"===e?this.url()+"?"+n.SP_FORCE+"=true":this.url()},getValue:function(t){var i;switch(t){case n.USAGE_STATS+"."+n.NEW_TOT_CAPACITY:case n.CAPACITY:i=this.getTotalCapacity();break;case n.USAGE_STATS+"."+n.NEW_TOT_USED_PHY:case n.TOT_USED_PHY:i=this.getUsedPhysical();break;case n.USAGE_STATS+"."+n.NEW_FREE_BYTES_PHYSICAL:case n.FREE_CAPACITY:i=this.getFreeCapacity();break;case n.SP_NUM_DISKS:i=this.getDiskCount();break;default:i=e.prototype.getValue.apply(this,arguments)}return i},toJSON:function(t){var i=e.prototype.toJSON.apply(this,arguments);return t&&t.includeCustomAttributes&&(i[n.TOT_USED_PHY]=this.getUsedPhysical(),i[n.FREE_CAPACITY]=this.getFreeCapacity(),i[n.CAPACITY]=this.getTotalCapacity()),i},validate:function(e){var t="";if(0===$.trim(e.name).length&&(t+=this.i18n("error_no_sp_name")),$.trim(t).length>0)return t},getUsedPhysical:function(){return this.hasArithmosStats?a.getUsageStats(this,n.NEW_TOT_USED_PHY):a.getUsageStats(this,n.TOT_USED_PHY)},getTotalCapacity:function(){return this.hasArithmosStats?a.getUsageStats(this,n.NEW_TOT_CAPACITY):a.getUsageStats(this,n.TOT_CAPACITY)},getFreeCapacity:function(){return this.hasArithmosStats?a.getUsageStats(this,n.NEW_FREE_BYTES_PHYSICAL):this.get(n.CAPACITY)-this.get(n.USED_CAPACITY)},getFreeUnreservedCapacity:function(){return this.hasArithmosStats?a.getUsageStats(this,n.NEW_FREE_UNRESERVED_CAPACITY):this.get(n.FREE_UNRESERVED_CAPACITY)},getDiskCount:function(){return this.get(n.DISKS)?this.get(n.DISKS).length:0},getPerTierStats:function(){return this.hasArithmosStats?a.formulatePerTierStats(this.get(n.USAGE_STATS)):a.formulatePerTierStatsOld(this.get(n.USAGE_STATS))},hasNewStorageStats:function(){return this.clusterManager.doesClusterHaveNewStorageStats(this)},hasStatsAggregatorCleanup:function(){return this.clusterManager.hasStatsAggregatorUsageCleanup(this)},getRealUsed:function(){if(this.hasNewStorageStats())return a.getUsageStats(this,n.NEW_REAL_USED_PHYSICAL);if(this.hasStatsAggregatorCleanup())return a.getUsageStats(this,n.SA_REAL_USED_PHYSICAL);throw new Error("Stats not supported.")},getReservedButNotUsed:function(){if(this.hasNewStorageStats())return a.getUsageStats(this,n.NEW_FREE_RESERVED_BYTES_PHYSICAL);if(this.hasStatsAggregatorCleanup())return a.getUsageStats(this,n.SA_FREE_RESERVED_CAPACITY_PHYSICAL);throw new Error("Stats not supported.")},getThickProvisionedNotUsed:function(){if(this.hasNewStorageStats())return a.getUsageStats(this,n.NEW_CONTAINER_RESERVED_FREE_BYTES);if(this.hasStatsAggregatorCleanup())return s.STATS_NOT_AVAILABLE;throw new Error("Stats not supported.")},getImplicitReservedButNotUsed:function(){if(this.hasNewStorageStats())return a.getUsageStats(this,n.NEW_CONTAINER_RESERVED_FREE_BYTES);if(this.hasStatsAggregatorCleanup())return a.getUsageStats(this,n.SA_FREE_IMPLICIT_RESERVED_BYTES_PHYSICAL);throw new Error("Stats not supported.")}})}),define("models/storage/StoragePoolCollection",["models/PollingCollection","models/storage/StoragePoolModel","data/DataURLConstants","data/DataProperties"],function(e,t,i,n){"use strict";var s=e.extend({model:t,url:i.STORAGEPOOL,name:"StoragePoolCollection",getTotalUsedPhysical:function(){var e=0;if(this.models)for(var t=0;t<this.models.length;t++)e+=this.models[t].getUsedPhysical()?this.models[t].getUsedPhysical():0;return e},getTotalMaxCapacity:function(){var e=0;if(this.models)for(var t=0;t<this.models.length;t++)e+=this.models[t].getTotalCapacity()?this.models[t].getTotalCapacity():0;return e},getUnusedModels:function(){return _.filter(this.models,function(e){return 0===e.getUsedPhysical()})},getUsedModels:function(){return _.filter(this.models,function(e){return e.getUsedPhysical()>0})},filterCollection:function(e){var t=this.filter(e),i=new s(t);return _.each(i.models,function(e){e.collection=i}),i},getPerTierStats:function(){var e=null;return _.each(this.models,function(t,i){var s=t.getPerTierStats();e=e||{};for(var a in s)e[a]||(e[a]={},e[a][n.TIER_USED_BYTES]=0,e[a][n.TIER_CAPACITY_BYTES]=0),e[a][n.TIER_USED_BYTES]+=s[a][n.TIER_USED_BYTES],e[a][n.TIER_CAPACITY_BYTES]+=s[a][n.TIER_USED_BYTES]}),e},comparator:function(e,t){return e.getUsedPhysical>t.getUsedPhysical()?-1:t.getUsedPhysical()>e.getUsedPhysical()?1:0}});return s}),define("views/basecomponents/vantagepoints/elements/metric/UsageVantagePointView",["views/basecomponents/vantagepoints/elements/BaseVantagePointView","views/basecomponents/vantagepoints/VantagePointLayoutDescriptor","text!templates/basecomponents/vantagepoints/elements/metric/UsageSmallView.html","text!templates/basecomponents/vantagepoints/elements/metric/UsageMediumView.html","models/storage/StoragePoolCollection","utils/AppConstants","utils/StatsUtil","utils/SVG"],function(e,t,i,n,s,a,r,o){"use strict";return e.extend({vantagePointCSS:"n-vantage-point-metric",updateStyle:function(){var e=this.getAspectsValue(a.VP_ASPECT_METRIC);this.vantagePointCSS+=" "+this.vantagePointCSS+"-"+e},updateTemplate:function(){switch(this.getSize()){case t.SIZE_SMALL:this.template=_.template(i,{model:this.model.toJSON(),SVG:o,customizable:this.isCustomizable});break;default:this.template=_.template(n,{model:this.model.toJSON(),SVG:o,customizable:this.isCustomizable})}},updateDataModels:function(){switch(this.getAspectsValue(a.VP_ASPECT_ENTITY)){case a.ENTITY_CLUSTER:this.registerDataModel(new s,this,this.renderSuccess,this.renderError,3e4)}},renderSuccess:function(e){var t=0,i=0,n=0,s=0;switch(this.getAspectsValue(a.VP_ASPECT_ENTITY)){case a.ENTITY_CLUSTER:t=e.getTotalMaxCapacity(),i=e.getTotalUsedPhysical(),n=t-i,s=r.round(n/t*100)}this.$(".lblPercentFree").html(s+"%"),this.$(".lblUsed").html(r.storageFormat(i)),this.$(".lblCapacity").html(r.storageFormat(t))}})}),define("views/basecomponents/charts/BaseChartMixin",["utils/AppConstants","utils/StatsUtil"],function(e,t){"use strict";return{chartDataMaxY:0,chartDataMinY:0,chartDataMaxYdisplay:0,autoscaleMargin:.2,DEFAULT_MAX_Y:100,DEFAULT_MIN_Y:0,initializeStatsProperties:function(e){},updateChartData:function(e){},renderChart:function(){},getMetricId:function(){return this.options.metricId||t.getStatsProperty(this.options.metricType,this.options.entityType,!0)},showNoData:function(){},xAxisTickFormatter:function(e){},yAxisTickFormatter:function(e){},getAutoScaleMargin:function(){return this.autoscaleMargin},getMax:function(){return this.chartDataMaxY},getMin:function(){return this.chartDataMinY},getMaxDisplay:function(){return this.chartDataMaxYdisplay},getMaxDisplayLabel:function(){return t.formatStatsChartYAxis(this.getMetricId(),this.getMaxDisplay()||this.getMax(),!0)},getMetricTypeUnit:function(){},updateChartOptions:function(){},setAppropriateMax:function(){var i=this.chartDataMaxY,n=1+this.getAutoScaleMargin(),s=Math.ceil(i*n);this.getMetricTypeUnit()===e.UNITS.PPM||t.isPPMStats(this.options.metricType)?i=this.getMaxPPM(i,s):this.getMetricTypeUnit()===e.UNITS.BYTES||t.isStorageStats(this.options.metricType)?i=this.getStorageMax(i,s):t.isBandwidthStats(this.options.metricType)?i=this.getBandwidthMax(i,s):this.getMetricTypeUnit()===e.UNITS.USECS||t.isLatencyStats(this.options.metricType)?i=this.getLatencyMax(i,s):this.getMetricTypeUnit()===e.UNITS.IOPS||t.isIOPSStats(this.options.metricType)?i=this.getIOPSMax(i,s):this.chartDataMaxY<=this.DEFAULT_MAX_Y&&(i=this.DEFAULT_MAX_Y),this.chartDataMaxY=i},getMaxPPM:function(e,t){return e=t>=1e6?1e6:Math.max(1e6*Math.ceil(t/1e6),1e6),this.chartDataMaxYdisplay=e,e},getStorageMax:function(e,i){var n=10*t.STORAGE_BINARY_UOM.TiB;return 0===this.chartDataMaxY?n:i},getBandwidthMax:function(e,t){return 0===this.chartDataMaxY?1e5:t},getLatencyMax:function(e,t){return 0===this.chartDataMaxY?1e3:t},getIOPSMax:function(e,t){return 0===this.chartDataMaxY?100:t},getTimeRangeMin:function(){return this.model.get("startTime")||parseInt(this.model.get("interval_start_ms"),10)},getTimeRangeMax:function(){
return this.model.get("endTime")||parseInt(this.model.get("interval_end_ms"),10)},_checkMetricsData:function(e,t){var i=!0;if(_.isArray(t))_.each(t,function(t){var n=e.getStats(t);i=i&&n&&0!==n.length});else{var n=e.getStats(t);i=n&&0!==n.length}return i}}}),define("views/basecomponents/charts/BaseChartView",["views/basecomponents/BaseView","views/basecomponents/charts/BaseChartMixin","utils/AppConstants","utils/AppUtil","utils/StatsUtil","utils/TimeUtil","utils/DataExportUtil"],function(e,t,i,n,s,a,r){"use strict";return e.extend(_.extend({},t,{_uniqueDOMId:null,graph:null,graphData:null,title:"",entityType:null,entityId:null,chartHeight:null,resizeTimer:null,useFill:!0,isStorageStats:!1,className:"n-chart",mainColor:["#dedede","#dedede"],events:{"click  .exportOption":"onExport"},initialize:function(t){e.prototype.initialize.apply(this,arguments),t.entityType&&(this.entityType=t.entityType),t.entityId&&(this.entityId=t.entityId),t.chartHeight&&(this.chartHeight=t.chartHeight),this.initializeStatsProperties(t),_.bindAll(this,"onResize","preProcessTooltipData","toolTipTrackFormatter")},getChartContainer:function(){return this._uniqueDOMId||(this._uniqueDOMId="chartId"+this.cid+(new Date).getTime(),this.$el.find(".chartBody").attr("id",this._uniqueDOMId)),document.getElementById(this._uniqueDOMId)},showNoData:function(){this.getDOM(".loading").hide(),this.getDOM(".noDataBody").show(),this.getDOM(".chartBody").hide(),this.getDOM(".chartValue").hide(),this.getDOM(".download-data").hide()},showChart:function(){this.getDOM(".loading").hide(),this.getDOM(".noDataBody").hide(),this.getDOM(".chartBody").show().css("opacity",1),this.getDOM(".chartValue").show(),this.getDOM(".download-data").show()},showLoading:function(){this.getDOM(".loading").show(),this.getDOM(".noDataBody").hide(),this.getDOM(".chartBody").show().css("opacity",.4),this.getDOM(".chartValue").show()},showMaxYaxisValue:function(){if(0===this.$(".flotr-labels > div.flotr-grid-label-y").length){var e=$("<div></div>").addClass("flotr-grid-label-y").html(this.getMaxDisplayLabel());this.$(".flotr-labels").append($(e))}this.$(".flotr-labels > div.flotr-grid-label-y:last").css("top","0px")},toolTipTrackFormatter:function(e){var t,n,r=e.x,o=e.y,l=new Date;return(this.getMetricTypeUnit()===i.UNITS.BYTES||s.isStorageStats(this.options.metricType))&&(o=s.processStorageStats(o,!0,!1)),l.setTime(r),t=s.statsFormat(this.options.metricType,o),n=a.formatLongTime(l)+" ("+a.formatDateOnly(l)+")",t+" <br /> "+n},hasFill:function(){return this.useFill},getTicks:function(){return[[this.getMin(),""],[this.getMax(),this.getMaxDisplayLabel()]]},updateChartOptions:function(){if(!this.graphData)return void n.log("Chart data should be not be empty");var e;this.chartDataMaxY=0,this.chartDataMinY=0,this.useFill=!0,this.isStorageStats=this.getMetricTypeUnit()===i.UNITS.BYTES||s.isStorageStats(this.options.metricType);for(var t=0;t<this.graphData.length;t++)e=this.graphData[t],this.isStorageStats&&(e[1]=s.processStorageStats(e[1],!1)),null!==e[1]&&e[1]!==i.STATS_NO_VALUE&&(e[1]>this.chartDataMaxY&&(this.chartDataMaxY=e[1]),e[1]<this.chartDataMinY&&(this.chartDataMinY=Math.max(0,e[1])));this.chartDataMaxYdisplay=this.isStorageStats?s.processStorageStats(this.chartDataMaxY,!0):this.chartDataMaxY,this.setAppropriateMax()},getExportOptions:function(){var e;return e=[{action:"csv",text:"Export Chart Data (CSV)..."},{action:"json",text:"Export Chart Data (JSON)..."}],_.map(e,function(e){return{attributes:i.NAV_ACTION+'="'+e.action+'"',name:e.text,class:"exportOption "+e.action}})},onExport:function(e){e.preventDefault();var t=$(e.currentTarget),i=r.getWinRef();t.hasClass("csv")?r.exportChartCSV(this.exportData,this.exportMetric,i):t.hasClass("json")&&r.exportChartJSON(this.exportData,this.exportMetric,i)},isValidForChartUpdate:function(e){var t=!0;return this.model&&e&&e.cid===this.model.cid?this.hasData()&&e.previous&&e.previous("entityId")===e.get("entityId")&&e.previous("entityType")===e.get("entityType")&&!this._checkMetricsData(e,this.getMetricId())&&(t=!1):this.model&&e&&this.hasData()&&this.model.get("entityId")===e.get("entityId")&&this.model.get("entityType")===e.get("entityType")&&!this._checkMetricsData(e,this.getMetricId())&&(t=!1),t||n.debug("Arithmos master restarted as new data is empty.  entityId: "+this.model.get("entityId")+" | entityType: "+this.model.get("entityType")),t},hasData:function(){return this.graphData&&this.graphData.length>0},processData:function(){var e=[];return _.each(this.graphData,function(t){if(null===t[1])return void e.push([t[0],0]);e.push(t)},this),_.isEmpty(e)&&(e=this.graphData),e},destroy:function(){this.graph&&(this.graph.destroy&&this.graph.destroy(),this.graph=null),e.prototype.destroy.apply(this,arguments)},onResize:function(){var e=this;clearTimeout(this.resizeTimer),this.resizeTimer=setTimeout(function(){this.$(".chartBody").is(":visible")&&e.renderChart()},300)},mouseTrackOverride:function(e,t,i,n,s){var a=e.relX,r=(e.relY,e.mouse.margin),o=t.left,l=(t.right,t.bottom,t.top,Number((i.style.left||"").replace("px",""))),c=Number((i.style.right||"").replace("px","")),u=$(i).width(),d=a-u-30<0;!isNaN(c)&&d?(i.style.right="auto",i.style.left=r+o+e.xaxis.d2p(e.x)+"px"):!isNaN(l)&&d&&(i.style.right=r-o-e.xaxis.d2p(e.x)+s+"px",i.style.left="auto")},preProcessTooltipData:function(e){var t=e.index;return null===this.graphData[t][1]?{x:e.x,y:i.STATS_NOT_AVAILABLE}:null},onStartServices:function(){$(window).on("resize.app",this.onResize)},onStopServices:function(){$(window).off("resize.app",this.onResize)}}))}),define("views/basecomponents/charts/ChartTemplates",[],function(){"use strict";return{SIMPLE_TIMELINE:_.template('<div class="n-chart-header">            <span class="n-chart-metric-title">             <%= title %>            </span>            <div class="chartValue  pull-right">               <div class="n-chart-value">               <span><%= i18n("peak") %>:</span>                <span class="lblmaxValue"></span>&nbsp;                <span> <%= i18n("current") %>:</span>                <span class="lblValue"></span>                <span class="lblResource"></span>              </div>            </div>           </div>          <div class="chartBody  n-chart-body                      n-chart-type-timeline"               style="<%= chartHeight ? "height:"+chartHeight+"px" : "" %>">          </div>          <div class="noDataBody n-chart-body"            style="display: none;">            <div class="n-chart-no-data">              No data available            </div>          </div>         <div class="loading  n-loading">Loading...</div>'),TIERWISE:_.template('<div class="n-chart-header">            <span class="n-chart-metric-title">             <%= title %>            </span>            <div class="pull-right">               <span class="lblValue  n-chart-value">              </span>             </div>           </div>          <div class="chartBody  n-chart-body                      n-chart-type-tierwise">          </div>          <div class="noDataBody n-chart-body"            style="display: none;">            <div class="n-chart-no-data">              No data available            </div>          </div>          <div class="singleTierBody n-chart-body"            style="display: none;">            <div class="singleTierMessage n-chart-no-data"></div>          </div>          <div class="loading  n-loading">Loading...</div>'),BAR_USAGE:_.template('<div class="n-chart-header">            <span class="n-chart-metric-title">             <%= title %>            </span>            <div class="pull-right">               <span class="lblValue  n-chart-value">              </span>             </div>           </div>          <div class="chartBody  n-chart-body                      n-chart-type-bar-usage">            \x3c!-- Usage Progress Bar --\x3e            <div class="progress   progress-success">              <div class="usageBar  bar"></div>            </div>          </div>          <div class="noDataBody n-chart-body"            style="display: none;">            <div class="n-chart-no-data">              No data available            </div>          </div>'),ENTITY_MULTIDATA_CHART:_.template('<div class="n-chart-header">            <span class="n-chart-metric-title">             <%= title %>            </span>          </div>          <div class="n-chart-body-container">           <div class=n-chart-body-legend            style="<%= legendWidthP ? "width:"+legendWidthP+"%" : "" %>">           </div>           <div class="chartBody  n-chart-body                 n-chart-type-entity-multidata"               style="<%= chartWidthP ? "width:"+chartWidthP+"%" : "" %>">           </div>          </div>          <div class="noDataBody n-chart-body"            style="display: none;">            <div class="n-chart-no-data">              No data available            </div>          </div>         <div class="loading  n-loading">Loading...</div>'),ENTITY_MULTIDATA_CHART_WITH_BORDER:_.template('<div class="n-chart-header">            <span class="n-chart-metric-title">             <%= title %>            </span>            <%= Components.dropdown({             classes   : "n-chart-metric-title download-data btn-group",             text      : exportTitle,             options   : exportOptions,             rightAlign: true           }) %>         </div>          <div class="n-chart-body-container">           <div class="chartBody  n-chart-body                 n-chart-type-entity-multidata"               style="<%= chartWidthP ? "width:"+chartWidthP+"%" : "" %>">           </div>          </div>          <div class="noDataBody n-chart-body"            style="display: none;">            <div class="n-chart-no-data">              <%= no_data %>            </div>          </div>         <div class="n-chart-separator"></div>         <div class="loading  n-loading"><%= loading %>...</div>'),ENTITY_MULTIDATA_CHART_WITH_DROPDOWN:_.template('<div class="n-chart-header">            <%= Components.dropdown({             classes   : "action-dropdown",             text      : title,             options   : options,             rightAlign: false           }) %>           <%= Components.dropdown({             classes   : "n-chart-metric-title download-data btn-group",             text      : exportTitle,             options   : exportOptions,             rightAlign: true           }) %>         </div>          <div class="n-chart-body-container">           <div class="chartBody  n-chart-body                 n-chart-type-entity-multidata"               style="<%= chartWidthP ? "width:"+chartWidthP+"%" : "" %>">           </div>          </div>          <div class="noDataBody n-chart-body"            style="display: none;">            <div class="n-chart-no-data">              <%= no_data %>            </div>          </div>         <div class="n-chart-separator"></div>         <div class="loading  n-loading"><%= loading %>...</div>'),VANTAGE_POINT_TIMELINE:'<div class="chartBody n-vantage-point-chart-body">              <span class="loading">Loading...</span>           </div>           <div class="noDataBody n-vantage-point-chart-body"               style="display: none;">             <div class="n-chart-no-data">               No data available             </div>           </div>',VANTAGE_POINT_PIE:'<div class="n-vantage-point-chart-pie">             <div class="chartBody n-vantage-point-chart-body">             </div>             <div class="n-donut-cover">               <svg xmlns="http://www.w3.org/2000/svg" version="1.1"                 style="width: 60px; height: 60px">                 <circle cx="30" cy="30" r="29" fill="#fefefe"                   stroke="#777777" stroke-width="1"  />               </svg>             </div>             <div class="n-pie-label">               <h5 class="lblUsedPerc"></h5>               <div class="n-used">Used</div>             </div>           </div>',NO_DATA_HTML:_.template('<div class="n-chart-no-data">           <%= args.message             ? args.message             : args.i18n("Placeholder.no_data_available",               "No data available") %>         </div>',null,{variable:"args"}),ERROR_IN_DATA_RETRIEVAL_HTML:_.template('<div class="n-chart-no-data"> <%= i18n("error_retrieve_data") %></div>'),NOT_READY_HTML:_.template('<div class="n-chart-no-data">            <p><%= i18n("collecting_data") %></p>           </div>'),TOOL_TIP_TEMPLATE:_.template('<span class="nutanixMoreInfo"           data-tooltip-classes="-nudge-down"           data-tooltip-container="body"           data-tooltip-title="<%= tooltipText %>">         </span>')}}),define("views/basecomponents/charts/vantagepoints/TimelineVantagePointChartView",["flotr2","views/basecomponents/charts/BaseChartView","views/basecomponents/charts/ChartTemplates","utils/StyleDescriptor","utils/TimeUtil"],function(e,t,i,n,s){"use strict";return t.extend({className:"n-vantage-point-chart",initializeStatsProperties:function(e){this.mainColor=n.getChartColor(e.metricType)},render:function(){return this.$el.html(i.VANTAGE_POINT_TIMELINE),this},updateChartData:function(e){this.isValidForChartUpdate(e)&&(this.model=e||this.model,this.graphData=this.model.getStats(this.getMetricId()),this.updateChartOptions(),this.renderChart())},renderChart:function(){var t=this.getChartContainer();if(this.graphData&&this.graphData.length){if(this.showChart(),t&&!t.clientWidth)return;var i=this.processData();this.graph=e.draw(t,[{data:i,lines:{fill:this.hasFill(),lineWidth:1,fillColor:{colors:this.mainColor},fillOpacity:.15}}],{colors:this.mainColor,shadowSize:0,fontColor:"#999999",xaxis:{mode:"time",labelsAngle:45,min:this.getTimeRangeMin(),max:this.getTimeRangeMax(),tickFormatter:this.xAxisTickFormatter,metricType:this.options.metricType},yaxis:{max:this.getMax(),min:this.getMin(),ticks:this.getTicks(),tickFormatter:this.yAxisTickFormatter,tickDecimals:0,noTicks:2,metricType:this.options.metricType},grid:{color:"#999999",tickColor:"#eaeaea",verticalLines:!0,horizontalLines:!1,minorHorizontalLines:!1,minorVerticalLines:!1,outlineWidth:.5,outline:"s"},mouse:{track:!0,trackAll:!0,relative:!1,position:"se",margin:6,lineColor:"#333333",trackFormatter:this.toolTipTrackFormatter,metricType:this.options.metricType,mouseTrackOverride:this.mouseTrackOverride,preProcessTooltipData:this.preProcessTooltipData},plotOffsetOveride:function(e){e.left=0}})}else this.showNoData();this.showMaxYaxisValue()},xAxisTickFormatter:function(e){return s.formatShortTime(e)},yAxisTickFormatter:function(e){return e}})}),define("text!templates/basecomponents/vantagepoints/elements/metric/PerformanceSmallView.html",[],function(){return'<div class="n-vantage-point-metric-small">\n  <div class="n-title">\n    <span class="lblTitle title" title="<%- title %>">\n      <%- title %>\n    </span>\n  </div>\n  <div class="n-content">\n    <% if (splitMetric) { %>\n    <div class="n-mixed-hypervisors">\n    </div>\n    <% } else { %>\n    <div class="n-metric-value">\n      <div class="n-h3 lblValue"></div>\n      <span class="lblResource">...</span>\n    </div>\n    <% } %>\n  </div>\n</div>'}),define("text!templates/basecomponents/vantagepoints/elements/metric/PerformanceMediumView.html",[],function(){return'<div class="n-vantage-point-metric-medium">\n  <div class="n-title">\n    <span class="lblTitle title" title="<%- title %>">\n      <%- title %>\n    </span>\n    <span class="ntnxMoreInfo"></span>\n    <div class="n-metric-value">\n    <span class="lblValue value">\n      \x3c!-- Metric value goes here... --\x3e\n    </span>\n      <span class="lblResource"></span>\n    </div>\n  </div>\n  <div class="n-content">\n    <div class="n-vantage-point-chart-container">\n      \x3c!-- Chart goese here... --\x3e\n    </div>\n  </div>\n</div>'}),define("models/stats/StatsModel",["models/PollingModel","data/DataURLConstants","data/DataManager","data/DataProperties","managers/ClusterManager","utils/AppUtil","utils/AppConstants"],function(e,t,i,n,s,a,r){"use strict";var o=[r.ENTITY_ACROPOLIS_VOLUME_GROUP,r.ENTITY_GPU],l={ENTITY_TYPE:"entityType"},c={SAMPLING_INTERVAL_SECS:"samplingIntervalSecs",INTERVAL:"intervalInSecs",START_TIME_IN_USECS:"startTimeInUsecs",VALUES:"values",STATS_RESPONSE:"statsSpecificResponses"},u={SAMPLING_INTERVAL_SECS:"sampling_interval_secs",INTERVAL:"interval_in_secs",START_TIME_IN_USECS:"start_time_in_usecs",VALUES:"values",STATS_RESPONSE:"stats_specific_responses"};return e.extend({urlRoot:t.TIME_RANGE_STATS,name:"StatsModel",defaults:{startTime:null,entityId:null,entityType:null,metricIds:null,stats:null,requestors:null,endTime:null,samplingIntervalSecs:null,clusterId:null},DP:c,initialize:function(){a.debug("StatsModel : initialize: | modelId : ",this.cid),this.initializeBaseModel(),this.set({metricIds:[],stats:[],requestors:[]})},parseOptions:function(t,n,s){return s=e.prototype.parseOptions.apply(this,arguments),s.url=i.getDataSourceURL(this._getApiVersion())+this.getStatsURL(),a.debug("StatsModel parseOptions: ","\n start: "+new Date(this.get("startTime")),"\n end: "+new Date(this.get("endTime")),"\n sampInterval: "+this.get("samplingIntervalSecs")),a.debug("StatsModel: in parseOptions method. URL: ",s.url),s},setupURLTemplateObject:function(){var e=this.get("entityId"),i={entityTypeURL:t.getEntityTypeURL(this.get("entityType")),entityId:e,metrics:_.isArray(this.get("metricIds"))?this.get("metricIds").join():this.get("metricIds"),startTime:1e3*this.get("startTime"),endTime:1e3*this.get("endTime"),entityParentId:this.get(n.ENTITY_PARENT_ID),entityParentType:this.get(n.ENTITY_PARENT_TYPE),samplingInterval:this.get("samplingIntervalSecs")};if(i.entityTypeURL===t.CLUSTER)if(s.isMulticlusterNavMode()){var o=s.getClusterModelById(e);o?i.entityId=o.get(n.ID):this.get(n.STATS_CLUSTER_ID)?i.entityId=this.get(n.STATS_CLUSTER_ID):a.log("StatsModel: getStatsURL: Issue retrieving cluster id "+this.get("entityId")),i.entityTypeURL=t.CLUSTERS}else i.entityId=null;if(this.get("entityType")===r.ENTITY_GPU){var l=e.split(r.GRAPH_DATA_SEPARATOR),c=l[0],u=l[1];i.entityTypeURL=_.template(i.entityTypeURL,{hostUuid:u}),i.entityId=c}return i},getStatsURL:function(){var e,s=this.setupURLTemplateObject(),a=s&&s[n.ENTITY_PARENT_TYPE]&&s[n.ENTITY_PARENT_ID];return a?(s[n.ENTITY_PARENT_TYPE]=t.getEntityTypeURL(s[n.ENTITY_PARENT_TYPE]),e=t.TIME_RANGE_STATS_PARENT_DEPENDENT):e=t.TIME_RANGE_STATS,this._getApiVersion()===i.API_VERSION.V2&&(e=a?t.TIME_RANGE_STATS_PARENT_DEPENDENT_V2:t.TIME_RANGE_STATS_V2),_.template(e,s)},getDrilldownRoute:function(e){var t=this.get("entityId"),i=this.get("entityType"),n=this.get("metricIds");return{entityId:t,entityType:i,metricId:e||n.join(",")}},getDataPoints:function(e){var t=this.getDataProperties(),i=[];if(e&&e.successful){var n=1e3*e[t.INTERVAL],s=Math.round(e[t.START_TIME_IN_USECS]/1e3);a.debug("StatsModel Received:\n: ","\n start: "+new Date(s),"\n backend intervalMills: "+n,"\n client  intervalMills: ",1e3*this.get(t.SAMPLING_INTERVAL_SECS),"\n nbValues: "+e[t.VALUES].length),_.each(e[t.VALUES],function(e,t){var a=s+n*t,o=e!==r.STATS_NO_VALUE?e:null;i.push([a,o])})}return i},parse:function(e){var t=this.getDataProperties(),i=[];return e&&e[t.STATS_RESPONSE]&&_.each(e[t.STATS_RESPONSE],function(e){i.push(this.processStats(this.getDataPoints(e)))},this),{stats:i}},getDataProperties:function(){return this._getApiVersion()===i.API_VERSION.V1?this.DP:u},setTimeInterval:function(e,t,i){this.set({startTime:e,endTime:t,samplingIntervalSecs:i},{silent:!0})},setSamplingIntervalSecs:function(e){this.set({samplingIntervalSecs:e},{silent:!0})},setStatsFor:function(e,t,i,n,s){i=_.isArray(i)?i:[i],this.set({entityId:e,entityType:t,metricIds:i,entityParentId:n,entityParentType:s},{silent:!0})},_getApiVersion:function(){return _.contains(o,this.get(l.ENTITY_TYPE))?i.API_VERSION.V2:i.API_VERSION.V1},isStatsFor:function(e,t){return this.get("entityId")===e&&_.contains(this.get("metricIds"),t)},hasMetrics:function(){return this.get("metricIds")&&this.get("metricIds").length>0},getStats:function(e){if(void 0===e)return this.get("stats")[0];for(var t=0;t<this.get("metricIds").length;t++)if(this.get("metricIds")[t]===e)return this.get("stats")[t];return null},getStatsLatestValue:function(e){var t=_.last(this.getStats(e)||[]);return t?t[1]:null},isSameFetchCall:function(){return this._newId=this.get("entityId"),this._previousId===this._newId},processStats:function(e){return e},addRequestor:function(e){var t=this.get("requestors");t.indexOf(e)<0&&t.push(e)},getRequestors:function(){return this.get("requestors")}},{DP:c})}),define("models/stats/UpdatedTimeStatsModel",["models/stats/StatsModel","utils/StatsUtil","data/DataURLConstants","data/DataProperties","data/DataManager"],function(e,t,i,n,s){"use strict";return e.extend({name:"UpdatedTimeStatsModel",clusterUuid:"",defaults:{entityParentType:null,entityParentId:null},preFetch:function(){var e,i;this.get("metricIds").length&&t.isBucketsStats(this.get("metricIds")[0])?(e=this.get(n.START_TIME),i=this.get(n.END_TIME)):(e=t.getStatsStartTime("",this.get(n.ENTITY_TYPE)),i=t.getStatsCurrentTime());for(var s=0;s<this.get("metricIds").length;s++)if(t.isHypervisorStats(this.get("metricIds")[s])){e=new Date(e).setSeconds(0),i=new Date(i).setSeconds(0);break}this.set({startTime:e,endTime:i},{silent:!0})},setupURLTemplateObject:function(){var t=e.prototype.setupURLTemplateObject.apply(this,arguments),s=this.get(n.ENTITY_PARENT_TYPE),a=this.get(n.ENTITY_PARENT_ID);return a&&s?(t[n.ENTITY_PARENT_TYPE]=i.getEntityTypeURL(s),t[n.ENTITY_PARENT_ID]=a):(t[n.ENTITY_PARENT_TYPE]=null,t[n.ENTITY_PARENT_ID]=null),t},getStatsURL:function(){var e=this.setupURLTemplateObject(),t=i.TIME_RANGE_STATS_PARENT_DEPENDENT;return this._getApiVersion()===s.API_VERSION.V2&&(t=i.TIME_RANGE_STATS_PARENT_DEPENDENT_V2),_.template(t,e)},setStatsFor:function(e,t,i,n,s){i=_.isArray(i)?i:[i],this.set({entityId:e,entityType:t,metricIds:i,entityParentId:n,entityParentType:s},{silent:!0})}})}),define("models/EntityProjectionModel",["models/PollingModel","data/DataURLConstants","data/DataProperties"],function(e,t,i){"use strict";var n={ENTITIES:"entities",VM_ENTITY:{MEMORY_SIZE_BYTES:"memory_size_bytes",NUM_VCPUS:"num_vcpus",CPU_RESERVATION_HZ:"cpu_reservation_hz",MEMORY_RESERVED_BYTES:"memory_reserved_bytes",CPU_USAGE:i.STATS_HYP_CPU_USAGE},HOST_ENTITY:{HYPERVISOR_FULL_NAME:"hypervisor_full_name",HYPERVISOR_TYPE:"hypervisor_type",CPU_FREQUENCY_HZ:"cpu_frequency_hz",MEMORY_SIZE_BYTES:"memory_size_bytes",NUM_CPU_CORES:"num_cpu_cores",HA_MEMORY_RESERVED:"ha_memory_reserved_bytes"}};return e.extend({DP:n,urlRoot:t.ENTITY_PROJECTION,name:"EntityProjectionModel",entityType:null,projection:null,initialize:function(t){if(e.prototype.initialize.apply(this,arguments),!t||!t.entityType||!t.projection)throw new Error("Must provide options.entityType and options.projection");this.entityType=t.entityType,this.projection=t.projection},parseOptions:function(t,i,n){return n=e.prototype.parseOptions.apply(this,arguments),"read"===t&&(this.entityType&&_.extend(n.data,{entityType:this.entityType}),this.projection&&_.extend(n.data,{projection:this.projection.join(",")})),n}},{DP:n})}),define("views/basecomponents/vantagepoints/elements/metric/PerformanceVantagePointView",["views/basecomponents/vantagepoints/elements/BaseVantagePointView","views/basecomponents/vantagepoints/VantagePointLayoutDescriptor","views/basecomponents/charts/vantagepoints/TimelineVantagePointChartView","text!templates/basecomponents/vantagepoints/elements/metric/PerformanceSmallView.html","text!templates/basecomponents/vantagepoints/elements/metric/PerformanceMediumView.html","models/stats/UpdatedTimeStatsModel","models/hardware/HostCollection","models/EntityProjectionModel","utils/AppConstants","utils/AppUtil","utils/StatsUtil","utils/HypervisorUtil","utils/CommonTemplates","utils/SVG","data/DataProperties","managers/NavigationManager"],function(e,t,i,n,s,a,r,o,l,c,u,d,h,p,T,E){"use strict";var S=_.template(n),g=_.template(s);return e.extend({statsModel:null,entityProjectionModel:null,vantagePointCSS:"n-vantage-point-metric n-vantage-point-timeline-metric",chartView:null,splitMetric:!1,titleOptions:!0,initializeVantagePoint:function(){var e=this.getClusterUuid();this.splitMetric=!!e&&u.isMetricSplittableForMixedHypervisor(this.getAspectsValue(l.VP_ASPECT_METRIC),e)},renderVantagePoint:function(){var e=this.getAspectsValue(l.VP_ASPECT_METRIC),t=this.getAspectsValue(l.VP_ASPECT_ENTITY),n=this.getAspectsValue(l.VP_ASPECT_ENTITY_ID);this.chartView=new i({metricType:e,entityType:t,entityId:n}),this.$(".n-vantage-point-chart-container").html(this.chartView.render().el),this.clusterManager.isClusterFFEnabled(l.FFLAGS.SUPPORT_PAGINATION)||this.renderResource(e)},updateTemplate:function(){var e=g,i=this.model.toJSON(),n=i.name,s=this.i18n(n,n);this.getSize()===t.SIZE_SMALL&&(e=S),this.template=e({model:i,title:s,splitMetric:this.splitMetric,SVG:p,customizable:this.isCustomizable})},updateTitleOptions:function(){this.getAspectsValue(l.VP_ASPECT_METRIC)===T.STATS_CONTROLLER_AVG_IO_LATENCY&&this.$(".ntnxMoreInfo").nutanixMoreInfo({title:this.i18nStatic("IntentDynamicPopupView","qos.iopsWarn")})},updateDataModels:function(){var e=this.getAspectsValue(l.VP_ASPECT_ENTITY),t=this.getAspectsValue(l.VP_ASPECT_METRIC),i=this.getAspectsValue(l.VP_ASPECT_ENTITY_ID),n=u.getStatsProperty(t,e,!0,this.getClusterUuid()),s=u.getStatsStartTime(),r=u.getStatsCurrentTime(),c=u.getSamplingIntervalSecs(n),h=o.DP.HOST_ENTITY,p=[h.CPU_FREQUENCY_HZ,h.MEMORY_SIZE_BYTES,h.NUM_CPU_CORES];if(d.isAcropolisEnabled()&&p.push(h.HA_MEMORY_RESERVED),!this.isMulticlusterNavMode()||e&&t&&i){if((t===l.METRIC_CPU_USAGE||t===l.METRIC_MEMORY_USAGE)&&(this.clusterManager.isClusterFFEnabled(l.FFLAGS.SUPPORT_PAGINATION)&&(this.entityProjectionModel=new o({entityType:l.ENTITY_HOST,projection:p}),this.registerDataModel(this.entityProjectionModel,this,this.renderAvailableResource,this.renderError,l.LONG_POLLING_INTERVAL)),this.splitMetric)){var E=u.splitMetricByHypervisorTypes(t);n=_.map(E,function(e,t){return e[0]})}this.statsModel=new a,this.statsModel.setTimeInterval(s,r,c),this.statsModel.setStatsFor(i,e,n),this.statsModel.set(T.STATS_CLUSTER_ID,this.getClusterId()),this.statsModel.set(T.CLUSTER_UUID,this.getClusterUuid()),this.registerDataModel(this.statsModel,this,this.renderSuccess,this.renderError,l.DEFAULT_STATS_INTERVAL)}else this.isEmptyContent=!0},destroy:function(){this.chartView&&(this.chartView.destroy(),this.chartView=null),this.$(".ntnxMoreInfo").nutanixMoreInfo("destroy"),e.prototype.destroy.apply(this,arguments)},renderSuccess:function(e){e=e||this.statsModel;var i,n=o.DP.HOST_ENTITY,s=this.getAspectsValue(l.VP_ASPECT_METRIC),a=this.getClusterUuid(),r=u.getStatsProperty(s,null,!0,a);if(e)if(this.splitMetric){var c=u.splitMetricByHypervisorTypes(s,a),p=[];_.each(c,function(t,i){p.push([l.HYPERVISOR_LABEL[i],u.statsFormat(s,e.getStatsLatestValue(t[0]))])}),this.$(".n-mixed-hypervisors").html(h.LABEL_COLUMN_LIST({list:p}))}else{if(i=e.getStatsLatestValue(r),d.isAcropolisEnabled()&&s===l.METRIC_MEMORY_USAGE){var T=i,E=0,S=this.entityProjectionModel.get(o.DP.ENTITIES);if(!S)return;E=u.getReservedMemUsage(S,n.MEMORY_SIZE_BYTES,n.HA_MEMORY_RESERVED),i=E+T,i>1e6&&(i=1e6)}i=u.statsFormat(s,i),this.getSize()===t.SIZE_SMALL&&(i=u.addStyleToUnit(i)),this.$(".lblValue").html(i)}this.getSize()!==t.SIZE_SMALL&&this.renderChart(e)},renderChart:function(e){this.chartView&&this.chartView.updateChartData(e)},onResize:function(){this.chartView&&this.chartView.onResize()},registerActionMenuCallbacks:function(){this.actionMenuView&&(this.actionMenuView.registerActionCallback(l.ACTION_MENU.CHART_REDIRECT,this.actionMenuCallbackRedirect,this),this.actionMenuView.registerActionCallback(l.ACTION_MENU.METRIC_REDIRECT,this.actionMenuCallbackRedirect,this))},actionMenuCallbackRedirect:function(){if(this.statsModel){var e=this.i18n(this.model.getName())||this.model.getName(),t=this.statsModel.getDrilldownRoute(),i=h.CHART_DRILL_DOWN(_.extend(t,{tr:l.STATS_LAST_HOURS,title:encodeURIComponent(e),entityParentType:"",entityParentId:""}));E.navigateToPage(l.PAGE_ANALYSIS,l.SUBPAGE_TIMELINE,i)}},renderResource:function(e){var t=new r,i=this;switch(e){case l.METRIC_CPU_USAGE:t.fetch({success:function(e){var t=u.aggregate(e,T.CPU_CAPACITY,!0,T.CPU_CORES),n=c.sprintf(this.i18n("use_of_cpu","OF %s"),t);i.$(".lblResource").html(n)}});break;case l.METRIC_MEMORY_USAGE:t.fetch({success:function(e){var t=u.aggregate(e,T.MEM_CAPACITY),n=c.sprintf(this.i18n("VantagePointProperties.use_of_mem","OF %s"),t);i.$(".lblResource").html(n)}});break;default:this.$(".lblResource").empty()}},renderAvailableResource:function(e){var t,i=o.DP.HOST_ENTITY,n=this.getAspectsValue(l.VP_ASPECT_METRIC),s=0,a=0,r=0,h=0;_.each(e.get(o.DP.ENTITIES),function(e){s=parseInt(e[i.NUM_CPU_CORES],10),a=parseInt(e[i.CPU_FREQUENCY_HZ],10),r+=s*a,h+=parseInt(e[i.MEMORY_SIZE_BYTES],10)}),n===l.METRIC_MEMORY_USAGE?(t=c.sprintf(this.i18n("use_of_mem","OF %s"),u.statsFormat(T.MEM_CAPACITY,h)),this.$(".lblResource").html(t)):n===l.METRIC_CPU_USAGE&&(t=c.sprintf(this.i18n("use_of_cpu","OF %s"),u.statsFormat(T.CPU_CAPACITY,r,!0)),this.$(".lblResource").html(t)),d.isAcropolisEnabled()&&n===l.METRIC_MEMORY_USAGE&&this.renderSuccess()},onStartServices:function(){if(this.statsModel){var t=this.getAspectsValue(l.VP_ASPECT_ENTITY),i=this.getAspectsValue(l.VP_ASPECT_METRIC),n=u.getStatsProperty(i,t,!0,this.getClusterUuid()),s=u.getStatsStartTime(),a=u.getStatsCurrentTime(),r=u.getSamplingIntervalSecs(n);this.statsModel.setTimeInterval(s,a,r),e.prototype.onStartServices.apply(this,arguments)}}})}),define("models/storage/ContainerModel",["models/BaseModel","models/PollingModel","data/DataURLConstants","data/DataProperties","utils/AppConstants","utils/StatsUtil","utils/CommonTemplates"],function(e,t,i,n,s,a,r){"use strict";var o={ON:"on",OFF:"off"};return t.extend({urlRoot:i.CONTAINER,entityType:s.ENTITY_CONTAINER,name:"ContainerModel",physical:!0,featureState:o,hasArithmosStats:!0,defaults:{id:null,name:"",storagePoolId:null,totalExplicitReservedCapacity:0,advertisedCapacity:null},initialize:function(e,i){t.prototype.initialize.apply(this,arguments),this.hasArithmosStats=this.clusterManager.isClusterFFEnabled(s.FFLAGS.ARITHMOS_USAGE_STATS)},getURL:function(e){return"update"===e?this.urlRoot:"delete"===e?this.url()+"?"+n.IGNORE_SMALL_FILES+"=true":this.url()},getValue:function(t){var i;switch(t){case n.USAGE_STATS+"."+n.NEW_FREE_BYTES_LOGICAL:case n.NEW_FREE_BYTES_LOGICAL:i=this.getTotalAvailableLogical();break;case n.USAGE_STATS+"."+n.NEW_TOT_USED_LOG:case n.TOT_USED_LOG:i=this.getTotalUsedLogical();break;case n.USAGE_STATS+"."+n.NEW_TOT_CAPACITY_LOGICAL:case n.NEW_TOT_CAPACITY_LOGICAL:i=this.getMaxCapacityLogical();break;case n.USAGE_STATS+"."+n.NEW_CONTAINER_OWN_USAGE_LOGICAL:case n.NEW_CONTAINER_OWN_USAGE_LOGICAL:i=this.getUsageByThisContainerOnly();break;case n.USAGE_STATS+"."+n.NEW_UNRESERVED_SHARED_LOGICAL:case n.NEW_UNRESERVED_SHARED_LOGICAL:i=this.getTotalUsedByOtherContainers();break;case n.ENCRYPTION_STATUS:return this.getEncryptionStatus();default:i=e.prototype.getValue.apply(this,arguments)}return i},toJSON:function(t){var i=e.prototype.toJSON.apply(this,arguments);return t&&t.includeCustomAttributes&&(i[n.NEW_FREE_BYTES_LOGICAL]=this.getTotalAvailableLogical(),i[n.TOT_USED_LOG]=this.getTotalUsedLogical(),i[n.NEW_TOT_CAPACITY_LOGICAL]=this.getMaxCapacityLogical(),i[n.NEW_CONTAINER_OWN_USAGE_LOGICAL]=this.getUsageByThisContainerOnly(),i[n.NEW_UNRESERVED_SHARED_LOGICAL]=this.getTotalUsedByOtherContainers(),i[n.ENCRYPTION_STATUS]=this.getEncryptionStatus(),i[n.ENCRYPTION_PROGRESS]=this.getEncryptionProgress()),i},validate:function(e,t){var i="";if(!t||!t.ignoreValidation){0===$.trim(e[n.NAME]).length&&(i+="Storage container name should not be empty. "),0===$.trim(e[n.SP_ID]).length&&(i+="Storage pool should be selected. "),
isNaN(e[n.RES_CAPACITY_EXPL])&&(i+="Reserved capacity should be numeric. "),$.trim(e[n.COMPRESSION_DELAY_SECS]).length&&isNaN(e[n.COMPRESSION_DELAY_SECS])&&(i+="Compression delay should be numeric. ");return e[n.ADVERTISED_CAPACITY]>0x3fffffffc0000000&&(i+="Maximum value of Advertised capacity is 4294967295 GiB. "),e[n.RES_CAPACITY_EXPL]>0x3fffffffc0000000&&(i+="Maximum value of Reserved Capacity is 4294967295 GiB. "),$.trim(i).length>0?i:void 0}},getMaxCapacityPhysical:function(){return this.hasArithmosStats?a.getUsageStats(this,n.NEW_TOT_CAPACITY):this.get(n.MAX_CAPACITY)},getMaxCapacityLogical:function(){return this.hasArithmosStats?a.getUsageStats(this,n.NEW_TOT_CAPACITY_LOGICAL):a.getUsageStats(this,n.TOT_CAPACITY)/this.get(n.RF)},getTotalUsedPhysical:function(){return this.hasArithmosStats?a.getUsageStats(this,n.NEW_TOT_USED_PHY):a.getUsageStats(this,n.TOT_USED_PHY)},getTotalUsedLogical:function(){return this.hasArithmosStats?a.getUsageStats(this,n.NEW_TOT_USED_LOG):a.getUsageStats(this,n.TOT_USED_LOG)},getTotalAvailablePhysical:function(){return this.hasArithmosStats?a.getUsageStats(this,n.NEW_FREE_BYTES_PHYSICAL):this.getMaxCapacityPhysical()-this.getTotalUsedPhysical()},getTotalAvailableLogical:function(){return this.hasArithmosStats?a.getUsageStats(this,n.NEW_FREE_BYTES_LOGICAL):this.getMaxCapacityLogical()-this.getTotalUsedLogical()},getFreeReservedPhysical:function(){if(this.hasArithmosStats)return a.getUsageStats(this,n.NEW_FREE_RESERVED_BYTES_PHYSICAL);var e=this.get(n.RF);return this.get(n.USAGE_STATS)[n.FREE_RESERVED_BYTES_LOGICAL]*e},getFreeUnreservedPhysical:function(){return this.hasArithmosStats?a.getUsageStats(this,n.NEW_FREE_UNRESERVED_CAPACITY):a.getUsageStats(this,n.FREE_UNRESERVED_CAPACITY)},getReservedCapacity:function(){return this.get(n.RES_CAPACITY_EXPL)>this.get(n.RES_CAPACITY_IMPL)?this.get(n.RES_CAPACITY_EXPL):this.get(n.RES_CAPACITY_IMPL)},getExcplicitReservedCapacity:function(e){return e?this.get(n.RES_CAPACITY_EXPL)*this.get(n.RF):this.get(n.RES_CAPACITY_EXPL)},getReservedCapacityLogical:function(){return a.getUsageStats(this,n.RESERVED_CAPACITY_LOGICAL)},getDataReductionSaving:function(){return a.getUsageStats(this,n.CONTAINER_DATA_REDUCTION_SAVING)},getDataReductionRatio:function(){return a.formatStatsRatio(a.getUsageStats(this,n.CONTAINER_DATA_REDUCTION_RATIO))},getOverallEfficiencyRatio:function(){return a.formatStatsRatio(a.getUsageStats(this,n.CONTAINER_EFFICIENCY_RATIO))},getEffectiveFree:function(){var e=this.getTotalAvailableLogical(),t=a.getUsageStats(this,n.CONTAINER_DATA_REDUCTION_RATIO);if(!isNaN(t)&&t>0&&!isNaN(e)){var i=parseInt(t,10)/s.PART_FROM_MILLION;return i=Math.round(100*i)/100,e*i}},getPhysicalSize:function(){return this.getUsageByThisContainerOnly(!0)},getTotalReservedCapacity:function(){return this.hasArithmosStats?a.getUsageStats(this,n.NEW_TOT_RES_CAPACITY):a.getUsageStats(this,n.TOT_RES_CAPACITY)},getPerTierStats:function(){return this.hasArithmosStats?a.formulatePerTierStats(this.get(n.USAGE_STATS)):a.formulatePerTierStatsOld(this.get(n.USAGE_STATS))},togglePhysical:function(){this.physical=!this.physical},isPhysical:function(){return this.physical},getActualSpaceSavedCompressionLabel:function(){var e=a.getUsageStats(this,n.COMPRESSION_USER_SAVED_BYTES);return a.getStorageLabelWithMinimumLimit(e,r.STATS_COMPRESSION_SMALL)},getActualSpaceSavedOnDiskDedupLabel:function(){var e=a.getUsageStats(this,n.DEDUP_USER_SAVED_BYTES);return a.getStorageLabelWithMinimumLimit(e,r.STATS_COMPRESSION_SMALL)},getEffectiveCompressionRatio:function(){var e=a.getUsageStats(this,n.COMPRESSION_SAVINGS_RATIO);return a.formatStatsRatio(e)},getEffectiveOnDiskDedupRatio:function(){var e=a.getUsageStats(this,n.DEDUP_SAVINGS_RATIO);return a.formatStatsRatio(e)},getThinProvSaving:function(){return a.getUsageStats(this,n.THIN_PROV_USER_SAVING_BYTES)},getThinProvSavingRatio:function(){return a.formatStatsRatio(a.getUsageStats(this,n.THIN_PROV_USER_SAVING_RATIO))},getIntCloneSaving:function(){return a.getUsageStats(this,n.INTL_CLONING_USER_SAVING_BYTES)},getIntCloneSavingRatio:function(){return a.formatStatsRatio(a.getUsageStats(this,n.INTL_CLONING_USER_SAVING_RATIO))},getPerfDedupLabel:function(){var e=this.get(n.FINGER_PRINT_ON_WRITE)||"";return e===s.FINGER_PRINT_ON_WRITE.NONE&&(e=s.FINGER_PRINT_ON_WRITE.OFF),e.toLowerCase()},getOnDiskDedupLabel:function(){var e=this.get(n.ON_DISK_DEDUP)||"";return e===s.FINGER_PRINT_ON_WRITE.NONE?e=s.FINGER_PRINT_ON_WRITE.OFF:e===s.FINGER_PRINT_ON_WRITE.POST_PROCESS&&(e=s.FINGER_PRINT_ON_WRITE.ON),e.toLowerCase()},getErasureCodeLabel:function(){return this.get(n.ERASURE_CODE).toLowerCase()},getErasureCodeDelayDisplayValue:function(){var e=this.get(n.ERASURE_CODE_DELAY);return _.isUndefined(e)?s.STATS_NOT_AVAILABLE:null!==e?Math.round(e/60*100)/100+" min.":s.STATS_DEFAULT_VAL},getErasureCodeSpaceSaved:function(){var e=a.getUsageStats(this,n.ERASURE_USER_SAVED_BYTES);return a.getStorageLabelWithMinimumLimit(e,r.STATS_COMPRESSION_SMALL)},getErasureCodeRatio:function(){var e=a.getUsageStats(this,n.ERASURE_SAVINGS_RATIO);return a.formatStatsRatio(e)},getTotalAvailableCapacity:function(){var e=this.getMaxCapacityPhysical(),t=this.getTotalUsedPhysical();return e?e-(t||0):0},isAdvertisedUsedAsMaxCapacity:function(){return this.get(n.ADVERTISED_CAPACITY)===this.getMaxCapacityLogical()},isSystemContainer:function(){return this.get(n.IS_NUTANIX_MANAGED)},hasNewStats413:function(){return this.clusterManager.doesClusterHaveStats413(this)},hasNewStorageStats:function(){return this.clusterManager.doesClusterHaveNewStorageStats(this)},hasStatsAggregatorCleanup:function(){return this.clusterManager.hasStatsAggregatorUsageCleanup(this)},getRealUsed:function(e){var t;if(this.hasNewStorageStats())return t=e?n.NEW_REAL_USED_PHYSICAL:n.NEW_REAL_USED_LOGICAL,a.getUsageStats(this,t);if(this.hasStatsAggregatorCleanup())return t=e?n.SA_REAL_USED_PHYSICAL:n.SA_REAL_USED_LOGICAL,a.getUsageStats(this,t);throw new Error("Stats not supported.")},getReservedButNotUsed:function(e){var t;if(this.hasNewStorageStats())return t=e?n.NEW_FREE_RESERVED_BYTES_PHYSICAL:n.NEW_FREE_RESERVED_BYTES_LOGICAL,a.getUsageStats(this,t);if(this.hasStatsAggregatorCleanup())return t=e?n.SA_FREE_RESERVED_CAPACITY_PHYSICAL:n.SA_FREE_RESERVED_CAPACITY_LOGICAL,a.getUsageStats(this,t);throw new Error("Stats not supported.")},getTotalUsedByOtherContainers:function(){if(this.hasNewStorageStats())return a.getUsageStats(this,n.NEW_UNRESERVED_SHARED_LOGICAL);if(this.hasStatsAggregatorCleanup())return a.getUsageStats(this,n.SA_UNRESERVED_SHARED_LOGICAL);throw new Error("Stats not supported.")},getImplicitReservationCapacity:function(){if(this.hasNewStorageStats())return a.getUsageStats(this,n.NEW_RESERVED_CAPACITY_LOGICAL);if(this.hasStatsAggregatorCleanup())return a.getUsageStats(this,n.SA_FREE_RESERVED_CAPACITY_LOGICAL);throw new Error("Stats not supported.")},getUsageByThisContainerOnly:function(e){if(this.hasNewStorageStats()||this.hasStatsAggregatorCleanup()){return(this.getRealUsed(e)||0)+(this.getReservedButNotUsed(e)||0)}throw new Error("Stats not supported.")},getOwnMaxCapacity:function(){if(this.hasNewStorageStats())return a.getUsageStats(this,n.NEW_CONTAINER_OWN_MAX_CAPACITY_LOGICAL);if(this.hasStatsAggregatorCleanup())return a.getUsageStats(this,n.SA_CONTAINER_OWN_MAX_CAPACITY_LOGICAL);throw new Error("Stats not supported. Own max capacity is not supported in this Acropolis version.")},getOtherContainersTotalReservedCapacity:function(){if(this.hasNewStats413())return a.getUsageStats(this,n.NEW_OTHER_CONTAINERS_RESERVED_CAPACITY_BYTES);if(this.hasNewStorageStats()||this.hasStatsAggregatorCleanup()){var e=this.getOwnMaxCapacity(),t=this.getMaxCapacityLogical();return Math.max(0,Math.abs(t-e))}throw new Error("Stats not supported. Either own max capacity or new total used logical is not supported in this Acropolis version.")},getMinimumRequiredMetroCapacity:function(){return Math.max(this.getExcplicitReservedCapacity(!0),this.getUsageByThisContainerOnly(!0))},getFileSystemWhiteListsLabel:function(){var e=(this.get(n.FILESYSTEM_WHITELISTS)||[]).length;return e||"None"},getFileSystemWhitelistsAsCSV:function(e){var t=this.get(e);return t?t.join(", "):""},getEncryptionStatus:function(){return this.get(n.ENCRYPTED)?this.get(n.SOFTWARE_ENCRYPTED)?this.i18n("yes"):this.i18nStatic("ContainerTabDetailsEntityView","encryptionInProgress"):this.i18n("no")},getEncryptionProgress:function(){if(this.get(n.ENCRYPTED)&&!this.get(n.SOFTWARE_ENCRYPTED)){var e=this.getTaskManager().findRunningTaskByTypeAndEntity(s.TASK_OPERATION_ENCRYPTION,s.ENTITY_APP_CONTAINER,this.get(n.CONTAINER_UUID));return e?e.getPercentageDisplay():s.DATA_NOT_AVAILABLE}return null}})}),define("models/storage/ContainerCollection",["models/PollingCollection","models/storage/ContainerModel","data/DataURLConstants","data/DataProperties"],function(e,t,i,n){"use strict";var s=e.extend({model:t,url:i.CONTAINER,name:"ContainerCollection",rfValue:2,getUnusedModels:function(){return _.filter(this.models,function(e){return 0===e.getPhysicalSize()})},getUsedModels:function(){return _.filter(this.models,function(e){return e.getPhysicalSize()>0})},filterCollection:function(e){var t=this.filter(e),i=new s(t);return _.each(i.models,function(e){e.collection=i}),i},findModelByUuid:function(e){return this.find(function(t){return t.get(n.CONTAINER_UUID)===e})},getMinRfValue:function(){var e=this.getUsedModels(),t=_.min(e,function(e){return e.get(n.RF)});return t&&t.get(n.RF)},hasMixedRf:function(){var e=this.getUsedModels(),t=e[0].get(n.RF),i=e.find(function(e){return e.get(n.RF)!==t});return Boolean(i)}});return s}),define("models/PostModel",["models/PollingModel"],function(e){"use strict";return e.extend({name:"PostModel",parseOptions:function(t,i,n){return n=e.prototype.parseOptions.apply(this,arguments),n.data=JSON.stringify(this.getPostRequestData()),n.type="POST",n.contentType="application/json",n},getPostRequestData:function(){throw new Error("getPostRequestData: Subclass must implement this function.")}})}),define("models/filtercount/FilterCountModel",["models/PostModel","data/DataURLConstants"],function(e,t){"use strict";return e.extend({urlRoot:t.SERVICE_UTIL_FILTER_COUNTS,name:"FilterCountModel",postRequestData:null,postResponseArray:null,getPostRequestData:function(){return this.postRequestData=[],this.postResponseArray=[],this.generatePostRequestData(),this.postRequestData},parse:function(e,t){return _.each(e,function(e,t){this.postResponseArray[t].count=e},this),{responses:this.sort(this.postResponseArray)}},generatePostRequestData:function(){},appendRequest:function(e,t,i){0===this.postRequestData.length&&this.appendRequestTotal(e);var n={entityType:e.toUpperCase(),filterCriteria:i};this.postRequestData.push(n);var s=_.clone(n);s.label=t,this.postResponseArray.push(s)},appendRequestTotal:function(e){this.postRequestData.push({entityType:e.toUpperCase()}),this.postResponseArray.push({entityType:e,label:"total"})},sort:function(e){return _.sortBy(e,function(e){return-e.count})},getCountObjects:function(){return _.filter(this.get("responses"),function(e){return"total"!==e.label})},getTotalCountObject:function(){return _.find(this.get("responses"),function(e){return"total"===e.label})}})}),define("models/filtercount/DiskTierCountModel",["models/filtercount/FilterCountModel","utils/AppConstants"],function(e,t){"use strict";return e.extend({name:"DiskTireCountModel",customResponseArray:null,generatePostRequestData:function(){var e=t.ENTITY_DISK;this.appendRequest(e,"SSD","storage_tier==SSD-PCIe,storage_tier==SSD-SATA"),this.appendRequest(e,"HDD","storage_tier==DAS-SATA")}})}),define("models/dataprotection/PendingReplicationModel",["models/BaseModel","data/DataURLConstants","utils/AppConstants"],function(e,t,i){"use strict";return e.extend({urlRoot:t.PENDING_REPLICATION,name:"PendingReplicationModel",entityType:i.ENTITY_PENDING_REPLICATION,idParserFunc:function(){return this.cid}})}),define("models/dataprotection/PendingReplicationCollection",["models/PollingCollection","models/dataprotection/PendingReplicationModel","data/DataURLConstants"],function(e,t,i){"use strict";return e.extend({model:t,url:i.PENDING_REPLICATION,name:"PendingReplicationCollection"})}),define("models/dataprotection/ReplicationModel",["models/BaseModel","data/DataURLConstants","data/DataProperties","utils/AppConstants"],function(e,t,i,n){"use strict";return e.extend({urlRoot:t.REPLICATION,idAttribute:i.REP_ID,nameAttribute:i.REP_ID,name:"ReplicationModel",entityType:n.ENTITY_REPLICATION})}),define("models/dataprotection/ReplicationCollection",["models/PollingCollection","models/dataprotection/ReplicationModel","data/DataURLConstants"],function(e,t,i){"use strict";return e.extend({model:t,url:i.REPLICATION,name:"ReplicationCollection"})}),define("views/basecomponents/vantagepoints/elements/SubviewVantagePointView",["views/basecomponents/BaseView","views/basecomponents/vantagepoints/VantagePointTemplates","managers/ClusterManager","data/DataProperties","utils/AppUtil","utils/AntiscrollUtil","utils/VisualizationUtil"],function(e,t,i,n,s,a,r){"use strict";return e.extend({enableColumn:!1,numberOfColumns:1,clusterUuid:null,modelEvents:{},initialize:function(t){e.prototype.initialize.apply(this,arguments),this.initializeModels(t),this.delegateModelEvents(),t&&t.clusterUuid&&(this.clusterUuid=t.clusterUuid)},render:function(){return this.$el.addClass("n-vantage-point-subview-content"),this.enableColumn&&this.$el.html(r.renderColumnContent(this.numberOfColumns)),this},getAspectsValue:function(e){return this.options[n.VP_ASPECTS]?this.options[n.VP_ASPECTS][e]:null},initializeModels:function(e){},renderModel:function(e){},renderModelContent:function(e){},renderModelError:function(e,i,n,a){a=a||"",i&&s.isConnectionError(i)?a="Unable to connect to the server.":i&&i.responseText&&(a=(s.processAjaxError(i.responseText)||"").replace(/(<([^>]+)>)/gi,"")),this.$el.html(t.ERROR({errorMessage:"An error occurred.",errorDetails:a}))},renderModelLoading:function(){this.enableColumn?this.$(".n-content-column-container  .n-column-content").html(t.LOADING):this.$el.html(t.LOADING),a.triggerAntiScroll(this)},generateGenericSummaryArray:function(e,t,s){t=t||this.model.models,s=s||3;var a=_.groupBy(t,function(t){return"function"==typeof e?e(t):t.get(e)});return a=_.map(a,function(t,s){var a={};return e===n.CLUSTER_UUID?a.label=i.getNameById(s):a.label=s,a.count=t.length,a}),_.sortBy(a,function(e){return-e.count}).slice(0,s)},onStartServices:function(){this.delegateEvents(),this.delegateModelEvents()},onStopServices:function(){this.undelegateEvents(),this.undelegateModelEvents()},updateColumnContent:function(){throw new Error("This function is meant to be overridden by BaseVantagePointView.")}})}),define("views/basecomponents/vantagepoints/elements/entity/EntityVantagePointTemplates",[],function(){"use strict";return{SP_LIST_ITEM:_.template('<li>             <div class="n-col-sp-chart  sp<%= spId %>">             </div>             <div class="n-col-sp-tier">               <ul>                 <strong><%= spName %></strong>                 <%= msg %>               </ul>             </div>           </li>'),SP_NO_DATA:"<h5>No Data Available</h5>",SP_TIER_SUMMARY:_.template("<li><strong><%= tierName %>:</strong>           <%= percent %> of <%= capacity %></li>"),SP_EMPTY:_.template('<div class="n-empty">             <% if (canModify) { %>               <a class="n-link-action" <%= actionAttributes %> >                Create Storage Pool               </a>             <% } else { %>                 No Storage Pools Found.             <% } %>           </div>'),CTR_ONE_SUMMARY:'<strong><%= ctrName %></strong> is mounted as datastore          <%= datastore != ctrName ? "("+datastore+")" : ""  %> on           <%= hostCount %> Hosts.',CTR_MANY_SUMMARY:'<span class="n-h3"><%= ctrCount %></span>           <%= ctrCount > 1 ? "storage containers are" : "storage container is" %> <br />           mounted on <strong><%= hostCount %> Hosts</strong>.',CTR_NO_DS_SUMMARY:'<span class="n-h3"><%= ctrCount %></span>          storage container<%= ctrCount > 1 ? "s are " : " is " %> <br />           not mounted as <%= ctrCount > 1 ? "datastores" : "a datastore" %>.',CTR_EMPTY:'<div class="n-empty">             <% if (canModify) { %>               <a class="n-link-action" <%= actionAttributes %> >                Create Storage Container               </a>             <% } else { %>                 No Storage Containers Found.             <% } %>           </div>',CTR_VM_ON_DS:'VM<%= (vmCount !== 1) ? "s" : "" %>          <% if (dsCount > 0) { %>             ON DATASTORE<%= (dsCount > 1) ? "S" : "" %>           <% } %>',DISK_TIER_COL:_.template('<div class="n-col n-col-disk">             <div class="n-h3">               <%= count %>             </div>             <%= label %>           </div>')}}),define("text!templates/basecomponents/vantagepoints/elements/entity/ContainerEntityDSVantagePointView.html",[],function(){return'\x3c!-- Container and Datastore --\x3e\n<div class="n-storage-summary-container">\n  \x3c!-- VM --\x3e\n  <div class="n-col n-col-ctr-vm">\n    <div class="n-h3">\n      <span class="lblVMCount">\n        \x3c!-- VM count goes here... --\x3e\n      </span>\n    </div>\n    <div class="lblVMsOnDatastore count-desc">\n      \x3c!-- Description of VMs on datastore goes here... --\x3e\n    </div>\n  </div>\n  <div class="n-col n-col-ctr">\n    \x3c!-- Container content goes here... --\x3e\n  </div>\n</div>'}),define("text!templates/basecomponents/vantagepoints/elements/entity/ContainerEntityNoDSVantagePointView.html",[],function(){return'<div class="n-containers-mounted">\n  \x3c!-- VMs counts --\x3e\n  <div class="n-col n-col-ctr-vm">\n    <div class="vm-count-value donut-loader-blue"></div>\n    <div class="lblVMsOnDatastore count-desc"> <%= i18n(\'vms\') %> <%= i18n(\'on\') %> <%= i18n(\'datastores\') %> </div>\n  </div>\n  \x3c!-- Containers and Hosts counts --\x3e\n  <div class="n-col n-col-ctr">\n    <div class="container-count-value donut-loader-blue"></div>\n    <div class="lblVMsOnDatastore count-desc">\n      <%= i18n(\'storage_containers_are\') %>\n      <%= i18n(\'mounted\') %><span class="hosts-info">\n        <%= i18n(\'on\') %>\n        <strong>\n          <span class="hosts-count-value donut-loader-blue"></span>\n          <%= i18n(\'hosts\') %></strong></span>.\n    </div>\n  </div>\n</div>\n'}),define("models/storage/DatastoreCollection",["backbone","models/BaseCollection","data/DataURLConstants","data/DataProperties","utils/AppUtil"],function(e,t,i,n,s){"use strict";return t.extend({url:i.DATASTORE,name:"DatastoreCollection",getHostsWithDatastore:function(e){var t=_.filter(this.models,function(t){return t.get(n.CONTAINER_ID)==e});return _.pluck(_.map(t,function(e){return e.toJSON()}),n.HOST_ID)},getDatastoreNameByContainer:function(e){var t=_.filter(this.models,function(t){return t.get(n.CONTAINER_ID)==e});return t&&t.length?t[0].get(n.DATASTORE_NAME):""},getDatastoreNamesByHost:function(e){var t=_.filter(this.toJSON(),function(t){return t[n.HOST_ID]==e||t[n.HOST_ID]==s.getDisplayableId(e)});return _.pluck(t,n.DATASTORE_NAME)},getAllVMs:function(){var e=[];return _.each(this.models,function(t){e=e.concat(t.get(n.VM_NAMES))}),_.uniq(e)},getVMsByHost:function(e){var t=[];return _.each(this.models,function(i){i.get(n.HOST_ID)==e&&(t=t.concat(i.get(n.VM_NAMES)))}),_.uniq(t)},getVMsByContainer:function(e){var t=[];return _.each(this.models,function(i){var a=i.get(n.CONTAINER_ID);a!=e&&s.getDisplayableId(a)!=e||(t=t.concat(i.get(n.VM_NAMES)))}),_.uniq(t)},getAllHostsWithDatastores:function(){var e=[];return _.each(this.models,function(t){e.push(t.get(n.HOST_ID))}),_.uniq(e)},getAllContainersAsDatastores:function(){var e=[];return _.each(this.models,function(t){e.push(t.get(n.CONTAINER_ID))}),_.uniq(e)}})}),define("views/basecomponents/vantagepoints/elements/entity/ContainerEntityVantagePointView",["jquery","backbone","views/basecomponents/vantagepoints/elements/SubviewVantagePointView","views/basecomponents/vantagepoints/elements/entity/EntityVantagePointTemplates","text!templates/basecomponents/vantagepoints/elements/entity/ContainerEntityDSVantagePointView.html","text!templates/basecomponents/vantagepoints/elements/entity/ContainerEntityNoDSVantagePointView.html","models/storage/ContainerCollection","models/storage/DatastoreCollection","models/vm/VMCollection","models/hardware/HostCollection","data/DataProperties","utils/AppUtil","utils/AntiscrollUtil","utils/AppConstants","utils/HypervisorUtil","utils/FilterUtil"],function(e,t,i,n,s,a,r,o,l,c,u,d,h,p,T,E){"use strict";return i.extend({name:"ContainerEntityVantagePointView",className:"n-vantage-point-entity-content",datastoreCollection:null,tmplEmpty:_.template(n.CTR_EMPTY),tmplOneSmry:_.template(n.CTR_ONE_SUMMARY),tmplManySmry:_.template(n.CTR_MANY_SUMMARY),tmplNoDSSmry:_.template(n.CTR_NO_DS_SUMMARY),tmplVMonDS:_.template(n.CTR_VM_ON_DS),tmplNoDS:_.template(a),modelEvents:{"reset    datastoreCollection":"renderContainerDatastore","error    datastoreCollection":"renderModelError","pending  datastoreCollection":"renderModelLoading","reset    vmCollection":"updateVMDataInfo","reset    hostCollection":"updateHostDataInfo"},DP:{CONTAINERS_COUNT:"containersCount",WMS_COUNT:"vmsCount",HOSTS_COUNT:"hostsCount"},initializeModels:function(){this.datastoreCollection=new o,this.vmCollection=new l,this.hostCollection=new c},renderModel:function(e){if(this.model=e||this.model||new r,0===this.model.length)this.$el.html(this.tmplEmpty({actionAttributes:d.createActionAttr(p.ENTITY_CONTAINER,p.ACTION_CREATE),canModify:this.canModifyByEntityType(p.ENTITY_CONTAINER)}));else if(T.hasESX(this.clusterUuid)){if(this.clusterUuid){var t=E.getEqualsFIQL(u.FILTER_CLUSTER_UUID,this.clusterUuid);this.datastoreCollection.setFilterCriteria(t)}this.datastoreCollection.fetch()}else this.renderContainerNoDatastore()},renderContainerDatastore:function(){var e,t,i=this.datastoreCollection.getAllContainersAsDatastores(),n=this.datastoreCollection.getAllHostsWithDatastores();this.$el.html(s),i.length>0&&1===this.model.length?(t=this.model.at(0),e=this.tmplOneSmry({ctrName:t.get(u.NAME),hostCount:n.length,datastore:this.datastoreCollection.getDatastoreNameByContainer(t.id)})):e=i.length>0&&this.model.length>1?this.tmplManySmry({ctrCount:i.length,hostCount:n.length}):0===i.length&&this.model.length>0?this.tmplNoDSSmry({ctrCount:this.model.length}):this.tmplEmpty,this.$(".n-col-ctr").html(e),this.$(".lblVMCount").html(this.datastoreCollection.getAllVMs().length),this.$(".lblVMsOnDatastore").html(this.tmplVMonDS({vmCount:this.datastoreCollection.getAllVMs().length,dsCount:i.length})),h.triggerAntiScroll(this)},updateVMDataInfo:function(){this.updateContainersNoDatastoreInfoParam(this.DP.WMS_COUNT,this.vmCollection.getMetaDataGrandTotalCount())},updateHostDataInfo:function(){this.updateContainersNoDatastoreInfoParam(this.DP.HOSTS_COUNT,this.hostCollection.getMetaDataGrandTotalCount())},updateContainersNoDatastoreInfo:function(e){var t=this;_.each(e,function(e,i){var n,s;switch(i){case t.DP.CONTAINERS_COUNT:n=t.$(".container-count-value"),s="n-h3";break;case t.DP.WMS_COUNT:n=t.$(".vm-count-value"),s="lblVMCount n-h3";break;case t.DP.HOSTS_COUNT:var a=t.$(".hosts-info");_.isNumber(e)&&e>0?(a.removeClass("hide"),n=t.$(".hosts-count-value",a)):a.addClass("hide")}_.isNull(n)||(n.hasClass("donut-loader-blue")&&(n.removeClass("donut-loader-blue"),_.isNull(s)||n.addClass(s)),n.text(e))})},updateContainersNoDatastoreInfoParam:function(e,t){var i={};i[e]=t,this.updateContainersNoDatastoreInfo(i)},renderContainerNoDatastore:function(){""===e.trim(this.$el.html())&&(this.$el.html(this.tmplNoDS(this.vtOptions())),h.triggerAntiScroll(this)),this.updateContainersNoDatastoreInfoParam(this.DP.CONTAINERS_COUNT,this.model.toJSON().length);var t={data:{count:1,page:1}};this.vmCollection.fetch(t),this.hostCollection.fetch(t)}})}),define("text!templates/basecomponents/vantagepoints/elements/entity/StoragePoolEntityVantagePointView.html",[],function(){return'\x3c!-- Storage pool entity information --\x3e\n<ul class="n-list">\n  \x3c!-- NOTE: Row items go here... --\x3e\n</ul>'}),define("views/basecomponents/charts/vantagepoints/PieVantagePointChartView",["flotr2","views/basecomponents/charts/BaseChartView","views/basecomponents/charts/ChartTemplates","data/DataProperties","utils/AppConstants","utils/StatsUtil","utils/StyleDescriptor"],function(e,t,i,n,s,a,r){"use strict";return t.extend({className:"n-vantage-point-chart",initializeStatsProperties:function(e){this.mainColor=r.getPieChartColor(e.metricType)},render:function(){return this.$el.html(i.VANTAGE_POINT_PIE),this},renderChart:function(t){this.model=t||this.model;var i=this.getUsageData();if(!i)return void this.showNoData();this.showChart();var n=this.getChartContainer();n&&!n.clientWidth||(this.graph=e.draw(n,i,{colors:this.mainColor,shadowSize:0,grid:{color:"#999",verticalLines:!1,horizontalLines:!1,outlineWidth:0},xaxis:{showLabels:!1},yaxis:{showLabels:!1},pie:{show:!0,explode:0,startAngle:90,fillOpacity:1,sizeRatio:.9,labelFormatter:this.labelFormatter},legend:{show:!1}}))},getUsageData:function(){var e,t,i,r;switch(e=t=i=0,this.entityType){case s.ENTITY_CLUSTER:break;default:t=this.model.get(n.USAGE_STATS)?this.model.get(n.USAGE_STATS)[n.TOT_USED_PHY]:0,e=this.model.get(n.USAGE_STATS)?this.model.get(n.USAGE_STATS)[n.TOT_CAPACITY]:0,i=e-t}return r=[],r.push({data:[[0,t]],label:"Used",pie:{fillOpacity:1}}),r.push({data:[[0,i]],label:"Free",pie:{fillOpacity:.15}}),this.$(".lblUsedPerc").html(a.roundPercent(t/e,2,!0)),r},labelFormatter:function(e){return null}})}),define("views/basecomponents/vantagepoints/elements/entity/StoragePoolEntityVantagePointView",["jquery","backbone","views/basecomponents/vantagepoints/elements/SubviewVantagePointView","views/basecomponents/vantagepoints/elements/entity/EntityVantagePointTemplates","text!templates/basecomponents/vantagepoints/elements/entity/StoragePoolEntityVantagePointView.html","views/basecomponents/charts/vantagepoints/PieVantagePointChartView","models/storage/StoragePoolCollection","models/hardware/DiskCollection","data/DataProperties","utils/AppUtil","utils/AntiscrollUtil","utils/AppConstants","utils/StatsUtil","utils/FilterUtil"],function(e,t,i,n,s,a,r,o,l,c,u,d,h,p){"use strict";return i.extend({className:"n-vantage-point-entity-content",diskCollection:null,modelEvents:{"reset    diskCollection":"renderModelContent","error    diskCollection":"renderModelError","pending  diskCollection":"renderModelLoading"},initializeModels:function(){this.diskCollection=new o},renderModel:function(e){if(this.model=e||this.model||new r,0===this.model.length)this.$el.html(n.SP_EMPTY({actionAttributes:c.createActionAttr(d.ENTITY_STORAGE_POOL,d.ACTION_CREATE),canModify:this.canModifyByEntityType(d.ENTITY_STORAGE_POOL)}));else{if(this.clusterUuid){var t=p.getEqualsFIQL(l.FILTER_CLUSTER_UUID,this.clusterUuid);this.diskCollection.setFilterCriteria(t)}this.diskCollection.fetch()}},renderModelContent:function(){var t,i,r,o,c,p,T;this.$el.html(s),_.each(this.model.models,function(s){i="",c=this.diskCollection.getPerTierMap(s.id);for(var u in c)r=c[u].used,o=c[u].capacity,p=h.roundPercent(r/o),i+=n.SP_TIER_SUMMARY({tierName:u,percent:p,capacity:h.storageFormat(o)});0===e.trim(i).length&&(i=n.SP_NO_DATA),t=n.SP_LIST_ITEM({spId:s.get(l.ID),spName:s.get(l.NAME),msg:i}),this.$(".n-list").append(t),T=new a({model:s,metricType:d.METRIC_USAGE_SUMMARY}),this.$(".n-list li .sp"+s.get(l.ID)).html(T.render().el),T.renderChart()},this),u.triggerAntiScroll(this)}})}),define("text!templates/basecomponents/vantagepoints/elements/entity/HostEntityVantagePointView.html",[],function(){return'<% if ( countMaintenance === 0 && countForRemoval === 0 ) { %>\n  \x3c!-- If no host is in maintenance mode and for removal, show few rows --\x3e\n  \x3c!-- Host Column 1 --\x3e\n  <div class="n-col  n-col-2">\n    <div class="n-host-monitor">\n      <div class="n-h3">\n        <%= countUnmonitored === 0 ? countMonitored : countUnmonitored %>\n      </div>\n      <%= countUnmonitored === 0 ? i18n("monitored", "Monitored") :\n      i18n("unmonitored", "Unmonitored") %>\n    </div>\n  </div>\n  \x3c!-- Host Column 2 --\x3e\n  <div class="n-col  n-col-2">\n    <div class="n-host-discovered">\n      <div class="n-h3  n-lbl-discovered">\n        <% if (countDiscovered !== null) { %>\n          <%=  countDiscovered %>\n        <% } else { %>\n          <div class="donut-loader"></div>\n        <% } %>\n      </div>\n      <%= i18n(\'discovered\', \'Discovered\') %>\n    </div>\n  </div>\n<% } else { %>\n  \x3c!-- If hosts are in maintenance mode or for removal, show all rows --\x3e\n  \x3c!-- Host Column 1 --\x3e\n  <div class="n-col  n-col-entity-host">\n    \x3c!-- Powered On --\x3e\n    <div class="n-component-host  n-host-monitor">\n      <div class="n-lbl-host">\n        <%= countUnmonitored === 0 ? i18n("monitored", "Monitored") :\n        i18n("unmonitored", "Unmonitored") %>\n      </div>\n      <%= countUnmonitored === 0 ? countMonitored : countUnmonitored %>\n    </div>\n    \x3c!-- Maintenance Mode --\x3e\n    <div class="n-component-host  n-host-maintenance-mode">\n      <div class="n-lbl-host">\n        <%= i18n(\'maintenance\', \'Maintenance\') %>\n      </div>\n      <%= countMaintenance %>\n    </div>\n  </div>\n  \x3c!-- Host Column 2 --\x3e\n  <div class="n-col  n-col-entity-host">\n    \x3c!-- Discovered --\x3e\n    <div class="n-component-host  n-host-discovered">\n      <div class="n-lbl-host">\n        <%= i18n(\'discovered\', \'Discovered\') %>\n      </div>\n      <span class="n-lbl-discovered">\n        <% if (countDiscovered !== null) { %>\n          <%=  countDiscovered %>\n        <% } else { %>\n          <div class="n-inline-loading"></div>&nbsp;\n        <% } %>\n      </span>\n    </div>\n    \x3c!-- For Removal --\x3e\n    <div class="n-component-host  n-host-removed">\n      <div class="n-lbl-host">\n        <%= i18n(\'for_removal\', \'For Removal\') %>\n      </div>\n      <%= countForRemoval %>\n    </div>\n  </div>\n<% } %>'}),define("models/genesis/UnConfiguredNodesModel",["models/genesis/GenesisBaseModel","utils/AppConstants"],function(e,t){"use strict";return e.extend({name:"UnConfiguredNodesModel",methodName:t.NODE_MANAGER_METHODS.DISCOVER_UNCONF_NODES,managerName:t.GENESIS.NODE_MANAGER,getReturnResponse:function(){return this.get(e.DP.GENESIS_RETURN)||[]}})}),define("views/basecomponents/vantagepoints/elements/entity/HostEntityVantagePointView",["backbone","views/basecomponents/vantagepoints/elements/SubviewVantagePointView","text!templates/basecomponents/vantagepoints/elements/entity/HostEntityVantagePointView.html","views/basecomponents/vantagepoints/VantagePointTemplates","models/hardware/HostCollection","models/genesis/UnConfiguredNodesModel","data/DataProperties","utils/AntiscrollUtil","utils/AppConstants"],function(e,t,i,n,s,a,r,o,l){"use strict";var c=_.template(i);return t.extend({name:"HostEntityVantagePointView",className:"n-vantage-point-entity-content",_discoveredCount:null,unconfiguredNodesModel:null,modelEvents:{"change   unconfiguredNodesModel":"renderDiscoveredNode","error    unconfiguredNodesModel":"onDiscoveredNodeError"},initializeModels:function(){this.unconfiguredNodesModel=new a},renderModel:function(e){this.model=e||this.model||new s,this.renderModelContent()},renderModelContent:function(){var e=0,t=0,i=0,n=0,s=this._discoveredCount;_.each(this.model.models,function(s){s.get(r.MONITORED)?e++:t++,s.get(r.MAINTENANCE_MODE)&&i++,s.get(r.REMOVAL_STATUS).length>1&&n++}),this.$el.html(c(this.vtOptions({countMonitored:e,countUnmonitored:t,countDiscovered:s,countMaintenance:i,countForRemoval:n}))),this.canModifyByEntityType(l.ENTITY_CLUSTER)?this.unconfiguredNodesModel.fetch():this.$(".n-host-discovered").hide(),o.triggerAntiScroll(this)},onDiscoveredNodeError:function(e,t){
this.$(".n-host-discovered").html(n.ERROR({errorMessage:"An error occurred.",errorDetails:t}))},renderDiscoveredNode:function(){this._discoveredCount=this.unconfiguredNodesModel.getReturnResponse().length,this.$(".n-lbl-discovered").html(this._discoveredCount)}})}),define("views/basecomponents/vantagepoints/elements/entity/DiskEntityVantagePointView",["views/basecomponents/vantagepoints/elements/SubviewVantagePointView","views/basecomponents/vantagepoints/elements/entity/EntityVantagePointTemplates","utils/AntiscrollUtil"],function(e,t,i){"use strict";return e.extend({className:"n-vantage-point-entity-content",renderModel:function(e){this.model=e||this.model,this.renderModelContent()},renderModelContent:function(){var e,n="";e=this.model.getCountObjects(),_.each(e,function(e){n+=t.DISK_TIER_COL(e)},this),this.$el.html(n),i.triggerAntiScroll(this)}})}),define("text!templates/basecomponents/vantagepoints/elements/entity/OngoingReplicationEntityVantagePointView.html",[],function(){return'\x3c!-- Column 1 --\x3e\n<div class="n-col  n-col-2  replication_vantage">\n  <div class="n-h3">\n    <%= countOutbound %>\n  </div>\n  Outbound\n</div>\n\x3c!-- Column 2 --\x3e\n<div class="n-col  n-col-2  replication_vantage">\n  <div class="n-h3  n-lbl-discovered">\n    <%= countInbound %>\n  </div>\n  Inbound\n</div>'}),define("text!templates/basecomponents/vantagepoints/elements/entity/PendingReplicationEntityVantagePointView.html",[],function(){return'\x3c!-- Column 1 --\x3e\n<div class="n-col  n-col-2  replication_vantage">\n  <div class="n-h3">\n    <%= countPending %>\n  </div>\n  Pending\n</div>'}),define("views/basecomponents/vantagepoints/elements/entity/ReplicationEntityVantagePointView",["backbone","views/basecomponents/vantagepoints/elements/SubviewVantagePointView","text!templates/basecomponents/vantagepoints/elements/entity/OngoingReplicationEntityVantagePointView.html","text!templates/basecomponents/vantagepoints/elements/entity/PendingReplicationEntityVantagePointView.html","data/DataProperties","utils/AntiscrollUtil","utils/AppConstants"],function(e,t,i,n,s,a,r){"use strict";return t.extend({templateOngoing:_.template(i),templatePending:_.template(n),renderModel:function(e){this.model=e,this.renderModelContent()},renderModelContent:function(){switch(this.options.type){case r.VP_REPLICATION_TYPE.ONGOING:var e=_.filter(this.model.models,function(e){return!0===e.get(s.REP_SENDER)}).length,t=_.filter(this.model.models,function(e){return!1===e.get(s.REP_SENDER)}).length;this.$el.html(this.templateOngoing({countOutbound:e||0,countInbound:t||0}));break;case r.VP_REPLICATION_TYPE.PENDING:this.$el.html(this.templatePending({countPending:this.model.length||0}))}a.triggerAntiScroll(this)}})}),define("text!templates/basecomponents/vantagepoints/elements/entity/SuccessfulReplicationEntityVantagePointView.html",[],function(){return'<% if (replicationList && replicationList.length) { %>\n  <table class="n-table">\n    <% _.each( replicationList, function( replication ) { %>\n      <tr>\n        <td class="n-col-1">\n          <a class="n-no-style n-cursor-default" title="<%= replication.pd %>">\n            <%= replication.pd %>\n          </a>\n        </td>\n        <td class="n-col-2">\n          <a class="n-no-style n-cursor-default" title="<%= replication.rs %>">\n            <%= replication.rs %>\n          </a>\n        </td>\n        <td class="n-col-3"><%= replication.ts %></td>\n      </tr>\n    <% }); %>\n  </table>\n<% } else { %>\n  \x3c!-- Show empty --\x3e\n  <div class="n-col  n-col-2  replication_vantage">\n    <div class="n-h3">\n      0\n    </div>\n    REPLICATIONS\n  </div>\n<% } %>\n'}),define("views/basecomponents/vantagepoints/elements/entity/SuccessfulReplicationEntityVantagePointView",["backbone","views/basecomponents/vantagepoints/elements/SubviewVantagePointView","text!templates/basecomponents/vantagepoints/elements/entity/SuccessfulReplicationEntityVantagePointView.html","data/DataProperties","utils/AntiscrollUtil","utils/TimeUtil"],function(e,t,i,n,s,a){"use strict";return t.extend({templateSuccessful:_.template(i),renderModel:function(e){this.model=e,this.renderModelContent()},renderModelContent:function(){var e=[];_.each(this.model.models,function(t){_.each(t.get(n.PD_REPLICATION_LINKS),function(i){var s=i[n.REP_LAST_REPLICATION_END_TIME];null!==s&&e.push({pd:t.get(n.PD_NAME),rs:i[n.REP_REMOTE_SITE_NAME],ts:a.formatDateTime(s>0?s/1e3:0)})})},this),this.$el.html(this.templateSuccessful({replicationList:e})),s.triggerAntiScroll(this)}})}),define("views/basecomponents/vantagepoints/elements/entity/EntityVantagePointView",["backbone","views/basecomponents/vantagepoints/elements/BaseVantagePointView","models/storage/StoragePoolCollection","models/storage/ContainerCollection","models/hardware/HostCollection","models/filtercount/DiskTierCountModel","models/vm/VMCollection","models/dataprotection/ProtectionDomainCollection","models/dataprotection/PendingReplicationCollection","models/dataprotection/ReplicationCollection","views/basecomponents/vantagepoints/elements/entity/ContainerEntityVantagePointView","views/basecomponents/vantagepoints/elements/entity/StoragePoolEntityVantagePointView","views/basecomponents/vantagepoints/elements/entity/HostEntityVantagePointView","views/basecomponents/vantagepoints/elements/entity/DiskEntityVantagePointView","views/basecomponents/vantagepoints/elements/entity/ReplicationEntityVantagePointView","views/basecomponents/vantagepoints/elements/entity/SuccessfulReplicationEntityVantagePointView","views/basecomponents/vantagepoints/VantagePointTemplates","data/DataProperties","utils/AppConstants"],function(e,t,i,n,s,a,r,o,l,c,u,d,h,p,T,E,S,g,A){"use strict";return t.extend({vantagePointCSS:"n-vantage-point-entity",updateStyle:function(){var e=this.getAspectsValue(A.VP_ASPECT_ENTITY),t=this.getAspectsValue(A.VP_ASPECT_TYPE);this.vantagePointCSS+=" "+this.vantagePointCSS+"-"+e,e===A.ENTITY_REPLICATION&&t===A.VP_REPLICATION_TYPE.LAST_SUCCESS&&(this.vantagePointCSS+=" n-last-successful")},updateSubView:function(){var e=this.getAspectsValue(A.VP_ASPECT_ENTITY),t=this.getAspectsValue(A.VP_ASPECT_TYPE);switch(e){case A.ENTITY_CONTAINER:this.subView=new u({clusterUuid:this.getClusterUuid()});break;case A.ENTITY_STORAGE_POOL:this.subView=new d({clusterUuid:this.getClusterUuid()});break;case A.ENTITY_HOST:this.subView=new h({clusterUuid:this.getClusterUuid()});break;case A.ENTITY_DISK:this.subView=new p({clusterUuid:this.getClusterUuid()});break;case A.ENTITY_REPLICATION:t===A.VP_REPLICATION_TYPE.LAST_SUCCESS?this.subView=new E({clusterUuid:this.getClusterUuid()}):this.subView=new T({type:t,clusterUuid:this.getClusterUuid()})}},updateDataModels:function(){var e,t=this.getAspectsValue(A.VP_ASPECT_ENTITY),u=this.getAspectsValue(A.VP_ASPECT_TYPE);switch(t){case A.ENTITY_CONTAINER:e=new n;break;case A.ENTITY_STORAGE_POOL:e=new i;break;case A.ENTITY_HOST:e=new s;break;case A.ENTITY_DISK:e=new a;break;case A.ENTITY_VM:e=new r;break;case A.ENTITY_REPLICATION:u===A.VP_REPLICATION_TYPE.LAST_SUCCESS?e=new o:u===A.VP_REPLICATION_TYPE.ONGOING?e=new c:u===A.VP_REPLICATION_TYPE.PENDING&&(e=new l)}e&&this.registerDataModel(e,this,this.renderSuccess,this.renderError,A.LONG_POLLING_INTERVAL)},renderSuccess:function(e){this.updateTitle(e),this.subView&&this.subView.renderModel(e)},updateTitle:function(e){var t=this.getAspectsValue(A.VP_ASPECT_ENTITY),i=0;switch(t){case A.ENTITY_DISK:i=e.getTotalCountObject().count;break;case A.ENTITY_REPLICATION:if(1!==e.length){var n=this.model.get(g.NAME);this.$(".lblTitle").html(S.TITLE({title:this.i18n("vantagePointPlural."+n)}))}return;default:i=e.length}if(this.model.get(this.model.DP.IS_CUSTOM_VP))this.$(".lblTitle").html(_.escape(this.model.get(g.NAME)));else{var s=A.ENTITY_NAMES[t],a=1===i?"entityNames":"entityNamesPlural",r=this.i18n(a+"."+s.toLowerCase().replace(/ /g,"_"),s);this.$(".lblTitle").html(S.TITLE_WITH_COUNT({count:i,name:r}))}}})}),define("models/resiliency/ResiliencyModel",["models/PollingModel","data/DataURLConstants","data/DataProperties","utils/AppConstants","utils/AppUtil"],function(e,t,i,n,s){"use strict";var a=_.template("<%= entityName %> failure(s) can be supported");return e.extend({urlRoot:t.RESILIENCY_STATUS,idAttribute:i.RESILIENCY_DOMAIN_TYPE,entityType:n.RESILIENCY_STATUS,name:"ResiliencyModel",getSummary:function(){for(var e,t,r,o,l,c,u,d,h=!0,p=[],T="",E=_.sortBy(this.get(i.RESILIENCY_COMPONENTS),i.RESILIENCY_MAX_FT),S=0;S<E.length;S++){var g=E[S],A=this.formatMessage(g[i.RESILIENCY_DETAILS]);if(g[i.RESILIENCY_COMPONENT]===n.RESILIENCY_COMPONENT.STATIC_CONFIGURATION)0===(t=g[i.RESILIENCY_MAX_FT])&&(u=n.RESILIENCY_STATUS.NONE);else{g[i.RESILIENCY_COMPONENT]===n.RESILIENCY_COMPONENT.FREE_SPACE?(h=g[i.RESILIENCY_MAX_FT]>0,A&&A.length&&(d=A)):A&&A.length&&p.push(A);var m=g[i.RESILIENCY_MAX_FT];void 0===o&&(o=m),void 0===r&&(r=m),o=Math.min(o,m),r=Math.max(r,m)}if(g[i.RESILIENCY_UNDER_COMP])return T="",c=null,u=null,(this.get(i.RESILIENCY_DOMAIN_TYPE)===n.RESILIENCY_DOMAIN_TYPE.BLOCK&&0!==t||this.get(i.RESILIENCY_DOMAIN_TYPE)===n.RESILIENCY_DOMAIN_TYPE.NODE)&&(u=n.RESILIENCY_STATUS.COMPUTING),{isUnderComputation:!0,faultToleranceCount:c,faultToleranceStatus:u,faultToleranceMessages:p,faultToleranceTitle:T}}return this.get(i.RESILIENCY_DOMAIN_TYPE)===n.RESILIENCY_DOMAIN_TYPE.NODE?(e=s.getEntityNameFromCount(n.ENTITY_HOST,1),c=o,T=a({entityName:e}),void 0===t&&(t=r),t===o&&o>0?u=n.RESILIENCY_STATUS.GOOD:t>o&&(u=!this.isClusterUnderReplicated()&&o>0?n.RESILIENCY_STATUS.GOOD:0===o?n.RESILIENCY_STATUS.CRITICAL:n.RESILIENCY_STATUS.GOOD)):this.get(i.RESILIENCY_DOMAIN_TYPE)===n.RESILIENCY_DOMAIN_TYPE.BLOCK?(e=s.getEntityNameFromCount(n.ENTITY_BLOCK,1),0===t?(u=null,T="Block Awareness Status",c="OFF"):(c=o,T=a({entityName:e}),u=t>o?n.RESILIENCY_STATUS.CRITICAL:n.RESILIENCY_STATUS.GOOD)):this.get(i.RESILIENCY_DOMAIN_TYPE)===n.RESILIENCY_DOMAIN_TYPE.DISK&&(e=s.getEntityNameFromCount(n.ENTITY_DISK,1),T=a({entityName:e}),u=o>0?n.RESILIENCY_STATUS.GOOD:n.RESILIENCY_STATUS.CRITICAL),l=u!==n.RESILIENCY_STATUS.GOOD&&h,{faultToleranceCount:c,faultToleranceStatus:u,faultToleranceMessages:p,faultToleranceTitle:T,isRebuildCapacityOK:h,isAutoHealBackProgress:l,freeSpaceMessage:d}},getEntityForDomainType:function(e){switch(e){case n.RESILIENCY_DOMAIN_TYPE.NODE:return n.ENTITY_HOST;case n.RESILIENCY_DOMAIN_TYPE.BLOCK:return n.ENTITY_RACKABLE_UNIT;case n.RESILIENCY_DOMAIN_TYPE.RACK:return n.ENTITY_RACK;default:throw new Error("unknown domain type: "+e)}},getSummaryRA:function(){for(var e=void 0,t=void 0,r=void 0,o=void 0,l=!0,c=void 0,u=void 0,d=void 0,h=[],p="",T=void 0,E=_.sortBy(this.get(i.RESILIENCY_COMPONENTS),i.RESILIENCY_MAX_FT),S=0;S<E.length;S++){var g=E[S],A=this.formatMessage(g[i.RESILIENCY_DETAILS]);if(g[i.RESILIENCY_COMPONENT]===n.RESILIENCY_COMPONENT.STATIC_CONFIGURATION)0===(t=g[i.RESILIENCY_MAX_FT])&&(d=n.RESILIENCY_STATUS.NONE);else{g[i.RESILIENCY_COMPONENT]===n.RESILIENCY_COMPONENT.FREE_SPACE?(l=g[i.RESILIENCY_MAX_FT]>0,A&&A.length&&(T=A)):A&&A.length&&h.push(A);var m=g[i.RESILIENCY_MAX_FT];void 0===o&&(o=m),void 0===r&&(r=m),o=Math.min(o,m),r=Math.max(r,m)}if(g[i.RESILIENCY_UNDER_COMP])return p="",u=null,d=null,(this.get(i.RESILIENCY_DOMAIN_TYPE)===n.RESILIENCY_DOMAIN_TYPE.BLOCK&&0!==t||this.get(i.RESILIENCY_DOMAIN_TYPE)===n.RESILIENCY_DOMAIN_TYPE.NODE)&&(d=n.RESILIENCY_STATUS.COMPUTING),{isUnderComputation:!0,faultToleranceCount:u,faultToleranceStatus:d,faultToleranceMessages:h,faultToleranceTitle:p}}if(this.get(i.RESILIENCY_DOMAIN_TYPE)!==n.RESILIENCY_DOMAIN_TYPE.DISK){var f=this.getEntityForDomainType(this.get(i.RESILIENCY_DOMAIN_TYPE));e=s.getEntityNameFromCount(f,1),u=o,p=a({entityName:e}),void 0===t&&(t=r),t===o&&o>0?d=n.RESILIENCY_STATUS.GOOD:t>o&&(d=!this.isClusterUnderReplicated()&&o>0?n.RESILIENCY_STATUS.GOOD:0===o?n.RESILIENCY_STATUS.CRITICAL:n.RESILIENCY_STATUS.GOOD)}else this.get(i.RESILIENCY_DOMAIN_TYPE)===n.RESILIENCY_DOMAIN_TYPE.DISK&&(e=s.getEntityNameFromCount(n.ENTITY_DISK,1),p=a({entityName:e}),d=o>0?n.RESILIENCY_STATUS.GOOD:n.RESILIENCY_STATUS.CRITICAL);return c=d!==n.RESILIENCY_STATUS.GOOD&&l,{faultToleranceCount:u,faultToleranceStatus:d,faultToleranceMessages:h,faultToleranceTitle:p,isRebuildCapacityOK:l,isAutoHealBackProgress:c,freeSpaceMessage:T}},getSummaryRows:function(){var e,t=[];return _.each(this.get(i.RESILIENCY_COMPONENTS),function(s,a){e={},e[i.RESILIENCY_COMPONENT]=n.RESILIENCY_COMPONENT_LABEL[a],s.underComputation?e[i.RESILIENCY_MAX_FT]="--":e[i.RESILIENCY_MAX_FT]=s[i.RESILIENCY_MAX_FT],e[i.RESILIENCY_MESSAGE]=this.formatMessage(s[i.RESILIENCY_DETAILS]),t.push(e)},this),t},formatMessage:function(e){if(!e)return null;var t,n=e[i.RESILIENCY_MESSAGE],s=e[i.RESILIENCY_ATTRIBUTES],a=_.keys(s)||[];for(t=0;t<a.length;t++)n=n.replace("{"+a[t]+"}",s[a[t]]);return n},isClusterUnderReplicated:function(){return this.getUnderReplicatedBytes()>0},getUnderReplicatedBytes:function(){return this.get(i.RESILIENCY_UNDER_BYTES)}})}),define("models/resiliency/ResiliencyCollection",["models/PollingCollection","models/resiliency/ResiliencyModel","data/DataProperties","data/DataURLConstants","utils/AppConstants"],function(e,t,i,n,s){"use strict";return e.extend({model:t,url:n.RESILIENCY_STATUS,name:"ResiliencyCollection",domainType:null,initialize:function(e,t){t=t||{},t.domainType&&(this.domainType=t.domainType,this.url=this.url+"/"+this.domainType),this.initializeBaseCollection(e,t)},getSummary:function(e){var t=this.find(function(t){return t.get(i.RESILIENCY_DOMAIN_TYPE)===e});if(t)return t.getSummary()},getSummaryRA:function(e){var t=this.find(function(t){return t.get(i.RESILIENCY_DOMAIN_TYPE)===e});if(t)return t.getSummaryRA()},getSummaryRows:function(e){var t=this.find(function(t){return t.get(i.RESILIENCY_DOMAIN_TYPE)===e});if(t)return t.getSummaryRows()},getUnderReplicatedBytes:function(){var e=this.find(function(e){return e.get(i.RESILIENCY_DOMAIN_TYPE)===s.RESILIENCY_DOMAIN_TYPE.BLOCK});if(e)return e.getUnderReplicatedBytes()}})}),define("models/filtercount/VMCountByClusterModel",["models/filtercount/FilterCountModel","data/DataProperties","utils/AppConstants"],function(e,t,i){"use strict";return e.extend({name:"VMCountByClusterModel",generatePostRequestData:function(){var e=i.ENTITY_VM;this.appendRequestTotal(e),this.clusterManager.getClusterCollection().each(function(i){this.appendRequest(e,i.get(t.CLUSTER_NAME),"cluster_uuid=="+i.getClusterUuid())},this)}})}),define("models/filtercount/HostCountByClusterModel",["models/filtercount/FilterCountModel","data/DataProperties","utils/AppConstants"],function(e,t,i){"use strict";return e.extend({name:"HostCountByClusterModel",generatePostRequestData:function(){var e=this.clusterManager.getClusterCollection(),n=i.ENTITY_HOST;this.appendRequestTotal(n),e.each(function(e){var i="cluster_uuid=="+e.getClusterUuid();this.appendRequest(n,e.get(t.CLUSTER_NAME),i)},this)}})}),define("models/filtercount/VMPowerStateCountModel",["models/filtercount/FilterCountModel","utils/AppConstants","utils/AppUtil"],function(e,t,i){"use strict";return e.extend({name:"VMPowerStateCountModel",generatePostRequestData:function(){var e=t.ENTITY_VM;_.each(t.VM_POWER_STATE,function(t){this.appendRequest(e,i.toUpperCaseFirstChar(t),"power_state=="+t)},this)}})}),define("models/multicluster/PCVMModel",["backbone","models/PollingModel","data/DataURLConstants","data/DataProperties","data/DataManager","utils/AppConstants","utils/AppUtil"],function(e,t,i,n,s,a,r){"use strict";var o=null,l=0,c={PC_VM_LIST:"pc_vm_list",VIRTUAL_IP:"virtual_ip",NIC_LIST:"nic_list",IP_LIST:"ip_list",NETWORK_CONFIGURATION:"network_configuration",DEFAULT_GATEWAY:"default_gateway",SUBNET_MASK:"subnet_mask",NUM_SOCKETS:"num_sockets",VM_NAME:"vm_name",VM_SIZE:"vm_size",CLUSTER_REFERENCE:"cluster_reference",UUID:"uuid",NETWORK_UUID:"network_uuid",CONTAINER_UUID:"container_uuid",MEMORY_SIZE_BYTES:"memory_size_bytes",DATA_DISK_SIZE_BYTES:"data_disk_size_bytes",POWER_STATE:"power_state",VM_UUID:"vm_uuid"},u=t.extend({DP:c,urlRoot:i.PRISM_CENTRAL_VM,entityType:a.ENTITY_PC_VM,name:"PCVMModel",enableNotifications:!1,defaults:{resources:null},actionMode:null,sync:function(t,n,s){n.actionMode===a.ACTION_ADD?this.urlRoot=i.PRISM_CENTRAL_VM_ADD:this.urlRoot=i.PRISM_CENTRAL_VM,s=this.parseOptions(t,n,s),r.debug("PCVMModel : \n\t method: "+t+"\n\t data  : "+s.url),e.sync(t,n,s)},getDataSourceURL:function(){return s.getDataSourceURL(s.API_VERSION.V3)},getPCVMSpec:function(){var e=this.get(n.INTENT_RESOURCES);return e&&e[c.PC_VM_LIST]?e[c.PC_VM_LIST]:null},getPCVM:function(){var e=this.getPCVMSpec();if(e){return _.find(e,function(e){return e[c.VM_NAME]!==a.PC_VM_NAME_DELETED})}return null},getNetworkConfiguration:function(){var e=this.getPCVM();return e&&e[c.NIC_LIST]&&_.first(e[c.NIC_LIST])[c.NETWORK_CONFIGURATION]?_.first(e[c.NIC_LIST])[c.NETWORK_CONFIGURATION]:null},getVirtualIP:function(){var e=this.get(n.INTENT_RESOURCES);return e&&e[c.VIRTUAL_IP]?e[c.VIRTUAL_IP]:null},getVMIPList:function(){var e=this.getPCVMSpec();return e?_.map(e,function(e){return e[c.NIC_LIST][0][c.IP_LIST][0]}):null},getVMUuidList:function(){var e=this.getPCVMSpec();return e?_.map(e,function(e){return e[c.VM_UUID]}):null},getVMNameList:function(){var e=[],t=this.getPCVMSpec();return t&&_.each(t,function(t){e.push(t[c.VM_NAME])}),e},getHostedClusterUuid:function(){var e=this.getPCVM();return e?e[c.CLUSTER_REFERENCE][c.UUID]:null},getPCVMSize:function(){var e=this.getPCVM();return e?e[c.VM_SIZE]:null},getContainerUuid:function(){var e=this.getPCVM();if(e)return e[c.CONTAINER_UUID]},getNumOfSockets:function(){var e=this.getPCVM();if(e)return e[c.NUM_SOCKETS]},getMemorySize:function(){var e=this.getPCVM();if(e)return e[c.MEMORY_SIZE_BYTES]},getDiskSize:function(){var e=this.getPCVMSpec();if(e)return _.max(_.map(e,function(e){return e[c.DATA_DISK_SIZE_BYTES]}))}},{getSharedPCVMModel:function(){return l++,null===o&&(o=new u),o},releaseSharedPCVMModel:function(){0===--l&&(o.isPolling()&&o.stopPolling(),o=null)}});return u}),define("text!templates/basecomponents/vantagepoints/elements/summary/StorageSummaryVantagePointColumn1View.html",[],function(){return"<% if (!isSetup) { %>\n  \x3c!-- Free column --\x3e\n  <div class=\"n-label-column storage-summary-label\">\n    <p class=\"breakdown-text breakdownText\">\n      <% if (displayLogical) { %>\n        <%= i18ns('free_logical',\n          {\n            total: '<span class=\"bold\">' + totalFree + '</span>',\n            tooltip: '<span class=\"moreInfo\"></span>',\n            capacity: capacity\n          })\n        %>\n      <% } else { %>\n        <%= i18ns(\n          'free_physical', {\n            total: '<span class=\"bold\">' + totalFree + '</span>',\n            tooltip: '<span class=\"moreInfo\"></span>',\n            capacity: capacity\n          })\n        %>\n      <% } %>\n    </p>\n  </div>\n  <div class=\"savings-bars-container\">\n    <div class=\"savings-bar\">\n    </div>\n  </div>\n<% } else { %>\n  \x3c!-- Setup storage --\x3e\n  <div class=\"n-empty\">\n    <%= i18n('no_storage_set_up') %>\n    <% if (canModify) { %>\n      <%= i18ns('create_storage_container',\n        '<a class=\"n-link-action\" ' + ctrAttr  + '>',\n        '</a>')\n      %>\n    <% } %>\n  </div>\n<% } %>"}),define("managers/CollectionManager",["models/storage/ContainerCollection","utils/LogUtil"],function(e,t){"use strict";var i={},n=0;return{COLLECTION:{CONTAINER:"containerCollection"},subscribe:function(e,t){var s=this,a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!e||"function"!=typeof t)throw new Error("CollectionManager.subscribe()\n            invoked without required parameters and/or types.");this._initializeCollection(e);var r=this._getCollectionByName(e),o=i[e];this._addSubscriber(e,t,n);var l=Date.now(),c=l-o.lastFetchTime;(0!==o.lastFetchTime&&c>=1e3||a)&&r.fetch().then(function(){o.lastFetchTime=l});var u=n++;return{unsubscribe:function(){return s._removeSubscriber(e,u)},then:function(t){var i=s._getCollectionByName(e);return i._jqXHR?i._jqXHR.done(t):i.fetch().done(t)},collection:this._getCollectionByName(e)}},_getCollectionObject:function(e){return i[e]},_getCollectionByName:function(e){return this._getCollectionObject(e).collection},_initializeCollection:function(e){var t=this;if(!i[e]){i[e]={collection:this._getNewCollection(e),subscribers:{},lastFetchTime:0};var n=this._getCollectionByName(e,!0);n.on("reset",function(){t._invokeSubscribers(e,n.models)}),n.startPolling?n.startPolling():this._fetchCollection(e)}},_fetchCollection:function(e){var t=this._getCollectionObject(e);if(t)return t.lastFetchTime=Date().now(),t.collection.fetch().then(function(){t.lastFetchTime=Date.now()})},_invokeSubscribers:function(e,t){var i=this._getCollectionObject(e);if(i){var n=i.subscribers;for(var s in n)n[s](t)}},_addSubscriber:function(e,t,n){i[e].subscribers[n]=t},_removeSubscriber:function(e,t){var i=this._getCollectionObject(e);if(i){var n=i.subscribers;delete n[t],Object.keys(n).length||this._removeCollection(e)}},_removeCollection:function(e){var t=this._getCollectionByName(e);t.stopPolling&&t.stopPolling(),delete i[e]},_getNewCollection:function(i){switch(i){case this.COLLECTION.CONTAINER:return new e;default:t.error("Attempted to subscribe to unknown\n              collection: "+i)}}}}),define("views/basecomponents/vantagepoints/elements/summary/StorageSummaryVantagePointView",["backbone","views/basecomponents/vantagepoints/elements/SubviewVantagePointView","text!templates/basecomponents/vantagepoints/elements/summary/StorageSummaryVantagePointColumn1View.html","models/cluster/ClusterModel","models/hardware/DiskCollection","managers/CollectionManager","utils/AppUtil","utils/StatsUtil","utils/VisualizationUtil","utils/TooltipContent","utils/AppConstants","components/Components"],function(e,t,i,n,s,a,r,o,l,c,u,d){"use strict";var h=_.template(i);return t.extend({className:"n-vantage-point-summary-content",name:"StorageSummaryVantagePointView",enableColumn:!0,numberOfColumns:1,isUsingClusterModel:!0,diskCollection:null,containerCollection:null,ss:null,rfValue:2,scalingFactor:.5,displayLogical:!0,renderGate:{},initializeModels:function(e){this.ss={},this.diskCollection=new s({projection:[u.PROJECTION.USAGE_STATS]})},modelEvents:{"reset diskCollection":"renderModelContent","reset clusterCollection":"renderModelContent"},renderModel:function(e){var t=this;if(!this.fetchedContainers){this.renderGate.containersCollection=!1;var i=a.subscribe(a.COLLECTION.CONTAINER,function(){t.rfValue=i.collection.getMinRfValue(),t.scalingFactor=1/t.rfValue,t.renderGate.containersCollection=!0,t.renderModelContent()},!0);this.containerSubscription=i,this.containerCollection=i.collection,this.fetchedContainers=!0}if(this.isClusterFFEnabled(u.FFLAGS.ARITHMOS_USAGE_STATS))if(this.isUsingClusterModel=!0,this.model=e||this.model||new n({projection:[u.PROJECTION.USAGE_STATS]}),0===this.model.getTotalUsedPhysical()){this.renderGate.diskCollection=!1;var r=this.diskCollection.fetch();r&&r.done(function(){t.renderGate.diskCollection=!0,t.renderModelContent()})}else this.renderModelContent();else this.isUsingClusterModel=!1,this.model=e||this.model||new s,this.renderModelContent()},isRenderGateOpen:function(){return _.all(this.renderGate,function(e){return e})},renderModelContent:function(){if(this.isRenderGateOpen()){this.ss.used=this.model.getTotalUsedPhysical(),this.ss.capacity=this.model.getTotalMaxCapacity(),this.ss.percentUsed=o.roundPercent(this.ss.used/this.ss.capacity),this.isUsingClusterModel?(this.ss.unallocated=this.diskCollection.getTotalCapacityOfUnAllocatedDisks(),this.ss.freeUnreserved=this.model.getUnreservedFree(),this.ss.freeReserved=this.model.getReservedFree(),this.ss.activeUsed=this.ss.used-this.ss.freeReserved,this.ss.totalFree=r.isDisplayableNumber(this.ss.freeUnreserved)?this.ss.freeUnreserved:0,this.ss.percentAvail=o.roundPercent(this.ss.totalFree/this.ss.capacity),this.ss.isSetup=this.diskCollection.areAllDisksUnallocated()&&0===this.model.getTotalUsedPhysical()):(this.ss.unallocated=this.model.getTotalCapacityOfUnAllocatedDisks(),this.ss.freeUnreserved=this.ss.capacity-this.ss.used,this.ss.totalFree=this.ss.freeUnreserved,this.ss.percentAvail=o.roundPercent(this.ss.freeUnreserved/this.ss.capacity),this.ss.isSetup=0===this.ss.capacity);var e=o.getStorageStatsHealth(this.ss.used,this.ss.capacity),t={isSetup:this.ss.isSetup,totalFree:o.addStyleToUnit(o.storageFormat(this.ss.totalFree*this.scalingFactor)),provisioned:this.ss.provisioned>0?o.storageFormat(this.ss.provisioned):null,freeUnreserved:o.addStyleToUnit(o.storageFormat(this.ss.freeUnreserved)),freeReserved:this.ss.freeReserved>0?o.storageFormat(this.ss.freeReserved):null,used:o.storageFormat(this.ss.used),capacity:o.storageFormat(this.ss.capacity*this.scalingFactor),unallocated:this.ss.unallocated>0?o.storageFormat(this.ss.unallocated):null,percentAvail:o.addStyleToUnit(this.ss.percentAvail),ctrAttr:r.createActionAttr(u.ENTITY_CONTAINER,u.ACTION_CREATE),canModify:this.canModifyByEntityType(u.ENTITY_STORAGE_POOL),TT:c.STORAGE_STATS,displayLogical:this.displayLogical},i="";switch(e){case u.HEALTH_STATUS.GOOD:i="n-storage-good";break;case u.HEALTH_STATUS.WARNING:i="n-storage-warning";break;case u.HEALTH_STATUS.CRITICAL:i="n-storage-critical"}this.updateColumnContent(1,!1,h(this.vtOptions(t)));var n=this.ss.activeUsed+this.ss.totalFree+this.ss.freeReserved,s=[],a=l.usageBarStyle(this.ss.activeUsed/n*100),d=l.usageBarStyle(this.ss.freeReserved/n*100);s.push({value:this.ss.activeUsed/n*100,tooltip:"CLUSTER_USED",class:"n-storage-tooltip ntnxTooltip\n                    active-usage "+i+" "+a},{value:this.ss.freeReserved/n*100,tooltip:"RESERVED_FREE",class:"n-storage-tooltip ntnxTooltip\n                    reserved-usage "+i+" "+d},{value:this.ss.totalFree/n*100,tooltip:"CLUSTER_FREE",class:"n-storage-tooltip ntnxTooltip free-usage"}),this.$(".savings-bar").html(l.renderMultiUsageBar({percentageList:s})),this.rfValue>1&&this.containerCollection.hasMixedRf()&&this.$(".moreInfo").nutanixMoreInfo({title:this.i18n("tt_mixed_rf")}),_.each(this.$(".n-storage-tooltip"),function(e,t,i){var n=this.$(e).attr("ntnxTooltip"),s=c.getStorageStatsInfo(n);_.isFunction(s)&&(s=s(this.vtOptions({free:o.storageFormat(this.ss.freeUnreserved*this.scalingFactor),used:o.storageFormat(this.ss.activeUsed*this.scalingFactor),reservedFree:o.storageFormat(this.ss.freeReserved*this.scalingFactor)}))),this.$(e).nutanixMoreInfo({classes:["-nudge-up"],placement:"right",title:s})},this)}},getTitleOptions:function(){return d.dropdown({text:this.i18n("logical"),variants:"-compact",rightAlign:!0,options:[{name:this.i18n("physical"),class:"rf-option rfOption titleOption",attributes:'data-rf-value="physical"'},{name:this.i18n("logical"),class:"rf-option rfOption titleOption",attributes:'data-rf-value="logical"'}]})},onClickTitleOption:function(e){var t=$(e.currentTarget).attr("data-rf-value");"physical"===t?(this.displayLogical=!1,t=1):(this.displayLogical=!0,t=this.containerCollection.getMinRfValue()),this.rfValue=t,this.scalingFactor=1/this.rfValue,this.renderModelContent()},destroy:function(){this.containerSubscription.unsubscribe(),t.prototype.destroy.apply(this,arguments)}})}),define("text!templates/basecomponents/vantagepoints/elements/summary/HardwareSummaryVantagePointColumn1View.html",[],function(){return'\x3c!-- Host count --\x3e\n<div class="n-label-column  n-label-column-inline">\n  <p class="n-label-column-title">\n    <%= countHosts %>\n  </p>\n  <p class="n-label-column-subtitle">\n    <%- entityHostName %>\n  </p>\n</div>\n\n\x3c!-- Block count --\x3e\n<div class="n-label-column  n-label-column-inline">\n  <p class="n-label-column-title">\n    <%= blocks.length %>\n  </p>\n  <p class="n-label-column-subtitle">\n    <%- entityBlockName %>\n  </p>\n</div>'}),define("text!templates/basecomponents/vantagepoints/elements/summary/HardwareSummaryVantagePointColumn2View.html",[],function(){return'\x3c!-- Hardware Model --\x3e\n<% if (modelVersions.length > 1) { %>\n  \x3c!-- Many Model Versions --\x3e\n  <div class="n-centerbox-content">\n    <ul class="n-label-column-list">\n      <% _.each(modelVersions, function (modelVersion) {\n           var model = modelVersion[0],\n               count = modelVersion[1]; %>\n          <li>\n            <p class="n-col-1" title="<%= model %>"><%= model %></p>\n            <p class="n-col-2">\n              <%= count + (count !== 1 ? \' Blocks\' : \' Block\') %>\n            </p>\n            <div class="n-clearfix"></div>\n          </li>\n      <% }) %>\n    </ul>\n  </div>\n<% } else { %>\n  \x3c!-- Only 1 model version --\x3e\n  <div class="n-label-column">\n    <% var onlyOneVersion = modelVersions.length === 1 ?\n             modelVersions[0][0] : \'N/A\';\n    %>\n    <p class="n-label-column-title n-version-one parent-version-column">\n        <span class="child-version-text"><%= onlyOneVersion %></span>\n    </p>\n    <p class="n-label-column-subtitle">\n      <%= i18n(\'CommonEntities.model\', \'model\') %>\n    </p>\n  </div>\n<% } %>'}),define("views/basecomponents/vantagepoints/elements/summary/HardwareSummaryVantagePointView",["views/basecomponents/vantagepoints/elements/SubviewVantagePointView","text!templates/basecomponents/vantagepoints/elements/summary/HardwareSummaryVantagePointColumn1View.html","text!templates/basecomponents/vantagepoints/elements/summary/HardwareSummaryVantagePointColumn2View.html","data/DataProperties","utils/AppConstants","utils/AppUtil"],function(e,t,i,n,s,a){"use strict";var r=_.template(t),o=_.template(i);return e.extend({name:"HardwareSummaryVantagePointView",className:"n-vantage-point-summary-content",enableColumn:!0,numberOfColumns:2,renderModel:function(e){this.model=e,this.renderModelContent()},renderModelContent:function(){var e,t,i;e=this.model.get(n.CLUSTER_BLOCK_SERIALS),t=this.model.get(n.CLUSTER_NUM_NODES),i=this.model.getModelVersions();var l={blocks:e,modelVersions:i,countHosts:t,entityHostName:a.getEntityNameFromCount(s.ENTITY_HOST,t),entityBlockName:a.getEntityNameFromCount(s.ENTITY_BLOCK,e.length)};this.updateColumnContent(1,!1,r(l)),this.updateColumnContent(2,l.modelVersions.length>1,o(this.vtOptions(l))),this.dynamicFontSizingModelVersion()},dynamicFontSizingModelVersion:function(){for(var e=parseInt(this.$(".child-version-text").css("font-size"));this.$(".parent-version-column").width()<this.$(".child-version-text").width();){if(e<14){this.$(".parent-version-column").addClass("-wrap-model-num");break}this.$(".child-version-text").css("font-size",e--)}}})}),define("models/ha/AcropolisHAModel",["models/AcropolisModel","data/DataURLConstants","managers/ClusterManager","utils/AppConstants"],function(e,t,i,n){"use strict";var s={ENABLE:"failoverEnabled",HOST_FAILURES_TO_TOLERATE:"numHostFailuresToTolerate",HA_STATE:"haState"};return e.extend({DP:s,urlRoot:t.MGMT_HA,name:"AcropolisHAModel",getEnable:function(){return this.get(s.ENABLE)},setEnable:function(e){this.set(s.ENABLE,e)},getHostFailuresToTolerate:function(){return this.get(s.HOST_FAILURES_TO_TOLERATE)},setHostFailuresToTolerate:function(e){this.set(s.HOST_FAILURES_TO_TOLERATE,e)},toJSON:function(){return{enableFailover:this.getEnable(),numHostFailuresToTolerate:this.getHostFailuresToTolerate()}},isEqual:function(e){return _.isEqual(this.attributes,e.attributes)},setMessage:function(e){this.msg.action="update",this.msg.entityMsg="",this.msg.entityType="",this.msg.entityName="VM high availability on the cluster",this.msg.suppressLink=!0},onTaskFailed:function(){var e="Failed to update VM high availability on the cluster "+(i.getCurrentClusterName()||"this cluster")+".";this.showClientNotification(n.NOTIFY_ERROR,e)},onTaskSucceeded:function(){var e="VM high availability settings for "+(i.getCurrentClusterName()||"this cluster")+" have been updated.";this.showClientNotification(n.NOTIFY_SUCCESS,e)}},{DP:s})}),
define("text!templates/basecomponents/vantagepoints/elements/summary/VMSummaryVantagePointColumn1View.html",[],function(){return'\x3c!-- VM count --\x3e\n<div class="n-label-column">\n  <p class="n-label-column-title">\n    <%= total %>\n  </p>\n  <p class="n-label-column-subtitle"><%- totalLabel %></p>\n</div>'}),define("text!templates/basecomponents/vantagepoints/elements/summary/VMSummaryVantagePointColumn2View.html",[],function(){return'\x3c!-- VM States --\x3e\n<div id="haStatusWrap" class="ha-wrapper">\n  <span id="haLabel" class="ha-label">HA Status</span>\n  <span id="haStatus" class="ha-status"></span>\n  <div class="n-clearfix"></div>\n</div>\n<ul class="n-label-column-list">\n  <% _.each(list, function(item) { %>\n    <li>\n      <p class="n-col-1">\n        <a title="<%- i18n(\'powerStates.\' +\n            item.label.toLowerCase(), item.label) %>"\n           class="n-vm-state-icon n-<%= item.label.toLowerCase()\n        %>"></a>\n        <%- i18n(\'powerStates.\' +\n          item.label.toLowerCase(), item.label) %>\n      </p>\n      <p class="n-col-2"><%= item.count %></p>\n      <div class="n-clearfix"></div>\n    </li>\n  <% }); %>\n</ul>\n'}),define("views/basecomponents/vantagepoints/elements/summary/VMSummaryVantagePointView",["views/basecomponents/vantagepoints/elements/SubviewVantagePointView","models/ha/AcropolisHAModel","text!templates/basecomponents/vantagepoints/elements/summary/VMSummaryVantagePointColumn1View.html","text!templates/basecomponents/vantagepoints/elements/summary/VMSummaryVantagePointColumn2View.html","managers/AccessManager","managers/ClusterManager","utils/AppConstants","utils/HypervisorUtil"],function(e,t,i,n,s,a,r,o){"use strict";var l={DISABLED:"ha-disabled",UNRESERVED:"ha-unreserved",ERROR:"ha-error",HEALTHY:"ha-healthy",WARNING:"ha-warning"},c=_.template(i),u=_.template(n);return e.extend({className:"n-vantage-point-summary-content",name:"VMSummaryVantagePointView",enableColumn:!0,numberOfColumns:2,modelEvents:{"change haModel":"_renderHAStatus"},initialize:function(){e.prototype.initialize.apply(this,arguments),this.haModel=new t,_.bindAll(this,"_renderHAStatus")},renderModel:function(e){this.model=e||this.model,this.renderModelContent()},renderModelContent:function(){var e={},t=this.model.getCountObjects(),i=this.model.getTotalCountObject();e.list=t,e.total=i.count,e.totalLabel=this.i18n("vms"),this.$("#haStatusWrap").tooltip("destroy"),this.updateColumnContent(1,!1,c(this.vtOptions(e))),this.updateColumnContent(2,!0,u(this.vtOptions(e))),this.renderHAStatus()},renderHAStatus:function(){o.isAcropolisEnabled(a.getCurrentClusterId())&&s.isFFEnabled(r.FFLAGS.UI_ACROPOLIS)?(this.$("#haStatusWrap").show(),this.haModel.startPolling({alwaysTriggerChange:!0})):this.$("#haStatusWrap").hide()},_renderHAStatus:function(){var e,t,i,n=this.haModel.get(this.haModel.DP.HA_STATE),s=this.haModel.get(this.haModel.DP.HOST_FAILURES_TO_TOLERATE),a="HA Status",o=_.map(l,function(e){return e}).join(" ");if(n===r.HA_STATE.DISABLED)e=l.DISABLED,t="Disabled",i="High availability is disabled on this cluster.";else if(0===this.haModel.get(this.haModel.DP.HOST_FAILURES_TO_TOLERATE))e=l.UNRESERVED,a=this.i18n("availability"),t=this.i18n("best_effort"),i=this.i18n("best_effort_tooltip");else switch(n){case r.HA_STATE.BEST_EFFORT:e=l.ERROR,t=this.i18n("status.critical"),i="Please visit alerts page for details.";break;case r.HA_STATE.HIGHLY_AVAILABLE:e=l.HEALTHY,t=this.i18n("status.ok"),i="Protected against "+(1===s?" one node failure.":" two node failures.");break;case r.HA_STATE.HEALING:e=l.WARNING,t=this.i18n("healing"),i="VMs are migrating or restarting in order to get back to a highly available state.";break;default:e=l.WARNING,t=this.i18n("unknown")}this.$("#haStatusWrap").removeClass(o).addClass(e),this.$("#haLabel").text(a),this.$("#haStatus").text(t),this.$("#haStatusWrap").tooltip("destroy").tooltip({title:i,placement:"bottom",container:"body"})},onStartServices:function(){this.isResume&&this.renderHAStatus(),e.prototype.onStartServices.apply(this,arguments)},onStopServices:function(){this.$("#haStatusWrap").tooltip("destroy"),this.haModel.stopPolling(),this.isResume=!0,e.prototype.onStopServices.apply(this,arguments)}})}),define("text!templates/basecomponents/vantagepoints/elements/summary/DRSummaryVantagePointColumn1View.html",[],function(){return'\x3c!-- Remote site count --\x3e\n<div class="n-label-column  n-label-column-inline">\n  <p class="n-label-column-title">\n    <%= countRemoteSite %>\n  </p>\n  <p class="n-label-column-subtitle">\n    <%- entityRemoteName %>\n  </p>\n</div>'});define("text!templates/basecomponents/vantagepoints/elements/summary/DRSummaryVantagePointColumn2View.html",[],function(){return'\x3c!-- Protection Domains --\x3e\n<div class="n-centerbox-content">\n  <div class="n-pd-title">\n    <%- entityPDName %>\n  </div>\n  <ul class="n-label-column-list">\n    <li>\n      <p class="n-col-1">Async DR</p>\n      <p class="n-col-2"><%= countAsyncPD %></p>\n      <div class="n-clearfix"></div>\n    </li>\n    <li>\n      <p class="n-col-1">Metro Availability</p>\n      <p class="n-col-2"><%= countMetroPD %></p>\n      <div class="n-clearfix"></div>\n    </li>\n  </ul>\n\n</div>'}),define("views/basecomponents/vantagepoints/elements/summary/DRSummaryVantagePointView",["views/basecomponents/vantagepoints/elements/SubviewVantagePointView","text!templates/basecomponents/vantagepoints/elements/summary/DRSummaryVantagePointColumn1View.html","text!templates/basecomponents/vantagepoints/elements/summary/DRSummaryVantagePointColumn2View.html","models/dataprotection/RemoteSiteCollection","utils/AppConstants","utils/AppUtil"],function(e,t,i,n,s,a){"use strict";var r=_.template(t),o=_.template(i);return e.extend({className:"n-vantage-point-summary-content",enableColumn:!0,numberOfColumns:2,remoteSiteCollection:null,modelEvents:{"reset    remoteSiteCollection":"renderModelContent","error    remoteSiteCollection":"renderModelError","pending  remoteSiteCollection":"renderModelLoading"},initializeModels:function(){this.remoteSiteCollection=new n},renderModel:function(e){this.model=e,this.remoteSiteCollection.fetch()},renderModelContent:function(){var e,t,i;e=this.remoteSiteCollection.length,this.model.length&&(t=this.model.filter(function(e){return e.isMetroAvailPD()}).length,i=this.model.length-t);var n={countRemoteSite:e||0,countAsyncPD:i||0,countMetroPD:t||0,entityRemoteName:a.getEntityNameFromCount(s.ENTITY_REMOTE_SITE,e),entityPDName:a.getEntityNameFromCount(s.ENTITY_PROTECTION_DOMAIN,this.model.length||0)};this.updateColumnContent(1,!1,r(n)),this.updateColumnContent(2,!1,o(n))}})}),define("text!templates/basecomponents/vantagepoints/elements/summary/HypervisorSummaryVantagePointColumn1View.html",[],function(){return"\x3c!-- Hypervisor type --\x3e\n<div class=\"n-label-column\">\n  <% if (hypervisors.length > 1) { %>\n    \x3c!-- Many hypervisors --\x3e\n    <p class=\"n-label-column-title  n-hypervisor-many\">\n      <%= hypervisors.length %>\n    </p>\n    <p class=\"n-label-column-subtitle\">\n      <%= i18n('hypervisors', 'hypervisors', \"CommonEntities\") %>\n    </p>\n  <% } else { %>\n    \x3c!-- Single hypervisor --\x3e\n    <p class=\"n-label-column-title  n-hypervisor-one\">\n      <%= hypervisors.length === 1 ? hypervisors[0] : i18n(\n        'n_a', 'N/A') %>\n    </p>\n    <p class=\"n-label-column-subtitle\">\n      <%= i18n('CommonEntities.hypervisor', 'hypervisor') %>\n    </p>\n  <% } %>\n</div>"}),define("text!templates/basecomponents/vantagepoints/elements/summary/HypervisorSummaryVantagePointColumn2View.html",[],function(){return'\x3c!-- Hypervsior version --\x3e\n<% if (versions.length > 1) { %>\n  \x3c!-- Many versions --\x3e\n  <div class="n-centerbox-content">\n    <ul class="n-label-column-list">\n      <% _.each(versions, function (versionModel) {\n           var version = versionModel[0],\n               count   = versionModel[1]; %>\n          <li>\n            <p class="n-col-1" title="<%= _.escape(version) %>">\n              <%- version %>\n            </p>\n            <p class="n-col-2">\n              <%= count + (count !== 1 ? \' Hosts\' : \' Host\') %>\n            </p>\n            <div class="n-clearfix"></div>\n          </li>\n      <% }); %>\n    </ul>\n  </div>\n<% } else { %>\n  \x3c!-- Only 1 version --\x3e\n  <div class="n-label-column  n-centerbox-content">\n    <% var onlyOneVersion = versions.length === 1 ? versions[0][0] : \'N/A\' %>\n    <p class="n-label-column-title  n-version-one\n      <%= onlyOneVersion.length > 18 ? \'n-version-small\' : \'\' %>">\n      <%- onlyOneVersion %> <%= hypervisorType %>\n    </p>\n    <p class="n-label-column-subtitle"><%= i18n("version", "VERSION") %></p>\n  </div>\n<% } %>'}),define("views/basecomponents/vantagepoints/elements/summary/HypervisorSummaryVantagePointView",["views/basecomponents/vantagepoints/elements/SubviewVantagePointView","text!templates/basecomponents/vantagepoints/elements/summary/HypervisorSummaryVantagePointColumn1View.html","text!templates/basecomponents/vantagepoints/elements/summary/HypervisorSummaryVantagePointColumn2View.html","models/genesis/LaJollaClusterModel","data/DataProperties","utils/AppConstants","utils/HypervisorUtil"],function(e,t,i,n,s,a,r){"use strict";var o=_.template(t),l=_.template(i);return e.extend({className:"n-vantage-point-summary-content",name:"HypervisorSummaryVantagePointView",enableColumn:!0,numberOfColumns:2,renderModel:function(e){this.model=e,this.renderModelContent()},renderModelContent:function(){var e=[],t=[],i=this;this.clusterManager.isClusterFFEnabled(a.FFLAGS.SUPPORT_PAGINATION)?(e=r.getHypervisorNames(this.model),t=r.getHypervisorVersions(this.model)):(e=this.model.getHypervisorNames(),t=this.model.getHypervisorVersions());var n={hypervisors:e,versions:t,hypervisorType:""};this.updateColumnContent(1,!1,o(this.vtOptions(n))),this.updateColumnContent(2,n.versions.length>1,l(this.vtOptions(n))),this.checkLajollaCapability(e,t,i)},checkLajollaCapability:function(e,t,i){var a=this.clusterManager.getCurrentClusterModel();if(a){if(r.hasHyperV(a.get(s.CLUSTER_UUID))){var o=new n;o.fetch({success:function(n,s){if(!0===o.getReturnResponse()){var a={hypervisors:e,versions:t,hypervisorType:"(CPS)"};i.updateColumnContent(2,!1,l(i.vtOptions(a)))}}})}}}})}),define("text!templates/basecomponents/vantagepoints/elements/summary/HypervisorSummaryVantagePointSingleColumnView.html",[],function(){return'\x3c!-- Hypervisor type --\x3e\n<div class="n-label-column">\n  <% if (hypervisors.length > 1) { %>\n    \x3c!-- Many hypervisors --\x3e\n    <p class="n-label-column-title  n-hypervisor-many">\n      <%= hypervisors.length %>\n    </p>\n\n  <% } else { %>\n    \x3c!-- Single hypervisor --\x3e\n    <p class="n-label-column-title  n-hypervisor-one">\n      <%= hypervisors.length === 1 ? hypervisors[0] : \'N/A\' %>\n    </p>\n    \x3c!-- <p class="n-label-column-subtitle">HYPERVISOR</p> --\x3e\n  <% } %>\n\n\n\n <p class="n-label-column-subtitle">\n  <% if (versions.length > 1) { %>\n    <% if (hypervisors.length > 1) { %>\n        <%= i18n(\'hypervisors\') %>\n    <% } else { %>\n        <%= i18ns(\'many_versions\', versions.length) %>\n    <% } %>\n\n    <span id="hTypeTooltip">\n      <%= Components.icon("question-tooltip", "-inline") %>\n    </span>\n  <% } else { %>\n      <%= i18ns(\'one_version\', versions[0][0], hypervisorType) %>\n  <% } %>\n  </p>\n</div>'}),define("views/basecomponents/datatables/DataTableTemplates",["utils/SVG"],function(e){"use strict";return{TABLE_GRP_HEADER:'<ul class="tableGrpHeader n-table-tab-buttons"></ul>',ENTITY_TAB:_.template('<li>             <a data-target="#<%= domID %>"                 actionTarget="<%= entity %>"                 class="buttonTab">               <%= entityName %>             </a>           </li>'),TABLE_GRP_BODY:'<div class="tableGrpBody  tab-content n-tab-content">             \x3c!-- tab contents go here... --\x3e           </div>',CHECKBOX_ROW:_.template('<input            type="checkbox"            class="checkboxDataRow n-datatable-checkbox"            value="<%= value %>"            <%= getQaDataTestId("select_row_checkbox") %>            <%= checked ? "checked" : "" %>          >'),CHECKBOX_DISABLED:_.template('<input              type="checkbox"              class="checkboxDisabled n-datatable-checkbox"              disabled="disabled"              <%= checked ? "checked" : "" %>            >'),RADIO_ROW:_.template('<input type="radio" class="radioDataRow n-datatable-radio"         name="<%= groupName %>"         value="<%= value %>">'),RADIO_ROW_LABEL:_.template('<label><%= Components.radio({name      : groupName,classes   : "radioDataRow  n-datatable-radio",value     : value}) %> <%= label %></label>'),INPUT_BOX:_.template('<input type="<%= inputType %>"                 class="n-datatable-input <%= className %>"                 name="<%= columnId %>" placeholder="<%= placeholder %>">'),CHECKBOX_SELECT_ALL:_.template('<div class="n-select-all">             <input              type="checkbox"              value="selectAll"              title="Select All"              class="checkboxSelectAll n-datatable-checkbox"              <%= getQaDataTestId("select_all_checkbox") %>            >          </div>'),HEALTH_ICON:_.template('<div class="count-badge-small         <%= healthIndicator.toLowerCase() %>-count-badge">&nbsp;</div>'),DETAILS_TABLE_CHECKBOX_SELECT_ALL:'<div class="n-details-select-all">             <input type="checkbox" value="selectAll"  title="Select All"                    class="checkboxSelectAll" >           </div>',LOADING:'<div class="n-loading-wrapper">           <div class="n-disable">            </div>           <div class="n-loading">             <div class="donut-loader-blue"></div>            Loading...            </div>         </div>',ERROR:_.template('<div class="n-error">             An error occurred.            <% if (typeof errorDetails !== "undefined") { %>               <a title="<%= errorDetails %>" tooltip="<%= errorDetails %>"              class="n-error-details">                 Show me why</a>            <% } %>          </div>'),MESSAGE:_.template('<div class="n-message">              <%= message %>           </div>'),CAUSE_AND_RESOLUTION:_.template('<a class="n-alert-doc-link causes" title=""  data-toggle="tooltip" data-id="<%= id %>" <% if (clusterUuid) { %> data-uuid="<%= clusterUuid %>"<% } %> data-severity="<%= severity %>">Cause</a><a class="n-alert-doc-link resolutions" title=""  data-toggle="tooltip" data-id="<%= id %>">Resolution</a>'),HYPERVISOR_TOOLTIP_TABLE:_.template('<table class="hypervisors-summary-tooltip-table"><tbody><% _.each(versions, function (versionModel) { %><% var version = versionModel[0]; %><% var count = versionModel[1]; %><tr><td><%= version %></td><td><%= AppUtil.pluralize("HypervisorSummaryHomeVantagePointView", "host","0 Hosts", "1 Host", "%d Hosts", count) %></td></tr><% }) %></tbody></table>'),DATATABLE:'<table class="baseDataTable display" cellpadding="0" cellspacing="0"              border="0" style="width: 100%">             \x3c!-- data rows go here... --\x3e           </table> ',BAR_HEADER:'<div class="n-header">            \x3c!-- Header left components go here... --\x3e            \x3c!-- Header right components go here... --\x3e           </div>',HEADER_LEFT:'<ul class="n-header-left">           </ul>',HEADER_RIGHT:'<ul class="n-header-right">           <li class="n-filter-settings n-filter-display"></li>            <li class="n-sep n-filter-display">              &middot;           </li>           <li class="n-help-container  n-help-display">              <span class="n-help-display-tooltip"></span>            </li>            <li class="n-sep  n-help-display">              &middot;           </li>            <li class="n-page-info-container">              <p class="n-page-info"></p>            </li>            <li class="n-sep">              &middot;           </li>           <li class="n-page-nav-container">              <a class="btn btnPrevious n-button-previous">                <i aria-hidden="true" data-icon="x"></i>              </a>              <a class="btn btnNext n-button-next" >                <i aria-hidden="true" data-icon="y"></i>              </a>            </li>            <li class="n-sep">              &middot;           </li>            <li class="n-settings-container">             <div class="dropdown pull-right">                <a class="btnSettings n-button-settings dropdown-toggle"                  data-toggle="dropdown">                  '+e.SVGIcon("C","gear-icon")+'\x3c!--                   [ This comment is fixing a positioning issue ]                 --\x3e<i aria-hidden="true" data-icon="z" class="-down-arrow"></i>                </a>                \x3c!-- User drop down menu --\x3e                <ul class="dropdown-menu dropdown-menu-right">                  <li>                    <a class="btnExport csv">                      Export CSV                    </a>                  </li>                  <li>                    <a class="btnExport json">                      Export JSON                    </a>                  </li>                </ul>              </div>            </li>           <li class="n-sep">              &middot;           </li>            <li class="n-table-filter-container">              <div class="n-table-filter-wrapper">                <i aria-hidden="true" data-icon="B" class="n-icon-search"></i>               <input class="n-table-filter tableFilter tableFilterChange"                       type="text" placeholder="search in table">              </div>            </li>          </ul>',PAGE_INFO_PAGES:_.template("<%= start %>&ndash;<%= end %> of <%= total %>"),PAGE_INFO_PAGE:_.template("<%= total %> <%= total > 1 ? AppUtil.getPluralEntityName(entityType) : AppUtil.getSingularEntityName(entityType) %>"),PAGE_INFO_NONE:_.template("No entities found"),PAGE_SELECT_ALL_LINK:_.template('<span class="selectAllLink" role="link">Select all <%= total %> rows.</span>'),PAGE_CLEAR_SELECTION_LINK:_.template('<span class="clearSelection" role="link">Clear selection.</span>'),ACTION_COUNT:'<span class="n-entity-count"></span>',ACTION_BUTTONS_ALERT:'<a class="btnAcknowledge btnAction btn">             <i class="glyphicon glyphglyphicon glyphicon-thumbs-up n-icon"></i>Acknowledge           </a>           <a class="btnResolve btnAction btn">             <i class="glyphicon glyphicon-ok n-icon"></i>Resolve           </a>',ACTION_BUTTONS_ALERT_ALL:'<a class="btnAcknowledgeAll btnAction btn">               <i class="glyphicon glyphicon-thumbs-up n-icon"></i>Acknowledge All           </a>             <a class="btnResolveAll btnAction btn">               <i class="glyphicon glyphicon-ok n-icon"></i>Resolve All           </a>',ACTION_BUTTONS_DELETE:'<a class="btnDelete btnAction btn">             <i class="glyphicon glyphicon-ok n-icon"></i>Delete           </a>',ACTION_BUTTONS_EVENT:'<a class="btnAcknowledge btnAction btn">               <i class="glyphicon glyphicon-thumbs-up n-icon"></i>Acknowledge             </a>',ACTION_BUTTONS_EVENT_ALL:'<a class="btnAcknowledgeAll btnAction btn">             <i class="glyphicon glyphicon-thumbs-up n-icon"></i>Acknowledge All         </a> ',FILTER_ALERT:'<ul class="n-filter-list  n-filter-alert-list">           <li>              <input type="checkbox" data-filter="resolved">             <span class="n-checkbox-label">Include Resolved</span>            </li>          </ul>          <div class="n-clearfix"></div>',FILTER_RECOVERY_POINT:_.template('<ul class="n-filter-list  n-filter-snapshot-list">           <% if (showRemoteRecoveryPointCheckbox) { %>            <li>              <input type="checkbox" data-filter="remote">             <span class="n-checkbox-label">               <%= remoteRPTitle %></span>            </li>            <% } %>          </ul>          <div class="n-clearfix"></div>'),FILTER_RECOVERY_PLAN_JOB:_.template('<ul class="n-filter-list  n-filter-queued-task-list">           <li>              <input type="checkbox" data-filter="queued">             <span class="n-checkbox-label">               <%= queuedTaskTitle %></span>            </li>          </ul>          <div class="n-clearfix"></div>'),FILTER_SNAPSHOT:'<ul class="n-filter-list  n-filter-snapshot-list">            <li>               <input type="checkbox" data-filter="expired">              <span class="n-checkbox-label">Include Expired</span>             </li>           </ul>           <div class="n-clearfix"></div>',FILTER_VM:'<ul class="n-filter-list  n-filter-vm-list">            <li>               <input type="checkbox" data-filter="controllerVm">              <span class="n-checkbox-label">Include Controller VMs</span>             </li>           </ul>           <div class="n-clearfix"></div>',DETAILS_TABLE:'<table class="detailsTable n-details-table display"              cellpadding="0" cellspacing="0"              border="0" style="width: 100%">             \x3c!-- data rows go here... --\x3e           </table> ',HOVER_TABLE_CELL:_.template('<span class="n-no-style n-cell-popover <%=customClassName%>" data-toggle="popover" <%=dataIdAttr%> ><%= value %></span>'),CONTAINER_TABLE_CELL:_.template('<div class="container-table-cell" style="display: inline-block; width:<%=width%>"><%= value %></div>'),PD_METRO_AVAIL_ENABLED_TABLE_CELL:'<div title="Storage containers are in sync">Enabled (in sync)</div>',PD_METRO_AVAIL_SYNCING_TABLE_CELL:'<span class="n-pd-in-sync" title="Synchronizing"></span><span> Synchronizing...<span>',PD_METRO_AVAIL_INACTIVE_TABLE_CELL:_.template('<div class="n-pd-inactive" title="<%= label %>"><%= label %></div>'),RS_DEPLOYING_TABLE_CELL:'<div class="donut-loader-blue"></div>',RS_SSH_TUNNEL_WARNING_ICON:'<span class="ssh-tunnel-warning-tooltip" data-toggle="tooltip"><span class="n-tooltip-circle-small">!</span></span>'}}),define("views/basecomponents/vantagepoints/elements/summary/HypervisorSummaryHomeVantagePointView",["views/basecomponents/vantagepoints/elements/SubviewVantagePointView","text!templates/basecomponents/vantagepoints/elements/summary/HypervisorSummaryVantagePointSingleColumnView.html","models/genesis/LaJollaClusterModel","views/basecomponents/datatables/DataTableTemplates","data/DataProperties","utils/AppConstants","utils/HypervisorUtil","components/Components"],function(e,t,i,n,s,a,r,o){"use strict";var l=_.template(t);return e.extend({className:"n-vantage-point-summary-content",enableColumn:!0,numberOfColumns:1,name:"HypervisorSummaryHomeVantagePointView",renderModel:function(e){this.model=e,this.renderModelContent()},renderModelContent:function(){var e=[],t=[],i=this;this.clusterManager.isClusterFFEnabled(a.FFLAGS.SUPPORT_PAGINATION)?(e=r.getHypervisorNames(this.model),t=r.getHypervisorVersions(this.model)):(e=this.model.getHypervisorNames(),t=this.model.getHypervisorVersions());var s={hypervisors:e,versions:t,hypervisorType:"",Components:o};this.updateColumnContent(1,!1,l(this.vtOptions(s)));var c=n.HYPERVISOR_TOOLTIP_TABLE(this.vtOptions({versions:t}));this.$el.find("#hTypeTooltip").tooltip({html:!0,container:".n-vantage-point-summary-hypervisor-home",title:c}),this.checkLajollaCapability(e,t,i)},checkLajollaCapability:function(e,t,n){var a=this.clusterManager.getCurrentClusterModel();if(a){if(r.hasHyperV(a.get(s.CLUSTER_UUID))){var o=new i;o.fetch({success:function(i,s){if(!0===o.getReturnResponse()){var a={hypervisors:e,versions:t,hypervisorType:"("+n.i18n("cps")+")"};n.updateColumnContent(1,!1,l(n.vtOptions(a)))}}})}}}})}),define("text!templates/basecomponents/vantagepoints/elements/summary/GenericSummaryVantagePointColumn1View.html",[],function(){return'\x3c!-- Total --\x3e\n<div class="n-label-column  n-label-column-inline">\n  <p class="n-label-column-title">\n    <%= total %>\n  </p>\n  <p class="n-label-column-subtitle">\n    <%= totalLabel %>\n  </p>\n</div>'}),define("text!templates/basecomponents/vantagepoints/elements/summary/GenericSummaryVantagePointColumn2View.html",[],function(){return'\x3c!-- List --\x3e\n<div class="n-centerbox-content">\n  <ul class="n-label-column-list">\n     <% _.each(list, function(item) { %>\n     <li>\n         <p class="n-col-1" title="<%= item.label %>"><%- item.label %></p>\n         <p class="n-col-2"><%= item.count %></p>\n         <div class="n-clearfix"></div>\n     </li>\n    <% }); %>\n  </ul>\n</div>'}),define("views/basecomponents/vantagepoints/elements/summary/MulticlusterSummaryVantagePointView",["views/basecomponents/vantagepoints/elements/SubviewVantagePointView","text!templates/basecomponents/vantagepoints/elements/summary/GenericSummaryVantagePointColumn1View.html","text!templates/basecomponents/vantagepoints/elements/summary/GenericSummaryVantagePointColumn2View.html","data/DataProperties"],function(e,t,i,n){"use strict";var s=_.template(t),a=_.template(i);return e.extend({className:"n-vantage-point-summary-multicluster",enableColumn:!0,numberOfColumns:2,renderModel:function(e){this.model=e,this.renderModelContent()},renderModelContent:function(){if(this.$el.is(":visible")){var e={clusters:this.model.toJSON()};e.list=this.generateGenericSummaryArray(function(e){return"Acropolis&nbsp;"+e.get(n.CLUSTER_NOS_VERSION)}),e.listTitle="",e.totalLabel="CLUSTER(S)",e.listLabel="",e.total=this.model.length,this.updateColumnContent(1,!1,s(e)),this.updateColumnContent(2,!0,a(e))}},onStartServices:function(){this.model=this.clusterManager.getClusterCollection(),this.model.on("reset",this.renderModel,this),this.model.triggerUpdate()},onStopServices:function(){this.model.off("reset",this.renderModel,this)}})}),define("views/basecomponents/vantagepoints/elements/summary/MulticlusterVMSummaryVantagePointView",["views/basecomponents/vantagepoints/elements/SubviewVantagePointView","text!templates/basecomponents/vantagepoints/elements/summary/GenericSummaryVantagePointColumn1View.html","text!templates/basecomponents/vantagepoints/elements/summary/GenericSummaryVantagePointColumn2View.html"],function(e,t,i){"use strict";var n=_.template(t),s=_.template(i);return e.extend({TOP_VMS_COUNT:3,className:"n-vantage-point-summary-content",enableColumn:!0,numberOfColumns:2,renderModel:function(e){this.model=e||this.model,this.renderModelContent()},renderModelContent:function(){var e={},t=this.model.getCountObjects(),i=this.model.getTotalCountObject();e.list=t.slice(0,this.TOP_VMS_COUNT),e.total=i.count,e.totalLabel="VM(s)",this.updateColumnContent(1,!1,n(e)),this.updateColumnContent(2,!0,s(e))}})}),define("views/basecomponents/vantagepoints/elements/summary/MulticlusterHardwareSummaryVantagePointView",["views/basecomponents/vantagepoints/elements/SubviewVantagePointView","text!templates/basecomponents/vantagepoints/elements/summary/GenericSummaryVantagePointColumn1View.html","text!templates/basecomponents/vantagepoints/elements/summary/GenericSummaryVantagePointColumn2View.html"],function(e,t,i){"use strict";var n=_.template(t),s=_.template(i);return e.extend({TOP_HOST_COUNT:3,className:"n-vantage-point-summary-content",enableColumn:!0,numberOfColumns:2,renderModel:function(e){this.model=e||this.model,this.renderModelContent()},renderModelContent:function(){var e={},t=this.model.getCountObjects(),i=this.model.getTotalCountObject();e.list=t.slice(0,this.TOP_VMS_COUNT),e.total=i.count,e.totalLabel="Host(s)",this.updateColumnContent(1,!1,n(e)),this.updateColumnContent(2,!0,s(e))}})}),define("text!templates/basecomponents/vantagepoints/elements/summary/MulticlusterHealthSummaryVantagePointView.html",[],function(){return'<div class="n-row-1">\n  <i class="n-health-icon  n-health-status"\n    aria-hidden="true" data-icon="I"></i>\n  <div class="n-health-score">\n    <div class="n-health-text">\n      <%= multiclusterHealthStatus %>\n    </div>\n  </div>\n</div>\n<div class="n-row-2">\n  <div class="antiscroll-wrap">\n    <div class="box-wrap">\n      <div class="antiscroll-inner">\n        <div class="box-inner  n-content-inner">\n          <ul class="n-list-many"></ul>\n        </div>\n      </div>\n    </div>\n  </div>\n</div>'}),define("views/basecomponents/vantagepoints/elements/summary/MulticlusterHealthSummaryVantagePointView",["views/basecomponents/vantagepoints/elements/SubviewVantagePointView","text!templates/basecomponents/vantagepoints/elements/summary/MulticlusterHealthSummaryVantagePointView.html","managers/ClusterManager","managers/NavigationManager","utils/AppConstants","utils/AppUtil","utils/AntiscrollUtil"],function(e,t,i,n,s,a,r){"use strict";var o=_.template(t),l=_.template('<li class="n-list-item" <%= attrs %>><span class="n-list-label"><%= clusterName %></span><span class="n-list-value n-health-status-<%= clusterHealthStatus.toLowerCase() %>"><%= clusterHealthStatus %></span><br/></li>');return e.extend({HEALTH_TEXT:"HEALTH",className:"n-vantage-point-summary-content",model:null,enableAntiscroll:!0,events:{"click  .n-list-item":"onClick"},renderModel:function(e){this.model=e,this.renderModelContent()},renderModelContent:function(){var e=this.model.getClusterHealthStatsModels();if(!this.model.length)return void this.$el.html('<span class="n-no-clusters">There are no registered clusters.</span>');var t=this.model.getMulticlusterHealthStatus();this.$el.html(o({multiclusterHealthStatus:t+" "+s.MULTICLUSTER_NAME.toUpperCase()+" "+this.HEALTH_TEXT}));var n="";_.each(_.keys(s.HEALTH_STATUS),function(e){n+=" n-health-status-"+e.toLowerCase()}),this.$("i.n-health-icon").removeClass(n),this.$(".n-health-text").removeClass(n),t&&(this.$("i.n-health-icon").addClass("n-health-status-"+t.toLowerCase()),this.$(".n-health-text").addClass("n-health-status-"+t.toLowerCase())),_.each(e,function(e){this.$(".n-list-many").append(l({model:e.toJSON(),clusterHealthStatus:e.getClusterHealthStatus(),clusterName:i.getNameById(e.getClusterUuid()),attrs:a.createActionAttr(s.ENTITY_MULTICLUSTER_HEALTH,s.ACTION_DETAILS,e)}))},this),r.triggerAntiScroll(this)},onStartServices:function(){this.model=this.clusterManager.getClusterCollection(),this.model.on("reset",this.renderModel,this),this.model.triggerUpdate()},onStopServices:function(){this.model.off("reset",this.renderModel,this)},onClick:function(e){n.navigateToPageByElement(s.PAGE_MC_HEALTH,s.SUBPAGE_TABLE,e.currentTarget)}})}),define("views/basecomponents/vantagepoints/elements/summary/HealthVantagePointTemplates",[],function(){"use strict";return{CUSTOMIZED_CONTENT_COLUMN:'<div class="n-content-column-customized">           <div class="n-column-content n-column-content-1">            </div>            <div class="n-column-content n-column-content-2">            </div>          </div>',SINGLE_CLUSTER_HEALTH_STATUS:_.template('<div class="n-label-column  n-health-status-container">            <div class="n-label-column-title">              <%= SVG.SVGIcon("I", "n-health-icon " + styleStatus) %>           </div>            <div class="n-label-column-subtitle  n-health-status                <%= styleStatus %>">              <%= clusterHealthStatus %>            </div>          </div>'),SINGLE_CLUSTER_ENTITY_SUMMARY_HEALTH:_.template('<div class="health-container">            <div class="entityTypesSummary">              <%= entityHealthSummary %>            </div>         </div>')}}),define("text!templates/pages/cluster/EntityTypesSummaryRow.html",[],function(){
return'<div id=\'ets-<%=entityType%>\' class=\'entityTypeStats\'>\n  <div class="entityTypeStats-header" stream-action="show"\n       stream-target="<%= entityTypeName %> entity">\n    <div class="pull-right">\n      <div class="count-box count-box-critical">\n        <div class="count-badge-small critical-count-badge">&nbsp;</div>\n        <span class="count-box-number">\n          <%= criticalCount %>\n        </span>\n      </div>\n      <div class="count-box count-box-warning">\n        <div class="count-badge-small warning-count-badge">&nbsp;</div>\n        <span class="count-box-number">\n          <%= warningCount %>\n        </span>\n      </div>\n      <div class="count-box count-box-good">\n        <div class="count-badge-small good-count-badge">&nbsp;</div>\n        <span class="count-box-number">\n          <%= okCount %>\n        </span>\n      </div>\n    </div>\n    <div class=\'entity-type-name-back\'>\n      <a class="back-icon n-icon">x</a>\n    </div>\n    <div class=\'entity-type-name\' title="<%= entityTypeName %>">\n      <%= entityTypeName %>\n    </div>\n    <% if (totalCount != null) { %>\n    <div class="count-badge-small total-count-badge">\n      <%= totalCount %>\n    </div>\n    <% } %>\n  </div>\n</div>\n<div class=\'groups-container\' id=\'<%=groupContainerId%>\'>\n  <%= groupingsHTML %>\n</div>'}),define("views/basecomponents/vantagepoints/elements/summary/HealthSummaryVantagePointView",["views/basecomponents/vantagepoints/elements/SubviewVantagePointView","views/basecomponents/vantagepoints/elements/summary/HealthVantagePointTemplates","text!templates/pages/cluster/EntityTypesSummaryRow.html","models/cluster/ClusterHealthStatsModel","data/DataProperties","utils/AppConstants","utils/AppUtil","utils/StatsUtil","managers/HealthManager","managers/NavigationManager"],function(e,t,i,n,s,a,r,o,l,c){"use strict";var u=_.template(i);return e.extend({className:"n-vantage-point-summary-content",name:"HealthSummaryVantagePointView",events:{"click  .entityTypeStats":"onEntityTypeClick","click  .n-label-column-title":"onClick"},renderModel:function(e){this.model=e||this.model||new n,this.renderModelContent()},renderModelContent:function(){var e="",i="",n="";switch(0===this.$(".n-column-content").length&&this.$el.html(t.CUSTOMIZED_CONTENT_COLUMN),this.model.getClusterHealthStatus()){case a.HEALTH_STATUS.GOOD:e="n-health-status-good";break;case a.HEALTH_STATUS.WARNING:e="n-health-status-warning";break;case a.HEALTH_STATUS.CRITICAL:e="n-health-status-critical"}var l=this.i18n("status."+this.model.getClusterHealthStatus().toLowerCase(),this.model.getClusterHealthStatus());i=t.SINGLE_CLUSTER_HEALTH_STATUS(this.vtOptions({clusterHealthStatus:l,styleStatus:e})),this.updateColumnContent(1,!1,i);var c=[];_.each(this.model.toJSON(),function(e,t){e&&e[s.HEALTH_SUMMARY]&&(e.key=t,c.push(e))}),c=_.sortBy(c,function(e){return-r.calculateHealthScore(e.healthSummary)}),_.each(c,function(e){var t=e[s.HEALTH_SUMMARY][s.HEALTH_STATUS_VALUES.GOOD]||0,i=e[s.HEALTH_SUMMARY][s.HEALTH_STATUS_VALUES.WARNING]||0,l=e[s.HEALTH_SUMMARY][s.HEALTH_STATUS_VALUES.CRITICAL]||0;0!==t+i+l&&(n+=u({entityType:e.key,entityTypeName:e.key===a.ENTITY_CLUSTER?this.i18n("services"):r.getPluralEntityName(e.key),okCount:t,warningCount:i,criticalCount:l,totalCount:null,groupingsHTML:"",groupContainerId:"",StatsUtil:o}))},this),n=t.SINGLE_CLUSTER_ENTITY_SUMMARY_HEALTH({entityHealthSummary:n}),this.updateColumnContent(2,!0,n)},onClick:function(e){c.navigateToPage(a.PAGE_CLUSTER_HEALTH)},onEntityTypeClick:function(e){var t=$(e.currentTarget),i=t.attr("id")||"",n=i.split("-");if(n.length>1){var s=n[1],r=c.createNavigationContext(s,{});c.navigateToPage(a.PAGE_CLUSTER_HEALTH,null,{contextId:r})}},onStartServices:function(){l.registerHealthListener("change",this.renderModelContent,this),e.prototype.onStartServices.apply(this,arguments)},onStopServices:function(){l.unregisterHealthListener("change",this.renderModelContent,this),e.prototype.onStopServices.apply(this,arguments)}})}),define("text!templates/basecomponents/vantagepoints/elements/summary/ResiliencySummaryVantagePointView.html",[],function(){return'<div class="n-content-column-customized">\n<%\n  for (var i = 0; i < numCells && viewData[i]; i++) {\n    if (i === 0) { // special case for first one\n%>\n      <div class="n-row n-row-1 n-max-row-<%= numCells %>"\n           action="show"\n           actionTargetId="<%= viewData[i].type%>"\n           actionTarget="resiliency_status"\n           tooltip="<%= viewData[i].tooltip || \'\' %>">\n        <div class="n-label-column">\n          <p class="n-label-column-title <%= viewData[i].status %>"\n              <%= getQaDataTestId(\'status\') %>>\n            <%= viewData[i].value %>\n          </p>\n          <div class="n-label-column-subtitle">\n            <%- viewData[i].label || "" %>\n          </div>\n        </div>\n      </div>\n\n<% } else { %>\n\n      <div class="n-row n-row-2" action="show"\n           actionTargetId="<%= viewData[i].type%>"\n           actionTarget="resiliency_status"\n           tooltip="<%= viewData[i].tooltip || \'\' %>">\n        <div class="n-label-column">\n          <div class="pull-left">\n            <span class="status <%= viewData[i].status %>"></span>\n            <span class="n-label-column-subtitle left">\n              <%- viewData[i].label || "" %>\n            </span>\n          </div>\n          <div class="pull-right">\n            <span class="n-label-column-title boxed">\n              <%= viewData[i].value %>\n            </span>\n          </div>\n        </div>\n      </div>\n\n<% } };%>\n</div>'}),define("views/basecomponents/vantagepoints/elements/summary/ResiliencyStatusSummaryVantagePointView",["views/basecomponents/vantagepoints/elements/SubviewVantagePointView","data/DataProperties","utils/AppConstants","managers/ActionManager","managers/I18nManager","text!templates/basecomponents/vantagepoints/elements/summary/ResiliencySummaryVantagePointView.html"],function(e,t,i,n,s,a){"use strict";var r=_.template(a);return e.extend({BLOCK_STATUS_LABEL_PREFIX:"Block",RACK_STATUS_LABEL_PREFIX:"Rack",RESILIENCY_STATUS_RESULT:{OK:s.t(i.I18N_NAMES.common,"status.ok","ok"),YES:s.t(i.I18N_NAMES.common,"status.yes","yes"),NO:s.t(i.I18N_NAMES.common,"status.no","no"),COMPUTING:s.t(i.I18N_NAMES.common,"status.computing","computing...")},RESILIENCY_LABELS:{STATUS_NA:s.t("RESILIENCY_LABELS","status_na","Data Resiliency status not available"),STATUS_WARNING:s.t("RESILIENCY_LABELS","status_warning","Data Resiliency at risk"),STATUS_OK:s.t("RESILIENCY_LABELS","status_ok","Data Resiliency possible"),STATUS_CRITICAL:s.t("RESILIENCY_LABELS","status_critical","Data Resiliency not possible"),REBUILD_CAPACITY:s.t("RESILIENCY_LABELS","rebuild_capacity","Rebuild capacity available"),AUTO_HEAL_BACK:s.t("RESILIENCY_LABELS","auto_heal_back","Auto rebuild in progress")},className:"n-vantage-point-summary-content",name:"ResiliencyStatusSummaryVantagePointView",resiliencyCollection:null,numCells:2,enableRA:!1,events:{"click     .n-row":"onClickContent"},initialize:function(){e.prototype.initialize.apply(this,arguments);var t=this.getCurrentClusterModel();this.enableRA=t&&t.isFFEnabled(i.FFLAGS.RA_DOMAIN_AWARENESS)},renderModel:function(e){this.resiliencyCollection=e,this.renderModelContent()},getDomainTypes:function(){return Object.keys(i.RESILIENCY_DOMAIN_TYPE).map(function(e){return i.RESILIENCY_DOMAIN_TYPE[e]})},getSummaryMap:function(e){var t=this;e||(e=this.getDomainTypes());var i={};return e.forEach(function(e){var n=t.resiliencyCollection.getSummaryRA(e);n&&(i[e]=n)}),i},getResiliencyDetails:function(){var e=this.getDomainTypes(),n=this.getSummaryMap(e),s=this.getCurrentClusterModel();if(this.isDiskFTOnlyMode()){var a=i.RESILIENCY_DOMAIN_TYPE.DISK,r=n[i.RESILIENCY_DOMAIN_TYPE.DISK],o=this.getFaultToleranceTooltipMessage(r[t.RESILIENCY_FAULT_TOLERANCE_MESSAGES],a),l=r[t.RESILIENCY_FAULT_TOLERANCE_STATUS],c=this.getStatusDetails(l);return{label:c.label,value:c.value,status:l,type:i.RESILIENCY_DOMAIN_TYPE.DISK,tooltip:o}}for(var u=!1,d=e.length;d--;){var h=e[d],p=n[h];if(p&&p[t.RESILIENCY_UNDER_COMPUTATION]){u=!0;break}}var _=s.get(t.CLUSTER_FAULT_TOLERANCE_DOMAIN),T=n[_];if(u)return{label:null,value:this.RESILIENCY_STATUS_RESULT.COMPUTING,status:T[t.RESILIENCY_FAULT_TOLERANCE_STATUS],type:_,tooltip:this.getFaultToleranceTooltipMessage(T[t.RESILIENCY_FAULT_TOLERANCE_MESSAGES],_)};var E={status:T[t.RESILIENCY_FAULT_TOLERANCE_STATUS],type:_,tooltip:this.getFaultToleranceTooltipMessage(T[t.RESILIENCY_FAULT_TOLERANCE_MESSAGES],_)};if(T[t.RESILIENCY_FAULT_TOLERANCE_STATUS]===i.RESILIENCY_STATUS.NONE){var S=null;return s&&s.get(t.CLUSTER_NUM_NODES)<=1&&(S=this.i18n("no_single_node")),Object.assign({},E,{label:this.RESILIENCY_LABELS.STATUS_NA,value:i.STATS_NOT_APPLICABLE,tooltip:E.tooltip||S})}var g=T[t.RESILIENCY_FAULT_TOLERANCE_STATUS],A=this.getStatusDetails(g),m="";return i.RESILIENCY_DOMAIN_TYPE.BLOCK===_?m=this.BLOCK_STATUS_LABEL_PREFIX+" ":i.RESILIENCY_DOMAIN_TYPE.RACK===_&&(m=this.RACK_STATUS_LABEL_PREFIX+" "),Object.assign({},E,{label:""+m+A.label,value:A.value})},getRebuildCapacityDetails:function(e,n){var s=null,a=null;return n[t.RESILIENCY_IS_REBUILD_CAPACITY]?(s=this.RESILIENCY_STATUS_RESULT.YES,a=i.RESILIENCY_STATUS.GOOD):(s=this.RESILIENCY_STATUS_RESULT.NO,a=i.RESILIENCY_STATUS.WARNING),{label:this.RESILIENCY_LABELS.REBUILD_CAPACITY,value:s,status:a,type:e,tooltip:n[t.RESILIENCY_FREE_SPACE_MESSAGE]}},getAutoHealBackDetails:function(e,n){var s=null,a=null;return n[t.RESILIENCY_IS_AUTO_HEALBACK_PROGRESS]?(s=this.RESILIENCY_STATUS_RESULT.YES,a=i.RESILIENCY_STATUS.GOOD):(s=this.RESILIENCY_STATUS_RESULT.NO,a=i.RESILIENCY_STATUS.WARNING),{label:this.RESILIENCY_LABELS.AUTO_HEAL_BACK,value:s,status:a,type:e,tooltip:null}},getStatusDetails:function(e){var t=null,n=null;switch(n=e===i.RESILIENCY_STATUS.GOOD?this.RESILIENCY_STATUS_RESULT.OK:e||i.STATS_NOT_APPLICABLE,e){case i.RESILIENCY_STATUS.GOOD:t=this.RESILIENCY_LABELS.STATUS_OK;break;case i.RESILIENCY_STATUS.WARNING:t=this.RESILIENCY_LABELS.STATUS_WARNING;break;case i.RESILIENCY_STATUS.CRITICAL:t=this.RESILIENCY_LABELS.STATUS_CRITICAL;break;default:t=this.RESILIENCY_LABELS.STATUS_NA}return{value:n,label:t}},renderModelContentRA:function(){this.$(".badge-container").tooltip("destroy");for(var e=this.getCurrentClusterModel(),n=e.get(t.CLUSTER_FAULT_TOLERANCE_DOMAIN),s=this.getDomainTypes(),a=this.getSummaryMap(s),o=a[n],l=2,c=!0,u=s.length;u--;){var d=s[u],h=a[d];if(h&&h[t.RESILIENCY_FAULT_TOLERANCE_STATUS]){c=!1;break}}c&&(l=1),o[t.RESILIENCY_FAULT_TOLERANCE_STATUS]!==i.RESILIENCY_STATUS.GOOD&&(l=3),0!==this.$(".n-column-content").length&&this.numCells===l||(this.numCells=l);var p=[this.getResiliencyDetails()];l>1&&p.push(this.getRebuildCapacityDetails(n,o)),l>2&&p.push(this.getAutoHealBackDetails(n,o)),this.$el.html(r(this.vtOptions({viewData:p,numCells:this.numCells})));var _=$("body");this.$(".n-row").each(function(){var e=this,t=$(this).attr("tooltip");$.trim(t).length&&($(this).tooltip({title:t,placement:"right",trigger:"hoverable",html:"true",container:_}),_.off("click",".view-more").on("click",".view-more",function(t){e.onClickContentRA(t)}))})},renderModelContent:function(){var e=this.getCurrentClusterModel(),n=e&&e.get(t.CLUSTER_FAULT_TOLERANCE_DOMAIN);if(this.enableRA&&n)return this.renderModelContentRA();var s,a,o,l=!1,c=2;this.$(".badge-container").tooltip("destroy"),s=this.resiliencyCollection.getSummary(i.RESILIENCY_DOMAIN_TYPE.NODE),e&&this.isDiskFTOnlyMode()&&(o=this.resiliencyCollection.getSummary(i.RESILIENCY_DOMAIN_TYPE.DISK),o.faultToleranceStatus!==i.RESILIENCY_STATUS.GOOD&&(l=!0,c++)),e.get(t.CLUSTER_BLOCK_AWARE_PLACEMENT)&&(a=this.resiliencyCollection.getSummary(i.RESILIENCY_DOMAIN_TYPE.BLOCK)),s.faultToleranceStatus===i.RESILIENCY_STATUS.NONE&&o.faultToleranceStatus===i.RESILIENCY_STATUS.NONE?c=1:s.faultToleranceStatus===i.RESILIENCY_STATUS.GOOD||this.isDiskFTOnlyMode()||(l=!0,c++),0!==this.$(".n-column-content").length&&this.numCells===c||(this.numCells=c);var u=this.getViewDataArray(s,a,o,l);this.$el.html(r(this.vtOptions({viewData:u,numCells:this.numCells})));var d=this;this.$(".n-row").each(function(){var e=$(this).attr("tooltip");$.trim(e).length&&($(this).tooltip({title:e,placement:"right",trigger:"hoverable",html:"true",container:$("body")}),$("body").off("click",".view-more").on("click",".view-more",function(e){d.onClickContent(e)}))})},getFaultToleranceTooltipMessage:function(e,t){return e&&e.length>0?e.length>1?e[0].concat("<br/><a class='view-more' action='show' actiontargetid='"+t+"' actiontarget='resiliency_status'>").concat(e.length-1+" more message(s)...</a> "):e[0]:""},getViewDataArray:function(e,n,s,a){var r,o,l,c,u=[],d="";if(e[t.RESILIENCY_UNDER_COMPUTATION]||n&&n[t.RESILIENCY_UNDER_COMPUTATION])return c=i.RESILIENCY_DOMAIN_TYPE.NODE,u.push({label:null,value:this.RESILIENCY_STATUS_RESULT.COMPUTING,status:e[t.RESILIENCY_FAULT_TOLERANCE_STATUS],type:c,tooltip:this.getFaultToleranceTooltipMessage(e[t.RESILIENCY_FAULT_TOLERANCE_MESSAGES],c)}),u;if(r=e[t.RESILIENCY_FAULT_TOLERANCE_STATUS]===i.RESILIENCY_STATUS.GOOD?this.RESILIENCY_STATUS_RESULT.OK:e[t.RESILIENCY_FAULT_TOLERANCE_STATUS],e[t.RESILIENCY_FAULT_TOLERANCE_STATUS]===i.RESILIENCY_STATUS.NONE||this.isDiskFTOnlyMode()){if(s)c=i.RESILIENCY_DOMAIN_TYPE.DISK,l=this.getFaultToleranceTooltipMessage(s[t.RESILIENCY_FAULT_TOLERANCE_MESSAGES],c),o=s[t.RESILIENCY_FAULT_TOLERANCE_STATUS],o===i.RESILIENCY_STATUS.GOOD?(d+=this.RESILIENCY_LABELS.STATUS_OK,r=this.RESILIENCY_STATUS_RESULT.OK):(d+=this.RESILIENCY_LABELS.STATUS_CRITICAL,r=s[t.RESILIENCY_FAULT_TOLERANCE_STATUS]),u.push({label:d,value:r,status:o,type:c,tooltip:l});else{var h=null,p=this.getCurrentClusterModel();p&&p.get(t.CLUSTER_NUM_NODES)<=1&&(h="Not applicable for single-node clusters."),c=i.RESILIENCY_DOMAIN_TYPE.NODE,u.push({label:this.RESILIENCY_LABELS.STATUS_NA,value:i.STATS_NOT_APPLICABLE,status:e[t.RESILIENCY_FAULT_TOLERANCE_STATUS],type:c,tooltip:this.getFaultToleranceTooltipMessage(e[t.RESILIENCY_FAULT_TOLERANCE_MESSAGES],c)||h})}return s[t.RESILIENCY_IS_REBUILD_CAPACITY]?(r=this.RESILIENCY_STATUS_RESULT.YES,o=i.RESILIENCY_STATUS.GOOD):(r=this.RESILIENCY_STATUS_RESULT.NO,o=i.RESILIENCY_STATUS.WARNING),u.push({label:this.RESILIENCY_LABELS.REBUILD_CAPACITY,value:r,status:o,type:i.RESILIENCY_DOMAIN_TYPE.DISK,tooltip:s[t.RESILIENCY_FREE_SPACE_MESSAGE]}),a&&(s[t.RESILIENCY_IS_AUTO_HEALBACK_PROGRESS]?(r=this.RESILIENCY_STATUS_RESULT.YES,o=i.RESILIENCY_STATUS.GOOD):(r=this.RESILIENCY_STATUS_RESULT.NO,o=i.RESILIENCY_STATUS.WARNING),u.push({label:this.RESILIENCY_LABELS.AUTO_HEAL_BACK,value:r,status:o,type:i.RESILIENCY_DOMAIN_TYPE.DISK,tooltip:null})),u}if(o=e[t.RESILIENCY_FAULT_TOLERANCE_STATUS],c=i.RESILIENCY_DOMAIN_TYPE.NODE,l=this.getFaultToleranceTooltipMessage(e[t.RESILIENCY_FAULT_TOLERANCE_MESSAGES],c),n){var _=e[t.RESILIENCY_FAULT_TOLERANCE_STATUS]===i.RESILIENCY_STATUS.GOOD,T=n[t.RESILIENCY_FAULT_TOLERANCE_STATUS]!==i.RESILIENCY_STATUS.GOOD;_&&T&&(d=this.BLOCK_STATUS_LABEL_PREFIX+" ",r=n[t.RESILIENCY_FAULT_TOLERANCE_STATUS]||i.STATS_NOT_APPLICABLE,o=n[t.RESILIENCY_FAULT_TOLERANCE_STATUS],c=i.RESILIENCY_DOMAIN_TYPE.BLOCK,l=this.getFaultToleranceTooltipMessage(n[t.RESILIENCY_FAULT_TOLERANCE_MESSAGES],c))}switch(o){case i.RESILIENCY_STATUS.GOOD:d+=this.RESILIENCY_LABELS.STATUS_OK;break;case i.RESILIENCY_STATUS.WARNING:d+=this.RESILIENCY_LABELS.STATUS_WARNING;break;case i.RESILIENCY_STATUS.CRITICAL:d+=this.RESILIENCY_LABELS.STATUS_CRITICAL;break;default:d+=this.RESILIENCY_LABELS.STATUS_NA}return u.push({label:d,value:r,status:o,type:c,tooltip:l}),o?(e[t.RESILIENCY_IS_REBUILD_CAPACITY]?(r=this.RESILIENCY_STATUS_RESULT.YES,o=i.RESILIENCY_STATUS.GOOD):(r=this.RESILIENCY_STATUS_RESULT.NO,o=i.RESILIENCY_STATUS.WARNING),u.push({label:this.RESILIENCY_LABELS.REBUILD_CAPACITY,value:r,status:o,type:i.RESILIENCY_DOMAIN_TYPE.NODE,tooltip:e[t.RESILIENCY_FREE_SPACE_MESSAGE]}),a&&(e[t.RESILIENCY_IS_AUTO_HEALBACK_PROGRESS]?(r=this.RESILIENCY_STATUS_RESULT.YES,o=i.RESILIENCY_STATUS.GOOD):(r=this.RESILIENCY_STATUS_RESULT.NO,o=i.RESILIENCY_STATUS.WARNING),u.push({label:this.RESILIENCY_LABELS.AUTO_HEAL_BACK,value:r,status:o,type:i.RESILIENCY_DOMAIN_TYPE.NODE,tooltip:null})),u):u},destroy:function(){this.$(".badge-container").tooltip("destroy"),this.$(".n-row").tooltip("destroy"),$("body").off("click",".view-more"),e.prototype.destroy.apply(this,arguments)},onClickContent:function(e){var s=this.getCurrentClusterModel(),a=s&&s.get(t.CLUSTER_FAULT_TOLERANCE_DOMAIN);if(this.enableRA&&a)return this.onClickContentRA(e);var r=this.resiliencyCollection.getSummary(i.RESILIENCY_DOMAIN_TYPE.NODE),o=this.resiliencyCollection.getSummary(i.RESILIENCY_DOMAIN_TYPE.BLOCK);r[t.RESILIENCY_UNDER_COMPUTATION]||o[t.RESILIENCY_UNDER_COMPUTATION]?$.nutanixConfirm({msg:"Resiliency status is currently being computed. Details are unavailable.",yesText:"OK",hideNo:!0}):n.executeActionElement(e.currentTarget)},onClickContentRA:function(e){for(var i=this.getDomainTypes(),s=this.getSummaryMap(i),a=!1,r=i.length;r--;){var o=i[r],l=s[o];if(l&&l[t.RESILIENCY_UNDER_COMPUTATION]){a=!0;break}}a?$.nutanixConfirm({msg:this.i18n("status_under_computation"),yesText:"OK",hideNo:!0}):n.executeActionElement(e.currentTarget)},isDiskFTOnlyMode:function(){var e=this.getCurrentClusterModel();return[i.CLUSTER_MODE_V2_API.READONLY,i.CLUSTER_MODE_V2_API.OVERRIDE,i.CLUSTER_MODE_V2_API.STANDALONE].indexOf(e.get(t.CLUSTER_OPERATION_MODE))>0||e.get(t.CLUSTER_NUM_NODES)<=1}})}),define("models/cluster/ClusterUpdateModel",["models/BaseModel","data/DataURLConstants","utils/AppConstants"],function(e,t,i){"use strict";return e.extend({urlRoot:t.CLUSTER,entityType:i.ENTITY_CLUSTER,actionMode:i.ACTION_UPDATE,name:"ClusterUpdateModel",save:function(t,i){this.isNew(!1),e.prototype.save.apply(this,arguments)}})}),define("text!templates/popups/multicluster/clustermanagement/PCVirtualIPDetailsContentView.html",[],function(){return'<div data-ntnx-content-inner>\n  <form>\n    <% if (!showAllClusterInfo) { %>\n      <section data-ntnx-section="type-text">\n        <%= i18n(\'modify_desc\') %>\n      </section>\n    <% } %>\n    <% if (showAllClusterInfo) { %>\n      <section data-ntnx-section>\n        <label data-ntnx-label><%= i18n(\'cluster_name\') %></label>\n        <input type="text" class="inputClusterName"\n               model-attribute="name">\n      </section>\n    <% } %>\n    <section data-ntnx-section>\n      <label data-ntnx-label>\n        <%= i18n(\'virtual_ip\') %>\n        <% if (showAllClusterInfo) { %>\n            <span data-ntnx-label-flag><%= i18n(\'required_for_fqdn\') %></span>\n          <% } %>\n      </label>\n      <input type="text" class="inputClusterExternalIPAddress"\n             model-validate="ip_address" model-attribute="virtualIPAddress">\n    </section>\n    <% if (showAllClusterInfo) { %>\n      <section data-ntnx-section>\n        <label data-ntnx-label><%= i18n(\'cluster_fqdn\') %></label>\n        <input type="text" class="inputClusterFQDN"\n               model-validate="domain_name" model-attribute="clusterFqdn">\n      </section>\n    <% } %>\n  </form>\n</div>'}),define("views/popups/multicluster/clustermanagement/PCVirtualIPDetailsPopupView",["views/basecomponents/popups/BasePopupView","data/DataProperties","models/cluster/ClusterUpdateModel","managers/AccessManager","managers/ClusterManager","utils/AppConstants","utils/ValidationUtil","utils/AppUtil","text!templates/popups/multicluster/clustermanagement/PCVirtualIPDetailsContentView.html"],function(e,t,i,n,s,a,r,o,l){"use strict";var c=_.template(l),u={CLUSTER_DETAILS:"cluster_info",VIRTUAL_IP:"virtual_ip"};return e.extend({name:"PCVirtualIPDetailsPopupView",overlayPopup:!0,isDataFetched:!1,events:{"click    .modal-header .close":"hide","click    .btnUpdate":"updateVirtualIP","keypress input":"onKeyPress","click    .btnCancel":"hide"},initialize:function(t){t=t||{},this.virtualIp=t.virtualIp,this.onSuccess=t.onSuccess,this.showAllClusterInfo=t.mode===u.CLUSTER_DETAILS,e.prototype.initialize.apply(this,arguments)},render:function(){var e=[{text:this.i18n("cancel"),extraClasses:"btnCancel"},{text:this.i18n("update"),extraClasses:"btnUpdate",isPrimary:!0}];this.$el.html(this.defaultTemplate({title:this.getPopupTitle(),bodyContent:c(this.vtOptions({showAllClusterInfo:this.showAllClusterInfo})),footerButtons:this.defaultFooter(e)})),this.prefillForm()},getPopupTitle:function(){return this.showAllClusterInfo?this.i18n("cluster_info_title"):this.virtualIp?this.i18n("update_pc_virtual_ip"):this.i18n("add_pc_virtual_ip")},prefillForm:function(){this.virtualIp&&(this.$(".inputClusterExternalIPAddress").val(this.virtualIp),this.showHeaderWarning(this.i18ns("update_virtual_ip_warning",this.virtualIp))),this.showAllClusterInfo&&(this.$(".inputClusterName").val(this.getClusterName()),this.$(".inputClusterFQDN").val(this.getClusterFQDN()||""))},getClusterName:function(){return this.clusterManager.getCurrentClusterName()||this.i18n("unnamed")},getClusterFQDN:function(){return s.getCurrentClusterModel().get(t.CLUSTER_FQDN)},extractFormValues:function(){var e=$.trim(this.$(".inputClusterExternalIPAddress").val()),t=e||null,i=this.getClusterName(),n=this.getClusterFQDN()||null;if(this.showAllClusterInfo){i=$.trim(this.$(".inputClusterName").val())||this.i18n("unnamed");n=$.trim(this.$(".inputClusterFQDN").val())||null}return{externalIPAddress:t,clusterName:i,clusterFQDN:n}},isFQDNEnabled:function(){return n.isV1FFEnabled?n.isV1FFEnabled(a.FFLAGS.FQDN_REGISTRATION):n.isFFEnabled(a.FFLAGS.FQDN_REGISTRATION)},updateVirtualIP:function(){var e=this;this.$(".btnUpdate").button("reset");var n=this.$("form"),s=r.validateFormValues(n);if(s.length)return r.defaultErrorHandler(n,s),null;var a=this.extractFormValues(),l=a.clusterName,c=a.clusterFQDN,u=a.externalIPAddress;if(c){if(!r.isValidDomainName(c))return void this.showHeaderError(this.i18n("invalid_fqdn_msg"));if(!u)return void this.showHeaderError(this.i18n("virtual_ip_required_fqdn_msg"))}var d=new i;d.set(t.CLUSTER_NAME,l),d.set(t.CLUSTER_EXTERNAL_IP_ADRESS,u),this.isFQDNEnabled()&&d.set(t.CLUSTER_FQDN,c),d.save(null,{success:function(i,n){var s=e.clusterManager.getCurrentClusterModel();s.set(t.CLUSTER_NAME,l),s.set(t.CLUSTER_EXTERNAL_IP_ADRESS,u),e.isFQDNEnabled()&&s.set(t.CLUSTER_FQDN,c),e.onSuccess(u,i),e.$(".btnUpdate").button("reset"),e.hide()},error:function(t,i){e.$(".btnUpdate").button("reset"),e.showHeaderError(o.processAjaxError(i.responseText))}})},onEnterKeyPress:function(){this.updateVirtualIP()}})}),define("views/basecomponents/vantagepoints/elements/PrismCentralVantagePointTemplates",[],function(){"use strict";return{CUSTOMIZED_CONTENT_COLUMN_CAPACITY:_.template('<ul class="n-list">         <li class="n-item-row n-row-1">           <div class="content-container"></div>         </li>         <% for (var ii = 1; ii < numOfRows; ii++) { %>           <li class="n-item-row n-row-<%= (ii + 1) %>">              <div class="content-container">             </div>           </li>          <%  }  %>        </table>'),CUSTOMIZED_CONTENT_COLUMN_VM:_.template('<div class="n-content-column-customized">         <div class="n-column-content n-column-content-1">          </div>          <div class="n-column-content n-column-content-2">          </div>        </div>'),CONNECTOR_TEMPLATE:_.template('<section data-ntnx-section><% if (isLoading) { %><%=  loadingMsg({msg: i18n("scaling_out_prism_central")})%><% } %><div class="html-svg-wrapper"><div class="viz-main-container"><div class="viz-main-svg"></div></div><div class="ip-address-group"><div class="virtual-ip" data-id="virtual-ip"><div class="has-virtual-ip"></div><div class="no-virtual-ip"></div></div><div class="pcvm-ip-address-group"><div class="cluster-name"> <%= hostClusterName %> </div><div class="vm-num"> <%= pcVMNum %> <%= i18n("pc_vm") %></div><div class="container-name"><%=i18n("container")%>: <%= containerName %></div><div class="tiles-container"></div></div></div></div></section>'),PC_VM_NAME_TILE:_.template("\n      <div class=\"tile-wrapper <%= showCriticalWarning ? '-critical': '' %>\n        <%= isPoweredOff ? 'power-off' : ''%>\"\n           data-id=\"<%= dataId %>\">\n        <div class=\"vm-name\"> <%= PCVMName %> </div>\n        <div class=\"ip-address\"> <%= ipAddress %> </div>\n        <% if (isDeleted) { %>\n          <div class=\"vm-deleted\">\n            <%= Components.icon('exclamation_badge', '-inline -critical') %>\n            <%= i18n('vm_deleted') %>\n          </div>\n        <% } else { %>\n          <div class=\"storage-info\">\n            <span class=\"cpu-info\"></span>\n            <span class=\"memory-size\"></span>\n          </div>\n          <% if (isPoweredOff) { %>\n            <div class=\"vm-powered-off\">\n              <%= Components.icon('exclamation_badge', '-inline -critical') %>\n              <%= i18n('vm_powered_off') %>\n            </div>\n          <% } %>\n        <% } %>\n      </div>\n    "),HAS_VIRTUAL_IP_TEMPLATE:_.template('\n      <div class="value" data-id="virtual-ip">\n        <%= virtualIP %>\n      </div>\n      <a class="edit-virtual-ip">\n        <%= i18n("edit_virtual_ip") %>\n      </a>\n    '),NO_VIRTUAL_IP_TEMPLATE:_.template('\n      <div class="label no-virtual-ip-label" data-id="virtual-ip">\n        <%= i18n("no_virtual_ip_set") %>\n      </div>\n      <a class="edit-virtual-ip">\n        <%= i18n("add_virtual_ip") %>\n      </a>\n    '),DATA_SYNC_MESSAGE:_.template('<div class="sync-data-msg"><%= message %></div>')}}),define("views/basecomponents/vantagepoints/elements/summary/PCClusterSummaryVantagePointView",["views/basecomponents/vantagepoints/elements/SubviewVantagePointView","views/popups/multicluster/clustermanagement/PCVirtualIPDetailsPopupView","views/basecomponents/vantagepoints/elements/PrismCentralVantagePointTemplates","managers/AccessManager","utils/AppUtil","utils/AppConstants","data/DataProperties"],function(e,t,i,n,s,a,r){"use strict";return e.extend({className:"n-vantage-point-summary-content",name:"PCClusterSummaryVantagePointView",enableColumn:!0,numberOfColumns:1,templateRowName:_.template('<div class="cluster-name"><%= clusterName %></div>'),templateOtherRow:_.template('<div class="row-info"><div class="row-label"><%= label %></div><div class="row-value" title="<%= value %>"><%= trucated_value %></div></div>'),renderModel:function(e){this.model=e||this.model,this.renderModelContent()},renderModelContent:function(){this.$el.html(i.CUSTOMIZED_CONTENT_COLUMN_CAPACITY({numOfRows:5})),this.$(".n-row-1").find(".content-container").html(this.templateRowName(this.vtOptions({clusterName:this.clusterManager.getCurrentClusterName()}))),this.pcCluster=this.clusterManager.getCurrentClusterModel();var e=this.pcCluster.get(r.CLUSTER_EXTERNAL_IP_ADRESS)||"-";this.$(".n-row-2").find(".content-container").html(this.templateOtherRow(this.vtOptions({label:this.i18n("pc_virtual_ip"),value:e,trucated_value:e})));var t=3;if(this.isFQDNEnabled()){var n=this.pcCluster.get(r.CLUSTER_FQDN)||"-";this.$(".n-row-"+t).find(".content-container").html(this.templateOtherRow(this.vtOptions({label:this.i18n("pc_fqdn"),value:n,trucated_value:s.truncateMiddle(n,25)}))),t++}this.$(".n-row-"+t).find(".content-container").html(this.templateOtherRow(this.vtOptions({label:this.i18n("pc_version"),value:this.clusterManager.getPrismCentralVersion(),trucated_value:this.clusterManager.getPrismCentralVersion()}))),t++;var a=this.model.getHostedClusterUuid(),o=null;a&&(o=this.clusterManager.getClusterModelByClusterUuid(a));var l=o?o.getName():this.i18n("not_registered");this.$(".n-row-"+t).find(".content-container").html(this.templateOtherRow(this.vtOptions({label:this.i18n("host_cluster"),value:l,trucated_value:s.truncateMiddle(l,15)}))),this.$(".content-container").addClass("no-alert")},getTitleOptions:function(){return this.isFQDNEnabled()?'<a class="titleOption"> '+this.i18n("edit")+" </a>":""},isFQDNEnabled:function(){return n.isV1FFEnabled?n.isV1FFEnabled(a.FFLAGS.FQDN_REGISTRATION):n.isFFEnabled(a.FFLAGS.FQDN_REGISTRATION)},onClickTitleOption:function(e){var i=this;new t({el:s.createPopupContainer("popupPCVirtualIPDetails"),virtualIp:this.pcCluster.get(r.CLUSTER_EXTERNAL_IP_ADRESS),mode:"cluster_info",onSuccess:function(e,t){i.model.fetch(),i.renderModelContent()}}).show()}})}),define("views/basecomponents/vantagepoints/elements/summary/PrismCentralSummaryVantagePointView",["views/basecomponents/vantagepoints/elements/SubviewVantagePointView","views/basecomponents/vantagepoints/elements/PrismCentralVantagePointTemplates","models/query/BaseQueryModel","utils/VisualizationUtil","utils/AppConstants","utils/AppUtil","utils/StatsUtil","utils/FilterUtil","utils/CommonTemplates","data/DataProperties","managers/NavigationManager"],function(e,t,i,n,s,a,r,o,l,c,u){"use strict";return e.extend({className:"n-vantage-point-summary-content",name:"PrismCentralSummaryVantagePointView",enableColumn:!0,numberOfColumns:1,vmsCountModel:null,templateRow1:_.template('<div class="alert-wrapper"></div><div class="storage-info"><div class="bar-container"></div><div class="vm-nums"><div class="managed-vm"><div class="value"> <%= vmNum %> <%=i18n("vms")%> </div><div class="capacity-label label">                 <%= i18n("currently_managed") %> </div></div><div class="can-supported-vm"><div class="value"> <%= canSupport %> <%=i18n("vms")%> </div><div class="capacity-label label">                 <%= canSupportLabel %> </div></div></div></div>'),templateRow2:_.template('<div class="row-info"><div class="row-label"><%= i18n("clusters_count_label") %></div><a class="row-value view-cluster-link" pageid="ebrowser"><%= clusterNum %></a></div>'),templateRow3:_.template('<div class="row-info"><div class="row-label"><%= i18n("pcvms_count_label") %></div><a class="row-value view-vms-link" pageid="ebrowser"><%= pcVMNum %></a></div>'),events:{"click .view-cluster-link":"onClickViewClusters","click .view-vms-link":"onClickViewVms"},modelEvents:{"sync  vmsCountModel":"renderModelContent","error vmsCountModel":"renderModelError"},initializeModels:function(){e.prototype.initializeModels.apply(this,arguments),this.vmsCountModel=new i({entity_type:s.ENTITY_VM,group_member_count:1})},renderModel:function(e){this.model=e||this.model,this.vmsCountModel.save(),this.renderModelLoading()},renderModelContent:function(){var e={};e[s.ENTITY_VM]=this.vmsCountModel.get(i.DP.FILTERED_ENTITY_COUNT),e[s.ENTITY_CLUSTER]=this.clusterManager.getClusterCollection().length,this.$el.html(t.CUSTOMIZED_CONTENT_COLUMN_CAPACITY({numOfRows:3}));var o=r.convertBytesToUnit(this.model.getMemorySize(),r.UOM_GIB,!1),c=this.model.getPCVMSpec().length,u=a.getVMNumberSupported(o,c),d=u-e[s.ENTITY_VM],h=d>=0?this.i18n("additional_capacity"):this.i18n("over_supported_limit");if(0!==e[s.ENTITY_VM]){this.$(".n-row-1").find(".content-container").html(this.templateRow1(this.vtOptions({vmNum:e[s.ENTITY_VM],canSupport:Math.abs(d),canSupportLabel:h})));var p=e[s.ENTITY_VM]/u;this.$(".bar-container").html(n.renderStorageBar(p,1,!0,s.PC_VM_WARNING_PC,100)),this.$(".content-container").removeClass("no-alert"),100*p>=s.PC_VM_WARNING_PC&&p<=1?this.$(".alert-wrapper").html(l.WARNING({msg:this.i18n("vm_over_80pc_warning")})):p>1?this.$(".alert-wrapper").html(l.ERROR({error:this.i18n("vm_over_limit_warning")})):this.$(".content-container").addClass("no-alert")}else this.$(".n-row-1").find(".content-container").html(t.DATA_SYNC_MESSAGE(this.vtOptions({message:this.i18n("syncing")})));0!==e[s.ENTITY_CLUSTER]?this.$(".n-row-2").find(".content-container").html(this.templateRow2(this.vtOptions({clusterNum:e[s.ENTITY_CLUSTER]}))).addClass("no-alert"):this.$(".n-row-2").find(".content-container").html(t.DATA_SYNC_MESSAGE(this.vtOptions({message:this.i18n("syncing")}))),this.$(".n-row-3").find(".content-container").html(this.templateRow3(this.vtOptions({pcVMNum:c}))).addClass("no-alert")},onClickViewClusters:function(e){
u.navigateToEBPage(s.ENTITY_CLUSTER)},onClickViewVms:function(e){var t={},i=this.model.getVMUuidList();t=o.addFilterCondition(t,c.ENTITY_ID_FILTER,o.createFilterCondition(s.ENTITY_VM,c.ENTITY_ID_FILTER,s.FILTER_OPERATORS.EQUALS,i)),u.navigateToEBPage(s.ENTITY_VM,null,null,null,t)}})}),define("views/basecomponents/vantagepoints/elements/summary/PCCapacityMiniVantagePointView",["views/basecomponents/vantagepoints/elements/SubviewVantagePointView","views/basecomponents/vantagepoints/elements/PrismCentralVantagePointTemplates","models/query/BaseQueryModel","utils/AppConstants","managers/NavigationManager"],function(e,t,i,n,s){"use strict";return e.extend({className:"n-vantage-point-summary-content",name:"PrismCentralSummaryVantagePointView",enableColumn:!0,numberOfColumns:1,vmsCountModel:null,templateRow1:_.template('<div class="row-info"><div class="row-label"><%= i18n("vms_count_label") %></div><a class="row-value view-vms-link" pageid="ebrowser"><%= vmNum %></a></div>'),templateRow2:_.template('<div class="row-info"><div class="row-label"><%= i18n("clusters_count_label") %></div><a class="row-value view-cluster-link" pageid="ebrowser"><%= clusterNum %></a></div>'),events:{"click .view-cluster-link":"onClickViewClusters","click .view-vms-link":"onClickViewVms"},modelEvents:{"sync  vmsCountModel":"renderModelContent","error vmsCountModel":"renderModelError"},initializeModels:function(){e.prototype.initializeModels.apply(this,arguments),this.vmsCountModel=new i({entity_type:n.ENTITY_VM,group_member_count:1})},renderModel:function(e){this.model=e||this.model,this.vmsCountModel.save(),this.renderModelLoading()},renderModelContent:function(){var e={};e[n.ENTITY_VM]=this.vmsCountModel.get(i.DP.FILTERED_ENTITY_COUNT),e[n.ENTITY_CLUSTER]=this.clusterManager.getClusterCollection().length,this.$el.html(t.CUSTOMIZED_CONTENT_COLUMN_CAPACITY({numOfRows:2})),this.$(".n-row-1").find(".content-container").html(this.templateRow1(this.vtOptions({vmNum:e[n.ENTITY_VM]}))),this.$(".n-row-1").addClass("mini-view-row-1"),this.$(".n-row-2").find(".content-container").html(this.templateRow2(this.vtOptions({clusterNum:e[n.ENTITY_CLUSTER]}))),this.$(".content-container").addClass("no-alert")},onClickViewClusters:function(e){s.navigateToEBPage(n.ENTITY_CLUSTER)},onClickViewVms:function(e){s.navigateToEBPage(n.ENTITY_VM)}})}),define("views/basecomponents/vantagepoints/elements/BasePCDeploymentVantagePointView",["views/basecomponents/vantagepoints/elements/SubviewVantagePointView","models/task/TaskCollection","utils/FilterUtil","utils/AppConstants","data/DataProperties","managers/TaskManager","events/AppEvents"],function(e,t,i,n,s,a,r){"use strict";return e.extend({initializeModels:function(){e.prototype.initializeModels.apply(this,arguments),_.bindAll(this,"pollTaskUuid"),r.onAppEvent(r.ENTITIES_CREATED,this.pollTaskUuid)},pollTaskUuid:function(e,o){var l=this;if(!this.taskPollingInProgress&&e.type===r.ENTITIES_CREATED&&o.entityType===n.ENTITY_TASK&&(o.operationType===n.TASK_OPERATION_PC_DEPLOYMENT||o.operationType===n.TASK_OPERATION_PC_ADD_NODE)){o.entity||(this.renderModelContent(this.model,{taskUuid:o.taskUuid,deploymentCompleted:!1}),r.offAppEvent(r.ENTITIES_CREATED,this.pollTaskUuid));var c=o.taskUuid,u=t.extend({getFilterCriteriaForDiff:function(){return i.filterConditionToFIQL(s.UUID,{op:n.FILTER_OPERATORS.EQUALS,value1:c})}}),d=new u;d.intervalTimeInMilliSec=5e3,d.taskUuid=o.taskUuid,d.on("reset",function(e){var t=void 0;t=l.clusterManager.isMulticlusterUI()?_.filter(e.models,function(e){return e.get(s.TASK_TYPE)===n.TASK_OPERATION_PC_ADD_NODE}):_.filter(e.models,function(e){return e.get(s.TASK_TYPE)===n.TASK_OPERATION_PC_DEPLOYMENT}),(t=t.length?_.first(t):null)&&t.isTaskCompleted()&&(d.stopPolling(),l.taskPollingInProgress=!1,a.fetchOnDemand().done(function(){l.checkPCScaleOutStatus()}))}),d.startPolling(),this.taskPollingInProgress=!0}},checkPCScaleOutStatus:function(){if(2===this.clusterManager.getCurrentClusterModel().get(s.CLUSTER_REDUNDANCY_STATE))return this.clusterPollingInProgress&&(this.clusterManager.detachEventHandler("reset",this.checkPCScaleOutStatus,this),this.clusterPollingInProgress=!1),void this.model.fetch({alwaysTriggerChange:!0,deploymentCompleted:!0});this.clusterPollingInProgress||(this.clusterPollingInProgress=!0,this.clusterManager.attachEventHandler("reset",this.checkPCScaleOutStatus,this))},hasInProgressDeployment:function(e){var t=e&&e.taskUuid,i=!1;if(t)if(e&&e.deploymentCompleted)i=!1;else if(a.getTaskById(t)){var o=a.getTaskById(t);i=!o.isTaskCompleted()}else i=e&&!1===e.deploymentCompleted;else{var l=this.findActiveDeploymentTask();t=l&&l.get(s.TASK_ID),t&&(i=t,this.pollTaskUuid({type:r.ENTITIES_CREATED},{entityType:n.ENTITY_TASK,entity:l,taskUuid:t,operationType:n.TASK_OPERATION_PC_DEPLOYMENT}))}return i},hasAddNodeRequestInProgress:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.taskUuid,i=!1;if(e.deploymentCompleted)i=!1;else if(t)if(a.getTaskById(t)){a.getTaskById(t);i=t,this.checkPCScaleOutStatus()}else i=e&&!1===e.deploymentCompleted;else{var o=this.findAddNodeTask();if(t=o&&o.get(s.TASK_ID))if(o.isStatusComplete())i=!0,this.checkPCScaleOutStatus();else{if(o.isTaskCompleted())return!1;i=!0,this.pollTaskUuid({type:r.ENTITIES_CREATED},{entityType:n.ENTITY_TASK,entity:o,taskUuid:t,operationType:n.TASK_OPERATION_PC_ADD_NODE})}}return i},findActiveDeploymentTask:function(){var e=a.getGlobalTasks().getLatestPcDeploymentTask();if(e&&!e.isTaskCompleted())return e},findAddNodeTask:function(){var e=a.getGlobalTasks().getLatestPCAddNodeTask();if(e)return e},destroy:function(){this.clusterPollingInProgress&&(this.clusterManager.detachEventHandler("reset",this.checkPCScaleOutStatus,this),this.clusterPollingInProgress=!1),r.offAppEvent(r.ENTITIES_CREATED,this.pollTaskUuid),e.prototype.destroy.apply(this,arguments)}})}),define("utils/D3Util",["d3","utils/AppConstants","utils/AppUtil"],function(e,t,i){"use strict";return{addSelectionHelpers:function(){e.selection.prototype.moveToFront=function(){return this.each(function(){this.parentNode.appendChild(this)})},e.selection.prototype.moveToBack=function(){return this.each(function(){var e=this.parentNode.firstChild;e&&this.parentNode.insertBefore(this,e)})}},addDragSelect:function(t,i,n,s,a,r){var o=e.select(t[0][0].parentNode);a=a||0,r=r||0,o.on("mousedown.dragselect",function(){var n=t.select("rect.d3-drag-selector");n&&n.remove();var s=e.mouse(this);t.append("rect").attr({class:"d3-drag-selector",x:s[0]+a,y:s[1]+r,width:0,height:0}),i&&i(null)}).on("mousemove.dragselect",function(){var i=t.select("rect.d3-drag-selector");if(!i.empty()){var s=e.mouse(this),a={x:Number(i.attr("x")),y:Number(i.attr("y")),width:Number(i.attr("width")),height:Number(i.attr("height"))},r={x:s[0]-a.x,y:s[1]-a.y};r.x<1||2*r.x<a.width?(a.x=s[0],a.width-=r.x):a.width=r.x,r.y<1||2*r.y<a.height?(a.y=s[1],a.height-=r.y):a.height=r.y,i.attr(a),n&&n(a)}}).on("mouseup.dragselect",function(){var e=t.select("rect.d3-drag-selector");if(!e.empty()){var i={x:Number(e.attr("x")),y:Number(e.attr("y")),width:Number(e.attr("width")),height:Number(e.attr("height"))};e.remove(),s&&s(i)}}).on("mouseleave.dragselect",function(){var e=t.select("rect.d3-drag-selector");e.empty()||e.remove()})},removeDragSelect:function(t){var i=e.select(t[0][0].parentNode);i.on("mousedown.dragselect",null),i.on("mousemove.dragselect",null),i.on("mouseup.dragselect",null),i.on("mouseleave.dragselect",null)},doLineSegmentsIntersect:function(e,t,i,n,s,a,r,o){var l,c,u,d;l=i-e,c=n-t,u=r-s,d=o-a;var h=-u*c+l*d;if(Math.abs(h)<1e-4)return!1;var p=(-c*(e-s)+l*(t-a))/h,_=(u*(t-a)-d*(e-s))/h;return p>=0&&p<=1&&_>=0&&_<=1},doesLineSegmentIntersectRect:function(e,t,i,n,s){var a=[];a.push([[s.x,s.y],[s.x,s.y+s.height]]),a.push([[s.x,s.y],[s.x+s.width,s.y]]),a.push([[s.x+s.width,s.y],[s.x+s.width,s.y+s.height]]),a.push([[s.x,s.y+s.height],[s.x+s.width,s.y+s.height]]);for(var r=0;r<a.length;r++){var o=a[r];if(this.doLineSegmentsIntersect(e,t,i,n,o[0][0],o[0][1],o[1][0],o[1][1]))return!0}return!1},renderSVGLine:function(e,t,i,n,s,a,r,o){var l=o?e.insert("line",o):e.append("line");return l.attr("x1",t).attr("y1",n).attr("x2",i).attr("y2",s).attr("stroke",a),r&&l.attr("stroke-width",r),l},renderSVGCircle:function(e,t,n,s,a,r){if(t>=0&&n>=0&&s>=0){return e.append("circle").attr("cx",t).attr("cy",n).attr("r",s).attr("fill",a).attr("stroke",r)}i.log("Invalid x,y coordinates")},renderSVGBand:function(t,i,n,s,a){if(t&&i&&a){var r=i.xScale(),o=i.yScale();s=s||.2;var l=e.svg.area().x(function(e){return r(e.x)}).y0(function(e){return o(e.y0)}).y1(function(e){return o(e.y1)});e.select(t).append("path").datum(a).attr("class","area").attr("d",l).style("fill",n).style("opacity",s)}},renderSVGRect:function(e,t,n,s,a,r,o,l,c){if(t>=0&&n>=0&&s>=0&&a>=0){var u=l?e.insert("rect",l):e.append("rect");return u.attr("x",t).attr("y",n).attr("width",s).attr("height",a).attr("fill",r).attr("stroke",o),c&&u.style("opacity",c),u}i.log("Invalid x,y coordinates")},renderSVGText:function(e,t,i,n,s,a,r){return e.append("text").text(t).attr("x",i).attr("y",n).attr("fill",s).attr("text-anchor",a||"middle").attr("class",r||"")},renderSparkLine:function(t,i,n,s,a,r,o,l,c,u,d){var h=o||0,p=l||0;if(i&&i.length){var T=i;-1===e.min(i)&&(T=_.map(i,function(e){return-1===e?null:e}));var E=e.select(t).append("svg").attr("width",n).attr("height",s).style("width",n+"px").style("height",s+"px"),S=e.scale.linear().domain([0,T.length]).range([0,n]),g=e.max(T)-e.min(T),A=Math.ceil(.05*g),m=e.scale.linear().domain([e.min(T)-A,e.max(T)+A]).range([s,0]),f=e.svg.line().interpolate("basis").x(function(e,t){return S(t)}).y(function(e){return m(e)}).defined(function(e){return null!==e});if(E.append("path").attr("d",f(T)).attr("class","sparkline").attr("stroke",a[0]).attr("transform","translate(0,"+h+")"),d&&E.append("circle").attr("fill",a[0]).attr("cx",S(T.length-1)).attr("cy",m(T[T.length-1])).attr("r",1.5),r){var I=e.svg.area().interpolate("basis").x(function(e,t){return S(t)}).y0(s).y1(function(e){return m(e)}).defined(function(e){return null!==e}),C=a[1];a[0]===a[1]&&(C=e.rgb(a[1]).brighter()),E.append("path").datum(T).attr("class","area").attr("d",I).attr("fill",C).attr("transform","translate(0,"+p+")")}_.isUndefined(c)||E.append("text").style("font-size","12px").attr("text-anchor","end").attr("x",3*n).attr("y",3*s).text(c)}},renderSVGBell:function(e,t,n,s,a){if(n>=0&&s>=0){return e.append("svg").attr("viewBox","0 792 2048 2048").attr("x",n).attr("y",s).attr("width",t+"px").attr("height",t+"px").append("path").attr("style","fill: "+a).attr("d","M2024.3 2343.3C1343.6 1880 1854.9 793.7 1024.2 793.7S704.7 1880 23.7 2343.3c-16 11-22.1 30.1-22.1 47.8c0 8 1 15 4 23.1 c10 25.1 33.1 40.8 59.8 40.8h1917c27.1 0 49.8-16 59.8-40.8c3-8 4-15 4-23.1C2046.3 2373.4 2040.3 2354.3 2024.3 2343.3z M1343.6 2583c-46.8 148.7-171.8 255.7-319.4 255.7s-272.7-107-319.4-255.7H1343.6z")}i.log("Invalid x,y coordinates")},renderSVGAnomaly:function(e,i,n,s,a){return e.append("svg").attr("viewBox",t.COMPONENTS.SVG.VIEWBOX.SIZE_10).attr("x",n).attr("y",s).attr("width",i).attr("height",i).attr("class","svg-icon -id-anomaly "+a).append("use").attr("xlink:href","#Anomaly")},renderSVGExclamation:function(e,t,i,n,s){return e.append("svg").attr("viewBox","0 792 2048 2048").attr("x",i).attr("y",n).attr("width",t).attr("height",t).attr("class","svg-icon -id-circular_exclamation "+s).append("use").attr("xlink:href","#Circular_Exclamation")},rectToPath:function(e,t,i,n){return"M"+e+","+t+"L"+(e+i)+","+t+","+(e+i)+","+(t+n)+","+e+","+(t+n)+","+e+","+t},curveXPoints:function(e,t,i,n){var s,a,r=t.x-e.x,o=Math.round(r/(i||2)),l=Math.abs(t.y-e.y),c=Math.round(l/(i||2)),u=[];if(0===r)switch(n){case"R":s={x:e.x+c,y:e.y},a={x:t.x+c,y:t.y};break;case"L":s={x:e.x-c,y:e.y},a={x:t.x-c,y:t.y}}else if(0===l)switch(n){case"T":s={x:e.x,y:e.y-o},a={x:t.x,y:t.y-o};break;case"B":s={x:e.x,y:e.y+o},a={x:t.x,y:t.y+o}}return s&&a||(s={x:e.x+o,y:e.y},a={x:t.x-o,y:t.y}),u.push(e),u.push(s),u.push(a),u.push(t),u},elbowPoints:function(e,t,i){var n,s,a=[];if("R"===i||"L"===i){var r=t.x-e.x,o=r>0;r=Math.abs(r),n={x:o?e.x+r/2:e.x-r/2,y:e.y},s={x:o?t.x-r/2:t.x+r/2,y:t.y}}else{var l=t.y-e.y,c=l>0;l=Math.abs(l),n={x:e.x,y:c?e.y+l/2:e.y-l/2},s={x:t.x,y:c?t.y-l/2:t.y+l/2}}return a.push(e),a.push(n),a.push(s),a.push(t),a},getConnectionPoint:function(e,t,n){if(!e||!e.node())return i.log("Invalid G element for selector:"+t),null;var s=Number(e.attr("gleft")),a=Number(e.attr("gtop")),r=Number(e.attr("pleft")),o=Number(e.attr("ptop")),l=Number(e.attr("angle")),c=e.select(t);if(!c||!c.node())return i.log("Unable to get connection point for selector:"+t),null;var u,d=c.node().getBBox(),h=d.x+Number(c.attr("cleft")||0),p=d.y+Number(c.attr("ctop")||0);if(e.attr("angle")){l+=Math.PI/180*180;var _=Math.round(d.width/2);return u={x:s+r+h+(_*Math.cos(l)+_),y:a+o+p+(_*Math.sin(l)+_)}}switch(n||(n="T"),n){case"T":u={x:s+r+h+Math.round(d.width/2),y:a+o+p};break;case"B":u={x:s+r+h+Math.round(d.width/2),y:a+o+p+d.height};break;case"L":u={x:s+r+h,y:a+o+p+Math.round(d.height/2)};break;case"R":u={x:s+r+h+d.width,y:a+o+p+Math.round(d.height/2)}}return u}}}),define("views/viz/VizView",["views/basecomponents/BaseView","d3tip","utils/D3Util","utils/AppUtil"],function(e,t,i,n){"use strict";var s={ELEMENTS:"elements",CONNECTORS:"connectors",LAYOUT_SYSTEM:"layoutSystem",LAYOUT_PERCENTAGE:"percentage",LAYOUT_FIXED:"fixed",C_LAYOUT_VERTICAL:"vertical",C_LAYOUT_HORIZONTAL:"horizontal",C_LAYOUT_CENTER:"center",C_LAYOUT_RADIAL:"radial",START_ANGLE:"startAngle",COVERAGE_ANGLE:"coverageAngle",ID:"id",TYPE:"type",CHILDREN:"children",CLASSNAME:"className",FACE:"face",LAYOUT:"layout",TRANS_LAYOUT:"transLayout",SRC_ID:"src-id",TAR_ID:"tar-id",DATA_ID:"data-id",GTOP:"gtop",GLEFT:"gleft",PTOP:"ptop",PLEFT:"pleft",ANGLE:"angle",CLASSES:"classes",SHADOW_CLASSES:"shadowClasses",ANIMATE:"animate",HEAD:"head",BACKGROUND:"background",CONTENT:"content",SHADOW:"shadow",CHILD_SELECTOR:"childSelector",TOOLTIP_TEXT:"tooltipText",EDGE_TYPE:{SPLINE:"spline",ELBOW:"elbow",STRAIGHT:"straight",CURVY:"curvy",CURVY_TUNNEL:"curvy-tunnel"},ELEMENT_TYPES:{GROUP:"g",RECT:"rect",CIRCLE:"circle",TITLE:"title",ICON:"icon"},ELEMENT_FACES:{RIGHT:"R",LEFT:"L",TOP:"T",BOTTOM:"B"},MARKERS:{ARROW:{LEFT_ARROW:"l-arrow",RIGHT_ARROW:"r-arrow"},CIRCLE:{BLUE_CIRCLE:"circle-blue",GREEN_CIRCLE:"circle-green",YELLOW_CIRCLE:"circle-yellow"},REG_CIRCLE:"reg-circle"},DIRECTIONS:{LEFT:"L",RIGHT:"R"}};return e.extend({name:"VizView",vizDef:null,DP:s,initialize:function(t){e.prototype.initialize.apply(this,arguments),this.vizDef=t.viewDefinition||{},this.parentContainer=t.parentContainer,this.dimensions=t.dimensions||{}},render:function(){this._clearTooltips(),this._tip=d3.tip().attr("class","d3-tip").offset(function(e){var t=e.attr("tooltipOffset");if(t&&t.length){var i=t.split(",");if(2===i.length)return[Number(i[0]),Number(i[1])]}return[0,0]}).direction(function(e){return e.attr("tooltipDirection")||"n"}).html(function(e){return e.attr("tooltipText")}),this._svg&&(this._svg.remove(),this._svg=null);var e=d3.select(this.$el.get(0));if(!e)return void n.log("Error: Unable to create visualization. Container not available");if(this._svg=e.append("svg").attr("width",this.dimensions.w||800).attr("height",this.dimensions.h||600).attr("preserveAspectRatio","xMinYMin meet").classed("svg-content-responsive",!0).call(this._tip),this.addDefs(),_.isEmpty(this.vizDef)||!this.vizDef[s.LAYOUT_SYSTEM])return void n.log("Error: Unable to create visualization. Invalid definition");if(this.renderEntities(null,this.vizDef[s.ELEMENTS],0),this.renderConnectors(this.vizDef[s.CONNECTORS]),this._svg[0][0]){var t=this.parentContainer.outerWidth(),i=this.parentContainer.outerHeight(),a=this._svg[0][0].getBBox(),r=a.height+20,o=a.width+20,l=Math.max(t,o),c=Math.max(i,r);this._svg.attr("width",l),this._svg.attr("height",c),this.$el.height(c+30)}},destroy:function(){this._clearTooltips()},setVisualizationDef:function(e){this.vizDef=e,this.render()},showTip:function(e){e.attr("tooltipText")&&this._tip.show(e,e[0][0])},showDomElementTip:function(e){this.showTip(d3.select(e))},hideTip:function(){this._tip.hide()},addDefs:function(){if(this._svg){var e=this._svg.append("defs");e.append("marker").attr({id:s.MARKERS.ARROW.LEFT_ARROW,viewBox:"0 -5 10 10",refX:0,refY:0,markerWidth:6,markerHeight:6,orient:"auto"}).append("path").attr("d","M10,-5L0,0L10,5").attr("class","arrow-head"),e.append("marker").attr({id:s.MARKERS.ARROW.RIGHT_ARROW,viewBox:"-10 -5 10 10",refX:0,refY:0,markerWidth:6,markerHeight:6,orient:"auto"}).append("path").attr("d","M-10,-5L0,0L-10,5").attr("class","arrow-head"),e.append("marker").attr({id:s.MARKERS.REG_CIRCLE,viewBox:"-3 -3 6 6",refX:0,refY:0,markerWidth:6,markerHeight:6,orient:"auto"}).append("circle").attr("cx",0).attr("cy",0).attr("r",2).attr("class","reg-circle"),_.each(s.MARKERS.CIRCLE,function(t){var i=e.append("marker").attr({id:t,viewBox:"-3 -3 6 6",refX:0,refY:0,markerWidth:6,markerHeight:6,orient:"auto"});i.append("circle").attr("cx",0).attr("cy",0).attr("r",3).attr("class","circle-head-shadow"),i.append("circle").attr("cx",0).attr("cy",0).attr("r",2).attr("class","circle-head-outer"),i.append("circle").attr("cx",0).attr("cy",0).attr("r",1).attr("class","circle-head-inner")})}},renderEntities:function(e,t,i){if(t){var a=e||this._svg,r=0,o=t.length;_.each(t,function(t,l){var c=void 0;switch(t[s.TYPE]){case s.ELEMENT_TYPES.GROUP:r=this.layoutEntity(e,r,t,i,o,l),c=this.renderG(a,t);break;case s.ELEMENT_TYPES.RECT:r=this.layoutEntity(e,r,t,i,o,l),c=this.renderRect(a,t);break;case s.ELEMENT_TYPES.CIRCLE:r=this.layoutEntity(e,r,t,i,o,l),c=this.renderCircle(a,t);break;case s.ELEMENT_TYPES.TITLE:r=this.layoutEntity(e,r,t,i,o,l),this.renderTitle(a,t);break;case s.ELEMENT_TYPES.ICON:r=this.layoutEntity(e,r,t,i,o,l),this.renderIcon(a,t);break;default:n.log("VizView: Unknown type of element found.")}if(c&&t[s.CHILDREN]&&t[s.CHILDREN][s.ELEMENTS]){var u=this.calcPadding(c,t[s.CHILDREN][s.ELEMENTS]);this.renderEntities(c,t[s.CHILDREN][s.ELEMENTS],u)}},this)}},calcPadding:function(e,t){var i=0,n=this.vizDef[s.LAYOUT_SYSTEM];if(e&&e.node()&&t&&t.length){var a=e.datum(),r=a&&a[s.CHILDREN]?a[s.CHILDREN][s.LAYOUT]:"",o=0,l=void 0,c=0,u=a&&a.transLayout?a.transLayout.w:this.dimensions.w||800,d=a&&a.transLayout?a.transLayout.h:this.dimensions.h||600;if(n&&n[s.TYPE]===s.LAYOUT_PERCENTAGE)switch(_.each(t,function(e){var t=e[s.LAYOUT]||{},i=void 0,n=void 0;t.h&&t.w?(i=t.h?t.h*d/100:0,n=t.w?t.w*u/100:0,c++):(i=0,n=0),o+=r===s.C_LAYOUT_VERTICAL?i:n}),r){case s.C_LAYOUT_VERTICAL:l=d-o;break;case s.C_LAYOUT_HORIZONTAL:l=u-o;break;default:l=0}else if(n&&n[s.TYPE]===s.LAYOUT_FIXED)switch(_.each(t,function(e){var t=e[s.LAYOUT]||{},i=void 0,n=void 0;t.h&&t.w?(i=t.h?parseInt(t.h,10):0,n=t.w?parseInt(t.w,10):0,c++):(i=0,n=0),o+=r===s.C_LAYOUT_VERTICAL?i:n}),r){case s.C_LAYOUT_VERTICAL:l=d-o;break;case s.C_LAYOUT_HORIZONTAL:l=u-o;break;default:l=0}l>0&&c>0&&(i=l/(c+1))}return i},renderG:function(e,t){var i=0,n=0;return e&&(i=Number(e.attr(s.GLEFT))+Number(e.attr(s.PLEFT))||0,n=Number(e.attr(s.GTOP))+Number(e.attr(s.PTOP))||0),e.selectAll('.entityG[data-id="'+t[s.ID]+'"]').data([t]).enter().append("g").attr("class","entityG").attr("data-id",function(e){return e[s.ID]}).attr(s.GLEFT,function(e){return e.transLayout.x}).attr(s.GTOP,function(e){return e.transLayout.y}).attr(s.PLEFT,i).attr(s.PTOP,n).attr("transform",function(e){return"translate("+e.transLayout.x+","+e.transLayout.y+")"})},renderRect:function(e,t){var i=0,n=0;e&&(i=Number(e.attr(s.GLEFT))+Number(e.attr(s.PLEFT))||0,n=Number(e.attr(s.GTOP))+Number(e.attr(s.PTOP))||0);var a=t.layout.offsetY?t.transLayout.y+t.layout.offsetY:t.transLayout.y,r=t.layout.offsetX?t.transLayout.x+t.layout.offsetX:t.transLayout.x,o=e.selectAll('.entityG[data-id="'+t[s.ID]+'"]').data([t]).enter().append("g").attr("class","entityG").attr("data-id",function(e){return e[s.ID]}).attr(s.GLEFT,function(e){return r}).attr(s.GTOP,function(e){return a}).attr(s.PLEFT,i).attr(s.PTOP,n).attr("transform",function(e){return"translate("+r+","+a+")"});return o.each(function(e){d3.select(this).selectAll("rect").data([e]).enter().append("rect").attr("x",0).attr("y",0).attr("rx",4.5).attr("ry",4.5).attr("class",function(e){return e.classes?e.classes.join(" "):""}).attr("width",function(e){return e.transLayout.w}).attr("height",function(e){return e.transLayout.h})}),o},renderCircle:function(e,t){var i=0,n=0;e&&(i=Number(e.attr(s.GLEFT))+Number(e.attr(s.PLEFT))||0,n=Number(e.attr(s.GTOP))+Number(e.attr(s.PTOP))||0);var a=e.selectAll('.entityG[data-id="'+t[s.ID]+'"]').data([t]).enter().append("g").attr("class","entityG").attr("data-id",function(e){return e[s.ID]}).attr(s.GLEFT,function(e){return e.transLayout.x}).attr(s.GTOP,function(e){return e.transLayout.y}).attr(s.PLEFT,i).attr(s.PTOP,n).attr(s.ANGLE,function(e){return e.transLayout.angle}).attr("transform",function(e){return"translate("+e.transLayout.x+","+e.transLayout.y+")"});return a.each(function(e){var t=d3.select(this);t.selectAll("circle").data([e]).enter().append("circle").attr("tooltipText",function(e){return e[s.TOOLTIP_TEXT]}).attr("cx",function(e){return e.transLayout.w/2}).attr("cy",function(e){return e.transLayout.h/2}).attr("r",function(e){return e.transLayout.w/2}).attr("class",function(e){return e.classes?e.classes.join(" "):""}),e.label&&t.selectAll(".label").data([e]).enter().append("text").attr("x",function(e){return e.transLayout.w/2+4}).attr("y",function(e){return e.transLayout.h+20}).attr("text-anchor","middle").attr("class",function(e){return e.label.classes?e.label.classes.join(" "):""}).text(e.label[s.CONTENT])}),a},renderTitle:function(e,t){var i=e.selectAll(".title").data([t]).enter().append("text").attr("class",function(e){return e.classes?e.classes.join(" "):""}).attr("y",function(e){return e.transLayout.y});if(_.isArray(t[s.CONTENT])?(i.attr("y",function(e){return e.transLayout.y-5}),_.each(t[s.CONTENT],function(e,t){i.append("tspan").text(e).attr("x",function(e){return e.transLayout.x}).attr("dy",function(e){return t>0?"15":"0"}).attr("text-anchor","middle")})):(i.attr("x",function(e){return e.transLayout.x}),i.text(t[s.CONTENT])),t[s.BACKGROUND]){var n=i[0][0].getBBox();e.insert("rect","text").attr("x",n.x-5).attr("y",n.y-5).attr("width",n.width+10).attr("height",n.height+10).attr("class","text-bb")}},renderIcon:function(e,t){var i=0,n=0;e&&(i=Number(e.attr(s.GLEFT))+Number(e.attr(s.PLEFT))||0,n=Number(e.attr(s.GTOP))+Number(e.attr(s.PTOP))||0),e.selectAll('.entityG[data-id="'+t[s.ID]+'"]').data([t]).enter().append("g").attr("class","entityG").attr("data-id",function(e){return e[s.ID]}).attr(s.GLEFT,function(e){return e.transLayout.x}).attr(s.GTOP,function(e){return e.transLayout.y}).attr(s.PLEFT,i).attr(s.PTOP,n).attr("transform",function(e){return"translate("+(e.transLayout.x-e.transLayout.w)+","+(e.transLayout.y-e.transLayout.h)+")"}).each(function(e){d3.select(this).selectAll(".icon").data([e]).enter().append("path").attr("class",function(e){return e.classes?e.classes.join(" "):""}).attr("d",function(e){return e.path})})},layoutEntity:function(e,t,i,n,a,r){var o={},l=i[s.LAYOUT]||{},c=void 0,u=void 0,d=void 0,h=void 0,p=this.vizDef[s.LAYOUT_SYSTEM];e&&e.node()&&(u=e.datum(),c=u&&u[s.CHILDREN]?u[s.CHILDREN][s.LAYOUT]:"",d=u&&u[s.CHILDREN]?u[s.CHILDREN][s.START_ANGLE]:"0",h=u&&u[s.CHILDREN]?u[s.CHILDREN][s.COVERAGE_ANGLE]:"360");var _=u&&u.transLayout?u.transLayout.w:this.dimensions.w||800,T=u&&u.transLayout?u.transLayout.h:this.dimensions.h||600,E=_/2,S=T/2,g=void 0,A=void 0;if(p&&p[s.TYPE]===s.LAYOUT_PERCENTAGE){switch(g=_>0?l.w*_/100:0,A=T>0?l.h*T/100:0,c){case s.C_LAYOUT_VERTICAL:o.x=E-g/2,o.y=t+n,t+=n+l.h*T/100,i[s.TYPE]!==s.ELEMENT_TYPES.TITLE&&i[s.TYPE]!==s.ELEMENT_TYPES.ICON||(o.x=E,o.y=0);break;case s.C_LAYOUT_HORIZONTAL:o.y=S-A/2,o.x=t+n,t+=n+l.w*_/100,i[s.TYPE]!==s.ELEMENT_TYPES.TITLE&&i[s.TYPE]!==s.ELEMENT_TYPES.ICON||(o.x=E,o.y=0);break;case s.C_LAYOUT_CENTER:i[s.TYPE]===s.ELEMENT_TYPES.TITLE||i[s.TYPE]===s.ELEMENT_TYPES.ICON?(o.x=E,o.y=S):(o.x=E-g/2,o.y=S-A/2);break;default:o.x=E-g/2,o.y=S-A/2,o.y<20&&(o.y=20)}o.w=g,o.h=A}else if(p&&p[s.TYPE]===s.LAYOUT_FIXED){switch(g=parseInt(l.w,10),A=parseInt(l.h,10),c){case s.C_LAYOUT_VERTICAL:i[s.TYPE]===s.ELEMENT_TYPES.TITLE||i[s.TYPE]===s.ELEMENT_TYPES.ICON?(o.x=E,o.y=0):(o.x=E-g/2,o.y=t+n,t+=n+A);break;case s.C_LAYOUT_HORIZONTAL:i[s.TYPE]===s.ELEMENT_TYPES.TITLE||i[s.TYPE]===s.ELEMENT_TYPES.ICON?(o.x=E,o.y=0):(o.y=S-A/2,o.x=t+n,t+=n+g);break;case s.C_LAYOUT_CENTER:i[s.TYPE]===s.ELEMENT_TYPES.TITLE||i[s.TYPE]===s.ELEMENT_TYPES.ICON?(o.x=E,o.y=S):(o.x=E-g/2,o.y=S-A/2);break;case s.C_LAYOUT_RADIAL:var m=parseInt(d,10)*(Math.PI/180),f=r*(Math.PI/180)*(h/a)+m,I=_/2;o.x=I*Math.cos(f)+(I-g/2),o.y=I*Math.sin(f)+(I-A/2),o.angle=f;break;default:o.x=E-g/2,o.y=S-A/2,o.y<20&&(o.y=20)}o.w=g,o.h=A}return i[s.TRANS_LAYOUT]=o,t},renderConnectors:function(e){_.each(e,function(e){var t='[data-id="'+e.source[s.ID]+'"]',i='[data-id="'+e.target[s.ID]+'"]',n=this.parentContainer.find(t),a=this.parentContainer.find(i);if(n.length&&a.length){var r=this.getConnectionPoint(n,e.source[s.FACE],e.source[s.CHILD_SELECTOR]),o=this.getConnectionPoint(a,e.target[s.FACE],e.target[s.CHILD_SELECTOR]),l=this,c=e[s.ANIMATE]?"line animate":"line";c=e[s.CLASSES]&&e[s.CLASSES].length?c+" "+e[s.CLASSES].join(" "):c;var u=e.source[s.HEAD]||"",d=e.target[s.HEAD]||"";switch(e[s.TYPE]){case s.EDGE_TYPE.SPLINE:if(e[s.SHADOW]){var h="line shadow";h=e[s.SHADOW_CLASSES]&&e[s.SHADOW_CLASSES].length?c+" "+e[s.SHADOW_CLASSES].join(" "):h,this._svg.selectAll(".lines").data([[r,o]]).enter().append("path").attr("class",h).attr(s.SRC_ID,e.source[s.ID]).attr(s.TAR_ID,e.target[s.ID]).attr("tooltipText",e.tooltipText).attr("tooltipDirection",e.tooltipDirection).attr("tooltipOffset",e.tooltipOffset).attr("d",function(t){var i=l.curveXPoints(t[0],t[1],2,e.source[s.FACE]);return"M"+i[0].x+","+i[0].y+"C"+i[1].x+","+i[1].y+","+i[2].x+","+i[2].y+","+i[3].x+","+i[3].y})}this._svg.selectAll(".lines").data([[r,o]]).enter().append("path").attr("class",c).attr("marker-start","url(#"+u+")").attr("marker-end","url(#"+d+")").attr(s.SRC_ID,e.source[s.ID]).attr(s.TAR_ID,e.target[s.ID]).attr("tooltipText",e.tooltipText).attr("tooltipDirection",e.tooltipDirection).attr("tooltipOffset",e.tooltipOffset).attr("d",function(t){var i=l.curveXPoints(t[0],t[1],2,e.source[s.FACE]);return"M"+i[0].x+","+i[0].y+"C"+i[1].x+","+i[1].y+","+i[2].x+","+i[2].y+","+i[3].x+","+i[3].y});break;case s.EDGE_TYPE.CURVY:var p=n.parents("g"),_=p.children("circle").first();_.length||(p=a.parents("g"),_=p.children("circle").first());var T={x:parseInt(p.attr("gleft"),10)+parseInt(p.attr("pleft"),10)+parseInt(_.attr("cx"),10),y:parseInt(p.attr("gtop"),10)+parseInt(p.attr("ptop"),10)+parseInt(_.attr("cy"),10)};this._svg.selectAll(".lines").data([[r,o]]).enter().append("path").attr("class",c).attr("marker-start","url(#"+u+")").attr("marker-end","url(#"+d+")").attr(s.SRC_ID,e.source[s.ID]).attr(s.TAR_ID,e.target[s.ID]).attr("tooltipText",e.tooltipText).attr("tooltipDirection",e.tooltipDirection).attr("tooltipOffset",e.tooltipOffset).attr("d",function(e){return"M"+e[0].x+","+e[0].y+"\n                      C"+T.x+","+T.y+","+T.x+","+T.y+",\n                      "+e[1].x+","+e[1].y});break;case s.EDGE_TYPE.CURVY_TUNNEL:var E=this.parentContainer.find('[data-id="tunnel"]');if(E.length){var S=this.getConnectionPoint(E,"T","rect"),g=this.getConnectionPoint(E,"B","rect");this._svg.selectAll(".lines").data([[r,o]]).enter().append("path").attr("class",c).attr("marker-start","url(#"+u+")").attr("marker-end","url(#"+d+")").attr(s.SRC_ID,e.source[s.ID]).attr(s.TAR_ID,e.target[s.ID]).attr("tooltipText",e.tooltipText).attr("tooltipDirection",e.tooltipDirection).attr("tooltipOffset",e.tooltipOffset).attr("d",function(e){return"M"+e[0].x+","+e[0].y+"\n                        C"+S.x+","+S.y+","+g.x+","+g.y+",\n                        "+e[1].x+","+e[1].y})}else this._svg.selectAll(".lines").data([[r,o]]).enter().append("path").attr("class",c).attr("marker-start","url(#"+u+")").attr("marker-end","url(#"+d+")").attr(s.SRC_ID,e.source[s.ID]).attr(s.TAR_ID,e.target[s.ID]).attr("tooltipText",e.tooltipText).attr("tooltipDirection",e.tooltipDirection).attr("tooltipOffset",e.tooltipOffset).attr("d",function(t){var i=l.curveXPoints(t[0],t[1],2,e.source[s.FACE]);return"M"+i[0].x+","+i[0].y+"C"+i[1].x+","+i[1].y+","+i[2].x+","+i[2].y+","+i[3].x+","+i[3].y});break;case s.EDGE_TYPE.ELBOW:e[s.SHADOW]&&this._svg.selectAll(".lines").data([[r,o]]).enter().append("path").attr("class","line shadow").attr(s.SRC_ID,e.source[s.ID]).attr(s.TAR_ID,e.target[s.ID]).attr("d",function(t){var i=l.elbowPoints(t[0],t[1],e.source[s.FACE]);return"M"+i[0].x+","+i[0].y+","+i[1].x+","+i[1].y+","+i[2].x+","+i[2].y+","+i[3].x+","+i[3].y}),this._svg.selectAll(".lines").data([[r,o]]).enter().append("path").attr("class",c).attr("marker-start","url(#"+u+")").attr("marker-end","url(#"+d+")").attr(s.SRC_ID,e.source[s.ID]).attr(s.TAR_ID,e.target[s.ID]).attr("d",function(t){var i=l.elbowPoints(t[0],t[1],e.source[s.FACE]);return"M"+i[0].x+","+i[0].y+","+i[1].x+","+i[1].y+","+i[2].x+","+i[2].y+","+i[3].x+","+i[3].y});break;default:e[s.SHADOW]&&this._svg.selectAll(".lines").data([[r,o]]).enter().append("path").attr("class","line shadow").attr(s.SRC_ID,e.source[s.ID]).attr(s.TAR_ID,e.target[s.ID]).attr("x1",function(e){return e[0].x}).attr("y1",function(e){return e[0].y}).attr("x2",function(e){return e[1].x}).attr("y2",function(e){return e[1].y}),this._svg.selectAll(".lines").data([[r,o]]).enter().append("line").attr("class",c).attr("marker-start","url(#"+u+")").attr("marker-end","url(#"+d+")").attr(s.SRC_ID,e.source[s.ID]).attr(s.TAR_ID,e.target[s.ID]).attr("x1",function(e){return e[0].x}).attr("y1",function(e){return e[0].y}).attr("x2",function(e){return e[1].x}).attr("y2",function(e){return e[1].y})}}},this)},toggleAnimate:function(e,t){var i=this.parentContainer.selector||"",n=i+' [src-id="'+e+'"][tar-id="'+t+'"]',a=d3.select(n);a&&a.node()&&a.classed(s.ANIMATE,!a.classed(s.ANIMATE))},addClass:function(e,t){d3.select(e).classed(t,!0)},addAllClass:function(e,t){this._svg.selectAll(""+e).classed(t,!0)},removeClass:function(e,t){d3.select(e).classed(t,!1)},removeAllClass:function(e){this._svg.selectAll("."+e).classed(e,!1)},curveXPoints:function(e,t,n,s){return i.curveXPoints(e,t,n,s)},elbowPoints:function(e,t,n){return i.elbowPoints(e,t,n)},isSVGElement:function(e){return e.parents(".svg-container").length>0},getConnectionPoint:function(e,t,n){if(this.isSVGElement(e)){var s=e[0]&&e[0].firstChild?e[0].firstChild.nodeName:"rect";return n&&(s=n),i.getConnectionPoint(d3.select(e[0]),s,t)}return this.getHTMLConnectionPoint(e,t)},getHTMLConnectionPoint:function(e,t){var i=e.position(),n=i.left,a=i.top,r=e.outerWidth(),o=e.outerHeight(),l=e.css("margin-top");l&&(l=parseInt(l,10)),l&&!isNaN(l)||(l=0);var c=e.css("margin-left");c&&(c=parseInt(c,10)),c&&!isNaN(c)||(c=0);var u=void 0;switch(t){case s.ELEMENT_FACES.TOP:u={x:n+c+Math.round(r/2),y:a};break;case s.ELEMENT_FACES.BOTTOM:u={x:n+c+Math.round(r/2),y:a+l+o};break;case s.ELEMENT_FACES.LEFT:u={x:n+c,y:a+l+Math.round(o/2)};break;case s.ELEMENT_FACES.RIGHT:u={x:n+c+r,y:a+l+Math.round(o/2)}}return u},getNodeConnections:function(e,t){var i=[],n=[],a=[],r=[],o=t||function(){return!0};return this._traverseGraph(e,s.DIRECTIONS.LEFT,i,n,o),a=a.concat(i),r=r.concat(n),i=[],n=[],this._traverseGraph(e,s.DIRECTIONS.RIGHT,i,n,o),a=a.concat(i),r=r.concat(n),{nodes:_.uniq(a),edges:_.uniq(r)}},_traverseGraph:function(e,t,i,n,a){var r=this;if(!_.contains(i,e)){i.push(e);var o=this.vizDef[s.CONNECTORS],l=[];t===s.DIRECTIONS.LEFT?(l=_.filter(o,function(t){return a([t.source.id,e])&&t.target.id===e}),_.each(l,function(s){r._traverseGraph(s.source.id,t,i,n,a),n.push([s.source.id,e])})):t===s.DIRECTIONS.RIGHT&&(l=_.filter(o,function(t){return t.source.id===e}),l=_.filter(o,function(t){
return a([t.target.id,e])&&t.source.id===e}),_.each(l,function(s){r._traverseGraph(s.target.id,t,i,n,a),n.push([e,s.target.id])}))}},_clearTooltips:function(){$(".d3-tip").remove()}},{DP:s})}),define("models/softwareupgrade/SoftwareReleaseModel",["models/PollingModel","data/DataURLConstants","data/DataProperties","utils/AppConstants","utils/AppUtil"],function(e,t,i,n,s){"use strict";return e.extend({idAttribute:i.UPGRADE_NAME,entityType:n.ENTITY_SOFTWARE_RELEASE,name:"SoftwareReleaseModel",download:function(e){this.actionMode=n.ACTION_DOWNLOAD,this.isNew(!0),this.save(null,e)},cancelTransfer:function(e){this.actionMode=n.ACTION_CANCEL_TRANSFER,this.isNew(!0),this.save(null,e)},showLatencyNotification:function(e,t,i){s.log("SoftwareReleaseModel : "+this.actionMode+" ... for"+this.id)},showSuccessNotification:function(e){s.log("SoftwareReleaseModel :  '"+this.actionMode+"' has been performed successfully for"+this.id)},getURL:function(e){var i;return this.collection&&this.collection.softwareType&&(i=this.collection.softwareType),this.actionMode===n.ACTION_DOWNLOAD&&"create"===e?_.template(t.UPGRADE_DOWNLOAD,{type:i,id:encodeURI(this.get(this.idAttribute))}):this.actionMode===n.ACTION_CANCEL_TRANSFER&&"create"===e?_.template(t.UPGRADE_CANCEL_TRANSFER,{type:i,id:encodeURI(this.get(this.idAttribute))}):"delete"===e?_.template(t.UPGRADE_COMPATIBLE_NOS_RELEASES,{type:i,version:encodeURIComponent(this.get(this.idAttribute))+"/"}):void 0}})}),define("models/softwareupgrade/SoftwareReleaseCollection",["models/PollingCollection","models/softwareupgrade/SoftwareReleaseModel","data/DataURLConstants","data/DataProperties","utils/AppUtil","utils/AppConstants"],function(e,t,i,n,s,a){"use strict";var r=null,o=0,l=e.extend({model:t,entityType:a.ENTITY_SOFTWARE_RELEASE,url:i.UPGRADE_SOFTWARE_RELEASES,name:"SoftwareReleaseCollection",softwareType:null,initialize:function(e,t){if(this.initializeBaseCollection(e,t),!t||!t.softwareType)throw new Error("options.softwareType is required.");this.softwareType=t.softwareType,this.url=_.template(this.url,{type:this.softwareType})},comparator:function(e,t){if(this.softwareType===a.UPGRADE_SOFTWARE_TYPE.NOS||this.softwareType===a.UPGRADE_SOFTWARE_TYPE.PRISM_CENTRAL||this.softwareType===a.ONECLICK_PC_DEPLOY_SOFTWARE_TYPE){var i=e.get(n.UPGRADE_VERSION),r=t.get(n.UPGRADE_VERSION);return-s.compareVersions(i,r)}var o=e.get(n.UPGRADE_NAME),l=t.get(n.UPGRADE_NAME);return o===l?0:o<l?1:-1}},{getSharedPCDeploySoftwareCollection:function(){return o++,null===r&&(r=new l(null,{softwareType:a.ONECLICK_PC_DEPLOY_SOFTWARE_TYPE})),r},releaseSharedPCDeployInstance:function(){0===--o&&(r.isPolling()&&r.stopPolling(),r=null)},getAvailableSoftwares:function(e,t){return _.filter(e,function(e){var i=e.get(n.UPGRADE_STATUS);return e.get(n.NAME)===t&&(i===a.UPGRADE_SOFTWARE_RELEASE_STATUS.COMPLETED||i===a.UPGRADE_SOFTWARE_RELEASE_STATUS.AVAILABLE)})},getPCSizeFromSharedInstance:function(e){var t=this.getSharedPCDeploySoftwareCollection(),i=_.first(this.getAvailableSoftwares(t.models,e));if(!i)return null;var s=i.get(n.PRISM_CENTRAL_SIZES);return this.releaseSharedPCDeployInstance(),s}});return l}),define("utils/PCScaleOutMixin",["models/query/QueryResultCollection","models/softwareupgrade/SoftwareReleaseCollection","utils/AppConstants","data/DataProperties"],function(e,t,i,n){"use strict";return{loadNetworkAndContainer:function(t,s,a){var r=this,o=[],l=new e(null,{entity_type:i.ENTITY_VIRTUAL_NETWORK,entity_ids:[t],group_member_attributes:[n.NAME]}),c=new e(null,{entity_type:i.ENTITY_CONTAINER,entity_ids:[s],group_member_attributes:[n.CTR_NAME]});o.push(l.fetch()),o.push(c.fetch()),$.when.apply($,o).done(function(){var e=l.models,t=c.models;if(!e.length||!t.length)return void r.showDataSyncMessage();var i=_.first(e).get(n.NAME),s=_.first(t).get(n.CTR_NAME);r.loadNetworkAndContianerSuccess(i,s,a)}).fail(function(e,t){r.loadNetworkAndContainerError(e,t)})},loadSoftwareRelease:function(e){var n=this,s=this.model.getHostedClusterUuid(),a=this.clusterManager.getNameById(s),r=this.clusterManager.getPrismCentralVersion(),o=new t(null,{softwareType:i.ONECLICK_PC_DEPLOY_SOFTWARE_TYPE});o.setProxyClusterUuid(s),o.fetch({success:function(s){var o=t.getAvailableSoftwares(s.models,r);o&&0!==o.length?n.$(".add-pcvm-btn").attr(i.NAV_ACTION,i.ACTION_CREATE_PC).attr(i.NAV_ACTION_TARGET_ID,a):n.$(".add-pcvm-btn").attr(i.NAV_ACTION,i.ACTION_DEPLOY).attr(i.NAV_ACTION_TARGET_ID,a),n.onClickAddPCVM(e)},error:function(e,t){n.triggerAction(i.MODAL.ACT.ALERT_SHOW,{type:i.MODAL.ALERT.TYPE_ERROR,message:t.responseText||n.i18n("serverError")})}})}}}),define("views/basecomponents/vantagepoints/elements/summary/PCVMsSummaryVantagePointView",["views/basecomponents/vantagepoints/elements/BasePCDeploymentVantagePointView","views/viz/VizView","views/popups/multicluster/clustermanagement/PCVirtualIPDetailsPopupView","managers/ActionManager","utils/AppConstants","utils/CommonTemplates","utils/VisualizationUtil","utils/SubViewHelper","utils/PCScaleOutMixin","utils/AppUtil","views/basecomponents/vantagepoints/elements/PrismCentralVantagePointTemplates"],function(e,t,i,n,s,a,r,o,l,c,u){"use strict";return e.extend(_.extend({},l,{SUBVIEW_CONNECTORS:"subview_connectors",className:"n-vantage-point-summary-content",name:"PCVMsSummaryVantagePointView",enableColumn:!0,numberOfColumns:1,connectorsView:null,subViewHelper:null,networkInfoTemplate:_.template('<div class="network_name"><div class="network_name_value value">               <%= networkName %> </div><div class="network_name_label label">               <%= i18n("network")%></div></div><div class="network_subnet"><div class="network_subnet_value value">               <%= subnetMask %> </div><div class="network_subnet_label label">               <%= i18n("subnet_mask")%></div></div><div class="network_gateway"><div class="network_gateway_value value"> <%= gateway %> </div><div class="network_gateway_label label"             ><%= i18n("default_gateway")%></div></div>'),scaleOutTemplate:_.template('<div class="scale-out-wrapper"><div class="scale-out-desc"><% if (!isLoading) { %><%= i18n("scale_out_desc") %><% } else { %><%=  loadingMsg                    ({msg: i18n("scaling_out_prism_central")})%><% } %></div><% if (!isLoading) { %><button class="btn btn-primary add-pcvm-btn"action="create_pc" actionTarget="prism_central_vm"><%= i18n("scale_out_pc")%></button><% } %></div>'),pcVMWrapperTemplate:_.template('<div class="pc-vm-wrapper"><div class="pc-vm-info"><div class="cluster-name"> <%= hostClusterName %> </div><div class="vm-num"> 1 VM </div><div class="container-name"><%=i18n("container")%>:<%= containerName %> </div></div></div>'),events:{"click .edit-virtual-ip":"onEditVirtualIpClick"},initializeModels:function(){e.prototype.initializeModels.apply(this,arguments),this.subViewHelper=new o},renderModel:function(e,t,i){this.model=e||this.model,this.renderModelContent(this.model,i)},renderModelContent:function(e,t){var i=this.model.DP,n=this.model.getNetworkConfiguration(),s=n[i.NETWORK_UUID],a=this.model.getContainerUuid();this.$el.html(u.CUSTOMIZED_CONTENT_COLUMN_VM()),this.loadNetworkAndContainer(s,a,t)},loadNetworkAndContianerSuccess:function(e,t,i){this.$(".n-column-content-2").removeClass("show-sync-msg"),this.renderPCVMView(e,t,i)},loadNetworkAndContainerError:function(e,t){this.renderModelError(e,t)},showDataSyncMessage:function(){this.$(".n-column-content-1").html(u.DATA_SYNC_MESSAGE(this.vtOptions({message:this.i18n("data_not_available")}))),this.$(".n-column-content-2").addClass("show-sync-msg"),this.$(".n-column-content-2").html(u.DATA_SYNC_MESSAGE(this.vtOptions({message:this.i18n("data_not_available")+"</br>"+this.i18n("data_not_available_details")})))},renderPCVMView:function(e,i,n){var o=this.hasAddNodeRequestInProgress(n),l=this.model.getPCVMSpec(),d=this.model.getVirtualIP(),h=this.model.getVMIPList(),p=this.model.getVMNameList(),_=this.model.getHostedClusterUuid(),T=l.length>=s.INITIAL_PC_VM_NO,E=this.clusterManager.getNameById(_),S=this.model.getNetworkConfiguration(),g=S[this.model.DP.DEFAULT_GATEWAY],A=S[this.model.DP.SUBNET_MASK],m=this.model.getNumOfSockets(),f=this.model.getMemorySize(),I=(this.clusterManager.getPrismCentralVersion(),this.clusterManager.getClusterVersionByClusterUuid(_));if(this.model.trigger("deploymentStatusChange",o),this.$(".n-column-content-1").html(this.networkInfoTemplate(this.vtOptions({networkName:e,gateway:g,subnetMask:A}))),T){var C=u.CONNECTOR_TEMPLATE(this.vtOptions({virtualIP:d,containerName:i,isLoading:o,loadingMsg:a.LOADING_MSG,hostClusterName:E,pcVMNum:l.length})),v={};v[t.DP.LAYOUT_SYSTEM]=t.DP.LAYOUT_PERCENTAGE,v[t.DP.CONNECTORS]=[],r.updateColumnContent(this.$(".n-content-column-customized"),C,2,!0);for(var R="",N=1;N<=l.length;N++){var P=this._isPcVmDeleted(l[N-1]),O=l[N-1][this.model.DP.POWER_STATE]===s.SSP_VM_POWER_STATE.POWERED_OFF;R+=u.PC_VM_NAME_TILE(this.vtOptions({dataId:"PC-NameOption-"+N,PCVMName:p[N-1],ipAddress:h[N-1],isDeleted:P,isPoweredOff:O,showCriticalWarning:P||O})),v[t.DP.CONNECTORS].push(this.constructNewConnector(N))}this.$(".tiles-container").html(R),this.renderVirtualIp(d),this.subViewHelper.get(this.SUBVIEW_CONNECTORS)&&this.subViewHelper.remove(this.SUBVIEW_CONNECTORS);var y=new t({el:this.$(".viz-main-svg"),viewDefinition:v,parentContainer:this.$(".html-svg-wrapper")});this.subViewHelper.register(this.SUBVIEW_CONNECTORS,y);var D=s.PC_VM_VERTICAL_DIST*l.length;this.$(".viz-main-container").css("height",D+"px"),this.$(".ip-address-group").css("margin-top","-"+D+"px"),y.render()}else{var M=!0;I&&c.compareVersions(I,s.PC_SCALE_OUT_VERSION_GA,3)>=0&&(M=!1),this.$(".n-column-content-2").html(this.scaleOutTemplate(this.vtOptions({isLoading:o,loadingMsg:a.LOADING_MSG,hostClusterName:E}))),this.$(".scale-out-wrapper").append(this.pcVMWrapperTemplate(this.vtOptions({hostClusterName:E,containerName:i}))),M&&this.$(".add-pcvm-btn").addClass("gray-out").tooltip({title:this.i18ns("upgrade_pe",E),placement:"right",trigger:"hover",html:!0,container:$("body")});var b=this._isPcVmDeleted(l[0]),L=l[0][this.model.DP.POWER_STATE]===s.SSP_VM_POWER_STATE.POWERED_OFF;this.$(".pc-vm-info").append(u.PC_VM_NAME_TILE(this.vtOptions({dataId:"PC-NameOption-1",PCVMName:p[0],ipAddress:h[0],isDeleted:b,isPoweredOff:L,showCriticalWarning:b||L})))}this.$(".vm-powered-off, .vm-deleted").tooltip("destroy"),this.$(".vm-deleted").tooltip({title:this.i18n("vm_deleted_tooltip"),placement:"bottom",trigger:"hover",container:$("body")}),this.$(".vm-powered-off").tooltip({title:this.i18n("vm_powered_off_tooltip"),placement:"bottom",trigger:"hover",container:$("body")}),this.$(".cpu-info").html(m+" "+this.i18n("vcpus")),this.$(".memory-size").html(f/Math.pow(s.UNITS_PER_K,3)+" "+this.i18n("memory"))},renderVirtualIp:function(e){e?(this.$(".no-virtual-ip").hide(),this.$(".has-virtual-ip").show(),this.$(".has-virtual-ip").html(u.HAS_VIRTUAL_IP_TEMPLATE(this.vtOptions({virtualIP:e})))):(this.$(".has-virtual-ip").hide(),this.$(".no-virtual-ip").show(),this.$(".no-virtual-ip").html(u.NO_VIRTUAL_IP_TEMPLATE(this.vtOptions())))},constructNewConnector:function(e){return{source:{face:"R",id:"virtual-ip"},target:{face:"L",id:s.DEFAULT_VM_NAME_PREFIX+e},type:"elbow"}},onClickAddPCVM:function(e){n.executeActionElement(e.currentTarget)},onEditVirtualIpClick:function(e){var t=this;new i({el:c.createPopupContainer("popupPCVirtualIPDetails"),virtualIp:this.model.getVirtualIP(),onSuccess:function(e){t.model.fetch(),t.renderVirtualIp(e)}}).show()},destroy:function(){this.$(".vm-powered-off",".vm-deleted",".add-pcvm-btn").tooltip("destroy"),this.subViewHelper&&(this.subViewHelper.destroy(),this.subViewHelper=null),e.prototype.destroy.apply(this,arguments)},_isPcVmDeleted:function(e){var t=e[this.model.DP.VM_NAME];return(!t||t===s.PC_VM_NAME_DELETED)&&!e[this.model.DP.MEMORY_SIZE_BYTES]&&!e[this.model.DP.NUM_SOCKETS]&&e[this.model.DP.NIC_LIST]&&e[this.model.DP.NIC_LIST][0]&&e[this.model.DP.NIC_LIST][0][this.model.DP.IP_LIST]&&e[this.model.DP.NIC_LIST][0][this.model.DP.IP_LIST][0]}}))}),define("views/basecomponents/vantagepoints/elements/summary/SummaryVantagePointView",["views/basecomponents/vantagepoints/elements/BaseVantagePointView","models/hardware/DiskCollection","models/dataprotection/ProtectionDomainCollection","models/resiliency/ResiliencyCollection","models/filtercount/VMCountByClusterModel","models/filtercount/HostCountByClusterModel","models/filtercount/VMPowerStateCountModel","models/EntityProjectionModel","models/multicluster/PCVMModel","views/basecomponents/vantagepoints/elements/summary/StorageSummaryVantagePointView","views/basecomponents/vantagepoints/elements/summary/HardwareSummaryVantagePointView","views/basecomponents/vantagepoints/elements/summary/VMSummaryVantagePointView","views/basecomponents/vantagepoints/elements/summary/DRSummaryVantagePointView","views/basecomponents/vantagepoints/elements/summary/HypervisorSummaryVantagePointView","views/basecomponents/vantagepoints/elements/summary/HypervisorSummaryHomeVantagePointView","views/basecomponents/vantagepoints/elements/summary/MulticlusterSummaryVantagePointView","views/basecomponents/vantagepoints/elements/summary/MulticlusterVMSummaryVantagePointView","views/basecomponents/vantagepoints/elements/summary/MulticlusterHardwareSummaryVantagePointView","views/basecomponents/vantagepoints/elements/summary/MulticlusterHealthSummaryVantagePointView","views/basecomponents/vantagepoints/elements/summary/HealthSummaryVantagePointView","views/basecomponents/vantagepoints/elements/summary/ResiliencyStatusSummaryVantagePointView","views/basecomponents/vantagepoints/elements/summary/PCClusterSummaryVantagePointView","views/basecomponents/vantagepoints/elements/summary/PrismCentralSummaryVantagePointView","views/basecomponents/vantagepoints/elements/summary/PCCapacityMiniVantagePointView","views/basecomponents/vantagepoints/elements/summary/PCVMsSummaryVantagePointView","managers/HealthManager","managers/I18nManager","managers/TaskManager","events/AppEvents","utils/AppConstants","utils/FilterUtil","data/DataProperties"],function(e,t,i,n,s,a,r,o,l,c,u,d,h,p,T,E,S,g,A,m,f,I,C,v,R,N,P,O,y,D,M,b){"use strict";return e.extend({vantagePointCSS:"n-vantage-point-summary",enableAntiscroll:!1,titleOptions:!1,events:_.extend({},e.prototype.events,{"click .titleOption":"onClickTitleOption"}),updateStyle:function(){var e=this.getAspectsValue(D.VP_ASPECT_TYPE);this.vantagePointCSS+=" "+this.vantagePointCSS+"-"+e},updateSubView:function(){var e=this.getAspectsValue(D.VP_ASPECT_TYPE);this.getAspectsValue(D.VP_ASPECT_ENTITY);switch(e){case D.VP_SUMMARY_TYPE.STORAGE:this.subView=new c,this.titleOptions=!0;break;case D.VP_SUMMARY_TYPE.HYPERVISOR:this.subView=new p;break;case D.VP_SUMMARY_TYPE.HYPERVISOR_HOME:this.subView=new T;break;case D.VP_SUMMARY_TYPE.VM:this.subView=new d;break;case D.VP_SUMMARY_TYPE.HARDWARE:this.subView=new u;break;case D.VP_SUMMARY_TYPE.CLUSTER:this.subView=new E;break;case D.VP_SUMMARY_TYPE.MC_VM:this.subView=new S;break;case D.VP_SUMMARY_TYPE.MC_HARDWARE:this.subView=new g;break;case D.VP_SUMMARY_TYPE.MC_HEALTH:this.subView=new A;break;case D.VP_SUMMARY_TYPE.HEALTH:this.subView=new m;break;case D.VP_SUMMARY_TYPE.DR:this.subView=new h;break;case D.VP_SUMMARY_TYPE.RESILIENCY_STATUS:this.subView=new f;break;case D.VP_SUMMARY_TYPE.PC_CLUSTER:this.subView=new I,this.titleOptions=!0;break;case D.VP_SUMMARY_TYPE.PC_CAPACITY:this.subView=new C;break;case D.VP_SUMMARY_TYPE.PC_CAPACITY_MINI:this.subView=new v;break;case D.VP_SUMMARY_TYPE.PC_VMs:this.subView=new R}},updateDataModels:function(){var e,c,u,d=this.getAspectsValue(D.VP_ASPECT_TYPE),h=D.NO_INTERVAL;switch(this.getClusterUuid()&&(u=this.getClusterUuid()),d){case D.VP_SUMMARY_TYPE.STORAGE:this.isClusterFFEnabled(D.FFLAGS.ARITHMOS_USAGE_STATS)?(c=u?this.clusterManager.getClusterModelByClusterUuid(u):this.clusterManager.getCurrentClusterModel())&&(c.alwaysTriggerChange=!0):e=new t,h=D.LONG_POLLING_INTERVAL;break;case D.VP_SUMMARY_TYPE.MC_HARDWARE:h=D.LONG_POLLING_INTERVAL,c=new a;break;case D.VP_SUMMARY_TYPE.HYPERVISOR_HOME:case D.VP_SUMMARY_TYPE.HYPERVISOR:var p=o.DP.HOST_ENTITY;h=D.LONG_POLLING_INTERVAL,c=new o({entityType:D.ENTITY_HOST,projection:[p.HYPERVISOR_FULL_NAME,p.HYPERVISOR_TYPE]});break;case D.VP_SUMMARY_TYPE.HARDWARE:c=u?this.clusterManager.getClusterModelByClusterUuid(u):this.clusterManager.getCurrentClusterModel(),c&&(c.alwaysTriggerChange=!0);break;case D.VP_SUMMARY_TYPE.MC_VM:c=new s,h=D.LONG_POLLING_INTERVAL;break;case D.VP_SUMMARY_TYPE.VM:c=new r,h=D.LONG_POLLING_INTERVAL;break;case D.VP_SUMMARY_TYPE.CLUSTER:break;case D.VP_SUMMARY_TYPE.DR:e=new i;break;case D.VP_SUMMARY_TYPE.RESILIENCY_STATUS:c=new n,h=D.LONG_POLLING_INTERVAL;break;case D.VP_SUMMARY_TYPE.MC_HEALTH:break;case D.VP_SUMMARY_TYPE.HEALTH:e=N.getClusterHealthStatsModel();break;case D.VP_SUMMARY_TYPE.PC_CLUSTER:case D.VP_SUMMARY_TYPE.PC_CAPACITY:case D.VP_SUMMARY_TYPE.PC_CAPACITY_MINI:case D.VP_SUMMARY_TYPE.PC_VMs:c=l.getSharedPCVMModel(),this.sharedCollection=!0}if(e||c){if(u){var _=M.getEqualsFIQL(b.FILTER_CLUSTER_UUID,this.clusterUuid);e&&e.setFilterCriteria(_),c&&c.setFilterCriteria(_)}this.registerDataModel(e||c,this,this.renderSuccess,this.renderError,h),e&&e.length&&e.triggerUpdate(),c&&c.getState()===D.STATE_SUCCESS&&this.renderSuccess(c)}else this.isEmptyContent=!0},renderSuccess:function(e,t,i){if(this.subView){this.subView.renderModel(e,t,i);O.getGlobalTasks().hasActiveClusterConvertTask()&&this.handleClusterConversionInProgress(null,{inProgress:!0}),y.onAppEvent(y.NODE_CONVERSION_IN_PROGRESS,_.bind(this.handleClusterConversionInProgress,this))}},handleClusterConversionInProgress:function(e,t){var i=this.getAspectsValue(D.VP_ASPECT_TYPE);if(i===D.VP_SUMMARY_TYPE.HYPERVISOR_HOME||i===D.VP_SUMMARY_TYPE.HYPERVISOR){var n=t.inProgress?P.t(this.subView.name,"conversionTitle"):null;this.updateTitle(n)}},destroy:function(){if(this.sharedCollection){var t=this.getAspectsValue(D.VP_ASPECT_TYPE);t!==D.VP_SUMMARY_TYPE.PC_CAPACITY&&t!==D.VP_SUMMARY_TYPE.PC_CAPACITY_MINI&&t!==D.VP_SUMMARY_TYPE.PC_VMs&&t!==D.VP_SUMMARY_TYPE.PC_CLUSTER||l.releaseSharedPCVMModel()}e.prototype.destroy.apply(this,arguments)},updateTitleOptions:function(){var e="";this.subView.getTitleOptions&&(e=this.subView.getTitleOptions()),this.$(".vpTitleOptions").html(e)},onClickTitleOption:function(e){this.subView.onClickTitleOption&&this.subView.onClickTitleOption(e)}})}),define("text!templates/basecomponents/vantagepoints/elements/feature/TotalCompressionSavings.html",[],function(){return'<div class="total-compression-container">\n  <div class="savings-container">\n    <div class="data-reduction-savings tooltip-wrapper"\n      ntnxtooltip="DATAREDUCTION_RATIO">\n      <div class="ratio">\n        <%= totalSavingsRatio %>\n      </div>\n      <div>\n        <span><%= i18n(\'data_reduction\') %></span>\n      </div>\n    </div>\n  </div>\n  <div class="seperator"></div>\n  <div class="line-items savings-container clearfix tooltip-wrapper"\n    ntnxtooltip="SAVINGS_TOOLTIP">\n    <div>\n      <%= i18n(\'total_savings\') %>\n    </div>\n    <div>\n      <%= totalSavedBytes %>\n    </div>\n  </div>\n  <div class="seperator"></div>\n  <div class="line-items savings-container clearfix tooltip-wrapper"\n    ntnxtooltip="OVERALL_EFFICIENCY">\n    <div>\n      <%= i18n(\'overall_efficiency\') %>\n    </div>\n    <div>\n      <%= overallEfficiencyRatio %>\n    </div>\n  </div>\n</div>'}),define("views/basecomponents/vantagepoints/elements/feature/UsageSavingsFeatureVantagePointView",["views/basecomponents/vantagepoints/elements/SubviewVantagePointView","text!templates/basecomponents/vantagepoints/elements/feature/TotalCompressionSavings.html","data/DataProperties","utils/StatsUtil","utils/TooltipContent","events/AppEvents"],function(e,t,i,n,s,a){"use strict";var r=_.template(t);return e.extend({name:"UsageSavingsFeatureVantagePointView",className:"n-vantage-point-feature-content",featureType:null,onStartServices:function(){this.model=this.clusterManager.getClusterCollection(),this.model.on("reset",this.renderModel,this),this.model.triggerUpdate()},onStopServices:function(){this.model.off("reset",this.renderModel,this)},renderModel:function(e){this.renderModelContent()},renderModelContent:function(){var e=this.model.at(0),t=e.get(i.USAGE_STATS),s=this,o=parseInt(t[i.TOTAL_SAVED_BYTES],10),l=n.formatStatsRatio(t[i.TOTAL_SAVINGS_RATIO]),c=n.formatStatsRatio(t[i.TOTAL_EFFICIENCY_RATIO]);if(o<=0||isNaN(o))return void this.trigger(a.SHOW_FEATURE_DISABLED);this.$el.html(r(this.vtOptions({totalSavedBytes:n.storageFormat(o),totalSavingsRatio:l,overallEfficiencyRatio:c}))),this.$(".tooltip-wrapper").tooltip({title:function(){var e=$(this).attr("ntnxtooltip");return s.getToolTipContent(e)},placement:"right",trigger:"hover",html:!0,container:this.$el.find(".total-compression-container")}),this.$(".nutanixMoreInfo").nutanixMoreInfo({parseDataAttrs:!0}),$("body").on("click",_.bind(this.onDocumentClick,this))},getToolTipContent:function(e){switch(e){case"SAVINGS_TOOLTIP":return this.i18n("usage_title_tooltip");default:return s.STORAGE_STATS[e].BREAKDOWN(this.vtOptions({}))}},onDocumentClick:function(){this.$(".tooltip-wrapper").tooltip("hide")},destroy:function(){this.$(".tooltip-wrapper").tooltip("destroy"),this.model.off("reset",this.renderModel,this),$("body").off("click",this.onDocumentClick),e.prototype.destroy.apply(this,arguments)}})}),define("text!templates/basecomponents/vantagepoints/elements/feature/LogicalPhysicalColumnBars.html",[],function(){return'<% if (isAvailable) {\n\n  // Set the properties\n  var barHeight = 55;\n  var logicalHeight = logicalTier1 + logicalTier2;\n  var physicalHeight = physicalTier1 + physicalTier2 + totalSaved;\n\n%>\n\n<div class="n-logical-physical">\n  <table width="100%" cellspacing="0" cellpadding="0"\n      class="n-logical-physical-content">\n    <tbody>\n      <tr>\n        \x3c!-- Logical --\x3e\n        <td width="45%" height="100%" align="right">\n\n          \x3c!-- Column wrapper --\x3e\n          <table class="n-column-table">\n            <tr>\n              <td>\n                \x3c!-- Column label --\x3e\n                <div class="n-logical-physical-column-label">\n                  <% if (logicalTier1 > 0) { %>\n                    <div class="n-logical-physical-label">\n                      <span class="label-type"><%= nameTier1 %></span>\n                      <span class="label-value"><%= lblLogicalTier1 %></span>\n                    </div>\n                  <% } %>\n                  <% if (logicalTier2 > 0) { %>\n                    <div class="n-logical-physical-label">\n                      <span class="label-type"><%= nameTier2 %></span>\n                      <span class="label-value"><%= lblLogicalTier2 %></span>\n                    </div>\n                  <% } %>\n                </div>\n              </td>\n              <td>\n                \x3c!-- Column bar --\x3e\n                <div class="n-logical-physical-column-bar  n-left"\n                     style="height: <%= barHeight %>px">\n\n                  <% if (logicalTier1 > 0) { %>\n                    <div class="n-usage-bar n-logical-physical-tier1"\n                      style="height: <%= barHeight *\n                        (logicalTier1 / logicalHeight) + 1 %>px">\n                    </div>\n                  <% } %>\n\n                  <% if (logicalTier2 > 0) { %>\n                    <div class="n-usage-bar n-logical-physical-tier2"\n                    style="height: <%= barHeight *\n                    (logicalTier2 / logicalHeight) + 1 %>px">\n                    </div>\n                  <% } %>\n\n                </div>\n              </td>\n            </tr>\n          </table>\n\n\n        </td>\n\n        \x3c!-- Arrow --\x3e\n        <td width="10%" height="100%">\n          <div class="n-direction">\n            <% if (Number(lblRatio) > 0) { %>\n              <div class="n-ratio"><%= lblRatio %> : 1</div>\n            <% } %>\n            <i aria-hidden="true" data-icon="y" class="n-arrow"></i>\n          </div>\n        </td>\n\n        \x3c!-- Physical --\x3e\n        <td width="45%" height="100%" align="left">\n\n          \x3c!-- Column wrapper --\x3e\n          <table class="n-column-table">\n            <tr>\n              <td>\n\n                \x3c!-- Column bar --\x3e\n                <div class="n-logical-physical-column-bar n-right"\n                     style="height: <%= barHeight %>px">\n\n                  <% if (totalSaved > 0) { %>\n                    <div class="n-usage-bar n-logical-physical-saved"\n                    style="height: <%= barHeight *\n                    (totalSaved / physicalHeight) + 1 %>px">\n                    </div>\n                  <% } %>\n\n                  <% if (physicalTier1 > 0) { %>\n                    <div class="n-usage-bar n-logical-physical-tier1"\n                    style="height: <%= barHeight *\n                    (physicalTier1 / physicalHeight) + 1 %>px">\n                    </div>\n                  <% } %>\n\n                  <% if (physicalTier2 > 0) { %>\n                    <div class="n-usage-bar n-logical-physical-tier2"\n                    style="height: <%= barHeight *\n                    (physicalTier2 / physicalHeight) + 1 %>px">\n                    </div>\n                  <% } %>\n\n                </div>\n\n              </td>\n              <td>\n\n                \x3c!-- Column label --\x3e\n                <div class="n-logical-physical-column-label">\n\n                  <% if (totalSaved > 0) { %>\n                    <div class="n-logical-physical-label">\n                      <span class="label-type">Saved</span>\n                      <span class="label-value"><%= lblTotalSaved %></span>\n                    </div>\n                  <% } %>\n\n                  <% if (physicalTier1 > 0) { %>\n                    <div class="n-logical-physical-label">\n                      <span class="label-type"><%= nameTier1 %></span>\n                      <span class="label-value"><%= lblPhysicalTier1 %></span>\n                    </div>\n                  <% } %>\n\n                  <% if (physicalTier2 > 0) { %>\n                    <div class="n-logical-physical-label">\n                      <span class="label-type"><%= nameTier2 %></span>\n                      <span class="label-value"><%= lblPhysicalTier2 %></span>\n                    </div>\n                  <% } %>\n                </div>\n              </td>\n            </tr>\n          </table>\n        </td>\n      </tr>\n      <tr>\n        <td align="right" class="n-column-label"><%= lblColumn1 %></td>\n        <td></td>\n        <td align="left" class="n-column-label"><%= lblColumn2 %></td>\n      </tr>\n    </tbody>\n  </table>\n</div>\n\n<% } else { %>\n\n\x3c!-- Empty --\x3e\n<div class="n-col">\n  <div class="n-empty  n-not-available">\n    <%= i18n(\'not_available\', \'Not Available\') %>\n  </div>\n</div>\n\n<% } %>'}),define("views/basecomponents/vantagepoints/elements/feature/DedupFeatureVantagePointView",["views/basecomponents/vantagepoints/elements/SubviewVantagePointView","text!templates/basecomponents/vantagepoints/elements/feature/LogicalPhysicalColumnBars.html","data/DataProperties","utils/AppConstants","utils/AntiscrollUtil","utils/StatsUtil"],function(e,t,i,n,s,a){"use strict";var r=_.template(t);return e.extend({className:"n-vantage-point-feature-content",name:"DedupFeatureVantagePointView",renderModel:function(e){this.renderModelContent()},renderModelContent:function(){var e=this.model.at(0),t=e.get(i.STATS),o=parseInt(t[i.CONTENT_CACHE_PHYSICAL_SSD_USAGE_BYTES],10),l=parseInt(t[i.CONTENT_CACHE_PHYSICAL_MEMORY_USAGE_BYTES],10),c=parseInt(t[i.CONTENT_CACHE_LOGICAL_SSD_USAGE_BYTES],10),u=parseInt(t[i.CONTENT_CACHE_LOGICAL_MEMORY_USAGE_BYTES],10),d=parseInt(t[i.CONTENT_CACHE_SAVED_SSD_USAGE_BYTES],10),h=parseInt(t[i.CONTENT_CACHE_SAVED_MEMORY_USAGE_BYTES],10),p=parseInt(t[i.CONTENT_CACHE_NUM_DEDUP_REF_COUNT_PPH],10)/100,_=0,T=!1;(o>0||l>0||c>0||u>0)&&(T=!0),_=d+h,this.$el.html(r(this.vtOptions({isAvailable:T,lblColumn1:this.i18n(n.VP_FEATURE_LABEL.LOGICAL),lblColumn2:this.i18n(n.VP_FEATURE_LABEL.PHYSICAL),nameTier1:this.i18n(n.VP_FEATURE_LABEL.MEMORY),nameTier2:this.i18n(n.VP_FEATURE_LABEL.SSD),physicalTier1:l,physicalTier2:o,logicalTier1:u,logicalTier2:c,totalSaved:_,lblRatio:p,lblPhysicalTier1:a.storageFormat(l),lblPhysicalTier2:a.storageFormat(o),lblLogicalTier1:a.storageFormat(u),lblLogicalTier2:a.storageFormat(c),lblTotalSaved:a.storageFormat(_)}))),T&&s.triggerAntiScroll(this)},onStartServices:function(){this.model=this.clusterManager.getClusterCollection(),this.model.on("reset",this.renderModel,this),this.model.triggerUpdate()},onStopServices:function(){this.model.off("reset",this.renderModel,this)}})}),define("views/basecomponents/vantagepoints/elements/feature/FeatureVantagePointView",["backbone","views/basecomponents/vantagepoints/elements/BaseVantagePointView","views/basecomponents/vantagepoints/elements/feature/UsageSavingsFeatureVantagePointView","views/basecomponents/vantagepoints/elements/feature/DedupFeatureVantagePointView","utils/AppConstants","utils/AppUtil","events/AppEvents"],function(e,t,i,n,s,a,r){"use strict";var o=_.template('<div class="n-feature-disabled"><%= disabledText %></div><div>&nbsp;</div>');return t.extend({LABEL_FEATURE_GENERIC:"",LABEL_FEATURE_TOTAL_COMPRESSION:"",vantagePointCSS:"n-vantage-point-feature",name:"FeatureVantagePointView",initialize:function(e){t.prototype.initialize.apply(this,arguments),this.LABEL_FEATURE_GENERIC=this.i18n("feature"),this.LABEL_FEATURE_TOTAL_COMPRESSION=this.i18n("capacity_optimization")},updateSubView:function(){switch(this.getAspectsValue(s.VP_ASPECT_TYPE)){case s.VP_FEATURE_TYPE.TOTAL_COMPRESSION_SAVINGS:this.subView=new i;break;case s.VP_FEATURE_TYPE.DEDUPLICATION:this.subView=new n;break;case s.VP_FEATURE_TYPE.ENCRYPTION:case s.VP_FEATURE_TYPE.MIGRATION:}this.subView&&this.subView.on(r.SHOW_FEATURE_DISABLED,_.bind(this.onShowFeatureDisabled,this))},updateDataModels:function(){},renderSuccess:function(e){this.subView&&this.subView.renderModel(e)},onShowFeatureDisabled:function(){var e;e=this.getAspectsValue(s.VP_ASPECT_TYPE)===s.VP_FEATURE_TYPE.TOTAL_COMPRESSION_SAVINGS?this.LABEL_FEATURE_TOTAL_COMPRESSION:this.LABEL_FEATURE_GENERIC,this.$(".n-content-inner").html(o({feature:e,disabledText:a.sprintf(this.i18n("no_feature_savings","There are no %s savings to show."),e)}))}})}),define("views/basecomponents/vantagepoints/elements/ListVantagePointTemplates",[],function(){"use strict";return{COMMON_HEADER:_.template('<div class="n-multi-col  n-col-head-1-of-2">             Name           </div>           <div class="n-multi-col  n-col-head-2-of-2  n-numeric">             <%= metric %>           </div>'),COMMON_ROW:_.template('<li class="<%= row %>  n-list-row" <%= attrs %>              data-id="<%= model.id %>"          >             <div class="n-multi-col  n-col-1-of-2">               <a title="<%= _.escape(model.name) %>">                 <%= _.escape(model.name) %>               </a>             </div>             <div class="n-multi-col  n-col-2-of-2  n-numeric">               <%= value1 ? value1 : "-" %>             </div>           </li>'),NO_CONTENT:_.template('<li class="n-row-odd n-list-row">            <div class="n-multi-col  n-col-1-of-2">              <%= text %>           </div>            <div class="n-multi-col  n-col-2-of-2  n-numeric"></div>         </li>')}}),define("text!templates/basecomponents/vantagepoints/elements/metric/TopMetricVantagePointView.html",[],function(){
return'<div class="n-title">\n  <span class="lblTitle title" title="<%- title %>">\n    <%- title %>\n  </span>\n</div>\n<div class="n-content  n-content-topmetric">\n  \x3c!-- Antiscroll --\x3e\n  <div class="antiscroll-wrap">\n    <div class="box-wrap">\n      <div class="antiscroll-inner">\n        <div class="box-inner  n-content-inner">\n          <ul class="n-list">\n            \x3c!-- Place content here --\x3e\n          </ul>\n        </div>\n      </div>\n    </div>\n  </div>\n</div>'}),define("views/basecomponents/vantagepoints/elements/metric/TopMetricVantagePointView",["views/basecomponents/vantagepoints/elements/BaseVantagePointView","views/basecomponents/vantagepoints/elements/ListVantagePointTemplates","text!templates/basecomponents/vantagepoints/elements/metric/TopMetricVantagePointView.html","models/storage/ContainerCollection","models/cluster/ClusterCollection","models/hardware/HostCollection","models/hardware/DiskCollection","models/vm/VMCollection","models/dataprotection/ProtectionDomainCollection","models/dataprotection/RemoteSiteCollection","managers/NavigationManager","managers/ClusterManager","data/DataProperties","utils/AppConstants","utils/AppUtil","utils/StatsUtil","utils/SVG"],function(e,t,i,n,s,a,r,o,l,c,u,d,h,p,T,E,S){"use strict";return e.extend({DEFAULT_COUNT:5,vantagePointCSS:"n-vantage-point-metric  n-vantage-point-top-metric",templateRow:null,events:{"click  .n-list-row":"onClick"},updateTemplate:function(){var e=this.model.toJSON(),t=this.i18n(e.name,e.name);this.template=_.template(i,{model:e,title:t,SVG:S,customizable:this.isCustomizable})},updateDataModels:function(){var e,t,i=this.getAspectsValue(p.VP_ASPECT_METRIC),u=this.getAspectsValue(p.VP_ASPECT_ENTITY),d=this.getAspectsValue(p.VP_ASPECT_COUNT)||this.DEFAULT_COUNT,T=this.getAspectsValue(p.VP_ASPECT_ORDER)||"descending",S=E.getStatsProperty(i,u,!0,this.getClusterUuid()),g={comparator:_.bind(this.sortMetric,this)};switch(u){case p.ENTITY_CONTAINER:e=new n(null,g);break;case p.ENTITY_HOST:e=new a(null,g);break;case p.ENTITY_DISK:e=new r(null,g);break;case p.ENTITY_VM:e=new o(null,g);break;case p.ENTITY_PROTECTION_DOMAIN:e=new l(null,g);break;case p.ENTITY_REMOTE_SITE:e=new c(null,g);break;case p.ENTITY_CLUSTER:e=new s(null,g)}e&&u===p.ENTITY_VM&&(t=h.VM_IS_CVM+"=="+p.FILTER_NOT_INCLUDE_CVM,e.setFilterCriteria(t)),e&&(E.isMemoryUsageStats(S||i)?e.setProjection([p.PROJECTION.STATS]):e.setProjection([p.PROJECTION.BASIC_INFO]),S?e.setSortCriteria(S,T):e.setSortCriteria(i,T),e.setCount(d),this.registerDataModel(e,this,this.renderSuccess,this.renderError,p.SERVICE_STATS_INTERVAL))},renderSuccess:function(e){var i,n,s,a,r=this.getAspectsValue(p.VP_ASPECT_COUNT),o=this.getAspectsValue(p.VP_ASPECT_ENTITY),l=this.getAspectsValue(p.VP_ASPECT_METRIC),c=E.getStatsProperty(l,o,!0,this.getClusterUuid());r=r||this.DEFAULT_COUNT,this.getAspectsValue(p.VP_ASPECT_SPECIAL_SORT)&&e.specialSort(_.bind(this.sortMetric,this)),i=_.first(e.models,r),this.$(".n-list").empty(),s=0,_.each(i,function(e){a=c?E.getStatsValue(c,e.toJSON()):E.statsFormat(l,e.get(l));var i=T.convertModelToNavItemModel(e,o,p.ACTION_DETAILS);d.isMulticlusterNavMode()&&(o!==p.ENTITY_VM&&o!==p.ENTITY_HOST||(i[p.NAV_ACTION_TARGET_ID]=e.get(h.UUID))),n=t.COMMON_ROW({model:e.toJSON({includeAttribute:!0}),value1:a,row:s++%2==0?"n-row-even":"n-row-odd",attrs:T.convertNavModelToHTMLAttr(i)}),this.$(".n-list").append(n)},this),this.applyAntiScroll()},sortMetric:function(e,t){var i=this.getAspectsValue(p.VP_ASPECT_ORDER),n=this.getAspectsValue(p.VP_ASPECT_METRIC),s=this.getAspectsValue(p.VP_ASPECT_ENTITY),a=E.getStatsProperty(n,s,!0,this.getClusterUuid()),r=0,o=0;return a?(r=E.getStatsValue(a,e.toJSON(),!1),o=E.getStatsValue(a,t.toJSON(),!1)):(r=e.get(n),o=e.get(n)),r===o?0:r===p.STATS_NOT_AVAILABLE?1:o===p.STATS_NOT_AVAILABLE?-1:(i=i||"descending","ascending"===i?r-o:o-r)},getHeaderTemplate:function(){var e=this.getAspectsValue(p.VP_ASPECT_METRIC);return t.COMMON_HEADER({metric:E.getMetricLabel(e)})},onClick:function(e){if(this.isInPreviewMode())return void e.stopPropagation();if(d.isMulticlusterNavMode()){var t=$(e.currentTarget),i=t.attr(p.NAV_ACTION_TARGET),n=t.attr(p.NAV_ACTION_TARGET_ID),s=u.createNavigationContext(i,{});u.navigateToFullScreenDetailsPane(i,n,s)}else u.navigateToSubPageByElement(p.SUBPAGE_TABLE,e.currentTarget)}})}),define("views/basecomponents/vantagepoints/elements/resource/ResourceVantagePointTemplates",[],function(){"use strict";return{CONTENT_SMALL:_.template('<div class="n-vantage-point-metric-small">            <div class="n-title">              <span class="lblTitle title" title="<%- title %>">                <%- title %>             </span>            </div>            <div class="n-content">             <% if (splitMetric) { %>                <div class="n-mixed-hypervisors">                </div>              <% } else { %>                <div class="n-col  n-content-inner">                  \x3c!-- Place content here --\x3e                </div>              <% } %>            </div>         </div>'),VM_CPU_SMALL:_.template('<div class="n-h3  n-value">             <%= countVCPU %>           </div>           <span class="n-label">             Provisioned vCPU<%= countVCPU !== 1 ? "(s)" : "" %>           </span>'),VM_CPU_DEFAULT:_.template('<div class="n-col  n-col-2 n-VMCPU">             <div class="n-h3">               <%= countVCPU %>             </div>             <% if (countVCPU !== 1) { %>              <%= i18n("provisioned_cpu_plural", "Provisioned vCPUs") %>            <% } else { %>              <%= i18n("provisioned_cpu_singular", "Provisioned vCPU") %>            <% } %>          </div>           <div class="n-col  n-col-2 right n-VMCPU  reserved-cpu">             <div class="n-h3">               <%= utilizedCPU %>             </div>             <% if (isUsage) { %>           <%= i18n("cpu_usage", "CPU Usage") %>            <% } else { %>           <%= i18n("reserved_cpu", "Reserved CPU") %>            <% } %>         </div>'),VM_MEMORY_SMALL:_.template('<div class="n-h3  n-value">             <%= memoryProvisioned %>           </div>           <span class="n-label">Provisioned</span>'),VM_MEMORY_DEFAULT:_.template('<div class="n-col  n-col-2 n-VMMemory">             <div class="n-h3">               <%= memoryProvisioned %>             </div>             <%= i18n("provisioned", "Total Provisioned") %>          </div>           <div class="n-col  n-col-2 n-VMMemory right">             <div class="n-h3">               <%= memoryReserved %>             </div>             <%= i18n("total_reserved", "Total Reserved") %>          </div>'),HOST_MEMORY_DEFAULT:_.template('<div class="n-h3  n-value">             <%= totalMemory %>           </div>           <span class="n-label"><%= i18n("total_memory", "Total Memory") %></span>'),HOST_CPU_DEFAULT:_.template('<div class="n-h3  n-value">             <%= totalCPU %>           </div>           <span class="n-label"><%= i18n("total_cpu", "Total CPU") %></span>')}}),define("views/basecomponents/vantagepoints/elements/resource/ResourceVantagePointView",["backbone","views/basecomponents/vantagepoints/elements/BaseVantagePointView","views/basecomponents/vantagepoints/VantagePointLayoutDescriptor","views/basecomponents/vantagepoints/elements/resource/ResourceVantagePointTemplates","models/vm/VMCollection","models/hardware/HostCollection","models/EntityProjectionModel","data/DataProperties","utils/CommonTemplates","utils/AppConstants","utils/StatsUtil","utils/HypervisorUtil"],function(e,t,i,n,s,a,r,o,l,c,u,d){"use strict";return t.extend({vantagePointCSS:"n-vantage-point-resource",name:"ResourceVantagePointView",splitMetric:!1,initializeVantagePoint:function(){this.splitMetric=this.isMulticlusterNavMode()||d.getClusterHypervisors(this.getClusterUuid()).length>1},updateTemplate:function(){if(this.getSize()===i.SIZE_SMALL){var e=this.model.toJSON(),t=e.name,s=this.i18n(t,t);this.template=n.CONTENT_SMALL({model:e,title:s,splitMetric:this.splitMetric})}else this.template=this.getDefaultTemplate()},updateDataModels:function(){var e,t=this.getAspectsValue(c.VP_ASPECT_ENTITY),i=r.DP.VM_ENTITY;switch(t){case c.ENTITY_VM:if(this.clusterManager.isClusterFFEnabled(c.FFLAGS.SUPPORT_PAGINATION)){var n=[i.CPU_RESERVATION_HZ,i.MEMORY_RESERVED_BYTES,i.NUM_VCPUS,i.MEMORY_SIZE_BYTES,i.CPU_USAGE];e=new r({entityType:c.ENTITY_VM,projection:n})}else e=new s;break;case c.ENTITY_HOST:e=new a}e&&(e.setProjection([c.PROJECTION.STATS]),this.registerDataModel(e,this,this.renderSuccess,this.renderError,c.NO_INTERVAL))},fetchHostUsage:function(){var e=new a;e.setProjection([c.PROJECTION.STATS]),e.on("reset",this.renderHcSuccess,this),e.on("error",this.renderError,this),e.fetch(),this._hcFetched=!0},renderHcSuccess:function(e){var t=0,i=0;_.each(e.models,function(e){var n=e.get(o.CPU_CAPACITY_IN_HZ),s=e.get(o.STATS);t+=n,i+=n*parseInt(s[o.STATS_HYP_CPU_USAGE],10)}),this._hostCpuUsagePpm=i/t,this._hcLoaded=!0,this.renderVMCPU(this._vmModel),this.applyAntiScroll()},renderSuccess:function(e){var t=this.getAspectsValue(c.VP_ASPECT_TYPE);switch(this.getAspectsValue(c.VP_ASPECT_ENTITY)){case c.ENTITY_VM:t===c.VP_RESOURCE_TYPE.CPU?this.renderVMCPU(e):t===c.VP_RESOURCE_TYPE.MEMORY&&this.renderVMMemory(e);break;case c.ENTITY_HOST:t===c.VP_RESOURCE_TYPE.CPU?this.renderHostCPU(e):t===c.VP_RESOURCE_TYPE.MEMORY&&this.renderHostMemory(e)}this.applyAntiScroll()},renderVMCPU:function(e){var t,s=this.getClusterUuid(),a=void 0;if((a=!s&&this.isMulticlusterNavMode()?d.hasAnyPEHKVM():d.hasKVM(s))&&!this._hcLoaded)return this._vmModel=e,void(this._hcFetched||this.fetchHostUsage());t=this.getSize()===i.SIZE_SMALL?n.VM_CPU_SMALL:n.VM_CPU_DEFAULT;var r=0,l=0,h=0;if(this.clusterManager.isClusterFFEnabled(c.FFLAGS.SUPPORT_PAGINATION)){var p=e.DP.VM_ENTITY;_.each(e.get(e.DP.ENTITIES),function(e){l+=parseInt(e[p.CPU_RESERVATION_HZ],10)||0,r+=parseInt(e[p.NUM_VCPUS],10)||0}),l=u.prefixFormat(l,u.SYMBOL_HERTZ)}else r=u.aggregate(e,o.VM_NUM_VCPUS),l=u.addStyleToUnit(u.aggregate(e,o.VM_CPU_RESERVED));h=a?u.ppmFormat(this._hostCpuUsagePpm):l,this.$(".n-content-inner").html(t(this.vtOptions({countVCPU:r,utilizedCPU:h,isUsage:a})));var T;s?T=d.hasHyperV(s):this.isMulticlusterNavMode()&&(T=d.hasAnyPEHyperv()),T&&this.$(".reserved-cpu").hide()},renderHostCPU:function(e){if(this.splitMetric)this.renderMixedHypervisorResource(e,this.aggregateFormatCPU);else{var t=this.aggregateFormatCPU(e);this.$(".n-content-inner").html(n.HOST_CPU_DEFAULT(this.vtOptions({totalCPU:u.addStyleToUnit(t)})))}},aggregateFormatCPU:function(e){var t=u.aggregate(e,o.CPU_CAPACITY,!0,o.CPU_CORES);return u.formatDecimalDigits(t,4)},renderVMMemory:function(e){var t,s=0,a=0;if(this.clusterManager.isClusterFFEnabled(c.FFLAGS.SUPPORT_PAGINATION)){var r=e.DP.VM_ENTITY;_.each(e.get(e.DP.ENTITIES),function(e){s+=parseInt(e[r.MEMORY_SIZE_BYTES],10)||0,a+=parseInt(e[r.MEMORY_RESERVED_BYTES],10)||0}),s=u.storageFormat(s),a=u.storageFormat(a)}else s=u.aggregate(e,o.VM_MEM_CAPACITY),a=u.aggregate(e,o.VM_MEM_RESERVED);t=this.getSize()===i.SIZE_SMALL?n.VM_MEMORY_SMALL:n.VM_MEMORY_DEFAULT,this.$(".n-content-inner").html(t(this.vtOptions({memoryProvisioned:u.addStyleToUnit(s),memoryReserved:u.addStyleToUnit(a)})))},renderHostMemory:function(e){if(this.splitMetric)this.renderMixedHypervisorResource(e,this.aggregateFormatMemory);else{var t=this.aggregateFormatMemory(e);this.$(".n-content-inner").html(n.HOST_MEMORY_DEFAULT(this.vtOptions({totalMemory:u.addStyleToUnit(t)})))}},aggregateFormatMemory:function(e){var t=u.aggregate(e,o.MEM_CAPACITY);return u.formatDecimalDigits(t,4)},renderMixedHypervisorResource:function(e,t){var i=[],n=e.groupBy(function(e){return e.get(o.HYPERVISOR_TYPE)});_.each(n,function(e,n){i.push([c.HYPERVISOR_LABEL[n],t(e)])},this),this.$(".n-mixed-hypervisors").html(l.LABEL_COLUMN_LIST({list:i}))}})}),define("views/basecomponents/vantagepoints/elements/alertevent/AlertEventVantagePointTemplates",[],function(){"use strict";return{CUSTOMIZED_CONTENT_COLUMN:'<div class="n-content-column-customized">           <div class="n-column-content n-column-content-1">            </div>            <div class="n-column-content n-column-content-2">            </div>          </div>',LIST_CONTAINER:_.template('<ul class="n-list"><%= content %></ul>'),LIST_ROW:_.template('<li class="n-item-row"               <%= attrs %> >            <div class="n-item-title<%= isBlink ? " n-blink" : "" %>">              <%= title %>            </div>            <div class="n-elapsed-time">              <%= elapsed %>           </div>          </li>'),BLANK_MESSAGE:_.template('<div class="n-blank <%= classes %>"><div class="n-blank-message"><%= msg %></div></div>'),BLANK:'<div class="n-blank"></div>'}}),define("models/event/EventModel",["models/BaseModel","data/DataURLConstants","data/DataProperties","utils/AppConstants"],function(e,t,i,n){"use strict";return e.extend({idAttribute:i.EVENT_ID,nameAttribute:i.EVENT_TYPE,urlRoot:t.EVENT,name:"EventModel",entityType:n.ENTITY_EVENT,getCreatedTimestamp:function(){var e=this.get(i.EVENT_CREATED_TIMESTAMP);return e&&e>0?e/1e3:0},getDisplayableId:function(){var e=this.get(this.idAttribute),t=e.indexOf("::");return t>=0?e.substring(0,t):e}})}),define("models/event/EventCollection",["models/PollingCollection","models/event/EventModel","data/DataProperties","data/DataURLConstants","utils/AppConstants"],function(e,t,i,n,s){"use strict";return e.extend({model:t,url:n.EVENT,name:"EventCollection",addFilterURL:function(e){e&&e.length&&(e===n.getFilterUrlByPageId(s.PAGE_FILE_SERVER)?this.url=this.url+"?entityType="+e:this.url=this.url+"/"+e)},fetch:function(){this.clusterManager.isMulticlusterNavMode()||e.prototype.fetch.apply(this,arguments)},getEvent:function(e){return _.find(this.models,function(t){return t.get(i.EVENT_ID)===e})},getEventsByEntityId:function(e){return _.filter(this.models,function(t){var n=t.get(i.EVENT_ENTITY_IDS);return _.contains(n,e)})},getAllEvents:function(){return this.models},getEventsInTimeRange:function(e,t){return this.filter(function(i){var n=i.getCreatedTimestamp();return n>=e&&n<t})}})}),define("utils/EventUtil",["data/DataProperties","utils/AppConstants"],function(e,t){"use strict";return{formatMessage:function(i,n){var s,a=n[e.EVENT_CONTEXT_TYPES].length;for(s=0;s<a;s++)if(n[e.EVENT_CONTEXT_TYPES][s]===t.EVENT_CONTEXT_TYPE_MESSAGE){i=n[e.EVENT_CONTEXT_VALUES][s];break}for(s=0;s<a;s++)i=i.replace("{"+n[e.EVENT_CONTEXT_TYPES][s]+"}","'"+n[e.EVENT_CONTEXT_VALUES][s]+"'");return i||""},getPreprocessedMessage:function(i){var n,s,a=i[e.EVENT_CONTEXT_TYPES].length;for(n=0;n<a;n++)if(i[e.EVENT_CONTEXT_TYPES][n]===t.EVENT_CONTEXT_TYPE_MESSAGE){s=i[e.EVENT_CONTEXT_VALUES][n];break}return(s||"").replace(/\{.+?\}/g,"")},getCreatedBy:function(i,n){var s,a=n[e.EVENT_CONTEXT_TYPES].length;for(i="",s=0;s<a;s++)if(n[e.EVENT_CONTEXT_TYPES][s]===t.EVENT_CONTEXT_TYPE_AUDIT_USER){i=n[e.EVENT_CONTEXT_VALUES][s];break}return i},formatTitle:function(t){var i=(t.get(e.EVENT_ENTITY_TYPES)&&t.get(e.EVENT_ENTITY_TYPES).length>0?t.get(e.EVENT_ENTITY_TYPES)[0]:"System")+" Event";return i=i.replace(/_/g," "),i=i.replace(/\w\S*/g,function(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()})}}}),define("views/basecomponents/vantagepoints/elements/alertevent/AlertEventVantagePointView",["views/basecomponents/vantagepoints/elements/BaseVantagePointView","views/basecomponents/vantagepoints/elements/alertevent/AlertEventVantagePointTemplates","models/alert/AlertCollection","models/event/EventCollection","managers/NavigationManager","managers/AccessManager","utils/AppConstants","utils/AppUtil","utils/AlertUtil","utils/EventUtil","utils/CommonTemplates","data/DataProperties"],function(e,t,i,n,s,a,r,o,l,c,u,d){"use strict";return e.extend({MAX_COUNT_DISPLAY:10,lastTimestamp:-1,lastCount:0,propTimestamp:null,isPollerMode:!1,displayModels:null,totalCount:0,vantagePointCSS:"n-vantage-point-alert-event",name:"AlertEventVantagePointView",enableColumn:!0,events:{"click  .n-item-row":"onClick"},isAlert:function(){return this.model.get(d.VP_TYPE)===r.VP_TYPE.ALERT},isEvent:function(){return this.model.get(d.VP_TYPE)===r.VP_TYPE.EVENT},updateStyle:function(e){if(this.isEvent())this.vantagePointCSS+=" n-vantage-point-event";else if(this.isAlert()){var t=this.getAspectsValue(r.VP_ASPECT_SEVERITY);t===d.ALERT_SEVERITY_CRITICAL?this.vantagePointCSS+=" n-vantage-point-alert-critical":t===d.ALERT_SEVERITY_WARNING?this.vantagePointCSS+=" n-vantage-point-alert-warning":t===d.ALERT_SEVERITY_INFO&&(this.vantagePointCSS+=" n-vantage-point-alert-info")}},updateTemplate:function(){this.isSizeSmall()?this.numberOfColumns=1:this.isSizeMedium()?this.numberOfColumns=2:this.template=$(this.getDefaultTemplate()).closest(".n-content").html(t.CUSTOMIZED_CONTENT_COLUMN).end()},updateDataModels:function(){var e,t,s,a=this.getAspectsValue(r.VP_ASPECT_PERSPECTIVE);this.isAlert()?(e=new i,this.propTimestamp=d.ALERT_CREATED_TIMESTAMP,t={resolved:!1}):this.isEvent()&&(e=new n,t={},this.propTimestamp=d.EVENT_CREATED_TIMESTAMP,this.isSizeSmall()?e.setCount(1):e.setCount(this.MAX_COUNT_DISPLAY)),s=a!==r.ENTITY_CLUSTER?a:"",e.addFilterURL(s),this.registerDataModel(e,this,this.renderSuccess,this.renderError,r.DEFAULT_POLLING_INTERVAL,{data:t})},renderSuccess:function(e){var t=e.at(0),i=-1;return t&&(i=t.get(this.propTimestamp)),i>this.lastTimestamp||this.lastCount!==e.getMetaDataTotalCount()?this.isPollerMode?(this.isEvent()&&this.isSizeSmall()?e.setCount(1):e.setCount(this.MAX_COUNT_DISPLAY),void(this.isPollerMode=!1)):(this.renderNewContent(e),t&&(this.lastTimestamp=t.get(this.propTimestamp)),this.lastCount=e.getMetaDataTotalCount(),this.isEvent()&&(this.isSizeSmall()?e.setCount(1):e.setCount(this.MAX_COUNT_DISPLAY)),this.isPollerMode=!0,void 0):void this.renderColumnContent(this.totalCount,this.displayModels)},renderNewContent:function(e){var t,i=this.getAspectsValue(r.VP_ASPECT_SEVERITY);this.isAlert()?(e.comparator=l.comparatorHighPriorityUnresolved,e.sort({silent:!0}),e.comparator=null,t=e.getAlertsBySeverity(i),this.totalCount=t.length):this.isEvent()&&(t=e.models,this.totalCount=e.getMetaDataTotalCount()),this.displayModels=this.getModelsForDisplay(t),this.renderColumnContent(this.totalCount,this.displayModels)},getModelsForDisplay:function(e){var t=this.getAspectsValue(r.VP_ASPECT_COUNT)||this.MAX_COUNT_DISPLAY;return e&&_.first(e,t)},renderColumnContent:function(e,i){var n,s,a;this.isAlert()?(n=this.getAspectsValue(r.VP_ASPECT_SEVERITY).replace("k",""),n=this.i18n("status."+n.toLowerCase().trim(),n),s=this.i18ns("last_alert")):this.isEvent()&&(n=1===e?o.getSingularEntityName("event"):o.getPluralEntityName("event"),s=this.i18ns("last_event")),i&&i.length&&(a=s+o.getElapsedTime({timestamp:i[0].get(this.propTimestamp)}));var h=u.LABEL_COLUMN({title:e,subtitle:n,smallTitle:a});if(this.updateColumnContent(1,!1,h),!this.isSizeSmall()){var p="",T=this.isAlert()?r.ENTITY_ALERT:r.ENTITY_EVENT;_.each(i,function(e){var i=e.toJSON(),n=void 0;n=this.isAlert()?i[d.ALERT_TITLE]||r.ALERT_MESSAGE_BLANK:c.formatMessage(i[d.ALERT_MESSAGE],i),p+=t.LIST_ROW({attrs:o.createActionAttr(T,r.ACTION_DETAILS,i),title:n,isBlink:l.isBlinking(i[d.ALERT_TYPE]),elapsed:s+o.getElapsedTime({timestamp:i[this.propTimestamp]})})},this),p=t.LIST_CONTAINER({content:p}),this.updateColumnContent(2,!0,p)}},getEmptyContentTemplate:function(){return t.BLANK_MESSAGE({classes:"n-blank-event",msg:this.i18ns("no_events")})},onClick:function(e){if(this.isInPreviewMode())return void e.stopPropagation();if(this.clusterManager.isMulticlusterNavMode()||a.isClusterFFEnabled(r.FFLAGS.ALERTS_IN_IDF)){var t=$(e.currentTarget).attr(r.NAV_ACTION_TARGET_ID),i=this.isAlert()?r.ENTITY_ALERT:r.ENTITY_EVENT;s.navigateToFullScreenDetailsPane(i,t)}else s.navigateToPageByElement(r.PAGE_ALERTS,r.SUBPAGE_TABLE,e.currentTarget)}})}),define("views/basecomponents/vantagepoints/elements/alertevent/AlertVantagePointView",["views/basecomponents/vantagepoints/elements/BaseVantagePointView","views/basecomponents/vantagepoints/elements/alertevent/AlertEventVantagePointTemplates","models/alert/AlertSummaryCollection","models/multicluster/PCVMModel","managers/NavigationManager","managers/AccessManager","utils/AppConstants","utils/AppUtil","utils/AlertUtil","utils/CommonTemplates","data/DataProperties"],function(e,t,i,n,s,a,r,o,l,c,u){"use strict";return e.extend({TOTAL_ALERTS_DISPLAY:10,vantagePointCSS:"n-vantage-point-alert-event",enableColumn:!0,events:{"click  .n-item-row":"onClick"},isAlert:function(){return this.model.get(u.VP_TYPE)===r.VP_TYPE.ALERT||this.model.get(u.VP_TYPE)===r.VP_TYPE.PC_ALERT},updateStyle:function(e){var t=this.getAspectsValue(r.VP_ASPECT_SEVERITY);t===u.ALERT_SEVERITY_CRITICAL?this.vantagePointCSS+=" n-vantage-point-alert-critical":t===u.ALERT_SEVERITY_WARNING?this.vantagePointCSS+=" n-vantage-point-alert-warning":t===u.ALERT_SEVERITY_INFO&&(this.vantagePointCSS+=" n-vantage-point-alert-info"),this.model.get(u.VP_TYPE)===r.VP_TYPE.PC_ALERT&&(this.vantagePointCSS+=" pc-alert")},updateTemplate:function(){this.isSizeSmall()?this.numberOfColumns=1:this.isSizeMedium()?this.isMulticlusterNavMode()?this.numberOfColumns=1:this.numberOfColumns=2:this.template=$(this.getDefaultTemplate()).closest(".n-content").html(t.CUSTOMIZED_CONTENT_COLUMN).end()},updateDataModels:function(){var e={},t=this.getAspectsValue(r.VP_ASPECT_PERSPECTIVE),s=this.getClusterUuid(),a=this.model.get(u.VP_TYPE);a!==r.VP_TYPE.ALERT||!s&&t===r.ENTITY_CLUSTER?a===r.VP_TYPE.PC_ALERT&&(e=l.setClusterFilter(e,n.getSharedPCVMModel().getHostedClusterUuid()),n.releaseSharedPCVMModel(),e=l.setClusterFilter(e,this.clusterManager.getPrismCentralClusterUuid())):(s&&(e=l.setClusterFilter(e,s)),e=l.setEntityFilter(e,t)),e=l.setAlertResolvedFilter(e,!1),e=l.setAlertSeverityFilter(e,r.ALERT_SEVERITY_NAMES[this.getAspectsValue(r.VP_ASPECT_SEVERITY)]);var o=new i(null,{filter_expression:e});this.registerDataModel(o,this,this.renderSuccess,this.renderError)},renderSuccess:function(e){this.renderColumnContent(e)},renderColumnContent:function(e){var i=this,n=void 0,s=void 0,a=void 0,d=e.getAlertCount();if(0===d)return void this.renderEmptyContent();n=this.getAspectsValue(r.VP_ASPECT_SEVERITY),s=r.ALERT_SEVERITY_NAMES[n],s=this.i18n("status."+s.toLowerCase().trim(),s),a=o.getElapsedTime({timestamp:e.at(0).getCreatedTime()});var h=c.LABEL_COLUMN({title:d||"",subtitle:s,smallTitle:a});if(this.updateColumnContent(1,!1,h),!(this.isSizeSmall()||this.isSizeMedium()&&this.isMulticlusterNavMode())){var p="",_=r.ENTITY_ALERT;e.each(function(e){p+=t.LIST_ROW({attrs:o.createActionAttr(_,r.ACTION_DETAILS,e),title:i.isAlert()?e.getDisplayName():e.get(u.EVENT_MESSAGE),isBlink:l.isBlinking(e[u.ALERT_TYPE]),elapsed:o.getElapsedTime({timestamp:e.getCreatedTime()})})},this),p=t.LIST_CONTAINER({content:p}),this.updateColumnContent(2,!0,p)}},getEmptyContentTemplate:function(){var e=void 0;switch(this.getAspectsValue(r.VP_ASPECT_SEVERITY)){case u.ALERT_SEVERITY_CRITICAL:e="no_critical_alerts";break;case u.ALERT_SEVERITY_WARNING:e="no_warning_alerts";break;default:e="no_info_alerts"}return t.BLANK_MESSAGE({classes:"n-blank-alert",msg:this.i18n(e)})},onClick:function(e){if(this.isInPreviewMode())return void e.stopPropagation();if(this.clusterManager.isMulticlusterNavMode()||a.isClusterFFEnabled(r.FFLAGS.ALERTS_IN_IDF)){var t=$(e.currentTarget).attr(r.NAV_ACTION_TARGET_ID);s.navigateToFullScreenDetailsPane(r.ENTITY_ALERT,t)}else s.navigateToPageByElement(r.PAGE_ALERTS,r.SUBPAGE_TABLE,e.currentTarget)}})}),define("text!templates/basecomponents/vantagepoints/elements/ListVantagePointView.html",[],function(){return'<div class="n-title">\n  <span class="lblTitle"><%- model.name %></span>\n</div>\n<div class="n-content  n-content-list">\n  \x3c!-- Antiscroll --\x3e\n  <div class="antiscroll-wrap">\n    <div class="box-wrap">\n      <div class="antiscroll-inner">\n        <div class="box-inner  n-content-inner">\n          <ul class="n-list">\n            \x3c!-- Place content here --\x3e\n          </ul>\n        </div>\n      </div>\n    </div>\n  </div>\n</div>'}),define("views/basecomponents/vantagepoints/elements/ListVantagePointView",["views/basecomponents/vantagepoints/elements/BaseVantagePointView","views/basecomponents/vantagepoints/elements/ListVantagePointTemplates","text!templates/basecomponents/vantagepoints/elements/ListVantagePointView.html","managers/ClusterManager","managers/TaskManager","utils/AppConstants","utils/SVG"],function(e,t,i,n,s,a,r){"use strict";return e.extend({vantagePointCSS:"n-vantage-point-list-content",sharedCollection:!1,updateTemplate:function(){this.template=_.template(i,{model:this.model.toJSON(),SVG:r,customizable:this.isCustomizable})},renderModel:function(e){this.model=e||this.model||n.getClusterCollection(),this.renderModelContent()},renderSuccess:function(e){var i,n=this.getAspectsValue(a.VP_ASPECT_TYPE),s=0,r=this.$(".n-list");switch(r.empty(),n){case a.VP_LIST_TYPE.MC_HYPERVISOR:this.$el.addClass("n-vantage-point-list-mc-hypervisor");var o=e.getHypervisorCount();_.each(o,function(e,n){var o=_.map(n.split(","),function(e){return a.HYPERVISOR_LABEL[e]}).join(", ");i=t.COMMON_ROW({model:{name:o},value1:e+" cluster(s)",row:s++%2==0?"n-row-even":"n-row-odd",attrs:""}),r.append(i)},this);break;case a.VP_LIST_TYPE.MC_ACTIVITY:this.$el.addClass("n-vantage-point-list-mc-activity"),e.length?_.each(e.getTasksByName(),function(e,n){i=t.COMMON_ROW({model:{name:n},value1:e,row:s++%2==0?"n-row-even":"n-row-odd",attrs:""}),r.append(i)},this):(i=t.NO_CONTENT({text:"There are no active tasks."}),r.append(i))}this.applyAntiScroll()},onStartServices:function(){switch(this.getAspectsValue(a.VP_ASPECT_TYPE)){case a.VP_LIST_TYPE.MC_ACTIVITY:this.taskCollection=s.getTaskMulticlusterCollection(),this.taskCollection.on("reset",this.renderSuccess,this),this.taskCollection.triggerUpdate();break;case a.VP_LIST_TYPE.MC_HYPERVISOR:this.clusterCollection=this.clusterManager.getClusterCollection(),this.clusterCollection.on("reset",this.renderSuccess,this),this.clusterCollection.triggerUpdate()}},onStopServices:function(){switch(this.getAspectsValue(a.VP_ASPECT_TYPE)){case a.VP_LIST_TYPE.MC_ACTIVITY:this.taskCollection.off("reset",this.renderSuccess,this);break;case a.VP_LIST_TYPE.MC_HYPERVISOR:this.clusterCollection.off("reset",this.renderSuccess,this)}}})}),define("models/ebrowser/EBStatsModel",["models/ebrowser/EBQueryModel","utils/AppConstants","utils/StatsUtil","data/DataProperties"],function(e,t,i,n){"use strict";return e.extend({name:"EBStatsModel",setSamplingIntervalSecs:function(e){this.set(this.DP.DOWNSAMPLING_INTERVAL,e,{silent:!0})},setStatsFor:function(e,t,i){var n={};n[this.DP.ENTITY_IDS]=_.isArray(e)?e:[e],n[this.DP.ENTITY_TYPE]=t,n[this.DP.GROUP_MEMBER_ATTRIBUTES]=this.convertGroupMemberAttributesList(_.isArray(i)?i:[i]),this.set(n,{silent:!0})},isStatsFor:function(e,t){var i=this.get(this.DP.ENTITY_IDS),n=this.get(this.DP.GROUP_MEMBER_ATTRIBUTES);return _.contains(i,e)&&_.find(n,function(e){return e.attribute===t})},hasMetrics:function(){var e=this.get(this.DP.GROUP_MEMBER_ATTRIBUTES);return e&&e.length>0},getStats:function(e){var t=this.getQueryResults(),i=t[t.DP.RESULT_MODELS];return i&&i.length?i[0].get(e):null},_rawResultsToEntities:function(e){var t=[];return _.each(e,function(e){var n={};n.id=e.id,_.each(e.data,function(e){var t=e.name;if(1===e.values.length)n[t]=e.values[0].value;else{var s=[];_.each(e.values,function(e){s.push([i.toMilliseconds(e.time),parseFloat(e.value)])}),n[t]=s}}),t.push(n)},this),t},getStatsLatestValue:function(e){var t=this.getStats(e)||[],i=-1,n=null;return _.each(t,function(e){e[0]>i&&(i=e[0],n=e[1])}),n},fillMissingDataPoints:function(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=[],s=0;if(!(e&&e.length&&i.startTime&&i.samplingInterval&&i.endTime))return e;for(var a=i.samplingInterval*t.MICROS_PER_MILLI,r=i.startTime+(e[0][0]-i.startTime)%a,o=r;o<=i.endTime;o+=a){var l=void 0,c=e[s];c&&o!==c[0]?l=null:(l=c?c[1]:null,s++),n.push([o,l])}return n},getDrilldownRoute:function(e){var t=this.get(n.ENTITY_ID),i=this.get(n.ENTITY_TYPE),s=this.get(n.METRIC_IDS);return{entityId:t,entityType:i,metricId:e||s.join(",")}},processStats:function(e){return e}})}),define("models/capacityplanning/CPStatsModel",["models/ebrowser/EBStatsModel","data/DataProperties","utils/StatsUtil"],function(e,t,i){"use strict";return e.extend({name:"CPStatsModel",parseMemberCollectionResults:function(t){return t[this.DP.GROUP_SUMMARIES]&&Object.keys(t[this.DP.GROUP_SUMMARIES]).length?this.rawSummariesToEntities(t[this.DP.GROUP_SUMMARIES],t[this.DP.ENTITY_RESULTS]):e.prototype.parseMemberCollectionResults.apply(this,arguments)},setDefaultGroupByTimeInterval:function(){},setGroupsStats:function(e,t,i,n,s,a){var r={},o=[],l=[];o=i&&i.map(function(e){return{attribute:e,operation:a}}),s&&(s=_.isArray(s)?s:[s],l=s.map(function(e){return{attribute:e,operation:a}})),r[this.DP.ENTITY_TYPE]=t,r[this.DP.ENTITY_IDS]=e,l&&l.length&&(r[this.DP.GROUP_MEMBER_ATTRIBUTES]=l),r[this.DP.GROUPING_ATTR]=n,r[this.DP.GROUP_ATTRIBUTES]=o,this.set(r,{silent:!0})},_rawResultsToEntities:function(e){var n=[];return _.each(e,function(e){var s={};s.id=e[t.CP.ENTITY_ID],_.each(e.data,function(e){var n=e[t.NAME],a=[];_.each(e.values,function(e){var t;_.isUndefined(e.value)?e.values&&e.values.length&&(t=e.values[0]):t=e.value,a.push([i.toMilliseconds(e.time),parseFloat(t)])}),s[n]=a}),n.push(s)},this),n},rawSummariesToEntities:function(e,n){var s=[];return _.each(e,function(e){var a={},r=e.name,o=[];_.each(e.values,function(e){o.push([i.toMilliseconds(e.time),parseFloat(e.values[0])])}),a[r]=o,1===n.length?(n[0][t.CP.ENTITY_ID]?a.id=n[0][t.CP.ENTITY_ID]:a.id=n[0].id,_.each(n[0].data[0],function(e,i){"values"===i&&e[0]&&(a[t.NAME]=e[0].value)})):a.id=null,s.push(a)},this),s},processStats:function(e,t){var i=this.get(this.DP.INTERVAL_START),n=this.get(this.DP.INTERVAL_END),s=this.get(this.DP.DOWNSAMPLING_INTERVAL),a=void 0,r=Math.round((n-i+(1e3*s-1))/(1e3*s));if(e.length<r){var o=r-e.length;a=e.length>0?t?0:e[e.length-1][1]:0;for(var l=0;l<o;l++)e.push([0,a])}else e.length=r;for(var c=e.length-1,u=i;c>=0;c--,u+=1e3*s)e[c][0]=u;return e}})}),define("models/capacityplanning/EntityEventQueryModel",["utils/AppConstants","utils/AlertUtil","data/DataProperties","models/query/BaseQueryModel"],function(e,t,i,n){"use strict";return n.extend({name:"EntityEventQueryModel",initialize:function(t,s){if(s=s||{},!t||!t.entityType||!t.entityId)throw new Error("Specify entityType and entityId in attributes");n.prototype.initialize.apply(this,arguments),this.entityType=t.entityType,this.indicatorEntityType=t.indicatorEntityType,this.entityId=t.entityId,this.metricName=t.metricName,this.countOnly=t.countOnly,this.startTime=s.startTime||Date.now()-1*e.MILLIS_PER_DAY,this.endTime=s.endTime,this.attributeList=s.attributeList||[i.ALERT_TITLE_V3,i.ALERT_DEFAULT_MSG,i.ALERT_PARAM_NAMES,i.ALERT_PARAM_VALUES,i.ALERT_METRIC_NAME,i.ALERT_TRIGGER_TIME],this.anomalyOnly=t.anomalyOnly||!1,this.setAttributesForQuery()},getEventCount:function(){return this.get(this.DP.FILTERED_ENTITY_COUNT)},setDefaultGroupByTimeInterval:function(){},setAttributesForQuery:function(){this.set(this.DP.ENTITY_TYPE,e.ENTITY_EVENT),this.countOnly||this.setGroupMemberAttributesList(this.attributeList);var i={};i=t.setEntityFilter(i,this.entityType,this.entityId,e.ENTITY_EVENT),this.indicatorEntityType&&(this.indicatorEntityType===e.ENTITY_HOST&&(this.indicatorEntityType=e.ENTITY_NODE),i=t.setIndicatorEntityTypeFilter(i,this.indicatorEntityType,e.ENTITY_EVENT)),this.anomalyOnly&&(i=t.setClassificationFilter(i,e.EVENT.TYPE.ANOMALOUS,e.ENTITY_EVENT)),this.metricName&&(i=t.setMetricFilter(i,this.metricName,e.ENTITY_EVENT)),t.setTimeRangeFilter(i,this.startTime,this.endTime,e.ENTITY_EVENT),this.countOnly&&this.set(this.DP.GROUP_MEMBER_COUNT,1),this.set(this.DP.FILTER_EXPR,i)}})}),
define("models/capacityplanning/CPQueryModel",["models/query/BaseQueryModel","data/DataProperties","data/DataManager","utils/AppConstants"],function(e,t,i,n){"use strict";var s=[t.MEMORY_CONFIG_LIST,t.SSD_CONFIG_LIST,t.HDD_CONFIG_LIST,t.CPU_CONFIG_LIST];return e.extend({name:"CPQueryModel",initialize:function(t){e.prototype.initialize.apply(this,arguments),t&&this.setGroupMemberAttributesList(t[this.DP.GROUP_MEMBER_ATTRIBUTES])},setQueryOptions:function(e){},getDataSourceURL:function(){return this.clusterUuid?i.getDataSourceURL(i.API_VERSION.V1):e.prototype.getDataSourceURL.apply(this,arguments)},_rawResultsToEntities:function(e){var i=[];return _.each(e,function(e){var a={};a.id=e[t.CP.ENTITY_ID],_.each(e.data,function(e){var t=e.name;e.values[0]?-1!==s.indexOf(t)?a[t]=e.values[0].values:a[t]=e.values[0].values[0]:a[t]=n.STATS_NOT_AVAILABLE},this),i.push(a)},this),i},setDefaultGroupByTimeInterval:function(e){}},{DP:e.DP})}),define("models/alert/ImpactedClusterModel",["models/BaseModel","models/query/BaseQueryModel","models/capacityplanning/EntityEventQueryModel","models/capacityplanning/CPQueryModel","data/DataProperties","utils/AppConstants","utils/FilterUtil"],function(e,t,i,n,s,a,r){"use strict";var o={EVENT_MODEL:"eventModel",RUNWAY_MODEL:"runwayModel",PLAY_MODEL:"playModel"};return e.extend({name:"ImpactedClusterModel",sync:function(e,l,c){var u,d=[],h=l.get("clusterId"),p=l.get("clusterName"),_=new i({entityType:a.ENTITY_CLUSTER,entityId:h,countOnly:!0,anomalyOnly:!0}),T=new n({entity_type:a.ENTITY_CLUSTER,group_member_attributes:[s.CLUSTER_RUNWAY],entity_ids:[h]}),E=new t((u={},_defineProperty(u,s.EB.ENTITY_TYPE,a.ENTITY_PLAYBOOK_RESULT),_defineProperty(u,t.DP.GROUP_MEMBER_COUNT,1),u)),S={};S=r.addFilterCondition(S,a.ENTITY_CLUSTER,r.createFilterCondition(a.ENTITY_PLAYBOOK_RESULT,a.ENTITY_CLUSTER,a.FILTER_OPERATORS.EQUALS,h,null,p?this.i18ns("cluster_name",p):"")),S=r.addFilterCondition(S,s.PLAY_EXECUTION_START_TIME,r.createFilterCondition(a.ENTITY_PLAYBOOK_RESULT,s.PLAY_EXECUTION_START_TIME,a.FILTER_OPERATORS.GREATER_OR_EQUAL,1e3*(Date.now()-a.MILLIS_PER_DAY),null,this.i18n("last_24_hrs"))),E.set(t.DP.FILTER_EXPR,S),E.set(t.DP.QUERY_NAME,"impacted_cluster_widget:action_rule_results"),d.push(_.save()),d.push(T.save()),d.push(E.save()),$.whenAll.apply($,d).done(function(){if(c.success){var e;c.success((e={},_defineProperty(e,o.EVENT_MODEL,_),_defineProperty(e,o.RUNWAY_MODEL,T),_defineProperty(e,o.PLAY_MODEL,E),e))}}).fail(function(){c.error&&c.error()})}},{DP:o})}),define("utils/NetworkUtil",["utils/AppConstants","data/DataProperties"],function(e,t){"use strict";return{getQuarantineMode:function(i){var n=_.first(i),s=n.get(t.EB.NETWORK_SECURITY_RULE.MODE),a=e.SYSTEM_CATEGORIES.QUARANTINE_FORENSIC_VALUE;return _.each(i,function(e){var i=e.get(t.EB.NETWORK_SECURITY_RULE.RULE_DEFINITION),n=_.first(i.target_group.categories||[]);n&&n.value===a&&(s=e.get(t.EB.NETWORK_SECURITY_RULE.MODE))}),s}}}),define("utils/renderers/NetworkSecurityRuleRenderers",["data/DataProperties","models/categories/CategoriesQueryModel","events/AppEvents","utils/NetworkUtil","utils/CommonTemplates","utils/I18nMixin","utils/AppConstants","utils/EntityUtil","utils/AppUtil"],function(e,t,i,n,s,a,r,o,l){"use strict";var c={RULE_TYPE:"rule_type",ANNOTATION:"annotation",RULE:"rule",MODE:"mode",MODIFIED_TIMESTAMP:"_modified_timestamp_usecs_"},u=_.template('<div class="net-sec-rule application-rule"><div class="entity-box inbounds"><div class="bubble"><%= sources %></div></div><div class="entity-box targets"><div class="target"><div class="bubble"><%= appType[0] %></div><div class="value"><%= appType[1] %></div></div><% _.each(targets, function(target) { %><div class="target"><div class="name bubble"><%= target[0] %></div><div class="value"><%= target[1] %></div></div><% }) %></div><div class="entity-box outbounds"><div class="bubble"><%= destinations %></div></div></div>'),d=_.template('<div class="net-sec-rule quarantine-rule">\n        <div class="entity-box quarantined">\n          <div class="bubble">\n            <%= label %>\n          </div>\n          <div class="nbVMs"><%= nbVMs %></div>\n        </div>\n      </div>'),h=_.template('<div class="net-sec-rule isolation-rule"><div class="entity-box targets isolation-targets"><% _.each(first_targets, function(target) { %><div class="target"><div class="name bubble"><%= target[0] %></div><div class="value"><%= target[1] %></div></div><% }) %></div><div class="entity-box targets isolation-targets"><% _.each(second_targets, function(target) { %><div class="target"><div class="name bubble"><%= target[0] %></div><div class="value"><%= target[1] %></div></div><% }) %></div></div>'),p=_.template('<div class="net-sec-rule application-rule">\n        <div class="entity-box inbounds">\n          <div class="bubble"><%= sources %></div>\n        </div>\n        <div class="entity-box targets">\n          <div class="target">\n            <div class="value">\n              <%= label %>\n            </div>\n          </div>\n        </div>\n        <div class="entity-box outbounds">\n          <div class="bubble"><%= destinations %></div>\n        </div>\n      </div>');return _.extend({},a,{name:"NetworkSecurityRuleRenderers",quarantineQueryModel:null,renderNetworkSecurityRule:function(t,i){var s=t[e.GROUP],a=_.first(s.getMembers());if(!a)return"";var u=a.get(i),d=a.get(c.RULE_TYPE);switch(i){case c.RULE_TYPE:return o.getAttributeDisplayValue(r.ENTITY_NETWORK_SECURITY_RULE,i,u,!1);case c.ANNOTATION:var h=o.getAttributeDisplayValue(r.ENTITY_NETWORK_SECURITY_RULE,i,u,!1);return this.i18n("rule_"+d+"_purpose",h);case c.MODIFIED_TIMESTAMP:return u?l.getElapsedTime({timestamp:u,includeAgo:!0,isDelta:!1,secondDetail:!1}):"-";case c.MODE:var p=u;switch(d===r.NSR_RULE_TYPE_CONSTANTS.QUARANTINE&&(p=n.getQuarantineMode(s.getMembers())),p){case r.NSR_RULE_ACTION.KMONITOR:return this.i18n("mode_monitoring");case r.NSR_RULE_ACTION.KAPPLY:return this.i18n("mode_applied");default:return"-"}case c.RULE:switch(d){case r.NSR_RULE_TYPE_CONSTANTS.APP:return this._renderAppRule(s);case r.NSR_RULE_TYPE_CONSTANTS.QUARANTINE:return this._renderQuarantineRule(s);case r.NSR_RULE_TYPE_CONSTANTS.ISOLATION:return this._renderIsolationRule(s);case r.NSR_RULE_TYPE_CONSTANTS.VDI:return this._renderVDIRule(s)}break;default:return""}},_renderAppRule:function(e){var t=[],i="";if(_.each(e.getMembers(),function(e){var n=e.get(c.RULE);if(n){var s=n.target_group||{};_.each(s.categories,function(e){if(e.name===r.SYSTEM_CATEGORIES.APP_TYPE)i=e.value;else if(e.name===r.SYSTEM_CATEGORIES.TIER);else{var n=_.find(t,function(t){return t[0]===e.name&&t[1]===e.value});n||t.push([e.name,e.value])}})}}),i||t.length){var n=_.map(e.getMembers(),function(e){return e.get(c.RULE)}),s=this._getSourcesOrDestsCount(n,r.NSR_FLOW_DIRECTION.INBOUND),a=this._getSourcesOrDestsCount(n,r.NSR_FLOW_DIRECTION.OUTBOUND);return u({appType:[r.SYSTEM_CATEGORIES.APP_TYPE,i],sources:s,destinations:a,targets:t})}return"-"},_renderQuarantineRule:function(e){var t=this._getQuarantineVMsCount();return d({label:this.i18n("quarantined"),nbVMs:t||""})},_renderIsolationRule:function(e){var t=[],i=[];return _.each(e.getMembers(),function(e){var n=e.get(c.RULE);if(n){var s=n.first_entity_filter||[];_.each(s,function(e){t.push([e.name,e.value])});var a=n.second_entity_filter||[];_.each(a,function(e){i.push([e.name,e.value])})}}),t.length||i.length?h({first_targets:t,second_targets:i}):"-"},_renderVDIRule:function(e){var t=_.map(e.getMembers(),function(e){return e.get(c.RULE)}),i=this._getSourcesOrDestsCount(t,r.NSR_FLOW_DIRECTION.INBOUND),n=this._getSourcesOrDestsCount(t,r.NSR_FLOW_DIRECTION.OUTBOUND);return p({sources:i,destinations:n,label:this.i18n("ad_group")})},_getSourcesOrDestsCount:function(e,t){var i=[],n=void 0;_.each(e,function(e){if(e){var s=t===r.NSR_FLOW_DIRECTION.INBOUND?e.inbound_list||[]:e.outbound_list||[];s.length&&1===_.first(s).peer_specification_type?n=-1:_.each(s,function(e){var t=String(e.ip_subnet||e.category_uuid_list);i.push(t)})}}),i.length&&(n=_.uniq(i).length);var s=this.i18n("no_"+t+"s");return-1===n?s=this.i18n("all_"+t+"s"):1===n?s=this.i18n("one_"+t):n>1&&(s=this.i18ns("n_"+t+"s",n)),s},_getQuarantinedVMsQueryModel:function(){var e=this;if(!this.quarantineQueryModel){this.quarantineQueryModel=new t({fetchEntityCounts:!0}),this.quarantineQueryModel.setNameFilter(r.SYSTEM_CATEGORIES.QUARANTINE_NAME),this._queryVMCounts();var n=function(t,i){i.entityType===r.ENTITY_VM&&e._queryVMCounts()};i.onAppEvent(i.ENTITIES_UPDATED,n),i.onAppEvent(i.ENTITIES_DELETED,n)}return this.quarantineQueryModel},_queryVMCounts:function(){var e=this,t=function(){var t=e._getQuarantineVMsCount();$(".entity-box.quarantined > .nbVMs").html(t)};this.quarantineQueryModel.performQuery({success:t,error:t})},_getQuarantineVMsCount:function(){var t=void 0,i=this._getQuarantinedVMsQueryModel();switch(i.getState()){case r.STATE_INIT:case r.STATE_PENDING:t=s.LOADING_MSG({msg:""});break;case r.STATE_SUCCESS:var n=0;_.each(i.getResultEntities(),function(t){var i=t.get(e.ENTITY_COUNTS)||{};n+=i[r.ENTITY_VM]||0}),t=0===n?this.i18n("no_vms"):this.i18ns("n_vms",n);break;default:t=""}return t}})}),define("utils/renderers/CategoryRenderers",["data/DataProperties","utils/EntityUtil","utils/CommonTemplates","utils/AppConstants","utils/I18nMixin","utils/SVG","utils/AppUtil"],function(e,t,i,n,s,a,r){"use strict";return _.extend({},s,{name:"CategoryRenderers",ENTITY_LINK_TEMPLATE:_.template('<span class="entityLink link showAllIcon" title="<%= tip %>" data-id="<%= id %>"> &middot; <%= SVG.SVGIcon("Export") %></span>'),renderEntityCategories:function(t){var i=t.get(e.EB.CATEGORIES)||[];return i.length?i.sort().join(", "):"-"},renderEntityCategory:function(t,i){var n=[],s=i.split(".");if(2===s.length){var a=s[1],r=t.get(e.EB.CATEGORIES)||[];_.each(r,function(e){var t=e.split(":");t[0]===a&&n.push(t[1])})}return n.length?n.join(","):"-"},renderCategoryValues:function(e,t){return this.isParentRow(e)?this._summarizeGroupValues(e,t):this._getCategoryDisplayValue(e.getName(),e.get(t))},renderCategoryCounts:function(t,i){var s={},a=null;if(this.isParentRow(t)){if(this.isExpandedRow(t))return"";s=this._getParentTotals(t[e.GROUP],i)}else{s=t.get(i)||{};var r=t.get(e.CAT_NAME)||"",o=t.get(e.CAT_VALUE)||"";i===e.ENTITY_COUNTS&&r.length&&o.length&&(a=""+r+n.ENTITY_CATEGORY_SEPARATOR+o)}return s=this.mergeEntityCounts(s),this._renderCategoryTotals(s,a)},isParentRow:function(t){return null!==t[e.GROUP]},isExpandedRow:function(t){return!0===t[e.EXPANDED]},isSystemCategory:function(t){if(this.isParentRow(t)){return!!t[e.GROUP].get(e.CAT_IMMUTABLE)}return!!t.get(e.CAT_IMMUTABLE)},_renderCategoryTotals:function(e,n){var s=[];return _.each(e,function(e,a){if(e>0){var o=e+" "+r.pluralizeEntity(a,e);n?s.push(i.CATEGORY_LINK({category:n,etype:t.fromEdb(a),linkText:o})):s.push(o)}}),s.length?s.join(" , "):"-"},_getParentTotals:function(e,t){return e.get("sum:total_"+t)||{}},_summarizeGroupValues:function(t,i){var n=this,s="",o=t[e.GROUP],l=o.getGroupMemberCounts();if(this.isExpandedRow(t)){if(l.available<l.total){var c=this.i18n("showingNofM","Showing %d of %d");s+=r.sprintf(c,l.available,l.total),s+=this.ENTITY_LINK_TEMPLATE({id:t.getId(),tip:this.i18n("showAll"),SVG:a})}}else{var u=[];if(_.each(o.getMembers(),function(e){u.length<3&&u.push(n._getCategoryDisplayValue(e.getName(),e.get(i)))}),s=u.join(", "),u.length<l.total){var d=this.i18n("nMore","  ( %d more )");s+=r.sprintf(d,l.total-u.length)}}return s},_getCategoryDisplayValue:function(e,t){return this.i18n("category_"+e+"_"+t,t)},mergeEntityCounts:function(e){var t=_.extend({},e),i=t[n.ENTITY_VM]||0,s=t[n.ENTITY_MH_VM]||0;return(i>0||s>0)&&(t[n.ENTITY_VM]=i+s),delete t[n.ENTITY_MH_VM],t}})}),define("utils/renderers/VirtualNetworkRenderers",["data/DataProperties","utils/I18nMixin","utils/AppUtil","utils/EntityUtil","utils/AppConstants","managers/AccessManager"],function(e,t,i,n,s,a){"use strict";var r=_.template('<span action-target="<%= targetId %>">\n        <a class="btnDetailsAction subnet-action" action="update_subnet">\n          <%= i18n("Common", "edit") %>\n        </a>\n        <span class="action-separator">&middot;</span>\n        <a class="btnDetailsAction subnet-action" action="delete">\n          <%= i18n("Common", "delete") %>\n        </a>\n      </span>');return _.extend({},t,{name:"VirtualNetworkRenderers",renderVirtualNetworkAttr:function(t,i){if(this.isParentRow(t)){var s=t[e.GROUP],a=s.get(s.DP.GROUP_SUMMARIES),r="",o=a["sum:"+i];return o&&o.values.length&&o.values[0].values.length&&(r=o.values[0].values[0]),n.getAttributeDisplayValue(t.entityType,i,r)}return" "},isParentRow:function(t){return null!==t[e.GROUP]},isExpandedRow:function(t){return!0===t[e.EXPANDED]},_summarizeGroupValues:function(t,s,a){var r="",o=t[e.GROUP],l=o.getGroupMemberCounts();if(this.isExpandedRow(t))if(l.available<l.total){var c=this.i18n("showingNofM","( Showing %d of %d )");r+=i.sprintf(c,l.available,l.total)}else r=" ";else{var u=[];if(_.each(o.getMembers(),function(e){u.length<3&&u.push(n.getAttributeDisplayValue(t.entityType,a,e.get(s)))}),r=u.join(", "),u.length<l.total){var d=this.i18n("nMore","  ( %d more )");r+=i.sprintf(d,l.total-u.length)}}return r},renderSubnetAttr:function(e,t){var i=t.slice(t.indexOf(":")+1,t.length);return this.isParentRow(e)?this._summarizeGroupValues(e,i,t):n.getAttributeDisplayValue(s.ENTITY_VIRTUAL_NETWORK,t,e.get(i))},renderSubnetRange:function(t){var i=t.get(e.EB.SUBNET.IP_RANGE),n=t.get(e.EB.SUBNET.PREFIX_LENGTH);return n?i+"/"+n:i},renderSubnetPool:function(t){var i=[],n=t.get(e.EB.SUBNET.IP_POOL_START),s=t.get(e.EB.SUBNET.IP_POOL_END);return _.isArray(n)&&_.isArray(s)&&_.each(n,function(e,t){n[t]&&s[t]&&i.push(n[t]+" - "+s[t])}),i.join(", ")},renderSubnetActions:function(e){var i=e.getId();return a.hasPermission(s.ENTITY_ATLAS_SUBNET,s.ACTION_UPDATE)?r({i18n:t.i18nStatic,targetId:i}):""}})}),define("utils/renderers/FloatingIPRenderers",["data/DataProperties","utils/I18nMixin"],function(e,t){"use strict";var i={ASSOCIATED:"Associated",NOT_ASSOCIATED:"Not Associated"};return _.extend({},t,{name:"FloatingIPRenderers",renderFloatingIPAssociation:function(t){return t.get(e.EB.FLOATING_IP.VIRTUAL_NIC_ID)?i.ASSOCIATED:i.NOT_ASSOCIATED}})}),define("utils/renderers/RoutingPolicyRenderers",["components/Components","data/DataProperties","utils/I18nMixin","utils/EntityUtil","utils/StatsUtil","utils/AppConstants"],function(e,t,i,n,s,a){"use strict";var r=_.template('<span action-target="<%= targetId %>">\n          <a class="btnDetailsAction routing-action" action="reset_counters">\n            <%= i18n("RoutingPolicyRenderers", "clear_counters") %>\n          </a>\n          <span class="action-separator">&middot;</span>\n          <a class="btnDetailsAction routing-action" action="update">\n            <%= i18n("Common", "edit") %>\n          </a>\n          <span class="action-separator">&middot;</span>\n          <a class="btnDetailsAction routing-action" action="delete">\n            <%= i18n("Common", "delete") %>\n          </a>\n      </span>'),o=_.template('<span action-target="<%= targetId %>">\n        <span class="action-separator">&middot;</span>\n        <a class="btnDetailsAction routing-action" action="reset_counters">\n          <%= i18n("RoutingPolicyRenderers", "clear_counters") %>\n        </a>\n      </span>'),l=_.template('<div class="pbr-priority-wrapper">\n        <div class="warning-svg-icon priority-warning" data = <%= priority %>>\n          <span class="error-msg-tooltip" data-error-msg="<%= errorMsg %>">\n            <%= Components.icon(\'exclamation_badge\', \'-inline -critical\') %>\n          </span>\n        </div>\n        <span><%= priority %></span>\n      </div>'),c={CUSTOM:"Custom",RE_ROUTE:"Reroute",ANY:"Any",DENY:"Deny",PERMIT:"Permit",ICMP_PROTOCOL:"ICMP",TCP:"TCP",UDP:"UDP"},u=[a.ROUTING_POLICY.RULE_TYPE.DEFAULT,a.ROUTING_POLICY.RULE_TYPE.SUBNET_DEFAULT],d={SOURCE_PORT:"source_port",DESTINATION_PORT:"destination_port",SOURCE_PORT_START:"source_port_range.start",SOURCE_PORT_END:"source_port_range.end",DEST_PORT_START:"destination_port_range.start",DEST_PORT_END:"destination_port_range.end",SOURCE_TYPE:"source_type",SOURCE_PREFIX:"source_prefix",DESTINATION_TYPE:"destination_type",DESTINATION_PREFIX:"destination_prefix",PROTOCOL_TYPE:"protocol_type",ICMP_CODE:"icmp_code",ICMP_TYPE:"icmp_type",PROTOCOL_NUMBER:"protocol_number",RULE_TYPE:"rule_type",PRIORITY:"priority",ACTION:"action",PACKET_COUNT:"packet_count_list",BYTE_COUNT:"byte_count_list",ERROR_MESSAGE:"error_message"},h={BYTES:"B"},p=_.template('<span class="default-rule-tooltip"\n          data-rule-type="<%=ruleType%>" data-subnet-ip="<%= subnetIp %>">\n        <%= Components.icon(\'information-tooltip\', \'-gray -inline -regular\') %>\n      </span>'),T=_.template('<div class="net-sec-rule pbr-rule">\n        <div class="entity-box inbounds">\n          <%= source %>\n        </div>\n        <% if (isCountersEnabled) { %>\n          <i class="counters">\n            <span class="counters-tooltip"\n              data-bytes-count="<%=byteCount[0]%>"\n              data-packet-count="<%= packetCount[0] %>">\n                <%= displayByteCount[0] %>\n            </span>\n          </i>\n        <% } %>\n        <div class="line"></div>\n        <div class="middle">\n          <div class="entity-box targets">\n            <div class="target">\n              <div class="value"><%= reroute %></div>\n            </div>\n          </div>\n        </div>\n        <% if (isCountersEnabled && byteCount[1]) { %>\n          <i class="counters">\n            <span class="counters-tooltip"\n              data-bytes-count="<%= byteCount[1] %>"\n              data-packet-count="<%= packetCount[1] %>">\n                <%= displayByteCount[1] %>\n            </span>\n          </i>\n        <% } %>\n        <div class="entity-box outbounds">\n          <%=destination%>\n        </div>\n      </div>'),E=_.template('<div class="net-sec-rule pbr-rule">\n        <div class="entity-box inbounds">\n          <div class="<%= action === \'Deny\' ? \'deny\' : \'\'%>">\n            <%=source%>\n          </div>\n        </div>\n        <% if (isCountersEnabled) { %>\n          <i class="counters">\n            <span class="counters-tooltip"\n              data-bytes-count="<%=byteCount[0]%>"\n              data-packet-count="<%= packetCount[0] %>">\n                <%= displayByteCount[0] %>\n            </span>\n          </i>\n        <% } %>\n        <div class="line"></div>\n        <div class="middle">\n          <div class="icon-wrapper">\n            <p> <%= title %></p>\n            <%= icon %>\n          </div>\n        </div>\n        <div class="entity-box outbounds">\n          <div class="<%= action === \'Deny\' ? \'deny\' : \'\'%>">\n            <%=destination%>\n          </div>\n        </div>\n      </div>'),S=_.template('\n      <div class="pbr-traffic">\n        <span class="protocol">\n          <%=protocol%>\n        </span>\n        <span class="port_range">\n          <%=portRange%>\n        </span>\n      </div>\n    '),g=_.template('\n      <span>\n        <%= i18n("RoutingPolicyRenderers", "icmp_type") %>: <%= type %>\n      </span>\n      <span>\n        <%= i18n("RoutingPolicyRenderers", "icmp_code") %>: <%= code %>\n      </span>\n    '),A=_.template('<span>\n        <%= i18n("RoutingPolicyRenderers", "src") %>: <%= src %>\n      </span>\n      <span>\n        <%= i18n("RoutingPolicyRenderers", "dest") %>: <%= dest %>\n      </span>\n    ');return _.extend({},i,{name:"RoutingPolicyRenderers",renderRoutingPolicyViz:function(r){var o={};o.source=this.renderCustomType(r,d.SOURCE_TYPE),o.destination=this.renderCustomType(r,d.DESTINATION_TYPE),o.byteCount=r.get(d.BYTE_COUNT),o.isCountersEnabled=!1,o.byteCount&&o.byteCount.length&&(o.isCountersEnabled=!0,o.displayByteCount=_.map(o.byteCount,function(e){return s.prefixFormat(e,h.BYTES)})),o.packetCount=r.get(d.PACKET_COUNT)||[a.DATA_NOT_AVAILABLE,a.DATA_NOT_AVAILABLE];var l=n.getAttributeDisplayValue(a.ENTITY_EB_ROUTING_POLICY,d.ACTION,r.get(d.ACTION),null,!0);if(o.action=l,l===c.RE_ROUTE){var u=n.getAttributeDisplayValue(a.ENTITY_EB_ROUTING_POLICY,t.EB.ROUTING_POLICY.SERVICE_IP_LIST,r.get(t.EB.ROUTING_POLICY.SERVICE_IP_LIST));return o.reroute=u,T(o)}return l===c.DENY?(o.icon=e.icon("x-square","-small -inline -critical"),o.title=i.i18nStatic(this.name,"drop")):(o.icon=e.icon("caret-right","-small -inline -active"),o.title=i.i18nStatic(this.name,"allow")),E(o)},renderRoutingPolicyTraffic:function(e){var t=this.renderCustomType(e,d.PROTOCOL_TYPE),s="",r=e.get(d.PROTOCOL_TYPE);r=n.getAttributeDisplayValue(a.ENTITY_EB_ROUTING_POLICY,d.PROTOCOL_TYPE,r,null,!0);var o=this.renderPortRange(e,d.SOURCE_PORT),l=this.renderPortRange(e,d.DESTINATION_PORT);return r===c.ICMP_PROTOCOL?s=g({type:o,code:l,i18n:i.i18nStatic}):r!==c.TCP&&r!==c.UDP||(s=A({src:o,dest:l,i18n:i.i18nStatic})),S({protocol:t,portRange:s})},renderCustomType:function(e,t){var i=n.getAttributeDisplayValue(a.ENTITY_EB_ROUTING_POLICY,t,e.get(t),null,!0),s=void 0;if(i===c.CUSTOM){var r=this._getCustomAttributeName(t);s=n.getAttributeDisplayValue(a.ENTITY_EB_ROUTING_POLICY,r,e.get(r))}else s=n.getAttributeDisplayValue(a.ENTITY_EB_ROUTING_POLICY,t,e.get(t));return s},renderRerouteAction:function(e,i){var s=n.getAttributeDisplayValue(a.ENTITY_EB_ROUTING_POLICY,i,e.get(i),null,!0),r=n.getAttributeDisplayValue(a.ENTITY_EB_ROUTING_POLICY,i,e.get(i));if(s===c.RE_ROUTE){r=r+" to "+n.getAttributeDisplayValue(a.ENTITY_EB_ROUTING_POLICY,t.EB.ROUTING_POLICY.SERVICE_IP_LIST,e.get(t.EB.ROUTING_POLICY.SERVICE_IP_LIST))}return r},renderActionsColumn:function(t){var s=t.get(d.RULE_TYPE);s=n.getAttributeDisplayValue(a.ENTITY_EB_ROUTING_POLICY,d.RULE_TYPE,s,null,!0);var l=t.getId();if(this._isInternalRule(s)){s=n.getAttributeDisplayValue(a.ENTITY_EB_ROUTING_POLICY,d.RULE_TYPE,s);var c=t.get(d.SOURCE_PREFIX)||t.get(d.DESTINATION_PREFIX);return i.i18nStatic(this.name,"default_rule")+p({ruleType:s,subnetIp:c,Components:e})+o({targetId:l,i18n:i.i18nStatic})}return r({i18n:i.i18nStatic,targetId:l})},renderPortRange:function(e,t){var i=e.get(d.PROTOCOL_TYPE);if((i=n.getAttributeDisplayValue(a.ENTITY_EB_ROUTING_POLICY,d.PROTOCOL_TYPE,i,null,!0))===c.ICMP_PROTOCOL){return(t===d.SOURCE_PORT?e.get(d.ICMP_TYPE):e.get(d.ICMP_CODE))||c.ANY}var s=void 0,r=void 0;return t===d.SOURCE_PORT?(s=e.get(d.SOURCE_PORT_START),r=e.get(d.SOURCE_PORT_END)):(s=e.get(d.DEST_PORT_START),r=e.get(d.DEST_PORT_END)),null===s&&null===r?c.ANY:s===r?s:s+" - "+r},_getCustomAttributeName:function(e){switch(e){case d.SOURCE_TYPE:return d.SOURCE_PREFIX;case d.DESTINATION_TYPE:return d.DESTINATION_PREFIX;case d.PROTOCOL_TYPE:return d.PROTOCOL_NUMBER}},renderRoutingPolicyPriority:function(t,i){var s=n.getAttributeDisplayValue(a.ENTITY_EB_ROUTING_POLICY,i,t.get(i),null,!0),r=t.get(d.ERROR_MESSAGE);return r&&r.length?l({priority:s,Components:e,errorMsg:r}):s},_isInternalRule:function(e){return!(!e||-1===u.indexOf(e))}})}),define("utils/renderers/ProjectRenderers",["data/DataProperties","managers/IntentManager","utils/AppConstants","utils/I18nMixin","utils/VisualizationUtil"],function(e,t,i,n,s){"use strict";return _.extend({},n,{name:"ProjectRenderers",isDefaultProject:function(i){var n=t.getStatusResourcesFromModel(i);if(n&&n[e.EB.PROJECT.IS_DEFAULT])return!0;if(i){var s=e.EB.PROJECT.IS_DEFAULT,a=i.get?i.get(s):i[s];return"true"===a||!0===a}return!1},getArrayCount:function(e){return _.isString(e)&&(e=[e]),_.isArray(e)?e.length:i.INVALID_STRING},getUserAndUserGroupCount:function(t,n){return!t||"true"!==t.get(e.EB.PROJECT.IS_DEFAULT)&&!0!==t.get(e.EB.PROJECT.IS_DEFAULT)?this.getArrayCount(t.get(n)):i.DATA_NOT_AVAILABLE},renderProjectName:function(e,t){return e.getValue(t)},renderProjectBar:function(e,t,n,a,r){if(isNaN(e)||void 0===e||null===e)return i.DATA_NOT_AVAILABLE;var o=void 0,l=void 0;return isNaN(t)||void 0===t||null===t?(r=!1,l=n):(o=e/t*100,l=n+" of "+a),r?s.renderProgressBar({percentUsed:o,rightTextLabel:l,widgetClass:"table-format",showBar:r}):l}})}),define("utils/renderers/draas/AvailabilityZoneRenderers",["data/DataProperties","utils/AppConstants","utils/I18nMixin"],function(e,t,i){"use strict";var n=t.ZONE_TYPE;return _.extend({},i,{name:"AvailabilityZoneRenderers",renderAZRegion:function(i,s){return i.get(e.EB.AZ.TYPE)===n.REMOTE?t.DATA_NOT_AVAILABLE:i.get(s)},renderZoneName:function(t,s){return t.get(e.EB.AZ.ZONE_TYPE)===n.LOCAL?i.i18nStatic("common","local"):t.get(s)},renderAZConnectionStatus:function(e,i){var n=e.get(i),s="",a=t.DATA_NOT_AVAILABLE;return null===n?a:("true"===n?(a=t.AZ_CONNECTION_STATUS.REACHABLE,s="-green"):(a=t.AZ_CONNECTION_STATUS.NOT_REACHABLE,s="-red"),'<span class="test_az_connectivity\n          az-status-icon '+s+'">'+a+"</span>")}})}),define("utils/renderers/draas/ProtectionRuleRenderers",["utils/AppConstants","utils/I18nMixin","managers/AppManager"],function(e,t,i){"use strict";var n={REMOTE_ROLLUP_VALUE:"remote_rollup_retention_policy.multiple",REMOTE_ROLLUP_TYPE:"remote_rollup_retention_policy.snapshot_interval_type",LOCAL_ROLLUP_VALUE:"local_rollup_retention_policy.multiple",LOCAL_ROLLUP_TYPE:"local_rollup_retention_policy.snapshot_interval_type",AZ_URL_LIST:"ordered_availability_zone_list.availability_zone_url",AZ_NAME_LIST:"az_order_list"};return _.extend({},t,{name:"ProtectionRuleRenderers",renderRecoveryPointObjective:function(t,i){var n=t.get(i);if(n){if(n>=e.SECONDS_PER_WEEK){var s=this._toNearestNDecimal(n/e.SECONDS_PER_WEEK,1);return this.i18ns("no_of_weeks",s)}if(n>=e.SECONDS_PER_DAY){var a=this._toNearestNDecimal(n/e.SECONDS_PER_DAY,1);return this.i18ns("no_of_days",a)}if(n>=e.SECONDS_PER_HOUR){var r=this._toNearestNDecimal(n/e.SECONDS_PER_HOUR,1);return this.i18ns("no_of_hours",r)}if(n>=e.SECONDS_PER_MINUTE){var o=this._toNearestNDecimal(n/e.SECONDS_PER_MINUTE,1);return this.i18ns("no_of_mins",o)}}},renderRetentionPolicy:function(e,t,i){var s=e.get(t);if(s)return this.i18ns("retention_in_snapshots",s);var a=void 0,r=void 0;return i?(a=e.get(n.LOCAL_ROLLUP_VALUE),r=e.get(n.LOCAL_ROLLUP_TYPE)):(a=e.get(n.REMOTE_ROLLUP_VALUE),r=e.get(n.REMOTE_ROLLUP_TYPE)),a&&r?a+" "+this.i18n("rollup_type_"+r):void 0},renderSourceAZName:function(e){var t=e.get(n.AZ_NAME_LIST)||[],s=e.get(n.AZ_URL_LIST)||[],a=i.getLocalAZUrl(),r=s.indexOf(a);if(!_.isNull(r)&&!_.isUndefined(r))return t[r]},renderDestinationAZName:function(e){var t=e.get(n.AZ_NAME_LIST)||[],s=e.get(n.AZ_URL_LIST)||[],a=i.getLocalAZUrl(),r=_.find(s,function(e){return e!==a});if(r){var o=s.indexOf(r),l=t[o];return l.indexOf("MISSING")>=0?this.i18n("not_connected"):l}},_toNearestNDecimal:function(e,t){if(t<=0)throw new Error("ProtectionRuleRenderers: n should be greater than zero");var i=Math.pow(10,t);return Math.round(e*i)/i}})}),define("utils/renderers/draas/RecoveryPlanRenderers",["data/DataProperties","utils/TimeUtil","utils/AppConstants","managers/I18nManager","managers/AppManager"],function(e,t,i,n,s){"use strict";var a=_.template('<span class="text-capitalize"><%= taskStatus %> </span>'),r={AZ_ORDER_LIST:"az_order_list",AZ_ORDER_URL_LIST:"az_order_url_list",ENTITY_LIST:"entity_list",LAST_TEST_CLEANUP_STATUS:"last_test_cleanup_status"};return _.extend({},n,{name:"RecoveryPlanRenderers",renderRPEntityCount:function(e,t){var i=e.get(t);return Array.isArray(i)?i.length:i?1:void 0},renderRPStartTime:function(e,i){var n=e.get(i);if(n)return t.formatFullDateTime(1e3*n)},renderRPGeneratedTime:function(e,i){var n=e.get(i);if(n)return t.formatFullDateTime(n/1e3)},renderRPJobExeStatus:function(e,t,s){var a=i.RECOVERY_PLAN.EXE_STATUS,r=[a.COMPLETED,a.RUNNING,a.PAUSED,a.ABORTED,a.FAILED,a.QUEUED,a.COMPLETE_WARNING,a.FAILED_WARNING];if(s)return r.indexOf(s)>-1?n.t("Common","recovery_plan_exe_status."+s):n.t("Common","recovery_plan_exe_status."+r[s])},renderRPStatus:function(e,t,i){if(i)return a({taskStatus:i})},renderRPSummaryDuration:function(e,t,s){if(s){var a=e.get("start_time_secs");if(a){var r=new Date(1e3*a),o=new Date(1e3*s),l=Math.abs(o-r)/i.MICROS_PER_MILLI,c=i.SECONDS_PER_MINUTE,u=i.SECONDS_PER_HOUR;return l<c?(l=""+Math.round(l),n.ts("SSPRecoveryPlanTaskTableView","duration_seconds",[l])):l>=c&&l<u?(l/=c,l=l.toFixed(2),n.ts("SSPRecoveryPlanTaskTableView","duration_mins",[l])):(l/=u,l=l.toFixed(2),n.ts("SSPRecoveryPlanTaskTableView","duration_hours",[l]))}}},renderRPTaskDuration:function(t,s,a){if(a){var r=t.get(e.EB.RECOVERY_PLAN_JOB.START_TIME);if(r){var o=new Date(r),l=new Date(a),c=Math.abs(l-o)/i.MICROS_PER_MILLI,u=i.SECONDS_PER_MINUTE,d=i.SECONDS_PER_HOUR;return c<u?(c=""+Math.round(c),n.ts("SSPRecoveryPlanTaskTableView","duration_seconds",[c])):c>=u&&c<d?(c/=u,c=c.toFixed(2),n.ts("SSPRecoveryPlanTaskTableView","duration_mins",[c])):(c/=d,c=c.toFixed(2),n.ts("SSPRecoveryPlanTaskTableView","duration_hours",[c]))}}},renderRPFullDateTime:function(e,i,n){if(n){var s=new Date(n);return t.formatDate(s,"yyyy-MM-dd hh:mm:ss tt")}},renderRPAZList:function(e,t){try{var s=e.get(t);if(s){if(s.length>1)return'<span class="conflict-detected">\n                '+n.t("SSPRecoveryPlanSummaryPanelView","conflict_detected")+"\n              </span>";return JSON.parse(s).map(function(e){return"<span>"+e+"</span></br>"}).join("")}}catch(e){return i.DATA_NOT_AVAILABLE}},renderRPJEntityRef:function(e,t,i){if(i&&_.first(i))return _.first(i).name},renderRPJobType:function(e,t,s){var a=i.RECOVERY_PLAN.JOB_TYPES,r=[a.VALIDATE,a.MIGRATE,a.FAILOVER,a.FAILBACK,a.TEST_FAILOVER,a.TEST_FAILBACK];if(s)return"1"===e.get("execution_status")?'<a class="running-rpj">'+n.t("Common","recovery_plan_job_types."+r[s])+"</a>":'<a href="#" class="job-title">'+n.t("Common","recovery_plan_job_types."+r[s])+"</a>"},renderLastValidationAndFailoverInfo:function(e,s){var a=e.get(s);if(a){var r=t.formatShortFullDateTime(a[1]/1e3),o=n.t("Common","recovery_plan_exe_status."+_.first(a));return r!==i.DATA_NOT_AVAILABLE&&o!==i.DATA_NOT_AVAILABLE?o+" - "+r:r===i.DATA_NOT_AVAILABLE||o===i.DATA_NOT_AVAILABLE?r!==i.DATA_NOT_AVAILABLE?r:o:i.DATA_NOT_AVAILABLE}return i.DATA_NOT_AVAILABLE},renderLastTestInfoInRPDetails:function(e,s){var a=e.get(s);if(a){var r=t.formatShortFullDateTime(a[1]/1e3),o=n.t("Common","recovery_plan_exe_status."+_.first(a));return r!==i.DATA_NOT_AVAILABLE&&o!==i.DATA_NOT_AVAILABLE?o+" - "+r:r===i.DATA_NOT_AVAILABLE||o===i.DATA_NOT_AVAILABLE?r!==i.DATA_NOT_AVAILABLE?r:o:i.DATA_NOT_AVAILABLE}return i.DATA_NOT_AVAILABLE},renderLastTestInfo:function(e,s){var a=e.get(s),o=e.get(r.LAST_TEST_CLEANUP_STATUS)||n.t("Common","none");if(a){var l=n.t("Common","recovery_plan_exe_status."+o);if(l!==i.DATA_NOT_AVAILABLE)return l+" - "+n.t("Common","recovery_plan_exe_status.CLEANUP_TEST_VMS");var c=t.formatShortFullDateTime(a[1]/1e3),u=n.t("Common","recovery_plan_exe_status."+_.first(a));return c!==i.DATA_NOT_AVAILABLE&&u!==i.DATA_NOT_AVAILABLE?u+" - "+c:c===i.DATA_NOT_AVAILABLE||u===i.DATA_NOT_AVAILABLE?c!==i.DATA_NOT_AVAILABLE?c:u:i.DATA_NOT_AVAILABLE}return i.DATA_NOT_AVAILABLE},renderRPJobValidateStatus:function(e,t,s){var a=i.RECOVERY_PLAN.EXE_STATUS,r=[a.COMPLETED,a.RUNNING,a.PAUSED,a.ABORTED,a.FAILED,a.QUEUED,a.COMPLETE_WARNING,a.FAILED_WARNING,a.WARNINGS,a.WARNING];if(s){if(e.get("index")){var o=e.get("validType")+"_VALIDATION";return'<span class="job-title"\n              data-test="test_cause_'+(o=o.toLowerCase())+"_"+e.get("index")+'">\n              '+n.t("Common","recovery_plan_exe_status."+s)+'\n              <a data-index="'+e.get("clientUUID")+'"\n                href=\'#\' class="ca-res">\n                '+n.t("CasResolutionPopupView","view_details")+"\n              </a>\n            </span>"}return r.indexOf(s)>-1?n.t("Common","recovery_plan_exe_status."+s):n.t("Common","recovery_plan_exe_status."+r[s])}},renderRPJValidationTitle:function(e,t,i){if(e.get("index")){i=i||"-";var s=e.get("validType")+"_VALIDATION"
;return'<span class="rpj-validation-title"\n            data-test="test_name_'+(s=s.toLowerCase())+"_"+e.get("index")+'">\n            <span class="subtask-index">'+e.get("index")+"</span>\n            "+i+"\n          </span>"}return n.t("SSPRecoveryPlanJobSummaryTableView",i+"_VALIDATION")},getSourceDestinationAZ:function(e){var t="",i="",a="",o="",l=e.get(r.AZ_ORDER_LIST);if(l&&l.length>1)return t=i=n.t("SSPRecoveryPlanSummaryPanelView","conflict_detected"),{sourceAZ:t,destinationAZ:i};try{l=JSON.parse(l)||[];var c=JSON.parse(e.get(r.AZ_ORDER_URL_LIST))||[],u=s.getLocalAZUrl(),d=_.indexOf(c,u),h=_.find(c,function(e){return e!==u}),p=_.indexOf(c,h);a=l[d],o=l[p]}catch(e){return}var T=e.get(r.ENTITY_LIST)||[];try{T&&(T=Array.isArray(T)?_.map(T,function(e){return e?JSON.parse(e):{}}):[JSON.parse(T)])}catch(e){throw new Error("Error in JSON parsing...")}var E=[],S=[];_.each(T,function(e){"true"===e.is_recovery_point?S.push(e):E.push(e)});var g=!0,A=!0;return E.length||(g=!1),S.length||(A=!1),g||A?g&&A?(i=a,t=o):g?(t=a,2===l.length&&(i=o)):A&&(i=a,2===l.length&&(t=o)):(i=a,2===l.length&&(t=o)),{sourceAZ:t,destinationAZ:i}},renderRPSource:function(e,t,i){try{return this.getSourceDestinationAZ(e).sourceAZ}catch(e){return"-"}},renderRPDestination:function(e,t,i){try{return this.getSourceDestinationAZ(e).destinationAZ}catch(e){return"-"}},renderRPPowerOnSequence:function(e,t,i){return'<a class="test_rp_power_seq_details rp-power-seq-details">\n          '+n.t("Common","viewDetails")+"</a>"},renderRPNetworkSettings:function(e,t,i){return'<a class="test_rp_network_set_details rp-network-set-details">\n          '+n.t("Common","viewDetails")+"</a>"},renderRPCleanupStatusSummary:function(e,t,i){var s=e.get(r.LAST_TEST_CLEANUP_STATUS)||n.t("Common","none");return n.t("Common","recovery_plan_exe_status."+s)}})}),define("utils/renderers/draas/VMRecoveryPointRenderers",["data/DataProperties","utils/I18nMixin","utils/TimeUtil"],function(e,t,i){"use strict";var n={LOCAL_RECOVERY_POINT_COUNT:"local_count",TOTAL_RECOVERY_POINT_COUNT:"total_count"};return _.extend({},t,{name:"VMRecoveryPointRenderers",renderEntityDetail:function(t,i){return t[e.GROUP].getSummaryAttributes()[i]},renderRemoteCount:function(e,t){var i=this.renderEntityDetail(e,n.LOCAL_RECOVERY_POINT_COUNT)||0,s=this.renderEntityDetail(e,n.TOTAL_RECOVERY_POINT_COUNT),a=s-i;return a>0?a:0},renderTimeUsec:function(e,t){var n=this.renderEntityDetail(e,t);if(n)return i.formatShortFullDateTime(n/1e3)}})}),define("utils/renderers/TooltipRenderers",["components/Components","utils/CommonTemplates","utils/ManagerMixin"],function(e,t,i){"use strict";var n={ICON:"icon",ACTIONABLE:"actionable",TEMPLATE:"template",PLACEMENT:"placement",CONTAINER:"container"},s={warning_icon:t.WARNING_ICON_TEMPLATE_CUSTOM({className:"tooltip-icon",reason:""})};return{name:"TooltipRenderers",renderTooltipIndicator:function(t,a,r){var o=i.getTooltipManager(),l="";r[n.TEMPLATE]&&(l+=" "+n.TEMPLATE+'="'+r[n.TEMPLATE]+'"'),r[n.PLACEMENT]&&(l+=" "+n.PLACEMENT+'="'+r[n.PLACEMENT]+'"'),r[n.ACTIONABLE]&&(l+=" "+n.ACTIONABLE+'="'+r[n.ACTIONABLE]+'"');var c=s[r[n.ICON]]||e.icon(r[n.ICON],"-regular -inline");return r[n.CONTAINER]&&(l+=" "+n.CONTAINER+'="'+r[n.CONTAINER]+'"'),'<span class="'+o.TOOLTIP_INDICATOR_CLASS+'"\n            data-toggle="tooltip"\n            data-id="'+t.getId()+'" data-attribute="'+a+'"\n            indicator="'+r[n.ICON]+'"\n            '+l+">\n            "+c+"\n          </span>"},renderDisplayValueWithTooltip:function(e,t,n,s){var a=i.getTooltipManager(),r=this.renderTooltipIndicator(e,n,s);if(r&&t)return"<span>"+t+'</span>\n                  <span class="pull-right icons-wrappe\n                  '+a.TOOLTIP_WRAPPER_CLASS+'">\n                  '+r+"</span>"}}}),define("utils/GpuUtil",["data/DataProperties","utils/AppConstants","utils/FilterUtil","utils/I18nMixin","models/query/QueryResultCollection","models/gpu/GpuModel"],function(e,t,i,n,s,a){"use strict";return{getGpuVendorDisplayName:function(e){var i=e;switch(e.toLowerCase()){case t.NVIDIA:i="NVIDIA";break;case t.INTEL:i="Intel"}return i},gpuObjToStr:function(t){var i="";if(t&&!_.isEmpty(t)){var n=t[e.GPU_VENDOR]||"",s=t[e.GPU_DEVICE_NAME]||"";i=this.getGpuVendorDisplayName(n)+" "+s}return i},groupGpuList:function(e){var t=_.groupBy(e,function(e){return e},this);return _.map(t,function(e,t){return 1===e.length?t:t+" ("+e.length+")"},this)},renderGpuSummary:function(e){if(_.isUndefined(e)||null===e||e===t.INVALID_STRING||"|"===e||0===e.length)return t.INVALID_STRING;_.isArray(e)||(e=_.compact(e.split("|")));var i=_.map(e,function(e){return e.replace("_compute",".compute").replace(/_/g," ")},this);return this.groupGpuList(i).join(", ")},nonLiveMigratablePoweredOnUserVms:function(n,a){var r={};i.addFilterCondition(r,e.EB.VM.IS_LIVE_MIGRATABLE,i.createFilterCondition(t.ENTITY_VM,e.EB.VM.IS_LIVE_MIGRATABLE,t.FILTER_OPERATORS.EQUALS,0)),i.addFilterCondition(r,e.EB.VM.IS_CVM,i.createFilterCondition(t.ENTITY_VM,e.EB.VM.IS_CVM,t.FILTER_OPERATORS.EQUALS,0)),i.addFilterCondition(r,e.EB.VM.POWER_STATE,i.createFilterCondition(t.ENTITY_VM,e.EB.VM.POWER_STATE,t.FILTER_OPERATORS.EQUALS,t.VM_POWER_STATE.ON)),n&&i.addFilterCondition(r,e.EB.VM.HYPERVISOR_TYPE,i.createFilterCondition(t.ENTITY_VM,e.EB.VM.HYPERVISOR_TYPE,t.FILTER_OPERATORS.EQUALS,n)),a&&_.each(a,function(n){i.addFilterCondition(r,e.EB.VM.NODE,i.createFilterCondition(t.ENTITY_VM,e.EB.VM.NODE,t.FILTER_OPERATORS.EQUALS,n))});var o=[e.EB.VM.VM_NAME,e.EB.VM.NODE_NAME],l={entityType:t.ENTITY_VM,group_member_attributes:o,filter_expression:r};return new s(null,l)},getGpuIdentifier:function(e,t){return e[t.DEVICE_ID]+"_"+e[t.GPU_VENDOR]+"_"+e[t.GPU_TYPE]},getFractionDisplayStr:function(e){return"1/"+e+" GPU"},getGpuAllocationStr:function(t){switch(t.get(a.DP.GPU_MODE)){case a.GPU_MODE_KSTRING.NONE:return n.i18nsStatic("GpuUtil","num_gpu_allocated_none");case a.GPU_MODE_KSTRING.PASSTHROUGH:return n.i18nsStatic("GpuUtil","num_gpu_allocated_singular",1,1);case a.GPU_MODE_KSTRING.VIRTUAL:return this.getVirtualGpuAllocationStr(t.get(e.EB.GPU.NUM_VGPUS_ALLOCATED),t.get(e.EB.GPU.MAX_ALLOCATABLE))}},getVirtualGpuAllocationStr:function(e,t){return t>1?n.i18nsStatic("GpuUtil","num_gpu_allocated_plural",e,t):n.i18nsStatic("GpuUtil","num_gpu_allocated_singular",e,t)}}}),define("utils/DataRendererUtil",["backbone","data/DataProperties","data/DataManager","data/DataURLConstants","utils/AppUtil","utils/AppConstants","utils/AlertUtil","utils/EntityUtil","utils/StatsUtil","utils/SVG","utils/VisualizationUtil","utils/CommonTemplates","utils/StyleDescriptor","utils/TimeUtil","utils/renderers/NetworkSecurityRuleRenderers","utils/renderers/CategoryRenderers","utils/renderers/VirtualNetworkRenderers","utils/renderers/FloatingIPRenderers","utils/renderers/RoutingPolicyRenderers","utils/renderers/ProjectRenderers","utils/renderers/draas/AvailabilityZoneRenderers","utils/renderers/draas/ProtectionRuleRenderers","utils/renderers/draas/RecoveryPlanRenderers","utils/renderers/draas/VMRecoveryPointRenderers","utils/renderers/TaskRenderers","utils/renderers/TooltipRenderers","utils/GpuUtil","utils/I18nMixin","utils/ManagerMixin","utils/ZoneUtil","components/Components","managers/I18nManager","managers/AccessManager","managers/ClusterManager"],function(e,t,i,n,s,a,r,o,l,c,u,d,h,p,T,E,S,g,A,m,f,I,C,v,R,N,P,O,y,D,M,b,L,w){"use strict";var U={ALERT_CONTEXT_TYPES:"context_types",ALERT_CONTEXT_VALUES:"context_values",ALERT_CATEGORIES:"categories",ALERT_IMPACT_TYPES:"impact_type",ALERT_MESSAGE:"message",EVENT_CLASSIFICATIONS:"classification",RUNWAY:"runway",PERCENT_USED:"percentUsed",ACKNOWLEDGED_BY:"acknowledged_by_user_name",ACKNOWLEDGED_TIMESTAMP:"acknowledged_time_stamp",RESOLVED_TIMESTAMP:"resolved_time_stamp",RESOLVED_BY:"resolved_by_user_name",AUTO_RESOLVED:"auto_resolved",ENTITY_UUIDS:"entity_uuids",ENTITY_TYPES:"entity_types",ENTITY_TYPE:"entityType",ENTITY_NAME:"entityName",AFFECTED_ENTITIES:"affected_entities"},V={TEXT:"text",PROTECTION_DOMAIN_ICON:"protectionDomainIcon",TEXT_WITH_TOOLTIP:"textWithTooltip",ALERT_IMPACT_TYPE_ICON:"alertImpactTypeIcon",ALERT_IMPACT_ICON:"alertImpactIcon",ALERT_STATS:"alertStats",ALERT_COUNT:"alertCount",ALERT_IMPACT_STATS:"alertImpactStats",ALERT_STATUS:"alertStatus",ANOMALY_COUNT:"anomalyCount",PLAY_COUNT:"playCountLink",PLAY_COUNT_HEADER:"playCountHeader",SPARK_LINE:"sparkLine",DETAILS_LINK:"detailsLink",RADIAL:"radial",STORAGE_BAR:"storageBar",DAYS:"days",RUNWAY:"runway",CLUSTER_DETAILS:"clusterDetails",CLUSTER_TYPE:"clusterType",SVG_ICON:"svgIcon",IOPS:"iops",LATENCY:"latency",TASK_NAME:"taskName",TASK_DETAILS:"taskDetails",TASK_NAME_DETAILS:"taskNameDetails",TASK_ENTITY_DETAILS:"taskEntityDetails",TASK_STATUS_DETAILS:"taskStatusDetails",TASK_ACTIONS:"taskActions",TASK_CREATE_TIME_DETAILS:"taskCreateTimeDetails",PROGRESS_BAR:"progressBar",ALERT_ISSUE:"alertIssue",ALERT_IMPACT_TYPE:"alertImpactType",ALERT_POLICY_DETAILS:"alertPolicyDetails",HEALTH:"health",USAGE_STATS:"UsageStats",CLUSTER_STATE_ICON:"clusterStateIcon",CLUSTER_VERSION:"clusterVersion",VM_EFFICIENCY:"vmEfficiency",VM_EFFICIENCY_LEVEL:"vmEfficiencyLevel",VM_EFFICIENCY_LINK:"vmEfficiencyLink",COMPRESSION_TYPE:"compressionType",COMMA_SEPARATED:"commaSeparated",COMMA_SEPARATED_UNIQUE:"commaSeparatedUnique",LINE_BREAKS:"lineBreaks",VM_MEMORY_USAGE:"vmMemoryUsage",STATUS_ICON:"statusIcon",WITNESS_PRIMARY_NAME:"witness_primary_name",WITNESS_SECONDARY_NAME:"witness_secondary_name",HOST_DETAILS_LINK:"hostDetailsLink",HOST_CVM_IP_ADDR:"hostCvmIpAddress",RELATED_ENTITY_DETAILS:"relatedEntityDetails",SOURCE_ENTITY_DETAILS:"sourceEntityDetails",TARGET_ENTITY_DETAILS:"targetEntityDetails",AFFECTED_ENTITIES_DETAILS:"affectedEntitiesDetails",TRIGGER_ENTITY_DETAILS:"triggerEntityDetails",PLAYBOOK_STATUS:"playbookStatus",CLUSTER_DETAILS_LINK:"clusterDetailsLink",CLUSTER_INEFFICIENT_LINK:"clusterInefficientLink",EXTRACT_ID_FROM_LONG_ID:"extractIdFromLongId",STORAGE_FORMARTTER_GB:"storageFormatterGb",APP_BLUEPRINT_TYPE:"appBlueprintType",TIMESTAMP_SECONDS:"timestampformatter",INTENT_TIMESTAMP_SECONDS:"intenttimestampformatter",TIMESTAMP_USEC:"timestampformatterUSec",TIMESTAMP_MILLISEC:"timestampformatterMilliSec",ISO_TIMESTAMP_MILLISEC:"ISODateTimestampformatterMilliSec",USERNAME:"username",USER_GROUPS:"userGroups",VMPROFILE_STORAGE_FORMATTER:"vmprofileStorageFormatter",CONTAINER_PORT_MAPPING_DETAILS:"containerPortMappingDetails",CONTAINER_PORT_MAPPING:"containerPortMapping",CONTAINER_CPU_SHARES:"containerCpuShares",CONTAINER_MEMORY_MB:"containerMemoryMb",CONTAINER_HOST_IP:"containerHostIp",GPU_LIST:"gpuList",GPU_FRAMEBUFFER:"gpuFramebuffer",GPU_VIRTUAL_SLICE:"gpuVirtualSlice",EVENT_CLASSIFICATION:"eventClassification",GPU_VMS_ASSIGNED:"vmsAssigned",NOT_EMPTY:"notEmpty",SCHEDULE_PERIODICITY:"periodicity",NGT_APP_LIST:"ngtAppListFormatter",AZ_REGION:"availabilityZoneRegion",AZ_NAME:"availabilityZoneName",AZ_CONNECTION_STATUS:"azConnectionStatus",VM_DESCRIPTION:"vmDescription",I18N_VALUE:"i18nValue",EB_PROJECT_VCPUS_COUNT_USAGE:"vcpusCountUsage",EB_PROJECT_MEMORY_USAGE:"memoryBytesUsage",EB_PROJECT_STORAGE_USAGE:"storageBytesUsage",EB_PROJECT_VCPUS_COUNT_USAGE_TEXT:"vcpusCountUsageText",EB_PROJECT_MEMORY_USAGE_TEXT:"memoryBytesUsageText",EB_PROJECT_STORAGE_USAGE_TEXT:"storageBytesUsageText",EB_PROJECT_NAME:"projectName",EB_PROJECT_USERS_COUNT:"usersCount",EB_PROJECT_USER_GROUPS_COUNT:"userGroupsCount",EB_RECOVERY_PLAN_ENTITY_COUNT:"recovery_plan_entity_count",EB_RECOVERY_PLAN_STATUS:"recovery_plan_status",EB_RECOVERY_PLAN_JOB_TYPE:"recovery_plan_job_type",EB_RECOVERY_PLAN_JOB_EXE_STATUS:"recovery_plan_job_exe_status",EB_RECOVERY_PLAN_JOB_VALIDATE:"recovery_plan_job_validate",EB_RPJ_VALIDATION_TITLE:"rpj_validation_title",EB_RECOVERY_PLAN_AZ_LIST:"process_az_list",EB_RECOVERY_PLAN_FULL_DATE_TIME:"full_date_time",EB_RECOVERY_PLAN_DURATION_MINS:"duration_mins",EB_RECOVERY_PLAN_SUMMARY_DURATION:"rp_summary_duration",EB_RECOVERY_PLAN_JOB_ENTITY_REF:"recovery_plan_job_entity_ref",EB_RP_VALIDATION_FAILOVER_STATUS:"rp_validation_failover_status",EB_RECOVERY_PLAN_TEST_STATUS:"recovery_plan_test_status",EB_RP_TEST_STATUS_DETAILS_VIEW:"rp_test_status_details_view",EB_RECOVERY_PLAN_SOURCE:"recovery_plan_source",EB_RECOVERY_PLAN_DESTINATION:"recovery_plan_destination",EB_RECOVERY_PLAN_JOB_TITLE:"recovery_plan_job_title",EB_RECOVERY_PLAN_GENERATED_TIME:"recovery_plan_generated_time",EB_RECOVERY_PLAN_START_TIME:"recovery_plan_start_time",EB_RECOVERY_PLAN_POWER_ON_SEQ:"rp_power_on_sequence",EB_RECOVERY_PLAN_NETWORK_SETTINGS:"rp_network_settings",EB_REPORT_DOWNLOAD_LINK:"report_download_link",EB_SUMMARY_RP_CLEANUP_STATUS:"recovery_plan_cleanup_summary",NET_SEC_RULE:"network_security_rule",SEC_RULE:"sec_rule",INTENT_LAST_STATE:"taskLastState",INTENT_OPERATION:"intentOperation",INTENT_ENTITY_TYPE:"intentEntityType",ENTITY_CATEGORIES:"entityCategories",ENTITY_CATEGORY:"categoryValue",ENTITY_CATEGORY_VALUES:"categoryValues",ENTITY_CATEGORY_COUNTS:"categoryCounts",VIRTUAL_NETWORK_CONFIG:"virtualNetworkConfig",SUBNET_RANGE:"subnetIPRange",SUBNET_POOL:"subnetPool",SUBNET_ACTIONS:"subnetActions",VIRTUAL_NETWORK_ATTR:"virtualNetworkAttr",SUBNET_ATTR:"subnetAttr",FLOATING_IP_ASSOCIATION:"floatingIPAssociation",RENDER_CUSTOM_TYPE:"renderCustomType",RENDER_PORT_RANGE:"renderPortRange",RENDER_REROUTE_ACTION:"renderRerouteAction",RENDER_ACTIONS_COLUMN:"renderActionsColumn",RENDER_ROUTING_POLICY_VIZ:"renderRoutingPolicyViz",RENDER_ROUTING_POLICY_TRAFFIC:"renderRoutingPolicyTraffic",RENDER_ROUTING_POLICY_PRIORITY:"renderRoutingPolicyPriority",VM_PROTECTION_RULE:"vmProtectionRule",VM_NIC_IP_ADDRESSES:"renderVirtualNicIpAddresses",VM_REMOTE_ACCESS_LINKS:"vmRemoteAccessLinks",VM_RECOVERY_POINT_VALUE:"vmRecoveryPointValue",VM_RECOVERY_POINT_TOTAL_COUNT:"vmRecoveryPointRemoteCount",VM_RECOVERY_POINT_TIME_USEC:"vmRecoveryPointTimeUsec",PR_SOURCE:"prSourceAZ",PR_DESTINATION:"prDestinationAZ",PR_RECOVERY_POINT_OBJECTIVE:"prRPO",PR_LOCAL_RETENTION_POLICY:"prLocalRetentionPolicy",PR_REMOTE_RETENTION_POLICY:"prRemoteRetentionPolicy",NGT_STATUS:"ngtStatus",NONE:"none"},k=_.template('<div class="n-spark-line-div"><div class="n-spark-line" entity-id="<%= entityId %>" metric-id="<%= metricId %>"><% if (showLoader) { %><div class="n-inline-loading"></div><% } %></div><div class="spark-line-label"><%= value %></div></div>'),x=_.template('<a class="n-link-action details-link <%= classes %>" action="<%= action %>" actionTarget="<%= actionTarget %>" actionTargetId="<%= actionTargetId %>" <% if (targetTabId) { %> targetTabId="<%= targetTabId %>" <% } %> actionTargetName="<%= actionTargetName %>"><%= displayValue %> </a>'),F=_.template(s.trimmedTemplate('\n      <span class="details-link"><%= ssh %></span>\n      &nbsp;&#x2F;&nbsp;\n      <span class="details-link"><%= rdp %></span>\n    ')),Y=_.template('<div class="n-category-icon n-<%= category.toLowerCase() %>-icon"><%= category.charAt(0) %></div>'),G=_.template('<span class="n-alert-count n-alert-count-<%= severity %>" data-id="<%= id %>" alert-category="<%= category%>"><%= value %></span>'),B=_.template('<a class="ebLink n-link-action cluster-efficiency" data-eb-entity="vm" data-eb-filter="cluster_name" data-eb-perspective="Efficiency" data-eb-filter-value="<%= entityName %>"><%= count %></a>'),H=_.template('<%_.each(categories, function(value, key) { %><span class="n-alert-count n-alert-count-<%= stats[key].className %>" alert-category="<%= key %>" data-id="<%= id %>" title="<%= value[0] %> : <%= stats[key].total%>"><%= I18nManager.t("Common", "Abbreviations.abbr_" + value[1].toLowerCase(), value[1]) %></span><% }) %>'),W=(_.template('<span class="n-alert-category-critical %>"><%= displayName %></span>'),_.template('<div class="n-bread-crumb n-link-action" data-id="<%= dataId %>"></div>')),K=_.template("<span><%= runway %></span>"),z=(_.template('<div class="n-widget">  <div class="n-visual-bar"><div style="width: <%= percentUsed %>%" class="bar <%= bar%>"></div></div><% if (used) { %><div class="n-visual-bar-label"><%= used %> </div>  <% } %></div>'),_.template('<span class="text-capitalize"><%= taskStatus %> </span>'),_.template('<div class="vantage-point-icon" title="<%= tooltip %>"><%= svgIcon %></div>')),j=_.template('<div class="css-icon state-icon -icon-<%= entityType.toLowerCase() %>-<%= state.toLowerCase() %>"></div><span><%= displayValue %></span>'),Q=_.template('<div class="task-title"><div class="pull-left"><%= tasks %></div><div class="pull-right"><%= details %></div></div>'),X=_.template('<span class="tooltip-wrapper" title="<%= tooltipMsg %>"><%= Components.icon("question-tooltip") %></span>'),q=_.template('<div class="intent-task-last-state"><%= progressBar %> </div>'),J=(_.template('<div class="intent-task-info" title="<%= message %>" ><%= Components.icon("information-tooltip", "-small -inline") %> </div>'),_.template('<div class="intent-task-help" title="<%= message %>" ><%= Components.icon("question-tooltip", "-small -inline") %> </div>')),Z=_.template("<%= containerPort %> -> <%= hostIp %>:<%= hostPort%>"),ee=_.template('<span title="<%= value %>"><%= value %></span>'),te=_.template('<span title="<%= tooltip %>"><%= value %></span>'),ie=_.template('<span class="system-entity"><%= systemLabel %></span>'),ne=_.template('\n      <% if (listForTooltip !== \'\') { %>\n        <span class="tooltip-wrapper" title="<%= listForTooltip %>"\n              data-tooltip-placement="right">\n      <% } %>\n      <%= listToShow %>\n      <% if (listForTooltip !== \'\') { %>\n        </span>\n      <% } %>'),se=_.template('<a data-test="datarendererutil_a_dashboard_play_count_<%= attr %>"\n        class="ebLink n-link-action n-hidden-link-action"\n        data-eb-entity="action_rule_result"\n        data-eb-perspective="General"\n        data-eb-filter-expr=\'<%= filter %>\'\n      ><%= count %></a>'),ae={NAME:"name",DISPLAY_NAME:"displayName",WIDTH:"width",COLUMN_WIDTH:"columnWidth",FORMATTER:"formatter",TOOLTIP:"tooltip",TARGET_TAB_ID:"targetTabId"},re=e.Model.extend({idAttribute:ae.NAME,nameAttribute:ae.NAME,name:"AttributeRendererModel",DP:ae,getAttributeName:function(){return this.get(ae.NAME)},getAttributeDisplayName:function(e){var t=o.getAttributeDisplayName(e,this.get(ae.NAME));return t||s.toTitleCase(this.getAttributeName())},getAttributeDisplayTooltip:function(e,t){var i=o.getAttributeDisplayTooltip(e,this.get(ae.NAME),t),n="";return i&&(n=this.renderTooltip(i)),n},getDisplayWidth:function(){return this.get(ae.WIDTH)},getTableColumnWidth:function(){return this.get(ae.COLUMN_WIDTH)},formatAttributeDisplayName:function(e){return this.get(ae.DISPLAY_NAME)},setFormatter:function(e){this.set(ae.FORMATTER,e)},isNoneFormatter:function(){return this.get(ae.FORMATTER)===V.NONE},hasDetailsPage:function(e){return!!(w.isMulticlusterUI()||e!==a.ENTITY_ALERT&&e!==a.ENTITY_EVENT)||L.isClusterFFEnabled(a.FFLAGS.ALERTS_IN_IDF)},getSystemEntityTag:function(e){var i=void 0;switch(e.entityType){case a.ENTITY_CATEGORY:i=E.isSystemCategory(e);break;case a.ENTITY_ROLE:i=L.isPrebuiltRole(e.getName());break;case a.ENTITY_NGT_POLICY:i=JSON.parse(e.get(t.EB.NGT.APPLY_ONCE));break;case a.ENTITY_PLAYBOOK:i=JSON.parse(e.get(t.OOB_PLAYBOOK));break;case a.ENTITY_ACTION_TEMPLATE:i=JSON.parse(e.get(t.OOB_ACTION_TEMPLATE));break;default:i=!1}return i?ie({systemLabel:O.i18nStatic("common","system_tag")}):""},getAttributeDisplayValue:function(e,t,i){t=void 0===t||t;var n=this.get(ae.NAME),s=i||e.getValue(n);if(0===n.indexOf(a.ENTITY_CATEGORY_PREFIX))return E.renderEntityCategory(e,n);if(this.isNoneFormatter())return s||a.DATA_NOT_AVAILABLE;0===n.indexOf("stats.")&&(n=n.substring("stats.".length)),s=o.getAttributeDisplayValue(e.entityType,n,s,t),this.get(ae.FORMATTER)&&(s=this.formatAttributeDisplayValue(e,n,this.get(ae.FORMATTER),s));var r=this.get(ae.TOOLTIP);return r&&y.getTooltipManager().showTooltipIndicator(e,n)?N.renderDisplayValueWithTooltip(e,s,n,r):s||a.DATA_NOT_AVAILABLE},getAttributeExportValue:function(e,i,n){var s=this.get(ae.FORMATTER);if(s)switch(s){case V.ALERT_ISSUE:return this.getAlertIssue(i,e);case V.ALERT_IMPACT_TYPE:return this.getAlertImpactTypes(i,e);case V.EVENT_CLASSIFICATION:return this.getEventClassification(i,e);case V.HOST_DETAILS_LINK:return this.renderHostDetailsLink(e,!0);case V.RELATED_ENTITY_DETAILS:return this.renderRelatedEntityDetails(e,!0);case V.SOURCE_ENTITY_DETAILS:return this.renderSourceEntityDetails(e,!0);case V.TARGET_ENTITY_DETAILS:return this.renderTargetEntityDetails(e,!0);case V.TRIGGER_ENTITY_DETAILS:return this.renderTriggerEntityDetails(e,!0);case V.CLUSTER_DETAILS_LINK:return this.renderClusterDetailsLink(e,!0);case V.TASK_ENTITY_DETAILS:return R.renderTaskEntityDetails(e,!0);case V.TASK_ACTIONS:return"";case V.NOT_EMPTY:return this.renderNotEmpty(i);case V.SCHEDULE_PERIODICITY:return this.renderSchedulePeriodicity(e);case V.VM_EFFICIENCY:return this.renderVMEfficiency(n,e);case V.PLAYBOOK_STATUS:return this.renderPlaybookStatus(e)}var l=this.get(ae.NAME);if(0===l.indexOf("stats.")&&(l=l.substring("stats.".length)),l===t.ALERT_SEVERITY&&e.entityType===a.ENTITY_ALERT)return r.formatSeverity(i);var c=o.getAttributeDisplayValue(e.entityType,l,i);return _.isArray(c)?c.join(" , "):c},exportEntityTypes:function(e,t,i){var n=e.get(t),r=[];if(!n)return"";_.isArray(n)||(n=[n]),i=_.isNumber(i)?i:n.length;for(var o=0;o<i;o++){var l=s.getEntityTypeForUI(n[o],w);r.push(a.ENTITY_NAMES[l]||s.toUpperCaseFirstChar(l))}return r.join(", ")},formatAttributeDisplayValue:function(e,i,n,h){switch(n){case V.TEXT:return e.get(i);case V.PROTECTION_DOMAIN_ICON:return u.renderProtectionDomainIcon(e.toJSON());case V.ALERT_IMPACT_TYPE_ICON:return h?Y({category:h}):"";case V.ALERT_POLICY_DETAILS:return this.renderAlertPolicyLink(e);case V.CLUSTER_INEFFICIENT_LINK:return this.renderClusterEfficiencyLink(e);case V.WITNESS_PRIMARY_NAME:case V.WITNESS_SECONDARY_NAME:return e.get(i);case V.STATUS_ICON:switch(e.entityType){case a.ENTITY_ALERT:return r.formatSeverity(e.get(i));default:var _=e.get(i);return j({entityType:e.entityType||"",state:_||"",displayValue:h||a.DATA_NOT_AVAILABLE})}case V.NGT_STATUS:return e.get(a.NGT.STATUS.INSTALLEDVERSION)?s.compareVersions(e.get(a.NGT.STATUS.CLUSTERVERSION),e.get(a.NGT.STATUS.INSTALLEDVERSION))>0?b.t("ngt","Common.upgrade_available"):b.t("ngt","Common.on_latest"):b.t("ngt","Common.not_installed");case V.ALERT_IMPACT_ICON:return h.replace(/^\k/,"");case V.ALERT_COUNT:return this.renderAlertCount(e);case V.ANOMALY_COUNT:return this.renderAnomalyCount(e);case V.PLAY_COUNT_HEADER:return this.renderPlayCountHeader(e,i);case V.PLAY_COUNT:return this.renderPlayCount(e,i);case V.ALERT_STATS:var N=e.getValue(i),O=N.total,y=i.replace(/^\alertStats\./,""),D=O?this.getHighestAlertSeverity(N):a.ALERT_SEVERITY_NAMES.kInfo;return 0===O?a.DATA_NOT_AVAILABLE:G({value:O,id:e.get(t.CLUSTER_UUID)||e.getId(),severity:D,category:y});case V.ALERT_IMPACT_STATS:var M=e.getValue(i);return M&&0===M.total?a.DATA_NOT_AVAILABLE:H({id:e.get(t.CLUSTER_UUID)||e.getId(),categories:a.ALERT_IMPACT_TYPES,stats:this.getAlertStatsInfoByCategory(M),I18nManager:b});case V.STORAGE_BAR:return this.renderStorageBar(e);case V.CLUSTER_DETAILS:return h||a.DATA_NOT_AVAILABLE;case V.DAYS:var w=parseInt(h,10);return isNaN(w)?a.INVALID_STRING:b.ts("Common","time.days",[w]);case V.RUNWAY:if(!h)return a.DATA_NOT_AVAILABLE;var U=s.processRunwayNumber(h);return K({runway:U});case V.SVG_ICON:return z({svgIcon:c.SVGIcon(h),tooltip:h});case V.SPARK_LINE:return k({value:h,entityId:e.getId(),metricId:this.getSparkLineMetric(),showLoader:this.showSparkLineLoader()});case V.DETAILS_LINK:var F=this.get(ae.TARGET_TAB_ID),B=e.get(t.UUID)||e.getId();return B||e.entityType!==a.ENTITY_CLUSTER||(B=e.get(t.CLUSTER_ID)||e.get("clusterId")),B&&L.canViewByEntityType(e.entityType)?x({action:a.SUBPAGE_COMPONENT_DETAILS,actionTargetId:B,actionTarget:e.entityType,actionTargetName:e.get(e.nameAttribute),displayValue:h,targetTabId:F||null,classes:null}):h;case V.RADIAL:var $=e.getValue(i);return d.RADIAL_TEMPLATE({className:null,displayValue:h,percent:$});case V.IOPS:return h===a.STATS_NO_VALUE?a.DATA_NOT_AVAILABLE:l.iopsFormat(h,!0);case V.LATENCY:return h===a.STATS_NO_VALUE?a.DATA_NOT_AVAILABLE:l.microSecondsFormat(h);case V.TASK_DETAILS:return R.renderTaskDetails(e);case V.TASK_NAME:return R.renderTaskName(e,h);case V.TASK_NAME_DETAILS:return R.renderTaskNameDetails(e);case V.TASK_ENTITY_DETAILS:return R.renderTaskEntityDetails(e);case V.TASK_STATUS_DETAILS:return R.renderTaskStatusDetails(e);case V.TASK_ACTIONS:return R.renderTaskActions(e);case V.TASK_CREATE_TIME_DETAILS:return R.renderTaskCreateTimeDetails(e,h);case V.PROGRESS_BAR:var W=void 0;e.entityType===a.ENTITY_INTENT_SPEC?W=s.getTaskStateFromIntentState(e.get(t.EB.INTENT_SPEC.STATE)):(W=e.get(t.TASK_STATUS),(W=W.toLowerCase())===a.TASK_STATUS_COMPLETED&&(W=a.TASK_STATUS_COMPLETE));var Q=e.getValue(i);return"undefined"===h&&null===h||h===a.DATA_NOT_AVAILABLE?h=a.DATA_NOT_AVAILABLE:h+="%",u.renderProgressBar({percentUsed:Q,rightTextLabel:h,barClass:W});case V.ALERT_ISSUE:return this.getAlertIssue(h,e);case V.ALERT_IMPACT_TYPE:return this.getAlertImpactTypes(h,e);case V.EVENT_CLASSIFICATION:return this.getEventClassification(i,e);case V.HEALTH:return this.getHealthIcon(h);case V.USAGE_STATS:return this.renderUsageStats(i,e);case V.CLUSTER_STATE_ICON:return this.renderClusterStateIcon(i,e);case V.VM_EFFICIENCY:return this.renderVMEfficiency(i,e);case V.VM_EFFICIENCY_LEVEL:return this.renderVMEfficiencyLevel(i,e);case V.VM_EFFICIENCY_LINK:return this.renderVMEfficiencyLink(i,e);case V.COMPRESSION_TYPE:return this.renderCompressionType(i,e);case V.VMPROFILE_STORAGE_FORMATTER:return this.renderVmProfileStorage(i,e);case V.COMMA_SEPARATED:return this.renderCommaSeparated(i,e);case V.COMMA_SEPARATED_UNIQUE:return this.renderCommaSeparated(i,e,!0);case V.LINE_BREAKS:return this.renderLineBreaks(i,e);case V.VM_REMOTE_ACCESS_LINKS:return this.renderRemoteAccessLinks(t.EB.VM.IP_ADDRESSES,e);case V.VM_PROTECTION_RULE:return this.renderVMProtectionRule(e,i);case V.VM_NIC_IP_ADDRESSES:return this.renderVMVnicIpAddresses(e,i);case V.VM_MEMORY_USAGE:return this.renderVMMemoryUsage(i,e);case V.HOST_DETAILS_LINK:return this.renderHostDetailsLink(e);case V.HOST_CVM_IP_ADDR:return this.renderHostCvmIp(e,h);case V.USERNAME:return this.renderUsername(i,e);case V.USER_GROUPS:return this.renderUsergroups(i,e);case V.ALERT_STATUS:return this.renderAlertStatus(i,e);case V.RELATED_ENTITY_DETAILS:return this.renderRelatedEntityDetails(e);case V.SOURCE_ENTITY_DETAILS:return this.renderSourceEntityDetails(e);case V.TARGET_ENTITY_DETAILS:return this.renderTargetEntityDetails(e);case V.AFFECTED_ENTITIES_DETAILS:return this.renderAffectedEntitiesDetails(e);case V.TRIGGER_ENTITY_DETAILS:return this.renderTriggerEntityDetails(e);case V.PLAYBOOK_STATUS:return this.renderPlaybookStatus(e);case V.CLUSTER_DETAILS_LINK:return this.renderClusterDetailsLink(e);case V.CONTAINER_CPU_SHARES:return this.renderContainerCpuShares(e);case V.CONTAINER_MEMORY_MB:return this.renderContainerMemoryMb(e);case V.CONTAINER_PORT_MAPPING_DETAILS:return this.renderContainerPortMapping(e,!0);case V.CONTAINER_PORT_MAPPING:return this.renderContainerPortMapping(e,!1);case V.CONTAINER_HOST_IP:return this.renderContainerHostIp(e);case V.TEXT_WITH_TOOLTIP:return this.renderWithTooltip(i,e);case V.STORAGE_FORMARTTER_GB:if(h)return h+" GiB";break;case V.INTENT_TIMESTAMP_SECONDS:var X=e.get(t.INTENT_KIND),q=e.get(t.EB.RECOVERY_PLAN_JOB.END_TIME_SECS);if(X===a.ENTITY_RECOVERY_PLAN_JOB&&q)return p.formatDateTime(1e3*q);if(h)return p.formatDateTime(1e3*h);break;case V.TIMESTAMP_SECONDS:if(h)return p.formatDateTime(1e3*h);break;case V.TIMESTAMP_USEC:if(h)return p.formatShortFullDateTime(h/1e3);break;case V.TIMESTAMP_MILLISEC:if(h)return p.formatShortFullDateTime(h);break;case V.ISO_TIMESTAMP_MILLISEC:if(h){var J=p.convertISODateTimeToUTS(h);return p.formatShortFullDateTime(J)}break;case V.EXTRACT_ID_FROM_LONG_ID:return h?(h.indexOf("::")>-1&&(h=h.split("::")[1]),h):a.DATA_NOT_AVAILABLE;case V.EB_RECOVERY_PLAN_START_TIME:return C.renderRPStartTime(e,i,h);case V.EB_RECOVERY_PLAN_GENERATED_TIME:return C.renderRPGeneratedTime(e,i,h);case V.EB_RECOVERY_PLAN_AZ_LIST:return C.renderRPAZList(e,i,h);case V.EB_RECOVERY_PLAN_JOB_ENTITY_REF:return C.renderRPJEntityRef(e,i,h);case V.EB_RECOVERY_PLAN_JOB_TYPE:return C.renderRPJobType(e,i,h);case V.EB_RECOVERY_PLAN_SUMMARY_DURATION:return C.renderRPSummaryDuration(e,i,h);case V.EB_RECOVERY_PLAN_DURATION_MINS:return C.renderRPTaskDuration(e,i,h);case V.EB_RECOVERY_PLAN_FULL_DATE_TIME:return C.renderRPFullDateTime(e,i,h);case V.EB_RECOVERY_PLAN_JOB_EXE_STATUS:return C.renderRPJobExeStatus(e,i,h);case V.EB_RECOVERY_PLAN_JOB_VALIDATE:return C.renderRPJobValidateStatus(e,i,h);case V.EB_RPJ_VALIDATION_TITLE:return C.renderRPJValidationTitle(e,i,h);case V.EB_RECOVERY_PLAN_STATUS:return C.renderRPStatus(e,i,h);case V.EB_RECOVERY_PLAN_ENTITY_COUNT:return C.renderRPEntityCount(e,i,h);case V.EB_RP_VALIDATION_FAILOVER_STATUS:return C.renderLastValidationAndFailoverInfo(e,i,h);case V.EB_RECOVERY_PLAN_TEST_STATUS:return C.renderLastTestInfo(e,i,h);case V.EB_RP_TEST_STATUS_DETAILS_VIEW:return C.renderLastTestInfoInRPDetails(e,i,h);case V.EB_SUMMARY_RP_CLEANUP_STATUS:return C.renderRPCleanupStatusSummary(e,i,h);case V.EB_RECOVERY_PLAN_SOURCE:return C.renderRPSource(e,i,h);case V.EB_RECOVERY_PLAN_DESTINATION:return C.renderRPDestination(e,i,h);case V.EB_RECOVERY_PLAN_POWER_ON_SEQ:return C.renderRPPowerOnSequence(e,i,h);case V.EB_RECOVERY_PLAN_NETWORK_SETTINGS:return C.renderRPNetworkSettings(e,i,h);case V.EB_PROJECT_VCPUS_COUNT_USAGE:return m.renderProjectBar(e.get(t.EB.PROJECT.VCPUS_COUNT),e.get(t.EB.PROJECT.VCPUS_COUNT_LIMIT),e.get(t.EB.PROJECT.VCPUS_COUNT),e.get(t.EB.PROJECT.VCPUS_COUNT_LIMIT),!0);case V.EB_PROJECT_MEMORY_USAGE:return m.renderProjectBar(e.get(t.EB.PROJECT.MEMORY_BYTES),e.get(t.EB.PROJECT.MEMORY_BYTES_LIMIT),o.getAttributeDisplayValue(a.ENTITY_PROJECT,t.EB.PROJECT.MEMORY_BYTES,e.get(t.EB.PROJECT.MEMORY_BYTES)),o.getAttributeDisplayValue(a.ENTITY_PROJECT,t.EB.PROJECT.MEMORY_BYTES_LIMIT,e.get(t.EB.PROJECT.MEMORY_BYTES_LIMIT)),!0);case V.EB_PROJECT_STORAGE_USAGE:return m.renderProjectBar(e.get(t.EB.PROJECT.STORAGE_BYTES),e.get(t.EB.PROJECT.STORAGE_BYTES_LIMIT),o.getAttributeDisplayValue(a.ENTITY_PROJECT,t.EB.PROJECT.STORAGE_BYTES,e.get(t.EB.PROJECT.STORAGE_BYTES)),o.getAttributeDisplayValue(a.ENTITY_PROJECT,t.EB.PROJECT.STORAGE_BYTES_LIMIT,e.get(t.EB.PROJECT.STORAGE_BYTES_LIMIT)),!0);case V.EB_PROJECT_VCPUS_COUNT_USAGE_TEXT:return m.renderProjectBar(e.get(t.EB.PROJECT.VCPUS_COUNT),e.get(t.EB.PROJECT.VCPUS_COUNT_LIMIT),e.get(t.EB.PROJECT.VCPUS_COUNT),e.get(t.EB.PROJECT.VCPUS_COUNT_LIMIT),!1);case V.EB_PROJECT_USERS_COUNT:return m.getUserAndUserGroupCount(e,t.EB.PROJECT.USER_REF_LIST);case V.EB_PROJECT_USER_GROUPS_COUNT:return m.getUserAndUserGroupCount(e,t.EB.PROJECT.USER_GROUP_REF_LIST);case V.EB_PROJECT_MEMORY_USAGE_TEXT:return m.renderProjectBar(e.get(t.EB.PROJECT.MEMORY_BYTES),e.get(t.EB.PROJECT.MEMORY_BYTES_LIMIT),o.getAttributeDisplayValue(a.ENTITY_PROJECT,t.EB.PROJECT.MEMORY_BYTES,e.get(t.EB.PROJECT.MEMORY_BYTES)),o.getAttributeDisplayValue(a.ENTITY_PROJECT,t.EB.PROJECT.MEMORY_BYTES_LIMIT,e.get(t.EB.PROJECT.MEMORY_BYTES_LIMIT)),!1);case V.EB_PROJECT_STORAGE_USAGE_TEXT:return m.renderProjectBar(e.get(t.EB.PROJECT.STORAGE_BYTES),e.get(t.EB.PROJECT.STORAGE_BYTES_LIMIT),o.getAttributeDisplayValue(a.ENTITY_PROJECT,t.EB.PROJECT.STORAGE_BYTES,e.get(t.EB.PROJECT.STORAGE_BYTES)),o.getAttributeDisplayValue(a.ENTITY_PROJECT,t.EB.PROJECT.STORAGE_BYTES_LIMIT,e.get(t.EB.PROJECT.STORAGE_BYTES_LIMIT)),!1);case V.EB_PROJECT_NAME:return m.renderProjectName(e,i);case V.EB_REPORT_DOWNLOAD_LINK:return this.renderReportDownloadLink(e,i);case V.ENTITY_CATEGORIES:return E.renderEntityCategories(e);case V.ENTITY_CATEGORY:return E.renderEntityCategory(e,i);case V.ENTITY_CATEGORY_VALUES:return E.renderCategoryValues(e,i)
;case V.ENTITY_CATEGORY_COUNTS:return E.renderCategoryCounts(e,i);case V.NET_SEC_RULE:return T.renderNetworkSecurityRule(e,i);case V.VM_RECOVERY_POINT_VALUE:return v.renderEntityDetail(e,i);case V.VM_RECOVERY_POINT_TOTAL_COUNT:return v.renderRemoteCount(e,i);case V.VM_RECOVERY_POINT_TIME_USEC:return v.renderTimeUsec(e,i);case V.PR_RECOVERY_POINT_OBJECTIVE:return I.renderRecoveryPointObjective(e,i);case V.PR_SOURCE:return I.renderSourceAZName(e);case V.PR_DESTINATION:return I.renderDestinationAZName(e);case V.PR_LOCAL_RETENTION_POLICY:return I.renderRetentionPolicy(e,i,!0);case V.PR_REMOTE_RETENTION_POLICY:return I.renderRetentionPolicy(e,i);case V.AZ_REGION:return f.renderAZRegion(e,i);case V.AZ_CONNECTION_STATUS:return f.renderAZConnectionStatus(e,i);case V.AZ_NAME:return f.renderZoneName(e,i);case V.APP_BLUEPRINT_TYPE:return this.renderAppBlueprintType(e);case V.NGT_APP_LIST:return this.renderNgtApp(e);case V.INTENT_LAST_STATE:return this.renderIntentLastState(e);case V.INTENT_OPERATION:return this.renderIntentOperationFromVersion(e);case V.INTENT_ENTITY_TYPE:return this.renderIntentEntityType(e);case V.CLUSTER_TYPE:return!0===h?b.t("Common","EntityTypes.external"):b.t("Common","EntityTypes.internal");case V.GPU_LIST:return P.renderGpuSummary(h);case V.GPU_FRAMEBUFFER:return l.statsFormat(t.STATS_GPU_FRAMEBUFFER_BYTES,e.get(i),!0);case V.GPU_VIRTUAL_SLICE:return P.getFractionDisplayStr(e.get(i));case V.SUBNET_RANGE:return S.renderSubnetRange(e);case V.FLOATING_IP_ASSOCIATION:return g.renderFloatingIPAssociation(e);case V.RENDER_CUSTOM_TYPE:return A.renderCustomType(e,i);case V.RENDER_ACTIONS_COLUMN:return A.renderActionsColumn(e,i);case V.RENDER_ROUTING_POLICY_VIZ:return A.renderRoutingPolicyViz(e);case V.RENDER_ROUTING_POLICY_TRAFFIC:return A.renderRoutingPolicyTraffic(e);case V.RENDER_ROUTING_POLICY_PRIORITY:return A.renderRoutingPolicyPriority(e,i);case V.RENDER_PORT_RANGE:return A.renderPortRange(e,i);case V.RENDER_REROUTE_ACTION:return A.renderRerouteAction(e,i);case V.SUBNET_POOL:return S.renderSubnetPool(e);case V.SUBNET_ACTIONS:return S.renderSubnetActions(e);case V.GPU_VMS_ASSIGNED:return P.getGpuAllocationStr(e);case V.NOT_EMPTY:return this.renderNotEmpty(e.get(i));case V.SCHEDULE_PERIODICITY:return this.renderSchedulePeriodicity(e);case V.VIRTUAL_NETWORK_ATTR:return S.renderVirtualNetworkAttr(e,i);case V.SUBNET_ATTR:return S.renderSubnetAttr(e,i);case V.VM_DESCRIPTION:if(e.entityType===a.ENTITY_VM){return e.get(i)||e.get(t.VM_ANNOTATION)}return h;case V.I18N_VALUE:var Z=e.entityType+"_"+e.get(i);return b.t("Common","EntityValues."+Z);default:return h}},isSparkLine:function(){return this.get(ae.FORMATTER)===V.SPARK_LINE},isAlertCategoryStats:function(){return this.get(ae.FORMATTER)===V.ALERT_IMPACT_STATS},getSparkLineMetric:function(){return this.get(ae.NAME).replace("stats.","")},showSparkLineLoader:function(){return!_.isBoolean(this._showLoader)||this._showLoader},setShowSparkLineLoader:function(e){this._showLoader=e},renderStorageBar:function(e){var t=this.getTotalCapacity(e),i=this.getUsedPhysical(e);return t>=0&&i>=0?u.renderStorageBar(i,t,!0):a.DATA_NOT_AVAILABLE},renderTooltip:function(e){return X({Components:M,tooltipMsg:e})},getUsedPhysical:function(e){return o.hasArithmosStats()?l.getUsageStats(e,t.NEW_TOT_USED_PHY):l.getUsageStats(e,t.TOT_USED_PHY)},getTotalCapacity:function(e){return o.hasArithmosStats()?l.getUsageStats(e,t.NEW_TOT_CAPACITY):l.getUsageStats(e,t.TOT_CAPACITY)},renderNotEmpty:function(e){return _.isEmpty(e)?b.t("Common","no"):b.t("Common","yes")},renderAppBlueprintType:function(e){var t=e.get(a.SSP_EB_CONSTANTS.RENDERED_FROM);if(t)return t=t.toLowerCase().replace("_reference",""),s.toUpperCaseFirstChar(t)},renderNgtApp:function(e){var t=e.get(a.NGT_ENABLED_APPS);if(t){if(t.length>1)return b.t("Common","ngtApps.vss_and_ssr");if(t[0]===a.NGT_EB_CONSTANTS.SSR)return b.t("Common","ngtApps.ssr");if(t[0]===a.NGT_EB_CONSTANTS.VSS)return b.t("Common","ngtApps.vss")}},renderAlertCount:function(e){return _.isUndefined(e.get(t.ALERT_CRITICAL_COUNT))?'<div class="donut-loader-blue"></div>':r.getAlertSeverityCount(e.get(t.ALERT_CRITICAL_COUNT),e.get(t.ALERT_WARNING_COUNT),e.get(t.EB.ENTITY_ID),e.get(t.EB.ENTITY_TYPE))},renderPlayCountHeader:function(e,t){return'<div class="play-count-header">\n            '+this.renderPlayCount(e,t)+'\n            <div class="header-text">\n              '+b.t("PlaybookRenderers","plays_completed")+'\n            </div>\n            <div class="header-text">\n              '+b.t("PlaybookRenderers","last_24_hrs")+"\n            </div>\n          </div>"},renderPlayCount:function(e,t){var i=e.get(t)||{};return se({attr:t,count:i.count||0,filter:JSON.stringify(i.expr)})},renderAnomalyCount:function(e){var i=e.get(t.EB.ENTITY_TYPE),n=e.get(t.EB.ENTITY_ID),s=e.get(t.EVENT_ANOMALY_COUNT);return _.isUndefined(s)?'<div class="donut-loader-blue"></div>':r.getAnomalyCountLink(s,n,i)},renderClusterDetailsLink:function(e,i){var n=e.getValue(t.CLUSTER_NAME_DP),r=L.getEntityTypeViewPrivileges([a.ENTITY_CLUSTER]),o=s.generateEntityDetailsLink({entityId:e.getValue(t.EB.CLUSTER_UUID),entityType:a.ENTITY_CLUSTER,entityName:n,clusterManager:w,exportOnly:i,isMulticluster:w.isMulticlusterUI(),hasViewPrivileges:r});return _.isObject(o)&&(o.addClass("persisted-link"),o=$(o).prop("outerHTML")),o},renderAttributeDetailsLink:function(e,t,i,n,r){if(n){var o;return s.renderAffectedEntitiesLink(w,L.getEntityTypeViewPrivileges([t]),e,[(o={},_defineProperty(o,U.ENTITY_NAME,i),_defineProperty(o,"uuid",n),_defineProperty(o,U.ENTITY_TYPE,t),o)],U.ENTITY_TYPE,U.ENTITY_NAME,"details-link",r)}return i||a.DATA_NOT_AVAILABLE},renderHostDetailsLink:function(e,i){var n=e.get(t.EB.VM.NODE),s=e.get(t.EB.VM.NODE_NAME),r=a.ENTITY_HOST;return this.renderAttributeDetailsLink(e,r,s,n,i)},renderHostCvmIp:function(e,i){return e.get(t.HOST_TYPE)===a.HOST_TYPES_EB.COMPUTE_ONLY?a.STATS_NOT_APPLICABLE:i},renderSourceEntityDetails:function(e,i){var n,r=e.get(t.ALERT_SOURCE_ENTITY_ID),o=e.get(t.ALERT_SOURCE_ENTITY_NAME),l=e.get(t.ALERT_SOURCE_ENTITY_TYPE);return l===a.ENTITY_NODE&&(l=a.ENTITY_HOST),s.renderAffectedEntitiesLink(w,L.getEntityTypeViewPrivileges([l]),e,[(n={},_defineProperty(n,U.ENTITY_NAME,o),_defineProperty(n,"uuid",r),_defineProperty(n,U.ENTITY_TYPE,l),n)],U.ENTITY_TYPE,U.ENTITY_NAME,"persisted-link",i)},renderTargetEntityDetails:function(e,i){var n=e.get(t.ALERT_TARGET_ENTITY_ID),s=e.get(t.ALERT_TARGET_ENTITY_NAME),r=e.get(t.ALERT_TARGET_ENTITY_TYPE);return r===a.ENTITY_NODE&&(r=a.ENTITY_HOST),this.renderAttributeDetailsLink(e,r,s,n,i)},renderAffectedEntitiesDetails:function(e,i){var n=this,r=e.get(t.ALERT_AFFECTED_ENTITY_UUID_LIST),o=e.get(t.ALERT_AFFECTED_ENTITY_NAME_LIST),l=e.get(t.ALERT_AFFECTED_ENTITY_TYPE_LIST),c="";return _.each(o,function(t,o){var u=l[o]===a.ENTITY_NODE?a.ENTITY_HOST:l[o],d=a.ENTITY_NAMES[u]||s.toTitleCase(u),h=n.renderAttributeDetailsLink(e,l[o],t,r[o],i);h&&(c+=d+" : "+h+"<br />")}),c||a.DATA_NOT_AVAILABLE},renderTriggerEntityDetails:function(e,i){var n=s.parseJSON(e.get(t.TRIGGER_OUTPUT_PARAM)),r=_.first(e.get(t.TRIGGER_ENTITY_NAME_LIST));if(!i&&n&&n.type===a.ENTITY_ALERT){return r+" : "+this.renderAttributeDetailsLink(e,n.type,n.name,n.uuid,i)}return r},renderRelatedEntityDetails:function(e,i){var n=void 0,r=e.get(U.AFFECTED_ENTITIES);return r&&r.length?(n=_.map(r,function(e){var i=e[t.ENTITY_TYPE];return i===a.ENTITY_NODE&&(i=a.ENTITY_HOST),i}),s.renderAffectedEntitiesLink(w,L.getEntityTypeViewPrivileges(n),e,r,U.ENTITY_TYPE,U.ENTITY_NAME,"persisted-link",i)):(n=e.get(U.ENTITY_TYPES),n?(_.isArray(n)||(n=[n]),s.renderEntityDetailsLink(w,L.getEntityTypeViewPrivileges(n),e,U.ENTITY_TYPES,U.ENTITY_UUIDS,"persisted-link",n.length,i)):a.INVALID_STRING)},renderPlaybookStatus:function(e){if(e.get(t.OOB_PLAYBOOK)===a.BOOLEAN_TRUE)return a.DATA_NOT_AVAILABLE;if(e.get(t.PLAYBOOK_VALID)===a.BOOLEAN_FALSE)return b.t("PlaybookRenderers","validation_errors");var i=e.get(t.PLAYBOOK_ENABLED)===a.BOOLEAN_TRUE;return b.t("PlaybookRenderers",i?"enabled":"disabled")},renderContainerCpuShares:function(e){var t,i=e.getValue(a.CONTAINER_HOST_BINDING);try{t=JSON.parse(i)}catch(e){s.log("renderContainerCpuShares: Error parsing value")}return t&&t.cpu_shares?t.cpu_shares:a.INVALID_STRING},renderContainerMemoryMb:function(e){var t,i=e.getValue(a.CONTAINER_HOST_BINDING);try{t=JSON.parse(i)}catch(e){s.log("renderContainerMemoryMb: Error parsing value")}return t&&t.memory_mb?t.memory_mb+" MB":a.INVALID_STRING},renderContainerPortMapping:function(e,t){var i=e.getValue(a.CONTAINER_HOST_BINDING),n=[];return _.isEmpty(i)||(i=_.map(i,JSON.parse),_.each(i,function(e){_.each(e,function(e,t){_.each(e,function(e){n.push(Z({containerPort:t,hostIp:e.hostip,hostPort:e.hostport}))})})})),n.length>0?te({tooltip:n.join("\n"),value:n.join(t?"<br />":", ")}):a.INVALID_STRING},renderContainerHostIp:function(e){var t=e.getValue(a.CONTAINER_HOST_BINDING),i=[];return _.each(t,function(e){var t=JSON.parse(e);_.each(t,function(e){_.each(e,function(e){i.push(e.hostip)})})}),i=_.uniq(i),i.length>0?te({tooltip:i.join("\n"),value:i.join("<br/>")}):a.INVALID_STRING},renderWithTooltip:function(e,t){var i=t.getValue(e);return i?ee({value:i}):a.INVALID_STRING},renderClusterEfficiencyLink:function(e){var i=(this.get(ae.NAME),e.getValue(t.CLUSTER_ANALYSIS));if(!i||!i[t.CLUSTER_VM_EFFICIENCY_MAP])return a.DATA_NOT_AVAILABLE;var n=i[t.CLUSTER_VM_EFFICIENCY_MAP][t.VM_EFFICIENCY.CLUSTER.INEFFICIENT_VM];return _.isUndefined(n)?a.DATA_NOT_AVAILABLE:B({count:n,entityName:e.getValue(t.NAME)})},renderAlertPolicyLink:function(e){var t=void 0,i=e.get(e.DP.USER_DEFINED),n=void 0,s=void 0,o=r.getAlertTypeMetadata(e.get(e.DP.ALERT_TYPE_UUID));return o?(t=o.title||o.name,i?(n=o.policyUuid,s=a.ENTITY_USER_DEFINED_ALERT_POLICY):(n=o.id,s=a.ENTITY_ALERT_POLICY)):t=a.UNKNOWN_VALUE,n&&L.canViewByEntityType(s)?x({action:a.ACTION_SHOW,actionTargetId:n,actionTarget:s,actionTargetName:null,targetTabId:null,displayValue:t,classes:"attributeDetailsLink"}):t},getAlertIssue:function(e,t){return r.getAlertDisplayName(t)},getAlertImpactTypes:function(e,t){var i=t.get(U.ALERT_IMPACT_TYPES),n=function(e){return"string"==typeof e?a.ALERT_IMPACT_TYPES[e]?a.ALERT_IMPACT_TYPES[e][0]:"":e?(e=_.filter(e,function(e){return a.ALERT_IMPACT_TYPES[e]}),_.map(e,function(e){return a.ALERT_IMPACT_TYPES[e][0]}).join(",")):""};return n(i)||n(t.get(U.ALERT_CATEGORIES))},getEventClassification:function(e,t){var i=[],n=t.get(e)||t.get(U.EVENT_CLASSIFICATIONS);return n?_.isString(n)?a.EVENT_CLASSIFICATIONS[n]||n:(_.each(n,function(e){i.push(a.EVENT_CLASSIFICATIONS[e]||e)}),i.join(", ")):a.DATA_NOT_AVAILABLE},getAlertStatsInfoByCategory:function(e){var t={};return _.each(a.ALERT_IMPACT_TYPES,function(i,n){var s=e&&e[n].total?this.getHighestAlertSeverity(e[n]):"empty";t[n]={className:s,total:e?e[n].total:0}},this),t},getHighestAlertSeverity:function(e){var t=a.ALERT_SEVERITY_NAMES.kCritical;return _.some(a.ALERT_SEVERITY_HIERARCHY,function(i,n){var r=a.ALERT_SEVERITY_NAMES[n];if(e[r]>0||e[s.toUpperCaseFirstChar(r)]>0)return t=r,!0}),t},getHealthIcon:function(e){var t=e||a.UNKNOWN_VALUE;return d.HEALTH_ICON_TEMPLATE({status:t,statusStyle:"n-health-status-"+t.toLowerCase()})},renderUsageStats:function(e,i){var n=i.get(t.USAGE_STATS)||{};if(e===t.TOTAL_SAVINGS_RATIO||e===t.COMPRESSION_SAVINGS_RATIO||e===t.ERASURE_SAVINGS_RATIO||e===t.DEDUP_SAVINGS_RATIO){var s=parseInt(n[t.TOTAL_SAVED_BYTES],10);return!isNaN(s)&&s>0?l.formatStatsRatio(n[e]):a.DATA_NOT_AVAILABLE}return n[e]},renderCommaSeparated:function(e,t,i){var n=t.get(e)||a.DATA_NOT_AVAILABLE,s=i&&_.isArray(n)?_.unique(n):n;if(s&&_.isArray(s)){if(s.length>1){var r=s.join(" , ");return"<span title='"+r+"'>"+r+"</span>"}return s[0]}return s},renderRemoteAccessLinks:function(e,i){var n=i&&i.get(t.EB.VM.POWER_STATE),s=i&&i.get(e);return s&&n===a.VM_POWER_STATE.ON?(s=_.isArray(s)?s[0]:s,F({ssh:d.NEW_TAB_LINK({destUrl:"ssh://"+s,content:b.t("Common","ssh")}),rdp:d.NEW_TAB_LINK({destUrl:"rdp://"+s,content:b.t("Common","rdp")})})):a.DATA_NOT_AVAILABLE},renderVMProtectionRule:function(e,t){var i=e.get(t),n=void 0,s=void 0;try{s=JSON.parse(i),n=s.rule_reference.name}catch(e){n=""}return n},renderVMVnicIpAddresses:function(e,i){var n=e.get(i)||[],s=e.get(t.EB.VIRTUAL_NIC.ASSIGNED_IPV4_ADDRESSES)||[];return _.union(n,s)},renderLineBreaks:function(e,t){var i=t.get(e);return i?_.isArray(i)?i.join("<br/>"):i:a.INVALID_STRING},renderVMMemoryUsage:function(e,i){var n=i.get(t.EB.VM.HYPERVISOR_TYPE),s=i.get(t.EB.VM.CLUSTER_UUID),r=i.get(e)||null;if(!l.isVMMemoryMetricSupported(e,s,n))return a.STATS_NOT_APPLICABLE;if(r){var o=l.ppmFormat(r);return"<span title='"+o+"'>"+o+"</span>"}return a.DATA_NOT_AVAILABLE},renderUsername:function(e,t){return t.get(e)||t.get(V.USERNAME)},renderUsergroups:function(e,i){var n=i.get(e);return _.isArray(n)&&n.length?this.renderHalfList(_.pluck(n,t.EB.USER_GROUP.GROUP_NAME),2,"<br>"):"-"},renderHalfList:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:", ",n=e.slice(0,t),s=e.slice(t).join(i);return""!==s&&n.push("..."),ne({listToShow:n.join(", "),listForTooltip:s})},renderVmProfileStorage:function(e,t){var i=t.get(e);return l.storageFormat(l.convertToBytes(i),!0)},renderCompressionType:function(e,t){return t.get(e)?b.t("Common","powerStates.on"):b.t("Common","powerStates.off")},renderVMEfficiency:function(e,i){if(r.getXfitFeatureInfo().disabled)return a.DATA_NOT_AVAILABLE;var n=i.get(e),o=void 0,l=[];t.VM_EFFICIENCY.OVERPROVISIONED_VM,t.VM_EFFICIENCY.CONSTRAINED_VM,t.VM_EFFICIENCY.INACTIVE_VM,t.VM_EFFICIENCY.BULLY_VM;try{o=JSON.parse(n)}catch(e){return s.log("renderVMEfficiency: Error parsing value"),a.DATA_NOT_AVAILABLE}return o?(_.each(o,function(e,i){var n=O.i18nStatic("VMEfficiencyVantagePointView",i);switch(i){case t.VM_EFFICIENCY.OVERPROVISIONED_VM:case t.VM_EFFICIENCY.CONSTRAINED_VM:case t.VM_EFFICIENCY.BULLY_VM:var s=this.parseEfficiencyReason(e);s&&l.push(O.i18nsStatic("VMEfficiencyVantagePointView","reason",n,s));break;case t.VM_EFFICIENCY.INACTIVE_VM:l.push(O.i18nsStatic("VMEfficiencyVantagePointView","reason",n,e))}},this),l.join(", ")):a.DATA_NOT_AVAILABLE},renderVMEfficiencyLevel:function(e,t){var i=r.getXfitFeatureInfo(),n=t.get(e);return i.disabled||!n?a.DATA_NOT_AVAILABLE:_.isArray(n)?n.join(", "):n},renderVMEfficiencyLink:function(e,i){if(r.getXfitFeatureInfo().disabled)return a.DATA_NOT_AVAILABLE;var n=void 0;if(i.get("capacity.vm_efficiency_detail"))try{n=JSON.parse(i.get("capacity.vm_efficiency_detail"))}catch(e){return void s.log("Error parsing capacity.vm_efficiency_detail")}var o=void 0;switch(e){case t.VM_EFFICIENCY.STATUS.OVERPROVISIONED:o=t.VM_EFFICIENCY.OVERPROVISIONED_VM;break;case t.VM_EFFICIENCY.STATUS.BULLY:o=t.VM_EFFICIENCY.BULLY_VM;break;case t.VM_EFFICIENCY.STATUS.CONSTRAINED:o=t.VM_EFFICIENCY.CONSTRAINED_VM}if(n&&n[o]){var l=[];return _.each(n[o],function(e,n){var r=void 0;r="cpu"===n?"CPU":"io"===n?"IO":s.toUpperCaseFirstChar(n);var o=s.createFullPageDetailsLink(r,i.get(t.EB.ENTITY_TYPE)||i.entityType,i.get(t.EB.ENTITY_ID),a.TAB_DETAILS.PERFORMANCE,_.first(_.keys(e)));l.push(o[0].outerHTML)}),l.join(", ")}},parseEfficiencyReason:function(e){var t=[];return _.each(e,function(e){var i=_.keys(e);i.length&&t.push(e[_.first(i)])}),t.join(",")},tagClusterVersion:function(e,i){var n=i.get(e);return i.get(t.IS_LTS)&&(n=[i.get(e),b.t("Common","long_term_support")].join(" ")),n},renderClusterStateIcon:function(e,i){var n=i.get(e);if(e===t.CLUSTER_NOS_VERSION&&(n=this.tagClusterVersion(e,i)),!D.isXi(i)){var s=i.get(t.EB.CLUSTER_UUID);i.entityType===a.ENTITY_CLUSTER&&(s=i.getId());var r=this.renderClusterAvailableIcon(s),o=this.renderAttributeDetailsLink(i,a.ENTITY_CLUSTER,n,s,!1);return r?r+" "+o:o}return a.DATA_NOT_AVAILABLE},renderClusterAvailableIcon:function(e){this.clusterManager||(this.clusterManager=require("managers/ClusterManager"));var i=this.clusterManager.getClusterModelByClusterUuid(e);if(this.clusterManager.isMulticlusterUI()&&i){var n=this.clusterManager.getPrismCentralVersion(),a=i.get(t.CLUSTER_NOS_VERSION);if(i.isNOSIncompatibleWithPC(n))return d.WARNING_ICON_TEMPLATE({SVG:c,reason:"This cluster is not compatible with the current version of Prism Central. Please un-register or upgrade to resolve the issue."});if(!i.isAvailable())return d.WARNING_ICON_TEMPLATE({SVG:c,reason:"This cluster is not reachable."});if(s.compareVersions(a,n,3)>1)return d.WARNING_ICON_TEMPLATE({SVG:c,reason:"This software combination may result in inconsistencies in the UI. Please upgrade Prism Central to version "+a+" or later."})}return null},renderAlertStatus:function(e,i){var n="true"===i.get(e),s="true"===i.get(U.AUTO_RESOLVED),a=void 0,o=void 0,l=void 0;return e===t.ALERT_ACKNOWLEDGED?(a=i.get(t.ALERT_ACKNOWLEDGING_USER)||i.get(U.ACKNOWLEDGED_BY),o=i.get(t.ALERT_ACKNOWLEDGED_TIME_USECS)||i.get(U.ACKNOWLEDGED_TIMESTAMP),l=n&&s&&!a):(a=i.get(t.ALERT_RESOLVING_USER)||i.get(U.RESOLVED_BY),o=i.get(t.ALERT_RESOLVED_TIME_USECS)||i.get(U.RESOLVED_TIMESTAMP),l=s),r.formatByUserAndTimestamp(n,a,o,l)},renderIntentLastState:function(e){var i=e.get(t.INTENT_TASK.STATE);if(i){var n="",r=e.get(t.INTENT_TASK.MESSAGE);r&&(n=J({message:r,Components:M}));var o=!s.isIntentStateComplete(e.entityType,i),l=u.renderProgressBar({percentUsed:e.get(t.INTENT_TASK.PERCENT_COMPLETE),rightTextLabel:b.t("IntentCommon","state."+i,i)+n,widgetClass:"table-format",barClass:h.getIntentStateStyle(i),showBar:o});return q({progressBar:l})}return a.DATA_NOT_AVAILABLE},renderIntentOperationFromVersion:function(e){var i=e.get(t.INTENT_KIND),n=e.get(t.TASK_OPERATION_TYPE);if(i===a.ENTITY_RECOVERY_PLAN_JOB){var r=a.RECOVERY_PLAN.JOB_TYPES,o=[r.VALIDATE,r.MIGRATE,r.FAILOVER,r.FAILBACK,r.TEST_FAILOVER,r.TEST_FAILBACK];if(n)return b.t("Common","recovery_plan_job_types."+o[n])}var l=e.get(t.INTENT_SPEC_ATTR.VERSION),c=e.get(t.INTENT_STATE),u=s.getActionForIntentSpecEntity(l,c);return s.toUpperCaseFirstChar(u)},renderIntentEntityType:function(e){var i=e.get(t.INTENT_KIND);return b.t("AppUtil","entityNames."+i)},renderSchedulePeriodicity:function(e){if(e.entityType===a.ENTITY_REPORT_CONFIG){var i=parseInt(e.get(t.EB.REPORT_CONFIG.SCHEDULE_MULTIPLE),10),n=parseInt(e.get(t.EB.REPORT_CONFIG.SCHEDULE_PERIODICITY),10);return p.formatPeriodicity(i,n)}return a.DATA_NOT_AVAILABLE},renderReportDownloadLink:function(e){var t=i.getV3DataSourceURL(),s=n.REPORT_INSTANCE.DOWNLOAD({uuid:e.uuid});return d.NEW_TAB_LINK({destUrl:""+t+s,content:b.t("PCReport","ReportInstancesContainer.download")})},renderVMRecoveryPlans:function(e,t){var i=s.getVMRecoveryPlans(e.get(t));return Array.isArray(i)?i.map(function(e){return e.name}).join(", "):"-"}},{DP:ae});return{FORMATTER:V,HELPER_DP:U,getRenderer:function(e){return new re(e)},renderBreadCrumb:function(e){return W({dataId:e})},renderTaskHeader:function(e,t){var i=t.$(".n-vantage-point-title"),n=z({svgIcon:c.SVGIcon("Task","view-tasks"),tooltip:"View all tasks"})+' <a id="allTaskLink">'+b.t("TableVantagePointView","view_all_tasks","View All Task(s)")+"</a>";t.$(".n-vantage-point-table thead").addClass("task-header hide");var s=t.$(".task-header tr .right").html(),a=Q({tasks:n,details:s});t.$(".n-content.n-content-table").removeClass("hide"),t.$(".n-healthy-entity-content").removeClass("show"),i.html(a).removeClass("hide").addClass("task-title-container")}}}),define("text!templates/basecomponents/vantagepoints/elements/TableVantagePointView.html",[],function(){return'<div class="n-title">\n  <span class="lblTitle title" title="<%- title %>">\n    <%- title %>\n  </span>\n</div>\n<div class="n-content n-content-table">\n  <div class="n-vantage-point-bread-crumbs"></div>\n  <div class="n-vantage-point-title hide"></div>\n  \x3c!-- Antiscroll --\x3e\n  <div class="antiscroll-wrap">\n    <div class="box-wrap">\n      <div class="antiscroll-inner">\n        <div class="box-inner  n-content-inner">\n          <table class="n-vantage-point-table">\n            <thead>\n            \x3c!-- Place header here --\x3e\n            </thead>\n            <tbody>\n            </tbody>\n            \x3c!-- Place content here --\x3e\n          </table>\n        </div>\n      </div>\n    </div>\n  </div>\n</div>\n<div class="n-content n-healthy-entity-content">\n  <div class="no-alert"><%= i18n(\'no_alerts\') %></div>\n</div>\n'}),define("views/basecomponents/vantagepoints/elements/TableVantagePointView",["views/basecomponents/vantagepoints/elements/BaseVantagePointView","views/basecomponents/charts/ChartTemplates","models/stats/StatsModel","models/capacityplanning/CPStatsModel","models/alert/ImpactedClusterModel","data/DataProperties","utils/ManagerMixin","managers/NavigationManager","events/AppEvents","utils/AppConstants","utils/AppUtil","utils/AlertUtil","utils/AntiscrollUtil","utils/DataRendererUtil","utils/FilterUtil","utils/D3Util","utils/StatsUtil","utils/StyleDescriptor","utils/SVG","text!templates/basecomponents/vantagepoints/elements/TableVantagePointView.html"],function(e,t,i,n,s,a,r,o,l,c,u,d,h,p,T,E,S,g,A,m){"use strict";var f=_.template(m),I=_.template('<th<% if (sClass) { %> class="<%= sClass %>"<% } %><% if (width) { %> width="<%= width %>"<% } %>title="<%= title %>"><%= title %></th>'),C=_.template('<tr data-id="<%= id %>"><% _.each(cells, function (cell) { %><td<% if (cell.sClass) { %> class="<%= cell.sClass %>"<% } %><% if (cell.width) { %> width="<%= cell.width %>"<% } %>><%= cell.value %></td><% }) %></tr>'),v={ALERT_STATS:"alertCount",PLAY_COUNT:"playCountDetails",NAME:"name"},R=_.template('<div title="<%= title %>"\n        <% if (showDetails) { %>\n          action="<%= action %>" actionTarget="<%= actionTarget %>"\n          actionTargetId="<%= actionTargetId %>" class="n-link-action"\n        <% } %>\n        ><%= title %>\n        </div>\n        <div class="alert-count-link"></div>'),N=_.template('<tr><td colspan="2" class="no-entities"><%= msg %></td></tr>'),P=["inefficient_vms","capacity.runway","anomalyCount"],O=["playCountDetails"],y={SORTING_VALUE_ATTR_NAME:"data-value"},D=[c.VP_TABLE_TYPE.MC_LATENCY,c.VP_TABLE_TYPE.MC_CPU_USAGE,c.VP_TABLE_TYPE.MC_IOPS,c.VP_TABLE_TYPE.MC_MEMORY_USAGE];return e.extend({vantagePointCSS:"n-vantage-point-table-content",name:"TableVantagePointView",schemaModel:null,displayAttributes:null,vantagePointDetailsModel:null,statsModelMap:null,singleClusterStatsView:!1,initialize:function(){e.prototype.initialize.apply(this,arguments),this.addExtraEvents({"click .alert-link":"onAlertSeverityClick","click .event-link":"onEventLinkClick","click .view-tasks":"onViewAllTasks","click #allTaskLink":"onViewAllTasks","click .n-click-rpj-task":"onclickRPTasks"}),this.statsModelMap={}},_delegateModelEvents:function(){var t=this;e.prototype._delegateModelEvents.apply(this,arguments);var i=this.getAspectsValue(c.VP_ASPECT_TYPE);i!==c.VP_TABLE_TYPE.MC_RUNWAY&&i!==c.VP_TABLE_TYPE.MC_CLUSTER_STATS||l.onAppEvent(l.SERVICE_AVAILABLE,function(e,i){i.name!==c.SERVICES.XFIT||i.enabled||t.renderVantagePoint()})},updateTemplate:function(){this.setQaDataTestListPrefix(this.model.toJSON().name);var e=this.model.toJSON(),t=e.name,i=this.i18n(t,t);this.template=f(this.vtOptions({model:e,title:i,SVG:A,customizable:this.isCustomizable}))},updateDataModels:function(){var e=this.getAspectsValue(c.VP_ASPECT_TYPE),t=this.getAspectsValue(c.VP_ASPECT_ENTITY),i=d.getXfitFeatureInfo();if(e!==c.VP_TABLE_TYPE.MC_RUNWAY||!i.disabled){e===c.VP_TABLE_TYPE.MC_CLUSTER_STATS&&this.getAspectsValue(c.VP_ASPECT_ENTITY_ID)&&(this.singleClusterStatsView=!0),this.vantagePointDetailsModel=r.getEntityManager().getEntityVantagePointTableModel(e);var n;if(this.vantagePointDetailsModel)if(this.vantagePointDetailsModel.getDataURL())if(n=this.getSharedCollectionByURL(this.vantagePointDetailsModel.getDataURL()))this.sharedCollection=!0;else{var s={};if(this.singleClusterStatsView){d.setClusterFilter(s,this.getAspectsValue(c.VP_ASPECT_ENTITY_ID),null,null,!0)}var a={entityType:t,filter_expression:s,queryType:this.vantagePointDetailsModel.get(this.vantagePointDetailsModel.DP.QUERY_TYPE)},o=this.vantagePointDetailsModel.getMemberAttributes();o&&o.length&&(a.group_member_attributes=o),n=r.getEntityManager().createGenericEntityPollingCollection(t,null,this.vantagePointDetailsModel.getDataURL(),a)}else n=this.getSharedCollectionByType(t),n?this.sharedCollection=!0:n=r.getEntityManager().createGenericEntityPollingCollection(t);if(n){var l=c.LONG_POLLING_INTERVAL;e===c.VP_TABLE_TYPE.MC_TASKS&&(l=c.TASK_POLLING_INTERVAL),this.registerDataModel(n,this,this.renderSuccess,this.renderError,l)}}},renderModel:function(e){this.model=e||this.model,this.renderModelContent()},renderSuccess:function(e){this.renderTableCells(e)},renderVantagePoint:function(){var e=this.getAspectsValue(c.VP_ASPECT_ENTITY),t=this.getAspectsValue(c.VP_ASPECT_TYPE),i=d.getXfitFeatureInfo();if(t===c.VP_TABLE_TYPE.MC_RUNWAY&&i.disabled)return void(i.licenseDisabled?this.renderOnlySupportedInPrismPro():i.featureDisabled&&this.renderUnsupportedMessage(i.message));this._getDisplayAttributes()?(this.schemaModel=r.getEntityManager().getEntitySchema(e),this.renderTableHeaders(),this._showAllRows()&&(this.$(".n-vantage-point-bread-crumbs").hide(),this.$(".n-healthy-entity-content").hide())):this.$(".n-vantage-point-table").hide(),h.applyAntiScroll(this.$(".antiscroll-wrap"))},onClickAction:function(t){if(this.isInPreviewMode())return void t.stopPropagation();var i=$(t.currentTarget),n=d.getXfitFeatureInfo(),s=r.getLicenseManager(),o=s.getFeatInfo(s.FEAT_MAP.VULCAN);if(!n.disabled&&!o.denied||!i.parents(".disable-no-license").length){var l=i.attr(c.NAV_ACTION),u=i.hasClass("n-bread-crumb"),h=i.hasClass("ebLink"),p=i.hasClass("n-more-bread-crumb");if(u){var E=i.attr("data-id"),S=this._findDataModel(E);this.renderIndividualDetails(E,S)}else if(p){var g=i.attr(c.NAV_PAGE_ID),A=i.attr(c.NAV_ACTION_TARGET),m=r.getNavigationManager().createNavigationContext(A,{entity_type:A}),f={contextId:m};r.getNavigationManager().navigateToPage(g,c.SUBPAGE_ENTITIES,f)}else if(l===c.ACTION_DETAILS)r.getNavigationManager().navigateToFullScreenDetailsPane(i.attr(c.NAV_ACTION_TARGET),i.attr(c.NAV_ACTION_TARGET_ID),null,i.attr(c.NAV_TARGET_TAB_ID));else if(i.hasClass("cluster-efficiency")){var I={},C=i.data(c.NAV_EB_ENITY);I=T.addFilterCondition(I,i.data(c.NAV_EB_FILTER_NAME),T.createFilterCondition(C,i.data(c.NAV_EB_FILTER_NAME),c.FILTER_OPERATORS.CONTAINS,i.data(c.NAV_EB_FILTER_VALUE)));var v=["Over Provisioned",a.VM_EFFICIENCY.STATUS.INACTIVE,a.VM_EFFICIENCY.STATUS.CONSTRAINED,a.VM_EFFICIENCY.STATUS.BULLY];_.each(v,function(e){I=T.addFilterCondition(I,a.VM_EFFICIENCY.EFFICIENCY_STATUS,T.createFilterCondition(C,a.VM_EFFICIENCY.EFFICIENCY_STATUS,c.FILTER_OPERATORS.CONTAINS,e))}),r.getNavigationManager().navigateToEBPage(C,i.data(c.NAV_EB_PERSPECTIVE),null,null,I)}else h?r.getNavigationManager().navigateToEBPage(i.data(c.NAV_EB_ENITY),i.data(c.NAV_EB_PERSPECTIVE),i.data(c.NAV_EB_FILTER_NAME),i.data(c.NAV_EB_FILTER_VALUE),i.data(c.NAV_EB_FILTER_EXPR)):e.prototype.onClickAction.apply(this,arguments)}},renderEmptyContent:function(){var t=this.getAspectsValue(c.VP_ASPECT_TYPE);if(t===c.VP_TABLE_TYPE.MC_CLUSTER_SIMPLE_STATS||t===c.VP_TABLE_TYPE.MC_CLUSTER_STATS)this.$(".n-content-table").hide(),this.$(".n-healthy-entity-content").show();else if(t!==c.VP_TABLE_TYPE.MC_TASKS||r.getTaskManager().getGlobalTasks().isTaskLoading())e.prototype.renderEmptyContent.apply(this,arguments);else{var i=this.$(".n-vantage-point-table > tbody");i.html(N({msg:r.getTaskManager().getNoTaskActivityMessage(!0)}))}},renderTableHeaders:function(){var e=this.$(".n-vantage-point-table > thead");if(e.empty(),this._showHeader()){var t="<tr>";_.each(this._getDisplayAttributes(),function(e){var i=e.displayName;if(!i)if(this.schemaModel){var n=this.schemaModel.getAttributeInfo(e.name);i=n?n.displayName:u.toUpperCaseFirstChar(e.name)}else i=e.name;t+=I({title:this.i18n(i,i),sClass:e.sClass,width:e.width})},this),t+="</tr>",e.append(t)}},updateHeader:function(e){this.getAspectsValue(c.VP_ASPECT_TYPE)===c.VP_TABLE_TYPE.MC_TASKS&&p.renderTaskHeader(e.getMetaDataGrandTotalCount(),this)},getSortByInfo:function(){var e=this.getAspectsValue(c.VP_ASPECT_TYPE),t=this.vantagePointDetailsModel.getSortByInfo();if(t&&D.indexOf(e)>=0){/^stats\./.test(t.sortBy)&&(t.sortBySchema=t.sortBy.slice("stats.".length))}return t},renderTableCells:function(e){this.$(".tooltip-wrapper").tooltip("destroy");var t,i=this.getAspectsValue(c.VP_ASPECT_TYPE);if(i===c.VP_TABLE_TYPE.MC_TASKS){if(r.getTaskManager().getGlobalTasks().isTaskLoading())return;t=r.getTaskManager().getQuickViewTasks()}else t=e.models;if(!this.singleClusterStatsView||t&&t.length)_.each(t,function(e){this.toCustomModel(e)},this);else{var n=r.getClusterManager().getClusterModelByClusterUuid(this.getAspectsValue(c.VP_ASPECT_ENTITY_ID));n&&(t=[n])}var s=this.getSortByInfo();if(s){var o=null;this.schemaModel&&(o=s.sortBySchema?this.schemaModel.getAttributeInfo(s.sortBySchema):this.schemaModel.getAttributeInfo(s.sortBy));var l;l="alertStats.total"===s.sortBy||"runway"===s.sortBy||!(!this.schemaModel||!o)&&o[this.schemaModel.DP.ATTR_TYPE]===this.schemaModel.TYPES.INT,t=i===c.VP_TABLE_TYPE.MC_RUNWAY?t.sort(function(e,t){var i=e.get(a.CP.RUNWAY),n=t.get(a.CP.RUNWAY);return u.sortRunwayNumbers(i,n)}):_.sortBy(t,function(e){var t=e.getValue(s.sortBy);return l&&!isNaN(t)?parseFloat(t):t},this),s.sortOrder===c.SORT_DESC&&(t=t.reverse())}var d=this.$(".n-vantage-point-table > tbody"),h=this._reuseCells();if(t.length!==d.find("tr").length&&(h=!1),h||d.empty(),this._showHeader()&&this.updateHeader(e),this._showAllRows())if(t.length){var T=[],E=!1,S=[];_.each(t,function(e,t){var n=[];if(_.each(this._getDisplayAttributes(),function(t){var i=p.getRenderer(t);i.isSparkLine()&&T.push(i.getSparkLineMetric());var s=!0;t.displayName!==c.METRIC_IOPS.toUpperCase()||i.isSparkLine()||(s=!1);var a=i.getAttributeDisplayValue(e,s);n.push({value:a,width:t.width,sClass:t.sClass,isSparkLine:i.isSparkLine()})},this),i===c.VP_TABLE_TYPE.MC_TASKS&&this.$(".tooltip-wrapper").tooltip({placement:"top",container:"body",trigger:"hover",html:"true"}),h){var s=d.find("tr").eq(t);s&&s.length&&_.each(n,function(t,i){var n=s.find("td").eq(i);if(t.isSparkLine){var a=n.find(".n-spark-line");a.attr("entity-id",e.getId()),a.attr("metric-id",T[0]);$(t.value).find(".spark-line-label").html();S.push(e),E=!0}else n=n.html(t.value)},this)}else d.append(C({cells:n,id:this.getQaDataTestListPrefixedId(e.id||e.uuid)})),S.push(e),E=!0},this),E&&S.length&&T.length?this.fetchSparkLineStats(S,T[0]):this.cutOffNotTopEntitiesRows()}else this.renderEmptyContent();else{if(!this._isHealthyEntity(e,t)||this.singleClusterStatsView){var g=this.$(".n-bread-crumb.n-link-action.n-active").data("id");if(this.renderBreadCrumbs(t),this.$(".n-content-table").show(),this.$(".n-healthy-entity-content").hide(),this.dataModel=t,t&&t.length){var A;g&&(A=_.find(t,function(e){return e.getId()===g})),A||(A=t[0]),this.renderIndividualDetails(A.getId(),A)}}else this.getAspectsValue(c.VP_ASPECT_TYPE)===c.VP_TABLE_TYPE.MC_PLAYBOOKS?this.renderPlaybooksDetails(_.first(t)):this.renderEmptyContent()}},cutOffNotTopEntitiesRows:function(){var e=this.$("tbody > tr");if(e.length>10)for(var t=10;e[t];t++)e[t].remove()},fetchSparkLineStats:function(e,t){if(e&&e.length&&t){var i=c.STATS_LAST_HOURS_PC,s=S.getStatsStartTime(i),r=S.getStatsCurrentTime(),o=S.getSamplingIntervalSecs([t]),l=this,d=new n,h=_.pluck(e,a.ID);d.setTimeInterval(s,r,o),d.setGroupsStats(h,e[0].entityType,null,e[0].entityType,[t],a.AGGREGATORS.AVERAGE),d.performQuery({success:function(){var i=d.getQueryResults();_.each(i.models,function(i){var n=_.find(e,function(e){return e.get(a.ID)===i.get(a.ID)}),s=i.get(t);if(n&&s){var r=[];s=s.reverse(),_.each(s,function(e){r.push(e[1])}),l.renderSparkLine(n,t,r)}}),l.sortRowsByValue(),l.cutOffNotTopEntitiesRows()},error:function(){_.each(e,function(e){l.renderSparkLine(e,t,[])}),u.log("fetchSparkLineStats failed.")}})}},
sortRowsByValue:function(){var e=this.getSortByInfo();if(e){var t=y.SORTING_VALUE_ATTR_NAME,i=this.$("["+t+"]").closest("tr").sort(function(i,n){var s=$(i).find("["+t+"]").attr(t),a=$(n).find("["+t+"]").attr(t);return e.sortOrder===c.SORT_DESC?a-s:s-a});this.$("tbody").empty().append(i)}},renderSparkLine:function(e,i,n){var s=e.getId(),a='.n-spark-line[entity-id="'+s+'"][metric-id="'+i+'"]',r=this.$(a),o=r.closest("td"),l=o.find(".spark-line-label"),c=parseInt(o.css("padding-right")),u=r.height(),d=o.width()-l.width()-c;r.find(".n-inline-loading").length&&r.find(".n-inline-loading").remove(),r.find("svg").length&&(r.find("svg").remove(),h.applyAntiScroll(this.$(".antiscroll-wrap"))),r.find(".n-chart-no-data").length&&r.find(".n-chart-no-data").remove();var p=g.getChartColor(i);if(n&&n.length){E.renderSparkLine(this.$(a)[0],n,d,u,p,!1,null,null,null,null,!0);var _=this.getSortByInfo(),T=_&&_.sortBySchema===i;this.renderLastSparkDataValue(e,n,l,T)}else r.html(t.NO_DATA_HTML(this.vtOptions()))},renderLastSparkDataValue:function(e,t,i,n){_.each(this._getDisplayAttributes(),function(s){if(s.formatter===p.FORMATTER.SPARK_LINE){var a=_.clone(s);a.formatter=null;var r=p.getRenderer(a),o=t&&t.length?t[t.length-1]:null,l=r.getAttributeDisplayValue(e,!0,o);i.html(l),n&&i.attr(y.SORTING_VALUE_ATTR_NAME,o)}})},fetchClusterEfficiencyDetails:function(e,t){var i=this;(new s).save({clusterId:e,clusterName:t.get(a.NAME)},{success:function(e){i.setEffeciencyData(e,t),i.renderIndividualDetails(t.getId(),t)},error:function(){u.log("Error in fetching efficiency details.")}})},setEffeciencyData:function(e,t){if(t.set(a.EB.ENTITY_TYPE,c.ENTITY_CLUSTER),t.set(a.EB.ENTITY_ID,t.getId()),t.set("efficiencyDetailFetched",!0),d.getXfitFeatureInfo().featureDisabled)return void t.set(a.EVENT_ANOMALY_COUNT,c.STATS_NOT_AVAILABLE);var i=e.get(s.DP.EVENT_MODEL),n=e.get(s.DP.RUNWAY_MODEL),r=e.get(s.DP.PLAY_MODEL);t.set(a.EVENT_ANOMALY_COUNT,i.getEventCount()),t.set("playCountDetails",{count:r.get(r.DP.FILTERED_ENTITY_COUNT),expr:r.get("filter_expression")});var o=n.getQueryResultAttributes();if(o&&o.length){var l=parseInt(o[0][a.CLUSTER_RUNWAY],10);l=_.isNaN(l)?c.STATS_NOT_AVAILABLE:this.i18ns("time.days",l),t.set(a.CLUSTER_RUNWAY,l)}},renderIndividualDetails:function(e,t){this._setBreadCrumbActive(e);var i=this.$(".n-vantage-point-table > tbody");i.empty();var n=this.$(".n-vantage-point-title");d.getXfitFeatureInfo();if(this.$el.parent().addClass("clusterstats"),t){t.entityType=c.ENTITY_CLUSTER;var s=u.truncateMiddle(t.get(a.NAME),15);n.html(R({title:s,action:c.ACTION_DETAILS,actionTarget:t.entityType,actionTargetId:t.getId(),showDetails:this.canShowDetailsLink(t)})),n.removeClass("hide"),t.set(a.ALERT_CRITICAL_COUNT,t.getValue("alertStats.critical")||0),t.set(a.ALERT_WARNING_COUNT,t.getValue("alertStats.warning")||0),t.get("efficiencyDetailFetched")||(t.set(a.CLUSTER_RUNWAY,c.STATS_NOT_AVAILABLE),this.fetchClusterEfficiencyDetails(t.getId(),t));var o=p.getRenderer({name:"alertCount",formatter:"alertCount"});n.find(".alert-count-link").html(o.getAttributeDisplayValue(t));var l=t.entityType===c.ENTITY_CLUSTER&&t.getId()===r.getClusterManager().getPrismCentralClusterUuid();this._renderIndividualTableRows(t,i,l)}else n.html('<div class="no-data">No Data</div>')},renderPlaybooksDetails:function(e){var t=this.$(".n-vantage-point-table > tbody");t.empty();var i=this.$(".n-vantage-point-title").show();this.$(".n-vantage-point-bread-crumbs").hide();var n=r.getLicenseManager();if(n.getFeatInfo(n.FEAT_MAP.VULCAN).denied)this.renderOnlySupportedInPrismPro();else{var s=_.first(this._getDisplayAttributes()),a=p.getRenderer(s);i.html(a.getAttributeDisplayValue(e)),this._renderIndividualTableRows(e,t)}},_renderIndividualTableRows:function(e,t,i){var n=this,s=d.getXfitFeatureInfo(),a=r.getLicenseManager(),o=a.getFeatInfo(a.FEAT_MAP.VULCAN),l=_.rest(this._getDisplayAttributes());_.each(l,function(a){if(!i||n._hasPCClusterData(a)){var r="",l=p.getRenderer(a),c=[],u=l.formatAttributeDisplayName(e);c.push({value:n.i18n(u.toLowerCase(),u),width:"70%",sClass:"cards"}),(s.disabled&&_.contains(P,a.name)||o.denied&&_.contains(O,a.name))&&(r="disable-no-license");var d=l.getAttributeDisplayValue(e);c.push({value:d,width:"40%",sClass:"cards right "+r}),t.append(C({cells:c,id:n.getQaDataTestListPrefixedId(a)})),(s.disabled||o.denied)&&n._createLicenseTooltip(s.message)}})},containsEmptyContent:function(t){return!this.singleClusterStatsView&&e.prototype.containsEmptyContent.apply(this,arguments)},_hasPCClusterData:function(e){return _.find(v,function(t){return t===e.name})},_createLicenseTooltip:function(e){this.$(".disable-no-license").tooltip({title:e,placement:"right",container:"body",trigger:"hover"})},renderBreadCrumbs:function(e){var t="";if(e.length>1){var i=_.first(e,5);_.each(i,function(e){t+=p.renderBreadCrumb(e.getId())})}this.$(".n-vantage-point-bread-crumbs").html(t)},_setBreadCrumbActive:function(e){this.$(".n-active").removeClass("n-active"),this.$('.n-bread-crumb[data-id="'+e+'"]').addClass("n-active")},_getDisplayAttributes:function(){return this.vantagePointDetailsModel?this.vantagePointDetailsModel.getDisplayAttributes():null},_findDataModel:function(e){return _.find(this.dataModel,function(t){return t.getId()===e},this)},_showAllRows:function(){return!this.vantagePointDetailsModel||this.vantagePointDetailsModel.getLayout()===this.vantagePointDetailsModel.LAYOUT.ALL},_showHeader:function(){return!this.vantagePointDetailsModel||this.vantagePointDetailsModel.showHeader()},_reuseCells:function(){return!!this.vantagePointDetailsModel&&this.vantagePointDetailsModel.reuseCells()},_getStatsModel:function(e,t){var n=e.getId()+t.join(","),s=this.statsModelMap[n]||new i;return this.statsModelMap[n]=s,s},toCustomModel:function(e){var t=this.getAspectsValue(c.VP_ASPECT_TYPE);if(t===c.VP_TABLE_TYPE.MC_STORAGE){var i,n=this.getUsedPhysical(e),s=this.getTotalCapacity(e),o=e.get(a.TOTAL_SAVINGS_RATIO),l=e.get(a.TOTAL_SAVED_BYTES);e.set(a.NAME,e.get(a.EB.CLUSTER.CLUSTER_NAME)),e.set(p.HELPER_DP.PERCENT_USED,S.round(n/s*100)),e.set(a.USAGE_STATS,(i={},_defineProperty(i,a.NEW_TOT_USED_PHY,n),_defineProperty(i,a.NEW_TOT_CAPACITY,s),_defineProperty(i,a.TOTAL_SAVINGS_RATIO,o),_defineProperty(i,a.TOTAL_SAVED_BYTES,l),i))}else if(t===c.VP_TABLE_TYPE.MC_CLUSTER_STATS){var u=r.getClusterManager().getClusterModelByClusterUuid(e.getId());u&&e.set(u.toJSON(),{silent:!0})}return e},getUsedPhysical:function(e){return e.get(a.NEW_TOT_USED_PHY)},getTotalCapacity:function(e){return e.get(a.NEW_TOT_CAPACITY)},_isHealthyEntity:function(e,t){return e.getState()===c.STATE_SUCCESS&&t.length<=0||!_.find(t,function(e){return e.getValue("alertStats.total")>0})},onAlertSeverityClick:function(e){if(this.isInPreviewMode())return void e.stopPropagation();var t=$(e.currentTarget);r.getNavigationManager().navigateToAlertsPage(null,t.attr(c.NAV_ACTION_TARGET_ID),t.attr(c.NAV_ACTION_TARGET_TYPE),t.data(c.FILTER_ALERT_SEVERITY))},onEventLinkClick:function(e){if(this.isInPreviewMode())return void e.stopPropagation();var t=$(e.currentTarget);if(!d.getXfitFeatureInfo().disabled||!t.parents(".disable-no-license").length){var i=t.attr(c.NAV_ACTION_TARGET_ID),n=t.attr(c.NAV_ACTION_TARGET_TYPE);r.getNavigationManager().navigateToEventsPage(c.EVENT.TYPE.ANOMALOUS,i,n)}},onclickRPTasks:function(e){if(this.isInPreviewMode())return void e.stopPropagation();var t=e.currentTarget.getAttribute("data-rpId");o.navigateToFullScreenDetailsPane(c.ENTITY_RECOVERY_PLAN,t)},onViewAllTasks:function(e){if(this.isInPreviewMode())return void e.stopPropagation();r.getNavigationManager().navigateToPage(c.PAGE_TASKS)},destroy:function(){this.$(".disable-no-license").tooltip("destroy"),this.$(".tooltip-wrapper").tooltip("destroy"),e.prototype.destroy.apply(this,arguments)},canShowDetailsLink:function(e){return!!(e.entityType&&e.getId()&&r.getAccessManager().canViewByEntityType(e.entityType))&&(e.entityType!==c.ENTITY_CLUSTER||r.getClusterManager().getPrismCentralClusterUuid()!==e.getId())}})}),define("text!templates/basecomponents/vantagepoints/elements/action/OneClickPCDeploymentView.html",[],function(){return'<div class="one-click-deployment-wr <%= !isLoading ? \'btnDetailsAction active\' : \'\' %>"\n  <% if (!isLoading && !isRegistered) { %>\n    action="deploy" actionTarget="prism_central_vm"\n  <% } else if (!isLoading && isRegistered && ipAddress) { %>\n    action="navigate_url" actionTarget="https://<%= ipAddress %>:9440"\n  <% } %>\n>\n  <% if (isLoading) { %>\n    <div class="connecting-wr">\n      <div class="donut-loader-blue"></div>\n      <p><%= message %></p>\n    </div>\n  <% } else if (!isRegistered) { %>\n    <div>\n      <p class="text-msg"><%= i18n(\'pc_not_registered\') %></p>\n      <% if (!canModify) { %>\n        <a class="small-link"><%= i18n(\'pc_register\') %></a>\n      <%} %>\n    </div>\n  <% } else if (!isReachable) { %>\n    <div class="disconnected-wr">\n\n      <div class="exclamation-mark">!</div>\n\n      <p>Disconnected</p>\n      <p class="ip-wrapper"><%= ipAddress %></p>\n    </div>\n  <% } else { %>\n    <div class="n-label-column">\n      <p class="n-label-column-title n-hypervisor-one">\n        <%= i18n(\'status_ok\') %>\n      </p>\n      <p class="ip-wrapper"><%= ipAddress %></p>\n      <p class="n-label-column-subtitle small-link" >\n      <%= i18n(\'link_launch\') %></p>\n    </div>\n  <% } %>\n</div>'}),define("views/basecomponents/vantagepoints/elements/action/OneClickPCDeploymentView",["views/basecomponents/vantagepoints/elements/BasePCDeploymentVantagePointView","managers/ActionManager","managers/TaskManager","managers/NotificationManager","data/DataManager","data/DataProperties","models/task/TaskModel","utils/AppConstants","events/AppEvents","text!templates/basecomponents/vantagepoints/elements/action/OneClickPCDeploymentView.html"],function(e,t,i,n,s,a,r,o,l,c){"use strict";var u=r.extend({urlRoot:"tasks",intervalTimeInMilliSec:o.TASK_REGISTER_POLLING_INTERVAL,getDataSourceURL:function(){return s.getV2DataSourceURL()},_statusChecker:function(e){return(this.get(a.TASK_PROGRESS_STATUS_V2)||"").toLowerCase()===e}}),d=_.template(c);return e.extend({className:"n-vantage-point-action-content",name:"OneClickPCDeploymentView",events:{"click  .btnDetailsAction":"_onClickLinkAction"},highFrequencyTaskPollCount:0,initializeModels:function(t){e.prototype.initializeModels.apply(this,arguments),_.bindAll(this,"onTasksChange","onPcRegistrationTriggered"),l.onAppEvent(o.CHANGE_EVENTS.PC_REGISTRATION_TRIGGERED,this.onPcRegistrationTriggered)},renderModel:function(e,t,i){this.model=e,this.renderModelContent(this.model,i)},onStartServices:function(){i.registerHandlerForChangedTasks(this.onTasksChange),e.prototype.onStartServices.apply(this,arguments)},onStopServices:function(){i.unregisterHandlerForChangedTasks(this.onTasksChange),e.prototype.onStopServices.apply(this,arguments)},renderModelContent:function(e,t){var n=this.hasInProgressDeployment(t),s={isLoading:n,isRegistered:!1},r=this.lastRegistrationTask||i.getGlobalTasks().getLatestTaskForType(o.TASK_OPERATION_PC_REGISTRATION),l=r&&!r.isTaskCompleted();if(!this.lastRegistrationTask&&r&&l&&this.onPcRegistrationTriggered(null,_defineProperty({},a.TASK_UUID,r.getId())),n)s.message=this.i18n("deploying");else if(l)s.isLoading=!0,s.message=r.getMessage()||this.i18n("registering");else{var c={details:"",isMultiCluster:!1};_.each(e.get(a.CLUSTER_EXTERNAL_STATE),function(e){var t=e[a.CLUSTER_EXTERNAL_STATE_DETAILS],i=t[a.MULTICLUSTER],n=t[a.REACHABLE];i&&(c.details=t,c.isMultiCluster=i),c.isReachable=n},this);var u=e.remoteConnectionExists();if(s={isLoading:!1,remoteConnectionExists:u,isRegistered:c.isMultiCluster,isReachable:c.isReachable},c.isMultiCluster){var h=c.details[a.CLUSTER_FQDN],p=e.getVirtualIpAddress();h?s.ipAddress=h:p?s.ipAddress=p:c.details.ipAddresses&&c.details.ipAddresses[0]?s.ipAddress=c.details.ipAddresses[0]:s.ipAddress=null}}var T=!this.canModifyByEntityType(o.ENTITY_PC_VM);s.canModify=T,this.$el.html(d(this.vtOptions(s))),T&&(this.$el.off("click",".btnDetailsAction"),this.$(".btnDetailsAction").removeClass("active"))},onTasksChange:function(e){_.some(e,function(e){if(e.isPcDeploymentTask())return this.model.fetch({alwaysTriggerChange:!0}),!0},this)},onPcRegistrationTriggered:function(e,t){var i=t[a.TASK_UUID];this.latencyNotificationId=t.latencyId,this.lastRegistrationTask=new u(_defineProperty({},a.TASK_ID,i)),this.lastRegistrationTask.startPolling({success:this.onLatestRegistrationTaskFetched.bind(this)}),this.highFrequencyTaskPollCount++},onLatestRegistrationTaskFetched:function(){if(this.lastRegistrationTask.isTaskCompleted()){this.lastRegistrationTask.stopPolling(),this.model.fetch({alwaysTriggerChange:!0});var e=o.NOTIFY_ERROR,t=this.i18n("pc_register_failed"),i={};this.lastRegistrationTask.isStatusComplete()&&(e=o.NOTIFY_SUCCESS,t=this.i18n("pc_register_succeeded")),this.latencyNotificationId&&(i.latencyId=this.latencyNotificationId),n.showClientNotification(e,t,i)}else this.highFrequencyTaskPollCount++>=15&&this.lastRegistrationTask.setIntervalTime(o.DEFAULT_POLLING_INTERVAL);this.renderModelContent(this.model,{})},destroy:function(){l.offAppEvent(o.CHANGE_EVENTS.PC_REGISTRATION_TRIGGERED,this.onPcRegistrationTriggered),e.prototype.destroy.apply(this,arguments)},_onClickLinkAction:function(e){t.executeActionElement(e.currentTarget)}})}),define("views/basecomponents/vantagepoints/elements/action/ActionVantagePointView",["components/Components","views/basecomponents/vantagepoints/elements/BaseVantagePointView","models/cluster/ClusterExternalStateModel","views/basecomponents/vantagepoints/elements/action/OneClickPCDeploymentView","utils/AppConstants","views/basecomponents/vantagepoints/VantagePointTemplates","utils/CommonTemplates"],function(e,t,i,n,s,a,r){"use strict";return t.extend({vantagePointCSS:"n-vantage-point-action",enableAntiscroll:!1,name:"ActionVantagePointView",updateStyle:function(){var e=this.getAspectsValue(s.VP_ASPECT_TYPE);e=e.replace(/_/g,"-"),this.vantagePointCSS+=" "+e},updateSubView:function(){var e=this.getAspectsValue(s.VP_ASPECT_TYPE);this.getAspectsValue(s.VP_ASPECT_ENTITY);switch(e){case s.VP_ACTION_TYPE.ONE_CLICK_PC_DEPLOY:this.subView=new n}},updateDataModels:function(){var e,t=this.getAspectsValue(s.VP_ASPECT_TYPE),n=s.DEFAULT_POLLING_INTERVAL;switch(t){case s.VP_ACTION_TYPE.ONE_CLICK_PC_DEPLOY:e=i.getSharedInstance()}e?this.registerDataModel(e,this,this.renderSuccess,this.renderError,n,null):this.isEmptyContent=!0},getDefaultTemplate:function(){return a.VANTAGE_POINT_CONTENT_TOOL_TIP(this.vtOptions({model:this.model.toJSON(),content:this.enableAntiscroll?r.ANTISCROLL:"",customizable:this.isCustomizable,icon:e.icon("question-tooltip","-inline")}))},renderSuccess:function(e,t,i){if(this.subView){var n;n=this.canModifyByEntityType(s.ENTITY_PC_VM)?this.i18n("tooltip_msg"):this.i18n("tooltip_msg_view_only"),this.$el.find(".n-title").nutanixMoreInfo({trigger:"hoverable",html:!0,title:n,placement:"right",container:"body",renderMethod:"append",template:'<div class="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',classes:["qtip"]}),this.subView.renderModel(e,t,i)}}})}),define("text!templates/basecomponents/vantagepoints/elements/ClusterQuickAccessVantagePointView.html",[],function(){return'<div class="n-title">\n  <span class="lblTitle title"><%- title %></span>\n</div>\n<div class="n-content  n-content-list">\n  \x3c!-- Antiscroll --\x3e\n  <div class="antiscroll-wrap">\n    <div class="box-wrap">\n      <div class="antiscroll-inner">\n        <div class="box-inner  n-content-inner">\n          <div class="n-notification">\n            \x3c!-- Place notification here --\x3e\n          </div>\n          <ul class="n-list">\n            \x3c!-- Place content here --\x3e\n          </ul>\n        </div>\n      </div>\n    </div>\n  </div>\n</div>'}),define("views/basecomponents/vantagepoints/elements/ClusterQuickAccessVantagePointView",["views/basecomponents/vantagepoints/elements/BaseVantagePointView","text!templates/basecomponents/vantagepoints/elements/ClusterQuickAccessVantagePointView.html","managers/ActionManager","managers/TaskManager","managers/EntityManager","models/cluster/ClusterModel","models/query/AlertStatsQueryModel","data/DataProperties","utils/AppConstants","utils/AppUtil","utils/CommonTemplates","utils/DataRendererUtil","utils/SVG"],function(e,t,i,n,s,a,r,o,l,c,u,d,h){"use strict";var p={clusterSummary:"cluster-summary",healthSummary:"health-summary",tasksSummary:"tasks-summary",alertsSummary:"alerts-summary",loader:"donut-loader-blue"},T={alertIcon:_.template('<span class="alert-count-minimal  -<%= severity %><%= (count > 0) ? "" : "  -no-alerts" %>"title="<%= severity.charAt(0).toUpperCase() + severity.slice(1) %> Alerts: <%= count %>"></span>'),loader:_.template('<div class="'+p.loader+'"></div>'),noResults:_.template('<div class="no-content-error"><%= error %></div>'),notification:_.template('<div class="notification -add-bottom-border"><div class="message -info"><span class="content"><%= content %></span><span class="close"><%= SVG.SVGIcon("x-square", "close") %></span></div></div>'),row:_.template('<li class="<%= row %>  n-list-row  n-link-action"  <%= attrs %>  <%= uuidAttr %>="<%= _.escape(model.clusterUuid) %>" data-id="<%= _.escape(model.clusterUuid) %>" ><div class="n-multi-col  n-col-1-of-2"><a title="<%= _.escape(model.name) %>"><%= _.escape(model.name) %></a></div><div class="n-multi-col  n-col-2-of-2  n-numeric"><ul class="'+p.clusterSummary+' hide"><li class="'+p.healthSummary+'"></li><li class="'+p.tasksSummary+'"></li><li class="'+p.alertsSummary+'"></li></ul></div></li>'),vantagePoint:_.template(t)};return e.extend({clusterModels:null,clusterModelMap:null,dataRenderer:d.getRenderer(),name:"ClusterQuickAccessVantagePointView",showHelp:"false",vantagePointCSS:"n-vantage-point-cluster-quick-access",events:{"click .n-link-action":"onClickAction","click .notification .close":"onClickNotificationClose"},initializeVantagePoint:function(){_.bindAll(this,"onTaskChange","onTaskRestructure","updateClusterSummary"),this.clusterModels=[],this.clusterModelMap={},this.alertsModel=new r(null,{})},renderVantagePoint:function(){if(c.hasLocalStorage()){null===localStorage.getItem(l.LOCAL_STORAGE.NOTIFICATION_CLUSTER_QUICK_ACCESS)&&localStorage.setItem(l.LOCAL_STORAGE.NOTIFICATION_CLUSTER_QUICK_ACCESS,"true"),this.showHelp=localStorage.getItem(l.LOCAL_STORAGE.NOTIFICATION_CLUSTER_QUICK_ACCESS)}if("true"===this.showHelp){var e=this.$(".n-notification"),t=T.notification({content:this.i18n("usage_help_message"),SVG:h});e.html(t)}},updateTemplate:function(){var e=this.model.toJSON(),t=e.name,i=this.i18n(t,t);this.template=T.vantagePoint({customizable:this.isCustomizable,model:e,SVG:h,title:i})},updateDataModels:function(){var e=this.getSharedCollectionByType(l.ENTITY_CLUSTER);e?this.sharedCollection=!0:e=s.createGenericEntityPollingCollection(l.ENTITY_CLUSTER),this.registerDataModel(e,this,this.renderSuccess,this.renderError)},renderSuccess:function(e){this._stopFetchClusterSummary(),this.clusterModels=e.models,this.clusterModels=_.sortBy(this.clusterModels,function(e){return e.get(o.CLUSTER_NAME)&&e.get(o.CLUSTER_NAME).toLowerCase()});var t=0,i=this.$(".n-list");i.empty(),this.clusterModels.length?(_.each(this.clusterModels,function(e){var n=e.toJSON(),s=e.getClusterUuid(),r=this.clusterModelMap[s];r||(r=new a(n),r.idAttribute=o.UUID,this.clusterModelMap[s]=r);var l=T.row({model:n,row:t++%2==0?"n-row-even":"n-row-odd",attrs:this.getNavLinkAttrs(e),uuidAttr:o.CLUSTER_UUID});i.append(l)},this),this.fetchClusterSummary()):i.replaceWith(T.noResults({error:this.i18n("no_cluster_found")})),this.applyAntiScroll()},fetchClusterSummary:function(){var e=this;this.alertsModel.save(null,{success:function(){var t=e.alertsModel.getQueryResultAttributes();_.each(e.clusterModels,function(i){var n=_.find(t,function(e){return e.id===i.id});n&&n.alertStats&&i.set(o.ALERT_SUMMARY,{critical:n.alertStats.critical,warning:n.alertStats.warning}),e.updateClusterSummary(i)})},error:function(){_.each(e.clusterModels,function(t){e.removeLoader(t)}),c.log("ClusterQuickAccessVantagePointView: Error fetching alerts.")}})},removeLoader:function(e){var t=this._getElByModel(e);t.find("."+p.loader).remove(),t.find("."+p.clusterSummary).removeClass("hide")},updateClusterSummary:function(e){this.removeLoader(e),this.updateClusterTasks(e),this.updateClusterAlerts(e)},updateClusterHealth:function(e){this._getElByModel(e).find("."+p.healthSummary).empty().html(this.getHealthTmpl(e))},updateClusterTasks:function(e){var t=this._getElByModel(e),i=t.find("."+p.tasksSummary),n=this._getClusterTasks(e),s=parseInt(t.find("."+p.tasksSummary+" > .radial").data("class"),10);s=isNaN(s)?0:s,c.hasLocalStorage()&&localStorage[l.LOCAL_STORAGE.NO_TASKS]||!(n.length>0)||i.empty().html(this.getTasksTmpl(e,s))},updateClusterAlerts:function(e){var t=this._getElByModel(e),i=t.find("."+p.alertsSummary);this.getAlertsTmpl(e).length&&i.html(this.getAlertsTmpl(e))},getNavLinkAttrs:function(e,t){return t="object"==typeof t?t:{},t[l.NAV_ACTION]=l.ACTION_ID_NAVIGATE_TO_PE,t[l.NAV_ACTION_TARGET]=this.getAspectsValue(l.VP_ASPECT_ENTITY),t[l.NAV_ACTION_TARGET_ID]=e.get(o.CLUSTER_UUID),t[l.NAV_ACTION_TARGET_NAME]=e.get(o.CLUSTER_NAME),c.convertNavModelToHTMLAttr(t)},getHealthTmpl:function(e){var t=e.getClusterHealthStatus();return this.dataRenderer.getHealthIcon(t)},getTasksTmpl:function(e,t){var i=this._getClusterTasks(e),s=u.RADIAL_TEMPLATE,a={className:"",displayValue:"",percent:0},r=[];if(_.each(i,function(e){e.isStatusCategoryRunning()&&r.push(e)}),0===r.length){return _.some(i,function(e){return"failed"===e.attributes.status})?(a.className="failed ",a.percent=100,s(a)):(a.className="succeeded ",a.percent=100,s(a))}var o=0,l=n.getGlobalTasks();_.each(r,function(e){l&&l.isFirstPass&&l.isFirstPass(e)&&(o+=parseInt(e.getPercentage(),10))},this),o>0&&(o=Math.min(t+o/r.length,100),a.percent=Math.floor(o));var c=0;return _.each(r,function(e){c+=parseInt(e.getPercentage(),10)}),c>0&&(c=Math.min(c/r.length,100),a.percent=Math.floor(c)),s(a)},getAlertsTmpl:function(e){var t=e.getAlertSummary(),i=_.template("<%= alertIcons.critical %><%= alertIcons.warning %><%= alertIcons.info %>"),n={critical:"",warning:"",info:""};return _.isEmpty(t)||_.each(n,function(e,i){i.toUpperCase();n[i]=T.alertIcon({count:t[i],severity:i})}),i({alertIcons:n})},onClickAction:function(e){if(this.isInPreviewMode())return void e.stopPropagation();var t=this.$(e.currentTarget);i.onEntityAction(t.attr(l.NAV_ACTION_TARGET),t.attr(l.NAV_ACTION),[t.attr(l.NAV_ACTION_TARGET_ID)])},onClickNotificationClose:function(e){if(this.isInPreviewMode())return void e.stopPropagation();this.$(".n-notification").empty(),this.applyAntiScroll(),c.hasLocalStorage()&&localStorage.setItem(l.LOCAL_STORAGE.NOTIFICATION_CLUSTER_QUICK_ACCESS,"false")},onTaskChange:function(e){var t={};_.each(e,function(e){var i=e[o.CLUSTER_UUID]||e.attributes[o.CLUSTER_UUID];t.hasOwnProperty(i)?t[i]+=1:t[i]=0}),_.each(t,function(e,t){e>0&&this._pulseRadial(t)},this)},onTaskRestructure:function(){n.unregisterHandlerResetStructure(this.onTaskRestructure),_.each(this.clusterModels,function(e){this.updateClusterTasks(e)},this)},onStartServices:function(){n.registerHandlerForChangedTasks(this.onTaskChange,this),n.registerHandlerResetStructure(this.onTaskRestructure,this),e.prototype.onStartServices.apply(this,arguments)},onStopServies:function(){n.unregisterHandlerForChangedTasks(this.onTaskChange),n.unregisterHandlerResetStructure(this.onTaskRestructure),e.prototype.onStopServies.apply(this,arguments)},_getElByModel:function(e){var t=c.sprintf('.n-list-row[%s="%s"]',o.CLUSTER_UUID,e.getClusterUuid());return this.$(t)},_getElByUuid:function(e){var t=c.sprintf('.n-list-row[%s="%s"]',o.CLUSTER_UUID,e);return this.$(t)},_getClusterTasks:function(e){return n.getQuickViewTasks().filter(function(t){return(t[o.CLUSTER_UUID]||t.attributes[o.CLUSTER_UUID])===e.getClusterUuid()})},_stopFetchClusterSummary:function(){this.alertsModel&&this.alertsModel.stopFetch()},_pulseRadial:function(e){var t=this,i=t._getElByUuid(e),n=i.find(".radial");n.addClass("n-pulsate"),setTimeout(function(){n.removeClass("n-pulsate")},l.TASK_PULSE_ANIMATION_TIMEOUT)}})}),define("text!templates/basecomponents/vantagepoints/elements/RPStatusVantagePointView.html",[],function(){return'<div class="n-title test_rp_widget_title">\n  <div class="rp-title-select-wrapper">\n    <span class="lblTitle title"><%= title %></span>\n    <% if (totalRPs > 0) { %>\n      <select class="rp-status-select test_rp_widget_period_dropdown">\n        <option value="<%= i18n(\'1week\') %>"><%= i18n(\'1week\') %></option>\n        <option value="<%= i18n(\'1month\') %>"><%= i18n(\'1month\') %></option>\n        <option value="<%= i18n(\'3months\') %>"><%= i18n(\'3months\') %></option>\n      </select>\n    <% } %>\n  </div>\n</div>\n<div class="n-content  n-content-list">\n  <% if (totalRPs > 0) { %>\n    <div class="rp-test-total-count test_rp_widget_tested_count" >\n      <%= i18ns(\'test_count\', testCount) %>\n    </div>\n  <% } else { %>\n    <div class="dr-recommendation-title">\n      <%= i18n(\'recommendation_steps\') %>\n    </div>\n  <% } %>\n  \x3c!-- Antiscroll --\x3e\n  <div class="antiscroll-wrap">\n    <div class="box-wrap">\n      <div class="antiscroll-inner">\n        <div class="box-inner  n-content-inner">\n          \x3c!-- Place content here --\x3e\n          <% if (totalRPs > 0) { %>\n            <ul class="n-list readonly-list">\n              <li>\n                <span class="test-status-icon  -notTested"></span>\n                <%= i18n(\'not_tested\') %>\n                <span class="test-count test_rp_widget_not_tested_count">\n                  <%= notTested %></span>\n              </li>\n              <li>\n                <span class="test-status-icon  -failed"></span>\n                <%= i18n(\'failed\') %>\n                <span class="test-count test_rp_widget_failed_count">\n                  <%= testFailed %></span>\n              </li>\n              <li>\n                <span class="test-status-icon  -warning"></span>\n                <%= i18n(\'pass_warning\') %>\n                <span class="test-count test_rp_widget_warning_count">\n                  <%= passWarning %></span>\n              </li>\n              <li>\n                <span class="test-status-icon  -succeeded"></span>\n                <%= i18n(\'passed\') %>\n                <span class="test-count test_rp_widget_passed_count">\n                  <%= testSuccess %></span>\n              </li>\n            </ul>\n          <% } else { %>\n            <ul class="dr-recommendation-steps">\n              <li>\n                <%= i18n(\'step1\') %>\n              </li>\n              <li>\n                <%= i18n(\'step2\') %>\n              </li>\n              <li>\n                <%= i18n(\'step3\') %>\n              </li>\n              <li>\n                <%= i18n(\'step4\') %>\n              </li>\n            </ul>\n          <% } %>\n          <% if (totalRPs === 0) { %>\n            <div>\n              <a class="dr-learn-more" href="https://portal.nutanix.com/#/page/docs/list?filterKey=type&filterVal=Prism" target="_blank">\n              <%= i18n(\'learn_more\') %> </a>\n            </div>\n          <% } else { %>\n            <div class="view-all-tests">\n              <a class="n-link-action test_rp_widget_view_all_link">\n                <%= i18n(\'view_all_RPs\') %></a>\n            </div>\n          <% } %>\n        </div>\n      </div>\n    </div>\n  </div>\n</div>\n'}),define("views/basecomponents/vantagepoints/elements/RPStatusVantagePointView",["views/basecomponents/vantagepoints/elements/BaseVantagePointView","text!templates/basecomponents/vantagepoints/elements/RPStatusVantagePointView.html","managers/NavigationManager","models/query/BaseQueryModel","data/DataProperties","utils/AppConstants","utils/SVG","utils/ManagerMixin","data/DataURLConstants"],function(e,t,i,n,s,a,r,o,l){"use strict";var c=_.template(t),u=a.SAMPLING_INTERVAL_IN_SECS_FOR_A_DAY*a.DAYS_IN_WEEK*a.MILLIS_PER_SECOND,d=a.MICROS_PER_MILLI;return e.extend({name:"RPStatusVantagePointView",test_info:{notTested:0,testFailed:0,passWarning:0,testSuccess:0,testCount:0},result:null,timeLimit:null,selectedValIndex:0,vantagePointCSS:"n-vantage-point-rp-status test_rp_widget",events:{"click .n-link-action":"onClickAction","change .rp-status-select":"onTimeSelect"},initializeVantagePoint:function(){var e=new Date;this.timeLimit=(e.getTime()-u)*d,this.selectedValIndex=0},updateTemplate:function(){var e=this.model.toJSON(),t=e.name,i=this.i18n(t,t);this.template=c(this.vtOptions({customizable:this.isCustomizable,model:e,SVG:r,title:i,notTested:this.test_info.notTested,testFailed:this.test_info.testFailed,passWarning:this.test_info.passWarning,testSuccess:this.test_info.testSuccess,testCount:this.test_info.testFailed+this.test_info.passWarning+this.test_info.testSuccess+"/"+this.test_info.testCount,totalRPs:this.test_info.testCount}))},updateDataModels:function(){var e,t=n,i=(e={},_defineProperty(e,t.DP.ENTITY_TYPE,a.ENTITY_RECOVERY_PLAN),_defineProperty(e,t.DP.GROUP_MEMBER_ATTRIBUTES,[s.EB.RECOVERY_PLAN.LAST_TEST_INFO]),e),r=o.getEntityManager().createGenericEntityCollection(a.ENTITY_RECOVERY_PLAN,null,l.ENTITY_BROWSER_QUERY,i);this.registerDataModel(r,this,this.renderSuccess,this.renderError)},renderEmptyContent:function(){this.result=[],this._filterData(),this.updateTemplate(),this.$el.html(this.template),this._renderView()},onClickAction:function(e){if(this.isInPreviewMode())return void e.stopPropagation();i.navigateToEBPage(a.ENTITY_RECOVERY_PLAN)},renderSuccess:function(e){this.result=e.models,this._filterData()},_filterData:function(){var e=this;this.test_info={notTested:0,testFailed:0,passWarning:0,testSuccess:0,testCount:0};var t=[this.i18n("1week"),this.i18n("1month"),this.i18n("3months")],i=a.RECOVERY_PLAN.EXE_STATUS;if(this.result&&this.result.length){this.test_info.testCount=this.result.length;this.result.filter(function(t){return t.attributes.last_test_info[1]>=e.timeLimit}).forEach(function(t){switch(t.attributes.last_test_info[0]){case i.FAILED:case i.FAILED_WARNING:e.test_info.testFailed++;break;case i.COMPLETE_WARNING:e.test_info.passWarning++;break;case i.COMPLETED:e.test_info.testSuccess++}}),this.test_info.notTested=this.test_info.testCount-(this.test_info.testFailed+this.test_info.passWarning+this.test_info.testSuccess),this.updateTemplate(),this.$el.html(this.template),this._renderView()}this.$(".rp-status-select").val(t[this.selectedValIndex])},onTimeSelect:function(e){this.selectedValIndex=e.target.selectedIndex;var t=new Date;switch(this.selectedValIndex){case 0:this.timeLimit=(t.getTime()-u)*d,this._filterData();break;case 1:t.setMonth(t.getMonth()-1),this.timeLimit=t.getTime()*d,this._filterData();break;case 2:t.setMonth(t.getMonth()-3),this.timeLimit=t.getTime()*d,this._filterData()}}})}),define("models/GraphQLPollingModel",["graphql","models/PollingModel"],function(e,t){"use strict";return t.extend({initialize:function(i){var n=i.getQuery;this.getQuery=n,this.GraphQLClient=new e,t.prototype.initialize.apply(this,arguments)},parse:function(e){return e},sync:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this.GraphQLClient.send({query:this.getQuery()}).then(function(e){return"function"==typeof i.success&&i.success(e),e}).catch(function(e){throw"function"==typeof i.error&&i.error(e),e})}})}),define("text!templates/basecomponents/vantagepoints/elements/ProtectionStatusVantagePoint.html",[],function(){
return'<div class="n-title">\n  <span class="lblTitle title" data-test="test_pr_widget_title">\n    <%= title %>\n  </span>\n</div>\n<div class="n-content n-content-list">\n  <div class="antiscroll-wrap">\n    <div class="box-wrap">\n      <div class="antiscroll-inner">\n        <div class="box-inner n-content-inner">\n          <div class="vms-protected">\n            <div class="radial <%= percentage %>" data-test="test_pr_vm_count_graphic">\n              <b><i></i></b>\n              <b><i></i></b>\n            </div>\n            <div>\n              <h3 class="heading" data-test="test_pr_vm_count">\n                <%= protectedVMs %>\n              </h3>\n              <div class="protected-vms-txt"><%= i18n(\'vms_protected\') %></div>\n            </div>\n          </div>\n          <div class="prot-status-alerts">\n            <%= i18n(\'policies_alerts\') %>\n            <select\n              class="prot-status-select"\n              data-test="test_pr_period_dropdown"\n            >\n              <option\n                <% if (filter === \'1_week\') { %>selected<% } %>\n                value="1_week"><%= i18n(\'1week\') %></option>\n              <option\n                <% if (filter === \'1_month\') { %>selected<% } %>\n                value="1_month"><%= i18n(\'1month\') %></option>\n              <option\n                <% if (filter === \'3_month\') { %>selected<% } %>\n                value="3_month"><%= i18n(\'3months\') %></option>\n            </select>\n          </div>\n          <% if (policyAlerts) { %>\n            <table class="policyAlerts n-vantage-point-table">\n              <% for (var i = 0; i < policyAlerts.length; ++i) { %>\n                <tr\n                  class="viewProtPolicy"\n                  data-id="<%= policyAlerts[i].id %>"\n                  data-test="test_<%= policyAlerts[i].name %>_row"\n                >\n                  <td data-id="<%= policyAlerts[i].id %>">\n                    <%= policyAlerts[i].name %>\n                  </td>\n                  <td><div class="alert-type-icon -critical"></div></td>\n                  <td class="alerts-count" data-test="test_pr_critical_count">\n                    <%= policyAlerts[i].alerts.critical %>\n                  </td>\n                  <td><div class="alert-type-icon -warning"></div></td>\n                  <td class="alerts-count" data-test="test_pr_warning_count">\n                    <%= policyAlerts[i].alerts.warning %>\n                  </td>\n                </tr>\n              <% } %>\n            </table>\n          <% } else { %>\n            <div class="no-policy-alerts text-center"><%= i18n(\'noAlerts\') %></div>\n          <% } %>\n        </div>\n      </div>\n    </div>\n  </div>\n</div>\n<div class="footer-action text-center">\n  <a class="eb-link viewAllPolicies" data-test="test_pr_view_all">\n    <%= i18n(\'view_all\') %>\n  </a>\n</div>'}),define("text!templates/basecomponents/vantagepoints/elements/ProtectionStatusOnboarding.html",[],function(){return'<div class="n-title">\n  <span class="lblTitle title">\n    <%= title %>\n  </span>\n</div>\n<div class="n-content n-content-list">\n  <div class="dr-recommendation-title">\n    <%= i18n(\'recommendation_steps\') %>\n  </div>\n  <ul class="dr-recommendation-steps">\n    <li>\n      <%= i18n(\'step1\') %>\n    </li>\n    <li>\n      <%= i18n(\'step2\') %>\n    </li>\n    <li>\n      <%= i18n(\'step3\') %>\n    </li>\n    <li>\n      <%= i18n(\'step4\') %>\n    </li>\n  </ul>\n</div>\n<div class="footer-action">\n  <a class="dr-learn-more" href="https://portal.nutanix.com/#/page/docs/list?filterKey=type&filterVal=Prism" target="_blank">\n  <%= i18n(\'learn_more\') %> </a>\n</div>'}),define("utils/QueryUtil",[],function(){"use strict";return{parseEntityResults:function(e){var t={};return Array.isArray(e)?(e.forEach(function(e){t[e.entity_id]={id:e.entity_id},e.data&&e.data.forEach(function(i){var n=void 0;try{n=i.values[0].values[0]}catch(e){n=null}n&&(t[e.entity_id][i.name]=n)})}),t):t}}}),define("views/basecomponents/vantagepoints/elements/ProtectionStatusVantagePointView",["moment","views/basecomponents/vantagepoints/elements/BaseVantagePointView","managers/NavigationManager","managers/ActionManager","managers/AccessManager","models/GraphQLPollingModel","text!templates/basecomponents/vantagepoints/elements/ProtectionStatusVantagePoint.html","text!templates/basecomponents/vantagepoints/elements/ProtectionStatusOnboarding.html","data/DataProperties","utils/AppConstants","utils/QueryUtil","utils/AppUtil"],function(e,t,i,n,s,a,r,o,l,c,u,d){"use strict";var h=_.template(r),p=_.template(o),T={WIDGET_TITLE:"widget_title",ENTITY_RESULTS:"entity_results"},E=["1","week"],S=a.extend({getValue:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return e&&e.values[0]&&e.values[0].values[0]||t},getAlerts:function(e,t,i){return _.filter(e,function(e){var n=e.protection_rule,s=e.severity;return n===t&&s===i})||[]},parse:function(e){var t=this,i=e.protectedVMs,n=e.nonProtectableVMs,s=e.alerts,a=e.prs;try{var r=i.filtered_entity_count,o=n.total_entity_count,l=n.filtered_entity_count,h=u.parseEntityResults(d.get(s,"group_results.0.entity_results")||null),p=u.parseEntityResults(d.get(a,"group_results.0.entity_results")||null),T=[];return _.each(p,function(e){var i=e.name,n=e.id,s=_.size(t.getAlerts(h,n,c.ALERT_SEVERITY_NAMES.kCritical)),a=_.size(t.getAlerts(h,n,c.ALERT_SEVERITY_NAMES.kWarning));(s||a)&&T.push({id:n,name:i,alerts:{critical:s,warning:a}})}),T.sort(function(e,t){return e.alerts.critical<t.alerts.critical}),T.slice(0,3),{protectedVMs:r,totalVMs:o-l,policyAlerts:T,prs:p}}catch(e){return null}}});return t.extend({name:"ProtectionStatusVantagePointView",vantagePointCSS:"n-vantage-point-prot-status test_pr_div",gqlPollingModel:null,events:{"change .prot-status-select":"applyFilter","click .viewAllPolicies":"viewAllPolicies","click .viewProtPolicy":"viewProtectionPolicy"},initModel:function(){this.gqlPollingModel=new S({getQuery:this.getQueries.bind(this),entityType:c.ENTITY_PROTECTION_RULE}),this.gqlPollingModel.startPolling({success:this.updateTemplate.bind(this),error:this.updateTemplate.bind(this)})},postStartServies:function(){this.gqlPollingModel||this.initModel()},postStopServies:function(){this.gqlPollingModel&&(this.gqlPollingModel.stopPolling(),this.gqlPollingModel=null)},getQueries:function(){var t=s.hasPermission(c.ENTITY_MH_VM,c.ACTION_GET),i=t?c.ENTITY_MH_VM:c.ENTITY_VM;return'\n        {\n          protectedVMs: groups(param_body: \n        {\n          entity_type: "'+i+'",\n          filter_criteria: "protection_type=='+c.VM_PROTECTION_TYPE.ENTITY_CENTRIC+'"\n        }\n      ) {\n            filtered_entity_count\n            total_entity_count\n          }\n          nonProtectableVMs: groups(param_body: \n        {\n          entity_type: "'+i+'",\n          filter_criteria: "('+l.VM_IS_CVM+"==1,"+l.EB.VM.VM_TYPE+"=="+c.ENTITY_PC+')"\n        }\n      ) {\n            filtered_entity_count\n            total_entity_count\n          }\n          alerts: groups(param_body: \n        {\n          group_member_attributes: [\n            {attribute: "severity"},\n            {attribute: "protection_rule"}\n          ],\n          entity_type: "alert",\n          filter_criteria: "_created_timestamp_usecs_=ge='+1e3*e().subtract(E[0],E[1]).valueOf()+';protection_rule!=\'\'"\n        }\n      ) {\n            group_results {\n              entity_results {\n                entity_id\n                data {\n                  name\n                  values {\n                    values\n                  }\n                }\n              }\n            }\n          }\n          prs: groups(param_body: \n        {\n          group_member_attributes: [\n            {attribute: "name"}\n          ],\n          entity_type: "'+c.ENTITY_PROTECTION_RULE+'"\n        }\n      ) {\n            group_results {\n              entity_results {\n                entity_id\n                data {\n                  name\n                  values {\n                    values\n                  }\n                }\n              }\n            }\n          }\n        }\n      '},updateTemplate:function(e){try{var t=e.attributes,i=t.protectedVMs,n=t.totalVMs,s=t.policyAlerts,a=void 0===s?[]:s,r=t.prs;if(!(i>0)&&_.isEmpty(a)&&_.isEmpty(r))throw new Error;this.renderPolicyAlerts(i,n,a)}catch(e){this.renderOnboardingSteps()}finally{this.render()}},renderOnboardingSteps:function(){this.template=p(this.vtOptions({title:this.i18n(T.WIDGET_TITLE)}))},renderPolicyAlerts:function(e,t,i){this.template=h(this.vtOptions({title:this.i18n(T.WIDGET_TITLE),filter:E.join("_"),protectedVMs:e+"/"+t,percentage:"percent"+Math.round(100*e/t),policyAlerts:_.isEmpty(i)?null:i}))},applyFilter:function(e){E=e.target.value.split("_"),this.gqlPollingModel.stopPolling(),this.gqlPollingModel.startPolling({success:this.updateTemplate.bind(this),error:this.updateTemplate.bind(this)})},viewAllPolicies:function(e){if(this.isInPreviewMode())return void e.stopPropagation();i.navigateToEBPage(c.ENTITY_PROTECTION_RULE)},viewProtectionPolicy:function(e){e.stopPropagation();var t=$(e.target).data("id");n.executeAction({action:c.ACTION_DETAILS,actionTargetId:t,actionTarget:c.ENTITY_PROTECTION_RULE,targetTabId:c.TAB_DETAILS.SUMMARY})}})}),define("text!templates/basecomponents/vantagepoints/elements/VMEfficiencyVantagePointView.html",[],function(){return'<div class="n-title">\n  <span class="lblTitle title">\n    <%= i18n(\'title\') %>\n  </span>\n</div>\n<div class="n-content vm-inefficiency-content">\n  <div class="wrapper <%= !isDashboardView ? \'popup-view\' : \'\' %>\n    <%= hideViewAll ? \'hide-view-all\': \'\' %>">\n    <div class="item">\n      <a data-eb-filter="capacity.vm_efficiency_status"\n        data-eb-filter-value="over provisioned">\n        <div class="num"><%= over_provisioned %></div>\n        <div class="text"><%= i18n(\'overprovisioned_vm\') %></div>\n        <% if (gain.overprovisionedGain) { %>\n        <div class="gain"><%= i18ns(\'potential_gain\', gain.overprovisionedGain) %></div>\n        <% } %>\n      </a>\n    </div>\n    <div class="item">\n      <a data-eb-filter="capacity.vm_efficiency_status"\n        data-eb-filter-value="inactive">\n        <div class="num"><%= inactive_vm %></div>\n        <div class="text"><%= i18n(\'inactive_vm\') %></div>\n        <% if (gain.inactiveGain) { %>\n          <div class="gain"><%= i18ns(\'potential_gain\', gain.inactiveGain) %></div>\n        <% } %>\n      </a>\n    </div>\n    <div class="item">\n      <a data-eb-filter="capacity.vm_efficiency_status"\n        data-eb-filter-value="constrained">\n        <div class="num"><%= under_provisioned %></div>\n        <div class="text"><%= i18n(\'constrained_vm\') %></div>\n      </a>\n    </div>\n    <div class="item">\n      <a data-eb-filter="capacity.vm_efficiency_status"\n        data-eb-filter-value="bully">\n        <div class="num"><%= bully_vm %></div>\n        <div class="text"><%= i18n(\'bully_vm\') %></div>\n      </a>\n    </div>\n  </div>\n  <div class="all-inefficient-vms  <%= hideViewAll ? \'hidden\': \'\' %>">\n    <a class="eb-link"><%= i18n(\'view_inefficient_vms\') %></a>\n  </div>\n</div>\n'}),define("views/basecomponents/vantagepoints/elements/VMEfficiencyVantagePointView",["views/basecomponents/vantagepoints/elements/BaseVantagePointView","managers/NavigationManager","managers/ClusterManager","utils/AlertUtil","utils/StatsUtil","utils/FilterUtil","data/DataProperties","events/AppEvents","utils/AppConstants","text!templates/basecomponents/vantagepoints/elements/VMEfficiencyVantagePointView.html"],function(e,t,i,n,s,a,r,o,l,c){"use strict";var u=_.template(c),d=r.VM_EFFICIENCY.CLUSTER,h={INACTIVE:"Inactive",OP:"Overprovisioned",VCPU_GAIN:"vcpu_gain",STORAGE_GAIN:"storage_gain_bytes",MEMORY_GAIN:"memory_gain_bytes"};return e.extend({vantagePointCSS:"vm-efficiency",name:"VMEfficiencyVantagePointView",schemaModel:null,displayAttributes:null,vantagePointDetailsModel:null,clusterId:null,initialize:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.clusterId=t.clusterId,this.isDashboardView=!_.isBoolean(t.isDashboardView)||t.isDashboardView,this.efficiencyGain=t.efficiencyGain||{},e.prototype.initialize.apply(this,arguments),this.addExtraEvents({"click a":"onClickAction"})},_delegateModelEvents:function(){var t=this;e.prototype._delegateModelEvents.apply(this,arguments),o.onAppEvent(o.SERVICE_AVAILABLE,function(e,i){i.name!==l.SERVICES.XFIT||i.enabled||t.renderVantagePoint()})},updateTemplate:function(){var e=this.model.toJSON(),t=e.name,i=(this.i18n(t,t),this.getRigtSizingInfo());this.template=u(this.vtOptions({over_provisioned:i[d.OVERPROVISIONED_VM],under_provisioned:i[d.CONSTRAINED_VM],inactive_vm:i[d.INACTIVE_VM],bully_vm:i[d.BULLY_VM],hideViewAll:0===i.total,isDashboardView:this.isDashboardView,gain:this.getResourceGain()}))},constructResourceGainMsg:function(e){var t=[];if(e)return e[h.MEMORY_GAIN]&&t.push(s.storageFormat(e[h.MEMORY_GAIN])+" "+this.i18n("memory")),e[h.STORAGE_GAIN]&&t.push(s.storageFormat(e[h.STORAGE_GAIN])+" "+this.i18n("CommonEntities.storage")),e[h.VCPU_GAIN]&&t.push(this.i18ns("vcpu_gain",e[h.VCPU_GAIN])),t.join(", ")},getResourceGain:function(){var e={};return this.efficiencyGain?(this.efficiencyGain[h.INACTIVE]&&(e.inactiveGain=this.constructResourceGainMsg(this.efficiencyGain[h.INACTIVE])),this.efficiencyGain[h.OP]&&(e.overprovisionedGain=this.constructResourceGainMsg(this.efficiencyGain[h.OP])),e):e},getRigtSizingInfo:function(){var e={},t=0,n=[d.OVERPROVISIONED_VM,d.CONSTRAINED_VM,d.INACTIVE_VM,d.BULLY_VM];return _.each(n,function(t){e[t]=0}),_.each(i.getClusterCollection().models,function(i){if(!this.clusterId||i.get(r.UUID)===this.clusterId){var s=i.get(r.CLUSTER_ANALYSIS);s&&s[r.CLUSTER_VM_EFFICIENCY_MAP]&&_.each(n,function(i){if(s[r.CLUSTER_VM_EFFICIENCY_MAP][i]){var n=parseInt(s[r.CLUSTER_VM_EFFICIENCY_MAP][i],10);e[i]+=n,t+=n}})}},this),e.total=t,e},onClickAction:function(e){if(this.isInPreviewMode())return void e.stopPropagation();var n=$(e.currentTarget),s={};if(n.data(l.NAV_EB_FILTER_NAME)&&n.data(l.NAV_EB_FILTER_VALUE))s=a.addFilterCondition(s,n.data(l.NAV_EB_FILTER_NAME),a.createFilterCondition(l.ENTITY_VM,n.data(l.NAV_EB_FILTER_NAME),l.FILTER_OPERATORS.CONTAINS,n.data(l.NAV_EB_FILTER_VALUE)));else{var o=[r.VM_EFFICIENCY.STATUS.OVER_PROVISIONED,r.VM_EFFICIENCY.STATUS.INACTIVE,r.VM_EFFICIENCY.STATUS.CONSTRAINED,r.VM_EFFICIENCY.STATUS.BULLY];_.each(o,function(e){s=a.addFilterCondition(s,r.VM_EFFICIENCY.EFFICIENCY_STATUS,a.createFilterCondition(l.ENTITY_VM,r.VM_EFFICIENCY.EFFICIENCY_STATUS,l.FILTER_OPERATORS.CONTAINS,e))})}if(this.clusterId){var c=i.getClusterModelByClusterUuid(this.clusterId);s=a.addFilterCondition(s,r.EB.VM.CLUSTER_NAME,a.createFilterCondition(l.ENTITY_VM,r.EB.VM.CLUSTER_NAME,l.FILTER_OPERATORS.CONTAINS,c.get(r.NAME)))}t.navigateToEBPage(l.ENTITY_VM,"Efficiency",null,null,s)},renderVantagePoint:function(){var t=n.getXfitFeatureInfo();if(t.disabled&&t.featureDisabled)return void this.renderUnsupportedMessage(t.message);e.prototype.renderVantagePoint.apply(this,arguments)}})}),define("text!templates/basecomponents/vantagepoints/elements/LaunchAppsVantagePointView.html",[],function(){return'<div class="n-title">\n  <span class="lblTitle title">\n    <%= i18n(\'title\') %>\n  </span>\n</div>\n<div class="n-content">\n  <div class="launch-apps-loader">\n    <div class="donut-loader-blue"></div>\n  </div>\n  \x3c!-- Antiscroll --\x3e\n  <div class="antiscroll-wrap">\n    <div class="box-wrap">\n      <div class="antiscroll-inner">\n        <div class="box-inner n-content-inner">\n          <div class="launchAppsContent"></div>\n        </div>\n      </div>\n    </div>\n  </div>\n</div>'}),define("text!templates/basecomponents/vantagepoints/elements/LaunchAppsVantagePointRowView.html",[],function(){return'<div class="item">\n  <div class="app-info">\n    <span class="app-name"><%= app.app_name %></span>\n  </div>\n  <div class="app-alerts">\n    <% if (app.app_health === APP_HEALTH.CRITICAL) { %>\n    <div class="app-alert n-health-icon n-health-status-critical">\n      <%= Components.icon(\'heart\') %>\n    </div>\n    <% } else if (app.app_health === APP_HEALTH.WARNING) { %>\n    <div class="app-alert n-health-icon n-health-status-warning">\n      <%= Components.icon(\'heart\') %>\n    </div>\n    <% } else if (app.app_health === APP_HEALTH.GOOD) { %>\n    <div class="app-alert n-health-icon n-health-status-good">\n      <%= Components.icon(\'heart\') %>\n    </div>\n    <% } %>\n    <div class="app-alert <%= app.critical ? \'\' : \'disabled\' %>">\n      <div class="alert-state-icon -critical"></div>\n      <div class="number"><%= app.critical ? app.critical : 0 %></div>\n    </div>\n    <div class="app-alert <%= app.warning ? \'\' : \'disabled\' %>">\n      <div class="alert-state-icon -warning"></div>\n      <div class="number"><%= app.warning ? app.warning : 0 %></div>\n    </div>\n    <div class="app-alert <%= app.info ? \'\' : \'disabled\' %>">\n      <div class="alert-state-icon -info"></div>\n      <div class="number"><%= app.info ? app.info : 0 %></div>\n    </div>\n  </div>\n  <div class="app-link-launch" data-ip="<%= app.ip %>" title="<%= app.ip %>">\n    <%= Components.icon(\'launch\') %>\n  </div>\n</div>'}),define("views/basecomponents/vantagepoints/elements/LaunchAppsVantagePointView",["views/basecomponents/vantagepoints/elements/BaseVantagePointView","models/genesis/DiscoverNdpV2NodesModel","text!templates/basecomponents/vantagepoints/elements/LaunchAppsVantagePointView.html","text!templates/basecomponents/vantagepoints/elements/LaunchAppsVantagePointRowView.html"],function(e,t,i,n){"use strict";var s={CRITICAL:"critical",WARNING:"warning",GOOD:"good"},a={row:_.template(n),noData:_.template('\n        <div class="item">\n          <%= msg %>\n        </div>\n      '),vantagePoint:_.template(i)};return e.extend({vantagePointCSS:"launch-apps",name:"LaunchAppsVantagePointView",schemaModel:null,displayAttributes:null,vantagePointDetailsModel:null,clusterId:null,initialize:function(i){i=i||{},this.clusterId=i.clusterId,e.prototype.initialize.apply(this,arguments),this.addExtraEvents({"click .app-link-launch":"onClickAction"}),this.discoverNdpV2NodesModel=new t},updateTemplate:function(){this.template=a.vantagePoint(this.vtOptions({}))},onClickAction:function(e){var t=$(e.currentTarget);window.open("http://"+t.attr("data-ip"),"_blank")},renderVantagePoint:function(){var e=this;this.$(".launch-apps-loader").show(),this.discoverNdpV2NodesModel.fetch({success:function(){e._addVantagePointRows(),e.$(".launch-apps-loader").hide()},error:function(){e.$(".launch-apps-loader").hide(),e.$(".launchAppsContent").append(a.noData(e.vtOptions({msg:e.i18n("error_apps_discovery")})))}})},_addVantagePointRows:function(){var e=this,t=this.$(".launchAppsContent"),i=this.discoverNdpV2NodesModel.getApps();i&&0!==i.length?_.each(i,function(i,n){t.append(a.row(e.vtOptions({app:i.response,APP_HEALTH:s})))}):t.append(a.noData(this.vtOptions({msg:this.i18n("no_apps_discovered")}))),this.applyAntiScroll()}})}),define("text!templates/basecomponents/vantagepoints/elements/ReportsVantagePointView.html",[],function(){return'<div class="n-title">\n  <span class="title">\n    <%= i18n(\'title\') %>\n  </span>\n</div>\n<div class="n-content <%= !reportsExist ? \'hidden\' : \'\' %>">\n  <div class="n-wrapper">\n    <div class="n-item">\n      <a class="n-report-action">\n        <span class="n-num"><%= totalReports %></span>\n        <span class="n-text"><%= i18n(\'total_reports\') %></span>\n      </a>\n    </div>\n    <div class="n-item">\n      <a class="n-report-action" data-eb-filter="schedule.schedule_id"\n        data-eb-filter-value="null">\n        <span class="n-num"><%= scheduledReports %></span>\n        <span class="n-text"><%= i18n(\'scheduled_reports\') %></span>\n      </a>\n    </div>\n  </div>\n  <div class="n-all-reports">\n    <a class="n-report-action"><%= i18n(\'view_all_reports\') %></a>\n  </div>\n</div>\n<div class="n-content <%= reportsExist ? \'hidden\' : \'\' %>">\n  <div class="n-no-reports"><%= i18n(\'no_reports\') %></div>\n</div>'}),define("views/basecomponents/vantagepoints/elements/ReportsVantagePointView",["views/basecomponents/vantagepoints/elements/BaseVantagePointView","managers/NavigationManager","models/query/BaseQueryModel","utils/AppConstants","utils/ManagerMixin","utils/FilterUtil","data/DataProperties","data/DataURLConstants","text!templates/basecomponents/vantagepoints/elements/ReportsVantagePointView.html"],function(e,t,i,n,s,a,r,o,l){"use strict";var c=_.template(l);return e.extend({vantagePointCSS:"n-reports",name:"ReportsVantagePointView",reports:{totalReports:0,scheduledReports:0},reportsExist:!1,events:{"click .n-report-action":"onReportClickAction"},updateTemplate:function(){this.template=c(this.vtOptions({totalReports:this.reports.totalReports,scheduledReports:this.reports.scheduledReports,reportsExist:this.reportsExist})),this.$el.html(this.template),this._renderView()},updateDataModels:function(){var e={};e[i.DP.ENTITY_TYPE]=n.ENTITY_REPORT_CONFIG,e[i.DP.GROUP_MEMBER_ATTRIBUTES]=[r.EB.REPORT_CONFIG.SCHEDULE_ID];var t=s.getEntityManager().createGenericEntityCollection(n.ENTITY_REPORT_CONFIG,null,o.ENTITY_BROWSER_QUERY,e);this.registerDataModel(t,this,this.renderSuccess,this.renderError)},renderSuccess:function(e){this.result=e.models,this.result.length&&(this.reportsExist=!0),this.reports.totalReports=this.result.length;var t=this.result.filter(function(e){return null!==e.attributes[r.EB.REPORT_CONFIG.SCHEDULE_ID]});this.reports.scheduledReports=t.length,this.updateTemplate()},onReportClickAction:function(e){if(this.isInPreviewMode())return void e.stopPropagation();var i={},s=$(e.currentTarget);s.data(n.NAV_EB_FILTER_NAME)&&(i=a.addFilterCondition(i,s.data(n.NAV_EB_FILTER_NAME),a.createFilterCondition(n.ENTITY_REPORT_CONFIG,s.data(n.NAV_EB_FILTER_NAME),n.FILTER_OPERATORS.DCONTAINS,s.data(n.NAV_EB_FILTER_VALUE)))),t.navigateToEBPage(n.ENTITY_REPORT_CONFIG,null,null,null,i)}})}),define("utils/VantagePointFactory",["data/DataProperties","utils/AppConstants","managers/ClusterManager","managers/I18nManager"],function(e,t,i,n){"use strict";return{getVantagePointView:function(n,s,a){var r=this;switch(n.get(e.VP_TYPE)){case t.VP_TYPE.USAGE:require(["views/basecomponents/vantagepoints/elements/metric/UsageVantagePointView"],function(e){r._invokeWidgetView(e,n,s,a)});break;case t.VP_TYPE.PERFORMANCE:require(["views/basecomponents/vantagepoints/elements/metric/PerformanceVantagePointView"],function(e){r._invokeWidgetView(e,n,s,a)});break;case t.VP_TYPE.ENTITY:require(["views/basecomponents/vantagepoints/elements/entity/EntityVantagePointView"],function(e){r._invokeWidgetView(e,n,s,a)});break;case t.VP_TYPE.SUMMARY_HOME:case t.VP_TYPE.SUMMARY:require(["views/basecomponents/vantagepoints/elements/summary/SummaryVantagePointView"],function(e){r._invokeWidgetView(e,n,s,a)});break;case t.VP_TYPE.FEATURE:require(["views/basecomponents/vantagepoints/elements/feature/FeatureVantagePointView"],function(e){r._invokeWidgetView(e,n,s,a)});break;case t.VP_TYPE.TOP_METRIC:require(["views/basecomponents/vantagepoints/elements/metric/TopMetricVantagePointView"],function(e){r._invokeWidgetView(e,n,s,a)});break;case t.VP_TYPE.RESOURCE:require(["views/basecomponents/vantagepoints/elements/resource/ResourceVantagePointView"],function(e){r._invokeWidgetView(e,n,s,a)});break;case t.VP_TYPE.EVENT:require(["views/basecomponents/vantagepoints/elements/alertevent/AlertEventVantagePointView"],function(e){r._invokeWidgetView(e,n,s,a)});break;case t.VP_TYPE.ALERT:case t.VP_TYPE.PC_ALERT:require(["views/basecomponents/vantagepoints/elements/alertevent/AlertVantagePointView","views/basecomponents/vantagepoints/elements/alertevent/AlertEventVantagePointView"],function(e,o){var l;l=i.isClusterFFEnabled(t.FFLAGS.SUPPORT_PAGINATION)?e:o,r._invokeWidgetView(l,n,s,a)});break;case t.VP_TYPE.LIST:require(["views/basecomponents/vantagepoints/elements/ListVantagePointView"],function(e){r._invokeWidgetView(e,n,s,a)});break;case t.VP_TYPE.TABLE:require(["views/basecomponents/vantagepoints/elements/TableVantagePointView"],function(e){r._invokeWidgetView(e,n,s,a)});break;case t.VP_TYPE.ACTION:require(["views/basecomponents/vantagepoints/elements/action/ActionVantagePointView"],function(e){r._invokeWidgetView(e,n,s,a)});break;case t.VP_TYPE.QUICK_ACCESS:require(["views/basecomponents/vantagepoints/elements/ClusterQuickAccessVantagePointView"],function(e){r._invokeWidgetView(e,n,s,a)});break;case t.VP_TYPE.RP_STATUS:require(["views/basecomponents/vantagepoints/elements/RPStatusVantagePointView"],function(e){r._invokeWidgetView(e,n,s,a)});break;case t.VP_TYPE.PROTECTION_STATUS:require(["views/basecomponents/vantagepoints/elements/ProtectionStatusVantagePointView"],function(e){r._invokeWidgetView(e,n,s,a)});break;case t.VP_TYPE.VM_EFFICIENCY:require(["views/basecomponents/vantagepoints/elements/VMEfficiencyVantagePointView"],function(e){r._invokeWidgetView(e,n,s,a)});break;case t.VP_TYPE.LAUNCH_APPS:require(["views/basecomponents/vantagepoints/elements/LaunchAppsVantagePointView"],function(e){r._invokeWidgetView(e,n,s,a)});break;case t.VP_TYPE.REPORTS:require(["views/basecomponents/vantagepoints/elements/ReportsVantagePointView"],function(e){r._invokeWidgetView(e,n,s,a)});break;default:require(["views/basecomponents/vantagepoints/elements/BaseVantagePointView"],function(e){r._invokeWidgetView(e,n,s,a)})}},_invokeWidgetView:function(e,i,s,a){var r=i.get("name");a(new e({model:i,title:n.t(t.I18N_NAMES.base_vantage_point_view,r,r),customizable:s}))}}}),define("views/basecomponents/vantagepoints/DashboardView",["gridster","views/basecomponents/BaseView","views/basecomponents/vantagepoints/VantagePointTemplates","views/basecomponents/vantagepoints/VantagePointLayoutDescriptor","data/DataProperties","utils/AppConstants","utils/AppUtil","utils/SubViewHelper","utils/VantagePointFactory","events/AppEvents","managers/ClusterManager","managers/DashboardManager","managers/ActionManager","managers/NotificationManager","managers/LicenseManager","managers/NavigationManager","managers/I18nManager"],function(e,t,i,n,s,a,r,o,l,c,u,d,h,p,T,E,S){"use strict";var g={resize_widget_dimensions:function(e){return e.widget_margins&&(this.options.widget_margins=e.widget_margins),e.widget_base_dimensions&&(this.options.widget_base_dimensions=e.widget_base_dimensions),this.$widgets.each($.proxy(function(e,t){var i=$(t);this.resize_widget(i)},this)),this.$widgets.sort(function(e,t){var i=$(e),n=$(t),s=parseInt(i.attr("data-row"),10),a=parseInt(n.attr("data-row"),10),r=parseInt(i.attr("data-col"),10),o=parseInt(n.attr("data-col"),10);return s>a||s===a&&r<o?1:-1}),this.generate_grid_and_stylesheet(),this.get_widgets_from_DOM(),this.set_dom_grid_height(),!1},add_style_tag:function(e){var t=document,i=t.createElement("style");return t.getElementsByTagName("head")[0].appendChild(i),i.setAttribute("type","text/css"),i.setAttribute("generated-from","gridster"),$('head [generated-from="gridster"]:not(:last)').remove(),i.styleSheet?i.styleSheet.cssText=e:i.appendChild(document.createTextNode(e)),this},generate_stylesheet:function(e){var t,i="",n=this.options.max_size_x;for(e=e||{},e.cols=e.cols||this.cols,e.rows=e.rows||this.rows,e.namespace=e.namespace||this.options.namespace,e.widget_base_dimensions=e.widget_base_dimensions||this.options.widget_base_dimensions,e.widget_margins=e.widget_margins||this.options.widget_margins,e.min_widget_width=2*e.widget_margins[0]+e.widget_base_dimensions[0],e.min_widget_height=2*e.widget_margins[1]+e.widget_base_dimensions[1],t=e.cols;t>=0;t--)i+=e.namespace+' [data-col="'+(t+1)+'"] { left:'+(t*e.widget_base_dimensions[0]+t*e.widget_margins[0]+(t+1)*e.widget_margins[0])+"px;} ";for(t=e.rows;t>=0;t--)i+=e.namespace+' [data-row="'+(t+1)+'"] { top:'+(t*e.widget_base_dimensions[1]+t*e.widget_margins[1]+(t+1)*e.widget_margins[1])+"px;} ";for(var s=1;s<=e.rows;s++)i+=e.namespace+' [data-sizey="'+s+'"] { height:'+(s*e.widget_base_dimensions[1]+(s-1)*(2*e.widget_margins[1]))+"px;}";for(var a=1;a<=n;a++)i+=e.namespace+' [data-sizex="'+a+'"] { width:'+(a*e.widget_base_dimensions[0]+(a-1)*(2*e.widget_margins[0]))+"px;}";return this.add_style_tag(i)},add_widget:function(e,t,i,n,s,a){var r;t=t||1,i=i||1,!n&!s?r=this.next_position(t,i):(r={col:n,row:s},this.empty_cells(n,s,t,i));var o=$(e).attr({"data-col":r.col,"data-row":r.row,"data-sizex":t,"data-sizey":i,"data-id":a}).addClass("gs_w").appendTo(this.$el).hide();return this.$widgets=this.$widgets.add(o),this.register_widget(o),this.add_faux_rows(r.size_y),this.set_dom_grid_height(),o.fadeIn()},get_all_widgets:function(){return this.$widgets},destroyGridster:function(){this.drag_api&&(this.drag_api.destroy(),this.$el.removeData("drag")),this.$el.removeData("gridster"),this.$el.empty()},move_widget_down:function(e,t){if(t<=0)return!1;var i=e.coords().grid,n=i.row,s=[],a=t;if(!e)return!1;if(-1===$.inArray(e,s)){var r=e.coords().grid,o=n+t,l=this.widgets_below(e);this.remove_from_gridmap(r),l.each($.proxy(function(e,t){var i=$(t),n=i.coords().grid,s=this.displacement_diff(n,r,a);s>0&&this.move_widget_down(i,s)},this)),r.row=o,this.update_widget_position(r,e),e.attr("data-row",r.row),this.$changed=this.$changed.add(e),s.push(e)}}};return $.extend($.Gridster,g),t.extend({WIDTH_SMALL_VP:1e3,STYLE_SMALL_VP:"n-body-vantage-point-small",addWidget:_.template('<div class="n-dashboard-addwdgt">'+S.t("DashboardView","empty_dash")+'<br><a class="btnPageAction" stream-action="Dashboards: AddWidgets" stream-target="Dashboard"<%= actionAttributes %> ><span>'+S.t("DashboardView","add_widgets")+"</span></a></div>"),perspectiveGrid:null,name:"DashboardView",dashboard:null,isCustomizable:null,isDragging:!1,subViewHelper:null,_previousWidth:null,events:{"click .n-widget-close":"onVantagePointClose","mouseover .n-vantage-point .n-title":"onMouseOverVantagePointTitle","mouseout .n-vantage-point .n-title":"onMouseOutVantagePointTitle"},initialize:function(e){this.dashboard=e.dashboard,this.isCustomizable=e.customizable||!1,this.isCustomizable&&!T.isPrismProFeaturesEnabled()&&(this.isCustomizable=!1),d.setCurrentDashboard(this.dashboard),this.model=d.getCurrentDashboard(),this.subViewHelper=new o,this.template=i.DASHBOARD({gridId:this.model.get(this.model.DP.GRID_ID),isCustomizable:this.isCustomizable}),_.bindAll(this,"resetToDefault","resetAllToDefault","render","addVantagePointToDashboard","renderDashboard"),this.render()},render:function(){this.$el.html(this.template),this.renderDashboard()},show:function(e){d.setCurrentDashboard(this.dashboard),$(window).trigger("resize.app")},destroy:function(){this.perspectiveGrid&&(this.perspectiveGrid.destroyGridster(),this.perspectiveGrid=null),this.subViewHelper.removeAll(),this.subViewHelper=null,d.unregisterDashboardListener(d.EVENTS.REFRESH_DASHBOARD,this.renderDashboard,this),d.unregisterDashboardListener(d.EVENTS.DELETE_DASHBOARD,this.renderDashboard,this),d.unregisterDashboardListener(d.EVENTS.ADD_VANTAGEPOINT,this.addVantagePointToDashboard,this),d.unregisterDashboardListener(d.EVENTS.ERROR,this._showErrorNotification,this),d.unregisterDashboardListener(d.EVENTS.SUCCESS,this._showSuccessNotification,this),t.prototype.destroy.apply(this,arguments)},renderDashboard:function(e,t){var i=d.getVantagePoints();this.perspectiveGrid?(this.perspectiveGrid.destroyGridster(),this.subViewHelper.removeAll(),this._createGrid(i)):this._createGrid(i)},_createGrid:function(e){var t,r,o;t=n.getDashboardGridsterLayout(this.$el);var l=this;if(this.perspectiveGrid=this.$(".n-dashboard > ul").gridster({widget_margins:[t.margin_horizontal,t.margin_vertical],widget_base_dimensions:[t.block_width,t.block_height],min_rows:t.min_rows,min_cols:t.min_cols,max_size_x:t.max_size_x,max_size_y:t.max_size_y,draggable:{
stop:_.bind(l.onDragStop,l),start:_.bind(l.onDragStart,l)}}).data("gridster"),this.perspectiveGrid&&this.perspectiveGrid.disable(),e){var c={};e.each(function(e){c[e.get(s.ID)]=n.getVantagePointLayout(e)});var u=e.models.sort(function(e,t){var i=c[e.get(s.ID)],n=c[t.get(s.ID)],a=parseInt(i.row),r=parseInt(n.row),o=parseInt(i.col),l=parseInt(n.col);return a>r||a===r&&o<l?1:-1}),d=!1;_.each(u,function(e){if(!1!==e.get(e.DP.AUTO_ADD)){if(r=c[e.get(s.ID)],!0===e.get(e.DP.AUTO_ADD)&&!e.get(e.DP.POSITION)){var t=this.perspectiveGrid.next_position(r.size_x,r.size_y);r.row=t.row,r.col=t.col,e.set(e.DP.POSITION,{x:t.col,y:t.row}),d=!0;var n=e.get(e.nameAttribute);p.showClientNotification(a.NOTIFY_SUCCESS,this.i18ns("auto_add_widget",this.i18nStatic("AddVantagePointPopupView",n,n)))}o=this.perspectiveGrid.add_widget(i.VANTAGE_POINT_WIDGET,r.size_x,r.size_y,r.col,r.row,e.get(s.ID)),this._createVantagePointSubView(e,o)}},this),d&&this._saveCurrentLayout()}null!==e&&0!==e.length||this._showAddWidgetReminder()},_showAddWidgetReminder:function(){if(T.isPrismProFeaturesEnabled()){var e=this.addWidget({actionAttributes:r.createActionAttr(a.ENTITY_DASHBOARD_VP_ADD,a.ACTION_ADD_WIDGET)});this.btnAddWidget=$(e).appendTo(this.$(".n-vantage-grid")),this.btnAddWidget.find(".btnPageAction").on("click",function(e){h.executeActionElement(e.currentTarget)})}},_saveCurrentLayout:function(){var e=d.getVantagePoints();this._changedGrid(e)},_changedGrid:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.perspectiveGrid){var i=this,n={};_.each(i.perspectiveGrid.get_all_widgets(),function(e){n[$(e).attr("data-id")]={x:$(e).attr("data-col"),y:$(e).attr("data-row")}}),_.each(e.models,function(e){var t=e.getId();n[t]?(e.get(e.DP.POSITION).x=n[t].x,e.get(e.DP.POSITION).y=n[t].y):r.logDebug("DashboardView | _changedGrid | Not able to set the position of vantagepoint "+t)},this)}d.saveVantagePoints(e,t)},_createVantagePointSubView:function(e,t){var i=this;l.getVantagePointView(e,this.isCustomizable,function(n){n&&(n.gridId=i.model.get(i.model.DP.GRID_ID),i.subViewHelper.register(e.get("id"),n),t.html(n.render().$el),i.delegateVantagePointEvents(n),n.startServices())})},_showSuccessNotification:function(e,t){p.showClientNotification(a.NOTIFY_SUCCESS,t)},_showErrorNotification:function(e,t){p.showClientNotification(a.NOTIFY_ERROR,t)},addVantagePointToDashboard:function(e){if(this.perspectiveGrid){var t=n.getVantagePointLayout(e),a=this.perspectiveGrid.add_widget(i.VANTAGE_POINT_WIDGET,t.size_x,t.size_y,t.col,t.row,e.get(s.ID));this._createVantagePointSubView(e,a),this.btnAddWidget&&this.btnAddWidget.remove()}},onDragStart:function(){this.isDragging=!0,this.$(".n-vantage-point-holder.dragging").addClass("-dragging")},onDragStop:function(){var e=this;r.onTransitionEnd(this.$(".n-vantage-point-holder.-dragging"),function(t){t.removeClass("-dragging"),e.isDragging=!1,e.perspectiveGrid.disable(),e._saveCurrentLayout()})},onVantagePointClose:function(e){$.nutanixConfirm({context:this,msg:this.i18n("confirm_remove_message","Do you want to remove the selected widget from this dashboard?"),yes:function(){var t=$(e.currentTarget),i=t.closest(".n-vantage-point-holder");this.$(".n-dashboard > ul").gridster().data("gridster").remove_widget(i,!1,_.bind(this._saveGridAfterRemoval,this))}})},onMouseOverVantagePointTitle:function(e){this.isCustomizable&&this.perspectiveGrid&&this.perspectiveGrid.enable()},onMouseOutVantagePointTitle:function(e){this.isCustomizable&&this.perspectiveGrid&&!this.isDragging&&this.perspectiveGrid.disable()},resetToDefault:function(e){$.nutanixConfirm({context:this,msg:this.i18n("confirm_reset_message","Are you sure you want to reset this dashboard?"),yes:function(){d.resetDashboardToDefault(this.dashboard),e.stopPropagation()}})},resetAllToDefault:function(e){e.stopPropagation();var t=!1;$.nutanixConfirm({context:this,msg:"This will remove all the custom dashboards and reset the main dashboard to initial state. <br/> Do you want to proceed ?",yes:function(){var e=this;t||(r.addFullPageLoader("Resetting Dashboards..."),t=!0,d.resetAllDashboardsToDefault().done(function(){var t;t=u.isMulticlusterUI()?a.PAGE_MC_DASHBOARD:a.PAGE_DASHBOARD,E.navigateToPage(t,null,null,!0),d.triggerEvent(d.EVENTS.REFRESH_DASHBOARD),p.showClientNotification(a.NOTIFY_SUCCESS,e.i18n("success_reset_dashboards"))}).fail(function(){p.showClientNotification(a.NOTIFY_ERROR,e.i18n("error_reset_dashboards"))}).always(function(){r.removeFullPageLoader()}))}})},_saveGridAfterRemoval:function(e){var t=e.attr("data-id"),i=d.getVantagePoints(),n=d.getCurrentDashboard();_.each(i.models,function(e){var a=e.get(s.ID);a===t&&(n.disableVantagePointAutoAdd(e),i.remove(e,{silent:!0}),this.subViewHelper.get(a).stopServices())},this),this._changedGrid(i,!0),0===i.length&&this._showAddWidgetReminder()},onChangeSize:function(e,t){t.model.set({size:e});var i=n.getVantagePointLayout(t.model),s=t.$el.parent();this.perspectiveGrid.resize_widget(s,i.size_x,i.size_y)},delegateVantagePointEvents:function(e){var t=_.bind(this.onChangeSize,this);e.off("changesize"),e.on("changesize",t)},undelegateVantagePointEvents:function(e){e.off("changesize")},onStartServices:function(){this.delegateEvents(),_.each(this.subViewHelper.getIds(),function(e){if(this.subViewHelper.get(e)){var t=this.subViewHelper.get(e);t.startServices(),this.delegateVantagePointEvents(t)}},this),c.onAppEvent(c.RESET_TO_DEFAULT,this.resetToDefault),c.onAppEvent(c.RESET_ALL_TO_DEFAULT,this.resetAllToDefault),d.registerDashboardListener(d.EVENTS.REFRESH_DASHBOARD,this.renderDashboard,this),d.registerDashboardListener(d.EVENTS.DELETE_DASHBOARD,this.renderDashboard,this),d.registerDashboardListener(d.EVENTS.ADD_VANTAGEPOINT,this.addVantagePointToDashboard,this),d.registerDashboardListener(d.EVENTS.ERROR,this._showErrorNotification,this),d.registerDashboardListener(d.EVENTS.SUCCESS,this._showSuccessNotification,this)},onStopServices:function(){this.undelegateEvents(),_.each(this.subViewHelper.getIds(),function(e){if(this.subViewHelper.get(e)){var t=this.subViewHelper.get(e);t.stopServices(),this.undelegateVantagePointEvents(t)}},this),c.offAppEvent(c.RESET_TO_DEFAULT,this.resetToDefault),c.offAppEvent(c.RESET_ALL_TO_DEFAULT,this.resetAllToDefault),d.unregisterDashboardListener(d.EVENTS.REFRESH_DASHBOARD,this.renderDashboard,this),d.unregisterDashboardListener(d.EVENTS.DELETE_DASHBOARD,this.renderDashboard,this),d.unregisterDashboardListener(d.EVENTS.ADD_VANTAGEPOINT,this.addVantagePointToDashboard,this),d.unregisterDashboardListener(d.EVENTS.ERROR,this._showErrorNotification,this),d.unregisterDashboardListener(d.EVENTS.SUCCESS,this._showSuccessNotification,this)},refreshView:function(){this.subViewHelper.iterate("refreshView")},onResize:function(){if(this.$el.width()<=this.WIDTH_SMALL_VP?$("body").hasClass(this.STYLE_SMALL_VP)||$("body").addClass(this.STYLE_SMALL_VP):$("body").removeClass(this.STYLE_SMALL_VP),this.perspectiveGrid){var e=n.getBlockDimension(this.$el),t={widget_base_dimensions:[e.width,e.height]};this.perspectiveGrid.resize_widget_dimensions(t),this.subViewHelper.iterate("onResize")}this._previousWidth=this.$el.width()}})}),define("views/pages/multicluster/home/MulticlusterDashboardPageView",["views/basecomponents/pages/BasePageView","views/pages/multicluster/home/details/ClusterTabDetailsView","views/basecomponents/vantagepoints/DashboardView","managers/DashboardManager","managers/NotificationManager","managers/NavigationManager","utils/AppUtil","utils/AppConstants","events/AppEvents"],function(e,t,i,n,s,a,r,o,l){"use strict";return e.extend({CUSTOM_DASHBOARD_LOAD_WAIT_PERIOD:300,pageId:o.PAGE_MC_DASHBOARD,defaultSubPageId:o.SUBPAGE_PERSPECTIVE,isCustomDashboardsEnabled:!1,initialize:function(){e.prototype.initialize.apply(this,arguments),this.isCustomDashboardsEnabled=n.isCustomDashboardsEnabled(),_.bindAll(this,"refreshView")},destroy:function(){l.offAppEvent(l.MULTICLUSTER_CLUSTERS_CHANGE,this.refreshView),n.unregisterDashboardListener(n.EVENTS.DELETE_DASHBOARD,this.onRemoveDashboard,this),e.prototype.destroy.apply(this,arguments)},showSubPage:function(e){n.isCustomDashboardsEnabled()?this.checkIfCustomDashboardsLoaded(e):this.loadSubPage(e)},loadSubPage:function(t){t=t||{};var i=t.subPageId;i&&i!==this.defaultSubPageId&&!n.getCustomDashboardById(i)&&(t.subPageId=this.defaultSubPageId,s.showClientNotification(o.NOTIFY_ERROR,"The dashboard you requested may have been deleted.")),e.prototype.showSubPage.call(this,t)},checkIfCustomDashboardsLoaded:function(e,t){var i=this;n.isInitialFetchComplete()?(r.removeFullPageLoader(),i.loadSubPage(e)):i.showLoader(e,t)},showLoader:function(e,t){t||r.addFullPageLoader("Loading Dashboards...");var i=this;setTimeout(function(){i.checkIfCustomDashboardsLoaded(e,!0)},i.CUSTOM_DASHBOARD_LOAD_WAIT_PERIOD)},onShowSubPage:function(e,t){var n=this.getSubView(e);if(!n){var s,a=this.getSubPageElement(e);e===o.SUBPAGE_PERSPECTIVE?s=o.PERSPECTIVE_DELOS:this.isCustomDashboardsEnabled&&(s=e,this._checkAndCreateSubPageElement(a,e)),n=this.registerSubView(e,new i({el:this.getSubPageElement(e),dashboard:s,customizable:this.isCustomDashboardsEnabled}))}n&&n.show(t)},onChangeDetailsPane:function(e){var i=this.getSubView(o.SUBPAGE_COMPONENT_DETAILS);i||(i=this.registerSubView(o.SUBPAGE_COMPONENT_DETAILS,new t({el:this.getDetailsElement()}))),i.show(e)},onStartServices:function(){l.onAppEvent(l.MULTICLUSTER_CLUSTERS_CHANGE,this.refreshView),n.registerDashboardListener(n.EVENTS.DELETE_DASHBOARD,this.onRemoveDashboard,this),e.prototype.onStartServices.apply(this,arguments)},onStopServices:function(){l.offAppEvent(l.MULTICLUSTER_CLUSTERS_CHANGE,this.refreshView),n.unregisterDashboardListener(n.EVENTS.DELETE_DASHBOARD,this.onRemoveDashboard,this),e.prototype.onStopServices.apply(this,arguments)},onRemoveDashboard:function(e){e.getId()===this.currentSubPageId&&this._navigateToDefaultSubPage()},_checkAndCreateSubPageElement:function(e,t){!e.length&&n.getCustomDashboardById(t)&&this.addSubPageElement(t)},_navigateToDefaultSubPage:function(){a.navigateToPage(this.pageId,this.defaultSubPageId)},onResize:function(){e.prototype.onResize.apply(this,arguments),this.subNavigationView.onResize()}})}),define("views/pages/dashboard/DashboardPageView",["views/basecomponents/pages/BasePageView","views/basecomponents/vantagepoints/DashboardView","managers/DashboardManager","managers/AccessManager","utils/AppConstants"],function(e,t,i,n,s){"use strict";return e.extend({pageId:s.PAGE_DASHBOARD,defaultSubPageId:s.SUBPAGE_PERSPECTIVE,onShowSubPage:function(e,n){var a=this.getSubView(e);if(!a){var r=s.PERSPECTIVE_DASHBOARD,o=this.getSubPageElement(e),l=this._isCustomDashboardsEnabled();e!==s.SUBPAGE_PERSPECTIVE&&(r=e),e===s.SUBPAGE_PERSPECTIVE&&l&&this._checkAndCreateDashboard(r),!o.length&&i.getCustomDashboardById(e)&&(o=this.addSubPageElement(e)),a=this.registerSubView(e,new t({el:o,dashboard:r,customizable:l}))}a.show(n)},_isCustomDashboardsEnabled:function(){return n.isFFEnabled(s.FFLAGS.CUSTOM_DASHBOARDS)&&this.canModifyByEntityType(s.ENTITY_DASHBOARD)},_checkAndCreateDashboard:function(e){i.getCustomDashboardById(e)||i.savePreDefinedDashboard(e)}})}),define("views/pages/ui_template/UITemplateIFramePageView",["views/basecomponents/pages/BasePageView","views/basecomponents/iframe/IFrameView","utils/AppConstants","managers/UITemplateManager"],function(e,t,i,n){"use strict";return e.extend({name:"UITemplateIFramePageView",pageId:i.PAGE_UI_TEMPLATE_IFRAME,defaultSubPageId:i.SUBPAGE_BLANK,iFrameView:null,setPageViewOptions:function(e){e.overridePageId&&(this.pageId=e.overridePageId)},onShowSubPage:function(e,i){if(e=e||this.subPageId,i=i||this.queryOptions,!this.iFrameView){var s=n.getPageDescriptor(this.pageId);this.iFrameView=new t({iFrameId:"uiTemplateIFrame_"+this.pageId,url:s.url,width:"100%",height:"100%"}),this.$el.html(this.iFrameView.render().el)}this.$el.addClass("page-ui-template-iframe")},destroy:function(){this.iFrameView&&(this.iFrameView.destroy(),this.iFrameView=null),e.prototype.destroy.apply(this,arguments)}})}),define("text!templates/pages/authorize/AuthorizePageView.html",[],function(){return'<div class="n-authorize-page">\n  <p class="main"><%= i18n(\'mainText\', \'Prism App Access Request\') %></p>\n  <p class="sub"><%= i18n(\'subText\', \'The Prism App would like to connect to \'+\n    \'your account. Allow access?\') %></p>\n  <p class="n-button-controls">\n    <button id="btnDeny" type="button" class="btn btn-danger btn-lg">\n      Deny Access</button>\n    <button id="btnAllow" type="button" class="btn btn-primary btn-lg">\n      Allow Access</button>\n  </p>\n</div>\n\n\x3c!-- We do a submit form action because of the Oauth2 standard library --\x3e\n<form id="formOauth" action="/api/nutanix/v3/oauth/authorize" method="post">\n  <input type="hidden" name="client_id" value="<%= options.client_id %>">\n  <input type="hidden" name="scope" value="<%= options.scope %>">\n  <input type="hidden" name="response_type" value="code">\n  <input type="hidden" name="confirm" value="" id="formInputConfirm">\n  <input type="hidden" name="state" value="<%= options.state %>">\n</form>\n'}),define("views/pages/common/AuthorizePageView",["views/basecomponents/pages/BasePageView","utils/AppUtil","text!templates/pages/authorize/AuthorizePageView.html"],function(e,t,i){"use strict";return e.extend({name:"AuthorizePageView",pageId:"authorize",options:null,compiledTemplate:_.template(i),events:{"click  #btnAllow":"onClickAllow","click  #btnDeny":"onClickDeny"},setPageViewOptions:function(e){e&&e.reason&&(this.reason=e.reason)},onShowSubPage:function(e,i){this.options=t.parseQueryToObject(i),this.$el.html(this.compiledTemplate(this.vtOptions({options:this.options})))},submitOauthForm:function(e){this.$("#formInputConfirm").val(e?"yes":"no"),this.$("#formOauth").submit()},onClickAllow:function(){this.submitOauthForm(!0)},onClickDeny:function(){this.submitOauthForm(!1)}})}),define("views/pages/common/AccessDeniedPageView",["views/basecomponents/pages/BasePageView","managers/NavigationManager","utils/AppConstants","utils/CommonTemplates","utils/SVG"],function(e,t,i,n,s){"use strict";return e.extend({pageId:i.PAGE_ACCESS_DENIED,defaultSubPageId:i.SUBPAGE_PERSPECTIVE,reason:null,actionLink:null,events:{"click  .linkHome":"onClickHomePageLink"},setPageViewOptions:function(e){e&&e.reason&&(this.reason=e.reason,this.actionLink=e.actionLink)},onShowSubPage:function(e,t){this.getSubView(i.SUBPAGE_PERSPECTIVE)||this.getSubPageElement(i.SUBPAGE_PERSPECTIVE).html(n.ERROR_SOMETHING_IS_WRONG({SVG:s,mainText:this.reason||this.i18nStatic("Common","AccessDeniedReasons.notFound"),subText:"",actionLinks:this.actionLink||'<a class="n-link linkHome">Return to the home page.</a>'}))},onClickHomePageLink:function(){this.isMulticlusterPageUuid()?t.navigateToPage(i.PAGE_MC_DASHBOARD,null,null,!0):t.navigateToPage(i.PAGE_DASHBOARD,null,null,!0)}})}),define("views/basecomponents/BaseAppView",["jquery","jqueryplugins","views/basecomponents/BaseView","text!templates/pages/AppView.html","models/app/AppModel","views/login/LoginView","views/notification/NotificationView","views/notification/NotificationBarView","views/header/HeaderView","views/basecomponents/pages/fulldetails/FullDetailsPageView","views/navigation/MenuDescriptor","managers/AppManager","managers/LoginManager","managers/NamespaceManager","managers/NavigationManager","managers/ClusterManager","managers/AjaxManager","managers/PrismElementManager","managers/IdleManager","managers/UserBehaviorManager","managers/NotificationManager","managers/AccessManager","managers/TaskManager","broker/managers/BrokerManager","managers/ExploreManager","managers/UITemplateManager","data/DataManager","data/DataURLConstants","utils/AppConstants","utils/AppUtil","utils/SubViewHelper","utils/SVG","data/DataProperties","events/AppEvents"],function(e,t,i,n,s,a,r,o,l,c,u,d,h,p,T,E,S,g,A,m,f,I,C,v,R,N,P,O,y,D,M,b,L,w){"use strict";return i.extend({name:"BaseAppView",MAX_PAGE_LIMIT:6,SUB_VIEW_ENTITY_DETAILS:"entity-details-view",appModel:null,el:"body",elContent:"#n-content-wrapper",elPage:"#n-ctr-page",loginView:null,headerView:null,notificationView:null,subViewHelper:null,currentPageUuid:null,isLoginPrevious:!1,isInitialized:!1,isHeaderToRestart:!1,modelEvents:{"change.route appModel":"onChangePageRoute"},events:{mouseover:"restartIdleManager",keypress:"restartIdleManager","click [stream-action]":"registerUserActivity"},initialize:function(){S.initialize(),P.initialize(),E.initialize(),m.initialize(),T.initialize(),this.appModel=this.initializeAppModel(),this.subViewHelper=new M,this.initializeManagers(),this.preInitialize(),this.registerAppEvents(),_.bindAll(this,"renderPageView","onResize","onEntityEvent","stopPreloader")},startAppServices:function(){this.startServices()},preInitialize:function(){},initializeManagers:function(){},registerAppEvents:function(){},initializeAppModel:function(e){return new s(e)},initializeLoginView:function(e){return new a(e)},renderInit:function(e,t,i){if(!e&&v.isSubAppRoute()&&(e={},e.pageId=y.PAGE_BROKER,e.subPageId=v.getSubAppName()),D.isIFrameModeActivated()){D.log("AppView : Prism Element iFrame has been activated!");var n=this;D.setIntervalWithTimeout({intervalPeriod:300,timeoutPeriod:3e4,timeoutHandler:function(){D.log("AppView Error : The stand alone Prism Element did not have the PrismCentral namespace.")},intervalHandler:function(){if(g.isLoadedFromPrismCentral())return D.log("AppView : The PrismCentral namespace has been successfully instantiated by the Prism Element container."),d.setEnvironmentMode(d.ENV_MODE.PE),n.checkLoginSessionIsActive(e,t,i),!0}})}else D.log("AppView: This is a stand alone Prism UI."),this.checkLoginSessionIsActive(e,t,i)},checkLoginSessionIsActive:function(e,t,i){var n=this;h.checkLoginSession(function(){e?n.showPage(e):t?n.showAction(t):i&&n.appModel.initialized?n.showFullPageDetailPane(i):n.showPage({})},function(t){h.checkParameters();var i=y.ROUTE_LOGIN;if(e&&e.pageId===y.PAGE_AUTHORIZE){var n=D.parseQueryToObject(e.options);i+=_.template(O.AUTHORIZE,{options:n?D.formatObjectToQuery(n):""})}else{var s=D.getHashParameters(),a=y.IDENTITY_PROVIDER.IDP_ERROR_PARAM;s&&s[a]&&(i+="?"+a+"="+s[a])}T.navigateToRoute(i)})},render:function(){this.$el.css("background-color","#ffffff"),D.hasLocalStorage()&&localStorage[y.LOCAL_STORAGE.CONTRAST_SETTING]&&e("body").addClass(localStorage[y.LOCAL_STORAGE.CONTRAST_SETTING]);var t=_.template(n);this.stopPreloader(),this.removeLoginBackground(),e("body").prepend(b.loadSVG(b.ICONS)),this.$(this.elContent).append(t),this.executeHeader(),this.notificationView=new r({el:this.$("#n-ctr-notification")}),this.notificationBarView=new o({el:this.$("#n-notification-bar")}),this.startAppServices(),this.isViewRendered=!0,this.bodyTagClassify(),this.htmlTagClassify(),this.updatePageTitle(),D.showLoader(),E.startServices(),this._checkPrismElementIFrame(),A.initialize(),this.postRender()},preRender:function(){},postRender:function(){},_checkPrismElementIFrame:function(){g.isLoadedFromPrismCentral()&&(g.updatePrismCentralLoadingStatus(!0),g.updatePrismCentralPageTitle())},renderLogin:function(e,t){null!==h.isLoggedIn()&&!0!==h.isLoggedIn()&&(this.isLoginPrevious=!0,this.loginView||(this.loginView=this.initializeLoginView({el:this.$el,stopPreloader:this.stopPreloader}),this.loginView.setOptions(t),this.loginView.setForwardRoute(e),this.loginView.render()))},renderLogout:function(e,t){this.sendUserActivityLogs();var i=this;h.logout(function(){i.stopServices(),i.hideContent(),i.invokeLoginUrl(t)},function(e){D.log("Logout failed: "+e),i.invokeLoginUrl(t)})},invokeLoginUrl:function(e){T.refreshToBaseURL(e)},executeHeader:function(){this.headerView=this.createHeaderView(this.$("#n-header"),this.appModel)},createHeaderView:function(e,t){return new l({el:e,appModel:t})},createFullDetailsPageView:function(e,t){return new c({el:e,detailPaneRoute:t})},showPage:function(e){var t=this;this._showPageContainer(y.PAGE_CONTAINERS.PAGE,function(){var e=t.subViewHelper.get(t.SUB_VIEW_ENTITY_DETAILS);e&&(e.stopServices(),t.subViewHelper.remove(t.SUB_VIEW_ENTITY_DETAILS),e.off(),e.destroy(),e=null)}),this._prepareForDisplay(),this.appModel.setCurrentPageRoute(e)},showFullPageDetailPane:function(e){var t=_.extend({entityId:e.actionTargetId,entityType:e.actionTarget,entityName:e.actionTargetName,targetTabId:e.targetTabId},e),i=this;if(!this.appModel.initialized){var n=_.clone(t),s=function(){T.navigateToFullScreenDetailsPane(n.entityType,n.entityId,n.contextId,n.targetTabId),i.off(w.APP_VIEW_IS_RENDERED,s)};return void this.on(w.APP_VIEW_IS_RENDERED,s)}var a=this.subViewHelper.get(this.currentPageUuid);a&&a.stopServices(),this._showPageContainer(y.PAGE_CONTAINERS.DETAILS);var r=this.subViewHelper.get(this.SUB_VIEW_ENTITY_DETAILS);r||(r=this.createFullDetailsPageView(this.$(".page-details"),t),this.subViewHelper.register(this.SUB_VIEW_ENTITY_DETAILS,r),D.hideLoader(),r.on(r.EVENT.FULL_DETAILS_CLOSED,function(){var e=!1,t=D.getHashParameters();if(t.contextId){var i=T.getNavigationContext(t.contextId);i&&i.pageRoute&&(T.navigateToPageRouteObject(i.pageRoute),e=!0)}e||window.history.back()},this)),r.refreshView({detailPaneRoute:t})},_prepareForDisplay:function(){h.isLoggedIn()&&(this.isViewRendered||this.preRender(),this.$(this.elContent).is(":visible")||this.showContent())},_showPageContainer:function(t,i){var n=this,s=this.$el,a=e.map(y.PAGE_CONTAINERS,function(e){if(n.$("#"+e+".active").length&&e!==t)return["#"+e]}),r=this.$(a.join(",  ")),o=this.$("#"+t);r.length?(o.addClass("active activate").removeClass("inactive hide"),r.addClass("deactivate").removeClass("activate"),s.addClass("n-app-container-noscroll"),D.onAnimationEnd(o,function(){s.removeClass("n-app-container-noscroll"),r.addClass("inactive hide").removeClass("deactivate active"),o.removeClass("activate"),_.isFunction(i)&&i()})):o.addClass("active")},restartIdleManager:_.throttle(function(e){p.get(p.IDLE_MANAGER)&&p.get(p.IDLE_MANAGER).restartTimer()},1e3),onChangePageRoute:function(){var e=this.appModel.getCurrentPageRoute(),t=!0;if(E.hasClusterData()){if(E.isMulticlusterUI()&&!E.isMulticlusterNavMode()&&!E.getClusterModelByClusterUuid(E.getClusterIdFromPageRoute(e))){var i="Please check if the cluster has been unregistered from Prism Central. The clusterid="+E.getClusterIdFromPageRoute(e)+" parameter in the url is invalid.";return f.showClientNotification(y.NOTIFY_ERROR,i,{temporary:!1}),void T.navigateToPage(y.PAGE_MC_DASHBOARD,null,null,!0)}if(this.isInitialized||(this.headerView.startServices(),this.isInitialized=!0),E.isMulticlusterUI()?(E.setCurrentClusterByPageRoute(e),E.isMulticlusterNavMode(e)?(this.headerView.switchToMulticlusterMode(),this.showNav(this)):(this.headerView.switchToSingleClusterMode(),this.showNav(this))):(this.headerView.switchToSingleClusterMode(),this.showNav(this)),g.isLoadedFromPrismCentral()&&!E.isCurrentClusterIdSameInPageRoute(e)){g.updatePrismCentralLoadingStatus(!0),this.headerView.prepareForClusterSwitch(),this.isHeaderToRestart=!0,E.switchCurrentClusterFromPageRoute(e),t=!1;var n=E.getClusterIdFromPageRoute(e);if(!E.isClusterInPrismElementCache(n)){D.showLoader();var s=this.subViewHelper.get(this.currentPageUuid);s&&s.hide()}}}t&&this.changePageRoute(e)},changePageRoute:function(e){e&&e.pageId||(e=this.appModel.getCurrentPageRoute());var t=e?e.pageId:null,i=e?e.subPageId:null;if(E.isPrismElementIFrameMode()&&(e.options=D.parseQueryToObject(e.options)||{},e.options[y.NAV_PAGE_ID]=t,e.options[y.NAV_SUBPAGE_ID]=i,e.options=D.formatObjectToQuery(e.options,!0),t=y.PAGE_MC_PE_IFRAME,i=null),E.isPrismElementNavMode()&&this.showHideHeaderElements(!0),g.isLoadedFromPrismCentral()&&this.isHeaderToRestart&&(this.isHeaderToRestart=!1,this.headerView.switchToSingleClusterMode()),t||null===this.currentPageUuid){this.currentPageUuid&&this.currentPageUuid!==this.getPageUuid(t)&&this.subViewHelper.get(this.currentPageUuid)&&this.subViewHelper.get(this.currentPageUuid).hide();var n=D.parseQueryToObject(e.options)||{};if(n&&n[y.NAV_RERENDER_FLAG_NAME]&&this.subViewHelper.remove(this.getPageUuid(t)),!this.subViewHelper.get(this.getPageUuid(t))&&this.subViewHelper.getIds().length>=this.MAX_PAGE_LIMIT){var s;_.each(this.subViewHelper.subViews,function(e){(!s||e.getLastAccessTime()<s.getLastAccessTime())&&(s=e)}),D.debug("Removing page ",s.pageUuid),this.subViewHelper.remove(s.pageUuid),s=null,this.currentPageUuid=null}this._showOrLoadPage(t,i,e)}},_showOrLoadPage:function(e,t,i){var n=this.subViewHelper.get(this.getPageUuid(e));window.nutanix&&window.nutanix.hotReload&&(n=null),this.currentPageUuid=this.getPageUuid(e);var s=!0;n?(n.setLastAccessTime((new Date).getTime()),n.show(i),this.isLoginPrevious&&(n.startServices(),n.refreshView(),this.startServices(),this.headerView&&this.headerView.refreshNavigationView&&this.headerView.refreshNavigationView()),n.hasCustomLoader()||D.hideLoader()):(E.isPrismElementIFrameMode()||D.showLoader(),s=I.isPageSupported(e),e===y.PAGE_AUTHORIZE?this.renderPageAuthorize(i):s&&this.isPageValid(e)&&this.isFeatureSupported(e)?this.canAccessPage(e)?this.isUITemplatePage(e)?this.loadUITemplatePage(e):this.loadPageView(e):this.renderPageAccessDenied(e,this.i18nStatic("Common","AccessDeniedReasons.accessDenied")):this.renderPageAccessDenied(e,this.i18nStatic("Common","AccessDeniedReasons.notFound"))),s?this.headerView.updateSelectedPage(e,t):this.headerView.updateSelectedPage(null),this.headerView.updateClusterName(),this.isLoginPrevious=!1},loadPageView:function(e){return E.isMulticlusterNavMode()?(require(["views/pages/multicluster/home/MulticlusterDashboardPageView"],this.renderPageView),y.PAGE_MC_DASHBOARD):(require(["views/pages/dashboard/DashboardPageView"],this.renderPageView),y.PAGE_DASHBOARD)},renderPageView:function(e,t){var i=this.getPageUuid(e.prototype[y.NAV_PAGE_ID]);this._processPageView(e,i,t)},_processPageView:function(e,t,i){var n={};n[L.PAGEUUID]=t;var s=this.subViewHelper.get(t);if(s||(s=new e(n)),i&&s.setPageViewOptions(i),s.setLastAccessTime((new Date).getTime()),this._showPageContainer(y.PAGE_CONTAINERS.PAGE),this.$("#n-ctr-page").append(s.render()),this.currentPageUuid===this.getPageUuid(s.pageId)){var a=this.appModel.getCurrentPageRoute();s.show(a)}else s.hide();this.subViewHelper.register(s.pageUuid,s),D.hideLoader(),R.beforeRenderPageView(t,s),this.trigger(w.APP_VIEW_IS_RENDERED,this)},loadUITemplatePage:function(e){var t=this;N.isIFramePage(e)?require(["views/pages/ui_template/UITemplateIFramePageView"],function(i){t._processPageView(i,t.getPageUuid(e),{overridePageId:e})}):D.debug("BaseAppView: Invalid template page.")},canAccessPage:function(e){return u.canAccessPage(e)},isFeatureSupported:function(e){return u.isFeatureSupported(e)},isPageValid:function(e){return!!u.getDescriptor(e)},isUITemplatePage:function(e){return N.isIFramePage(e)},showAction:function(e){h.isLoggedIn()&&(this.isViewRendered||this.render(),this.currentPageUuid||this.showPage({}),this.handlePopupAction(e))},handlePopupAction:function(e){},showHideHeaderElements:function(e){if(this.headerView){var t=this.headerView.$el.find(".n-nav-bar, .n-header-cluster-health, .n-header-alerts, .n-header-tasks, .right-menu");e?t.removeClass("hidden").addClass("inline-flex"):t.removeClass("inline-flex").addClass("hidden")}},showNav:function(e){e.$(".n-navigation").addClass("-show"),e.$(".n-navigation").removeClass("hidden")},hideNav:function(e){e.$(".n-navigation").removeClass("-show"),e.$(".n-navigation").addClass("hidden")},updateGlobalKeyEvent:function(e){this.headerView&&this.headerView.updateGlobalKeyEvent&&this.headerView.updateGlobalKeyEvent(e)},stopPreloader:function(e){var t=this.$el.find("#preloader"),i=t.find(".prism-loader");t.length>0?(i.addClass("fade-out"),D.onTransitionEnd(i,function(e,t){e.remove(),_.isFunction(t)&&t()},e,t)):_.isFunction(e)&&e()},removeLoginBackground:function(){this.$("#loginBackground").remove()},showContent:function(){this.$(this.elContent).fadeIn(250)},hideContent:function(){this.$(this.elContent).fadeOut(300)},htmlTagClassify:function(){var t=D.getBrowser();e("html").addClass(t)},bodyTagClassify:function(){var t="";t=E.isMulticlusterNavMode()?"prism-central":"prism-element",e("body").addClass(t)},getCurrentPageView:function(){if(this.subViewHelper)return this.subViewHelper.get(this.currentPageUuid)},onStartServices:function(){if(e(window).on("beforeunload",this.sendUserActivityLogs),e(window).on("resize.app",this.onResize),this.delegateModelEvents(),this.appModel&&this.appModel.initialized&&this.onChangePageRoute(),w.onAppEvent(w.ENTITIES_CREATED,this.onEntityEvent),w.onAppEvent(w.ENTITIES_UPDATED,this.onEntityEvent),w.onAppEvent(w.ENTITIES_DELETED,this.onEntityEvent),g.isLoadedFromPrismCentral()&&E.hasClusterData()){var t=this.subViewHelper.get(this.currentPageUuid);t&&t.startServices(),this.headerView.startServices(),E.startServices()}},onStopServices:function(){this.subViewHelper.iterate("stopServices"),this.headerView.stopServices(),E.stopServices(),e(window).off("beforeunload",this.sendUserActivityLogs),e(window).off("resize.app",this.onResize),this.undelegateModelEvents(),w.offAppEvent(w.ENTITIES_CREATED,this.onEntityEvent),w.offAppEvent(w.ENTITIES_UPDATED,this.onEntityEvent),w.offAppEvent(w.ENTITIES_DELETED,this.onEntityEvent)},refreshView:function(e){this.isViewRendered&&(e?(D.log("AppView : Refresh the view. The entity type is "+e.entityType+". The page to be refreshed is "+this.currentPageUuid),e.entityType===y.ENTITY_CLUSTER&&this.headerView.refreshClusterName()):D.log("AppView : The page to be refreshed is "+this.currentPageUuid),this.subViewHelper.get(this.currentPageUuid)&&this.subViewHelper.get(this.currentPageUuid).refreshView(e),this.refreshTaskData()&&C.fetchOnDemand())},refreshTaskData:function(){return!E.isPrismElementNavMode()&&!h.isChangeSystemDefaultPasswordView()},getPageUuid:function(e){var t;return t=e===y.PAGE_MC_PE_IFRAME?E.getCurrentClusterFullVersion():E.getCurrentClusterId(),e+y.PAGE_UUID_SEPARATOR+t},renderPageAccessDenied:function(e,t,i){this.currentPageUuid=this.getPageUuid(y.PAGE_ACCESS_DENIED);var n=this,s=function(e){n.renderPageView(e,{reason:t||n.i18nStatic("Common","AccessDeniedReasons.accessDenied"),actionLink:i})};return this.invokeAccessDeniedPage(s),e},renderPageAuthorize:function(e){this.currentPageUuid=this.getPageUuid(e.pageId),this.$("#n-notification-bar").hide(),this.$("#n-header").hide();var t=this,i=function(i){t.renderPageView(i,e.options)};return require(["views/pages/common/AuthorizePageView"],i),e.pageId},showNotification:function(e,t){this.notificationView&&this.notificationView.showNotification(e,t)},showNotificationBar:function(e,t,i){if(E.isPrismElementIFrameMode())return void D.log("AppView : Ignore notification bar because the app is in Prism Element iFrame mode.");this.notificationBarView&&this.notificationBarView.showNotificationBar(e,t,i)},hideNotificationBar:function(e){this.notificationBarView&&this.notificationBarView.hideNotificationBar(null,e)},showLatencyAction:function(e){this.notificationView&&this.notificationView.showLatencyAction(e)},hideLatencyAction:function(e){this.notificationView&&this.notificationView.hideLatency(e)},showLatencyMessage:function(e){if(this.notificationView)return this.notificationView.showLatencyMessage(e)},hideLatencyMessage:function(e){if(this.notificationView)return this.notificationView.hideLatency(e)},sendUserActivityLogs:function(){p.get(p.IS_LOGGED_IN)&&m.recordUserActivities({action:"disconnect",userLoggedOut:!0})},onResize:function(){var e=this;clearTimeout(this.resizeTimer),this.resizeTimer=setTimeout(function(){var t=e.subViewHelper.get(e.SUB_VIEW_ENTITY_DETAILS),i=e.subViewHelper.get(e.currentPageUuid);t?t.onResize():i&&i.onResize()},100)},onEntityEvent:function(e,t){this.subViewHelper.iterate("onEntityEvent",e,t)},updatePageTitle:function(){if(!E.isMulticlusterUI()){var e=p.get(p.SESSION_INFO),t=e[L.CLUSTER_NAME_DP];D.setPageTitle(t)}},
invokeAccessDeniedPage:function(e){require(["views/pages/common/AccessDeniedPageView"],e)}})}),define("managers/PopupViewFactory",["utils/AppConstants","utils/AppUtil","data/DataProperties","managers/AsyncLoadManager","text!app/scripts/popups.json"],function(e,t,i,n,s){"use strict";var a,r;try{r=JSON.parse(s)}catch(e){t.log("PopupViewFactory: Failed to parse popups module config: "+e)}return{MAP_ACTION_UI_SEARCH:{lockdown:e.ENTITY_CLUSTER_LOCKDOWN,expand:e.ENTITY_HOST,whitelist:e.ENTITY_NFS_WHITELIST,ntp:e.ENTITY_NTP_SERVER,remote_support:e.ENTITY_REMOTE_SUPPORT,upgrade:e.ENTITY_UPGRADE,dns:e.ENTITY_NAME_SERVER,proxy:e.ENTITY_HTTPPROXY,switch:e.ENTITY_NETWORK_SWITCH,license:e.ENTITY_LICENSING,smtp:e.ENTITY_SMTP_SERVER,snmp:e.ENTITY_SNMP,pulse:e.ENTITY_ENABLE_PULSE,encrypt:e.ENTITY_ENCRYPTION,service_center:e.ENTITY_SERVICE_CENTER,management_server:e.ENTITY_MANAGEMENT_SERVER,network_switch:e.ENTITY_NETWORK_SWITCH,hyperv_failover:e.ENTITY_HYPERV_FAILOVER_CLUSTER,hyperv_domain:e.ENTITY_HYPERV_DOMAIN_JOIN,ssl_prism_key:e.ENTITY_SSL_PRISM_KEY,auth_config:e.ENTITY_AUTH_CONFIG,user_profile:e.ENTITY_USER_PROFILE,change_password:e.ENTITY_USER_PASSWORD,user_management:e.ENTITY_USER,welcome_banner:e.SYSTEM_DATA_WELCOME_BANNER,asup:e.ENTITY_ASUP,dr_schedule:e.ENTITY_SCHEDULE,ui_settings:e.ENTITY_UI_SETTINGS,language_setting:e.ENTITY_I18N_SETTINGS,alert_policy:e.ENTITY_ALERT_POLICY,kerberos:e.ENTITY_KERBEROS_CONFIG,id_based_security:e.ENTITY_ID_BASED_SECURITY},CLUSTER_ACTION_POPUPS:(a={},_defineProperty(a,e.ACTION_CONVERT,"NodeConversionPopupView"),_defineProperty(a,e.ACTION_SHOW_CP_RECOMMENDATION,"RecommendationPopupView"),_defineProperty(a,e.ACTION_SHOW_CP_WHATIF_ANALYSIS,"WhatIfPopupView"),_defineProperty(a,e.ACTION_RUN_CHECK,"RunChecksPopupView"),_defineProperty(a,e.ACTION_NCC_FREQUENCY,"NccFrequencyPopupView"),_defineProperty(a,e.ACTION_FETCH,"LogCollectorPopupView"),_defineProperty(a,e.ACTION_UPDATE_CLUSTER,"ClusterUpdatePopupView"),_defineProperty(a,e.ACTION_SSP_CONFIG,"ClusterSSPConfigPopupView"),_defineProperty(a,e.ACTION_UNREGISTER,"GenericNotificationPopupView"),_defineProperty(a,e.ACTION_UPLINK_CONFIG,"ClusterUplinkPopupView"),_defineProperty(a,e.ACTION_TRIGGER_PLAYBOOK,"TriggerPlaybookPopupView"),_defineProperty(a,e.ACTION_MANAGE_CATEGORIES,"IntentDynamicPopupView"),a),translateActionTarget:function(e,t){return this.MAP_ACTION_UI_SEARCH[e]||t},showPopup:function(e,t,i,n){t=this.translateActionTarget(e,t);var s=this.getPopupClass(e,t),a=this.isMultiplePopup(t);this.loadPopupView(s,a,i,n)},loadPopupView:function(e,t,i,s){n.whenLoaded(r.moduleName+".js",function(){!0===t?require([r.modules[e]],s):require([r.modules[e]],i)})},isMultiplePopup:function(t){return t===e.ENTITY_STORAGE_POOL||t===e.ENTITY_CONTAINER},getPopupClass:function(t,n){var s;switch(n){case e.ENTITY_CLUSTER:s=this.CLUSTER_ACTION_POPUPS[t]||"ClusterPopupView";break;case e.ENTITY_MULTICLUSTER_CONFIG_SPEC:s="ClusterUpdatePopupView";break;case e.ENTITY_STORAGE_POOL:case e.ENTITY_CONTAINER:if(t===e.ACTION_FANOUT.CONTAINER_CREATE){s="ClusterSelectionPopupView";break}s="StoragePopupView";break;case e.ENTITY_DATASTORE:s="StoragePopupView";break;case e.ENTITY_VM:case e.ENTITY_ACROPOLIS_SNAPSHOT:switch(t){case e.ACTION_TRIGGER_PLAYBOOK:s="TriggerPlaybookPopupView";break;case e.ACTION_FANOUT.VM_CREATE:case e.ACTION_FANOUT.NETWORK_CREATE:s="ClusterSelectionPopupView";break;case e.ACTION_SHOW_NW_ENTITY_DETAILS:s="NetworkEntityPopupView";break;case e.ACTION_MANAGE_NGT:s="VmManageNgtPopupView";break;case e.ACTION_LAUNCH_CONSOLE:s="LaunchConsolePopupView";break;case e.ACTION_SNAPSHOT_V3:s="VmSnapshotv3";break;default:s="VmPopupView"}break;case e.ENTITY_VM_FANOUT:s="VmFanoutActionView";break;case e.ENTITY_ENCRYPTION:s="EncryptionPagePopupView";break;case e.ENTITY_HTTPPROXY:s="HttpProxyPopupView";break;case e.ENTITY_SERVICE_CENTER:s="ServiceCenterPopupView";break;case e.ENTITY_MANAGEMENT_SERVER:s="RegisterManagementServerPopupView";break;case e.ENTITY_NAME_SERVER:s="NameServerPopupView";break;case e.ENTITY_NTP_SERVER:s="NtpServerPopupView";break;case e.ENTITY_NETWORK_SWITCH:s=t===e.ACTION_SHOW_NW_ENTITY_DETAILS?"NetworkEntityPopupView":"NetworkSwitchConfigPopupView";break;case e.ENTITY_NFS_WHITELIST:s="NfsWhitelistPopupView";break;case e.ENTITY_REMOTE_SUPPORT:s="RemoteSupportPopupView";break;case e.ENTITY_HYPERV_FAILOVER_CLUSTER:s="HypervFailoverClusterPopupView";break;case e.ENTITY_KERBEROS_CONFIG:s="KerberosManagementPopupView";break;case e.ENTITY_SMTP_SERVER:s="SmtpServerPopupView";break;case e.ENTITY_SNMP:s="SnmpPopupView";break;case e.ENTITY_SYNC:s="ForcedEntitySyncPopupView";break;case e.ENTITY_RECOVERY_PLAN_JOB:s="CasResolutionPopupView";break;case e.ENTITY_SSL_PRISM_KEY:s="PrismPemKeyPopupView";break;case e.ENTITY_AUTH_CONFIG:s="AuthConfigPopupView";break;case e.ENTITY_CLUSTER_LOCKDOWN:s="LockDownPopupView";break;case e.ENTITY_MULTICLUSTER_FILTER:s="MulticlusterFilterPopupView";break;case e.ENTITY_MULTICLUSTER_MANAGEMENT:s="MulticlusterManagementPopupView";break;case e.ENTITY_ALERT_POLICY:s=t===e.ACTION_SUMMARY?"AlertPoliciesPopupView":"AlertPolicyPopupView";break;case e.ENTITY_USER_DEFINED_ALERT_POLICY:s="UDAPolicyPopupView";break;case e.ENTITY_CP_ALERT_POLICY:s="CPAlertPolicyPopupView";break;case e.ENTITY_UPGRADE:s="SoftwareUpgradePopupView";break;case e.ENTITY_HYPERV_DOMAIN_JOIN:s="HypervDomainJoinPopupView";break;case e.ENTITY_HYPERV_CPS_DEPLOYMENT:s="HypervCpsDeploymentPopupView";break;case e.ENTITY_REDUNDANCY_STATE:s="RedundancyStatePopupView";break;case e.ENTITY_LICENSING:s="LicensingPopupView";break;case e.SUPPORT_CASE:s="SupportCasePopupView";break;case e.ENTITY_ALERT_CONFIGURATION:s="AlertConfigWizard";break;case e.ENTITY_HOST:s=t===e.ACTION_TRIGGER_PLAYBOOK?"TriggerPlaybookPopupView":t===e.ACTION_REMOVE?"RemoveHostPopupView":t===e.ACTION_FANOUT.EXPAND_CLUSTER?"ClusterSelectionPopupView":t===e.ACTION_REPAIR?"BootDiskRepairPopupView":t===e.ACTION_SHOW_NW_ENTITY_DETAILS?"NetworkEntitiesBasePopupView":t===e.ACTION_REBOOT?"HostRebootPopupView":"ExpandClusterPopupView";break;case e.ENTITY_DISK:t===e.ACTION_REMOVE?s="RemoveDiskPopupView":t===e.ACTION_REPLACE&&(s="ReplaceDiskPopupView");break;case e.ENTITY_USER_PROFILE:s="UpdateProfilePopupView";break;case e.ENTITY_USER_PASSWORD:s="ChangePasswordPopupView";break;case e.ENTITY_USER:s="UserPopupView";break;case e.ENTITY_DASHBOARD:s="ManageDashboardsPopupView";break;case e.ENTITY_ROLE_MAPPING:s="RoleMappingPopupView";break;case e.SYSTEM_VERSION:if(t===e.ACTION_SHOW_RELEASE_NOTES){s="ReleaseNotesPopupView";break}s="VersionPopupView";break;case e.ENTITY_REMOTE_SITE:s="RemoteSiteFormView";break;case e.ENTITY_PROTECTION_DOMAIN:case e.ENTITY_ASYNC_PD:if(t===e.ACTION_MIGRATE){s="MigratePDFormView";break}if(t===e.ACTION_REPLICATE){s="ReplicatePDFormView";break}if(t===e.ACTION_ACTIVATE){s="ActivatePDFormView";break}if(t===e.ACTION_WARNING){s="PDWarningPopupView";break}throw"Unknown protection domain action.";case e.ENTITY_METRO_AVAILABILITY_PD:if(t===e.ACTION_CHECK_PREREQUISITE)s="GenericNotificationPopupView";else{if(t!==e.ACTION_UPDATE){if(t===e.ACTION_REPLICATE){s="ReplicatePDFormView";break}throw"Unknown metro availability protection domain action."}s="VMAvailabilityPopupView"}break;case e.ENTITY_SNAPSHOT:if(t!==e.ACTION_RESTORE)throw"Unknown snapshot action.";s="RestoreSnapshotPopupView";break;case e.SYSTEM_DATA_WELCOME_BANNER:s="WelcomeBannerPopupView";break;case e.ENTITY_UI_SETTINGS:s="UISettingsPopupView";break;case e.ENTITY_I18N_SETTINGS:s="LanguageSettingsPopupView";break;case e.ENTITY_ASUP:s="AutoSupportPopupView";break;case e.ENTITY_ID_BASED_SECURITY:s="IDBasedSecurityPopup";break;case e.ENTITY_RESILIENCY_STATUS:s="ResiliencyStatusPopupView";break;case e.ENTITY_SCHEDULE:s="SchedulePopupView";break;case e.ENTITY_ACROPOLIS_NETWORK:s="NetworkConfigurationPopupView";break;case e.ENTITY_CVM_INTERFACE:s="CVMNetworkInterfacePopupView";break;case e.ENTITY_DASHBOARD_VP_ADD:s="AddVantagePointPopupView";break;case e.ENTITY_IMAGE:t===e.ACTION_MIGRATE?s="ImageImportPopupView":t===e.ACTION_REMOTE_COPY?s="ImageRemoteCopyPopupView":t===e.ACTION_MANAGE_CATEGORIES&&(s="IntentDynamicPopupView");break;case e.ENTITY_ACROPOLIS_IMAGE:s="AcropolisImagePopupView";break;case e.ENTITY_HA:s="HighAvailabilityPopupView";break;case e.ENTITY_FILE_SERVER:s=t===e.ACTION_CHECK_PREREQUISITE?"FileServerPrerequisitePopupView":t===e.ACTION_PROTECT?"FileServerProtectPopupView":t===e.ACTION_SHOW?"FileServerSizingPopupView":t===e.ACTION_ADD_ADMINS?"FileServerAddAdminsPopupView":t===e.ACTION_USER_MANAGEMENT?"FileServerUserManagementPopupView":t===e.ACTION_ADD_DNS?"FileServerAddDNSPopupView":t===e.ACTION_ENABLE_FILE_INSIGHTS?"FileServerInsightPopupView":t===e.DEPLOY_FILE_INSIGHTS?"FileInsightDeployPopupView":"FileServerPopupView";break;case e.ENTITY_SHARE:s=t===e.ACTION_ANTIVIRUS_SETUP?"FileServerAntivirusPopupView":"SharePopupView";break;case e.ENTITY_SHARE_QUOTAS:s="FileServerShareQuotaPopupView";break;case e.ENTITY_NONRECOVERABLE_VMS:s="NonRecoverableVMPopupView";break;case e.ENTITY_ISCSI_CLIENT:s="IscsiClientPopupView";break;case e.ENTITY_ACROPOLIS_VOLUME_GROUP:s="VolumeGroupPopupView";break;case e.ENTITY_AZURE_ONBOARDING:s="HyperVAzureOnboardingView";break;case i.NW_E_TYPES.SWITCH_INTERFACE:s="NetworkEntityPopupView";break;case e.ENTITY_PC_VM:t===e.ACTION_DEPLOY?s="PCDeploymentPopupView":t===e.ACTION_CREATE_PC?s="MultipleNodePCDeploymentCreatePopupView":t===e.ACTION_SHOW&&(s="MulticlusterSelfMonitorPopupView");break;case e.ENTITY_WITNESS_ADD:s="WitnessVMRegisterPopupView";break;case e.ENTITY_CITRIX_CONNECTOR:s="CitrixConnectorPopupView";break;case e.ENTITY_LCM:t===e.ACTION_UPDATE&&(s="LCMConfigPopupView");break;case e.ENTITY_LCM_VERSION:s="LCMAvailableVersionPopupView";break;case e.ENTITY_NCC:s="NCCTaskSuceededPopupView";break;case e.ACTION_CVM_CONFIG:s="ConfigureCVMPopupView";break;case e.ACTION_INCREASE_PC_RESOURCES:s="IncreasePCResourcesPopupView";break;case e.ENTITY_EULA_POPUP:s="FileServerEulaPopupView";break;case e.BROKER_POPUP:s="BrokerPopupView";break;case e.ENTITY_DEGRADED_NODE:s="DegradedNodePopupView";break;case e.FEATURE_DISABLE_POPUP:s="FeatureDisabledPopupView";break;case e.ENTITY_PROTECTION_RULE:t===e.ACTION_UNPROTECT&&(s="VMUnprotectActionView");break;case e.ENTITY_AFFINITY_RULE:s=t===e.ACTION_MANAGE_LEGACY_RULE?"AffinityRuleLegacyPopupView":"IntentDynamicPopupView";break;case e.ENTITY_VM_RECOVERY_POINT:s=t===e.ACTION_RECOVER?"VmRecoveryPointRecoverPopupView":t===e.ACTION_REPLICATE?"VmRecoveryPointReplicatePopupView":"IntentDynamicPopupView";break;case e.ENTITY_PLAYBOOK:s="PlaybookPopupView";break;case e.ENTITY_ACTION_TEMPLATE:s="ActionTemplatePopupView";break;case e.ENTITY_NVME_DRIVE:s="NVMeGuidePopupView";break;case e.SSP_MAPPING_EB_TO_ENTITY[e.ENTITY_ATLAS_SUBNET]:s=t===e.ACTION_CREATE_ADD_SUBNET?"IntentDynamicOverlayPopupView":"IntentDynamicPopupView";break;case e.ENTITY_ROUTING_POLICY:s=t===e.ROUTING_POLICY.ACTION_UNDERSTAND_PRIORITIES?"GenericNotificationPopupView":"IntentDynamicPopupView";break;case e.ENTITY_VPN_CONNECTION:s=t===e.ACTION_VPN_ON_PREM_GATEWAY_CONFIG?"VPNOnPremGatewayConfigPopupView":"IntentDynamicPopupView";break;case e.ENTITY_K8S_CLUSTER:s="EnableK8sClusterPopupView";break;case e.ENTITY_NETWORK_SECURITY_RULE:if(t===e.ACTION_CREATE_DIALOG){s="NetworkSecurityPolicyView";break}default:s="IntentDynamicPopupView"}return s}}}),define("text!templates/basecomponents/wizards/WizardContentView.html",[],function(){return'<div data-ntnx-content-inner>\n  <div class="wizard-page-container">\n  </div>\n</div>'}),define("text!templates/basecomponents/wizards/WizardView.html",[],function(){return'\x3c!-- The parent div modal is #popupUser --\x3e\n<div class="modal-header">\n  <button type="button" class="close" data-dismiss="modal">\n    <i data-icon="K" aria-hidden="true"></i>\n  </button>\n  <h4 class="n-title"><%= wizardConfiguration.title %></h4>\n</div>\n\n<div class="n-modal-wrapper">\n  <div class="n-modal-body">\n    <div class="n-modal-content-wrapper">\n      <div class="wizard-page-header">\n        <ul class="modal-nav">\n          <% _.each(wizardConfiguration.pages, function(page, idx) { %>\n            <li class="wizard-step" id="title-<%=page.id%>"\n                data-index="<%= idx %>">\n              <span class="custom-title" page-id="<%=page.id%>"></span>\n              <%= page.title %>\n            </li>\n          <% }) %>\n        </ul>\n      </div>\n      <div class="n-modal-alert-header">\n        \x3c!-- @view: alerts go here... --\x3e\n      </div>\n      <div class="wizard-page-container">\n      </div>\n    </div>\n  </div>\n\n  <div class="n-modal-footer">\n    <button class="btnPrevious btn pull-left">\n      <%= i18n(\'previous\') %>\n    </button>\n    <button class="removeUserMapping btn pull-left hidden">\n      <%= i18n(\'remove_mapping\') %>\n    </button>\n\n    <button class="btnCancel btn">\n      <%= i18n(\'cancel\') %>\n    </button>\n    <button class="btnNext btn btn-primary">\n      <%= i18n(\'next\') %>\n    </button>\n    <button class="btnSave btn btn-primary">\n      <%= i18n(\'save\') %>\n    </button>\n\n  </div>\n</div>\n'}),define("views/basecomponents/wizards/WizardView",["views/basecomponents/popups/BasePopupView","utils/SubViewHelper","utils/AppConstants","utils/SVG","text!templates/basecomponents/wizards/WizardContentView.html","text!templates/basecomponents/wizards/WizardView.html"],function(e,t,i,n,s,a){"use strict";var r={LINEAR:"linear",ADHOC:"adhoc"};return e.extend({el:"#wizardPopup",name:"WizardView",NEXT_PAGE:1,PREVIOUS_PAGE:-1,wizardConfiguration:null,subViewHelper:null,currentPageIdx:null,title:null,template:_.template(a),contentTemplate:_.template(s),events:{"click  .modal-header .close":"hide","keypress input":"onKeyPress","click .btnCancel":"onCancel","click .btnPrevious":"onPrevious","click .btnNext":"onNext","click .btnSave":"onSave","click .next-page":"onNext","click .previous-page":"onPrevious","click .go-to-page":"onGoToPage"},onCancel:function(){this.subViewHelper.get(this._getCurrentPageId()).onPageCancel()&&(this.onCancelClicked=!0,this.hide())},onPrevious:function(e){if($(e.currentTarget).hasClass("btnBack")&&"function"==typeof this.subViewHelper.get(this._getCurrentPageId()).onPageBack)this.subViewHelper.get(this._getCurrentPageId()).onPageBack();else if(this.currentPageIdx>0){var t=this.subViewHelper.get(this._getCurrentPageId());t&&t.notifyOnPrevious?this._gotoPage(this.currentPageIdx-1,!0):this._renderPage(this.currentPageIdx-1)}},onNext:function(e){var t=$(e.currentTarget),i=this.wizardConfiguration.pages.length;t.hasClass("btnApply")?this._onApply():this.currentPageIdx<i-1&&this._gotoPage(this.currentPageIdx+1)},onGoToPage:function(e){var t=$(e.currentTarget).data("index");this._renderPage(t)},onSave:function(){var e=this;this.subViewHelper.get(this._getCurrentPageId()).onPageTransition(function(){e.hide()}),this.$(".btnSave").prop("disabled",!1)},initializeWizard:function(e){if(this.wizardConfiguration=e,!this.wizardConfiguration.pages||this.wizardConfiguration.pages.length<2)throw"Error: Register at least two pages for a wizard.";this.subViewHelper=new t,this.currentPageIdx=0,_.bindAll(this,"onResize","onResizeWizardContainer")},addPageView:function(e,t,i){$('<div id="'+e+'"  class="wizard-page"></div>').appendTo(this.$(".wizard-page-container"));var n=new t({el:"#"+e,model:i});n.setWizard(this),this.subViewHelper.register(e,n)},_setButtonStates:function(e){var t=this.wizardConfiguration.pages,i=t.length,n=this._getDefaultPreviousButtonLabel(),s=this._getDefaultNextButtonLabel();if("function"==typeof e.getButtonLabel&&(n=e.getButtonLabel(this.PREVIOUS_PAGE)||n,s=e.getButtonLabel(this.NEXT_PAGE)||s),this.$(".btnPrevious").html(n),this.$(".btnNext").html(s),this.wizardConfiguration.wizardType!==r.ADHOC){var a=this.$(".previous-page");a&&a.removeClass("previous-page");var o=this.$(".next-page");o&&o.removeClass("next-page")}var l=!0,c=!0;if("function"==typeof e.canTransitionPage&&(l=e.canTransitionPage(this.PREVIOUS_PAGE),c=e.canTransitionPage(this.NEXT_PAGE)),this.currentPageIdx>0&&l){this.showPreviousButton();var u="previous-page";if(this.wizardConfiguration.wizardType===r.ADHOC&&(u="go-to-page"),e.canEnablePageLink(this.PREVIOUS_PAGE)){var d=this.wizardConfiguration.pages[this.currentPageIdx-1].id;this.$("#title-"+d).addClass(u)}}else this.hidePreviousButton();if(this.currentPageIdx<i-1&&c){this.$(".btnNext").removeClass("disabled"),this.$(".btnNext").show();var h="next-page";if(this.wizardConfiguration.wizardType===r.ADHOC?(h="go-to-page",this._showSaveButton(e)):this.$(".btnSave").hide(),e.canEnablePageLink(this.NEXT_PAGE)){var p=this.wizardConfiguration.pages[this.currentPageIdx+1].id;this.$("#title-"+p).addClass(h)}}else this.wizardConfiguration.wizardType===r.ADHOC&&c||(this.$(".btnNext").addClass("disabled"),this.$(".btnNext").hide()),this._showSaveButton(e);if("function"==typeof e.showCancelButton&&(e.showCancelButton()?this.$(".btnCancel").show():this.$(".btnCancel").hide()),"function"==typeof e.hideSaveButton&&e.hideSaveButton()&&this.$(".btnSave").hide(),"function"==typeof e.hidePreviousButton&&e.hidePreviousButton()&&this.hidePreviousButton(),this.wizardConfiguration.wizardType===r.ADHOC){this._setAdHocPageLink(l,c);var _=!0;"function"==typeof e.canApplyPageChanges&&(_=e.canApplyPageChanges()),_||this.$(".btnNext").addClass("disabled")}},_setAdHocPageLink:function(e,t){_.each(this.wizardConfiguration.pages,function(i,n){n<this.currentPageIdx&&e||n>this.currentPageIdx&&t?this.$("#title-"+i.id).addClass("go-to-page"):this.$("#title-"+i.id).removeClass("go-to-page")},this)},_getDefaultPreviousButtonLabel:function(){return this.wizardConfiguration.wizardType===r.ADHOC?"< Back":"Previous"},_getDefaultNextButtonLabel:function(){return this.wizardConfiguration.wizardType===r.ADHOC?"Apply":"Next"},_showSaveButton:function(e){var t="Save";"function"==typeof e.getSaveButtonLabel&&(t=e.getSaveButtonLabel()||t,this.$(".btnSave").html(t)),this.$(".btnSave").show()},_getCurrentPageId:function(){return this.wizardConfiguration.pages[this.currentPageIdx].id},_gotoPage:function(e,t){var i=this;this.subViewHelper.get(this._getCurrentPageId()).onPageTransition(function(){i._renderPage(e)},t)},_renderPage:function(e){var t=this._getCurrentPageId();this.cleanedPopup?this.$el.find(".tab").closest("li").removeClass("active"):this.$("#title-"+t).removeClass("current-page"),this.$("#"+t).hide(),this.clearHeader(),this.clearCurrentPageTitleError(),this.currentPageIdx=e;var i=this._getCurrentPageId(),n=this.subViewHelper.get(i);n.render(),this.cleanedPopup?this.$(".tab-"+e).closest("li").addClass("active"):this.$("#title-"+i).addClass("current-page"),this.$("#"+i).show(),this._setButtonStates(n),this.reSizePopup()},reSizePopup:function(){this.triggerAction(i.MODAL.ACT.AS_REBUILD)},_onApply:function(){this.subViewHelper.get(this._getCurrentPageId()).onPageTransition(function(){})},setCurrentPageTitleError:function(){var e=n.SVGIcon("Exclamation_Mark"),t=this._getCurrentPageId();this.$(".custom-title[page-id="+t+"]").html(e),this.$("#title-"+t+" .custom-title").addClass("error-icon")},disableSaveButton:function(){this.$(".btnSave").prop("disabled",!0)},enableSaveButton:function(){this.$(".btnSave").prop("disabled",!1)},disableNextButton:function(){this.$(".btnNext").prop("disabled",!0)},enableNextButton:function(){this.$(".btnNext").prop("disabled",!1)},disableCancelButton:function(){this.$(".btnCancel").prop("disabled",!0)},enableCancelButton:function(){this.$(".btnCancel").prop("disabled",!1)},disablePreviousButton:function(){this.$(".btnPrevious").prop("disabled",!0)},enablePreviousButton:function(){this.$(".btnPrevious").prop("disabled",!1)},getPageIds:function(){return _.map(this.wizardConfiguration.pages,function(e){return e.id})},disablePages:function(e){var t=this;_.each(e,function(e){t.$(".wizardTab[page-id="+e+"]").hasClass("disabled")||t.$(".wizardTab[page-id="+e+"]").addClass("disabled")})},enablePages:function(e){var t=this;_.each(e,function(e){t.$(".wizardTab[page-id="+e+"]").removeClass("disabled")})},clearCurrentPageTitleError:function(){var e=this._getCurrentPageId();this.$(".custom-title[page-id="+e+"]").html(""),this.$("#title-"+e+" .custom-title").removeClass("error-icon")},setButtonStates:function(){var e=this._getCurrentPageId(),t=this.subViewHelper.get(e);this._setButtonStates(t)},render:function(){if(this.cleanedPopup){var e=[{text:this.i18n("previous"),extraClasses:"btnPrevious",leftAligned:!0},{text:this.i18n("cancel"),extraClasses:"btnCancel"},{text:this.i18n("next"),isPrimary:!0,extraClasses:"btnNext"},{text:this.i18n("save"),isPrimary:!0,extraClasses:"btnSave"}];this.$el.html(this.defaultTemplate({title:this.wizardConfiguration.title,nestedAlert:!0,tabs:!0,tabsList:this.defaultTabs(this.convertConfigToTabs(this.wizardConfiguration)),bodyContent:this.contentTemplate({wizardConfiguration:this.wizardConfiguration}),footerButtons:this.defaultFooter(e)}))}else this.$el.html(this.template(this.vtOptions({wizardConfiguration:this.wizardConfiguration})));this.wizardConfiguration.wizardType===r.ADHOC&&this.$(".btnNext").addClass("btnApply"),_.each(this.wizardConfiguration.pages,function(e){this.subViewHelper.get(e.id)||this.addPageView(e.id,e.klass,e.model)},this),this._renderPage(this.currentPageIdx)},convertConfigToTabs:function(e){var t=[];return _.each(e.pages,function(e,i){t.push({isActive:0===i,extraClasses:"wizardTab tab-"+i,extraAttr:[{key:"page-id",value:e.id}],text:e.title})}),t},show:function(t){e.prototype.show.apply(this,arguments),$(window).on("resize.app",this.onResize),this.$(".n-modal-alert-header").on(this.SHOW_ALERT,this.onResizeWizardContainer),this.checkPrerequisites({entity:t[i.NAV_ACTION_TARGET],action:t[i.NAV_ACTION]})},hide:function(){e.prototype.hide.apply(this,arguments)&&(this.subViewHelper.removeAll(),$(window).off("resize.app",this.onResize),this.$(".n-modal-alert-header").off(this.SHOW_ALERT,this.onResizeWizardContainer))},confirmHide:function(e){if(this.onCancelClicked)this.onCancelClicked=!1,e();else{var t=this.subViewHelper?this.subViewHelper.get(this._getCurrentPageId()):null;t?t.confirmHide(e):e()}},hidePreviousButton:function(){this.$(".btnPrevious").hide()},showPreviousButton:function(){this.$(".btnPrevious").show()},clearHeader:function(){this.$(".n-license-warning").is(":visible")||e.prototype.clearHeader.apply(this,arguments)},checkPrerequisites:function(e){},onResize:_.throttle(function(){this.resizePageContainer()},100),resizePageContainer:function(e){0!==$("#wizardPopup").length&&e&&e()},onResizeWizardContainer:function(e,t){var i=this;setTimeout(function(){i.resizePageContainer(t)},300)},scrollToBottom:function(){var e=this.$(".wizard-page-container");$(e).animate({scrollTop:$(e).prop("scrollHeight")-$(e).height()},0,"fast")},scrollToElement:function(e){var t=this.$(".wizard-page-container"),i=e?$(e).prop("offsetTop"):$(t).prop("scrollHeight")-$(t).height();$(t).animate({scrollTop:i},"fast")}},{WIZARD_TYPES:r})}),define("views/basecomponents/wizards/BaseWizardPage",["views/basecomponents/BaseView"],function(e){"use strict";return e.extend({theWizard:null,setWizard:function(e){this.theWizard=e},getWizard:function(){return this.theWizard},canEnablePageLink:function(e){return this.canTransitionPage(e)},canTransitionPage:function(e){return!0},getButtonLabel:function(e){return null},getSaveButtonLabel:function(){return null},showCancelButton:function(){return!0},canApplyPageChanges:function(){return!0},onPageTransition:function(e){},onPageCancel:function(){},confirmHide:function(e){e()},showError:function(e){this.getWizard().showHeaderError(e)},showWarning:function(e){this.getWizard().showHeaderWarning(e)},showHeaderWarning:function(e){this.getWizard().showHeaderWarning(e)},showHeaderErrorWithDetails:function(e,t){this.getWizard().showHeaderErrorWithDetails(e,t)},clearHeader:function(){this.getWizard().clearHeader()},showInfo:function(e){this.getWizard().showHeaderInfo(e)},showSuccess:function(e){this.getWizard().showHeaderSuccess(e)},onResize:function(e){this.getWizard().onResizeWizardContainer(null,e)},scrollToBottom:function(){this.getWizard().scrollToBottom()},scrollToElement:function(e){this.getWizard().scrollToElement(e)},disableSaveButton:function(){this.getWizard().disableSaveButton()},enableNextButton:function(){this.getWizard().enableNextButton()},disableNextButton:function(){this.getWizard().disableNextButton()},enableSaveButton:function(){this.getWizard().enableSaveButton()},disableCancelButton:function(){this.getWizard().disableCancelButton()},enableCancelButton:function(){this.getWizard().enableCancelButton()},disablePreviousButton:function(){this.getWizard().disablePreviousButton()},enablePreviousButton:function(){this.getWizard().enablePreviousButton()},getPageIds:function(){return this.getWizard().getPageIds()},disablePages:function(e){this.getWizard().disablePages(e)},enablePages:function(e){this.getWizard().enablePages(e)}})}),define("text!templates/wizards/pd/name-page.html",[],function(){return'<div class="n-popup-description">\n  <% if (model.getEditingMode() === \'metro_availability_pd\') { %>\n  Metro Availability leverages the protection domain construct to maintain\n  an up-to-date data copy on each site.&nbsp;&nbsp;Enter a name\n  (using alpha numeric characters only)\n  for the protection domain you would like to create.\n  Next,&nbsp;you will select the storage container and remote site.\n  <% } else { %>\n  A protection domain is a grouping of Virtual Machines for disaster recovery\n  purposes. Enter a name (using alpha numeric characters only) for the\n  protection domain you would like to create. You will then be guided into\n  assigning Virtual Machines to it, and scheduling it.\n  <% } %>\n</div>\n\n<form id="pdForm" class="form-horizontal">\n  <div class="control-group">\n    <label class="control-label" for="inputName">\n      Name\n    </label>\n    <div class="controls">\n      <input type="text" class="inputName" id="inputName"\n             value="<%= name || \'\' %>">\n      <div class="n-input-validation-msg"></div>\n    </div>\n  </div>\n</form>\n'}),define("views/wizards/pd/name-page",["backbone","data/DataProperties","views/basecomponents/wizards/BaseWizardPage","utils/AppUtil","utils/AppConstants","text!templates/wizards/pd/name-page.html"],function(e,t,i,n,s,a){"use strict";return i.extend({events:{"keyup .inputName":"onKeyUp"},template:_.template(a),onKeyUp:function(e){n.validNameCharactersEventHandler(e,this.$(".n-input-validation-msg"))},render:function(){var e=this.model.get("name")||"",t=this.template({name:e,model:this.model});this.$el.html(t);var i=this;setTimeout(function(){i.$("#inputName").focus()},400)},canEnablePageLink:function(){return!1},canTransitionPage:function(e){return e>0},getButtonLabel:function(e){return e>0&&this.model.getEditingMode()!==s.ENTITY_METRO_AVAILABILITY_PD?"Create":null},onPageTransition:function(e){var i=this.$("#inputName").val().trim();if(0===i.length)return void this.getWizard().showHeaderError("Please enter a name using alpha-numeric characters");var a=this;if(this.model.getEditingMode()===s.ENTITY_METRO_AVAILABILITY_PD)this.model.pdLookup(i,{success:function(n){n.size()?a.showError("Error creating protection domain. Specified protection domain "+i+" exists."):(a.model.set({name:i}),a.model.setEditingAttribute(t.PD_NAME,i),e())},error:function(s,r){var o=n.processAjaxError(r.responseText);n.log(o),a.model.set({name:i}),a.model.setEditingAttribute(t.PD_NAME,i),e()}});else{this.model.set({name:i});var r=this.model.getOptionsSuccessFunction(this.model,s.ACTION_CREATE,e);setTimeout(function(){var e=a.model.enableNotifications;a.model.enableNotifications=!1,r(),a.model.enableNotifications=e},100)}},onPageCancel:function(){return!0}})}),define("views/basecomponents/datatables/DataTableColResizeMixin",["colresize"],function(e){"use strict";var t={_colResizers:[],getColResizeDataTableSettings:function(e){return{sDom:"Zlfrtip",bStateSave:!0,fnStateSave:function(t,i){e._dataTableStateSave(t,i)},fnStateLoad:function(t){return e._dataTableStateLoad(t)},colResize:{resizeCallback:function(i){e._dataTableColResizeCallback(i),t._addColResizer(this)},destroyCallback:function(){t._removeColResizer(this)}}}},getDataTableColResizeMixin:function(){return{_dataTableStateSave:function(e,t){if("true"===localStorage[this._getColResizeEnabledKey()]){var i=this._getColResizeStateKey(),n=JSON.stringify(t);localStorage[i]=n}},_dataTableStateLoad:function(e){if("true"===localStorage[this._getColResizeEnabledKey()]){var t=this._getColResizeStateKey(),i=localStorage[t];if(i)return JSON.parse(i)}return null},_dataTableColResizeCallback:function(e){localStorage[this._getColResizeEnabledKey()]="true",this.dataTable.fnDraw(!0)},_getColResizeEnabledKey:function(){return"colResize.on."+this._getKeySuffix()},_getColResizeStateKey:function(){return"colResize."+this._getKeySuffix()},_getKeySuffix:function(){var e=this.$el.selector;if(!e){var t,i=this.$el[0],n=i.id;if(n&&(t=n.match(/(.*\D)[\d]*$/)))e=t[1];else{e=i.tagName+"."+i.className.trim().replace(/\s+/g,".")}}return e}}},clearAllColResizeStates:function(){Object.keys(localStorage).forEach(function(e){0===e.indexOf("colResize.")&&localStorage.removeItem(e)})},_addColResizer:function(e){_.find(this._colResizers,function(t){return t===e})||this._colResizers.push(e)},_removeColResizer:function(e){var t=_.indexOf(this._colResizers,e);-1!==t&&this._colResizers.splice(t,1)},_onResize:function(){if(this._colResizers.length){var e=this,t=this._colResizers.slice();_.each(t,function(t){t.fnReset&&t.fnReset(),e._removeColResizer(t)})}}};return $(window).on("resize",t._onResize.bind(t)),t.clearAllColResizeStates(),t}),define("views/basecomponents/datatables/DetailsTableView",["backbone","datatables","views/basecomponents/BaseView","views/basecomponents/datatables/DataTableTemplates","views/basecomponents/datatables/DataTableColResizeMixin","data/DataProperties","utils/AppConstants","utils/AppUtil","utils/SubViewHelper"],function(e,t,i,n,s,a,r,o,l){"use strict";return i.extend(_.extend({minimumRows:5,scrollHeight:"270px",columns:[{sTitle:"ID",mData:a.ID,sWidth:"100%"}],initialSorting:[],tmplHover:null,titleHover:null,dataTable:null,subViewHelper:null,resizeTimer:null,_dataSource:null,attachRowTargetId:!1,events:{"mouseover .detailsTable tbody > tr":"onMouseOverRow","mouseout  .detailsTable tbody > tr":"onMouseOutRow"},tablePopoverTemplate:_.template('<div class="n-details-table-tip"> <%= tipText %></div>'),tableCellTemplate:_.template('<a class="n-no-style  n-row-popover" title=""  data-toggle="popover"  actionTargetId="<%= actionTargetId %>"><%= value %></a>'),initialize:function(e){_.bindAll(this,"onResize"),this.subViewHelper=new l,this.tmplHover=e.tmplHover||this.tmplHover,this.titleHover=e.titleHover||this.titleHover,this.tmplHoverArgs=e.tmplHoverArgs||{},this.minimumRows=e.minimumRows||this.minimumRows,this.columns=this.updateColumns(e.columns||this.columns),this.scrollHeight=e.scrollHeight||this.scrollHeight,this.initialSorting=e.initialSorting||[],e.highlightRadioSelection&&(this.highlightRadioSelection=!0,this.addExtraEvents({"click .detailsTable tbody tr td:first-child input[type=radio]":"_onClickFirstCellRadioInput"})),$.fn.dataTableExt.sErrMode="throw"},render:function(){this.$el.html(n.DETAILS_TABLE);var e=this;return this.dataTable=this.$(".detailsTable").dataTable(_.extend({sDOM:"rt",bProcessing:!0,bLengthChange:!1,bPaginate:!1,bFilter:!1,bInfo:!1,sScrollY:this.scrollHeight,aoColumns:this.columns,iDisplayLength:this.minimumRows,oLanguage:{sEmptyTable:"&nbsp;",sZeroRecords:""},bJQueryUI:!1,aaSorting:this.initialSorting,fnDrawCallback:function(t){var i=this.oApi._fnVisbleColumns(t);e.fnAddRows(this,i,e.minimumRows),e.highlightRadioSelection&&e.applyNutanixInput({types:["radio"]})},fnRowCallback:function(t,i,n){return i[a.FOR_EDIT]&&$(t).addClass("row_editing"),e.attachRowTargetId&&i[a.ID]&&$(t).attr(r.NAV_ACTION_TARGET_ID,i[a.ID]),
e.highlightRadioSelection&&e.selectedDataId===i[a.ID]&&($(t).find("td:first-child input[type=radio]").prop("checked",!0),$(t).addClass("row_selected")),t}},s.getColResizeDataTableSettings(this))),this},updateDataSource:function(t){if(!t)throw new Error("Empty data source is not allowed in DetailsTableView.");this.dataTable.fnClearTable(),this._dataSource=t instanceof e.Collection?t.toJSON({includeAttribute:!0}):t,this.dataTable.fnAddData(this._dataSource,!0),this.dataTable.fnAdjustColumnSizing()},getSelectedRow:function(){return this.dataTable.$("tr.row_selected")},updateSelection:function(e){if(e&&e[r.NAV_ACTION_TARGET_ID]){var t=e[r.NAV_ACTION_TARGET_ID];this.goToPageWithRow(t),this.selectRow(t)}},selectRow:function(e){if(e){this.selectedDataId=e;var t=this.$('.detailsTable  tbody  tr:[actionTargetId="'+e+'"]');this.dataTable&&t&&(this.dataTable.$("tr.row_selected").removeClass("row_selected"),$(t).addClass("row_selected"))}},getSelectedDataId:function(){return this.selectedDataId},fnAddRows:function(e,t,i){var n,s,a,r=e.find("tbody tr"),o=i-r.length,l=r.last(),c=l.children("td");a=i%2?"odd":"even",c.each(function(e){$(this).hasClass("sorting_1")&&(s=e)});var u,d;for(u=0;u<o;u++){for(n="",d=0;d<t;d++)n+=d===s?'<td class="sorting_1">&nbsp;</td>':"<td>&nbsp;</td>";l.after('<tr class="'+a+' row_blank">'+n+"</tr>"),a="even"===a?"odd":"even"}},fnAdjustColumnSizes:function(){this.dataTable&&this.dataTable.fnAdjustColumnSizing()},updateColumns:function(e){if(!this.tmplHover)return e;var t,i=[],n=this.tableCellTemplate;return _.each(e,function(e){e.mRender?(e.mRenderOrig=e.mRender,t=function(t,i,s){return n({actionTargetId:s.id,value:e.mRenderOrig()})}):t=function(e,t,i){return n({actionTargetId:i.id,value:e})},e.sHover&&(e.mRender=t),i.push(e)},this),i},getRowData:function(){},destroy:function(){o.debug("DetailsTableView : destroy: "," | viewid     : "+this.cid),this.dataTable.fnDestroy(),this.dataTable=null,$(window).off("resize.app",this.onResize),this.$(".n-row-popover").popover("destroy"),i.prototype.destroy.apply(this,arguments)},showClientMessage:function(e){this.$(".n-loading-wrapper").hide(),this.hideClientMessage(),this.$el.append(n.MESSAGE({message:e}))},hideClientMessage:function(){this.$(".n-message").remove()},onResize:function(){var e=this;clearTimeout(this.resizeTimer),this.resizeTimer=setTimeout(function(){e.dataTable.fnAdjustColumnSizing()},100)},onMouseOverRow:function(e){var t=e.currentTarget,i=this.dataTable.fnGetData(t);if(i&&this.tmplHover){var n=$(t).find(".n-row-popover"),s=_.extend(this.tmplHoverArgs,{model:i}),a=this.tablePopoverTemplate({tipText:this.tmplHover(s)});$(n).popover("destroy"),$(n).popover({title:this.titleHover||"Details",content:a,placement:"top",trigger:"manual",html:"true",container:$("body")}),n.popover("show")}},onMouseOutRow:function(e){$(e.currentTarget).find(".n-row-popover").popover("destroy")},_onClickFirstCellRadioInput:function(e){if(this.dataTable){this.dataTable.$("tr.row_selected").removeClass("row_selected");var t=$(e.currentTarget),i=t.closest("tr");t.is(":checked")&&(i.addClass("row_selected"),this.selectedDataId=t.attr("value"))}},onStartServices:function(){this.fnAdjustColumnSizes(),$(window).on("resize.app",this.onResize),this.delegateEvents()},onStopServices:function(){$(window).off("resize.app",this.onResize),this.undelegateEvents(),this.$(".n-row-popover").popover("destroy")}},s.getDataTableColResizeMixin()))}),define("models/network/AcropolisNetworkModel",["models/AcropolisModel","data/DataURLConstants","data/DataProperties","utils/AppConstants"],function(e,t,i,n){"use strict";var s={NAME:"name",VLAN_ID:"vlanId",VSWITCH_NAME:"vswitchName",IP_CONFIG:"ipConfig",DHCP_OPTIONS:"dhcpOptions",POOL:"pool",LOGICAL_TIMESTAMP:"logicalTimestamp",NETWORK_TYPE:"network_type",ipConfig:{DHCP_ADDY:"dhcpServerAddress",NETWORK_ADDY:"networkAddress",PREFIX_LENGTH:"prefixLength",DEFAULT_GATEWAY:"defaultGateway",dhcpOptions:{DNS_SERVERS:"domainNameServers",DOMAIN_SEARCH:"domainSearch",DOMAIN_NAME:"domainName",TFTP_SERVER_NAME:"tftpServerName",BOOT_FILE_NAME:"bootFileName"}}},a={VLAN_ID:"vlan_id",IP_CONFIG:"ip_config",NET_ADDR:"network_address",PREFIX_LENGTH:"prefix_length",NETWORK_TYPE:"network_type",DHCP_OPTIONS:"dhcp_options",ip_config:{DHCP_ADDY:"dhcp_server_address",NETWORK_ADDY:"network_address",PREFIX_LENGTH:"prefix_length",DEFAULT_GATEWAY:"default_gateway",dhcpOptions:{DNS_SERVERS:"domain_name_servers",DOMAIN_SEARCH:"domain_search",DOMAIN_NAME:"domain_name",TFTP_SERVER_NAME:"tftp_server_name",BOOT_FILE_NAME:"boot_file_name"}}},r={INTERNAL:"internal",EXTERNAL:"external"};return e.extend({DP:s,V2_DP:a,VLAN_PREFIX:"vlan.",idAttribute:i.UUID,nameAttribute:i.NAME,urlRoot:t.MGMT_NETWORK,name:"AcropolisNetworkModel",entityType:n.ENTITY_ACROPOLIS_NETWORK,getDisplayVlanId:function(){var e=this.getVlanId();return void 0===e?this.get(this.nameAttribute):this.VLAN_PREFIX+e},getVlanId:function(){var e=this.get(s.VLAN_ID);return _.isUndefined(e)&&(e=this.get(a.VLAN_ID)),e},setMessage:function(e){e=e||this.actionMode,this.msg.action=n.ACTION_NAMES[e].toLowerCase(),this.msg.entityMsg=this.entityMsg,this.msg.entityType=n.ENTITY_NAMES[n.ENTITY_ACROPOLIS_NETWORK],this.msg.entityName=this.getDisplayName()},getDisplayName:function(){return this.escape(s.NAME)},getUuid:function(){return this.get(i.UUID)},getIpConfigAttr:function(e){var t=this.get(s.IP_CONFIG)||this.get(a.IP_CONFIG);if(t)return t[e]},getIpPool:function(){var e=this.getIpConfigAttr(s.POOL);if(!e){e=(this.get(a.IP_CONFIG)||{})[s.POOL]}return e},getDhcpOptionsAttr:function(e){var t=this.getIpConfigAttr(s.DHCP_OPTIONS)||this.getIpConfigAttr(a.DHCP_OPTIONS);if(t)return t[e]},getNetworkAddressWithPrefix:function(){var e=this.get(a.IP_CONFIG)||{};if(e[a.NET_ADDR])return e[a.NET_ADDR]+"/"+e[a.PREFIX_LENGTH];var t=s[s.IP_CONFIG];return this.getIpConfigAttr(t.NETWORK_ADDY)?this.getIpConfigAttr(t.NETWORK_ADDY)+"/"+this.getIpConfigAttr(t.PREFIX_LENGTH):void 0},isManagedNetwork:function(){var e=this.get(s.IP_CONFIG)||this.get(a.IP_CONFIG)||{};return!(!e[s[s.IP_CONFIG].NETWORK_ADDY]&&!e[a.NET_ADDR])},getURL:function(){return this.url()},isInternal:function(){return(this.get(s.NETWORK_TYPE)||"").toLowerCase()===r.INTERNAL},isEqual:function(e){var t=s[s.IP_CONFIG],i=t[s.DHCP_OPTIONS];if(!this.isPropertiesEqual(this.get(s.NAME),e.get(s.NAME)))return!1;if(!this.isPropertiesEqual(this.get(s.VLAN_ID),e.get(s.VLAN_ID)))return!1;if(!this.isPropertiesEqual(this.getIpConfigAttr(t.DHCP_ADDY),e.getIpConfigAttr(t.DHCP_ADDY)))return!1;if(!this.isPropertiesEqual(this.getIpConfigAttr(t.NETWORK_ADDY),e.getIpConfigAttr(t.NETWORK_ADDY)))return!1;var n=this.getIpConfigAttr(t.PREFIX_LENGTH),a=e.getIpConfigAttr(t.PREFIX_LENGTH);if(void 0!==n&&""!==n||(n=0),void 0!==a&&""!==a||(a=0),String(n)!==String(a))return!1;if(!this.isPropertiesEqual(this.getIpConfigAttr(t.DEFAULT_GATEWAY),e.getIpConfigAttr(t.DEFAULT_GATEWAY)))return!1;if(!this.isPropertiesEqual(this.getDhcpOptionsAttr(i.DNS_SERVERS),e.getDhcpOptionsAttr(i.DNS_SERVERS)))return!1;if(!this.isPropertiesEqual(this.getDhcpOptionsAttr(i.DOMAIN_SEARCH),e.getDhcpOptionsAttr(i.DOMAIN_SEARCH)))return!1;if(!this.isPropertiesEqual(this.getDhcpOptionsAttr(i.DOMAIN_NAME),e.getDhcpOptionsAttr(i.DOMAIN_NAME)))return!1;if(!this.isPropertiesEqual(this.getDhcpOptionsAttr(i.TFTP_SERVER_NAME),e.getDhcpOptionsAttr(i.TFTP_SERVER_NAME)))return!1;if(!this.isPropertiesEqual(this.getDhcpOptionsAttr(i.BOOT_FILE_NAME),e.getDhcpOptionsAttr(i.BOOT_FILE_NAME)))return!1;var r=this.getIpConfigAttr(s.POOL)||[],o=e.getIpConfigAttr(s.POOL)||[];return r.length===o.length&&_.reduce(r,function(e,t){return!!_.find(o,function(e){return t.range===e.range})},!0)},isPropertiesEqual:function(e,t){return"number"==typeof e&&(e=String(e)),"number"==typeof t&&(t=String(t)),!1===Boolean(e)&&!1===Boolean(t)||Boolean(e)===Boolean(t)&&e===t},toJSON:function(t){var i,n,a,r=this;i=_.reduce(s[s.IP_CONFIG][s.DHCP_OPTIONS],function(e,t){return!_.isEmpty(r.getDhcpOptionsAttr(t))||e},!1),n=!_.isEmpty(r.getIpConfigAttr(s.POOL)),a=i||n||_.reduce(s[s.IP_CONFIG],function(e,t){return!_.isEmpty(r.getIpConfigAttr(t))||e},!1);var o=e.prototype.toJSON.apply(this,arguments);return!i&&o[s.IP_CONFIG]&&delete o[s.IP_CONFIG][s.DHCP_OPTIONS],a||delete o[s.IP_CONFIG],o}},{DP:s,V2_DP:a,VLAN_PREFIX:"vlan."})}),define("models/vm/AcropolisSnapshotModel",["models/AcropolisModel","data/DataURLConstants","data/DataProperties","utils/ValidationUtil","utils/AppConstants"],function(e,t,i,n,s){"use strict";var a={VM_UUID:"vmUuid",PARENT_UUID:"parentSnapshotUuid",LINKED_LIST:"linkList",SNAPSHOT_INFO:"snapshotInfo",UUID:"snapshotUuid",CREATED_TIME:"createdTime",SPECS:"snapshotSpecs",NAME:"snapshotName",CREATE_SPEC:"vmCreateSpecification",SPEC_LIST:"specList",OVERRIDE_NETWORK:"overrideNetworkConfig",VM_GPUS:"vmGpus",VM_NICS:"vmNics"};return e.extend({DP:a,idAttribute:a.UUID,nameAttribute:i.NAME,urlRoot:t.MGMT_SNAPSHOTS,name:"AcropolisSnapshotModel",entityType:s.ENTITY_ACROPOLIS_SNAPSHOT,entityMsg:" a snapshot of ",validate:function(e){if(this.actionMode&&this.actionMode===s.ACTION_CLONE&&!n.isRequired(e[i.NAME]).valid)return this.i18n("invalidName")},takeSnapshot:function(e,t,i){return this.setupToTakeSnapShot(e,i),this.vmName=t,this.save()},setupToTakeSnapShot:function(e,t){this.set(a.VM_UUID,e),this.set(a.NAME,t),this.actionMode=s.ACTION_SNAPSHOT},setNics:function(e){this.nicCollection=e},getURL:function(){var e=this.url();return this.actionMode===s.ACTION_CLONE&&(e+=_.template(t.MGMT_SNAPSHOTS_CLONE,{snapshotId:this.snapshotId})),e},toJSON:function(t){var n={},r=[],o={};return this.actionMode===s.ACTION_SNAPSHOT?(o[a.VM_UUID]=this.get(a.VM_UUID),o[a.NAME]=this.get(a.NAME)||"",t&&t[s.IS_FANOUT]&&delete o[this.idAttribute],r.push(o),n[a.SPECS]=r):this.actionMode===s.ACTION_CLONE?(o=e.prototype.toJSON.apply(this,arguments),this.nicCollection&&(o[a.OVERRIDE_NETWORK]=!0,_.extend(o,this.nicCollection.toJSON())),_.isArray(o[i.NAME])?_.each(o[i.NAME],function(e){var n=_.clone(o);n[i.NAME]=e,t&&t[s.IS_FANOUT]&&delete n[this.idAttribute],r.push(n)},this):r.push(o),n[a.SPEC_LIST]=r,t&&t[s.IS_FANOUT]&&delete o[this.idAttribute]):n=e.prototype.toJSON.apply(this,arguments),n}},{DP:a})}),define("models/MinervaModel",["models/PollingModel","managers/I18nManager","data/DataProperties","utils/AppUtil","utils/AppConstants"],function(e,t,i,n,s){"use strict";return e.extend({name:"MinervaModel",getLatencyMessage:function(e){var i=this.getMessageTemplateValue(e);return t.ts("MinervaModel","latency_message",i.action+" "+i.entityType+(i.entityName?" "+decodeURI(i.entityName):""))},getNotificationMessage:function(e){var a=n.processSerializedObject(this._jqXHR.responseText);if(a[i.TASK_UUID]){var r=this.getMessageTemplateValue(e);return t.ts("MinervaModel","async_action_message",r.action+" "+(r.entityType?" "+r.entityType:"")+(r.entityName?" "+r.entityName:""))}if(a[i.SYSTEM_DATA_VALUE]||!_.isEmpty(a)&&(this.entityType===s.ENTITY_ICAP_SERVERS||this.entityType===s.ENTITY_FS_ADMINS||this.entityType===s.ENTITY_FS_USERS||this.entityType===s.ENTITY_USER_MAPPINGS_SEARCH||this.entityType===s.ENTITY_AV_SCAN_POLICY)){var o=this.getMessageTemplateValue(e);return e===s.ACTION_CONNECTION_TEST&&"kUnreachable"===this.get("connectionStatus")?t.t("MinervaModel","test_failed"):t.ts("MinervaModel","sync_action_message",o.action+" "+o.entityType+" "+decodeURI(o.entityName))}return t.ts("MinervaModel","failed_message",a.message)},getMessageTemplateValue:function(e){var t={};return e=e||this.actionMode,t.action=s.ACTION_NAMES[e].toLowerCase(),t.entityType=s.ENTITY_NAMES[this.entityType],t.entityName=this.getValue(this.nameAttribute),t}})}),define("models/fileserver/FileServerModel",["models/MinervaModel","data/DataURLConstants","data/DataProperties","managers/I18nManager","utils/AppConstants","utils/AppUtil","utils/ValidationUtil","utils/StatsUtil"],function(e,t,i,n,s,a,r,o){"use strict";var l={UUID:"uuid",NAME:"name",DOMAIN_CONFIG:"domainDirectoryDTO",NVMS:"nvms",INTERNAL_NETWORK:"internalNetwork",EXTERNAL_NETWORK:"externalNetworks",DNS_ENTRIES:"dnsEntries",DNS_SERVER_IP_ADDRESSES:"dnsServerIpAddresses",NTP_SERVERS:"ntpServers",PD_STATUS:"protectionDomainState",PD_NAME:"protectionDomainName",PD_STATE:"pdStatus",FILE_SERVER_STATE:"fileServerState",nvms:{NUM_CALCULATED_NVMS:"numCalculatedNvms",NUM_VCPUS_PER_VM:"numVcpus",MEM_PER_VM:"memoryGiB"},domainDirectoryDTO:{REALM:"windowsAdDomainName",USERNAME:"windowsAdUsername",PASSWORD:"windowsAdPassword"},internalNetwork:{UUID:"uuid",NETMASK:"subnetMask",GATEWAY:"defaultGateway",IPPOOL:"pool"},externalNetworks:{UUID:"uuid",NETMASK:"subnetMask",GATEWAY:"defaultGateway",IPPOOL:"pool"},NUM_SHARES:"numShares",NUM_HOME_SHARES:"numHomeShares",NUM_CONNECTED_USERS:"total_smb_connections",TOTAL_SPACE_USED:"fs_used_space_bytes",FILE_SERVER_SIZE_BYTES:"fileserver_size_bytes",TOTAL_ACTIVE_SPACE_USED:"fs_usedbydataset_bytes",SPACE_USED_BY_SNAPSHOTS:"fs_usedbysnapshots_bytes",TOTAL_SPACE_AVAILABLE:"fs_free_space_bytes",CONTAINER_ID:"containerId",VERSION:"version",UPGRADE_IN_PROGRESS:"upgradeInProgress",SIZE:"fileserver_size_bytes",REBALANCE_NEEDED:"isRebalanceNeeded",RECOMMENDATION:"recommendation",recommendation:{NUM_NVMS:"numNvms",RECOMMENDATION_TYPE:"recommendationType"},FILE_SERVER_SIZE:"sizeGib",PROTOCOL_TYPE:"protocolType",AD_DETAILS:"adDetails",adDetails:{REALM:"windowsAdDomainName",USERNAME:"windowsAdUsername",PASSWORD:"windowsAdPassword",ADD_USER_AS_FS_ADMIN:"addUserAsFsAdmin",RFC_2307_ENABLED:"rfc2307Enabled",PREFERRED_DOMAIN_CONTROLLER:"preferredDomainController",ORGANIZATIONAL_UNIT:"organizationalUnit",OVERWRITE_USER_ACCOUNT:"overwriteUserAccount"},DNS_DETAILS:"dnsDetails",NFS_V4_DOMAIN:"nfsv4Domain",CONFIGURE_LDAP:"configureLdap",LDAP_DETAILS:"ldapDetails",LOCAL_DETAILS:"localDetails",SERVER_IP:"uri",BASE_DN:"base",NAME_SERVICE_CONFIG:"nameServicesDTO",DNS_DOMAIN_NAME:"dnsDomainName",NFS_VERSION:"nfsVersion",FILE_BLOCKING_EXTENSIONS:"fileBlockingExtensions"};return e.extend({urlRoot:t.FILE_SERVER,entityType:s.ENTITY_FILE_SERVER,idAttribute:l.UUID,name:"FileServerModel",nameAttribute:l.NAME,entityName:null,DP:l,getURL:function(e){return"update"===e?this.urlRoot:this.url()},getValue:function(t){return t===this.nameAttribute?this.get(this.nameAttribute)||this.entityName:e.prototype.getValue.apply(this,arguments)},getLdapDetails:function(){return this.getUnescapedValue(this.DP.NAME_SERVICE_CONFIG+"."+this.DP.LDAP_DETAILS)},getServerIP:function(){var e=this.getLdapDetails();return e&&e[this.DP.SERVER_IP]},getRealmName:function(){return this.getValue(this.DP.DOMAIN_CONFIG+"."+this.DP.domainDirectoryDTO.REALM)},getUserName:function(){return this.getValue(this.DP.DOMAIN_CONFIG+"."+this.DP.domainDirectoryDTO.USERNAME)},getAdDetails:function(){return this.getValue(this.DP.NAME_SERVICE_CONFIG+"."+this.DP.AD_DETAILS)},getAdRealmName:function(){var e=this.getAdDetails();return e&&e[this.DP.adDetails.REALM]},getProtocolType:function(){var e=this.getAdDetails();return e&&e[this.DP.PROTOCOL_TYPE]},getLocalDetails:function(){return this.getValue(this.DP.NAME_SERVICE_CONFIG+"."+this.DP.LOCAL_DETAILS)},getLocalDetailsProtocolType:function(){var e=this.getLocalDetails();return e&&e[this.DP.PROTOCOL_TYPE]},setEntityName:function(e){this.entityName=e},getAvailableIpsPerNetwork:function(e){var t=0;return _.each(e.getIpPool(),function(e){t+=this.findDiffIpRange(e.range)},this),t},findDiffIpRange:function(e){var t,i;if(e){var n=e.split(" ");if(2===n.length)return t=n[0],i=n[1],a.findDifferenceBetweenIps(t,i)+1}return 0},getNumRequiredIntIpPerHost:function(e){return e?e.get(i.CLUSTER_HOSTS)+1:0},getNumRequiredExtIpPerHost:function(e){return e?e.get(i.CLUSTER_HOSTS):0},getDomainConfig:function(e){var t=this.get(l.DOMAIN_CONFIG);if(t)return t[e]},getNvmDetails:function(e){var t=this.get(l.NVMS),i=0;return t&&t.length>0&&_.some(t,function(t){if(t[e]>0)return i=t[e],!0}),i},getNvmDetailsForAll:function(e){var t=this.get(l.NVMS),i=[];return t&&t.length&&_.each(t,function(t){i.length?_.each(i,function(n){n.val===t[e]?n.count+=1:i.push({val:t[e],count:1})}):i.push({val:t[e],count:1})}),i},getNumberOfHost:function(){var e=this.clusterManager.getCurrentClusterModel();return e?e.get(i.CLUSTER_HOSTS):0},validateDomainConfig:function(e,t){var i={errorEntity:"",errorMsg:""},s=!1,a=[];return t||0!==$.trim(e.get([e.DP.REALM])).length||(i.errorEntity+=e.DP.REALM,s=!0),0===$.trim(e.get([e.DP.PASSWORD])).length&&(i.errorEntity+=e.DP.PASSWORD,s=!0),0===$.trim(e.get([e.DP.USERNAME])).length&&(i.errorEntity+=e.DP.USERNAME,s=!0),s&&a.push(n.t("FileServerModel","required_field_msg")),$.trim(e.get([e.DP.REALM])).length>0&&-1===$.trim(e.get([e.DP.REALM])).indexOf(".")&&(i.errorEntity+=e.DP.REALM,a.push(n.ts("FileServerModel","invalid_field_msg","domain name"))),a.length?(i.errorMsg=a.join("<br/>"),i):null},isValidInputs:function(e,t){var i="";if(_.isEmpty(e))i+=n.t("FileServerModel","required_field_msg");else if("ntp server"!==t){var s=this.isValidIpAddressList(e,null);s||(i+=n.ts("FileServerModel","invalid_field_msg",t))}return i},validateName:function(e){var t="";return 0===e.length?t+=n.t("FileServerModel","required_field_msg"):a.validateFileServerCharacters(e)||(t+=n.t("FileServerModel","invalid_fs_name_msg")),t},validateFsSize:function(e){var t="";return(isNaN(e)||!r.isNumber(e)||e<1)&&(t+=n.t("FileServerModel","invalid_fs_size_msg")),t},compareFsSizeWithClusterSize:function(e){var t="",s=this.clusterManager.getCurrentClusterModel();if(s){var r=s.get(i.CLUSTER_REDUNDANCY_STATE)||{},l=r[i.DESIRED_REDUNDANCY_FACTOR]||0,c=o.convertBytesToUnit(o.getUsageStats(s,i.NEW_FREE_BYTES_PHYSICAL),o.UOM_TIB,!1);0!==l&&e>c/l&&(t+=n.ts("FileServerModel","fs_size_gt_cluster_free_space",+a.formatFloat(c/l)+""))}return t},isValidIpAddressList:function(e,t){var i=!0;if(_.isEmpty(e)&&(i=!1),t&&_.isEqual(e,t))i=!1;else{i=!_.some(e,function(e){return!a.isValidIP(e.trim())})}return i},isEndIpInRange:function(e,t,i){if(!e||!t||!i)return!1;var n=e&t,s=e|~t;return e>n&&i<s},getFormField:function(e,t,i){return{value:e,fieldName:i,description:t}},isUsedIP:function(e){var t=!0,i=[];return this.get(this.DP.EXTERNAL_NETWORK)&&i.push(this.get(this.DP.EXTERNAL_NETWORK)[0].pool),this.get(this.DP.INTERNAL_NETWORK)&&i.push(this.get(this.DP.INTERNAL_NETWORK).pool),_.isEmpty(i)||_.some(i,function(i){if(i&&i[0]){var n=i[0].split(" "),s=a.strToLongIP(n[0]),r=a.strToLongIP(n[1]),o=a.strToLongIP(e);(o===s||o===r||o>s&&o<r)&&(t=!1)}}),t},getExistingPool:function(e){var t=[],i=0;return e?this.get(this.DP.INTERNAL_NETWORK)&&t.push(this.get(this.DP.INTERNAL_NETWORK).pool):this.get(this.DP.EXTERNAL_NETWORK)&&t.push(this.get(this.DP.EXTERNAL_NETWORK)[0].pool),_.isEmpty(t)||_.some(t,function(e){if(e&&e[0]){var t=e[0].split(" "),n=a.strToLongIP(t[0]),s=a.strToLongIP(t[1]);return i+=s-n+1}}),i},getRecommendationDetails:function(e){var t=this.get(l.RECOMMENDATION);if(t)return t[e]},strToLongIP:function(e){return a.strToLongIP(e)>>>0}},{DP:l})}),define("models/fileserver/ShareModel",["models/MinervaModel","data/DataURLConstants","data/DataProperties","managers/I18nManager","utils/AppConstants","utils/AppUtil"],function(e,t,i,n,s,a){"use strict";var r={UUID:"uuid",NAME:"name",OBJECT_VERSION:"objectVersion",FILE_SERVER_UUID:"fileServerUuid",FILE_SERVER_NAME:"fileServerName",WINDOWS_PREVIOUS_VERSION:"enablePreviousVersion",NUM_CONNECTED_USERS:"share_smb_connections",TOTAL_SPACE_USED:"share_usedbydataset_bytes",SPACE_USED_BY_SHARE:"share_used_bytes",SPACE_USED_BY_SNAPSHOTS:"share_usedbysnapshots_bytes",CONTAINER_ID:"containerId",DOMAIN_NAME:"windowsAdDomainName",DESCRIPTION:"description",ENABLE_ANTIVIRUS:"enableAntivirus",ENABLE_ABE:"enableAccessBasedEnumeration",ENABLE_CONCURRENT_READS:"concurrentReadsEnabled",CASE_SENSITIVE_NAMESPACE:"caseSensitiveNamespaceEnabled",SIMULTANEOUS_ACCESS_ENABLED:"simultaneousAccessEnabled",SYMLINK_CREATION_ENABLED:"symlinkCreationEnabled",SHARE_TYPE:"shareType",PROTOCOL_TYPE:"protocolType",SECONDARY_PROTOCOL_TYPE:"secondaryProtocolType",MAX_SIZE:"maxSizeGiB",DEFAULT_QUOTA_LIMIT:"defaultQuotaLimitGiB",QUOTA_ENFORCEMENT_TYPE:"quotaEnforcementType",SEND_QUOTA_NOTIFICATION:"sendQuotaNotificationsToUser",QUOTA_NOTIFICATION_RECEIPENTS:"quotaNotificationRecipients",AUTHENTICATION_TYPE:"authenticationType",DEFAULT_SHARE_ACCESS_TYPE:"defaultShareAccessType",ANONYMOUS_UID:"anonymousUid",ANONYMOUS_GID:"anonymousGid",SQUASH_TYPE:"squashType",CLIENT_READ_WRITE:"clientReadWrite",CLIENT_READ_ONLY:"clientReadOnly",CLIENT_NO_ACCESS:"clientNoAccess",SHARE_PATH:"sharePath",NESTED_SHARES:"nestedShares",PARENT_SHARE_UUID:"parentShareUuid",ENABLE_NFSV3:"enableNfsv3",ENABLE_NFSV4:"enableNfsv4",FILE_BLOCKING_EXTENSIONS:"fileBlockingExtensions",ENABLE_SMB3_ENCRYPTION:"enableSmb3Encryption"},o=["HOMES","HOME"];return e.extend({urlRoot:t.FILE_SERVER_SHARE,entityType:s.ENTITY_SHARE,name:"ShareModel",idAttribute:r.UUID,nameAttribute:r.NAME,DP:r,defaults:{name:"",fileServerUuid:null,enablePreviousVersion:!1},setUuid:function(e){this.fileServerUuid=e.fsUuid,this.shareId=e.shareId},getURL:function(e){return"update"===e||"create"===e?this.urlRoot=_.template(t.FILE_SERVER_SHARES,{uuid:this.get(this.DP.FILE_SERVER_UUID)||this.fileServerUuid}):"read"!==e&&"delete"!==e||(this.urlRoot=_.template(t.FILE_SERVER_SHARE,{uuid:this.fileServerUuid,share_uuid:this.shareId})),"read"===e?this.urlRoot:this.urlRoot+"?"+i.SP_FORCE+"=true"},validate:function(e,t){for(var i="",s=$.trim(e[r.NAME]),l="",c=0,u=s.length;c<u;c++)s.charCodeAt(c)<=127&&(l+=s[c]);if(0===s.length?i+=n.t("ShareModel","required_field_error_msg"):a.VALID_SHARE_NAME_CHARS_RE.test(l)||0===l.length?s.toUpperCase()===o[0].toUpperCase()?i+=n.ts("ShareModel","reserved_share_name_error_msg",$.trim(e[r.NAME])):s.toUpperCase()===o[1].toUpperCase()&&"GENERAL"===$.trim(e[r.SHARE_TYPE]).toUpperCase()?i+=n.ts("ShareModel","reserved_share_name_home_error_msg",$.trim(e[r.NAME])):0===s.indexOf(".")&&(i+=n.t("ShareModel","share_name_pattern_error_msg")):i+=n.t("ShareModel","invalid_share_name_error_msg"),0===$.trim(e[r.FILE_SERVER_UUID]).length&&(i+=n.t("ShareModel","file_server_select_error_msg")),a.isDisplayableNumber(Number($.trim(e[r.MAX_SIZE])))&&a.isNonNegativeInt(Number($.trim(e[r.MAX_SIZE])))||(i+=n.t("ShareModel","share_size_error_msg")),i)return i},validateShareSize:function(e,t){var i="";if(a.isDisplayableNumber(Number($.trim(e[r.MAX_SIZE])))&&a.isNonNegativeInt(Number($.trim(e[r.MAX_SIZE])))||(i+=n.t("ShareModel","share_size_error_msg")),i)return i}},{DP:r})}),define("views/basecomponents/datatables/DataTableColumnProvider",["views/basecomponents/datatables/DataTableTemplates","utils/CommonTemplates","data/DataProperties","managers/ClusterManager","managers/AccessManager","managers/TaskManager","models/task/AcropolisTaskModel","models/network/AcropolisNicModel","models/network/AcropolisNetworkModel","models/vm/AcropolisSnapshotModel","models/fileserver/FileServerModel","models/fileserver/ShareModel","utils/AppConstants","utils/AppUtil","utils/AlertUtil","utils/EventUtil","utils/I18nMixin","utils/DataTestMixin","utils/StatsUtil","utils/TimeUtil","utils/VisualizationUtil","utils/TooltipContent","utils/SVG"],function(e,t,i,n,s,a,r,o,l,c,u,d,h,p,T,E,S,g,A,m,f,I,C){"use strict";return _.extend({},S,g,{name:"DataTableColumnProvider",getDataColumns:function(g,v,R){var N,P=this;switch(g){case h.ENTITY_STORAGE_POOL:N=[{sTitle:this.i18n("name"),mData:i.NAME,sortKey:i.SP_NAME,sWidth:"30%",sClass:h.STYLE_ALERT_TABLE_INDICATOR},{sTitle:"Disks",mData:i.DISKS,sWidth:"10%",sClass:"right",bSearchable:!1,sortKey:i.SP_NUM_DISKS,mRender:function(e,t,i){return e?e.length:0}},{sTitle:"Free (Physical)",exportTitle:"Free (Logical)",sWidth:"10%",sClass:"right",sortKey:i.NEW_FREE_BYTES_PHYSICAL,mData:function(e,t,n){var s=e[i.FREE_CAPACITY];return P.renderStorageStats(s,t,e)},ntnxTooltip:I.STORAGE_STATS.STORAGE_POOL_FREE.ID},{sTitle:"Used (Physical)",exportTitle:"Used (Physical)",sWidth:"10%",sClass:"right",sortKey:i.NEW_TOT_USED_PHY,mData:function(e,t,n){var s=e[i.TOT_USED_PHY];return P.renderStorageStats(s,t,e)},ntnxTooltip:I.STORAGE_STATS.STORAGE_POOL_USED.ID},{sTitle:"Max Capacity (Physical)",exportTitle:"Max Capacity (Physical)",sWidth:"10%",sClass:"right",sortKey:i.NEW_TOT_CAPACITY,mData:function(e,t,n){var s=e[i.CAPACITY];return P.renderStorageStats(s,t,e)},ntnxTooltip:I.STORAGE_STATS.STORAGE_POOL_MAX.ID},{sTitle:"Disk IOPS",mData:i.STATS+"."+i.STATS_NUM_IOPS,sWidth:"10%",sClass:"right",sortKey:i.STATS_NUM_IOPS,bSearchable:!1,mRender:function(e,t,n){return P.renderStatsValue(i.STATS_NUM_IOPS,e,t,n,!1)}},{sTitle:"Disk IO B/W",mData:i.STATS+"."+i.STATS_BANDWIDTH,sWidth:"10%",sClass:"right",sortKey:i.STATS_BANDWIDTH,bSearchable:!1,mRender:function(e,t,n){return P.renderStatsValue(i.STATS_BANDWIDTH,e,t,n)}},{sTitle:"Disk Avg IO Latency",mData:i.STATS+"."+i.STATS_AVG_IO_LATENCY,sWidth:"10%",sClass:"right",sortKey:i.STATS_AVG_IO_LATENCY,bSearchable:!1,mRender:function(e,t,n){return P.renderStatsValue(i.STATS_AVG_IO_LATENCY,e,t,n)}}];break;case h.ENTITY_CONTAINER:N=[{sTitle:this.i18n("name"),mData:i.NAME,sortKey:i.CTR_NAME,sWidth:"20%",sClass:h.STYLE_ALERT_TABLE_INDICATOR},{sTitle:this.i18n("rf"),mData:i.RF,sortKey:i.CTR_RF,sWidth:"6%"},{sTitle:this.i18n("compression"),mData:i.COMPRESSION_DELAY_SECS,sWidth:"6%",sortKey:i.CTR_COMPRESSION,mRender:function(t,n,s){var a,r=s[i.COMPRESSION_ENABLED],o=!0===r?P.i18n("powerStates.on"):P.i18n("powerStates.off");return n===h.TABLE_COL_TYPE_DISPLAY?(a=e.CONTAINER_TABLE_CELL({value:o,width:"24px"}),t&&(a+=" "+P.i18ns("compressionDelayMinutes",s[i.COMPRESSION_DELAY_SECS]/60)),a):o}},{sTitle:this.i18n("cacheDeduplication"),mData:i.FINGER_PRINT_ON_WRITE,sWidth:"6%",sortKey:i.CTR_FINGER_PRINT,mRender:function(t,n,s){var a=s[i.FINGER_PRINT_ON_WRITE]||"";return a===h.FINGER_PRINT_ON_WRITE.NONE&&(a=h.FINGER_PRINT_ON_WRITE.OFF),a=p.toUpperCaseFirstChar(a),n===h.TABLE_COL_TYPE_DISPLAY?e.CONTAINER_TABLE_CELL({value:a,width:"auto"}):a}},{sTitle:this.i18n("capacityDeduplication"),mData:i.ON_DISK_DEDUP,sWidth:"6%",sortKey:i.CTR_FINGER_PRINT,mRender:function(t,n,s){var a=s[i.ON_DISK_DEDUP]||"";return a===h.FINGER_PRINT_ON_WRITE.NONE?a=h.FINGER_PRINT_ON_WRITE.OFF:a===h.FINGER_PRINT_ON_WRITE.POST_PROCESS&&(a=h.FINGER_PRINT_ON_WRITE.ON),a=a.replace(/_/g," "),a=p.toUpperCaseFirstChar(a),n===h.TABLE_COL_TYPE_DISPLAY?e.CONTAINER_TABLE_CELL({value:a,width:"100px"}):a}},{sTitle:this.i18n("erasureCoding"),mData:i.NAME,sWidth:"6%",bSortable:!1,mRender:function(t,n,s){var a=s[i.ERASURE_CODE];return void 0===a?h.STATS_NOT_AVAILABLE:(a=a&&"off"!==a.toLowerCase()?h.ERASURE_CODING.ON:h.ERASURE_CODING.OFF,a=p.toUpperCaseFirstChar(a),n===h.TABLE_COL_TYPE_DISPLAY?e.CONTAINER_TABLE_CELL({value:a,width:"100px"}):a)}},{sTitle:this.i18n("freeLogical"),exportTitle:this.i18n("freeLogical"),sWidth:"8%",sClass:"right",sortKey:i.NEW_FREE_BYTES_LOGICAL,mData:function(e,t,n){var s=e[i.NEW_FREE_BYTES_LOGICAL];return P.renderStorageStats(s,t,e)},ntnxTooltip:I.STORAGE_STATS.CONTAINER_FREE.ID},{sTitle:this.i18n("used"),exportTitle:this.i18n("used"),sWidth:"8%",sClass:"right",sortKey:i.NEW_CONTAINER_OWN_USAGE_LOGICAL,mData:function(e,t,n){var s=e[i.NEW_CONTAINER_OWN_USAGE_LOGICAL];return P.renderStorageStats(s,t,e)},ntnxTooltip:I.STORAGE_STATS.CONTAINER_USED.ID},{sTitle:this.renderEllipsedText(this.i18n("maxCapacity")),exportTitle:this.i18n("maxCapacity"),mData:function(e,t,n){var s=e[i.NEW_TOT_CAPACITY_LOGICAL];return P.renderStorageStats(s,t,e)},sortKey:i.NEW_TOT_CAPACITY_LOGICAL,sWidth:"8%",sClass:"right",ntnxTooltip:I.STORAGE_STATS.CONTAINER_MAX.ID},{sTitle:this.i18n("controllerIOPS"),mData:i.STATS+"."+i.STATS_CONTROLLER_NUM_IOPS,sWidth:"6%",sClass:"right",sortKey:i.STATS_CONTROLLER_NUM_IOPS,bSearchable:!1,mRender:function(e,t,n){return P.renderStatsValue(i.STATS_CONTROLLER_NUM_IOPS,e,t,n,!1)}},{sTitle:this.i18n("controllerIOBW"),mData:i.STATS+"."+i.STATS_CONTROLLER_BANDWIDTH,sWidth:"7%",sClass:"right",sortKey:i.STATS_CONTROLLER_BANDWIDTH,bSearchable:!1,mRender:function(e,t,n){return P.renderStatsValue(i.STATS_CONTROLLER_BANDWIDTH,e,t,n)}},{sTitle:this.i18n("controllerIOLatency"),mData:i.STATS+"."+i.STATS_CONTROLLER_AVG_IO_LATENCY,sWidth:"7%",sClass:"right",sortKey:i.STATS_CONTROLLER_AVG_IO_LATENCY,bSearchable:!1,mRender:function(e,t,n){return P.renderStatsValue(i.STATS_CONTROLLER_AVG_IO_LATENCY,e,t,n)}}];break;case h.ENTITY_ACROPOLIS_VOLUME_GROUP:N=[{sTitle:this.i18n("name"),mData:function(e,t,n){return e[i.NAME]=e[i.VG_NAME],e[i.VG_NAME]},sortKey:i.VG_NAME,sWidth:"40%",sClass:h.STYLE_ALERT_TABLE_INDICATOR},{sTitle:"Disks",mData:function(e,t,n){return e[i.VG_NFS_DISKS]?e[i.VG_NFS_DISKS].length:0},sWidth:"15%",sClass:"right",bSortable:!1,bSearchable:!1,sortKey:i.VG_NFS_DISKS},{sTitle:"Controller IOPS",mData:i.STATS_CONTROLLER_NUM_IOPS,sWidth:"15%",sClass:"right",sortKey:i.STATS_CONTROLLER_NUM_IOPS,bSearchable:!1,mRender:function(e,t,n){return t===h.TABLE_COL_TYPE_DISPLAY||t===h.TABLE_COL_TYPE_EXPORT?A.statsFormat(i.STATS_CONTROLLER_NUM_IOPS,e,!0):e}},{sTitle:"Controller IO B/W",mData:i.STATS_CONTROLLER_BANDWIDTH,sWidth:"15%",sClass:"right",sortKey:i.STATS_CONTROLLER_BANDWIDTH,bSearchable:!1,mRender:function(e,t,n){return t===h.TABLE_COL_TYPE_DISPLAY||t===h.TABLE_COL_TYPE_EXPORT?A.statsFormat(i.STATS_CONTROLLER_BANDWIDTH,e,!0):e}},{sTitle:"Controller IO Latency",mData:i.STATS_CONTROLLER_AVG_IO_LATENCY,sWidth:"15%",sClass:"right",sortKey:i.STATS_CONTROLLER_AVG_IO_LATENCY,bSearchable:!1,mRender:function(e,t,n){return t===h.TABLE_COL_TYPE_DISPLAY||t===h.TABLE_COL_TYPE_EXPORT?A.statsFormat(i.STATS_CONTROLLER_AVG_IO_LATENCY,e,!0):e}}];break;case h.ENTITY_HOST:N=[{sTitle:"Host Name",mData:i.NAME,sWidth:"15%",sortKey:i.HOST_NODE_NAME,sClass:h.STYLE_ALERT_TABLE_INDICATOR,mRender:function(e,i,n){return i!==h.TABLE_COL_TYPE_DISPLAY&&i!==h.TABLE_COL_TYPE_EXPORT||!T.isHostMetadataDetached(n)?e:t.IMPORTANT_CRITICAL_ALERT+" "+e}},{sTitle:"Host IP",mData:i.HYPERVISOR_IP,sortKey:i.HOST_IP_ADDRESS,sWidth:"8%"},{sTitle:"CVM IP",mData:i.SERVICE_VM_IP,sortKey:i.HOST_SERVICE_VM_IP,sWidth:"8%",mRender:this.renderApplicable(i.SERVICE_VM_IP)},{sTitle:"Hypervisor",mData:i.HYPERVISOR_TYPE,sWidth:"6%",sortKey:i.HOST_HYPERVISOR,mRender:function(e,t,n){var s=a.getGlobalTasks().getActiveNodeConvertTask(n[i.UUID]);return s?"Converting "+s.get(i.TASK_PERCENT_COMPLETE)+"%":h.HYPERVISOR_LABEL[e]}},{sTitle:"CPU Usage",mData:i.STATS+"."+i.STATS_HYP_CPU_USAGE,sWidth:"7%",sClass:"right",sortKey:i.STATS_HYP_CPU_USAGE,bSearchable:!1,mRender:function(e,t,n){return P.renderStatsValue(i.STATS_HYP_CPU_USAGE,e,t,n)}},{sTitle:"CPU Capacity",mData:i.CPU_CAPACITY,sWidth:"7%",sClass:"right",sortKey:i.HOST_CPU_FREQUENCY_HZ,mRender:function(e,t,n){var s=n[i.CPU_CORES]*n[i.CPU_CAPACITY];return t===h.TABLE_COL_TYPE_DISPLAY||t===h.TABLE_COL_TYPE_EXPORT?A.statsFormat(i.CPU_CAPACITY,s):s}},{sTitle:"Memory Usage",mData:i.STATS+"."+i.STATS_HYP_MEMORY_USAGE,sWidth:"7%",sClass:"right",sortKey:i.STATS_HYP_MEMORY_USAGE,bSearchable:!1,mRender:function(e,t,n){return P.renderStatsValue(i.STATS_HYP_MEMORY_USAGE,e,t,n)}},{sTitle:"Memory Capacity",mData:i.MEM_CAPACITY,sortKey:i.HOST_MEMORY_SIZE_BYTES,sWidth:"5%",sClass:"right",mRender:P.renderStorageBinaryStats},{sTitle:"Total Disk Usage",sWidth:"13%",sClass:"right",sortKey:i.NEW_TOT_USED_PHY,bSearchable:!1,mData:this.renderApplicable(i.NEW_TOT_USED_PHY,function(e,t,n){var s=e[i.TOT_CAPACITY],a=e[i.TOT_USED_PHY];if(t===h.TABLE_COL_TYPE_DISPLAY||t===h.TABLE_COL_TYPE_EXPORT)return A.storageFormat(a)+" of "+A.storageFormat(s);var r=parseInt(a,10),o=parseInt(s,10);return r===h.STATS_NO_VALUE||o===h.STATS_NO_VALUE?h.STATS_NO_VALUE:r},"mData")},{sTitle:"Disk Usage",sWidth:"6%",sClass:"right",bSearchable:!1,mData:this.renderApplicable(i.TOT_CAPACITY,function(e,t,n){var s=e[i.TOT_CAPACITY];if(s>0){var a=e[i.TOT_USED_PHY];return A.round(a/s*100)+"%"}return"0%"},"mData")},{sTitle:"Disk IOPS",mData:i.STATS+"."+i.STATS_NUM_IOPS,sWidth:"6%",sClass:"right",sortKey:i.STATS_NUM_IOPS,bSearchable:!1,mRender:this.renderApplicable(i.STATS_NUM_IOPS,function(e,t,n){
return P.renderStatsValue(i.STATS_NUM_IOPS,e,t,n,!1)})},{sTitle:"Disk IO B/W",mData:i.STATS+"."+i.STATS_BANDWIDTH,sWidth:"6%",sClass:"right",sortKey:i.STATS_BANDWIDTH,bSearchable:!1,mRender:this.renderApplicable(i.STATS_BANDWIDTH,function(e,t,n){return P.renderStatsValue(i.STATS_BANDWIDTH,e,t,n)})},{sTitle:"Disk IO Latency",mData:i.STATS+"."+i.STATS_AVG_IO_LATENCY,sWidth:"6%",sClass:"right",sortKey:i.STATS_AVG_IO_LATENCY,bSearchable:!1,mRender:this.renderApplicable(i.STATS_AVG_IO_LATENCY,function(e,t,n){return P.renderStatsValue(i.STATS_AVG_IO_LATENCY,e,t,n)})}];break;case h.ENTITY_DISK:N=[{sTitle:"Disk ID",mData:i.DISK_ID,sortKey:"id",searchId:"id",bSortable:!n.isMulticlusterNavMode(),sWidth:"10%",sClass:h.STYLE_ALERT_TABLE_INDICATOR},{sTitle:"Serial Number",mData:i.NAME,sortKey:i.DISK_MOUNT_PATH,searchId:i.DISK_MOUNT_PATH,sWidth:"12%"},{sTitle:"Hypervisor IP",mData:i.HOST_NAME,sortKey:i.DISK_NODE_IP,searchId:i.DISK_NODE_IP,sWidth:"10%"},{sTitle:"Tier",mData:i.TIER_NAME,sortKey:i.DISK_TIER,searchId:i.DISK_TIER,sWidth:"8%"},{sTitle:"Status",mData:i.ONLINE,sWidth:"8%",sortKey:i.DISK_MODE,searchId:i.DISK_MODE,mRender:function(e,t,i){return!0===e?"Online":"Offline"}},{sTitle:"Disk Usage",sWidth:"20%",sClass:"right",sortKey:i.USAGE_PERCENTAGE,bSearchable:!1,mData:function(e,n,s){var a=e[i.TOT_CAPACITY],r=e[i.TOT_USED_PHY];if(n===h.TABLE_COL_TYPE_DISPLAY)return a>=0?f.renderStorageBar(r,a):t.STATS_NOT_COMPATIBLE;if(n===h.TABLE_COL_TYPE_EXPORT)return A.roundPercent(r/a);var o=parseInt(r,10);return o===h.STATS_NO_VALUE||parseInt(a,10)===h.STATS_NO_VALUE?h.STATS_NO_VALUE:o}},{sTitle:"Disk IOPS",mData:i.STATS+"."+i.STATS_NUM_IOPS,sWidth:"10%",sClass:"right",sortKey:i.STATS_NUM_IOPS,bSearchable:!1,mRender:function(e,t,n){return P.renderStatsValue(i.STATS_NUM_IOPS,e,t,n,!1)}},{sTitle:"Disk IO B/W",mData:i.STATS+"."+i.STATS_BANDWIDTH,sWidth:"10%",sClass:"right",sortKey:i.STATS_NUM_IOPS,bSearchable:!1,mRender:function(e,t,n){return P.renderStatsValue(i.STATS_BANDWIDTH,e,t,n)}},{sTitle:"Disk Avg IO Latency",mData:i.STATS+"."+i.STATS_AVG_IO_LATENCY,sWidth:"10%",sClass:"right",sortKey:i.STATS_AVG_IO_LATENCY,bSearchable:!1,mRender:function(e,t,n){return P.renderStatsValue(i.STATS_AVG_IO_LATENCY,e,t,n)}}];break;case h.ENTITY_SWITCH:N=[{sTitle:"Switch Id",mData:i.SWITCH_ID,sWidth:"10%",sClass:h.STYLE_ALERT_TABLE_INDICATOR,mRender:function(e,t,i){return p.getDisplayableId(e)}},{sTitle:"Switch Name",mData:i.SWITCH_NAME,sortKey:"name",sWidth:"10%"},{sTitle:"Management Addresses",mData:i.SWITCH_MGMT_ADDRESSES,sWidth:"15%"},{sTitle:"Vendor Name",mData:i.SWITCH_VENDOR_NAME,sortKey:i.SWITCH_VENDOR_NAME,sWidth:"15%"},{sTitle:"Location Info",mData:i.SWITCH_LOCATION_INFO,sWidth:"10%"},{sTitle:"Contact Info",mData:i.SWITCH_CONTACT_INFO,sWidth:"10%"},{sTitle:"Description",mData:i.SWITCH_DESCRIPTION,sWidth:"30%"}];break;case h.ENTITY_PHYSICAL_SWITCH_INTERFACE:N=[{sTitle:"Physical Switch Interface",sWidth:"11%",mData:i.PHYSICAL_SWITCH_INTERFACE_NAME,sClass:"n-name"},{sTitle:"Switch Id",sWidth:"11%",mData:i.PHYSICAL_SWITCH_INTERFACE_SWITCH_ID,sClass:"n-switch-id",mRender:function(e,t,i){return p.getDisplayableId(e)}},{sTitle:"Index",sWidth:"8%",mData:i.PHYSICAL_SWITCH_INTERFACE_INDEX,sClass:"n-index",bSearchable:!1},{sTitle:"MTU (in Bytes)",sWidth:"8%",mData:i.PHYSICAL_SWITCH_INTERFACE_MTU,sClass:"n-mtu",bSearchable:!1},{sTitle:"Mac Address",sWidth:"14%",mData:i.PHYSICAL_SWITCH_INTERFACE_MAC_ADDRESS,sClass:"n-mac-address"},{sTitle:"Unicast Rx Pkts",mData:function(e,t,n){return e[i.STATS_NETWORK_UNICAST_RECEIVED_PACKETS]},sClass:"n-unicast-rx",sWidth:"8%",bSearchable:!1,mRender:function(e,t,n){return P.renderStatsValue(i.STATS_NETWORK_UNICAST_RECEIVED_PACKETS,e,t,n,!1)}},{sTitle:"Unicast Tx Pkts",mData:function(e,t,n){return e[i.STATS_NETWORK_UNICAST_TRANSMITTED_PACKETS]},sClass:"n-unicast-tx",sWidth:"8%",bSearchable:!1,mRender:function(e,t,n){return P.renderStatsValue(i.STATS_NETWORK_UNICAST_TRANSMITTED_PACKETS,e,t,n,!1)}},{sTitle:"Error Rx Pkts",mData:function(e,t,n){return e[i.STATS_NETWORK_ERROR_RECEIVED_PACKETS]},sClass:"n-error-rx",sWidth:"8%",bSearchable:!1,mRender:function(e,t,n){return P.renderStatsValue(i.STATS_NETWORK_ERROR_RECEIVED_PACKETS,e,t,n,!1)}},{sTitle:"Error Tx Pkts",mData:function(e,t,n){return e[i.STATS_NETWORK_ERROR_TRANSMITTED_PACKETS]},sClass:"n-error-tx",sWidth:"8%",bSearchable:!1,mRender:function(e,t,n){return P.renderStatsValue(i.STATS_NETWORK_ERROR_TRANSMITTED_PACKETS,e,t,n,!1)}},{sTitle:"Discard Rx Pkts",mData:function(e,t,n){return e[i.STATS_NETWORK_DISCARD_RECEIVED_PACKETS]},sClass:"n-discard-rx",sWidth:"8%",bSearchable:!1,mRender:function(e,t,n){return P.renderStatsValue(i.STATS_NETWORK_DISCARD_RECEIVED_PACKETS,e,t,n)}},{sTitle:"Discard Tx Pkts",mData:function(e,t,n){return e[i.STATS_NETWORK_DISCARD_TRANSMITTED_PACKETS]},sClass:"n-discard-tx",sWidth:"8%",bSearchable:!1,mRender:function(e,t,n){return P.renderStatsValue(i.STATS_NETWORK_DISCARD_TRANSMITTED_PACKETS,e,t,n)}}];break;case h.ENTITY_ALERT:N=[{sTitle:"",mData:i.ALERT_ID,sWidth:"12px",sClass:"center",bSortable:!1,bSearchable:!1,exportTitle:"Alert ID",mRender:function(e,t,i){return t===h.TABLE_COL_TYPE_DISPLAY?P.createDataRowCheckbox(e):e}},{sTitle:this.i18n("severity"),mData:i.ALERT_SEVERITY,sWidth:"60px",bSortable:!1,mRender:function(e,t,i){return t===h.TABLE_COL_TYPE_DISPLAY||t===h.TABLE_COL_TYPE_EXPORT?T.formatSeverity(e):t===h.TABLE_COL_TYPE_SORT?T.orderSeverity(e):e}},{sTitle:this.i18n("issue"),mData:i.ALERT_MESSAGE,sWidth:"35%",bSortable:!1,mRender:function(e,t,i){return T.formatIssue(e,i)}},{sTitle:this.i18n("create_time"),mData:i.ALERT_CREATED_TIMESTAMP,sWidth:"12%",bSortable:!1,mRender:function(e,t,i){return t===h.TABLE_COL_TYPE_DISPLAY||t===h.TABLE_COL_TYPE_EXPORT?m.formatDateTime(e>0?e/h.MICROS_PER_MILLI:0):e}},{sTitle:this.i18n("last_occurred"),mData:i.ALERT_LAST_OCCURENCE_TIMESTAMP,sWidth:"12%",bSortable:!1,mRender:function(e,t,i){return t===h.TABLE_COL_TYPE_DISPLAY||t===h.TABLE_COL_TYPE_EXPORT?m.formatDateTime(e>0?e/h.MICROS_PER_MILLI:0):e}},{sTitle:this.i18n("status"),mData:i.ALERT_RESOLVED,sWidth:"15%",bSortable:!1,mRender:function(e,t,n){return e?T.formatByUserAndTimestamp(e,n[i.ALERT_RESOLVED_BY],n[i.ALERT_RESOLVED_TIMESTAMP],n[i.ALERT_AUTO_RESOLVED],h.ALERT_FILTER.RESOLVED):n[i.ALERT_ACKNOWLEDGED]?T.formatByUserAndTimestamp(n[i.ALERT_ACKNOWLEDGED],n[i.ALERT_ACKNOWLEDGED_BY],n[i.ALERT_ACKNOWLEDGED_TIMESTAMP],n[i.ALERT_AUTO_RESOLVED],h.ALERT_FILTER.ACKNOWLEDGED):h.STATS_NOT_AVAILABLE}},{sTitle:this.i18n("entities"),mData:i.ALERT_ENTITY_TYPES,sWidth:"7%",bSortable:!1,sClass:"n-entity-type-col",mRender:function(e,t,i){return t===h.TABLE_COL_TYPE_DISPLAY||t===h.TABLE_COL_TYPE_EXPORT?P._entityRenderCB(e,t,i):(e||[]).join(", ")}},{sTitle:this.i18n("documentation"),mData:i.ALERT_CREATED_TIMESTAMP,sWidth:"12%",bSortable:!1,sClass:"n-entity-type-col",mRender:function(e,t,i){return P.renderAlertCauseAndResolution(e,t,i)}}],s.canModifyByEntityType(h.ENTITY_ALERT)&&N.push({mData:i.ALERT_CHECK_ID,sWidth:"20px",sClass:"right",bSortable:!1,mRender:function(e,t,i){return n.isMulticlusterNavMode()?"":T.formatEditAlertPolicy(e,i)}});break;case h.ENTITY_EVENT:N=[{sTitle:this.i18n("message"),mData:h.EVENT_CONTEXT_TYPE_MESSAGE,sWidth:"60%",bSortable:!1,mRender:function(e,t,i){return E.formatMessage(e,i)}},{sTitle:this.i18n("entities"),mData:i.EVENT_ENTITY_TYPES,sWidth:"20%",bSortable:!1,sClass:"n-entity-type-col",mRender:function(e,t,i){return t===h.TABLE_COL_TYPE_DISPLAY||t===h.TABLE_COL_TYPE_EXPORT?P._entityRenderCB(e,t,i):(e||[]).join(", ")}},{sTitle:this.i18n("created"),mData:i.EVENT_CREATED_TIMESTAMP,sWidth:"20%",bSortable:!1,mRender:function(e,t,i){return t===h.TABLE_COL_TYPE_DISPLAY||t===h.TABLE_COL_TYPE_EXPORT?m.formatDateTime(e>0?e/1e3:0):e}}],n.isMulticlusterNavMode()||(N=this.prependCheckboxColumn(N,{sTitle:"Event ID",mData:i.EVENT_ID,sWidth:"15px",sClass:"center",bSortable:!1,bSearchable:!1,bVisible:!1,mRender:function(e,t,i){return t===h.TABLE_COL_TYPE_DISPLAY?"":e}}));break;case h.ENTITY_REMOTE_SITE:N=[{sTitle:this.i18n("name"),mData:i.RS_NAME,sWidth:"15%",sClass:h.STYLE_ALERT_TABLE_INDICATOR,mRender:function(t,n,s){return n===h.TABLE_COL_TYPE_DISPLAY&&s[i.RS_STATUS]===h.RS_STATUS.DEPLOYING?t+e.RS_DEPLOYING_TABLE_CELL:t}},{sTitle:"Remote Site Type",mData:i.RS_CLOUD_TYPE,sWidth:"10%",bSearchable:!1,mRender:function(e,t,i){return null!==e?h.CLOUD_DISPLAY_NAMES[e]||"Unknown":h.PHYSICAL_CLUSTER}},{sTitle:"Remote Addresses",mData:i.RS_IP_ADDRESS,sWidth:"10%"},{sTitle:"vStore Mappings",mData:i.RS_VSTORE_NAME_MAP,sWidth:"15%",bSearchable:!1,mRender:function(e,t,i){if(e){var n="";return _.each(_.keys(e),function(t,i,s){n+=t+" : "+e[t]+(i+1<s.length?", ":"")}),n}return e||""}},{sTitle:"Capabilities",mData:i.RS_USER_CAPABILITIES,sWidth:"10%",mRender:function(e,t,n){return t===h.TABLE_COL_TYPE_DISPLAY&&n[i.RS_STATUS]===h.RS_STATUS.DEPLOYING?h.STATE_PENDING:e}},{sTitle:"Compress on wire",mData:i.RS_COMPRESSION_ENABLED,sWidth:"9%",mRender:function(e,t,i){return e?"On":"Off"}},{sTitle:"Use SSH Tunnel",mData:i.RS_SSH_ENABLED,sWidth:"9%",exportTitle:"Mode",mRender:function(t,i,n){return i===h.TABLE_COL_TYPE_DISPLAY&&t?h.LABEL_YES+e.RS_SSH_TUNNEL_WARNING_ICON:t?h.LABEL_YES:h.LABEL_NO}},{sTitle:"B/W Limit (Tx)",mData:i.RS_MAX_BPS,sWidth:"7%",sClass:"right",mRender:function(e,t,i){return t===h.TABLE_COL_TYPE_DISPLAY||t===h.TABLE_COL_TYPE_EXPORT?e?A.bandwidthFormat(e/1e3):h.STATS_NOT_AVAILABLE:e}},{sTitle:"B/W Used (Tx)",sWidth:"7%",sClass:"right",bSearchable:!1,mData:function(e,t){var n=e[i.STATS]?e[i.STATS][i.STATS_REP_BW_TRANSFERRED]:h.STATS_NO_VALUE;return P.renderStatsValue(i.STATS_REP_BW_TRANSFERRED,n,t,e)}},{sTitle:"B/W Used (Rx)",sWidth:"8%",sClass:"right",bSearchable:!1,mData:function(e,t){var n=e[i.STATS]?e[i.STATS][i.STATS_REP_BW_RECEIVED]:h.STATS_NO_VALUE;return P.renderStatsValue(i.STATS_REP_BW_RECEIVED,n,t,e)}}];break;case h.ENTITY_PROTECTION_DOMAIN:case h.ENTITY_ASYNC_PD:N=[{sTitle:"",mData:i.PD_ACTIVE,sWidth:"20px",bSearchable:!1,exportTitle:"Mode",mRender:function(e,t,n){return t===h.TABLE_COL_TYPE_DISPLAY?f.renderProtectionDomainIcon(n):e?"Active"+(null!==n[i.PD_VSTORE_ID]?" (vStore)":""):"Inactive"+(null!==n[i.PD_VSTORE_ID]?" (vStore)":"")}},{sTitle:this.i18n("name"),mData:i.PD_NAME,sClass:h.STYLE_ALERT_TABLE_INDICATOR,sWidth:"21%",mRender:function(e,t,i){return t===h.TABLE_COL_TYPE_DISPLAY?_.escape(e):e}},{sTitle:"Remote Sites",mData:i.PD_REMOTE_SITES,sWidth:"17%",mRender:function(e,t,i){return e&&e.length?e.join(", "):h.STATS_NOT_AVAILABLE}},{sTitle:"Entity Count",mData:function(e){return e[i.PD_VMS].concat(e[i.PD_VGS])},sWidth:"7%",sClass:"right",bSearchable:!1,mRender:function(e,t,i){return e?e.length:0}},{sTitle:"Next Snapshot Time",mData:i.PD_NEXT_SNAPSHOT_TIME,sWidth:"12%",sClass:"right",mRender:function(e,t,i){return P.renderDateTimeValue(e,t,i)}},{sTitle:"Snapshot Exclusive Usage",mData:i.PD_SPACE_USAGE,sWidth:"7%",sClass:"right",bSearchable:!1,mRender:P.renderStorageStats},{sTitle:"B/W Used (Tx)",sWidth:"10%",sClass:"right",bSearchable:!1,mData:function(e,t){var n=e[i.STATS]?e[i.STATS][i.STATS_REP_BW_TRANSFERRED]:h.STATS_NO_VALUE;return P.renderStatsValue(i.STATS_REP_BW_TRANSFERRED,n,t,e)}},{sTitle:"B/W Used (Rx)",sWidth:"10%",sClass:"right",bSearchable:!1,mData:function(e,t){var n=e[i.STATS]?e[i.STATS][i.STATS_REP_BW_RECEIVED]:h.STATS_NO_VALUE;return P.renderStatsValue(i.STATS_REP_BW_RECEIVED,n,t,e)}},{sTitle:"Ongoing",mData:i.PD_ONGOING_REPS,sWidth:"8%",sClass:"right",bSearchable:!1},{sTitle:"Pending",mData:i.PD_PENDING_REPS,sWidth:"8%",sClass:"right",bSearchable:!1}];break;case h.ENTITY_REPLICATION:N=[{sTitle:"ID",mData:i.REP_ID,sWidth:"20%"},{sTitle:"Remote Site",mData:i.REP_REMOTE,sWidth:"10%"},{sTitle:"Snapshot ID",mData:i.REP_SNAPSHOT_ID,sWidth:"10%"},{sTitle:"Protection Domain",mData:i.REP_PD_NAME,sWidth:"10%"},{sTitle:"Replication Status",mData:i.REP_ID,sWidth:"10%"},{sTitle:"Percent Complete",mData:i.REP_COMPLETE_PERCENT,sWidth:"10%"},{sTitle:"Est. Time Complete",mData:i.REP_ID,sWidth:"10%",mRender:function(e,t,i){return""}},{sTitle:"Data Size",mData:i.REP_COMPLETE_BYTES,sWidth:"10%",mRender:P.renderStorageStats},{sTitle:"Current File",mData:i.REP_ID,sWidth:"10%",mRender:function(e,t,i){return""}}];break;case h.ENTITY_CLUSTER:N=[{sTitle:"Cluster Name",mData:i.NAME,sWidth:"25%",sClass:"left",bSortable:!0},{sTitle:"Acropolis Version",mData:i.CLUSTER_NOS_VERSION,sWidth:"25%",sClass:"left"},{sTitle:"Health",mData:i.CLUSTER_UUID,sWidth:"25%",sClass:"left",mRender:function(e,t,i){var s=n.getClusterModelByClusterUuid(e);return s&&s.isAvailable()?s.getClusterHealthStatus():(p.debug("DataTableColumnProvider: mRender: no health data for cluster ",e),h.UNKNOWN_VALUE)}},{sTitle:"Hypervisor(s)",mData:"hypervisorTypes",sWidth:"25%",sClass:"left",mRender:function(e,t,i){return _.reduce(e,function(e,t){return t?(t=h.HYPERVISOR_LABEL[t],e.length?e+=", "+t:t):e},"")}}];break;case h.ENTITY_MULTICLUSTER_HEALTH:var O=function(e){return function(i,s,a){var r,o=n.getClusterModelByClusterUuid(i);if(o.isAvailable()){if(r=o.getClusterHealthStatsModel()){var l=_.clone(r.getHealthStats(e)),c=!0;if(_.each(l,function(e,t){c=c&&-1===e}),c)return s===h.TABLE_COL_TYPE_SORT?-1:s===h.TABLE_COL_TYPE_EXPORT?h.STATS_NOT_AVAILABLE:t.ENTITY_HEALTH_STATUS_NOSHOW({noShowStr:h.STATS_NOT_AVAILABLE});var u=_.reduce(l,function(e,t){return e+=t},0);if(s===h.TABLE_COL_TYPE_EXPORT){var d="total("+u+") ";return _.each(l,function(e,t){d+=t+"("+e+") "}),d}return s===h.TABLE_COL_TYPE_SORT?u:t.ENTITY_HEALTH_STATUS(_.extend(l,{total:u}))}p.log("DataTableColumnProvider: mRender: Issue  retrieving "+e+" data for cluster uuid "+i)}else p.debug("DataTableColumnProvider: mRender: no ","health data for cluster ",i);return h.STATS_NOT_AVAILABLE}};N=[{sTitle:"CLUSTER NAME",mData:i.NAME,sWidth:"10%",sClass:"left",bSortable:!0,mRender:function(e,t,i){return e}},{sTitle:"CURRENT HEALTH",mData:i.CLUSTER_UUID,sWidth:"10%",sClass:"left",mRender:function(e,i,s){var a=n.getClusterModelByClusterUuid(e),r=a.getClusterHealthStatus();return i===h.TABLE_COL_TYPE_EXPORT?r:t.CLUSTER_HEALTH_STATUS({status:r.toLowerCase()})}},{sTitle:"HOSTS HEALTH STATUS",mData:i.CLUSTER_UUID,sWidth:"14%",sClass:"right",sType:"numeric",bSearchable:!1,mRender:O(h.ENTITY_HOST)},{sTitle:"DISKS HEALTH STATUS",mData:i.CLUSTER_UUID,sWidth:"14%",sClass:"right",sType:"numeric",mRender:O(h.ENTITY_DISK)},{sTitle:"VMS HEALTH STATUS",mData:i.CLUSTER_UUID,sWidth:"14%",sClass:"right",sType:"numeric",bSearchable:!1,mRender:O(h.ENTITY_VM)},{sTitle:"PROTECTION DOMAINS HEALTH STATUS",mData:i.CLUSTER_UUID,sWidth:"14%",sClass:"right",sType:"numeric",bSearchable:!1,mRender:O(h.ENTITY_PROTECTION_DOMAIN)},{sTitle:"REMOTE SITES HEALTH STATUS",mData:i.CLUSTER_UUID,sWidth:"14%",sClass:"right",sType:"numeric",bSearchable:!1,mRender:O(h.ENTITY_REMOTE_SITE)},{sTitle:"",mData:i.CLUSTER_UUID,sWidth:"10%",sClass:"right",bSearchable:!1,bSortable:!1,mRender:function(e,i,s){return i===h.TABLE_COL_TYPE_EXPORT?"":n.isClusterAvailable(e)?t.HEALTH_PAGE_LINK({clusterUuid:e}):h.STATS_NOT_AVAILABLE}}];break;case h.ENTITY_METRO_AVAILABILITY_PD:N=[{sTitle:"",mData:i.PD_METRO_AVAIL,sWidth:"5px",exportTitle:"Mode",mRender:function(e,t,n){if(t===h.TABLE_COL_TYPE_DISPLAY)return f.renderProtectionDomainIcon(n);if(e){var s=e[i.PD_METRO_AVAIL_STATUS]||"";return(e[i.PD_METRO_AVAIL_ROLE]||"")+" ("+s+")"}return""}},{sTitle:this.i18n("name"),mData:i.PD_NAME,sClass:h.STYLE_ALERT_TABLE_INDICATOR,sWidth:"15%",mRender:function(e,t,i){return t===h.TABLE_COL_TYPE_DISPLAY?_.escape(e):e}},{sTitle:"Role",mData:i.PD_METRO_AVAIL,sWidth:"5%",mRender:function(e,t,n){return e?e[i.PD_METRO_AVAIL_ROLE]||"":""}},{sTitle:"Metro Remote Site",mData:function(e,t,n){var s=e[i.PD_METRO_AVAIL];return s?s[i.PD_METRO_AVAIL_REMOTE_SITE]:null},sWidth:"15%",mRender:function(e,t,i){return e||""}},{sTitle:"Storage Container",mData:function(e,t,n){var s=e[i.PD_METRO_AVAIL];return s?s[i.PD_METRO_AVAIL_VSTORE]:null},sWidth:"10%",mRender:function(e,t,i){return e||""}},{sTitle:"Status",mData:function(e,t,n){var s=e[i.PD_METRO_AVAIL];return s?s[i.PD_METRO_AVAIL_STATUS]:null},sWidth:"15%",mRender:function(t,i,n){if(i===h.TABLE_COL_TYPE_DISPLAY){if(t===h.PD_METRO_AVAIL_STATUS.SYNCHRONIZING)return e.PD_METRO_AVAIL_SYNCING_TABLE_CELL;if(t===h.PD_METRO_AVAIL_STATUS.ENABLED)return e.PD_METRO_AVAIL_ENABLED_TABLE_CELL;if(t===h.PD_METRO_AVAIL_STATUS.DISABLED)return e.PD_METRO_AVAIL_INACTIVE_TABLE_CELL({label:t})}return t||""}},{sTitle:"Failure Handling",mData:function(e){var t=e[i.PD_METRO_AVAIL],n=t[i.PD_METRO_AVAIL_FAILURE_HANDLING]||"";return n&&h.FAILURE_HANDLING_DISPLAY_VALUES[n]||null},sWidth:"20%",bSearchable:!1,mRender:function(t,n,s){if(t&&n===h.TABLE_COL_TYPE_DISPLAY){var a=s[i.PD_METRO_AVAIL];return(a?a[i.PD_METRO_AVAIL_STATUS]:null)===h.PD_METRO_AVAIL_STATUS.ENABLED?t:e.PD_METRO_AVAIL_INACTIVE_TABLE_CELL({label:t})}return t||""}},{sTitle:"B/W Used (Tx)",mData:function(e,t,n){var s=e[i.PD_METRO_REPLICATION_STATS];return s?s[i.STATS_REP_BW_TRANSFERRED]||null:null},sWidth:"10%",sClass:"right",bSearchable:!1,mRender:function(e,t,n){return t===h.TABLE_COL_TYPE_DISPLAY||t===h.TABLE_COL_TYPE_EXPORT?A.statsFormat(i.STATS_REP_BW_TRANSFERRED,e):e}},{sTitle:"B/W Used (Rx)",mData:function(e,t,n){var s=e[i.PD_METRO_REPLICATION_STATS];return s?s[i.STATS_REP_BW_RECEIVED]||null:null},sWidth:"10%",sClass:"right",bSearchable:!1,mRender:function(e,t,n){return t===h.TABLE_COL_TYPE_DISPLAY||t===h.TABLE_COL_TYPE_EXPORT?A.statsFormat(i.STATS_REP_BW_RECEIVED,e):e}}];break;case h.ENTITY_ACROPOLIS_TASK:N=[{sTitle:"Operation",mData:r.DP.OPERATION_TYPE,sWidth:"13%",mRender:function(e,t,n){var s=r.DISPLAY_OPERATION[e]||e;if(t===h.TABLE_COL_TYPE_DISPLAY){s+='<span style="display:none" class="'+n[i.UUID]+'"></span>'}var a=n[r.DP.MESSAGE];return a&&(s+='<span class="n-task-message-widget label" data-trigger="hover" data-toggle="popover" title="Message" data-content="<p>'+_.escape(a)+'</p>">i</span>'),s}},{sTitle:"Entities",mData:function(e,t,i){return e&&e[r.DP.ENTITY_LIST]?e[r.DP.ENTITY_LIST]:(p.debug("DataTableColumnProvider: task uuid ",e.uuid," has no entityList property."),"")},sWidth:"34%",mRender:function(e,t,n){var s="";return _.each(e,function(e){var t=e[r.DP.ENTITY_NAME]||e[i.UUID];s+=e[r.DP.ENTITY_TYPE]+(e[r.DP.ENTITY_NAME]?"":" (UUID)")+" : "+t+"<BR>"}),t===h.TABLE_COL_TYPE_DISPLAY?s:s.replace("<BR>","")}},{sTitle:"Percent Complete",mData:function(e,t,n){return e&&e[r.DP.PERCENTAGE_COMPLETE]?e[r.DP.PERCENTAGE_COMPLETE]:(p.debug("DataTableColumnProvider: task uuid ",e[i.UUID]," has no "+r.DP.PERCENTAGE_COMPLETE+" property."),"")},sWidth:"8%"},{sTitle:"Progress Status",mData:function(e,t,i){var n=e[r.DP.PROGRESS_STATUS],s="";if("Failed"===n){var a=e[r.DP.META_RESPONSE];if(a&&a[r.DP.ERROR_DETAIL]){var o=a[r.DP.ERROR_DETAIL].replace(/'/g,'"');s=n+" : "+o;var l=p.truncateNotificationMessage(s,50);return t===h.TABLE_COL_TYPE_DISPLAY?"<span title='"+o+"'>"+l+"</span>":s}}return n},sWidth:"17%"},{sTitle:this.i18n("create_time"),mData:r.DP.CREATE_TIME,sWidth:"12%",sType:"numeric",bSortable:!0,sortKey:r.DP.CREATE_TIME,mRender:function(e,t,i){return t===h.TABLE_COL_TYPE_SORT?e:m.formatDateTime(e/1e3)}},{sTitle:"Duration",mData:function(e,t,i){var n=e[r.DP.START_TIME],s=e[r.DP.COMPLETE_TIME],a=p.isDisplayableNumber(n),o=p.isDisplayableNumber(s);return a&&o?s-n:!a&&o?h.INVALID_STRING:"In Progress..."},sWidth:"11%",mRender:function(e,t,i){return _.isNumber(e)?p.getElapsedTime({timestamp:e/1e3,includeAgo:!1,isDelta:!0,secondDetail:!0}):e}}];break;case h.ENTITY_ACROPOLIS_NIC:if(N=[{sTitle:this.i18n("vlan_id"),mData:function(e,t,i){var n="";return e.network&&(n=e.network[l.DP.VLAN_ID],_.isUndefined(n)&&(n=e.network[l.V2_DP.VLAN_ID]),_.isUndefined(n)&&(n="")),n},sWidth:"33%",mRender:function(e,t,n){return p.isDisplayableNumber(e)?(e=l.VLAN_PREFIX+e,t===h.TABLE_COL_TYPE_DISPLAY?'<span class="vlanid" uuid="'+n[i.UUID]+'">'+e+"</span>":e):h.INVALID_STRING}},{sTitle:this.i18n("mac_address"),mData:o.DP.MAC_ADDRESS,sClass:"n-mac-address",sWidth:"33%"},{sTitle:this.i18n("requested_ip_address"),mData:function(e,t,i){return e[o.DP.REQ_IP_ADDRESS]||""},sWidth:"33%"},{sTitle:this.i18n("actions"),mData:o.DP.MAC_ADDRESS,sWidth:"110px",bSortable:!1,bSearchable:!1,exportTitle:"Title",mRender:function(e,i,n){if(i===h.TABLE_COL_TYPE_DISPLAY){var a=s.canModifyByEntityType(h.ENTITY_ACROPOLIS_NIC);return t.NIC_ITEM({canModify:a,targetId:e})}return""}}],R&&n.isMulticlusterNavMode()){if(n.getClusterModelByClusterUuid(R).isNicDisconnectSupported()){N[0].sWidth="13%";var y={sTitle:this.i18n("network_connection_state"),mData:o.DP.IS_CONNECTED,sClass:"n-network-connection-state",sWidth:"20%",mRender:function(e,t,i){return e?S.i18nStatic("VmNicFormView","connected"):S.i18nStatic("VmNicFormView","dis_connected")}};N.splice(2,0,y)}}break;case h.ENTITY_ACROPOLIS_SNAPSHOT:N=[{sTitle:this.i18n("create_time"),mData:c.DP.SNAPSHOT_INFO,sWidth:"50%",mClass:"center",sType:"numeric",bSearchable:!0,exportTitle:"Title",mRender:function(e,t,i){var n=e[c.DP.CREATED_TIME];return t===h.TABLE_COL_TYPE_SORT?n:m.formatDateTime(n/1e3)}},{sTitle:this.i18n("name"),mData:function(e,t,i){return(e[c.DP.SNAPSHOT_INFO]||{})[c.DP.NAME]||""},sWidth:"50%",bSortable:!0,bSearchable:!0,exportTitle:"Title"},{sTitle:this.i18n("actions"),mData:c.DP.UUID,sClass:"snapshotActions",sWidth:"210px",bSortable:!1,bSearchable:!1,exportTitle:"Title",mRender:function(e,i,n){if(i===h.TABLE_COL_TYPE_DISPLAY){var a=s.canModifyByEntityType(h.ENTITY_ACROPOLIS_SNAPSHOT);return t.SNAPSHOT_ITEM({canModify:a,targetId:e})}return""}}];break;case h.ENTITY_FILE_SERVER:var D=h.FILE_SERVER_STATES.FS_ACTIVATED_NOT_REACHABLE;N=[{sTitle:this.i18n("name"),mData:u.DP.NAME,sClass:h.STYLE_ALERT_TABLE_INDICATOR,sWidth:"40%",bSearchable:!0,bSortable:!0,mRender:function(e,t,n){var s=n[i.ID],r=a.taskCollection,o=r.filter(function(e){return e.get(i.TASK_TYPE)===h.TASK_FILE_SERVER_UPGRADE&&e.get(h.TASK_SUBTASK_LIST)}),l=o.some(function(e){return e.get(h.TASK_SUBTASK_LIST).some(function(e){return e[i.TASK_ENTITY_ID]&&e[i.TASK_ENTITY_ID][0]===s&&e[i.TASK_STATUS]===h.TASK_STATUS_ACTIVE})}),c=r.some(function(e){return e.get(i.TASK_ENTITY_ID)&&e.get(i.TASK_ENTITY_ID)[0]===s&&e.get(i.TASK_TYPE)===h.TASK_FILE_SERVER_ACTIVATE&&e.get(i.TASK_STATUS)===h.TASK_STATUS_ACTIVE});return l?e+=" - "+P.i18n("fs_status.upgrading"):c?e+=" ("+P.i18n("fs_status.activating")+")":n[u.DP.FILE_SERVER_STATE]===h.FILE_SERVER_STATES.FS_PD_ACTIVATED?e+=" ("+P.i18n("fs_status.needs_activation")+")":n[u.DP.FILE_SERVER_STATE]===h.FILE_SERVER_STATES.FS_PD_DEACTIVATED&&(e+=" ("+P.i18n("fs_status.not_active")+")"),t===h.TABLE_COL_TYPE_DISPLAY?_.escape(e):e}},{sTitle:this.i18n("share_count"),mData:u.DP.NUM_SHARES,sWidth:"15%",sClass:"middle",sType:"numeric",bSearchable:!0,bSortable:!0,mRender:function(e,t,i){return e||0}},{sTitle:this.i18n("open_connections"),sWidth:"15%",sClass:"middle",sType:"numeric",bSearchable:!0,bSortable:!0,mData:function(e,t,i){var n=A.getUsageStats(e,u.DP.NUM_CONNECTED_USERS);return n>0?n:"0"}},{sTitle:this.i18n("space_used"),exportTitle:this.i18n("space_used"),sWidth:"15%",sClass:"middle",sType:"numeric",bSearchable:!0,bSortable:!0,mData:function(e,t,i){var n=A.getUsageStats(e,u.DP.TOTAL_SPACE_USED);return n<=0?h.STATS_NOT_AVAILABLE:A.storageFormat(n)},ntnxTooltip:I.STORAGE_STATS.FILE_SERVER_USED.ID},{sTitle:this.i18n("snapshots_space_used"),sWidth:"15%",sClass:"middle",sType:"numeric",bSearchable:!0,bSortable:!0,mData:function(e,t,i){var n=A.getUsageStats(e,u.DP.SPACE_USED_BY_SNAPSHOTS);return n<=0?h.STATS_NOT_AVAILABLE:A.storageFormat(n)}},{sTitle:this.i18n("recommendations"),sWidth:"15%",sClass:"middle",sType:"numeric",bSearchable:!0,bSortable:!0,mData:function(e,t,i){return e.isRebalanceNeeded},mRender:function(e,t,n){return t===h.TABLE_COL_TYPE_DISPLAY?n[u.DP.FILE_SERVER_STATE]===h.FILE_SERVER_STATES.FS_PD_ACTIVATED||n[u.DP.FILE_SERVER_STATE]===h.FILE_SERVER_STATES.FS_PD_DEACTIVATED||n[u.DP.FILE_SERVER_STATE]===D||n[u.DP.FILE_SERVER_STATE]===h.FILE_SERVER_STATES.NOT_REACHABLE?'<div class="fs-recommendation"><span class="warning-icon">'+C.SVGIcon("Exclamation_Mark","-inline -mini")+"</span> "+P.i18n("not_reachable")+"</div>":n[u.DP.RECOMMENDATION]&&n[u.DP.REBALANCE_NEEDED]?'<div class="fs-recommendation"><span class="warning-icon">'+C.SVGIcon("Exclamation_Mark","-inline -mini")+'</span> <a action="'+h.ACTION_LOAD_BALANCE+'"actionTarget="'+h.PAGE_FILE_SERVER+'"actiontargetId="'+n[i.UUID]+'">'+P.i18n("performance_opt")+"</a></div>":h.STATS_NOT_AVAILABLE:e}}];break;case h.ENTITY_SHARE:N=[{sTitle:this.i18n("name"),mData:d.DP.NAME,sClass:h.STYLE_ALERT_TABLE_INDICATOR+" share-name-tooltip-text",sWidth:"35%",bSearchable:!0,bSortable:!0,mRender:function(e,t,i){return t===h.TABLE_COL_TYPE_DISPLAY?"HOMES"===i.shareType?'<span class="home-tooltip" data-toggle="tooltip" data-original-title="'+P.i18n("share_name_tooltip_text")+'">'+_.escape(e)+"</span>":_.escape(e):e}},{sTitle:this.i18n("file_server"),mData:d.DP.FILE_SERVER_NAME,sClass:h.STYLE_ALERT_TABLE_INDICATOR,sWidth:"35%",bSearchable:!0,bSortable:!0,mRender:function(e,t,i){return t===h.TABLE_COL_TYPE_DISPLAY?_.escape(e)||"":e||""}},{sTitle:this.i18n("share_path"),sWidth:"35%",sClass:"prism-table-cell-ellipsis",bSearchable:!0,bSortable:!0,mData:function(e,t,i){return e},mRender:function(e,t,i){var n=e[d.DP.SHARE_PATH];return n||(n="/"+e[d.DP.NAME]),'<span\n                                class="home-tooltip"\n                                data-toggle="tooltip" data-placement="top"\n                                data-original-title="'+n+'">\n                                  '+_.escape(n)+"\n                              </span>"}},{sTitle:this.i18n("protocol_type"),sWidth:"20%",sClass:"middle",bSearchable:!0,bSortable:!0,mData:function(e,t,i){return e},mRender:function(e,t,i){return(e[d.DP.PROTOCOL_TYPE]===h.FS_PROTOCOLS.SMB||e[d.DP.PROTOCOL_TYPE]===h.FS_PROTOCOLS.NFS?e[d.DP.PROTOCOL_TYPE]:h.FS_PROTOCOLS.SMB)+(e[d.DP.SECONDARY_PROTOCOL_TYPE]===h.FS_PROTOCOLS.SMB||e[d.DP.SECONDARY_PROTOCOL_TYPE]===h.FS_PROTOCOLS.NFS?", "+e[d.DP.SECONDARY_PROTOCOL_TYPE]:"")||h.FS_PROTOCOLS.SMB}},{sTitle:this.i18n("open_connections"),sWidth:"20%",sClass:"middle",sType:"numeric",bSearchable:!0,bSortable:!0,mData:function(e,t,i){var n=A.getUsageStats(e,d.DP.NUM_CONNECTED_USERS);return n>0?n:"0"}},{sTitle:this.i18n("space_used"),sWidth:"20%",sClass:"middle",sType:"numeric",bSearchable:!0,bSortable:!0,mData:function(e,t,i){var n=p.compareVersions(e.objectVersion,h.FILE_SERVER_VERSIONS.THREE_DOT_FIVE)>0,s=n?d.DP.SPACE_USED_BY_SHARE:d.DP.TOTAL_SPACE_USED;return e.parentShareUuid?-1:A.getUsageStats(e,s)},mRender:function(e,t,i){return"sort"===t?e:e<0?h.STATS_NOT_AVAILABLE:A.storageFormat(e)},ntnxTooltip:I.STORAGE_STATS.FILE_SERVER_USED.ID},{sTitle:this.i18n("snapshots_space_used"),sWidth:"20%",sClass:"middle",sType:"numeric",bSearchable:!0,bSortable:!0,mData:function(e,t,i){return e.parentShareUuid?-1:A.getUsageStats(e,d.DP.SPACE_USED_BY_SNAPSHOTS)},mRender:function(e,t,i){return"sort"===t?e:e<0?h.STATS_NOT_AVAILABLE:A.storageFormat(e)}}];break;default:N=[{sTitle:"",mData:i.ID,sWidth:"15px",sClass:"center",bSortable:!1,bSearchable:!1,mRender:function(e,t,i){return t===h.TABLE_COL_TYPE_DISPLAY?P.createDataRowCheckbox(e):""}},{sTitle:this.i18n("name"),mData:i.NAME,sWidth:"100%"}]}return N},prependClusterNameColumn:function(e,t){var s=0;e===h.ENTITY_ALERT&&(s=1);var a=e===h.ENTITY_ALERT||e===h.ENTITY_EVENT;return this.appendColumn(t,{sTitle:"Cluster Name",mData:i.CLUSTER_UUID,sWidth:"10%",sClass:"left",bSortable:!a,sortKey:i.CL_NAME,mRender:function(e,t,i){return n.getNameById(e)}},10,null,s)},prependCheckboxColumn:function(e,t){var n=this;return t=t||{sTitle:"",mData:i.ID,sWidth:"15px",sClass:"center",bSortable:!1,bSearchable:!1,mRender:function(e,t,i){return n.createDataRowCheckbox(e)}},[t].concat(e)},appendColumn:function(e,t,i,n,s){0!==s&&(s=s||"last");var a=0;_.each(e,function(e){e.sWidth&&e.sWidth.indexOf("%")>0&&a++});var r=(100-i)/100,o=0;if(0!==a){Math.round(i/a);_.each(e,function(e){if(e.sWidth&&e.sWidth.indexOf("%")>0){var t=parseInt(e.sWidth,10);t>1&&(t=A.round(t*r,1),e.sWidth=t+"%"),o+=t}})}if(i=100-o,t.sWidth&&t.sWidth.indexOf("%")>0&&(t.sWidth=i+"%"),_.isNumber(s)){if(s<0)return void p.log("DataTableColumnProvider: Invalid placement value.");e.splice(s,0,t)}else"first"===s.toLowerCase()?e.unshift(t):e.push(t);return n&&(e[e.length-1].sClass=n),e},createDataRowCheckbox:function(t,i){var n=this;return e.CHECKBOX_ROW({value:t,checked:i,getQaDataTestId:function(e){return n.getQaDataTestId(e)}})},createDataRowRadioBox:function(t,i){return e.RADIO_ROW({groupName:t,value:i})},createDataInputBox:function(t,i,n){return e.INPUT_BOX({columnId:t,inputType:i,placeholder:n||"",className:"password"===i?"inputPassword":""})},renderApplicable:function(e,t,n){return function(s,a,r){if("mData"===n){var o=[r,s];s=o[0],r=o[1]}return _.contains(r[i.NA_DATA_PROPS],e)?r[i.NA_TEXT]||h.STATS_NOT_APPLICABLE:_.isFunction(t)?t.apply(this,arguments):s}},renderStorageStats:function(e,t,i){return e===h.STATS_NOT_AVAILABLE?e:t===h.TABLE_COL_TYPE_DISPLAY||t===h.TABLE_COL_TYPE_EXPORT?A.storageFormat(e):e},renderEllipsedText:function(e){return'<span class="header" title="'+e+'">'+e+"</span>"},renderStorageBinaryStats:function(e,t,i){return t===h.TABLE_COL_TYPE_DISPLAY||t===h.TABLE_COL_TYPE_EXPORT?A.storageFormat(e):e},renderStatsValue:function(e,t,i,n,s){return i===h.TABLE_COL_TYPE_DISPLAY||i===h.TABLE_COL_TYPE_EXPORT?A.getStatsValue(e,n,s):t},renderDateTimeValue:function(e,t,i){return t===h.TABLE_COL_TYPE_DISPLAY||t===h.TABLE_COL_TYPE_EXPORT?m.formatDateTime(e>0?e/1e3:0):e},_entityRenderCB:function(e,t,a){return p.renderEntityDetailsLink(n,s.getEntityTypeViewPrivileges(a[i.ALERT_ENTITY_TYPES]),a,i.ALERT_ENTITY_TYPES,i.ALERT_ENTITY_IDS,"n-alert-entity-link")},renderRetentionPolicy:function(t,i,n,s){var a,r,o=[],l=0;if(s){var c=t.localRetentionPeriod,u=t.localRetentionType;o.push("Local: "+c+" "+h[u]);var d=t.remoteRetentionPeriod,T=t.remoteRetentionType;a=_.size(d);for(r in d)if(d[r]>0&&(o.push(p.truncateMiddle(r,n)+": "+d[r]+" "+h[T[r]]),++l>=1))break}else{var E=t.localMaxSnapshots;o.push("Local: "+E);var S=t.remoteMaxSnapshots;a=_.size(S);for(r in S)if(S[r]>0&&(o.push(p.truncateMiddle(r,n)+": "+S[r]),++l>=2))break}var g=o.join(", "),A=a-l;if(A){var m='data-id="'+i+'"';g+="<br>"+e.HOVER_TABLE_CELL({value:A+" More...",dataIdAttr:m,customClassName:"details-link"})}return g},renderAlertCauseAndResolution:function(t,n,s){var a=s[i.ALERT_TYPE_UUID],r=T.getAlertTypeMetadata(a);if(r&&r.isUserDefined)return"";if(n===h.TABLE_COL_TYPE_DISPLAY)return e.CAUSE_AND_RESOLUTION({id:a,severity:s[i.ALERT_SEVERITY],clusterUuid:s[i.CLUSTER_UUID]});if(n===h.TABLE_COL_TYPE_EXPORT){if(r){var o=T.formatCauses(r,s[i.ALERT_SEVERITY],s[i.CLUSTER_UUID]);return"Cause: "+(o&&o.length?o[0]:"Not Available")+" | Resolution: "+(r.resolutions&&r.resolutions.length?r.resolutions[0]:"Not Available")}return"-"}return""},renderScheduleActions:function(e,t,i){var n={};return i&&(n[h.ACTION_UPDATE]=f.UPDATE),n[h.ACTION_DELETE]=f.DELETE,f.renderItemActions(h.ENTITY_SCHEDULE,e,t,n)}})}),define("models/dataprotection/PDScheduleModel",["data/DataURLConstants","data/DataManager","data/DataProperties","models/BaseModel","utils/AppUtil","utils/TimeUtil","utils/AppConstants"],function(e,t,i,n,s,a,r){"use strict";var o={SECONDLY:"second",MINUTELY:"minute",HOURLY:"hour",DAILY:"day",WEEKLY:"week",MONTHLY:"month"},l={SECONDLY:"Please enter a repeating value in seconds.",MINUTELY:"Please enter a repeating value in minutes.",HOURLY:"Please enter a repeating value in hours.",DAILY:"Please enter a repeating value in days.",WEEKLY:"Please select a weekly value.",MONTHLY:"Please enter a monthly value."},c=["","Sun","Mon","Tue","Wed","Thu","Fri","Sat"],u=n.extend({name:"PDScheduleModel",defaults:{pdName:null,type:null,values:[],everyNth:1,userStartTimeInUsecs:null,startTimesInUsecs:null,endTimeInUsecs:null,timezoneOffset:null,retentionPolicy:{}},nameAttribute:i.SCHEDULE_TYPE,
isPDMetroAvail:!1,userInput:{uiStartDate:null,uiStartTime:null,endDateEnabled:!1,uiEndDate:null,uiEndTime:null,scheduleType:null,scheduleValues:null,everyNth:1},initialize:function(e,t){this.isPDMetroAvail=t&&t.isPDMetroAvail,_.defaults(e.retentionPolicy,{localMaxSnapshots:1,remoteMaxSnapshots:{},localRetentionPeriod:1,localRetentionType:u.NEAR_SYNC_RETENTION_TYPES.DAYS,remoteRetentionPeriod:{},remoteRetentionType:{}}),n.prototype.initialize.apply(this,arguments),this._convertToUIModel()},saveSchedule:function(e,t,i){$.ajax({type:"POST",url:this.getURL(),contentType:"application/json; charset=UTF-8",data:JSON.stringify(this._modelToServer(i)),statusCode:this.getStatusCode(),success:function(t,i,n){e(t)},error:function(e,i,n){var a=s.safeStringify(n);e&&e.responseText&&e.responseText.length>0&&(a=s.processAjaxError(e.responseText)),t(a)}})},deleteSchedule:function(e,t){var i=this.getURL("/"+this.id);$.ajax({type:"DELETE",url:i,contentType:"application/json; charset=UTF-8",statusCode:this.getStatusCode(),success:function(t,i,n){e(t)},error:function(e,i,n){var a=s.safeStringify(n);e&&e.responseText&&e.responseText.length>0&&(a=s.processAjaxError(e.responseText)),t(a,e)}})},updateSchedule:function(e,t,i){var n=this.getURL("/"+this.id);$.ajax({type:"PUT",url:n,contentType:"application/json; charset=UTF-8",data:JSON.stringify(this._modelToServer(i)),statusCode:this.getStatusCode(),success:function(t,i,n){e(t)},error:function(e,i,n){var a=s.safeStringify(n);e&&e.responseText&&e.responseText.length>0&&(a=s.processAjaxError(e.responseText)),t(a)}})},getURL:function(i){var n=e.PROTECTION_DOMAIN;return t.getFormattedURL(n+"/"+this.get("pdName")+"/schedules"+(i||""))},getDisplayScheduleValues:function(){var e=this.get(i.SCHEDULE_TYPE),t=this.get(i.SCHEDULE_VALUES);return e===u.SECONDLY||e===u.MINUTELY||e===u.HOURLY||e===u.DAILY?_.template('Every <%= everyNth %> <%= scheduleTerm %><%= (everyNth > 1) ? "s" : "" %>',this._toDisplayTemplateData()):e===u.WEEKLY?(t=this.get(i.SCHEDULE_VALUES),t.map(function(e){return c[e]}).join(",")):e===u.MONTHLY?(t=this.get(i.SCHEDULE_VALUES),t.join(",")):t.join(",")},toUIJSON:function(){this._populateUserInputData();var e={SECONDLY:this._toSecondlyUIJSON(),MINUTELY:this._toMinutelyUIJSON(),HOURLY:this._toHourlyUIJSON(),DAILY:this._toDailyUIJSON(),WEEKLY:this._toWeeklyUIJSON(),MONTHLY:this._toMonthlyUIJSON(),WEEKLY_LIST:c,startDate:this.getStartDate(),startTime:this.getStartTime(),endDate:this.getEndDate(),endTime:this.getEndTime(),endDateDisabled:this.userInput.endDateEnabled?"":"disabled",appConsistent:this.userInput.appConsistent},t=this.get(i.SCHEDULE_TYPE);return t&&(e[t].checked="checked"),e},getRetentionPolicyInfo:function(){return{localMaxSnapshots:this.userInput.localMaxSnapshots,maxSnapshotsByRemoteSite:this.userInput.remoteMaxSnapshots,localRetentionPeriod:this.userInput.localRetentionPeriod,localRetentionType:this.userInput.localRetentionType,remoteRetentionPeriod:this.userInput.remoteRetentionPeriod,remoteRetentionType:this.userInput.remoteRetentionType}},setStartDate:function(e){this.userInput.uiStartDate=e},getStartDate:function(){return this.userInput.uiStartDate},setStartTime:function(e){this.userInput.uiStartTime=e},getStartTime:function(){return this.userInput.uiStartTime},setEndDateEnabled:function(e){this.userInput.endDateEnabled=e},setEndDate:function(e){this.userInput.uiEndDate=e},getEndDate:function(){return this.userInput.uiEndDate},setEndTime:function(e){this.userInput.uiEndTime=e},getEndTime:function(){return this.userInput.uiEndTime},setScheduleType:function(e){this.userInput.scheduleType=e},getScheduleType:function(){return this.userInput.scheduleType},setScheduleValues:function(e){this.userInput.scheduleValues=e},setEveryNthValue:function(e){this.userInput.everyNth=e},getEveryNthValue:function(){return this.userInput.everyNth},getRemoteMaxSnapshots:function(){return this.userInput.remoteMaxSnapshots||{}},setRemoteMaxSnapshots:function(e){this.userInput.remoteMaxSnapshots=e},setLocalMaxSnapshotsChange:function(e){this.userInput.localMaxSnapshots=e},setLocalRetentionPeriod:function(e){this.userInput.localRetentionPeriod=e},setLocalRetentionType:function(e){this.userInput.localRetentionType=e},setRemoteRetentionPeriod:function(e){this.userInput.remoteRetentionPeriod=e},getRemoteRetentionPeriod:function(){return this.userInput.remoteRetentionPeriod||{}},setRemoteRetentionType:function(e){this.userInput.remoteRetentionType=e},setAppConsistent:function(e){this.userInput.appConsistent=e},getAppConsistent:function(){return this.userInput.appConsistent},setMetroAvail:function(e){this.isPDMetroAvail=!!e},isNearSync:function(){return!this.isPDMetroAvail&&(this.userInput.scheduleType===u.SECONDLY||this.userInput.scheduleType===u.MINUTELY&&null!==this.userInput.everyNth&&this.userInput.everyNth<=u.NEAR_SYNC_MAX_MINUTES)},hasRemoteRetention:function(){return this.isNearSync()?Object.keys(this.userInput.remoteRetentionPeriod).length>0:Object.keys(this.userInput.remoteMaxSnapshots).length>0},isInputDataValid:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(null===this.userInput.scheduleType||this.userInput.scheduleType.length<=0)return"Please select a schedule type.";if(this.userInput.scheduleType===u.SECONDLY||this.userInput.scheduleType===u.MINUTELY||this.userInput.scheduleType===u.DAILY||this.userInput.scheduleType===u.HOURLY){var t=this.userInput.everyNth;if(this.userInput.scheduleType===u.SECONDLY&&(null===t||t<u.MIN_REPEATING_SECONDS||t>u.MAX_REPEATING_SECONDS))return this.i18n("secondly_rpo_help_msg");if(this.isPDMetroAvail&&this.userInput.scheduleType===u.MINUTELY&&(null===t||t<u.METRO_AVAIL_PD_MINIMUM_REPEATING_MINUTES))return this.i18ns("min_minute_val_msg",u.METRO_AVAIL_PD_MINIMUM_REPEATING_MINUTES);if(null===t||t<=0)return l[this.userInput.scheduleType]}else if(null===this.userInput.scheduleValues||this.userInput.scheduleValues.length<=0)return l[this.userInput.scheduleType];var i=void 0;if(this.isNearSync()){var n=this.userInput.localRetentionType;if(!n)return"Please select a snapshot retention type for local site.";var s=this.userInput.localRetentionPeriod,r=u.NEAR_SYNC_RETENTION_LIMIT,o=u.NEAR_SYNC_RETENTION_TYPES;if(n===o.DAYS&&(s<1||s>r.DAYS))return this.i18ns("nearSyncValidationMsg",{limit:r.DAYS,type:this.i18n("days"),site:this.i18n("localSite")});if(n===o.WEEKS&&(s<1||s>r.WEEKS))return this.i18ns("nearSyncValidationMsg",{limit:r.WEEKS,type:this.i18n("weeks"),site:this.i18n("localSite")});if(n===o.MONTHS&&(s<1||s>r.MONTHS))return this.i18ns("nearSyncValidationMsg",{limit:r.MONTHS,type:this.i18n("months"),site:this.i18n("localSite")});if(this.userInput.remoteRetentionPeriod&&Object.keys(this.userInput.remoteRetentionPeriod).length>1)return this.i18ns("single_remote_site_check",u.NEAR_SYNC_MAX_MINUTES);for(i in this.userInput.remoteRetentionPeriod){var c=this.userInput.remoteRetentionPeriod[i],d=this.userInput.remoteRetentionType[i];if(!c)return this.i18ns("missing_retention_period_msg",i);if(!d)return this.i18ns("missing_retention_type_msg",i);if(d===o.DAYS&&(c<1||c>r.DAYS))return this.i18ns("nearSyncValidationMsg",{limit:r.DAYS,type:this.i18n("days"),site:i});if(d===o.WEEKS&&(c<1||c>r.WEEKS))return this.i18ns("nearSyncValidationMsg",{limit:r.WEEKS,type:this.i18n("weeks"),site:i});if(d===o.MONTHS&&(c<1||c>r.MONTHS))return this.i18ns("nearSyncValidationMsg",{limit:r.MONTHS,type:this.i18n("months"),site:i})}}else{if(this.userInput.localMaxSnapshots<=0)return"Please enter a snapshot retention value greater than 0 for local sites.";for(i in this.userInput.remoteMaxSnapshots){if(null===this.userInput.remoteMaxSnapshots[i])return this.i18ns("missing_retention_type_value",i);if(this.userInput.remoteMaxSnapshots[i]<=0)return this.i18ns("negative_retention_type_value",i)}}var h=null;if(this.userInput.endDateEnabled){if(null===this.userInput.uiEndDate||this.userInput.uiEndDate.length<=0)return"Please enter an end date.";if(null===this.userInput.uiEndTime||this.userInput.uiEndTime.length<=0)return"Please enter an end time.";var p=this.userInput.uiEndDate+" "+this.userInput.uiEndTime;if(null===(h=Date.parse(p)))return this.i18ns("invalid_time_format",{time:p,example:a.formatDateTime(Date.now())})}if(!e.skipStartDateTimeValidation){if(null===this.userInput.uiStartDate||this.userInput.uiStartDate.length<=0)return this.i18n("missing_start_date_msg");if(null===this.userInput.uiStartTime||this.userInput.uiStartTime.length<=0)return this.i18n("missing_start_time_msg");var _=this.userInput.uiStartDate+" "+this.userInput.uiStartTime,T=Date.parse(_);if(null===T)return this.i18ns("invalid_time_format",{time:_,example:a.formatDateTime(Date.now())});if(a.convertISODateTimeToUTS(_)<Date.now()){if(this.isNew())return this.i18n("start_time_check");if(e.isTransitioningFromAsyncToNearSync)return this.i18n("async_to_nearsync_start_time_check")}if(null!==h&&h.getTime()<=T.getTime())return this.i18n("invalid_start_end_time_combination")}return null},_convertToUIModel:function(){var e=this.get("values");null!==e&&e.length>0&&this.set({values:e.sort(function(e,t){return e-t})})},_modelToServer:function(e){var t=null,n=null;if(null!==this.get(i.SCHEDULE_USER_START_TIME)){var s=this.get(i.SCHEDULE_USER_START_TIME)/1e3;n=a.formatDate(s,"MM/dd/yyyy"),t=a.formatDate(s,"hh:mm tt","en-US")}if(e)this.set(_defineProperty({},i.SCHEDULE_USER_START_TIME,0));else if(this.userInput.uiStartDate!==n||this.userInput.uiStartTime!==t){var o=Date.parse(this.userInput.uiStartDate+" "+this.userInput.uiStartTime);this.set(_defineProperty({},i.SCHEDULE_USER_START_TIME,1e3*o.getTime()))}if(this.userInput.endDateEnabled){if(null!==this.userInput.uiEndDate&&null!==this.userInput.uiEndTime){var l=Date.parse(this.userInput.uiEndDate+" "+this.userInput.uiEndTime);this.set({endTimeInUsecs:1e3*l.getTime()})}}else this.set({endTimeInUsecs:null});return this.userInput.scheduleType===u.SECONDLY||this.userInput.scheduleType===u.MINUTELY||this.userInput.scheduleType===u.HOURLY||this.userInput.scheduleType===u.DAILY?(this.set({everyNth:this.userInput.everyNth}),this.set({values:null})):(this.set({everyNth:1}),this.set({values:this.userInput.scheduleValues})),this.set({type:this.userInput.scheduleType}),this.isNearSync()?this.set({retentionPolicy:{localRetentionPeriod:this.userInput.localRetentionPeriod,localRetentionType:this.userInput.localRetentionType,remoteRetentionPeriod:this.userInput.remoteRetentionPeriod,remoteRetentionType:this.userInput.remoteRetentionType}}):(this.set({retentionPolicy:{localMaxSnapshots:this.userInput.localMaxSnapshots,remoteMaxSnapshots:this.userInput.remoteMaxSnapshots}}),this.set(i.PD_ROLL_UP_SCHEDULE_UUID,null)),void 0!==this.userInput.appConsistent&&this.set(i.SCHEDULE_APP_CONSISTENT,this.userInput.appConsistent),this.set(i.SCHEDULE_TIMEZONE_OFFSET,-(new Date).getTimezoneOffset()*r.SECONDS_PER_MINUTE),this.toJSON()},_populateUserInputData:function(){var e=this.get(i.SCHEDULE_USER_START_TIME)?this.get(i.SCHEDULE_USER_START_TIME)/1e3:0;e<=0&&(e=Date.now()+3*r.MILLIS_PER_MINUTE),this.userInput.uiStartDate=a.formatDate(e,"MM/dd/yyyy"),this.userInput.uiStartTime=a.formatDate(e,"hh:mm tt","en-US");var t=this.get(i.SCHEDULE_END_TIME)?this.get(i.SCHEDULE_END_TIME)/1e3:0;0===t?(this.userInput.uiEndDate=null,this.userInput.uiEndTime=null,this.userInput.endDateEnabled=!1):(this.userInput.endDateEnabled=!0,this.userInput.uiEndDate=a.formatDate(t,"MM/dd/yyyy"),this.userInput.uiEndTime=a.formatDate(t,"hh:mm tt","en-US")),this.userInput.scheduleType=this.get(i.SCHEDULE_TYPE),this.userInput.scheduleValues=this.get(i.SCHEDULE_VALUES),this.userInput.everyNth=this.get(i.SCHEDULE_EVERY_NTH);var n=this.get(i.SCHEDULE_RETENTION_POLICY);this.userInput.localMaxSnapshots=n.localMaxSnapshots,this.userInput.remoteMaxSnapshots=n.remoteMaxSnapshots,this.userInput.localRetentionPeriod=n.localRetentionPeriod,this.userInput.localRetentionType=n.localRetentionType,this.userInput.remoteRetentionPeriod=n.remoteRetentionPeriod,this.userInput.remoteRetentionType=n.remoteRetentionType,this.userInput.appConsistent=this.get(i.SCHEDULE_APP_CONSISTENT)},_toSecondlyUIJSON:function(){return{checked:"",value:this.get(i.SCHEDULE_TYPE)===u.SECONDLY?this.get(i.SCHEDULE_EVERY_NTH):""}},_toMinutelyUIJSON:function(){return{checked:"",value:this.get(i.SCHEDULE_TYPE)===u.MINUTELY?this.get(i.SCHEDULE_EVERY_NTH):""}},_toHourlyUIJSON:function(){return{checked:"",value:this.get(i.SCHEDULE_TYPE)===u.HOURLY?this.get(i.SCHEDULE_EVERY_NTH):""}},_toDailyUIJSON:function(){return{checked:"",value:this.get(i.SCHEDULE_TYPE)===u.DAILY?this.get(i.SCHEDULE_EVERY_NTH):""}},_toWeeklyUIJSON:function(){var e=this.get(i.SCHEDULE_VALUES),t={};return this.get(i.SCHEDULE_TYPE)===u.WEEKLY&&e.forEach(function(e){t[c[e]]="checked"}),{checked:"",valueSelected:t}},_toMonthlyUIJSON:function(){return{checked:"",value:this.get(i.SCHEDULE_TYPE)===u.MONTHLY?this.get(i.SCHEDULE_VALUES):""}},_toDisplayTemplateData:function(){return{everyNth:this.get(i.SCHEDULE_EVERY_NTH),scheduleTerm:o[this.get(i.SCHEDULE_TYPE)]}}},{SECONDLY:"SECONDLY",MINUTELY:"MINUTELY",HOURLY:"HOURLY",DAILY:"DAILY",WEEKLY:"WEEKLY",MONTHLY:"MONTHLY",TIME_FORMAT:"hh:mm tt",DATE_FORMAT:"MM/dd/yyyy",TIME_PICKER_LOCALE:"en-US",SCHEDULE_TYPES:["SECONDLY","MINUTELY","HOURLY","DAILY","WEEKLY","MONTHLY"],NEAR_SYNC_RETENTION_TYPES:{DAYS:"DAYS",WEEKS:"WEEKS",MONTHS:"MONTHS"},NEAR_SYNC_RETENTION_LIMIT:{DAYS:7,WEEKS:4,MONTHS:12},METRO_AVAIL_PD_MINIMUM_REPEATING_MINUTES:60,MIN_REPEATING_SECONDS:15,MAX_REPEATING_SECONDS:59,NEAR_SYNC_MAX_MINUTES:15});return u}),define("models/dataprotection/PDScheduleCollection",["models/PollingCollection","models/dataprotection/PDScheduleModel","data/DataURLConstants","data/DataProperties","utils/AppConstants"],function(e,t,i,n,s){"use strict";var a=_.template("<%= type %>: <%= values %>");return e.extend({model:t,url:null,name:"PDScheduleCollection",pdName:null,isPDMetroAvail:!1,initialize:function(t,i){this.pdName=i&&i.pdName,this.isPDMetroAvail=i&&i.isPDMetroAvail,e.prototype.initialize.apply(this,arguments)},_prepareModel:function(t,i){return i.isPDMetroAvail=this.isPDMetroAvail,e.prototype._prepareModel.apply(this,arguments)},setPDName:function(e){this.pdName=e},fetch:function(t){this._parameters=this._parameters||{},this._parameters[n.SCHEDULE_TIMEZONE_OFFSET]=-(new Date).getTimezoneOffset()*s.SECONDS_PER_MINUTE;var a=i.PROTECTION_DOMAIN;return this.url=a+"/"+this.pdName+"/schedules",e.prototype.fetch.apply(this,arguments)},getScheduleSummary:function(){var e=[];return _.each(this.models,function(t){e.push(a({type:t.get(t.nameAttribute),values:t.getDisplayScheduleValues()}))},this),e},hasNearSyncSchedule:function(){return Boolean(this.models.find(function(e){return Boolean(e.get(n.PD_ROLL_UP_SCHEDULE_UUID))}))}})}),define("text!templates/wizards/pd/vms-page.html",[],function(){return'<% if ( ! initialized ) { %>\n\n<div class="no-data page-loading-message">\n  <img src="app/assets/images/spinners/loading.gif">\n   Loading...\n</div>\n\n<% } else if ( vstoreId ) { %>\n\n<div class="schedule-protection-domain">\n  <div class="n-popup-description">\n    <p>This Protection Domain was initiated externally and\n    cannot be modified here.</p>\n    <p>Click on the Next button to schedule it.</p>\n  </div>\n</div>\n\n<% } else { %>\n<div class="vm-containers">\n  <div class="vm-container unprotected-vms">\n    <div class="n-title">\n      Unprotected Entities <span class="unprotected-vms-count">\n        <%= unprotectedEntityCount %></span>\n      <% if(isFeatureSupported) { %>\n      <div class="unprotect-tooltip" data-toggle="tooltip"\n          data-original-title="<%=i18n(\'protection_info\')%>">\n          <span class="n-tooltip-circle">?</span>\n      </div>\n      <% } %>\n    </div>\n    <div class="filter-by">\n      <input type="text" class="filterInput filterInputUnprotectedVM"\n             id="filterInputUnprotectedVM"\n             value="" placeholder="Search by Entity Name">\n    </div>\n    <div class="nav_table scrollable-table">\n      <div class="n-page-body">\n        <div class="table-unprotected-vms">\n          \x3c!--table here--\x3e\n        </div>\n      </div>\n    </div>\n    <div class="cg-options">\n      <div class="help">\n        <div class="title">\n          Pick a Consistency Group\n          <div class="cg-tooltip" data-toggle="tooltip"\n               data-original-title="\n        In order to transfer the selected entities to a protected state,\n        you need to select a Consistency Group first. <br>\n        If you decide to use an existing group, groups that are\n        targeted for application consistent snapshots will not be available for\n        selection.\n               ">\n            <span class="n-tooltip-circle">?</span></div>\n        </div>\n      </div>\n      <div class="cg-btns">\n        <div class="cg-btn useVM cg-btn-selected hide">\n          <%= Components.radio({\n            name       : \'cg-option\',\n            value      : \'useVM\',\n            checked    : true\n          }) %>\n\n          Use Entity Name\n        </div>\n\n        <% var sDisabled = (consistencyGroups.length > 0) ? \'\' : \'disabled\'; %>\n        <div class="cg-btn useExisting <%=sDisabled%>">\n          <input type="radio" name="cg-option" value="useExisting"\n              <%= sDisabled %> >\n          <span class="use-exisiting-selection-text">Use an existing CG</span>\n          <div class="dropdown">\n            <a data-toggle="dropdown"\n               class="cgSelectBtn n-button-settings pull-right dropdown-toggle">\n            </a>\n            <ul class="dropdown-menu">\n              <% _.each(consistencyGroups, function(cg) { %>\n                <li>\n                  <a class="cg-menu-option" id="<%=cg%>"><%=cg%></a>\n                </li>\n              <% }) %>\n            </ul>\n          </div>\n        </div>\n\n        <div class="cg-btn newCG">\n          <%= Components.radio({\n            name       : \'cg-option\',\n            value      : \'newCG\'\n          }) %>\n          <input class="text-newcg" type="text" value="Create a new CG"\n                 placeholder="">\n        </div>\n\n        <% if (bAppConsistent) { %>\n          <div class="appConsistent">\n            <div class="title">\n              Snapshots\n            </div>\n            <%= Components.checkbox({id: \'appConsistentSnapshots\'}) %>\n            <span class="appConsistentText">\n              Use application consistent snapshots\n              <div class="cg-tooltip" data-toggle="tooltip"\n                 data-original-title="\n                 Select this option if you wish your Consistency Group to\n                 perform application consistent snapshots. Such Consistency\n                 Groups can contain one and only one Entity.<br/>\n                 Please install NGT for the VSS Hardware Requestor.">\n                 <span class="n-tooltip-circle">?</span>\n              </div>\n            </span>\n          </div>\n        <% } %>\n      </div>\n    </div>\n\n    <% if (autoProtectSupported) { %>\n    <div class="checkbox">\n      <%= Components.checkbox({checked:true, id: \'autoProtectRelatedEntities\'}) %>\n      <span class="appConsistentText">\n        Auto protect related entities.\n        <div class="cg-tooltip" data-toggle="tooltip"\n           data-original-title="Entities related to the selected entities will\n            be protected in the same consistency group.">\n           <span class="n-tooltip-circle">?</span>\n        </div>\n      </span>\n    </div>\n    <% } %>\n\n    <div class="move-btn move-btn-disabled protectButton">\n      Protect Selected Entities\n      <span class="to-protect-vm-count"></span>\n      <img id="protect-spinner" class="hide"\n           src="app/assets/images/spinners/loading.gif">\n      <i class="arrow pull-right"\n         data-icon="y" aria-hidden="true"></i>\n    </div>\n  </div>\n\n  <div class="vm-container protected-vms">\n    <div class="n-title">\n      Protected Entities <span class="protected-vms-count">\n        <%= protectedEntityCount %></span>\n    </div>\n    <div class="filter-by">\n      <input type="text" class="filterInput filterInputProtectedVM"\n             id="filterInputProtectedVM"\n             value="" placeholder="Search by Entity Name">\n      <input type="text" class="filterInput filterInputCG"\n             id="filterInputCG"\n             value="" placeholder="Search by CG Name">\n    </div>\n    <div class="nav_table scrollable-table">\n      <div class="n-page-body">\n        <div class="table-protected-vms">\n          \x3c!--table here--\x3e\n        </div>\n      </div>\n    </div>\n    <div class="move-btn move-btn-disabled rhs-move-btn unprotectButton">\n      <i class="arrow" data-icon="x" aria-hidden="true"></i>\n      <div class="pull-right">\n       <img id="unprotect-spinner" class="hide"\n           src="app/assets/images/spinners/loading.gif">\n       Unprotect Selected Entities\n       <span class="to-unprotect-vm-count"></span>\n      </div>\n    </div>\n  </div>\n</div>\n<% }  %>\n'}),define("views/wizards/pd/vms-page",["views/basecomponents/BaseView","views/basecomponents/wizards/BaseWizardPage","views/basecomponents/datatables/DataTableTemplates","views/basecomponents/datatables/DetailsTableView","views/basecomponents/datatables/DataTableColumnProvider","models/dataprotection/PDScheduleCollection","data/DataProperties","utils/SubViewHelper","utils/AppUtil","utils/AppConstants","utils/VisualizationUtil","utils/HypervisorUtil","text!templates/wizards/pd/vms-page.html","managers/LicenseManager","managers/ClusterManager","components/Components"],function(e,t,i,n,s,a,r,o,l,c,u,d,h,p,T,E){"use strict";var S=_.template('<% _.each(consistencyGroups, function(cg) { %><li><a class="cg-menu-option" id="<%= cg %>"><%= cg %></a></li><% }) %>'),g=_.template("<%= formatId(model.id) %>");return t.extend({UNPROTECTED_ENTITY_ROW_POPOVER_TITLE:"UUID",template:_.template(h),subViewHelper:null,unprotectedEntities:null,protectedEntities:null,notifyOnPrevious:!0,_initialized:!1,_filterUnprotectedClause:null,_filterProtectedClause:null,_isAppConsistentSnapshotsProtectedEntity:!1,name:"VmsPage",events:{"click .cg-btn":"onCGBtnClick","click .cg-menu-option":"onUseCGSelect","keyup .filterInput":"onFilterInputChange","click .protectButton:not(.move-btn-disabled)":"onProtectEntities","click .unprotectButton:not(.move-btn-disabled)":"onUnprotectEntities","click .n-datatable-checkbox":"onSelectEntity","click .checkboxSelectAll":"onSelectAll","click input#appConsistentSnapshots":"onClickSnapshots"},onClickSnapshots:function(e){this.getWizard().toggleLicenseWarning(e)},onSelectAll:function(e){var t=$(e.currentTarget),i=t.is(":checked"),n=t.closest(".vm-container");if(n){var s=n.find(".n-datatable-checkbox");i?(s.attr("checked","checked"),this._isUnprotectedEntityCheckbox(t.parent())&&this.showNearSyncWarning()):s.removeAttr("checked"),this._enableDisableMoveButtons()}},onSelectEntity:function(e){this._enableDisableMoveButtons();var t=$(e.currentTarget);t.is(":checked")&&this._isUnprotectedEntityCheckbox(t)&&this.showNearSyncWarning()},onProtectEntities:function(){var e=this;if(!this.$("#protect-spinner").is(":visible")){var t=this;if(!this._isUpdate()&&!this._createdPD){var i=function(){e._createdPD=!0,e.getWizard().hidePreviousButton(),e.onProtectEntities()};return void this._createPD(i)}var n=this._getSelectedEntities("table-unprotected-vms");if(n&&0===n.length)return void this.getWizard().showHeaderError("Please select one or more Entities.");var s=this.$("input[name=cg-option]:checked"),a=s.val(),o=null;if("useExisting"===a){if(o=this.$(".use-exisiting-selection-text").text(),this.model.getConsistencyGroupNames().indexOf(o)<0)return void this.getWizard().showHeaderError("Please select a consistency group.")}else if("newCG"===a&&(o=this.$(".text-newcg").val().trim(),0===o.length))return void this.getWizard().showHeaderError("Please enter a consistency group name.");var c=(n.length,d.isAppConsistentSnapshotSupported()&&this.$("#appConsistentSnapshots").is(":checked"));this.$("#protect-spinner").removeClass("hide");var u=_.filter(t.unprotectedEntities,function(e){return n.indexOf(e[r.ID])>=0}),h=this.$("#autoProtectRelatedEntities").is(":checked");this.model.protect(u,o,c,h,function(){_.each(u,function(e){var i=o||e[r.NAME];e[r.VM_CONSISTENCY_GROUP]=i,e[r.APP_CONSISTENT_SNAPSHOTS]=c,t.protectedEntities.push(e)}),t.protectedEntities=t.model.getProtectedEntities(),t.unprotectedEntities=_.reject(t.unprotectedEntities,function(e){return _.find(t.protectedEntities,function(t){return l.getEntityIdWithoutClusterId(e[r.ID])===t[r.ID]})}),setTimeout(function(){t.$("#protect-spinner").addClass("hide"),t.refreshView(),t.getWizard().showHeaderSuccess("Successfully protected "+u.length+" entities")},1e3)},function(e){t.$("#protect-spinner").addClass("hide");var i="Error protecting selected entities.";e&&e.length>0&&(i+=" "+e),t.getWizard().showHeaderError(i)})}},onUnprotectEntities:function(){if(this.protectedEntities.forEach(function(e){e.changeIcon=!1}),this._isAppConsistentSnapshotsProtectedVM=!1,!this.$("#unprotect-spinner").is(":visible")){var e=this,t=this._getSelectedEntities("table-protected-vms");if(t&&0===t.length)return void this.getWizard().showHeaderError("Please select one or more Entities.");this.$("#unprotect-spinner").removeClass("hide");var i=_.filter(e.protectedEntities,function(e){return t.indexOf(e[r.ID])>=0}),n=_.flatten(_.pluck(i,r.RELATED_ENTITY_UUIDS)),s=!1;_.each(this.protectedEntities,function(e){-1!==n.indexOf(e.id)&&(e.changeIcon=!0,s=!0)}),this.model.unprotect(i,function(){e.unprotectedEntities=_.union(e.unprotectedEntities,i),e.protectedEntities=_.reject(e.protectedEntities,function(e){return _.find(i,function(t){return e[r.ID]===t[r.ID]})}),setTimeout(function(){e.$("#unprotect-spinner").addClass("hide"),e.refreshView(),e.getWizard().showHeaderSuccess("Successfully unprotected "+i.length+" entities");var t=e._getProtectedEntitiesToRender();e.subViewHelper.get("tableProtectedVms").updateDataSource(t),e.$el.find(".related-msg").tooltip({title:e.i18n("related_tooltip"),placement:"right",container:"body"}),s&&e.getWizard().showHeaderWarning(e.i18n("related_warning_msg"))},1e3)},function(t){e.$("#unprotect-spinner").addClass("hide");var i="Error removing selected entities from this domain.";t&&t.length>0&&(i+=" "+t),e.getWizard().showHeaderError(i)})}},onFilterInputChange:_.throttle(function(e){var t,i,n=$(e.currentTarget),s=n.val().trim();switch(n.attr("id")){case"filterInputUnprotectedVM":t=this._filterUnprotectedClause,i=r.NAME;break;case"filterInputProtectedVM":t=this._filterProtectedClause,i=r.NAME;break;case"filterInputCG":t=this._filterProtectedClause,i=r.VM_CONSISTENCY_GROUP}s.length>0?t[i]=s:delete t[i],this._updateDetailTables()},200),onCGBtnClick:function(e){var t=$(e.currentTarget);if(!t.hasClass("disabled")){this.$(".cg-btn").removeClass("cg-btn-selected");t.find("input[type=radio]").attr("checked",!0),t.addClass("cg-btn-selected");var i=d.isAppConsistentSnapshotSupported();t.hasClass("useExisting")?(this.$("ul.dropdown-menu").show(),this.$(".text-newcg").val("Create a new CG"),i&&(this.$("#appConsistentSnapshots").attr("disabled","disabled"),this.$(".appConsistentText").addClass("appConsistent-disabled")),e.stopPropagation()):t.hasClass("newCG")?(this.$("ul.dropdown-menu").hide(),this.$(".text-newcg").val("").focus(),i&&(this.$("#appConsistentSnapshots").removeAttr("disabled"),this.$(".appConsistentText").removeClass("appConsistent-disabled"))):t.hasClass("useVM")&&(this.$("ul.dropdown-menu").hide(),this.$(".text-newcg").val("Create a new CG"),i&&(this.$("#appConsistentSnapshots").removeAttr("disabled"),this.$(".appConsistentText").removeClass("appConsistent-disabled")))}},onUseCGSelect:function(e){var t=$(e.currentTarget).text();this.$(".use-exisiting-selection-text").text(t);var i=this;setTimeout(function(){i.$("ul.dropdown-menu").hide()},100)},onBodyClick:function(e){this.$("ul.dropdown-menu").hide()},initialize:function(){this.subViewHelper=new o,this.protectedEntities=[],this.unprotectedEntities=[],this._entitiesToProtect=[],this._entitiesToUnprotect=[],this._filterUnprotectedClause={},this._filterProtectedClause={},_.bindAll(this,"onBodyClick","_updateExistingCGLists"),$("body").on("click",this.onBodyClick)},render:function(){var e=this._getEntityCounts(-1,-1),t=this.model.get("vstoreId"),a=d.isAppConsistentSnapshotSupported(),o=!T.isPowerPcCluster()&&!d.hasHyperV(T.getCurrentClusterUuid()),h=this.template(this.vtOptions({initialized:this._initialized,isFeatureSupported:this.isClusterFFEnabled(c.FFLAGS.BROWNFIELD),unprotectedEntityCount:e.sUnprotected,protectedEntityCount:e.sProtected,consistencyGroups:this.model.getConsistencyGroupNames(),vstoreId:t,Components:E,bAppConsistent:a,autoProtectSupported:o}));if(this.$el.html(h),!t){if(this._initialized){var S=this;if(this._isAppConsistentSnapshotsProtectedEntity){var A=p.FEATURE_MAP,m=A.LICENSE_DR_APPLICATION_CONSISTENT_SNAPSHOT;p.violatedFeatureLicense(m)&&this.getWizard().showHeaderWarning(p.getPopupMessageTemplate(m,"This cluster has protected entities which are using application consistent snapshots. The current license level does not allow for the use of this feature.")),$(".alert-warning h4").addClass("pvm-warning")}var f=i.DETAILS_TABLE_CHECKBOX_SELECT_ALL;if(!this.subViewHelper.get("tableUnprotectedVms")){var I=d.hasKVMOnly()&&this.containsDuplicateEntityName(this.unprotectedEntities),C=new n({el:this.$(".table-unprotected-vms"),scrollHeight:"135px",minimumRows:3,initialSorting:[[1,c.SORT_ASC]],tmplHover:I?g:null,titleHover:I?this.UNPROTECTED_ENTITY_ROW_POPOVER_TITLE:null,tmplHoverArgs:I?{formatId:l.getDisplayableId}:null,columns:[{sTitle:f,mData:r.ID,sWidth:"20px",bSortable:!1,sClass:"unprotectedEntitiesCheckBox",mRender:function(e,t,i){var n=-1!==S._entitiesToProtect.indexOf(e);return s.createDataRowCheckbox(e,n)}},{sTitle:"Name",mData:r.NAME,sWidth:"179px",sClass:"n-row-popover",mRender:function(e,t,i){return t===c.TABLE_COL_TYPE_DISPLAY?_.escape(e):e}},{sTitle:"Type",mData:r.TYPE,sWidth:"169px"}]});this.subViewHelper.register("tableUnprotectedVms",C)}var v="233px",R=12;if(a||(v="227px",R=10),!this.subViewHelper.get("tableProtectedVms")){var N=d.hasKVMOnly()&&this.containsDuplicateEntityName(this.protectedEntities),P=new n({el:this.$(".table-protected-vms"),scrollHeight:v,minimumRows:R,initialSorting:[[1,c.SORT_ASC]],tmplHover:N?g:null,titleHover:N?this.UNPROTECTED_ENTITY_ROW_POPOVER_TITLE:null,tmplHoverArgs:N?{formatId:l.getDisplayableId}:null,columns:[{sTitle:f,mData:r.ID,sWidth:"30px",sClass:"protectedEntitiesCheckBox",bSortable:!1,mRender:function(e,t,i){var n=-1!==S._entitiesToUnprotect.indexOf(e);return s.createDataRowCheckbox(e,n)}},{sTitle:"Entity Name",mData:r.NAME,sWidth:"169px",sClass:"n-row-popover",mRender:function(e,t,i){return i.changeIcon?"<span>"+e+'  <span class="related-msg">'+E.icon("Circular_Exclamation","-inline -small")+"</span></span>":i.isAutoAdded?"<span>"+e+'  <span class="auto-added">'+E.icon("Link_Twisted","-inline -small")+"</span></span>":t===c.TABLE_COL_TYPE_DISPLAY?_.escape(e):e}},{sTitle:"CG",mData:r.VM_CONSISTENCY_GROUP,sWidth:"169px",mRender:function(e,t,i){var n=i[r.VM_CONSISTENCY_GROUP];return i[r.APP_CONSISTENT_SNAPSHOTS]?u.renderAppConsistentSnapshotCG(n):n}}]});this.subViewHelper.register("tableProtectedVms",P)}this.subViewHelper.renderAll(),this._updateDetailTables(),this.$(".cg-tooltip").tooltip({placement:"right",trigger:"hover",html:!0,container:"body"}),this.$(".unprotect-tooltip").tooltip({placement:"right",trigger:"hover",container:"body"}),this.subViewHelper.iterate("onResize"),this.getWizard().onResizeWizardContainer()}else this._loadResources();this.applyNutanixInput({types:["checkbox","radio"]})}},refreshView:function(){this._updateDetailTables(),this._fetchConsistencyGroups(this._updateExistingCGLists)},destroy:function(){this.subViewHelper.destroy(),
$("body").off("click",this.onBodyClick),this.$(".cg-tooltip").tooltip("destroy"),this.$(".related-msg").tooltip("destroy"),this.$(".auto-added").tooltip("destroy"),this.$(".unprotect-tooltip").tooltip("destroy"),e.prototype.destroy.apply(this)},canTransitionPage:function(e){return e>0||!(this._isUpdate()||this._createdPD)},containsDuplicateEntityName:function(e){var t=[],i=_.find(e,function(e){var i=_.indexOf(_.pluck(t,r.NAME),e[r.NAME]);return i>=0&&t[i][r.TYPE]===e[r.TYPE]||(t.push(e),!1)});return!_.isUndefined(i)},onPageTransition:function(e,t){var i=this;if(this.subViewHelper.removeAll(),t||this._isUpdate()||this._createdPD)e();else{var n=function(){i._createdPD=!0,e()};this._createPD(n)}},onPageCancel:function(){return!0},showCancelButton:function(){return!1},_isUpdate:function(){return 0===this.getWizard().wizardConfiguration.title.indexOf("Update")},_createPD:function(e){var t=this;this.model.createPD(this.model.get("name"),e,function(e){t.getWizard().showHeaderError("Error creating protection domain. "+e)})},_updateDetailTables:function(){var e=this._getProtectedEntitiesToRender();this._entitiesToUnprotect=this._getAllSelectedEntities("table-protected-vms",this._entitiesToUnprotect),this.subViewHelper.get("tableProtectedVms").updateDataSource(e);var t=this._getUnprotectedEntitiesToRender();this._entitiesToProtect=this._getAllSelectedEntities("table-unprotected-vms",this._entitiesToProtect),this.subViewHelper.get("tableUnprotectedVms").updateDataSource(t),this.$(".checkboxSelectAll").removeAttr("checked");var i=this.protectedEntities||[],n=-1;i.length&&!_.isEmpty(this._filterProtectedClause)&&(n=e.length);var s=-1;this.unprotectedEntities.length&&!_.isEmpty(this._filterUnprotectedClause)&&(s=t.length);var a=this._getEntityCounts(s,n);this.$(".unprotected-vms-count").html(a.sUnprotected),this.$(".protected-vms-count").html(a.sProtected),this._enableDisableMoveButtons(),this.$el.find(".auto-added").tooltip({title:this.i18n("auto_added"),placement:"right",container:"body"})},_getUnprotectedEntitiesToRender:function(){var e=[];if(_.isEmpty(this._filterUnprotectedClause))e=this.unprotectedEntities;else{var t=this._filterUnprotectedClause;e=_.filter(this.unprotectedEntities,function(e){for(var i in t)if(!l.containsCompare(e[i],t[i]))return!1;return!0})}return e},_getProtectedEntitiesToRender:function(){var e=[];if(_.isEmpty(this._filterProtectedClause))e=this.protectedEntities;else{var t=this._filterProtectedClause;e=_.filter(this.protectedEntities,function(e){for(var i in t)if(!l.containsCompare(e[i],t[i]))return!1;return!0})}return _.each(e,function(e){e[r.NAME]=e[r.NAME]||"",e[r.VM_CONSISTENCY_GROUP]=e[r.VM_CONSISTENCY_GROUP]||"None"}),e},_loadResources:function(){var e=this,t=this,i=0,n=function(){0===--i&&(t.protectedEntities=t.model.getProtectedEntities(),t.unprotectedEntities=_.reject(t.unprotectedEntities,function(e){return _.find(t.protectedEntities,function(t){return e[r.ID]===t[r.ID]})}),_.each(t.protectedEntities,function(e){e.appConsistentSnapshots&&(t._isAppConsistentSnapshotsProtectedVM=!0)}),t._initialized=!0,t.render())};i++,this._isUpdate()?(this.scheduleCollection=new a,this.scheduleCollection.setPDName(this.model.get(r.PD_NAME)),$.when(this.model.fetch(),this.scheduleCollection.fetch()).done(function(){n()}).fail(function(t){e.getWizard().showHeaderErrorWithDetails("Error unable to retrieve protection domain data.",t.responseText)})):setTimeout(function(){n()},100),i++,this._fetchConsistencyGroups(n),i++,this.model.fetchUnprotectedVMs(function(e){t.unprotectedEntities=t.unprotectedEntities.concat(e),n()},function(e){t.getWizard().showHeaderError("Error retrieving unprotected Entities. "+e)}),i++,this.model.fetchUnprotectedVGs(function(e){t.unprotectedEntities=t.unprotectedEntities.concat(e),n()},function(e){t.getWizard().showHeaderError("Error retrieving unprotected Entities. "+e)})},_getAllFilteredEntities:function(e){var t=this.$("."+e),i=t.find(".n-datatable-checkbox"),n=[];return _.each(i,function(e){n.push(e.value)},this),n},_getSelectedEntities:function(e){var t=this.$("."+e),i=t.find(".n-datatable-checkbox:checked"),n=[];return _.each(i,function(e){n.push(e.value)},this),n},_getAllSelectedEntities:function(e,t){var i=this._getAllFilteredEntities(e),n=_.difference(t,i);return this._getSelectedEntities(e).concat(n)},_getEntityCounts:function(e,t){var i="",n="";if(this._initialized){i+="(",-1!==e&&(i+=e+"/"),i+=this.unprotectedEntities.length||"None",i+=")";var s=this.protectedEntities||[];n+="(",-1!==t&&(n+=t+"/"),n+=s.length>0?s.length:"None",n+=")"}return{sUnprotected:i,sProtected:n}},showNearSyncWarning:function(){this.scheduleCollection&&this.scheduleCollection.hasNearSyncSchedule()&&this.getWizard().showHeaderWarning(this.i18n("add_entities_near_sync_warning"))},_isUnprotectedEntityCheckbox:function(e){return e.parent().hasClass("unprotectedEntitiesCheckBox")},_enableDisableMoveButtons:function(){var e=[["table-unprotected-vms",".protectButton",".to-protect-vm-count"],["table-protected-vms",".unprotectButton",".to-unprotect-vm-count"]];_.each(e,function(e){var t=this._getSelectedEntities(e[0]);t&&t.length?$(e[2]).html("("+t.length+")"):$(e[2]).html(""),t&&0===t.length?this.$(e[1]).addClass("move-btn-disabled"):this.$(e[1]).removeClass("move-btn-disabled")},this)},_fetchConsistencyGroups:function(e){var t=this;this.model.fetchConsistencyGroups(function(t){e()},function(e,i){t.getWizard().showHeaderErrorWithDetails("Error retrieving consistency groups. "+i.responseText)})},_updateExistingCGLists:function(){var e=this.model.getConsistencyGroupNames(),t=this.$(".useExisting"),i=this.$('.useExisting input[value="useExisting"]'),n=this.$(".useExisting ul.dropdown-menu");if(e.length)t.removeClass("disabled"),i.removeAttr("disabled"),n.html(S({consistencyGroups:e}));else{t.addClass("disabled");var s=i.is(":checked");i.attr("disabled","disabled").prop("checked",!1),s&&this.$('input[value="useVM"]').prop("checked",!0),n.html("")}}})}),define("views/basecomponents/BaseSubView",["views/basecomponents/BaseView","utils/AppUtil"],function(e,t){"use strict";return e.extend({parentView:null,setParentView:function(e){this.parentView=e},getParentView:function(){return this.parentView},setViewOption:function(e){},showSuccess:function(e){this._showMessage(this.parentView.showSuccess,e)},showError:function(e){this._showMessage(this.parentView.showError,e)},showModelError:function(e,i){this.showError(t.processAjaxError(i.responseText))},showInfo:function(e){this._showMessage(this.parentView.showInfo||this.parentView.showHeaderInfo,e)},showHeaderError:function(e){this._showMessage(this.parentView.showHeaderError,e)},showHeaderWarning:function(e){this._showMessage(this.parentView.showHeaderWarning,e)},showHeaderLoading:function(e){this._showMessage(this.parentView.showHeaderLoading,e)},showHeaderSaving:function(e){this._showMessage(this.parentView.showHeaderSaving,e)},_showMessage:function(e,i){"function"==typeof e?e.call(this.parentView,i):t.log(i)},clearBaseHeader:function(){"function"==typeof this.parentView.clearHeader&&this.parentView.clearHeader()},onClickLinkAction:function(e){"function"==typeof this.parentView.onClickLinkAction?this.parentView.onClickLinkAction(e):this.showError("Unimplemented item click action.")},hideView:function(){$(this.el).hide()},showView:function(){$(this.el).show()},refreshView:function(){},isViewVisible:function(){return this.$el.is(":visible")},isModelInitialized:function(){return"function"==typeof this.parentView.isModelInitialized&&this.parentView.isModelInitialized()},saveViewData:function(e){e()},validateForm:function(e){for(var t=0;t<e.length;t++)if(0===$.trim($(e[t]).val()).length)return"Please fill required field";return""}})}),define("utils/RemoteSiteUtil",["data/DataProperties","managers/ClusterManager","managers/I18nManager","utils/AppConstants"],function(e,t,i,n){"use strict";return{name:"RemoteSiteUtil",isLightCompute:function(t){var i=t.get(e.RS_CLUSTER_TYPE);return void 0!==i&&-1!==_.indexOf(i,n.RS_CLUSTER_TYPE.LIGHT_COMPUTE)},isSingleNodeBackup:function(t){var i=t.get(e.RS_CLUSTER_TYPE);return void 0!==i&&_.contains(i,n.RS_CLUSTER_TYPE.SINGLE_NODE_BACKUP)},isArchSameAsSource:function(e){return e.getClusterArch().toUpperCase()===t.getClusterArch().toUpperCase()},getDRDisableMsgForLightCompute:function(){return this.i18ns("dr_not_supported")},getDRDisableMsgForSingleNodeBackup:function(){return this.i18ns("dr_not_supported_single_node_backup")},getDRDisableMsgForArchMismatch:function(e){return this.i18ns("dr_not_supported_arch_mismatch",e.getClusterArch())},i18ns:function(e){var t=Array.prototype.slice.call(arguments);return i.ts(this.name,e,t.splice(1))}}}),define("text!templates/wizards/pd/ScheduleListView.html",[],function(){return'<% if ( ! initialized ) { %>\n<div class=\'no-data page-loading-message\'>\n  Loading...\n</div>\n<% } else { %>\n<div class="title-container n-clearfix">\n  <div class="text schedule-summary-text">\n  </div>\n  <div id="create-schedule">\n    <button class="btnCreate btn btn-small"\n            data-loading-text="Saving..." action="create">\n      New Schedule\n    </button>\n  </div>\n</div>\n\n<div class="tableSchedules">\n   \x3c!-- @view: Table Schedules --\x3e\n</div>\n<% } %>'}),define("text!templates/pages/dr/details/PopoverRetentionPolicyDetails.html",[],function(){return'<div class="n-cell-hover">\n  <% var allData  = cellData || []; %>\n  <table class="n-hover-details">\n    <tr>\n      <th>Remote Site</th>\n      <th>Retention Policy</th>\n    </tr>\n    <% _.each(allData, function(data, idx) { %>\n    <tr>\n      <td><%=data.remoteSite%></td>\n      <td><%=data.retentionPolicy%></td>\n    </tr>\n    <% }); %>\n  </table>\n</div>'}),define("views/wizards/pd/ScheduleListView",["data/DataProperties","views/basecomponents/datatables/DetailsTableView","views/basecomponents/BaseSubView","views/basecomponents/datatables/DataTableColumnProvider","utils/AppConstants","utils/SubViewHelper","utils/HypervisorUtil","utils/RemoteSiteUtil","utils/TimeUtil","text!templates/wizards/pd/ScheduleListView.html","text!templates/pages/dr/details/PopoverRetentionPolicyDetails.html"],function(e,t,i,n,s,a,r,o,l,c,u){"use strict";var d=_.template('<% if (scheduleCount <= 0) { %><% if (hybridSchedulesCount) { %>You have <%= hybridSchedulesCount %> hybrid schedule(s) that are not displayed below.<% } else { %>You currently do not have any schedules.<% } %><% } else { %>You currently have <%= scheduleCount + hybridSchedulesCount %> <%= scheduleLabel %>. <%= hybridSchedulesCount ? hybridSchedulesCount + " hybrid schedule(s) are not listed below.<br>" : "" %>Next snapshot is scheduled on <%= nextSnapshotTime %>.<% } %>'),h=_.template(c),p=_.template(u);return i.extend({modelEvents:{"reset  model":"_updateTableDataSource","remove model":"_updateTableDataSource","change pdModel":"_renderScheduleSummary"},events:{"click .btnCreate":"onClickLinkAction","click .btnItemAction":"onClickLinkAction"},subViewHelper:null,pdModel:null,name:"ScheduleListView",initialize:function(e){this.subViewHelper=new a,this.pdModel=e.pdModel,this.remoteSiteCollection=e.remoteSiteCollection,this.delegateModelEvents()},render:function(){var i=this.isModelInitialized();if(this.$el.html(h({initialized:i})),i){this._renderScheduleSummary();var a=this;if(!this.subViewHelper.get("tableSchedules")){var r=new t({el:this.$(".tableSchedules"),scrollHeight:"240px",minimumRows:10,columns:[{sTitle:"Type",mData:e.NAME,sWidth:"5%",mRender:function(e,t,i){return a.i18n("ScheduleType."+e)}},{sTitle:"Repeat On",mData:e.SCHEDULE_VALUES,sWidth:"20%",mRender:function(e,t,i){return a._renderScheduleDisplayValues(e,i)}},{sTitle:"Start Date",mData:e.SCHEDULE_USER_START_TIME,sWidth:"10%",mRender:function(e,t,i){return l.formatDateTime(e>0?e/1e3:0)}},{sTitle:"End Date",mData:e.SCHEDULE_END_TIME,sWidth:"10%",mRender:function(e,t,i){return l.formatDateTime(e>0?e/1e3:0)}},{sTitle:"App Consistent Snapshot",mData:e.ID,sWidth:"10%",mRender:function(t,i,n){return n[e.SCHEDULE_APP_CONSISTENT]?"Yes":"No"}},{sTitle:"Retention Policy",mData:e.SCHEDULE_RETENTION_POLICY,sWidth:"40%",mRender:function(t,i,s){return n.renderRetentionPolicy(t,s[e.ID],20,s[e.PD_ROLL_UP_SCHEDULE_UUID])}},{sTitle:"",mData:e.ID,sWidth:"5%",sClass:"right",mRender:function(t,i,r){if(i===s.TABLE_COL_TYPE_DISPLAY){var o=r[e.SCHEDULE_TYPE]+"-Schedule";return n.renderScheduleActions(t,o,a.pdModel.isScheduleEditable())}return""}}]});this.subViewHelper.register("tableSchedules",r)}this.subViewHelper.renderAll(),this._updateTableDataSource(),this.refreshView()}},refreshView:function(){this.updateHeader()},updateHeader:function(){var t=this,i=_.pluck(this.model.pluck(e.SCHEDULE_RETENTION_POLICY),e.SCHEDULE_REMOTE_MAX_SNAP);i=i.concat(_.pluck(this.model.pluck(e.SCHEDULE_RETENTION_POLICY),e.SCHEDULE_REMOTE_RETENTION_PERIOD));var n=[];_.each(i,function(e){if(e){var t=_.keys(e);t.length&&(n=n.concat(t))}}),n=_.uniq(n);var a=[];this.remoteSiteCollection.forEach(function(i){var s=i.get(e.RS_NAME),r=i.get(e.RS_CAPABILITIES)||[];!_.contains(n,s)||o.isLightCompute(i)||t._isBackupOnly(r)||[].push.apply(a,i.get(e.RS_CAPABILITIES))}),a=_.uniq(a),this.getParentView().clearHeader();var l="",c="";this._hasCrossHypervisorSchedule(a)&&(l=r.hasKVMOnly()?s.HYPERVISOR_TYPE.KVM:s.HYPERVISOR_TYPE.ESXI,c=l===s.HYPERVISOR_TYPE.KVM?s.HYPERVISOR_TYPE.ESXI:s.HYPERVISOR_TYPE.KVM,this.showInfo(_.template("Some target sites runs <%= remoteHypType %> while this site runs <%= localHypType %>, so all VMs in the Protection Domain will need to have a driver for <%= remoteHypType %>. Please ask the VM admin to install the driver on all VMs in this PD through Nutanix Guest Tools.",{remoteHypType:s.HYPERVISOR_LABEL[c],localHypType:s.HYPERVISOR_LABEL[l]})))},_isBackupOnly:function(e){return _.contains(e,s.RS_CAPABILITIES.BACKUP)},_hasCrossHypervisorSchedule:function(e){return r.hasKVMOnly()&&-1!==_.indexOf(e,s.RS_CAPABILITIES.SUPPORT_VSPHERE)||r.hasESXOnly()&&-1!==_.indexOf(e,s.RS_CAPABILITIES.SUPPORT_KVM)},destroy:function(){this.$(".n-cell-popover").popover("destroy"),this.subViewHelper.destroy(),this.undelegateModelEvents(),i.prototype.destroy.apply(this)},_renderScheduleDisplayValues:function(t,i){var n=i[e.ID];return this.model.findModelById(n).getDisplayScheduleValues()},_renderRSRetentionPolicyTooltip:function(t){var i=this.model.findModelById(t),n=i.get(e.SCHEDULE_RETENTION_POLICY),a=_.map(n.remoteMaxSnapshots,function(e,t){return{remoteSite:t,retentionPolicy:e+" snapshots"}});if(n.remoteRetentionPeriod){var r=n.remoteRetentionType,o=_.map(n.remoteRetentionPeriod,function(e,t){return{remoteSite:t,retentionPolicy:e+" "+s[r]}});a=_.extend(a,o)}return p({cellData:a})},_updateTableDataSource:function(){var e=this.subViewHelper.get("tableSchedules");if(e){e.updateDataSource(this.model);var t=this;this.$(".n-cell-popover").popover({title:"Retention Policy",placement:"left",trigger:"hover",html:!0,content:function(){return t._renderRSRetentionPolicyTooltip($(this).data("id"))}}),this.subViewHelper.iterate("onResize")}},_renderScheduleSummary:function(){var t=this.model.length,i=this.pdModel.get(e.PD_NEXT_SNAPSHOT_TIME),n=d({scheduleCount:t,scheduleLabel:t>1?" schedules":" schedule",nextSnapshotTime:l.formatFullDateTime(i/1e3),hybridSchedulesCount:this.pdModel.get(e.PD_HYBRID_SCHEDULES_COUNT)});this.$(".schedule-summary-text").html(n),this.pdModel.isScheduleEditable()||this.$(".btnCreate").prop("disabled",!0)}})}),define("text!templates/wizards/pd/ScheduleDetailView.html",[],function(){return'<% if ( ! initialized ) { %>\n<div class=\'no-data page-loading-message\'>\n  Loading...\n</div>\n<% } else { %>\n<div class="schedule-form-container">\n  <div class="schedule-wrapper">\n    <div class="schedule-form-inner">\n      <div class="n-title">Configure your local schedule</div>\n      <div class="schedule-group-wrapper <%= showSecondsRPO ? \'secondly-rpo-wrapper\' : \'\'%>">\n        <div class="schedule-group">\n          \x3c!-- Secondly Schedule --\x3e\n          <% if ( showSecondsRPO ) { %>\n            <div class="schedule-type secondly-type">\n              <div class="schedule-parameter secondly-parameter">\n                <input <%=scheduleModel[\'SECONDLY\'].checked%>\n                  type=\'radio\' name=\'schedule-type\' value=\'SECONDLY\'>\n                <%= i18n(\'repeat_every\') %>\n                \x3c!--Secondly interval value--\x3e\n                <input class="everyNInput" type="text" id="secondlyValue"\n                  <% if (scheduleModel[\'SECONDLY\'].checked === \'checked\') { %>\n                  value="<%= scheduleModel[\'SECONDLY\'].value%>"\n                  <% } %>> <%= i18n(\'rpo_type_SECONDLY\') %>\n                <div class="schedule-tooltip" data-toggle="tooltip"\n                  data-original-title="<%= i18n(\'secondly_rpo_help_msg\') %>">\n                  <span class="n-tooltip-circle">?</span>\n                </div>\n              </div>\n            </div>\n          <% } %>\n          \x3c!-- End of Secondly Schedule --\x3e\n          \x3c!-- Minutely Schedule --\x3e\n          <div class="schedule-type minutely-type">\n            <div class="schedule-parameter minutely-parameter">\n              <input <%=scheduleModel[\'MINUTELY\'].checked%>\n                type=\'radio\' name=\'schedule-type\' value=\'MINUTELY\'>\n              Repeat every\n              \x3c!--Minutely interval value--\x3e\n              <input class="everyNInput" type="text" id="minutelyValue"\n                <% if (scheduleModel[\'MINUTELY\'].checked === \'checked\') { %>\n                value="<%= scheduleModel[\'MINUTELY\'].value%>"\n                <% } %>> minute(s)\n              <div class="schedule-tooltip" data-toggle="tooltip"\n                data-original-title="<%= isMetroAvailPD ?\n                  i18n(\'metroPD_minutely_schedule_tooltip\') : i18n(\'minutely_schedule_tooltip\') %>">\n                <span class="n-tooltip-circle">?</span>\n              </div>\n            </div>\n          </div>\n          \x3c!-- End of Minutely Schedule --\x3e\n          \x3c!-- Hourly Schedule --\x3e\n          <div class="schedule-type hourly-type">\n            <div class="schedule-parameter hourly-parameter">\n              <input <%=scheduleModel[\'HOURLY\'].checked%>\n                type="radio" name="schedule-type" value="HOURLY">\n              Repeat every\n              \x3c!--Hour interval value--\x3e\n              <input class="everyNInput" type="text" id="hourlyValue"\n                <% if (scheduleModel[\'HOURLY\'].checked === \'checked\') { %>\n                value="<%= scheduleModel[\'HOURLY\'].value%>"\n                <% } %>> hour(s)\n              <div class="schedule-tooltip" data-toggle="tooltip"\n                data-original-title="Enter an hour value greater than 0.">\n                <span class="n-tooltip-circle">?</span>\n              </div>\n            </div>\n          </div>\n          \x3c!-- End of Hourly Schedule --\x3e\n          \x3c!-- Daily Schedule --\x3e\n          <div class="schedule-type daily-type">\n            <div class="schedule-parameter daily-parameter">\n              <input <%=scheduleModel[\'DAILY\'].checked%>\n                type="radio" name="schedule-type" value="DAILY">\n              Repeat every\n              \x3c!--Day interval value--\x3e\n              <input class="everyNInput" type="text" id="dailyValue"\n                <% if (scheduleModel[\'DAILY\'].checked === \'checked\') { %>\n                value="<%= scheduleModel[\'DAILY\'].value%>"\n                <% } %>> day(s)\n              <div class="schedule-tooltip" data-toggle="tooltip"\n                data-original-title="Enter a day value greater than 0.">\n                <span class="n-tooltip-circle">?</span>\n              </div>\n            </div>\n          </div>\n          \x3c!-- End of Daily Schedule --\x3e\n        </div>\n        <div class="schedule-group">\n          \x3c!-- Weekly Schedule --\x3e\n          <div class="schedule-type weekly-type">\n            <div class="schedule-type-btn">\n              <input <%=scheduleModel[\'WEEKLY\'].checked%>\n                type="radio" name="schedule-type" value="WEEKLY">\n              Repeat weekly\n            </div>\n            <div class="schedule-parameter weekly-parameter">\n              <% for (var i = 1; i < scheduleModel.WEEKLY_LIST.length;\n                i++) {\n                var weekday = scheduleModel.WEEKLY_LIST[i];\n                var checked = scheduleModel[\'WEEKLY\'].valueSelected[weekday] || \'\';\n                %>\n              <div class="weekly-checkbox">\n                <input <%= checked %>\n                  name="weeklyParameter" type="checkbox" value="<%= i %>">\n                <%= scheduleModel.WEEKLY_LIST[i][0] %>\n              </div>\n              <% } %>\n            </div>\n          </div>\n          \x3c!-- End of Weekly Schedule --\x3e\n          \x3c!-- Monthly schedule --\x3e\n          <div class="schedule-type monthly-type">\n            <div class="schedule-type-btn">\n              <input <%=scheduleModel[\'MONTHLY\'].checked%>\n                type="radio" name="schedule-type" value="MONTHLY">\n              Repeat monthly\n            </div>\n            <div class="schedule-parameter monthly-parameter">\n              Day of month:\n              <input type="text" id="monthlyValue"\n                placeholder="<%= i18n(\'monthly_schedule_placeholder\') %>"\n                <% if (scheduleModel[\'MONTHLY\'].checked === \'checked\') { %>\n                value="<%= scheduleModel[\'MONTHLY\'].value%>"\n                <% } %>\n                >\n              <div class="schedule-tooltip" data-toggle="tooltip"\n                data-original-title="\n                Enter a comma-separated list of the days of the month.\n                Valid values are 1 to 31\n                ">\n                <span class="n-tooltip-circle">?</span>\n              </div>\n            </div>\n          </div>\n          \x3c!--End of Monthly Schedule--\x3e\n        </div>\n        \x3c!-- Start Date and Time --\x3e\n        <div class="schedule-group schedule-start-time start-time">\n          <div class="schedule-time">\n            <div class="start-text">Start on</div>\n            \x3c!-- Date Picker--\x3e\n            <div class="input-append date" id="startDatePicker"\n              data-date="<%= scheduleModel.startDate%>">\n              <input id="startDate" class="input-small date-time" type="text">\n              <span class="add-on"><i\n                class="glyphicon glyphicon-calendar"></i></span>\n            </div>\n            <div class="text2">at</div>\n            \x3c!-- Time picker--\x3e\n            <div class="input-append bootstrap-timepicker">\n              <input id="startTime" type="text" class="input-small date-time">\n              <span class="add-on"><i class="glyphicon glyphicon-time"></i></span>\n            </div>\n          </div>\n        </div>\n        \x3c!-- End of Start Date and Time --\x3e\n        \x3c!-- End Date and Time --\x3e\n        <div class="schedule-group schedule-start-time">\n          <div class="schedule-time schedule-end-time">\n            <input type="checkbox" id="enableEndDate"\n              <%= scheduleModel.endDate ? \'checked\' : \'\'%>>\n            <div class="end-text">End on</div>\n            \x3c!-- Date Picker--\x3e\n            <div class="input-append date" id="endDatePicker"\n              data-date="<%=scheduleModel.endDate?scheduleModel.endDate:\'\'%>">\n              <input id="endDate" class="input-small date-time" type="text"\n                <%= scheduleModel.endDateDisabled%> >\n              <span class="add-on <%= scheduleModel.endDateDisabled%>">\n              <i class="glyphicon glyphicon-calendar"></i>\n              </span>\n            </div>\n            <div class="text2 <%= scheduleModel.endDateDisabled%>">at</div>\n            \x3c!-- Time picker--\x3e\n            <div class="input-append bootstrap-timepicker">\n              <input id="endTime" type="text" class="input-small date-time"\n                <%= scheduleModel.endDateDisabled %> >\n              <span class="add-on <%= scheduleModel.endDateDisabled%>">\n              <i class="glyphicon glyphicon-time"></i>\n              </span>\n            </div>\n          </div>\n        </div>\n        \x3c!-- End of End Date and Time --\x3e\n      </div>\n    </div>\n    \x3c!-- Retention Policy --\x3e\n    <div class="remote-site-container">\n      <div class="n-title">Retention policy</div>\n      <div class="remote-site-inner <%= showSecondsRPO ? \'secondly-rpo-wrapper\' : \'\'%>">\n        <% if ( remoteSitesCollection === null ) { %>\n        <div class="no-data">\n          <img src="app/assets/images/common/loading.gif"> Loading...\n        </div>\n        <% } else { %>\n        <div id="retention-policy-container">\n          \x3c!-- @view: retention policy table added here... --\x3e\n        </div>\n        <% } %>\n      </div>\n    </div>\n  </div>\n</div>\n\x3c!-- App Consistent is not for metro PD or HyperV only cluster --\x3e\n<% if (showAppConsistent) {%>\n<div class="app-consistent-div appConsistentContainer" data-toogle="tooltip"\n    data-original-title="<%= i18n(\'nearSync_appConstistent_warning\') %>">\n  <input type="checkbox" class="cb-app-consistent"\n    <%= scheduleModel.appConsistent ? "checked" : "" %>>\n  Create application consistent snapshot\n</div>\n<% } %>\n\x3c!-- End App Consistent --\x3e\n<% }  %>'}),define("text!templates/wizards/pd/ScheduleRetentionPolicyView.html",[],function(){return'<table class="remote-site-table">\n  \x3c!--Local snapshots--\x3e\n  <tr class="remote-site-row">\n    <td class="remote-site-col-0">\n      <input type="checkbox" checked disabled\n        class="cb-local-Snapshot" value="Local">\n    </td>\n    <td class="remote-site-col-1">\n      <%= (standBy) ? \'Origin Site\' : \'Local\' %>\n      <% if (showWarningMsgForLocal) { %>\n      <span class="info-icon"><%= infoIcon %></span>\n      <% } %>\n    </td>\n    <td class="remote-site-col-2" >\n      <% if (isNearSync) { %>\n      <input type="text" id="localRetentionPeriod"\n        value="<%= retentionPolicy.localRetentionPeriod %>">\n      <select id="localRetentionType">\n        <% _.each(NEAR_SYNC_RETENTION_TYPES, function(key) { %>\n          <option\n            <%= retentionPolicy.localRetentionType === key? \'selected\' : \'\'%>\n            value=<%= key %>\n            >\n            <%= i18n(key) %>\n          </option>\n        <% }) %>\n      </select>\n      <% } else { %>\n      keep the last\n      <input type="text" id="localMaxSnapshots"\n        value="<%= retentionPolicy.localMaxSnapshots%>">\n      snapshots\n      <% } %>\n    </td>\n  </tr>\n  <% if (standBy) { %>\n  <tr class="remote-site-row">\n    <td class="remote-site-col-0">\n      <input type="checkbox" checked disabled\n        class="cb-local-Snapshot" value="<%=standBy%>">\n    </td>\n    <td class="remote-site-col-1">\n      Metro Remote Site (<%= standBy %>)\n    </td>\n    <td class="remote-site-col-2" >\n      keep the last\n      <input type="text" disabled id="standByMaxSnapshots"\n        value="<%= retentionPolicy.localMaxSnapshots%>">\n      snapshots\n    </td>\n  </tr>\n  <% } %>\n  <tr class="remote-site-row n-text-about-snapshots">\n    \x3c!-- @view: explanation of snapshots added here... --\x3e\n  </tr>\n  \x3c!--End of Local snapshots--\x3e\n  <% if ( remoteSitesCollection.length === 0 ) { %>\n  <tr class="remote-site-row">\n    <td class="remote-site-col-0"></td>\n    <td class="no-remote-site-col" colspan="2">\n      <%=(standBy) ? \'No other remote sites \' : \'Remote sites \' %>\n      have not been defined for this cluster.\n    </td>\n  </tr>\n  <% } else { %>\n  <tr class="remote-site-row">\n    <td class="remote-site-col-0" colspan="3">\n      Remote Sites\n    </td>\n  </tr>\n  \x3c!--Remote site snapshots--\x3e\n  <% if (isNearSync) { %>\n    <% _.each(remoteSitesCollection, function(rs, idx) {\n      var name = rs.get(\'name\');\n      var uuid = rs.get(\'uuid\');\n      var showWarningIcon = rs.get(\'showWarningIcon\') || false;\n      var retentionPeriod = retentionPolicy.remoteRetentionPeriod[name] || "";\n      var retentionType = retentionPolicy.remoteRetentionType[name] || "";\n      var isChecked = retentionPeriod;\n      var isDisabled = !isChecked && disabledUncheckedRemoteSite;\n      %>\n    \x3c!--For each remote site--\x3e\n    <tr class="remote-site-row">\n      <td class="remote-site-col-0 cb-remote-site" data-toogle="tooltip"\n            data-original-title="Only 1 remote site can be selected for a\n              schedule with a RPO of less than or equal to\n              <%= NEAR_SYNC_MAX_MINUTES %> minutes.">\n        <%=\n          Components.checkbox({\n            checked: isChecked ? true : false,\n            disabled: isDisabled,\n            jsClasses: \'cb-remote-site\',\n            value: name,\n            name: \'remote-sites\',\n            attributes: \'showWarningIcon=\' + showWarningIcon\n          })\n          %>\n      </td>\n      <td class="remote-site-col-1" data-original-name="<%= name %>">\n        <%= name %>\n        <% if (showWarningIcon) { %>\n        <span class="info-icon"><%= infoIcon %></span>\n        <% } %>\n      </td>\n      <td class="remote-site-col-2" >\n        <input type="text" data-id="<%=name%>"\n          class="remote-retention-period"\n          value="<%= retentionPeriod %>">\n        <select class="remote-retention-type">\n          <option value="">Select</option>\n          <% _.each(NEAR_SYNC_RETENTION_TYPES, function(key) { %>\n            <option\n              <%= retentionType === key? \'selected\' : \'\'%>\n              value=<%= key %>\n              >\n              <%= i18n(key) %>\n            </option>\n          <% }) %>\n        </select>\n      </td>\n    </tr>\n    <% }) %>\n  <% } else { %>\n    <% _.each(remoteSitesCollection, function(rs, idx) {\n      var name = rs.get(\'name\');\n      var uuid = rs.get(\'uuid\');\n      var showWarningIcon = rs.get(\'showWarningIcon\') || false;\n      var snapshotSize = retentionPolicy.maxSnapshotsByRemoteSite[name] || "";\n      var isChecked = snapshotSize;\n      %>\n    \x3c!--For each remote site--\x3e\n    <tr class="remote-site-row">\n      <td class="remote-site-col-0">\n        <%=\n          Components.checkbox({\n            checked: isChecked ? true : false,\n            jsClasses: \'cb-remote-site\',\n            value: name,\n            name: \'remote-sites\',\n            attributes: \'showWarningIcon=\' + showWarningIcon\n          })\n          %>\n      </td>\n      <td class="remote-site-col-1" data-original-name="<%= name %>">\n        <%= name %>\n        <% if (showWarningIcon) { %>\n        <span class="info-icon"><%= infoIcon %></span>\n        <% } %>\n      </td>\n      <td class="remote-site-col-2" >\n        keep the last\n        <input type="text" data-id="<%=name%>"\n          class="remote-site-snapshots"\n          value="<%= snapshotSize%>">\n        snapshots\n      </td>\n    </tr>\n    <% }) %>\n  <% } %>\n  <% } %>\n</table>\n'}),define("views/wizards/pd/ScheduleDetailView",["datepicker","timepicker","views/basecomponents/BaseSubView","managers/LicenseManager","models/dataprotection/PDScheduleModel","models/BaseCollection","utils/AppConstants","utils/AppUtil","utils/HypervisorUtil","utils/TimeUtil","utils/SVG","data/DataProperties","text!templates/wizards/pd/ScheduleDetailView.html","text!templates/wizards/pd/ScheduleRetentionPolicyView.html","components/Components"],function(e,t,i,n,s,a,r,o,l,c,u,d,h,p,T){"use strict"
;var E=_.template(h),S=_.template(p),g=_.template('<td class="remote-site-col-0"></td><td class="no-remote-site-col" colspan="2"><%= explanationText %></td>'),A='<div class="n-tooltip-wrapper"></div>',m=_.template("Up to <%= totalSnapshots %> <%= totalSnapshotsEntityName %> will be retained for this schedule and retention policy (<%= maxSnapshots %> <%= maxSnapshotsEntityName %> for each interval)."),f=_.template("<% if (!retentionPolicyPeriod) { %>\n        <%= i18n('emptyRetentionPolicyPeriodMsg') %>\n      <% } else if (!retentionPolicyType) { %>\n        <%= i18n('emptyRetentionPolicyTypeMsg') %>\n      <% } else { %>\n        <%= i18ns('nearSyncMinutelySchedule',\n          { value: rpo_value,\n            type: rpo_type\n          }) %>\n        <br/><%= i18n('nearSyncHourlySchedule') %>\n        <br/><%= i18ns('nearSyncDailySchedule',\n          (retentionPolicyType === NEAR_SYNC_RETENTION_TYPES.DAYS) ?\n            retentionPolicyPeriod : NEAR_SYNC_RETENTION_LIMIT.DAYS) %>\n        <% if (appConsistent) { %>\n           (<%= i18n('appConsistent') %>)\n        <% } %>\n        .\n        <% if (retentionPolicyType === NEAR_SYNC_RETENTION_TYPES.WEEKS) { %>\n          <br/><%= i18ns('nearSyncWeeklySchedule', retentionPolicyPeriod) %>\n          <% if (appConsistent) { %>\n             (<%= i18n('appConsistent') %>)\n          <% } %>\n          .\n        <% } %>\n        <% if (retentionPolicyType === NEAR_SYNC_RETENTION_TYPES.MONTHS) {%>\n          <br/><%= i18ns('nearSyncWeeklySchedule',\n              NEAR_SYNC_RETENTION_LIMIT.WEEKS) %>\n          <% if (appConsistent) { %>\n             (<%= i18n('appConsistent') %>)\n          <% } %>\n          .\n          <br/><%= i18ns('nearSyncMonthlySchedule', retentionPolicyPeriod) %>\n          <% if (appConsistent) { %>\n             (<%= i18n('appConsistent') %>)\n          <% } %>\n          .\n        <% } %>\n      <% } %>");return i.extend({events:{"click input[name=schedule-type]":"onScheduleTypeButtonClick","click input[name=weeklyParameter]":"onWeeklyValueChange","change #secondlyValue":"onSecondlyValueChange","change #minutelyValue":"onMinutelyValueChange","change #hourlyValue":"onHourlyValueChange","change #dailyValue":"onDailyValueChange","change #monthlyValue":"onMonthlyValueChange","click input[name=remote-sites]":"onRemoteSiteCheckboxClick","change .remote-site-snapshots":"onSnapshotInputChange","keyup .remote-site-snapshots":"onSnapshotInputKeyup","change #localMaxSnapshots":"onLocalMaxSnapshotsChange","keyup #localMaxSnapshots":"onSnapshotInputKeyup","change #localRetentionPeriod":"onLocalRetentionPeriodChange","keyup #localRetentionPeriod":"onRetentionPeriodKeyup","change #localRetentionType":"onLocalRetentionTypeChange","change .remote-retention-period":"onRemoteRetentionPeriodChange","keyup .remote-retention-period":"onRetentionPeriodKeyup","change .remote-retention-type":"onRemoteRetentionTypeChange","click #enableEndDate":"onEnableEndDate","change .cb-app-consistent":"onAppConsistentSnapshot","keyup #monthlyValue":"onMonthlyValueKeyup","mouseover .n-tooltip-wrapper":"onTooltipMouseOver","mouseout .n-tooltip-wrapper":"onTooltipMouseOut"},remoteSiteCollection:null,protectionDomain:null,hasUserData:!1,name:"ScheduleDetailView",initialize:function(e){i.prototype.initialize.apply(this,arguments),_.bindAll(this,"onBodyClick"),$("body").on("click",this.onBodyClick),this.remoteSiteCollection=e.remoteSiteCollection,this.protectionDomain=e.protectionDomain,this.scheduleCollection=e.scheduleCollection},render:function(){var e=this.protectionDomain.get(d.PD_VGS),t=this.remoteSiteCollection.models,i=this.clusterManager.getCurrentClusterUuid(),n=l.getDominantHypervisor(i);_.each(t,function(t){var i=t.get(d.RS_CAPABILITIES),s=[];_.contains(i,r.RS_CAPABILITIES.SUPPORT_KVM)&&s.push(r.HYPERVISOR_TYPE.KVM),_.contains(i,r.RS_CAPABILITIES.SUPPORT_VSPHERE)&&s.push(r.HYPERVISOR_TYPE.ESXI),_.contains(i,r.RS_CAPABILITIES.SUPPORT_HYPERV)&&s.push(r.HYPERVISOR_TYPE.HYPERV);var a=_.contains(s,n),o=_.contains(i,r.RS_CAPABILITIES.BACKUP);t.get(d.CLUSTER_EXTERNAL_DATA_SERVICES)||o||!a||_.isEmpty(e)||t.set("showWarningIcon",!0)});var a=this.protectionDomain.getMetroStandbySiteName();a&&(t=_.filter(this.remoteSiteCollection.models,function(e){return e.get(e.nameAttribute)!==a},this));var o=!this.protectionDomain.isMetroAvailPD()&&!this.protectionDomain.get("vstoreId")&&!this.protectionDomain.isFileServerPD()&&l.isAppConsistentSnapshotSupported(),u=E(this.vtOptions({initialized:this.isModelInitialized(),remoteSitesCollection:t,scheduleModel:this.model.toUIJSON(),showAppConsistent:o,showSecondsRPO:this.isSecondsRPOSupported(),isMetroAvailPD:this.protectionDomain.isMetroAvailPD()}));this.$el.html(u);var h=this,p=_.extend(c.getDatePickerOptions(),{format:c.getDatePickerFormat(s.TIME_PICKER_LOCALE)});this.$("#startDatePicker").datepicker(p).on("changeDate",function(e){var t=h.$("#startDate").val();h.model.setStartDate(t)}),this.$("#startDatePicker").datepicker("setDate",new Date(this.model.getStartDate())),this.$("#startTime").timepicker({template:"dropdown",showSeconds:!1,defaultTime:this.model.getStartTime()}).on("changeTime.timepicker",function(e){var t=h.$("#startTime").val();h.model.setStartTime(t)}),this.$("#endDatePicker").datepicker(p).on("changeDate",function(e){var t=h.$("#endDate").val();h.model.setEndDate(t)}),this.model.getEndDate()&&this.$("#endDatePicker").datepicker("setDate",new Date(this.model.getEndDate())),this.$("#endTime").timepicker({template:"dropdown",showSeconds:!1,defaultTime:this.model.getEndTime()?this.model.getEndTime():null}).on("changeTime.timepicker",function(e){var t=h.$("#endTime").val();h.model.setEndTime(t)}),this.$(".schedule-tooltip").tooltip({placement:"top",trigger:"hover",html:!0}),this.toggleScheduleType(this.model.get(this.model.nameAttribute)),this.hasUserData=!1,o&&this.setAppConsistent(this.$(".cb-app-consistent").prop("checked")),this.renderRetentionPolicy(!0),this.updateAppConsistentSnapshotOption(),this.existingNearSyncFlag=this.model.isNearSync(),this.isRPOOneHour=!1,this.isStartTimeDisabled=!1,this.isExistingStartTimeDisabled=!1,this.existingStartTime=null,this.existingStartDate=null,this.model.isNew()||(this.existingStartTime=this.model.getStartTime(),this.existingStartDate=this.model.getStartDate(),this.checkOneHourRPO(),this.isStartTimeDisabled?this.isExistingStartTimeDisabled=!0:(this.existingStartTime=null,this.existingStartDate=null))},renderRetentionPolicy:function(e,t){var i=this.protectionDomain.get(d.PD_VGS),a=this.clusterManager.getCurrentClusterModel(),r=a.get(d.CLUSTER_EXTERNAL_DATA_SERVICES),o=[],l=void 0;_.isEmpty(i)||r||(l=!0,e&&o.push(this.i18n("ip_configuration_warning"))),this.model.isNearSync()&&this.hasOneHourRPOSchedule()&&o.push(this.i18n("nearSync_hourly_schedule_info"));var c=this.protectionDomain.getMetroStandbySiteName(),u=this.remoteSiteCollection.models;c&&(u=_.filter(u,function(e){return e.get(e.nameAttribute)!==c},this));var h=_.size(this.model.getRemoteRetentionPeriod())>0,p=S(this.vtOptions({remoteSitesCollection:u,retentionPolicy:this.model.getRetentionPolicyInfo(),isNearSync:this.model.isNearSync(),standBy:c,showWarningMsgForLocal:l,Components:T,infoIcon:T.icon("Circular_Exclamation","-inline -small"),NEAR_SYNC_RETENTION_TYPES:s.NEAR_SYNC_RETENTION_TYPES,NEAR_SYNC_MAX_MINUTES:s.NEAR_SYNC_MAX_MINUTES,disabledUncheckedRemoteSite:h}));this.$("#retention-policy-container").html(p),this.$(".info-icon").tooltip("destroy"),this.$(".info-icon").tooltip({title:this.i18n("ip_not_configured"),placement:"right",container:"body"}),this.applyNutanixInput();var E=this;this._showLocalTotalSnapshots();var g;if(this.model.isNearSync()){this.updateRemoteSiteRetentionPolicyView(this.$("input[name=remote-sites]:checked")),g=this.$(".remote-retention-period");var A=n.FEAT_MAP.LICENSE_NEAR_SYNC;n.violatedFeatureLicense(A)&&o.push(n.getPopupMessageTemplate(A,this.i18ns("nearSync_license_warning",s.NEAR_SYNC_MAX_MINUTES)))}else g=this.$(".remote-site-snapshots");_.each(g,function(e){$(e).val().trim()&&E._showRemoteTotalSnapshots(e)}),this.model.getScheduleType()||this.$(".n-text-about-snapshots").hide(),this._validateRemoteMaxSnapshotsSchedule(t,o)},refreshRetentionPolicyView:function(e){this.renderRetentionPolicy(!1,e),this.updateAppConsistentSnapshotOption(e)},updateAppConsistentSnapshotOption:function(e){var t=this.$(".cb-app-consistent"),i=t.parents("div.app-consistent-div");i.tooltip("destroy"),this.model.isNearSync()?(t.prop("checked")&&(t.prop("checked",!1),this.setAppConsistent(!1),e&&this.toggleAppConsistentLicenseWarning(e,!1)),t.prop("disabled",!0),i.tooltip({placement:"top",html:"true",trigger:"hover"})):t.prop("disabled",!1)},destroy:function(){$("body").off("click",this.onBodyClick),this.$(".schedule-tooltip").tooltip("destroy"),this.$(".info-icon").tooltip("destroy"),this.$("input[name=remote-sites]:disabled").parents("td").tooltip("destroy"),this.$(".cb-app-consistent:disabled").parents("div.app-consistent-div").tooltip("destroy"),this.$(".start-time").tooltip("destroy"),this.$("#startDatePicker").datepicker("destroy"),this.$("#endDatePicker").datepicker("destroy"),this.$("#startTime").timepicker().remove(),this.$("#endTime").timepicker().remove(),i.prototype.destroy.apply(this)},isSecondsRPOSupported:function(){return o.isLocalStorageProperty(r.LOCAL_STORAGE.SECONDS_RPO_FEATURE_FLAG)&&!this.protectionDomain.isMetroAvailPD()},onScheduleTypeButtonClick:function(e){var t=$(e.currentTarget),i=t.val();if(i!==this.model.getScheduleType()){var n=this.model.isNearSync();this.model.setScheduleType(i),this.model.setScheduleValues(null),this.model.setEveryNthValue(null),this.setInputValueByType(i),this.toggleScheduleType(i),n!==this.model.isNearSync()?this.refreshRetentionPolicyView(e):(this._showLocalTotalSnapshots(),this._validateRemoteMaxSnapshotsSchedule(e))}},toggleScheduleType:function(e){null!==e&&(this.hasUserData=!0,_.each(s.SCHEDULE_TYPES,function(t){var i="."+t.toLowerCase()+"-parameter",n=this.$(i),s="."+t.toLowerCase()+"-type";t!==e?(n.addClass("disabled"),this.$(i+" :input[type=text]").attr("disabled",!0),this.$(i+" :input[type=checkbox]").attr("disabled",!0),this.$(s).removeClass("active")):(n.removeClass("disabled"),this.$(i+" :input[type=text]").removeAttr("disabled"),this.$(i+" :input[type=checkbox]").removeAttr("disabled"),this.$(s).addClass("active"))},this))},setInputValueByType:function(e){switch(e){case s.SECONDLY:this.setEveryNthValue(this.$("#secondlyValue"));break;case s.MINUTELY:this.setEveryNthValue(this.$("#minutelyValue")),Number(this.$("#minutelyValue").val())===r.MINUTES_PER_HOUR?this.setOneHourRPOFlag():this.clearOneHourRPOFlag();break;case s.HOURLY:this.setEveryNthValue(this.$("#hourlyValue")),1===Number(this.$("#hourlyValue").val())?this.setOneHourRPOFlag():this.clearOneHourRPOFlag();break;case s.DAILY:this.setEveryNthValue(this.$("#dailyValue")),this.clearOneHourRPOFlag();break;case s.WEEKLY:this.setWeeklyValues(),this.clearOneHourRPOFlag();break;case s.MONTHLY:this.setMonthlyValues(this.$("#monthlyValue")),this.clearOneHourRPOFlag();break;default:this.showError("Unsupported schedule type.")}},checkScheduleTypeButton:function(e){this.$("input[name=schedule-type][value="+e+"]").attr("checked",!0)},updateScheduleType:function(e){this.checkScheduleTypeButton(e),this.model.setScheduleType(e),this.toggleScheduleType(e)},onSecondlyValueChange:function(e){var t=this.model.isNearSync();this.setEveryNthValue($(e.currentTarget)),this.model.getScheduleType()!==s.SECONDLY&&(this.updateScheduleType(s.SECONDLY),this._showLocalTotalSnapshots());var i=this.model.getEveryNthValue();if(null!==i&&(i<s.MIN_REPEATING_SECONDS||i>s.MAX_REPEATING_SECONDS))return this.model.setEveryNthValue(null),this.showError(this.i18n("secondly_rpo_help_msg")),void $(e.currentTarget).val("");t!==this.model.isNearSync()?this.refreshRetentionPolicyView(e):this._validateRemoteMaxSnapshotsSchedule(e)},onMinutelyValueChange:function(e){var t=this.model.isNearSync();this.setEveryNthValue($(e.currentTarget)),Number($(e.currentTarget).val())===r.MINUTES_PER_HOUR?this.setOneHourRPOFlag():this.clearOneHourRPOFlag(),this.model.getScheduleType()!==s.MINUTELY&&(this.updateScheduleType(s.MINUTELY),this._showLocalTotalSnapshots());var i=this.model.getEveryNthValue();if(this.protectionDomain.isFileServerPD()&&this.protectionDomain.isMetroAvailPD()&&null!==i&&i<s.METRO_AVAIL_PD_MINIMUM_REPEATING_MINUTES)return this.model.setEveryNthValue(null),this.showError("Please enter a value greater than or equal to "+s.METRO_AVAIL_PD_MINIMUM_REPEATING_MINUTES+" minutes."),void $(e.currentTarget).val("");t!==this.model.isNearSync()?this.refreshRetentionPolicyView(e):this._validateRemoteMaxSnapshotsSchedule(e)},onHourlyValueChange:function(e){this.setEveryNthValue($(e.currentTarget)),1===Number($(e.currentTarget).val())?this.setOneHourRPOFlag():this.clearOneHourRPOFlag(),this._validateRemoteMaxSnapshotsSchedule(e),this.model.getScheduleType()!==s.HOURLY&&(this.updateScheduleType(s.HOURLY),this._showLocalTotalSnapshots())},onDailyValueChange:function(e){this.setEveryNthValue($(e.currentTarget)),this.clearOneHourRPOFlag(),this.model.getScheduleType()!==s.DAILY&&(this.updateScheduleType(s.DAILY),this._showLocalTotalSnapshots())},onWeeklyValueChange:function(){this.setWeeklyValues(),this.clearOneHourRPOFlag(),this.model.getScheduleType()!==s.WEEKLY&&this.updateScheduleType(s.WEEKLY),this._showLocalTotalSnapshots()},onMonthlyValueKeyup:function(e){this._showLocalTotalSnapshots()},onMonthlyValueChange:function(e){this.setMonthlyValues($(e.currentTarget)),this.clearOneHourRPOFlag(),this.model.getScheduleType()!==s.MONTHLY&&this.updateScheduleType(s.MONTHLY)},checkOneHourRPO:function(){var e=1===this.model.getEveryNthValue()&&this.model.get(d.SCHEDULE_TYPE)===s.HOURLY,t=this.model.getEveryNthValue()===r.MINUTES_PER_HOUR&&this.model.get(d.SCHEDULE_TYPE)===s.MINUTELY;(e||t)&&this.setOneHourRPOFlag()},setOneHourRPOFlag:function(){this.isRPOOneHour=!0,this.hasNearSyncSchedule()&&this.disableStartTime()},clearOneHourRPOFlag:function(){this.isRPOOneHour=!1,this.enableStartTime()},skipStartDateTime:function(){return this.isStartTimeDisabled&&!this.isExistingStartTimeDisabled},isTransitioningFromAsyncToNearSync:function(){return!this.existingNearSyncFlag&&this.model.isNearSync()},disableStartTime:function(){if(!this.isStartTimeDisabled){this.isStartTimeDisabled=!0;var e="",t="",i=this.i18n("create_async_schedule_disabled_start_time");(this.existingStartDate||this.existingStartTime)&&(e=this.existingStartDate,t=this.existingStartTime,i=this.i18n("update_async_schedule_disabled_start_time")),this.$("#startDate").val(e),this.model.setStartDate(e),this.$("#startTime").val(t),this.model.setStartTime(t),this.$("#startDate").prop("disabled",!0),this.$("#startTime").prop("disabled",!0),this.$(".start-time").tooltip({title:i,placement:"top",container:"body"})}},enableStartTime:function(){if(this.isStartTimeDisabled){this.isStartTimeDisabled=!1,this.$(".start-time").tooltip("destroy"),this.$("#startDate").prop("disabled",!1),this.$("#startTime").prop("disabled",!1);var e=Date.now(),t=c.formatDate(e,s.DATE_FORMAT);this.$("#startDate").val(t),this.model.setStartDate(t);var i=c.formatDate(e,s.TIME_FORMAT,s.TIME_PICKER_LOCALE);this.$("#startTime").val(i),this.model.setStartTime(i)}},setMonthlyValues:function(e){if(e){this.model.setScheduleValues([]);var t=this._getMonthlyValues();null===t?(this.showError("Please enter a day of month between 1 to 31."),e.val("")):this.model.setScheduleValues(t)}},setWeeklyValues:function(){this.model.setScheduleValues(this._getWeeklyScheduleValues())},setEveryNthValue:function(e){if(e){var t=e.val().trim();if(this.model.setEveryNthValue(null),""!==t){var i=parseInt(t,10);if(isNaN(i)||i<=0)return this.showError("Please enter a positive number."),void e.val("");this.model.setEveryNthValue(i)}}},setAsyncRemoteSiteRetentionPolicy:function(){var e={},t=[];_.each(this.$("input[name='remote-sites']:checked"),function(i){var n=$(i).val();e[n]=null;var s=this.$("input[data-id='"+n+"']").val();if(s&&s.length>0){var a=this._stringToRetentionValue(s);null===a?t.push(n):e[n]=a}},this),t.length&&this.showError("Please enter a snapshot retention value greater than 0 for remote site '"+t.join(", ")+"'."),this.model.setRemoteMaxSnapshots(e)},updateRemoteSiteRetentionPolicyView:function(e){if(this.$("input[name=remote-sites]:disabled").parents("td").tooltip("destroy"),e.prop("checked")){this.$("input[name=remote-sites]").prop("disabled",!0),this.$(".remote-retention-period").prop("disabled",!0),this.$(".remote-retention-type").parent().addClass("disabled");var t=e.parents("tr");e.prop("disabled",!1),t.find(".remote-retention-period").prop("disabled",!1),t.find(".remote-retention-type").parent().removeClass("disabled")}else this.$("input[name=remote-sites]").prop("disabled",!1),this.$(".remote-retention-period").prop("disabled",!1),this.$(".remote-retention-type").parent().removeClass("disabled");this.$("input[name=remote-sites]:disabled").parents("td").tooltip({placement:"top",html:"true",container:"body",trigger:"hover"})},setNearSyncRemoteSiteRetentionPolicy:function(e){var t={},i={};if(e.prop("checked")){var n=e.parents("tr"),s=n.children(".remote-site-col-1").attr("data-original-name"),a=n.find(".remote-retention-period"),r=this._stringToRetentionValue(a.val().trim());r&&(a.val(r),t[s]=r);var o=n.find(".remote-retention-type"),l=o.val().trim();l&&(i[s]=l)}this.model.setRemoteRetentionPeriod(t),this.model.setRemoteRetentionType(i)},onRemoteSiteCheckboxClick:function(e){var t=[];"true"===$(e.target).attr("showWarningIcon")&&t.push(this.i18n("ip_configuration_warning")),this.model.isNearSync()?(this.updateRemoteSiteRetentionPolicyView($(e.currentTarget)),this.setNearSyncRemoteSiteRetentionPolicy($(e.currentTarget))):this.setAsyncRemoteSiteRetentionPolicy(),this._validateRemoteMaxSnapshotsSchedule(e,t)},_validateRemoteMaxSnapshotsSchedule:function(e,t){if(t=t||[],this.remoteSiteCollection&&this.remoteSiteCollection.length){var i={};this.$(".n-checkbox.cb-remote-site:checked").each(function(e,t){i[$(t).val()]=$(t).val()}),_.each(i,function(e){var i=this.remoteSiteCollection.find(function(t){return t.getValue(d.NAME)===e},this),n=this._validateRemoteSiteSchedule(i);n&&t.push(n)},this),t.length?(this.getParentView().showHeaderWarning(t.join("<br>")),$(".alert-warning h4").addClass("remote-site-rpo-warning")):$(".remote-site-rpo-warning").is(":visible")&&this.getParentView().clearHeader(),e&&e.stopPropagation()}},_validateRemoteSiteSchedule:function(e){if(e){var t=e.getValue(d.RS_CLOUD_TYPE),i=this.model.getScheduleType(),n=this.model.getEveryNthValue();if(i&&t){if(i===s.SECONDLY)return this.i18ns("remote_site_rpo_violation",[e.get(d.NAME)]);if(i===s.MINUTELY){if(!n||n<360)return this.i18ns("remote_site_rpo_violation",[e.get(d.NAME)])}else if(i===s.HOURLY&&(!n||n<6))return this.i18ns("remote_site_rpo_violation",[e.get(d.NAME)])}}},onSnapshotInputKeyup:function(e){var t=$(e.currentTarget),i=t.val().trim();if(""!==i){null===this._stringToRetentionValue(i)?(this.showError("Please enter a snapshot retention value greater than 0."),t.val("")):("localMaxSnapshots"===t.attr("id")?this._showLocalTotalSnapshots():this._showRemoteTotalSnapshots(t),this._validateRemoteMaxSnapshotsSchedule(e))}},onTooltipMouseOver:function(e){var t,i=$(e.currentTarget);if(this.model.isNearSync())t=this._getRetentionPolicyExplanationText(i);else{var n=i.parents("td"),s=n.siblings(".remote-site-col-1").attr("data-original-name"),a=this._getRemoteMaxSnapshots(s),l=this._getTotalSnapshots(a);t=m({totalSnapshots:l,maxSnapshots:a,totalSnapshotsEntityName:o.getEntityNameFromCount(r.ENTITY_DR_SNAPSHOT,l),maxSnapshotsEntityName:o.getEntityNameFromCount(r.ENTITY_DR_SNAPSHOT,a)})}i.tooltip({title:t,trigger:"manual",placement:"top",html:"true",container:"body"}),i.tooltip("show")},onTooltipMouseOut:function(e){$(e.currentTarget).tooltip("destroy")},onSnapshotInputChange:function(e){var t=$(e.currentTarget).attr("data-id"),i=$("input[value='"+t+"']");i&&!i.prop("checked")&&i.prop("checked",!0),this.setAsyncRemoteSiteRetentionPolicy()},onLocalMaxSnapshotsChange:function(e){var t=$(e.currentTarget).val().trim(),i=this._stringToRetentionValue(t);null===i?(this.showError("Please enter a snapshot retention value greater than 0 for local sites."),this.$("#standByMaxSnapshots").val(""),this.model.setLocalMaxSnapshotsChange(null)):(this.$("#standByMaxSnapshots").val(i),this.model.setLocalMaxSnapshotsChange(i))},isValidRetentionPeriodInput:function(e){var t=e.val().trim(),i=this._stringToRetentionValue(t),n="localRetentionPeriod"===e.attr("id");return!!i||(n?this.showError("Please enter a retention period greater than 0 for local site."):this.showError("Please enter a retention period greater than 0 for remote site."),e.val(""),!1)},onRetentionPeriodKeyup:function(e){var t=this.$(e.currentTarget);this.isValidRetentionPeriodInput(t)&&("localRetentionPeriod"===t.attr("id")?this._showLocalTotalSnapshots():this._showRemoteTotalSnapshots($(e.currentTarget)))},onLocalRetentionPeriodChange:function(e){var t=this.$(e.currentTarget);if(this.isValidRetentionPeriodInput(t)){var i=this._stringToRetentionValue(t.val().trim());this.$("#localRetentionPeriod").val(i),this.model.setLocalRetentionPeriod(i)}else this.model.setLocalRetentionPeriod(null)},onLocalRetentionTypeChange:function(e){var t=this.$(e.currentTarget).val().trim();this.model.setLocalRetentionType(t)},onRemoteRetentionPeriodChange:function(e){var t=this.$(e.currentTarget),i=t.parent().siblings(".remote-site-col-0").find("input[name=remote-sites]"),n={};if(this.isValidRetentionPeriodInput(t)){i.prop("checked")||(i.prop("checked",!0),this.updateRemoteSiteRetentionPolicyView(i));var s=t.parent().siblings(".remote-site-col-1").attr("data-original-name"),a=this._stringToRetentionValue(t.val().trim());t.val(a),n[s]=a}this.model.setRemoteRetentionPeriod(n)},onRemoteRetentionTypeChange:function(e){var t=$(e.currentTarget).parents("td").siblings(".remote-site-col-1").attr("data-original-name"),i=$(e.currentTarget).val().trim(),n={};i&&(n[t]=i),this.model.setRemoteRetentionType(n)},onEnableEndDate:function(e){var t=$(e.currentTarget).prop("checked");this.model.setEndDateEnabled(t),t?(this.$("div.schedule-end-time :input[type=text]").removeAttr("disabled"),this.$("div.schedule-end-time > div > span.add-on").removeClass("disabled"),this.$("div.schedule-end-time > div.text2").removeClass("disabled")):(this.$("div.schedule-end-time :input[type=text]").attr("disabled",!0),this.$("div.schedule-end-time > div > span.add-on").addClass("disabled"),this.$("div.schedule-end-time > div.text2").addClass("disabled"),this.$("#endDate").val(""),this.$("#endTime").val(""),this.model.setEndDate(null),this.model.setEndTime(null))},onAppConsistentSnapshot:function(e){var t=this.$(".cb-app-consistent").prop("checked");this.setAppConsistent(t),this.toggleAppConsistentLicenseWarning(e,t)},setAppConsistent:function(e){this.model.setAppConsistent(e)},toggleAppConsistentLicenseWarning:function(e,t){e.stopPropagation();var i=n.FEATURE_MAP.LICENSE_DR_APPLICATION_CONSISTENT_SNAPSHOT;t?n.violatedFeatureLicense(i)&&(this.showHeaderWarning(n.getPopupMessageTemplate(i,this.i18n("appConsistent_license_warning"))),$(".alert-warning h4").addClass("appConsistent-license-warning")):$(".appConsistent-license-warning").is(":visible")&&this.getParentView().clearHeader()},refreshView:function(){this.render()},onBodyClick:function(e){this._hideDropdowns()},hasUserModifyData:function(){return!!this.protectionDomain.isNew()&&this.hasUserData},getOtherSchedules:function(){var e=this;return new a(this.scheduleCollection.filter(function(t){return t.getId()!==e.model.getId()}))},hasNearSyncSchedule:function(){return Boolean(this.getOtherSchedules().find(function(e){return Boolean(e.get(d.PD_ROLL_UP_SCHEDULE_UUID))}))},hasOneHourRPOSchedule:function(){return Boolean(this.getOtherSchedules().find(function(e){var t=e.get(d.SCHEDULE_TYPE),i=e.get(d.SCHEDULE_EVERY_NTH),n=1===i&&t===s.HOURLY,a=i===1*r.MINUTES_PER_HOUR&&t===s.MINUTELY;return n||a}))},_showLocalTotalSnapshots:function(){if(this.model.getScheduleType())if(this.model.isNearSync()){var e=$("#localRetentionPeriod").parents("td");if(e.find(".info-tooltip").length<=0){var t=$(A).append(u.SVGIcon("information-tooltip","info-tooltip")).attr("id","localRetentionExplanation");e.append(t)}}else{var i=this._getLocalMaxSnapshots(),n=this._getTotalSnapshots(i),s=m({totalSnapshots:n,maxSnapshots:i,totalSnapshotsEntityName:o.getEntityNameFromCount(r.ENTITY_DR_SNAPSHOT,n),maxSnapshotsEntityName:o.getEntityNameFromCount(r.ENTITY_DR_SNAPSHOT,i)});this.$(".n-text-about-snapshots").html(g({explanationText:s})),this.$(".n-text-about-snapshots").show()}},_showRemoteTotalSnapshots:function(e){var t=$(e).parents("td");if(t.find(".info-tooltip").length<=0){var i=$(A).append(u.SVGIcon("information-tooltip","info-tooltip"));t.append(i)}},_hideDropdowns:function(){this.$("ul.dropdown-menu").hide()},_stringToRetentionValue:function(e){var t=parseInt(e,10);return isNaN(t)||t<=0||t.toString()!==e?null:t},_getMonthlyValues:function(){var e=this.$("#monthlyValue"),t=e.val().trim(),i=[];if(""!==t)for(var n=t.split(","),s=0;s<n.length;s++){var a=parseInt(n[s],10);if(!c.isTimeUnitAndValueValid("days",a))return null;i.push(a)}return i},_getRemoteMaxSnapshots:function(e){var t=this.$("[data-id="+e+"]").val().trim();return""!==t?this._stringToRetentionValue(t):0},_getLocalMaxSnapshots:function(){var e=this.$("#localMaxSnapshots").val().trim();return""!==e?this._stringToRetentionValue(e):0},_getWeeklyScheduleValues:function(){var e=[];return this.$("input[name=weeklyParameter]:checked").each(function(){var t=$(this).attr("value");e.push(parseInt(t,10))}),e},_getTotalSnapshots:function(e){var t,i,n=this.model.getScheduleType();switch(n){case s.WEEKLY:i=this._getWeeklyScheduleValues(),t=Math.max(i.length*e,1);break;case s.MONTHLY:i=this._getMonthlyValues()||[],t=Math.max(i.length*e,1);break;case s.DAILY:case s.HOURLY:case s.MINUTELY:case s.SECONDLY:t=e;break;default:t=0}return t},_getRetentionPolicyExplanationText:function(e){var t=e.siblings("input").val().trim(),i=e.siblings("div").find("select").val().trim(),n=this.model.getEveryNthValue()||0,a=this.model.getScheduleType(),r=this.model.getAppConsistent();return f(this.vtOptions({retentionPolicyPeriod:t,retentionPolicyType:i,rpo_value:n,rpo_type:this.i18n("rpo_type_"+a),appConsistent:r,NEAR_SYNC_RETENTION_TYPES:s.NEAR_SYNC_RETENTION_TYPES,NEAR_SYNC_RETENTION_LIMIT:s.NEAR_SYNC_RETENTION_LIMIT}))}})}),define("views/wizards/pd/SchedulePage",["data/DataProperties","views/basecomponents/wizards/BaseWizardPage","views/wizards/pd/ScheduleListView","views/wizards/pd/ScheduleDetailView","models/dataprotection/PDScheduleCollection","models/dataprotection/RemoteSiteCollection","models/dataprotection/PDScheduleModel","utils/AppConstants","utils/SubViewHelper"],function(e,t,i,n,s,a,r,o,l){"use strict";return t.extend({subViewHelper:null,initialized:!1,editingScheduleModel:null,scheduleCollection:null,remoteSiteCollection:null,model:null,mode:o.ACTION_LIST,name:"SchedulePage",initialize:function(t){this.subViewHelper=new l,this.scheduleCollection=new s({},{pdName:t.model.get(e.PD_NAME),isPDMetroAvail:t.model.isMetroAvailPD()}),this.remoteSiteCollection=new a},render:function(){this.model.isNew()?this.mode=o.ACTION_CREATE:this.mode=o.ACTION_LIST,this.subViewHelper.getIds().length>0?this.model.isNew()||this._switchView({action:o.ACTION_LIST}):(this.initialized?this.$el.html('<div id="scheduleListContainer" class="schedule-list-container"></div> <div id="scheduleEditorContainer" class="schedule-container"></div>'):this.$el.html("<div class='no-data page-loading-message'> <img src=\"app/assets/images/spinners/loading.gif\" width=16px height=16px />&nbsp;Loading...</div>"),this.initialized?this._switchView({action:this.mode}):this._loadModels())},refreshView:function(){if(this.initialized){var e=this._getCurrentSubView();if(e)this.mode!==o.ACTION_LIST&&(e.model=this.editingScheduleModel),e.refreshView(),e.showView();else{var t=this._getSubViewId();this.mode===o.ACTION_LIST?(e=new i({el:"#scheduleListContainer",model:this.scheduleCollection,remoteSiteCollection:this.remoteSiteCollection,pdModel:this.model}),e.setParentView(this),this.subViewHelper.register(t,e)):(e=new n({el:"#scheduleEditorContainer",model:this.editingScheduleModel,remoteSiteCollection:this.remoteSiteCollection,protectionDomain:this.model,scheduleCollection:this.scheduleCollection}),e.setParentView(this),this.subViewHelper.register(t,e)),this.subViewHelper.render(t)}this.subViewHelper.iterate("onResize")}},destroy:function(){this.subViewHelper.destroy(),t.prototype.destroy.apply(this)},onClickLinkAction:function(e){var t=$(e.currentTarget),i={action:t.attr(o.NAV_ACTION),actionTarget:t.attr(o.NAV_ACTION_TARGET),actionTargetId:t.attr(o.NAV_ACTION_TARGET_ID),actionTargetName:t.attr(o.NAV_ACTION_TARGET_NAME)};if(i.action===o.ACTION_UPDATE||i.action===o.ACTION_CREATE)this._switchView(i);else if(i.action===o.ACTION_DELETE){var n=this;$.nutanixConfirm({msg:"Delete this schedule?",yes:function(){n._deleteAction(i)},yesText:"Yes",noText:"No"})}},isModelInitialized:function(){return this.initialized},getSaveButtonLabel:function(){return this.mode===o.ACTION_UPDATE?"Save":this.mode===o.ACTION_CREATE?"Create Schedule":"Close"},canTransitionPage:function(e){return-1!==e||this.mode!==o.ACTION_UPDATE&&this.mode!==o.ACTION_CREATE?1!==e||this.mode!==o.ACTION_UPDATE&&this.mode!==o.ACTION_CREATE?!this.model.isFileServerPD():this.model.isNew():this.model.isMetroAvailPD()&&this.model.isNew()},onPageTransition:function(e){var t=this,i=void 0,n=void 0;if(this.mode===o.ACTION_CREATE){i=this._getCurrentSubView();var s=i.hasUserModifyData();if(i){var a=i.skipStartDateTime();if((!this.model.isNew()||s)&&null!==(n=this.editingScheduleModel.isInputDataValid({skipStartDateTimeValidation:a})))return void this.getWizard().showHeaderError(n);this.model.isNew()?(s?this.model.setMetroSchedule(this.editingScheduleModel):this.model.setMetroSchedule(null),e()):(this.getWizard().$(".btnSave").button("loading"),this.remoteSiteCollection.length&&!this.editingScheduleModel.hasRemoteRetention()?$.nutanixConfirm({msg:this.i18n("no_remote_retention_confirmation_text"),yesText:this.i18n("continue"),yes:function(){t._saveSchedule(a)}}):this._saveSchedule(a))}}else if(this.mode===o.ACTION_UPDATE){if(i=this._getCurrentSubView()){var r=i.skipStartDateTime();if(null!==(n=this.editingScheduleModel.isInputDataValid({skipStartDateTimeValidation:r,isTransitioningFromAsyncToNearSync:i.isTransitioningFromAsyncToNearSync()})))return void this.getWizard().showHeaderError("Error updating schedule: "+n);this.remoteSiteCollection.length&&!this.editingScheduleModel.hasRemoteRetention()?$.nutanixConfirm({msg:this.i18n("no_remote_retention_confirmation_text"),yesText:this.i18n("continue"),yes:function(){t._updateSchedule(r)}}):this._updateSchedule(r)}}else this.subViewHelper.removeAll(),e()},onPageCancel:function(){return this.mode!==o.ACTION_UPDATE&&this.mode!==o.ACTION_CREATE||(!!this.model.isNew()||(this._switchView({action:o.ACTION_LIST}),!1))},showCancelButton:function(){return this.mode===o.ACTION_UPDATE||this.mode===o.ACTION_CREATE||!this.model.isNew()&&this.model.isMetroAvailPD()},confirmHide:function(e){if(this.mode!==o.ACTION_UPDATE&&this.mode!==o.ACTION_CREATE)return e();$.nutanixConfirm({msg:"Schedule content has not been saved. Are you sure you want to exit?",yes:e,yesText:"Yes",noText:"No"})},_saveSchedule:function(e){var t=this,i=this.getWizard().$(".btnSave");this.editingScheduleModel.saveSchedule(function(e){t._loadSchedules(function(){i.button("reset"),t._switchView({action:o.ACTION_LIST})})},function(e){i.button("reset"),t.getWizard().showHeaderError(t.i18n("schedule_error")+": "+e)},e)},_updateSchedule:function(e){var t=this;this.editingScheduleModel.updateSchedule(function(e){t._loadSchedules(function(){
t._switchView({action:o.ACTION_LIST})})},function(e){t.getWizard().showHeaderError(t.i18n("schedule_error")+": "+e)},e)},_loadModels:function(){var t=this,i=[];this.scheduleCollection.setPDName(this.model.get(e.NAME)),i=this.model.isNew()?[this.remoteSiteCollection.fetch()]:[this.model.fetch(),this.scheduleCollection.fetch(),this.remoteSiteCollection.fetch()],$.when.apply($,i).done(function(){t.initialized=!0,t.render()}).fail(function(e,i,n){t._onModelError(e)})},_deleteAction:function(e){var t=this,i=e.actionTargetId,n=this.scheduleCollection.findModelById(i);n.deleteSchedule(function(e){e&&(t.scheduleCollection.remove(n),t._getCurrentSubView().refreshView(),t.model.fetch())},function(e){t.getWizard().showHeaderError("Error delete schedule. "+e)})},_loadSchedules:function(e){var t=this;$.when.apply($,[this.model.fetch(),this.scheduleCollection.fetch()]).done(function(){e?e():t.render()}).fail(function(e,i,n){t._onModelError(e)})},_onModelError:function(e){this.getWizard().showHeaderError(e.responseText)},_getSubViewId:function(){return this.mode===o.ACTION_LIST?"listView":"editorView"},_getCurrentSubView:function(){return this.subViewHelper.get(this._getSubViewId())},_switchView:function(t){var i=this._getCurrentSubView();i&&(i.hideView(),this.getWizard().clearHeader()),this.mode=t.action,t.action===o.ACTION_UPDATE?this.editingScheduleModel=this.scheduleCollection.findModelById(t.actionTargetId):t.action===o.ACTION_CREATE?this.model.isNew()&&this.model.getMetroSchedule()||(this.editingScheduleModel=new r({pdName:this.model.get(e.PD_NAME)},{isPDMetroAvail:this.model.isMetroAvailPD()})):t.action===o.ACTION_LIST&&(this.editingScheduleModel=null),this.refreshView(),this.getWizard().setButtonStates()}})}),define("models/storage/VStoreModel",["backbone","models/BaseModel","data/DataURLConstants","utils/AppConstants"],function(e,t,i,n){"use strict";var s={ID:"id",CONTAINER_UUID:"containerUuid"};return t.extend({urlRoot:i.VSTORE,entityType:n.ENTITY_VSTORE,name:"VStoreModel",DP:s,defaults:{id:-1,name:null,containerId:null,backedup:!1,protectionDomain:null,markedForRemoval:!1}})}),define("models/storage/VStoreCollection",["backbone","models/PollingCollection","models/storage/VStoreModel","data/DataURLConstants","data/DataProperties","utils/AppUtil"],function(e,t,i,n,s,a){"use strict";return t.extend({model:i,url:n.VSTORE,name:"VstoreCollection",comparator:function(e){return e.get(e.nameAttribute)},getProtectionDomainForContainer:function(e){var t=_.find(this.models,function(t){var i=t.get(s.CONTAINER_ID);return a.endsWith(e,"::"+i)});return _.isUndefined(t)?null:t.get(s.PD)}})}),define("text!templates/wizards/pd/ContainersPage.html",[],function(){return'<% if ( ! initialized ) { %>\n\n<div class="no-data page-loading-message">\n  Loading...\n</div>\n<% } else { %>\n\n  <div class="containers-div">\n    <div data-ntnx-section class="n-title">\n    Origin Storage Container\n    </div>\n\n    <div class="table-items containersTable">\n      \x3c!-- @view: Table Containers --\x3e\n    </div>\n  </div>\n<% } %>'}),define("views/wizards/pd/ContainersPage",["views/basecomponents/datatables/DataTableColumnProvider","data/DataProperties","models/storage/ContainerCollection","models/storage/VStoreCollection","models/dataprotection/ProtectionDomainCollection","views/basecomponents/datatables/DetailsTableView","views/basecomponents/wizards/BaseWizardPage","utils/SubModelHelper","utils/SubViewHelper","utils/AppConstants","text!templates/wizards/pd/ContainersPage.html"],function(e,t,i,n,s,a,r,o,l,c,u){"use strict";return r.extend({events:{"click table":"clearHeader"},initialized:!1,subViewHelper:null,subModelHelper:null,template:_.template(u),model:null,initialize:function(e){this.subViewHelper=new l,this.subModelHelper=new o,this.subModelHelper.register(c.ENTITY_CONTAINER,new i),this.subModelHelper.register(c.ENTITY_PROTECTION_DOMAIN,new s),this.subModelHelper.register(c.ENTITY_VSTORE,new n)},render:function(){if(!this.isViewRendered){var i=this.template({initialized:this.initialized});if(this.$el.html(i),this.initialized){if(!this.subViewHelper.get("containersTable")){var n=new a({el:this.$(".containersTable"),scrollHeight:"260px",minimumRows:10,highlightRadioSelection:!0,columns:[{sTitle:"",mData:t.ID,sWidth:"5%",sClass:"center",mRender:function(i,n,s){return e.createDataRowRadioBox(t.PD_METRO_AVAIL_VSTORE,i)}},{sTitle:"Name",mData:t.NAME,sWidth:"75%"},{sTitle:"Capacity",mData:function(e,i,n){return e[t.NEW_TOT_CAPACITY_LOGICAL]},sWidth:"10%",mRender:e.renderStorageStats},{sTitle:"Remaining Space",sWidth:"10%",mData:function(e,i,n){return e[t.NEW_FREE_BYTES_LOGICAL]},mRender:e.renderStorageStats}]});this.subViewHelper.register("containersTable",n)}this.subViewHelper.renderAll(),this.subViewHelper.get("containersTable").updateDataSource(this._getMetroAvailCompatibleContainers()),this.subViewHelper.iterate("onResize"),this.isViewRendered=!0}else this._loadModels();this.applyNutanixInput()}},onModelsLoaded:function(){this.initialized=!0,this.render()},canEnablePageLink:function(){return!this.model.isNew()},canTransitionPage:function(e){return e>0},onPageTransition:function(e){var t=this.$(".containersTable"),i=t.find(".n-datatable-radio:checked");if(i&&i.length){var n=this.subModelHelper.get(c.ENTITY_CONTAINER).findModelById(i[0].value);this.model.setMetroAvailVstore(n),e()}else this.getWizard().showHeaderError("Please select a container.")},onPageCancel:function(){return!0},destroy:function(){this.subViewHelper.destroy(),this.subModelHelper.destroy(),r.prototype.destroy.apply(this,arguments)},_loadModels:function(){var e=this;$.when.apply($,this.subModelHelper.iterate("fetch")).done(function(){e.onModelsLoaded()}).fail(function(t,i,n){e.onModelsLoaded()})},_getNonCompatibleVStores:function(e){var i=[],n=[];return _.each(e.models,function(e){if(null!==e.get(t.PD_VSTORE_ID)){var s=this.findContainerUUIDByVStoreId(e.get(t.PD_VSTORE_ID));s&&i.push(s)}var a=e.get(t.PD_METRO_AVAIL);a&&null!==a[t.PD_METRO_AVAIL_VSTORE]&&n.push(a[t.PD_METRO_AVAIL_VSTORE])},this),{protectedContainerUUids:i,metroAvailEnabledVStores:n}},_getMetroAvailCompatibleContainers:function(){var e=this._getNonCompatibleVStores(this.subModelHelper.get(c.ENTITY_PROTECTION_DOMAIN)),i=e.protectedContainerUUids,n=e.metroAvailEnabledVStores;return this.subModelHelper.get(c.ENTITY_CONTAINER).models.filter(function(e){return!(_.contains(i,e.get(t.CONTAINER_UUID))||_.contains(n,e.get(t.NAME)))}).map(function(e){return e.toJSON({includeAttribute:!0,includeCustomAttributes:!0})})},findContainerUUIDByVStoreId:function(e){var t=this.subModelHelper.get(c.ENTITY_VSTORE),i=t.find(function(t){return t.getId()===e});return i?i.get(i.DP.CONTAINER_UUID):null}})}),define("text!templates/wizards/pd/RemoteSitesPage.html",[],function(){return'<% if ( ! initialized ) { %>\n\n<div class=\'no-data page-loading-message\'>\n  <img src=\'app/assets/images/spinners/loading.gif\'\n       width=16px height=16px />&nbsp;Loading...\n</div>\n<% } else { %>\n<div class="remoteSites-div">\n  <a class="btnRefresh">\n    Refresh\n  </a>\n  <div class="n-title">\n    Target Sites\n  </div>\n  <div class="text">Compatible Remote Sites</div>\n  <div class="table-items remoteSitesTable">\n    \x3c!-- @view: Table Remote Sites --\x3e\n  </div>\n\n  <div class="text">Incompatible Remote Sites</div>\n  <div class="inCompatibleRemoteSitesTable">\n    \x3c!-- @view: Table Incompatible Remote Sites --\x3e\n  </div>\n\n</div>\n<% } %>'}),define("text!templates/popups/dr/EnableMetroAvailabilityInfo.html",[],function(){return'<div class="n-description">\n  Metro Availability requires advanced setup procedures.&nbsp;&nbsp;\n  To set up Metro Availability, please contact your account team,\n  or support.\n</div>\n<div class="n-description">\n  <a target="_blank" href="http://www.nutanix.com/phone-numbers/" >\n    http://www.nutanix.com/phone-numbers/</a>\n</div>'}),define("views/wizards/pd/RemoteSitesPage",["data/DataProperties","views/basecomponents/datatables/DataTableColumnProvider","views/basecomponents/datatables/DetailsTableView","views/basecomponents/wizards/BaseWizardPage","models/dataprotection/RemoteSiteCollection","utils/SubViewHelper","utils/AppUtil","utils/StatsUtil","utils/AppConstants","utils/CommonTemplates","text!templates/wizards/pd/RemoteSitesPage.html","text!templates/popups/dr/EnableMetroAvailabilityInfo.html"],function(e,t,i,n,s,a,r,o,l,c,u,d){"use strict";var h=_.template('<div class="latency-label <%= className %>"><%= latencyLabel %></div><span class="info-tooltip" data-toggle="tooltip" data-original-title="Latency must be <= <%= threshold %> milliseconds RTT<br>Current Latency: <%= latencyTooltip %>"><span class="n-tooltip-circle">?</span></span>'),p=_.template('<div class="<%= className %>"><%= label %></div><% if (showTooltip) {%><span class="metro-tooltip" data-toggle="tooltip" ><span class="n-tooltip-circle">?</span></span><% }%>'),T=_.template('<span class="n-incompatible"><%=data%></span>'),E=_.template("Storage container '<%= container %>' on '<%= remoteSite %>' has existing data."),S=_.template('<div class="n-incompatible"><%= label %></div><span class="info-tooltip" data-toggle="tooltip" data-original-title="<%= tooltip %>"><span class="n-tooltip-circle">?</span></span>'),g=_.template("Storage container '<%= container %>' on '<%= remoteSite %>' has been protected."),A=_.template("Storage container '<%= container %>' on '<%= remoteSite %>' already has metro availability configured for protection domain '<%= pdName %>'."),m=_.template("Maximum capacity for storage container '<%= container %>' on '<%= remoteSite %>' is <%= rsMaxCapacity %>, the required maximum capacity must be at least <%= maxCapacity %>.");return n.extend({events:{"click .detailsTable input[name=remoteSite]":"clearHeader","click .btnRefresh":"_loadRemoteSites"},modelEvents:{"reset   remoteSiteCollection":"onRemoteSitesLoaded","error   remoteSiteCollection":"onRemoteSitesError","pending remoteSiteCollection":"onRemoteSitesLoading"},name:"RemoteSitesPage",initialized:!1,remoteSiteCollection:null,subViewHelper:null,template:_.template(u),model:null,metroAvailVStore:null,initialize:function(e){n.prototype.initialize.apply(this,arguments),this.subViewHelper=new a,this.remoteSiteCollection=new s(null,{alwaysTriggerPending:!0}),this.delegateModelEvents()},render:function(){var n=this.metroAvailVStore;if(this.metroAvailVStore=this.model.getMetroAvailVstore().get(e.NAME),this.isViewRendered)return void(this.metroAvailVStore!==n&&this._loadRemoteSites());var s=this.template({initialized:this.initialized});if(this.$el.html(s),this.initialized){if(this.$(".remoteSites-div").append(c.LOADING_MSG({msg:this.i18n("loading")})),!this.subViewHelper.get("remoteSitesTable")){var a=this,r=new i({el:this.$(".remoteSitesTable"),scrollHeight:"120px",minimumRows:5,highlightRadioSelection:!0,columns:[{sTitle:"",mData:e.RS_NAME,sWidth:"5%",sClass:"center",mRender:function(i,n,s){return t.createDataRowRadioBox(e.PD_METRO_AVAIL_REMOTE_SITE,i)}},{sTitle:"Remote Site",mData:e.RS_NAME,sWidth:"50%"},{sTitle:"IP Address",mData:e.RS_REMOTE_ADDRESS,sWidth:"45%",mRender:function(e,t,i){var n="";return _.each(_.keys(e),function(t,i,s){n+=t+(null===e[t]?"":":"+e[t])+(i+1<s.length?", ":"")}),n}}]});this.subViewHelper.register("remoteSitesTable",r)}if(!this.subViewHelper.get("inCompatibleRemoteSitesTable")){var o=new i({el:this.$(".inCompatibleRemoteSitesTable"),scrollHeight:"130px",minimumRows:5,columns:[{sTitle:"Remote Site",mData:e.RS_NAME,sWidth:"25%"},{sTitle:"IP Address",mData:e.RS_REMOTE_ADDRESS,sWidth:"25%",mRender:function(e,t,i){var n="";return _.each(_.keys(e),function(t,i,s){n+=t+(null===e[t]?"":":"+e[t])+(i+1<s.length?", ":"")}),n}},{sTitle:"Metro Ready",mData:e.RS_METRO_READY,sWidth:"20%",mRender:function(e,t,i){return p({label:e?"Yes":"No",className:e?"n-compatible":"n-incompatible",showTooltip:!e})}},{sTitle:"Has Storage Container",mData:e.RS_VSTORE_INFO,sWidth:"10%",mRender:function(e,t,i){if(e&&e[a.metroAvailVStore]){var n=a.getIncompatibleContainerTooltip(e,i);return""===n?"Yes":S({label:"Yes",tooltip:n})}return T({data:"No"})}},{sTitle:"Latency",mData:e.RS_LATENCY,sWidth:"20%",mRender:function(e,t,i){return a.renderRemoteSiteLatency(e)}}]});this.subViewHelper.register("inCompatibleRemoteSitesTable",o)}this.subViewHelper.renderAll(),this.refreshTables(),this.isViewRendered=!0}else this._loadRemoteSites()},destroy:function(){this.subViewHelper.destroy(),this.undelegateModelEvents(),this.destroyTooltips(),n.prototype.destroy.apply(this,arguments)},refreshTables:function(){this.destroyTooltips(),this.$(".loading-msg-wrapper").hide();var e,t=this.getContainerMinimumRequiredMetroCapacity(),i=this.remoteSiteCollection.getCompatibleRemoteSites(this.metroAvailVStore,t),n=this.subViewHelper.get("remoteSitesTable");if(i.length){if(e=n.getSelectedDataId()){_.find(i,function(t){return e===t.getId()})||(e=null)}e=e||_.first(i).getId()}n.selectRow(e),n.updateDataSource(i.map(function(e){return e.toJSON({includeAttribute:!0})})),this.subViewHelper.get("inCompatibleRemoteSitesTable").updateDataSource(this.remoteSiteCollection.getNonCompatibleRemoteSites(this.metroAvailVStore,t).map(function(e){return e.toJSON()})),this.$(".info-tooltip").tooltip({placement:"top",trigger:"hover",html:!0}),this.$(".metro-tooltip").tooltip({title:function(){return d},placement:"top",trigger:"hover",html:!0}),this.subViewHelper.iterate("onResize")},renderRemoteSiteLatency:function(e){var t=e&&e<=l.RS_BAD_LATENCY_THRESHOLD,i=l.UNKNOWN_VALUE;return e&&(i=e/l.MICROS_PER_MILLI+" milliseconds RTT"),h({className:t?"n-compatible":"n-incompatible",latencyLabel:t?l.RS_LATENCY.GOOD:l.RS_LATENCY.BAD,threshold:l.RS_BAD_LATENCY_THRESHOLD/l.MICROS_PER_MILLI,latencyTooltip:i})},canEnablePageLink:function(){return!this.model.isNew()},onPageTransition:function(e){var t=this.$(".n-datatable-radio:checked");if(t&&t.length){var i=this.remoteSiteCollection.findModelById(t[0].value);this.model.setMetroAvailRemoteSite(i),e()}else this.getWizard().showHeaderError("Please select a compatible remote site.")},onPageCancel:function(){return!0},onRemoteSitesLoaded:function(){this.initialized=!0,this.isViewRendered?this.refreshTables():this.render()},onRemoteSitesError:function(e,t){this.isViewRendered?this.$(".loading-msg-wrapper").hide():this.$el.empty(),this.showError(r.processThrownError(t))},onRemoteSitesLoading:function(){this.$(".loading-msg-wrapper").show()},_loadRemoteSites:function(){this.remoteSiteCollection.fetch({data:{fullDetails:!0,metroCompatible:!0,remoteContainers:this.metroAvailVStore}})},destroyTooltips:function(){this.$(".info-tooltip").tooltip("destroy"),this.$(".metro-tooltip").tooltip("destroy")},getIncompatibleContainerTooltip:function(t,i){var n=t[this.metroAvailVStore],s=n[e.RS_VSTORE_IS_STRETCH_EMPTY],a=null===s||s?"":E({container:this.metroAvailVStore,remoteSite:i[e.RS_NAME]});n[e.RS_VSTORE_IS_PROTECTED]&&(a+=a?"<br>":"",a+=g({container:this.metroAvailVStore,remoteSite:i[e.RS_NAME]})),n[e.RS_VSTORE_METRO_PD]&&(a+=a?"<br>":"",a+=A({container:this.metroAvailVStore,remoteSite:i[e.RS_NAME],pdName:n[e.RS_VSTORE_METRO_PD]}));var r=this.getContainerMinimumRequiredMetroCapacity();return n[e.MAX_CAPACITY]<r&&(a+=a?"<br>":"",a+=m({container:this.metroAvailVStore,remoteSite:i[e.RS_NAME],rsMaxCapacity:o.storageFormat(n[e.MAX_CAPACITY]),maxCapacity:o.storageFormat(r)})),a},getContainerMinimumRequiredMetroCapacity:function(){return this.model.getMetroAvailVstore().getMinimumRequiredMetroCapacity()}})}),define("text!templates/wizards/pd/FailureHandlingPage.html",[],function(){return"<fieldset class=\"checkboxgroup\">\n  <p class=\"n-title\">\n    Select failure handling mode:\n  </p>\n  <ul>\n    <li>\n      <span class=\"disabled-witness-tooltip\" data-toggle=\"tooltip\"\n        data-original-title=\"<%= witnessTooltip%>\" >\n        <%= Components.radio({\n          id: 'witness', name: 'mode', checked: witness, value: 'Witness',\n          disabled: witnessReadOnly, classes: 'current-mode'\n        })%>\n        <label for=\"witness\">\n          Witness\n        </label>\n      </span>\n      <p>The Nutanix Metro Availability Witness will automatically decide\n        whether to failover in case of a site or network outage\n        <br><strong>Note:</strong> Witness is only supported for Metro clusters,\n        not for synchronous replication deployments</p>\n    </li>\n    <li>\n      <%= Components.radio({\n        id: 'automatic-resume', name: 'mode', checked: automatic,\n        disabled: automaticReadOnly, value: 'Automatic',\n        classes: 'current-mode'\n      })%>\n      <label for=\"automatic-resume\">\n        Automatic Resume\n      </label>\n      <p>Virtual Machines in a protected container will automatically resume\n        operation after the specified timeout. Requires manual intervention\n        in case of primary site outage</p>\n    </li>\n    <li>\n      <%= Components.radio({\n        id: 'manual', name: 'mode', checked: manual,\n        disabled: manualReadOnly, value: 'Manual',\n        classes: 'current-mode'\n      })%>\n      <label for=\"manual\">\n        Manual\n      </label>\n      <p>All resume or failover operations are manually driven by\n        Nutanix administrator</p>\n    </li>\n  </ul>\n</fieldset>\n"}),define("views/wizards/pd/FailureHandlingPage",["data/DataProperties","managers/ClusterManager","models/witnessregister/MAWitnessCollection","views/basecomponents/wizards/BaseWizardPage","utils/AppConstants","utils/AppUtil","utils/HypervisorUtil","text!templates/wizards/pd/FailureHandlingPage.html"],function(e,t,i,n,s,a,r,o){"use strict";return n.extend({events:{},name:"FailureHandlingPageView",model:null,template:_.template(o),initialized:!1,hasWitnessDetails:!1,render:function(){var n=this;if(a.addInLineDonutLoader(this.$el),this.isViewRendered)n._renderWithData();else{var s=$.Deferred(),o=s.promise(),l=t.getCurrentClusterUuid();if(r.hasESX(l)?o=(new i).fetch({success:function(t){if(t.length){var i=t.at(0);if(i.get(e.V2.CLUSTER_EXTERNAL_STATE_IP_ADDYS)&&i.get(e.V2.CLUSTER_EXTERNAL_STATE_IP_ADDYS).length)return void(n.hasWitnessDetails=!0)}n.getWizard().showHeaderWarning(n.i18n("configure_witness_msg"))},error:function(e,t){n.showHeaderErrorWithDetails(n.i18n("configure_witness_msg"),t.responseText),n.$el.empty()}}):s.resolve(!0),this.model.isNew())o.done(function(){n.initialized=!0,n._renderWithData()});else{var c=this.model.fetch({error:function(e,t){n.showHeaderErrorWithDetails("Error unable to retrieve protection domain.",t.responseText),n.$el.empty()}});$.when(o,c).done(function(){n.initialized=!0,n._renderWithData()})}}},_renderWithData:function(){var e=this.model.getMetroWitnessFailureHandling(),i=!0,n=!0,a=!0;this.model.getMetroAvailStatus()===s.PD_METRO_AVAIL_STATUS.DISABLED||this.model.isNew()?(i=!1,n=!1,a=!1):this.model.isNew()||(n=!1,a=!1);var o="";this.hasWitnessDetails||(i=!0,o=this.i18n("witness_not_supported"));var l=t.getCurrentClusterUuid();r.hasESX(l)&&(o=this.i18n("disabled_witness_tooltip")),this.$el.html(this.template(this.vtOptions({initialized:this.initialized,failureHandling:e,witness:e===s.PD_METRO_AVAIL_FAILURE_HANDLING.WITNESS||this.model.isNew()&&this.hasWitnessDetails,automatic:e===s.PD_METRO_AVAIL_FAILURE_HANDLING.AUTOMATIC||this.model.isNew()&&!this.hasWitnessDetails,manual:e===s.PD_METRO_AVAIL_FAILURE_HANDLING.MANUAL,witnessReadOnly:i,automaticReadOnly:n,manualReadOnly:a,witnessTooltip:o,pdEntityType:s.ENTITY_NAMES[s.ENTITY_METRO_AVAILABILITY_PD]}))),i&&this.$(".disabled-witness-tooltip").tooltip({placement:"right"}),this.initialized&&(this.isViewRendered=!0)},destroy:function(){n.prototype.destroy.apply(this,arguments)},onPageTransition:function(t){var i=this.$('.n-radio[name="mode"]:checked').val();if(this.model.isNew())this.model.setEditingAttribute(e.PD_METRO_AVAIL_FAILURE_HANDLING,i),t();else{var n=this.model.getMetroWitnessFailureHandling();if(i!==n){var a=this.model.get(e.PD_METRO_AVAIL);a[e.PD_METRO_AVAIL_FAILURE_HANDLING]=i;var r=this;this.model.metroAvailAction(s.ACTION_UPDATE_FAILURE).fail(function(){a[e.PD_METRO_AVAIL_FAILURE_HANDLING]=n,n===s.PD_METRO_AVAIL_FAILURE_HANDLING.AUTOMATIC?r.$("#automatic-resume").prop("checked",!0):n===s.PD_METRO_AVAIL_FAILURE_HANDLING.WITNESS?r.$("#witness").prop("checked",!0):r.$("#manual").prop("checked",!0)}).then(function(){t()})}else t()}},onPageCancel:function(){return!0}})}),define("text!templates/wizards/pd/ReviewPage.html",[],function(){return'<div class="review-div">\n\n  <div class="n-title">\n    <%= name %>\n  </div>\n\n  <div class="outer-div">\n    <div>\n      Storage Container Name:\n      <span class="n-value"><%= container.name %></span>\n    </div>\n    <div>\n      Storage Container Max Capacity:\n      <span class="n-value"><%= container.maxSize %></span>\n    </div>\n  </div>\n\n  <div class="outer-div outer-right-div">\n    <div>\n      Latency:\n      <span class="n-value"><%= remoteSite.latency %> milliseconds RTT</span>\n    </div>\n    <div>\n      Failure Handling:\n      <span class="n-value"> <%= timeoutLabel %></span>\n      <span class="timeout-tooltip n-tooltip-circle"\n            data-toggle="tooltip"\n            data-original-title="<%= timeoutTooltip %>">?</span>\n    </div>\n  </div>\n\n  <div class="separator-div"></div>\n\n  <div class="outer-div">\n    <div class="n-title">\n      Origin Site\n    </div>\n    <div class="inner-div">\n      <div class="n-title"><%= clusterName %> (Active)</div>\n    </div>\n  </div>\n\n  <div class="arrow-div">\n    <div class="right-arrow"></div>\n  </div>\n\n  <div class="outer-div">\n    <div class="n-title">\n      Target Site\n    </div>\n    <div class="inner-div">\n      <div class="n-title"><%= remoteSite.name %> (Standby)</div>\n      <div><%= remoteSite.ips %></div>\n    </div>\n  </div>\n\n</div>\n'}),define("views/wizards/pd/ReviewPage",["data/DataProperties","views/basecomponents/wizards/BaseWizardPage","utils/AppConstants","utils/StatsUtil","text!templates/wizards/pd/ReviewPage.html"],function(e,t,i,n,s){"use strict";var a=_.template("Create <%= pdEntityType %> protection domain '<%= pdName %>'?<br><br>This operation will <%= actionName.toLowerCase() %> <%= pdEntityType %> on storage container '<%= containerName %>' across '<%=primarySite%>' and '<%= secondarySite %>'.<br><br><p class=\"n-popup-waring\">WARNING: This operation will overwrite existing data on storage container '<%= containerName %>' at '<%= secondarySite %>'.</p>Do you want to continue? "),r=_.template("<% if (witness) { %>The Nutanix Witness will automatically decide whether to failover in case of site or network outage<% } else if (automatic) { %>Virtual Machines in a protected storage container will automatically resume operation after <%= timeout %> seconds timeout. Requires manual intervention in case of primary site outage<% } else {%>All resume or failover operations are manually driven by Nutanix administrator<% }%>");return t.extend({template:_.template(s),model:null,render:function(){var t=this.model.getMetroAvailVstore(),s=this.model.getMetroAvailRemoteSite(),a=this.model.getEditingAttribute(e.PD_METRO_AVAIL_FAILURE_HANDLING),o=s.get(e.RS_LATENCY)/i.MICROS_PER_MILLI,l=this.template({name:this.model.getEditingAttribute(e.PD_NAME),clusterName:this.getCurrentClusterName()||i.ENTITY_CLUSTER_NAME,clusterIP:this.getCurrentClusterModel().get(e.CLUSTER_EXTERNAL_IP_ADRESS),timeoutTooltip:r({witness:a===i.PD_METRO_AVAIL_FAILURE_HANDLING.WITNESS,automatic:a===i.PD_METRO_AVAIL_FAILURE_HANDLING.AUTOMATIC,timeout:this.model.getMetroMinTimeoutValue()}),timeoutLabel:i.FAILURE_HANDLING_DISPLAY_VALUES[a],container:{name:t.get(e.NAME),maxSize:n.storageFormat(t.getMaxCapacityLogical())},remoteSite:{name:s.get(e.RS_NAME),ips:s.getValue(e.RS_IP_ADDRESS),latency:o}});this.$el.html(l),this.$(".timeout-tooltip").tooltip({placement:"left",trigger:"hover",html:!1})},destroy:function(){this.$(".timeout-tooltip").tooltip("destroy"),t.prototype.destroy.apply(this,arguments)},canEnablePageLink:function(){return!this.model.isNew()},canTransitionPage:function(e){return e<0},getSaveButtonLabel:function(){return i.ACTION_NAMES[i.ACTION_CREATE]},onPageTransition:function(t){var n=this.model.getMetroAvailVstore(),s=this.model.getMetroAvailRemoteSite(),r=this.model.getEditingAttribute(e.PD_NAME),o=a({pdEntityType:i.ENTITY_NAMES[i.ENTITY_METRO_AVAILABILITY_PD],actionName:i.ACTION_NAMES[i.ACTION_ENABLE_METRO_AVAIL],pdName:r,primarySite:this.getCurrentClusterName()||i.ENTITY_CLUSTER_NAME,secondarySite:s.get(e.RS_NAME),containerName:n.get(e.NAME)});this._confirm(o,function(){var e=this;this.model.createMetroAvailPD(function(){t()},function(t){e.showError(t)})})},onPageCancel:function(){return!0},_confirm:function(e,t){$.nutanixConfirm({msg:e,yes:t,yesText:"Yes",noText:"No",context:this})}})}),define("views/wizards/pd/ProtectionDomainWizard",["views/basecomponents/wizards/WizardView","models/BaseCollection","models/dataprotection/ProtectionDomainModel","views/wizards/pd/name-page","views/wizards/pd/vms-page","views/wizards/pd/SchedulePage","views/wizards/pd/ContainersPage","views/wizards/pd/RemoteSitesPage","views/wizards/pd/FailureHandlingPage","views/wizards/pd/ReviewPage","managers/NavigationManager","managers/LicenseManager","data/DataProperties","data/DataURLConstants","utils/AppConstants"],function(e,t,i,n,s,a,r,o,l,c,u,d,h,p,T){"use strict";var E=t.extend({model:i,url:p.PROTECTION_DOMAIN}),S=_.template("Protection Domain (<%= pdType %>)"),g=i.extend({userInfoData:null,uiEditingMode:T.ENTITY_PROTECTION_DOMAIN,initialize:function(e,t){i.prototype.initialize(this,arguments),this.userInfoData={}},setEditingMode:function(e){this.uiEditingMode=e},setEditingAttribute:function(e,t){this.userInfoData[e]=t},getEditingAttribute:function(e){return this.userInfoData[e]},getEditingMode:function(){return this.uiEditingMode},setMetroAvailVstore:function(e){this.setEditingAttribute(h.PD_METRO_AVAIL_VSTORE,e)},getMetroAvailVstore:function(){return this.userInfoData[h.PD_METRO_AVAIL_VSTORE]},setMetroAvailRemoteSite:function(e){this.setEditingAttribute(h.PD_METRO_AVAIL_REMOTE_SITE,e)},getMetroAvailRemoteSite:function(){return this.userInfoData[h.PD_METRO_AVAIL_REMOTE_SITE]},getMetroStandbySiteName:function(){var e=this.get(h.PD_METRO_AVAIL);if(e)return e[h.PD_METRO_AVAIL_REMOTE_SITE];var t=this.getMetroAvailRemoteSite();return t?t.get(h.NAME):null},isMetroAvailPD:function(){return this.get(h.PD_METRO_AVAIL)||this.getEditingMode()===T.ENTITY_METRO_AVAILABILITY_PD},setMetroSchedule:function(e){this.userInfoData[h.PD_CRON_SCHEDULE]=e},getMetroSchedule:function(){return this.userInfoData[h.PD_CRON_SCHEDULE]},pdLookup:function(e,t){(new E).fetch(_.extend({data:{names:e}},t))},showLatencyNotification:function(e,t){t!==T.ACTION_DELETE&&i.prototype.showLatencyNotification.apply(this,arguments)},showSuccessNotification:function(e,t,n){t!==T.ACTION_DELETE&&i.prototype.showSuccessNotification.apply(this,arguments)},createMetroAvailPD:function(e,t){var i=this.userInfoData[h.PD_NAME],n=this.userInfoData[h.PD_METRO_AVAIL_VSTORE].get(h.NAME),s=this.userInfoData[h.PD_METRO_AVAIL_REMOTE_SITE].get(h.RS_NAME),a={};a[h.PD_METRO_AVAIL_VSTORE]=n,a[h.PD_METRO_AVAIL_REMOTE_SITE]=s,this.userInfoData[h.PD_METRO_AVAIL_FAILURE_HANDLING]&&(a[h.PD_METRO_AVAIL_FAILURE_HANDLING]=this.userInfoData[h.PD_METRO_AVAIL_FAILURE_HANDLING]);var r=this,o=e;this.getMetroSchedule()&&(o=function(){r.createMetroSchedule(e,t)}),this.createPD(i,function(e){r.enableMetroAvailability(a,o,function(e){r.actionMode=T.ACTION_DELETE,r.destroy(),t(e)})},function(e){t(e)})},createMetroSchedule:function(e,t){var i=this;this.getMetroSchedule().saveSchedule(e,function(e){i.actionMode=T.ACTION_DELETE,i.destroy(),t(e)})},getMetroTimeout:function(){return this.isNew()?this.getMetroMaxTimeoutValue():i.prototype.getMetroTimeout.apply(this,arguments)}});return e.extend({initialize:function(e){},show:function(t){var i=t[T.NAV_ACTION_TARGET_ID];if(t[T.NAV_ACTION]===T.ACTION_DELETE)this._deletePD(i);else{var u="Protection Domain",d=new g,h=[{id:"pd-name",title:"Name",klass:n,model:d}],p=t[T.NAV_ACTION_TARGET];d.setEditingMode(p),p===T.ENTITY_PROTECTION_DOMAIN||p===T.ENTITY_ASYNC_PD?(u=S({pdType:T.ENTITY_NAMES[p]}),h=[{id:"pd-name",title:"Name",klass:n,model:d},{id:"pd-vms",title:"Entities",klass:s,model:d},{id:"pd-schedule",title:"Schedule",klass:a,model:d}],t[T.NAV_ACTION]===T.ACTION_UPDATE&&h.shift(),t[T.NAV_ACTION]===T.ACTION_UPDATE_FS_PD_SCHEDULE&&(h=[{id:"pd-schedule",title:"Schedule",klass:a,model:d},{id:"pd-vms",title:"Entities",klass:s,model:d}])):p===T.ENTITY_METRO_AVAILABILITY_PD&&(u=S({pdType:T.ENTITY_NAMES[T.ENTITY_METRO_AVAILABILITY_PD]}),t[T.NAV_ACTION]===T.ACTION_UPDATE?h=[{id:"pd-schedule",title:"Schedule",klass:a,model:d},{id:"pd-failure-handling",title:"Failure Handling",klass:l,model:d}]:(d.isNew(!0),h=[{id:"pd-name",title:"Name",klass:n,model:d},{id:"pd-containers",title:"Storage Containers",klass:r,model:d},{id:"pd-remoteSites",title:"Remote Sites",klass:o,model:d},{id:"pd-failure-handling",title:"Failure Handling",klass:l,model:d},{id:"pd-schedule",title:"Schedule",klass:a,model:d},{id:"pd-review",title:"Review",klass:c,model:d}])),t[T.NAV_ACTION]!==T.ACTION_UPDATE&&t[T.NAV_ACTION]!==T.ACTION_UPDATE_FS_PD_SCHEDULE||(d.set({id:i,name:i}),u="Update "+u+": "+i),this.initializeWizard({title:u,wizardType:e.WIZARD_TYPES.LINEAR,pages:h}),e.prototype.show.apply(this,arguments),p===T.ENTITY_METRO_AVAILABILITY_PD&&d.isNew()&&this.$(".n-license-warning").is(":visible")&&this.$(".n-license-warning").one("remove",this.showMetroInfoMessage.bind(this))}},checkPrerequisites:function(e){if(e&&e.entity===T.ENTITY_METRO_AVAILABILITY_PD){var t=d.FEATURE_MAP.LICENSE_METRO_AVAIL;d.canUseFeat(t)||d.canUseFeat(t,null,!0)?e.action===T.ACTION_CREATE&&this.showMetroInfoMessage():this.showHeaderWarning(d.getPopupMessageTemplate(t))}},showMetroInfoMessage:function(){this.showHeaderInfo('<div class="metro-alert"><p>Protection domains are configured for Metro ​Availability or ​Synchronous ​Replication depending on the following:</p><p><b>Metro Availability:</b>The hypervisor is ESXi and the Metro ​Availability requirements for ​a single vSphere cluster across sites and vCenter HA are satisfied.</p><p><b>Synchronous Replication:</b>The hypervisor is either ESXi (when not set up for Metro Availability) and Hyper-V.</p></div>')},_deletePD:function(e){var t=this,n="Deleting Protection Domain '"+e+"' will also delete its snapshot(s). Do you want to proceed?";$.nutanixConfirm({msg:n,yes:function(){var n=new i;n.set(n.idAttribute,e,{silent:!0}),n.destroy({success:function(e,i){u.showDetailsSummary(),t.hide()}})},no:function(){t.hide()},yesText:"Yes",noText:"No"})},toggleLicenseWarning:function(e){e.stopPropagation();var t=d.FEATURE_MAP.LICENSE_DR_APPLICATION_CONSISTENT_SNAPSHOT;if($(e.target).attr("checked")){if(!d.canUseFeat(t)&&!d.canUseFeat(t,null,!0)){if($(".pvm-warning").length&&$(".n-modal-alert-header").is(":visible"))return;this.showHeaderWarning(d.getPopupMessageTemplate(t,"Application consistent snapshots are not allowed under the current license level."))}}else $(".pvm-warning").length||this.clearHeader()}})}),define("models/dataprotection/CloudRemoteSiteModel",["models/BaseModel","data/DataURLConstants","data/DataProperties","utils/AppConstants"],function(e,t,i,n){"use strict";var s=_.template("Remote site '<%= name %>' creation has been initiated successfully. This process can take a while.");return e.extend({urlRoot:t.REMOTE_SITE,entityType:n.ENTITY_REMOTE_SITE,name:"CloudRemoteSiteModel",cvmInputData:null,currentCloudType:null,currentCloudRegions:null,defaults:{name:null,vstoreNameMap:null,remoteIpPorts:null,maxBps:null,proxyEnabled:!1,bandwidthPolicyEnabled:!1,compressionEnabled:!0,sshEnabled:!1,capabilities:[n.RS_CAPABILITIES.BACKUP]},initialize:function(t,i){e.prototype.initialize.apply(this,arguments),this.set({vstoreNameMap:{},remoteIpPorts:{}}),this.cvmInputData={}},getURL:function(){
if(this.isNew()){return null!==this.getCloudCVMModel()?t.REMOTE_SITE:_.template(t.CLOUD_REMOTE_SITE)({cloudType:this.getCurrentCloudType()})}return t.REMOTE_SITE},setCurrentCloudType:function(e){this.currentCloudType=e},getCurrentCloudType:function(){return this.currentCloudType},setCloudRegions:function(e){this.currentCloudRegions=e},getCloudRegions:function(){return this.currentCloudRegions},toJSON:function(t){if(t&&t.display)return e.prototype.toJSON.apply(this,arguments);var s=this.getCloudCVMModel();if(null===s)return this._toDeployCVMRemoteSiteJSON();var a=e.prototype.toJSON.apply(this,arguments),r={};r[s.get(i.CVM_PUBLIC_IP)]=this.cvmInputData.sshTunnelPort?this.cvmInputData.sshTunnelPort:null,a.remoteIpPorts=r;var o=this.get(i.RS_MAX_BPS);return o&&(a[i.RS_MAX_BPS]=o*n.MBPS),a},showSuccessNotification:function(t,a,r){a===n.ACTION_CREATE?(this.hideLatencyNotification(t,a),this.showClientNotification(n.NOTIFY_SUCCESS,s({name:t.get(i.RS_NAME)}))):e.prototype.showSuccessNotification.apply(this,arguments)},setCredentialName:function(e){this.cvmInputData.credentialName=e},getCredentialName:function(){return this.cvmInputData.credentialName},setNewCloudCVM:function(e,t,n,s,a){this.cvmInputData[i.CVM_REGION]=e,this.cvmInputData.adminPassword=t,this.cvmInputData[i.CVM_SUBNETID]=n,this.cvmInputData.connectivityType=s,this.cvmInputData[i.CVM_VPCID]=a},setCloudCVMModel:function(e){this.cvmInputData.cloudCVMModel=e},getCloudCVMModel:function(){return this.cvmInputData.cloudCVMModel},setSSHTunnelPort:function(e){this.cvmInputData.sshTunnelPort=e},addVStore:function(e,t){this.get(i.RS_VSTORE_NAME_MAP)[e]=t},removeVStore:function(e){delete this.get(i.RS_VSTORE_NAME_MAP)[e]},getBandwidthPolicyConfigs:function(){var e=this.get(i.RS_BANDWIDTH_POLICY);return e?e[i.RS_BANDWIDTH_CONFIGS]:null},addBandwidthPolicyConfig:function(e){var t=this.get(i.RS_BANDWIDTH_POLICY);if(!t){t={policyName:this.get(i.NAME)?this.get(i.NAME)+"_policy":"policy"}}t[i.RS_BANDWIDTH_CONFIGS]||(t[i.RS_BANDWIDTH_CONFIGS]=[]),t[i.RS_BANDWIDTH_CONFIGS].push(e),this.set(i.RS_BANDWIDTH_POLICY,t)},updateBandwidthPolicyConfig:function(e,t){var n=this.get(i.RS_BANDWIDTH_POLICY);n&&(n[i.RS_BANDWIDTH_CONFIGS][e]=t),this.set(i.RS_BANDWIDTH_POLICY,n)},removeBandwidthPolicyConfig:function(e){var t=this.get(i.RS_BANDWIDTH_POLICY);t&&(delete t[i.RS_BANDWIDTH_CONFIGS][e],t[i.RS_BANDWIDTH_CONFIGS]=_.compact(t[i.RS_BANDWIDTH_CONFIGS])),this.set(i.RS_BANDWIDTH_POLICY,t)},getDefaultBandwidthLimit:function(){var e=this.get(i.RS_BANDWIDTH_POLICY);if(e){var t=e[i.RS_DEFAULT_BANDWIDTH_LIMIT];if(!isNaN(t))return t/n.MBPS}return null},setDefaultBandwidthLimit:function(e){var t=this.get(i.RS_BANDWIDTH_POLICY);if(!t){t={policyName:this.get(i.NAME)?this.get(i.NAME)+"_policy":"policy"}}t.defaultBandwidthLimit=e?e*n.MBPS:null,this.set(i.RS_BANDWIDTH_POLICY,t),this.dirty=!0},hasUserContent:function(){return null!==this.get(i.NAME)||_.size(this.cvmInputData)>0||_.size(this.get(i.RS_VSTORE_NAME_MAP))>0||_.size(this.get(i.RS_REMOTE_ADDRESS))>0},_toDeployCVMRemoteSiteJSON:function(){var e={};e.credentialName=this.getCredentialName(),e[i.CVM_REGION]=this.cvmInputData[i.CVM_REGION],e.localRemoteSiteName=this.get(i.NAME),e.connectivityType=this.cvmInputData.connectivityType,this.cvmInputData.adminPassword&&(e.adminPassword=this.cvmInputData.adminPassword),this.cvmInputData[i.CVM_SUBNETID]&&(e[i.CVM_SUBNETID]=this.cvmInputData[i.CVM_SUBNETID]),this.cvmInputData[i.CVM_VPCID]&&(e[i.CVM_VPCID]=this.cvmInputData[i.CVM_VPCID]);var t=this.get(i.RS_VSTORE_NAME_MAP);if(_.size(t)>0){var n=[],s=[];_.each(this.get(i.RS_VSTORE_NAME_MAP),function(e,t){n.push(t),s.push(e)}),n.length>0&&s.length>0&&(e.localContainerNames=n,e.remoteContainerNames=s)}return this.cvmInputData.sshTunnelPort&&(e.sshTunnelPort=this.cvmInputData.sshTunnelPort),_.each([i.RS_PROXY_ENABLED,i.RS_COMPRESSION_ENABLED,i.RS_MAX_BPS],function(t){e[t]=this.get(t)},this),e[i.RS_BANDWIDTH_POLICY_ENABLED]=this.get(i.RS_BANDWIDTH_POLICY_ENABLED),e[i.RS_BANDWIDTH_POLICY]=this.get(i.RS_BANDWIDTH_POLICY),e}})}),define("text!templates/wizards/remotesite/CloudPage.html",[],function(){return'<div data-ntnx-section class="cloud-page-wr">\n  <h5 class="data-ntnx-title">\n    Cloud Type\n  </h5>\n  <div data-ntnx-section="type-text" class="cloud-txt">\n    Choose the type of cloud that will act as the remote site.\n  </div>\n  <div data-ntnx-section class="cloud-options">\n    <div class="cloudGroup">\n      <div data-ntnx-form-inline class="control-wr">\n        <input id="useAws" type="radio"\n               class="useAws" name="cloud" value="aws">\n        <label data-ntnx-label for="useAws" class="cloud-label">AWS</label>\n      </div>\n      <div data-ntnx-form-inline class="control-wr">\n        <input id="useAzure" type="radio"\n               class="useAzure" name="cloud" value="azure" checked >\n        <label data-ntnx-label for="useAzure" class="cloud-label">Azure</label>\n      </div>\n    </div>\n  </div>\n\n</div>'}),define("views/wizards/remotesite/CloudPage",["views/basecomponents/wizards/BaseWizardPage","text!templates/wizards/remotesite/CloudPage.html"],function(e,t){"use strict";var i=_.template(t);return e.extend({render:function(){var e=i({});this.$el.html(e),this.applyNutanixInput()},canEnablePageLink:function(){return!1},canTransitionPage:function(e){return e>0},onPageTransition:function(e){this.model.setCurrentCloudType(this.$("input[name=cloud]:checked").val()),e()},onPageCancel:function(){return!0}})}),define("text!templates/wizards/remotesite/CredentialsPage.html",[],function(){return'<section data-ntnx-section>\n  <% if ( ! initialized ) { %>\n    <div class="no-data page-loading-message">\n      <span class="n-loading-text">Loading data </span>\n      <div class="donut-loader-blue"></div>\n    </div>\n  <% } else { %>\n    <div class="credential-div">\n      <button class="btn btn-default btnAction" actiontarget="cloud_credentials"\n              action="add" data-test="add_cloud_credentials_btn">\n        <% if (cloudType === \'aws\') { %>\n          Add New Key\n        <% } else { %>\n          Add New Credential\n        <% } %>\n      </button>\n      <div data-ntnx-section="type-text" class="n-title">\n        <%= title %>\n      </div>\n      <div>\n        <% if (cloudType === \'aws\') { %>\n          Choose from the list of configured AWS access keys,\n          or add new access keys.\n        <% } else { %>\n          Choose from the list of configured Azure credentials\n          or add a new Credential.\n        <% } %>\n\n      </div>\n      <div class="table-items credentialsTable">\n        \x3c!-- @view: Table Credentials --\x3e\n      </div>\n    </div>\n  <% } %>\n</section>'}),define("text!templates/wizards/remotesite/AddUpdateCredential.html",[],function(){return'<section data-ntnx-section>\n    <% if(isAWS) { %>\n    <form id="addUpdateCredentialDiv" class="form-horizontal">\n        <div class="control-group">\n            <label class="control-label">\n                NAME\n            </label>\n            <% if(isNewCredential) { %>\n            <div class="controls">\n                <input type="text" name ="name"\n                       value="<%- name %>">\n                <div class="n-input-validation-msg"></div>\n            </div>\n           <% } else { %>\n            <div class="controls">\n                <input type="text" name ="name"\n                       value="<%- name %>" disabled>\n            </div>\n            <% } %>\n        </div>\n        <div class="control-group">\n            <label class="control-label">\n                ACCESS KEY ID\n            </label>\n            <div class="controls">\n                <input type="text" name="accessKey"\n                       value="<%- accessKeyId  %>">\n                <div class="n-input-validation-msg"></div>\n            </div>\n        </div>\n        <div class="control-group">\n            <label class="control-label" for="secretAccessKey">\n                SECRET ACCESS KEY\n            </label>\n            <div class="controls">\n                <input type="password"  name="secretKey"\n                       id="secretAccessKey"\n                       value="<%- secretAccessKey %>">\n                <div class="n-input-validation-msg"></div>\n            </div>\n        </div>\n        <div class="controls">\n            <%= Components.checkbox({\n                name    : \'chkDefaultKey\',\n                value   : \'test\',\n                checked :  isDefault,\n                id      : \'chkDefaultKey\',\n                classes : \'inline\'\n            }) %>\n            <label for="chkDefaultKey" class="lbl-mark-default-key">Make this key\n                the default key</label>\n            <span class="n-tooltip-circle chk-mark-default">?</span>\n        </div>\n    </form>\n    <% } else { %>\n    <form id="addUpdateCredentialDiv" class="form-horizontal">\n        <div class="control-group">\n            <label class="control-label">\n                NAME\n            </label>\n            <% if(isNewCredential) { %>\n            <div class="controls">\n                <input type="text" name ="name"\n                       value="<%- name %>">\n                <div class="n-input-validation-msg"></div>\n            </div>\n            <% } else { %>\n            <div class="controls">\n                <input type="text" name ="name"\n                       value="<%- name %>" disabled>\n            </div>\n            <% } %>\n        </div>\n        <div class="control-group">\n            <label class="control-label">\n                SUBSCRIPTION ID\n            </label>\n            <div class="controls">\n                <input name="subscriptionID" type="text" id="subscriptionId"\n                       value="<%- subscriptionId  %>">\n                <div class="n-input-validation-msg"></div>\n            </div>\n        </div>\n        <div class="control-group">\n            <label class="control-label certificate" for="certificate">\n                <% if (isNewCredential)  {%>\n                CERTIFICATE\n                <% } else { %>\n                CERTIFICATE (upload new certificate to change the existing\n                certificate)\n                <% } %>\n            </label>\n            <div class="controls azure-certificate">\n                <input name="certificate" type="file" id="certificate"\n                      class="certificate-file" value="<%- certificate %>">\n                <div class="n-input-validation-msg"></div>\n            </div>\n        </div>\n        <div class="controls">\n            <%= Components.checkbox({\n                name    : \'chkDefaultKey\',\n                value   : \'test\',\n                checked :  isDefault,\n                id      : \'chkDefaultKey\',\n                classes : \'inline\'\n            }) %>\n            <label for="chkDefaultKey" class="lbl-mark-default-key">Make this key\n                the default key</label>\n            <span class="n-tooltip-circle chk-mark-default">?</span>\n        </div>\n    </form>\n    <% } %>\n</section>'}),define("views/wizards/remotesite/CredentialsPage",["components/Components","data/DataProperties","data/DataURLConstants","data/DataManager","models/BaseModel","models/BaseCollection","views/basecomponents/datatables/DataTableColumnProvider","views/basecomponents/datatables/DetailsTableView","views/basecomponents/wizards/BaseWizardPage","utils/SubViewHelper","utils/AppConstants","utils/VisualizationUtil","utils/AppUtil","text!templates/wizards/remotesite/CredentialsPage.html","text!templates/wizards/remotesite/AddUpdateCredential.html"],function(e,t,i,n,s,a,r,o,l,c,u,d,h,p,T){"use strict";var E={aws:{awsCredential:{accessKey:"",secretKey:""},name:"",useAsDefault:!1},azure:{azureCredential:{subscriptionID:"",secureFileID:""},name:"",useAsDefault:!1}},S=s.extend({idAttribute:t.NAME,nameAttribute:t.NAME,name:"CloudCredentialsModel",entityType:u.ENTITY_CLOUD_CREDENTIALS,getURL:function(e,t){var n="";switch(e){case u.ACTION_DELETE:case u.ACTION_UPDATE:n="/"+this.id;break;default:n=""}var s=this.getCurrentCloudType().toUpperCase();return _.template(i.CLOUD_CREDENTIALS)({cloudType:u.CLOUD_TYPES[s]})+n},setCurrentCloudType:function(e){S.prototype.currentCloudType=e},getCurrentCloudType:function(){return this.currentCloudType}}),g=a.extend({model:S,url:_.template(i.CLOUD_CREDENTIALS)({cloudType:u.CLOUD_TYPES.AWS}),name:"CloudCredentialsCollection",defaultCredentials:null,getDefaultCredentials:function(){if(this.defaultCredentials)return this.defaultCredentials;var e=_.find(this.models,function(e){return e.get(t.CLOUD_KEY_USE_AS_DEFAULT)});return e||(e=_.first(this.models)),e?e.get(t.NAME):null},addCredentials:function(e){this.defaultCredentials=e.get(t.NAME),this.add(e)},removeCredentials:function(e){e.get(t.NAME)===this.defaultCredentials&&(this.defaultCredentials=null)}}),A=S.extend({idParserFunc:function(){return"_new_"},toJSON:function(e){var i=S.prototype.toJSON.apply(this,arguments);return e&&e.includeAttribute&&(i[t.FOR_EDIT]=!0),i},clear:function(){S.prototype.clear.apply(this,arguments),this.set(E[this.getCurrentCloudType()])},isNew:function(){return!0},setCloudType:function(e){this.setCurrentCloudType(e),this.set(E[e])}});return l.extend({name:"CredentialsPage",template:_.template(p),initialized:!1,cloudCredentialsCollection:null,inEditMode:!1,editModel:null,subViewHelper:null,isAddEditMode:!1,isNewCredential:!1,currModelCredentialID:null,modelEvents:{"reset  cloudCredentialsCollection":"credentialsLoaded","remove cloudCredentialsCollection":"updateTable","add    cloudCredentialsCollection":"updateTable","error  cloudCredentialsCollection":"credentialsLoadError","sync   editModel":"credentialsCreated"},events:{"click .btnAction":"onClickLinkAction","click .btnItemAction":"onClickLinkAction"},initialize:function(e){l.prototype.initialize.apply(this,arguments),this.subViewHelper=new c,this.cloudCredentialsCollection=new g,this.editModel=new A,this.delegateModelEvents()},destroy:function(){l.prototype.destroy.apply(this,arguments),this.subViewHelper.destroy(),this("#rs-credential .chk-mark-default").tooltip("destroy")},render:function(){if(!this.isViewRendered){var e=this.model.getCurrentCloudType();e.toUpperCase();this.editModel.setCloudType(e),this.cloudCredentialsCollection.setURL(_.template(i.CLOUD_CREDENTIALS)({cloudType:e}));var n=this.template({title:u.CLOUD_TITLE[e],cloudType:e,initialized:this.initialized});if(this.$el.html(n),this.initialized){if(!this.subViewHelper.get("credentialsTable")){var s=new o({el:this.$(".credentialsTable"),scrollHeight:"200px",minimumRows:7,highlightRadioSelection:!0,columns:[{sTitle:"",mData:t.NAME,sWidth:"5%",sClass:"center",mRender:function(e,t,i){return r.createDataRowRadioBox("Credentials",e)}},{sTitle:"Name",mData:t.NAME,sWidth:"20%",sClass:"name",mRender:function(e,i,n){var s=e;return n[t.CLOUD_KEY_USE_AS_DEFAULT]&&(s+='<span class="n-default-credential">(Default)</span>'),s}},{sTitle:u.ACCESS_KEY_HEADER[e],mData:t.CLOUD_ACCESS_KEY[e],sWidth:"25%",sClass:t.ACCESS_KEY[e],mRender:function(e,t,i){return e}},{sTitle:u.SECRET_KEY_HEADER[e],mData:function(){return"**********************************************"},sWidth:"25%",mRender:function(e,t,i){return e}},{sTitle:"",mData:t.ID,sWidth:"25%",sClass:"right",mRender:function(i,n,s){var a={};return a[u.ACTION_UPDATE]=d.UPDATE,a[u.ACTION_DELETE]=d.DELETE,d.renderItemActions(s[t.CLOUD_CREDENTIAL_ID],i,s[t.CLOUD_CREDENTIAL[e]][t.ACCESS_KEY[e]],a)}}]});this.subViewHelper.register("credentialsTable",s),this.subViewHelper.render("credentialsTable")}this.updateTable(),this.isViewRendered=!0}else this.cloudCredentialsCollection.fetch()}},canEnablePageLink:function(){return this.initialized},canTransitionPage:function(e){return e>0},onPageTransition:function(e){if(this.isAddEditMode)this._createCredentials();else{var t=this.$(".credentialsTable"),i=t.find(".n-datatable-radio:checked");i&&i.length?(this.model.setCredentialName(i[0].value),e()):this.showError(this.i18n("select_credential_error"))}},onPageCancel:function(){return!this.isAddEditMode||(this._hideAddUpdateCredentialForm(),this.cloudCredentialsCollection.remove(this.editModel),!1)},confirmHide:function(e){this.model.hasUserContent()?$.nutanixConfirm({msg:"Remote site content has not been saved. Are you sure you want to exit?",yes:e,yesText:"Yes",noText:"No"}):e()},onClickLinkAction:function(e){var t=$(e.currentTarget),i={action:t.attr(u.NAV_ACTION),actionTargetId:t.attr(u.NAV_ACTION_TARGET_ID),actionTargetName:t.attr(u.NAV_ACTION_TARGET_NAME)};i.action===u.ACTION_ADD?(this.isNewCredential=!0,this.cloudCredentialsCollection.add(this.editModel),this._showAddUpdateCredentialForm()):i.action===u.ACTION_CREATE?this._createCredentials():"Cancel"===i.action?this.cloudCredentialsCollection.remove(this.editModel):i.action===u.ACTION_DELETE?this._confirm("Delete credential '"+i.actionTargetName+"'?",function(){this._deleteCredentials(i.actionTargetId)}):i.action===u.ACTION_UPDATE&&(this.isNewCredential=!1,this._showAddUpdateCredentialForm(t))},updateTable:function(){this.subViewHelper.get("credentialsTable").updateDataSource(this.cloudCredentialsCollection);var e=this.cloudCredentialsCollection.getDefaultCredentials();if(e){var t='[value="'+e+'"]';this.$(".n-datatable-radio"+t).attr("checked",!0)}},credentialsLoaded:function(){this.initialized=!0,this.isViewRendered?this.updateTable():this.render()},credentialsCreated:function(e,t){this.editModel.clear(),this.cloudCredentialsCollection.remove(this.editModel,{silent:!0});var i=new S(t);i.setCurrentCloudType(this.model.getCurrentCloudType()),this.cloudCredentialsCollection.addCredentials(i)},credentialsLoadError:function(e,t){this.credentialsLoaded(),this.showHeaderErrorWithDetails("Unable to retrieve access keys.",t.responseText)},_deleteCredentials:function(e){var t=this.cloudCredentialsCollection.findModelById(e);if(t){var i=this;t.destroy({success:function(){i.cloudCredentialsCollection.removeCredentials(t)},wait:!0})}},_createAzureCredentials:function(){var e=this.$("#addUpdateCredentialDiv input[name=subscriptionID]").val().trim(),s=this.$("#addUpdateCredentialDiv input[name=certificate]").get(0),a=this.$("#addUpdateCredentialDiv #chkDefaultKey").prop("checked");if(!e)return void this.showError(this.i18n("enter_subscription_id_error"));var r=this,o="",l={};if(this.isNewCredential){if(!(o=this.$("#addUpdateCredentialDiv input[name=name]").val().trim()))return void this.showError(this.i18n("enter_name_error"));if(!s.files.length)return void this.showError(this.i18ns("choose_certificate_file_error"));h.uploadFile(this.$("input[name=certificate]"),n.getFormattedURL(i.AZURE_CERT_UPLOAD),{success:function(i){l[t.ACCESS_KEY[u.CLOUD_TYPES.AZURE]]=e,l[t.SECURE_FILE_ID[u.CLOUD_TYPES.AZURE]]=i.value,r.editModel.set(t.NAME,o),r.editModel.set(t.CLOUD_KEY_USE_AS_DEFAULT,a),r.editModel.set(t.CLOUD_CREDENTIAL[u.CLOUD_TYPES.AZURE],l),r.editModel.save(null,{success:function(e,t){r._setDefaultCredentialOnSuccess(e),r._hideAddUpdateCredentialForm(),r.credentialsCreated(e,t)},error:function(e,t){r.showHeaderErrorWithDetails(t.responseText)}})},error:function(e){r.showHeaderErrorWithDetails(e)}})}else{var c=this.cloudCredentialsCollection.findModelById(this.currModelCredentialID);o=c.get(t.NAME),s.files.length?h.uploadFile(this.$("input[name=certificate]"),n.getFormattedURL(i.AZURE_CERT_UPLOAD),{success:function(i){l[t.ACCESS_KEY[u.CLOUD_TYPES.AZURE]]=e,l[t.SECURE_FILE_ID[u.CLOUD_TYPES.AZURE]]=i.value,c.set(t.NAME,o),c.set(t.CLOUD_KEY_USE_AS_DEFAULT,a),c.set(t.CLOUD_CREDENTIAL[u.CLOUD_TYPES.AZURE],l),c.save(null,{success:function(e,t){r._setDefaultCredentialOnSuccess(e),r._hideAddUpdateCredentialForm(),r.updateTable()},error:function(e,t){r.showHeaderErrorWithDetails(t.responseText)}})},error:function(e){r.showHeaderErrorWithDetails(e)}}):(l[t.ACCESS_KEY[u.CLOUD_TYPES.AZURE]]=e,c.set(t.NAME,o),c.set(t.CLOUD_KEY_USE_AS_DEFAULT,a),c.set(t.CLOUD_CREDENTIAL[u.CLOUD_TYPES.AZURE],l),c.save(null,{success:function(e,t){r._setDefaultCredentialOnSuccess(e),r._hideAddUpdateCredentialForm(),r.updateTable()},error:function(e,t){r.showHeaderErrorWithDetails(t.responseText)}}))}},_createCredentials:function(){if(this.model.getCurrentCloudType()===u.CLOUD_TYPES.AZURE)return void this._createAzureCredentials();var e=this.model.getCurrentCloudType(),i=this.$("#addUpdateCredentialDiv input[name=accessKey]").val().trim(),n=this.$("#addUpdateCredentialDiv input[name=secretKey]").val().trim(),s=this.$("#addUpdateCredentialDiv #chkDefaultKey").prop("checked"),a={};if(a[t.ACCESS_KEY[u.CLOUD_TYPES.AWS]]=i,a[t.CLOUD_SECRET_KEY]=n,!i)return void this.showError(this.i18n("enter_access_key_error"));if(!n)return void this.showError(this.i18n("enter_secret_access_key_error"));var r=this;if(this.isNewCredential){var o=this.$("#addUpdateCredentialDiv input[name=name]").val().trim();if(!o)return void this.showError(this.i18n("enter_name_error"));this.editModel.set(t.CLOUD_CREDENTIAL[u.CLOUD_TYPES.AWS],a),this.editModel.set(t.NAME,o),this.editModel.set(t.CLOUD_KEY_USE_AS_DEFAULT,s),this.editModel.save(null,{success:function(e,t){r._setDefaultCredentialOnSuccess(e),r._hideAddUpdateCredentialForm(),r.credentialsCreated(e,t)},error:function(e,t){r.showHeaderErrorWithDetails("Error creating access keys. ",t.responseText)}})}else{var l=this.cloudCredentialsCollection.findModelById(this.currModelCredentialID);u.DEFAULT_DUMMY_VALUES.SECRET_ACCESS_KEY===n?a[t.CLOUD_SECRET_KEY]="":a[t.CLOUD_SECRET_KEY]=n,l.set(t.CLOUD_CREDENTIAL[e],a),l.set(t.CLOUD_KEY_USE_AS_DEFAULT,s),l.save(null,{success:function(e,t){r._setDefaultCredentialOnSuccess(e),r._hideAddUpdateCredentialForm(),r.updateTable()},error:function(e,t){r.showHeaderErrorWithDetails(t.responseText)}})}},_setDefaultCredentialOnSuccess:function(e){this.cloudCredentialsCollection.defaultCredentials=e.get(t.NAME),e.get(t.CLOUD_KEY_USE_AS_DEFAULT)&&_.map(this.cloudCredentialsCollection.toArray(),function(i){i.id!==e.id&&i.set(t.CLOUD_KEY_USE_AS_DEFAULT,!1)})},_confirm:function(e,t,i){$.nutanixConfirm({msg:e,yes:t,no:i,yesText:"Yes",noText:"No",context:this})},_showAddUpdateCredentialForm:function(i){this.clearHeader(),this.isAddEditMode=!0;var n=this.$el.closest("#wizardPopup"),s=this.model.getCurrentCloudType(),a=s===u.CLOUD_TYPES.AWS,r=null,o="",l="",c="";if(i&&i.length){var d=i.closest("tr"),h=d.find("a").attr(u.NAV_ACTION_TARGET_ID);this.currModelCredentialID=h,r=this.cloudCredentialsCollection.findModelById(h),c=r.get(t.NAME),a?o=r.get([t.CLOUD_CREDENTIAL[s]])[t.ACCESS_KEY[s]]:l=r.get([t.CLOUD_CREDENTIAL[s]])[t.ACCESS_KEY[s]]}else this.currModelCredentialID=null;var p=_.template(T,{Components:e,isAWS:a,name:c,accessKeyId:o,secretAccessKey:this.isNewCredential?"":u.DEFAULT_DUMMY_VALUES.SECRET_ACCESS_KEY,subscriptionId:l,certificate:u.DEFAULT_DUMMY_VALUES.CERTIFICATE_FILE_VALUE,isNewCredential:this.isNewCredential,isDefault:r&&r.get([t.CLOUD_KEY_USE_AS_DEFAULT])||!1});n.find(".btnNext").hide(),n.find(".btnSave").show(),n.find("#rs-credential > .credential-div").hide(),n.find("#rs-credential").append(p),n.find("#rs-credential .chk-mark-default").tooltip("destroy").tooltip({title:this.i18n("mark_as_default"),placement:"right",trigger:"hover",html:!1})},_hideAddUpdateCredentialForm:function(){var e=this.$el.closest("#wizardPopup");e.find(".btnNext").show(),e.find(".btnSave").hide(),e.find("#rs-credential > .credential-div").show(),e.find("#addUpdateCredentialDiv").remove(),this.isAddEditMode=!1}})}),define("text!templates/wizards/remotesite/CVMSettings.html",[],function(){return'<div class="settings-div">\n  <label class="control-label middle-align-label">Region</label>\n  <select class="new-cvm-region">\n    <% _.each(region, function(value, key ) { %>\n    <option value="<%= key %>"><%= value %></option>\n    <% }) %>\n  </select>\n</div>\n\n<div class="settings-div">\n  <label class="control-label">Connectivity</label>\n  <div class="control-div">\n    <div class="control-group">\n      <span class="radio-control">\n        <label for="r_wizardPopup_rs_EC2_sshTunnel_remove" class="n-label">\n          <input type="radio" action="remove" actionTarget="sshTunnel"\n                 id="r_wizardPopup_rs_EC2_sshTunnel_remove" name="platform"\n                 value="vpn" checked>\n                  <% if (cloud === \'aws\') { %>\n                    VPN/Direct-connect\n                  <%  } else { %>\n                    VPN/Express-route\n                  <% } %>\n        </label>\n      </span>\n      <span class="radio-control">\n        <label for="r_wizardPopup_rs_EC2_sshTunnel_add" class="n-label">\n          <input type="radio" action="add" actionTarget="sshTunnel"\n                 id="r_wizardPopup_rs_EC2_sshTunnel_add" name="platform"\n                 value="ssh-tunnel">\n          Create SSH Tunnel (not recommended)\n        </label>\n        <span class="nutanixMoreInfo cvm-tooltip"\n              data-tooltip-container="body"\n              data-tooltip-title="<%= sshTunnelTooltip %>"></span>\n        </span>\n      </span>\n    </div>\n    <div class="vpc platform-div">\n      <div class="control-group subnet-div">\n        <% if (cloud === \'azure\') { %>\n          <label class="control-label vpn-label">Virtual Network</label>\n          <div class="vpn-wr">\n            <div class="vpn-list">\n              <select class="vpn-op" data-class="overflowing">\n                <option value="">\n                  &nbsp;\n                </option>\n              </select>\n            </div>\n          </div>\n        <% } %>\n        <label class="control-label vpc-label">Subnet</label>\n        <label class="control-label classic-label">Subnet (Optional)</label>\n        <div class="cvm-subnet-div">\n          <div class="vpc-subnets">\n            <select class="cvm-subnet" data-class="overflowing">\n              <option value="">\n                &nbsp;\n              </option>\n            </select>\n          </div>\n          <div class="vpc-info" style="display: none">\n            <span class="vpn-state-warning" style="display: none">\n            WARNING: Subnet VPN is in a disconnected state\n            </span>\n          </div>\n          <div class="classic-subnets" style="display: none">\n            <select class="cvm-subnet" data-class="overflowing">\n              <option value="">\n                &nbsp;\n              </option>\n            </select>\n          </div>\n        </div>\n        <div class="platform-info vpc-info">\n          Ensure that you have configured your VPN to allow connectivity\n          with the CVM or cluster.\n        </div>\n        <div class="platform-info classic-info" style="display: none">\n          Ensure that your cluster is reachable by configuring a cluster\n          external IP address and you allow outbound SSH connections.\n        </div>\n      </div>\n      <div class="control-group">\n        <label class="control-label vpc-label">\n          Reset Admin Password (optional)\n          <span class="nutanixMoreInfo cvm-tooltip"\n                data-tooltip-container="body"\n                data-tooltip-title="If needed, create a new administrator\n                  password for the remote Controller VM&#39;s nutanix user.">\n          </span>\n        </label>\n        <label class="control-label classic-label" style="display:none">\n          Set up an Admin Password\n          <span class="nutanixMoreInfo cvm-tooltip"\n                data-tooltip-container="body"\n                data-tooltip-title="Create a new administrator password for the\n                  remote Controller VM&#39;s nutanix user. This field is\n                  required.">\n          </span>\n        </label>\n        <div class="controls">\n          <input type="password" autocomplete="off"\n            class="inputPassword admin-pwd" placeholder="Password">\n        </div>\n        <div class="controls">\n          <input type="password" autocomplete="off"\n              class="inputPassword confirm-admin-pwd"\n              placeholder="Confirm Password">\n        </div>\n        <div class="platform-info password-info" style="display:none">\n          For security reasons, the Administrator password must\n          be changed from its default value.\n        </div>\n      </div>\n\n      <div class="n-loading">\n        <img src="app/assets/images/spinners/loading.gif"\n             width=16px height=16px />&nbsp;Loading Subnets...\n      </div>\n    </div>\n  </div>\n</div>'}),define("views/wizards/remotesite/CVMSettings",["data/DataProperties","views/basecomponents/BaseSubView","utils/AppConstants","text!templates/wizards/remotesite/CVMSettings.html"],function(e,t,i,n){"use strict";var s={vpn:[".vpc-subnets",".vpc-info",".vpc-label"],"ssh-tunnel":[".classic-subnets",".classic-info",".classic-label",".password-info"]},a=_.template('<select class="<%= className %>" data-class="overflowing"><% if (subnets.length === 0) { %><option value="">No Subnet found</option><% } %><% if (addBlank) { %><option value="">(none)</option><% } %><% _.each(subnets, function(subnet) { %><option value="<%=subnet.get(subnet.idAttribute)%>"><%= subnet.getFormattedValue() %></option><% }) %></select>'),r=_.template('<select class="<%= className %>" data-class="overflowing"><% if (vpns.length === 0) { %><option value="">No Virtual Network</option><% } %><% if (addBlank) { %><option value="">(none)</option><% } %><% _.each(vpns, function(vpn) { %><option value="<%= vpn %>"><%= vpn %></option><% }) %></select>');return t.extend({template:_.template(n),subnetCollection:null,events:{"click  input[name=platform]":"onClickLinkAction","change .new-cvm-region":"onRegionChanged","click  input[type=text]":"clearBaseHeader","change .cvm-vpc-subnet":"onVPCSubnetChange","change .vpn-op":"refreshVpnSubnetIds"},initialize:function(e){t.prototype.initialize.apply(this,arguments),this.subnetCollection=e.subnetCollection},render:function(){var e=this.template({region:this.model.getCloudRegions(),sshTunnelTooltip:i.RS_SSH_TUNNEL_WARNING_MESSAGE,cloud:this.model.getCurrentCloudType()});this.$el.html(e),this.applyNutanixInput({types:["radio","select"]}),this.$(".nutanixMoreInfo").nutanixMoreInfo({parseDataAttrs:!0}),this.refreshView(),this.isViewRendered=!0},destroy:function(){this.$(".nutanixMoreInfo").nutanixMoreInfo("destroy"),t.prototype.destroy.apply(this,arguments)},refreshView:function(){this._loadSubnets();var e=this.$("input[name=platform]:checked");e=e||"vpn",this.$("input[value="+e.val()+"]").trigger("click")},validateForm:function(){if(this.isViewVisible()){var t=this.$(".new-cvm-region option:selected").val();if(!t)return this.showError("Please select a region."),!1;var n=this.$("input[name=platform]:checked").val(),s=null,a=null,r=null,o=$(".admin-pwd").val().trim(),l=$(".confirm-admin-pwd").val().trim();if(o!==l)return this.showError("Password doesn't match."),!1;if(r=this.$(".cvm-vpn").val(),"vpn"===n){if(!r&&this.model.getCurrentCloudType()===i.CLOUD_TYPES.AZURE)return this.showError("Please select a Virtual Network."),!1;if(!(s=this.$(".cvm-vpc-subnet option:selected").val()))return this.showError("Please enter a subnet Id."),!1;a=this.subnetCollection.findModelById(s).get(e.CVM_SUBNETID)}else if(s=this.$(".cvm-classic-subnet option:selected").val(),a=s?this.subnetCollection.findModelById(s).get(e.CVM_SUBNETID):"",_.isEmpty(a)&&(a=null),_.isEmpty(o)||_.isEmpty(l))return this.showError("Please enter a password."),!1;return this.model.setNewCloudCVM(t,o,a,n,r),!0}return!0},getValidationWarning:function(){if(this.isViewVisible()){if("vpn"!==this.$("input[name=platform]:checked").val())return i.RS_SSH_TUNNEL_WARNING_MESSAGE;var e=this.$(".cvm-vpc-subnet option:selected").val()
;if(this.subnetCollection.findModelById(e).isVPNImpaired())return"The selected subnet VPN state is disconnected. Replication may not work until VPN connectivity is restored.<br />*Please ignore this message if using direct connect."}return null},showModelError:function(e,i){this._hideLoading(),this._refreshSubnetIds(),this.isViewVisible()&&t.prototype.showModelError.apply(this,arguments)},onClickLinkAction:function(e){"vpn"===$(e.currentTarget).val()?(_.each(s["ssh-tunnel"],function(e){this.$(e).hide()},this),_.each(s.vpn,function(e){this.$(e).show()},this)):(_.each(s.vpn,function(e){this.$(e).hide()},this),_.each(s["ssh-tunnel"],function(e){this.$(e).show()},this)),this._refreshSubnetIds(),t.prototype.onClickLinkAction.apply(this,arguments)},onRegionChanged:function(e){var t=$(e.currentTarget);this.subnetCollection.stopFetch(),this.subnetCollection.setRegion(t.val()),this._showLoading(),this.subnetCollection.fetch()},onDataLoaded:function(){this._hideLoading(),this._refreshSubnetIds()},onVPCSubnetChange:function(e){this._showVNPWarning($(e.currentTarget).val())},_loadSubnets:function(){var e=this.$(".new-cvm-region option:selected").val();this.subnetCollection.setRegion(e||_.first(_.keys(i.CLOUD_REGIONS[this.model.getCurrentCloudType()]))),this.subnetCollection.isSameFetchCall()&&this.subnetCollection.getState()===i.STATE_SUCCESS?this.isViewRendered||this._refreshSubnetIds():(this._showLoading(),this.subnetCollection.fetch())},_renderSubnets:function(e){var t=this.model.getCurrentCloudType()===i.CLOUD_TYPES.AWS;this.$(".vpc-subnets").html(a({addBlank:!1,className:"cvm-vpc-subnet",subnets:this.subnetCollection.getVPNSubnets(e)})),this.$(".classic-subnets").html(a({addBlank:t,className:"cvm-classic-subnet",subnets:t?this.subnetCollection.getClassicSubnets():this.subnetCollection.getVPNSubnets(e)})),this.applyNutanixInput({types:["select"]})},_refreshSubnetIds:function(){var e=this.model.getCurrentCloudType()===i.CLOUD_TYPES.AZURE?"":void 0;this.model.getCurrentCloudType()===i.CLOUD_TYPES.AZURE&&(this.$(".vpn-list").html(r({addBlank:"ssh-tunnel"===this.$("input[name=platform]:checked").val(),className:"cvm-vpn vpn-op",vpns:this.subnetCollection.getVPNs()})),e=this.$(".vpn-op").val()),this._renderSubnets(e),this._showVNPWarning()},refreshVpnSubnetIds:function(e){var t=$(e.target).val();this._renderSubnets(t)},_showVNPWarning:function(e){var t=e||this.$(".cvm-vpc-subnet option:selected").val(),i=this.subnetCollection.findModelById(t);i&&i.isVPNImpaired()?this.$(".vpn-state-warning").show():this.$(".vpn-state-warning").hide()},_showLoading:function(){this.$(".n-loading").show()},_hideLoading:function(){this.$(".n-loading").hide()}})}),define("text!templates/wizards/remotesite/ContainerMappings.html",[],function(){return'<% if ( ! initialized ) { %>\n<div class="no-data">\n  <img src="app/assets/images/spinners/loading.gif"\n       width="16" height="16" />&nbsp;Loading...\n</div>\n<% } else { %>\n<div class="settings-div">\n  <label class="control-label">VStore Name Mappings</label>\n  <div class="control-div n-form-advanced-settings">\n    <div class="advanced-settings-div vstore-div">\n      \x3c!-- Vstores table--\x3e\n      <div class="control-group">\n        <% if (vstores && (vstores.size() > 0) ) { %>\n          <div class="controls containerMap">\n\n            \x3c!-- Header for the container map--\x3e\n            <li class="ctrMapHeader">\n              <div class="ctrSourceLabel">\n                Source\n              </div>\n              <div class="ctrDestinationLabel">\n                Destination\n              </div>\n            </li>\n\n            \x3c!-- Container map entries--\x3e\n            <% _.each(vstoreNameMap, function(destination, src) { %>\n              <li class="ctrMapEntry">\n                <input type="text" class="ctrSource" disabled\n                       value=\'<%= src %>\'>\n                <input type="text" class="destination" disabled\n                       value=\'<%= destination %>\'>\n                <i data-ctr=\'<%= src %>\' data-icon="v"\n                   aria-hidden="true"\n                   class="btnDeleteVS"></i>\n              </li>\n            <% }) %>\n\n            \x3c!-- Add container map entry--\x3e\n            <% if ( unmappedVstores.length > 0 ) { %>\n              <li class="ctrMapEntry">\n                <select class="ctrSource ctrAddSource" data-class="overflowing">\n                  <% if (selectedValue === \'\') { %>\n                  \x3c!-- Add a blank entry if more than one entry--\x3e\n                    <option value="">Select a VStore</option>\n                  <% } %>\n                  <% _.each(unmappedVstores, function(vsNew) { %>\n                  <option id="<%=vsNew.get(\'id\')%>"\n                          value="<%= vsNew.get(\'name\') %>">\n                    <%= vsNew.get(\'name\') %>\n                  </option>\n                  <% }) %>\n                </select>\n                <input type="text" class="destination ctrAddDestination"\n                       value=\'<%= selectedValue %>\'>\n                <a class="btnCreate btn btnAddVS">Add</a>\n              </li>\n              <div class="row-description">\n                <%= i18n(\'unique_mapping_msg\') %>\n              </div>\n            <% } %>\n          </div>\n        <% } else { %>\n          <div class="controls">\n            Unable to fetch vStores mapping details.\n          </div>\n        <% } %>\n      </div>\n    </div>\n  </div>\n</div>\n<% } %>'}),define("views/wizards/remotesite/ContainerMappings",["data/DataProperties","models/storage/VStoreCollection","views/basecomponents/BaseSubView","text!templates/wizards/remotesite/ContainerMappings.html"],function(e,t,i,n){"use strict";return i.extend({model:null,initialized:!1,name:"ContainerMappings",events:{"click  .btnAddVS":"onAddVStore","click  .btnDeleteVS":"onDeleteVStore","change .ctrAddSource":"onCtrSourceChange"},initialize:function(e){i.prototype.initialize.apply(this,arguments),_.bindAll(this,"_scrollToView")},render:function(){var t=this.model.get(e.RS_VSTORE_NAME_MAP),i=[];null===this.model.getCloudCVMModel()&&_.isEmpty(t),this.initialized&&this.vstores&&this.vstores.each(function(n){t[n.get(e.NAME)]||i.push(n)});var s="",a=this.model.get(e.RS_VSTORE_NAME_MAP);this.initialized&&_.size(a)<=0&&1===i.length&&(s=i[0].get(e.NAME));var r=_.template(n,this.vtOptions({vstoreNameMap:a,vstores:this.vstores,unmappedVstores:i,initialized:this.initialized,selectedValue:s}));this.$el.html(r),this.applyNutanixInput({types:["select"]}),this.initialized||this._getVStores()},validateForm:function(){return!this._validateVStoreMap()||!_.isEmpty(this.model.get(e.RS_VSTORE_NAME_MAP))||(this.showError("Please select a VStore Mapping."),!1)},onAddVStore:function(e){var t=this.$(".ctrAddSource").val().trim(),i=this.$(".ctrAddDestination").val();if(0===t.length)return void this.showError("Please select a source.");0===i.length&&(i=t),this.model.addVStore(t,i),this.render(),this._scrollToView()},onDeleteVStore:function(e){var t=$(e.currentTarget).attr("data-ctr");this._confirm("Delete vstore entry '"+t+"'?",function(){this.model.removeVStore(t),this.render()})},onCtrSourceChange:function(e){var t=$(e.currentTarget),i=t.data("prevSelected")||"",n=t.val().trim(),s=this.$(".ctrAddDestination").val().trim();""!==s&&s!==i||this.$(".ctrAddDestination").val(n),t.data("prevSelected",n)},_validateVStoreMap:function(){var t={},i={},n=_.some(this.$(".ctrMapEntry"),function(e){var t=this.$(e),n=t.find(".ctrSource").val().trim();if(n.length){var s=t.find(".destination"),a=s.val().trim();0===a.length&&(a=n),i[n]=a}},this);return n||(t[e.RS_VSTORE_NAME_MAP]=i,this.model.set(t)),!n},_getVStores:function(){var e=this;this.vstores=new t,this.vstores.fetch({success:function(){e.initialized=!0,e.render()},error:function(t,i){e.initialized=!0,e.render(),e.showModelError(t,i)}})},_confirm:function(e,t,i){$.nutanixConfirm({msg:e,yes:t,no:i,yesText:"Yes",noText:"No",context:this})},_scrollToView:function(){this.getParentView().scrollToElement(this.$el)}})}),define("text!templates/wizards/remotesite/BandwidthConfigList.html",[],function(){return'<div class="bandwidth-policies">\n  <% if (!bandwidthConfigs || bandwidthConfigs.length === 0) { %>\n    <div class="no-policy">No policy found</div>\n  <% } %>\n  <% _.each(bandwidthConfigs, function (bandwidthConfig, index) { %>\n    <div class="bw-policy" id="bw-config-<%= index %>">\n      <div class="desc"\n           title="<%= bandwidthConfig.description %>">\n        <%= bandwidthConfig.description %>\n      </div>\n      <div class="actions">\n        \x3c!-- Edit config --\x3e\n        <div class="btnEditConfig action-btn"\n              action="update"\n              actionTarget="bandwidthConfig"\n              actionTargetId="<%= index %>">\n          <i aria-hidden="true"\n             class="n-pencil-icon action">\n            <%= editIcon %>\n          </i>\n        </div>\n        <span class="sep">·</span>\n        \x3c!-- Delete config --\x3e\n        <div class="btnDeleteConfig action-btn"\n              action="delete"\n              actionTarget="bandwidthConfig"\n              actionTargetId="<%= index %>">\n          <i aria-hidden="true"\n             class="n-delete-icon action">\n            <%= deleteIcon %>\n          </i>\n        </div>\n      </div>\n    </div>\n  <% }); %>\n  \x3c!-- Add bandwidth policy configuration button --\x3e\n  <div>\n    <button class="btn btnAddConfig"\n       action="create"\n       actionTarget="bandwidthConfig">\n      <i data-icon="H" aria-hidden="true"></i>\n      <span class="btn-content">Add Policy</span>\n    </button>\n  </div>\n</div>'}),define("views/wizards/remotesite/BandwidthConfigListView",["views/basecomponents/BaseSubView","utils/AppConstants","utils/TimeUtil","utils/SVG","text!templates/wizards/remotesite/BandwidthConfigList.html"],function(e,t,i,n,s){"use strict";var a=_.template(s);return e.extend({ALL_DAYS_BITMAP:127,el:"#bandwidth-policies",viewOption:{},initialize:function(t){e.prototype.initialize.apply(this,t),this.model=t.model},render:function(){var e=this.model.getBandwidthPolicyConfigs(),t=[],i=this;_.each(e,function(e,n){t.push({bandwidthLimit:e.bandwidthLimit,startTime:e.startTime,endTime:e.endTime,daysSelected:e.daysSelected,description:i.getBandwidthConfigDescription(e)})});var s=a({bandwidthConfigs:t,editIcon:n.SVGIcon("F","action-icon",'width="12px" height="12px"'),deleteIcon:n.SVGIcon("v","action-icon",'width="12px" height="12px"')});this.$el.html(s),this.$(".desc").each(function(){$(this).tooltip({title:$(this).attr("title"),placement:"top",trigger:"hover",html:"false"})})},destroy:function(){this.$(".desc").each(function(){$(this).tooltip("destroy")}),e.prototype.destroy.apply(this)},getBandwidthConfigDescription:function(e){var n=e.bandwidthLimit,s=e.startTime,a=e.endTime,r=e.daysSelected,o=n/t.MBPS+" MBps";if(a-s===t.MICROS_PER_DAY&&r===this.ALL_DAYS_BITMAP)o+=" at all times";else{for(var l=i.getDaysFromBitmap(r),c=[],u=0;u<t.DAYS_IN_WEEK;u++)l[u]&&c.push(t.DAYS_OF_WEEK[u]);o+=" on "+c.join(", ")}return o}})}),define("text!templates/wizards/remotesite/RemoteSiteAdvancedSettings.html",[],function(){return'<div class="settings-div">\n  <label class="control-label section-title">Advanced Settings</label>\n  <div class="control-div n-form-advanced-settings">\n\n    <div class="advanced-settings-div">\n      \x3c!-- Use bandwidth throttling --\x3e\n      <div>\n        <div class="control-label-section">\n          <label class="control-label">Enable bandwidth throttling</label>\n        </div>\n        <div class="control-input-section">\n          <%= Components.switchInput({\n                id: \'useBwThrottle\',\n                checked: bandwidthThrottlingEnabled,\n                value: \'\',\n                classes: \'n-switch-medium\' }) %>\n        </div>\n      </div>\n\n      \x3c!-- Default bandwidth limit --\x3e\n      <div>\n        <div class="control-label-section">\n          <label class="control-label">Default Bandwidth Limit</label>\n        </div>\n        <div class="control-input-section">\n          <div>\n            <input type="text" class="input-default-bw"\n                   value=\'<%= defaultBandwidth || "" %>\'>\n            <br>\n            <div class="row-description">\n              Enter the maximum bandwidth in megabytes per second\n              (up to 2 decimal places).\n            </div>\n          </div>\n        </div>\n      </div>\n\n      \x3c!-- Here be bandwidth policy configurations --\x3e\n      <div>\n        <div class="control-label-section">\n          <label class="control-label bw-policy">\n            Bandwidth Throttling Policies\n          </label>\n        </div>\n        <div class="control-input-section">\n          <div id="bandwidth-policies"></div>\n        </div>\n      </div>\n\n      \x3c!-- Use Compression --\x3e\n      <div>\n        <div class="control-label-section">\n          <label class="control-label">Compress on wire</label>\n        </div>\n        <div class="control-input-section">\n          <%= Components.switchInput({\n                id: \'useCompress\',\n                checked: compressionEnabled,\n                value: \'\',\n                classes: \'n-switch-medium\' }) %>\n        </div>\n      </div>\n\n      \x3c!-- Use Cost-savings mode/auto power-off --\x3e\n      \x3c!-- ENG-105492: hiding cost-savings mode for now --\x3e\n      <div class="hide">\n        <div class="control-label-section">\n          <label class="control-label">\n            Cost Savings Mode\n            <span class="cost-saving-help n-tooltip-circle-medium"\n                  data-toggle="tooltip"\n                  data-original-title="When enabled, the cloud instance will\n                    automatically switch off when not in use\n                    to reduce costs. You can disable cost savings\n                    mode while updating the remote site.">\n              ?\n            </span>\n          </label>\n        </div>\n        <div class="control-input-section">\n          <%= Components.switchInput({\n                id: \'cost-saving-mode\',\n                checked: true,\n                disabled: true,\n                value: \'\',\n                classes: \'n-switch-medium\' }) %>\n        </div>\n      </div>\n    </div>\n  </div>\n</div>'}),define("views/wizards/remotesite/RemoteSiteAdvancedSettings",["data/DataProperties","components/Components","views/basecomponents/BaseSubView","views/wizards/remotesite/BandwidthConfigListView","utils/StatsUtil","utils/AppConstants","text!templates/wizards/remotesite/RemoteSiteAdvancedSettings.html"],function(e,t,i,n,s,a,r){"use strict";return i.extend({model:null,BANDWIDTH_CONFIG:"bandwidthConfig",events:{"click  input":"clearBaseHeader","click  .btnAddConfig":"onClickLinkAction","click  .btnEditConfig":"onClickLinkAction","click  .btnDeleteConfig":"onClickLinkAction"},initialize:function(e){i.prototype.initialize.apply(this,arguments),_.bindAll(this,"_scrollToView")},render:function(){if(!this.isViewRendered){var i=this.model.get(e.RS_COMPRESSION_ENABLED),n=this.model.get(e.RS_DEFAULT_BANDWIDTH_LIMIT),s=this.model.get(e.RS_BANDWIDTH_POLICY_ENABLED),a=_.template(r,{Components:t,compressionEnabled:i,defaultBandwidth:n,bandwidthThrottlingEnabled:s});this.$el.html(a),this.refreshBandwidthConfigList(),this.$(".cost-saving-help").tooltip({placement:"top",trigger:"hover",html:!1}),this.isViewRendered=!0}this.refreshView()},destroy:function(){this.$(".cost-saving-help").tooltip("destroy"),i.prototype.destroy.apply(this,arguments)},refreshView:function(){this.getParentView().onResize(this._scrollToView)},refreshBandwidthConfigList:function(){new n({model:this.model}).render()},showView:function(){i.prototype.showView.apply(this,arguments),this.isViewRendered&&this._scrollToView()},validateForm:function(){var t={};t[e.RS_COMPRESSION_ENABLED]=this.$("#useCompress").is(":checked"),t[e.RS_BANDWIDTH_POLICY_ENABLED]=this.$("#useBwThrottle").is(":checked"),t[e.RS_COST_SAVING_ENABLED]=this.$("#cost-saving-mode").is(":checked");var i=this.$(".input-default-bw").val().trim();if(i&&i.length){var n=parseFloat(i);if(isNaN(n)||n<0)return this.showError("Please enter a value in the range 0 to "+a.MAX_MBPS+" for the default bandwidth."),!1;var r=s.round(n,2);if(r>=a.MAX_MBPS)return this.showError("The maximum bandwidth should be less than "+a.MAX_MBPS+" Mbps."),!1;this.model.setDefaultBandwidthLimit(r)}else this.model.setDefaultBandwidthLimit(null);return this.model.set(t),!0},onClickLinkAction:function(e){var t=$(e.currentTarget),i={action:t.attr(a.NAV_ACTION),actionTarget:t.attr(a.NAV_ACTION_TARGET),actionTargetId:t.attr(a.NAV_ACTION_TARGET_ID)};i.action===a.ACTION_CREATE&&i.actionTarget===this.BANDWIDTH_CONFIG?this.parentView.showBandwidthConfigForm(i):i.action===a.ACTION_UPDATE&&i.actionTarget===this.BANDWIDTH_CONFIG?this.parentView.showBandwidthConfigForm(i):i.action===a.ACTION_DELETE&&i.actionTarget===this.BANDWIDTH_CONFIG&&$.nutanixConfirm({msg:"Are you sure you want to delete this bandwidth throttling policy?",yes:function(){this.model.removeBandwidthPolicyConfig(i.actionTargetId),this.refreshBandwidthConfigList()},no:function(){},yesText:"Yes",noText:"No",context:this})},_scrollToView:function(){this.getParentView().scrollToElement(this.$el)}})}),define("models/dataprotection/BandwidthConfigModel",["models/BaseModel","data/DataProperties","utils/AppConstants","utils/TimeUtil"],function(e,t,i,n){"use strict";return e.extend({name:"BandwidthConfigModel",MBPS:1e6,defaults:{startTime:0,endTime:i.MICROS_PER_DAY-i.MICROS_PER_SECOND*i.SECONDS_PER_MINUTE,daysSelected:127,bandwidthLimit:0},getSelectedDays:function(){return n.getDaysFromBitmap(this.get(t.RS_DAYS_SELECTED))},setSelectedDays:function(e){for(var n=0,s=0,a=i.DAYS_IN_WEEK-1;a>=0;a--)s=0,e[a]&&(s=1),n=n<<1|s;this.set(t.RS_DAYS_SELECTED,n)},setAllDayDuration:function(){this.set(t.RS_START_TIME,0),this.set(t.RS_END_TIME,i.MICROS_PER_DAY)},getStartTime:function(){var e=n.getTimeFromMicroseconds(this.get(t.RS_START_TIME));return e.hours+":"+e.minutes+" "+e.meridian},setStartTime:function(e){var i=n.getTimeOfDayInMicroseconds(e);this.set(t.RS_START_TIME,i)},getEndTime:function(){var e=n.getTimeFromMicroseconds(this.get(t.RS_END_TIME));return e.hours+":"+e.minutes+" "+e.meridian},setEndTime:function(e){var i=n.getTimeOfDayInMicroseconds(e);this.set(t.RS_END_TIME,i)},getBandwidthLimit:function(){return this.get(t.BANDWIDTH_LIMIT)/i.MBPS},setBandwidthLimit:function(e){this.set(t.BANDWIDTH_LIMIT,e*i.MBPS)},isDurationAllDay:function(){var e=this.get(t.RS_START_TIME);return this.get(t.RS_END_TIME)-e===i.MICROS_PER_DAY},validateModel:function(){return this.get(t.BANDWIDTH_LIMIT)<0?this.i18ns("bandwidth_lower_limit_msg",i.MAX_MBPS):this.get(t.BANDWIDTH_LIMIT)>=i.MAX_MBPS*i.MBPS?this.i18ns("bandwidth_upper_limit_msg",i.MAX_MBPS):this.get(t.RS_END_TIME)<=this.get(t.RS_START_TIME)?this.i18n("time_range_val_msg"):0===this.get(t.RS_DAYS_SELECTED)?this.i18n("days_val_msg"):void 0},resetDefault:function(){this.clear(),this.set(this.defaults)}})}),define("text!templates/wizards/remotesite/BandwidthConfigView.html",[],function(){return'<div class="n-title">\n  <span>Configure Bandwidth Throttling Policy</span>\n</div>\n<form id="policyForm" class="form-horizontal">\n  <div class="control-group">\n    \x3c!-- Bandwidth limit input --\x3e\n    <label class="control-label">Bandwidth Limit</label>\n    <div class="controls">\n      <input type="text" class="inputBwLimit"\n             value="<%= bandwidthLimit || \'\' %>">\n      <span>MBps</span>\n      <div class="row-description">Up to 2 decimal places</div>\n      <div class="n-input-validation-msg"></div>\n    </div>\n  </div>\n  <div class="control-group">\n    <label class="control-label">Duration</label>\n    <div class="controls compressGroup">\n      <div>\n        \x3c!-- Duration all day radio --\x3e\n        <input id="allDayThrottle" type="radio"\n               class="input-duration" name="throttleDur" value=""\n        <%= durationAllDay ? \'checked\' : \'\' %>>\n        <label for="allDayThrottle">All day</label>\n      </div>\n      <div>\n        \x3c!-- Specific time duration radio --\x3e\n        <input id="specTimeThrottle" type="radio"\n               class="input-duration" name="throttleDur" value=""\n        <%= !durationAllDay ? \'checked\' : \'\' %>>\n        <label for="specTimeThrottle" class="multiline-radio-label">\n          Specific duration (Based on the cluster\'s time zone: <%= timezone %>)\n        </label>\n      </div>\n    </div>\n    <div class="controls">\n      <div style="<%= durationAllDay ? \'display:none\' : \'\' %>"\n           id="specTimeInput">\n        <div class="time-group">\n          <div class="time-row">\n            <div class="time-label"><span>From </span></div>\n            \x3c!-- Start time picker --\x3e\n            <div class="input-append bootstrap-timepicker time-input">\n              <input id="startTime" type="text"\n                     class="input-small date-time">\n              <span class="add-on"><i class="glyphicon glyphicon-time"\n               ></i></span>\n            </div>\n\n          </div>\n          <div class="time-row">\n            <div class="time-label"><span>To </span></div>\n            \x3c!-- End time picker --\x3e\n            <div class="input-append bootstrap-timepicker time-input">\n              <input id="endTime" type="text"\n                     class="input-small date-time">\n              <span class="add-on"><i class="glyphicon glyphicon-time"\n               ></i></span>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n  <div class="control-group">\n    <label class="control-label">Repeat</label>\n    <div class="controls">\n      \x3c!-- Days selected input --\x3e\n      <span class="select-day <%= daysSelected[0] ? \'selected\': \'\' %>">Su</span>\n      <span class="select-day <%= daysSelected[1] ? \'selected\': \'\' %>">M</span>\n      <span class="select-day <%= daysSelected[2] ? \'selected\': \'\' %>">T</span>\n      <span class="select-day <%= daysSelected[3] ? \'selected\': \'\' %>">W</span>\n      <span class="select-day <%= daysSelected[4] ? \'selected\': \'\' %>">Th</span>\n      <span class="select-day <%= daysSelected[5] ? \'selected\': \'\' %>">F</span>\n      <span class="select-day <%= daysSelected[6] ? \'selected\': \'\' %>">S</span>\n    </div>\n  </div>\n</form>'}),define("views/wizards/remotesite/BandwidthConfigView",["data/DataProperties","views/basecomponents/BaseSubView","models/dataprotection/BandwidthConfigModel","managers/ClusterManager","text!templates/wizards/remotesite/BandwidthConfigView.html"],function(e,t,i,n,s){"use strict";var a=_.template(s);return t.extend({bandwidthConfigurationModel:null,viewOption:{},events:{"click  .input-duration":"onSelectDuration","click  .select-day":"toggleDaySelect"},initialize:function(e){t.prototype.initialize.apply(this,e),this.bandwidthConfigurationModel=new i},destroy:function(){this.$("#startTime").timepicker("remove"),this.$("#endTime").timepicker("remove"),t.prototype.destroy.apply(this,arguments)},render:function(){var t,i,s,r,o;if(this.viewOption&&this.viewOption.actionTargetId){var l=this.model.get(e.RS_BANDWIDTH_POLICY)[e.RS_BANDWIDTH_CONFIGS][this.viewOption.actionTargetId];this.bandwidthConfigurationModel.set(l),r=this.bandwidthConfigurationModel.isDurationAllDay()}else this.bandwidthConfigurationModel.resetDefault(),r=!0;t=this.bandwidthConfigurationModel.getBandwidthLimit(),i=this.bandwidthConfigurationModel.getStartTime(),s=this.bandwidthConfigurationModel.getEndTime(),o=this.bandwidthConfigurationModel.getSelectedDays();var c=n.getCurrentClusterTimezone()||"Unknown";this.$el.html(a({durationAllDay:r,bandwidthLimit:t,startTimeUsecs:i,endTimeUsecs:s,daysSelected:o,timezone:c}));var u=this;this.$("#startTime").timepicker({template:"dropdown",showSeconds:!1,defaultTime:i,minuteStep:1}).on("keydown.timepicker",this.forceTimepickerWidget).on("focus.timepicker",this.forceTimepickerWidget).on("changeTime.timepicker",function(e){u.bandwidthConfigurationModel.setStartTime(e.time)}),this.$("#endTime").timepicker({template:"dropdown",showSeconds:!1,defaultTime:s,minuteStep:1}).on("keydown.timepicker",this.forceTimepickerWidget).on("focus.timepicker",this.forceTimepickerWidget).on("changeTime.timepicker",function(e){u.bandwidthConfigurationModel.setEndTime(e.time)}),this.applyNutanixInput()},showView:function(){this.render(),$(this.el).show()},setViewOption:function(e){this.viewOption=e},validateForm:function(){var e=[],t=this.$(".select-day"),i=this.$(".inputBwLimit").val().trim();if(this.$("#specTimeInput").is(":visible")||this.bandwidthConfigurationModel.setAllDayDuration(),$.each(t,function(t,i){var n=0;$(i).hasClass("selected")&&(n=1),e.push(n)}),this.bandwidthConfigurationModel.setSelectedDays(e),0===i.length)return this.parentView.showError("The bandwidth limit cannot be empty."),!1;if(isNaN(i))return this.parentView.showError("The bandwidth limit should be a number."),!1;this.bandwidthConfigurationModel.setBandwidthLimit(parseFloat(i));var n=this.bandwidthConfigurationModel.validateModel();return!n||(this.parentView.showError(n),!1)},getSaveButtonLabel:function(){return"Save"},onSelectDuration:function(e){"specTimeThrottle"===$(e.currentTarget).attr("id")?this.$("#specTimeInput").show():this.$("#specTimeInput").hide()},toggleDaySelect:function(e){var t=$(e.currentTarget);t.hasClass("selected")?t.removeClass("selected"):t.addClass("selected")},forceTimepickerWidget:function(e){e.preventDefault(),$(e.currentTarget).timepicker("showWidget")},saveViewData:function(e){this.bandwidthConfigurationModel&&(this.viewOption&&void 0!==this.viewOption.actionTargetId?this.model.updateBandwidthPolicyConfig(this.viewOption.actionTargetId,this.bandwidthConfigurationModel.toJSON()):this.model.addBandwidthPolicyConfig(this.bandwidthConfigurationModel.toJSON())),"function"==typeof e&&e()}})}),define("text!templates/wizards/remotesite/RemoteSiteSettingsPage.html",[],function(){return'<div class="no-data">\n  <div class="donut-loader-blue"></div>\n  <span class="n-loading-text">Loading...</span>\n</div>\n<% if (initialized) { %>\n  <div class="remote-site-settings">\n    <div>\n      <button class="btnAdvancedSettings btn">\n        <i aria-hidden="true" data-icon="C"></i>\n        Advanced Settings\n      </button>\n    </div>\n    \x3c!-- Remote Site Settings --\x3e\n    <div class="settings-div">\n      <label class="control-label name-label">Name</label>\n      <div class="control-div">\n        <div class="control-group">\n          \x3c!--name--\x3e\n          <div class="controls">\n            <input type="text" class="inputName" value="<%= model.name ||\n              \'\' %>">\n            <div class="n-input-validation-msg"></div>\n          </div>\n        </div>\n      </div>\n    </div>\n\n    <div id="new-cvm" class="cvm-div" style="display:none">\n      \x3c!-- New CVM info goes here--\x3e\n    </div>\n\n    <div class="settings-div proxy-setting">\n      <label class="control-label">Proxy</label>\n      <div class="control-div">\n        <div class="control-group">\n          \x3c!--proxy and SSH tunnel--\x3e\n          <div class="controls">\n            <label class="n-label-text">Enable</label>\n            <input id="useProxy" type="checkbox" class="n-switch useProxy"\n              <%= model.proxyEnabled ? \' checked \' : \'\' %> >\n            <label for="useProxy" class="n-switch-medium n-useProxy"></label>\n            <div class="ssh-div" style="display:none">\n              <label class="n-label-text">Use SSH Tunnel</label>\n              <input  id="useSSH" type="checkbox" class="n-switch useSSH"\n                <%= model.sshEnabled ? \' checked \' : \'\' %> >\n              <label for="useSSH" class="n-switch-medium n-useSSH"></label>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n\n    <div id="container-mappings" class="container-div">\n      \x3c!-- Container Mapping goes here--\x3e\n    </div>\n\n    <div id="advanced-setting" class="advanced-div" style="display:none">\n      \x3c!-- Remote site advanced settings goes here--\x3e\n    </div>\n  </div>\n  <div id="bandwidth-config" style="display:none">\n    \x3c!-- Bandwidth throttling configuration form goes here--\x3e\n  </div>\n<% } %>'}),define("views/wizards/remotesite/RemoteSiteSettingsPage",["data/DataProperties","data/DataURLConstants","models/BaseModel","models/BaseCollection","views/basecomponents/wizards/BaseWizardPage","views/wizards/remotesite/CVMSettings","views/wizards/remotesite/ContainerMappings","views/wizards/remotesite/RemoteSiteAdvancedSettings","views/wizards/remotesite/BandwidthConfigView","utils/AppUtil","utils/AppConstants","utils/SubViewHelper","text!templates/wizards/remotesite/RemoteSiteSettingsPage.html"],function(e,t,i,n,s,a,r,o,l,c,u,d,h){"use strict";var p=_.template("Create Remote Site '<%= rsName %>'?<br><br>WARNING: <%= warningMsg %><br><br>Do you want to continue?"),T=_.template("<%= subnetCidr %> (<%= subnetId %>)"),E=u.CLOUD_TYPES.AWS,S=i.extend({urlRoot:function(){return _.template(t.CLOUD_SUBNETS)({cloudType:u.CLOUD_TYPES[E.toUpperCase()]})},idAttribute:e.CVM_ID,nameAttribute:e.CVM_SUBNETID,name:"SubnetModel",entityType:u.ENTITY_CLOUD_SUBNET,getFormattedValue:function(){return T({subnetCidr:this.get(e.SUBNET_CIDR),subnetId:this.get(e.CVM_SUBNETID)})},isVPNUnavailable:function(){var t=this.get(e.SUBNET_VPN_STATE);return!t||"UNAVAILABLE"===t},isVPNImpaired:function(){return"IMPAIRED"===this.get(e.SUBNET_VPN_STATE)}}),g=n.extend({model:S,url:_.template(t.CLOUD_SUBNETS)({cloudType:u.CLOUD_TYPES.AWS}),name:"SubnetCollection",setRegion:function(e){this._parameters.region=e},setCredentialName:function(e){this._parameters.credentialName=e},getClassicSubnets:function(){return this.models.filter(function(t){var i=t.get(e.SUBNET_VPN_STATE);return!i||"UNAVAILABLE"===i})},getVPCSubnets:function(){return this.models.filter(function(t){var i=t.get(e.SUBNET_VPN_STATE);return i&&"UNAVAILABLE"!==i})},getVPNSubnets:function(t){return void 0===t?this.models:this.models.filter(function(i){return i.get(e.CVM_VPCID)===t})},getVPNs:function(){return _.uniq(this.pluck(e.CVM_VPCID))},isSameFetchCall:function(e){var t=n.prototype.isSameFetchCall.apply(this,arguments);if(t){var i,s;return this._previousOptions&&this._previousOptions.data&&(i=this._previousOptions.data.credentialName,s=this._previousOptions.data.region),this._parameters.credentialName===i&&this._parameters.region===s}return t}}),A=i.extend({defaults:{metadata:{},entities:[]},name:"CloudRegionsModel",initialize:function(e){i.prototype.initialize.apply(this,arguments),this.credentialName=e.credentialName,this.cloudType=e.cloudType},getURL:function(e,i){return _.template(t.CLOUD_REGIONS)({credentialName:this.credentialName,cloudType:this.cloudType})}});return s.extend({subViewHelper:null,subnetCollection:null,initialized:!1,events:{"click  .btnAdvancedSettings":"onToggleAdvancedSettings","keyup .inputName":"onInputNameKeyUp","click input[type=text]":"clearHeader","click .useSSH":"onSSHClick","click .useProxy":"onProxyClick"},modelEvents:{"reset subnetCollection":"onDataLoaded","error subnetCollection":"showModelError"},initialize:function(e){s.prototype.initialize.apply(this,arguments),this.subViewHelper=new d,this.subnetCollection=new g,this.delegateModelEvents()},render:function(){if(!this.isViewRendered){var e=_.template(h,{model:this.model.toJSON({display:!0}),initialized:this.initialized});if(this.$el.html(e),!this.initialized)return void this._fetchRegions();E=this.model.getCurrentCloudType(),this.subnetCollection.setURL(_.template(t.CLOUD_SUBNETS)({cloudType:E})),this._renderContainerMappings(),this.isViewRendered=!0}this._toggleCVMSettings(),this.refreshView(),
this.hideBandwidthConfigForm()},_fetchRegions:function(){var t=this;new A({credentialName:this.model.getCredentialName(),cloudType:this.model.getCurrentCloudType()}).fetch({success:function(i){var n={};_.each(i.toJSON()[e.CLOUD_REGION_ENTITIES],function(t){n[t[e.CLOUD_REGION_CODE]]=t[e.CLOUD_REGION_NAME]}),t.model.setCloudRegions(n),t.initialized=!0,t.render()},error:function(e,i){t.showError(c.processAjaxError(i.responseText)),t.$(".no-data").hide()}})},destroy:function(){this.subnetCollection.stopFetch(),this.subViewHelper.destroy(),s.prototype.destroy.apply(this,arguments)},onPageTransition:function(t){var i=this._getBandwidthConfigView(),n=this;if(i&&i.isViewVisible())return void(i.validateForm()&&(i.saveViewData(function(){var e=n.subViewHelper.get("advancedSettings");e&&e.refreshBandwidthConfigList()}),this.hideBandwidthConfigForm()));if(this.validateForm()){s.prototype.disableSaveButton.apply(this,arguments);var a=this._getCVMSettingPage();if(a){var r=a.getValidationWarning();r?$.nutanixConfirm({msg:p({rsName:this.model.get(e.RS_NAME),warningMsg:r}),yes:function(){this._saveRemoteSite(t)},no:function(){s.prototype.enableSaveButton.apply(this,arguments)},yesText:"Yes",noText:"No",context:this}):this._saveRemoteSite(t)}else this._saveRemoteSite(t)}},onPageCancel:function(){var e=this._getBandwidthConfigView();return!e||!e.isViewVisible()||(this.hideBandwidthConfigForm(),!1)},getSaveButtonLabel:function(){return u.ACTION_NAMES[u.ACTION_CREATE]},confirmHide:function(e){this.model.isNew()?$.nutanixConfirm({msg:"Remote site content has not been saved. Are you sure you want to exit?",yes:e,yesText:"Yes",noText:"No"}):e()},refreshView:function(){this.$(".useSSH").is(":checked")&&this.getWizard().checkPrerequisites({entity:u.ENTITY_CLUSTER}),this.onResize()},onInputNameKeyUp:function(e){c.validNameCharactersEventHandler(e,this.$(".n-input-validation-msg"))},onSSHClick:function(e){this._setSSHTunnelMode($(e.currentTarget).is(":checked"))},onProxyClick:function(e){$(e.currentTarget).is(":checked")||(this.$(".useSSH").prop("checked",!1),this._setSSHTunnelMode(!1))},onToggleAdvancedSettings:function(e){var t=this.$(".advanced-div").is(":visible"),i=this.subViewHelper.get("advancedSettings");t?i.hideView():(i?i.refreshView():(i=new o({el:"#advanced-setting",model:this.model}),i.setParentView(this),this.subViewHelper.register("advancedSettings",i),this.subViewHelper.render("advancedSettings")),i.showView())},onClickLinkAction:function(e){var t=$(e.currentTarget),i={};i[u.NAV_ACTION]=t.attr(u.NAV_ACTION),i[u.NAV_ACTION_TARGET]=t.attr(u.NAV_ACTION_TARGET),"sshTunnel"===i[u.NAV_ACTION_TARGET]&&this._showSSHTunnel(i[u.NAV_ACTION]===u.ACTION_ADD)},onDataLoaded:function(){if(null!==this.model.getCloudCVMModel())this._resetProxySettings();else{var e=this._getCVMSettingPage();e&&e.isViewVisible()&&e.onDataLoaded()}},showModelError:function(e,t){if(e.reset(),null!==this.model.getCloudCVMModel())this.showError(c.processAjaxError(t.responseText)),this._showSettingsContent(!0);else{var i=this._getCVMSettingPage();i&&i.isViewVisible()&&i.showModelError(e,t)}},showBandwidthConfigForm:function(e){var t=this.subViewHelper.get("bwConfigFormView");t?t.refreshView():(t=new l({el:"#bandwidth-config",model:this.model}),t.setParentView(this),this.subViewHelper.register("bwConfigFormView",t),this.subViewHelper.render("bwConfigFormView")),t.setViewOption(e),t.showView(),$(".remote-site-settings").hide(),this.showButton("Previous",!1),this.setButtonText("Save",t.getSaveButtonLabel())},hideBandwidthConfigForm:function(){var e=this.subViewHelper.get("bwConfigFormView");e&&(e.hideView(),this.$(".remote-site-settings").show(),this.showButton("Previous",!0),this.setButtonText("Save",this.getSaveButtonLabel()))},showButton:function(e,t){t?$(".btn"+e).show():$(".btn"+e).hide()},setButtonText:function(e,t){$(".btn"+e).text(t)},validateForm:function(){var t=this.$(".ssh-div").is(":visible"),i={name:this.$(".inputName").val().trim(),proxyEnabled:this.$(".useProxy").is(":checked"),sshEnabled:t&&this.$(".useSSH").is(":checked")},n=this.$(".input-default-bw").length&&parseFloat(this.$(".input-default-bw").val().trim());if(isNaN(n)||n<0)n=null;else{if(n>=u.MAX_MBPS)return this.showError("The Maximum Bandwidth should be less than "+u.MAX_MBPS+" Mbps."),!1;this.model.setDefaultBandwidthLimit(n)}var s=!!this.$("#useBwThrottle").attr("checked");if(this.model.set(e.RS_BANDWIDTH_POLICY_ENABLED,s),!(i.name&&i.name.length>0))return this.showError("Please enter a remote site name"),!1;var a=null;t&&i.sshEnabled&&(a=3e3);var r=_.some(this.subViewHelper.getIds(),function(e){if(!this.subViewHelper.get(e).validateForm())return!0},this);return r||(this.model.set(i),this.model.setSSHTunnelPort(a)),!r},_saveRemoteSite:function(e){var t=this;this.model.save(null,{success:function(t,i){t.isNew(!1),e()},error:function(e,i){t.showHeaderErrorWithDetails("Error saving remote site configuration.",i.responseText),s.prototype.enableSaveButton.apply(t,arguments)}})},_setSSHTunnelMode:function(e){e?this.$(".useProxy").prop("checked",!0):this.clearHeader(),e&&this.getWizard().checkPrerequisites({entity:u.ENTITY_CLUSTER})},_renderContainerMappings:function(){var e=this.subViewHelper.get("containerMappings");e?e.refreshView():(e=new r({el:"#container-mappings",model:this.model}),e.setParentView(this),this.subViewHelper.register("containerMappings",e),this.subViewHelper.render("containerMappings"))},_getCVMSettingPage:function(){return this.subViewHelper.get("cvmSettings")},_getBandwidthConfigView:function(){return this.subViewHelper.get("bwConfigFormView")},_toggleCVMSettings:function(){this.subnetCollection.setCredentialName(this.model.getCredentialName());var e=this._getCVMSettingPage();null===this.model.getCloudCVMModel()?(e?e.refreshView():(e=new a({el:"#new-cvm",model:this.model,subnetCollection:this.subnetCollection}),e.setParentView(this),this.subViewHelper.register("cvmSettings",e),this.subViewHelper.render("cvmSettings")),e.showView(),this._showSettingsContent(!0)):(e&&e.hideView(),this._resetProxySettings())},_showSSHTunnel:function(e){e?(this.$(".useSSH").prop("checked",!0),this.$(".ssh-div").show(),this._setSSHTunnelMode(!0),this.$(".useSSH").prop("disabled",!0),this.$(".useProxy").prop("disabled",!0),this.$(".n-useSSH").addClass("disabled"),this.$(".n-useProxy").addClass("disabled"),this.$(".proxy-setting").addClass("top-margin-div")):(this.$(".ssh-div").hide(),this.$(".useSSH").prop("disabled",!1),this.$(".useProxy").prop("disabled",!1),this.$(".n-useSSH").removeClass("disabled"),this.$(".n-useProxy").removeClass("disabled"),this.$(".useProxy").prop("checked",!1),this.$(".proxy-setting").removeClass("top-margin-div"),this.clearHeader())},_resetProxySettings:function(){if(null!==this.model.getCloudCVMModel()){this.subnetCollection.setRegion(this.model.getCloudCVMModel().get(e.CVM_REGION));var t=this.model.getCloudCVMModel().get(e.CVM_ID),i=this.subnetCollection.findModelById(t);this.subnetCollection.isSameFetchCall()&&i?(i.isVPNUnavailable()?this._showSSHTunnel(!0):this._showSSHTunnel(!1),this._showSettingsContent(!0)):(this._showSettingsContent(!1),this.subnetCollection.fetch())}},_showSettingsContent:function(e){e?(this.$(".no-data").hide(),this.$(".remote-site-settings").show()):(this.$(".no-data").show(),this.$(".remote-site-settings").hide())}})}),define("views/wizards/remotesite/RemoteSiteWizard",["views/basecomponents/wizards/WizardView","models/BaseModel","models/dataprotection/CloudRemoteSiteModel","views/wizards/remotesite/CloudPage","views/wizards/remotesite/CredentialsPage","views/wizards/remotesite/RemoteSiteSettingsPage","data/DataProperties","data/DataURLConstants","events/AppEvents","managers/ActionManager","managers/LicenseManager","utils/AppConstants","utils/AppUtil"],function(e,t,i,n,s,a,r,o,l,c,u,d,h){"use strict";var p=_.template('<a class="externalPopupLink" <%= actionAttributes %>><%= title %></a>'),T=t.extend({urlRoot:o.NAME_SERVERS,entityType:d.ENTITY_NAME_SERVER,parse:function(e,i){t.prototype.parse.apply(this,arguments);var n={};return n.nameServers=e,n},isNameServerConfigured:function(){var e=this.get("nameServers");return e&&!_.isEmpty(e)}});return e.extend({initialize:function(t){e.prototype.initialize.apply(this,arguments),this.addExtraEvents({"click .externalPopupLink":"onExternalPopupLinkClick"}),_.bindAll(this,"externalPopupClosed","showNameServerInfo")},show:function(t){if(t[d.NAV_ACTION]===d.ACTION_CREATE){var r=new i;r.setCloudCVMModel(null);var o=[{id:"rs-cloud",title:"Cloud Type",klass:n,model:r},{id:"rs-credential",title:"Credentials",klass:s,model:r},{id:"rs-settings",title:"Remote Site Settings",klass:a,model:r}];if(this.initializeWizard({title:"Cloud Site",wizardType:e.WIZARD_TYPES.LINEAR,pages:o}),e.prototype.show.apply(this,arguments),this.$(".n-license-warning").is(":visible")){var l=this;this.$(".n-license-warning").on("remove",function(){l.checkPrerequisites({entity:d.ENTITY_NAME_SERVER})})}}},hide:function(){$("body").off(l.POPUP_CLOSE,this.externalPopupClosed),this.$(".n-license-warning").is(":visible")&&this.$(".n-license-warning").off("remove"),e.prototype.hide.apply(this,arguments)},checkPrerequisites:function(e){if(e&&e.entity===d.ENTITY_CLUSTER)this.showClusterExternalIdWarning();else if(e&&e.entity===d.ENTITY_NAME_SERVER)(new T).fetch({success:this.showNameServerInfo});else{var t=u.FEATURE_MAP.LICENSE_CLOUD_CONNECT;u.violatedFeatureLicense(t)?this.showHeaderWarning(u.getPopupMessageTemplate(t)):(new T).fetch({success:this.showNameServerInfo})}},onExternalPopupLinkClick:function(e){this.$el.hide(),c.executeActionElement(e.currentTarget),$("body").on(l.POPUP_CLOSE,this.externalPopupClosed)},externalPopupClosed:function(e,t){this.$el.show(),$("body").off(l.POPUP_CLOSE,this.externalPopupClosed),!t||t.actionTarget!==d.ENTITY_NAME_SERVER&&t.actionTarget!==d.ENTITY_CLUSTER||this.checkPrerequisites({entity:t.actionTarget})},showNameServerInfo:function(e){e.isNameServerConfigured()?this.clearHeader():this.showHeaderInfo("A Name server has not been configured. This may cause DNS resolution failures."+this.createActionLink("Add Name Server",d.ENTITY_NAME_SERVER))},showClusterExternalIdWarning:function(){this.getCurrentClusterModel()&&!this.getCurrentClusterModel().get(r.CLUSTER_EXTERNAL_IP_ADRESS)?this.showHeaderWarning("Cluster external address must be configured when SSH tunnel is enabled."+this.createActionLink("Add Cluster External Address",d.ENTITY_CLUSTER)):this.clearHeader()},createActionLink:function(e,t){return this.canModifyByEntityType(t)?"<br>"+p({title:e,actionAttributes:h.createActionAttr(t,d.ACTION_SHOW)}):""}})}),define("text!templates/popups/fileserver/FileServerPrerequisitePopupView.html",[],function(){return'<div class="modal-header">\n  <button type="button" class="close" data-dismiss="modal">\n    <i data-icon="K" aria-hidden="true"></i>\n  </button>\n  <h4 class="n-title"> <%  if (isActivateFlow) { %>\n  <%= i18n(\'file_server_activation\') %>\n  <% } else { %>\n  <%= i18n(\'new_file_server\') %>\n   <% } %><%= i18n(\'pre_check\') %></h4>\n</div>\n\x3c!-- Link to configure network page --\x3e\n<div class="n-modal-wrapper">\n  <div class="n-modal-body">\n    <div class="modal-content-container n-modal-content-wrapper">\n      <div class="n-modal-alert-header not-empty">\n        \x3c!-- alert goes here --\x3e\n      </div>\n      <div class="n-modal-content">\n        <form id="fsPrechecksPopupForm" class="form-horizontal">\n          <section class="fs-precheck-config">\n            <div class="section-content">\n              <div class="fs-precheck-container">\n                \x3c!-- Capacity of the File Server --\x3e\n                <div class="control-group">\n                  <div class="title">\n                    <%= i18n(\'requirements\') %>\n                  </div>\n                </div>\n                <div class="tab tab-wrapper">\n                  <% if (!isActivateFlow) { %>\n                    <div class="control-group">\n                      <div class="title">\n                        <% if (!isLatestFileServerInstalled) { %>\n                          <span class="badge -light-grey">1</span>\n                          <div class="download-fs-url addExternalPopup">\n                            <a class="softwarePopupLink adv-settings-lnk"\n                               action="show"\n                               actiontarget="upgrade">\n                              <%= i18n(\'download_software\') %>\n                            </a>\n                          </div>\n                        <% } else { %>\n                          <span class="badge -blue"><%= SVG.SVGIcon(\'J\') %></span>\n                          <label class="control-label checkbox-label">\n                            <%= i18n(\'afs_software\') %>\n                          </label>\n                        <% } %>\n                      </div>\n                      <% if (!isContainerSet) { %>\n                        <div class="download-fs-url addExternalPopup">\n                          <div class="alert alert-warning error-class">\n                            <%= i18n(\'create_storage_container\') %></div>\n                        </div>\n                      <% } %>\n                      <div class="description">\n                        <% if (isSingleNodeAndPreThreeDotOne) { %>\n                          <%= i18n(\'pre_three_dot_one_msg\') %>\n                        <% } else { %>\n                          <%= i18n(\'afs_software_required\') %>\n                        <% } %>\n                      </div>\n                    </div>\n                  <% } %>\n                  <div class="control-group">\n                    <div class="title">\n                      <%  if (!isExternalDataServiceSet) { %>\n                        <% if(!isAHV) { %>\n                          <span class="badge -light-grey"></span>\n                        <% } else { %>\n                          <span class="badge -light-grey"></span>\n                        <% } %>\n                        <div class="addExternalPopup addExternalPopup">\n                          <a class="externalPopupLink adv-settings-lnk">\n                            <%= i18n(\'add_data_services_ip\') %>\n                          </a>\n                        </div>\n                      <% } else { %>\n                        <span class="badge -blue"><%= SVG.SVGIcon(\'J\') %></span>\n                        <label class="control-label checkbox-label">\n                          <%= i18n(\'data_Services_ip_added\') %>\n                        </label>\n                      <% } %>\n                    </div>\n                    <div class="description">\n                      <%= i18n(\'for_data_transfer\') %>\n                    </div>\n                  </div>\n                  <div class="control-group">\n                    <div class="title">\n                      <% if (!isNetworkConfigured) { %>\n                        <span class="badge -light-grey"></span>\n                        <% if (isAHV) { %>\n                          <div class="config-network-url addExternalPopup">\n                            <a class="networkPopupLink adv-settings-lnk"\n                              action="show"\n                              actiontarget="acropolis_network">\n                              <%= i18n(\'add_network\') %>\n                            </a>\n                          </div>\n                        <% } else { %>\n                          <label class="control-label checkbox-label">\n                            <%= i18n(\'add_network_vcenter\') %></label>\n                        <% } %>\n                      <% } else { %>\n                        <span class="badge -blue"><%= SVG.SVGIcon(\'J\') %></span>\n                        <label class="control-label checkbox-label">\n                          <%= totalAvailableNetworks %>\n                        </label>\n                      <% } %>\n                    </div>\n                    <div class="description">\n                      <%= i18n(\'network_minimum\') %>\n                       &nbsp;<span class="tooltip-wrapper">\n                       <%= SVG.SVGIcon(\'Question_Mark\', \'question-mark\') %></span>\n                    </div>\n                  </div>\n                  <% if (!isAHV) { %>\n                    <br/>\n                    <div class="control-group vcenter">\n                      <div class="title">\n                        <%  if (!isClusterRegisteredVcenter) { %>\n                          <span class="badge -light-grey"></span>\n                          <div class="config-network-url addExternalPopup">\n                            <a class="vcenterPopupLink adv-settings-lnk"\n                               action="show"\n                               actionTarget="management_server"\n                               actionTargetId="vCenter">\n                              <%= i18n(\'register_vcenter\') %>\n                            </a>\n                          </div>\n                        <% } else { %>\n                          <span class="badge -blue"><%= SVG.SVGIcon(\'J\') %></span>\n                          <label class="control-label checkbox-label">\n                            <%= i18n(\'vcenter_registered\') %>\n                          </label>\n                        <% } %>\n                      </div>\n                      <div class="description">\n                        <%= i18n(\'vcenter_registration\') %>\n                        <%  if (isActivateFlow) { %>\n                        <%= i18n(\'activating\') %>\n                        <% } else { %>\n                        <%= i18n(\'deploying\') %>\n                        <% } %><%= i18n(\'file_server\') %>\n                      </div>\n                    </div>\n                  <% } %>\n                  <div class="description">\n                    <%= i18n(\'active_directory_level_msg\') %>\n                  </div>\n                </div>\n              </div>\n            </div>\n          </section>\n        </form>\n      </div>\n    </div>\n  </div>\n  \x3c!-- File server prerequisite cancel and continue button --\x3e\n  <div class="n-modal-footer">\n    <% if(!disabled) { %>\n      <span class="n-terms-conditions-container">\n        <%= i18n(\'agree_and_accept\') %>\n          <a class="eulaAgreementPopup">EULA</a>\n      </span>\n    <% } %>\n    <button class="btnCancel btn n-btn-form">\n      <%= i18n(\'cancel\') %>\n    </button>\n    <button class="btnSave btn n-btn-form <%= disabled %>">\n      <%= i18n(\'continue\') %>\n    </button>\n  </div>\n</div>'}),define("views/popups/fileserver/FileServerPrerequisitePopupView",["views/basecomponents/popups/BasePopupView","managers/PopupManager","managers/LicenseManager","managers/NotificationManager","events/AppEvents","utils/AppConstants","components/Components","utils/SVG","text!templates/popups/fileserver/FileServerPrerequisitePopupView.html"],function(e,t,i,n,s,a,r,o,l){"use strict";return e.extend({el:"#popupPrerequisiteFileServer",name:"FileServerPrerequisitePopupView",model:null,events:{"click  .btnCancel":"closePopupAndWizard","click  .modal-header .close":"closePopupAndWizard","click  .softwarePopupLink":"onSoftwarePopupLinkClick","click  .networkPopupLink":"onNetworkPopupLinkClick","click  .externalPopupLink":"onExternalPopupLink","click  .vcenterPopupLink":"onVcenterPopupLink","click  .eulaAgreementPopup":"onEulaPopupLink","click  .btnSave":"onClickAccept"},template:_.template(l),render:function(){var e,t=this.options.isNetworkConfigured?this.options.totalNetworks:0;e=t>1?this.i18ns("networks",t):this.i18ns("network",t);var i=this.template(this.vtOptions({Components:r,SVG:o,isNetworkConfigured:this.options.isNetworkConfigured,totalAvailableNetworks:e,isLatestFileServerInstalled:this.options.isLatestFileServerInstalled,isAHV:this.options.isAHV,isExternalDataServiceSet:this.options.isExternalDataServiceSet,isClusterRegisteredVcenter:this.options.isClusterRegisteredVcenter,isContainerSet:this.options.isContainerSet,isActivateFlow:this.options.isActivateFlow,disabled:this.options.showPrecheck?"disabled":"",isSingleNodeAndPreThreeDotOne:this.options.isSingleNodeAndPreThreeDotOne}),this);this.$el.html(i),this.options.showPrecheck&&this.addBtnTooltip(),this.addTooltip(),this.checkFileServerLicense(),this.isClusterFFEnabled(a.FFLAGS.HELP_DOC)&&this.createHelpIcon(this.options.actionRoute),this.addNumericLabels()},closePopupAndWizard:function(){this.hide();var e={action:a.ACTION_CREATE,actionTarget:a.ENTITY_FILE_SERVER};s.triggerAppEvent(s.CANCEL_PRE_CHECK_NOTIFICATION,{entityType:a.ENTITY_FILE_SERVER,actionRoute:e})},addTooltip:function(){var e="<p>"+this.i18n("tooltip_msg1")+"</p><p>"+this.i18n("tooltip_msg2")+"</p><p>"+this.i18n("tooltip_msg3")+"</p>";this.$(".tooltip-wrapper").tooltip({placement:"top",trigger:"hover",html:"true",title:e})},addBtnTooltip:function(){var e=this.$(".btnSave"),t=this.getRequirementCount(),i=this.i18ns("requirements_msg",t);1===t&&(i=this.i18n("requirement_msg")),e.tooltip("destroy"),e.addClass("events-allowed"),e.tooltip({title:i,placement:"left",trigger:"hover",html:!0})},getRequirementCount:function(){var e=0;return this.options.isActivateFlow||(this.options.isLatestFileServerInstalled||e++,this.options.isContainerSet||e++),this.options.isExternalDataServiceSet||e++,this.options.isNetworkConfigured||e++,this.options.isAHV||this.options.isClusterRegisteredVcenter||e++,e},addNumericLabels:function(){this.titlewrapper=this.$el.find(".tab-wrapper .control-group"),_.each(this.titlewrapper,function(e,t){$(e).find(".-light-grey").text(t+1)})},onExternalPopupLink:function(e){this.hide(),t.handleAction({action:a.ACTION_SHOW,actionTarget:a.ENTITY_CLUSTER,fsPrecheckFlow:!0})},onSoftwarePopupLinkClick:function(e){this.hide(),t.handleAction({action:a.ACTION_SHOW,actionTarget:a.ENTITY_UPGRADE,actionTargetId:a.ENTITY_FILE_SERVER,fsPrecheckFlow:!0})},onNetworkPopupLinkClick:function(e){this.hide(),t.handleAction({action:a.ACTION_SHOW,actionTarget:a.ENTITY_ACROPOLIS_NETWORK,fsPrecheckFlow:!0})},onVcenterPopupLink:function(e){this.hide(),t.handleAction({action:a.ACTION_SHOW,actionTarget:a.ENTITY_MANAGEMENT_SERVER,actionTargetId:"vCenter",fsPrecheckFlow:!0})},onEulaPopupLink:function(e){this.hide(),t.handleAction({action:a.ACTION_SHOW,actionTarget:a.ENTITY_EULA_POPUP})},onClickAccept:function(e){if(!$(e.currentTarget).hasClass("disabled")){this.hide();var t={action:a.ACTION_CREATE,actionTarget:a.ENTITY_FILE_SERVER};s.triggerAppEvent(s.SHOW_PRE_CHECK_NOTIFICATION,{entityType:a.ENTITY_FILE_SERVER,actionRoute:t})}},checkFileServerLicense:function(){var e=i.FEATURE_MAP.LICENSE_FILE_SERVER,t=i.violatedFeatureLicense(e),s=i.violatedFeatureLicense(e,null,!0);t&&s&&n.showClientNotification(a.NOTIFY_WARNING,i.getPopupMessageTemplate(e))},destroy:function(){this.$(".tooltip-wrapper").tooltip("destroy"),this.$(".btnSave").tooltip("destroy"),e.prototype.destroy.apply(this,arguments)}})}),define("models/fileserver/FileServerCollection",["models/PollingCollection","models/fileserver/FileServerModel","data/DataURLConstants"],function(e,t,i){"use strict";return e.extend({model:t,url:i.FILE_SERVER,name:"FileServerCollection"})}),define("models/network/AcropolisNetworkCollection",["models/PollingCollection","models/network/AcropolisNetworkModel","data/DataManager","data/DataURLConstants"],function(e,t,i,n){"use strict";return e.extend({model:t,name:"AcropolisNetworkCollection",useUhuraAPI:!1,url:n.MGMT_NETWORK,sortStrategy:"displayName",sortStrategies:{vlanId:function(e){return e.getVlanId()},displayName:function(e){return(e.getDisplayName()||e.getDisplayVlanId()||"").toLowerCase()}},initialize:function(t,i){e.prototype.initialize.apply(this,arguments),i&&i.useUhuraAPI&&(this.useUhuraAPI=i.useUhuraAPI)},getDataSourceURL:function(){return this.useUhuraAPI?i.getV2DataSourceURL():t.prototype.getDataSourceURL.apply(this)},useUhura:function(e){!1===e?(this.useUhuraAPI=!1,this.url=n.MGMT_NETWORK):(this.useUhuraAPI=!0,this.url=n.MGMT_NETWORK.substring(1))},setSortStrategy:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this.sortStrategies[e]&&(this.sortStrategy=e,this.sort({silent:t})),this},comparator:function(e){return this.sortStrategies[this.sortStrategy].apply(this,arguments)}})}),define("models/genesis/ClusterUpgradeModel",["models/genesis/GenesisBaseModel","utils/AppConstants"],function(e,t){"use strict";return e.extend({name:"ClusterUpgradeModel",methodName:t.CLUSTER_MANAGER_METHODS.CLUSTER_UPGRADE,managerName:t.GENESIS.CLUSTER_MANAGER,setRPCParams:function(e,t,i,n){void 0===t&&(t=!1),void 0===i&&(i=!1),void 0===n&&(n=!1),_.extend(this.kwargs,{nos_version:e,manual_upgrade:t,ignore_preupgrade_tests:i,skip_upgrade:n})},getErrorResponse:function(){var t=e.prototype.getErrorResponse.apply(this,arguments);if(t)return t;var i=this.getReturnResponse();return!1===i[0]?i[1]?i[1]:"Failed to add node.":void 0},getReturnResponse:function(){return this.get(e.DP.GENESIS_RETURN)||[]}})}),define("models/docker/DockerModel",["models/PollingModel","data/DataURLConstants","data/DataManager","utils/AppConstants","utils/AppUtil"],function(e,t,i,n,s){"use strict";var a={UUID:"uuid",NAME:"name",VERSION:"version",STATE:"state",BUSY_REASON:"busy_reason",ENABLED:"ENABLED"};return e.extend({urlRoot:t.DOCKER_VERSION_URL,entityType:n.ENTITY_CONTAINER,idAttribute:a.UUID,name:"DockerModel",nameAttribute:a.NAME,entityName:null,DP:a,getDataSourceURL:function(){return i.getV2DataSourceURL()},getURL:function(e){return"update"===e?this.urlRoot:this.url()},getValue:function(t){return t===this.nameAttribute?this.get(this.nameAttribute)||this.entityName:e.prototype.getValue.apply(this,arguments)},setEntityName:function(e){this.entityName=e},validateName:function(e){var t="";return 0===e.length?t+=this.i18n("required_fields","Please enter the required field(s)."):s.validateFileServerCharacters(e)||(t+=this.i18n("require_chars","Please use alpha numeric or dash characters only.")),t},validateFsSize:function(e){var t="";return(isNaN(e)||!s.isInt(e)||e<1024)&&(t+=this.i18n("file_size","File size should be an integer greater than or equal to 1024 GiB.")),t}},{DP:a})}),define("models/docker/DockerCollection",["models/PollingCollection","models/docker/DockerModel","data/DataManager","data/DataURLConstants"],function(e,t,i,n){"use strict";return e.extend({model:t,url:n.DOCKER_VERSION_URL,name:"DockerCollection",getDataSourceURL:function(){return i.getV2DataSourceURL()}})}),define("models/softwareupgrade/SoftwareUpgradeModel",["models/BaseModel","models/softwareupgrade/SoftwareReleaseCollection","models/genesis/ClusterUpgradeModel","models/fileserver/FileServerCollection","models/docker/DockerCollection","data/DataURLConstants","data/DataProperties","data/DataManager","managers/TaskManager","managers/I18nManager","utils/AppConstants","utils/AppUtil","utils/SubModelHelper","utils/TimeUtil","utils/HypervisorUtil"],function(e,t,i,n,s,a,r,o,l,c,u,d,h,p,T){"use strict";var E=e.extend({entityType:u.ENTITY_UPGRADE_CONFIG,urlRoot:a.UPGRADE_CONFIGURATION,name:"UpgradeConfigurationModel",localTaskManager:null,initialize:function(e,t){if(this.initializeBaseModel(),!t||!t.softwareType)throw new Error("options.softwareType is required.");this.urlRoot=_.template(this.urlRoot,{type:t.softwareType})},url:function(){return this.urlRoot}});return e.extend({STATE_VERSION:"state_version",STATE_UPGRADING:"state_upgrading",STATE_UPLOAD_READY:"state_upload_ready",STATE_UPLOAD_RESET:"state_upload_reset",STATE_UPLOAD_INPROGRESS:"state_upload_inprogress",STATE_UPLOAD_FAILED:"state_upload_failed",STATE_UPLOAD_FINISHED:"state_upload_finished",PC_SW_UPGRADE_MODEL:"PrismCentralSoftwareUpgradeModel",HV_SW_UPGRADE_MODEL:"HypervisorSoftwareUpgradeModel",UPGRADE_PROGRESS_ARRAY:[r.UPGRADE_VERSION_ID,r.UPGRADE_IGNORE_UPGRADE,r.UPGRADE_MANUAL_UPGRADE,r.UPGRADE_IGNORE_PREUPGRADE],urlRoot:a.UPGRADE,entityType:u.ENTITY_UPGRADE,name:"SoftwareUpgradeModel",softwareTypeState:null,xhrUpload:null,$elForm:null,stopStateChange:!1,softwareMetadata:null,isValidateMetadataBeforeUpload:!1,defaults:{state:null,softwareUpgrading:null,currentVersionModel:null,upgradeConfigModel:null,softwareReleases:null,stateUpload:null,upgradeTasks:null,clusterUpgradeModel:null,softwareType:null,versionIdToUpgrade:null,isManualUpgrade:!1,isIgnorePreupgrade:!1,isIgnoreUpgrade:!1,upgradeToMd5sum:null},initialize:function(e,t){if(this.initializeBaseModel(),this.localTaskManager=l,this.localTaskManager.registerHandlerResetStructure(this._onResetTasks,this),!this.getSoftwareType())throw new Error("The softwareType is required.");this.set(r.UPGRADE_SOFTWARE_TYPE,this.getSoftwareType(),{silent:!0});var i=this.createVersionModelInstance(),n=new E(null,{softwareType:this.get(r.UPGRADE_SOFTWARE_TYPE)}),s=this.createSoftwareReleasesModelInstance();this.subModelHelper=new h,this.subModelHelper.register(r.UPGRADE_SOFTWARE_RELEASES,s),this.subModelHelper.register(r.UPGRADE_UPGRADE_CONFIG_MODEL,n),i&&this.subModelHelper.register(r.UPGRADE_VERSION_MODEL,i),this.subModelHelper.attachEventHandler("change",this._onChangeSubModel,this),this.subModelHelper.attachEventHandler("error",this._onErrorSubModel,this),this.subModelHelper.attachEventHandler("reset",this._onResetSubModel,this),this.subModelHelper.attachEventHandler("sync",this._onSyncSubModel,this),this.checkLocalStorage()},createSoftwareReleasesModelInstance:function(){return new t(null,{softwareType:this.get(r.UPGRADE_SOFTWARE_TYPE)})},isVCenterUsed:function(){return T.hasESX()},isSCVMMUsed:function(){return T.hasHyperV()},getSoftwareType:function(){return null},getSoftwareCurrentVersion:function(){return null},createVersionModelInstance:function(){return null},isSoftwareTypeUpgradeRunning:function(){var e=this.getSoftwareType();return this.get(r.UPGRADE_SOFTWARE_UPGRADING)===e||(e===u.UPGRADE_SOFTWARE_TYPE.PRISM_CENTRAL&&(e=u.UPGRADE_SOFTWARE_TYPE.NOS),this.get(r.UPGRADE_SOFTWARE_UPGRADING)===e)},isSoftwareTypeUpgradeCompleted:function(){var e=this.localTaskManager.getGlobalTasks().getUpgradeTasks(this.getSoftwareType());return this._isProgressPresent(e)&&!this.isAnyActiveProgressPresent()},isParallelOperationRunning:function(){return!1},isSingleMetadataFileUpload:function(){return!1},_onErrorSubModel:function(e,t,i){var n="";_.isString(t)?n=t:_.isObject(t)&&t.responseText&&(n=d.processAjaxError(t.responseText)),this.trigger("error",n)},_onChangeSubModel:function(e){e.entityType===u.SYSTEM_VERSION?this.setProperty(r.UPGRADE_VERSION_MODEL,e):e.entityType===u.ENTITY_UPGRADE_CONFIG&&this.setProperty(r.UPGRADE_UPGRADE_CONFIG_MODEL,e)},_onSyncSubModel:function(e){e.entityType===u.ENTITY_UPGRADE_CONFIG&&this.setProperty(r.UPGRADE_UPGRADE_CONFIG_MODEL,e)},_onResetSubModel:function(e){e.entityType===u.ENTITY_SOFTWARE_RELEASE?this.setProperty(r.UPGRADE_SOFTWARE_RELEASES,e):e instanceof n?this.setProperty(r.UPGRADE_VERSION_MODEL,e):e instanceof s&&this.setProperty(r.UPGRADE_VERSION_MODEL,e)},_isProgressPresent:function(e,t){var i=this.localTaskManager.getGlobalTasks().hasActiveUpgradeTasks();if(t)return i||this.isSoftwareTypeUpgradeRunning();if(i)return i;if(e&&1===e.length){var n=_.first(e).get(r.TASK_CREATE_TIME);return p.getDateDiff(n/u.MILLIS_PER_SECOND)<=u.SECONDS_PER_DAY}return e&&e.length},isAnyActiveProgressPresent:function(){return this.localTaskManager.getGlobalTasks().hasActiveUpgradeTasks()},isActiveProgressMyType:function(){return!1},_getSoftwareUpgrading:function(e){return _.find(_.keys(u.TASK_OPERATION_TYPES),function(t){if(u.TASK_OPERATION_TYPES[t]===e)return t})},_onResetTasks:function(e){var t,i,n,s,a;this.setProperty(r.UPGRADE_STATE_UPLOAD,this.STATE_UPLOAD_READY),t=this.localTaskManager.getGlobalTasks().getUpgradeTasks(this.getSoftwareType()),i=this.localTaskManager.getGlobalTasks().getClusterUpgradeTask(this.getSoftwareType()),a=this.hasActiveUploadTasks(),
n=this._isProgressPresent(t);var o=n?this.STATE_UPGRADING:this.STATE_VERSION;if(n){var l=this.localTaskManager.getGlobalTasks().getActiveUpgradeTaskModel()||t[0],c="";c=this._getSoftwareUpgrading(l.get(r.TASK_TYPE)),l.isMulticlusterVMTask&&(c=u.UPGRADE_SOFTWARE_TYPE.NOS),this.set(r.UPGRADE_SOFTWARE_UPGRADING,c),s=this._isProgressPresent(t,this.getSoftwareType()),o=s?this.STATE_UPGRADING:this.STATE_VERSION}this.get(r.UPGRADE_STATE)===o||this.stopStateChange||this.setProperty(r.UPGRADE_STATE,o),t&&t.length&&this.setProperty(r.UPGRADE_TASKS,t),i&&this.setProperty(r.UPGRADE_CLUSTER_UPGRADE_MODEL,i),a&&this.setProperty(r.UPGRADE_STATE_UPLOAD,this.STATE_UPLOAD_INPROGRESS)},fetchUpgradeState:function(){this.localTaskManager.fetchOnDemand()},fetchCurrentVersion:function(){var e=this.subModelHelper.get(r.UPGRADE_VERSION_MODEL);e&&e.fetch()},destroyAll:function(){this.stopPollingSoftwareReleases(),this.subModelHelper.iterate("off"),this.localTaskManager.unregisterHandlerResetStructure(this._onResetTasks,this)},changeStateToUpgrade:function(){this.stopStateChange=!0,this.setProperty(r.UPGRADE_STATE,this.STATE_UPGRADING),this.fetchUpgradeState()},changeStateToVersion:function(){this.stopStateChange=!0,this.setProperty(r.UPGRADE_STATE,this.STATE_VERSION)},isCvmMemoryConfigRunning:function(){var e=this.localTaskManager.getGlobalTasks().getCVMConfigTask();return!(!e||!e.isStatusActive()&&!e.isStatusQueued())},isStateUpgrade:function(){return this.get(r.UPGRADE_STATE)===this.STATE_UPGRADING},isStateVersion:function(){return this.get(r.UPGRADE_STATE)===this.STATE_VERSION},isGlobalUpgradeComplete:function(){var e=this.get(r.UPGRADE_CLUSTER_UPGRADE_MODEL);return!(!e||e.isPreupgradeCheckTask())&&100===e.get(r.TASK_PERCENT_COMPLETE)},isGlobalStatusFailed:function(){var e=this.get(r.UPGRADE_CLUSTER_UPGRADE_MODEL);return e&&e.get(r.TASK_STATUS)===u.TASK_STATUS_FAILED},isGlobalStatusAborted:function(){var e=this.get(r.UPGRADE_CLUSTER_UPGRADE_MODEL);return e&&e.get(r.TASK_STATUS)===u.TASK_STATUS_ABORTED},areGlobalUpgradeProcessesComplete:function(){return(this.isGlobalUpgradeComplete()||this.isGlobalStatusFailed()||this.isGlobalStatusAborted())&&this.isStateUpgrade()&&(!this.isAnyActiveProgressPresent()||this.isActiveProgressMyType())},isPreupgradeCheckFailed:function(){var e=this.getPreupgradeTaskModel();return!(!e||!e.isStatusFailed()&&!e.isStatusAborted())},isManualUpgrade:function(){return this.get(r.UPGRADE_MANUAL_UPGRADE)},getPreupgradeTaskModel:function(){return _.find(this.get(r.UPGRADE_TASKS),function(e){if(e.isPreupgradeCheckTask())return e})},startPollingSoftwareReleases:function(e){this.subModelHelper.get(r.UPGRADE_SOFTWARE_RELEASES).startPolling(e)},stopPollingSoftwareReleases:function(){this.subModelHelper.get(r.UPGRADE_SOFTWARE_RELEASES).stopPolling()},fetchSoftwareReleases:function(e){return this.subModelHelper.get(r.UPGRADE_SOFTWARE_RELEASES).fetch(e)},getSoftwareRelease:function(e){var t=this.get(r.UPGRADE_SOFTWARE_RELEASES);return t?t.get(e):null},resetSoftwareReleases:function(){this.setProperty(r.UPGRADE_SOFTWARE_RELEASES,this.get(r.UPGRADE_SOFTWARE_RELEASES))},deleteSoftwareRelease:function(e){var t=this.getSoftwareRelease(e);if(t){this.stopPollingSoftwareReleases();var i=this;t.destroy({success:function(t,n,s){d.log("SoftwareUpgradeModel : Successfully deleted: "+e),i.startPollingSoftwareReleases({force:!0})},error:function(t,n,s){d.log("SoftwareUpgradeModel : Error in deleting: "+e+" | "+n),i.trigger("error",n),i.resetSoftwareReleases()}})}},downloadSoftwareRelease:function(e){var t=this.getSoftwareRelease(e);if(t){this.stopPollingSoftwareReleases();var i=this;t.download({success:function(t,n,s){d.log("SoftwareUpgradeModel : Successfully started download: "+e),i.startPollingSoftwareReleases({force:!0})},error:function(t,n,s){d.log("SoftwareUpgradeModel : Error in downloading: "+e+" | "+n),i.trigger("error",n),i.resetSoftwareReleases()}})}},cancelTransferSoftwareRelease:function(e){var t=this.getSoftwareRelease(e);if(t){this.stopPollingSoftwareReleases(),this.xhrUpload&&this.xhrUpload.abort&&200!==this.xhrUpload.status&&4!==this.xhrUpload.readyState&&this.xhrUpload.abort();var i=this;t.cancelTransfer({success:function(n,s,a){d.log("SoftwareUpgradeModel : Successfully canceled transfer: "+e),i.startPollingSoftwareReleases({force:!0}),t.get(r.UPGRADE_TRANSFER_TYPE)===u.UPGRADE_TRANSFER_TYPE.UPLOAD&&i.setProperty(r.UPGRADE_STATE_UPLOAD,i.STATE_UPLOAD_READY)},error:function(t,n,s){d.log("SoftwareUpgradeModel : Error in canceled transfer: "+e+" | "+n),i.trigger("error",n),i.resetSoftwareReleases()}})}},fetchUpgradeConfig:function(){this.isAutomaticDownloadEnabled()&&this.subModelHelper.get(r.UPGRADE_UPGRADE_CONFIG_MODEL).fetch()},updateUpgradeConfigAutoDownload:function(e){var t=this.subModelHelper.get(r.UPGRADE_UPGRADE_CONFIG_MODEL),i={};i[r.UPGRADE_ENABLE_AUTOMATIC_DOWNLOAD]=e,t.isNew(!1),t.save(i)},isAutomaticDownloadEnabled:function(){return this.softwareTypeState===u.UPGRADE_SOFTWARE_TYPE_STATE.NOS||this.softwareTypeState===u.UPGRADE_SOFTWARE_TYPE_STATE.PRISM_CENTRAL},uploadSoftwareRelease:function(e){var t=this.validateUploadForm(e,!0);if($.trim(t).length)return this.trigger("error",t),void this.setProperty(r.UPGRADE_STATE_UPLOAD,this.STATE_UPLOAD_READY);d.log("SoftwareUpgradeModel : Start uploading the files...\n Metadata: "+e.find(".inputMetadataFile").val()+"\n "+this.softwareTypeState+" File: "+e.find(".inputFile").val()),this.setProperty(r.UPGRADE_STATE_UPLOAD,this.STATE_UPLOAD_INPROGRESS),this._validateMetadataFile(e)},_validateMetadataFile:function(e){var t=this,i=function(){"undefined"==typeof File?t._uploadMetadataFileLegacyBrowser(e):t._uploadMetadataFile(e)};if(this.isValidateMetadataBeforeUpload){var n=o.getFormattedURL(_.template(a.UPGRADE_VALIDATE_METADATA,{type:this.getSoftwareType()})),s=e.find(".inputMetadataFile")[0],l=s.files[0];$.ajax({type:"POST",url:n,data:l,cache:!1,contentType:"application/octet-stream",processData:!1}).done(function(e){d.log("SoftwareUpgradeModel : Valid metadata file."),i()}).fail(function(e,i,n){var s=d.processAjaxError(e.responseText);d.log("SoftwareUpgradeModel : Invalid metadata file: "+s),t.trigger("error",s),t.setProperty(r.UPGRADE_STATE_UPLOAD,t.STATE_UPLOAD_FAILED)})}else i()},_uploadMetadataFile:function(e){d.log("SoftwareUpgradeModel : Upload metadata file via HTML5 browser.");var t,i=e.find(".inputMetadataFile")[0],n=i.files[0];t=this.isSingleMetadataFileUpload()?o.getFormattedURL(_.template(a.UPGRADE_SINGLE_METADATA_UPLOAD,{type:this.getSoftwareType()})):o.getFormattedURL(a.SERVICE_UTIL_FILE_READER);var s=this;$.ajax({type:"POST",url:t,data:n,cache:!1,contentType:"application/octet-stream",processData:!1}).done(function(t){if(d.log("SoftwareUpgradeModel : Successful metadata upload: "+JSON.stringify(t)),!s.isSingleMetadataFileUpload()){var i=d.processAjaxPrimitive(t);try{i=JSON.parse(i)}catch(e){return s.trigger("error","Metadata parsing error."),void s.setProperty(r.UPGRADE_STATE_UPLOAD,s.STATE_UPLOAD_FAILED)}s.softwareMetadata=i,0===$.trim(e.find(".inputName").val()).length&&e.find(".inputName").val(i.version_id),0===$.trim(e.find(".inputVersion").val()).length&&e.find(".inputVersion").val(i.version_id),0===$.trim(e.find(".inputMD5Sum").val()).length&&(i.md5?e.find(".inputMD5Sum").val(i.md5):e.find(".inputMD5Sum").val(i.hex_md5))}s.uploadNutanixBinaryFile(e)}).fail(function(e,t,i){d.log("SoftwareUpgradeModel : Error in uploading metadata: "+i+" | "+d.processAjaxError(e.responseText)+" | "+e.status),s.trigger("error",d.processAjaxError(e.responseText)),s.setProperty(r.UPGRADE_STATE_UPLOAD,s.STATE_UPLOAD_FAILED)})},uploadNutanixBinaryFile:function(e){d.log("SoftwareUpgradeModel : Upload NOS binary file via HTML5 browser.");var t=this.validateUploadForm(e,!1);if($.trim(t).length)return this.trigger("error",t),void this.setProperty(r.UPGRADE_STATE_UPLOAD,this.STATE_UPLOAD_READY);var i,n,s,a,o,l,c=e.find(".inputFile")[0],h=c.files[0];if(i=e.find(".inputFileSize").val(),l=e.find(".overwrite").is(":checked"),s=e.find(".inputName").val(),n=e.find(".inputOffset").val(),a=e.find(".inputVersion").val(),o=e.find(".inputMD5Sum").val(),i=$.trim(i).length>0?i:h.size,s=$.trim(s).length>0?s:h.name,this.getSoftwareType()===u.UPGRADE_SOFTWARE_TYPE.FOUNDATION){var p=this;d.calculateFileMD5Async(h,{},function(t,i,r){e.find('.inputMD5Sum"]').val(o),p._startUploadFile(t,o,r,s,n,a,h)})}else this._startUploadFile(i,o,l,s,n,a,h);this.fetchSoftwareReleases({force:!0})},_getUploadParams:function(e,t,i,n){return{fileSize:e,md5Sum:t,overwrite:i,fileName:n}},isUploadedVersionCompatible:function(e){},showSoftwareIncompatibleError:function(){},_startUploadFile:function(e,t,i,n,s,l,h){var p=this._getUploadParams(e,t,i,n);$.trim(s).length&&(p.offset=s),$.trim(l).length&&(p.version=l),p=d.formatObjectToQuery(p);var T=this.getSoftwareType(),E=this._getVersionIdForUrl(T,n),S=o.getFormattedURL(_.template(a.UPGRADE_UPLOAD,{id:E,params:p,type:T})),g=this;this.xhrUpload=$.ajax({type:"POST",url:S,data:h,cache:!1,contentType:"application/octet-stream",processData:!1}).done(function(e){d.log("SoftwareUpgradeModel : Successfully Uploaded the file!"),e.status===u.UPGRADE_SOFTWARE_RELEASE_STATUS.MD5SUMMISMATCH&&g.trigger("error",c.ts(g.HV_SW_UPGRADE_MODEL,"md5_upload_error")),g.setProperty(r.UPGRADE_STATE_UPLOAD,g.STATE_UPLOAD_FINISHED),$.when(g.fetchSoftwareReleases({force:!0})).done(function(e){g.isUploadedVersionCompatible(e)||g.showSoftwareIncompatibleError()})}).fail(function(e,t,i){if("abort"===i)return void d.log("SoftwareUpgradeModel : Upload was aborted.");d.log("SoftwareUpgradeModel : Error in uploading file: "+i+" | "+d.processAjaxError(e.responseText)+" | "+e.status),g.trigger("error",d.processAjaxError(e.responseText)),g.setProperty(r.UPGRADE_STATE_UPLOAD,g.STATE_UPLOAD_FAILED),g.fetchSoftwareReleases({force:!0})})},_getVersionIdForUrl:function(e,t){return"hypervisor"===e?encodeURIComponent(encodeURIComponent(t)):encodeURI(t)},_uploadMetadataFileLegacyBrowser:function(e){d.log("SoftwareUpgradeModel : Upload metadata via legacy browser."),this.trigger("error","Upload is currently supported only on IE0+, Chrome and Firefox."),this.setProperty(r.UPGRADE_STATE_UPLOAD,this.STATE_UPLOAD_FAILED)},_uploadNutanixBinaryFileLegacyBrowser:function(e){d.log("SoftwareUpgradeModel : Upload NOS binary file via legacy browser."),this.trigger("error","Upload is currently supported only on IE0+, Chrome and Firefox."),this.setProperty(r.UPGRADE_STATE_UPLOAD,this.STATE_UPLOAD_FAILED)},validateUploadForm:function(e,t){var i="",n=$.trim(e.find(".inputFile").val()),s=$.trim(e.find(".inputMetadataFile").val());if(0===s.length&&(i+="Please select the "+this.softwareTypeState+"\n          metadata file. "),0===n.length&&(i+="Please select the "+this.softwareTypeState+" binary file. "),!s||s.endsWith(u.JSON_SUFFIX)||s.endsWith(u.TXT_SUFFIX)||(i+=c.ts(this.PC_SW_UPGRADE_MODEL,"metadata_file_error")),this.getSoftwareType()===u.UPGRADE_SOFTWARE_TYPE.PRISM_CENTRAL&&n&&!n.endsWith(u.TAR_GZ_SUFFIX)&&(i+=this.i18n("binary_file_error")),!t&&!this.isSingleMetadataFileUpload()&&(0===$.trim(e.find(".inputName").val()).length&&(i+="Invalid name. "),0===$.trim(e.find(".inputMD5Sum").val()).length&&(i+="Invalid md5sum. "),this.softwareMetadata)){e.find(".inputFile")[0].files[0].size!==this.softwareMetadata.size&&(i+="The size of the file to be uploaded does not match the size in the metadata file. You might have chosen the wrong file.")}return i},startUpgrade:function(e){var t=this;d.log("SoftwareUpgradeModel: Start upgrade  | Version ID: "+e.versionId+" | isManualUpgrade: "+e.isManualUpgrade+" | isIgnorePreupgradeTests: "+e.isIgnorePreupgradeTests),this.set({versionIdToUpgrade:e.versionId,isManualUpgrade:e.isManualUpgrade,isIgnorePreupgrade:e.isIgnorePreupgradeTests,isIgnoreUpgrade:e.isIgnoreUpgrade},{silent:!0});var n=new i;n.setRPCParams(e.versionId,e.isManualUpgrade,e.isIgnorePreupgradeTests,e.isIgnoreUpgrade),n.save({success:function(){d.log("SoftwareUpgradeModel : Successfully started upgrade"),e.successCallback&&e.successCallback(),t.stopStateChange=!0,t.setProperty(r.UPGRADE_SOFTWARE_UPGRADING,t.getSoftwareType()),t.setProperty(r.UPGRADE_STATE,t.STATE_UPGRADING),t.fetchUpgradeState()},error:function(i,n){d.log("SoftwareUpgradeModel : Error : "+n),e.errorCallback&&e.errorCallback(),t.trigger("error",n)}})},retryUpgrade:function(){var e=this.getPreupgradeTaskModel();if(e&&e.isStatusFailed()){var t=this.get(r.UPGRADE_VERSION_ID),i=this.get(r.UPGRADE_IGNORE_PREUPGRADE),n=this.get(r.UPGRADE_IGNORE_UPGRADE),s=this.get(r.UPGRADE_MANUAL_UPGRADE);t?this.startUpgrade({versionId:t,isManualUpgrade:s,ignorePreupgrade:i,ignoreUpgrade:n}):d.log("SoftwareUpgradeModel: Version ID is not found.")}else d.log("SoftwareUpgradeModel : You can only retry upgrade if it is in preupgrade check mode that is in failed state.")},checkLocalStorage:function(){for(var e=this.UPGRADE_PROGRESS_ARRAY,t=0;t<e.length;t++)this._setLocalStorageProperty(this,e[t])},_setLocalStorageProperty:function(e,t){d.isLocalStorageProperty(t)&&e.set(t,localStorage[t])},forceFetchSubTasks:function(){var e={data:_defineProperty({},u.TASK_PARAM.HAS_SUBTASK_DETAIL,!0)},t=this.localTaskManager.getGlobalTasks();t.forceFetchTasks(e,t.getFilterCriteriaForDiff())},fetchLatestUpgradeTask:function(e){return e.sort(function(e,t){var i=r.TASK_START_TIME;return t[i]-e[i]}),e.slice(0,1)},hasActiveUploadTasks:function(){return this.localTaskManager.getGlobalTasks().hasActiveUploadTasks()}})}),define("models/fileserver/FileServerUpgradeModel",["models/BaseModel","data/DataURLConstants"],function(e,t){"use strict";var i={UUID:"uuid",VERSION:"version",VERSIONS:"versions"};return e.extend({urlRoot:t.FILE_SERVER_UPGRADE_ALL,name:"FileServerUpgradeModel",DP:i,addUpgradeOp:function(e,t){var n=this.get(i.VERSIONS)||[],s={};s[i.UUID]=e,s[i.VERSION]=t,this.set(i.VERSIONS,n.concat(s))},toJSON:function(){return(this.get(i.VERSIONS)||[]).map(function(e){var t={};return t[e[i.UUID]]=e[i.VERSION],t})}},{DP:i})}),define("models/softwareupgrade/FileServerSoftwareUpgradeModel",["models/softwareupgrade/SoftwareUpgradeModel","models/fileserver/FileServerCollection","models/fileserver/FileServerUpgradeModel","data/DataProperties","managers/ClusterManager","utils/AppConstants","utils/AppUtil"],function(e,t,i,n,s,a,r){"use strict";return e.extend({name:"FileServerSoftwareUpgradeModel",softwareTypeState:a.UPGRADE_SOFTWARE_TYPE_STATE.FILE_SERVER,isValidateMetadataBeforeUpload:!0,initialize:function(){e.prototype.initialize.apply(this,arguments);var t=s.getCurrentClusterModel();t&&t.on("change",function(){this.trigger("change.softwareReleases")},this)},getSoftwareType:function(e){return a.UPGRADE_SOFTWARE_TYPE.FILE_SERVER},createVersionModelInstance:function(){return new t},startPollingSoftwareReleases:function(){e.prototype.startPollingSoftwareReleases.apply(this,arguments),s.getCurrentClusterModel().fetch()},getSoftwareCurrentVersion:function(){return this.getFSVersions().join(", ")},getFSVersions:function(){var e=this.subModelHelper.get(n.UPGRADE_VERSION_MODEL);return e?e.chain().map(function(e){return e.get(e.DP.VERSION)}).filter(function(e){return e}).uniq().sort(function(e,t){return r.compareVersions(e,t)}).value():[]},getFSNameVersionMap:function(){var e={},t=this.subModelHelper.get(n.UPGRADE_VERSION_MODEL);return t&&t.each(function(t){var i=t.get(t.DP.NAME),n=t.get(t.DP.VERSION);n&&(-1===n.indexOf("master")&&(n=r.extractVersionNumber(n)),e[i]=n)}),e},hasDeployedFileServers:function(){return this.subModelHelper.get(n.UPGRADE_VERSION_MODEL).some(function(e){return e.get(e.DP.VERSION)})},isCompatibleWithCurrentNos:function(e){var t=this.subModelHelper.get(n.UPGRADE_SOFTWARE_RELEASES),i=t.find(function(t){return 0===r.compareVersions(t.get(n.VERSION)||"",e)}),a=s.getCurrentClusterModel();if(i){var o=a.get(n.VERSION);return!o||_.some(i.get(n.UPGRADE_COMPATIBLE_NOS_VERSIONS),function(e){return 0===r.compareVersions(o,e)})}return!0},getLatestCompatibleFSRelease:function(e){var t;return this.subModelHelper.get(n.UPGRADE_SOFTWARE_RELEASES).each(function(i){if(_.some(i.get(n.UPGRADE_COMPATIBLE_NOS_VERSIONS),function(t){return 0===r.compareVersions(t,e)})){var s=i.get(n.VERSION)||"";(!t||r.compareVersions(s,t)>0)&&(t=s)}}),t},getMinimalNosVersion:function(e){var t=this.subModelHelper.get(n.UPGRADE_SOFTWARE_RELEASES),i=t.find(function(t){return 0===r.compareVersions(t.get(n.VERSION)||"",e)}),s=i&&i.get(n.UPGRADE_COMPATIBLE_NOS_VERSIONS);return s&&s.length>0?s.sort(function(e,t){return 0===r.compareVersions(e,t)?e.indexOf("*")>-1?1:-1:r.compareVersions(e,t)})[0]:""},isUpgradableFromCurrentFS:function(e){var t=this.subModelHelper.get(n.UPGRADE_SOFTWARE_RELEASES),i=t.find(function(t){return 0===r.compareVersions(t.get(n.VERSION)||"",e)}),s=i.get(n.UPGRADE_COMPATIBLE_VERSIONS),a=this.getFSVersions(),o=_.reduce(a,function(e,t){return r.compareVersions(e,t)>0?t:e});return!!o&&(s?_.some(s,function(e){return 0===r.compareVersions(o,e)}):0!==r.compareVersions(o,e))},startUpgrade:function(e){var t=this;r.log("FileServerSoftwareUpgradeModel: Start File Server upgrade  | Version ID: "+e.versionId+" | isManualUpgrade: "+e.isManualUpgrade+" | isIgnorePreupgradeTests: "+e.isIgnorePreupgradeTests),this.set({versionIdToUpgrade:e.versionId,isManualUpgrade:e.isManualUpgrade,isIgnorePreupgrade:e.isIgnorePreupgradeTests,isIgnoreUpgrade:e.isIgnoreUpgrade},{silent:!0});var s=new i,o=this.subModelHelper.get(n.UPGRADE_VERSION_MODEL);o&&o.length>0&&(o.each(function(t){!1!==t.get(t.DP.PD_STATUS)&&s.addUpgradeOp(t.get(n.UUID),e.versionId)}),s.entityType=a.ENTITY_UPGRADE,s.save({},{success:function(){r.log("FileServerSoftwareUpgradeModel : Successfully started upgrade"),e.successCallback&&e.successCallback(),t.stopStateChange=!0,t.setProperty(n.UPGRADE_SOFTWARE_UPGRADING,t.getSoftwareType()),t.setProperty(n.UPGRADE_STATE,t.STATE_UPGRADING),t.fetchUpgradeState()},error:function(i,n){r.log("FileServerSoftwareUpgradeModel : Error : "+n),e.errorCallback&&e.errorCallback(),t.trigger("error",n)}}))}})}),define("models/managementserver/ManagementServerInfoModel",["models/BaseModel","data/DataURLConstants","utils/AppConstants"],function(e,t,i){"use strict";var n={REGISTERED:"registered"};return e.extend({urlRoot:t.MANAGEMENT_SERVER_INFO,entityType:i.ENTITY_MANAGEMENT_SERVER_INFO,name:"ManagementServerInfoModel",DP:n},{DP:n})}),define("models/managementserver/ManagementServerInfoCollection",["models/PollingCollection","models/managementserver/ManagementServerInfoModel","data/DataURLConstants"],function(e,t,i){"use strict";return e.extend({model:t,url:i.MANAGEMENT_SERVER_INFO,name:"ManagementServerInfoCollection"})}),define("models/fileserver/UserMappingModel",["models/MinervaModel","utils/AppConstants","data/DataURLConstants"],function(e,t,i){"use strict";var n={FILE_SERVER_UUID:"fileServerUuid",RULE_BASED_MAPPING:"ruleBasedMapping",TEMPLATE_MAPPING:"templateMapping",NFS_WITH_NO_MAPPINGS:"nfsWithNoMappings",SMB_WITH_NO_MAPPINGS:"smbWithNoMappings",MAPPING_TYPE:"mappingType",NAME:"name",ACTION_TYPE:"actionType",GID:"gid",UID:"uid",EXPLICIT_MAPPING:"explicitMapping",MAPPING_DTO:"mappingDTO",NFS_MAPPING:"nfsMapping",SMB_MAPPING:"smbMapping",PRIORITY:"priority",ONE_TO_ONE_MAPPING_LIST:"oneToOneMappingList",WILD_CARD_MAPPING_LIST:"wildCardMappingList",DENIED_ACCESS_NFS_GROUPS:"deniedAccessNfsGroups",DENIED_ACCESS_NFS_USERS:"deniedAccessNfsUsers",DENIED_ACCESS_SMB_GROUPS:"deniedAccessSmbGroups",DENIED_ACCESS_SMB_USERS:"deniedAccessSmbUsers"};return e.extend({DP:n,urlRoot:i.FILE_SERVER_USER_MAPPINGS,name:"UserMappingModel",entityType:t.ENTITY_USER_MAPPINGS,getURL:function(e){return _.template(i.FILE_SERVER_USER_MAPPINGS,{uuid:this.get(this.DP.FILE_SERVER_UUID)})},getRuleBasedMapping:function(){return this.get(this.DP.RULE_BASED_MAPPING)},getExplicitMapping:function(){return this.get(this.DP.EXPLICIT_MAPPING)},getRuleBasedMappingDetail:function(e){var t=this.getRuleBasedMapping();if(t)return t[e]},getExplicitMappingDetail:function(e){var t=this.getExplicitMapping();if(t)return t[e]}})}),define("utils/FileServerUtil",["managers/NavigationManager","managers/NotificationManager","managers/TaskManager","managers/I18nManager","models/fileserver/UserMappingModel","data/DataProperties","utils/AppUtil","utils/ValidationUtil","utils/AppConstants"],function(e,t,i,n,s,a,r,o,l){"use strict";return{name:"FileServerUtil",getFileServerAndShareUuidsFromPageRoute:function(t){var i=e.getCurrentPageRoute().options,n=r.parseQueryToObject(i);if(n&&(n.actionParentId||n.actionTargetId)&&(t||n.actionTargetId))return{fsUuid:n.actionParentId||n.actionTargetId.split(":")[0],shareId:t||n.actionTargetId.split(":")[1]}},copyToClipboard:function(e){var i=this,n=document.createRange(),s=void 0;if(window.clipboardData)window.clipboardData.setData("Text",e);else{var a=$('<div class="copyToClipboardElem">');a.css({position:"absolute",left:"-1000px",top:"-1000px"}),a.html(e),$("body").append(a),n.selectNodeContents(a.get(0)),s=window.getSelection(),s.removeAllRanges(),s.addRange(n);try{document.execCommand("copy",!1,null)}catch(n){t.showClientNotification(l.NOTIFY_ERROR,i.i18n("copy_message")+e)}finally{a.remove()}}},compareAFSversion:function(e,t){var i=0,n=e&&(e.get(e.DP.VERSION)||e.get(e.DP.OBJECT_VERSION));return n&&(i=r.compareVersions(n,t)),i},getGlobalTaskList:function(){return i.getGlobalTasks()},checkSpaceInString:function(e){var t=e.split(",");return!!_.find(t,function(e){return e=e.trimLeft().trimRight(),e.indexOf(" ")>-1})},setHelpLinkAfsVersion:function(e,t,i){var n=i.get(i.DP.VERSION)||i.get(i.DP.OBJECT_VERSION);t[l.NAV_ACTION_CONTEXT_ID]=l.DOCS_HELP_SOFTWARE_TYPE_AFS,t[l.NAV_ACTION_TARGET_VERSION]=this.getHelpLinkAfsVesion(n),e.updateHelpButton(t)},getHelpLinkAfsVesion:function(e){return(e=e&&e.split("-")&&e.split("-")[0])&&e.split(".").slice(0,2).join(".")},checkTaskStatus:function(e,t,i){var n=this.getGlobalTaskList(),s=!1,r=e.get(e.DP.UUID);return i&&(r=i),_.each(n.models,function(e){var i=e.get(a.TASK_ENTITY_ID);e.get(a.TASK_STATUS)===l.TASK_STATUS_ACTIVE&&i&&i.indexOf(r)>-1&&(s=this.checkTaskProgress(e,t))},this),s},checkTaskProgress:function(e,t){var i=!1;return e.get(a.TASK_TYPE)===t&&(i=!0),i},getActiveTask:function(e){var t=i.getGlobalTasks().find(function(t){return t.get(a.TASK_TYPE)===e});if(t&&!t.isTaskCompleted())return t.get(a.TASK_ID)},getFSTableTemplate:function(e,t,i,s){return'\n          <section data-ntnx-section>\n            <span class="title secondary">\n              <span class="'+e+'"></span>\n                <% if (!'+s+') { %>\n                  <a class="'+t+" pull-right add-link\">\n                    <%= Components.icon('plus', '-small -inline') %>\n                  <span class=\"btn-content\">"+n.t("FileServerUtil",i)+'</span>\n                  </a>\n                <% } else { %>\n                  <div class="pull-right">\n                    <a class="'+t+' add-link">\n                     '+n.t("FileServerUtil",i)+'\n                    </a>\n                    <a class="uploadCsv upload-csv add-link">\n                     '+n.t("FileServerUtil","change_file")+'\n                    </a>\n                  </div>\n                <% } %>\n            </span>\n          </section>\n          <section data-ntnx-section>\n            <div class="antiscroll-wrap">\n              <div class="box-wrap">\n                <div class="antiscroll-inner">\n                  <div class="box-inner">\n                    <table class="table table-data-items table-input">\n                      <thead><tr>\n                          <% _.each(columns, function(column) { %>\n                            <th><%= column.columnName %></th>\n                          <% }); %>\n                          <% if (isActionEnabled) { %>\n                            <th><%= i18n(\'actions\') %></th>\n                          <% } %>\n                        </tr></thead>\n                      <tbody></tbody>\n                    </table>\n                  </div>\n                </div>\n              </div>\n            </div>\n          </section>'},getNfsProtocol:function(e){return e.getServerIP()?l.NFS_PROTOCOL_TYPE.LDAP:e.getLocalDetailsProtocolType()===l.FS_PROTOCOLS.NFS?l.NFS_PROTOCOL_TYPE.UNMANAGED:l.NFS_PROTOCOL_TYPE.AD},getMappingSuggestion:function(e){var t=this.getNfsProtocol(e),i=t===l.NFS_PROTOCOL_TYPE.LDAP?n.t("FileServerUtil","name_to_name"):n.t("FileServerUtil","name_to_id");return n.t("FileServerUtil","rec_mapping")+':\n          <span class="title-weight">'+i+"</span>"},validateWildcardSmbUser:function(e){var t=this,i="",s=_.find(e.split("\\"),function(e){return t.isStarInMiddle(e)||t.isStarRepeated(e)});return(this.smbUserNameCheck(e)||s||"*"===e||"/"===e)&&(i+=n.t("FileServerUtil","wrong_smb_user")),i},smbUserNameCheck:function(e){var t=e.split("\\").length,i=e.indexOf("\\");return 1===t||t>2||0===i||i===e.length-1||"*\\*"===e||e.indexOf("@")>=0},validateWildcardNfsUser:function(e){var t="";return(e.indexOf("@")>=0||"*"===e||"*"===e||"/"===e||this.isStarInMiddle(e)||this.isNumberWithWildcard(e)||this.isStarRepeated(e))&&(t+=n.t("FileServerUtil","wrong_nfs_user")),this.isInt32Num(e)||(t+=n.t("FileServerUtil","wrong_nfs_id")),t},isNumberWithWildcard:function(e){return e.indexOf("*")>-1&&o.isNumber(e.split("*").join("")).valid},isStarInMiddle:function(e){return e.indexOf("*")>0&&e.indexOf("*")<e.length-1},isStarRepeated:function(e){return e.indexOf("*")!==e.lastIndexOf("*")},validateSmbUser:function(e){var t="";return(this.smbUserNameCheck(e)||e.indexOf("*")>=0)&&(t+=n.t("FileServerUtil","wrong_smb_user")),t},parseCSV:function(e,t){var i=this;this.clearHeader();var n=new FileReader;n.onload=function(e){var n=e.target.result.split(/\r\n|\n/);n.shift(),n=_.filter(n,function(e){return 3===e.split(",").length});var s=i.validateCSVFile(n);if(s.isValid){var a={};a.title=i.$(".filename")[0].title,a.rows=n.length,a.lines=n,t(a)}else i.showError(i.i18ns("invalid_file",s.lineNumber))},n.readAsText(e)},getFsNfsProtocol:function(e){var t=e.getValue(e.DP.NAME_SERVICE_CONFIG+"."+e.DP.AD_DETAILS),i=t&&t[e.DP.PROTOCOL_TYPE];if(i===l.FS_PROTOCOLS.NFS||i===l.FS_PROTOCOLS.NFS_SMB)return l.NFS_PROTOCOL_TYPE.AD;var n=e.getValue(e.DP.NAME_SERVICE_CONFIG+"."+e.DP.LDAP_DETAILS);if(n&&n[e.DP.SERVER_IP])return l.NFS_PROTOCOL_TYPE.LDAP;var s=e.getValue(e.DP.NAME_SERVICE_CONFIG+"."+e.DP.LOCAL_DETAILS);return(s&&s[e.DP.PROTOCOL_TYPE])===l.FS_PROTOCOLS.NFS?l.NFS_PROTOCOL_TYPE.UNMANAGED:void 0},validateNfsUser:function(e){var t="";return(e.indexOf("*")>=0||e.indexOf("@")>=0)&&(t+=n.t("FileServerUtil","wrong_nfs_user")),this.isInt32Num(e)||(t+=n.t("FileServerUtil","wrong_nfs_id")),t},isInt32Num:function(e){var t=1;return 8211===e.charCodeAt(0)&&(e=e.substr(1),t=-1),!(!isNaN(e)&&((e*=t)>l.INT32.MAX||e<l.INT32.MIN))},deletFsUserMapping:function(e,i){var a=new s;a.set(a.DP.FILE_SERVER_UUID,e);var r={};a.set(r),a.save(null,{success:function(e,s){t.showClientNotification(l.NOTIFY_SUCCESS,n.t("FileServerUtil","delete_user_mapping_message")),i&&_.isFunction(i)&&i()},error:function(e,i){t.showClientNotification(l.NOTIFY_ERROR,n.t("FileServerUtil","delete_user_mapping_error"))}})},isUserMappingConfigured:function(e){var t=[e.getExplicitMappingDetail(e.DP.DENIED_ACCESS_SMB_USERS),e.getExplicitMappingDetail(e.DP.DENIED_ACCESS_SMB_GROUPS),e.getExplicitMappingDetail(e.DP.DENIED_ACCESS_NFS_USERS),e.getExplicitMappingDetail(e.DP.DENIED_ACCESS_NFS_GROUPS),e.getExplicitMappingDetail(e.DP.ONE_TO_ONE_MAPPING_LIST),e.getExplicitMappingDetail(e.DP.WILD_CARD_MAPPING_LIST),e.getRuleBasedMappingDetail(e.DP.NFS_WITH_NO_MAPPINGS),e.getRuleBasedMappingDetail(e.DP.SMB_WITH_NO_MAPPINGS)],i=e.getRuleBasedMappingDetail(e.DP.TEMPLATE_MAPPING);return!(!_.find(t,function(e){return e&&e.length})&&!i)},isSmbOnly:function(e){return this.supportNfsOrSmbOnly(e,l.FS_PROTOCOLS.SMB)},isNfsOnly:function(e){return this.supportNfsOrSmbOnly(e,l.FS_PROTOCOLS.NFS)},supportNfsOrSmbOnly:function(e,t){var i=e.getProtocolType(),n=e.getLocalDetailsProtocolType(),s=e.getServerIP();return t===l.FS_PROTOCOLS.SMB?!(i!==l.FS_PROTOCOLS.SMB||s||n!==l.FS_PROTOCOLS.NONE&&n):i!==l.FS_PROTOCOLS.SMB&&(s||n!==l.FS_PROTOCOLS.NONE)}}}),define("text!templates/wizards/fileserver/FileServerDefinePage.html",[],function(){return'<div class="n-modal-content">\n  <div data-ntnx-content-inner>\n    <form class="fs-fileServerDefineForm">\n      <% if (isSupportSpectre) { %>\n        <section data-ntnx-section="type-half">\n      <% } else {%>\n        <section data-ntnx-section="type-text">\n      <% } %>\n        <label data-ntnx-label for="fsName">\n          <%= i18n("name") %>\n          <span class="nutanixMoreInfo"\n            data-tooltip-classes="-nudge-up"\n            data-tooltip-container="body"\n            data-tooltip-title="<%= i18n(\'formTxt.name_placeholder\') %>">\n          </span>\n          <span id="lblAlertFsName" data-ntnx-label-flag class="fs-name-alert">\n          </span>\n        </label>\n        <input type="text" class="fsName" id="fsName"\n          maxlength="15" value="<%= name %>">\n      </section>\n      <% if (isSupportSpectre) { %>\n        <section data-ntnx-section="type-half">\n          <label data-ntnx-label for="realmName"><%= i18n(\'domain\') %></label>\n          <input type="text" class="realmName" id="realmName"\n            placeholder="<%= i18n(\'formTxt.domain_placeholder\') %>">\n        </section>\n      <% } %>\n\n      <section data-ntnx-section="type-subtitle">\n        <%= i18n(\'qualified_domain\') %><span class="fqdnText fqdn-text"></span>\n        <span class="nutanixMoreInfo"\n          data-tooltip-classes="-nudge-up"\n          data-tooltip-container="body"\n          data-tooltip-title="<%= i18n(\'formTxt.fqdn_tooltip\') %>">\n        </span>\n      </section>\n      <section data-ntnx-section>\n        <label  data-ntnx-label for="fsSize">\n          <%= i18n("formTxt.file_server_size_txt") %>\n        </label>\n        <input type="number" class="fsSize" id="fsSize" value="<%= size %>"\n          min="1"/>\n        <span class="memory-unit">TiB</span>\n      </section>\n\n      \x3c!-- Configuration list table --\x3e\n      <section data-ntnx-section="type-separator">\n        <h5 data-ntnx-title><%= i18n(\'capacity_configuration\') %></h5>\n        <div data-ntnx-section="type-text">\n          <%= i18n(\'capacity_descrition\') %>\n        </div>\n        <section data-ntnx-section="type-text">\n            <span class="configDetails"></span>\n            <a data-ntnx-label-flag class="customConfiguration pull-right"\n              action="show" actiontarget="file_server">\n              <%= i18n("formTxt.custom_config_txt") %>\n            </a>\n        </section>\n        <section data-ntnx-section="type-subtitle">\n          <table id="configurationList" class="table table-hover">\n            <thead>\n            <tr>\n              <th><%= i18n("formTxt.file_server_vms") %></th>\n              <th><%= i18n("formTxt.vcpu_per_vm") %></th>\n              <th><%= i18n("formTxt.memory_per_vm") %></th>\n            </tr>\n            </thead>\n            <tbody>\n            <tr class="n-table-row">\n              \x3c!-- Number of File Server VMs item--\x3e\n              <td class="fsNumVms">\n                <%=fsVms%>\n              </td>\n              <td class="fsNumVcpus">\n                <%=vcpus%>\n              </td>\n              <td class="fsNumMemory">\n                <%=memory%> GB\n              </td>\n            </tr>\n            </tbody>\n          </table>\n        </section>\n        <section data-ntnx-section="type-text">\n          <%= i18n("performance_hint") %>\n        </section>\n      </section>\n      \x3c!-- empty space in bottom of the form --\x3e\n      <section data-ntnx-section="type-text"></section>\n    </form>\n  </div>\n</div>\n'}),define("text!extras/file_server_config.json",[],function(){
return'{\n  "default": {\n    "multi_node": [{\n      "connections": 750,\n      "throughput" : 270,\n      "numNvm"     : 3,\n      "numCpu"     : 4,\n      "memory"     : 12\n    }],\n    "single_node": [{\n      "connections": 250,\n      "throughput" : 270,\n      "numNvm"     : 1,\n      "numCpu"     : 4,\n      "memory"     : 12\n    }]\n  },\n  "configurations": [\n    {\n      "connections": 250,\n      "throughput" : 270,\n      "numCpu"     : 4,\n      "memory"     : 12\n    },\n    {\n      "connections": 500,\n      "throughput" : 270,\n      "numCpu"     : 4,\n      "memory"     : 16\n    },\n    {\n      "connections": 1000,\n      "throughput" : 270,\n      "numCpu"     : 6,\n      "memory"     : 24\n    },\n    {\n      "connections": 1500,\n      "throughput" : 270,\n      "numCpu"     : 6,\n      "memory"     : 32\n    },\n    {\n      "connections": 2000,\n      "throughput" : 270,\n      "numCpu"     : 8,\n      "memory"     : 40\n    },\n    {\n      "connections": 2500,\n      "throughput" : 270,\n      "numCpu"     : 8,\n      "memory"     : 60\n    },\n    {\n      "connections": 4000,\n      "throughput" : 270,\n      "numCpu"     : 12,\n      "memory"     : 96\n    }\n  ],\n  "allowedValuesCpu": ["4", "6", "8", "10", "12"],\n  "allowedValuesMemory": ["12", "16", "24", "32", "40", "48", "64", "96"]\n}'}),define("views/wizards/fileserver/FileServerDefinePage",["views/basecomponents/wizards/BaseWizardPage","models/fileserver/FileServerModel","managers/PopupManager","data/DataProperties","utils/SVG","utils/AppConstants","utils/AppUtil","utils/StatsUtil","utils/FileServerUtil","text!templates/wizards/fileserver/FileServerDefinePage.html","text!extras/file_server_config.json"],function(e,t,i,n,s,a,r,o,l,c,u){"use strict";var d=_.template("<%=supportTxt%>: <span><%=connections%></span> <%=connectionTxt%> <span><%=throughput%> MBPS</span> <%=throughputTxt%>");return e.extend({name:"FileServerDefinePage",events:{"keydown  .fs-num-nvms":"onKeyDown","keydown  .fsSize":"onFileServeSizeKeyDown","input    .fsSize":"onChangeFSSize","click    .customConfiguration":"customConfiguration","keyup     .fsName":"onKeyupFsName","keyup     .realmName":"onKeyupRealmName"},template:_.template(c),initialize:function(i){e.prototype.initialize.apply(this,arguments),this.model?this.model=this.model[0]:this.model=new t,this.fsSupportNFS=l.compareAFSversion(this.model,a.FILE_SERVER_VERSIONS.SPECTRE)>=0,this.fsSupportThreeDotOne=l.compareAFSversion(this.model,a.FILE_SERVER_VERSIONS.THREE_DOT_ONE)>=0},onKeyDown:function(e){e.preventDefault()},render:function(){if(this.isViewRendered)return void this.$(".nutanixMoreInfo").nutanixMoreInfo({parseDataAttrs:!0});this.renderViewDetails();var e=this;setTimeout(function(){e.$(".fsName").focus()},400),this.$(".nutanixMoreInfo").nutanixMoreInfo({parseDataAttrs:!0}),this.isViewRendered=!0,this.$(".n-tooltip-name").tooltip({title:this.i18n("file_server_name_message"),placement:"right",trigger:"hover",html:!0,animation:!1})},canEnablePageLink:function(){return!1},getButtonLabel:function(e){return e<0?a.BUTTON.BACK:null},onPageTransition:function(e){var t,i,n=$.trim(this.$(".fsName").val()),s=Number($.trim(this.$(".fsSize").val())),a=$.trim(this.$(".realmName").val()),l=null,c=[];if($("table#configurationList > tbody > tr > td").each(function(){c.push($(this).text().trim())}),t=c[0],i=c[1],l=c[2].split(" ")[0],this.validateAndHandleError(n,s,a))this.$(".nutanixMoreInfo").nutanixMoreInfo({parseDataAttrs:!0});else{var u=o.convertBytesToUnit(o.convertToBytes(s,o.UOM_TIB,!1),o.UOM_GIB,!1);this.model.set({dnsDomainName:a,name:n,numCalculatedNvms:t,numVcpus:i,memoryGiB:l,sizeGib:r.formatInt(u)}),e()}},onPageCancel:function(){return!0},renderViewDetails:function(){var e,t,i,a,o,l;try{e=JSON.parse(u)}catch(t){r.log(this.i18n("fileServerSizingJsonParsingError")+t),e=[]}var c=e.default.multi_node,h=this.clusterManager.getCurrentClusterModel().get(n.CLUSTER_NUM_NODES);this.fsSupportThreeDotOne&&h<3&&(c=e.default.single_node),_.each(c,function(e){t=e.numNvm,i=e.numCpu,a=e.memory,o=e.connections,l=e.throughput});var p=this.template(this.vtOptions({name:"",size:"",numNvms:3,model:this.model,noOfHosts:this.model.getNumberOfHost(),questionIcon:s.SVGIcon("Question_Mark","-inline -mini"),fsVms:t,vcpus:i,memory:a,isSupportSpectre:this.fsSupportNFS}));this.$el.html(p);var T=d({connections:o,throughput:l,supportTxt:this.i18n("configTxt.performance_txt"),connectionTxt:this.i18n("configTxt.connection_txt"),throughputTxt:this.i18n("configTxt.throughput_txt")});$(".configDetails").html(T),this.$el.addClass("fs-fileServerDefinePage")},validateAndHandleError:function(e,t,i){var n=this.model.validateName(e),s=this.model.validateFsSize(t),a="",r="";if(this.fsSupportNFS&&(i.length?i&&-1===i.indexOf(".")&&(a=this.i18nsStatic("FileServerModel","invalid_field_msg","domain name")):a=this.i18n("miss_domain_name_message")),e.length||(r=this.i18n("miss_fs_name_message")),n||s||a){var o=this.combineErrorMsg(n,s,a,r);this.getWizard().setCurrentPageTitleError(),n?this.$(".fsName").addClass("error-class"):this.$(".fsName").removeClass("error-class"),s?this.$(".fsSize").addClass("error-class"):this.$(".fsSize").removeClass("error-class"),a?this.$(".realmName").addClass("error-class"):this.$(".realmName").removeClass("error-class"),this.showError(o),this.getWizard().setCurrentPageTitleError()}else this.getWizard().clearCurrentPageTitleError(),this.$(".fsName, .fsSize, .realmName").removeClass("error-class");return n+s+a},combineErrorMsg:function(){var e=[],t=Array.prototype.slice.call(arguments),i="";return _.each(t,function(t){t&&e.push(t)}),e.length&&(i=e.join("<br/>")),i},onFileServeSizeKeyDown:function(e){187!==e.which&&189!==e.which&&109!==e.which||e.preventDefault()},onChangeFSSize:function(){var e=Number($.trim(this.$(".fsSize").val()));if(!this.model.validateFsSize(e)){var t=this.model.compareFsSizeWithClusterSize(e);t?this.showWarning(t):this.clearHeader()}},customConfiguration:function(){i.handleAction({action:a.ACTION_SHOW,actionTarget:a.ENTITY_FILE_SERVER,actionSupportNFS:this.fsSupportNFS,fsSupportThreeDotOne:this.fsSupportThreeDotOne}),this.onPageCancel(),this.theWizard.$el.hide()},onSaveConfiguration:function(e){if(""!==e){var t=null,i=e.attributes;$(".fsNumVms").html(i.numCalculatedNvms),$(".fsNumVcpus").html(i.numVcpus),$(".fsNumMemory").html(i.memoryGiB+" GB"),i.customConfiguration?(t=d({connections:i.customConfiguration.connections,throughput:i.customConfiguration.throughput,supportTxt:this.i18n("configTxt.support_txt"),connectionTxt:this.i18n("configTxt.connection_txt"),throughputTxt:this.i18n("configTxt.throughput_txt")}),$(".configDetails").html(t),$(".configDetails").show()):$(".configDetails").hide()}},onKeyupFsName:function(){var e=this.$("#lblAlertFsName"),t=this.$(".fsName").val().trim();_.find(this.theWizard.fileServers.models,function(e){return e.get(e.DP.NAME)===t})?(e.html(this.i18n("duplicate_fs_name")),this.$(".fsName").addClass("error-class"),this.disableNextButton()):(e.html(""),this.$(".fsName").removeClass("error-class"),this.enableNextButton()),this.onKeyupRealmName()},onKeyupRealmName:function(){var e=$.trim(this.$(".fsName").val()),t=$.trim(this.$(".realmName").val());this.$(".fqdnText").html("("+e+"."+t+")")}})}),define("text!templates/wizards/fileserver/CloneFileServerDefinePage.html",[],function(){return'<div class="n-modal-content">\n  <div data-ntnx-content-inner>\n    <form class="fs-fileServerDefineForm">\n      <section data-ntnx-section>\n        <h5 data-ntnx-title><%= heading %></h5>\n        <section data-ntnx-section>\n          <% if (isSupportSpectre) { %>\n            <section data-ntnx-section="type-half">\n          <% } else {%>\n            <section data-ntnx-section">\n          <% } %>\n            <label data-ntnx-label for="fsName"><%= name %></label>\n            <input type="text" class="fsName" id="fsName"\n              placeholder="<%= maxLengthLimitMsg %>"\n              maxlength="15" value="">\n          </section>\n          <% if (isSupportSpectre) { %>\n            <section data-ntnx-section="type-half">\n              <label data-ntnx-label for="realmName"><%= domain %></label>\n              <input type="text" class="realmName" id="realmName"\n                placeholder="<%= domainMsg %>">\n            </section>\n          <% } %>\n        </section>\n      </section>\n    </form>\n  </div>\n</div>'}),define("views/wizards/fileserver/CloneFileServerDefinePage",["views/basecomponents/wizards/BaseWizardPage","utils/AppConstants","utils/FileServerUtil","text!templates/wizards/fileserver/CloneFileServerDefinePage.html"],function(e,t,i,n){"use strict";return e.extend({name:"CloneFileServerDefinePage",template:_.template(n),initialize:function(n){e.prototype.initialize.apply(this,arguments),this.model=this.model[0],this.fsSupportNFS=i.compareAFSversion(this.model,t.FILE_SERVER_VERSIONS.SPECTRE)>=0},onPageTransition:function(e){var t=this.$(".fsName").val().trim(),i=$.trim(this.$(".realmName").val());this.validateAndHandleError(t,i)||(this.model.set({dnsDomainName:i,name:t,pdName:""}),e())},render:function(){if(!this.isViewRendered){var e=this.template({heading:this.i18n("heading"),name:this.i18n("name"),maxLengthLimitMsg:this.i18n("max_length_limit"),domain:this.i18n("domain"),domainMsg:this.i18n("domain_placeholder"),model:this.model,isSupportSpectre:this.fsSupportNFS});this.$el.html(e),this.$el.addClass("clone-file-server"),this.isViewRendered=!0}},validateAndHandleError:function(e,t){var i="",n="";this.$(".fsName, .realmName").removeClass("error-class"),this.fsSupportNFS&&(t.length?-1===t.indexOf(".")&&(n=this.i18nsStatic("FileServerModel","invalid_field_msg","domain name")):n=this.i18n("miss_domain_name_message")),e.length||(i=this.i18n("miss_fs_name_message"));var s=i+n;return i||n?(i&&n?this.$(".fsName, .realmName").addClass("error-class"):i?this.$(".fsName").addClass("error-class"):n&&this.$(".realmName").addClass("error-class"),this.showError(s),this.getWizard().setCurrentPageTitleError()):(this.getWizard().clearCurrentPageTitleError(),this.$(".fsName").removeClass("error-class")),s},onPageCancel:function(){return!0}})}),define("models/dataprotection/SnapshotModel",["models/BaseModel","data/DataManager","data/DataURLConstants","data/DataProperties","utils/AppConstants"],function(e,t,i,n,s){"use strict";var a={VM_NAMES:"vmNames",VG_UUIDS:"volumeGroupUuids",REPLACE:"replace",PATH_PREFIX:"pathPrefix",SNAPSHOT_ID:"snapshotId",VM_NAME_PREFIX:"vmNamePrefix",VG_NAME_PREFIX:"vgNamePrefix"};return e.extend({defaults:{protectionDomainName:null,snapshotId:null,snapshotCreateTimeUsecs:null,snapshotExpiryTimeUsecs:null,oobScheduleIds:[],state:null,consistencyGroups:null,vms:null,nfsFiles:null,locatedRemoteSiteName:null},urlRoot:i.SNAPSHOT,nameAttribute:n.SNAP_ID,name:"SnapshotModel",entityType:s.ENTITY_SNAPSHOT,initialize:function(t,i){if(e.prototype.initialize.apply(this,arguments),t){var s=_.template("[<%= snapshotId %>][<%= pdName %>][<%= locatedRemoteSiteName %>]",{snapshotId:this.get(n.SNAP_ID),pdName:this.get(n.SNAP_PD_NAME),locatedRemoteSiteName:this.get(n.SNAP_LOCATED_RS_NAME)||""});this.set({id:s},{silent:!0})}},isRemoteSnapshot:function(){return null!==this.get(n.SNAP_LOCATED_RS_NAME)},deleteSnapshot:function(e){null!==this.get(n.SNAP_LOCATED_RS_NAME)?this.deleteRemoteSnapshot(e):this.deleteLocalSnapshot(e)},deleteRemoteSnapshot:function(e){var a=i.REMOTE_SITE,r=this.get(n.SNAP_LOCATED_RS_NAME),o=t.getFormattedURL(a+"/"+r+"/dr_snapshots/remove_list"),l=this;this.actionMode=s.ACTION_DELETE;var c={};c[this.get(n.SNAP_PD_NAME)]=[this.get(n.SNAP_ID)],$.ajax({type:"POST",url:o,contentType:"application/json; charset=UTF-8",data:JSON.stringify({drSnapshotIdsMap:c}),statusCode:this.getStatusCode(),success:function(t,i,n){l.showSuccessNotification(l,s.ACTION_DELETE,t),e()},error:function(e,t,i){l.showErrorNotification(l,s.ACTION_DELETE,e)}})},deleteLocalSnapshot:function(e){var a=i.PROTECTION_DOMAIN,r=this.get(n.SNAP_PD_NAME),o=this.get(n.SNAP_ID),l=t.getFormattedURL(a+"/"+r+"/dr_snapshots/"+o);this.actionMode=s.ACTION_DELETE;var c=this;$.ajax({type:"DELETE",url:l,contentType:"application/json; charset=UTF-8",statusCode:this.getStatusCode(),success:function(t,i,n){c.showSuccessNotification(c,s.ACTION_DELETE,t),e()},error:function(e,t,i){c.showErrorNotification(c,s.ACTION_DELETE,e)}})},retrieveSnapshot:function(e){if(this.isRemoteSnapshot()){var a=i.REMOTE_SITE,r=this.get(n.SNAP_LOCATED_RS_NAME),o=t.getFormattedURL(a+"/"+r+"/dr_snapshots/download_snapshot"),l=this;this.actionMode=s.ACTION_RETRIEVE,$.ajax({type:"POST",url:o,contentType:"application/json; charset=UTF-8",data:JSON.stringify({pdName:this.get(n.SNAP_PD_NAME),drSnapshotId:this.get(n.SNAP_ID)}),statusCode:this.getStatusCode(),success:function(t,i,n){l.showClientNotification(s.NOTIFY_INFO,l.i18n("retrieve_initiated")),e()},error:function(e,t,i){l.showError=!0,l.showErrorNotification(l,s.ACTION_RETRIEVE,e)}})}else this.showClientNotification(this.i18n("no_retrieve_action"))},restoreSnapshot:function(e){var r=this;if(this.actionMode=s.ACTION_RESTORE,this.isRemoteSnapshot())e.errorCB(this.i18n("no_restore_action"));else{var o=i.PROTECTION_DOMAIN,l=this.get(n.SNAP_PD_NAME),c=t.getFormattedURL(o+"/"+l+"/restore_entities"),u={};u[a.VM_NAMES]=e.vms,u[a.VG_UUIDS]=e.vgs,u[a.REPLACE]=e.replace,u[a.PATH_PREFIX]=e.pathPrefix,u[a.SNAPSHOT_ID]=this.get(n.SNAP_ID),e.vmNamePrefix&&(u[a.VM_NAME_PREFIX]=e.vmNamePrefix),e.vgNamePrefix&&(u[a.VG_NAME_PREFIX]=e.vgNamePrefix),$.ajax({type:"POST",url:c,contentType:"application/json; charset=UTF-8",data:JSON.stringify(u),statusCode:this.getStatusCode(),success:function(t,i,n){r.showClientNotification(s.NOTIFY_INFO,r.i18n("restore_initiated")),e.successCB(t)},error:function(t,i,n){e.errorCB(t)}})}}})}),define("models/fileserver/FileServerSnapshotCollection",["models/BaseCollection","models/dataprotection/SnapshotModel","utils/FilterUtil","utils/AppConstants","data/DataURLConstants","data/DataProperties"],function(e,t,i,n,s,a){"use strict";var r=i._filterConditionToFIQL(a.SNAP_STATE,n.FILTER_OPERATORS.NOT_EQUALS,"",n.SNAPSHOT_STATE.EXPIRED);return e.extend({model:t,name:"FileServerSnapshotCollection",url:s.LOCAL_SNAPSHOT,setPdName:function(e){return this.url=_.template(s.LOCAL_SNAPSHOT+"?filterCriteria="+r,{pdName:e}),this.url}})}),define("text!templates/wizards/fileserver/SnapshotFileServerDefinePage.html",[],function(){return'<div class="n-modal-content">\n  <div data-ntnx-content-inner>\n    <form id="snapshotFileServerDefine" class="form-horizontal\n      fs-fileServerDefineForm fs-snapshotDefineForm">\n      <section data-ntnx-section= class="fsDetails-config">\n        <h5 data-ntnx-title><%= heading %></h5>\n          \x3c!-- Name and domain of the file server --\x3e\n          <section data-ntnx-section="type-text" class="description snapshot-description">\n            <%= description %>\n          </section>\n          <section data-ntnx-section="type-half">\n            <label data-ntnx-label for="fs-name"><%= i18n("name") %></label>\n            <input type="text" class="fs-name"\n                 placeholder="<%= maxLengthLimitMsg %>"\n                 maxlength="15" value=""/>\n          </section>\n          <section data-ntnx-section="type-half" class="realmNameContainer">\n            <label data-ntnx-label for="realm-name"><%= i18n(\'domain\') %></label>\n            <input type="text" class="realm-name"\n            placeholder="like: dom.companyname.com">\n          </section>\n          \x3c!-- Snapshot list table --\x3e\n          <section data-ntnx-section>\n            <h5 data-ntnx-title><%= listSnapshots %></h5>\n            <section data-ntnx-section>\n              <table class="table table-hover fs-snapshotDetail">\n                <thead>\n                <tr>\n                  <th></th>\n                  <th><%= snapshotId %></th>\n                  <th><%= snapshotCreateTime %></th>\n                  <th><%= snapshotExpiryTime %></th>\n                </tr>\n                </thead>\n                <tbody>\n                \x3c!-- @view: Snapshots go here... --\x3e\n                </tbody>\n              </table>\n            </section>\n          </section>\n      </section>\n    </form>\n  </div>\n</div>'}),define("views/wizards/fileserver/SnapshotFileServerDefinePage",["views/basecomponents/wizards/BaseWizardPage","models/fileserver/FileServerSnapshotCollection","utils/AppUtil","utils/TimeUtil","utils/AppConstants","utils/FileServerUtil","data/DataURLConstants","data/DataProperties","components/Components","managers/NotificationManager","data/DataManager","text!templates/wizards/fileserver/SnapshotFileServerDefinePage.html"],function(e,t,i,n,s,a,r,o,l,c,u,d){"use strict";var h=_.template('<tr class="n-table-row" targetId="<%= snapshotUuid %>"version="<%= version %>"><td class="text-center"><%= Components.radio({name    : "configOption",classes : "action snapshotCheckbox",checked : checked}) %></td><td class="fs-snapshotId"><%= snapshotId %></td><td class="fs-createTime"><%= createTime %></td><td class="fs-expiryTime"><%= expiryTime %></td></tr>'),p=_.template('<tr class="n-table-row" targetId="<%= snapshotUuid %>"> <td class="text-center"><%= Components.radio({name    : "configOption",classes : "action",checked : checked}) %></td><td class="fs-snapshotId" colspan="3"><%= snapshotText %><span class="nutanixMoreInfo" data-tooltip-classes="-nudge-up" data-tooltip-container="body" data-tooltip-title="<%= snapshotTooltipText %>"></span></td></tr>');return e.extend({name:"SnapshotFileServerDefinePage",events:{"click   .snapshotCheckbox":"onClicksnapshot"},template:_.template(d),initialize:function(t){e.prototype.initialize.apply(this,arguments),this.model=this.model[0],this.fsSupportNFS=a.compareAFSversion(this.model,s.FILE_SERVER_VERSIONS.SPECTRE)>=0},getData:function(e){var n=this,a=new t;a.setPdName(e),a.fetch({success:function(e,t){e.models.length>=1?n.filterSnapshotData(e.models):n.showSnapshotList(e.models)},error:function(e,t){c.showClientNotification(s.NOTIFY_ERROR,i.processAjaxError(t.responseText))}})},showSnapshotList:function(e){var t=this,a=this.$(".fs-snapshotDetail > tbody");a.html("");var r,c,u=null;e.length||this.fsSupportNFS||this.$(".realmNameContainer").hide(),!1===this.model.get(this.model.DP.PD_STATUS)&&e.length<1&&(this.$(".configuration-section").hide(),$(".btnNext").addClass("disabled"),$("ul.modal-nav li").removeClass("next-page"),this.showError(this.i18n("clone_not_supported")),this.getWizard().setCurrentPageTitleError()),_.each(e,function(e,d){if(0===d){r=!0;var p=e.get(o.VERSION);i.compareVersions(e.get(o.VERSION),s.FILE_SERVER_VERSIONS.SPECTRE)<0&&(t.$(".realmNameContainer").hide(),t.snapshotSupportNFS=!1),t.model.set(o.VERSION,p)}else r=!1;var _=e.get(o.SNAP_CREATE_TIME),T=e.get(o.SNAP_EXPIRE_TIME);u=h({snapshotUuid:e.get(o.SNAP_UUID),snapshotId:e.get(o.SNAP_ID),version:e.get(o.VERSION),createTime:n.formatDateTime(_>0?_/1e3:0),expiryTime:n.formatDateTime(T>0?T/1e3:0),checked:r,Components:l},t),a.append(u),c=e.get(o.SNAP_VMS)}),!1!==this.model.get(this.model.DP.PD_STATUS)&&this.addTakeSnapshotTemplate(a),this.model.get(this.model.DP.NUM_NVMS)<1&&this.model.set(this.model.DP.NUM_NVMS,c.length)},addTakeSnapshotTemplate:function(e){var t=this,i=p({snapshotUuid:"",snapshotText:t.i18n("snapshot_text"),snapshotTooltipText:t.i18n("snapshot_text_tooltip"),checked:!1,Components:l},this);e.append(i),this.$(".nutanixMoreInfo").nutanixMoreInfo({parseDataAttrs:!0,placement:"bottom"})},onPageTransition:function(e){var t=this.$(".fs-name").val().trim(),i=$.trim(this.$(".realm-name").val()),n=this.validateAndHandleError(t,i),r=$("input.n-radio:checked"),o=r.closest("tr").attr("targetId")||"",l=a.checkTaskStatus(this.model,s.TASK_FILE_SERVER_UPGRADE,this.model.fileServerUuid);if(!o&&l||n){if(!n){var c=this.i18n("fsUpgradingMsg");this.showError(c)}}else this.model.set({name:t,dnsDomainName:i,snapshotUuid:o||"",pdName:""}),e()},render:function(){if(this.isViewRendered)return void this.$(".nutanixMoreInfo").nutanixMoreInfo({parseDataAttrs:!0});var e=this.template(this.vtOptions({heading:this.i18n("heading"),name:this.i18n("name"),description:this.i18n("clone_description"),learnMore:this.i18n("learn_more"),maxLengthLimitMsg:this.i18n("max_length_limit"),listSnapshots:this.i18n("list_snapshots"),snapshotId:this.i18n("snapshot_id"),snapshotCreateTime:this.i18n("snapshot_create_time"),snapshotExpiryTime:this.i18n("snapshot_expiry_time"),model:this.model}));this.$el.html(e),this.model.get(this.model.DP.PD_NAME)&&this.getData(this.model.get(this.model.DP.PD_NAME)),this.isViewRendered=!0},filterSnapshotData:function(e){var t,n=[],s=this,a=u.getFormattedURL(r.LOCAL_SNAPSHOT_FILTER);t=e[0].get(o.SNAP_PD_NAME),_.each(e,function(e,t){n[t]=e.get(o.SNAP_UUID)});var l={pdName:t,snapshotUuids:n};i.showLoader(),$.ajax({type:"POST",url:a,contentType:"application/json; charset=UTF-8",data:JSON.stringify(l),success:function(t,n,a){i.hideLoader();var r=_.filter(e,function(e,i){if(t[i])return e.get(o.SNAP_UUID)===t[i][o.SNAP_UUID]});_.each(r,function(e,i){t[i]&&e.get(o.SNAP_UUID)===t[i][o.SNAP_UUID]&&e.set(o.VERSION,t[i][o.VERSION_FS])}),s.showSnapshotList(r)},error:function(e,t,n){i.hideLoader(),s.showError(i.processAjaxError(e.responseText))}})},validateAndHandleError:function(e,t){this.$(".error-class").removeClass("error-class");var i=this.model.validateName(e),n="";(this.fsSupportNFS&&!1!==this.snapshotSupportNFS||this.snapshotSupportNFS)&&(t.length?-1===t.indexOf(".")&&(n=this.i18nsStatic("FileServerModel","invalid_field_msg","domain name")):n=this.i18n("miss_domain_name_message"));var s="";return i&&(this.$(".fs-name").addClass("error-class"),s+=i),n&&(this.$(".realm-name").addClass("error-class"),s=s.length?s+"<br>"+n:n),s.length?(this.showError(s),this.getWizard().setCurrentPageTitleError()):this.getWizard().clearCurrentPageTitleError(),i+n},onClicksnapshot:function(e){var t=$(e.currentTarget),n=t.closest("tr").attr(o.VERSION);this.model.set(o.VERSION,n),i.compareVersions(n,s.FILE_SERVER_VERSIONS.SPECTRE)>=0?(this.$(".realmNameContainer").show(),this.snapshotSupportNFS=!0):(this.$(".realmNameContainer").hide(),this.snapshotSupportNFS=!1)},onPageCancel:function(){return!0}})}),define("text!templates/wizards/fileserver/ActivateFileServerDefinePage.html",[],function(){return'<div class="n-modal-content">\n  <div data-ntnx-content-inner>\n    <form id="activateFileServerDefine" class="fs-fileServerDefineForm\n      fs-activateDefineForm">\n      <% if (isSpectreSupported) { %>\n        <section data-ntnx-section="type-half">\n      <% } else {%>\n        <section data-ntnx-section="type-text">\n      <% } %>\n        <label data-ntnx-label for="fsName"><%=i18n(\'name\')%></label>\n        <input type="text" class="fsName"\n             maxlength="15" value="<%=fsName%>" disabled/>\n      </section>\n      <% if (isSpectreSupported) { %>\n        <section data-ntnx-section="type-half">\n          <label data-ntnx-label for="realmName"><%=i18n(\'domain\')%></label>\n          <input type="text" class="realmName"\n            placeholder="like: dom.companyname.com">\n        </section>\n      <% } %>\n      <section data-ntnx-section="type-text">\n        <%= i18n(\'qualified_domain\') %><span class="fqdnText"></span>\n      </section>\n    </form>\n  </div>\n</div>\n'}),define("views/wizards/fileserver/ActivateFileServerDefinePage",["views/basecomponents/wizards/BaseWizardPage","data/DataProperties","utils/FileServerUtil","utils/AppConstants","text!templates/wizards/fileserver/ActivateFileServerDefinePage.html"],function(e,t,i,n,s){"use strict";return e.extend({name:"ActivateFileServerDefinePage",events:{"blur     .realmName":"onBlurName"},template:_.template(s),initialize:function(t){e.prototype.initialize.apply(this,arguments),this.model=this.model[0],this.fsSupportNFS=i.compareAFSversion(this.model,n.FILE_SERVER_VERSIONS.SPECTRE)>=0},onPageTransition:function(e){var t=this.$(".fsName").val().trim(),i=$.trim(this.$(".realmName").val());this.validateAndHandleError(i)||(this.model.set({name:t,dnsDomainName:i}),e())},render:function(){var e=this.template(this.vtOptions({fsName:this.model.get(t.NAME),isSpectreSupported:this.fsSupportNFS}));this.$el.html(e)},validateAndHandleError:function(e){this.$(".error-class").removeClass("error-class");var t="";return this.fsSupportNFS&&(e.length?-1===e.indexOf(".")&&(t=this.i18nsStatic("FileServerModel","invalid_field_msg","domain name")):t=this.i18n("miss_domain_name_message")),t.length?(this.$(".realmName").addClass("error-class"),this.showError(t),this.getWizard().setCurrentPageTitleError()):this.getWizard().clearCurrentPageTitleError(),t},onPageCancel:function(){return!0},onBlurName:function(){var e=$.trim(this.$(".fsName").val()),t=$.trim(this.$(".realmName").val());e&&t&&this.$(".fqdnText").html("("+e+"."+t+")")}})}),define("models/network/AcropolisNetworkAddressModel",["models/AcropolisModel","data/DataURLConstants","utils/AppConstants"],function(e,t,i){"use strict";var n={MAC_ADDRESS:"macAddress",IP_ADDRESS:"ipAddress",NETWORK_UUID:"networkUuid",ENTITY_UUID:"entityUuid",OVERLAY_NETWORK_ID:"overlayNetworkId",TYPE:"type",DELETED:"deleted"};return e.extend({DP:n,urlRoot:t.MGMT_NETWORK_ADDRESS,name:"AcropolisNetworkAddressModel",entityType:i.ENTITY_ACROPOLIS_NETWORK_ADDRESS})}),define("models/network/AcropolisNetworkAddressCollection",["models/PollingCollection","models/network/AcropolisNetworkAddressModel","data/DataManager","data/DataURLConstants"],function(e,t,i,n){"use strict";return e.extend({model:t,name:"AcropolisNetworkAddressCollection",initialize:function(t,i){if(e.prototype.initialize.apply(this,arguments),!i||!i.networkAddressId)throw"Missing network id.";var s=i.networkAddressId;this.url=_.template(n.MGMT_NETWORK_ADDRESS)({networkAddressId:s})},getDataSourceURL:function(){return i.getNutanixApiDataSourceURL()}})}),define("views/basecomponents/tableinput/TableInputView",["views/basecomponents/BaseView","utils/AppUtil","utils/SVG","utils/AppConstants","utils/ValidationUtil","managers/I18nManager"],function(e,t,i,n,s,a){"use strict";var r={ADD:"add",SAVE:"save",EDIT:"edit",ERROR:"error",DELETE:"delete",CHANGE_LIST:"change_list",CANCEL:"cancel"},o=_.template('<div class="header"><% if (isFilterEnabled) { %><div class="n-table-filter">'+i.SVGIcon("B","search-icon")+'<input class="n-table-filter tableFilter"  type="text" placeholder="search in table"></div><% } %><% if (isNewActionEnabled || isConfigEnabled) { %><div class="header-table-input"><% if (isNewActionEnabled) { %><a class="link-table-input"><%= Components.icon("plus-small") %> <%= addCaption %></a><% } %><% if (isConfigEnabled) { %><a class="link-table-config"><%= Components.icon("C") %></a><% } %></div><% } %></div><table class="table table-data-items table-input <%= ebClass %>"><thead><tr><% _.each(columns, function(column) { %><th><%= column.columnName %></th><% }); %><% if (isActionEnabled) { %><th>Actions</th><% } %></tr></thead><tbody></tbody></table>'),l='<% if (isActionEnabled) { %><td class="data-cell"><div class="action-links">'+i.SVGIcon("pencil","edit not-active")+'<a class="save active" tabindex="0"><%= i18n("save") %></a><span class="middot"> &middot; </span>'+i.SVGIcon("x-round","delete not-active")+'<a class="cancel active" tabindex="0"><%= i18n("cancel") %></a></div></td><% } %>',c=_.template('<tr data-id="<%= dataId %>" <%=isNew ? "new":""%> class="n-table-row"model-attribute="user-row" model-validate="isRowSaved"><% _.each(columns, function(column) { %><td class="data-cell"><input type="<%= column.type ? column.type : "text" %>" class="input-data <%= column.className ? column.className : "" %>" readonly <% if (column.modelValidate) { %>model-validate="<%= column.modelValidate %>"<% } %><% if (column.modelAttribute) { %>model-attribute="<%= column.modelAttribute %>" <% } else if (modelAttribute) { %>model-attribute="<%= modelAttribute %>" <% } %>value="<%= isNew ? "" : column.renderer(data) %>" placeholder="<%= (placeholderText) ? placeholderText : column.columnName%>"></td><% }); %>'+l+"</tr>"),u=_.template('<tr class="no-data"><td colspan="<%= columnLength %>"><%= noData %></td></tr>');return e.extend({ID_TO_BE_ADDED:n.ID_TO_BE_ADDED,name:"TableInputView",className:"component-table-input",entityType:null,columns:null,idAttribute:"id",dataItems:null,isActionEnabled:!0,isNewActionEnabled:!0,isConfigEnabled:!1,modelAttribute:null,tmplTable:null,tmplOptions:null,addCaption:null,_previousValue:"",additionalRowsAttrs:null,events:{"click  a.link-table-input":"onClickAddRow","click  a.link-table-config":"onClickConfig","click  .action-links .edit":"onClickEditLink","keyup  .tableFilter":"onFilterChange","click  .action-links .delete":"onClickDeleteLink","click  a.save":"onClickSaveLink","click  a.cancel":"onClickCancelLink","keyup  .input-data":"onKeyUpInput","keyup  a.save":"onKeyUpSave","keyup  a.cancel":"onKeyUpCancel"},ACTION_EVENTS:r,initialize:function(e){if(e=e||{},!e.entityType||!e.columns)throw new Error("Incomplete options object. See initialize commentfor more information in creating this component.");this.entityType=e.entityType,this.columns=e.columns,this.dataItems=e.data||[],this.idAttribute=e.idAttribute||this.idAttribute,this.filterAttributes=e.filterAttributes||[],this.disableInlineEdit=e.disableInlineEdit||!1,this.modelAttribute=e.modelAttribute||null,this.ebTableStyle=e.ebTableStyle||!1,this.tmplDataRow=e.tmplDataRow||c,this.placeholderText=e.placeholderText,this.addCaption=e.addCaption,this.noDataText=e.noDataText||a.t("TableInputView","no_data"),this.filterAttributes&&this.filterAttributes.length&&(this.isFilterEnabled=!0),_.isBoolean(e.isActionEnabled)&&(this.isActionEnabled=e.isActionEnabled),_.isBoolean(e.isNewActionEnabled)&&(this.isNewActionEnabled=e.isNewActionEnabled),_.isBoolean(e.isConfigEnabled)&&(this.isConfigEnabled=e.isConfigEnabled),_.isFunction(e.onClickConfig)&&(this.onClickConfig=e.onClickConfig),this.tmplTable=e.tmplTable||o},render:function(){var e=n.ENTITY_NAMES[this.entityType],t=a.t("TableInputView",this.entityType,e),i=this.addCaption||t,s=_.defaults({},this.tmplOptions,{addCaption:i,entityName:t,columns:this.columns,isActionEnabled:this.isActionEnabled,isFilterEnabled:this.isFilterEnabled,ebClass:this.ebTableStyle?"entity-browser-table":"",isNewActionEnabled:this.isNewActionEnabled,isConfigEnabled:this.isConfigEnabled});return this.$el.html(this.tmplTable(this.vtOptions(s))),this.renderTable(),this},renderTable:function(e){var t=this.dataItems;this.clearTable(),e&&this.isFilterEnabled&&(t=this.filterDataItems(e)),t&&t.length?_.each(t,function(e){this.insertTableRow(e)},this):this.insertNoDataRow()},setAdditionalRowAttr:function(e,t){this.additionalRowsAttrs=this.additionalRowsAttrs||{},this.additionalRowsAttrs[e]=t},setAdditionalAttrs:function(e){_.isObject(this.additionalRowsAttrs)&&_.each(this.additionalRowsAttrs,function(t,i){e.attr("data-"+i,t)})},filterDataItems:function(e){return _.filter(this.dataItems,function(i){var n=!1;return i instanceof Backbone.Model&&(i=i.attributes),_.some(this.filterAttributes,function(s){var a=i[s];if(t.containsCompare(a,e))return n=!0,!0}),n},this)},setConfigLinkTooltip:function(e){this.$("a.link-table-config").attr("title",e)},clearTable:function(){this.$(".table-data-items tbody").html("")},insertNoDataRow:function(){this.$(".table-data-items tbody").append(u({columnLength:this.columns.length+(this.isActionEnabled?1:0),isActionEnabled:this.isActionEnabled,noData:this.noDataText}))},removeNoDataRow:function(){this.$("tr.no-data").remove()},insertTableRow:function(e,t){e instanceof Backbone.Model&&(e=e.attributes),t=void 0!==t&&t;var i=t?this.ID_TO_BE_ADDED:e[this.idAttribute],n=this.getRowToBeAddedElement();if(!t||!n.length){var s=$(this.tmplDataRow(this.vtOptions({isNew:t,dataId:i,data:e,columns:this.columns,isActionEnabled:this.isActionEnabled,modelAttribute:this.modelAttribute,placeholderText:this.placeholderText
})));this.$(".table-data-items tbody").append(s),this.removeNoDataRow(),this.setAdditionalAttrs(s,this.additionalRowsAttrs)}},resetTable:function(){this.$("tr").removeClass("edit"),this.$("td").removeClass("error"),this.getRowToBeAddedElement().remove(),this.$(".input-data").attr("readonly",!0),0===this.$("tr[data-id]").length&&this.insertNoDataRow()},getRowToBeAddedElement:function(){return this.$('tr[data-id="'+this.ID_TO_BE_ADDED+'"][new]')},getRowFromActionLink:function(e){return $(e.currentTarget).closest("tr")},getRows:function(){return this.$('[model-attribute="user-row"]').not("[new]")},getData:function(){var e=n.FORM_SELECTORS.DATA_MODEL_ATTR,t=this.getRows();return _.map(t,function(t){var i={};return $(t).find(".input-data").each(function(t,n){i[n.getAttribute(e)||t]=n.value}),i})},saveRow:function(e){var t=this.getRowFromActionLink(e),i=t.find("input"),a=i.val().trim(),o=s.validateFormValues(t);if(o&&o.length)return t.find("td").addClass("error"),void this.trigger(r.ERROR,{errors:o,rule:i.attr(n.FORM_SELECTORS.VALIDATE_MODEL_ATTR)});a?(t.attr("data-id",a),t.removeAttr("new"),this.trigger(this.ACTION_EVENTS.SAVE,t)):t.remove(),this.resetTable()},deleteRow:function(e){var t=$(e.currentTarget),i=t.closest("tr"),n=i.attr("data-id");i.remove(),this.resetTable(),this.trigger(this.ACTION_EVENTS.DELETE,n),this.trigger(this.ACTION_EVENTS.CHANGE_LIST)},addRow:function(){this.resetTable(),this.insertTableRow(null,!0);var e=this.getRowToBeAddedElement();e.find(".action-links .edit").click(),e.find("input").length>0&&$(e.find("input")[0]).focus(),this.trigger(this.ACTION_EVENTS.ADD)},cancelRow:function(e){this.getRowFromActionLink(e).find("input").val(this._previousValue),this._previousValue="",this.resetTable(),this.trigger(this.ACTION_EVENTS.CANCEL)},onClickAddRow:function(){this.addRow()},onClickConfig:function(){},onClickEditLink:function(e){var t=this.getRowFromActionLink(e),i=t.find("input"),n=t.attr("data-id"),s=this.$('tr[data-id="'+n+'"]');this.trigger(this.ACTION_EVENTS.EDIT,n),this.disableInlineEdit||(this._previousValue=i.val(),this.$("tr").removeClass("edit"),s.addClass("edit"),s.find("input:first-child").focus(),s.find("input.input-data").removeAttr("readonly"))},onClickCancelLink:function(e){this.cancelRow(e)},onClickSaveLink:function(e){this.saveRow(e)},onClickDeleteLink:function(e){this.deleteRow(e)},onKeyUpSave:_.debounce(function(e){var t=$.ui.keyCode;e.keyCode===t.ENTER&&this.onClickSaveLink(e)},300),onKeyUpCancel:_.debounce(function(e){var t=$.ui.keyCode;e.keyCode===t.ENTER&&this.onClickCancelLink(e)},300),onKeyUpInput:_.debounce(function(e){var t=$.ui.keyCode;e.keyCode===t.ENTER&&this.onInputEnterKeyUp(e)},300),onInputEnterKeyUp:function(e){this.saveRow(e)},onFilterChange:function(e){e.target.value?this.renderTable(e.target.value):(this.clearTable(),this.renderTable())}},{ACTION_EVENTS:r,EDIT_COLUMN_TEMPLATE:l})}),define("views/wizards/fileserver/FileServerIpPoolFormView",["views/basecomponents/tableinput/TableInputView","utils/AppConstants","utils/CommonTemplates","utils/AppUtil"],function(e,t,i,n){"use strict";var s=_.template('<div class="section-header"><%= requiredIpsLabel %></div>');return e.extend({name:"FileServerIpPoolFormView",model:null,internal:null,isOldActionEnabled:!0,initialize:function(n){this.internal=n.internal,this.model=n.model,n=_.defaults({entityType:t.ENTITY_SELECT_NETWORK,disableInlineEdit:!1,ebTableStyle:!0,idAttribute:"endAddress",columns:this.getDefaultColumns()},n),e.prototype.initialize.call(this,n),this.tmplDataRow=n.tmplDataRow||i.TMPL_DATA_ROW,_.isBoolean(n.isOldActionEnabled)&&(this.isOldActionEnabled=n.isOldActionEnabled),this.addExtraEvents({"keyup  .edit .startIpRange":"onKeyUpInputOnStartIp","keyup  .edit .endIpRange":"onKeyUpInputOnEndIp"})},onKeyUpInputOnStartIp:function(e){var t=$(e.currentTarget).val();if(t){var i=t.split(".");if(4===i.length&&i[3]){var n=this.$(".table-data-items .n-table-row:not(.edit) .numberOfIps"),s=0;_.each(n,function(e){s+=parseInt($(e).val(),10)});var a=this.parentView.parentView.getRequiredNumberOfIps()-1;a-=s;var r=this.getEndIpAddress(a,t),o=this.getTotalIps(t,r);this.$(".edit .endIpRange").val(r),this.$(".edit .numberOfIps").val(o)}else this.$(".edit .endIpRange").val("")}},renderTable:function(e){var t=this.dataItems;this.clearTable(),e&&this.isFilterEnabled&&(t=this.filterDataItems(e)),t&&t.length?(_.each(t,function(e){this.insertTableRow(e)},this),this.isOldActionEnabled=!0):this.insertNoDataRow()},onKeyUpInputOnEndIp:function(e){var t=$(e.currentTarget).val(),i=this.$(".edit .startIpRange").val(),n=this.getTotalIps(i,t);this.$(".edit .numberOfIps").val(n)},getDefaultColumns:function(){var e=this;return[{columnName:e.i18n("column_name.from"),className:"startIpRange start-ip-range",renderer:function(e){return e.startAddress}},{columnName:e.i18n("column_name.to"),className:"endIpRange end-ip-range",renderer:function(e){return e.endAddress}},{columnName:e.i18n("column_name.no_of_ips"),className:"numberOfIps",renderer:function(e){return e.numberOfIps}}]},insertTableRow:function(e,i){e instanceof Backbone.Model&&(e=e.attributes),i=void 0!==i&&i;var n=i?this.ID_TO_BE_ADDED:e[this.idAttribute],s=this.getRowToBeAddedElement();if(!i||!s.length){this.$(".table-data-items tbody").append(this.tmplDataRow(this.vtOptions({isNew:i,dataId:n,data:e,columns:this.columns,isOldActionEnabled:this.isOldActionEnabled,isActionEnabled:this.isActionEnabled,modelAttribute:this.modelAttribute,placeholderText:this.placeholderText}))),this.removeNoDataRow();var a=this.$(".table-data-items tbody").find("tr").last();e?(a.attr("startRawIp",e.startAddress),a.attr("endRawIp",e.endAddress),a.attr("numberOfIps",e.numberOfIps)):(a.find(".startIpRange").attr("placeholder",this.i18n("column_name.start_ip")),a.find(".endIpRange").attr("placeholder",this.i18n("column_name.end_ip")),a.find(".numberOfIps").attr("placeholder","")),this.$(".numberOfIps").prop(t.FORM_ATTR.DISABLED,!0)}},onClickCancelLink:function(t){e.prototype.onClickCancelLink.call(this,arguments),this.$(".startIpRange, .endIpRange").removeClass("error-class");var i=$(t.currentTarget).closest("tr");i.find(".startIpRange").val(i.attr("startRawIp")),i.find(".endIpRange").val(i.attr("endRawIp")),i.find(".numberOfIps").val(i.attr("numberOfIps")),this.showHideAddPoolBtn()},onClickSaveLink:function(t){this.internal?this.model.set(this.model.DP.INTERNAL_NETWORK,null):this.model.set(this.model.DP.EXTERNAL_NETWORK,null);var i=$(t.currentTarget).closest("tr"),n=$.trim(i.find(".startIpRange").val()),s=$.trim(i.find(".endIpRange").val()),a=$.trim(this.parentView.$(".netmask").val()),r=$.trim(this.parentView.$(".gateway").val());if(!this.isValidForm(a,r,n,s)){var o=this.getTotalIps(n,s);i.find(".numberOfIps").val(o),e.prototype.onClickSaveLink.call(this,t),this.saveForm(),this.showHideAddPoolBtn(),i.attr("startRawIp",n),i.attr("endRawIp",s),i.attr("numberOfIps",o)}},getTotalIps:function(e,t){var i,n=this.model.strToLongIP(e),s=this.model.strToLongIP(t);return t?i=s-n+1:(t=e,i=1),i=i<1?0:i},setParentView:function(e){this.parentView=e},render:function(t){e.prototype.render.call(this),t?this.addRow():!this.options.isNvmChanged&&this.model.get(this.model.DP.DOMAIN_CONFIG).windowsAdDomainName||this.showHideAddPoolBtn();var i=this.parentView.parentView.getRequiredNumberOfIps();return this.renderHeader(i),this},renderHeader:function(e){e+=" "+this.i18n("ip_required"),this.$(".header-table-input").html(s({requiredIpsLabel:e})),this.$el.addClass("network-pool-wrapper")},saveForm:function(){if(this.internal)this.model.set({internalNetwork:this.parentView.saveForm()});else{var e=[];e.push(this.parentView.saveForm()),this.model.set({externalNetworks:e})}},showHideAddPoolBtn:function(){this.getIpPool().numberOfIps>=this.parentView.parentView.getRequiredNumberOfIps()?this.$(".link-table-input").hide():(this.$(".link-table-input").show(),this.addRow()),this.$(".numberOfIps").prop(t.FORM_ATTR.DISABLED,!0)},getEndIpAddress:function(e,t){var i=this.model.strToLongIP(t),s=i+e;return n.longToStrIP(s)},isValidForm:function(e,t,i,n){var s=this.validateNetmask(e);return s||(s=this.validateStartIpRange(i),s||(s=this.validateDuplicateStartEndIp(i,n)),s||(s=this.validateSubNet(e,t,i,n)),!s&&n&&((s=this.validateEndIpRange(n))||(s=this.validateStartAndEndAddress(i,n,e)))),s||(s=this.validateTotalIps()),s&&s.length>0&&this.parentView.showError(s),s},validateSubNet:function(e,t,i,n){var s=function(e){return e.split(".").reduce(function(e,t){return(e<<8)+parseInt(t,10)},0)>>>0},a=s(e),r=s(t)&a;return(s(i)&a)!==r?this.i18n("invalid_start_ip"):(s(n)&a)!==r?this.i18n("invalid_end_ip"):void 0},validateTotalIps:function(){var e=this.$(".numberOfIps"),t=0,i=null;return _.each(e,function(e){t+=parseInt($(e).val(),10)}),t>this.parentView.parentView.getRequiredNumberOfIps()&&(i=this.i18n("exceeds_ips")),i},validateStartAndEndAddress:function(e,t,i){var s=0,a=[],r=n.strToLongIP(e),o=n.strToLongIP(i);return t&&(s=n.strToLongIP(t)),s<r?(a.push(this.i18n("end_ip_range")),this.$(".edit .startIpRange").addClass("error-class"),this.$(".edit .endIpRange").addClass("error-class")):this.$(".startIpRange, .endIpRange").removeClass("error-class"),a.push(this.validateStartEndAddressInRange(r,o,s)),a&&a.length>0?a.join(" "):""},validateStartEndAddressInRange:function(e,t,i){var n="";return this.model.isEndIpInRange(e,t,i)?this.$(".startIpRange, .endIpRange").removeClass("error-class"):(n=this.i18n("start_end_ip_range"),this.$(".edit .startIpRange").addClass("error-class"),this.$(".edit .endIpRange").addClass("error-class")),n},validateDuplicateStartEndIp:function(e,t){var i=[],n=[],s=[],a=this.$(".table-data-items").find("tr").not(".edit");a.find(".startIpRange").each(function(e){i.push($.trim($(this).val()))}),a.find(".endIpRange").each(function(e){n.push($.trim($(this).val()))}),(-1!==$.inArray(e,i)||!_.isEmpty(n)&&-1!==$.inArray(e,n))&&(s.push(this.i18n("duplicate_start_ip")),this.$(".edit .startIpRange").addClass("error-class")),(t&&-1!==$.inArray(t,n)||!_.isEmpty(i)&&-1!==$.inArray(t,i))&&(s.push(this.i18n("duplicate_end_ip")),this.$(".edit .endIpRange").addClass("error-class"));var r=this.model.isUsedIP(e),o=this.model.isUsedIP(t);return r&&o||(s.push(this.i18n("duplicate_end_ip")),this.$(".edit .startIpRange").addClass("error-class"),this.$(".edit .endIpRange").addClass("error-class")),s&&s.length>0?s.join(" "):(this.$(".startIpRange, .endIpRange").removeClass("error-class"),"")},validateNetmask:function(e){var t=[];e&&t.push(e);var i=this.model.isValidInputs(t,"netmask");return i?this.parentView.$(".netmask").addClass("error-class"):this.parentView.$(".netmask").removeClass("error-class"),i},validateStartIpRange:function(e){var t=[];e&&t.push(e);var i=this.model.isValidInputs(t,"startIpRange");return i?this.$(".edit .startIpRange").addClass("error-class"):this.$(".startIpRange").removeClass("error-class"),i},validateEndIpRange:function(e){return n.isValidIP(e)?(this.$(".endIpRange").removeClass("error-class"),""):(this.$(".endIpRange").addClass("error-class"),this.i18n("end_ip_not_valid"))},onClickDeleteLink:function(t){e.prototype.onClickDeleteLink.call(this,t),this.showHideAddPoolBtn(),this.internal?this.model.set(this.model.DP.INTERNAL_NETWORK,null):this.model.set(this.model.DP.EXTERNAL_NETWORK,null)},getIpPool:function(){var e={},t=[],i=0;return this.$(".table-data-items > tbody tr").each(function(){var n=$.trim($(this).find(".startIpRange").val()),s=$.trim($(this).find(".endIpRange").val()),a=n;i+=parseInt($.trim($(this).find(".numberOfIps").val()),10),s&&(a=n+" "+s),t.push(a),e.ipPoolRange=t,e.numberOfIps=i}),e.numberOfIps||(e.numberOfIps=0),e}})}),define("text!templates/wizards/fileserver/FileServerNetworkFormView.html",[],function(){return'\x3c!-- File Server External Network Form. --\x3e\n<section class="network-config" data-ntnx-section>\n  <h5 data-ntnx-title><%= title %></h5>\n  <% if (isUpdate && !isInternal && !isScaleOut && isSupportNFS && showDeleteMsg) { %>\n    <div class="alert alert-warning">\n      <%= deleteDnsMsg %>\n    </div>\n  <% } %>\n  <section data-ntnx-section>\n    <label data-ntnx-label>\n      <span class="lblNetwork"></span>\n    </label>\n    <div class="select-wrapper">\n      <select class="fs-net-vlans" data-test="fsVlanSelect">\n        \x3c!-- @option goes here... --\x3e\n      </select>\n    </div>\n    <div class="fs-networkDetail" style="display:none">\n      <section data-ntnx-section="type-text">\n        <table id="managedNetworkDetail" class="table  readonly-table">\n          <tbody>\n          \x3c!-- @view: managed network details goes here...--\x3e\n          </tbody>\n        </table>\n      </section>\n    </div>\n    <div class="fs-networkConfig">\n      \x3c!-- Netmask.  --\x3e\n      <section data-ntnx-section>\n        <label data-ntnx-label><%= subnetMask %></label>\n        <input type="text" class="netmask"/>\n      </section>\n      \x3c!-- Gateway.  --\x3e\n      <section data-ntnx-section>\n        <label data-ntnx-label><%= gateway %></label>\n        <input type="text" class="gateway"/>\n      </section>\n    </div>\n  </section>\n</section>\n\n<section class="networkIpConfig" data-ntnx-section style="display:none;">\n  <h5 data-ntnx-title class="ipAddressLbl multi-ip-range">\n    <span class="required-number-ips">\n    </span>\n    <%= requiredIps %>\n  </h5>\n  \x3c!-- supporting multi range pool goes here --\x3e\n  <section class="ipAddressBtnWrapper ip-pool-overlay" data-ntnx-section>\n    <div class="description"><%= addIps %></div>\n    <%= Components.button({\n      extraClasses : \'btn-primary addIpAddress\',\n      text         : i18n(\'ip_address_btn\'),\n      iconLeft     : \'plus\'\n    }) %>\n  </section>\n  <section id="fsIpPoolNetworkForm" class="component-table-input"\n    style="display:none;">\n  </section>\n</section>\n<section class="fs-networkType" data-ntnx-section>\n  \x3c!-- Network Type.  --\x3e\n  <input type="hidden" class="networkType"/>\n  <input type="hidden" class="requiredIpPerNvm"/>\n</section>'}),define("text!templates/wizards/fileserver/ManagedNetworkDetailsView.html",[],function(){return'  <% if (subnetMask !== \'\') { %>\n  <tr class="n-table-row">\n    <td  class="subnetmask-label-cell">\n      <%= subnetMaskLabel %>\n    </td>\n    <td  class="subnetmask-value-cell">\n      <%= subnetMask %>\n    </td>\n  </tr>\n  <% } %>\n\n  <% if (defaultGateway !== \'\') { %>\n  <tr class="n-table-row">\n    <td  class="default-gateway-label-cell">\n      <%= gatewayLabel %>\n    </td>\n    <td  class="default-gateway-value-cell">\n      <%= defaultGateway %>\n    </td>\n  </tr>\n  <% } %>\n\n  <% if (selectedVlan) { %>\n    <tr class="n-table-row">\n      <td  class="network-prefix-label-cell">\n        <%= vlanLabel %>\n      </td>\n      <td  class="network-prefix-value-cell">\n        <%= selectedVlan %>\n      </td>\n    </tr>\n  <% } %>\n\n  <% if (networkPrefix !== null) { %>\n    <tr class="n-table-row">\n      <td  class="network-prefix-label-cell">\n        <%= subnetMaskLabel %>\n      </td>\n      <td  class="network-prefix-value-cell">\n        <%= networkPrefix %>\n      </td>\n    </tr>\n  <% } %>\n\n  <% if (firstIpPool !== null) { %>\n    <tr class="n-table-row">\n      <td  class="ip-address-range-label-cell">\n        <%= ipRangeLabel %>\n      </td>\n      <td  class="ip-address-range-value-cell">\n        <%= firstIpPool %>\n      </td>\n    </tr>\n  <% } %>\n\n  <% if (numberOfPools > 0) { %>\n    <tr class="n-table-row">\n      <td  class="ip-address-range-label-cell">\n        <%= morePoolLabel %>\n      </td>\n      <td  class="ip-address-range-value-cell">\n        <%= numberOfPools %>\n      </td>\n    </tr>\n  <% } %>\n\n  <% if (requiredIps > 0) { %>\n    <tr class="n-table-row requiredIps hidden">\n      <td  class="required-ips-label-cell">\n        <%= NoOfIpsLabel %>\n      </td>\n      <td  class="required-ips-value-cell">\n        <%= usedIpLabel %>\n      </td>\n    </tr>\n  <% } %>'}),define("views/wizards/fileserver/FileServerNetworkFormView",["data/DataProperties","views/basecomponents/BaseSubView","models/network/AcropolisNetworkAddressCollection","utils/SubViewHelper","utils/HypervisorUtil","utils/AppConstants","utils/AppUtil","utils/ValidationUtil","utils/FileServerUtil","managers/I18nManager","managers/ActionManager","views/wizards/fileserver/FileServerIpPoolFormView","text!templates/wizards/fileserver/FileServerNetworkFormView.html","text!templates/wizards/fileserver/ManagedNetworkDetailsView.html"],function(e,t,i,n,s,a,r,o,l,c,u,d,h,p){"use strict";var T=_.template('<div class="n-popup-loading"><%= loadingLabel %></div>'),E=_.template('<option vlanid= <%= vlanID %> value= "<%= networkUuid %>" ><%= networkDisplayVlan %> <%= isManaged %></option>');return h=_.template(h),p=_.template(p),t.extend({name:"FileServerNetworkFormView",SELECT:"Select",SUB_VIEW_IP_POOL:"ipPoolForm",events:{"change .fs-net-vlans":"onNetworkChange","click  .deleteDns":"onDeleteDns","click  .addIpAddress":"onAddIpAddressClick"},networks:null,networkModel:null,model:null,internal:null,subViewHelper:null,clusterModel:null,initialize:function(e){t.prototype.initialize.apply(this,arguments),this.subViewHelper=new n,this.model=e.model,this.networks=e.networks,this.internal=e.internal,this.origModel=e.origModel,this.fsSupportNFS=l.compareAFSversion(this.model,a.FILE_SERVER_VERSIONS.SPECTRE)>=0},render:function(){this.$el.html(T({loadingLabel:this.i18n("loading")})),this.renderNetworks()},reRenderNetwork:function(){if(this.isManagedNetworkSelected())this.renderManagedNetworkDetails(this.networkModel,this.addressCollection);else{var e=this.parentView.getRequiredNumberOfIps();this.subViewHelper.get(this.SUB_VIEW_IP_POOL).renderHeader(e)}},destroy:function(){this.subViewHelper.destroy(),t.prototype.destroy.apply(this)},renderNetworks:function(){this.renderVlanOptions(this.networks.models)},disableGatewayAndSubnet:function(){this.$(".netmask").prop("disabled",!0),this.$(".gateway").prop("disabled",!0),this.$(".fs-net-vlans").attr("disabled",!0),this.$(".select-wrapper").addClass("disabled")},renderVlanOptions:function(e){var t,i=null;t=this.prepareSelectTemplate(t),_.each(e,function(e){i=e.getDisplayName()?e.getDisplayName():e.getDisplayVlanId(),t+=E({vlanID:e.getDisplayVlanId()||e.getDisplayName(),networkUuid:e.get(e.idAttribute),networkDisplayVlan:i,isManaged:this.getManagedUnmanagedFlag(e)})},this);var n=this.model.get(this.model.DP.DNS_ENTRIES),a=n&&n.length&&_.filter(n,function(e){return!0===e.verified}).length,r=this.i18ns("delete_dns_msg",'<a class="deleteDns">'+this.i18n("delete_dns")+"</a>");this.$el.html(h(this.vtOptions({title:this.i18n("title"),subnetMask:this.i18n("subnet_mask"),gateway:this.i18n("gateway"),requiredIps:this.i18n("required_ips"),addIps:this.i18n("add_ip_label"),showDeleteMsg:a,deleteDnsMsg:r,isSupportNFS:this.fsSupportNFS,isUpdate:!this.model.isNew(),isInternal:this.internal,isScaleOut:!!this.model.get(this.model.DP.IS_SCALEOUT)}))),this.$(".fs-net-vlans").append(t),s.hasESX()?this.$(".lblNetwork").html(this.i18n("network_label_esx")):this.$(".lblNetwork").html(this.i18n("network_label_ahv")),this.renderSelectedNetwork()},getManagedUnmanagedFlag:function(e){var t="";return s.hasKVMOnly()&&e.isManagedNetwork()?t=" - "+this.i18n("managed_text"):s.hasKVMOnly()&&!e.isManagedNetwork()&&(t=" - "+this.i18n("unmanaged_text")),t},prepareSelectTemplate:function(e){var t;return s.hasESX()?t=this.i18n("select_unmanaged_network"):s.hasKVM&&(t=this.i18n("select_managed_network")),e+=E({vlanID:"Select",networkUuid:"Select",networkDisplayVlan:t,isManaged:""})},onNetworkChange:function(e){this.clearBaseHeader(),this.renderNetworkConfig(e.target.value)},renderNetworkConfig:function(t){var i=this,n=this.$(".fs-net-vlans");this.networks.forEach(function(s){s.get(e.UUID)===t&&(i.networkModel=s,i.parentView.networkModel=s,"Select"===n.val()&&n.val(s.get(e.UUID)).change())}),this.renderPerNetworkSelected(this.networkModel)},isManagedNetworkSelected:function(){var t=this.$(".fs-net-vlans").val();return this.networks.find(function(i){return i.get(e.UUID)===t&&i.isManagedNetwork()})},renderPerNetworkSelected:function(e){s.hasESX()?this.renderEsxDnsInfo():this.renderDnsInfo(e),this.renderNetworkInfoPerNetworkType(e)},renderEsxDnsInfo:function(){this.internal||(this.model.isNew()?this.parentView.renderNetworkDnsConfig():this.parentView.$(".domainNameServers").val(this.model.get(this.model.DP.DNS_SERVER_IP_ADDRESSES)))},renderDnsInfo:function(e){var t=[];if(!this.internal&&this.model.isNew()){if(e){var i=e.DP,n=i[i.IP_CONFIG],s=n[i.DHCP_OPTIONS];e.getDhcpOptionsAttr(s.DNS_SERVERS)&&t.push(e.getDhcpOptionsAttr(s.DNS_SERVERS))}this.parentView.renderNetworkDnsConfig(t)}else this.parentView.$(".domainNameServers").val(this.model.get(this.model.DP.DNS_SERVER_IP_ADDRESSES))},renderNetworkInfoPerNetworkType:function(e){!s.hasESX()&&e&&e.isManagedNetwork()?(this.$(".managed-network-details").show(),this.$(".fs-networkDetail").show(),this.$(".fs-networkConfig").hide(),this.$(".networkIpConfig").hide(),this.subViewHelper.destroy(),this.$(".networkType").val("Managed"),this.fetchManagedNetworkAddress(e)):(this.$(".fs-networkConfig").show(),this.$(".networkIpConfig").show(),this.$(".fs-networkDetail").hide(),this.$(".required-number-ips").html(this.parentView.getRequiredNumberOfIps()),this.renderUnmanagedNetwork()),this.model.isNew()||!this.model.get(this.model.DP.IS_SCALEOUT)&&this.fsSupportNFS||this.disableGatewayAndSubnet()},fetchManagedNetworkAddress:function(t){var n=this;this.addressCollection=new i(null,{networkAddressId:t.get(e.UUID)}),this.addressCollection.fetch({success:function(){n.renderManagedNetworkDetails(t,n.addressCollection)},error:function(e){this.showError(this.i18n("network_address_error")+e.responseText)}})},renderManagedNetworkDetails:function(e,t){var i=this,n=e.getIpPool();if(!n.length)return void this.showError(this.i18n("not_enough_address"));var s,a=_.map(n,function(e){return s=e.range.split(" "),i.i18ns("ip_range",s[0],s[1])}),r=(n[0].range.split(" "),t.length),o=void 0;o=this.model.get(this.model.DP.IS_SCALEOUT)?this.getNewRequiredNumberOfIps():this.parentView.getRequiredNumberOfIps();var l=this.model.getAvailableIpsPerNetwork(e);this.$(".networkType").val("Managed");var c=l-r;c=this.getAvailableIpCount(c),this.$("#managedNetworkDetail tbody").empty(),this.$("#managedNetworkDetail tbody").append(p({selectedVlan:e.getDisplayName(),networkPrefix:e.getNetworkAddressWithPrefix(),firstIpPool:a.join().replace(",",", "),numberOfPools:n.length-1,availableIps:l,requiredIps:o,subnetMask:"",defaultGateway:"",subnetMaskLabel:this.i18n("subnet_mask"),gatewayLabel:this.i18n("gateway"),vlanLabel:this.i18n("vlan_id_label"),ipRangeLabel:this.i18n("ip_range_label"),morePoolLabel:this.i18n("more_pool_label"),NoOfIpsLabel:this.i18n("no_of_ips_label"),usedIpLabel:this.i18ns("used_ips",o,c)})),this.isNetworkIPChanged()||this.model.get(this.model.DP.IS_SCALEOUT)?this.$(".requiredIps").removeClass("hidden"):this.$(".requiredIps").hasClass("hidden")||this.$(".requiredIps").addClass("hidden"),l-r<o&&this.isNetworkIPChanged()&&this.showError(this.i18n("not_enough_address"))},getNewRequiredNumberOfIps:function(){return parseInt(this.model.get(this.model.DP.NUM_NVMS),10)-this.model.get(this.model.DP.NVMS).length},isNetworkIPChanged:function(){var e,t=this.saveForm();return e=this.internal?this.parentView.origModel.get(this.model.DP.INTERNAL_NETWORK):this.parentView.origModel.get(this.model.DP.EXTERNAL_NETWORK)&&this.parentView.origModel.get(this.model.DP.EXTERNAL_NETWORK)[0],this.compareFormInputs(e,t)},onAddIpAddressClick:function(e){e.preventDefault(),this.$(".ipAddressBtnWrapper").hide(),this.$(".ipAddressLbl").hide(),this.$(".component-table-input").show()},onNextClick:function(){var e=this.getFormInputs(),t=[],i=[],n={};return e.gateway&&t.push(e.gateway),e.netmask&&i.push(e.netmask),n={gateway:this.model.getFormField(t,"gateway","gateway"),netmask:this.model.getFormField(i,"netmask","netmask")},this.validateForm(n,e.networkType,e.uuid)},saveForm:function(){this.model.actionMode===a.ACTION_UPDATE&&this.model.isNew(!1);var e=this.getFormInputs();return{subnetMask:e.netmask,defaultGateway:e.gateway,uuid:e.uuid,pool:this.calculateIPPool()}},calculateIPPool:function(){var e=[];return this.subViewHelper.get("ipPoolForm")&&(e=this.subViewHelper.get("ipPoolForm").getIpPool().ipPoolRange),e},getAvailableIpCount:function(e){if("FileServerInternalNetworkPage"===this.parentView.name){var t=this.parentView.getWizard().subViewHelper.get("fs-fileServerExternalNetwork");this.networkModel.cid===t.networkModel.cid&&(this.model.get(this.model.DP.IS_SCALEOUT)?e-=this.getNewRequiredNumberOfIps():e-=t.getRequiredNumberOfIps())}return e},validateForm:function(e,t,i){this.clearBaseHeader();var n=[],s=this;if(t||"Managed"===t){var a=void 0;a=this.model.get(this.model.DP.IS_SCALEOUT)?this.getNewRequiredNumberOfIps():this.parentView.getRequiredNumberOfIps();var r=this.addressCollection.length,l=this.model.getAvailableIpsPerNetwork(this.networkModel)-r;l=this.getAvailableIpCount(l),l<a&&this.isNetworkIPChanged()&&n.push(this.i18n("not_enough_address"))}else{_.each(e,function(e){var t=s.model.isValidInputs(e.value,e.description);t?(s.$("."+e.fieldName).addClass("error-class"),-1===n.indexOf(t)&&n.push(t)):s.$("."+e.fieldName).removeClass("error-class")});var c=this.isValidIpPool();c&&n.push(c)}var u=o.isTableRowSaved(this.$el);return u.valid||n.push(u.message),i&&"Select"===i&&n.push(this.i18n("invalid_network")),n},getFormInputs:function(){return{gateway:$.trim(this.$(".gateway").val()),netmask:$.trim(this.$(".netmask").val()),networkType:$.trim(this.$(".networkType").val()),uuid:$.trim(this.$(".fs-net-vlans").val())}},compareFormInputs:function(e,t){var i=this;e=e||{};var n=[this.model.DP.UUID];return!s.hasESX()&&this.networkModel&&this.networkModel.isManagedNetwork()||(n=n.concat([this.model.DP.NETMASK,this.model.DP.GATEWAY,this.model.DP.IPPOOL])),_.find(n,function(n){return n===i.model.DP.IPPOOL?e[n].sort().join()!==t[n].sort().join():e[n]!==t[n]})},isValidIpPool:function(){var e,t=this.subViewHelper.get("ipPoolForm")&&this.subViewHelper.get("ipPoolForm").getIpPool();return t?(!t.numberOfIps||t.numberOfIps<this.parentView.getRequiredNumberOfIps())&&this.isNetworkIPChanged()?(this.$(".edit .startIpRange").addClass("error-class"),this.$(".edit .endIpRange").addClass("error-class"),e=this.i18n("not_enough_address")):t.numberOfIps>this.parentView.getRequiredNumberOfIps()?(this.$(".edit .startIpRange").addClass("error-class"),this.$(".edit .endIpRange").addClass("error-class"),e=c.t("FileServerIpPoolFormView","exceeds_ips")):(this.$(".edit .startIpRange").removeClass("error-class"),this.$(".edit .endIpRange").removeClass("error-class")):e=this.i18n("select_port_group"),e},renderUnmanagedNetwork:function(){var t,i,n=null,s=null;this.model.isNew()||(this.internal?(n=this.model.get(this.model.DP.INTERNAL_NETWORK).subnetMask,s=this.model.get(this.model.DP.INTERNAL_NETWORK).defaultGateway,t=this.model.get(this.model.DP.INTERNAL_NETWORK).pool,i=this.model.get(this.model.DP.INTERNAL_NETWORK).uuid):(n=this.model.get(this.model.DP.EXTERNAL_NETWORK)[0].subnetMask,s=this.model.get(this.model.DP.EXTERNAL_NETWORK)[0].defaultGateway,t=this.model.get(this.model.DP.EXTERNAL_NETWORK)[0].pool,i=this.model.get(this.model.DP.EXTERNAL_NETWORK)[0].uuid),this.networkModel&&this.networkModel.get(e.UUID)!==i&&(n=s=null)),t&&(n||s)?(this.$(".ipAddressBtnWrapper").hide(),this.$(".ipAddressLbl").hide(),this.$(".component-table-input").show()):(this.$(".ipAddressBtnWrapper").show(),this.$(".ipAddressLbl").show(),this.$(".component-table-input").hide()),this.renderEsxDnsInfo(),this.$(".netmask").val(n),this.$(".gateway").val(s),this.$(".managed-network-details").show(),this.$(".networkType").val(""),this.subViewHelper.destroy(),this.renderNetworkDetails(n,s)},renderNetworkDetails:function(e,t){var i=this.model.isNew()||!e&&!t,n=i?null:this.getIpPoolList(),s=!0,r=!0,o=!1,l=parseInt(this.model.get(this.model.DP.NUM_NVMS),10);this.model.get(this.model.DP.NVMS)&&(o=l>this.model.get(this.model.DP.NVMS).length),this.model.actionMode===a.ACTION_UPDATE&&n&&(!o&&this.model.get(this.model.DP.IS_SCALEOUT)||!this.model.get(this.model.DP.IS_SCALEOUT)&&!this.fsSupportNFS)&&(s=r=!1);var c=void 0;this.model.isNew()||(o&&(c=!1,s=!0),this.model.get(this.model.DP.NVMS).length&&l<this.model.get(this.model.DP.NVMS).length&&(r=!0));var u=new d({el:this.$("#fsIpPoolNetworkForm"),model:this.model,internal:this.internal,isNvmChanged:this.model.get(this.model.DP.IS_SCALEOUT),isActionEnabled:r,isOldActionEnabled:c,isNewActionEnabled:s,data:n});u.setParentView(this),this.subViewHelper.register("ipPoolForm",u),u.render(i)},renderSelectedNetwork:function(){var e=$(".fs-net-vlans option:first").val();this.model.isNew()||(this.model.get(this.model.DP.INTERNAL_NETWORK)&&this.model.get(this.model.DP.EXTERNAL_NETWORK)?e=this.internal?this.model.get(this.model.DP.INTERNAL_NETWORK).uuid:this.model.get(this.model.DP.EXTERNAL_NETWORK)[0].uuid:this.model.isNew(!0),this.renderNetworkConfig(e),this.showNetworkChangeMessage())},checkIfFsHasOnlyOneVm:function(){return this.model.get(this.model.DP.NUM_NVMS)&&1===parseInt(this.model.get(this.model.DP.NUM_NVMS),10)||this.model.get(this.model.DP.NVMS)&&1===this.model.get(this.model.DP.NVMS).length},showNetworkChangeMessage:function(){var e;!this.model.isNew()&&parseInt(this.model.get(this.model.DP.NUM_NVMS),10)>this.model.get(this.model.DP.NVMS).length?(e=parseInt(this.model.get(this.model.DP.NUM_NVMS),10)-this.model.get(this.model.DP.NVMS).length,this.showInfo(this.i18ns("no_of_vms_text",e))):!this.model.isNew()&&parseInt(this.model.get(this.model.DP.NUM_NVMS),10)<this.model.get(this.model.DP.NVMS).length&&(e=this.model.get(this.model.DP.NVMS).length-parseInt(this.model.get(this.model.DP.NUM_NVMS),10),this.showInfo(this.i18ns("remove_vms_info",e,e)))},getIpPoolList:function(){var e,t=[];return e=this.internal?this.model.get(this.model.DP.INTERNAL_NETWORK).pool:this.model.get(this.model.DP.EXTERNAL_NETWORK)[0].pool,_.each(e,function(e){var i=e.split(" ");t.push({startAddress:i[0],endAddress:i[1],numberOfIps:r.strToLongIP(i[1])-r.strToLongIP(i[0])+1})}),t},onDeleteDns:function(){var e={action:a.ACTION_ADD_DNS,actionTarget:a.ENTITY_FILE_SERVER,actionTargetId:this.model.get(this.model.DP.UUID),actionTargetName:this.model.get(this.model.DP.NAME)};this.parentView.getWizard().hide(),u.executeAction(e)}})}),define("text!templates/wizards/fileserver/FileServerExternalNetworkPage.html",[],function(){return'\x3c!-- File Server External Network Form. --\x3e\n<div class="n-modal-content">\n  <div data-ntnx-content-inner>\n    <form id="fsExternalNetworkForm" class="external-network fs-extNetworkForm">\n      \x3c!-- External Network vlan description.--\x3e\n      <section data-ntnx-section="type-subtitle">\n        <%= i18n(\'vlan_description\') %>\n      </section>\n\n      \x3c!-- External Network Logo --\x3e\n      <section id="externalNetworkLogoContainer" data-ntnx-section>\n        \x3c!-- logo goes here --\x3e\n      </section>\n\n      \x3c!-- network form sub view --\x3e\n      <div id="fsExtNetworkForm"></div>\n\n      <section class="extNetwork-config" data-ntnx-section="type-separator">\n        <h5 data-ntnx-title><%= i18n(\'add_dns_and_ntp_serevers\') %></h5>\n        \x3c!-- DNS Name Servers.  --\x3e\n        <section data-ntnx-section>\n          <label data-ntnx-label><%= i18n(\'dns_ip\') %></label>\n          <input type="text" class="domainNameServers"/>\n        </section>\n\n        \x3c!-- NTP Servers.  --\x3e\n        <section data-ntnx-section>\n          <label data-ntnx-label><%= i18n(\'ntp_serevers\') %></label>\n          <input type="text" class="ntpServers"/>\n        </section>\n      </section>\n      \x3c!-- empty space in bottom of the form --\x3e\n      <section data-ntnx-section="type-text"></section>\n    </form>\n  </div>\n</div>\n'}),
define("views/wizards/fileserver/FileServerExternalNetworkPage",["data/DataProperties","views/basecomponents/wizards/BaseWizardPage","utils/AppUtil","utils/AppConstants","utils/SubViewHelper","views/wizards/fileserver/FileServerNetworkFormView","text!templates/wizards/fileserver/FileServerExternalNetworkPage.html"],function(e,t,i,n,s,a,r){"use strict";var o=_.template('<a class="externalPopupLink" <%= actionAttributes %>><%= title %></a>'),l=_.template(r);return t.extend({name:"FileServerExternalNetworkPage",clusterModel:null,subViewHelper:null,networks:null,model:null,initialize:function(e){t.prototype.initialize.apply(this,arguments);var i=this.model[0],n=this.model[1];this.model=i,this.origModel=jQuery.extend(!0,{},i),this.networks=n,this.subViewHelper=new s},render:function(){if(this.isViewRendered){this.model.isNew()&&this.model.set(this.model.DP.EXTERNAL_NETWORK,null);var e=this.subViewHelper.get("fileServerExtNetworkForm");return e.$(".fs-net-vlans").val()!==e.SELECT&&e.reRenderNetwork(),void this.renderNetworkImage()}this.renderExternalNetwork(),this.disableDnsNtp(),this.isViewRendered=!0},createActionLink:function(e,t){return o({title:e,actionAttributes:i.createActionAttr(t,n.ACTION_SHOW)})},canEnablePageLink:function(){return!1},onPageTransition:function(e){var t=this.$(".domainNameServers").val().trim(),i=this.$(".ntpServers").val().trim();t&&(t=t.split(","),t=$.map(t,$.trim)),i&&(i=i.replace(/,\s*$/,""),i=i.split(","),i=$.map(i,$.trim));var n={dnsNameServers:t,ntpServers:i,continuation:e};this.validateFormAndSetModel(n)},getButtonLabel:function(e){return e<0?"Back":null},onPageCancel:function(){return!0},destroy:function(){this.subViewHelper.destroy(),t.prototype.destroy.apply(this)},renderExternalNetwork:function(){this.$el.addClass("fs-fileServerExternalNetwork"),this.$el.html(l(this.vtOptions())),this.model.isNew()?(this.clusterModel=this.model.clusterManager.getCurrentClusterModel(),this.fetchCurrentClusterDetails(),this.renderNetworkDnsConfig()):this.renderNtpServers(this.model.get(this.model.DP.NTP_SERVERS));var e=new a({el:this.$("#fsExtNetworkForm"),model:this.model,networks:this.networks,internal:!1});e.setParentView(this),this.subViewHelper.register("fileServerExtNetworkForm",e),e.render(),this.renderNetworkImage()},renderNetworkImage:function(){var e=this.subViewHelper.get("fileServerExtNetworkForm").checkIfFsHasOnlyOneVm()?'<img src="./app/assets/images/fileserver/external-1node.png">':'<img src="./app/assets/images/fileserver/external_network.png">';this.$("#externalNetworkLogoContainer").html(e)},getRequiredNumberOfIps:function(){return parseInt(this.model.get(this.model.DP.NUM_NVMS),10)||this.model.get(this.model.DP.NVMS).length},fetchCurrentClusterDetails:function(){var e=this;this.clusterModel.fetch({success:function(){e.renderNtpServers()},error:function(e){i.debug(e.responseText)}})},renderNetworkDnsConfig:function(t){var i=[],n=[];this.clusterModel&&(i=this.clusterModel.get(e.CLUSTER_NAME_SERVERS)||[]),n=t&&t.length>0?t:i,this.$(".domainNameServers").val(n)},renderNtpServers:function(e){if(e)this.$(".ntpServers").val(e||"");else{var t="";this.clusterModel&&(t=this.clusterModel.get(this.model.DP.NTP_SERVERS)),this.$(".ntpServers").val(t)}},validateFormAndSetModel:function(e){var t=[];if(!this.validateAndHandleError(this.prepareFormInputElement(e.dnsNameServers,e.ntpServers))){t.push(this.onViewSaveForm());var i=this.origModel.get(this.model.DP.EXTERNAL_NETWORK)&&this.origModel.get(this.model.DP.EXTERNAL_NETWORK)[0];!this.model.isNew()&&this.subViewHelper.get("fileServerExtNetworkForm").compareFormInputs(i,t[0])?this.model.isExternalChanged=!0:this.model.isExternalChanged&&delete this.model.isExternalChanged,this.model.set({externalNetworks:t,dnsServerIpAddresses:e.dnsNameServers,ntpServers:e.ntpServers}),e.continuation()}},prepareFormInputElement:function(e,t){return{dnsNameServers:this.model.getFormField(e,"domain name server IP","domainNameServers"),ntpServers:this.model.getFormField(t,"ntp server","ntpServers")}},validateAndHandleError:function(e){var t=this,i=this.onViewNextClick();return _.each(e,function(e){var n=t.model.isValidInputs(e.value,e.description);n?(t.$("."+e.fieldName).addClass("error-class"),-1===i.indexOf(n)&&i.push(n)):t.$("."+e.fieldName).removeClass("error-class")}),i.length>0?(this.setWizardPageTitle(),this.showWizardError(i.join("<br/>"))):this.clearWizardPageTitle(),i.join("<br/>")},disableDnsNtp:function(){this.model.isNew()||parseInt(this.model.get(this.model.DP.NUM_NVMS),10)===this.model.get(this.model.DP.NVMS).length||(this.$(".domainNameServers").prop("disabled",!0),this.$(".ntpServers").prop("disabled",!0))},clearWizardPageTitle:function(){this.getWizard().clearCurrentPageTitleError()},setWizardPageTitle:function(){this.getWizard().setCurrentPageTitleError()},onViewNextClick:function(){return this.subViewHelper.get("fileServerExtNetworkForm").onNextClick()},onViewSaveForm:function(){return this.subViewHelper.get("fileServerExtNetworkForm").saveForm()},showWizardError:function(e){this.showError(e)}})}),define("text!templates/wizards/fileserver/FileServerInternalNetworkPage.html",[],function(){return'\x3c!-- File Server Internal Network Form. --\x3e\n<div class="n-modal-content">\n  <div data-ntnx-content-inner>\n    <form id="fsInternalNetworkForm" class="internal-network fs-intNetworkForm">\n      <section class="intNetwork-config">\n        \x3c!-- Internal Network vlan description.--\x3e\n        <section data-ntnx-section="type-subtitle">\n          <%= i18n(\'network_description\') %>\n        </section>\n\n        \x3c!-- Internal Network Logo --\x3e\n        <section id="internalNetworkLogoContainer" data-ntnx-section>\n          \x3c!-- logo goes here --\x3e\n        </section>\n\n        \x3c!-- network form sub view --\x3e\n        <div id="fsIntNetworkForm"></div>\n      </section>\n    </form>\n  </div>\n</div>\n'}),define("views/wizards/fileserver/FileServerInternalNetworkPage",["data/DataProperties","views/basecomponents/wizards/BaseWizardPage","utils/FileServerUtil","utils/AppUtil","utils/AppConstants","utils/SubViewHelper","views/wizards/fileserver/FileServerNetworkFormView","text!templates/wizards/fileserver/FileServerInternalNetworkPage.html"],function(e,t,i,n,s,a,r,o){"use strict";var l=_.template(o),c=_.template('<p><%= heading %><p><p class="modal-extensions"><%= desc %></p>');return t.extend({name:"FileServerInternalNetworkPage",subViewHelper:null,networks:null,initialize:function(e){t.prototype.initialize.apply(this,arguments);var n=this.model[0],r=this.model[1];this.model=n,this.origModel=jQuery.extend(!0,{},n),this.networks=r,this.subViewHelper=new a,this.fsSupportNFS=i.compareAFSversion(this.model,s.FILE_SERVER_VERSIONS.SPECTRE)>=0},render:function(){if(this.isViewRendered){this.model.isNew()&&this.model.set(this.model.DP.INTERNAL_NETWORK,null);var e=this.subViewHelper.get("fileServerIntNetworkForm");return e.$(".fs-net-vlans").val()!==e.SELECT&&e.reRenderNetwork(),void this.renderNetworkImage()}this.$el.addClass("fs-fileServerInternalNetwork"),this.$el.html(l(this.vtOptions()));var t=new r({el:this.$("#fsIntNetworkForm"),model:this.model,origModel:this.origModel,networks:this.networks,internal:!0});t.setParentView(this),this.subViewHelper.register("fileServerIntNetworkForm",t),t.render(),this.renderNetworkImage(),this.isViewRendered=!0},renderNetworkImage:function(){var e=this.subViewHelper.get("fileServerIntNetworkForm").checkIfFsHasOnlyOneVm()?'<img src="./app/assets/images/fileserver/internal-1node.png">':'<img src="./app/assets/images/fileserver/fs_internal_network.png">';this.$("#internalNetworkLogoContainer").html(e)},canEnablePageLink:function(){return!1},onPageTransition:function(e){this.validateFormAndSetModel(e)},getButtonLabel:function(e){return e<0?"Back":null},onPageCancel:function(){return!0},getSaveButtonLabel:function(){return this.model.actionMode===s.ACTION_ACTIVATE_FILE_SERVER?this.i18n("activate"):null},destroy:function(){this.subViewHelper.destroy(),t.prototype.destroy.apply(this)},getRequiredNumberOfIps:function(){var e=parseInt(this.model.get(this.model.DP.NUM_NVMS),10)||this.model.get(this.model.DP.NVMS).length;return 1!==e&&(e+=1),e},validateFormAndSetModel:function(e){var t=this.onViewNextClick();if(0===t.length){var i=this.onViewSaveForm();if(this.model.set({internalNetwork:i}),this.clearWizardPageTitle(),this.model.isNew())this.model.actionMode===s.ACTION_ACTIVATE_FILE_SERVER&&this.fsSupportNFS?$.nutanixConfirm({title:this.i18n("confirm_activate_title"),msg:this.i18n("confirm_activate_msg"),context:this,yes:function(){this.onConfirmAcvation(e)},class:"-compact",yesText:this.i18n("activate"),noText:this.i18n("cancel")}):e();else{this.model.setEntityName(this.model.get(this.model.DP.NAME));var n=parseInt(this.model.get(this.model.DP.NUM_NVMS),10),a=this.model.get(this.model.DP.NVMS).length;if(n!==a){this.model.actionMode===s.ACTION_REBALANCE&&this.model.isNew(!0);var r=!1;n<a&&this.model.get("hasNFSShare")&&(r=!0),this.confirmRebalance(this.model,r,this.i18n("rebalance_file_server_warning_msg"),e)}else{var o=this.origModel.get(this.model.DP.INTERNAL_NETWORK);this.subViewHelper.get("fileServerIntNetworkForm").compareFormInputs(o,i)?this.model.isInternalChanged=!0:this.model.isInternalChanged&&delete this.model.isInternalChanged;var l=this.model.get(this.model.DP.DNS_SERVER_IP_ADDRESSES)&&this.model.get(this.model.DP.DNS_SERVER_IP_ADDRESSES).join(),c=this.origModel.get(this.model.DP.DNS_SERVER_IP_ADDRESSES)&&this.origModel.get(this.model.DP.DNS_SERVER_IP_ADDRESSES).join(),u=this.model.get(this.model.DP.NTP_SERVERS)&&this.model.get(this.model.DP.NTP_SERVERS).join(),d=this.origModel.get(this.model.DP.NTP_SERVERS)&&this.origModel.get(this.model.DP.NTP_SERVERS).join(),h=l!==c||u!==d;if(!this.model.isExternalChanged&&!this.model.isInternalChanged&&!h)return this.showError(this.i18n("no_change_msg")),void this.setWizardPageTitle();this.checkUpdateType(e)}}}else this.showError(t.join("<br/>")),this.setWizardPageTitle()},onConfirmAcvation:function(t){var i=this;this.disableSaveButton(),this.disableCancelButton(),this.disablePreviousButton(),this.model.save(null,{success:function(i,s){n.processSerializedObject(s)[e.TASK_UUID]&&t()},error:function(e,t){i.enableSaveButton(),i.enableCancelButton(),i.enablePreviousButton(),n.log("FileServer: Error :"+t),t.responseText=t.responseText.replace(/'/g,""),i.showError("Error creating: "+n.processAjaxError(t.responseText))}})},clearWizardPageTitle:function(){this.getWizard().clearCurrentPageTitleError()},setWizardPageTitle:function(){this.getWizard().setCurrentPageTitleError()},onViewNextClick:function(){return this.subViewHelper.get("fileServerIntNetworkForm").onNextClick()},onViewSaveForm:function(){return this.subViewHelper.get("fileServerIntNetworkForm").saveForm()},confirmUpdate:function(e){$.nutanixConfirm({msg:this.i18n("update_cpu_memory_confirm_msg"),context:this,yes:function(){this.updateFileServer(e)},class:"-compact -red-confirm",yesText:this.i18n("reboot"),noText:this.i18n("cancel")})},checkUpdateType:function(e){var t="",i="";this.model.isExternalChanged&&this.model.isInternalChanged?(i=this.i18n("change_both_title"),t=this.i18n("change_both_msg")):this.model.isExternalChanged?(i=this.i18n("change_external_title"),t=this.i18n("change_external_msg")):this.model.isInternalChanged&&(i=this.i18n("change_internal_title"),t=this.i18n("change_internal_msg")),i?$.nutanixConfirm({title:i,msg:t,context:this,yes:function(){this.updateFileServer(e)},class:"-compact -blue-confirm",yesText:this.i18n("update_network"),noText:this.i18n("cancel")}):this.updateFileServer(e)},updateFileServer:function(t){delete this.model.isExternalChanged,delete this.model.isInternalChanged,this.getWizard().disableSaveButton(),this.disableCancelButton(),this.disablePreviousButton();var i=this;this.model.save(null,{success:function(i,s){n.processSerializedObject(s)[e.TASK_UUID]&&t()},error:function(e,t){i.getWizard().enableSaveButton(),i.enableCancelButton(),i.enablePreviousButton(),n.log("UpdateFileServerWizard: Error :"+t),i.showError("Error updating File Server: "+n.processAjaxError(t.responseText))}})},addNewAddedIp:function(){var e=this.origModel.get(this.model.DP.INTERNAL_NETWORK),t=this.model.get(this.model.DP.INTERNAL_NETWORK),i=this.origModel.get(this.model.DP.EXTERNAL_NETWORK)&&this.origModel.get(this.model.DP.EXTERNAL_NETWORK)[0],n=this.model.get(this.model.DP.EXTERNAL_NETWORK)&&this.model.get(this.model.DP.EXTERNAL_NETWORK)[0];t[this.model.DP.IPPOOL]=this.removeOldIp(e,t),n[this.model.DP.IPPOOL]=this.removeOldIp(i,n)},removeOldIp:function(e,t){var i=e&&e[this.model.DP.IPPOOL],n=t&&t[this.model.DP.IPPOOL];return _.each(i,function(e){n.indexOf(i[0])>=0&&n.splice(n.indexOf(i[0]),1)}),n},confirmRebalance:function(t,i,a,r){this.getWizard().disableSaveButton(),this.disableCancelButton(),this.disablePreviousButton(),i&&(a=c({heading:this.i18n("rm_vm_heading"),desc:this.i18n("rm_vm_desc")})),$.nutanixConfirm({msg:a,yes:function(){var i=this;parseInt(this.model.get(this.model.DP.NUM_NVMS),10)>this.model.get(this.model.DP.NVMS).length&&this.addNewAddedIp(),t.save(null,{success:function(t,i){n.processSerializedObject(i)[e.TASK_UUID]&&r()},error:function(e,t){i.getWizard().enableSaveButton(),i.enableCancelButton(),i.enablePreviousButton();var a=i.i18ns("server_error_message",e.actionMode);e.showClientNotification(s.NOTIFY_ERROR,a+n.processAjaxError(t.responseText))}})},no:function(){this.getWizard().enableSaveButton(),this.enableCancelButton(),this.enablePreviousButton()},class:i?"-red-confirm":"-compact",yesText:i?this.i18n("rm_vm"):this.i18n("continue"),noText:this.i18n("cancel"),context:this})}})}),define("models/fileserver/ICAPServerModel",["models/MinervaModel","data/DataURLConstants","managers/NotificationManager","utils/AppConstants"],function(e,t,i,n){"use strict";var s={UUID:"uuid",FS_UUID:"fileServerUuid",IP_ADDRESS:"ipAddress",PORT_NO:"portNumber",AVG_LATENCY:"avgLatency",CONNECTION_STATUS:"connectionStatus",DESCRIPTION:"description",ENABLE:"enable",NUM_DISCONNECT_COUNT:"numDisconnectCount",NUM_FILES_SCANNED:"numFileScanned",NAME:"name",KOK:"kOk",KUNREACHABLE:"kUnreachable",CONNECTION_STATUS_FETCHED:"connectionStatusFetched"};return e.extend({urlRoot:t.FILE_SERVER_ANTI_VIRUS_SERVER,entityType:n.ENTITY_ICAP_SERVERS,name:"ICAPServerModel",idAttribute:s.UUID,DP:s,defaults:{uuid:null,fileServerUuid:null},setEntityName:function(e){this.entityName=e},getValue:function(t){return t===this.nameAttribute?this.get(this.nameAttribute)||this.entityName:e.prototype.getValue.apply(this,arguments)},showSuccessNotification:function(e,t,s){e.actionMode===n.ACTION_CONNECTION_TEST&&s.value.split(":")[1].replace(/\s+/g,"")!==this.DP.KOK&&(e.set(this.DP.CONNECTION_STATUS,this.DP.KUNREACHABLE),i.showNotification(n.NOTIFY_WARNING,e,t,s)),this.enableNotifications&&i.showNotification(n.NOTIFY_SUCCESS,e,t,s)},getURL:function(){return this.actionMode===n.ACTION_UPDATE||this.actionMode===n.ACTION_CREATE?_.template(this.urlRoot,{fsUuid:this.get(this.DP.FS_UUID),uuid:""}):this.actionMode===n.ACTION_DELETE||this.actionMode===n.ACTION_FETCH?_.template(this.urlRoot,{fsUuid:this.get(this.DP.FS_UUID),uuid:this.get(this.DP.UUID)}):this.actionMode===n.ACTION_CONNECTION_TEST?_.template(t.FILE_SERVER_AV_TEST_CONNECTION,{fsUuid:this.get(this.DP.FS_UUID),uuid:this.get(this.DP.UUID)}):void 0}},{DP:s})}),define("views/popups/fileserver/ICAPServersTableInputView",["components/Components","views/basecomponents/tableinput/TableInputView","models/fileserver/ICAPServerModel","utils/AppUtil","utils/ValidationUtil","utils/AppConstants","utils/SVG"],function(e,t,i,n,s,a,r){"use strict";var o=_.template('<div class="header <% if (isNewActionEnabled) { %>-dual-pane<% } %>"><% if (isNewActionEnabled) { %><div class="title secondary"><%= i18n("icap_list") %></div><div class="header-table-input"><a class="link-table-input"><%= i18n("add_icap") %></a></div><% } %></div><table class="table table-data-items table-input <%= ebClass %>"><thead><tr><% _.each(columns, function(column) { %><th><%= column.columnName %></th><% }); %><% if (isActionEnabled) { %><th>Actions</th><% } %></tr></thead><tbody></tbody></table>'),l='<% if (isActionEnabled) { %><td class="data-cell cell-actions"><div class="action-links">'+r.SVGIcon("pencil","edit not-active")+'<a class="save active"><%= i18n("save") %></a><span class="middot"> &middot; </span>'+r.SVGIcon("x-round","delete not-active")+'<a class="cancel active"><%= i18n("cancel") %></a></div></td><% } %>',c=_.template('<tr data-id="<%= dataId %>" <%=isNew ? "new":""%> class="n-table-row"model-attribute="user-row" model-validate="isRowSaved"><% _.each(columns, function(column) { %><td class="data-cell"><% if(column.className === "connection-status") { %><div class="input-data connection-status"><%= column.renderer(data) %></div><% } else { %><% if(column.className === "description") { %><div class="input-data server-description"><input type="<%= column.type ? column.type : "text" %>" class="input-data <%= column.className ? column.className : "" %>" readonly <% if (modelAttribute) { %>model-attribute="<%= modelAttribute %>" <% } %>value="<%= column.renderer(data) %>"></div><% } else { %><input type="<%= column.type ? column.type : "text" %>" class="input-data <%= column.className ? column.className : "" %>" readonly <% if (modelAttribute) { %>model-attribute="<%= modelAttribute %>" <% } %>value="<%= column.renderer(data) %>" ><% } %><% } %></td><% }); %>'+l+"</tr>"),u=(_.template('<tr data-id="<%= dataId %>" new="true" class="n-table-row"><td class="data-cell"><input type="text" class="input-data ip-address" placeholder=""></td><td class="data-cell"><input type="number" class="input-data port" value="1344"></td><td class="data-cell"><input id="description" type="text" class="input-data description" placeholder=""></td><td class="data-cell"><div class="input-data connection-status">Not tested</div></td>'+t.EDIT_COLUMN_TEMPLATE+"</tr>"),_.template('<div class="connection-indication" connection-id="ok"><span  class="inactiveLink">'+e.icon("check")+'</span><span><%= i18n("ok") %></span></div>')),d=_.template('<div class="connection-indication retest-connection" connection-id="failed"><a>'+e.icon("x-round","-critical")+'</a><a><%= i18n("retest") %></a></div>'),h=_.template('<div class="connection-indication not-tested"><%= i18n("not_tested") %></div>');return t.extend({name:"ICAPServersTableInputView",className:"component-table-input",idAttribute:"id",fileServerUuid:null,isNewActionEnabled:!0,modelAttribute:null,tmplTable:null,icapSeverCount:null,ACTION_EVENTS:{EDIT:"edit",DELETE:"delete"},initialize:function(e){e.columns=this.getResourceTableColumns(),t.prototype.initialize.call(this,e),this.dataItems=e.dataItems||[],this.tmplDataRow=c,this.tmplTable=o,this.fileServerUuid=e.fileServerUuid,this.parent=e.parent,this.icapSeverCount=this.dataItems.length,this.addExtraEvents({"click div.retest-connection":"onClickTestConnection"})},getResourceTableColumns:function(){var e=this;return[{columnName:this.i18n("ip_address"),className:"ip-address",renderer:function(e){return e?e.ipAddress:""}},{columnName:this.i18n("port"),className:"port",renderer:function(e){return e?e.portNumber:"1344"}},{columnName:this.i18n("description"),className:"description",renderer:function(e){return e&&e.description?e.description:""}},{columnName:this.i18n("connection_status"),className:"connection-status",renderer:function(t){return t?"OK"===t.connectionStatus?u(e.vtOptions()):d(e.vtOptions()):h(e.vtOptions())}}]},onClickAddRow:function(){this.parent.disableNextButton(),this.addRow()},onClickEditLink:function(e){t.prototype.onClickEditLink.apply(this,arguments);var i=$(e.currentTarget),n=i.closest("tr").attr("data-id");if("ID_TO_BE_ADDED"!==n){var s=this.$('tr[data-id="'+n+'"]');s.find(".ip-address, .port").attr("readonly","readonly"),s.find(".ip-address, .port").parents("td").addClass("no-edit")}this.parent.disableNextButton()},onClickCancelLink:function(){this.resetTable(),this.icapSeverCount>=1&&this.parent.enableNextButton()},insertTableRow:function(e,i){t.prototype.insertTableRow.apply(this,arguments);var n=this.$("tr::last").find(".description"),s=n.val();s.length>21&&n.tooltip({title:s,placement:"right",trigger:"hover",html:!0})},saveRow:function(e){var t=$(e.currentTarget),i=t.closest("tr"),a=this.getRowData(i);if(a&&a.ipAddress){var r=a.ipAddress,o=r.indexOf(".")>0&&r.indexOf(".")<r.length-1;(n.isValidIP(r)||n.isValidHostname(r)&&o)&&s.isNumber(a.portNumber,"type=integer").valid?(a.description.length>21&&i.find(".description").tooltip({title:a.description,placement:"right",trigger:"hover",html:!0}),this.saveICAPServerData(i,a)):n.isValidIP(r)||n.isValidHostname(r)&&o?this.parent.showError(this.i18n("invalid_port_no")):this.parent.showError(this.i18n("invalid_ip"))}else i.remove()},onClickDeleteLink:function(e){var t=this,i=$(e.currentTarget),n=i.closest("tr"),s=this.getRowData(n),a="<p>"+this.i18ns("delete_confirm",s.ipAddress)+"</p>";1===this.icapSeverCount&&(a+=this.i18n("delete_warning")),$.nutanixConfirm({msg:a,yes:function(){t.confirmedDeleteRow(e,s)},context:t})},confirmedDeleteRow:function(e,t){var s=this,r=new i;r.set(r.DP.FS_UUID,this.fileServerUuid),r.set(r.DP.UUID,t.uuid),r.actionMode=a.ACTION_DELETE,r.setEntityName(t.ipAddress),r.isNew(!1),r.destroy({success:function(t,i){s.deleteRow(e),0===--s.icapSeverCount&&s.parent.disableNextButton()},error:function(e,t){s.parent.showError(n.processAjaxError(t.responseText))}})},getRowData:function(e){return{ipAddress:e.find(".ip-address").val(),portNumber:e.find(".port").val(),description:e.find(".description").val(),connectionStatus:e.find(".connection-status").val(),uuid:e.attr("data-id")}},saveICAPServerData:function(e,t){var s=this,r=new i;"ID_TO_BE_ADDED"!==t.uuid?(r.isNew(!1),r.actionMode=a.ACTION_UPDATE):(r.isNew(!0),r.actionMode=a.ACTION_CREATE,t.uuid=""),t.fileServerUuid=this.fileServerUuid,r.setEntityName(t.ipAddress),r.save(t,{success:function(i,n){var a=i.get(i.DP.UUID);e.attr("data-id",a),e.removeAttr("new"),t.uuid=a,r.isNew()&&s.icapSeverCount++,s.icapSeverCount>=1&&s.parent.enableNextButton(),s.resetTable(),s.testConnection(e,t,r)},error:function(e,t){n.log("Error :"+n.processAjaxError(t.responseText));var i="";i=e.isNew()?s.i18n("creating"):s.i18n("updating"),s.parent.showError(n.processAjaxError(t.responseText)+i)}})},onClickTestConnection:function(e){var t=$(e.currentTarget).closest("tr");this.testConnection(t)},testConnection:function(e,t,s){var r,o=this;t?r=s:(t=this.getRowData(e),r=new i,r.set(r.DP.FS_UUID,this.fileServerUuid),r.setEntityName(t.ipAddress)),r.isNew(!0),r.actionMode=a.ACTION_CONNECTION_TEST,r.save(t,{success:function(t,i){"kOk"===t.get("value").replace(/\s/g,"").split(":")[1]?e.find(".connection-status").html(u(o.vtOptions())):e.find(".connection-status").html(d(o.vtOptions()))},error:function(e,t){n.log("ICAPServersExceptionPopup: Error :"+t),o.parent.showError(n.processAjaxError(t.responseText))}})}},{EDIT_COLUMN_TEMPLATE:l})});define("models/fileserver/ICAPServerCollection",["models/PollingCollection","models/fileserver/ICAPServerModel","data/DataURLConstants","utils/AppConstants"],function(e,t,i,n){"use strict";return e.extend({model:t,url:null,intervalTimeInMilliSec:n.ANTI_VIRUS_POLLING_INTERVAL,name:"ICAPServerCollection",setFSId:function(e){this.url=_.template(i.FILE_SERVER_ANTI_VIRUS_SERVERS,{fsUuid:e})}})}),define("text!templates/wizards/fileserver/FileServerICAPServersPage.html",[],function(){return'\x3c!-- File Server ICAP Servers Form. --\x3e\n<form id="fsICAPServersForm" class="form-horizontal fs-ICAPServersForm">\n  <div class="active fsicapservers-content">\n    <p data-ntnx-title>\n      <%= i18n(\'connect_cap_servers\') %>\n    </p>\n    <div class="table-wrapper">\n    </div>\n    <div class="icap-status">\n      <div class="no-table-wrapper"><%= i18n(\'no_icap_server\') %>\n        <div class="n-clearfix">\n          <span class="btn btnICAPAdd btn-primary"><%= i18n(\'connect_icap_server\') %></span>\n        </div>\n      </div>\n    </div>\n  </div>\n</form>'}),define("views/wizards/fileserver/FileServerICAPServersPage",["views/basecomponents/wizards/BaseWizardPage","views/popups/fileserver/ICAPServersTableInputView","models/fileserver/ICAPServerCollection","utils/AppUtil","utils/AppConstants","text!templates/wizards/fileserver/FileServerICAPServersPage.html"],function(e,t,i,n,s,a){"use strict";var r=_.template(a);return e.extend({name:"FileServerICAPServersPage",events:{"click    .btnICAPAdd":"handleAddICAPServerClick"},render:function(){if(!this.isViewRendered){var e=this,t=new i;t.setFSId(this.model.actionTargetId),n.showLoader(),t.fetch({silent:!0,success:function(t){n.hideLoader(),e.renderModel(t.models)},error:function(t,i){n.hideLoader(),e.showError(n.processAjaxError(i.responseText)),e.renderModel([])}})}},renderModel:function(e){this.$el.html(r(this.vtOptions({}))),e.length?(this.$(".icap-status").hide(),this.$(".table-wrapper").show(),this.addICAPServerTable(e)):(this.disableNextButton(),this.$(".icap-status").show(),this.$(".table-wrapper").hide()),this.isViewRendered=!0,this.model.clickAction===s.ENTITY_ICAP_SERVERS&&this.handleICAPServerTabActions(this.model.actionId)},addICAPServerTable:function(e){var i=new t({idAttribute:"uuid",fileServerUuid:this.model.actionTargetId,entityType:s.ENTITY_ICAP_SERVERS,disableInlineEdit:!1,ebTableStyle:!0,dataItems:e,parent:this,columns:[]});this.$(".table-wrapper").html(i.render().el)},handleAddICAPServerClick:function(){this.$(".icap-status").hide(),this.$(".table-wrapper").show(),this.addICAPServerTable([]),$("a.link-table-input").click()},handleICAPServerTabActions:function(e){var t=this.model.actionTargetElem;if(e===s.ACTION_ADD)$("a.link-table-input").click();else if(t){var i='table.entity-browser-table > tbody > tr[data-id = "'+t+'"] > td.cell-actions > div.action-links > .edit';$(i).click()}},canEnablePageLink:function(){return!1},onPageTransition:function(e){this.$(".description").tooltip("destroy"),e()},showCancelButton:function(){return!1},getButtonLabel:function(e){return e<0?this.i18n("back"):null}})}),define("models/fileserver/ScanSettingModel",["models/MinervaModel","data/DataURLConstants","utils/AppConstants"],function(e,t,i){"use strict";var n={ENABLE_ANTIVIRUS:"enableAntiVirus",SCAN_ON_READ:"scanOnRead",SCAN_ON_WRITE:"scanOnWrite",FILE_TYPE_EXCLUSIONS:"fileTypeExclusions",FILE_SIZE_EXCLUSION:"fileSizeExclusion",SCAN_TIMEOUT_INTERVAL_IN_SECS:"scanTimeoutIntervalInSecs",BLOCK_ACCESS_FILE:"blockAccessFile"};return e.extend({urlRoot:t.FILE_SERVER_AV_SCAN_POLICY,entityType:i.ENTITY_AV_SCAN_POLICY,name:"ScanSettingModel",DP:n,defaults:{uuid:null},setuuid:function(e){this.uuid=e},setEntityName:function(e){this.entityName=e},getValue:function(t){return t===this.nameAttribute?this.get(this.nameAttribute)||this.entityName:e.prototype.getValue.apply(this,arguments)},getURL:function(){if(this.actionMode===i.ACTION_UPDATE||this.actionMode===i.ACTION_CREATE||this.actionMode===i.ACTION_FETCH)return _.template(this.urlRoot,{uuid:this.uuid})}})}),define("models/fileserver/ShareCollection",["models/PollingCollection","models/fileserver/ShareModel","data/DataProperties","data/DataURLConstants"],function(e,t,i,n){"use strict";return e.extend({model:t,url:n.FILE_SERVERS_SHARES,name:"ShareCollection",fileServerId:null,setFSId:function(e){this.fileServerId=e},parse:function(i,n){return i=e.prototype.parse.apply(this,arguments),_.each(i,function(e){e&&(e.uuid=e.fileServerUuid+":"+e.uuid)},this),this.fileServerId?_.filter(i,function(e){return e[t.DP.FILE_SERVER_UUID]===this.fileServerId},this):i},comparator:function(e){return(e.get(i.NAME)||"").toLowerCase()}})}),define("text!templates/wizards/fileserver/FileServerAntivirusContent.html",[],function(){
return'<% if (!isAll) { %>\n<div data-ntnx-content-inner>\n<% } %>\n  <form id="scan-setting" class="form-horizontal fs-scansSettingForm">\n    <section class="shareLevelException-config">\n      \x3c!-- share type container --\x3e\n      <% if (isAll) { %>\n        <div>\n          <span class="all-header">\n          <%= i18n(\'scan_settings_all\') %>\n          </span>\n          <div class="all-header-description">\n            <%= i18n(\'apply_to_all\') %>\n          </div>\n          <section data-ntnx-section class="nfsWarningContainer hidden">\n            <div class="nfsWarning"></div>\n          </section>\n        </div>\n      <% } else { %>\n        <section data-ntnx-section>\n          <%= Components.checkbox({\n            jsClasses: \'enable-checkbox\',\n            labelText: i18n(\'enable_antivirus\')\n          }) %>\n        </section>\n        <section data-ntnx-section class="multiprotocolInfoContainer hidden">\n          <div class="multiprotocolInfo"></div>\n        </section>\n      <% } %>\n    </section>\n\n    <section data-ntnx-section class="scanType-config">\n      <div data-ntnx-title="type-text">\n        <%= i18n(\'scan_type\') %>\n        <span class="nutanixMoreInfo"\n          data-tooltip-classes="-nudge-up"\n          data-tooltip-container="body"\n          data-tooltip-title="<%= scantypeTitle %>"></span>\n      </div>\n\n      <section data-ntnx-section>\n        <%= Components.checkbox({\n          jsClasses: \'write-checkbox\',\n          labelText: i18n(\'scan_on_write\')\n        }) %>\n      </section>\n      <section data-ntnx-section>\n        <%= Components.checkbox({\n          jsClasses: \'read-checkbox readCheckBox\',\n          labelText: i18n(\'scan_on_read\')\n        }) %>\n      </section>\n      <section data-ntnx-section class="scanReadWarningContainer hidden">\n        <div class="scanReadWarning"></div>\n      </section>\n    </section>\n\n    <section class="Exclue-config">\n      \x3c!-- File type container --\x3e\n      <section data-ntnx-section>\n        <label data-ntnx-label>\n          <%= i18n(\'exclude_file_types\') %>\n        </label>\n        <input type="text" class="exclude-types"\n          placeholder="<%= i18n(\'exclude_file_types_placeholder\') %>">\n      </section>\n      \x3c!-- File size container --\x3e\n      <section data-ntnx-section>\n        <label data-ntnx-label>\n          <%= i18n(\'exclude_files_size\') %>\n          <span class="nutanixMoreInfo"\n            data-tooltip-classes="-nudge-up"\n            data-tooltip-container="body"\n            data-tooltip-title="<%= i18n(\'excludeSizeTitle\') %>"></span>\n        </label>\n        <input type="text" class="exclude-size"\n          placeholder="<%= i18n(\'exclude_file_size_placeholder\') %>">\n        <div class="unit">\n          <span class="quota-unit"><%= i18n(\'mb\') %></span>\n        </div>\n      </section>\n    </section>\n\n    <section class="advanced-config">\n      <section data-ntnx-section>\n        <%= Components.checkbox({\n          id: \'advancedOptions\',\n          jsClasses: \'advancedOptions\',\n          labelText: i18n(\'show_advanced_options\')\n        }) %>\n      </section>\n      <div class="section-content advancedOptions"\n      style="display: none;">\n        \x3c!-- Set scan timeout --\x3e\n        <section data-ntnx-section>\n          <label data-ntnx-label>\n            <span>\n              <%= i18n(\'scan_timeout\') %>\n            </span>\n            <span class="nutanixMoreInfo"\n              data-tooltip-classes="-nudge-up"\n              data-tooltip-container="body"\n              data-tooltip-title="<%= timeoutTitle %>"></span>\n            <span class="pull-right">\n              <%= i18n(\'max_timeout\') %>\n            </span>\n          </label>\n          <input type="text" class="scan-timeout">\n          <div class="unit">\n            <span class="time-unit">\n              <%= i18n(\'seconds\') %>\n            </span>\n          </div>\n        </section>\n        \x3c!-- Enable Block access to files --\x3e\n        <section data-ntnx-section>\n          <%= Components.checkbox({\n            jsClasses: \'blockaccess-checkbox\',\n            labelText: i18n(\'block_access_to_files\')\n          }) %>\n          <span class="nutanixMoreInfo"\n            data-tooltip-classes="-nudge-up"\n            data-tooltip-container="body"\n            data-tooltip-title="<%= blockAccessTitle %>"></span>\n        </section>\n      </div>\n    </section>\n    <% if (!isAll) { %>\n      \x3c!-- Cover --\x3e\n      <div class="n-cover"\n        style="display: <%= !isAll ? \'none\' : \'block\' %>">\n      </div>\n      \x3c!-- Cover --\x3e\n      <div class="enable-cover"\n        style="display: <%= !isAll ? \'none\' : \'block\' %>">\n      </div>\n    <% } %>\n  </form>\n<% if (!isAll) { %>\n      </div>\n<% } %>'}),define("views/wizards/fileserver/FileServerScanSettingsPage",["components/Components","views/basecomponents/wizards/BaseWizardPage","models/fileserver/ScanSettingModel","models/fileserver/ShareCollection","managers/NotificationManager","utils/AppUtil","utils/ValidationUtil","utils/AppConstants","utils/CommonTemplates","text!templates/wizards/fileserver/FileServerAntivirusContent.html"],function(e,t,i,n,s,a,r,o,l,c){"use strict";var u=_.template(c);return t.extend({name:"FileServerScanSettingsPage",new:!1,uuid:null,events:{"change  #advancedOptions":"onToggleAdvancedOptions"},render:function(){var e=this;if(!this.isViewRendered){var t=new i;t.setuuid(this.model.actionTargetId),t.actionMode=o.ACTION_FETCH,a.showLoader();var r=t.fetch({silent:!0}),l=new n;l.setFSId(this.model.actionTargetId);var c=l.fetch({silent:!0}),u=function(i,n){a.hideLoader();var s=_.find(l.models,function(t){return t.get(t.DP.PROTOCOL_TYPE)===o.FS_PROTOCOLS.NFS&&e.model.actionTargetId===t.get(t.DP.FILE_SERVER_UUID)&&t.get(t.DP.SECONDARY_PROTOCOL_TYPE)!==o.FS_PROTOCOLS.SMB});t.get("uuid")||e.showError(e.i18n("scan_policy_missing")),e.renderModel(t,!!s)},d=function(t,i){a.hideLoader(),t===o.STATE_ERROR&&s.showClientNotification(o.NOTIFY_ERROR,e.i18n("scan_policy_missing")),i===o.STATE_ERROR&&s.showClientNotification(o.NOTIFY_ERROR,e.i18n("share_fetch_failure")),e.renderModel()};$.when(r,c).then(u,d)}},renderModel:function(t,i){this.$el.html(u(this.vtOptions({isAll:!0,Components:e,timeoutTitle:this.i18n("timeout_message"),scantypeTitle:this.i18n("scan_type_message"),blockAccessTitle:this.i18n("block_access_message")}))),this.$(".nutanixMoreInfo").nutanixMoreInfo({parseDataAttrs:!0,placement:"right"});var n=this.i18n("disable_scan_message");i&&(n+=this.i18n("not_support_message"));var s=l.INFO({msg:n});if(this.$(".nfsWarning").html(s),this.$(".nfsWarningContainer").removeClass("hidden"),t){var a=t.get(t.DP.FILE_SIZE_EXCLUSION);a&&t.set(t.DP.FILE_SIZE_EXCLUSION,a*Math.pow(2,-20)),this.fillScanSettings(t),this.uuid=t.uuid}this.isViewRendered=!0},fillScanSettings:function(e){this.$(".read-checkbox").prop("checked",e.get(e.DP.SCAN_ON_READ)),this.$(".write-checkbox").prop("checked",e.get(e.DP.SCAN_ON_WRITE)),e.fileTypeExclusions?this.$(".exclude-types").val(e.get(e.DP.FILE_TYPE_EXCLUSIONS).join()):this.$(".exclude-types").val(e.get(e.DP.FILE_TYPE_EXCLUSIONS));var t=e.get(e.DP.FILE_SIZE_EXCLUSION);0!==t&&this.$(".exclude-size").val(t),this.$(".scan-timeout").val(e.get(e.DP.SCAN_TIMEOUT_INTERVAL_IN_SECS)),this.$(".blockaccess-checkbox").prop("checked",e.get(e.DP.BLOCK_ACCESS_FILE))},onToggleAdvancedOptions:function(e){$(e.target).is(":checked")?this.$(".section-content.advancedOptions").slideDown():this.$(".section-content.advancedOptions").slideUp()},canEnablePageLink:function(){return!1},onPageTransition:function(e){var t=this,n=this.getScanSettings(),s=new i;s.setuuid(this.model.actionTargetId),s.setEntityName(this.model.actionTargetName),this.new?(s.isNew(!0),s.actionMode=o.ACTION_CREATE):(s.isNew(!1),s.actionMode=o.ACTION_UPDATE,n.uuid=this.uuid);var r=this.validateInputs(n);r?t.showError(r):s.save(n,{success:function(t,i){e()},error:function(e,i){a.log("Error :"+a.processAjaxError(i.responseText));var n="";n=e.isNew()?t.i18n("creating"):t.i18n("updating"),t.showError(a.processAjaxError(i.responseText)+n)}})},getScanSettings:function(){var e={};e.scanOnRead=this.$(".read-checkbox").is(":checked"),e.scanOnWrite=this.$(".write-checkbox").is(":checked");var t=this.$(".exclude-types").val();return t&&(t=t.replace(/\s+/g,""),e.fileTypeExclusions=t.split(",")),e.fileSizeExclusion=this.$(".exclude-size").val(),e.scanTimeoutIntervalInSecs=this.$(".scan-timeout").val(),e.blockAccessFile=this.$(".blockaccess-checkbox").is(":checked"),e},validateInputs:function(e){var t=this.i18n("invalid_input_msg");this.$(".exclude-size, .scan-timeout, .exclude-types").removeClass("input_error"),!r.isNumber(e.fileSizeExclusion,"type=integer").valid||parseInt(e.fileSizeExclusion,10)<0?(t+=this.i18n("exclude_size"),this.$(".exclude-size").addClass("input_error")):parseInt(e.fileSizeExclusion,10)>1024?(t+=this.i18n("exclude_size_limit"),this.$(".exclude-size").addClass("input_error")):e.fileSizeExclusion=parseInt(e.fileSizeExclusion,10)*Math.pow(2,20),!r.isNumber(e.scanTimeoutIntervalInSecs,"type=integer").valid||parseInt(e.scanTimeoutIntervalInSecs,10)<1||parseInt(e.scanTimeoutIntervalInSecs,10)>240?(t+=this.i18n("scan_timeout"),this.$(".scan-timeout").addClass("input_error")):e.scanTimeoutIntervalInSecs=parseInt(e.scanTimeoutIntervalInSecs,10);var i=!1;return _.each(e.fileTypeExclusions,function(e){var t=e.slice(1);!e||"."===e[0]&&/^[a-zA-Z]+$/.test(t)||(i=!0)}),i&&(t+=this.i18n("exclude_file_types"),this.$(".exclude-types").addClass("input_error")),e.scanOnRead||e.scanOnWrite||(t+=this.i18n("scan_type_msg")),t!==this.i18n("invalid_input_msg")&&t},getButtonLabel:function(e){return e<0?this.i18n("back"):null},onPageCancel:function(){return!0}})}),define("views/popups/fileserver/FileServerLDAPTableInputView",["views/basecomponents/tableinput/TableInputView","utils/AppUtil","utils/ValidationUtil"],function(e,t,i){"use strict";var n=_.template('<section data-ntnx-section class="leaveLDAP_ONLY"><span class="table-title"><%= i18n("ldap_server") %></span><% if (isActionEnabled) { %><a class="link-table-input pull-right"><%= Components.icon("plus", "-small -inline") %> <%= i18n("new_ldap_server") %></a><% } else { %><a class="leaveDomain pull-right leaveDomainLDAP_ONLY"><%= i18n("unconfigure_ldap") %></a><% } %><table class="table table-data-items table-input<%= ebClass %>"><thead><tr><% _.each(columns, function(column) { %><th><%= column.columnName %></th><% }); %><% if (isActionEnabled) { %><th><%= i18n("actions") %></th><% } %></tr></thead><tbody></tbody></table></section>'),s=_.template('<tr data-id="<%= dataId %>" new="true"class="n-table-row ldap-table-row"><% _.each(columns, function(column) { %><td class="data-cell"><input type="text" class="input-data serverUrl server-url" readonly value="<%= column.renderer(data) %>" placeholder="<%= i18n("server_url_example") %>"></td><% }); %>'+e.EDIT_COLUMN_TEMPLATE+"</tr>");return e.extend({name:"FileServerLDAPTableInputView",className:"component-table-input",idAttribute:"uuid",fileServerUuid:null,tmplTable:null,initialize:function(t){t.columns=this.getResourceTableColumns(),t.tmplDataRow=s,e.prototype.initialize.call(this,t),this.dataItems=t.dataItems||[],this.tmplTable=n,this.parent=t.parent,this.fileServerUuid=t.fileServerUuid,this.isActionEnabled=!this.dataItems.length},getResourceTableColumns:function(){return[{columnName:this.i18n("server_uri"),className:"serverIp",renderer:function(e){return e||""}}]},deleteRow:function(t){e.prototype.deleteRow.apply(this,arguments),this.$(".link-table-input").removeClass("disabled")},addRow:function(){e.prototype.addRow.apply(this,arguments);var t=this.getRowToBeAddedElement();1===t.closest("tbody").find("tr").length&&t.find("input").first().prop("checked",!0)},saveRow:function(e){var t=$(e.currentTarget),i=t.closest("tr"),n=i.find("input").last().val().trim();this.clearHeader(),this.checkTableError(i,n)&&n||(n?(i.attr("data-id",n),i.removeAttr("new")):i.remove(),this.resetTable(),this.trigger(this.ACTION_EVENTS.SAVE,i),0!==n.indexOf("ldaps://")||this.parent.$("#ldapfileInput").is(":checked")||this.parent.$("#ldapfileInput").click())},checkTableError:function(e,n){var s=_.map(this.$(".ldap-table-row"),function(e){return $(e).attr("data-id")}),a=e.attr("data-id"),r=!1,o=_.filter(s,function(e){return e===n});("ID_TO_BE_ADDED"===a||n!==a)&&o.length>0&&(r=!0);var l=s[0].slice(0,5),c=l!==n.slice(0,5),u=n.split("//")[1]&&n.split("//")[1].split(":"),d="";return 0!==n.indexOf("ldaps://")&&0!==n.indexOf("ldap://")?d=this.i18ns("invalid_ldap_server_ip"):!t.isValidHostname(u[0])||u[1]&&!i.isNumber(u[1],"type=integer").valid?d=this.i18ns("invalid_ldap_server_ip"):this.$(".ldap-table-row").length>1&&c?d=this.i18ns("diff_type_error"):r&&(d=this.i18ns("duplicate_ldap_server_ip")),d&&this.showTableError(d),d},onClickCancelLink:function(t){this.clearHeader(),e.prototype.onClickCancelLink.call(this,arguments);var i=$(t.currentTarget).closest("tr");i.find("input").val(i.attr("data-id"))},clearHeader:function(){this.parent.updateDomain?this.parent.clearBaseHeader():this.parent.parentView.clearHeader()},showTableError:function(e){this.parent.updateDomain?this.parent.showHeaderError(e):this.parent.parentView.showError(e)}})}),define("text!templates/wizards/fileserver/FileServerActiveDirectory.html",[],function(){return'<section data-ntnx-section\n  class="leave<%= protocol %>Container leave-<%= protocol %>-container\n    leaveBothContainer">\n  \x3c!-- Name of realm --\x3e\n  <div class="realm-container">\n    <label data-ntnx-label for="leave<%= protocol %>RealmName">\n      <%= i18n(\'realm_name\') %>\n    </label>\n    <a data-ntnx-label-flag\n      class="leave-domain leaveDomain leaveDomain<%= protocol %>">\n      <%= i18n(\'leave_domain\') %>\n    </a>\n  </div>\n  <div class="adRealNameTooltip">\n    <input type="text" class="leave<%= protocol %>RealmName realmNameInput"\n      id="leave<%= protocol %>RealmName" disabled>\n  </div>\n</section>\n\n<div class="join<%= protocol %>Container">\n  <section data-ntnx-section class="<%= protocol %>Container\n    <%= protocol %>-container">\n    \x3c!-- Name of realm --\x3e\n    <label data-ntnx-label for="<%= protocol %>RealmName">\n      <%= i18n(\'realm_name\') %>\n      <span data-ntnx-label-flag class="<%= protocol %>UserAccount user-account">\n        <%= i18n(\'user_account\') %>\n      </span>\n      <span data-ntnx-label-flag class="<%= protocol %>UserAccountLeave user-account-leave">\n        <%= i18n(\'user_account_leave\') %>\n      </span>\n    </label>\n    <div class="adRealNameTooltip">\n      <input type="text" class="<%= protocol %>RealmName"\n        id="<%= protocol %>RealmName" disabled\n        placeholder="like: dom.companyname.com">\n    </div>\n  </section>\n\n  <div class="ad-credentials <%= protocol %>AdCredentials">\n    \x3c!-- Windows AD username --\x3e\n    <section data-ntnx-section="type-half">\n      <label data-ntnx-label for="<%= protocol %>Username">\n        <%= i18n(\'username\') %>\n      </label>\n      <input type="text" id="<%= protocol %>Username"\n        class="<%= protocol %>Username">\n    </section>\n\n    \x3c!-- Windows AD password --\x3e\n    <section data-ntnx-section="type-half">\n      <label data-ntnx-label for="<%= protocol %>Password">\n        <%= i18n(\'password\') %>\n      </label>\n      <input type="password" id="<%= protocol %>Password"\n        class="<%= protocol %>Password">\n    </section>\n  </div>\n\n  <div class="unjoin<%= protocol %>Container unjoinBothContainer">\n    <% if (protocol === "SMB") { %>\n      <section data-ntnx-section\n        class="addAdminOptionsContainer addAdminOptions<%= protocol %>Container">\n        <%= Components.checkbox({\n          jsClasses: protocol + \'AddAdminCheckbox\',\n          labelText: i18n(\'make_file_server_admin\')\n        }) %>\n        <span class="nutanixMoreInfo"\n          data-tooltip-classes="-nudge-up"\n          data-tooltip-container="body"\n          data-tooltip-title="<%= i18n(\'file_server_admin_tooltip\') %>"></span>\n      </section>\n    <% } %>\n  </div>\n  <section data-ntnx-section class="unjoinBoth<%= protocol %>Container">\n    <% if (protocol === "SMB") { %>\n      <%= Components.checkbox({\n        id: protocol +\'advancedOptions\',\n        jsClasses: \'toggleOptions advancedOptions\',\n        labelText: i18n(\'show_advanced_options\')\n      }) %>\n    <% } else { %>\n      <%= Components.checkbox({\n        id: protocol +\'advancedOptions\',\n        jsClasses: \'toggleOptions advancedOptions\',\n        labelText: i18n(\'show_ad_advanced_options\')\n      }) %>\n    <% } %>\n    <div class="<%= protocol %>advancedOptionsToggle" style="display: none;">\n      \x3c!-- Preferred Domain Controller --\x3e\n      <section data-ntnx-section>\n        <label data-ntnx-label for="<%= protocol %>PreferredDomainController">\n          <%= i18n(\'preferred_domain_controller\') %>\n          <span class="nutanixMoreInfo"\n            data-tooltip-classes="-nudge-up"\n            data-tooltip-container="body"\n            data-tooltip-title="\n              <%= i18n(\'preferred_domain_controller_info\') %>">\n          </span>\n        </label>\n        <input type="text" id="<%= protocol %>PreferredDomainController"\n          class="<%= protocol %>PreferredDomainController"\n          placeholder="<%= i18n(\'placeholder_domain_ctrl\') %>">\n      </section>\n\n      <div class="unjoin<%= protocol %>Container unjoinBothContainer">\n        \x3c!-- Organizational Unit --\x3e\n        <section data-ntnx-section>\n          <label data-ntnx-label for="<%= protocol %>OrganizationalUnit">\n            <%= i18n(\'organizational_unit\') %>\n            <span class="nutanixMoreInfo"\n              data-tooltip-classes="-nudge-up"\n              data-tooltip-container="body"\n              data-tooltip-title="<%= i18n(\'organizational_unit_info\') %>">\n            </span>\n          </label>\n          <input type="text" id="<%= protocol %>OrganizationalUnit"\n            class="<%= protocol %>OrganizationalUnit"\n            placeholder="<%= i18n(\'placeholder_org_unit\') %>">\n        </section>\n\n        \x3c!-- Enable overwrite flag --\x3e\n        <section data-ntnx-section>\n          <label data-ntnx-label for="<%= protocol %>checkboxOverwriteAd">\n            <%= Components.checkbox({\n              id: protocol + \'checkboxOverwriteAd\',\n              jsClasses: \'checkboxOverwriteAd\'\n            }) %>\n            <%= i18n(\'overwrite_existing_afs\') %>\n            <span class="nutanixMoreInfo"\n              data-tooltip-classes="-nudge-up"\n              data-tooltip-container="body"\n              data-tooltip-title="<%= i18n(\'file_server_overwrite_info\') %>">\n            </span>\n          </label>\n        </section>\n        <% if (isPostThreeDotOne) { %>\n          \x3c!-- Add DNS Entries flag --\x3e\n          <section data-ntnx-section>\n            <label data-ntnx-label for="<%= protocol %>checkboxDnsEntries">\n              <%= Components.checkbox({\n                id: protocol + \'checkboxDnsEntries\',\n                jsClasses: \'checkboxDnsEntries\'\n              }) %>\n              <%= i18n(\'add_dns_entries\') %>\n              <span class="nutanixMoreInfo"\n                data-tooltip-classes="-nudge-up"\n                data-tooltip-container="body"\n                data-tooltip-title="<%= i18n(\'add_dns_entries_info\') %>">\n              </span>\n            </label>\n          </section>\n        <% } %>\n      </div>\n    </div>\n  </section>\n</div>'}),define("text!templates/wizards/fileserver/FileServerUserManagementView.html",[],function(){return'<form class="fs-userMangementPage">\n    <% if (postSpectre) { %>\n      <% if (updateDomain) { %>\n        <section data-ntnx-section class="protocol-text">\n      <% } else { %>\n        <section data-ntnx-section="type-text">\n      <% } %>\n        <%= i18n(\'select_protocols_1\') %>\n        <% if (!updateDomain) { %>\n          <span>\n            <%= i18n(\'select_protocols_2\') %>\n          </span>\n        <% } %>\n        </section>\n    <% } %>\n  <section data-ntnx-section>\n    <div data-ntnx-form-inline>\n      <%= Components.checkbox(\n        {\n          jsClasses : \'toggleOptions\',\n          id: \'smbProtocol\',\n          labelText: i18n(\'use_smb_protocol\')\n        })\n      %>\n    </div>\n  </section>\n  <section data-ntnx-section="type-text">\n    <%= i18n(\'ad_requrired\') %>\n  </section>\n\n  <div class="smbProtocolToggle" style="display: none;">\n    \x3c!-- AD credential form goes here --\x3e\n  </div>\n\n  <div class="nfsProtocolContainer">\n    <section data-ntnx-section="type-separator">\n      <div data-ntnx-form-inline>\n        <%= Components.checkbox(\n          {\n            jsClasses : \'toggleOptions\',\n            id: \'nfsProtocol\',\n            labelText: i18n(\'use_nfs_protocol\')\n          })\n        %>\n      </div>\n    </section>\n    <section data-ntnx-section="type-text" class="ad-ldap">\n      <%= i18n(\'ad_or_ldap\') %>\n    </section>\n    <div class="nfsProtocolToggle nfs-protocol-toggle" style="display: none;">\n      <section data-ntnx-section>\n        <label data-ntnx-label for="comboUserManagement">\n          <%= i18n(\'user_management\') %>\n          <span class="nutanixMoreInfo"\n            data-tooltip-classes="-nudge-up"\n            data-tooltip-container="body"\n            data-tooltip-title="<%= i18n(\'user_management_info\') %>">\n          </span>\n        </label>\n        <%= Components.select({\n          jsClasses: \'comboUserManagement\',\n          id: \'comboUserManagement\',\n          variants: \'bottom-anchor\',\n          options: userManagementOptions\n        }) %>\n      </section>\n      <section data-ntnx-section class="nfsProtocolWarningContainer hidden">\n        <div class="nfsWarning"></div>\n      </section>\n      <div class="ldapToggle" style="display: none;">\n        <section data-ntnx-section>\n          <h5 data-ntnx-title><%= i18n(\'ldap_details\') %></h5>\n          <section data-ntnx-section="type-text">\n            <%= i18n(\'config_ldap\') %>\n          </section>\n          <div class="ldapTableContainer">\n            <div class="ldapTable">\n              \x3c!-- LDAP input table goes here --\x3e\n            </div>\n            <div class="ldapInputsContainer">\n              <section data-ntnx-section class=\n            "hide">\n                <%= Components.checkbox(\n                  {\n                    jsClasses : \'toggleOptions\',\n                    id: \'ldapfileInput\',\n                    labelText: i18n(\'use_tls\')\n                  })\n                %>\n              </section>\n              <div class="ldapfileInputToggle hide">\n                <section data-ntnx-section>\n                  <label data-ntnx-label for="uploadChainCertificate">\n                    <%= i18n(\'ssl_certificate\') %>\n                  </label>\n                  <%= Components.fileInput({\n                    id: "uploadChainCertificate",\n                    classes: \'upload-field inputChain\',\n                    name: "chain",\n                    defaultFilenameText: i18n(\'no_file_chosen\')\n                  }) %>\n                  <input type="hidden" class="txtInfo"\n                  name="filename">\n                </section>\n              </div>\n            </div>\n          </div>\n          <div class="noLdapServer no-table-wrapper"><%= i18n(\'no_ldap_server\') %>\n            <div class="n-clearfix">\n              <button type="button" class="btn btnLdapAdd btn-primary"><%= i18n(\'new_ldap_server\') %></button>\n            </div>\n          </div>\n          \x3c!-- Base DN --\x3e\n          <section data-ntnx-section>\n            <label data-ntnx-label for="baseDN">\n              <%= i18n(\'base_dn\') %>\n              <span class="nutanixMoreInfo"\n                data-tooltip-container="body"\n                data-tooltip-title="<%= i18n(\'base_dn_info\') %>">\n              </span>\n            </label>\n            <input type="text" id="baseDN" class="baseDN"\n              placeholder="eg. dc=nut,dc=com">\n          </section>\n          <div class="ldapInputsContainer">\n            <div class="ldap-credentials">\n              \x3c!-- Bind DN --\x3e\n              <section data-ntnx-section="type-half">\n                <label data-ntnx-label for="bindDN">\n                  <%= i18n(\'bind_dn\') %>\n                  <span class="nutanixMoreInfo"\n                    data-tooltip-classes="-nudge-up"\n                    data-tooltip-container="body"\n                    data-tooltip-title="<%= i18n(\'bind_dn_info\') %>">\n                  </span>\n                </label>\n                <input type="text" id="bindDN" class="bindDN"\n                  placeholder="eg. cn=Admin,dc=dev,dc=eng,dc=nut,dc=com">\n              </section>\n              \x3c!-- Bind password --\x3e\n              <section data-ntnx-section="type-half">\n                <label data-ntnx-label for="bindPassword">\n                  <%= i18n(\'bind_password\') %>\n                </label>\n                <input type="password" id="bindPassword" class="bindPassword" disabled>\n              </section>\n            </div>\n          </div>\n        </section>\n      </div>\n\n      <div class="adToggle" style="display: none;">\n        <section data-ntnx-section class="rfc-check-container hide">\n          <%=Components.checkbox({\n            id:\'rfc2307Enabled\',\n            labelText: i18n(\'enable_rfc_2307\')\n          })%>\n          <span class="nutanixMoreInfo"\n            data-tooltip-classes="-nudge-up"\n            data-tooltip-container="body"\n            data-tooltip-title="<%= i18n(\'rfc_2307_tooltip\') %>">\n          </span>\n        </section>\n        <div class="nfsAdContainer">\n          \x3c!-- AD credential form goes here --\x3e\n        </div>\n        <section data-ntnx-section class="adRealNameContainer ad-realName-container">\n          \x3c!-- Name of realm --\x3e\n          <label data-ntnx-label for="disabledNFSRealmName">\n            <%= i18n(\'realm_name\') %>\n            <span data-ntnx-label-flag><%= i18n(\'same_as_smb\') %></span>\n          </label>\n          <div class="adRealNameTooltip">\n            <input type="text" class="disabledNFSRealmName"\n              id="disabledNFSRealmName" disabled>\n          </div>\n        </section>\n      </div>\n\n      <div class="kerberosToggle" style="display: none;">\n        <section data-ntnx-section>\n          <h5 data-ntnx-title><%= i18n(\'kerberos_details\') %></h5>\n        </section>\n        <section data-ntnx-section>\n          <label data-ntnx-label><%= i18n(\'real_name\') %></label>\n          <input type="text" class="realmName">\n        </section>\n        <div class="kerberosTable">\n            \x3c!-- kerberos input table goes here --\x3e\n        </div>\n        <section data-ntnx-section>\n          <label data-ntnx-label><%= i18n(\'host_name\') %></label>\n          <input type="text" class="hostName">\n        </section>\n        \x3c!-- kerberos username --\x3e\n        <section data-ntnx-section="type-half">\n          <label data-ntnx-label><%= i18n(\'username\') %></label>\n          <input type="text" class="kerberosUsername">\n        </section>\n\n        \x3c!-- kerberos password --\x3e\n        <section data-ntnx-section="type-half">\n          <label data-ntnx-label><%= i18n(\'password\') %></label>\n          <input type="password" class="kerberosPassword">\n        </section>\n      </div>\n      \x3c!-- Advanced options--\x3e\n      <section data-ntnx-section>\n        <%= Components.checkbox({\n          id: \'advancedOptions\',\n          jsClasses: \'toggleOptions\',\n         labelText: i18n(\'show_nfs_advanced_options\')\n        }) %>\n        <span class="nutanixMoreInfo nfsToolTip hidden"\n          data-tooltip-classes="-nudge-up"\n          data-tooltip-container="body"\n          data-tooltip-title="<%= i18n(\'nfs_advanced_tooltip\') %>">\n        </span>\n        <div class="advancedOptionsToggle" style="display: none;">\n          \x3c!-- Preferred Domain Controller --\x3e\n          <% if (isPostThreeDotFive) { %>\n            <section data-ntnx-section="type-text">\n              <%= i18n(\'nfs_version_text\') %>\n            </section>\n            <section data-ntnx-section>\n              <%= Components.checkbox({\n                jsClasses: \'enableNfsv3\',\n                checked :  enableNfsv3v4,\n                labelText: i18n(\'enable_nfsv3\')\n              }) %>\n            </section>\n            <section data-ntnx-section>\n              <%= Components.checkbox({\n                jsClasses: \'enableNfsv4\',\n                checked : enableNfsv3v4,\n                labelText: i18n(\'enable_nfsv4\')\n              }) %>\n            </section>\n          <% } %>\n          <section data-ntnx-section>\n            <label data-ntnx-label for="nfsDomain"><%= i18n(\'nfsv4_domain\') %>\n              <span class="nutanixMoreInfo"\n              data-tooltip-classes="-nudge-up"\n              data-tooltip-container="body"\n              data-tooltip-title="<%= i18n(\'nfs_domain_info\') %>"></span>\n            </label>\n            <input type="text" id="nfsDomain" class="nfsDomain">\n          </section>\n        </div>\n      </section>\n    </div>\n  </div>\n</form>'}),define("views/popups/fileserver/FileServerUserManagementView",["views/basecomponents/BaseSubView","views/popups/fileserver/FileServerLDAPTableInputView","managers/NotificationManager","utils/FileServerUtil","utils/AppUtil","utils/AppConstants","utils/I18nMixin","utils/CommonTemplates","data/DataProperties","text!templates/wizards/fileserver/FileServerActiveDirectory.html","text!templates/wizards/fileserver/FileServerUserManagementView.html"],function(e,t,i,n,s,a,r,o,l,c,u){"use strict";var d=_.template('<p data-ntnx-section="type-text">\n      <%= domain %></p><p data-ntnx-section="type-text"><%= protocol %></p>'),h=_.template('<p data-ntnx-section="type-text">\n      <%= domain %></p><p data-ntnx-section="type-text"><%= protocol %></p>\n      <section data-ntnx-section>\n        <%= Components.checkbox({\n          id: "deleteUserMapping",\n          jsClasses: "deleteUserMapping",\n          labelText: text\n        }) %>\n      </section>');u=_.template(u),c=_.template(c);var p=[{value:a.FS_USER_MANAGEMENT_TYPES.UNMANAGED,name:r.i18nStatic("FileServerUserManagementView","none")},{value:a.FS_USER_MANAGEMENT_TYPES.LDAP_ONLY,name:r.i18nStatic("FileServerUserManagementView","ldap_only")},{value:a.FS_USER_MANAGEMENT_TYPES.ACTIVE_DIRECTORY,name:r.i18nStatic("FileServerUserManagementView","active_directory")}],T={NFS:"2",DISABLE:"0"};return e.extend({name:"FileServerUserManagementView",localDetails:null,events:{"change .comboUserManagement":"onChangeUserManagement","change .toggleOptions":"onToggleOptions","click .leaveDomain":"onLeaveDomain","click .btnLdapAdd":"handleAddLDAPServerClick","focus .bindDN":"onFocusBindDN","blur  .bindDN":"onBlurBindDN","click .enableNfsv3, .enableNfsv4":"onClickenableNfs"},initialize:function(t){e.prototype.initialize.apply(this,arguments),this.model=t.model,this.isUserMappingConfigured=t.isUserMappingConfigured,this.unjoinActions=[],this.updateDomain=t.updateDomain,this.fsSupportNFS=n.compareAFSversion(this.model,a.FILE_SERVER_VERSIONS.SPECTRE)>=0,this.isPostThreeDotOne=n.compareAFSversion(this.model,a.FILE_SERVER_VERSIONS.THREE_DOT_ONE)>=0,this.isPostThreeDotFive=n.compareAFSversion(this.model,a.FILE_SERVER_VERSIONS.THREE_DOT_FIVE)>=0},render:function(){if(!this.isViewRendered){if(this.$el.html(u(this.vtOptions({userManagementOptions:p,
updateDomain:this.updateDomain,postSpectre:this.fsSupportNFS,enableNfsv3v4:this.model.isNew(),isPostThreeDotFive:this.isPostThreeDotFive}))),this.applyNutanixInput({types:["select"]}),this.$(".smbProtocolToggle").html(c(this.vtOptions({protocol:a.FS_PROTOCOLS.SMB,isPostThreeDotOne:this.isPostThreeDotOne}))),this.$(".nfsAdContainer").html(c(this.vtOptions({protocol:a.FS_PROTOCOLS.NFS,isPostThreeDotOne:this.isPostThreeDotOne}))),this.model.isNew())this.$(".noLdapServer").show(),this.$(".ldapTableContainer").hide();else{var e=this.model.getLdapDetails();e?(this.addTable(e),this.$(".noLdapServer").hide()):(this.$(".noLdapServer").show(),this.$(".ldapTableContainer").hide())}this.setInputs(),this.isViewRendered=!0}if(this.$(".NFSUserAccountLeave, .SMBUserAccountLeave").hide(),this.$(".NFSUserAccount, .SMBUserAccount").show(),!this.updateDomain){var t=this.model.get(this.model.DP.DNS_DOMAIN_NAME);this.$(".SMBRealmName, .NFSRealmName, .disabledNFSRealmName").val(t)}this.$(".nutanixMoreInfo").nutanixMoreInfo({parseDataAttrs:!0})},setInputs:function(){var e=void 0,t=void 0;this.compareToSpectre=0;var i=0;if(t=this.model.get(a.FILE_SERVER_VERSION),t&&(this.compareToSpectre=s.compareVersions(t,a.FILE_SERVER_VERSIONS.SPECTRE),i=s.compareVersions(t,a.FILE_SERVER_VERSIONS.ASTERIX_DOT_TWO)),this.compareToSpectre<0)return this.$(".nfsProtocolContainer").hide(),this.updateDomain&&(e=this.model.getRealmName()),e?(this.actionMode=a.ACTION_UNJOIN_DOMAIN,this.$(".leaveSMBRealmName, .SMBRealmName").val(e),this.$(".SMBUsername").val(this.model.getUserName()),this.$(".joinSMBContainer").hide(),this.$(".leaveSMBContainer").show()):(this.actionMode=a.ACTION_JOIN_DOMAIN,this.$(".leaveSMBContainer").hide(),this.$(".joinSMBContainer").show(),this.$(".SMBRealmName").prop("disabled",!1)),this.$("#smbProtocol").click(),void this.$("#smbProtocol").prop("disabled",!0);var n=this.model.getAdDetails();if(e=this.model.getAdRealmName()||this.model.get(this.model.DP.DNS_DOMAIN_NAME),this.$(".leaveSMBRealmName, .SMBRealmName, .leaveNFSRealmName,.NFSRealmName, .disabledNFSRealmName").val(e),this.model.isNew())i<0&&this.$(".addAdminOptionsContainer").hide(),this.$(".leaveSMBContainer, .leaveNFSContainer").hide();else{var r=this.model.getProtocolType();this.renderAd(n,r,e);var o=this.model.getLdapDetails(),l=this.model.getServerIP();this.renderLDAP(n,r,o,l),this.renderLocalDetails(r,l)}if(this.updateDomain){var c;_.each(this.$(".adRealNameTooltip"),function(e){c=$(e).parent().hasClass("leaveBothContainer"),$(e).tooltip({title:c?this.i18n("change_domain_msg"):this.i18n("change_domain_msg_failed"),placement:"top"})},this)}},renderAd:function(e,t,i){var n=e&&e[this.model.DP.adDetails.USERNAME];t===a.FS_PROTOCOLS.SMB?(this.$(".SMBUsername").val(n),this.$(".joinSMBContainer").hide(),this.$("#smbProtocol").click(),this.$("#smbProtocol").prop("disabled",!0).off("click"),this.$(".unjoin"+a.FS_PROTOCOLS.NFS+"Container").hide()):t===a.FS_PROTOCOLS.NFS?(this.$(".NFSUsername").val(n),this.$(".joinNFSContainer, .leaveSMBContainer").hide(),this.$(".unjoin"+a.FS_PROTOCOLS.SMB+"Container").hide(),e[this.model.DP.adDetails.RFC_2307_ENABLED]&&this.$("#rfc2307Enabled").prop("checked",!0),this.$("#rfc2307Enabled").prop("disabled",!0)):t===a.FS_PROTOCOLS.NFS_SMB?(this.$(".leaveSMBRealmName, .SMBRealmName").val(i),this.$(".leaveNFSRealmName, .NFSRealmName").val(i),this.$(".SMBUsername, .NFSUsername").val(n),this.$(".joinSMBContainer, .joinNFSContainer").hide(),e[this.model.DP.adDetails.RFC_2307_ENABLED]&&this.$("#rfc2307Enabled").prop("checked",!0),this.$("#rfc2307Enabled").prop("disabled",!0),this.$("#smbProtocol").click(),this.$("#smbProtocol").prop("disabled",!0).off("click")):this.$(".leaveSMBContainer, .leaveNFSContainer").hide()},renderLDAP:function(e,t,i,n){n||t===a.FS_PROTOCOLS.NFS||t===a.FS_PROTOCOLS.NFS_SMB?(this.$(".nfsDomain").val(this.model.getValue(this.model.DP.NAME_SERVICE_CONFIG+"."+this.model.DP.NFS_V4_DOMAIN)),this.$(".nfsDomain").prop("disabled",!0),this.$("#nfsProtocol").click(),this.$("#nfsProtocol").prop("disabled",!0).off("click"),t===a.FS_PROTOCOLS.NFS||t===a.FS_PROTOCOLS.NFS_SMB?(this.$(".comboUserManagement").val(a.FS_USER_MANAGEMENT_TYPES.ACTIVE_DIRECTORY),this.$(".comboUserManagement").change()):n&&(this.$(".comboUserManagement").val(a.FS_USER_MANAGEMENT_TYPES.LDAP_ONLY),this.$(".comboUserManagement").change(),this.$(".ldapInputsContainer").hide(),this.$(".baseDN").val(i&&i[this.model.DP.BASE_DN]),this.$(".baseDN").prop("disabled",!0)),this.$(".comboUserManagement").trigger("disable")):this.$(".leaveNFSContainer").hide(),this.checkNfsVersionCheckbox()},checkNfsVersionCheckbox:function(){switch(this.model.getValue(this.model.DP.NAME_SERVICE_CONFIG+"."+this.model.DP.NFS_VERSION)){case a.NFS_VERSION.NFSV3:this.$(".enableNfsv4").prop("checked",!1),this.$(".enableNfsv3").prop("checked",!0);break;case a.NFS_VERSION.NFSV4:this.$(".enableNfsv4").prop("checked",!0),this.$(".enableNfsv3").prop("checked",!1);break;default:this.$(".enableNfsv4").prop("checked",!0),this.$(".enableNfsv3").prop("checked",!0)}var e=this.$(".comboUserManagement").val();this.setAdNfsVersion(e)},onClickenableNfs:_.debounce(function(e){$(e.currentTarget).is(":checked")||($(e.currentTarget).hasClass("enableNfsv3")?this.$(".enableNfsv4").prop("checked",!0):this.$(".enableNfsv3").prop("checked",!0)),this.getParentView().$(".n-save").removeClass("disabled")},100),renderLocalDetails:function(e,t){this.model.getLocalDetailsProtocolType()!==a.FS_PROTOCOLS.NFS||e===a.FS_PROTOCOLS.NFS||e===a.FS_PROTOCOLS.NFS_SMB||t||(this.localDetails=a.FS_PROTOCOLS.NFS,this.$("#nfsProtocol").click(),this.$(".comboUserManagement").val(a.FS_USER_MANAGEMENT_TYPES.UNMANAGED),this.$(".comboUserManagement").change())},onToggleOptions:function(e){var t=this,i=$(e.currentTarget).is(":checked"),n=$(e.currentTarget).attr("id"),s=this.$("."+n+"Toggle"),r=this.$(".comboUserManagement").val(),o=r===a.FS_USER_MANAGEMENT_TYPES.ACTIVE_DIRECTORY,l=this.model.getProtocolType();if(i){this.updateDomain||s.slideDown(),"smbProtocol"===n&&this.$("#nfsProtocol").is(":checked")&&o?(this.$(".SMBRealmName").val(this.$(".NFSRealmName").val()),this.$(".disabledNFSRealmName").val(this.$(".NFSRealmName").val()),this.$(".SMBUsername").val(this.$(".NFSUsername").val()),this.$(".SMBPassword").val(this.$(".NFSPassword").val()),this.$(".joinNFSContainer").is(":visible")&&(this.$(".nfsAdContainer").hide(),this.$(".adRealNameContainer").show())):"nfsProtocol"===n&&this.$("#smbProtocol").is(":checked")&&!this.$("#smbProtocol").prop("disabled")&&o?(this.$(".nfsAdContainer").hide(),this.$(".adRealNameContainer").show()):("smbProtocol"===n&&this.$("#nfsProtocol").is(":checked")||"nfsProtocol"===n&&this.$("#smbProtocol").is(":checked"))&&!o&&!this.isUserMappingConfigured&&this.isPostThreeDotFive&&this.showUserMappingWarning(),this.updateDomain&&"smbProtocol"===n&&!this.model.isNew()&&(l!==a.FS_PROTOCOLS.SMB&&l!==a.FS_PROTOCOLS.NFS_SMB&&this.getParentView().$(".n-save").removeClass("disabled"),l===a.FS_PROTOCOLS.NFS&&this.$(".SMBRealmName").prop("disabled",!0));var c=void 0;this.updateDomain&&(c=this.model.getServerIP()),"nfsProtocol"!==n||c||l===a.FS_PROTOCOLS.NFS||l===a.FS_PROTOCOLS.NFS_SMB||this.localDetails||this.getParentView().$(".n-save").removeClass("disabled")}else this.updateDomain||s.slideUp(),"smbProtocol"===n&&this.$("#nfsProtocol").is(":checked")&&o&&(this.$(".nfsAdContainer").show(),this.$(".adRealNameContainer").hide()),!this.updateDomain||this.model.isNew()||$(e.currentTarget).hasClass("advancedOptions")||this.$("#smbProtocol").is(":checked")||this.$("#nfsProtocol").is(":checked")||this.getParentView().$(".n-save").hasClass("disabled")||this.getParentView().$(".n-save").addClass("disabled"),this.updateDomain&&!this.$("#nfsProtocol").is(":checked")&&this.localDetails&&this.getParentView().$(".n-save").removeClass("disabled"),this.$(".nfsProtocolWarningContainer").hasClass("hidden")||this.$(".nfsProtocolWarningContainer").addClass("hidden");this.updateDomain&&s.slideToggle("fast",function(){t.getParentView().triggerAction(a.MODAL.ACT.AS_REBUILD),s.is(":visible")&&t.scrollToElement(s,".antiscroll-inner")})},showUserMappingWarning:function(){this.$(".nfsProtocolWarningContainer").removeClass("hidden");var e=o.INFO({msg:this.i18n("user_mapping_warning")});this.$(".nfsWarning").html(e),this.$(".learnWhy").addClass("addTooltip").attr("title",this.i18n("learn_why_msg")).tooltip({placement:"bottom"})},onChangeUserManagement:_.debounce(function(e){var t=this.$(".comboUserManagement").val();if(t===a.FS_USER_MANAGEMENT_TYPES.LDAP_ONLY?(this.$(".adToggle, .nfsToolTip").hide(),this.$(".ldapToggle").show()):t===a.FS_USER_MANAGEMENT_TYPES.UNMANAGED?this.$(".adToggle, .ldapToggle, .nfsToolTip").hide():t===a.FS_USER_MANAGEMENT_TYPES.ACTIVE_DIRECTORY&&(this.$(".adToggle").show(),this.$(".rfc-check-container").show(),this.model.isNew()?this.$("#smbProtocol").is(":checked")?(this.$(".nfsAdContainer").hide(),this.$(".adRealNameContainer").show(),this.$(".disabledNFSRealmName").val(this.$(".SMBRealmName").val())):(this.$(".nfsAdContainer").show(),this.$(".adRealNameContainer").hide(),this.getParentView().$(".n-save").removeClass("disabled")):(this.$("#smbProtocol").is(":checked")&&!this.$("#smbProtocol").prop("disabled")||this.unjoinActions.indexOf(a.FS_PROTOCOLS.SMB)>=0?(this.$(".NFSRealmName").val(this.$(".SMBRealmName").val()),this.$(".adRealNameContainer").show(),this.$(".nfsAdContainer").hide()):(this.$(".adRealNameContainer").hide(),this.$(".nfsAdContainer").show()),this.$(".NFSRealmName").prop("disabled",!0)),this.$(".ldapToggle").hide(),this.$("#nfsProtocol").is(":checked")&&this.$(".nfsToolTip").removeClass("hidden").show()),this.$("#smbProtocol").is(":checked")&&t!==a.FS_USER_MANAGEMENT_TYPES.ACTIVE_DIRECTORY&&!this.isUserMappingConfigured&&this.isPostThreeDotFive?this.showUserMappingWarning():this.$("#smbProtocol").is(":checked")&&this.$(".nfsProtocolWarningContainer").is(":visible")&&this.$(".nfsProtocolWarningContainer").addClass("hidden"),this.updateDomain&&(this.localDetails&&t!==a.FS_USER_MANAGEMENT_TYPES.UNMANAGED&&this.getParentView().$(".n-save").removeClass("disabled"),this.getParentView().triggerAction(a.MODAL.ACT.AS_REBUILD)),!this.$("#nfsProtocol").prop("disabled")){this.model.getLocalDetailsProtocolType()||(this.$(".enableNfsv3").prop("checked",!0),this.$(".enableNfsv4").prop("checked",!0)),this.setAdNfsVersion(t)}},0),setAdNfsVersion:function(e){e===a.FS_USER_MANAGEMENT_TYPES.ACTIVE_DIRECTORY?(this.$(".enableNfsv4").attr("disabled",!0),this.$(".enableNfsv4").prop("checked",!0)):this.$(".enableNfsv4").attr("disabled",!1)},onFocusBindDN:function(){this.$(".bindPassword").removeAttr("disabled")},onBlurBindDN:function(e){$.trim($(e.currentTarget).val()).length||(this.$(".bindPassword").val(""),this.$(".bindPassword").attr("disabled",!0))},onLeaveDomain:function(e){var t=this,i=$(e.currentTarget),n=i.closest("section"),s=n.attr("class"),r="",o="",l="";s.indexOf(a.FS_PROTOCOLS.NFS)>=0?(r=a.FS_PROTOCOLS.NFS,this.$(".NFSUserAccount").hide(),this.$(".NFSUserAccountLeave").show()):s.indexOf(a.FS_PROTOCOLS.SMB)>=0?(r=a.FS_PROTOCOLS.SMB,this.$(".SMBUserAccount").hide(),this.$(".SMBUserAccountLeave").show(),this.$(".SMBPassword").val(this.$(".NFSPassword").val())):(r=a.FS_PROTOCOLS.NFS,o=a.FS_USER_MANAGEMENT_TYPES.LDAP_ONLY),l=n.find(".realmNameInput").val();var c=this.i18n("leave_ad_domain");s.indexOf(a.FS_USER_MANAGEMENT_TYPES.LDAP_ONLY)>=0&&(c=this.i18n("leave_ldap_domain"));var u=this.i18n("leave_domain"),d="";s.indexOf(a.FS_USER_MANAGEMENT_TYPES.LDAP_ONLY)>=0?(d=this.composeMessage(this.i18n("unconfigure_ldap_text1"),this.i18ns("leave_ad_domain_text_nfs",r,r)),u=this.i18n("unconfigure")):d=r===a.FS_PROTOCOLS.NFS?this.composeMessage(this.i18ns("leave_ad_domain_text1",l),this.i18ns("leave_ad_domain_text_nfs",r,r)):this.composeMessage(this.i18ns("leave_ad_domain_text1",l),this.i18ns("leave_ad_domain_text2",r,r)),$.nutanixConfirm({title:c,msg:d,class:"confirmLeaveDomain -compact -red-confirm",yesText:u,yes:function(){t.confirmedleaveDomain(r,l,o)},context:this})},composeMessage:function(e,t){return this.isUserMappingConfigured&&!this.deleteUserMapping?h(this.vtOptions({domain:e,protocol:t,text:this.i18n("delete_user_mapping")})):d({domain:e,protocol:t})},confirmedleaveDomain:function(e,t,i){this.deleteUserMapping=$(".confirmLeaveDomain .deleteUserMapping").is(":checked");var n=!1;this.getParentView().$(".n-save").removeClass("disabled"),this.unjoin=!0,i?this.$(".leaveDomainLDAP_ONLY").addClass("disabled"):this.$(".leaveDomain"+e).addClass("disabled"),i===a.FS_USER_MANAGEMENT_TYPES.LDAP_ONLY?this.unjoinActions.push(i):(this.unjoinActions.push(e),this.unjoinActions.indexOf(a.FS_PROTOCOLS.SMB)>=0&&this.unjoinActions.indexOf(a.FS_PROTOCOLS.NFS)>=0?(this.$(".joinSMBContainer, .joinNFSContainer").show(),this.$(".leaveBothContainer, .unjoinBothContainer, .NFSAdCredentials, .unjoinBothNFSContainer").hide(),this.$(".SMBPassword").val(this.$(".NFSPassword").val())):(this.$(".leave"+e+"Container,.unjoin"+e+"Container").hide(),this.$(".join"+e+"Container").show(),n=!0,(this.unjoinActions.indexOf(a.FS_PROTOCOLS.NFS)>=0&&this.$("#smbProtocol").is(":checked")&&!this.$("#smbProtocol").prop("disabled")||this.unjoinActions.indexOf(a.FS_PROTOCOLS.SMB)>=0&&this.$("#nfsProtocol").is(":checked")&&!this.$("#nfsProtocol").prop("disabled")&&this.$(".comboUserManagement").val()===a.FS_USER_MANAGEMENT_TYPES.ACTIVE_DIRECTORY)&&(this.$(".nfsAdContainer").hide(),this.$(".adRealNameContainer").show())),this.fsSupportNFS||this.$(".unjoinBothSMBContainer").hide()),this.getParentView().triggerAction(a.MODAL.ACT.AS_REBUILD),n&&this.$("#"+e+"Password").focus()},joinOrleaveDomain:function(){var e=this,t=function(t,i){var n={errorMessage:t,settings:i};return e.finalizeJoindata(n)};this.getInputs(t)},finalizeJoindata:function(e){this.getParentView().clearHeader(),e.errorMessage?(this.getParentView().$(".n-save").removeClass("disabled"),this.getParentView().$(".btnCancel").removeClass("disabled"),this.getParentView().showHeaderError(e.errorMessage)):this.updateFSDomain({settings:e.settings})},updateFSDomain:function(e){var t=this;this.getParentView().clearHeader();var n=e.settings,r=n[this.model.DP.AD_DETAILS];this.getParentView().fileServerUIModel.set(n),this.actionMode&&n[this.model.DP.AD_DETAILS]&&this.getParentView().fileServerUIModel.set({windowsAdDomainName:r[this.model.DP.adDetails.REALM],windowsAdUsername:r[this.model.DP.adDetails.USERNAME],windowsAdPassword:r[this.model.DP.adDetails.PASSWORD],addUserAsFsAdmin:r[this.model.DP.adDetails.ADD_USER_AS_FS_ADMIN],preferredDomainController:r[this.model.DP.adDetails.PREFERRED_DOMAIN_CONTROLLER],organizationalUnit:r[this.model.DP.adDetails.ORGANIZATIONAL_UNIT]}),this.compareToSpectre<0&&this.getParentView().fileServerUIModel.set(this.getParentView().fileServerUIModel.DP.OVERWRITE_USER_ACCOUNT,r[this.model.DP.adDetails.OVERWRITE_USER_ACCOUNT]),this.actionMode?this.getParentView().fileServerUIModel.actionMode=this.actionMode:this.getParentView().fileServerUIModel.isNew(!0),this.getParentView().fileServerUIModel.save(null,{success:function(e,n){s.processSerializedObject(n)[l.TASK_UUID]&&(t.getParentView().hide(),i.showClientNotification(a.NOTIFY_SUCCESS,t.i18n("domain_message")),t.deleteUserMapping&&t.deletFsUserMapping())},error:function(e,i){t.unjoin?t.showHeaderError(t.i18ns("server_error_message_template",t.i18ns("leaving_from_domain"))+s.processAjaxError(i.responseText)):t.showHeaderError(t.i18ns("server_error_message_template",t.i18ns("joining_to_domain"))+s.processAjaxError(i.responseText)),t.getParentView().$(".n-save").removeClass("disabled"),t.getParentView().$(".btnCancel").removeClass("disabled")}})},deletFsUserMapping:function(){n.deletFsUserMapping(this.getParentView().actionRoute.actionTargetId)},converProtocolType:function(e){return{NONE:"0",SMB:"1",NFS:"2",NFS_SMB:"3"}[e]},addTable:function(e){e=e&&e.uri?e.uri.split(" "):[];var i=new t({idAttribute:"serverIp",fileServerUuid:this.model.actionTargetId,entityType:a.ENTITY_FILE_SERVER,disableInlineEdit:!1,ebTableStyle:!0,dataItems:e,parent:this});this.$(".ldapTable").html(i.render().el)},handleAddLDAPServerClick:function(){this.$(".noLdapServer").hide(),this.$(".ldapTableContainer").show(),this.addTable(),$("a.link-table-input").click()},onSave:function(e){this.getInputs(e)},afterGetAllInputs:function(e,t){var i="";return this.$(".error-class").removeClass("error-class"),this.checkSMBADInputs&&(i+=this.validateADInputs(e,a.FS_PROTOCOLS.SMB)),this.checkNFSADInputs&&(i+=this.validateADInputs(e,a.FS_PROTOCOLS.NFS)),this.checkLdapInputs&&(i+=this.validateLdapInputs(e)),this.checkNfsv4Domain&&(i+=this.validateNfsv4Domain(e)),i&&(i=this.i18n("invalid_input_msg")+i),t(i,e)},getInputs:function(e){var t=this,i={UNMANAGED:"2",NONE:"0"};this.checkSMBADInputs=!1,this.checkNFSADInputs=!1,this.checkLdapInputs=!1,this.checkNfsv4Domain=!1,this.isReadingFile=!1;var n={};if(this.updateDomain){var r=this.model.get(this.model.DP.NAME_SERVICE_CONFIG);if(r){n=r;var o=this.model.getAdDetails();if(this.unjoinActions.indexOf(a.FS_PROTOCOLS.SMB)>=0||this.unjoinActions.indexOf(a.FS_PROTOCOLS.NFS)>=0){var l=$.trim(this.$(".SMBPreferredDomainController").val())||$.trim(this.$(".NFSPreferredDomainController").val());l&&(o.preferredDomainController=l)}var c=this.model.getLdapDetails();o&&(o.protocolType=this.converProtocolType(o.protocolType),n.adDetails=o),c&&(c.protocolType=T[c.protocolType]),n.localDetails=null}}var u=this.$(".comboUserManagement").val();if(this.$("#smbProtocol").is(":checked")?_.contains(this.unjoinActions,a.FS_PROTOCOLS.SMB)?(n.adDetails=this.getADInputs(a.FS_PROTOCOLS.SMB),this.checkSMBADInputs=!0,this.$("#nfsProtocol").is(":checked")&&u===a.FS_USER_MANAGEMENT_TYPES.ACTIVE_DIRECTORY&&!_.contains(this.unjoinActions,a.FS_PROTOCOLS.NFS)?n.adDetails=_.extend(n.adDetails,{protocolType:this.converProtocolType(a.FS_PROTOCOLS.NFS)}):n.adDetails=_.extend(n.adDetails,{protocolType:this.converProtocolType(a.FS_PROTOCOLS.NONE)})):(this.$("#smbProtocol").prop("disabled")?(this.$("#nfsProtocol").is(":checked")&&!this.$("#nfsProtocol").prop("disabled")&&u===a.FS_USER_MANAGEMENT_TYPES.ACTIVE_DIRECTORY||_.contains(this.unjoinActions,a.FS_PROTOCOLS.NFS))&&(n.adDetails=this.getADInputs(a.FS_PROTOCOLS.NFS),this.checkNFSADInputs=!0):(n.adDetails=this.getADInputs(a.FS_PROTOCOLS.SMB),this.checkSMBADInputs=!0),this.$("#nfsProtocol").is(":checked")&&u===a.FS_USER_MANAGEMENT_TYPES.ACTIVE_DIRECTORY&&!_.contains(this.unjoinActions,a.FS_PROTOCOLS.NFS)?n.adDetails=_.extend(n.adDetails,{protocolType:this.converProtocolType(a.FS_PROTOCOLS.NFS_SMB)}):(n.adDetails||(n.adDetails=this.getADInputs(a.FS_PROTOCOLS.SMB),this.checkSMBADInputs=!0),n.adDetails=_.extend(n.adDetails,{protocolType:this.converProtocolType(a.FS_PROTOCOLS.SMB)}))):((this.$("#nfsProtocol").is(":checked")&&!this.$("#nfsProtocol").prop("disabled")&&u===a.FS_USER_MANAGEMENT_TYPES.ACTIVE_DIRECTORY||_.contains(this.unjoinActions,a.FS_PROTOCOLS.NFS))&&(n.adDetails=this.getADInputs(a.FS_PROTOCOLS.NFS),this.checkNFSADInputs=!0),this.$("#nfsProtocol").is(":checked")&&u===a.FS_USER_MANAGEMENT_TYPES.ACTIVE_DIRECTORY&&!_.contains(this.unjoinActions,a.FS_PROTOCOLS.NFS)?n.adDetails=_.extend(n.adDetails,{protocolType:this.converProtocolType(a.FS_PROTOCOLS.NFS)}):n.adDetails&&(n.adDetails=_.extend(n.adDetails,{protocolType:this.converProtocolType(a.FS_PROTOCOLS.NONE)}))),this.$("#nfsProtocol").is(":checked")&&!this.$("#nfsProtocol").prop("disabled")&&u===a.FS_USER_MANAGEMENT_TYPES.LDAP_ONLY&&(n.ldapDetails=this.getLdapInputs(),this.checkLdapInputs=!0,this.$("#ldapfileInput").is(":checked"))){var d=this.$("#uploadChainCertificate")[0].files[0];if(d){this.isReadingFile=!0;var h=function(i){n.ldapDetails.tlsCacertcontent=i,t.afterGetAllInputs(n,e)};s.readFileSync(d,h)}}this.$("#nfsProtocol").is(":checked")&&!this.$("#nfsProtocol").prop("disabled")&&(n.nfsv4Domain=$.trim(this.$(".nfsDomain").val()),n.nfsv4Domain&&(this.checkNfsv4Domain=!0)),this.isPostThreeDotFive&&this.$("#nfsProtocol").is(":checked")&&this.getNfsVersionSetting(n),this.$("#nfsProtocol").is(":checked")&&u===a.FS_USER_MANAGEMENT_TYPES.UNMANAGED&&(n.localDetails={protocolType:i.UNMANAGED}),!this.$("#nfsProtocol").is(":checked")&&this.localDetails&&(n.localDetails={protocolType:i.NONE}),_.contains(this.unjoinActions,a.FS_USER_MANAGEMENT_TYPES.LDAP_ONLY)&&(n.ldapDetails={protocolType:T.DISABLE}),this.isReadingFile||this.afterGetAllInputs(n,e)},getNfsVersionSetting:function(e){this.$(".enableNfsv3").is(":checked")&&this.$(".enableNfsv4").is(":checked")?e.nfsVersion=a.NFS_VERSION.NFSV3V4:this.$(".enableNfsv3").is(":checked")?e.nfsVersion=a.NFS_VERSION.NFSV3:e.nfsVersion=a.NFS_VERSION.NFSV4},getADInputs:function(e){var t={};return t.windowsAdDomainName=$.trim(this.$("."+e+"RealmName").val()),t.windowsAdUsername=$.trim(this.$("."+e+"Username").val()),t.windowsAdPassword=$.trim(this.$("."+e+"Password").val()),t.addUserAsFsAdmin=this.$("."+e+"AddAdminCheckbox").is(":checked"),t.organizationalUnit=$.trim(this.$("."+e+"OrganizationalUnit").val()),t.preferredDomainController=$.trim(this.$("."+e+"PreferredDomainController").val()),t.overwriteUserAccount=this.$("#"+e+"checkboxOverwriteAd").is(":checked"),t.rfc2307Enabled=this.$("#rfc2307Enabled").is(":checked"),this.isPostThreeDotOne&&(t.useSameCredentialsForDns=this.$("#"+e+"checkboxDnsEntries").is(":checked")),t},getLdapInputs:function(){var e={};return e.uri="",_.each(this.$(".ldap-table-row"),function(t){e.uri+=$(t).attr("data-id")+" "}),e.uri=$.trim(e.uri),e.base=$.trim(this.$(".baseDN").val()),e.binddn=$.trim(this.$(".bindDN").val()),e.bindpw=$.trim(this.$(".bindPassword").val()),e.protocolType=T.NFS,e.tlsReqcert=null,e},parseLdapInputs:function(e){var t=e.split(",");return t=_.map(t,function(e){return $.trim(e)}),t.join(",")},validateADInputs:function(e,t){var i="",n=!1;return e.adDetails.windowsAdDomainName?-1===e.adDetails.windowsAdDomainName.indexOf(".")&&(this.$("."+t+"RealmName").addClass("error-class"),i+=this.i18n("invalid_realm_name")):(i+=this.i18n("invalid_realm_name"),this.$("."+t+"RealmName").addClass("error-class"),n=!0),e.adDetails.windowsAdUsername||(this.$("."+t+"Username").addClass("error-class"),n=!0),e.adDetails.windowsAdPassword||(this.$("."+t+"Password").addClass("error-class"),n=!0),n&&(i+=this.i18n("missing_ad_credentials")),i},validateLdapInputs:function(e){var t="";return e.ldapDetails.uri||(t+=this.i18n("missing_ldap_server_ip"),this.$(".link-table-input").click()),e.ldapDetails.base?e.ldapDetails.base.split(" ").length>1&&(t+=this.i18n("invalid_base_dn"),this.$(".baseDN").addClass("error-class")):(t+=this.i18n("missing_base_dn"),this.$(".baseDN").addClass("error-class")),e.ldapDetails.binddn&&(e.ldapDetails.bindpw||(t+=this.i18n("miss_bind_password"),this.$(".bindPassword").addClass("error-class"))),t},validateNfsv4Domain:function(e){var t="";return this.isValidHostname(e.nfsv4Domain)||(t+=this.i18n("invalid_NFSV4Domain_msg"),this.$(".nfsDomain").addClass("error-class")),t},isValidHostname:function(e){return s.isValidHostname(e)}})}),define("views/wizards/fileserver/FileServerProtocolsPage",["views/basecomponents/wizards/BaseWizardPage","views/popups/fileserver/FileServerUserManagementView","utils/SubViewHelper","utils/AppConstants","utils/AppUtil","utils/FileServerUtil","data/DataProperties","managers/I18nManager"],function(e,t,i,n,s,a,r,o){"use strict";return e.extend({name:"FileServerProtocolsPage",initialize:function(t){e.prototype.initialize.apply(this,arguments),this.model=this.model[0],this.subViewHelper=new i},render:function(){if(this.isViewRendered)return void this.subViewHelper.render("userManagementView");this.$el.html('<div class="n-modal-content"><div data-ntnx-content-inner><div class="userManagementContainer"></div></div></div>'),this.subView=new t({el:".userManagementContainer",model:this.model}),this.subView.setParentView(this),this.subViewHelper.register("userManagementView",this.subView),this.subViewHelper.render("userManagementView"),this.isViewRendered=!0},destroy:function(){this.subViewHelper.destroy(),e.prototype.destroy.apply(this)},canEnablePageLink:function(){return!1},getButtonLabel:function(e){return e<0?o.t("Common","back"):null},onPageTransition:function(e){var t=this,i=void 0,n=function(n,s){i={errorMessage:n,settings:s},t.completeTransistion(i,e)};this.subView.onSave(n)},completeTransistion:function(e,t){var i=this;e.errorMessage?(this.showError(e.errorMessage),this.$(".nutanixMoreInfo").nutanixMoreInfo({parseDataAttrs:!0})):(_.size(e.settings)?(this.model.set(this.model.DP.NAME_SERVICE_CONFIG,e.settings),this.model.set({windowsAdDomainName:e.settings.adDetails&&e.settings.adDetails[this.model.DP.REALM],windowsAdUsername:e.settings.adDetails&&e.settings.adDetails[this.model.DP.USERNAME],windowsAdPassword:e.settings.adDetails&&e.settings.adDetails[this.model.DP.PASSWORD],addUserAsFsAdmin:e.settings.adDetails&&e.settings.adDetails[this.model.DP.ADD_USER_AS_FS_ADMIN],organizationalUnit:e.settings.adDetails&&e.settings.adDetails[this.model.DP.ORGANIZATIONAL_UNIT],preferredDomainController:e.settings.adDetails&&e.settings.adDetails[this.model.DP.PREFERRED_DOMAIN_CONCTROLLER]}),a.compareAFSversion(this.model,n.FILE_SERVER_VERSIONS.SPECTRE)<0&&this.model.set(this.model.DP.OVERWRITE_USER_ACCOUNT,e.settings.adDetails&&e.settings.adDetails[this.model.DP.OVERWRITE_USER_ACCOUNT])):this.model.set(this.model.DP.NAME_SERVICE_CONFIG,{}),this.populateDNS(),!this.model.actionMode||this.model.actionMode!==n.ACTION_ACTIVATE_FILE_SERVER&&this.model.actionMode!==n.ACTION_FILE_SERVER_CLONE?t():(this.disableSaveButton(),this.disableCancelButton(),this.disablePreviousButton(),this.model.save(null,{success:function(e,i){s.processSerializedObject(i)[r.TASK_UUID]&&t()},error:function(e,t){i.enableSaveButton(),i.enableCancelButton(),i.enablePreviousButton(),!1===i.model.get(i.model.DP.PDSTATUS)?i.showError(i.i18ns("server_error_message","activating")+s.processAjaxError(t.responseText)):i.model.actionMode===n.ACTION_FILE_SERVER_CLONE?i.showError(i.i18ns("server_error_message","cloning")+s.processAjaxError(t.responseText)):i.showError(s.processAjaxError(t.responseText))}})))},populateDNS:function(){var e=this.model.getUnescapedValue(this.model.DP.NAME_SERVICE_CONFIG+"."+this.model.DP.AD_DETAILS);if(e){var t=void 0;t={dnsOpType:n.DNS_OP_TYPE.AUTO,dnsServer:"",dnsUserName:e[this.model.DP.USERNAME],dnsPassword:e[this.model.DP.PASSWORD]},this.model.set(this.model.DP.DNS_OPERATIONS,t)}else this.model.set(this.model.DP.DNS_OPERATIONS,{dnsOpType:n.DNS_OP_TYPE.MANUAL})},onPageCancel:function(){return!0}})}),define("text!templates/wizards/fileserver/FileServerScaleOutPage.html",[],function(){return'<form id="fileServerScaleOut" class="form-horizontal fs-fileServerScaleUpForm">\n  <section class="fsDetails-config">\n    <div class="section-header">File Server Capacity Configuration</div>\n    <div class="section-content">\n      \x3c!-- Warning message --\x3e\n      <div class="control-group">\n        <div class="description warning-message">\n          Note: Changing either of these parameters may cause a\n          momentary connection drop for end users accessing files on\n          File Server <%= name %>.\n        </div>\n      </div>\n      \x3c!-- Number of NVMs --\x3e\n      <div class="control-group num-nvm-control">\n        <label class="control-label">\n          Number of File Server VMs (current : <%=currentNvmConf%>)\n        </label>\n        <div class="controls">\n          <input type="number" class="fs-num-nvms" value="<%= numNvms %>"\n            min="3" max="<%= noOfHosts %>"/>\n        </div>\n      </div>\n    </div>\n  </section>\n</form>'}),define("views/wizards/fileserver/FileServerScaleOutPage",["views/basecomponents/wizards/BaseWizardPage","models/fileserver/ShareCollection","utils/AppUtil","utils/AppConstants","text!templates/wizards/fileserver/FileServerScaleOutPage.html"],function(e,t,i,n,s){"use strict";s=_.template(s);var a=_.template("File Server <%= name %> is overloaded. <br/> Recommendation: Update number of File Servers to <%= newNvm %>.");return e.extend({events:{"keydown  .fs-num-nvms":"onKeyDown"},initialize:function(t){e.prototype.initialize.apply(this,arguments),this.model=this.model[0]},onKeyDown:function(e){e.preventDefault()},render:function(){var e=this;if(!this.isViewRendered){var s=this.model.get(this.model.DP.UUID),a=new t;i.showLoader(),a.setFSId(s),a.fetch({success:function(t,s){i.hideLoader(),_.find(t.models,function(e){return e.get(e.DP.PROTOCOL_TYPE)===n.FS_PROTOCOLS.NFS})&&e.model.set("hasNFSShare",!0),e.renderPage()},error:function(t,n){i.hideLoader(),e.showError(e.i18ns("server_error_message_template",e.i18ns("fetch_share"))+i.processAjaxError(n.responseText)),e.renderPage()}})}},renderPage:function(){var e=this.model.getNumberOfHost();e<3&&(e=3);var t=s({numNvms:this.model.getRecommendationDetails(this.model.DP[this.model.DP.RECOMMENDATION].NUM_NVMS)?this.model.get(this.model.DP.NVMS).length+parseInt(this.model.getRecommendationDetails(this.model.DP[this.model.DP.RECOMMENDATION].NUM_NVMS),10):this.model.get(this.model.DP.NVMS).length,currentNvmConf:this.model.get(this.model.DP.NVMS).length,noOfHosts:e,name:this.model.get(this.model.DP.NAME)});this.isScaleOutRecommended()&&this.getWizard().showHeaderWarning(a({name:this.model.get(this.model.DP.NAME),newNvm:this.model.get(this.model.DP.NVMS).length+parseInt(this.model.getRecommendationDetails(this.model.DP[this.model.DP.RECOMMENDATION].NUM_NVMS),10)})),this.$el.html(t),this.$el.addClass("fs-fileServerScaleOutPage"),this.isViewRendered=!0},canEnablePageLink:function(){return!1},getButtonLabel:function(e){return e<0?n.BUTTON.BACK:null},onPageTransition:function(e){var t=parseInt(this.$(".fs-num-nvms").val().trim(),10);this.validateNumNvm(t)&&(this.model.set({numCalculatedNvms:t,nvmChange:!0,isScaleOut:!0,recommendedAction:this.model.actionMode===n.ACTION_REBALANCE?n.ACTION_SCALE_OUT:null}),e())},onPageCancel:function(){return!0},validateNumNvm:function(e){return e===this.model.get(this.model.DP.NVMS).length?void this.showError("Number of File Server VMs should be lesser or greater than the existing number of File Server VMs."):!(e<3)||void this.showError("Number of File Server VMs should not be less than default number of File Server VMs i.e 3")},isScaleOutRecommended:function(){return!!(this.model.getRecommendationDetails(this.model.DP[this.model.DP.RECOMMENDATION].RECOMMENDATION_TYPE)&&"SCALEOUT"===this.model.getRecommendationDetails(this.model.DP[this.model.DP.RECOMMENDATION].RECOMMENDATION_TYPE).toUpperCase()&&parseInt(this.model.getRecommendationDetails(this.model.DP[this.model.DP.RECOMMENDATION].NUM_NVMS),10)>0)}})}),define("text!templates/wizards/fileserver/FileServerSummaryPage.html",[],function(){
return'<div class="n-modal-content">\n  <div data-ntnx-content-inner>\n    <form id="file-server-summary" class="form-horizontal fs-fileServerSummaryForm">\n      <section data-ntnx-section>\n        <h5 data-ntnx-title><%= messages.title %>\n          <span class="name"> <%= name %> </span>\n        </h5>\n        <section data-ntnx-section="type-text">\n          <div> <%= messages.storage_capacity %>:\n            <span class="size"><%= size %>\n            </span> <%= messages.tib %>\n          </div>\n          <div> <%= messages.configuration %>:\n            <span class="nvms"> <%= nvms %></span> <%= messages.fs_vms %>\n            <span class="cpu"><%= numCpu %></span> <%= messages.fs_vcpu %>\n            <span class="memory"><%= memory %></span> <%= messages.fs_ram %>\n          </div>\n        </section>\n      </section>\n      <section data-ntnx-section="type-separator">\n        <h5 data-ntnx-title><%= messages.pd_title %></h5>\n        <section data-ntnx-section>\n            <%= Components.checkbox(\n              {\n                jsClasses : \'createProtection\',\n                labelText: messages.create_protection_msg\n              })\n            %>\n        </section>\n        <section data-ntnx-section="type-text">\n          <%= messages.description %></br>\n          <%= messages.description2 %>\n          <a class="learnMoreTooltip"><%= messages.learn_more %></a>\n          <section data-ntnx-section="type-text">\n            <label data-ntnx-label for="pdName"><%= messages.pd_name %></label>\n            <input type="text" id = "pdName" class="pd-name" value="<%= pdName %>"\n              maxlength="75">\n          </section>\n        </section>\n      </section>\n    </form>\n  </div>\n</div>\n'}),define("views/wizards/fileserver/FileServerSummaryPage",["views/basecomponents/wizards/BaseWizardPage","models/dataprotection/ProtectionDomainCollection","data/DataProperties","utils/AppUtil","utils/AppConstants","utils/StatsUtil","components/Components","text!templates/wizards/fileserver/FileServerSummaryPage.html"],function(e,t,i,n,s,a,r,o){"use strict";return e.extend({name:"FileServerSummaryPage",events:{"click .default-pd-name":"onDefaultPdNameClick"},template:_.template(o),initialize:function(t){e.prototype.initialize.apply(this,arguments),this.model=this.model[0]},render:function(){this.$(".pd-name").val("NTNX-"+this.model.get(this.model.DP.NAME)),this.$(".name").html(this.model.get(this.model.DP.NAME));var e=a.convertBytesToUnit(a.convertToBytes(this.model.get(this.model.DP.FILE_SERVER_SIZE),a.UOM_GIB,!1),a.UOM_TIB,!1);this.$(".size").html(e),this.$(".nvms").html(parseInt(this.model.get(this.model.DP.NUM_NVMS),10)),this.$(".cpu").html(this.model.get(this.model.DP[this.model.DP.NVMS].NUM_VCPUS_PER_VM)),this.$(".memory").html(this.model.get(this.model.DP[this.model.DP.NVMS].MEM_PER_VM)),this.isViewRendered||(this.renderViewDetails(),this.$(".learnMoreTooltip").tooltip({title:this.i18n("messages.learn_more_msg"),trigger:"hover",placement:"left"}),this.isViewRendered=!0)},canEnablePageLink:function(){return!1},getButtonLabel:function(e){return e<0?s.BUTTON.BACK:null},getSaveButtonLabel:function(){return"Create"},onPageTransition:function(e){var t=null,s=this,a=this.$(".createProtection").is(":checked"),r=$.trim(this.$(".pd-name").val());a&&(r?r!=="NTNX-"+this.model.get(this.model.DP.NAME)&&a&&(t=this.validateAndHandleError(r)):(t=!0,this.showError(this.i18n("miss_pd_name_error")))),t||(a?this.model.set(this.model.DP.PD_NAME,r):this.model.unset(this.model.DP.PD_NAME),this.disableSaveButton(),this.disableCancelButton(),this.disablePreviousButton(),this.model.save(null,{success:function(t,s){n.processSerializedObject(s)[i.TASK_UUID]&&e()},error:function(e,t){s.enableSaveButton(),s.enableCancelButton(),s.enablePreviousButton(),n.log("FileServer: Error :"+t),t.responseText=t.responseText.split("'").join(""),s.showError("Error creating: "+n.processAjaxError(t.responseText))}},this))},onPageCancel:function(){return!0},onDefaultPdNameClick:function(){this.$("#enablePd").is(":checked")?this.$(".pd-name").prop("disabled",!1):this.$(".pd-name").prop("disabled",!0)},renderViewDetails:function(){var e=+n.formatFloat(a.convertBytesToUnit(a.convertToBytes(this.model.get(this.model.DP.FILE_SERVER_SIZE),a.UOM_GIB,!1),a.UOM_TIB,!1)),t=this.template({name:this.model.get(this.model.DP.NAME),size:e,nvms:parseInt(this.model.get(this.model.DP.NUM_NVMS),10),numCpu:this.model.get(this.model.DP[this.model.DP.NVMS].NUM_VCPUS_PER_VM),memory:this.model.get(this.model.DP[this.model.DP.NVMS].MEM_PER_VM),pdName:"NTNX-"+this.model.get(this.model.DP.NAME),Components:r,messages:this.i18n("messages")});this.$el.html(t),this.$(".createProtection").prop("checked",!0),this.$el.addClass("fs-fileServerPdPage")},validateAndHandleError:function(e){var n=new t;return n.fetch({async:!1}),!!_.some(_.map(n.models,function(t){return t.get(i.NAME)===e}))&&(this.showError(this.i18ns("pd_name_error",e)),this.getWizard().setCurrentPageTitleError(),!0)}})}),define("text!templates/wizards/fileserver/CloneFileServerSummaryPage.html",[],function(){return'<form id="file-server-summary" class="form-horizontal">\n  <section>\n    <div class="section-header"><%= title %></div>\n    <div class="section-content">\n      <div class="description protect-domain-text"><%= description%>\n        <a class="fileserver-name"><%= fileServerPageMsg%></a>\n      </div>\n    </div>\n  </section>\n</form>\n'}),define("views/wizards/fileserver/CloneFileServerSummaryPage",["views/basecomponents/wizards/BaseWizardPage","managers/NavigationManager","managers/I18nManager","data/DataProperties","utils/AppUtil","utils/AppConstants","text!templates/wizards/fileserver/CloneFileServerSummaryPage.html"],function(e,t,i,n,s,a,r){"use strict";return e.extend({template:_.template(r),events:{"click .fileserver-name":"onFileServerNameClick"},initialize:function(t){e.prototype.initialize.apply(this,arguments),this.model=this.model[0]},render:function(){this.isViewRendered||(this.renderViewDetails(),this.isViewRendered=!0)},getSaveButtonLabel:function(){return i.t("FileServerPopupView","clone")},onPageCancel:function(){return!0},onPageTransition:function(e){var t=this;this.disableSaveButton(),this.disableCancelButton(),this.disablePreviousButton(),this.model.save(null,{success:function(t,i){s.processSerializedObject(i)[n.TASK_UUID]&&e()},error:function(e,n){t.enableSaveButton(),t.enableCancelButton(),t.enablePreviousButton(),s.log("FileServer: Error :"+n),t.showError(i.t("FileServerWizard","error.clone")+s.processAjaxError(n.responseText))}},this)},onDefaultPdNameClick:function(){this.$("#enablePd").is(":checked")?this.$(".pd-name").prop("disabled",!1):this.$(".pd-name").prop("disabled",!0)},renderViewDetails:function(){var e=this.template({title:i.t("FileServerWizard","title.clone_file_server"),description:i.t("FileServerWizard","summary_description"),fileServerPageMsg:i.t("FileServerWizard","file_server_page_msg")});this.$el.html(e)},onFileServerNameClick:function(e){e.preventDefault(),this.theWizard.hide();var i=a.ENTITY_FILE_SERVER,n={action:a.ACTION_DETAILS,actionTarget:a.ENTITY_FILE_SERVER,actionParentEntityType:a.PAGE_CLUSTER};t.navigateToPage(i,n)}})}),define("text!templates/wizards/fileserver/FSUserMappingSearchPage.html",[],function(){return"<div class=\"userMappingSearch\">\n  <section data-ntnx-section>\n    <h5 data-ntnx-title><%= i18n('search_title') %></h5>\n    <p data-ntnx-section=\"type-text\"><%= i18n('search_desc') %></p>\n  </section>\n  <section data-ntnx-section>\n    <div class=\"radio-flex-container\">\n      <div data-ntnx-form-inline>\n        <%= Components.radio({\n          jsClasses: 'smbMapping mappingRadio',\n          id: 'smbMapping',\n          labelText: i18n('smb_to_nfs_mapping')\n        }) %>\n      </div>\n      <div data-ntnx-form-inline>\n        <%= Components.radio({\n          jsClasses: 'nfsMapping mappingRadio',\n          id: 'nfsMapping',\n          labelText: i18n('nfs_to_smb_mapping')\n        }) %>\n      </div>\n    </div>\n  </section>\n  <section data-ntnx-section>\n    <div class=\"n-search-wrapper\">\n      <div class=\"n-search-container\">\n        <%= Components.select({\n          options: mappingOptions,\n          jsClasses: 'userOrGroupSelect user-or-group-select',\n          variants: 'bottom-anchor',\n          useBrowserSelect: true\n        }) %>\n        <i aria-hidden=\"true\" data-icon=\"B\" class=\"n-icon-serach\"></i>\n        <input class=\"searchInput n-search\" type=\"text\">\n      </div>\n      <div class=\"serach-btn-wrapper\">\n        <%= Components.button({\n          extraClasses: 'btnSearch',\n          text: i18n('search')\n        }) %>\n      </div>\n    </div>\n  </section>\n  <section data-ntnx-section>\n    <div class=\"searchresult\"></div>\n  </section>\n</div>\n"}),define("views/wizards/fileserver/FSUserMappingSearchPage",["views/basecomponents/wizards/BaseWizardPage","utils/AppConstants","text!templates/wizards/fileserver/FSUserMappingSearchPage.html"],function(e,t,i){"use strict";return e.extend({name:"FSUserMappingSearchPage",template:_.template(i),events:{"click .mappingRadio":"onClickMappingRadio","click .btnSearch":"onClickBtnSearch"},render:function(){if(this.rendered)return void this.getWizard().$(".removeUserMapping").removeClass("hidden");var e=[{value:"user",name:this.i18n("user")},{value:"group",name:this.i18n("group")}],i=this.template(this.vtOptions({mappingOptions:e}));this.$el.html(i),this.$(".smbMapping").prop("checked",!0),this.getWizard().triggerAction(t.MODAL.ACT.AS_REBUILD),this.getWizard().$(".removeUserMapping").removeClass("hidden"),this.rendered=!0},onClickMappingRadio:function(e){$(e.currentTarget).hasClass("smbMapping")?this.$(".nfsMapping").prop("checked",!1):this.$(".smbMapping").prop("checked",!1)},onClickBtnSearch:function(){this.getWizard().search(this)},onPageTransition:function(e){this.getWizard().$(".removeUserMapping").addClass("hidden"),e()},canEnablePageLink:function(){return!1},onPageCancel:function(){return!0}})}),define("text!templates/wizards/fileserver/FSRuleBasedMappingPage.html",[],function(){return"<form>\n  <div class=\"ruleBasedMapping\">\n    <section data-ntnx-section>\n      <h5 data-ntnx-title><%= i18n('template_mapping_rule_title') %></h5>\n      <p data-ntnx-section=\"type-text\">\n        <%= i18n('default_mapping_rule_desc') %>\n      </p>\n    </section>\n    <section data-ntnx-section>\n      <%= Components.select({\n        jsClasses: 'defaultRule',\n        options: defaultRuleOptions,\n        useBrowserSelect: true\n      }) %>\n    </section>\n  </div>\n</form>"}),define("views/wizards/fileserver/FSRuleBasedMappingPage",["views/basecomponents/wizards/BaseWizardPage","models/fileserver/UserMappingModel","managers/I18nManager","utils/AppConstants","text!templates/wizards/fileserver/FSRuleBasedMappingPage.html"],function(e,t,i,n,s){"use strict";var a=i.t("FSRuleBasedMappingPage","select_rule");return e.extend({name:"FSRuleBasedMappingPage",template:_.template(s),initialize:function(i){e.prototype.initialize.apply(this,arguments),this.model?(this.userMappingModel=this.model[0],this.fsModel=this.model[1]):this.userMappingModel=new t},render:function(){if(!this.isViewRendered){this.pageIds=this.getPageIds();var e=this.getDefaultRule();if(this.isViewRendered=!0,!this.userMappingModel.isNew()){for(var t=this.userMappingModel.getRuleBasedMappingDetail(this.userMappingModel.DP.TEMPLATE_MAPPING),i=0;i<e.length&&e[i].value!==t;i++);i<e.length&&(e[i].selected=!0)}var n=this.template(this.vtOptions({defaultRuleOptions:e}));this.$el.html(n)}},getDefaultRule:function(){var e=[{value:n.FS_USER_MAPPING_RULES.NO_TEMPLATE_MAPPING,name:i.t("FSRuleBasedMappingPage","no_template_mapping")},{value:n.FS_USER_MAPPING_RULES.SMB_NAME_NFS_NAME,name:i.t("FSRuleBasedMappingPage","sam_match_username")}];return this.fsModel.getServerIP()||e.splice(1,1),e},getButtonLabel:function(e){return e<0?n.BUTTON.BACK:null},onPageTransition:function(e){var t=void 0;t=this.userMappingModel.isNew()?{}:this.userMappingModel.getRuleBasedMapping(),this.$(".defaultRule").val()!==a&&(t[this.userMappingModel.DP.TEMPLATE_MAPPING]=this.$(".defaultRule")[0].value),this.userMappingModel.set(this.userMappingModel.DP.RULE_BASED_MAPPING,t),e()},canEnablePageLink:function(){return!1},onPageCancel:function(){return!0}})}),define("utils/FileServerTemplates",["views/basecomponents/tableinput/TableInputView"],function(e){"use strict";return{name:"FileServerTemplates",FS_ONE_TO_ONE_TABLE_DATA_ROW:_.template('\n        <tr data-id="<%= dataId %>" new="true"\n          class="n-table-row one-to-one-mapping-row tableRow">\n          <% _.each(columns, function(column) { %>\n            <% if(column.className === "userOrGroup" && isActionEnabled) { %>\n              <td class="data-cell user-or-group-select">\n                <%= Components.select({\n                  options: mappingOptions,\n                  jsClasses: \'userOrGroupSelect no-border\',\n                  variants: \'bottom-anchor\',\n                  useBrowserSelect: true,\n                  disabled: true\n                }) %>\n            <% } else { %>\n              <td class="data-cell">\n                <input type="text" class="input-data <%= column.className ?\n                  column.className : "" %>" readonly\n                  <% if(column.className === "smbUser") { %>\n                    placeholder="<%=i18n(\'smb_user_example\')%>"\n                  <% } else { %>\n                    placeholder="<%=i18n(\'nfs_user_example\')%>"\n                  <% }%>\n                  value="<%= isNew ? "" : column.renderer(data)%>">\n              <% }%>\n            </td>\n          <% }); %>'+e.EDIT_COLUMN_TEMPLATE+"\n        </tr>"),FS_WILDCARD_TABLE_DATA_ROW:_.template('\n        <tr data-id="<%= dataId %>" new="true"\n          class="n-table-row wild-card-mapping-row tableRow">\n          <% for (var i = 0; i < columns.length; i++) { %>\n            <% if (columns[i].className === "userOrGroup") { %>\n              <td class="data-cell user-or-group-select <%= i == 0 ?\n                \'dropdownCell\' : \'\' %>" data-id=<%= rowIndex %>>\n                <%= Components.select({\n                  options: mappingOptions,\n                  jsClasses: \'userOrGroupSelect no-border\',\n                  variants: \'bottom-anchor\',\n                  useBrowserSelect: true,\n                  disabled: true\n                }) %>\n            <% } else { %>\n              <td class="data-cell <%= i == 0 ? \'dropdownCell\' : \'\' %>"\n                data-id=<%= rowIndex %>>\n              <% if (columns[i].className !== "priority") { %>\n                <input type="text" class="input-data <%= columns[i].className ?\n                  columns[i].className : "" %>" readonly\n                  placeholder="<%= columns[i].placeholderText %>"\n                  value="<%= isNew ? "" : columns[i].renderer(data)%>">\n              <% } %>\n            <% } %>\n            </td>\n          <% } %>'+e.EDIT_COLUMN_TEMPLATE+"\n        </tr>")}}),define("views/popups/fileserver/FSUserOneToOneMappingTableInputView",["views/basecomponents/tableinput/TableInputView","utils/AntiscrollUtil","utils/FileServerUtil","utils/DataExportUtil","utils/FileServerTemplates","utils/ValidationUtil","utils/AppConstants"],function(e,t,i,n,s,a,r){"use strict";var o=_.template(i.getFSTableTemplate("addManualMappingDesc","addOneToOneMappingLink","add_mapping")+"\n        <section data-ntnx-section>\n          <span><%= i18n('upload_csv') %></span>\n        </section>\n      "),l=_.template(i.getFSTableTemplate("addMappingNumber","downLoadMapping","download",!0)+"\n    "),c=_.template('<tr class="no-data">\n         <td colspan="<%= columnLength %>">\n          <a class="viewMore"><%= viewMore %></a>\n        </td>\n      </tr>'),u={SMB_USER:"smbUser",NFS_USER:"nfsUser",USER_OR_GROUP:"userOrGroup"};return e.extend({name:"FSUserOneToOneMappingTableInputView",className:"component-table-input",tmplTable:null,initialize:function(t){this.parent=t.parent,t.columns=this.getResourceTableColumns(),e.prototype.initialize.call(this,t),this.tmplDataRow=s.FS_ONE_TO_ONE_TABLE_DATA_ROW,this.dataItems=t.dataItems||[],this.tmplTable=o,this.userMappingModel=t.userMappingModel,this.addExtraEvents({"click  a.addOneToOneMappingLink":"onClickAddRow","click  a.viewMore":"onClickViewMore","click  .downLoadMapping":"onClickDownLoadMapping","click  .uploadCsv":"onClickUploadCsv"})},render:function(){return this.setDataItems(),e.prototype.render.call(this,arguments),this.isReadOnly?this.$(".addMappingNumber").html(this.i18ns("mapping_number_desc",this.dataItems.length,this.completeDataItems.length)):this.$(".addManualMappingDesc").html(this.i18n("add_mapping_manually_desc")),this.dataItems.length>this.parent.rowCountToEnableScroll&&t.applyAntiScroll(this.$(".antiscroll-wrap"),null,180),this.isActionEnabled||this.insertViewMoreRow(),this},setDataItems:function(){this.isUserMappingConfigured=i.isUserMappingConfigured(this.userMappingModel),this.isUserMappingConfigured&&this.dataItems.length>100&&(this.completeDataItems=this.dataItems.slice(),this.dataItems=this.dataItems.slice(0,5),this.isReadOnly=!0,this.isActionEnabled=!1,this.tmplTable=l)},getResourceTableColumns:function(){var e=this.parent.model[1].getServerIP(),t=null===e?this.i18n("nfs_user_id"):this.i18n("nfs_user_name");return[{columnName:this.i18n("smb_user"),className:u.SMB_USER,renderer:function(e){return e&&e.smbName?e.smbName:""}},{columnName:t,className:u.NFS_USER,renderer:function(e){return e&&e.nfsName?e.nfsName:""}},{columnName:this.i18n("user_or_group"),className:u.USER_OR_GROUP,renderer:function(e){return e&&e.mappingType?e.mappingType:""}}]},insertTableRow:function(e,t){e instanceof Backbone.Model&&(e=e.attributes),t=void 0!==t&&t;var i=t?this.ID_TO_BE_ADDED:e[this.idAttribute],n=!t&&e.mappingType.toUpperCase()===r.USER_MAPPING_TYPE.GROUP,s=[{value:"user",name:this.i18n("user"),selected:!n},{value:"group",name:this.i18n("group"),selected:n}];this.$(".table-data-items tbody").append(this.tmplDataRow(this.vtOptions({isNew:t,dataId:i,data:e,columns:this.columns,isActionEnabled:this.isActionEnabled,modelAttribute:this.modelAttribute,mappingOptions:s}))),this.removeNoDataRow()},insertViewMoreRow:function(){this.$(".table-data-items tbody").append(c({columnLength:this.columns.length,viewMore:this.i18n("view_more")}))},onClickViewMore:function(){this.dataItems=this.completeDataItems.slice(0,this.dataItems.length+5),this.renderTable(),this.insertViewMoreRow(),this.$(".addMappingNumber").html(this.i18ns("mapping_number_desc",this.dataItems.length,this.completeDataItems.length))},onClickDownLoadMapping:function(){var e=[];_.each(this.parent.oneToOneMappingColumns,function(t){var i=void 0;switch(t.className){case u.SMB_USER:i="smbName";break;case u.NFS_USER:i="nfsName";break;default:i="mappingType"}e.push({exportTitle:t.columnName,mData:i})}),n.exportTableCSV(this.completeDataItems,e)},onClickUploadCsv:function(){this.parent.showUploadCSV()},saveRow:function(e){var i=this.getRowFromActionLink(e),n=i.find("input"),s=n.val().trim(),o=a.validateFormValues(i);if(o&&o.length)return i.find("td").addClass("error"),void this.trigger(this.ACTION_EVENTS.ERROR,{errors:o,rule:n.attr(r.FORM_SELECTORS.VALIDATE_MODEL_ATTR)});if(s){var l=s.replace("\\","*");i.attr("data-id",l),i.removeAttr("new"),this.trigger(this.ACTION_EVENTS.SAVE,i)}else i.remove();this.resetTable(),i.closest("table").find(".tableRow").length>this.parent.rowCountToEnableScroll&&t.applyAntiScroll(this.$(".antiscroll-wrap"),null,180)},onClickAddRow:function(){if(this.getRowToBeAddedElement().length)return void this.parent.showError(this.i18n("new_existing_row"));this.addRow()},onClickEditLink:function(t){e.prototype.onClickEditLink.apply(this,arguments);var i=this.getRowFromActionLink(t),n=$.trim(i.find(".smbUser").val()),s=$.trim(i.find(".nfsUser").val()),a=$.trim(i.find(".userOrGroupSelect").val());i.attr("smbUser",n),i.attr("nfsUser",s),i.attr("userOrGroupSelect",a),i.find(".userOrGroupSelect").attr("disabled","disabled"),i.find(".userOrGroupSelect").removeAttr("disabled")},onClickCancelLink:function(e){var t=this.getRowFromActionLink(e);t.find(".smbUser").val(t.attr("smbUser")),t.find(".nfsUser").val(t.attr("nfsUser")),t.find(".userOrGroupSelect").val(t.attr("userOrGroupSelect")),this.resetTable(),t.find(".userOrGroupSelect").attr("disabled","disabled")},onClickSaveLink:function(e){var t=(this.getRowFromActionLink(e),this.validateSaveAction(e));if(t)return void this.parent.showError(t);this.saveRow(e)},validateSaveAction:function(e){var t=$(e.currentTarget).closest("tr"),n="",s=$.trim(t.find(".smbUser").val());n+=s?i.validateSmbUser(s):this.i18nStatic("FileServerUtil","missing_smb_user");var a=$.trim(t.find(".nfsUser").val());return n+=a?i.validateNfsUser(a):this.i18nStatic("FileServerUtil","missing_nfs_user")}})}),define("views/popups/fileserver/FSWildcardMappingTableInputView",["views/basecomponents/tableinput/TableInputView","utils/AntiscrollUtil","utils/FileServerUtil","utils/FileServerTemplates","utils/ValidationUtil","utils/SVG","utils/AppConstants"],function(e,t,i,n,s,a,r){"use strict";var o=_.template(i.getFSTableTemplate("addWildcardDesc","addWildcardMappingLink","add_wildcard_link")),l=_.template('\n      <div class="dropdown priority-dropdown">\n        <button class="priority-dropdown-toggle dropdown-toggle">\n          <span class="text"><%= rowIndex %></span>&nbsp;\n          '+a.SVGIcon("z","-down-arrow")+'\n        </button>\n        <ul class="dropdown-menu priority-dropdown-menu" role="menu">\n          <%= options %>\n        </ul>\n      </div>'),c={MOVE_TO_TOP:0,MOVE_UP:1,MOVE_DOWN:2,MOVE_TO_BOTTOM:3};return e.extend({name:"FSWildcardMappingTableInputView",className:"component-table-input",tmplTable:null,initialize:function(t){this.parent=t.parent,t.columns=this.getResourceTableColumns(),e.prototype.initialize.call(this,t),this.dataItems=this.sortDataItmes(t.dataItems)||[],this.tmplTable=o,this.tmplDataRow=n.FS_WILDCARD_TABLE_DATA_ROW,this.userMappingModel=t.userMappingModel,this.addExtraEvents({"click    .dropdown-menu li":"onSelectPrority","click    .priority-dropdown-toggle":"onClickDropdown","click    a.addWildcardMappingLink":"onClickAddRow"})},sortDataItmes:function(e){return _.sortBy(e,function(e){return e.id})},render:function(){return e.prototype.render.call(this,arguments),this.$(".addWildcardDesc").html(this.i18n("add_wildcard_desc")),this.dataItems.length>this.parent.rowCountToEnableScroll&&t.applyAntiScroll(this.$(".antiscroll-wrap"),null,180),this},getResourceTableColumns:function(){var e=this.parent.model[1].getServerIP(),t=null===e?this.i18n("nfs_user_id"):this.i18n("nfs_user_name");return[{columnName:this.i18n("priority"),className:"priority",placeholderText:""},{columnName:this.i18n("smb_user"),className:"smbUser",placeholderText:this.i18n("smb_user_example"),renderer:function(e){return e&&e.smbName?e.smbName:""}},{columnName:t,className:"nfsUser",placeholderText:this.i18n("nfs_user_example"),renderer:function(e){return e&&e.nfsName?e.nfsName:""}},{columnName:this.i18n("user_or_group"),className:"userOrGroup"}]},insertTableRow:function(e,t){e instanceof Backbone.Model&&(e=e.attributes),t=void 0!==t&&t;var i=t?this.ID_TO_BE_ADDED:e[this.idAttribute],n=this.$(".n-table-row").length+1,s=!t&&e.mappingType&&e.mappingType.toUpperCase()===r.USER_MAPPING_TYPE.GROUP,a=[{value:"user",name:this.i18n("user"),selected:!s},{value:"group",name:this.i18n("group"),selected:s}];this.$(".table-data-items tbody").append(this.tmplDataRow(this.vtOptions({isNew:t,dataId:i,data:e,columns:this.columns,isActionEnabled:this.isActionEnabled,modelAttribute:this.modelAttribute,placeholderText:this.placeholderText,mappingOptions:a,rowIndex:n}))),this.$('.dropdownCell[data-id="'+n+'"]').html(this.getPriorityDropdown(n)),this.$('.dropdownCell[data-id="'+n+'"] svg').hide(),this.removeNoDataRow()},getPriorityDropdown:function(e,t){for(var i=[{className:"moveTop priorityOption is-static-value",name:this.i18n("move_top")},{className:"moveUp priorityOption is-static-value",name:this.i18n("move_up")},{className:"moveDown priorityOption is-static-value",name:this.i18n("move_down")},{className:"moveBottom priorityOption is-static-value",name:this.i18n("move_bottom")}],n="",s=0;s<i.length;s++)t&&t.indexOf(s)>=0?n+='<li>\n                <a class="'+i[s].className+'">'+i[s].name+"</a><li>":n+='<li><a class="'+i[s].className+' in-active">\n                '+i[s].name+"</a><li>";return l({options:n,rowIndex:e})},saveRow:function(e){var i=$(e.currentTarget),n=i.closest("tr"),a=parseInt(n.find("td").attr("data-id"),10),o=this.$(".n-table-row").length;if(a<o||a===o&&n.attr("data-id")!==this.ID_TO_BE_ADDED){var l=parseInt(i.closest("tr").find(".dropdownCell").attr("data-id"),10);this.dataItems[l-1].mappingType||(this.dataItems[l-1].mappingType=n.find(".userOrGroupSelect")[0].value,this.dataItems[l-1].smbName=$.trim(n.find(".smbUser")[0].value),this.dataItems[l-1].nfsName=$.trim(n.find(".nfsUser")[0].value))}else this.updateDataItems(n);var c=n.find("input"),u=c.val().trim(),d=s.validateFormValues(n);if(d&&d.length)return n.find("td").addClass("error"),void this.trigger(this.ACTION_EVENTS.ERROR,{errors:d,rule:c.attr(r.FORM_SELECTORS.VALIDATE_MODEL_ATTR)});if(u){var h=u.replace("\\","@");n.attr("data-id",h),n.removeAttr("new"),this.trigger(this.ACTION_EVENTS.SAVE,n)}else n.remove();this.resetTable(),n.find(".priority-dropdown-toggle").attr("disabled",!0),n.find(".dropdownCell svg").hide(),n.find(".priority-dropdown").removeClass("open"),n.closest("table").find(".tableRow").length>this.parent.rowCountToEnableScroll&&t.applyAntiScroll(this.$(".antiscroll-wrap"),null,180)},updateDataItems:function(e){var t={id:this.dataItems.length,smbName:$.trim(e.find(".smbUser")[0].value),nfsName:$.trim(e.find(".nfsUser")[0].value),mappingType:e.find(".userOrGroupSelect")[0].value};this.dataItemsReordered&&(t.newlyAdded=!0),this.dataItems.push(t)},addRow:function(){if(this.getRowToBeAddedElement().length)return void this.parent.showError(this.i18n("new_existing_row"));e.prototype.addRow.apply(this,arguments)},deleteRow:function(e){var t=$(e.currentTarget),i=t.closest("tr"),n=i.attr("data-id"),s=parseInt(i.find(".dropdownCell").attr("data-id"),10);this.dataItems.splice(s-1,1),i.remove(),this.renderTable(),this.trigger(this.ACTION_EVENTS.DELETE,n),this.trigger(this.ACTION_EVENTS.CHANGE_LIST)},renderTable:function(){var e=this;this.clearTable(),this.dataItems&&this.dataItems.length?_.each(this.dataItems,function(t){e.insertTableRow(t)}):this.insertNoDataRow()},onClickEditLink:function(t){e.prototype.onClickEditLink.apply(this,arguments);var i=$(t.currentTarget),n=i.closest("tr").attr("data-id"),s=this.$('tr[data-id="'+n+'"]');s.find(".priority-dropdown-toggle").attr("disabled",!1),s.find(".dropdownCell svg").show();var a=$.trim(s.find(".smbUser").val()),r=$.trim(s.find(".nfsUser").val()),o=$.trim(s.find(".userOrGroupSelect").val());s.attr("smbUser",a),s.attr("nfsUser",r),s.attr("userOrGroupSelect",o),s.find(".userOrGroupSelect").removeAttr("disabled")},onClickCancelLink:function(e){var t=$(e.currentTarget),i=t.closest("tr"),n=parseInt(t.closest("tr").find(".dropdownCell").attr("data-id"),10);this.closePriorityDropdown(i),i.find(".userOrGroupSelect").attr("disabled","disabled"),this.dataItems[n-1]&&this.dataItems[n-1].newlyAdded?(this.dataItems.splice(n-1,1),this.renderTable()):this.dataItemsReordered?(this.dataItems=this.preDataItems.slice(),this.renderTable()):(i.find(".smbUser").val(i.attr("smbUser")),i.find(".nfsUser").val(i.attr("nfsUser")),i.find(".userOrGroupSelect").val(i.attr("userOrGroupSelect")),this.resetTable(),this.trigger(this.ACTION_EVENTS.CANCEL)),this.dataItemsReordered=!1,i.find(".priority-dropdown-toggle").attr("disabled",!0),i.find(".dropdownCell svg").hide()},onClickSaveLink:function(e){var t=this.getRowFromActionLink(e),i=parseInt(t.closest("tr").find(".dropdownCell").attr("data-id"),10);this.closePriorityDropdown(t);var n=this.validateSaveAction(e);if(n)return void this.parent.showError(n);this.saveRow(e),delete this.dataItems[i-1].newlyAdded,this.dataItemsReordered=!1,t.find(".userOrGroupSelect").attr("disabled","disabled")},closePriorityDropdown:function(e){e.find(".dropdown").hasClass("open")&&e.find(".dropdown").removeClass("open")},onSelectPrority:function(e){var t=$(e.currentTarget),i=t.closest("tr"),n=i.find("input.smbUser").val(),s=i.find("input.nfsUser").val();if(this.preDataItems=this.dataItems.slice(),this.dataItemsReordered=!0,!n||!s){var a=this.validateSaveAction(e);return a&&this.parent.showError(a),void this.closePriorityDropdown(t.closest("td"))}i.attr("data-id")===this.ID_TO_BE_ADDED&&this.updateDataItems(i);var r=this.$(".n-table-row").length,o=parseInt(t.closest(".dropdownCell").attr("data-id"),10),l=void 0;l=t.find("a").hasClass("moveTop")?1:t.find("a").hasClass("moveUp")?o-1:t.find("a").hasClass("moveDown")?o+1:r;var c=this.dataItems[o-1];this.dataItems.splice(o-1,1),this.dataItems.splice(l-1,0,c),this.renderTable(),this.$('.dropdownCell[data-id="'+l+'"]').closest("tr").find(".action-links .edit").click()},onClickDropdown:function(e){e.preventDefault();var t=$(e.currentTarget);if(t.closest("tr").hasClass("edit")){var i=this.$(".n-table-row").length,n=parseInt(t.closest("td").attr("data-id"),10),s=n>1,a=n>1,r=n<i,o=n<i,l=[];s&&l.push(c.MOVE_TO_TOP),a&&l.push(c.MOVE_UP),r&&l.push(c.MOVE_DOWN),o&&l.push(c.MOVE_TO_BOTTOM);var u=this.$('.dropdownCell[data-id="'+n+'"]').find(".priority-dropdown");u.hasClass("open")?u.removeClass("open"):(this.$('.dropdownCell[data-id="'+n+'"]').html(this.getPriorityDropdown(n,l)),u=this.$('.dropdownCell[data-id="'+n+'"]').find(".priority-dropdown"),u.addClass("open"))}},validateSaveAction:function(e){var t=$(e.currentTarget).closest("tr"),n="",s=$.trim(t.find(".smbUser").val()),a=$.trim(t.find(".nfsUser").val());return n+=s?i.validateWildcardSmbUser(s):this.i18nStatic("FileServerUtil","missing_smb_user"),n+=a?i.validateWildcardNfsUser(a):this.i18nStatic("FileServerUtil","missing_nfs_user"),(s.indexOf("*")>=0&&a.indexOf("*")>=0||s.indexOf("*")<0&&a.indexOf("*")<0)&&(n+=this.i18n("invalid_wildcard")),n}})}),define("text!templates/wizards/fileserver/FSExplicitMappingPage.html",[],function(){
return'<form class="explicit-mapping-form">\n  <div class="explicitMapping">\n    <section data-ntnx-section="type-text">\n      <%= explicitMappingDesc %>\n    </section>\n    <section data-ntnx-section>\n      <div class="alert alert-info">\n        <%= mappingSuggestion %>\n      </div>\n    </section>\n    \x3c!--One to one mapping--\x3e\n    <section data-ntnx-section>\n      <h5 data-ntnx-title><%= i18n(\'one_to_one_mapping_title\') %></h5>\n      \x3c!-- One to one mapping options select--\x3e\n      <section data-ntnx-section class="oneToOneMappingOption">\n        <section data-ntnx-empty-list>\n          <section data-ntnx-section="type-subtitle">\n            <%= i18n(\'one_to_one_mapping_desc\') %>\n          </section>\n          <section data-ntnx-section>\n            <%= Components.button({\n              isPrimary: true,\n              extraClasses: \'btnAddManual\',\n              text: i18n(\'btn_add_manually\')\n            }) %>\n            <span class="or-desc"><%= i18n(\'or\') %></span>\n            <%= Components.button({\n              isPrimary: true,\n              id: "csvFile",\n              extraClasses: \'btnCSVOption\',\n              text: i18n(\'btn_upload_csv\')\n            }) %>\n          </section>\n        </section>\n      </section>\n\n      \x3c!-- Add one to one mappnig manually --\x3e\n      <div class="oneToOneMappingManual hidden">\n      </div>\n\n      <section data-ntnx-section class="oneToOneMappingCSV hidden">\n        <section data-ntnx-empty-list class="csvWrapper">\n        </section>\n        <div class="warningWrapper hidden">\n        </div>\n        <section data-ntnx-section="type-text">\n          <%= i18n(\'go_back_manual_link\') %>\n        </section>\n      </section>\n    </section>\n\n    \x3c!--wild card mapping--\x3e\n    <section data-ntnx-section="type-separator">\n      <h5 data-ntnx-title><%= i18n(\'wildcard_mapping_title\') %></h5>\n      \x3c!--wild card mapping option--\x3e\n      <section data-ntnx-section class="wildcardMappingOption">\n        <section data-ntnx-empty-list>\n            <section data-ntnx-section="type-subtitle">\n              <%= i18n(\'wildcard_mapping_desc\') %>\n            </section>\n            <section data-ntnx-section><%= Components.button({\n                isPrimary: true,\n                extraClasses: \'btnAddWildcard\',\n                text: i18n(\'btn_wildcard_mapping\')\n              }) %>\n            </section>\n        </section>\n      </section>\n\n      <div class="wildcardMappingTable wild-card-table hidden">\n      </div>\n    </section>\n\n    \x3c!--Deny access--\x3e\n    <section data-ntnx-section="type-separator">\n      <h5 data-ntnx-title><%= i18n(\'deny_access_title\') %></h5>\n      <section data-ntnx-section="type-text">\n        <%= i18n(\'deny_access_desc\') %>\n      </section>\n      <section data-ntnx-section class="addDeniedLink">\n        <a class="addDeniedUsers add-link">\n        <%= Components.icon(\'plus\', \'-small -inline\') %>\n        <span class="btn-content"><%= i18n(\'add_denied_users\') %>\n        </span></a>\n        <%= i18n(\'add_denied_users_comment\') %>\n      </section>\n      <section data-ntnx-section class="addDeniedForm hidden">\n        <h5 data-ntnx-title><%= i18n(\'deny_access_notice\') %></h5>\n        <section data-ntnx-section>\n          <label data-ntnx-label class="mapping-label">\n            <%= i18n(\'deny_smb_users\') %></label>\n          <input class="deniedSMBUsers" placeholder="<%= i18n(\'smb_user_example\') %>" type="text">\n        </section>\n        <section data-ntnx-section>\n          <label data-ntnx-label class="mapping-label">\n            <%= i18n(\'deny_smb_groups\') %></label>\n          <input class="deniedSMBGroups" placeholder="<%= i18n(\'smb_user_example\') %>" type="text">\n        </section>\n        <section data-ntnx-section>\n          <label data-ntnx-label class="mapping-label">\n            <%= i18n(\'deny_nfs_users\') %>\n          </label>\n          <input class="deniedNFSUsers" placeholder="<%= i18n(\'nfs_user_example\') %>" type="text">\n        </section>\n        \x3c!-- changes are for ENG-196161 --\x3e\n        \x3c!-- <section data-ntnx-section>\n          <label data-ntnx-label class="mapping-label">\n            <%= i18n(\'deny_nfs_groups\') %>\n          </label>\n          <input class="deniedNFSGroups" placeholder="<%= i18n(\'nfs_user_example\') %>" type="text">\n        </section> --\x3e\n      </section>\n    </section>\n  </div>\n</form>'}),define("views/wizards/fileserver/FSExplicitMappingPage",["views/basecomponents/wizards/BaseWizardPage","views/popups/fileserver/FSUserOneToOneMappingTableInputView","views/popups/fileserver/FSWildcardMappingTableInputView","utils/AppConstants","utils/CommonTemplates","utils/DataExportUtil","utils/FileServerUtil","text!templates/basecomponents/dropdowns/default.html","text!templates/wizards/fileserver/FSExplicitMappingPage.html"],function(e,t,i,n,s,a,r,o,l){"use strict";var c={GROUP:"Group",USER:"User"};return e.extend({name:"FSExplicitMappingPage",events:{"click      .btnAddManual, .btnAddWildcard":"showInputTable","click      .btnCSVOption, .uploadCSVLink":"onShowUploadCSV","click      .backToManual":"backToManual","click      .addDeniedUsers":"onAddDeiniedUser","click      .btnUploadCSV":"onUploadCSV","click      .btnCancelCSV":"onCancelUploadCSV","click      .csvFormatLink":"downloadCSVTemplate","change     #csvFile":"onChangeFileInput"},template:_.template(l),dropdownTemplate:_.template(o),uploadCSVTemplate:_.template("\n        <section data-ntnx-section=\"type-subtitle\" class=\"description\">\n          <%= i18n('upload_csv_desc')%>\n          <a class=\"csvFormatLink csv-format-link\">\n          <%= i18n('view_csv_req')%></a>\n        </section>\n        <section class=\"inputTypeWrapper\" data-id=\"fromFileUpload\">\n          <section data-ntnx-section>\n            <%= Components.fileInput({\n              btnText: i18n('upload_text'),\n              id: \"csvFile\",\n              classes: 'uploadItem',\n              variants: '-inline-flex'\n            }) %>\n          </section>\n          <section data-ntnx-section>\n            <%= Components.button({\n              text: i18n('cancel'),\n              extraClasses: 'btnCancelCSV'\n            }) %>\n            <%= Components.button({\n              isPrimary: true,\n              text: i18n('upload'),\n              extraClasses: 'btnUploadCSV',\n              disabled: true\n            }) %>\n          </section>\n        </section>"),csvFormatTableTemplate:_.template("\n        <section data-ntnx-section class='csv-info-line'>\n          <h4><%= i18ns(\"file_title\", fileInfo.title) %>\n          </h4>\n          <span><a class=\"uploadCSVLink\"><%= i18n('change_file')%></a></span>\n        </section>\n        <section data-ntnx-section class='csv-info-line'>\n          <span><%= i18n('file_format') %></span>\n          <span><%= i18n('correcct_format') %><span>\n        </section>\n        <section data-ntnx-section class='csv-info-line'>\n          <span><%= i18n('numer_of_rows') %></span>\n          <span><%= fileInfo.rows %></span>\n        </section>\n        "),csvMappingList:[],initialize:function(t){e.prototype.initialize.apply(this,arguments),this.userMappingModel=this.model[0],this.fsModel=this.model[1],this.rowCountToEnableScroll=4},render:function(){if(this.isViewRendered)return!0;var e=r.getNfsProtocol(this.fsModel),t=r.getMappingSuggestion(this.fsModel),i=this.template(this.vtOptions({explicitMappingDesc:this.i18ns("explicit_mapping_desc",e),mappingSuggestion:t}));if(this.$el.html(i),this.isViewRendered=!0,!this.userMappingModel.isNew()){var s=this.userMappingModel.getExplicitMappingDetail(this.userMappingModel.DP.ONE_TO_ONE_MAPPING_LIST),a=this.userMappingModel.getExplicitMappingDetail(this.userMappingModel.DP.WILD_CARD_MAPPING_LIST);s&&s.length&&(this.hasOneToOneMapping=!0,this.$(".btnAddManual").click()),a&&a.length&&(this.hasWildcardMapping=!0,this.$(".btnAddWildcard").click());var o=this.userMappingModel.getExplicitMappingDetail(this.userMappingModel.DP.DENIED_ACCESS_SMB_USERS),l=this.userMappingModel.getExplicitMappingDetail(this.userMappingModel.DP.DENIED_ACCESS_SMB_GROUPS),c=this.userMappingModel.getExplicitMappingDetail(this.userMappingModel.DP.DENIED_ACCESS_NFS_USERS);(o&&o.length||l&&l.length||c&&c.length)&&(this.$(".addDeniedUsers").click(),o&&this.$(".deniedSMBUsers").val(this.parseNameFromList(o,n.FS_PROTOCOLS.SMB)),l&&this.$(".deniedSMBGroups").val(this.parseNameFromList(l,n.FS_PROTOCOLS.SMB)),c&&this.$(".deniedNFSUsers").val(this.parseNameFromList(c,n.FS_PROTOCOLS.NFS)))}},parseNameFromList:function(e,t){var i=_.map(e,function(e){return n.FS_PROTOCOLS.NFS,e.name});return i.length>=1?i.join(","):i},getButtonLabel:function(e){return e<0?n.BUTTON.BACK:null},getOneToOneOrWildcardMappingList:function(e){var t=this,i=[],s=!0,a="wild-card-mapping-row"===e;return _.each(this.$("."+e),function(e){$(e).find(".nfsUser").val().length&&$(e).find(".smbUser").val().length||(s=!1);var r={};r[t.userMappingModel.DP.MAPPING_TYPE]=$.trim($(e).find(".userOrGroupSelect").val());var o={};o[t.userMappingModel.DP.ACTION_TYPE]=n.USER_MAPPING_ACTION_TYPE.MAP_IDENTITIES,o[t.userMappingModel.DP.MAPPING_TYPE]=$.trim($(e).find(".userOrGroupSelect").val()),o[t.userMappingModel.DP.NAME]=$.trim($(e).find(".nfsUser").val());var l={};if(l[t.userMappingModel.DP.ACTION_TYPE]=n.USER_MAPPING_ACTION_TYPE.MAP_IDENTITIES,l[t.userMappingModel.DP.MAPPING_TYPE]=$.trim($(e).find(".userOrGroupSelect").val()),l[t.userMappingModel.DP.NAME]=$.trim($(e).find(".smbUser").val()),r[t.userMappingModel.DP.NFS_MAPPING]=o,r[t.userMappingModel.DP.SMB_MAPPING]=l,a){var c=$(e).find(".smbUser").closest("td");r[t.userMappingModel.DP.PRIORITY]=c.attr("data-id")-1}i.push(r)}),s?i||!0:(this.showError(this.i18n("missing_inputs")),s)},getDeniedNames:function(e,t){var i=[],s="denied"+t+e+"s",a=$.trim(this.$("."+s)[0].value);if(a.length)return _.each(a.split(","),function(t){t=$.trim(t),t.length&&(n.FS_PROTOCOLS.NFS,i.push({actionType:n.USER_MAPPING_ACTION_TYPE.DENY_ACCESS,mappingType:e,name:t}))}),i},onPageCancel:function(){return!0},showInputTable:function(e){e.preventDefault();var t=e.currentTarget;$(t).hasClass("btnAddManual")||$(t).hasClass("backToManual")?(this.$(".oneToOneMappingOption").addClass("hidden"),this.$(".oneToOneMappingManual").removeClass("hidden"),this.addTable(t),this.hasOneToOneMapping||$("a.addOneToOneMappingLink").click()):(this.$(".wildcardMappingOption").addClass("hidden"),this.$(".wildcardMappingTable").removeClass("hidden"),this.addTable(t),this.hasWildcardMapping||$("a.addWildcardMappingLink").click())},addTable:function(e){var s=void 0,a=this.userMappingModel.getExplicitMappingDetail(this.userMappingModel.DP.ONE_TO_ONE_MAPPING_LIST),r=a&&this.getDataItemsFromList(a),o=this.userMappingModel.getExplicitMappingDetail(this.userMappingModel.DP.WILD_CARD_MAPPING_LIST),l=o&&this.getDataItemsFromList(o,!0);$(e).hasClass("btnAddManual")||$(e).hasClass("backToManual")?(s=new t({entityType:n.ENTITY_FILE_SERVER,parent:this,userMappingModel:this.userMappingModel,dataItems:r}),this.$(".oneToOneMappingManual").html(s.render().el),this.oneToOneMappingColumns=s.getResourceTableColumns()):(s=new i({entityType:n.ENTITY_FILE_SERVER,parent:this,userMappingModel:this.userMappingModel,dataItems:l}),this.$(".wildcardMappingTable").html(s.render().el))},getDataItemsFromList:function(e,t){var i=this,n=0,s=[];return _.each(e,function(e){var a=n;t&&(a=e[i.userMappingModel.DP.PRIORITY]),s.push({id:a,mappingType:e[i.userMappingModel.DP.MAPPING_TYPE],smbName:e[i.userMappingModel.DP.SMB_MAPPING][i.userMappingModel.DP.NAME],nfsName:e[i.userMappingModel.DP.NFS_MAPPING][i.userMappingModel.DP.NAME]}),n++}),s},onPageTransition:function(e){if(this.clearHeader(),this.$(".n-table-row").hasClass("edit"))return void this.showError(this.i18n("mapping_acitve"));var t={},i=this.userMappingModel.getExplicitMappingDetail(this.userMappingModel.DP.ONE_TO_ONE_MAPPING_LIST),s=void 0;if(this.getWizard().CSVFileName)s=this.csvMappingList;else if(i&&i.length>100)s=i;else if(!(s=this.getOneToOneOrWildcardMappingList("one-to-one-mapping-row")))return;s&&s.length&&(t[this.userMappingModel.DP.ONE_TO_ONE_MAPPING_LIST]=s);var a=this.getOneToOneOrWildcardMappingList("wild-card-mapping-row");if(a){t[this.userMappingModel.DP.WILD_CARD_MAPPING_LIST]=a;var r=this.getDeniedNames(c.USER,n.FS_PROTOCOLS.NFS),o=this.getDeniedNames(c.USER,n.FS_PROTOCOLS.SMB),l=this.getDeniedNames(c.GROUP,n.FS_PROTOCOLS.SMB),u="";if(u+=this.validateUser(c.USER,n.FS_PROTOCOLS.NFS,r),u+=this.validateUser(c.USER,n.FS_PROTOCOLS.SMB,o),u+=this.validateUser(c.GROUP,n.FS_PROTOCOLS.SMB,l))return void this.showError(u);r&&r.length&&(t[this.userMappingModel.DP.DENIED_ACCESS_NFS_USERS]=r),o&&o.length&&(t[this.userMappingModel.DP.DENIED_ACCESS_SMB_USERS]=o),l&&l.length&&(t[this.userMappingModel.DP.DENIED_ACCESS_SMB_GROUPS]=l),this.userMappingModel.set(this.userMappingModel.DP.EXPLICIT_MAPPING,t),e()}},validateUser:function(e,t,i){var s="";if(this.$(".form-control-error").removeClass("form-control-error"),t===n.FS_PROTOCOLS.SMB?_.find(i,function(e){var t=r.validateSmbUser(e.name);return t&&(s+=t),t}):_.find(i,function(e){var t=r.validateNfsUser(e.name);return t&&(s+=t),t}),s){var a="denied"+t+e+"s";this.$("."+a).hasClass("form-control-error")||this.$("."+a).addClass("form-control-error")}return s},onChangeFileInput:function(){this.$(".btnUploadCSV").attr("disabled")&&this.$(".btnUploadCSV").attr("disabled",!1)},downloadCSVTemplate:function(){var e=[{exportTitle:"smb name",mData:"smbUser"},{exportTitle:"nfs id",mData:"nfsUser"},{exportTitle:"user/group",mData:"userOrGroup"}];a.exportTableCSV([],e)},onShowUploadCSV:function(e){var t=this;e.preventDefault();var i=this.getOneToOneMappingList();if(this.$(".oneToOneMappingManual").is(":visible")&&i.length){var n=[];_.each(this.oneToOneMappingColumns,function(e){n.push({exportTitle:e.columnName,mData:e.className})});var s=function(){a.exportTableCSV(i,n)},r=this.i18n("confirm_csv_desc");i.length>0&&(r+=this.i18n("download_entries"));var o=3*(1500+i.length);$.nutanixConfirm({title:this.i18n("change_upload_csv"),msg:r,yes:function(){t.showUploadCSV()},class:"confirmUploadCsv -compact -red-confirm",yesText:this.i18n("delete_manual_mapping"),noText:this.i18n("cancel"),timeoutPeriod:o}),$(".confirmUploadCsv .downloadEntries").on("click",s)}else this.$(".oneToOneMappingManual").is(":visible")&&this.$(".oneToOneMappingManual").addClass("hidden"),this.csvMappingList=[],this.$(".oneToOneMappingOption").addClass("hidden"),this.$(".oneToOneMappingCSV").removeClass("hidden"),this.$(".csvWrapper").empty().html(this.uploadCSVTemplate(this.vtOptions()))},showUploadCSV:function(){this.csvMappingList=[],this.$(".oneToOneMappingManual").addClass("hidden"),this.$(".oneToOneMappingCSV").removeClass("hidden"),this.$(".csvWrapper").empty().html(this.uploadCSVTemplate(this.vtOptions()))},getOneToOneMappingList:function(){var e=[],t=!0;return _.each(this.$(".one-to-one-mapping-row"),function(i){$(i).find(".nfsUser").val().length&&$(i).find(".smbUser").val().length||(t=!1);var n={};n.smbUser=$(i).find(".smbUser").val(),n.nfsUser=$(i).find(".nfsUser").val(),n.userOrGroup=$(i).find(".userOrGroupSelect").val(),e.push(n)}),t?e||!0:(this.showError(this.i18n("missing_inputs")),t)},backToManual:function(e){var t=this;$.nutanixConfirm({title:this.i18n("change_manual"),msg:this.i18n("confirm_manual_desc"),yes:function(){t.csvMappingList=[],t.$(".oneToOneMappingCSV").addClass("hidden"),t.$(".oneToOneMappingManual").children().length?t.$(".oneToOneMappingManual").removeClass("hidden"):t.showInputTable(e)},class:"-compact -red-confirm",yesText:this.i18n("remove_uploaded_csv"),noText:this.i18n("cancel")})},onAddDeiniedUser:function(){this.$(".addDeniedLink").addClass("hidden"),this.$(".addDeniedForm").removeClass("hidden")},onUploadCSV:function(e){e.preventDefault(),this.clearHeader();var t=this.$("#csvFile")[0].files[0];if(!t)return void this.showError(this.i18n("miss_csv_file"));this.parseCSV(t)},onCancelUploadCSV:function(e){e.preventDefault(),this.enableNextButton(),this.$(".oneToOneMappingCSV").addClass("hidden"),this.$(".oneToOneMappingOption").removeClass("hidden")},afterUploadFile:function(e){var t=this;this.enableNextButton(),this.$(".csvWrapper").empty().html(this.csvFormatTableTemplate(this.vtOptions({fileInfo:e})));var i=s.INFO({msg:this.i18n("csv_validate_info")});this.$(".warningWrapper").removeClass("hidden").html(i),this.getWizard().CSVFileName=e.title,this.csvMappingList=_.map(e.lines,function(e){var i=e.split(","),s=$.trim(i[2].replace(/"/g,"").toUpperCase()),a={};a[t.userMappingModel.DP.MAPPING_TYPE]=s;var r={};r[t.userMappingModel.DP.ACTION_TYPE]=n.USER_MAPPING_ACTION_TYPE.MAP_IDENTITIES,r[t.userMappingModel.DP.MAPPING_TYPE]=s,r[t.userMappingModel.DP.NAME]=$.trim(i[1].replace(/"/g,""));var o={};return o[t.userMappingModel.DP.ACTION_TYPE]=n.USER_MAPPING_ACTION_TYPE.MAP_IDENTITIES,o[t.userMappingModel.DP.MAPPING_TYPE]=s,o[t.userMappingModel.DP.NAME]=$.trim(i[0].replace(/"/g,"")),a[t.userMappingModel.DP.NFS_MAPPING]=r,a[t.userMappingModel.DP.SMB_MAPPING]=o,a})},parseCSV:function(e){var t=this;this.clearHeader();var i=new FileReader;i.onload=function(e){var i=e.target.result.split(/\r\n|\n/);i.shift(),i=_.filter(i,function(e){return 3===e.split(",").length});var n=t.validateCSVFile(i);if(n.isValid){var s={};s.title=t.$(".filename")[0].title,s.rows=i.length,s.lines=i,t.afterUploadFile(s)}else t.showError(t.i18ns("invalid_file",n.lineNumber))},i.readAsText(e)},isTypeCorrect:function(e){return e!==n.USER_MAPPING_TYPE.USER&&e!==n.USER_MAPPING_TYPE.GROUP},isSmbUserCorrect:function(e){return!e||r.validateSmbUser(e)},isNfsUserCorrect:function(e){return!e||r.validateNfsUser(e)},validateCSVFile:function(e){var t=this,i=!0,n=[];return!(e.length<1)&&(_.each(e,function(e,s){var a=e.split(",");3!==e.split(",").length&&(i=!1);var o=a[0].replace(/"/g,""),l=a[1].replace(/"/g,""),c=a[2].replace(/"/g,"").toUpperCase();(t.isTypeCorrect(c)||t.isSmbUserCorrect(o)||t.isNfsUserCorrect(l))&&(i=!1,n.push(s+2)),o&&!r.validateSmbUser(o)||(i=!1),l&&!r.validateNfsUser(l)||(i=!1)}),{isValid:i,lineNumber:n})}})}),define("text!templates/wizards/fileserver/FSDefaultMappingPage.html",[],function(){return'<form class="default-mapping-form">\n  <section data-ntnx-section>\n    <div class="alert alert-info">\n      <%= mappingSuggestion %>\n    </div>\n  </section>\n  <section data-ntnx-section>\n    <h5 data-ntnx-title><%= i18n(\'no_mapping_found_title\') %></h5>\n    <p data-ntnx-section="type-text">\n      <%= i18n(\'no_mapping_found_desc\') %>\n    </p>\n\n    <section data-ntnx-section>\n      <label data-ntnx-label class="mapping-label">\n        <%= i18n(\'smb_user_no_nfs\') %>\n      </label>\n      <%= Components.select({\n        id: \'smbUserNoNFSSelect\',\n        jsClasses: \'noMappingSelect\',\n        options: smbUserNoNFSOptions,\n        useBrowserSelect: true\n      }) %>\n    </section>\n    <div class="n-clearfix">\n      <section data-ntnx-section="type-half">\n        <label data-ntnx-label class="mapping-label">\n          <% if (ldapDetails !== null) { %>\n            <%= i18n(\'unix_username\') %>\n          <% } else { %>\n            <%= i18n(\'unix_uid\') %>\n          <% } %>\n        </label>\n        <input type="text" class="nfsUserInput"\n          placeholder="<%= placeholder %>"\n          model-attribute="unixUID"\n          model-validate="isNumber"\n          value="<%= uid || uid === 0 ? uid : \'\' %>"\n          model-attribute-name="Unix Uid" <%= disableSmb ? \'disabled\' : \'\' %>>\n      </section>\n      <section data-ntnx-section="type-half">\n        <label data-ntnx-label class="mapping-label">\n          <% if (ldapDetails !== null) { %>\n            <%= i18n(\'unix_groupname\') %>\n          <% } else { %>\n            <%= i18n(\'unix_gid\') %>\n          <% } %>\n        </label>\n        <input type="text" class="nfsGroupInput"\n          placeholder="<%= placeholder %>"\n          model-attribute="unixGID"\n          model-validate="isNumber"\n          value="<%= gid || gid === 0 ? gid : \'\' %>"\n          model-attribute-name="Unix Gid" <%= disableSmb ? \'disabled\' : \'\' %>>\n      </section>\n    </div>\n\n    <section data-ntnx-section>\n      <label data-ntnx-label class="mapping-label">\n        <%= i18n(\'nfs_user_no_smb\') %>\n      </label>\n      <%= Components.select({\n        id: \'nfsUserNoSMBSelect\',\n        jsClasses: \'noMappingSelect\',\n        options: nfsUserNoSMBOptions,\n        useBrowserSelect: true\n      }) %>\n    </section>\n    <div class="n-clearfix">\n      <section data-ntnx-section="type-half">\n        <label data-ntnx-label class="mapping-label">\n          <%= i18n(\'smb_user\') %>\n        </label>\n        <input type="text" class="smbUserInput"\n          placeholder="<%= i18n(\'eg_smb\') %>"\n          value="<%= adUserName ? adUserName: \'\' %>"\n          <%= disableNfs ? \'disabled\' : \'\' %>>\n      </section>\n      <section data-ntnx-section="type-half">\n        <label data-ntnx-label class="mapping-label">\n          <%= i18n(\'smb_group\') %>\n        </label>\n        <input type="text" class="smbGroupInput"\n          placeholder="<%= i18n(\'eg_smb\') %>"\n          value="<%= adGroupName ? adGroupName: \'\' %>"\n          <%= disableNfs ? \'disabled\' : \'\' %>>\n      </section>\n    </div>\n  </section>\n</form>'}),define("views/wizards/fileserver/FSDefaultMappingPage",["views/basecomponents/wizards/BaseWizardPage","models/fileserver/UserMappingModel","managers/I18nManager","utils/AppConstants","utils/FileServerUtil","utils/ValidationUtil","text!templates/wizards/fileserver/FSDefaultMappingPage.html"],function(e,t,i,n,s,a,r){"use strict";var o=[{value:n.USER_MAPPING_ACTION_TYPE.MAP_IDENTITIES,name:i.t("FSDefaultMappingPage","map_unix_uid")},{value:n.USER_MAPPING_ACTION_TYPE.DENY_ACCESS,name:i.t("FSDefaultMappingPage","deny_access_to_nfs")}],l=[{value:n.USER_MAPPING_ACTION_TYPE.MAP_IDENTITIES,name:i.t("FSDefaultMappingPage","map_ad_user")},{value:n.USER_MAPPING_ACTION_TYPE.DENY_ACCESS,name:i.t("FSDefaultMappingPage","deny_access_to_smb")}];return e.extend({name:"FSDefaultMappingPage",events:{"change    .noMappingSelect":"onChangeNoMappingSelect"},template:_.template(r),initialize:function(i){e.prototype.initialize.apply(this,arguments),this.model?(this.userMappingModel=this.model[0],this.fsModel=this.model[1]):this.userMappingModel=new t},render:function(){if(!this.isViewRendered){this.isViewRendered=!0;var e=void 0,t=void 0;this.ldapDetails=this.fsModel.getServerIP();var i=[o,l];_.each(i,function(e){_.each(e,function(e){e.selected=!1})});var a=this.fsModel.getServerIP()?this.i18n("eg_name"):this.i18n("eg_id"),r=s.getMappingSuggestion(this.fsModel);this.userMappingModel.isNew()||(e=this.getExistingNoMappingConfigs(n.FS_PROTOCOLS.SMB),t=this.getExistingNoMappingConfigs(n.FS_PROTOCOLS.NFS));var c=this.template(this.vtOptions({smbUserNoNFSOptions:o,nfsUserNoSMBOptions:l,uid:e&&e[0],gid:e&&e[1],adUserName:t&&t[0],adGroupName:t&&t[1],placeholder:a,disableSmb:o[1].selected,disableNfs:l[1].selected,mappingSuggestion:r,ldapDetails:this.ldapDetails}));this.$el.html(c)}},getExistingNoMappingConfigs:function(e){var t=this,i=e===n.FS_PROTOCOLS.SMB?this.userMappingModel.getRuleBasedMappingDetail(this.userMappingModel.DP.SMB_WITH_NO_MAPPINGS):this.userMappingModel.getRuleBasedMappingDetail(this.userMappingModel.DP.NFS_WITH_NO_MAPPINGS),a=_.find(i,function(e){return e[t.userMappingModel.DP.MAPPING_TYPE]===n.USER_MAPPING_TYPE.USER}),r=_.find(i,function(e){return e[t.userMappingModel.DP.MAPPING_TYPE]===n.USER_MAPPING_TYPE.GROUP}),c=e===n.FS_PROTOCOLS.SMB?o:l,u=void 0,d=void 0;if(a){a[this.userMappingModel.DP.ACTION_TYPE]===n.USER_MAPPING_ACTION_TYPE.DENY_ACCESS?c[1].selected=!0:(c[0].selected=!0,u=a[this.userMappingModel.DP.UID],e!==n.FS_PROTOCOLS.NFS&&s.getNfsProtocol(this.fsModel)!==n.NFS_PROTOCOL_TYPE.LDAP||(u=a[this.userMappingModel.DP.NAME]),d=r[this.userMappingModel.DP.GID],e!==n.FS_PROTOCOLS.NFS&&s.getNfsProtocol(this.fsModel)!==n.NFS_PROTOCOL_TYPE.LDAP||(d=r[this.userMappingModel.DP.NAME]))}return[u,d]},getNoMappingOptionsInputs:function(e){var t=[],i={},a={},r=e.toLowerCase(),o=e===n.FS_PROTOCOLS.SMB?n.FS_PROTOCOLS.NFS:n.FS_PROTOCOLS.SMB,l=this.$("#"+r+"UserNo"+o+"Select")[0];if(i[this.userMappingModel.DP.ACTION_TYPE]=l.value,i[this.userMappingModel.DP.MAPPING_TYPE]=n.USER_MAPPING_TYPE.USER,a[this.userMappingModel.DP.ACTION_TYPE]=l.value,a[this.userMappingModel.DP.MAPPING_TYPE]=n.USER_MAPPING_TYPE.GROUP,l.value!==n.USER_MAPPING_ACTION_TYPE.DENY_ACCESS){var c=$.trim(this.$("."+o.toLowerCase()+"UserInput")[0].value);if(!c.length)return this.$("."+o.toLowerCase()+"UserInput").addClass("form-control-error"),void this.showError(this.i18n("missing_ad_user"));var u=this.validtateUserName(o,c);if(u)return this.showError(u),void this.$("."+o.toLowerCase()+"UserInput").addClass("form-control-error");var d=$.trim(this.$("."+o.toLowerCase()+"GroupInput")[0].value);if(!d.length)return this.$("."+o.toLowerCase()+"GroupInput").addClass("form-control-error"),void this.showError(this.i18n("missing_ad_group"));var h=this.validtateUserName(o,d);if(h)return this.showError(h),void this.$("."+o.toLowerCase()+"GroupInput").addClass("form-control-error");var p=this.userMappingModel.DP.UID;s.getNfsProtocol(this.fsModel)!==n.NFS_PROTOCOL_TYPE.LDAP&&e!==n.FS_PROTOCOLS.NFS||(p=this.userMappingModel.DP.NAME);var _=$.trim(this.$("."+o.toLowerCase()+"UserInput")[0].value);i[p]=_;var T=this.userMappingModel.DP.GID;s.getNfsProtocol(this.fsModel)!==n.NFS_PROTOCOL_TYPE.LDAP&&e!==n.FS_PROTOCOLS.NFS||(T=this.userMappingModel.DP.NAME);var E=$.trim(this.$("."+o.toLowerCase()+"GroupInput")[0].value);a[T]=E}return t.push(i),t.push(a),t},validtateUserName:function(e,t){var i="";return e===n.FS_PROTOCOLS.SMB?i+=s.validateSmbUser(t):this.fsModel.getServerIP()?i+=s.validateNfsUser(t):i+=a.isNumber(t)&&a.isNumber(t).message,i},getButtonLabel:function(e){return e<0?n.BUTTON.BACK:null},onPageTransition:function(e){var t=this.getNoMappingOptionsInputs(n.FS_PROTOCOLS.NFS),i=this.getNoMappingOptionsInputs(n.FS_PROTOCOLS.SMB);if(t&&i){var s=this.userMappingModel.getRuleBasedMapping();s[this.userMappingModel.DP.NFS_WITH_NO_MAPPINGS]=t,s[this.userMappingModel.DP.SMB_WITH_NO_MAPPINGS]=i,this.userMappingModel.set(this.userMappingModel.DP.RULE_BASED_MAPPING,s),e()}},onPageCancel:function(){return!0},canEnablePageLink:function(){return!1},onChangeNoMappingSelect:function(e){var t=$(e.currentTarget)[0].id,i=$(e.currentTarget)[0].value,s=i===n.USER_MAPPING_ACTION_TYPE.DENY_ACCESS;"smbUserNoNFSSelect"===t?(this.$(".nfsUserInput").attr("disabled",s),this.$(".nfsGroupInput").attr("disabled",s)):"nfsUserNoSMBSelect"===t&&(this.$(".smbUserInput").attr("disabled",s),this.$(".smbGroupInput").attr("disabled",s))}})}),define("text!templates/wizards/fileserver/FSUserMappingSummaryPage.html",[],function(){return'<div class="userMappingSummary">\n  <section data-ntnx-section class="mappingSummaryPage">\n    <h5 data-ntnx-title><%= i18n(\'summary_title\') %></h5>\n    <p data-ntnx-section="type-text"><%= i18n(\'summary_desc\') %></p>\n    <section data-ntnx-section>\n      <ul data-ntnx-ul class="userMappingInfoList">\n      </ul>\n    </section>\n  </section>\n  <section data-ntnx-section class="taskStatusPage hidden">\n    <div class="validationWrapper">\n      <h5 data-ntnx-title>\n        <%= i18n(\'task_running\') %>\n        <span class="spinit donut-loader-blue"></span>\n      </h5>\n      <p data-ntnx-section="type-text" class="closePopup">\n        <%= i18n(\'close_popup_option\') %>\n      </p>\n    </div>\n    <section data-ntnx-section>\n      <div class="radio-flex-container">\n        <div data-ntnx-form-inline>\n          <%= Components.radio({\n            jsClasses: \'smbMapping mappingRadio\',\n            disabled: true,\n            id: \'smbMappingSummary\',\n            labelText: i18n(\'smb_to_nfs_mapping\')\n          }) %>\n        </div>\n        <div data-ntnx-form-inline>\n          <%= Components.radio({\n            jsClasses: \'nfsMapping mappingRadio\',\n            disabled: true,\n            id: \'nfsMappingSummary\',\n            labelText: i18n(\'nfs_to_smb_mapping\')\n          }) %>\n        </div>\n      </div>\n    </section>\n    <section data-ntnx-section>\n      <div class="n-search-wrapper">\n        <div class="n-search-container">\n          <%= Components.select({\n            options: mappingOptions,\n            jsClasses: \'userOrGroupSelect user-or-group-select\',\n            variants: \'bottom-anchor\',\n            useBrowserSelect: true\n          }) %>\n          <i aria-hidden="true" data-icon="B" class="n-icon-serach"></i>\n          <input class="searchInput n-search" type="text">\n        </div>\n        <div class="serach-btn-wrapper">\n          <%= Components.button({\n            extraClasses: \'btnSearch\',\n            text: i18n(\'search\')\n          }) %>\n        </div>\n      </div>\n    </section>\n    <section data-ntnx-section>\n      <div class="searchresult"></div>\n    </section>\n  </section>\n</div>\n'}),define("views/wizards/fileserver/FSUserMappingSummaryPage",["views/basecomponents/wizards/BaseWizardPage","models/task/TaskCollection","text!templates/wizards/fileserver/FSUserMappingSummaryPage.html","data/DataProperties","utils/AppConstants","utils/AppUtil","utils/FilterUtil","utils/FileServerUtil","managers/I18nManager","components/Components","managers/TaskManager"],function(e,t,i,n,s,a,r,o,l,c,u){"use strict";return e.extend({name:"FSUserMappingSummaryPage",template:_.template(i),ruleNameMappings:{SMB_NAME_NFS_NAME:l.t("FSUserMappingSummaryPage","sam_match_username"),NO_TEMPLATE_MAPPING:l.t("FSUserMappingSummaryPage","no_default_mapping_rule")},events:{"click .mappingRadio":"onClickMappingRadio","click .btnSearch":"onClickBtnSearch"},initialize:function(t){e.prototype.initialize.apply(this,arguments),this.userMappingModel=this.model[0],this.fsModel=this.model[1]},render:function(){var e=[{value:"user",name:this.i18n("user")},{value:"group",name:this.i18n("group")}],t=this.template(this.vtOptions({mappingOptions:e})),i=this.getUserMappingInfo(),n=this.getWizard().CSVFileName;this.$el.html(t),this.$(".smbMapping").prop("checked",!0),this.$(".smbMapping, .nfsMapping").attr("disabled",!0),this.$(".n-search").attr("disabled",!0),this.$(".btnSearch").attr("disabled",!0);var a=o.getActiveTask(s.TASK_FILE_SERVER_USER_MAPPING);if(a)return this.renderTaskPage(!1),void this.pollTaskUuid(a);var r=this.$(".userMappingInfoList");i.deniedSMBUsersAndGroupsNum&&r.append("\n            <li>"+this.i18ns("smb_users_groups_denied_access_desc",i.deniedSMBUsersAndGroupsNum)+"</li>"),i.deniedNFSUsersAndGroupsNum&&r.append("\n            <li>"+this.i18ns("nfs_users_groups_denied_access_desc",i.deniedNFSUsersAndGroupsNum)+"</li>"),i.oneToOneMappingListNum&&r.append("<li>"+this.i18ns(n?"one_to_one_mapping_csv":"one_to_one_mapping",i.oneToOneMappingListNum)+"</li>"),i.wildcardMappingListNum&&r.append("<li>"+this.i18ns("wild_card_mapping",i.wildcardMappingListNum)+"</li>"),i.defaultRule&&r.append("<li>"+this.i18ns("default_rule",this.ruleNameMappings[i.defaultRule]||this.i18n("not_selected"))+"</li>");var l=this.i18n("no_mapping_found");l+=this.populateNoMappingInfo(i.smbWithNoMappings,s.FS_PROTOCOLS.SMB),l+=this.populateNoMappingInfo(i.nfsWithNoMappings,s.FS_PROTOCOLS.NFS),r.append("<li>"+l+".</li>")},populateNoMappingInfo:function(e,t){var i=this,n="",a=o.getNfsProtocol(this.fsModel)===s.NFS_PROTOCOL_TYPE.LDAP,r=a?this.i18ns("name"):this.i18ns("id");return _.each(e,function(e){
e[i.userMappingModel.DP.MAPPING_TYPE]===s.USER_MAPPING_TYPE.USER?e[i.userMappingModel.DP.ACTION_TYPE]===s.USER_MAPPING_ACTION_TYPE.DENY_ACCESS?n+=", "+i.i18ns("no_mapping_deny_users",t===s.FS_PROTOCOLS.SMB?s.FS_PROTOCOLS.SMB:s.FS_PROTOCOLS.NFS):n+=t===s.FS_PROTOCOLS.SMB?", "+i.i18ns("no_mapping_map_smb_users",r,e[a?i.userMappingModel.DP.NAME:i.userMappingModel.DP.UID]):", "+i.i18ns("no_mapping_map_nfs_users",e[i.userMappingModel.DP.NAME]):e[i.userMappingModel.DP.ACTION_TYPE]===s.USER_MAPPING_ACTION_TYPE.DENY_ACCESS?n+=", "+i.i18ns("no_mapping_deny_groups",t===s.FS_PROTOCOLS.SMB?s.FS_PROTOCOLS.SMB:s.FS_PROTOCOLS.NFS):n+=t===s.FS_PROTOCOLS.SMB?", "+i.i18ns("no_mapping_map_smb_groups",r,e[a?i.userMappingModel.DP.NAME:i.userMappingModel.DP.GID]):", "+i.i18ns("no_mapping_map_nfs_groups",e[i.userMappingModel.DP.NAME])}),n},getUserMappingInfo:function(){var e={},t=this.userMappingModel.getExplicitMappingDetail(this.userMappingModel.DP.DENIED_ACCESS_SMB_USERS)?this.userMappingModel.getExplicitMappingDetail(this.userMappingModel.DP.DENIED_ACCESS_SMB_USERS).length:0,i=this.userMappingModel.getExplicitMappingDetail(this.userMappingModel.DP.DENIED_ACCESS_SMB_GROUPS)?this.userMappingModel.getExplicitMappingDetail(this.userMappingModel.DP.DENIED_ACCESS_SMB_GROUPS).length:0,n=this.userMappingModel.getExplicitMappingDetail(this.userMappingModel.DP.DENIED_ACCESS_NFS_USERS)?this.userMappingModel.getExplicitMappingDetail(this.userMappingModel.DP.DENIED_ACCESS_NFS_USERS).length:0,s=this.userMappingModel.getExplicitMappingDetail(this.userMappingModel.DP.DENIED_ACCESS_NFS_GROUPS)?this.userMappingModel.getExplicitMappingDetail(this.userMappingModel.DP.DENIED_ACCESS_NFS_GROUPS).length:0,a=this.userMappingModel.getExplicitMappingDetail(this.userMappingModel.DP.ONE_TO_ONE_MAPPING_LIST)?this.userMappingModel.getExplicitMappingDetail(this.userMappingModel.DP.ONE_TO_ONE_MAPPING_LIST).length:0,r=this.userMappingModel.getExplicitMappingDetail(this.userMappingModel.DP.WILD_CARD_MAPPING_LIST)?this.userMappingModel.getExplicitMappingDetail(this.userMappingModel.DP.WILD_CARD_MAPPING_LIST).length:0,o=this.userMappingModel.getRuleBasedMappingDetail(this.userMappingModel.DP.TEMPLATE_MAPPING),l=this.userMappingModel.getRuleBasedMappingDetail(this.userMappingModel.DP.NFS_WITH_NO_MAPPINGS),c=this.userMappingModel.getRuleBasedMappingDetail(this.userMappingModel.DP.SMB_WITH_NO_MAPPINGS);return 0===t&&0===i||(e.deniedSMBUsersAndGroupsNum=t+i),0===n&&0===s||(e.deniedNFSUsersAndGroupsNum=n+s),0!==a&&(e.oneToOneMappingListNum=a),0!==r&&(e.wildcardMappingListNum=r),e.defaultRule=o,l&&l.length&&(e.nfsWithNoMappings=l),c&&c.length&&(e.smbWithNoMappings=c),e},renderTaskPage:function(e){this.getWizard().CSVFileName;$(".n-modal-tabs").hide(),this.$(".mappingSummaryPage").addClass("hidden"),this.$(".taskStatusPage").removeClass("hidden"),$(".btnPrevious").addClass("hidden"),$(".btnSave").addClass("hidden"),$(".btnCancel").text(this.i18n("close")),e&&(this.$(".validationWrapper .closePopup").html(this.i18n("task_completed_text")),this.$(".validationWrapper h5").html(this.i18n("task_completed")+" "+c.icon("check","-small -success")),this.$(".smbMapping, .nfsMapping").attr("disabled",!1),this.$(".n-search").attr("disabled",!1),this.$(".btnSearch").attr("disabled",!1)),this.getWizard().reSizePopup()},pollTaskUuid:function(e){var i=this;if(!this.taskPollingInProgress){var a=t.extend({getFilterCriteriaForDiff:function(){return r.filterConditionToFIQL(n.UUID,{op:s.FILTER_OPERATORS.EQUALS,value1:e})}}),o=new a;o.intervalTimeInMilliSec=5e3,o.taskUuid=e,o.on("reset",function(e){var t=void 0;t=_.filter(e.models,function(e){return e.get(n.TASK_TYPE)===s.TASK_FILE_SERVER_USER_MAPPING}),(t=t.length?_.first(t):null)&&t.isTaskCompleted()&&(o.stopPolling(),i.taskPollingInProgress=!1,u.fetchOnDemand().done(function(){i.renderTaskPage(!0)}))}),o.startPolling(),this.taskPollingInProgress=!0}},onClickMappingRadio:_.debounce(function(e){$(e.currentTarget).hasClass("smbMapping")?this.$(".nfsMapping").prop("checked",!1):this.$(".smbMapping").prop("checked",!1)},100),onClickBtnSearch:function(){var e=this.getWizard().search(this);e&&this.$(".serachresult").html(e)},getButtonLabel:function(e){return e<0?s.BUTTON.BACK:null},onPageTransition:function(e){var t=this;this.userMappingModel.save(null,{success:function(e,i){var s=i[n.TASK_UUID];t.renderTaskPage(!1),t.pollTaskUuid(s)},error:function(e,i){a.log("FileServer: Error :"+i),t.showError(t.i18n("error_create_user_mapping")+a.processAjaxError(i.responseText))}})},canEnablePageLink:function(){return!1},onPageCancel:function(){return!0}})}),define("views/wizards/fileserver/FileServerWizard",["views/basecomponents/wizards/WizardView","views/popups/fileserver/FileServerPrerequisitePopupView","models/fileserver/FileServerModel","models/MinervaModel","models/fileserver/FileServerCollection","models/network/AcropolisNetworkCollection","models/storage/ContainerCollection","models/softwareupgrade/FileServerSoftwareUpgradeModel","models/managementserver/ManagementServerInfoCollection","models/fileserver/UserMappingModel","views/wizards/fileserver/FileServerDefinePage","views/wizards/fileserver/CloneFileServerDefinePage","views/wizards/fileserver/SnapshotFileServerDefinePage","views/wizards/fileserver/ActivateFileServerDefinePage","views/wizards/fileserver/FileServerExternalNetworkPage","views/wizards/fileserver/FileServerInternalNetworkPage","views/wizards/fileserver/FileServerICAPServersPage","views/wizards/fileserver/FileServerScanSettingsPage","views/wizards/fileserver/FileServerProtocolsPage","views/wizards/fileserver/FileServerScaleOutPage","views/wizards/fileserver/FileServerSummaryPage","views/wizards/fileserver/CloneFileServerSummaryPage","views/wizards/fileserver/FSUserMappingSearchPage","views/wizards/fileserver/FSRuleBasedMappingPage","views/wizards/fileserver/FSExplicitMappingPage","views/wizards/fileserver/FSDefaultMappingPage","views/wizards/fileserver/FSUserMappingSummaryPage","managers/PopupManager","managers/LicenseManager","managers/ActionManager","managers/I18nManager","events/AppEvents","data/DataProperties","data/DataURLConstants","utils/FileServerUtil","utils/AppUtil","utils/HypervisorUtil","utils/SubModelHelper","utils/AppConstants"],function(e,t,i,n,s,a,r,o,l,c,u,d,h,p,T,E,S,g,A,m,f,I,C,v,R,N,P,O,y,D,M,b,L,w,U,V,k,x,F){"use strict";var Y=_.template('<a class="externalPopupLink" <%= actionAttributes %>><%= title %></a>'),G=_.template('<table class="table table-data-items table-input">\n        <thead>\n          <tr>\n            <th><%= mappingFrom %></th>\n            <th><%= mappingTo %></th>\n            <th class="mappingRule">\n              '+M.t("FileServerWizard","mapping_rule")+"\n            </th>\n          </tr>\n        </thead>\n        <tbody>\n        </tbody>\n      </table>"),B=_.template('<tr class="n-table-row">\n        <td class="data-cell"><%= mappingFromReuslt %></td>\n        <td class="data-cell"><%= mappingToReuslt %></td>>\n        <td class="data-cell"><%= mappingRuleReuslt %></td>\n      </tr>'),H=_.template('<tr class="no-data">\n        <td colspan="3"><%= noData %></td>\n      </tr>'),W=M.t("FileServerWizard","tab_heading.basic"),K=M.t("FileServerWizard","tab_heading.snapshot"),z=M.t("FileServerWizard","tab_heading.client_network"),j=M.t("FileServerWizard","tab_heading.storage_network"),Q=M.t("FileServerWizard","tab_heading.icap_servers"),X=M.t("FileServerWizard","tab_heading.scan_settings"),q=M.t("FileServerWizard","tab_heading.directory_services"),J=M.t("FileServerWizard","tab_heading.configuration"),Z=M.t("FileServerWizard","tab_heading.summary"),ee=M.t("FileServerWizard","tab_heading.user_mapping_search"),te=M.t("FileServerWizard","tab_heading.rule_based_mapping"),ie=M.t("FileServerWizard","tab_heading.explicit_mapping"),ne=M.t("FileServerWizard","tab_heading.default_mapping"),se=M.t("FileServerWizard","tab_heading.summary"),ae={UUID:"uuid",NAME:"name",DOMAIN_CONFIG:"domainDirectoryDTO",DNS_ENTRIES:"dnsEntries",NAME_SERVICE_CONFIG:"nameServicesDTO",NUM_NVMS:"numCalculatedNvms",NVMS:"nvms",NUM_VCPUS_PER_VM:"numVcpus",MEM_PER_VM:"memoryGiB",INTERNAL_NETWORK:"internalNetwork",EXTERNAL_NETWORK:"externalNetworks",REALM:"windowsAdDomainName",USERNAME:"windowsAdUsername",PASSWORD:"windowsAdPassword",ADD_USER_AS_FS_ADMIN:"addUserAsFsAdmin",OVERWRITE_AD:"overwriteAd",DNS_SERVER_IP_ADDRESSES:"dnsServerIpAddresses",NTP_SERVERS:"ntpServers",FILE_SERVER_SIZE:"sizeGib",nvms:{NUM_VCPUS_PER_VM:"numVcpus",MEM_PER_VM:"memoryGiB"},SIZE:"fileserver_size_bytes",PD_STATUS:"protectionDomainState",PD_NAME:"pdName",NVM_CHANGE:"nvmChange",CPU_MEMORY_CHANGE:"cpuMemorychange",RECOMMENDATION:"recommendation",recommendation:{NUM_NVMS:"numNvms",RECOMMENDATION_TYPE:"recommendationType"},ORGANIZATIONAL_UNIT:"organizationalUnit",PREFERRED_DOMAIN_CONCTROLLER:"preferredDomainController",PROTOCOL_TYPE:"protocolType",AD_DETAILS:"adDetails",LDAP_DETAILS:"ldapDetails",DNS_OPERATIONS:"fsDnsOperationsDTO",DNS_DOMAIN_NAME:"dnsDomainName",VERSION:"version",URI:"uri",NETMASK:"subnetMask",GATEWAY:"defaultGateway",IPPOOL:"pool",OVERWRITE_USER_ACCOUNT:"overwriteUserAccount",IS_SCALEOUT:"isScaleOut"},re=null,oe=i.extend({urlRoot:w.FILE_SERVER_SEARCH_USER_MAPPINGS,entityType:F.ENTITY_USER_MAPPINGS_SEARCH,name:"FileServerSearchUserMappingsModel",fileServerUuid:null,setFileServerUuid:function(e){this.fileServerUuid=e},getValue:function(e){return e===this.nameAttribute?this.get(this.nameAttribute)||"":n.prototype.getValue.apply(this,arguments)},getURL:function(){return _.template(this.urlRoot,{uuid:this.fileServerUuid})}}),le=i.extend({entityType:F.ENTITY_FILE_SERVER,name:"FileServerActionModel",DP:ae,defaults:{name:"",numCalculatedNvms:null,numVcpus:null,memoryGiB:null,internalNetwork:null,externalNetworks:null,windowsAdDomainName:"",windowsAdUsername:"",windowsAdPassword:"",dnsServerIpAddresses:null,ntpServers:null,sizeGib:0},setFileServerUuid:function(e){this.fileServerUuid=e},getURL:function(e){return this.actionMode&&this.actionMode===F.ACTION_ACTIVATE_FILE_SERVER?_.template(w.FILE_SERVER_ACTIVATE,{uuid:this.fileServerUuid}):this.actionMode&&this.actionMode===F.ACTION_REBALANCE?_.template(w.FILE_SERVER_REBALANCE,{uuid:this.fileServerUuid}):!this.actionMode||this.actionMode!==F.ACTION_CLONE&&this.actionMode!==F.ACTION_FILE_SERVER_CLONE?i.prototype.getURL.apply(this,arguments):_.template(w.FILE_SERVER_CLONE,{uuid:this.fileServerUuid})}},{DP:ae});return e.extend({name:"FileServerWizard",model:null,userMappingModel:null,initialize:function(t){e.prototype.initialize.apply(this,arguments),this.addExtraEvents({"click .externalPopupLink":"onExternalPopupLinkClick","click .removeUserMapping":"onRemoveUserMappingClick"}),_.bindAll(this,"externalPopupSaved","showClusterInfo","externalPopupCanceled"),b.onAppEvent(b.SHOW_PRE_CHECK_NOTIFICATION,this.externalPopupSaved),b.onAppEventOnce(b.CANCEL_PRE_CHECK_NOTIFICATION,this.externalPopupCanceled),this.$el.addClass("wizard-view-disable-nav-tabs")},show:function(e){if(e.action===F.ACTION_PROTECT)return void O.handleAction({action:F.ACTION_PROTECT,actionTarget:F.ENTITY_FILE_SERVER,actionTargetId:e.actionTargetId,actionTargetName:e.actionTargetName});if(e.action===F.ACTION_ANTIVIRUS_SETUP)return void this.fetchFileServer(e);if(e.action===F.ACTION_UPDATE)return void this.showFileServerUpdatePopup(e);if(e.action===F.ACTION_ADD_USER_MAPPING)return void this.fetchUserMapping(e);V.showLoader();var t=this;if(this.fileServers=new s,this.networks=new a,this.networks.useUhura(!0),e.action===F.ACTION_UPDATE_NETWORK||e.action===F.ACTION_UPDATE_NVM||e.action===F.ACTION_SCALE_OUT)return void this.fetchNetworks(e);this.model=new le,this.subModelHelper=new x,this.numberOfPendingFetches=0,this.clusterModel=this.model.clusterManager.getCurrentClusterModel(),this.fsModel=new o,e.action!==F.ACTION_ACTIVATE_FILE_SERVER&&(this.fsModel.on("change.softwareReleases",function(){t.numberOfPendingFetches--,t.checkFSCreationPrerequisite(e)}),this.numberOfPendingFetches++,this.fsModel.fetchSoftwareReleases()),this.containers=new r,this.numberOfPendingFetches++,this.containers.fetch({success:function(){t.numberOfPendingFetches--,t.checkFSCreationPrerequisite(e)},error:function(i){t.numberOfPendingFetches--,t.checkFSCreationPrerequisite(e),t.showHeaderError(t.i18n("error.container_fetch")),t.$(".btnNext").hide()}}),this.numberOfPendingFetches++,this.networks.fetch({success:function(){t.numberOfPendingFetches--,t.checkFSCreationPrerequisite(e)},error:function(i){t.numberOfPendingFetches--,t.checkFSCreationPrerequisite(e),t.showHeaderError(t.i18n("error.network_fetch")),t.$(".btnNext").hide()}}),k.hasESX()&&(this.managementServerInfo=new l,this.numberOfPendingFetches++,this.managementServerInfo.fetch({success:function(i,n){t.numberOfPendingFetches--,t.checkFSCreationPrerequisite(e)},error:function(i,n){t.numberOfPendingFetches--,t.checkFSCreationPrerequisite(e),t.showHeaderError(t.i18n("error.network_fetch")),t.$(".btnNext").hide()}})),this.numberOfPendingFetches++,this.fileServers.fetch({success:function(){t.numberOfPendingFetches--,t.checkFSCreationPrerequisite(e)},error:function(i){t.numberOfPendingFetches--,t.checkFSCreationPrerequisite(e),t.showHeaderError(t.i18n("error.fileserver_ferch")),t.$(".btnNext").hide()}})},checkFSCreationPrerequisite:function(e){if(0===this.numberOfPendingFetches){k.hasESX()&&(this.networks.models=_.filter(this.networks.models,function(e){return e.get(e.DP.NETWORK_TYPE)&&"external"===e.get(e.DP.NETWORK_TYPE)},this));var t=this.networks.models&&this.networks.models.length>=1,i=0;_.each(this.fileServers.models,function(e){(e.get(e.DP.VERSION)&&e.get(e.DP.PD_STATUS)||!1===e.get(e.DP.PD_STATUS)&&!e.get(e.DP.VERSION))&&i++});var n=this.fsModel.get(L.UPGRADE_SOFTWARE_RELEASES),s=this.clusterModel.get(L.VERSION),a=void 0,r=n&&n.find(function(e){var t=e.get(L.UPGRADE_COMPATIBLE_NOS_VERSIONS),i=e.get(L.UPGRADE_COMPATIBLE_VERSIONS),n=e.get(L.TASK_STATUS)===F.UPGRADE_SOFTWARE_RELEASE_STATUS.COMPLETED,r=void 0;return n&&(a=e.get(L.VERSION),r=_.some(i,function(e){return 0===V.compareVersions(e,a)})),(_.some(t,function(e){return 0===V.compareVersions(e,s)})||r)&&n}),o=!!r;this.downloadedModelVersion=r&&r.get(F.FILE_SERVER_VERSION);var l=!1;if(a){var c=this.clusterManager.getCurrentClusterModel().get(L.CLUSTER_NUM_NODES),u=V.compareVersions(a,F.FILE_SERVER_VERSIONS.THREE_DOT_ONE)<0;c<3&&u&&(o=!1,l=!0)}var d=this.model.clusterManager.getCurrentClusterModel(),h=d.get(L.CLUSTER_EXTERNAL_DATA_SERVICES),p=this.hasNutanixManagementShareContainerExists(),T=!0;k.hasESX()&&!this.isClusterRegisteredToVcenter()&&(T=!1),h=!!h,e.action===F.ACTION_ACTIVATE_FILE_SERVER||e.action===F.ACTION_CLONE||e.action===F.ACTION_FILE_SERVER_CLONE?t&&h&&T&&p?e.action===F.ACTION_ACTIVATE_FILE_SERVER?this.fetchFileServer(e):e.action!==F.ACTION_CLONE&&e.action!==F.ACTION_FILE_SERVER_CLONE||this.showFileServerWizard(e):this.showFileServerPrerequisitePopup(t,!0,h,T,p,e,i,l):t&&o&&h&&T&&p&&(re||0!==i)?this.showFileServerWizard(e):this.showFileServerPrerequisitePopup(t,o,h,T,p,e,i,l)}},showFileServerWizard:function(t){var i=void 0,n=[],s=[this.model,this.networks],a=void 0,r=!0;V.hideLoader();var o=void 0;if(o=t.action===F.ACTION_CLONE?t.actionTargetName.split(",")&&t.actionTargetName.split(",")[2]:t.actionTargetId,this.fileServers)var l=_.find(this.fileServers.models,function(e){return e.get(e.DP.UUID)===o});l&&(a=l.get(F.FILE_SERVER_VERSION)),t[F.NAV_ACTION_CONTEXT_ID]=F.DOCS_HELP_SOFTWARE_TYPE_AFS;var c=this.model.get(this.model.DP.VERSION)||a;if(t[F.NAV_ACTION_TARGET_VERSION]=U.getHelpLinkAfsVesion(c),t.action===F.ACTION_ACTIVATE_FILE_SERVER)this.model.isNew(!0),this.model.actionMode=F.ACTION_ACTIVATE_FILE_SERVER,a&&(this.model.set(F.FILE_SERVER_VERSION,a),r=V.compareVersions(a,F.FILE_SERVER_VERSIONS.SPECTRE)>=0),r?(i=this.i18ns("title.activate_file_server_new",this.model.get(this.model.DP.NAME)),n=[{id:"fs-fileServerExternalNetwork",title:z,klass:T,model:s},{id:"fs-fileServerInternalNetwork",title:j,klass:E,model:s}]):(i=this.i18n("title.activate_file_server"),n=[{id:"fs-basic",title:W,klass:p,model:s},{id:"fs-fileServerExternalNetwork",title:z,klass:T,model:s},{id:"fs-fileServerInternalNetwork",title:j,klass:E,model:s},{id:"fs-fileServerUserManagement",title:q,klass:A,model:s}]);else if(t.action===F.ACTION_SCALE_OUT||t.action===F.ACTION_UPDATE_NVM)i=this.i18n("title.update_capacity"),t.action===F.ACTION_UPDATE_NVM?this.model.actionMode=F.ACTION_UPDATE:this.model.actionMode=F.ACTION_REBALANCE,this.model.set({sizeGib:null}),n=[{id:"fs-fileServerScaleOut",title:J,klass:m,model:s},{id:"fs-fileServerExternalNetwork",title:z,klass:T,model:s},{id:"fs-fileServerInternalNetwork",title:j,klass:E,model:s}];else if(t.action===F.ACTION_UPDATE_NETWORK)i=this.i18n("title.update_network"),this.model.set({numCalculatedNvms:this.model.get(this.model.DP.NVMS).length,sizeGib:null}),this.model.actionMode=F.ACTION_UPDATE,n=[{id:"fs-fileServerExternalNetwork",title:z,klass:T,model:s},{id:"fs-fileServerInternalNetwork",title:j,klass:E,model:s}];else if(t.action===F.ACTION_CLONE){var O=t.actionTargetName.split(",");i=this.i18n("title.clone_file_server"),this.model.setFileServerUuid(O[2]),this.model.actionMode=F.ACTION_CLONE,this.model.set({snapshotUuid:O[0].trim(),numCalculatedNvms:O[1],version:t.actionVersion}),this.model.isNew(!0),n=[{id:"fs-basic",title:W,klass:d,model:s},{id:"fs-fileServerExternalNetwork",title:z,klass:T,model:s},{id:"fs-fileServerInternalNetwork",title:j,klass:E,model:s},{id:"fs-fileServerUserManagement",title:q,klass:A,model:s},{id:"fs-fileServerPD",title:Z,klass:I,model:s}]}else if(t.action===F.ACTION_ANTIVIRUS_SETUP){i=this.i18n("title.antivirus_setup")+t.actionTargetName;n=[{id:"fs-fileServerICAPServer",title:Q,klass:S,model:t},{id:"fs-fileServerScanSettings",title:X,klass:g,model:t}]}else if(t.action===F.ACTION_FILE_SERVER_CLONE)i=this.i18n("title.clone_file_server"),this.model.setFileServerUuid(t.actionTargetId),this.model.actionMode=F.ACTION_FILE_SERVER_CLONE,this.model.set({numCalculatedNvms:l.get(l.DP.NVMS).length,pdName:l.get(l.DP.PD_NAME),protectionDomainState:l.get(l.DP.PD_STATUS)}),this.model.isNew(!0),a&&this.model.set(F.FILE_SERVER_VERSION,a),n=[{id:"fs-basic",title:K,klass:h,model:s},{id:"fs-fileServerExternalNetwork",title:z,klass:T,model:s},{id:"fs-fileServerInternalNetwork",title:j,klass:E,model:s},{id:"fs-fileServerUserManagement",title:q,klass:A,model:s}];else if(t.action===F.ACTION_ADD_USER_MAPPING){this.$el.addClass("userMappingWizard"),i=this.i18n("title.user_mapping");var y=[this.userMappingModel,this.model];this.searchUserMappingsModel=new oe,this.searchUserMappingsModel.setFileServerUuid(this.model.get(this.model.DP.UUID)),this.searchUserMappingsModel.isNew(!0);var D={id:"user-mapping-search",title:ee,klass:C,model:y};n=[{id:"rule-based-mapping",title:te,klass:v,model:y},{id:"explicit-mapping",title:ie,klass:R,model:y},{id:"default-mapping",title:ne,klass:N,model:y},{id:"mapping-summary",title:se,klass:P,model:y}],this.userMappingModel.isNew()||n.unshift(D)}else i=this.i18n("title.create_file_server"),this.model.isNew(!0),this.downloadedModelVersion&&(this.model.set(F.FILE_SERVER_VERSION,this.downloadedModelVersion),t[F.NAV_ACTION_TARGET_VERSION]=U.getHelpLinkAfsVesion(this.downloadedModelVersion)),n=[{id:"fs-basic",title:W,klass:u,model:s},{id:"fs-fileServerExternalNetwork",title:z,klass:T,model:s},{id:"fs-fileServerInternalNetwork",title:j,klass:E,model:s},{id:"fs-fileServerUserManagement",title:q,klass:A,model:s},{id:"fs-fileServerPD",title:Z,klass:f,model:s}];this.initializeWizard({title:i,wizardType:e.WIZARD_TYPES.LINEAR,pages:n}),t.action===F.ACTION_ANTIVIRUS_SETUP?this.$el.addClass("avWizardViewFileserver"):this.$el.addClass("wizardviewfileserver"),e.prototype.show.apply(this,arguments)},showFileServerPrerequisitePopup:function(e,i,n,s,a,r,o,l){V.hideLoader();var c=r.action===F.ACTION_ACTIVATE_FILE_SERVER,u=t.prototype.el;new t({el:V.createPopupContainer(u.replace("#","")),isNetworkConfigured:e,totalNetworks:this.networks.models.length,isLatestFileServerInstalled:i,isAHV:k.hasKVMOnly(),isExternalDataServiceSet:n,isClusterRegisteredVcenter:s,isContainerSet:a,isActivateFlow:c,showPrecheck:!!o||!!re,actionRoute:r,isSingleNodeAndPreThreeDotOne:l}).show()},showFileServerUpdatePopup:function(e){this.hide(),O.handleAction({action:F.ACTION_UPDATE_NETWORK,actionTarget:F.ENTITY_FILE_SERVER,actionTargetId:e.actionTargetId,actionTargetName:e.actionTargetName})},onRemoveUserMappingClick:function(){var e=this;$.nutanixConfirm({title:this.i18n("remove_mapping_title"),msg:this.i18n("remove_mapping_text"),yes:function(){e.deletFsUserMapping()},context:this})},deletFsUserMapping:function(){var e=this,t=function(){var t={actionTarget:F.ENTITY_FILE_SERVER,actionTargetId:e.model.get(e.model.DP.UUID),action:F.ACTION_ADD_USER_MAPPING};e.hide(),D.executeAction(t)};U.deletFsUserMapping(this.model.get(this.model.DP.UUID),t)},checkPrerequisites:function(){var e=this.model.clusterManager.getCurrentClusterModel(),t=y.FEATURE_MAP.LICENSE_FILE_SERVER,i=y.violatedFeatureLicense(t),n=y.violatedFeatureLicense(t,null,!0);this.showClusterInfo(e.get(L.CLUSTER_EXTERNAL_DATA_SERVICES),i,n,t)},showClusterInfo:function(e,t,i,n){!e&&t&&i?(this.showHeaderWarning(this.i18n("cluster_config_msg")+" "+this.createActionLink(this.i18n("external_ip_msg"),F.ENTITY_CLUSTER)+"<br/>"+y.getPopupMessageTemplate(n)),this.$(".btnNext").hide()):t&&i?this.showHeaderWarning(y.getPopupMessageTemplate(n)):e?this.$(".btnNext").show():(this.$(".btnNext").hide(),this.showHeaderWarning(this.i18n("cluster_config_msg")+" "+this.createActionLink(this.i18n("external_ip_msg"),F.ENTITY_CLUSTER)))},createActionLink:function(e,t){return this.canModifyByEntityType(t)?Y({title:e,actionAttributes:V.createActionAttr(t,F.ACTION_SHOW)}):""},onExternalPopupLinkClick:function(e){D.executeActionElement(e.currentTarget),b.offAppEvent(b.ENTITIES_UPDATED,this.externalPopupSaved),b.offAppEvent(b.POPUP_CLOSE,this.externalPopupSaved),b.onAppEventOnce(b.ENTITIES_UPDATED,this.externalPopupSaved),b.onAppEventOnce(b.POPUP_CLOSE,this.externalPopupSaved)},hide:function(){this.$(".n-tooltip-ad-credential").tooltip("destroy"),this.$(".nutanixMoreInfo").nutanixMoreInfo("destroy"),this.$(".description, .learnMoreTooltip, .userMappingTooltip\n          .addTooltip").tooltip("destroy"),e.prototype.hide.apply(this,arguments)},onPrevious:function(t){this.$(".n-tooltip-ad-credential").tooltip("destroy"),this.$(".nutanixMoreInfo").nutanixMoreInfo("destroy"),e.prototype.onPrevious.apply(this,arguments)},onNext:function(t){this.$(".n-tooltip-ad-credential").tooltip("destroy"),this.$(".nutanixMoreInfo").nutanixMoreInfo("destroy"),e.prototype.onNext.apply(this,arguments)},externalPopupSaved:function(e,t){b.offAppEvent(b.ENTITIES_UPDATED,this.externalPopupSaved),b.offAppEvent(b.SHOW_PRE_CHECK_NOTIFICATION,this.externalPopupSaved),t.entityType===F.ENTITY_CLUSTER?this.showClusterInfo(t.clusterExternalDataServices):t.entityType===F.ENTITY_FILE_SERVER&&(re=this.i18n("yes"),this.checkFSCreationPrerequisite(t.actionRoute))},externalPopupCanceled:function(){b.offAppEvent(b.SHOW_PRE_CHECK_NOTIFICATION,this.externalPopupSaved)},fetchFileServer:function(e){var t=this;this.model=new le,this.model.set(this.model.idAttribute,e.actionTargetId,{silent:!0}),this.model.setFileServerUuid(e.actionTargetId),this.model.setEntityName(e.actionTargetName),this.model.fetch({success:function(){t.showFileServerWizard(e)},error:function(i){t.showFileServerWizard(e),t.showHeaderError(t.i18n("error.file_server_fetch")),t.$(".btnNext").hide()}})},fetchUserMapping:function(e){var t=this,n=e[F.NAV_ACTION_TARGET_ID],s=[];this.userMappingModel=new c,this.userMappingModel.set(this.userMappingModel.DP.FILE_SERVER_UUID,n),this.model=new i,this.model.set(this.model.DP.UUID,n),s.push(this.model.fetch()),s.push(this.userMappingModel.fetch()),$.whenAll.apply($,s).done(function(){var i=t.model.getValue(t.model.DP.NAME_SERVICE_CONFIG+"."+t.model.DP.LOCAL_DETAILS);(i&&i[t.model.DP.PROTOCOL_TYPE])===F.FS_PROTOCOLS.NFS&&(t.isNFSUnmanaged=!0),U.isUserMappingConfigured(t.userMappingModel)?t.userMappingModel.isNew(!1):t.userMappingModel.isNew(!0),t.showFileServerWizard(e)}).fail(function(){t.showFileServerWizard(e),t.showHeaderError(t.i18n("data_fetch_error")),t.$(".btnNext").hide()})},search:function(e){var t=this;this.clearHeader();var i=e.$(".smbMapping").prop("checked")?F.SEARCH_MAPPING_TYPE.SMB_TO_NFS:F.SEARCH_MAPPING_TYPE.NFS_TO_SMB,n=e.$(".userOrGroupSelect").val(),s=$.trim(e.$(".searchInput").val());if(!s)return void this.showHeaderError(this.i18n("error.missing_input"));var a=[s],r=void 0;if(e.$(".smbMapping").prop("checked")?_.find(a,function(e){return r=U.validateWildcardSmbUser(e)}):_.find(a,function(e){return r=U.validateWildcardNfsUser(e)}),r)return this.showHeaderError(r),void e.$(".searchresult").empty();var o={mappingType:n,nameOrIds:a,searchMappingType:i};this.searchUserMappingsModel.set(o),V.showLoader(),this.searchUserMappingsModel.save(null,{silent:!0,success:function(i){V.hideLoader(),t.renderSearchResult(i.toJSON(),e,n)},error:function(i,s){V.hideLoader(),t.showHeaderError(V.processAjaxError(s.responseText)),t.renderSearchResult(null,e,n)}})},renderSearchResult:function(e,t,i){var n=U.getFsNfsProtocol(this.model),s=void 0,a=void 0;t.$(".smbMapping").prop("checked")?(s=F.FS_PROTOCOLS.SMB+" "+F.NFS_PROTOCOL_TYPE.AD+" "+i,a=F.FS_PROTOCOLS.NFS+" "+n+" "+i):(s=F.FS_PROTOCOLS.NFS+" "+n+" "+i,a=F.FS_PROTOCOLS.SMB+" "+F.NFS_PROTOCOL_TYPE.AD+" "+i);var r=G(this.vtOptions({mappingFrom:s,mappingTo:a}));t.$(".searchresult").html(r),e&&e[0]&&e[0].optionType?this.insertTableRow(e,t):this.insertNoDataRow(t)},insertNoDataRow:function(e){e.$(".table-data-items tbody").append(H({noData:this.i18n("no_data")}))},insertTableRow:function(e,t){t.$(".table-data-items tbody").append(B(this.vtOptions({mappingFromReuslt:e[0].searchedEntry&&e[0].searchedEntry.nameOrIds&&e[0].searchedEntry.nameOrIds[0],mappingToReuslt:e[0].mappedEntry[0].nameOrIds,mappingRuleReuslt:e[0].optionType.replace(/_/g,"-")})))},isClusterRegisteredToVcenter:function(){var e=!1;return this.managementServerInfo.models<=0?e=!1:_.each(this.managementServerInfo.models,function(t){e=!!t.get(t.DP.REGISTERED)}),e},hasNutanixManagementShareContainerExists:function(){return _.some(this.containers.models,function(e){return"NutanixManagementShare"===e.get(L.NAME)})},fetchNetworks:function(e){var t=this;this.networks.fetch({success:function(){t.fetchFileServer(e)},error:function(i){t.showHeaderError(t.i18n("error.network_fetch")),t.fetchFileServer(e)}})}})}),define("models/fileserver/ShareScanSettingModel",["models/MinervaModel","data/DataURLConstants","utils/AppConstants"],function(e,t,i){"use strict";var n={ENABLE_ANTIVIRUS:"enableAntiVirus",SCAN_ON_READ:"scanOnRead",SCAN_ON_WRITE:"scanOnWrite",FILE_TYPE_EXCLUSIONS:"fileTypeExclusions",FILE_SIZE_EXCLUSION:"fileSizeExclusion",SCAN_TIMEOUT_INTERVAL_IN_SECS:"scanTimeoutIntervalInSecs",BLOCK_ACCESS_FILE:"blockAccessFile"};return e.extend({urlRoot:t.SHARE_AV_SCAN_POLICY,name:"ShareScanSettingModel",entityType:i.ENTITY_AV_SCAN_POLICY,DP:n,defaults:{uuid:null},setUuid:function(e){this.fsUuid=e.fsUuid,this.shareId=e.shareId},setEntityName:function(e){this.entityName=e},getValue:function(t){return t===this.nameAttribute?this.get(this.nameAttribute)||this.entityName:e.prototype.getValue.apply(this,arguments)},getURL:function(){return _.template(this.urlRoot,{uuid:this.fsUuid,shareId:this.shareId})}})}),define("text!templates/wizards/fileserver/ShareFSBasicPage.html",[],function(){return'<form>\n  \x3c!-- Share name container --\x3e\n  <section data-ntnx-section>\n    <label data-ntnx-label>\n      <%= i18n(\'name\') %>\n    </label>\n    <input type="text" class="shareName">\n  </section>\n  \x3c!-- Share description container --\x3e\n  <section data-ntnx-section>\n    <label data-ntnx-label>\n      <%= i18n(\'description\') %>\n    </label>\n    <input type="text" class="shareDescription">\n  </section>\n\n  \x3c!-- File servers container --\x3e\n  <section data-ntnx-section>\n    <label data-ntnx-label>\n      <%= i18n(\'file_server\') %>\n    </label>\n    <%= Components.select({\n      jsClasses: \'comboFileServer\',\n      options: fileServersOptions\n    }) %>\n  </section>\n\n  \x3c!-- Share path container --\x3e\n  <section data-ntnx-section class="sharePathContainer">\n    <label data-ntnx-label>\n      <%= i18n(\'share_path\') %>\n        <span class="nutanixMoreInfo"\n          data-tooltip-classes="-nudge-up"\n          data-tooltip-container="body"\n          data-tooltip-title="<%= i18n(\'share_path_info\') %>">\n        </span>\n    </label>\n    <input type="text" class="sharePath" value="<%= sharePath %>"\n      placeholder="/<sharename>/<dir>">\n  </section>\n\n  <div class="nestedShareContainer">\n    <section data-ntnx-section class="max-size">\n      <label data-ntnx-label>\n        <%= i18n(\'max_size\') %>\n      </label>\n      <input type="text" class="maxSize">\n      <div class="unit"><span class="memory-unit"><%= i18n(\'gb\') %></span></div>\n    </section>\n\n    <section data-ntnx-section class="protocoTypeContainer">\n      <h5 data-ntnx-title>\n        <% if (!update) { %>\n          <%= i18n(\'select\') %>\n        <% } %>\n        <%= i18n(\'protocol\') %>\n        <% if (update) { %>\n          <span class="protocolType">: <%= protocolType %></span>\n        <% } if (!update) { %>\n          <a class="joinDomain"><%= i18n(\'join_a_domain\') %></a>\n        <% } %>\n      </h5>\n      <section data-ntnx-section>\n        <div data-ntnx-form-inline class="nfsCheckboxContainer">\n          <span class="nfsTooltipWrapper tooltipWrapper">\n            <%= Components.radio({\n              jsClasses: \'protocolCheckbox protocolNfs\',\n              labelText: i18n(\'nfs\')\n            }) %>\n          </span>\n        </div>\n        <div data-ntnx-form-inline class="smbCheckboxContainer">\n          <span class="smbTooltipWrapper tooltipWrapper">\n            <%= Components.radio({\n              jsClasses: \'protocolCheckbox protocolSmb\',\n              labelText: i18n(\'smb\')\n            }) %>\n          </span>\n        </div>\n      </section>\n    </section>\n\n    <section data-ntnx-section class="enableNonNativeContainer hidden">\n      <div class="enableNonNativeSMB hidden">\n        <span class="multiTooltipWrapper tooltipWrapper">\n          <%= Components.checkbox(\n            {\n              jsClasses : \'enableNonNative\',\n              id: \'enableNonNativeSMB\',\n              labelText: i18n(\'enable_non_native_smb\')\n            })\n          %>\n        </span>\n      </div>\n      <div class="enableNonNativeNFS hidden">\n        <span class="multiTooltipWrapper tooltipWrapper">\n          <%= Components.checkbox(\n            {\n              jsClasses : \'enableNonNative\',\n              id: \'enableNonNativeNFS\',\n              labelText: i18n(\'enable_non_native_nfs\')\n            })\n          %>\n        </span>\n      </div>\n      <section data-ntnx-section class="noneAdMappingMsgContainer hidden">\n        <div class="noneAdMappingMsg"></div>\n      </section>\n     </section>\n  </div>\n</form>\n'}),define("views/wizards/fileserver/ShareFSBasicPage",["views/basecomponents/wizards/BaseWizardPage","models/fileserver/ShareScanSettingModel","models/fileserver/ShareModel","models/fileserver/ShareCollection","models/fileserver/UserMappingModel","managers/ActionManager","managers/NotificationManager","utils/AppConstants","utils/FileServerUtil","utils/AppUtil","utils/CommonTemplates","text!templates/wizards/fileserver/ShareFSBasicPage.html"],function(e,t,i,n,s,a,r,o,l,c,u,d){"use strict";var h=_.template('<a class="externalPopupLink" <%= actionAttributes %>><%= title %></a>');return e.extend({name:"ShareFSBasicPage",validNestedShare:!0,nestedShareSupport:!0,events:{"keydown input.shareName":"_onKeyDown","keydown input.sharePath":"_onsharePathKeyDown",
"change  .comboFileServer":"onChangeFileServer","click   .protocolCheckbox":"onClickProtocol","click   .comboUsage":"_onClickUsageType","click   .joinDomain":"_onClickJoinDomain","click   .enableNonNative":"_onClickEnableNonNative"},template:_.template(d),initialize:function(t){e.prototype.initialize.apply(this,arguments),this.model?(this.fileServers=this.model[1],this.shareModel=this.model[0]):this.shareModel=new i;var n=l.getFileServerAndShareUuidsFromPageRoute();n&&this.shareModel.setUuid(n),this.newPayload={isNestedShare:!1},this.firstFsUuid=this.fileServers.models&&this.fileServers.models[0]&&this.fileServers.models[0].get(this.fileServers.models[0].DP.UUID)},render:function(){if(this.isViewRendered)return this._addTooltip(),void this.addTooltipToElement();var e=l.getFileServerAndShareUuidsFromPageRoute();this.fsModel=this.fileServers.models[0],e&&(this.fsModel=_.find(this.fileServers.models,function(t){return e.fsUuid===t.get(t.DP.UUID)})),this.isFsPostSabine=l.compareAFSversion(this.fsModel,o.FILE_SERVER_VERSIONS.THREE_DOT_FIVE)>=0,this.shareModel.isNew()?this.fetchUserMapping(e&&e.fsUuid,!0):this.isFsPostSabine?this.fetchScanAndUserMapping(e):this.fetchScan(e),this.isViewRendered=!0},fetchScan:function(e){var i=this,n=new t;e&&n.setUuid(e),c.showLoader(),n.fetch({success:function(e,t){c.hideLoader(),i.isScanEnabled=e.get(e.DP.ENABLE_ANTIVIRUS),i.isReadEnabled=e.get(e.DP.SCAN_ON_READ),i.postRender()},error:function(e,t){c.hideLoader(),r.showClientNotification(o.NOTIFY_ERROR,i.i18n("share_scan_fetch_failure")),i.postRender()}})},fetchScanAndUserMapping:function(e){var i=this,n=new t,a=new s;e&&(n.setUuid(e),a.set(a.DP.FILE_SERVER_UUID,e.fsUuid,{silent:!0}));var u=n.fetch(),d=a.fetch(),h=function(e,t){c.hideLoader(),i.isScanEnabled=n.get(n.DP.ENABLE_ANTIVIRUS),i.isReadEnabled=n.get(n.DP.SCAN_ON_READ),i.isUserMappingConfigured=a&&l.isUserMappingConfigured(a),i.postRender()},p=function(e,t){c.hideLoader(),e===o.STATE_ERROR&&r.showClientNotification(o.NOTIFY_ERROR,i.i18n("share_scan_fetch_failure")),t===o.STATE_ERROR&&r.showClientNotification(o.NOTIFY_ERROR,i.i18n("user_mapping_fetch_failure")),i.postRender()};c.showLoader(),$.when(u,d).then(h,p)},postRender:function(){var e=this,t=!0;if(0===this.fileServers.length)this._showAddFileServerView();else{var n=[];if(this.shareModel.isNew())t=!1,this.fileServers.each(function(e){if(t||(t=l.compareAFSversion(e,o.FILE_SERVER_VERSIONS.SPECTRE)>=0),e.get(e.DP.DNS_SERVER_IP_ADDRESSES)&&!1!==e.get(e.DP.PD_STATUS)&&!e.get(e.DP.UPGRADE_IN_PROGRESS)&&e.get(e.DP.VERSION)&&(e.get(e.DP.NAME_SERVICE_CONFIG)||e.getDomainConfig(e.DP[e.DP.DOMAIN_CONFIG].REALM))){var i={name:e.get(e.DP.NAME),value:e.get(e.DP.UUID)};n.push(i)}});else{var s={name:this.shareModel.get(i.DP.FILE_SERVER_NAME),value:this.shareModel.get(i.DP.FILE_SERVER_UUID)};n.push(s)}var a=this.shareModel[this.shareModel.DP.FILE_SERVER_UUID],r="";!this.shareModel.isNew()&&this.shareModel.get(this.shareModel.DP.SHARE_PATH)&&(r=this.shareModel.get(this.shareModel.DP.SHARE_PATH));var c=this.shareModel.get(this.shareModel.DP.PROTOCOL_TYPE),u=this.template(this.vtOptions({fileServersOptions:n,sharePath:r,update:!this.shareModel.isNew(),protocolType:c}));this.$el.html(u),this.shareModel.isNew()&&this.$(".comboFileServer").val(this.uuids&&this.uuids.fsUuid||this.firstFsUuid).select(),!r&&this.shareModel.isNew()||(this.$(".sharePath").attr("disabled","disabled"),this.shareModel.get(this.shareModel.DP.PARENT_SHARE_UUID)?this.$(".nestedShareContainer").hide():this.$(".sharePathContainer").addClass("hidden"),this.getWizard().reSizePopup()),t||this.$(".nfsCheckboxContainer").hide(),n||(this.$(".shareName").prop("disabled",!0),this.showError(this.i18n("join_domain"))),this.$(".shareName").val(this.shareModel.get(this.shareModel.DP.NAME)),this.$(".shareDescription").val(this.shareModel.get(this.shareModel.DP.DESCRIPTION)),this.$(".maxSize").val(this.shareModel.get(this.shareModel.DP.MAX_SIZE)||""),this.setProtocolShareType(a),this.isViewRendered=!0,this.shareModel.isNew()?this.disableNextButton():(this.$(".protocolCheckbox").attr("disabled","disabled").off("click"),this.$(".comboFileServer").attr("disabled","disabled").off("click"))}setTimeout(function(){e.getWizard().triggerAction(o.MODAL.ACT.AS_REBUILD)},500)},setHelpLinkAfsVersion:function(e){var t=this.getWizard().actionRoute;l.setHelpLinkAfsVersion(this.getWizard(),t,e)},onChangeFileServer:_.debounce(function(e){var t=this.$(".comboFileServer").val();this.fetchUserMapping(t)},300),fetchUserMapping:function(e,t){var i=this,n=this.fileServers.find(function(t){return t.get(t.DP.UUID)===e});if(!(l.compareAFSversion(n,o.FILE_SERVER_VERSIONS.THREE_DOT_FIVE)>=0))return void(t?this.postRender():(this.setHelpLinkAfsVersion(n),this.setProtocolShareType(e)));e&&e!==o.ACTION_SUMMARY||(e=this.firstFsUuid);var a=new s;a.set(a.DP.FILE_SERVER_UUID,e,{silent:!0}),c.showLoader(),a.fetch({success:function(n,s){c.hideLoader(),i.isUserMappingConfigured=a&&l.isUserMappingConfigured(a),t?i.postRender():i.setProtocolShareType(e)},error:function(e,n){c.hideLoader(),r.showClientNotification(o.NOTIFY_ERROR,i.i18n("user_mapping_fetch_failure")),t&&i.postRender()}})},setProtocolShareType:function(e){var t=this;e&&this.$(".comboFileServer").val(e).select(),this._displaySharePath(),this.fileServers.each(function(e){if(e.get(e.DP.UUID)===t.$(".comboFileServer").val()){l.compareAFSversion(e,o.FILE_SERVER_VERSIONS.SPECTRE)<0?t.$(".nfsCheckboxContainer").hide():t.$(".nfsCheckboxContainer").show(),t.selectedFileServer=e,t.isFsPostSabine=l.compareAFSversion(e,o.FILE_SERVER_VERSIONS.THREE_DOT_FIVE)>=0;var i=e.getValue(e.DP.NAME_SERVICE_CONFIG+"."+e.DP.AD_DETAILS),n=i&&i[e.DP.PROTOCOL_TYPE],s=e.getValue(e.DP.NAME_SERVICE_CONFIG+"."+e.DP.LDAP_DETAILS),a=s&&s[e.DP.PROTOCOL_TYPE],r=e.getValue(e.DP.NAME_SERVICE_CONFIG+"."+e.DP.LOCAL_DETAILS),c=r&&r[e.DP.PROTOCOL_TYPE],u=e.getDomainConfig(e.DP[e.DP.DOMAIN_CONFIG].REALM);t.trackFsProtocol(n,c,a),t.precheckProtocolCheckBox(n,s,c,a,i,u),t._showEnableNonNativeContainer(),t.shareModel.isNew()||t.checkEnableNonNative()}}),this.getWizard().reSizePopup(),this.setHelpLinkAfsVersion(this.selectedFileServer)},trackFsProtocol:function(e,t,i){e===o.FS_PROTOCOLS.NFS_SMB||e===o.FS_PROTOCOLS.SMB?this.isSmbFileServer=!0:this.isSmbFileServer=!1,e===o.FS_PROTOCOLS.NFS_SMB||e===o.FS_PROTOCOLS.NFS||t===o.FS_PROTOCOLS.NFS||i===o.FS_PROTOCOLS.NFS?this.isNfsFileServer=!0:this.isNfsFileServer=!1},precheckProtocolCheckBox:function(e,t,i,n,s,a){if(this.shareModel.isNew()){var r=!1;this.$(".protocolSmb, .protocolNfs").removeAttr("disabled"),this.$(".smbTooltipWrapper, .nfsTooltipWrapper").tooltip("destroy"),this.$(".protocolSmb, .protocolNfs").prop("checked",!1),(e!==o.FS_PROTOCOLS.NFS_SMB&&(e!==o.FS_PROTOCOLS.SMB||i!==o.FS_PROTOCOLS.NFS&&n!==o.FS_PROTOCOLS.NFS)||this.isSMBEnabled||this.isNFSEnabled)&&(s&&(e===o.FS_PROTOCOLS.SMB||e===o.FS_PROTOCOLS.NFS_SMB)||!s&&a?(this.$(".smbCheckboxContainer").show(),this.checkSmb(),r=!0):(this.$(".protocolSmb").attr("disabled","disabled"),this.protocolSmbDisabled=!0,c.addSVGClass(this.$(".smbTooltipWrapper"),"disabled"),this.checkNfs())),t||i===o.FS_PROTOCOLS.NFS||e===o.FS_PROTOCOLS.NFS||e===o.FS_PROTOCOLS.NFS_SMB?r=!0:(this.$(".protocolNfs").prop("checked",!1),this.$(".protocolNfs").attr("disabled","disabled"),c.addSVGClass(this.$(".nfsTooltipWrapper"),"disabled")),this._addTooltip(),this.realm=a,r?this.$(".joinDomain").hide():this.$(".joinDomain").show()}else this.$(".comboFileServer").val(this.shareModel.get(this.shareModel.DP.FILE_SERVER_UUID)).select(),e!==o.FS_PROTOCOLS.NFS_SMB&&e!==o.FS_PROTOCOLS.SMB&&(this.$(".protocolSmb").attr("disabled","disabled"),this.protocolSmbDisabled=!0),i!==o.FS_PROTOCOLS.NFS&&e!==o.FS_PROTOCOLS.NFS&&e!==o.FS_PROTOCOLS.NFS_SMB&&(this.$(".protocolNfs").attr("disabled","disabled"),this.protocolNfsDisabled=!0),this.shareModel.get(this.shareModel.DP.PROTOCOL_TYPE)===o.FS_PROTOCOLS.NFS?this.checkNfs():this.checkSmb()},_showEnableNonNativeContainer:function(){var e=this.shareModel.get(this.shareModel.DP.SECONDARY_PROTOCOL_TYPE),t=this.isIncompatibleAndMpSupported();if(!this.isFsPostSabine||this.isNestedShare||t)return this.$(".enableNonNativeContainer").hasClass("hidden")||this.$(".enableNonNativeContainer").addClass("hidden"),this.$(".noneAdMappingMsgContainer").hasClass("hidden")||this.$(".noneAdMappingMsgContainer").addClass("hidden"),void this.$(".enableNonNative").prop("checked",!1);var i=this.checkParentNestedShare()&&!this.isFsPostSabine;(this.$(".protocolNfs").prop("disabled")||this.$(".protocolSmb").prop("disabled"))&&this.shareModel.isNew()?(this.$(".enableNonNativeContainer").hasClass("hidden")||this.$(".enableNonNativeContainer").addClass("hidden"),this.$(".enableNonNative").prop("checked",!1)):i?(this.$(".enableNonNative").prop("disabled",!0),this._addTooltip()):(!this.shareModel.isNew()||this.isNFSEnabled||this.isSMBEnabled)&&this.$(".enableNonNativeContainer").removeClass("hidden"),this.shareModel.isNew()||e||(this.isNfsFileServer||this.$(".enableNonNativeNFS").prop("checked")||this.$(".protocolNfs").prop("checked")||this.$(".enableNonNativeNFS").addClass("hidden"),this.isSmbFileServer||this.$(".enableNonNativeSMB").prop("checked")||this.$(".protocolSmb").prop("checked")||this.$(".enableNonNativeSMB").addClass("hidden"))},isIncompatibleAndMpSupported:function(){var e=this.shareModel.get(this.shareModel.DP.PROTOCOL_TYPE),t=this.shareModel.get(this.shareModel.DP.SECONDARY_PROTOCOL_TYPE),i=t===o.FS_PROTOCOLS.INCOMPATIBLE,n=l.compareAFSversion(this.shareModel,o.FILE_SERVER_VERSIONS.THREE_DOT_FIVE_DOT_ONE)>=0;return i&&(!n||n&&e===o.FS_PROTOCOLS.NFS)},checkEnableNonNative:function(){var e=this.shareModel.get(this.shareModel.DP.SECONDARY_PROTOCOL_TYPE);e&&(this.$("#enableNonNative"+e).prop("checked",!0),this.showMsg())},checkSmb:function(){$(".antiscroll-wrap").antiscroll(),this.$(".protocolSmb").prop("checked",!0),this.$(".protocolNfs, .enableNonNative").prop("checked",!1),this.isSMBEnabled=!0,this.isNFSEnabled=!1,this._showEnableNonNativeContainer(),this.addTooltipToElement(),this.$(".enableNonNativeNFS").removeClass("hidden"),this.$(".enableNonNativeSMB").addClass("hidden"),this.scrollToElement(this.$(".enableNonNativeNFS")),this.$(".noneAdMappingMsgContainer").hasClass("hidden")||this.$(".noneAdMappingMsgContainer").addClass("hidden")},checkNfs:function(){$(".antiscroll-wrap").antiscroll(),this.$(".protocolSmb, .enableNonNative").prop("checked",!1),this.$(".protocolNfs").prop("checked",!0),this.isSMBEnabled=!1,this.isNFSEnabled=!0,this._showEnableNonNativeContainer(),this.addTooltipToElement(),this.$(".enableNonNativeNFS").addClass("hidden"),this.$(".enableNonNativeSMB").removeClass("hidden"),this.scrollToElement(this.$(".enableNonNativeSMB")),this.$(".noneAdMappingMsgContainer").hasClass("hidden")||this.$(".noneAdMappingMsgContainer").addClass("hidden")},scrollToElement:function(e){var t=e&&e.first().offset().top||0;this.getWizard().$(".antiscroll-inner").animate({scrollTop:t},500)},addTooltipToElement:function(){var e=this.selectedFileServer&&this.selectedFileServer.getValue(this.selectedFileServer.DP.NAME_SERVICE_CONFIG+"."+this.selectedFileServer.DP.AD_DETAILS),t=e&&e[this.selectedFileServer.DP.PROTOCOL_TYPE];if(this.isUserMappingConfigured||t===o.FS_PROTOCOLS.NFS_SMB)this.$(".userMappingTooltip").tooltip("destroy"),this.$(".enableNonNative").removeAttr("disabled");else{var i=this.i18n("setup_user_mapping_msg");this.$(".multiTooltipWrapper").addClass("addTooltip userMappingTooltip").attr("title",i).tooltip({placement:"top"}),this.$(".enableNonNative").prop("checked",!1),this.$(".enableNonNative").attr("disabled","disabled")}},_onKeyDown:_.debounce(function(e){this._validateForm()},100),_onsharePathKeyDown:_.debounce(function(e){this._validateSharePath()},500),_validateSharePath:function(){var e=this,t=this.$(".sharePath").val();if(this.clearHeader(),t&&"/"!==t&&this.shareModel.isNew()){var i=t.split("/"),s=i.length,a=i[1],r=!1;("/"!==t.charAt(0)||s<3||""===i[s-1])&&(this.validNestedShare=!1,this.showError(this.i18n("error.share_path_not_exists")),r=!0),r||(this.shareCollection=new n,this.shareCollection.setFSId(this.$(".comboFileServer").val()),this.shareCollection.fetch({success:function(){e._validateParentShare(a)},error:function(t){e.validNestedShare=!1,e.showError(e.i18n("error.share_fetch"))}}))}else this.newPayload={isNestedShare:!1},this.$(".nestedShareContainer").show(),this.validNestedShare=!0,this.getWizard().reSizePopup()},_validateParentShare:function(e){var t=this,i=!1,n=null,s=!1,a=null;this.shareCollection.models.length&&(this.shareCollection.models.find(function(r){if(a=r.get(r.DP.PROTOCOL_TYPE),(r.get(r.DP.NAME)===e||a===o.FS_PROTOCOLS.SMB&&r.get(r.DP.NAME).toLowerCase()===e.toLowerCase())&&(i=t._validateShareProtocolType(r),s=!0,i))return n=r}),s?i||n?n.get(n.DP.PARENT_SHARE_UUID)?(this.validNestedShare=!1,this.showError(this.i18ns("error.share_path_has_nested_share",'"'+e+'"'))):(this.newPayload={protocolType:n.get(n.DP.PROTOCOL_TYPE),secondaryProtocolType:n.get(n.DP.SECONDARY_PROTOCOL_TYPE),shareType:o.FS_SHARE_TYPES.GENERAL,enablePreviousVersion:n.get(n.DP.WINDOWS_PREVIOUS_VERSION),authenticationType:n.get(n.DP.AUTHENTICATION_TYPE),isNestedShare:!0},n.get(n.DP.SECONDARY_PROTOCOL_TYPE)&&_.extend(this.newPayload,{simultaneousAccessEnabled:n.get(n.DP.SIMULTANEOUS_ACCESS_ENABLED),symlinkCreationEnabled:n.get(n.DP.SYMLINK_CREATION_ENABLED)}),this.$(".nestedShareContainer").hide(),this.$(".maxSize").val(""),this.validNestedShare=!0,this._validateForm()):(this.validNestedShare=!1,this.showError(this.i18ns("error.share_path_multi_protocol",'"'+e+'"'))):(this.validNestedShare=!1,this.showError(this.i18n("error.share_path_not_exists"))),this.getWizard().reSizePopup())},_displaySharePath:function(){var e=this.$(".comboFileServer").val(),t=this.fileServers.models.find(function(t){return t.get(t.DP.UUID)===e});this.isFsPreThreeDotTwo=t&&l.compareAFSversion(t,o.FILE_SERVER_VERSIONS.THREE_DOT_TWO)<0,this.hideSharePath()},hideSharePath:function(){this.isFsPreThreeDotTwo||!this.shareModel.isNew()&&this.shareModel.get(this.shareModel.DP.SHARE_PATH)&&!this.shareModel.get(this.shareModel.DP.PARENT_SHARE_UUID)?(this.$(".sharePathContainer").hide(),this.nestedShareSupport=!1):(this.nestedShareSupport=!0,this.$(".sharePathContainer").show())},_validateForm:function(){var e=this.$(".shareName").val().trim(),t="";this.$(".protocolCheckbox:checked").hasClass("protocolSmb")?t=o.FS_PROTOCOLS.SMB:this.$(".protocolCheckbox:checked").hasClass("protocolNfs")&&(t=o.FS_PROTOCOLS.NFS),(t||this.newPayload.isNestedShare)&&e.length>0?!this.validNestedShare&&this.nestedShareSupport||this.enableNextButton():this.disableNextButton()},_validateShareProtocolType:function(e){if(this.isFsPostSabine)return!0;var t=e.get(e.DP.SECONDARY_PROTOCOL_TYPE),i=!0;return t!==o.FS_PROTOCOLS.NFS&&t!==o.FS_PROTOCOLS.SMB||(i=!1),i},onPageTransition:function(e){var t=this;if(!this.validNestedShare&&this.nestedShareSupport)return void this.disableNextButton();this.$(".shareName").removeClass("error-class");var i=this.$(".comboFileServer").val(),n=this.selectedFileServer,s=n&&l.compareAFSversion(n,o.FILE_SERVER_VERSIONS.SPECTRE);if((!this.$(".protocolSmb").prop("checked")&&!this.$(".protocolNfs").prop("checked")||!this.$(".protocolSmb").prop("checked")&&s<0)&&!this.newPayload.isNestedShare)return this.showError(this.i18n("choose_domain_msg")),void this._addTooltip();var a=this.$(".shareName").val().trim(),r=this.$(".shareDescription").val().trim(),c=Number(this.$(".maxSize").val().trim()),u=o.FS_PROTOCOLS.NFS;this.$(".protocolSmb").prop("checked")&&(u=o.FS_PROTOCOLS.SMB);var d=this.shareModel.get(this.shareModel.DP.SECONDARY_PROTOCOL_TYPE),h=void 0;h=d===o.FS_PROTOCOLS.INCOMPATIBLE?d:o.FS_PROTOCOLS.NONE,this.$("#enableNonNativeNFS").prop("checked")?h=o.FS_PROTOCOLS.NFS:this.$("#enableNonNativeSMB").prop("checked")&&(h=o.FS_PROTOCOLS.SMB);var p=this.$(".sharePath").val(),_=this.shareModel.validate({name:a,fileServerUuid:i,maxSizeGiB:c});u===o.FS_PROTOCOLS.NFS&&a.indexOf("$")>-1&&this.isFsPreThreeDotTwo&&s>=0&&(_=_?_+" "+this.i18n("wrong_name_msg"):this.i18n("wrong_name_msg"));var T=this.shareModel.get(this.shareModel.DP.DOMAIN_NAME);if(T||(T=this.realm),_)this.scrollToElement(),this.showError(_),this._addTooltip();else{var E={fileServerUuid:i,windowsAdDomainName:T,name:a,description:r,maxSizeGiB:c,protocolType:u,secondaryProtocolType:h};this.isFsPreThreeDotTwo||(E.sharePath=p);var S=this.shareModel.get(this.shareModel.DP.NAME);if(S&&S!==a&&!this.shareModel.isNew()){var g=u===o.FS_PROTOCOLS.SMB?this.i18n("share"):this.i18n("export");$.nutanixConfirm({msg:this.i18ns("name_change_msg",g),yes:function(){t.goToNextPage(E,e)},yesText:this.i18n("continue"),context:this})}else this.goToNextPage(E,e)}},goToNextPage:function(e,t){this.shareModel.set(e),this.shareModel.set(this.newPayload),t()},_addTooltip:function(){var e=this.selectedFileServer&&this.selectedFileServer.getValue(this.selectedFileServer.DP.NAME_SERVICE_CONFIG+"."+this.selectedFileServer.DP.AD_DETAILS),t=e&&e[this.selectedFileServer.DP.PROTOCOL_TYPE],i=this.selectedFileServer&&this.selectedFileServer.getDomainConfig(this.selectedFileServer.DP[this.selectedFileServer.DP.DOMAIN_CONFIG].REALM),n=this.selectedFileServer&&this.selectedFileServer.getValue(this.selectedFileServer.DP.NAME_SERVICE_CONFIG+"."+this.selectedFileServer.DP.LDAP_DETAILS),s=this.selectedFileServer&&this.selectedFileServer.getValue(this.selectedFileServer.DP.NAME_SERVICE_CONFIG+"."+this.selectedFileServer.DP.LOCAL_DETAILS),a=s&&s[this.selectedFileServer.DP.PROTOCOL_TYPE];if(e&&(t===o.FS_PROTOCOLS.SMB||t===o.FS_PROTOCOLS.NFS_SMB)||!e&&i||this.$(".smbTooltipWrapper").addClass("addTooltip").attr("title",this.i18n("join_domain_msg")).tooltip({placement:"right"}),n||a===o.FS_PROTOCOLS.NFS||t===o.FS_PROTOCOLS.NFS||t===o.FS_PROTOCOLS.NFS_SMB||this.$(".nfsTooltipWrapper").addClass("addTooltip").attr("title",this.i18n("join_domain_msg")).tooltip({placement:"right"}),!this.shareModel.isNew()){this.checkParentNestedShare()&&this.$(".multiTooltipWrapper").addClass("addTooltip").attr("title",this.i18n("parent_nested_share_msg")).tooltip({placement:"top"})}this.$(".nutanixMoreInfo").nutanixMoreInfo({parseDataAttrs:!0})},_onClickEnableNonNative:function(e){var t=$(e.currentTarget).prop("checked");t?this.showMsg(t):this.isSMBEnabled?this.checkSmb():this.isNFSEnabled&&this.checkNfs()},showMsg:function(e){var t=this,i=void 0,n=void 0;if(this.isSMBEnabled){this.selectedFileServer;i="",this.isScanEnabled&&(i+=this.i18n("av_not_work_msg"),this.isReadEnabled||(i+=this.i18n("turn_on_read_msg")))}this.shouldShowSmbDisruptedMsg()&&e&&(i+=this.i18n("smb_disrupted_msg")),i?(n=u.INFO({msg:i}),this.$(".noneAdMappingMsg").html(n),this.$(".noneAdMappingMsgContainer").removeClass("hidden"),setTimeout(function(){t.getWizard().triggerAction(o.MODAL.ACT.AS_REBUILD)},500),this.scrollToElement(this.$(".noneAdMappingMsg"))):this.$(".noneAdMappingMsgContainer").hasClass("hidden")||this.$(".noneAdMappingMsgContainer").addClass("hidden")},shouldShowSmbDisruptedMsg:function(){var e=this.shareModel.get(this.shareModel.DP.SHARE_TYPE)===o.FS_SHARE_TYPES.HOMES,t=this.shareModel.get(this.shareModel.DP.PROTOCOL_TYPE),i=l.compareAFSversion(this.shareModel,o.FILE_SERVER_VERSIONS.THREE_DOT_FIVE_DOT_ONE)>=0;return this.shareModel.get(this.shareModel.DP.SECONDARY_PROTOCOL_TYPE)===o.FS_PROTOCOLS.INCOMPATIBLE&&i&&e&&t===o.FS_PROTOCOLS.SMB},onClickProtocol:function(e){this._validateForm();var t=$(e.currentTarget).closest("div").find("input");t.prop("checked")&&(t.hasClass("protocolSmb")?this.checkSmb():this.checkNfs())},_onClickJoinDomain:function(){var e={action:o.ACTION_USER_MANAGEMENT,actionTarget:o.ENTITY_FILE_SERVER,actionTargetId:$(".comboFileServer").val(),actionTargetName:$(".comboFileServer option:selected").text().trim()};this.getWizard().hide(),a.executeAction(e)},_onClickUsageType:function(e){var t=$(e.currentTarget).val(),i=t.toLowerCase()+"_content";this.$(".usageTypeContentContainer .content-pane").hide(),this.$(".usageTypeContentContainer .content-pane."+i).show()},_showAddFileServerView:function(){this.getWizard().showHeaderInfo("<p>"+this.i18n("add_fs_msg")+"</p>"+this._createActionLink(this.i18n("add_file_server"),o.ENTITY_FILE_SERVER)),this.disableNextButton(),this.getWizard().$(".wizard-page-header").hide()},_createActionLink:function(e,t){return this.canModifyByEntityType(t)?h({title:e,actionAttributes:c.createActionAttr(t,o.ACTION_SHOW)}):""},onPageCancel:function(){return!0},canEnablePageLink:function(){return!1},getButtonLabel:function(e){return e<0?o.BUTTON.BACK:null},checkParentNestedShare:function(){var e=this.shareModel.get(this.shareModel.DP.NESTED_SHARES),t=!1;return e&&Object.keys(e).length&&(t=!0),t}})}),define("text!templates/wizards/fileserver/ShareSMBSettingsPage.html",[],function(){return'<form>\n  <div class="smbProtocol">\n    <% if (isMultiProtocol) { %>\n      <section class="smb-nfs-title">\n        <h5 data-ntnx-title>\n          <%= i18n(\'smb_protocol\') %>\n        </h5>\n      </section>\n    <% } %>\n    \x3c!-- Enable access based enumeration flag--\x3e\n    <section class="smbContainer">\n      <div data-ntnx-form-inline class="input-tooltip">\n        <%= Components.checkbox({\n            jsClasses : \'enableAbe\',\n            checked : abeCheck,\n            labelText: i18n(\'access_based_enumeration\')\n          })\n        %>\n        <span class="nutanixMoreInfo"\n          data-tooltip-classes="-nudge-up"\n          data-tooltip-container="body"\n          data-tooltip-title="<%= i18n(\'access_based_enumeration_message\') %>"></span>\n      </div>\n      \x3c!-- Enable previous version flag--\x3e\n      <section data-ntnx-section class="ssrContainer">\n        <div data-ntnx-form-inline class="input-tooltip">\n          <%= Components.checkbox({\n              jsClasses : \'smbEnablePreviousVersion\',\n              checked : enablePreviousVersion,\n              labelText: i18n(\'self_service_restore\'),\n              dataTestAttribute: \'sharesmbsettingspage_checkbox_enable\'\n            })\n          %>\n          <span class="nutanixMoreInfo"\n            data-tooltip-classes="-nudge-up"\n            data-tooltip-container="body"\n            data-tooltip-title="<%= i18n(\'windows_previous_versions_message\') %>"></span>\n        </div>\n      </section>\n      \x3c!-- Enable file blocking flag--\x3e\n      <section data-ntnx-section class="smbFileBlockingContainer">\n        <div data-ntnx-form-inline class="input-tooltip">\n          <%= Components.checkbox({\n              jsClasses : \'smbFileBlockingExtensions\',\n              checked : fileBlockingExtensions,\n              labelText: i18n(\'blocked_file_types\'),\n              dataTestAttribute: \'sharesmbsettingspage_checkbox_file_blocking\'\n            })\n          %>\n          <span class="nutanixMoreInfo"\n            data-tooltip-classes="-nudge-up"\n            data-tooltip-container="body"\n            data-tooltip-title="<%= i18n(\'blocked_file_types_message\') %>"></span>\n        </div>\n        <div class="blockingFileTypesInputContainer\n          <% if (!fileBlockingExtensions) { %>\n            hidden\n          <% } %>\n        ">\n          <label data-ntnx-label>\n            <%= i18n(\'blocked_file_types_label\') %>\n          </label>\n          <input type="text" class="blockingFileTypes" value="<%= types %>"\n              data-test="sharesmbsettingspage_input_file_blocking">\n          <div data-ntnx-hint>\n            <%= i18n(\'blocked_file_types_comment\') %>\n          </div>\n        </div>\n        <div data-ntnx-hint class="blockingFileTypesTextContainer\n          <% if (fileBlockingExtensions) { %>\n            hidden\n          <% } %>\n        ">\n          <% if (fsFileBlockingExtensions) { %>\n            <%=  fsBlockedFileTypesComment %>\n          <% } else { %>\n            <%= i18n(\'blocked_file_types_hint\') %>\n          <% } %>\n        </div>\n      </section>\n    </section>\n    \x3c!-- Enable smb encrypt messages flag--\x3e\n    <% if (isFsPostThreeDotSix) { %>\n      <section data-ntnx-section class="smbEncryptionContainer">\n        <div data-ntnx-form-inline class="input-tooltip">\n          <%= Components.checkbox({\n              jsClasses : \'enableSmbEncryption\',\n              checked : smbEncryptionCheck,\n              labelText: i18n(\'encrypt_smb_message\'),\n              dataTestAttribute: \'sharesmbsettingspage_checkbox_smb_encrypt\'\n            })\n          %>\n          <span class="nutanixMoreInfo"\n            data-tooltip-classes="-nudge-up"\n            data-tooltip-container="body"\n            data-tooltip-title="<%= i18n(\'encrypt_smb_message_info\') %>"></span>\n        </div>\n        <section data-ntnx-section class="smbEncryptWarningContainer hidden">\n          <div class="smbEncryptWarning"></div>\n        </section>\n      </section>\n    <% } %>\n  </div>\n</form>\n'}),define("views/wizards/fileserver/ShareSMBSettingsPage",["views/basecomponents/BaseSubView","utils/AppConstants","utils/CommonTemplates","utils/FileServerUtil","text!templates/wizards/fileserver/ShareSMBSettingsPage.html"],function(e,t,i,n,s){"use strict";return e.extend({name:"ShareSMBSettingsPage",events:{"click  .smbFileBlockingExtensions":"onClickFileBlockingExtensions","click  .enableSmbEncryption":"onClickSmbEncrypt"},template:_.template(s),initialize:function(t){e.prototype.initialize.apply(this,arguments),this.model=this.model[0],this.fsModels=t.model[1],this.parent=t.parent},render:function(){this.isMultiProtocol=this.parent.isMultiProtocol,this.primaryProtocol=this.model.get(this.model.DP.PROTOCOL_TYPE),this.secondaryProtocolType=this.model.get(this.model.DP.SECONDARY_PROTOCOL_TYPE),this.isFsPostSabine=this.parent.isFsPostSabine,this.isSmbSsrEnabled=!this.isFsPostSabine||this.primaryProtocol===t.FS_PROTOCOLS.SMB&&this.isFsPostSabine&&this.secondaryProtocolType===t.FS_PROTOCOLS.INCOMPATIBLE,this.isSmbFileBlockingEnabled=!this.isMultiProtocol&&this.parent.isFileBlockingSupported,this.protocol=this.parent.protocol,this.isFsPostThreeDotSix=n.compareAFSversion(this.parent.fsModel,t.FILE_SERVER_VERSIONS.THREE_DOT_SIX)>=0;var e=this.template(this.vtOptions({abeCheck:this.model.get(this.model.DP.ENABLE_ABE),enablePreviousVersion:this.model.get(this.model.DP.WINDOWS_PREVIOUS_VERSION),fileBlockingExtensions:this.parent.fileTypes&&this.parent.fileTypes.length,types:this.parent.fileTypes&&this.parent.fileTypes.join(", ")||"",fsFileBlockingExtensions:this.parent.fsBlockedfileTypes&&this.parent.fsBlockedfileTypes.length,fsBlockedFileTypesComment:this.i18ns("fs_blocked_file_types_comment",this.parent.fsBlockedfileTypes&&this.parent.fsBlockedfileTypes.join(", ")||""),isMultiProtocol:this.isMultiProtocol,isFsPostThreeDotSix:!1,smbEncryptionCheck:this.model.get(this.model.DP.ENABLE_SMB3_ENCRYPTION)}));this.$el.html(e),this.model.get(t.IS_NESTED_SHARE)||this.model.get(this.model.DP.PARENT_SHARE_UUID)?(this.$(".enablePreviousVersion").attr("disabled","disabled"),this.parent.showInfo(this.i18n("nested_share_ssr_info"))):this.$(".enablePreviousVersion").removeAttr("disabled"),this.parent.hideContainer(this.$(".ssrContainer"),this.isSmbSsrEnabled),this.parent.hideContainer(this.$(".smbFileBlockingContainer"),this.isSmbFileBlockingEnabled),this.initializeMoreInfo()},initializeMoreInfo:function(){this.$(".nutanixMoreInfo").nutanixMoreInfo({parseDataAttrs:!0})},onClickFileBlockingExtensions:function(){this.parent.showHideBlockingTypes(this.$(".smbFileBlockingExtensions"),this)},onPageTransition:function(){var e=this,t=this.getInputs();if(this.model.set(this.model.DP.ENABLE_ABE,t.enableAccessBasedEnumeration),this.model.set(this.model.DP.ENABLE_SMB3_ENCRYPTION,t.enableSmbEncryption),this.isSmbSsrEnabled&&this.model.set(this.model.DP.WINDOWS_PREVIOUS_VERSION,t.enablePreviousVersion),this.isSmbFileBlockingEnabled&&this.parent.validateFileBlocking(this.$(".smbFileBlockingExtensions"),this))return!1;if(!this.isMultiProtocol){var i=[this.model.DP.AUTHENTICATION_TYPE,this.model.DP.DEFAULT_SHARE_ACCESS_TYPE,this.model.DP.ANONYMOUS_UID,this.model.DP.ANONYMOUS_GID,this.model.DP.SQUASH_TYPE,this.model.DP.CLIENT_READ_WRITE,this.model.DP.CLIENT_READ_ONLY,this.model.DP.CLIENT_NO_ACCESS];this.isSmbFileBlockingEnabled||i.push(this.model.DP.FILE_BLOCKING_EXTENSIONS),_.each(i,function(t){e.model.unset(t)})}return!0},getInputs:function(){var e={};return e.enableAccessBasedEnumeration=this.$(".enableAbe").is(":checked"),e.enablePreviousVersion=this.$(".smbEnablePreviousVersion").is(":checked"),e.enableSmbEncryption=this.$(".enableSmbEncryption").is(":checked"),e},getParentShareName:function(){return this.model.get(this.model.DP.SHARE_PATH).split("/")[1]},onClickSmbEncrypt:function(){var e=this,n=this.i18n("encrypt_smb_warning"),s=i.WARNING({msg:n});this.$(".enableSmbEncryption").prop("checked")?(this.$(".smbEncryptWarning").html(s),this.$(".smbEncryptWarningContainer").removeClass("hidden")):this.$(".smbEncryptWarningContainer").addClass("hidden"),setTimeout(function(){e.parent.getWizard().triggerAction(t.MODAL.ACT.AS_REBUILD)},500)}})}),define("text!templates/wizards/fileserver/ShareNFSSettingsPage.html",[],function(){
return'<form>\n  <div class="nfsProtocol">\n    <% if (isMultiProtocol) { %>\n      <section class="smb-nfs-title">\n        <h5 data-ntnx-title>\n          <%= i18n(\'nfs_protocol\') %>\n        </h5>\n      </section>\n    <% } %>\n    <section class="nfsContainer">\n      <label data-ntnx-label>\n        <%= i18n(\'authentication\') %>\n      </label>\n      <%= Components.select({\n        jsClasses: \'comboAuthentication\',\n        options: authenticationOptions,\n        useBrowserSelect: true\n      }) %>\n      <section data-ntnx-section class="authWarningContainer hidden">\n        <div class="authWarning"></div>\n      </section>\n    </section>\n    <section data-ntnx-section>\n      <label data-ntnx-label>\n        <%= i18n(\'default_access\') %>\n        <a data-ntnx-label-flag\n          class="add-access addExceptions addExceptionsTab">\n          <%= Components.icon(\'plus\', \'-small -inline\') %>\n          <%= i18n(\'add_exceptions\') %>\n        </a>\n      </label>\n      <%= Components.select({\n        jsClasses: \'comboAccess\',\n        options: accessOptions\n      }) %>\n      <div class=\'addExceptionsContent\' style=\'display: none;\'>\n        \x3c!-- Exceptions --\x3e\n        <section data-ntnx-section class="readWriteContainer">\n          <label data-ntnx-label><%= i18n(\'read_write_access\') %>\n          </label>\n          <textarea type="text" class="readWriteException"\n            placeholder="<%= i18n(\'read_write_placeholder\') %>"></textarea>\n        </section>\n        <section data-ntnx-section class="readOnlyContainer">\n          <label data-ntnx-label><%= i18n(\'read_only_access\') %>\n          </label>\n          <textarea type="text" class="readOnlyException"\n            placeholder="<%= i18n(\'read_only_placeholder\') %>"></textarea>\n        </section>\n        <section data-ntnx-section class="noAccessContainer">\n          <label data-ntnx-label><%= i18n(\'no_access_access\') %>\n          </label>\n          <textarea type="text" class="noAccessException"\n            placeholder="<%= i18n(\'no_access_placeholder\') %>"></textarea>\n        </section>\n      </div>\n    </section>\n    <section data-ntnx-section class="ssrContainer">\n      <div data-ntnx-form-inline class="input-tooltip">\n        <%= Components.checkbox({\n            jsClasses : \'nfsEnablePreviousVersion\',\n            checked : enablePreviousVersion,\n            labelText: i18n(\'self_service_restore\'),\n            dataTestAttribute: \'sharenfssettingspage_checkbox_enable\'\n          })\n        %>\n        <span class="nutanixMoreInfo"\n          data-tooltip-classes="-nudge-up"\n          data-tooltip-container="body"\n          data-tooltip-title="<%= i18n(\'windows_previous_versions_message\') %>"></span>\n      </div>\n    </section>\n    \x3c!-- Enable file blocking flag--\x3e\n    <section data-ntnx-section class="nfsFileBlockingContainer">\n      <div data-ntnx-form-inline class="input-tooltip">\n        <%= Components.checkbox({\n            jsClasses : \'nfsFileBlockingExtensions\',\n            checked : fileBlockingExtensions,\n            labelText: i18n(\'blocked_file_types\'),\n            dataTestAttribute: \'sharenfssettingspage_checkbox_file_blocking\'\n          })\n        %>\n        <span class="nutanixMoreInfo"\n          data-tooltip-classes="-nudge-up"\n          data-tooltip-container="body"\n          data-tooltip-title="<%= i18n(\'blocked_file_types_message\') %>"></span>\n      </div>\n      <div class="blockingFileTypesInputContainer\n        <% if (!fileBlockingExtensions) { %>\n          hidden\n        <% } %>\n      ">\n        <label data-ntnx-label>\n          <%= i18n(\'blocked_file_types_label\') %>\n        </label>\n        <input type="text" class="blockingFileTypes" value="<%= types %>"\n            data-test="sharenfssettingspage_input_file_blocking">\n        <div data-ntnx-hint>\n          <%= i18n(\'blocked_file_types_comment\') %>\n        </div>\n      </div>\n      <div data-ntnx-hint class="blockingFileTypesTextContainer\n        <% if (fileBlockingExtensions) { %>\n          hidden\n        <% } %>\n      ">\n        <% if (fsFileBlockingExtensions) { %>\n          <%=  fsBlockedFileTypesComment %>\n        <% } else { %>\n          <%= i18n(\'blocked_file_types_hint\') %>\n        <% } %>\n      </div>\n    </section>\n\n    <section data-ntnx-section class="advancedSettingsContainer">\n      <div data-ntnx-form-inline>\n        <%= Components.checkbox({\n          jsClasses: \'advancedSettings\',\n          labelText: i18n(\'advanced_nfs_settings\')\n        }) %>\n      </div>\n      <div class="advancedSettingsContent" style="display: none;">\n        \x3c!-- Preferred Domain Controller --\x3e\n        <section data-ntnx-section="type-half">\n          <label data-ntnx-label><%= i18n(\'anonymous_uid\') %>\n          </label>\n          <input type="text" class="anonymousUid">\n        </section>\n        <section data-ntnx-section="type-half">\n          <label data-ntnx-label><%= i18n(\'anonymous_gid\') %>\n          </label>\n          <input type="text" class="anonymousGid">\n        </section>\n        <section data-ntnx-section>\n          <label data-ntnx-label>\n            <%= i18n(\'squash\') %>\n          </label>\n          <%= Components.select({\n            jsClasses: \'comboSquash\',\n            options: squashOptions\n          }) %>\n        </section>\n      </div>\n    </section>\n  </div>\n</form>\n'}),define("views/wizards/fileserver/ShareNFSSettingsPage",["views/basecomponents/BaseSubView","managers/I18nManager","utils/AppConstants","utils/ValidationUtil","utils/CommonTemplates","text!templates/wizards/fileserver/ShareNFSSettingsPage.html"],function(e,t,i,n,s,a){"use strict";var r=[i.FS_AUTH_TYPES.KERBEROS,i.FS_AUTH_TYPES.KERBEROS_5I,i.FS_AUTH_TYPES.KERBEROS_5P],o=[{value:i.ACCESS_TYPES.READ_WRITE,name:t.t("ShareNFSSettingsPage","read_write")},{value:i.ACCESS_TYPES.READ_ONLY,name:t.t("ShareNFSSettingsPage","read_only")},{value:i.ACCESS_TYPES.NO_ACCESS,name:t.t("ShareNFSSettingsPage","no_access")}],l=[{value:i.FS_SQUASH_TYPES.ROOT_SQUASH,name:t.t("ShareNFSSettingsPage","root_squash")},{value:i.FS_SQUASH_TYPES.NONE,name:t.t("ShareNFSSettingsPage","none")},{value:i.FS_SQUASH_TYPES.ALL_SQUASH,name:t.t("ShareNFSSettingsPage","all_squash")}];return e.extend({name:"ShareNFSSettingsPage",prevProtocol:null,events:{"click   .addExceptions":"onAddExceptions","change  .comboAccess":"changeExceptionsTile","change  .advancedSettings":"onToggleAdvancedSettings","change  .comboAuthentication":"onChangeAuthentication","click   .nfsFileBlockingExtensions":"onClickFileBlockingExtensions"},template:_.template(a),initialize:function(t){e.prototype.initialize.apply(this,arguments),this.model=this.model[0],this.authenticationType=this.model.get(this.model.DP.AUTHENTICATION_TYPE),this.fsModels=t.model[1],this.parent=t.parent},render:function(){var e=this;this.isMultiProtocol=this.parent.isMultiProtocol,this.primaryProtocol=this.model.get(this.model.DP.PROTOCOL_TYPE),this.secondaryProtocolType=this.model.get(this.model.DP.SECONDARY_PROTOCOL_TYPE),this.isFsPostSabine=this.parent.isFsPostSabine,this.isNfsSsrEnabled=this.primaryProtocol===i.FS_PROTOCOLS.NFS&&this.isFsPostSabine&&this.secondaryProtocolType===i.FS_PROTOCOLS.INCOMPATIBLE,this.isNfsFileBlockingEnabled=!this.isMultiProtocol&&this.parent.isFileBlockingSupported,this.protocol=this.parent.protocol,this.fsModel=this.fsModels.models.find(function(t){return t.get(t.DP.UUID)===e.model.get(e.model.DP.FILE_SERVER_UUID)});var n=this.fsModel&&this.fsModel.getValue(this.fsModel.DP.NAME_SERVICE_CONFIG+"."+this.fsModel.DP.AD_DETAILS),s=n&&n[this.fsModel.DP.PROTOCOL_TYPE];this.enableKerberos=s&&s.includes(i.FS_PROTOCOLS.NFS);var a=[{value:i.FS_AUTH_TYPES.SYSTEM,name:t.t("ShareNFSSettingsPage","system")},{value:i.FS_AUTH_TYPES.NONE,name:t.t("ShareNFSSettingsPage","none")},{value:i.FS_AUTH_TYPES.KERBEROS,name:t.t("ShareNFSSettingsPage","kerberos")},{value:i.FS_AUTH_TYPES.KERBEROS_5I,name:t.t("ShareNFSSettingsPage","kerberos_5i")},{value:i.FS_AUTH_TYPES.KERBEROS_5P,name:t.t("ShareNFSSettingsPage","kerberos_5p")}],c=a.slice();this.enableKerberos?_.each(c,function(e){e&&r.indexOf(e.value)>=0&&(e.disabled=!1)}):_.each(c,function(e){e&&r.indexOf(e.value)>=0&&(e.disabled=!0)}),this.primaryProtocol===i.FS_PROTOCOLS.SMB&&_.each(c,function(e){e.value===i.FS_AUTH_TYPES.NONE&&(e.disabled=!0)});var u=c,d=this.template(this.vtOptions({authenticationOptions:u,accessOptions:o,squashOptions:l,fileBlockingExtensions:this.parent.fileTypes&&this.parent.fileTypes.length,types:this.parent.fileTypes&&this.parent.fileTypes.join(", ")||"",fsFileBlockingExtensions:this.parent.fsBlockedfileTypes&&this.parent.fsBlockedfileTypes.length,fsBlockedFileTypesComment:this.i18ns("fs_blocked_file_types_comment",this.parent.fsBlockedfileTypes&&this.parent.fsBlockedfileTypes.join(", ")||""),enablePreviousVersion:this.model.get(this.model.DP.WINDOWS_PREVIOUS_VERSION),isMultiProtocol:this.isMultiProtocol}));this.$el.html(d),this.model.get(i.IS_NESTED_SHARE)||this.model.get(this.model.DP.PARENT_SHARE_UUID)?(this.$(".enablePreviousVersion").attr("disabled","disabled"),this.parent.showInfo(this.i18n("nested_share_ssr_info"))):this.$(".enablePreviousVersion").removeAttr("disabled"),this.parent.hideContainer(this.$(".ssrContainer"),this.isNfsSsrEnabled),this.parent.hideContainer(this.$(".nfsFileBlockingContainer"),this.isNfsFileBlockingEnabled);var h=this.model.get(this.model.DP.CLIENT_READ_WRITE),p=this.model.get(this.model.DP.CLIENT_READ_ONLY),T=this.model.get(this.model.DP.CLIENT_NO_ACCESS);this.$(".comboAuthentication").val(this.model.get(this.model.DP.AUTHENTICATION_TYPE)),this.$(".comboAccess").val(this.model.get(this.model.DP.DEFAULT_SHARE_ACCESS_TYPE)),this.$(".readWriteException").val(h),this.$(".readOnlyException").val(p),this.$(".noAccessException").val(T),this.$(".anonymousUid").val(this.model.get(this.model.DP.ANONYMOUS_UID)),this.$(".anonymousGid").val(this.model.get(this.model.DP.ANONYMOUS_GID)),this.$(".comboSquash").val(this.model.get(this.model.DP.SQUASH_TYPE)),this.$(".comboAuthentication").change(),(h||p||T)&&this.$(".addExceptions").click(),this.onChangeAuthentication(),this.isMultiProtocol&&this.primaryProtocol===i.FS_PROTOCOLS.SMB?this.$(".advancedSettingsContainer").hide():this.$(".advancedSettingsContainer").show(),this.isMultiProtocol&&this.primaryProtocol===i.FS_PROTOCOLS.SMB?this.$(".advancedSettingsContainer").hide():this.$(".advancedSettingsContainer").show()},initializeMoreInfo:function(){this.$(".nutanixMoreInfo").nutanixMoreInfo({parseDataAttrs:!0})},onAddExceptions:function(e){this.$(".addExceptionsTab").hide(),this.$(".addExceptionsContent").show(),this.changeExceptionsTile()},onChangeAuthentication:function(e){var t=this.$(".comboAuthentication").val(),n=void 0,a=void 0,r=this.isMultiProtocol&&this.enableKerberos;this.isSysMultiProtocolNFSAd=!1,this.$(".authWarningContainer").hasClass("hidden")||this.$(".authWarningContainer").addClass("hidden"),t.indexOf("KERBEROS")>=0&&!this.parent.fsDnsVerified?n=this.i18n("kerberos_warning"):t.toUpperCase()===i.FS_AUTH_TYPES.NONE?n=r?this.i18n("auth_smb_none_notif"):this.i18n("auth_none_notif"):t.toUpperCase()===i.FS_AUTH_TYPES.SYSTEM&&r&&!this.parent.isUserMappingConfigured&&(n=this.i18n("auth_none_system_notif"),this.isSysMultiProtocolNFSAd=!0),n&&(a=this.isSysMultiProtocolNFSAd?s.WARNING({msg:n}):s.INFO({msg:n}),this.$(".authWarning").html(a),this.$(".authWarningContainer").removeClass("hidden"))},changeExceptionsTile:function(){switch(this.$(".comboAccess").val()){case i.ACCESS_TYPES.READ_WRITE:this.$(".readWriteContainer").hide(),this.$(".readWriteContainer").val(""),this.$(".readOnlyContainer, .noAccessContainer").show();break;case i.ACCESS_TYPES.READ_ONLY:this.$(".readWriteContainer, .noAccessContainer").show(),this.$(".readOnlyContainer").hide(),this.$(".readOnlyContainer").val("");break;case i.ACCESS_TYPES.NO_ACCESS:this.$(".readWriteContainer, .readOnlyContainer").show(),this.$(".noAccessContainer").hide(),this.$(".noAccessContainer").val("")}this.parent.getWizard().reSizePopup()},onToggleAdvancedSettings:function(e){var t=this,n=this.$(".advancedSettingsContent");n.slideToggle("fast",function(){t.parent.getWizard().triggerAction(i.MODAL.ACT.AS_REBUILD),n.is(":visible")&&t.parent.getWizard().scrollToElement(n,".antiscroll-inner")})},onClickFileBlockingExtensions:function(){this.parent.showHideBlockingTypes(this.$(".nfsFileBlockingExtensions"),this)},onPageTransition:function(){var e=this.getInputs();if(this.isNfsSsrEnabled&&this.model.set(this.model.DP.WINDOWS_PREVIOUS_VERSION,e.enablePreviousVersion),this.isNfsFileBlockingEnabled&&this.parent.validateFileBlocking(this.$(".nfsFileBlockingExtensions"),this))return!1;var t=this.validateAndHandleError(e);return t?(this.parent.showError(t),!1):(this.completeTransition(e),!0)},completeTransition:function(e){var t=this;if(this.model.set(e),!this.isMultiProtocol){var i=[this.model.DP.ENABLE_ABE,this.model.DP.ENABLE_CONCURRENT_READS,this.model.DP.CASE_SENSITIVE_NAMESPACE,this.model.DP.ENABLE_SMB3_ENCRYPTION];this.isFsPostSabine||i.push(this.model.DP.WINDOWS_PREVIOUS_VERSION),this.isNfsFileBlockingEnabled||i.push(this.model.DP.FILE_BLOCKING_EXTENSIONS),_.each(i,function(e){t.model.unset(e)})}},getInputs:function(){var e={};switch(e.authenticationType=this.$(".comboAuthentication").val(),e.defaultShareAccessType=this.$(".comboAccess").val(),e.anonymousUid=this.$(".anonymousUid").val(),e.anonymousGid=this.$(".anonymousGid").val(),e.squashType=this.$(".comboSquash").val(),e.enablePreviousVersion=this.$(".nfsEnablePreviousVersion").is(":checked"),e.defaultShareAccessType){case i.ACCESS_TYPES.READ_WRITE:e.clientReadWrite="",e.clientReadOnly=this.$(".readOnlyException").val(),e.clientNoAccess=this.$(".noAccessException").val();break;case i.ACCESS_TYPES.READ_ONLY:e.clientReadWrite=this.$(".readWriteException").val(),e.clientReadOnly="",e.clientNoAccess=this.$(".noAccessException").val();break;case i.ACCESS_TYPES.NO_ACCESS:e.clientReadWrite=this.$(".readWriteException").val(),e.clientReadOnly=this.$(".readOnlyException").val(),e.clientNoAccess=""}return e},validateAndHandleError:function(e){var t=this.i18n("invalid_input_msg");return this.$(".anonymousGid, .anonymousUid, .readWriteException,.readOnlyException, .noAccessException").removeClass("input-error"),e.anonymousGid.length>0&&!n.isNumber(e.anonymousGid,"type=integer").valid&&(t+=this.i18n("anonymous_gid"),this.$(".anonymousGid").addClass("input-error")),e.anonymousUid.length>0&&!n.isNumber(e.anonymousUid,"type=integer").valid&&(t+=this.i18n("anonymous_uid"),this.$(".anonymousUid").addClass("input-error")),e.clientReadWrite.length>0&&(this.checkRepeatedIp(e.clientReadWrite)&&(t+=this.i18n("repeated_read_write"),this.$(".readWriteException").addClass("input-error")),this.checkSpecialChar(e.clientReadWrite)&&(t+=this.i18n("invalid_exception_input"),this.$(".readWriteException").addClass("input-error"))),e.clientReadOnly.length>0&&(this.checkRepeatedIp(e.clientReadOnly)&&(t+=this.i18n("repeated_read_only"),this.$(".readOnlyException").addClass("input-error")),this.checkSpecialChar(e.clientReadOnly)&&(t+=this.i18n("invalid_exception_input"),this.$(".readOnlyException").addClass("input-error"))),e.clientNoAccess.length>0&&(this.checkRepeatedIp(e.clientNoAccess)&&(t+=this.i18n("repeated_no_access"),this.$(".noAccessException").addClass("input-error")),this.checkSpecialChar(e.clientNoAccess)&&(t+=this.i18n("invalid_exception_input"),this.$(".noAccessException").addClass("input-error"))),t!==this.i18n("invalid_input_msg")&&t},checkRepeatedIp:function(e){e=e.replace(/\s/g,"");var t=e.split(",");return _.uniq(t).length!==t.length},checkSpecialChar:function(e){var t=/[ !@#$%^&*()+=[\]{};':"\\|,<>\/?]/,i=/[ !@#$%^&()+={};':"\\|,<>\/]/,s=e.split(","),a=void 0,r=void 0;return _.some(s,function(e){return e=e.trim(),a=e.indexOf("/"),!e||("@"===e[0]?t.test(e.slice(1)):a>0?(r=e.split("/"),2!==r.length||!n.isValidIP(r[0])||!n.isPositiveInt(parseInt(r[1],10))||parseInt(r[1],10)>32||void 0):i.test(e))})}})}),define("text!templates/wizards/fileserver/ShareMultiprotocolSettingsPage.html",[],function(){return"<form>\n  <div class=\"smbProtocol\">\n    <section>\n      <h5 data-ntnx-title>\n        <%= i18n('multiprotocol_access') %>\n      </h5>\n      <p data-ntnx-section=\"type-text\">\n        <%= i18n('multiprotocol_access_desc') %>\n      </p>\n    </section>\n\n    <section data-ntnx-section>\n      \x3c!-- ENG-185236 Temporarily comment out --\x3e\n\x3c!--       <div data-ntnx-form-inline>\n        <%= Components.checkbox(\n          {\n            jsClasses : 'enableReads',\n            checked : enableReads,\n            labelText: i18n('enable_concurrent_reads')\n          })\n        %>\n      </div> --\x3e\n\n      <div data-ntnx-form-inline class=\"input-tooltip\">\n        <%=Components.checkbox({\n          jsClasses : 'enableSimultanesousAccess',\n            checked : enableSimultanesousAccess,\n          labelText: i18n('simultaneous_access')\n        })%>\n        <div class=\"nutanixMoreInfo\"\n          data-tooltip-classes=\"-nudge-up\"\n          data-tooltip-container=\"body\"\n          data-tooltip-title=\"<%= i18n('simultaneous_access_tooltip') %>\">\n        </div>\n      </div>\n\n      \x3c!-- Show checkboxes if share is Native SMB--\x3e\n      <% if (isNativeSmb) { %>\n      \x3c!-- Will add it back when backend supports case sensitive option --\x3e\n        \x3c!-- <div data-ntnx-form-inline class=\"input-tooltip\">\n          <%= Components.checkbox(\n            {\n              jsClasses : 'caseSensitive',\n              checked : caseSensitive,\n              labelText: i18n('case_sensitive_namespace')\n            })\n          %>\n          <div class=\"nutanixMoreInfo\"\n            data-tooltip-classes=\"-nudge-up\"\n            data-tooltip-container=\"body\"\n            data-tooltip-title=\"<%= i18n('case_sensitive_tooltip') %>\">\n          </div>\n        </div> --\x3e\n\n        <div data-ntnx-form-inline>\n          <%= Components.checkbox(\n            {\n              jsClasses : 'allowSymlink',\n              checked : allowSymlink,\n              labelText: i18n('allow_symlink')\n            })\n          %>\n        </div>\n      <% } %>\n    </section>\n  </div>\n</form>\n"}),define("views/wizards/fileserver/ShareMultiprotocolSettingsPage",["views/basecomponents/BaseSubView","utils/AppConstants","text!templates/wizards/fileserver/ShareMultiprotocolSettingsPage.html"],function(e,t,i){"use strict";return e.extend({name:"ShareMultiprotocolSettingsPage",template:_.template(i),initialize:function(t){e.prototype.initialize.apply(this,arguments),this.model=this.model[0],this.authenticationType=this.model.get(this.model.DP.AUTHENTICATION_TYPE),this.fsModels=t.model[1],this.parent=t.parent},render:function(){this.currentProtocal=this.model.get(this.model.DP.PROTOCOL_TYPE);var e=!(!this.model.isNew()&&null!==this.model.get(this.model.DP.ENABLE_CONCURRENT_READS))||this.model.get(this.model.DP.ENABLE_CONCURRENT_READS);this.isNativeSmb=this.model.get(this.model.DP.PROTOCOL_TYPE)===t.FS_PROTOCOLS.SMB;var i=this.template(this.vtOptions({enableReads:e,isNativeSmb:this.isNativeSmb,caseSensitive:this.model.get(this.model.DP.CASE_SENSITIVE_NAMESPACE),enableSimultanesousAccess:this.model.get(this.model.DP.SIMULTANEOUS_ACCESS_ENABLED),allowSymlink:this.model.get(this.model.DP.SYMLINK_CREATION_ENABLED)}));this.$el.html(i),this.initializeMoreInfo()},initializeMoreInfo:function(){this.$(".nutanixMoreInfo").nutanixMoreInfo({parseDataAttrs:!0})},mapNfsClientAccess:function(){switch(this.model.get(this.model.DP.DEFAULT_SHARE_ACCESS_TYPE)){case t.ACCESS_TYPES.READ_WRITE:return this.i18n("read_write");case t.ACCESS_TYPES.READ_ONLY:return this.i18n("read_only");case t.ACCESS_TYPES.NO_ACCESS:return this.i18n("no_access")}},onPageTransition:function(){var e=this.getInputs();return this.completeTransition(e),!0},completeTransition:function(e){this.model.set({simultaneousAccessEnabled:e.simultaneousAccessEnabled,symlinkCreationEnabled:e.symlinkCreationEnabled})},getInputs:function(){var e={};return e.concurrentReadsEnabled=this.$(".enableReads").is(":checked"),e.simultaneousAccessEnabled=this.$(".enableSimultanesousAccess").is(":checked"),this.isNativeSmb&&(e.caseSensitiveNamespaceEnabled=this.$(".caseSensitive").is(":checked"),e.symlinkCreationEnabled=this.$(".allowSymlink").is(":checked")),e}})}),define("text!templates/wizards/fileserver/ShareSettingsPage.html",[],function(){return'<form>\n  <% if (isFsPostSabine) { %>\n    <section data-ntnx-section class="generalSsrConatiner general-ssr">\n      <% if (isMultiProtocol) { %>\n        <h5 data-ntnx-title class="smb-nfs-title">\n          <%= i18n(\'general\') %>\n        </h5>\n      <% } %>\n      \x3c!-- Enable previous version flag--\x3e\n      <section>\n  <% } else { %>\n    <section data-ntnx-section class="general-ssr">\n      <section>\n  <% } %>\n    <div data-ntnx-form-inline class="input-tooltip shareTypeContainer">\n      <%= Components.checkbox({\n          jsClasses : \'upgradeShareType\',\n          checked : isHomeShare,\n          labelText: i18n(\'share_type_label\')\n        })\n      %>\n      <span class="nutanixMoreInfo"\n        data-tooltip-classes="-nudge-up"\n        data-tooltip-container="body"\n        data-tooltip-title="<%= i18n(\'share_type_message\') %>"></span>\n    </div>\n    <div data-ntnx-hint class="shareTypeText share-type-text hidden"></div>\n  </section>\n  <% if (!isFsPostSabine) { %>\n    <section>\n  <% } %>\n  <% if (isFsPostSabine) { %>\n    \x3c!-- Enable previous version flag--\x3e\n    <% if (!isMultiNode) { %>\n      <section>\n    <% } else { %>\n      <section data-ntnx-section>\n    <% } %>\n        <div data-ntnx-form-inline class="input-tooltip ssrContainer">\n          <%= Components.checkbox({\n              jsClasses : \'enablePreviousVersion\',\n              checked : enablePreviousVersion,\n              labelText: i18n(\'self_service_restore\')\n            })\n          %>\n          <span class="nutanixMoreInfo"\n            data-tooltip-classes="-nudge-up"\n            data-tooltip-container="body"\n            data-tooltip-title="<%= i18n(\'windows_previous_versions_message\') %>"></span>\n        </div>\n      </section>\n    </section>\n  <% } %>\n\n  <section data-ntnx-section class="fileBlockingContainer">\n    <div data-ntnx-form-inline class="input-tooltip">\n      <%= Components.checkbox({\n          jsClasses : \'mpFileBlockingExtensions\',\n          checked : fileBlockingExtensions,\n          labelText: i18n(\'blocked_file_types\'),\n          dataTestAttribute: \'sharesettingspage_checkbox_file_blocking\'\n        })\n      %>\n      <span class="nutanixMoreInfo"\n        data-tooltip-classes="-nudge-up"\n        data-tooltip-container="body"\n        data-tooltip-title="<%= i18n(\'blocked_file_types_message\') %>"></span>\n    </div>\n    <div class="blockingFileTypesInputContainer\n      <% if (!fileBlockingExtensions) { %>\n        hidden\n      <% } %>\n    ">\n      <label data-ntnx-label>\n        <%= i18n(\'blocked_file_types_label\') %>\n      </label>\n      <input type="text" class="blockingFileTypes" value="<%= types %>"\n          data-test="sharesettingspage_input_file_blocking">\n      <div data-ntnx-hint>\n        <%= i18n(\'blocked_file_types_comment\') %>\n      </div>\n    </div>\n    <div data-ntnx-hint class="blockingFileTypesTextContainer\n      <% if (fileBlockingExtensions) { %>\n        hidden\n      <% } %>\n    ">\n      <% if (fsFileBlockingExtensions) { %>\n        <%=  fsBlockedFileTypesComment %>\n      <% } else { %>\n        <%= i18n(\'blocked_file_types_hint\') %>\n      <% } %>\n    </div>\n  </section>\n\n  <% if (isMultiProtocol) { %>\n    <section data-ntnx-section="type-separator">\n  <% } else if (isFsPostSabine || isMultiNode) { %>\n    <section data-ntnx-section>\n  <% } else { %>\n    <section>\n  <% } %>\n    <section class="smbSetting"></section>\n    <div data-ntnx-section="type-separator"\n      class="<%= isMultiProtocol ? \'\' : \'hidden\' %>"></div>\n    <section class="nfsSetting"></section>\n    <div data-ntnx-section="type-separator"\n      class="<%= isMultiProtocol ? \'\' : \'hidden\' %>"></div>\n    <section class="multiProtocolSetting"></section>\n  </section>\n</form>\n'}),define("views/wizards/fileserver/ShareSettingsPage",["views/basecomponents/wizards/BaseWizardPage","utils/AppConstants","utils/SubViewHelper","utils/FileServerUtil","views/wizards/fileserver/ShareSMBSettingsPage","views/wizards/fileserver/ShareNFSSettingsPage","views/wizards/fileserver/ShareMultiprotocolSettingsPage","text!templates/wizards/fileserver/ShareSettingsPage.html"],function(e,t,i,n,s,a,r,o){"use strict";var l=_.template('<span class="nutanixMoreInfo"\n      data-tooltip-classes="-nudge-up"\n      data-tooltip-container="body"\n      data-tooltip-title="<%= moreInfoText %>"></span>');return e.extend({name:"ShareSettingsPage",subViewHelper:null,events:{"click  .upgradeShareType":"onClickUpgradeShareType","click  .mpFileBlockingExtensions":"onClickFileBlockingExtensions"},template:_.template(o),initialize:function(t){e.prototype.initialize.apply(this,arguments),this.model=this.model[0],this.fsModels=t.model[1],this.subViewHelper=new i},render:function(){var e=this.model.get(this.model.DP.SECONDARY_PROTOCOL_TYPE);this.isMultiProtocol=e===t.FS_PROTOCOLS.NFS||e===t.FS_PROTOCOLS.SMB,this.primaryProtocol=this.model.get(this.model.DP.PROTOCOL_TYPE),this.authenticationType=this.model.get(this.model.DP.AUTHENTICATION_TYPE);var i=this.model.get(this.model.DP.PROTOCOL_TYPE),s=i;this.isMultiProtocol&&(s=s+"_"+e),this.isNestedShare=this.model.get(t.IS_NESTED_SHARE),this.fsModel=this.getWizard().subViewHelper.get(t.SHARE_PAGES.SHARE_BASIC_PAGE_ID).selectedFileServer,this.isUserMappingConfigured=this.getWizard().subViewHelper.get(t.SHARE_PAGES.SHARE_BASIC_PAGE_ID).isUserMappingConfigured,this.isFsPostSabine=n.compareAFSversion(this.fsModel,t.FILE_SERVER_VERSIONS.THREE_DOT_FIVE)>=0,this.isNotUpgradeToSabine=this.isFsPostSabine&&e!==t.FS_PROTOCOLS.INCOMPATIBLE,this.isFileBlockingSupported=n.compareAFSversion(this.fsModel,t.FILE_SERVER_VERSIONS.THREE_DOT_SIX)>=0&&!1,this.isMpFileBlockingEnabled=this.isMultiProtocol&&this.isFileBlockingSupported;var a=this.fsModel.get(this.fsModel.DP.NAME);if(this.fsChanged=this.fsName!==a,this.fsName=a,this.protocolChanged=this.protocol!==s,this.protocol=s,!this.protocolChanged&&!this.fsChanged)return this.subViewHelper.iterate("initializeMoreInfo"),this.getWizard().hasSubmitError=!1,void this.$(".nutanixMoreInfo").nutanixMoreInfo({parseDataAttrs:!0});this.setDnsVerifiedFlag();var r=[this.model,this.fsModels],o=this.model.get(this.model.DP.SHARE_TYPE)===t.FS_SHARE_TYPES.HOMES,l=void 0;this.fsModel.get(this.fsModel.DP.NVMS)&&(l=this.fsModel.get(this.fsModel.DP.NVMS).length>2),this.fileTypes=this.model.get(this.model.DP.FILE_BLOCKING_EXTENSIONS),this.fsBlockedfileTypes=this.fsModel.get(this.fsModel.DP.FILE_BLOCKING_EXTENSIONS);var c=this.template(this.vtOptions({isMultiProtocol:this.isMultiProtocol,isFsPostSabine:this.isNotUpgradeToSabine,isHomeShare:o,isMultiNode:l,enablePreviousVersion:this.model.get(this.model.DP.WINDOWS_PREVIOUS_VERSION),fileBlockingExtensions:this.fileTypes&&this.fileTypes.length,types:this.fileTypes&&this.fileTypes.join(", ")||"",fsFileBlockingExtensions:this.fsBlockedfileTypes&&this.fsBlockedfileTypes.length,fsBlockedFileTypesComment:this.i18ns("fs_blocked_file_types_comment",this.fsBlockedfileTypes&&this.fsBlockedfileTypes.join(", ")||""),update:!this.model.isNew()}));this.$el.html(c),this.model.isNew()||this.$(".upgradeShareType").attr("disabled",!0),this.renderProtocolView(r),this.hideUpgradeShareType(this.fsModel),this.isNotUpgradeToSabine&&this.disableSsr(),this.hideContainer(this.$(".fileBlockingContainer"),this.isMpFileBlockingEnabled),this.model.isNew()||this.$(".comboUsage").attr("disabled","disabled").off("click"),this.$(".nutanixMoreInfo").nutanixMoreInfo({parseDataAttrs:!0}),this.rebuild()},rebuild:function(){var e=this;setTimeout(function(){e.getWizard().triggerAction(t.MODAL.ACT.AS_REBUILD)},500)},setDnsVerifiedFlag:function(){if(n.compareAFSversion(this.fsModel,t.FILE_SERVER_VERSIONS.SPECTRE)>=0&&(this.isMultiProtocol||this.primaryProtocol===t.FS_PROTOCOLS.NFS)){var e=this.fsModel.get(this.fsModel.DP.DNS_ENTRIES);this.fsDnsVerified=0===_.filter(e,function(e){return!e.verified}).length&&e&&e[0]}},renderProtocolView:function(e){var i=this.model.get(this.model.DP.PROTOCOL_TYPE),n=i;switch(this.isMultiProtocol&&(n=t.FS_PROTOCOLS.NFS_SMB),this.subViewHelper.removeAll(),n){case t.FS_PROTOCOLS.SMB:this.renderSmbProtocolView(e);break;case t.FS_PROTOCOLS.NFS:this.renderNfsProtocolView(e);break;case t.FS_PROTOCOLS.NFS_SMB:this.renderSmbProtocolView(e),this.renderNfsProtocolView(e),this.isNestedShare||this.model.get(this.model.DP.PARENT_SHARE_UUID)||this.renderMultiProtocolView(e)}},disableSsr:function(){this.model.get(t.IS_NESTED_SHARE)||this.model.get(this.model.DP.PARENT_SHARE_UUID)?(this.$(".enablePreviousVersion").attr("disabled","disabled"),this.showInfo(this.i18n("nested_share_ssr_info"))):this.$(".enablePreviousVersion").removeAttr("disabled")},renderSmbProtocolView:function(e){var t=new s({model:e,el:this.$(".smbSetting"),parent:this});this.$el.append(t.render()),this.subViewHelper.register("shareSmbSettingsPage",t)},renderNfsProtocolView:function(e){var t=new a({model:e,el:this.$(".nfsSetting"),parent:this});this.$el.append(t.render()),this.subViewHelper.register("shareNfsSettingsPage",t)},renderMultiProtocolView:function(e){var t=new r({model:e,el:this.$(".multiProtocolSetting"),parent:this});this.$el.append(t.render()),this.subViewHelper.register("shareMultiprotocolSettingsPage",t)},onPageTransition:function(e){var i=this.subViewHelper.iterate("onPageTransition");if(!this.isNestedShare){var n=t.FS_SHARE_TYPES.GENERAL;this.$(".upgradeShareType").prop("checked")&&(n=t.FS_SHARE_TYPES.HOMES),this.model.set(this.model.DP.SHARE_TYPE,n)}this.isNotUpgradeToSabine&&this.model.set(this.model.DP.WINDOWS_PREVIOUS_VERSION,this.$(".enablePreviousVersion").is(":checked")),this.isMpFileBlockingEnabled&&this.validateFileBlocking(this.$(".mpFileBlockingExtensions"),this)||i.indexOf(!1)<0&&(this.authenticationType&&this.authenticationType!==this.model.get(this.model.DP.AUTHENTICATION_TYPE)?$.nutanixConfirm({title:this.i18n("update_auth_type_confirm_title"),msg:this.i18n("update_auth_type_confirm_msg"),context:this,yes:function(){e()},class:"-compact -red-confirm",yesText:this.i18n("yes"),noText:this.i18n("cancel")}):e())},validateFileBlocking:function(e,t){if(t.$(".blockingFileTypes").removeClass("input-error"),e.prop("checked")){var i=$.trim(t.$(".blockingFileTypes").val());if(n.checkSpaceInString(i))return this.showError(this.i18n("spaces_in_middle_msg")),!0;if(i.indexOf(".")>-1||i.indexOf("*")>-1)return this.showError(this.i18n("not_allowed_msg")),!0;var s=i&&i.replace(/ /g,"").split(",");if(!s.length)return this.showError(this.i18n("missing_input_msg")),t.$(".blockingFileTypes").addClass("input-error"),!0;this.model.set(this.model.DP.FILE_BLOCKING_EXTENSIONS,s)}else this.model.set(this.model.DP.FILE_BLOCKING_EXTENSIONS,[])},hideUpgradeShareType:function(e){var i=n.compareAFSversion(e,t.FILE_SERVER_VERSIONS.THREE_DOT_ONE)>=0,s=void 0;e.get(e.DP.NVMS)&&(s=e.get(e.DP.NVMS).length),i&&s<3||this.isNestedShare?this.$(".shareTypeContainer").hasClass("hidden")||(this.$(".shareTypeContainer").addClass("hidden"),this.$(".upgradeShareType").prop("checked",!1)):this.$(".shareTypeContainer").removeClass("hidden")},onClickUpgradeShareType:function(e){var i=this;this.$(".upgradeShareType").prop("checked")?(this.$(".shareTypeText").removeClass("hidden"),
this.showUpgradeShareTypeText()):this.$(".shareTypeText").hasClass("hidden")||this.$(".shareTypeText").addClass("hidden"),setTimeout(function(){i.getWizard().triggerAction(t.MODAL.ACT.AS_REBUILD)},500)},onClickFileBlockingExtensions:function(){this.showHideBlockingTypes(this.$(".mpFileBlockingExtensions"),this)},showHideBlockingTypes:function(e,t){e.prop("checked")?(t.$(".blockingFileTypesInputContainer").removeClass("hidden"),t.$(".blockingFileTypesTextContainer").hasClass("hidden")||t.$(".blockingFileTypesTextContainer").addClass("hidden")):(t.$(".blockingFileTypesInputContainer").hasClass("hidden")||t.$(".blockingFileTypesInputContainer").addClass("hidden"),t.$(".blockingFileTypesTextContainer").removeClass("hidden")),this.rebuild()},showUpgradeShareTypeText:function(){var e="",i=l(this.vtOptions({moreInfoText:this.i18n("nfsv4_text")})),n=l(this.vtOptions({moreInfoText:this.i18n("mmc_plugin_text")}));this.primaryProtocol===t.FS_PROTOCOLS.SMB?e=this.isMultiProtocol?this.i18ns("smb_nfs_text",n,i):this.i18ns("smb_only_text",i):this.primaryProtocol===t.FS_PROTOCOLS.NFS&&(e=this.isMultiProtocol?this.i18ns("nfs_smb_text",i,n):this.i18ns("nfs_only_text",i)),this.$(".shareTypeText").html(e),this.$(".nutanixMoreInfo").nutanixMoreInfo({parseDataAttrs:!0})},hideContainer:function(e,t){t?e.removeClass("hidden"):e.hasClass("hidden")||e.addClass("hidden")},canEnablePageLink:function(){return!1},getButtonLabel:function(e){return e<0?t.BUTTON.BACK:null},getSaveButtonLabel:function(){return this.model.isNew()?this.i18n("create"):this.i18n("save")},onPageCancel:function(){return!0}})}),define("text!templates/wizards/fileserver/ShareSummaryPage.html",[],function(){return"<section data-ntnx-section>\n  <table class=\"table\">\n    <tbody>\n      <tr>\n        <td><%= i18n('share_summary.file_server') %></td>\n        <td><%= fileServerName %></td>\n      </tr>\n      <tr>\n        <td><%= i18n('share_summary.share_name') %></td>\n        <td><%= shareName %></td>\n      </tr>\n      <tr>\n        <td><%= i18n('share_summary.share_path') %></td>\n        <td><%= sharePath %></td>\n      </tr>\n      <tr>\n        <td><%= i18n('share_summary.protocol') %></td>\n        <td><%= shareProtocol %></td>\n      </tr>\n      <tr>\n        <td><%= i18n('share_summary.max_size') %></td>\n        <td><%= shareSize %></td>\n      </tr>\n      <tr>\n        <td><%= i18n('share_summary.share_type') %></td>\n        <td><% if (enableShareOptimization) { %>\n            <%= i18n('share_summary.distributed') %>\n          <% } else { %>\n            <%= i18n('share_summary.standard') %>\n          <% } %> <span class=\"nutanixMoreInfo\"\n          data-tooltip-classes=\"-nudge-up\"\n          data-tooltip-container=\"body\"\n          data-tooltip-title=\"<%= i18n('share_summary.share_optimization_info') %>\">\n        </span></td>\n      </tr>\n      <% if (showBlockedFileTypes) { %>\n        <tr>\n          <td><%= i18n('share_summary.blocked_file_types') %></td>\n          <td><%= blockedFileTypes %></td>\n        </tr>\n      <% } %>\n      <% if (isFsPostThreeDotSix && showSmbProtocol) { %>\n        <tr>\n          <td><%= i18n('encrypt_smb_message') %>\n            <span class=\"nutanixMoreInfo\"\n            data-tooltip-classes=\"-nudge-up\"\n            data-tooltip-container=\"body\"\n            data-tooltip-title=\"<%= i18n('encrypt_smb_message_info') %>\">\n            </span>\n          </td>\n          <td>\n            <% if (enableSmbEncryption) { %>\n              <%= i18n('enabled') %>\n            <% } else { %>\n              <%= i18n('not_enabled') %>\n            <% } %>\n          </td>\n        </tr>\n      <% } %>\n    </tbody>\n  </table>\n</section>\n\n<section data-ntnx-section>\n  <h5 data-ntnx-title>\n    <%= i18n('table_title') %>\n  </h5>\n  <section data-ntnx-section>\n    <table class=\"table\">\n      <thead>\n        <tr>\n          <th><%= i18n('property') %></th>\n          <th><%= i18n('smb_protocol_clients') %></th>\n          <th><%= i18n('nfs_protocol_clients') %></th>\n        </tr>\n      </thead>\n      <tbody>\n        <tr>\n          <td><%= i18n('authentication') %></td>\n          <% if (showSmbProtocol) { %>\n            <td><%= i18n('kerberos') %></td>\n          <% } else { %>\n            <td rowspan=\"4\"><%= i18n('not_supported') %></td>\n          <% } %>\n          <% if (showNfsProtocol) { %>\n            <td><%= nfsAuthentication %></td>\n          <% } else { %>\n            <td rowspan=\"4\"><%= i18n('not_supported') %></td>\n          <% } %>\n        </tr>\n        <tr>\n          <td><%= i18n('client_access') %></td>\n          <% if (showSmbProtocol) { %>\n            <td><%= i18n('read_write') %></td>\n          <% } %>\n          <% if (showNfsProtocol) { %>\n            <td><%= nfsClientAccess %></td>\n          <% } %>\n        </tr>\n        <tr>\n          <td><%= i18n('abe') %></td>\n          <% if (showSmbProtocol) { %>\n            <td>\n              <% if (enableAbe) { %>\n                <%= i18n('enabled') %>\n              <% } else { %>\n                <%= i18n('disabled') %>\n              <% } %>\n            </td>\n          <% } %>\n          <% if (showNfsProtocol) { %>\n            <td><%= i18n('not_supported') %></td>\n          <% } %>\n        </tr>\n        <tr class=\"ssrContainer\">\n          <td><%= i18n('self_service_restore') %></td>\n            <td class=\"showSmbProtocol\">\n              <span class=\"enableSsr\"><%= i18n('enabled') %></span>\n              <span class=\"disableSsr\"><%= i18n('disabled') %></span>\n            </td>\n            <td class=\"showNfsProtocol\">\n              <% if (isFsPostSabine) { %>\n                <span class=\"enableSsr\"><%= i18n('enabled') %></span>\n                <span class=\"disableSsr\"><%= i18n('disabled') %></span>\n              <% } else { %>\n                <%= i18n('not_supported') %>\n              <% } %>\n            </td>\n        </tr>\n      </tbody>\n    </table>\n  </section>\n</section>\n\x3c!-- Show multiprotocol settings table if opted for multiprotocol--\x3e\n<% if (isMultiProtocol) { %>\n  <section data-ntnx-section>\n    <h5 data-ntnx-title>\n      <%= i18n('multiprotocol_settings') %>\n    </h5>\n    <section data-ntnx-section>\n      <table class=\"table\">\n        <thead>\n          <tr>\n            <th><%= i18n('property') %></th>\n            <th><%= i18n('status') %></th>\n          </tr>\n        </thead>\n        <tbody>\n          <tr>\n            <td><%= i18n('simultaneous_access') %></td>\n            <td>\n              <% if (enableSimultanesousAccess) { %>\n                <%= i18n('enabled') %>\n              <% } else { %>\n                <%= i18n('disabled') %>\n              <% } %>\n            </td>\n          </tr>\n          <% if (isNativeSmb) { %>\n            \x3c!-- Will add it back when backend supports case sensitive option --\x3e\n            \x3c!--<tr>\n              <td><%= i18n('case_sensitive') %></td>\n              <td>\n                <% if (caseSensitive) { %>\n                  <%= i18n('enabled') %>\n                <% } else { %>\n                  <%= i18n('disabled') %>\n                <% } %>\n              </td>\n            </tr> --\x3e\n            <tr>\n              <td><%= i18n('symlink') %></td>\n              <td>\n                <% if (allowSymlink) { %>\n                  <%= i18n('enabled') %>\n                <% } else { %>\n                  <%= i18n('disabled') %>\n                <% } %>\n              </td>\n            </tr>\n          <% } %>\n        </tbody>\n      </table>\n    </section>\n  </section>\n<% } %>\n"}),define("views/wizards/fileserver/ShareSummaryPage",["views/basecomponents/wizards/BaseWizardPage","data/DataProperties","utils/AppUtil","utils/AppConstants","utils/FileServerUtil","text!templates/wizards/fileserver/ShareSummaryPage.html"],function(e,t,i,n,s,a){"use strict";return e.extend({name:"ShareSummaryPage",template:_.template(a),initialize:function(t){e.prototype.initialize.apply(this,arguments),this.model=this.model[0],this.authenticationType=this.model.get(this.model.DP.AUTHENTICATION_TYPE),this.fsModels=t.model[1]},render:function(){this.isMultiProtocol=this.model.get(this.model.DP.SECONDARY_PROTOCOL_TYPE)===n.FS_PROTOCOLS.NFS||this.model.get(this.model.DP.SECONDARY_PROTOCOL_TYPE)===n.FS_PROTOCOLS.SMB,this.fsModel=this.getWizard().subViewHelper.get(n.SHARE_PAGES.SHARE_BASIC_PAGE_ID).selectedFileServer,this.isFsPostSabine=s.compareAFSversion(this.fsModel,n.FILE_SERVER_VERSIONS.THREE_DOT_FIVE)>=0,this.isFsPostThreeDotSix=s.compareAFSversion(this.fsModel,n.FILE_SERVER_VERSIONS.THREE_DOT_SIX)>=0;var e=!!this.model.isNew()||this.model.get(this.model.DP.ENABLE_CONCURRENT_READS);this.isNativeSmb=this.model.get(this.model.DP.PROTOCOL_TYPE)===n.FS_PROTOCOLS.SMB;var t=this.model.get(this.model.DP.PROTOCOL_TYPE),i=this.model.get(this.model.DP.SECONDARY_PROTOCOL_TYPE);i&&i!==n.FS_PROTOCOLS.NONE&&i!==n.FS_PROTOCOLS.INCOMPATIBLE&&(t+=", "+i);var a=this.model.get(this.model.DP.SHARE_PATH);a||(a="/"+this.model.get(this.model.DP.NAME));var r=this.model.get(this.model.DP.MAX_SIZE);r||(r="-");var o=this.model.get(this.model.DP.FILE_BLOCKING_EXTENSIONS),l=o&&o.length,c=this.model.get(this.model.DP.SHARE_TYPE)===n.FS_SHARE_TYPES.HOMES,u=this.showProtocol(n.FS_PROTOCOLS.SMB),d=this.showProtocol(n.FS_PROTOCOLS.NFS),h=this.template(this.vtOptions({fileServerName:this.getFileServerName(),shareName:this.model.get(this.model.DP.NAME),sharePath:a,shareProtocol:t,shareSize:r,enableShareOptimization:c,showBlockedFileTypes:l,blockedFileTypes:o&&o.join(", "),protocol:this.model.get(this.model.DP.PROTOCOL_TYPE),showSmbProtocol:u,showNfsProtocol:d,enableReads:e,isNativeSmb:this.isNativeSmb,caseSensitive:this.model.get(this.model.DP.CASE_SENSITIVE_NAMESPACE),enableSimultanesousAccess:this.model.get(this.model.DP.SIMULTANEOUS_ACCESS_ENABLED),allowSymlink:this.model.get(this.model.DP.SYMLINK_CREATION_ENABLED),nfsAuthentication:this.model.get(this.model.DP.AUTHENTICATION_TYPE),nfsClientAccess:this.mapNfsClientAccess(),enableAbe:this.model.get(this.model.DP.ENABLE_ABE),isFsPostSabine:this.isFsPostSabine,isMultiProtocol:this.isMultiProtocol,enableSmbEncryption:this.model.get(this.model.DP.ENABLE_SMB3_ENCRYPTION),isFsPostThreeDotSix:!1}));this.$el.html(h),this.hideShowSsrContent(),this.$(".nutanixMoreInfo").nutanixMoreInfo({parseDataAttrs:!0})},hideShowSsrContent:function(){this.isMultiProtocol&&this.isFsPostSabine?this.$(".ssrContainer").hide():this.$(".ssrContainer").show(),this.showProtocol(n.FS_PROTOCOLS.SMB)?this.$(".showSmbProtocol").show():this.$(".showSmbProtocol").hide(),this.showProtocol(n.FS_PROTOCOLS.NFS)?this.$(".showNfsProtocol").show():this.$(".showNfsProtocol").hide(),this.model.get(this.model.DP.WINDOWS_PREVIOUS_VERSION)?(this.$(".enableSsr").show(),this.$(".disableSsr").hide()):(this.$(".enableSsr").hide(),this.$(".disableSsr").show())},showProtocol:function(e){var t=this.model.get(this.model.DP.PROTOCOL_TYPE),i=this.model.get(this.model.DP.SECONDARY_PROTOCOL_TYPE);return t===e||i===e||t===n.FS_PROTOCOLS.NFS_SMB},getFileServerName:function(){var e=this,t=null;return this.fsModels.each(function(i){i.get(i.DP.UUID)&&i.get(i.DP.UUID)===e.model.get(e.model.DP.FILE_SERVER_UUID)&&(t=i.get(i.DP.NAME))}),t},mapNfsClientAccess:function(){switch(this.model.get(this.model.DP.DEFAULT_SHARE_ACCESS_TYPE)){case n.ACCESS_TYPES.READ_WRITE:return this.i18n("read_write");case n.ACCESS_TYPES.READ_ONLY:return this.i18n("read_only");case n.ACCESS_TYPES.NO_ACCESS:return this.i18n("no_access")}},onPageTransition:function(e){var s=this,a={protocolType:this.model.get(this.model.DP.PROTOCOL_TYPE),secondaryProtocolType:this.model.get(this.model.DP.SECONDARY_PROTOCOL_TYPE),isNestedShare:this.model.get(n.IS_NESTED_SHARE)};(this.model.get(n.IS_NESTED_SHARE)||this.model.get(this.model.DP.PARENT_SHARE_UUID))&&this.removeUnwantedAttr(),this.model.unset("concurrentReadsEnabled"),this.disableSaveButton(),this.disableCancelButton(),this.disablePreviousButton(),this.model.save(null,{success:function(n,s){var a=i.processSerializedObject(s);a&&a[t.TASK_UUID]&&e()},error:function(e,t){s.enableSaveButton(),s.enableCancelButton(),s.enablePreviousButton(),i.log("FileServer: Error :"+t),s.model.set(a),s.validateSharePath(),s.model.isNew()?s.showError(s.i18n("error_create_share")+i.processAjaxError(t.responseText)):s.showError(s.i18n("error_update_share")+i.processAjaxError(t.responseText))}},this)},removeUnwantedAttr:function(){var e=this,t=[this.model.DP.PROTOCOL_TYPE,this.model.DP.SECONDARY_PROTOCOL_TYPE,this.model.DP.MAX_SIZE,this.model.DP.WINDOWS_PREVIOUS_VERSION,this.model.DP.SHARE_TYPE,this.model.DP.ENABLE_CONCURRENT_READS,this.model.DP.CASE_SENSITIVE_NAMESPACE,this.model.DP.SIMULTANEOUS_ACCESS_ENABLED,this.model.DP.SYMLINK_CREATION_ENABLED,n.IS_NESTED_SHARE];_.each(t,function(t){e.model.unset(t)})},canEnablePageLink:function(){return!1},getButtonLabel:function(e){return e<0?n.BUTTON.BACK:null},getSaveButtonLabel:function(){return this.model.isNew()?this.i18n("create"):this.i18n("save")},onPageCancel:function(){return!0},validateSharePath:function(){var e=this.model.get(this.model.DP.SHARE_PATH);if(this.model.set(n.IS_NESTED_SHARE,!0),e&&"/"!==e){var t=e.split("/"),i=t.length;("/"!==e.charAt(0)||i<3||3===i&&""===t[i-1])&&this.model.set(n.IS_NESTED_SHARE,!1)}else if(this.model.set(n.IS_NESTED_SHARE,!1),!this.model.isNew()){var s=this.model.get(this.model.DP.PARENT_SHARE_UUID);s&&this.model.set(n.IS_NESTED_SHARE,!0)}}})}),define("views/wizards/fileserver/ShareWizard",["views/basecomponents/wizards/WizardView","models/fileserver/ShareModel","models/fileserver/FileServerCollection","text!templates/basecomponents/wizards/WizardContentView.html","views/wizards/fileserver/ShareFSBasicPage","views/wizards/fileserver/ShareSettingsPage","views/wizards/fileserver/ShareSummaryPage","managers/WizardManager","managers/I18nManager","utils/AppUtil","utils/FileServerUtil","utils/AppConstants"],function(e,t,i,n,s,a,r,o,l,c,u,d){"use strict";var h=l.t("ShareWizard","tab_heading.basic"),p=l.t("ShareWizard","tab_heading.settings"),T=l.t("ShareWizard","tab_heading.summary");l.t("ShareWizard","tab_heading.smb_settings"),l.t("ShareWizard","tab_heading.nfs_settings"),l.t("ShareWizard","tab_heading.multiprotocol_settings");return e.extend({name:"ShareWizard",model:null,el:"#popupShareWizard",template:_.template(n),initialize:function(t){e.prototype.initialize.apply(this,arguments),this.addExtraEvents({"click .externalPopupLink":"onExternalPopupLinkClick"}),this.$el.addClass("wizard-view-disable-nav-tabs")},show:function(e){var n=this,s=arguments;if(this.model=new t,this.fileServers=new i,c.showLoader(),e.action===d.ACTION_UPDATE){var a=u.getFileServerAndShareUuidsFromPageRoute();a&&(this.model.setUuid(a),this.model.set(this.model.idAttribute,e.actionTargetId,{silent:!0}));var r=this.fileServers.fetch(),o=this.model.fetch(),l=[this.i18n("error.file_server_fetch"),this.i18n("error.share_export_fetch")],h=function(){c.hideLoader(),n.showFileServerWizard(e)},p=function(){c.hideLoader();for(var e=Array.prototype.slice.call(s),t=0;t<e.length;t++)e[t]===d.STATE_ERROR&&n.showHeaderError(l[t]);n.hide()};$.when(r,o).then(h,p)}else this.model.isNew(!0),this.fileServers.fetch({success:function(){c.hideLoader(),n.showFileServerWizard(e)},error:function(t){c.hideLoader(),n.showFileServerWizard(e),n.showHeaderError(n.i18n("error.fileserver_ferch")),n.$(".btnNext").hide()}})},showFileServerWizard:function(t){var i=this.i18n("title.new_share_export"),n=[],o=[this.model,this.fileServers];t.action===d.ACTION_UPDATE&&(i=this.i18n("title.update_share_export")),n=[{id:"share-basic",title:h,klass:s,model:o},{id:"share-settings",title:p,klass:a,model:o},{id:"share-summary",title:T,klass:r,model:o}],this.initializeWizard({title:i,wizardType:e.WIZARD_TYPES.LINEAR,pages:n}),e.prototype.show.apply(this,arguments)},onExternalPopupLinkClick:function(e){this.hide(),o.handleAction({action:d.ACTION_CREATE,actionTarget:d.ENTITY_FILE_SERVER})},hide:function(){this.tooltipDestroy(),e.prototype.hide.apply(this,arguments)},onPrevious:function(t){this.tooltipDestroy();var i=this._getCurrentPageId(),n=this.subViewHelper.get(i);"share-nfsSettings"!==i||n.isMultiProtocol?e.prototype.onPrevious.apply(this,arguments):this._renderPage(0)},onNext:function(t){this.tooltipDestroy();var i=this._getCurrentPageId(),n=this.subViewHelper.get(i);"share-basic"===i&&n.protocolType===d.FS_PROTOCOLS.NFS?this._gotoPage(2):e.prototype.onNext.apply(this,arguments)},_setButtonStates:function(t){e.prototype._setButtonStates.apply(this,arguments);var i=this._getCurrentPageId();t.isMultiProtocol||"share-smbSettings"!==i&&"share-nfsSettings"!==i||(this.$(".btnNext").addClass("disabled"),this.$(".btnNext").hide(),this._showSaveButton(t))},tooltipDestroy:function(){this.$(".tooltipWrapper").tooltip("destroy"),this.$(".nutanixMoreInfo").nutanixMoreInfo("destroy")}})}),define("managers/WizardManager",["data/DataProperties","data/DataURLConstants","models/BaseModel","managers/PopupManager","utils/AppUtil","utils/AppConstants"],function(e,t,i,n,s,a){"use strict";var r=i.extend({urlRoot:t.EXTENDED_NFS_HANDLER,name:"MetroReadyModel",entityType:a.EXTENDED_NFS_HANDLER}),o={},l=[a.ACTION_ADD,a.ACTION_CREATE,a.ACTION_UPDATE];return o[a.ENTITY_PROTECTION_DOMAIN]=l,o[a.ENTITY_ASYNC_PD]=_.clone(l),o[a.ENTITY_ASYNC_PD].push(a.ACTION_UPDATE_FS_PD_SCHEDULE),o[a.ENTITY_METRO_AVAILABILITY_PD]=l,o[a.ENTITY_CLOUD_AWS]=l,o[a.ENTITY_FILE_SERVER]=_.without(l,a.ACTION_UPDATE),o[a.ENTITY_FILE_SERVER].push(a.ACTION_UPDATE_NETWORK),o[a.ENTITY_FILE_SERVER].push(a.ACTION_UPDATE_NVM),o[a.ENTITY_FILE_SERVER].push(a.ACTION_ACTIVATE_FILE_SERVER),o[a.ENTITY_FILE_SERVER].push(a.ACTION_SCALE_OUT),o[a.ENTITY_FILE_SERVER].push(a.ACTION_CLONE),o[a.ENTITY_FILE_SERVER].push(a.ACTION_ANTIVIRUS_SETUP),o[a.ENTITY_FILE_SERVER].push(a.ACTION_FILE_SERVER_CLONE),o[a.ENTITY_FILE_SERVER].push(a.ACTION_ADD_USER_MAPPING),o[a.ENTITY_SHARE]=_.without(l,a.ACTION_ADD),_.extend({},n,{isEntityUsingWizard:function(e,t){var i=o[t];return _.contains(i,e)},showPopup:function(e,t){switch(t){case a.ENTITY_METRO_AVAILABILITY_PD:this._showMetroAvailPopup(t);break;default:this._showWizardPopup(t)}},_showWizardPopup:function(e){var t=_.bind(function(e){this.renderWizardPopupView(e,this.currentActionRoute)},this);switch(e){case a.ENTITY_PROTECTION_DOMAIN:case a.ENTITY_ASYNC_PD:case a.ENTITY_METRO_AVAILABILITY_PD:require(["views/wizards/pd/ProtectionDomainWizard"],t);break;case a.ENTITY_CLOUD_AWS:require(["views/wizards/remotesite/RemoteSiteWizard"],t);break;case a.ENTITY_FILE_SERVER:require(["views/wizards/fileserver/FileServerWizard"],t);break;case a.ENTITY_SHARE:require(["views/wizards/fileserver/ShareWizard"],t)}},_showMetroAvailPopup:function(t){var i=this,n=new r;$.when.apply($,[n.fetch()]).done(function(s){var r=n.get(e.PRIMITIVE_KEY);if(!0!==r&&"true"!==r)return void this.handleAction({action:a.ACTION_CHECK_PREREQUISITE,actionTarget:a.ENTITY_METRO_AVAILABILITY_PD});i._showWizardPopup(t)}).fail(function(e,t,i){s.hideLoader();var n=s.processThrownError(i);e.showClientNotification(a.NOTIFY_ERROR,n)})}})}),define("managers/ActionWorkflowFactory",["managers/NamespaceManager","managers/PopupManager","managers/WizardManager","managers/NavigationManager","managers/UserBehaviorManager","managers/EntityManager","managers/ClusterManager","managers/BatchManager","managers/AccessManager","managers/AppManager","broker/managers/BrokerManager","utils/AppConstants","utils/AppUtil","data/DataURLConstants","data/DataProperties","events/AppEvents"],function(e,t,i,n,s,a,r,o,l,c,u,d,h,p,T,E){"use strict";var S=[d.ENTITY_ALERT,d.ENTITY_ALERT_POLICY,d.ENTITY_USER_DEFINED_ALERT_POLICY,d.ENTITY_MANAGEMENT_SERVER,d.ENTITY_REPORT_CONFIG,d.ENTITY_CATEGORY,d.ENTITY_AFFINITY_RULE,d.ENTITY_PLAYBOOK,d.ENTITY_ACTION_TEMPLATE,d.ENTITY_PLAYBOOK_RESULT,d.ENTITY_NETWORK_SECURITY_RULE,d.SUPPORT_CASE,d.ENTITY_MULTICLUSTER_CONFIG_SPEC,d.ENTITY_PC_VM,d.ENTITY_LCM,d.ENTITY_LCM_VERSION,d.ENTITY_AVAILABILITY_ZONE,d.ENTITY_PROTECTION_RULE,d.ENTITY_RECOVERY_PLAN_JOB,d.ENTITY_RECOVERY_PLAN,d.ENTITY_VM_RECOVERY_POINT,d.ENTITY_QOS_POLICY,d.ENTITY_NGT_POLICY,d.ENTITY_IMAGE_PLACEMENT_POLICY,d.ENTITY_CVM_NETWORK_INTERFACE],g=[d.ACTION_TRIGGER_PLAYBOOK,d.ACTION_MANAGE_CATEGORIES,d.ACTION_UPDATE_CHANGE_OWNER,d.ACTION_QUARANTINE,d.ACTION_UNQUARANTINE,d.ACTION_CONFIGURE_QOS];return{navigationActions:[d.ACTION_NAVIGATE_PAGE,d.ACTION_DETAILS,d.ACTION_NAVIGATE_URL],_isAppViewReady:!1,executeAction:function(e,t){if(t=t||{},t.changeUrl&&this.isNavigationAction(e.action))return void(e.action===d.ACTION_NAVIGATE_PAGE?this._navigateToPageWithActionRoute(e):this._navigateToUrlWithActionRoute(e));s.recordUserActivities(e),r.isMulticlusterUI()&&!n.isRouteExecuteAction()&&this.isPEAssist(e)?this.executeActionOnNewWindow(e,t,!0):this.executeActionOnSameWindow(e,t)},executeActionOnNewWindow:function(e,t,i){var n="";if(_.each(e,function(e,t){t!==d.NAV_OPTIONS&&(n+=t+"="+e+"&")}),i){var s=this.getClusterUuidFromActionRoute(e);n+=p.CLUSTER_ID+"="+s+"&",n+=p.PE_ASSIST+"=true"}var a={action:d.ACTION_NAVIGATE_URL,actionTarget:"#"+p.EXECUTE_ACTION({options:n}),isNewWindow:!0};this.executeAction(a)},executeActionOnSameWindow:function(e,i){if(this.isNavigationAction(e.action))this._changeNavigation(e);else if(e.action===d.ACTION_DOWNLOAD)n.executeDownloadAction(e[d.NAV_ACTION_TARGET],e);else if(e.actionTarget===d.ENTITY_ALERT||e.actionTarget===d.ENTITY_PLAYBOOK_RESULT||e.actionTarget===d.ENTITY_MULTICLUSTER_CONFIG_SPEC&&e.action!==d.ACTION_UPDATE_CLUSTER){var s=a.createEntityActionModel(e.actionTarget,e.action);s&&s.performAction(e.action,e.actionTargetId,i)}else if(e.actionTarget===d.ENTITY_CLUSTER&&e.action===d.ACTION_ENTER_OVERRIDE_MODE){var l=T,c=_defineProperty({},l.INTENT_SPEC,_defineProperty({},l.INTENT_RESOURCES,_defineProperty({},l.INTENT_RESOURCES_CONFIG,{operation_mode:d.CLUSTER_MODE_V3_API.OVERRIDE})));o.updateEntities(d.ACTION_UPDATE,d.ENTITY_CLUSTER,[e[d.NAV_ACTION_TARGET_ID]],c)}else e.action===d.ACTION_LAUNCH_CONSOLE&&r.isMulticlusterNavMode()?this.launchVmConsole(e):e.action===d.ACTION_UNREGISTER&&e.actionTarget===d.ENTITY_CLUSTER?t.handleAction(e):this.isBatchAction(e)?o.executeAction(e[d.NAV_ACTION_ID],e[d.NAV_ACTION_TARGET],e[d.NAV_ACTION_TARGET_ID].split(","),e[d.NAV_ACTION]):e.action===d.ACTION_BROKER_DYNAMIC?this._renderBrokerDynamicView(e,i):(e[d.NAV_ACTION_ROUTE_OPTIONS]=_.extend(e[d.NAV_ACTION_ROUTE_OPTIONS]||{},i),this._showPopup(e))},launchVmConsole:function(e){var t=e[d.NAV_ACTION_TARGET_ID],i=e[d.NAV_ACTION_PARENT_ID],s=e[d.NAV_ACTION_TARGET_NAME],a=c.getVncEnvironment();if(h.useReactVnc())return void n.navigateToURL(p.RVNC_URL({vmId:t,env:a,mode:d.VNC_MODE.DETACHED}),!0,d.VM_CONSOLE_WINDOW_OPTIONS);var o;o=i?r.getClusterModelByClusterUuid(i):r.getCurrentClusterModel();var u=!!o&&o.isAmfOverEsxBasicSupported(),_=p.VNC_URL({uuid:t,vmName:s||t,attached:!1,useUhura:u,useV3:!0,noV1Access:!l.hasAccessV1(),isXi:c.isXi()});i&&(_+="&clusterId="+i);var T={action:d.ACTION_NAVIGATE_URL,actionTarget:_,isNewWindow:!0,windowOptions:d.VM_CONSOLE_WINDOW_OPTIONS};this.executeAction(T)},isNavigationAction:function(e){return _.contains(this.navigationActions,e)},isBatchAction:function(e){return e[d.NAV_ACTION_TYPE]===d.ACTION_TYPE_BATCH},getClusterUuidFromActionRoute:function(e){var t=e[d.NAV_ACTION_PARENT_ID]||e[d.NAV_ACTION_TARGET_ID],i=e[d.NAV_ACTION_PARENT_ENTITY_TYPE]||e[d.NAV_ACTION_TARGET];if(i===d.ENTITY_CLUSTER||_.contains(this.getEntitiesNotPEAssist(),i))return t;throw new Error("ClusterUuid is missing from actionRoute : "+JSON.stringify(e))},_getAppViewInstance:function(){var t=e.get(e.APP_VIEW);if(t)return t;throw new Error("Changing navigation requires AppView.")},_changeNavigation:function(e){var t=this._getAppViewInstance(),i=e.action;delete e.action,i===d.ACTION_NAVIGATE_PAGE?t.showPage(e):i===d.ACTION_DETAILS?t.showFullPageDetailPane(e):i===d.ACTION_NAVIGATE_URL&&this._navigateToURL(e.actionTarget,e.isNewWindow,e.windowOptions)},_showPopup:function(e){if(this._isAppViewReady||this._getAppViewInstance().currentPageUuid)this._handlePopupRoute(e),this._isAppViewReady=!0;else{var t=this._getAppViewInstance(),i=this,n=function(){t.off(E.APP_VIEW_IS_RENDERED,n),i._handlePopupRoute(e),i._isAppViewReady=!0};t.on(E.APP_VIEW_IS_RENDERED,n),this.executeAction({action:d.ACTION_NAVIGATE_PAGE})}},_renderBrokerDynamicView:function(e,t){var i=_.extend({},e[d.NAV_OPTIONS],t);if(i.subApp){var n=null;i.container&&(n=$(i.container));var s=!1!==i.changeHash;i.callback={onOpen:function(){},onCancel:function(){u.goBack()}},setTimeout(function(){u.loadSubApp(i.subApp,n,i,s)})}},_handlePopupRoute:function(e){if(r.isMulticlusterUI()&&n.isPEAssistMode())return void this.executePEAssistActionForPEIFrame(e);i.isEntityUsingWizard(e.action,e.actionTarget)?i.handleAction(e):t.handleAction(e)},_navigateToURL:function(e,t,i){n.navigateToURL(e,t,i)},_navigateToPageWithActionRoute:function(e){n.navigateToPage(e[d.NAV_PAGE_ID],e[d.NAV_SUBPAGE_ID],e[d.NAV_OPTIONS])},_navigateToUrlWithActionRoute:function(e){var t=d.ROUTE_ACTION+"?"+h.formatObjectToQuery(e,!0);n.navigateToRoute(t)},isPEAssist:function(e,t){e=e||{};var i=e[d.NAV_ACTION],n=e[d.NAV_ACTION_PARENT_ID]||e[d.NAV_ACTION_TARGET_ID],s=this.getActionTargetEntityType(e);if(this.isNavigationAction(i))return!1;if(i===d.ACTION_FANOUT.CONTAINER_CREATE||i===d.ACTION_FANOUT.VM_CREATE||i===d.ACTION_FANOUT.NETWORK_CREATE||i===d.ACTION_FANOUT.EXPAND_CLUSTER)return!1;if(!n||n.indexOf(",")>-1)return!1;if(s===d.ENTITY_CLUSTER&&(i===d.ACTION_UPDATE_CLUSTER||i===d.ACTION_UNREGISTER))return!1;if(_.contains(this.getEntitiesNotPEAssist(),s))return!1;if(_.contains(this.getActionsNotPEAssist(),i))return!1;if(i===d.ACTION_ENTER_OVERRIDE_MODE)return!1;if(i===d.NCC_TASK_SUMMARY)return!1;var a=this.getClusterUuidFromActionRoute(e),o=r.getClusterModelByClusterUuid(a);if(o)return(!o.hasPCConsoleFeature()||s!==d.ENTITY_VM)&&!o.isEntityActionSupportFanout(e);throw new Error("actionRoute does not have the cluster id.")},getActionTargetEntityType:function(e){return e[d.NAV_ACTION_TARGET]},executePEAssistActionForPEIFrame:function(e){var t={};t[d.NAV_ACTION]=d.ACTION_NAVIGATE_PAGE,t.pageId=d.PAGE_DASHBOARD;var i=_.clone(e||{});i[p.PE_ASSIST]=!0,i[p.CLUSTER_ID]=e[p.CLUSTER_ID],t[d.NAV_OPTIONS]=i,this._changeNavigation(t)},getEntitiesNotPEAssist:function(){return S},getActionsNotPEAssist:function(){return g}}}),define("managers/acropolis/AcropolisNetworkManager",["models/network/AcropolisNetworkCollection","managers/NamespaceManager","managers/ClusterManager","managers/AccessManager","utils/HypervisorUtil","utils/AppConstants"],function(e,t,i,n,s,a){"use strict";return{networkCollection:null,initialize:function(){this.networkCollection||(this.networkCollection=new e,t.set(t.NETWORK_MANAGER,this))},fetchOnDemand:function(){this.networkCollection.fetch()},registerNetworkListener:function(e,t,i){this.networkCollection.on(e,t,i)},unregisterNetworkListener:function(e,t,i){this.networkCollection.off(e,t,i)},getNetworkCollection:function(){return this.networkCollection},setProxyClusterUuid:function(e){this.networkCollection.setProxyClusterUuid(e)},startServices:function(){s.isAcropolisEnabled(i.getCurrentClusterId())&&n.isFFEnabled(a.FFLAGS.UI_ACROPOLIS)&&(this.networkCollection||this.initialize(),this.networkCollection.startPolling())},stopServices:function(){s.isAcropolisEnabled(i.getCurrentClusterId())&&n.isFFEnabled(a.FFLAGS.UI_ACROPOLIS)&&this.networkCollection.stopPolling()}}}),define("views/basecomponents/pages/fulldetails/FullDetailsBaseTabView",["views/details/TabDetailsView","utils/AppUtil","managers/NavigationManager","managers/UserBehaviorManager"],function(e,t,i,n){"use strict";var s=_.template('<% _.each(tabNames, function(name, id) { %><div href="" class="tab" data-target="<%= id %>" <%= getQaDataTestId(id) %> ><%= name %></div><% }); %>');return e.extend({tabBodyElement:null,targetTabId:null,events:{"click .tab:not(.gray-out)":"onClickTab"},initialize:function(t){if(!t.tabBodyElement)throw new Error("Must provide tabBodyElement DOM object.");if(!t.entityId)throw new Error("Must provide entityId.");!t.tabIds&&_.size(t.tabNames)&&(t.tabIds=_.keys(t.tabNames)),this.tabBodyElement=t.tabBodyElement,this.entityId=t.entityId,this.entityType=t.entityType,this.targetTabId=t.targetTabId,e.prototype.initialize.apply(this,arguments),this.selectFirstTab()},render:function(){1===this.tabIds.length?(this.$el.html(""),this.$el.parent().addClass("no-tabs-header"),this.tabBodyElement.addClass("no-tabs-header")):(this.$el.html(s(this.vtOptions({tabNames:this.tabNames,tabIds:this.tabIds}))),this.$el.parent().removeClass("no-tabs-header"),this.tabBodyElement.removeClass("no-tabs-header")),this.setModelId(this.entityId),this.refreshCurrentTab()},refreshView:function(e){e&&e.entityId&&this.setModelId(this.entityId),this.refreshCurrentTab()},onClickTab:function(e){var t=$(e.currentTarget).data("target");n.recordUserActivities({action:"select tab",actionTarget:t}),this.selectTab(t)},selectTab:function(e){if(e!==this.currentTabId){var n=this.subViewHelper.get(this.currentTabId);n&&(n.hide(),n.stopServices()),n=this.subViewHelper.get(e),this.currentTabId=e,n?this._showSubViewTab(n):this._createTabContentView(e),this.$(".tab").removeClass("selected"),this.$('[data-target="'+e+'"').addClass("selected");var s=t.parseQueryToObject(location.hash)||{};s.targetTabId=e,s.actionTargetId||(s.actionTargetId=this.entityId),s.actionTarget||(s.actionTarget=this.entityType),i.replaceFullScreenDetailsRoute(s),this.trigger(this.TAB_CHANGED_EVENT,e)}},selectFirstTab:function(){if(1===this.tabIds.length)return void this.selectTab(this.tabIds[0]);var e=this.$('[data-target="'+this.targetTabId+'"]');e.length?this.selectTab(e.data("target")):this.selectTab(this.$(".tab")[0].getAttribute("data-target"))},renderTabBodyContent:function(e){this.tabBodyElement.append(e)}})}),define("views/basecomponents/pages/fulldetails/FullDetailsGenericEntityTabView",["views/basecomponents/pages/fulldetails/FullDetailsBaseTabView","managers/EntityManager","utils/CommonTemplates","utils/SVG"],function(e,t,i,n){"use strict";return e.extend({entityModel:null,initialize:function(i){var n=t.getEntityFullDetailsModel(i.entityType);n?(i.tabNames=n.getDetailsTabs(),i.pageId=i.pageId||n.getPageId()):(i.tabIds=[],i.tabNames={}),i.currentModel&&(_.bindAll(this,"onEntityModelChange"),this.listenForModelChange(i.currentModel)),e.prototype.initialize.apply(this,arguments)},render:function(){_.size(this.tabNames)?e.prototype.render.apply(this,arguments):this.renderTabBodyContent(i.ERROR_SOMETHING_IS_WRONG({SVG:n,mainText:this.reason||"Under construction",subText:"",actionLinks:""}))},selectFirstTab:function(){_.size(this.tabNames)&&e.prototype.selectFirstTab.apply(this,arguments)},listenForModelChange:function(e){this.removeListenerForModelChange(),e&&(this.entityModel=e,this.entityModel.on("change",this.onEntityModelChange))},removeListenerForModelChange:function(){this.entityModel&&this.entityModel.off("change",this.onEntityModelChange)},onEntityModelChange:function(e){this.showHideTabsBasedOnModel(e)},showHideTabsBasedOnModel:function(e){this.viewFilters&&this.renderViewFilter()},destroy:function(){this.removeListenerForModelChange(),e.prototype.destroy.apply(this,arguments)}})}),define("views/widgets/EntityActionButtonsBarView",["views/widgets/DynamicButtonsGroupWidgetView"],function(e){"use strict";return e.extend({name:"EntityActionButtonsBarView",model:null,modelEvents:{"change model":"onModelChange"},onModelChange:function(){},onStartServices:function(){this.delegateModelEvents()},onStopServices:function(){this.undelegateModelEvents()}})}),
define("views/basecomponents/pages/fulldetails/FullDetailsGenericActionBarView",["views/widgets/EntityActionButtonsBarView","utils/AppConstants","utils/EntityUtil","components/Components","managers/ActionManager","managers/AppManager","data/DataProperties"],function(e,t,i,n,s,a,r){"use strict";return e.extend({name:"FullDetailsGenericActionBarView",initialize:function(t){if(this.model=t.model,!this.model)throw"EntityActionButtonsBarView: model not available.";if(this.entityType=this.model.entityType,!this.entityType)throw"EntityActionButtonsBarView: entity type not available.";e.prototype.initialize.apply(this,arguments)},render:function(){e.prototype.render.apply(this,arguments),this.renderViewFilter()},getViewFeatures:function(){return{canUserModify:this.canModifyByEntityType(this.entityType),isConnectedToRemotePC:a.isXi()?a.isConnectedToOnPrem():a.isConnectedToXi(),states:this.model.get(r.STATE),imageFilePresent:!_.isNull(this.model.get(r.SSP_VM_DISK_SIZE))}},viewFilters:function(){return[{targets:{selectors:[".modify-action"]},conditions:{groups:[{type:"canUserModify",data:[!1],operator:t.FILTER_OPERATORS.EQUALS,reasonCode:"common.accessDenied",reason:this.getAccessDeniedMsg()}]}},{targets:{style:t.VIEW_FILTER.STYLE_CLASS.GRAY_OUT,selectors:[".btn-group.btnBar [action-id=manage_categories]"]},conditions:{groups:[{type:"states",data:[t.INTENT_RESPONSE_STATUS.ERROR],operator:t.FILTER_OPERATORS.IN,reasonCode:"image.inErrorState"},{type:"states",data:[t.INTENT_RESPONSE_STATUS.RUNNING],operator:t.FILTER_OPERATORS.IN,reasonCode:"image.inRunningStateUpdate"},{type:"states",data:[t.INTENT_RESPONSE_STATUS.PENDING],operator:t.FILTER_OPERATORS.IN,reasonCode:"image.inPendingState"},{type:"states",data:[t.INTENT_RESPONSE_STATUS.DELETE_PENDING],operator:t.FILTER_OPERATORS.IN,reasonCode:"image.inDeletePendingState"},{type:"imageFilePresent",data:[!1],operator:t.FILTER_OPERATORS.EQUALS,reasonCode:"image.noImageFile"}]}},{targets:{style:t.VIEW_FILTER.STYLE_CLASS.GRAY_OUT,selectors:[".btn-group.btnBar [action-id=add_blueprint]"]},conditions:{groups:[{type:"states",data:[t.INTENT_RESPONSE_STATUS.ERROR],operator:t.FILTER_OPERATORS.IN,reasonCode:"image.inErrorState"},{type:"states",data:[t.INTENT_RESPONSE_STATUS.RUNNING],operator:t.FILTER_OPERATORS.IN,reasonCode:"image.inRunningStateAddToCatalog"},{type:"states",data:[t.INTENT_RESPONSE_STATUS.PENDING],operator:t.FILTER_OPERATORS.IN,reasonCode:"image.inPendingState"},{type:"states",data:[t.INTENT_RESPONSE_STATUS.DELETE_PENDING],operator:t.FILTER_OPERATORS.IN,reasonCode:"image.inDeletePendingState"},{type:"imageFilePresent",data:[!1],operator:t.FILTER_OPERATORS.EQUALS,reasonCode:"image.noImageFile"}]}},{targets:{style:t.VIEW_FILTER.STYLE_CLASS.HIDE,selectors:[".btn-group.btnBar [action-id=remote_copy]"]},conditions:{groups:[{type:"isConnectedToRemotePC",data:[!1],operator:t.FILTER_OPERATORS.EQUALS}]}},{targets:{style:t.VIEW_FILTER.STYLE_CLASS.GRAY_OUT,selectors:[".btn-group.btnBar [action-id=remote_copy]"]},conditions:{groups:[{type:"states",data:[t.INTENT_RESPONSE_STATUS.ERROR],operator:t.FILTER_OPERATORS.IN,reasonCode:"image.inErrorState"},{type:"states",data:[t.INTENT_RESPONSE_STATUS.RUNNING],operator:t.FILTER_OPERATORS.IN,reasonCode:"image.inRunningStateUpdate"},{type:"states",data:[t.INTENT_RESPONSE_STATUS.PENDING],operator:t.FILTER_OPERATORS.IN,reasonCode:"image.inPendingState"},{type:"states",data:[t.INTENT_RESPONSE_STATUS.DELETE_PENDING],operator:t.FILTER_OPERATORS.IN,reasonCode:"image.inDeletePendingState"},{type:"imageFilePresent",data:[!1],operator:t.FILTER_OPERATORS.EQUALS,reasonCode:"image.noImageFile"}]}}]},onModelChange:function(){this.clearButtonsMap();var e=s.getActions(this.entityType).getModifyEntityActions();_.each(e,function(e){var t=e.toJSON(),s={};s.label=i.getEntityActionTitle(this.entityType,e.getId()),t.icon&&(s.icon=n.icon(t.icon,t.icon)),s.actionId=t.actionId,s.btnClass=t.btnClass,s.groupId=t.groupId,this.isModifyAction(t.actionId)&&(s.btnClass=s.btnClass||"modify-action"),this.addButton(s)},this),this.render(this.maxButtons)},onClick:function(e){e.stopPropagation();var t=this.getButtonOptionsByElement(e.currentTarget);if(t){var i=t.options.actionId;s.onEntityAction(this.entityType,i,[this.model.getId()],this.model.getClusterUuid(),{detailsEntityModelInfo:this.model.toJSON()})}}})}),define("text!templates/basecomponents/details/FullDetailsSection.html",[],function(){return'<% _.each(sections, function(section) { %>\n  <% if (section.displayItems.length > 0) { %>\n  <ul class="details-summary-list">\n  <% _.each(section.displayItems, function(item) { %>\n    <li class="detail-summary <%= item.classStr %>">\n      <span class="name" title="<%= item.label %>" <%= item.labelAttr %>>\n        <span class="name-inner">\n          <%= item.label %>\n        </span>\n      </span>\n      <span class="value" title="<%= item.valueTitle%>" <%= item.valueAttr %>>\n        <span class="value-inner">\n          <%= item.value%>\n        </span>\n      </span>\n    </li>\n  <% }); %>\n  </ul>\n  <% } %>\n<% }); %>\n'}),define("views/basecomponents/pages/fulldetails/FullDetailsSummaryView",["views/basecomponents/BaseView","managers/NavigationManager","utils/AppConstants","utils/AppUtil","text!templates/basecomponents/details/FullDetailsSection.html"],function(e,t,i,n,s){"use strict";s=_.template(s);var a=_.template('<header class="details-summary-header <%= classStr %>"><h2 class="heading" <%- valueAttr %>><%- value %></h2><p class="name" <%-labelAttr %>><%- label %></p></header><div class="details-summary-list task-progress bg-info"><div class="donut-loader"></div><span class="description"></span></div>');return e.extend({sections:null,headerItem:null,headerTmpl:null,DEFAULT_SECTION_ID:null,events:{"click    a.alert-link":"onAlertLinkClick","click    a.event-link":"onEventLinkClick","click    a.pageLink":"onPageLinkClick"},initialize:function(t){e.prototype.initialize.apply(this,arguments),this.headerItem=null,this.headerTmpl=a,this.sections=[]},render:function(){return this.$el.empty(),this.renderHeading(),this.renderInfoSection(),this},renderHeading:function(){this.headerItem&&this.$el.html(this.headerTmpl(this.headerItem))},renderInfoSection:function(){this.$el.append(s({sections:this.sections}))},addSection:function(){var e=n.randomId();return this.sections.push({id:e,displayItems:[]}),e},addDisplayItem:function(e,t,i,s,a,r){var o=this._getSection(r||this.currentSection);if(!o)return void n.log("FullDetailsSummaryView : incorrect sectionId provided");o.displayItems.push(this._createItem(e,t,i,s,a))},setHeaderItem:function(e,t,i,n,s){this.headerItem=this._createItem(e,t,i,n,s)},_createItem:function(e,t,s,a,r){if(t||(t=i.INVALID_STRING),!e)throw new Error("Must provide a list label to create an item.");var o={label:e,value:t,valueTitle:n.stripHTMLfromStr(t),classStr:"",labelAttr:"",valueAttr:""};return r&&(o.labelAttr=this.toAttrStr(r)),a&&(o.valueAttr=this.toAttrStr(a)),s&&(o.classStr=s),o},toAttrStr:function(e){return _.map(e,function(e,t){return t+'="'+e+'"'}).join(" ")},clearDisplayItem:function(){this.sections=[],this.DEFAULT_SECTION_ID=null,this.headerItem=null},refreshView:function(){this.render()},onAlertLinkClick:function(e){var n=$(e.currentTarget);t.navigateToAlertsPage(null,n.attr(i.NAV_ACTION_TARGET_ID),n.attr(i.NAV_ACTION_TARGET_TYPE),n.data(i.FILTER_ALERT_SEVERITY))},onEventLinkClick:function(e){var n=$(e.currentTarget),s=n.attr(i.NAV_ACTION_TARGET_ID),a=n.attr(i.NAV_ACTION_TARGET_TYPE);t.navigateToEventsPage(i.EVENT.TYPE.ANOMALOUS,s,a)},onEBLinkClick:function(e){var n=$(e.currentTarget);t.navigateToEBPage(n.data(i.NAV_EB_ENITY),n.data(i.NAV_EB_PERSPECTIVE),n.data(i.NAV_EB_FILTER_NAME),n.data(i.NAV_EB_FILTER_VALUE))},onDetailsLinksClick:function(e){var n=$(e.currentTarget);t.navigateToFullScreenDetailsPane(n.attr(i.NAV_ACTION_TARGET),n.attr(i.NAV_ACTION_TARGET_ID),null,n.attr(i.NAV_TARGET_TAB_ID))},onPageLinkClick:function(e){var s,a=$(e.currentTarget),r=a.attr(i.NAV_ACTION_TARGET_ID),o=a.attr(i.NAV_ACTION_TARGET),l=a.attr(i.NAV_TARGET_TAB_ID),c=a.attr(i.NAV_TARGET_PARAMS),u=o===this.model.entityType&&n.getHashParameters(),d=u&&u.contextId?u.contextId:"";d?s=t.getNavigationContext(d):(d=t.createNavigationContext(o),s=t.getNavigationContext(d)),c&&(s.options=s.options||{},s.options[i.NAV_TARGET_PARAMS]=c),this.trigger("onRouteChange"),t.navigateToFullScreenDetailsPane(o,r,d,l,!1)},_getDefaultSectionId:function(){if(!this.DEFAULT_SECTION_ID){var e=n.randomId();this.sections.unshift({id:e,displayItems:[]}),this.DEFAULT_SECTION_ID=e}return this.DEFAULT_SECTION_ID},_getSection:function(e){return e||(e=this._getDefaultSectionId()),_.find(this.sections,function(t){if(t.id===e)return!0})}})}),define("views/basecomponents/pages/fulldetails/FullDetailsEntitySummaryView",["views/basecomponents/pages/fulldetails/FullDetailsSummaryView","data/DataProperties","utils/AppConstants","utils/AppUtil","utils/CommonTemplates"],function(e,t,i,n,s){"use strict";var a=_.template('<a class="ebLink" data-eb-perspective="<%= perspective %>" data-eb-entity="<%= entityType %>" data-eb-filter="<%= filterName %>" data-eb-filter-value="<%= filterValue %>"><%= value %></a>');return e.extend({model:null,ebLinkTemplate:a,modelEvents:{"change   model":"onDataChange","error    model":"onDataError"},events:{"click    a.pageLink":"onPageLinkClick"},refreshView:function(t){t&&t.model&&this.model.getState()===i.STATE_CANCELED?n.addInLineDonutLoader(this.el):e.prototype.refreshView.apply(this,arguments)},onDataChange:function(e){throw new Error("onDataChange method must be defined.")},onDataError:function(e){this.showNoEntityErrorMessage(e)},onStartServices:function(){this.delegateEvents(),this.delegateModelEvents(),this.model.getState()===i.STATE_SUCCESS&&this.onDataChange(this.model)},onStopServices:function(){this.undelegateEvents(),this.undelegateModelEvents()},addClusterLinkItem:function(e,s){var a=this.clusterManager.getClusterModelByClusterUuid(e);if(a){var r=a.get(t.NAME),o=n.createFullPageDetailsLink(r,i.ENTITY_CLUSTER,a.getId());this.addDisplayItem("Cluster Name",o[0].outerHTML,"summary-cluster-name",{title:r},null,s)}},addClusterVersionItem:function(e,i){var n=this.clusterManager.getClusterModelByClusterUuid(e);if(n){var s=n.get(t.CLUSTER_NOS_VERSION);this.addDisplayItem("Cluster Version",s,"summary-cluster-version",{title:s},null,i)}},createPageLink:function(e,t,s){return e?n.createFullPageDetailsLink(e,t,s)[0].outerHTML:i.INVALID_STRING},showNoEntityErrorMessage:function(e){var t=s.DETAILS_NO_ENTITY({entityType:e.name,entityId:e.getId(),entityIdAttribute:e.idAttribute});this.$el.html(t)}})}),define("views/basecomponents/pages/fulldetails/FullDetailsGenericEntitySummaryView",["views/basecomponents/pages/fulldetails/FullDetailsEntitySummaryView","managers/EntityManager","utils/AppConstants","utils/DataRendererUtil"],function(e,t,i,n){"use strict";return e.extend({onDataChange:function(e){this.clearDisplayItem();var s=t.getEntitySchema(e.entityType),a=t.getEntityFullDetailsModel(e.entityType);if(s?this.setHeaderItem(i.ENTITY_NAMES[e.entityType]||"Name",e.escape(s.get(s.DP.NAME_ATTR)),null,{title:e.escape(s.get(s.DP.NAME_ATTR))}):this.setHeaderItem(i.ENTITY_NAMES[e.entityType]||"Name",e.get(e.nameAttribute),null,{title:e.get(e.nameAttribute)}),this.clusterUuid=e.getClusterUuid(),this.addClusterLinkItem(this.clusterUuid),s&&a){var r=a.getSummarySections();_.each(r,function(t,i){var r=null;0!==i&&(r=this.addSection()),_.each(t,function(t){if(!t[a.DP.SUMMARY.HIDE]){var i=s.getAttributeInfo(t[a.DP.SUMMARY.NAME]),o=i?i.displayName:t[a.DP.SUMMARY.NAME],l=n.getRenderer(t),c=l.getAttributeDisplayValue(e);this.addDisplayItem(o,c,null,null,null,r)}},this)},this)}this.refreshView()}})}),define("models/views/BaseViewConfigCollection",["backbone","utils/AppUtil"],function(e,t){"use strict";return e.Collection.extend({url:null,fetch:function(e){var i=this.url;e&&e.url&&(i=e.url);var n=this;return $.getJSON(t.cacheBustURL(i),function(i){try{n.add(n.parseData(i,e)),e&&e.success&&e.success(n,i,e)}catch(s){t.log("Error parsing json. "+s),e&&e.error&&e.error(n,i,e)}})},parseData:function(e,t){return e},findModelById:function(e){return this.find(function(t){return t.get(t.idAttribute)==e})}})}),define("models/views/VantagePointTableModel",["backbone","utils/AppConstants"],function(e,t){"use strict";var i={ASPECT_TYPE:"aspectType",DATA_URL:"dataURL",QUERY_TYPE:"queryType",DISPLAY_ATTRIBUTES:"displayAttributes",SORT_BY:"sortBy",SORT_BY_ORDER:"sortByOrder",LAYOUT:"layout",MORE_LABEL:"moreLabel",SHOW_HEADER:"showHeader",REUSE_CELLS:"reuseCells",SCHEMA_ATTRIBUTES:"schemaAttributes"},n={ALL:"all",INDIVIDUAL:"individual"};return e.Model.extend({idAttribute:i.ASPECT_TYPE,nameAttribute:i.ASPECT_TYPE,name:"VantagePointTableModel",DP:i,LAYOUT:n,getDisplayAttributes:function(){return this.get(i.DISPLAY_ATTRIBUTES)},getDataURL:function(){return this.get(i.DATA_URL)},getSortBy:function(){return this.get(i.SORT_BY)},getSortByOrder:function(){return this.get(i.SORT_BY_ORDER)||t.SORT_ASC},getLayout:function(){return this.get(i.LAYOUT)||n.ALL},getMoreLabel:function(){return this.get(i.MORE_LABEL)||"items"},getMemberAttributes:function(){var e=[];return _.each(this.getDisplayAttributes(),function(t){t[i.SCHEMA_ATTRIBUTES]&&(e=e.concat(t[i.SCHEMA_ATTRIBUTES]))}),e},getSortByInfo:function(){var e=this.get(i.SORT_BY);return e?{sortBy:e,sortOrder:this.getSortByOrder()}:null},showHeader:function(){return!1!==this.get(i.SHOW_HEADER)&&this.getLayout()!==n.INDIVIDUAL},reuseCells:function(){return this.get(i.REUSE_CELLS)||!1}},{DP:i})}),define("models/views/VantagePointTablesCollection",["models/views/BaseViewConfigCollection","data/DataURLConstants","models/views/VantagePointTableModel"],function(e,t,i){"use strict";return e.extend({name:"VantagePointTableCollection",model:i,url:t.VANTAGE_POINT_TABLES,getVantagePointTableModel:function(e){return this.findModelById(e)}})}),define("models/views/EntityConfigurationModel",["backbone","utils/AppConstants","utils/AppUtil","utils/ConfigAccessMixin"],function(e,t,i,n){"use strict";var s={ENTITY_TYPE:"entityType",CONFIGURATIONS:"configurations",CONFIG_TYPE:"configType",DETAILS_TABS:"detailsTabs",ACTION_NAME:"actionName",TAB_ID:"tabId",TAB_NAME:"tabName",ACTION_ACCESS:"access",EB_ACCESS_ROLES:"roles",EB_CONFIG_TYPE:{ACTIONS:"actions",DETAILS:"details",PERSPECTIVES:"perspectives",QUERIES:"queries",SCHEMA:"schema",LAYOUT:"layout"},NAME:"name"},a=t.ROLE_ACCESS_ORDERS,r=_.keys(a).length;return e.Model.extend(_.extend({},n,{idAttribute:s.ENTITY_TYPE,nameAttribute:s.ENTITY_TYPE,name:"EntityConfigurationModel",DP:s,getConfigurations:function(){return this.get(s.CONFIGURATIONS)},getFilteredConfigurations:function(){var e=this;if(this.get(s.CONFIG_TYPE)===s.EB_CONFIG_TYPE.DETAILS){var t=$.extend(!0,{},this.get(s.CONFIGURATIONS));return _.each(t,function(t){var i=t[s.DETAILS_TABS];t[s.DETAILS_TABS]=e._getAccessFilteredConfigs(i)}),t}var i=this.get(s.CONFIGURATIONS);return this._getAccessFilteredConfigs(i)},_getConfigName:function(e){var i=this.get(s.CONFIG_TYPE);return i===s.EB_CONFIG_TYPE.ACTIONS?e[this.DP.ACTION_NAME]||e[t.NAV_ACTION_ID]:i===s.EB_CONFIG_TYPE.DETAILS?e[this.DP.TAB_NAME]||e[this.DP.TAB_ID]:e[this.DP.NAME]},_getAccessFilteredConfigs:function(e){var t=this,n={};return _.each(e,function(e){var t=this._getConfigName(e),s=e[this.DP.ACTION_ACCESS];if(s){this.hasAccess(s)?(n[t]=n[t]||[],n[t].push(e)):i.debugObject("EntityConfigurationModel:contentPackAccessFilter Filtering out entity config as its not accessible to the user",e)}else n[t]=n[t]||[],n[t].push(e)},this),_.map(n,function(e){return e&&e.length>1&&(e=_.sortBy(e,function(e){return t._getSortOrderByConfigAccess(e[t.DP.ACTION_ACCESS])})),_.first(e)})},_getSortOrderByConfigAccess:function(e){var t=e&&e[this.DP.EB_ACCESS_ROLES];if(t){var i=_.min(t,function(e){return a[e]||0});return a[i]}return _.isEmpty(t)&&e&&this.canAccessByEnvironment(e)?r+1:r+2}}),{DP:s})}),define("models/views/EntityConfigurationCollection",["models/views/BaseViewConfigCollection","models/views/EntityConfigurationModel","data/DataURLConstants"],function(e,t,i){"use strict";return e.extend({CONFIGURATIONS_URL_TEMPLATE:null,name:"EntityConfigurationCollection",model:t,configType:null,entityTypes:null,initialize:function(t,n){n&&n.entityTypes&&(this.entityTypes=n.entityTypes),this.CONFIGURATIONS_URL_TEMPLATE=_.template(i.ENTITY_CONFIGURATIONS),this.url=this.getJSONURL(),e.prototype.initialize.apply(this,arguments)},getJSONURL:function(){return this.CONFIGURATIONS_URL_TEMPLATE({configuration:this.configType})},getEntityTypes:function(){return this.entityTypes},parseData:function(e,i){var n=[],s=[];return _.each(e,function(e,i){s.push(i);var a={entityType:i};a[t.DP.CONFIGURATIONS]=e,a[t.DP.CONFIG_TYPE]=this.configType,n.push(a)},this),this.entityTypes=s,n}})}),define("models/ebrowser/schema/SchemaCollection",["models/views/EntityConfigurationCollection","models/ebrowser/schema/SchemaModel"],function(e,t){"use strict";return e.extend({name:"SchemaCollection",configType:"schema",getEntityTypesWithSchema:function(){return _.map(this.models,function(e){return e.get(e.idAttribute)})},getSchemaModel:function(e){var i=this.findModelById(e),n=i?i.getConfigurations():null;return n?new t(n):null}})}),define("models/actions/ActionModel",["models/BaseModel","utils/AppConstants","utils/AppUtil"],function(e,t,i){"use strict";var n={ACTION_ID:"actionId",ROUTE:"route",ACCESS:"access",TITLE:"title",SHORT_TITLE:"shortTitle",ICON:"icon",GROUP:"group",CONFIRMATION:"confirmation",BULK_ACTION:"bulkAction",CREATE_ACTION:"createAction",KEYWORDS:"keywords",RENDER_TYPE:"renderType",ENABLED:"enabled",ACTION_FILTER:"actionFilter",VIEW_ONLY:"viewonly"},s={BUTTON:"button"};return e.extend({idAttribute:n.ACTION_ID,nameAttribute:n.TITLE,name:"ActionModel",routeTemplate:null,DP:n,RENDER_TYPES:s,defaults:{actionId:null,route:null,title:null,icon:null,group:null,confirmation:null,bulkAction:!1,createAction:!1,keywords:null,enabled:!0},initialize:function(t){e.prototype.initialize.apply(this,arguments),t=t||{},this.set(this.DP.KEYWORDS,t[this.DP.KEYWORDS]||[]),this.set(this.DP.CONFIRMATION,t[this.DP.CONFIRMATION]||""),this.set(this.DP.ENABLED,!0),this.set(this.DP.CREATE_ACTION,t[this.DP.CREATE_ACTION]||!1)},getActionRoute:function(e){return this.routeTemplate||(this.routeTemplate=_.template(JSON.stringify(this.get(this.DP.ROUTE)))),JSON.parse(this.routeTemplate(e))},isDeleteAction:function(){var e=this.get(this.DP.ROUTE);return e&&e[t.NAV_ACTION]===t.ACTION_DELETE},isCreateAction:function(){return this.get(this.DP.CREATE_ACTION)},getAccessAttribute:function(e){return i.getObjectPathValue(this.get(n.ACCESS)||{},e)},getActionId:function(){return this.get(this.DP.ACTION_ID)},getActionFilter:function(){return this.get(this.DP.ACTION_FILTER)},canViewOnlyUserAccess:function(){var e=this.get(this.DP.ACCESS);return e&&e[this.DP.VIEW_ONLY]}},{DP:n})}),define("models/actions/ActionsCollection",["models/BaseCollection","data/DataURLConstants","models/actions/ActionModel","utils/AppUtil"],function(e,t,i,n){"use strict";return e.extend({name:"ActionsCollection",entityType:null,model:i,initialize:function(t,i){if(i=i||{},!i.entityType)throw"Error: entity type not available for actions collection";this.entityType=i.entityType,e.prototype.initialize.apply(this,arguments)},fetch:function(e){var i=_.template(t.ENTITY_CONFIGURATIONS,{configuration:"actions"}),s=this;return $.getJSON(n.cacheBustURL(i),function(t){try{var i=t&&t[s.entityType];s.reset(i||[]),e&&e.success&&e.success(s,i,e)}catch(i){n.log("Error parsing actions json. "+i),e&&e.error&&e.error(s,t,e)}})},getCreateEntityActions:function(){return this.filter(function(e){return e.get(e.DP.CREATE_ACTION)})},getModifyEntityActions:function(){return this.filter(function(e){return!e.get(e.DP.CREATE_ACTION)})},getActionModelByActionId:function(e){return this.find(function(t){return t.getId()===e})}})}),define("models/views/EntityActionsCollection",["models/views/EntityConfigurationCollection","models/actions/ActionsCollection"],function(e,t){"use strict";return e.extend({name:"EntityActionsCollection",configType:"actions",getActionsCollection:function(e){var i=this.findModelById(e),n=i&&i.getFilteredConfigurations();return new t(n||[],{entityType:e})}})}),define("models/ebrowser/layout/LayoutModel",["models/BaseModel","utils/ExploreConstants"],function(e,t){"use strict";var i={GROUPS:"groups",TAB_ID:"tabId",LAYOUT:"layout",GROUP:"group",ACCESS:"access",ROLES:"roles",WIDGETS:"widgets",ENVIRONMENT:"environment",IS_COLLAPSED_NAV:"isCollapsedLeftNav",SEARCH_ENABLED:"searchEnabled",CHILD_ENTITY_TYPE:"child_entity_type",ENTITY_TYPE:"entityType"};return e.extend({name:"LayoutModel",DP:i,defaults:{layout:t.LAYOUT.ONE_COLUMN},getIsLeftNavCollapsed:function(){return this.get(this.DP.IS_COLLAPSED_NAV)},getIsSearchEnabled:function(){return this.get(this.DP.SEARCH_ENABLED)},getTabGroups:function(){var e=this.get(this.DP.GROUPS);return e||[]}},{DP:i})}),define("models/ebrowser/layout/LayoutCollection",["models/views/EntityConfigurationCollection","models/ebrowser/layout/LayoutModel"],function(e,t){"use strict";return e.extend({name:"LayoutCollection",configType:"layout",entityType:null,getLayoutModel:function(e){var t=this.findModelById(e);if(t){var i=t.get(t.DP.CONFIGURATIONS);if(i)return this.createLayoutModel(i)}return null},createLayoutModel:function(e){return new t(e)}})}),define("models/ebrowser/EntityPerspectivesCollection",["models/views/EntityConfigurationCollection","models/views/EntityConfigurationModel"],function(e,t){"use strict";var i={ENTITY_ATTRIBUTES:"entityAttributes",DISPLAY_ATTRIBUTES:"displayAttributes",GROUP_BY_ATTRIBUTES:"groupByAttributes",FILTER_BY_ATTRIBUTES:"filterByAttributes",COLOR_BY_ATTRIBUTES:"colorByAttributes"},n=[i.DISPLAY_ATTRIBUTES,i.GROUP_BY_ATTRIBUTES,i.FILTER_BY_ATTRIBUTES,i.COLOR_BY_ATTRIBUTES],s=t.extend({getFilteredConfigurations:function(e){var s=this,a=t.prototype.getFilteredConfigurations.apply(this,arguments);return a?_.filter(a,function(t){var a=t[i.ENTITY_ATTRIBUTES];return _.each(n,function(t){var i=_.filter(a[t],function(t){return s.canAccessEntityAttribute(e,t)});a[t]=i}),t}):a}});return e.extend({name:"EntityPerspectivesCollection",model:s,configType:"perspectives",getPerspectives:function(e){var t=this.findModelById(e);if(!t)return null;var i=t.getFilteredConfigurations(e);return i||null}})}),define("models/views/DetailsModel",["backbone","data/DataProperties","utils/AppUtil","utils/AppConstants"],function(e,t,i,n){"use strict";var s={DETAILS_TYPE:"detailsType",ENTITY_TYPE:"entityType",PAGE_ID:"pageId",NAME_ATTRIBUTE:"nameAttribute",NAME_FORMATTER:"nameFormatter",ID_ATTRIBUTE:"idAttribute",SUMMARY_SECTIONS:"summarySections",SUMMARY:{NAME:"name",FORMATTER:"formatter",HIDE:"hide"},DETAILS_TABS:"detailsTabs",ATTRIBUTES:{NAME:"name",FORMATTER:"formatter"},TAB:{TAB_ID:"tabId",DISPLAY_VALUE:"displayValue",PERF_CHART_ATTRIBUTES:"perfCharAttributes"}};return e.Model.extend({idAttribute:s.ENTITY_TYPE,nameAttribute:s.ENTITY_TYPE,name:"DetailsModel",DP:s,getSummarySections:function(){return this.get(s.SUMMARY_SECTIONS)},getDetailsTabs:function(){var e=this.get(s.DETAILS_TABS),t={};return _.isArray(e)?_.each(e,function(e){t[e]=n.TAB_DETAILS_NAMES[e]||i.toTitleCase(e)}):t=e,t},getPageId:function(){return this.get(s.PAGE_ID)},getAttributes:function(){var e=[],i=this.get(s.SUMMARY_SECTIONS)||[];return _.each(i,function(i){_.each(i,function(i){e.push(i[t.NAME])})}),e}},{DP:s})}),define("models/views/DetailsCollection",["models/views/EntityConfigurationCollection","models/views/DetailsModel"],function(e,t){"use strict";return e.extend({name:"DetailsCollection",configType:"details",FULL_PAGE_DETAILS_TYPE:"fullPageDetails",getFullPageDetailsModel:function(e){var i=this.findModelById(e);if(i){var n=_.find(i.getFilteredConfigurations(),function(e){return e[t.DP.DETAILS_TYPE]===this.FULL_PAGE_DETAILS_TYPE},this);if(n)return this.createDetailsModel(n)}return null},createDetailsModel:function(e){return new t(e)}})}),define("managers/EntityFactory",["data/DataProperties","data/DataURLConstants","data/DataManager","models/BaseModel","models/BaseCollection","models/PollingCollection","utils/SubModelHelper","utils/AppConstants","utils/AppUtil","utils/AlertUtil"],function(e,t,i,n,s,a,r,o,l,c){"use strict";var u={DETAILS:"details",SCHEMA:"schema",ACTIONS:"actions",PERSPECTIVES:"perspectives",VANTAGE_POINT_TABLES:"vantagePointTables",LAYOUT:"layout"},d={CLUSTER_NAME:"clusterName",CLUSTER_UUID:"clusterUuid",NEW_CLUSTER_UUID:"cluster_uuid",NEW_CLUSTER:"cluster"},h=[o.ENTITY_ALERT,o.ENTITY_AUDIT,o.ENTITY_EVENT,o.ENTITY_CLUSTER,o.ENTITY_VM,o.ENTITY_HOST,o.ENTITY_SERVICE,o.ENTITY_STORAGE_POOL,o.ENTITY_CONTAINER,o.ENTITY_DISK,o.ENTITY_TASK,o.ENTITY_CAP_PLANNING_RESOURCE,o.ENTITY_VIRTUAL_DISK,o.ENTITY_NIC_TEAM,o.ENTITY_NETWORK_SWITCH_INTERFACE,o.ENTITY_NETWORK_SWITCH,e.NW_E_TYPES.VNIC,e.NW_E_TYPES.PNIC,e.NW_E_TYPES.BRIDGE,o.ENTITY_REPORT_CONFIG,o.ENTITY_QOS_POLICY];return{name:"EntityFactory",clusterManager:null,subModelHelper:null,deferredLoaders:null,viewsFactories:null,customModelFactory:null,VIEWS:{TAB_DETAILS:"tabDetails",FULL_PAGE_DETAILS:"fullPageDetails"},initialize:function(e){e?(this.clusterManager=e.clusterManager,this.viewsFactories=e.viewsFactories||{},this.customModelFactory=e.customModelFactory):this.viewsFactories={},this.subModelHelper=new r,this.deferredLoaders={}},setCustomViewFactories:function(e){this.viewsFactories=e},setCustomModelFactory:function(e){this.customModelFactory=e},fetchConfigurations:function(){return this.deferredLoaders.requiredConfigs||(this.deferredLoaders.requiredConfigs=$.Deferred(),this._loadViewConfigClasses()),this.deferredLoaders.requiredConfigs.promise()},fetchPerspectivesConfiguration:function(){return this.deferredLoaders[u.PERSPECTIVES]||(this.deferredLoaders[u.PERSPECTIVES]=$.Deferred(),this._loadPerspectivesCollection()),this.deferredLoaders[u.PERSPECTIVES].promise()},fetchDetailsConfiguration:function(){return this.deferredLoaders[u.DETAILS]||(this.deferredLoaders[u.DETAILS]=$.Deferred(),this._loadDetailsCollection()),this.deferredLoaders[u.DETAILS].promise()},getEntityTypes:function(){return h},getEntityNameIdSchema:function(t){try{var i=this.getEntitySchema(t);if(i)return{idAttribute:i.get(i.DP.ID_ATTR),nameAttribute:i.get(i.DP.NAME_ATTR)}}catch(e){l.log(e)}return{idAttribute:e.ID,nameAttribute:e.NAME}},getEntityTypesWithSchema:function(){var e=this.subModelHelper.get(u.SCHEMA);return e?e.getEntityTypesWithSchema():[]},getEntitySchema:function(e){var t=this.subModelHelper.get(u.SCHEMA);if(t)return t.getSchemaModel(e);throw Error("Undefined Entity schema  for "+e)},getEntityLayout:function(e){var t=this.subModelHelper.get(u.LAYOUT);if(t)return t.getLayoutModel(e)},hasEntityAction:function(e){var t=this.subModelHelper.get(u.ACTIONS);return!!t&&null!==t.getActionsCollection(e)},getEntityActions:function(e){var t=this.subModelHelper.get(u.ACTIONS);return t?t.getActionsCollection(e):null},getEntityActionTitle:function(e){e===o.ENTITY_NODE&&(e=o.ENTITY_HOST);var t=this.subModelHelper.get(u.ACTIONS);if(t)return t.getActionsCollection(e);throw"Undefined Entity schema  for "+e},getEntityFullDetailsModel:function(e){var t=this.subModelHelper.get(u.DETAILS);return t?t.getFullPageDetailsModel(e):null},getEntityVantagePointTableModel:function(e){var t=this.subModelHelper.get(u.VANTAGE_POINT_TABLES);return t?t.getVantagePointTableModel(e):null},getEntityDataURL:function(e){switch(e){case o.ENTITY_ALERT:return t.ALERT;case o.ENTITY_CLUSTER:return t.CLUSTERS;case o.ENTITY_VM:return t.VM;case o.ENTITY_CONTAINER:return t.CONTAINER;case o.ENTITY_STORAGE_POOL:return t.STORAGEPOOL;case o.ENTITY_HOST:case o.ENTITY_NODE:return t.HOST;case o.ENTITY_PROTECTION_DOMAIN:case o.ENTITY_ASYNC_PD:case o.ENTITY_METRO_AVAILABILITY_PD:return t.PROTECTION_DOMAIN;case o.ENTITY_REMOTE_SITE:return t.REMOTE_SITE;case o.ENTITY_SNAPSHOT:return t.SNAPSHOT;case o.ENTITY_DISK:return t.DISK;case o.ENTITY_SERVICE:return t.SERVICE;case o.ENTITY_TASK:return t.TASK;case o.ENTITY_CVM:return t.VM;case o.ENTITY_CONFLICTING_POLICY:return t.CONFLICTING_POLICIES;default:return e}},createGenericEntityModelClass:function(e){return this._createGenericModelClass(e,this.getEntityDataURL(e),this.getEntityNameIdSchema(e))},createEntityActionModelClass:function(e,t){if(this.customModelFactory){var i=this.customModelFactory.getCustomActionModel(e,t);if(i)return i}return this._createGenericModelClass(e,this.getEntityDataURL(e),this.getEntityNameIdSchema(e))},createGenericModelClassByURL:function(e,t){return this._createGenericModelClass(e,t,this.getEntityNameIdSchema(e))},createGenericEntityCollectionClass:function(e,t,i,n){if(this.customModelFactory){var s=this.customModelFactory.getCustomModelCollectionByURL(t);if(s)return s}return this._createGenericCollectionClass(e,t||this.getEntityDataURL(e),this.getEntityNameIdSchema(e),i)},_createGenericModelClass:function(t,s,a){if(this.customModelFactory){var r=this.customModelFactory.getCustomModel(t);if(r)return r}var l="Generic"+t+"Model";return n.extend({idAttribute:a.idAttribute,nameAttribute:a.nameAttribute,urlRoot:s,name:l,entityType:t,entityId:null,initialize:function(e,t){n.prototype.initialize.apply(this,arguments),this.entityType===o.ENTITY_ALERT||this.entityType===o.ENTITY_EVENT||this.entityType===o.ENTITY_AUDIT?this.nameParserFunc=this.formatAlertName:this.nameParserFunc=null},getValue:function(t){var i=n.prototype.getValue.apply(this,arguments);if(t===d.CLUSTER_NAME&&!i){var s=this.getValue(d.CLUSTER_UUID);s=s||this.getValue(d.NEW_CLUSTER_UUID),s=s||this.getValue(d.NEW_CLUSTER),s&&(i=this.clusterManager.getNameById(s)),i||(i=s)}return t===this.idAttribute&&this.entityType===o.ENTITY_GPU?this.get(this.idAttribute)+o.GRAPH_DATA_SEPARATOR+this.get(e.EB.GPU.NODE):i},getClusterUuid:function(){return this.get(d.NEW_CLUSTER_UUID)||this.get(d.CLUSTER_UUID)||this.get(d.NEW_CLUSTER)},toJSON:function(e){var t=n.prototype.toJSON.apply(this,arguments);return e&&e.includeCustomAttributes&&!t[d.CLUSTER_NAME]&&t[d.CLUSTER_UUID]&&(t[d.CLUSTER_NAME]=this.getValue(d.CLUSTER_NAME)),t},formatAlertName:function(){return c.getAlertDisplayName(this)},getDataSourceURL:function(){return this.entityType===o.ENTITY_CONFLICTING_POLICY?i.getV2DataSourceURL():n.prototype.getDataSourceURL.apply(this,arguments)}})},_createGenericCollectionClass:function(e,t,n,r){var l="Generic_"+e+"_Collection",c=this._createGenericModelClass(e,t,n),u=s;return r&&(u=a),u.extend({model:c,url:t,name:l,getDataSourceURL:function(){return e===o.ENTITY_CONFLICTING_POLICY?i.getV2DataSourceURL():s.prototype.getDataSourceURL.apply(this,arguments)}})},loadDetailsViewContents:function(e,t){var i=this;this.fetchDetailsConfiguration().always(function(){i._loadDetailsViewContents(e,t)})},_loadDetailsViewContents:function(e,t){var i=!1;if(this.viewsFactories[this.VIEWS.FULL_PAGE_DETAILS]&&(i=this.viewsFactories[this.VIEWS.FULL_PAGE_DETAILS].loadDetailsViewContents(e,t)),!i){var n=_.bind(function(i,n){t(this.createGenericEntityModelClass(e),i,n)},this);require(["views/basecomponents/pages/fulldetails/FullDetailsGenericEntityTabView","views/basecomponents/pages/fulldetails/FullDetailsGenericActionBarView"],n)}},loadTabDetailsView:function(e,t,i){if(!this.viewsFactories[this.VIEWS.TAB_DETAILS])throw"Undefined tab details view factory";this.viewsFactories[this.VIEWS.TAB_DETAILS].loadTabDetailsView(e,t,i)},loadSummaryViewContents:function(e,t){var i=!1;this.viewsFactories[this.VIEWS.TAB_DETAILS]&&(i=this.viewsFactories[this.VIEWS.TAB_DETAILS].loadSummaryViewContents(e,t)),i||require(["views/basecomponents/pages/fulldetails/FullDetailsGenericEntitySummaryView"],t)},_initializeViewConfigModels:function(e,t,i,n){var s=[],a=this.getEntityTypes(),r=new e;this.subModelHelper.register(u.VANTAGE_POINT_TABLES,r),s.push(r.fetch());var o=new t(null,{entityTypes:a});this.subModelHelper.register(u.SCHEMA,o),s.push(o.fetch());var l=new i(null,{entityTypes:a})
;this.subModelHelper.register(u.ACTIONS,l),s.push(l.fetch());var c=new n(null,{entityTypes:a});this.subModelHelper.register(u.LAYOUT,c),s.push(c.fetch());var d=this;$.whenAll.apply($,s).done(function(){d.deferredLoaders.requiredConfigs.resolve([r,o,l],"success")})},_loadViewConfigClasses:function(){require(["models/views/VantagePointTablesCollection","models/ebrowser/schema/SchemaCollection","models/views/EntityActionsCollection","models/ebrowser/layout/LayoutCollection"],_.bind(this._initializeViewConfigModels,this))},_loadPerspectivesCollection:function(){require(["models/ebrowser/EntityPerspectivesCollection"],_.bind(function(e){var t=this.getEntityTypes(),i=new e(null,{entityTypes:t});this.subModelHelper.register(u.PERSPECTIVES,i);var n=this;i.fetch().done(function(){n.deferredLoaders[u.PERSPECTIVES].resolve(i,"success")}).fail(function(){n.deferredLoaders[u.PERSPECTIVES].reject(i,"failed")})},this))},_loadDetailsCollection:function(){require(["models/views/DetailsCollection"],_.bind(function(e){var t=this.getEntityTypes(),i=new e(null,{entityTypes:t});this.subModelHelper.register(u.DETAILS,i);var n=this;i.fetch().done(function(){n.deferredLoaders[u.DETAILS].resolve(i,"success")}).fail(function(){n.deferredLoaders[u.DETAILS].reject(i,"failed")})},this))}}}),define("models/genesis/ConvertClusterFatalModel",["models/genesis/GenesisBaseModel","utils/AppConstants"],function(e,t){"use strict";return e.extend({name:"ConvertClusterFatalModel",methodName:t.CLUSTER_CONVERSION_METHODS.IS_FATAL_FAILURE,managerName:t.GENESIS.CLUSTER_CONVERSION,setRPCParams:function(e){_.extend(this.kwargs,{task_uuid_str:e})},getErrorResponse:function(){return this.getParsedErrorResponse("Error checking if convert cluster operation fatal failed.")}})}),define("models/genesis/AbortClusterConversionModel",["models/genesis/GenesisBaseModel","utils/AppConstants"],function(e,t){"use strict";return e.extend({ERROR_MSG:"Failed to abort cluster conversion.",name:"AbortClusterConversionModel",methodName:t.CLUSTER_CONVERSION_METHODS.ABORT_CLUSTER_CONVERSION,managerName:t.GENESIS.CLUSTER_CONVERSION,getReturnResponse:function(){return this.get(e.DP.GENESIS_RETURN)||[]}})}),define("models/genesis/ConvertClusterFailedModel",["models/genesis/GenesisBaseModel","utils/AppConstants"],function(e,t){"use strict";return e.extend({name:"ConvertClusterFailedModel",methodName:t.CLUSTER_CONVERSION_METHODS.CONVERT_CLUSTER_FAILED,managerName:t.GENESIS.CLUSTER_CONVERSION,getErrorResponse:function(){return this.getParsedErrorResponse("Error checking if convert cluster operation failed.")}})}),define("models/genesis/ConvertClusterResumeModel",["models/genesis/GenesisBaseModel","utils/AppConstants"],function(e,t){"use strict";return e.extend({name:"ConvertClusterResumeModel",methodName:t.CLUSTER_CONVERSION_METHODS.RESUME_CLUSTER_CONVERSION,managerName:t.GENESIS.CLUSTER_CONVERSION,getErrorResponse:function(){return this.getParsedErrorResponse("Error resuming cluster conversion.")}})}),define("managers/ClusterConvertManager",["models/genesis/ConvertClusterFatalModel","models/genesis/AbortClusterConversionModel","models/genesis/ConvertClusterFailedModel","models/genesis/ConvertClusterResumeModel","events/AppEvents","utils/AppConstants","data/DataProperties","managers/TaskManager","managers/I18nManager","managers/NotificationManager"],function(e,t,i,n,s,a,r,o,l,c){"use strict";return{initialize:function(){_.bindAll(this,"checkStatus"),this.checkInitStatus=this.checkStatus.bind(this,null),o.registerHandlerResetStructure(this.checkInitStatus,this),o.registerHandlerForChangedTasks(this.checkStatus,this)},destroy:function(){o.unregisterHandlerForChangedTasks(this.checkStatus,this)},getConvertNodeFailedTask:function(e){return e.find(function(e){return e.get(r.TASK_TYPE)===a.TASK_OPERATION_CONVERT_NODE&&e.isStatusFailed()},this)},getGlobalConvertNodeFailedTask:function(){var e=[],t=o.getGlobalTasks().filter(function(t){var i=_.first(t.get(r.TASK_ENTITY_ID)||[]);return _.indexOf(e,i)<0&&t.get(r.TASK_TYPE)===a.TASK_OPERATION_CONVERT_NODE&&(e.push(i),!0)});return _.find(t,function(e){return e.isStatusFailed()})},checkStatus:function(u){var d;null===u?(d=this.getGlobalConvertNodeFailedTask(),o.unregisterHandlerResetStructure(this.checkInitStatus,this)):d=this.getConvertNodeFailedTask(u);var h=o.getGlobalTasks().hasActiveClusterConvertTask();if(s.triggerAppEvent(s.NODE_CONVERSION_IN_PROGRESS,{inProgress:!!h}),d){var p=new e;p.setRPCParams(d.get(r.ID));var T=new i,E=[p.fetch(),T.fetch()];$.when.apply($,E).then(function(){if(!T.getReturnResponse()){var e=d.get(r.SUB_TASK_MESSAGE)||d.get(r.TASK_MESSAGE),i="NodeConversionPopupView",s=!p.hasErrorResponse()&&p.getParsedReturnResponse(),o=p.getParsedErrorResponse();!_.isEmpty(o)&&_.isEmpty(e)&&(e=o),$.nutanixConfirm({msg:l.ts(i,"failMsg",e||" "),extHTML:l.ts(i,"failHelp",['<a href="https://portal.nutanix.com/#/page/kbs/details?targetId=kA032000000TVweCAG" target="_blank">',"</a>"]),yes:function(){var e=c.showLatencyMessage(l.t(i,"abortInit")),n=new t;n.fetch({success:function(){n.getParsedReturnResponse()?(c.hideLatencyMessage(e),c.showClientNotification(a.NOTIFY_SUCCESS,l.t(i,"abortSuccess"))):(c.hideLatencyMessage(e),c.showClientNotification(a.NOTIFY_ERROR,l.ts(i,"abortFail",n.getParsedErrorResponse())))}})},no:function(){var e=c.showLatencyMessage(l.t(i,"resumeInit")),t=new n;t.fetch({success:function(){c.hideLatencyMessage(e),c.showClientNotification(a.NOTIFY_SUCCESS,l.t(i,"resumeSuccess"))},error:function(){c.hideLatencyMessage(e),c.showClientNotification(a.NOTIFY_ERROR,l.ts(i,"resumeFail",t.getParsedErrorResponse()))}})},yesText:l.t(i,"abort"),noText:l.t(i,"proceed"),hideNo:s})}})}}}}),define("utils/tooltips/BaseTooltips",["utils/I18nMixin","utils/ManagerMixin"],function(e,t){"use strict";return _.extend({},e,t,{extend:function(e){return _.extend({},this,e)},showTooltipIndicator:function(e,t,i){return e.getValue(t)},getTooltipText:function(e,t,i,n){return e.getValue(i)}})}),define("utils/tooltips/TaskTooltips",["data/DataProperties","utils/AppConstants","utils/tooltips/BaseTooltips"],function(e,t,i){"use strict";var n=_.template('\n      <a class="n-tooltip-action"\n        action="<%= action %>"\n        actionTarget="<%= entityType %>"\n        actionTargetId="<%= id %>"\n        title="<%= title %>">\n        <%= displayValue %>\n      </a>\n    ');return i.extend({name:"taskTooltips",showTooltipIndicator:function(e,t,i){return!!e.isScheduleJob()},getTooltipText:function(i,s,a,r){return n({entityType:t.ENTITY_CLUSTER,id:i.getId(),title:"Click to View the Schedule",displayValue:i.get(e.TASK_DISPLAY_NAME),action:t.ACTION_UPDATE_CLUSTER})}})}),define("utils/tooltips/ClusterTooltips",["data/DataProperties","utils/AppConstants","utils/TimeUtil","utils/tooltips/BaseTooltips"],function(e,t,i,n){"use strict";var s={START_TIME:"start_time",TIME_ZONE:"time_zone"};return n.extend({name:"clusterTooltips",showTooltipIndicator:function(i,n,s){switch(n){case e.EB.CLUSTER.CLUSTER_UPGRAD_STATUS:if(i.getValue(e.EB.CLUSTER.CLUSTER_UPGRAD_STATUS)===t.SCHEDULE_STATUS.SCHEDULED){var a=this.getTaskManager(),r=a.getScheduleTasks();return _.some(r,function(n){var s=n.get(e.TASK_ENTITY_ID);return n.get(e.TASK_NEW_STATUS)===t.TASK_STATUS_SCHEDULED&&s&&s.indexOf(i.getId())>=0})}break;case e.EB.CLUSTER.VERSION:if(this.isReadOnly(i))return!0;break;default:return!1}return!1},getTooltipText:function(n,a,r,o){switch(a){case e.EB.CLUSTER.CLUSTER_UPGRAD_STATUS:if(n.getValue(e.EB.CLUSTER.CLUSTER_UPGRAD_STATUS)===t.SCHEDULE_STATUS.SCHEDULED){var l=this.getTaskManager().getScheduleTasks(),c=_.find(l,function(t){var i=t.get(e.TASK_ENTITY_ID);return i&&i.indexOf(n.getId())>=0});if(c){return c.get(e.TASK_DISPLAY_NAME)+"<br>schedule for "+i.formatDateTimeWithTimeZone(c.get(s.START_TIME),c.get(s.TIME_ZONE))}}break;case e.EB.CLUSTER.VERSION:if(this.isReadOnly(n))return this.i18ns("tooltip_read_only",{link_open:'\n                    <a class="n-tooltip-action"\n                      action="'+t.ACTION_ENTER_OVERRIDE_MODE+'"\n                      actionTarget="'+t.ENTITY_CLUSTER+'"\n                      actionTargetId="'+n.get("id")+'"\n                      title="">',link_close:"</a>"});break;default:return""}},isReadOnly:function(e){var i=this.getClusterManager(),n=e.getId(),s=i&&i.getClusterModelById(n);return this.getAccessManager().canModifyByEntityType(t.ENTITY_CLUSTER)&&s&&s.isReadOnly()}})}),define("managers/TooltipManager",["managers/BaseManager","managers/ActionManager","utils/AppConstants","utils/tooltips/TaskTooltips","utils/tooltips/ClusterTooltips"],function(e,t,i,n,s){"use strict";var a;return e.extend({name:i.MANAGER.TOOLTIP,TOOLTIP_SELECTOR:".nx-tooltip-indicator[data-toggle=tooltip]",TOOLTIP_WRAPPER_CLASS:"nx-tooltip-wrapper",TOOLTIP_INDICATOR_CLASS:"nx-tooltip-indicator",TOOLTIP_MOUSE_EVENTS:{MOUSE_ENTER:"mouseenter .nx-tooltip-wrapper",MOUSE_LEAVE:"mouseleave .nx-tooltip-wrapper"},ENTITY_TOOLTIPS:(a={},_defineProperty(a,i.ENTITY_CLUSTER,s),_defineProperty(a,i.ENTITY_TASK,n),a),initialize:function(){this.addToManagerHelper(),_.bindAll(this,"onTooltipAction"),$("body").on("click",".tooltip > .tooltip-inner .n-tooltip-action",this.onTooltipAction)},destroyTooltips:function(){$(this.TOOLTIP_SELECTOR).attr("tooltipShown","false"),$(this.TOOLTIP_SELECTOR).tooltip("destroy")},onTooltipAction:function(e){t.executeActionElement(e.currentTarget,{changeUrl:!1}),this.destroyTooltips()},showTooltipIndicator:function(e,t,i){var n=this.ENTITY_TOOLTIPS[e.entityType];return!!n&&n.showTooltipIndicator.apply(n,arguments)},getTooltipText:function(e,t,i,n){var s=this.ENTITY_TOOLTIPS[e.entityType];return s?s.getTooltipText.apply(s,arguments):""}})}),define("views/basecomponents/details/tabs/BaseTabContentDetailsView",["views/basecomponents/BaseView","utils/AppUtil"],function(e,t){"use strict";return e.extend({className:"n-tab-details-content tab",extraClassName:null,tabId:null,pageId:null,entityName:null,entityType:null,currentModelId:null,initialize:function(t){e.prototype.initialize.apply(this,arguments),this.pageId=t.pageId,this.entityType=t.entityType,this.entityName=t.entityName,this.currentModel=t.currentModel||t.model,this.extraClassName&&this.$el.addClass(this.extraClassName),this.initializeProperties(t)},initializeProperties:function(e){},render:function(){return this},show:function(){this.$el.show()},hide:function(){this.$el.hide()},refreshView:function(){this.tableView&&this.tableView.refreshData&&this.tableView.refreshData()},setModelId:function(e){t.isValidId(e)&&this.currentModelId!==e&&(this.currentModelId=e,this.postSetModelId(e))},getModelId:function(){return this.currentModelId},postSetModelId:function(e){},triggerHeaderCountChange:function(){}})}),define("models/alert/AlertActionModel",["models/BaseModel","data/DataManager","data/DataURLConstants","events/AppEvents","utils/AppConstants"],function(e,t,i,n,s){"use strict";var a={resolve:"Resolving alert(s) failed",acknowledge:"Acknowledging alert(s) failed"},r={ID:"id",ALERT_IDS:"alertIds",RESOLVED:"resolved",ACKNOWLEDGED:"acknowledged",CATEGORY:"category",CATEGORIES:"categories",ENTITY_TYPE:"entityType",ENTITY_TYPE_IDS:"entityTypeIds"};return e.extend({urlRoot:i.ALERT_ACKNOWLEDGE,name:"AlertActionModel",entityType:s.ENTITY_ALERT,alertEntityType:null,alertEntityId:null,defaults:{alertIds:[]},getUpdatedMethod:function(e,t,i){return"create"},parseOptions:function(n,a,o){return o=e.prototype.parseOptions.apply(this,arguments),this.unset(r.ID),a.actionMode===s.ACTION_RESOLVE?o.url=t.getFormattedURL(i.ALERT_RESOLVE):a.actionMode===s.ACTION_ACKNOWLEDGE?o.url=t.getFormattedURL(i.ALERT_ACKNOWLEDGE):a.actionMode===s.ACTION_RESOLVE_ALL?(o.url=t.getFormattedURL(i.ALERT_RESOLVE_ALL),this.appendFilteredAlertURLParameters(o)):a.actionMode===s.ACTION_ACKNOWLEDGE_ALL&&(o.url=t.getFormattedURL(i.ALERT_ACKNOWLEDGE_ALL),this.appendFilteredAlertURLParameters(o)),o},toJSON:function(){return this.get(r.ALERT_IDS)},save:function(){var t=this;return e.prototype.save.apply(this,arguments).fail(function(){t.showNotification(s.NOTIFY_ERROR,t,t.actionMode)})},performAction:function(e,t,i){return e!==s.ACTION_RESOLVE_ALL&&e!==s.ACTION_ACKNOWLEDGE_ALL&&(t&&!_.isArray(t)&&(t=t.split(",")),this.set(r.ALERT_IDS,t,{silent:!0})),i.filterExpression&&(this._parameters=_.extend(this._parameters||{},this.filterExpressionToQueryParams(i.filterExpression))),this.actionMode=e,this.save(null,i)},filterExpressionToQueryParams:function(e){var t={};return _.each(e,function(e,i){_.each(e,function(e){t[i]?t[i]=t[i]+","+e.value1:t[i]=e.value1})}),t},resolveAlerts:function(e){this.resolve(e)},resolve:function(e){this.setRequest(e,s.ACTION_RESOLVE)},acknowledgeAlerts:function(e){this.acknowledge(e)},acknowledgeAllAlerts:function(){this.actionMode=s.ACTION_ACKNOWLEDGE_ALL,this.save()},resolveAllAlerts:function(){this.actionMode=s.ACTION_RESOLVE_ALL,this.save()},acknowledge:function(e){this.setRequest(e,s.ACTION_ACKNOWLEDGE)},setRequest:function(e,t){this.set(r.ALERT_IDS,e,{silent:!0}),this.actionMode=t,this.save()},showSuccessNotification:function(e,t,i){var n=s.NOTIFY_SUCCESS,r=i;this.actionMode!==s.ACTION_RESOLVE&&this.actionMode!==s.ACTION_ACKNOWLEDGE||_.some(i,function(e){return!e.successful})&&(n=s.NOTIFY_ERROR,r={responseText:a[this.actionMode]}),this.showNotification(n,e,t,r)},showNotification:function(e,t,i,o){e!==s.NOTIFY_ERROR||o||(o={responseText:a[this.actionMode]}),this.getNotificationManager().showNotification(e,t,i,o||{}),n.triggerAppEvent(n.ENTITIES_UPDATED,{entityType:s.ENTITY_ALERT,entityIds:this.get(r.ALERT_IDS)})},getSuccessNotificationMsg:function(){return this.actionMode===s.ACTION_RESOLVE||this.actionMode===s.ACTION_RESOLVE_ALL?this.i18n("resolve_success"):this.i18n("acknowledge_success")},setAlertEntityType:function(e){this.alertEntityType=e},setAlertEntityId:function(e){this.alertEntityId=e},appendFilteredAlertURLParameters:function(e){var t=[];this.alertEntityType&&t.push(r.ENTITY_TYPE+"="+encodeURIComponent(this.alertEntityType)),this.alertEntityId&&t.push(r.ENTITY_TYPE_IDS+"="+encodeURIComponent(this.alertEntityId)),_.each(this._parameters,function(e,i){i!==r.RESOLVED&&(i===r.CATEGORY&&(i=r.CATEGORIES),t.push(i+"="+encodeURIComponent(e)))}),t.length>0&&(e.url+="?"+t.join("&"))}})}),define("models/alert/PCAlertActionModel",["models/alert/AlertActionModel","data/DataManager","data/DataURLConstants","events/AppEvents","utils/AppConstants"],function(e,t,i,n,s){"use strict";var a={ALERT_IDS:"alertIds"};return e.extend({urlRoot:i.ALERT_ACKNOWLEDGE_V3,name:"PCAlertActionModel",parseOptions:function(t,n){var a=this.getDataManager(),r=e.prototype.parseOptions.apply(this,arguments);return n.actionMode===s.ACTION_RESOLVE?r.url=a.getFormattedURL(i.ALERT_RESOLVE_V3,null,a.API_VERSION.V3):n.actionMode===s.ACTION_ACKNOWLEDGE&&(r.url=a.getFormattedURL(i.ALERT_ACKNOWLEDGE_V3,null,a.API_VERSION.V3)),r},toJSON:function(){return{alert_uuid_list:this.get(a.ALERT_IDS)}},save:function(){var t=this;return e.prototype.save.apply(this,arguments).then(function(e){if(t.actionMode!==s.ACTION_RESOLVE_ALL&&t.actionMode!==s.ACTION_ACKNOWLEDGE_ALL){var i=e.task_uuid;t.getTaskManager().pollIntentTask(i).then(function(e){var i=s.NOTIFY_ERROR;e.status&&e.status.toLowerCase()===s.TASK_STATUS_COMPLETE&&(i=s.NOTIFY_SUCCESS,n.triggerAppEvent(n.ENTITIES_UPDATED,{entityType:s.ENTITY_ALERT,entityIds:t.get(a.ALERT_IDS)})),t.showNotification(i,t,t.actionMode,!0)}).fail(function(){t.showNotification(s.NOTIFY_ERROR,t,t.actionMode)})}})},showSuccessNotification:function(e,t,i,n){(this.actionMode!==s.ACTION_ACKNOWLEDGE&&this.actionMode!==s.ACTION_RESOLVE||n)&&this.showNotification(s.NOTIFY_SUCCESS,e,t,i)},getSuccessNotificationMsg:function(){var t=e.prototype.getSuccessNotificationMsg.apply(this,arguments);return this.actionMode!==s.ACTION_RESOLVE_ALL&&this.actionMode!==s.ACTION_ACKNOWLEDGE_ALL||(t+=" "+this.i18n("wait_for_update")),t}})}),define("views/basecomponents/datatables/ActionView",["views/basecomponents/BaseView","views/basecomponents/datatables/DataTableTemplates","managers/AlertManager","models/alert/AlertActionModel","models/alert/PCAlertActionModel","utils/AppUtil","utils/AppConstants","utils/ManagerMixin","events/AppEvents"],function(e,t,i,n,s,a,r,o,l){"use strict";return e.extend(_.extend({},o,{_entityType:null,_entityIds:null,currentAction:null,className:"n-action",modelEvents:{"sync     model":"showSuccess","error    model":"showError","pending  model":"showLoading"},initialize:function(t){switch(e.prototype.initialize.apply(this,arguments),this._entityType=t.entityType,this._entityType){case r.ENTITY_VM:case r.ENTITY_STORAGE_POOL:case r.ENTITY_CONTAINER:case r.ENTITY_HOST:case r.ENTITY_DISK:case r.ENTITY_FILE_SERVER:break;case r.ENTITY_ALERT:this.getClusterManager().isMulticlusterNavMode()?this.model=new s:this.model=new n,this.events={"click .btnAcknowledge":"onClickAcknowledge","click .btnResolve":"onClickResolve","click .btnAcknowledgeAll":"onClickAcknowledgeAll","click .btnResolveAll":"onClickResolveAll"};break;case r.ENTITY_SNAPSHOT:this.model=t.model,this.events={"click .btnDelete":"onDeleteClickAction"}}this.model&&(this.model.alwaysTriggerPending=!0,this.model.alwaysTriggerChange=!0)},render:function(){if(this.$el.empty(),this.$el.append(t.ACTION_COUNT),this.canModifyByEntityType(this._entityType))switch(this._entityType){case r.ENTITY_VM:case r.ENTITY_EVENT:case r.ENTITY_STORAGE_POOL:case r.ENTITY_CONTAINER:case r.ENTITY_HOST:case r.ENTITY_DISK:case r.ENTITY_FILE_SERVER:case r.ENTITY_SHARE:break;case r.ENTITY_ALERT:this.$el.append(t.ACTION_BUTTONS_ALERT);break;case r.ENTITY_SNAPSHOT:this.$el.append(t.ACTION_BUTTONS_DELETE)}return this},show:function(){this.$el.css("display","inline-block")},hide:function(){this.$el.hide()},setIds:function(e,i,n){this._entityIds=_.isArray(e)?e:[e],i&&i!==this._entityIds.length?(this.$(".n-entity-count").html(this._entityIds.length+" of "+i+" rows selected. "),this.$(".n-entity-count").append(t.PAGE_SELECT_ALL_LINK({total:i}))):(this.$(".n-entity-count").html(this._entityIds.length+" selected."),i&&i===this._entityIds.length&&n&&n<i&&this.$(".n-entity-count").append(t.PAGE_CLEAR_SELECTION_LINK())),this._entityIds.length?this.show():this.hide()},showSuccess:function(){this.$(".btnAction").removeAttr("disabled").removeClass("n-a-button-disable"),this._entityType===r.ENTITY_ALERT&&(this.clusterManager.isClusterFFEnabled(r.FFLAGS.SUPPORT_PAGINATION)||i.fetchOnDemand()),this.trigger(l.TABLE_ACTION_SUCCESS,_.clone(this.currentAction)),this.currentAction=null},showError:function(){this.$(".btnAction").removeAttr("disabled").removeClass("n-a-button-disable"),this._entityType===r.ENTITY_ALERT&&i.fetchOnDemand(),this.trigger(l.TABLE_ACTION_ERROR,_.clone(this.currentAction)),this.currentAction=null},showLoading:function(){this.$(".btnAction").attr("disabled","disabled").addClass("n-a-button-disable"),this.trigger(l.TABLE_ACTION_PENDING,_.clone(this.currentAction))},onClickAcknowledge:function(){this.model.getState()!==r.STATE_PENDING&&(this.currentAction=r.ACTION_ACKNOWLEDGE,this.model.acknowledgeAlerts(this._entityIds),this.trigger(l.TABLE_ACTION_INVOKED,_.clone(this.currentAction)))},onClickResolve:function(){this.model.getState()!==r.STATE_PENDING&&(this.currentAction=r.ACTION_RESOLVE,this.model.resolveAlerts(this._entityIds),this.trigger(l.TABLE_ACTION_INVOKED,_.clone(this.currentAction)))},onClickAcknowledgeAll:function(){this.model.getState()!==r.STATE_PENDING&&(this.currentAction=r.ACTION_ACKNOWLEDGE_ALL,this.model.acknowledgeAllAlerts(),this.trigger(l.TABLE_ACTION_INVOKED,_.clone(this.currentAction)))},onClickResolveAll:function(){this.model.getState()!==r.STATE_PENDING&&(this.currentAction=r.ACTION_RESOLVE_ALL,this.model.resolveAllAlerts(),this.trigger(l.TABLE_ACTION_INVOKED,_.clone(this.currentAction)))},onClickAcknowledgeEvents:function(){this.model.getState()!==r.STATE_PENDING&&(this.currentAction=r.ACTION_ACKNOWLEDGE,this.model.acknowledgeEvents(this._entityIds),this.trigger(l.TABLE_ACTION_INVOKED,_.clone(this.currentAction)))},onClickAcknowledgeAllEvents:function(){this.model.getState()!==r.STATE_PENDING&&(this.currentAction=r.ACTION_ACKNOWLEDGE_ALL,this.model.acknowledgeAllEvents(),this.trigger(l.TABLE_ACTION_INVOKED,_.clone(this.currentAction)))},onDeleteClickAction:function(e){if(this.model&&this.model.getState()!==r.STATE_PENDING&&"function"==typeof this.model.deleteItemsByIds&&(this.currentAction=r.ACTION_DELETE,this._entityIds&&this._entityIds.length>0)){var t="Delete "+this._entityIds.length+" "+a.getEntityNameFromCount(this._entityType,this._entityIds.length)+"?",i=this;$.nutanixConfirm({msg:t,yes:function(){i.model.deleteItemsByIds(i._entityIds)},yesText:"Yes",noText:"No"})}},onStartServices:function(){this.delegateEvents(),this.model&&this.delegateModelEvents()},onStopServices:function(){this.undelegateEvents(),this.model&&this.undelegateModelEvents()}}))}),define("views/basecomponents/datatables/AlertEventActionView",["views/basecomponents/datatables/ActionView","views/basecomponents/datatables/DataTableTemplates","managers/ClusterManager","utils/AppConstants"],function(e,t,i,n){"use strict";return e.extend({setAlertActionViewOptions:function(e){e.entityType!==n.ENTITY_ALERT&&(this.model.setAlertEntityType(e.entityType),this.model.setAlertEntityId(e.entityId))},setIds:function(e,n,s,a){this._entityIds=_.isArray(e)?e:[e];var r=!i.isMulticlusterNavMode(),o=this.canModifyByEntityType(this._entityType);this.$el.empty(),this.$el.append(t.ACTION_COUNT),a?(this.$(".n-entity-count").html(this._entityIds.length+" of "+n+" rows selected. "),o&&(this.updateAcknowledgeResolveButtons(!0),r&&(this.$(".n-entity-count").append(t.PAGE_SELECT_ALL_LINK({total:n})),this.$(".n-entity-count").append(t.PAGE_CLEAR_SELECTION_LINK())))):(this.$(".n-entity-count").html(n+" selected."),o&&(this.updateAcknowledgeResolveButtons(!1),r&&this.$(".n-entity-count").append(t.PAGE_CLEAR_SELECTION_LINK()))),this._entityIds.length?this.show():this.hide()},updateAcknowledgeResolveButtons:function(e){this._entityType===n.ENTITY_ALERT&&(e?this.$el.append(t.ACTION_BUTTONS_ALERT):this.$el.append(t.ACTION_BUTTONS_ALERT_ALL))}})}),define("views/basecomponents/datatables/advancedsearchfilter/AdvancedSearchFilterTemplates",[],function(){"use strict";return{FILTER_TAGS_CONTAINER:'<div class="n-filter-advanced">             <div id="tagContainer" class="n-filter-tags-container">&nbsp;</div>           <div id="filterBtnGrp" class="btn-group pull-right">               <button id="btnDropdown"                 class="n-filter-btn btn btn-mini dropdown-toggle -no-caret">                 <i aria-hidden="true" data-icon="z" class="-down-arrow"></i>              </button>               <ul class="dropdown-menu dropdown-menu-right">                 <li id="filterItemsContainer"></li>                 <li class="divider"></li>                 <li>                  <a id="btnFilter" class="btn btn-primary pull-right">                    Apply Filter</a>                </li>              </ul>             </div>           </div>',FILTER_ITEM_BASE:_.template('<label class="n-label"><%= label %></label>          <div class="n-control"></div>'),FILTER_TAG:_.template('<div class="n-filter-tag  <%= tagName %>">             <%= tagName %>             <i class="n-delete-tag" data-icon="K" aria-hidden="true"                tagId="<%= tagId %>" filterId="<%= filterId %>"></i>          </div>'),FILTER_COMBOBOX:_.template('<select id="filterControl<%= cid %>" class="n-filter-select">             <%= options %>           </select>'),FILTER_COMBOBOX_OPTION:_.template('<option value="<%= value || "" %>" <%= checked ? "selected" :"" %>>           <%= label %></option>'),FILTER_RANGE_SELECTOR:'<div class="range-container">              <div class="range-from">               <label>From</label>                <div class="range-start"></div>              </div>           <div class="range-to">             <label>to</label>              <div class="range-end"></div>            </div>         </div>'}}),define("views/basecomponents/datetimepicker/DateTimePickerView",["datepicker","timepicker","views/basecomponents/BaseView","utils/AppConstants","utils/TimeUtil"],function(e,t,i,n,s){"use strict";var a=_.template('\x3c!-- Date Picker--\x3e        <div class="input-append date" id="startDatePicker"             data-date="<%= startDate %>">          <input id="startDate" class="input-small date-time" type="text"                 value="<%= startDate %>">          <span class="add-on"><i class="glyphicon glyphicon-calendar"></i></span>        </div>        \x3c!-- Time picker--\x3e        <div class="input-append bootstrap-timepicker">          <input id="startTime" type="text" class="input-small date-time">         <span class="add-on"><i class="glyphicon glyphicon-time"></i></span>        </div>');return i.extend({className:"n-date-time-picker",_dateString:null,_timeString:null,startDate:null,endDate:null,events:{"click  .glyphicon-calendar":"onCalendarClick"},initialize:function(e){_.bindAll(this,"onBodyClick"),$("body").on("click",this.onBodyClick)},render:function(){this._dateString=this.options.dateString||"",this._timeString=this.options.timeString||"";var e=a({startDate:this._dateString,startTime:this._timeString});this.$el.html(e);var t=this,i=s.getDatePickerOptions();return this.endDate&&(i=_.extend(i,{endDate:this.endDate})),this.startDate&&(i=_.extend(i,{startDate:this.startDate})),this.$("#startDatePicker").datepicker(i).on("changeDate",function(e){var i=t.$("#startDate").val();t._dateString=i,t._timeString?t.constrainTime():t.$("#startTime").timepicker("setTime",new Date),t.triggerChangeEvent()}),this.$("#startTime").timepicker({template:"dropdown",showSeconds:!1,defaultTime:this._timeString}).on("changeTime.timepicker",function(e){var i=t.$("#startTime").val();t._timeString=i,t.constrainTime(),t.triggerChangeEvent()}),this.applyNutanixInput(),this},constrainTime:function(){var e=parseInt(this.$("#startTime").data("min-time"),10),t=parseInt(this.$("#startTime").data("max-time"),10),i=this.getDateTimeValueInUsecs();if(!_.isNaN(e)&&i<=e||!_.isNaN(t)&&i>=t){var s=0;s=e?Math.round((e+n.MILLIS_PER_MINUTE*n.MICROS_PER_MILLI)/1e3):Math.round((t-n.MILLIS_PER_MINUTE*n.MICROS_PER_MILLI)/1e3),this.$("#startTime").timepicker("setTime",new Date(s))}},triggerChangeEvent:function(){this.trigger("changeDateTime",{date:this._dateString,time:this.getDateTimeValueInUsecs()})},setStartDate:function(e){this.startDate=e},setEndDate:function(e){this.endDate=e},setMaxDateTime:function(e){if(e){var t=this.$("#startDatePicker").data("datepicker"),i=e.date;i=this.endDate&&i?this.endDate<i?this.endDate:i:i||this.endDate,t.setEndDate(i),this.$("#startTime").data("max-time",e.time)}},setMinDateTime:function(e){if(e){var t=this.$("#startDatePicker").data("datepicker"),i=e.date;i=this.startDate&&i?i<this.startDate?this.startDate:i:i||this.startDate,t.setStartDate(i),this.$("#startTime").data("min-time",e.time)}},getCurrentTime:function(){return s.formatShortTime(new Date)},getCurrentDate:function(){return s.formatShortDate(new Date)},getDateTimeString:function(){var e=this.$("#startDate").val().trim(),t=this.$("#startTime").val().trim(),i="";return e.length&&(i=e),t.length&&(i+=" "+t),i},getDateString:function(){return this.$("#startDate").val().trim()},getTimeString:function(){return this.$("#startTime").val().trim()},getDateTimeValueInUsecs:function(){var e=this.$("#startDate").val().trim(),t=this.$("#startTime").val().trim();if(e.length&&t.length){var i=Date.parse(e+" "+t);if(i&&!isNaN(i))return 1e3*new Date(i).getTime()}},destroy:function(){$("body").off("click",this.onBodyClick),this.$("#startDatePicker").datepicker("remove"),this.$("#startTime").timepicker().remove(),i.prototype.destroy.apply(this)},refreshView:function(){this.render()},onCalendarClick:function(e){this.$("#startDatePicker").data("datepicker").setDate(new Date)},onBodyClick:function(e){this._hideDropdowns()},_hideDropdowns:function(){this.$("ul.dropdown-menu").hide()}})}),define("views/basecomponents/datatables/advancedsearchfilter/AdvancedSearchFilterItemView",["views/basecomponents/BaseView","views/basecomponents/datatables/advancedsearchfilter/AdvancedSearchFilterTemplates","views/basecomponents/datetimepicker/DateTimePickerView","managers/ClusterManager","utils/AppConstants","utils/SubViewHelper","data/DataProperties"],function(e,t,i,n,s,a,r){"use strict";return e.extend({_entityType:null,_parentView:null,_paramFilter:null,className:"n-advanced-filter-item",filterModels:null,name:"AdvancedSearchFilterItemView",comboBoxInterceptedValue:{true:"Yes",false:"No"},LABEL_ALL:"All",initialize:function(e){if(this.subViewHelper=new a,this._entityType=e.entityType,this._parentView=e.parentView,this.filterModels=e.filterModels,!this.filterModels||!this.filterModels.length)throw new Error("FilterModel(s) are required in creating a filter view item");this._paramFilter=this.filterModels[0].getFilterAttribute()},render:function(e){void 0===e&&(e=!0);var i,n=this.filterModels[0].getCategory().replace("Filter by","");return this.isPlainCombobox()?i=this.getPlainCombobox(e):this.isRangePicker()&&(i=this.getRangeFilter(e)),this.$el.html(t.FILTER_ITEM_BASE({label:n})),this.$(".n-control").html(i),this.applyNutanixInput({types:["select"]}),this},destroy:function(){this.isRangePicker()&&(this.subViewHelper.get("startDateTime").off(),this.subViewHelper.get("endDateTime").off()),this.subViewHelper.removeAll(),this.subViewHelper=null,e.prototype.destroy.apply(this,arguments)},restrictDateTime:function(e,t){if(t){var i=this.subViewHelper.get("startDateTime");i.setMaxDateTime(e),i.setMinDateTime(null)}else{var n=this.subViewHelper.get("endDateTime");n.setMinDateTime(e),n.setMaxDateTime(null)}},isPlainCombobox:function(){return this.filterModels.length>=1&&!this.isRangePicker()},isRangePicker:function(){return this.filterModels[0].isDateRangeFilter()},getPlainCombobox:function(e){var i="";t.FILTER_COMBOBOX_OPTION;return i+=t.FILTER_COMBOBOX_OPTION({label:this.LABEL_ALL,value:null,checked:!1}),_.each(this.filterModels,function(n){var s=n.get("name"),a=String(n.getFilterValue());a=this.comboBoxInterceptedValue[a]||a,i+=t.FILTER_COMBOBOX_OPTION({label:s,value:a,checked:!!e&&n.isApplied()})},this),t.FILTER_COMBOBOX({cid:this.cid,options:i})},getRangeFilter:function(){var e=new i,n=new i,a=$(t.FILTER_RANGE_SELECTOR);if(this._entityType===s.ENTITY_ALERT){var r=Date.today();e.setEndDate(r),n.setEndDate(r)}return a.find(".range-start").html(e.render().el).end().find(".range-end").html(n.render().el).end(),e.on("changeDateTime",function(e){this.restrictDateTime(e,!1)},this),n.on("changeDateTime",function(e){this.restrictDateTime(e,!0)},this),this.subViewHelper.register("startDateTime",e),this.subViewHelper.register("endDateTime",n),a},getFilterId:function(){return this.cid},getFilterParam:function(){var e=[];if(this.isRangePicker()){var t=this.subViewHelper.get("startDateTime"),i=this.subViewHelper.get("endDateTime"),a=t.getDateTimeValueInUsecs(),o=i.getDateTimeValueInUsecs();(a||o)&&_.each(this.filterModels,function(t){var i=t.getFilterAttribute();i.indexOf("start")>-1&&a?e.push([i,a]):i.indexOf("end")>-1&&o&&e.push([i,o])},this)}else if(this.isPlainCombobox()){var l=(this.getFilterControl().val()||"").trim();_.each(this.comboBoxInterceptedValue,function(e,t){l===e&&(l=t)},this),this.isMulticlusterFilter()&&l===s.MULTICLUSTER_CLUSTER_ID&&(l=n.getPrismCentralClusterUuid()),l&&l.length&&e.push([this._paramFilter,l])}return this.isMulticlusterFilter()&&e.push([r.ENTITY_TYPE,s.ENTITY_CLUSTER]),e},getFilterControl:function(){return this.$("#filterControl"+this.cid)},getFilterTag:function(){var e;if(this.isRangePicker()){var t=this.subViewHelper.get("startDateTime"),i=this.subViewHelper.get("endDateTime"),a=t.getDateTimeString(),r=i.getDateTimeString();if(a||r){var o;o=a&&r?this.i18ns("dateToFrom",a,r):a?this.i18ns("dateAfter",a):this.i18ns("dateBefore",r),e=[this.filterModels[0].get("id"),o]}}else if(this.isPlainCombobox()){
var l=this.getFilterParam();if(l&&l.length){var c=l[0][1];this.isMulticlusterFilter()&&c===n.getPrismCentralClusterUuid()&&(c=s.MULTICLUSTER_CLUSTER_ID);var u=_.find(this.filterModels,function(e){return String(e.getFilterValue())===String(c)});u&&(e=[u.get("id"),u.get("name")])}}return e},removeFilter:function(e){var t=void 0===e;this.render(t)},isMulticlusterFilter:function(){return this.filterModels&&this.filterModels[0].isMultiClusterFilter()}})}),define("models/cluster/FilterModel",["models/BaseModel","data/DataProperties","utils/AppUtil"],function(e,t,i){"use strict";return e.extend({idAttribute:t.ID,nameAttribute:t.NAME,name:"FilterModel",HEALTH_FILTER_CATEGORY:"Filter by health",DATE_RANGE_FILTER_CATEGORY:"Filter by date range",CLUSTER_FILTER_CATEGORY:"Filter by cluster",CONDITION_OPERATORS:{NOT_EQUALS:"ne",EQUALS:"eq"},defaults:{id:null,entityType:null,name:null,category:null,isApplied:null,nbMatchingEntities:-1,condition:null},initialize:function(){i.debug("FilterModel : initialize: "," | modelId     : "+this.cid)},isApplied:function(){return this.get("isApplied")},setIsApplied:function(e){this.set("isApplied",e)},getCategory:function(){return this.get("category")},getEntityType:function(){return this.get("entityType")},getFIQLCondition:function(){var e=this.get("condition");return e[0]+"=="+e[2]},getMatchCount:function(){return this.get("nbMatchingEntities")},getFilterAttribute:function(){return this.get("condition")[0]},getFilterValue:function(){return this.get("condition")[2]},calculateMatchCount:function(e){for(var t=0,i=0;i<e.length;i++)this.matchTest(e[i])&&t++;this.set("nbMatchingEntities",t)},isHealthFilter:function(){return this.getCategory()===this.HEALTH_FILTER_CATEGORY},isDateRangeFilter:function(){return this.getCategory()===this.DATE_RANGE_FILTER_CATEGORY},isMultiClusterFilter:function(){return this.getCategory()===this.CLUSTER_FILTER_CATEGORY},matchTest:function(e){var t=this.get("condition");if(t){if(t[1]===this.CONDITION_OPERATORS.EQUALS)return e.getValue(t[0])==t[2];if(t[1]===this.CONDITION_OPERATORS.NOT_EQUALS)return e.getValue(t[0])!=t[2]}return i.log("Invalid filter found: No condition defined. ",this.get("name")),!0}})}),define("text!extras/filters.json",[],function(){return'[\n  {\n    "id":       "10",\n    "entityType": "vm",\n    "category": "Filter by health",\n    "name":     "Critical",\n    "isApplied": false,\n    "condition": ["healthSummary.healthStatus","eq","Critical"]\n  },\n\n  {\n    "id":       "11",\n    "entityType": "vm",\n    "category": "Filter by health",\n    "name":     "Warning",\n    "isApplied": false,\n    "condition": ["healthSummary.healthStatus","eq","Warning"]\n  },\n\n  {\n    "id":       "12",\n    "entityType": "vm",\n    "category": "Filter by health",\n    "name":     "Good",\n    "isApplied": false,\n    "condition": ["healthSummary.healthStatus","eq","Good"]\n  },\n\n\n  {\n    "id":       "13",\n    "entityType": "vm",\n    "category": "Filter by VM type",\n    "name":     "Acropolis Controller VM",\n    "isApplied": false,\n    "condition": ["controllerVm","eq",true]\n  },\n\n  {\n    "id":       "14",\n    "entityType": "vm",\n    "category": "Filter by VM type",\n    "name":     "User VM",\n    "isApplied": false,\n    "condition": ["controllerVm","eq",false]\n  },\n\n  {\n    "id":       "15",\n    "entityType": "vm",\n    "category": "Filter by power state",\n    "name":     "On",\n    "isApplied": false,\n    "condition": ["powerState","eq","on"]\n  },\n\n  {\n    "id":       "16",\n    "entityType": "vm",\n    "category": "Filter by power state",\n    "name":     "Off",\n    "isApplied": false,\n    "condition": ["powerState","eq","off"]\n  },\n\n  {\n    "id":       "17",\n    "entityType": "vm",\n    "category": "Filter by power state",\n    "name":     "Suspended",\n    "isApplied": false,\n    "condition": ["powerState","eq","suspended"]\n  },\n\n\n  {\n    "id":       "18",\n    "entityType": "vm",\n    "category": "Filter by Number of CPUs",\n    "name":     "One",\n    "isApplied": false,\n    "condition": ["numVCpus","eq","1"]\n  },\n\n  {\n    "id":       "19",\n    "entityType": "vm",\n    "category": "Filter by Number of CPUs",\n    "name":     "Two",\n    "isApplied": false,\n    "condition": ["numVCpus","eq","2"]\n  },\n\n  {\n    "id":       "20",\n    "entityType": "vm",\n    "category": "Filter by Number of CPUs",\n    "name":     "Four",\n    "isApplied": false,\n    "condition": ["numVCpus","eq","4"]\n  },\n\n  {\n    "id":       "21",\n    "entityType": "vm",\n    "category": "Filter by Number of CPUs",\n    "name":     "Six",\n    "isApplied": false,\n    "condition": ["numVCpus","eq","6"]\n  },\n\n  {\n    "id":       "22",\n    "entityType": "vm",\n    "category": "Filter by Number of CPUs",\n    "name":     "Eight",\n    "isApplied": false,\n    "condition": ["numVCpus","eq","8"]\n  },\n\n  {\n    "id":       "23",\n    "entityType": "vm",\n    "category": "Filter by Number of CPUs",\n    "name":     "Ten",\n    "isApplied": false,\n    "condition": ["numVCpus","eq","10"]\n  },\n\n  {\n    "id":       "24",\n    "entityType": "vm",\n    "category": "Filter by Number of CPUs",\n    "name":     "Twelve",\n    "isApplied": false,\n    "condition": ["numVCpus","eq","12"]\n  },\n\n\n  {\n    "id":       "100",\n    "entityType": "host",\n    "category": "Filter by health",\n    "name":     "Critical",\n    "isApplied": false,\n    "condition": ["healthSummary.healthStatus","eq","Critical"]\n  },\n\n  {\n    "id":       "101",\n    "entityType": "host",\n    "category": "Filter by health",\n    "name":     "Warning",\n    "isApplied": false,\n    "condition": ["healthSummary.healthStatus","eq","Warning"]\n  },\n\n  {\n    "id":       "102",\n    "entityType": "host",\n    "category": "Filter by health",\n    "name":     "Good",\n    "isApplied": false,\n    "condition": ["healthSummary.healthStatus","eq","Good"]\n  },\n\n\n  {\n    "id":       "103",\n    "entityType": "host",\n    "category": "Host Monitoring",\n    "name":     "Monitored",\n    "isApplied": false,\n    "condition": ["monitored","eq",true]\n  },\n\n  {\n    "id":       "104",\n    "entityType": "host",\n    "category": "Host Monitoring",\n    "name":     "Not Monitored",\n    "isApplied": false,\n    "condition": ["monitored","eq",false]\n  },\n\n\n  {\n    "id":       "200",\n    "entityType": "disk",\n    "category": "Filter by health",\n    "name":     "Critical",\n    "isApplied": false,\n    "condition": ["healthSummary.healthStatus","eq","Critical"]\n  },\n\n  {\n    "id":       "201",\n    "entityType": "disk",\n    "category": "Filter by health",\n    "name":     "Warning",\n    "isApplied": false,\n    "condition": ["healthSummary.healthStatus","eq","Warning"]\n  },\n\n  {\n    "id":       "202",\n    "entityType": "disk",\n    "category": "Filter by health",\n    "name":     "Good",\n    "isApplied": false,\n    "condition": ["healthSummary.healthStatus","eq","Good"]\n  },\n\n  {\n    "id":       "203",\n    "entityType": "disk",\n    "category": "Disk Mode",\n    "name":     "Online",\n    "isApplied": false,\n    "condition": ["online","eq",true]\n  },\n\n  {\n    "id":       "204",\n    "entityType": "disk",\n    "category": "Disk Mode",\n    "name":     "Offline",\n    "isApplied": false,\n    "condition": ["online","eq",false]\n  },\n\n  {\n    "id":       "205",\n    "entityType": "disk",\n    "category": "Disk Status",\n    "name":     "Normal",\n    "isApplied": false,\n    "condition": ["diskStatus","eq","NORMAL"]\n  },\n\n  {\n    "id":       "206",\n    "entityType": "disk",\n    "category": "Disk Status",\n    "name":     "Data Migration Initiated",\n    "isApplied": false,\n    "condition": ["diskStatus","eq","DATA_MIGRATION_INITIATED"]\n  },\n\n  {\n    "id":       "207",\n    "entityType": "disk",\n    "category": "Disk Status",\n    "name":     "Marked for removal",\n    "isApplied": false,\n    "condition": ["diskStatus","eq","MARKED_FOR_REMOVAL_BUT_NOT_DETACHABLE"]\n  },\n\n  {\n    "id":       "208",\n    "entityType": "disk",\n    "category": "Disk Status",\n    "name":     "Detachable",\n    "isApplied": false,\n    "condition": ["diskStatus","eq","DETACHABLE"]\n  },\n\n\n  {\n    "id":       "300",\n    "entityType": "remote_site",\n    "category": "Filter by health",\n    "name":     "Critical",\n    "isApplied": false,\n    "condition": ["healthSummary.healthStatus","eq","Critical"]\n  },\n\n  {\n    "id":       "301",\n    "entityType": "remote_site",\n    "category": "Filter by health",\n    "name":     "Warning",\n    "isApplied": false,\n    "condition": ["healthSummary.healthStatus","eq","Warning"]\n  },\n\n  {\n    "id":       "302",\n    "entityType": "remote_site",\n    "category": "Filter by health",\n    "name":     "Good",\n    "isApplied": false,\n    "condition": ["healthSummary.healthStatus","eq","Good"]\n  },\n\n  {\n    "id":       "303",\n    "entityType": "remote_site",\n    "category": "Filter by capabilities",\n    "name":     "Backup",\n    "isApplied": false,\n    "condition": ["capabilities","eq","BACKUP"]\n  },\n\n  {\n    "id":       "304",\n    "entityType": "remote_site",\n    "category": "Filter by capabilities",\n    "name":     "Disaster Recovery",\n    "isApplied": false,\n    "condition": ["capabilities","eq","DISASTER_RECOVERY"]\n    },\n\n\n    {\n      "id":       "305",\n      "entityType": "remote_site",\n      "category": "Filter by SSH Tunnel",\n      "name":     "Use SSH Tunnel",\n      "isApplied": false,\n      "condition": ["sshEnabled","eq","true"]\n    },\n\n    {\n      "id":       "306",\n      "entityType": "remote_site",\n      "category": "Filter by SSH Tunnel",\n      "name":     "Do not use SSH Tunnel",\n      "isApplied": false,\n      "condition": ["sshEnabled","ne","true"]\n    },\n\n    {\n      "id":       "307",\n      "entityType": "remote_site",\n      "category": "Filter by compression",\n      "name":     "Compress on Wire",\n      "isApplied": false,\n      "condition": ["compressionEnabled","eq","true"]\n    },\n\n    {\n      "id":       "308",\n      "entityType": "remote_site",\n      "category": "Filter by compression",\n      "name":     "Do not Compress on Wire",\n      "isApplied": false,\n      "condition": ["compressionEnabled","ne","true"]\n    },\n\n    {\n      "id":       "309",\n      "entityType": "remote_site",\n      "category": "Filter by Proxy Enabled",\n      "name":     "Proxy Enabled",\n      "isApplied": false,\n      "condition": ["proxyEnabled","eq","true"]\n    },\n\n    {\n      "id":       "310",\n      "entityType": "remote_site",\n      "category": "Filter by Proxy Enabled",\n      "name":     "Proxy Disabled",\n      "isApplied": false,\n      "condition": ["proxyEnabled","ne","true"]\n    },\n\n    {\n      "id":       "400",\n      "entityType": "protection_domain",\n      "category": "Filter by health",\n      "name":     "Critical",\n      "isApplied": false,\n      "condition": ["healthSummary.healthStatus","eq","Critical"]\n    },\n\n    {\n      "id":       "401",\n      "entityType": "protection_domain",\n      "category": "Filter by health",\n      "name":     "Warning",\n      "isApplied": false,\n      "condition": ["healthSummary.healthStatus","eq","Warning"]\n    },\n\n    {\n      "id":       "402",\n      "entityType": "protection_domain",\n      "category": "Filter by health",\n      "name":     "Good",\n      "isApplied": false,\n      "condition": ["healthSummary.healthStatus","eq","Good"]\n    },\n\n    {\n      "id":       "403",\n      "entityType": "protection_domain",\n      "category": "Filter by replications",\n      "name":     "Ongoing",\n      "isApplied": false,\n      "condition": ["ongoingReplicationCount","ne", 0]\n    },\n\n    {\n      "id":       "404",\n      "entityType": "protection_domain",\n      "category": "Filter by replications",\n      "name":     "Pending",\n      "isApplied": false,\n      "condition": ["pendingReplicationCount","ne", 0]\n    },\n\n    {\n      "id":       "405",\n      "entityType": "protection_domain",\n      "category": "Filter by active state",\n      "name":     "Active",\n      "isApplied": false,\n      "condition": ["active","eq", "true"]\n    },\n\n    {\n      "id":       "406",\n      "entityType": "protection_domain",\n      "category": "Filter by active state",\n      "name":     "Inactive",\n      "isApplied": false,\n      "condition": ["active","ne", "true"]\n    },\n\n    {\n      "id":         "501",\n      "entityType": "alert",\n      "category":   "Filter by severity",\n      "name":       "Critical",\n      "isApplied":  false,\n      "condition":  ["severity", "eq", "CRITICAL"]\n    },\n\n    {\n      "id":         "502",\n      "entityType": "alert",\n      "category":   "Filter by severity",\n      "name":       "Warning",\n      "isApplied":  false,\n      "condition":  ["severity", "eq", "WARNING"]\n    },\n\n    {\n      "id":         "503",\n      "entityType": "alert",\n      "category":   "Filter by severity",\n      "name":       "Info",\n      "isApplied":  false,\n      "condition":  ["severity", "eq", "INFO"]\n    },\n\n    {\n      "id":         "504",\n      "entityType": "alert",\n      "category":   "Resolution",\n      "name":       "Unresolved",\n      "isApplied":  true,\n      "condition":  ["resolved", "eq", false]\n    },\n\n    {\n      "id":         "505",\n      "entityType": "alert",\n      "category":   "Filter by date range",\n      "name":       "Start",\n      "isApplied":  false,\n      "condition":  ["startTimeInUsecs", "lt", "<%= value %>"]\n    },\n\n    {\n      "id":         "506",\n      "entityType": "alert",\n      "category":   "Filter by date range",\n      "name":       "End",\n      "isApplied":  false,\n      "condition":  ["endTimeInUsecs", "gt", "<%= value %>"]\n    },\n\n    {\n      "id":         "507",\n      "entityType": "alert",\n      "category":   "Filter by cluster",\n      "name":       "Prism Central",\n      "isApplied":  false,\n      "condition":  ["entityIds", "eq", "mc"]\n    },\n\n    {\n      "id":         "508",\n      "entityType": "alert",\n      "category":   "Resolution",\n      "name":       "Auto Resolved",\n      "isApplied":  false,\n      "condition":  ["resolved", "eq", "auto"]\n    },\n\n    {\n      "id":         "509",\n      "entityType": "alert",\n      "category":   "Resolution",\n      "name":       "Manual Resolved",\n      "isApplied":  false,\n      "condition":  ["resolved", "eq", "manual"]\n    }\n]\n'}),define("models/cluster/FiltersCollection",["models/BaseCollection","models/cluster/FilterModel","utils/SubModelHelper","utils/AppUtil","utils/AppConstants","text!extras/filters.json"],function(e,t,i,n,s,a){"use strict";return e.extend({model:t,name:"FiltersCollection",initialize:function(){n.debug("FiltersCollection : initialize: "," | modelId     : "+this.cid),this.subModelHelper=new i,this.initializeBaseCollection()},fetch:function(){try{var e=JSON.parse(a);this.reset(e),this.stateMonitor.setState(s.STATE_SUCCESS)}catch(e){n.log("FiltersCollection : ","Error loading filter definitions. ",e),this.stateMonitor.setState(s.STATE_ERROR)}},getFiltersByEntityType:function(e){return this.filter(function(t){return t.getEntityType()===e})},getFilterById:function(e){return this.findModelById(e)},getAppliedFilterGroupsByEntityType:function(e){var t=_.filter(this.models,function(t){return t.isApplied()&&t.getEntityType()===e});return _.groupBy(t,function(e){return e.getCategory()})}})}),define("views/basecomponents/datatables/advancedsearchfilter/AdvancedSearchFilterBarView",["views/basecomponents/BaseView","views/basecomponents/datatables/advancedsearchfilter/AdvancedSearchFilterItemView","views/basecomponents/datatables/advancedsearchfilter/AdvancedSearchFilterTemplates","managers/ClusterManager","utils/SubViewHelper","events/AppEvents","models/cluster/FiltersCollection"],function(e,t,i,n,s,a,r){"use strict";return e.extend({_entityType:null,_parentView:null,className:"n-advanced-filter",filtersCollection:null,subViewHelper:null,NO_FILTER_TEXT:'<div class="n-no-filter">Select Filter</div>',events:{"click  #btnFilter":"onClickApplyFilter","click  #tagContainer":"onClickTagContainer","click  #btnDropdown":"onClickDropDownButton","click  #filterBtnGrp > ul":"onClickDropDownBody","click  .n-delete-tag":"onClickDeleteTagButton"},modelEvents:{"reset  filtersCollection":"onResetFilters"},initialize:function(e){this._entityType=e.entityType,this._parentView=e.parentView,this.filtersCollection=new r,this.subViewHelper=new s,this.delegateModelEvents(),_.bindAll(this,"onBodyClick")},render:function(){return this.$el.html(i.FILTER_TAGS_CONTAINER),this.filtersCollection.fetch(),this},createFilterCriteriaItems:function(){var e=this.filtersCollection.getFiltersByEntityType(this._entityType),i=_.groupBy(e,function(e){return e.getCategory()});this.$("#filterItemsContainer").empty(),_.each(i,function(e,i){if(n.isMulticlusterNavMode()||!e.length||!e[0].isMultiClusterFilter()){var s=new t({entityType:this._entityType,filterModels:e});this.$("#filterItemsContainer").append(s.render().el),this.subViewHelper.register(s.getFilterId(),s)}},this)},destroy:function(){this.subViewHelper.destroy(),this.subViewHelper=null,$("body").off("click",this.onBodyClick),e.prototype.destroy.apply(this,arguments)},getFilter:function(){var e={};return _.each(this.subViewHelper.subViews,function(t){for(var i=t.getFilterParam(),n=0;n<i.length;n++){var s=i[n];e[s[0]]=s[1]}},this),e},renderFilterTags:function(){var e=0;this.$("#tagContainer").empty(),_.each(this.subViewHelper.subViews,function(t){var n=t.getFilterTag();n&&(e++,this.$("#tagContainer").append(i.FILTER_TAG({filterId:t.getFilterId(),tagId:n[0],tagName:n[1]})))},this),0===e&&this.$("#tagContainer").html(this.NO_FILTER_TEXT)},triggerFilterChange:function(){this.renderFilterTags(),this._parentView&&this._parentView.trigger(a.TABLE_FILTER_CHANGE)},toggleDropDownMenu:function(){this.$("#filterBtnGrp").hasClass("open")?this._hideDropDownMenu():this._showDropDownMenu()},_showDropDownMenu:function(){this.$("#filterBtnGrp").addClass("open"),$("body").on("click",this.onBodyClick)},_hideDropDownMenu:function(){this.$("#filterBtnGrp").removeClass("open"),$("body").off("click",this.onBodyClick)},onResetFilters:function(){this.createFilterCriteriaItems(),this.renderFilterTags()},onBodyClick:function(e){this._hideDropDownMenu()},onClickApplyFilter:function(e){this._hideDropDownMenu(),this.triggerFilterChange()},onClickDropDownButton:function(e){this.handleToggle(e)},onClickDropDownBody:function(e){e.stopPropagation()},onClickTagContainer:function(e){this.handleToggle(e,"n-filter-tag")},handleToggle:function(e,t){if($(e.target).hasClass(t))return void e.stopPropagation();var i=this;setTimeout(function(){i.toggleDropDownMenu()},50),e.stopPropagation()},onClickDeleteTagButton:function(e){e.stopPropagation();var t=$(e.currentTarget),i=t.attr("tagId"),n=$(e.currentTarget).attr("filterId"),s=this.subViewHelper.get(n);s&&(s.removeFilter(i),this.triggerFilterChange())}})}),define("views/basecomponents/datatables/FilterView",["views/basecomponents/BaseView","views/basecomponents/datatables/advancedsearchfilter/AdvancedSearchFilterBarView","views/basecomponents/datatables/DataTableTemplates","managers/AppManager","utils/AppConstants","utils/SubViewHelper","events/AppEvents"],function(e,t,i,n,s,a,r){"use strict";return e.extend({name:"FilterView",_entityType:null,subViewHelper:null,className:"n-filter",events:{"change  input.n-checkbox":"onChangeFilterCheckbox"},initialize:function(t){e.prototype.initialize.apply(this,arguments),this._entityType=t.entityType,this.subViewHelper=new a},render:function(){switch(this._entityType){case s.ENTITY_ALERT:if(this.isClusterFFEnabled(s.FFLAGS.SUPPORT_ADVANCED_FILTER)&&!this.clusterManager.isMulticlusterNavMode()){var e=new t({parentView:this,entityType:s.ENTITY_ALERT});this.subViewHelper.register("advancedFilterBar",e),this.$el.html(e.render().el)}else this.$el.html(i.FILTER_ALERT);break;case s.ENTITY_RECOVERY_POINT:this.$el.html(i.FILTER_RECOVERY_POINT({remoteRPTitle:this.i18n("remote_remote_point_title"),showRemoteRecoveryPointCheckbox:!n.isXi()}));break;case s.ENTITY_RECOVERY_PLAN_JOB:this.$el.html(i.FILTER_RECOVERY_PLAN_JOB({queuedTaskTitle:this.i18n("queued_tasks")}));break;case s.ENTITY_SNAPSHOT:this.$el.html(i.FILTER_SNAPSHOT);break;case s.ENTITY_VM:this.$el.html(i.FILTER_VM)}return this.applyNutanixInput({types:["checkbox"]}),this.applyFilterCheckboxStyle(),this},show:function(){this.$el.css("display","inline-block")},hide:function(){this.$el.hide()},getFilter:function(){var e,t=this.subViewHelper.get("advancedFilterBar");if(t)e=t.getFilter();else{var i=this.$("input.n-checkbox");i&&i.length&&(e={},i.each(function(){var t=$(this).attr("data-filter");$(this).is(":checked")||(e[t]=!1)}))}return e},applyFilterCheckboxStyle:function(){this.$(".n-filter-list li").each(function(e){var t=$(this);t.find(".n-checkbox-label").removeClass("unchecked"),t.find("input.n-checkbox").prop("checked")||t.find(".n-checkbox-label").addClass("unchecked")})},destroy:function(){this.subViewHelper.destroy(),this.subViewHelper=null,e.prototype.destroy.apply(this,arguments)},onChangeFilterCheckbox:function(e){var t=$(e.currentTarget),i=t.is(":checked");this.applyFilterCheckboxStyle(),this.trigger(r.TABLE_FILTER_CHANGE,i)},onStartServices:function(){this.delegateEvents(),this.subViewHelper.iterate("startServices")},onStopServices:function(){this.undelegateEvents(),this.subViewHelper.iterate("stopServices")}})}),define("models/storage/VolumeGroupModel",["models/BaseModel","data/DataURLConstants","utils/AppConstants"],function(e,t,i){"use strict";return e.extend({urlRoot:t.VOLUME_GROUP,entityType:i.ENTITY_ACROPOLIS_VOLUME_GROUP,name:"VolumeGroupModel"})}),define("models/storage/VolumeGroupCollection",["models/PollingCollection","models/storage/VolumeGroupModel","data/DataURLConstants","data/DataProperties"],function(e,t,i,n){"use strict";return e.extend({model:t,url:i.VOLUME_GROUP,name:"VolumeGroupCollection",initialize:function(){e.prototype.initialize.apply(this,arguments),this.setProjection([n.ID,n.VG_NAME,n.VG_NFS_DISKS,n.VG_NFS_DISKS_UUIDS,n.STATS_CONTROLLER_NUM_IOPS,n.STATS_CONTROLLER_BANDWIDTH,n.STATS_CONTROLLER_AVG_IO_LATENCY])}})}),define("models/hardware/SwitchModel",["models/PollingModel","data/DataURLConstants","data/DataProperties","utils/AppConstants"],function(e,t,i,n){"use strict";return e.extend({idAttribute:i.SWITCH_ID,urlRoot:t.SWITCH,entityType:n.ENTITY_SWITCH,name:"SwitchModel",defaults:{id:null,address:null,hostAddresses:[],description:null,objectId:null,contactInfo:null,locationInfo:null,vendorName:null,services:null,managementAddresses:[],interfaceIds:[]}})}),define("models/hardware/SwitchCollection",["models/PollingCollection","models/hardware/SwitchModel","data/DataURLConstants"],function(e,t,i){"use strict";return e.extend({model:t,url:i.SWITCH,name:"SwitchCollection"})}),define("models/dataprotection/SnapshotCollection",["models/PollingCollection","models/dataprotection/SnapshotModel","data/DataProperties","data/DataURLConstants","utils/AppConstants"],function(e,t,i,n,s){"use strict";var a=_.template(i.SNAP_PD_NAME+"==<%= pdName %>"),r=_.template(i.SNAP_ID+"==<%= snapId %>"),o=i.SNAP_STATE+"!=EXPIRED";return e.extend({model:t,url:n.SNAPSHOT,name:"SnapshotCollection",collectionFilterId:null,collectionFilterIdType:null,snapshotType:s.SNAPSHOT_TYPE.LOCAL,collectionSnapshotFilterId:null,includeExpired:!1,fullDetails:!1,preFetch:function(){var e=null,t=[];if(this.collectionFilterIdType===s.ENTITY_PROTECTION_DOMAIN?this.snapshotType===s.SNAPSHOT_TYPE.REMOTE?(this.url=n.REMOTE_SITE_SNAPSHOT,e=a({pdName:this.collectionFilterId})):this.url=_.template(n.LOCAL_SNAPSHOT,{pdName:this.collectionFilterId}):this.collectionFilterIdType===s.ENTITY_REMOTE_SITE?this.url=_.template(n.REMOTE_SNAPSHOT,{remoteSite:this.collectionFilterId}):this.snapshotType===s.SNAPSHOT_TYPE.REMOTE?this.url=n.REMOTE_SITE_SNAPSHOT:this.url=n.SNAPSHOT,this.url=this.url+"?fullDetails="+this.fullDetails,t.push(e),this.includeExpired||t.push(o),this.collectionSnapshotFilterId){var i=r({snapId:this.collectionSnapshotFilterId});t.push(i)}this.setFilterCriteria(this._getFilterCriteria(t))},_getFilterCriteria:function(e){var t="";return _.each(e,function(e){t+=e?(t.length?";":"")+e:""}),t},enableFullDetails:function(){this.fullDetails=!0},isSameFetchCall:function(t){var i=e.prototype.isSameFetchCall.apply(this,arguments);if(t&&i){var n=void 0,a=void 0,r=void 0,o=void 0;t.data&&(a=t.url,o=t.data[s.PARAM_FILTER_CRITERIA]),this._previousOptions&&this._previousOptions.data&&(n=this._previousOptions.url,r=this._previousOptions.data[s.PARAM_FILTER_CRITERIA]),i=null!==this._previousOptions&&n===a&&o===r}return i},setCollectionFilterId:function(e){this.collectionFilterId=e},getCollectionFilterId:function(){return this.collectionFilterId},setCollectionFilterIdType:function(e){this.collectionFilterIdType=e},getCollectionFilterIdType:function(){return this.collectionFilterIdType},setSnapshotType:function(e){this.snapshotType=e},getSnapshotType:function(){return this.snapshotType},setIncludeExpired:function(e){this.includeExpired=e},setSnapshotFilterId:function(e){this.collectionSnapshotFilterId=e}})}),define("models/fileserver/QuotaPolicyModel",["models/MinervaModel","data/DataURLConstants","managers/NavigationManager","utils/AppConstants","utils/AppUtil"],function(e,t,i,n,s){"use strict";var a={UUID:"uuid",SHARE_UUID:"shareUuid",PRINCIPAL_TYPE:"principalType",PRINCIPAL_VALUE:"principalValue",QUOTA_SIZE_GIB:"quotaSizeGiB",QUOTA_ENFORCEMENT_TYPE:"quotaEnforcementType",USER_NOTIFICATION:"sendQuotaNotificationsToUser",NOTIFICATION_RECIPIENTS:"notificationRecipients"};return e.extend({urlRoot:t.QUOTA_POLICY,entityType:n.ENTITY_SHARE_QUOTAS,name:"QuotaPolicyModel",idAttribute:a.UUID,nameAttribute:a.PRINCIPAL_VALUE,DP:a,entityName:null,defaults:{uuid:null,shareUuid:"",principalType:"",principalValue:"",quotaSizeGiB:0,quotaEnforcementType:null,sendQuotaNotificationsToUser:!1,notificationRecipients:null},setShareId:function(e){this.shareId=e},setEntityName:function(e){this.entityName=e},getURL:function(){var e=i.getCurrentPageRoute().options,a=s.parseQueryToObject(e);return this.actionMode===n.ACTION_CREATE||this.actionMode===n.ACTION_UPDATE?this.url=_.template(t.QUOTA_POLICIES,{shareId:this.shareId,uuid:a.actionParentId}):this.actionMode!==n.ACTION_DELETE&&this.actionMode!==n.ACTION_FETCH||(this.url=_.template(t.QUOTA_POLICY,{uuid:a.actionParentId,shareId:this.shareId,quota_policy_uuid:this.get(this.DP.UUID)})),this.url}},{DP:a})}),define("models/fileserver/QuotaPolicyCollection",["models/PollingCollection","models/fileserver/QuotaPolicyModel","managers/NavigationManager","data/DataURLConstants","utils/AppUtil"],function(e,t,i,n,s){"use strict";var a={PRINCIPAL_VALUE:"principalValue",DEFAULT:"_default"};return e.extend({model:t,url:n.QUOTA_POLICIES,name:"QuotaPolicyCollection",shareId:null,parse:function(t,i){t=e.prototype.parse.apply(this,arguments);var n=[],s=[];return _.each(t,function(e){e[a.PRINCIPAL_VALUE]!==a.DEFAULT?s.push(e):n.push(e)}),n.concat(s)},setShareId:function(e){var t=i.getCurrentPageRoute().options,a=s.parseQueryToObject(t);this.shareId=e,this.url=_.template(n.QUOTA_POLICIES,{shareId:this.shareId,uuid:a.actionParentId})}})}),define("models/fileserver/DNSEntryModel",["models/MinervaModel"],function(e){"use strict";var t={NAME:"dnsName",IP_ADDRESS:"dnsIpAddress",ACTION:"action"};return e.extend({name:"DNSEntryModel",idAttribute:t.UUID,DP:t},{DP:t})}),define("models/fileserver/DNSEntriesCollection",["models/PollingCollection","models/fileserver/DNSEntryModel","data/DataURLConstants"],function(e,t,i){"use strict";var n={DNS_ENTRIES:"dnsEntries"};return e.extend({model:t,name:"DNSEntriesCollection",fileServerId:null,filterByAction:null,setFSId:function(e){this.fileServerId=e},setAction:function(e){this.filterByAction=e},getURL:function(e,t){return _.template(i.FILE_SERVER_DNS_ENTRIES,{uuid:this.fileServerId})},parse:function(i,s){var a=this;return i=e.prototype.parse.apply(this,arguments),_.filter(i[n.DNS_ENTRIES],function(e){return e[t.DP.ACTION]===a.filterByAction})},parseOptions:function(){var t=e.prototype.parseOptions.apply(this,arguments);return t.url=this.getDataSourceURL()+this.getURL(),t}})}),define("views/basecomponents/datatables/BaseTableView",["datatables","views/basecomponents/BaseView","views/basecomponents/datatables/DataTableTemplates","views/basecomponents/datatables/DataTableColumnProvider","views/basecomponents/datatables/DataTableColResizeMixin","views/basecomponents/datatables/ActionView","views/basecomponents/datatables/AlertEventActionView","views/basecomponents/datatables/FilterView","managers/NavigationManager","managers/AlertManager","managers/NotificationManager","managers/TaskManager","managers/ClusterManager","data/DataProperties","models/alert/AlertCollection","models/event/EventCollection","models/storage/StoragePoolCollection","models/storage/ContainerCollection","models/storage/VolumeGroupCollection","models/hardware/HostCollection","models/hardware/DiskCollection","models/hardware/SwitchCollection","models/dataprotection/RemoteSiteCollection","models/dataprotection/ProtectionDomainCollection","models/dataprotection/ReplicationCollection","models/dataprotection/SnapshotCollection","models/fileserver/ShareCollection","models/fileserver/FileServerCollection","models/fileserver/QuotaPolicyCollection","models/fileserver/DNSEntriesCollection","utils/AppConstants","utils/AppUtil","utils/AlertUtil","utils/SubViewHelper","utils/DataExportUtil","utils/TooltipContent","utils/CommonTemplates","events/AppEvents"],function(e,t,i,n,s,a,r,o,l,c,u,d,h,p,T,E,S,g,A,m,f,I,C,v,R,N,P,O,y,D,M,b,L,w,U,V,k,x){"use strict";var F=_.template('<div class="n-details-table-tip"> <%= tipText %></div>');return t.extend(_.extend({SUBVIEW_ACTION:"action",SUBVIEW_FILTER:"filter",defaultMinRows:10,dataTable:null,pageId:null,entityType:null,selectedDataId:null,checkedDataIds:null,selectAllRows:!1,totalFilteredRows:null,className:"n-base-data-table  n-tab  tab-pane",subViewHelper:null,isUpdateSelectionCalled:!1,pageOptionsObject:null,infoMessage:null,isSelectionEnabled:!0,sharedModel:!1,hideSearch:!1,hoverEnabled:!1,dataTableSettings:{sDOM:"rt",bProcessing:!0,bLengthChange:!1,bPaginate:!0,bFilter:!0,bInfo:!1,bScrollCollapse:!0,bAutoWidth:!1,oLanguage:{sEmptyTable:"&nbsp;",sZeroRecords:""},bJQueryUI:!1},eventBus:null,events:{"click  .btnPrevious":"goToPreviousPage","click  .btnNext":"goToNextPage","click  .btnSettings":"onClickSettings","click  .btnExport":"onExport","click  .baseDataTable tbody tr":"onClickDataRow","change .checkboxSelectAll":"onChangeSelectAll","click  .selectAllLink":"onClickSelectAll","click  .clearSelection":"onClickClearSelection","input  .tableFilter":"onTableFilter","input  .tableFilterChange":"onTableFilterChange","click  .n-table-filter-wrapper > .n-icon-search":"onClearClicked"},modelEvents:{"reset    model":"onDataChange","error    model":"onDataError","pending  model":"onDataLoading"},hoverMouseEvents:{'mouseenter .baseDataTable tbody tr td:has("[data-toggle=popover]")':"onPopoverCellMouseEnter",'mouseleave  .baseDataTable tbody tr td:has("[data-toggle=popover]")':"onPopoverCellMouseLeave"},initialize:function(e){t.prototype.initialize.apply(this,arguments),this.subViewHelper=new w,this.checkedDataIds=[];var i=e.actionView;i&&this.subViewHelper.register(this.SUBVIEW_ACTION,i),$.fn.dataTableExt.sErrMode="throw",this.pageId=e.pageId,this.entityType=e.entityType,this.ebTableStyle=e.ebTableStyle||!1,this.eventBus=e.eventBus,this.initializeTableModel(e),this.defaultMinRows=e.defaultMinRows||this.defaultMinRows,this.initializeDataTableSettings()},initializeTableModel:function(e){this.dataTableSettings.bPaginate=!0;var t=!0;switch(this.entityType){case M.ENTITY_ALERT:this.model=new T,
this.model.comparator=L.comparatorHighPriorityUnresolved,this.defaultMinRows=20,t=!1;break;case M.ENTITY_EVENT:this.model=new E,this.defaultMinRows=20,t=!1;break;case M.ENTITY_STORAGE_POOL:this.model=new S,this.defaultMinRows=5;break;case M.ENTITY_CONTAINER:this.model=new g,this.defaultMinRows=5;break;case M.ENTITY_ACROPOLIS_VOLUME_GROUP:this.model=new A,this.defaultMinRows=5,t=!1;break;case M.ENTITY_HOST:this.model=new m;break;case M.ENTITY_DISK:this.model=new f;break;case M.ENTITY_SWITCH:this.model=new I;break;case M.ENTITY_REMOTE_SITE:this.model=new C,this.defaultMinRows=6;break;case M.ENTITY_PROTECTION_DOMAIN:case M.ENTITY_ASYNC_PD:this.model=new v(null,{metroAvail:"false"}),this.defaultMinRows=6;break;case M.ENTITY_METRO_AVAILABILITY_PD:this.model=new v(null,{metroAvail:"true"}),this.defaultMinRows=6;break;case M.ENTITY_REPLICATION:this.model=new R,this.defaultMinRows=6;break;case M.ENTITY_SNAPSHOT:this.model=new N;break;case M.ENTITY_CLUSTER:this.model=h.getClusterCollection(),this.defaultMinRows=5,this.sharedModel=!0,t=!1,this.onDataLoading();break;case M.ENTITY_MULTICLUSTER_HEALTH:this.model=this.clusterManager.getClusterCollection(),this.defaultMinRows=20,this.sharedModel=!0,t=!1,this.onDataLoading();break;case M.ENTITY_SHARE:this.model=new P,this.defaultMinRows=5;break;case M.ENTITY_FILE_SERVER:this.model=new O,this.defaultMinRows=5;break;case M.ENTITY_FILE_SERVER_DNS_ENTRY:this.model=new D,this.defaultMinRows=5;break;case M.ENTITY_SHARE_QUOTAS:this.model=new y;break;default:throw"The model on BaseTableView has not been initialized.  Entity: "+this.entityType}this.model&&t&&this.model.setProjection([M.PROJECTION.STATS,M.PROJECTION.ALERTS])},initializeDataTableSettings:function(){var e=this;this.dataTableSettings=_.extend({},this.dataTableSettings,{iDisplayLength:this.defaultMinRows,aaSorting:this.getDefaultSort(this.entityType),aoColumns:this._getDefaultColumnsWrapper(this.entityType,this.pageId),fnDrawCallback:function(t){e._dataTableDrawCallback(t,this)},fnRowCallback:function(t,i,n){e._dataTableRowCallback(t,i,n)}},s.getColResizeDataTableSettings(this))},render:function(){return this.$el.empty(),this.$el.append(i.BAR_HEADER).append(i.DATATABLE).append(i.LOADING),this._renderDataTable(),this.renderSubviews(),this},getActionViewOptions:function(){return null},_renderDataTable:function(){this.dataTable=this.$(".baseDataTable").dataTable(this.dataTableSettings),this.ebTableStyle&&this.$(".baseDataTable").addClass("entity-table")},_dataTableRowCallback:function(e,t,i){t[p.ID]&&($(e).attr(M.NAV_ACTION_TARGET_ID,t[p.ID]).attr(M.NAV_ACTION_TARGET,this.getActionTarget()).attr(M.NAV_ACTION,M.ACTION_DETAILS).attr(M.NAV_ACTION_SOURCE,M.ACTION_SOURCE.SELECTION).attr(M.NAV_ACTION_PARENT_ENTITY_TYPE,M.ENTITY_CLUSTER).attr(M.NAV_ACTION_PARENT_ID,t[p.CLUSTER_UUID]),t[p.NAME]&&$(e).attr(M.NAV_ACTION_TARGET_NAME,t[p.NAME])),this.selectedDataId===$(e).attr(M.NAV_ACTION_TARGET_ID)&&$(e).addClass("row_selected"),t[p.DATA_NO_READY]&&$(e).addClass("row_data_no_ready"),this._isRowChecked(t)&&$(e).find(".checkboxDataRow").prop("checked",!0),this._isRowDisabled(t)&&$(e).find(".checkboxDataRow").prop("disabled",!0);var n=t[p.ALERT_SUMMARY];if(n&&n.count>0){var s=$(e).find("td.n-alert-table-indicator");L.renderAlertWidget({targetEl:s,entityId:t[p.ID],entityType:this.getActionTarget(),alertSummary:n,alertType:M.ALERT_TYPE_TABLE})}return e},_dataTableDrawCallback:function(e,t){var i=_.bind(this.updatePaginator,this),n=t.oApi._fnVisbleColumns(e);this.fnAddRows(t,n,this.defaultMinRows),i(e),this.renderSelectAllCheckbox(e),this.isUpdateSelectionCalled&&this.updateSelection(this.pageOptionsObject),this.onDrawCallback(e),this.applyNutanixInput({types:["checkbox"]})},_isRowChecked:function(e){return $.inArray(e[p.ID],this.checkedDataIds)>=0},_isRowDisabled:function(e){return!1},renderSubviews:function(){this.$(".n-header").prepend(i.HEADER_RIGHT),this.$(".n-header").prepend(i.HEADER_LEFT);var e=this.getActionViewOptions()||{};if(e.entityType=this.entityType,this.subViewHelper.get(this.SUBVIEW_ACTION)||(this.entityType===M.ENTITY_ALERT||this.entityType===M.ENTITY_EVENT?this.subViewHelper.register(this.SUBVIEW_ACTION,new r(e)):this.subViewHelper.register(this.SUBVIEW_ACTION,new a(e))),this.$(".n-header-left").append(this.subViewHelper.get(this.SUBVIEW_ACTION).render().el),this.subViewHelper.register(this.SUBVIEW_FILTER,new o({entityType:this.entityType})),this.$(".n-header-right > .n-filter-settings").prepend(this.subViewHelper.get(this.SUBVIEW_FILTER).render().el),this.hideSearch&&this.$(".n-table-filter-container").hide(),this.displayFilterForEntity()?this.$(".n-filter-display").show():this.$(".n-filter-display").hide(),this.$(".n-help-display").hide(),!1===this.options.enableDefaultTableFilter){var t=this.$(".n-table-filter-container");t.prev().hide(),t.hide()}this.$el.find("table thead tr").find("th:first").html()||this.$el.find("table thead tr").find("th:first").html(i.CHECKBOX_SELECT_ALL(this.vtOptions())),this._delegateSubviewEvents()},displayFilterForEntity:function(){return this.entityType===M.ENTITY_ALERT||this.entityType===M.ENTITY_SNAPSHOT},_delegateSubviewEvents:function(){this.subViewHelper.get(this.SUBVIEW_ACTION).on(x.TABLE_ACTION_SUCCESS,this.onActionSuccess,this).on(x.TABLE_ACTION_ERROR,this.onActionError,this).on(x.TABLE_ACTION_PENDING,this.onActionPending,this).on(x.TABLE_ACTION_INVOKED,this.onActionInvocation,this),this.subViewHelper.get(this.SUBVIEW_FILTER).on(x.TABLE_FILTER_CHANGE,this.onFilterChange,this)},_destroySubviews:function(){this.subViewHelper.get(this.SUBVIEW_ACTION).off(x.TABLE_ACTION_SUCCESS,this.onActionSuccess,this).off(x.TABLE_ACTION_ERROR,this.onActionError,this).off(x.TABLE_ACTION_PENDING,this.onActionPending,this).off(x.TABLE_ACTION_INVOKED,this.onActionInvocation,this),this.subViewHelper.get(this.SUBVIEW_FILTER).off(x.TABLE_FILTER_CHANGE,this.onFilterChange,this),this.subViewHelper.removeAll(),this.subViewHelper=null},onDrawCallback:function(){},refreshData:function(e){if(!this.model)throw new Error("The model on BaseTableView has not been initialized.");this.model.fetch(e||this.getOptions())},modelToJSON:function(){return this.model.toJSON({includeAttribute:!0,includeCustomAttributes:!0})},onSelectedIdsChange:function(e){!this.totalViewablePages&&this.checkedDataIds.length>0?this.checkedDataIds=_.intersection(e,this.checkedDataIds):this.selectAllRows&&this.checkedDataIds.length&&(this.checkedDataIds=_.union(e,this.checkedDataIds),this._updateSelectionCheckboxes(!0,!0))},onDataChange:function(){this.$(".n-loading-wrapper").hide(),this.$(".n-error").hide(),this._removePopovers(),this.$(".checkboxDisabled + label").tooltip("destroy"),this.dataTable.fnClearTable();var e=this.modelToJSON();if(this.model&&e.length){var t=_.pluck(e,p.ID);this.onSelectedIdsChange(t),this.dataTable.fnAddData(e,!1),this.standingRedraw(this.dataTable.fnSettings())}else 0===e.length&&(this.checkedDataIds=[]);0===this.checkedDataIds.length?this._updateSelectionCheckboxes(!1):this.updateActionView(),this.refreshViews(),this._updateRetrievalResultTooltip(),this.refreshToCorrectSelection();var i=this.getDisableCheckboxTooltip();i&&this.$(".checkboxDisabled + label").tooltip({title:i,placement:"right",trigger:"hover",html:!0}),this.eventBus&&this.eventBus.trigger(x.TABLE_RENDER_COMPLETE)},refreshViews:function(){this.entityType!==M.ENTITY_TASK&&d.refreshViews()},refreshToCorrectSelection:function(e){var t=this.pageOptionsObject?this.pageOptionsObject[M.NAV_ACTION_TARGET_ID]:null;this.pageOptionsObject&&t&&(!this.model.findModelById(t)||e)&&this.updateSelection(this.pageOptionsObject)},onDataError:function(e,t,n){if(this.$(".n-error").remove(),this.$(".n-loading-wrapper").hide(),e.getState()!==M.STATE_CANCELED){var s="";s=b.isConnectionError(t)?"Unable to connect to the server.":b.isHttp404Error(t)?"Requested resource not available":(b.processAjaxError(t.responseText)||"").replace(/(<([^>]+)>)/gi,""),this.$el.append(i.ERROR({errorDetails:s})),this.$(".n-error-details").tooltip({placement:"bottom",trigger:"hover",html:!0})}},showClientMessage:function(e){this.$(".n-loading-wrapper").hide(),this.hideClientMessage(),this.$el.append(i.MESSAGE({message:e}))},hideClientMessage:function(){this.$(".n-message").remove()},onDataLoading:function(){this.$(".n-error").hide(),0===this.model.length&&this.$(".n-loading-wrapper").show()},clearTable:function(){this.dataTable&&this.dataTable.fnClearTable()},getSelectedRow:function(){return this.dataTable.$("tr.row_selected")},renderSelectAllCheckbox:function(e){e.fnRecordsTotal()&&this.$(".checkboxDataRow").length?this.$(".n-select-all").show():this.$(".n-select-all").hide()},updateSelection:function(e){var t;e&&(t=e[M.NAV_ACTION_TARGET_ID],e.actionTarget===M.PAGE_FILE_SERVER&&t&&t.indexOf("::")>-1&&(t=t.split("::")[1]));var i=h.isMulticlusterNavMode();if(t||i){var n=t?this.model.findModelById(t):null;this.handleRowSelection(t,n)}this.pageOptionsObject=e},handleRowSelection:function(e,t){var i=this;if(this.isReadyForSelection()){if(!t&&b.isEntityWithoutModelId(e))return void this.removeRowSelection();t||(e&&e!==M.ACTION_SUMMARY&&this.showNoEntityErrorMessage(e),e=this.hasSummary()?M.ACTION_SUMMARY:this.getFirstRowActionTargetId()),clearTimeout(this.selectionTimer),e&&(this.selectionTimer=setTimeout(function(){e===M.ACTION_SUMMARY?(l.showDetailsSummary(),i.removeRowSelection()):(i.goToPageWithRow(e),i.selectRow(e),i.clusterManager.isMulticlusterNavMode()&&!t&&i.updateNavigation(e)),i.isUpdateSelectionCalled=!1},250))}else this.isUpdateSelectionCalled=!0},getFirstRowActionTargetId:function(){var e=this.$(".baseDataTable tbody tr:nth-child(1)");return e.length?$(e).attr(M.NAV_ACTION_TARGET_ID):null},hasSummary:function(){return this.entityType!==M.ENTITY_ALERT&&this.entityType!==M.ENTITY_EVENT&&!h.isMulticlusterNavMode()},showNoEntityErrorMessage:function(e){var t=k.DETAILS_NO_ENTITY({entityType:this.getEntityTypeName(),entityId:e,entityIdAttribute:this.getEntityIdAttribute()});u.showClientNotification(M.NOTIFY_WARNING,t)},isReadyForSelection:function(){var e=this.dataTable.fnSettings();return this.model.length>0&&e.fnRecordsTotal()>0},getTableRowByTargetId:function(e){return this.$('.baseDataTable  tbody tr:[actionTargetId="'+e+'"]')},selectRow:function(e){if(e){this.selectedDataId=e;var t=this.getTableRowByTargetId(e);this.dataTable&&t.length&&(this.removeRowSelection(),$(t).addClass("row_selected"))}},removeRowSelection:function(){this.dataTable&&this.dataTable.$("tr.row_selected").removeClass("row_selected")},goToPageWithRow:function(e){if(!e)return void b.log("BaseTableView - invalid action target id");var t=0,i=this.dataTable.fnGetNodes(),n=this.dataTable.fnSettings(),s=Math.ceil(n._iDisplayStart/n._iDisplayLength)+1,a=_.find(i,function(t){var i=this.dataTable.fnGetPosition(t);return this.dataTable.fnGetData(i).id===e},this);if(a){var r=_.indexOf(this.dataTable.fnSettings().aiDisplay,this.dataTable.fnGetPosition(a));t=Math.floor(r/n._iDisplayLength)+1,s!==t&&n.fnRecordsTotal()>0&&(b.log("BaseTableView - Switching to datatable page "+t),this.dataTable.fnPageChange(t-1))}else b.log("BaseTableView - actionTargetId "+e+" not found in table");return t},onClickDataRow:function(e){var t,i,n=$(e.target);if(n.hasClass("checkboxDataRow"))return t=$(e.target).val(),i=$(e.target).is(":checked"),_.isNumber(t)&&(t=Number(t)),i&&-1===$.inArray(t,this.checkedDataIds)&&(this.checkedDataIds[this.checkedDataIds.length++]=t),i?this._updateCurrentPageSelectAllCheckbox():(this.checkedDataIds=$.grep(this.checkedDataIds,function(e){return e!==t}),this.$(".checkboxSelectAll").attr("checked",!1),this.selectAllRows=!1),void this.updateActionView();if(!n.parents(".n-checkbox").length&&this.isSelectionEnabled){var s=e.currentTarget;if(this.dataTable.fnGetData(s)){if(!$(s).hasClass("row_blank")){var a=this.dataTable.fnGetData(s);t=a[p.ID],this.selectRow(t)}this.updateNavigation(t)}}},_updateCurrentPageSelectAllCheckbox:function(){this.$(".checkboxDataRow").length===this.$(".checkboxDataRow:checked").length&&this.$(".checkboxSelectAll").attr("checked",!0)},onTableFilter:function(e){var t=$(e.currentTarget).val();this.dataTable.fnFilter(t),this.updatePaginator(this.dataTable.fnSettings())},onClearClicked:function(e){this.$(".tableFilter").val(""),this.$(".tableFilter").trigger("input")},onTableFilterChange:function(e){var t=$(e.currentTarget).val();this.updateTableFilterIconState(t)},updateTableFilterIconState:function(e){var t=this.$(".n-table-filter-wrapper > .n-icon-search");""===e?(t.attr("data-icon","B"),t.removeClass("n-icon-clear")):(t.attr("data-icon","v"),t.addClass("n-icon-clear"))},updateNavigation:function(e){var t=this.getTableRowByTargetId(e);if(t.length>0&&$(t).hasClass("row_selected"))if(this.entityType===M.ENTITY_ALERT){if(this.clusterManager.isMulticlusterNavMode()){var i=l.createNavigationContext(this.entityType,{entities:this.model.models});l.navigateToFullScreenDetailsPane(this.entityType,e,i)}}else l.updateRouteOption(t)},onChangeSelectAll:function(){this.$(".checkboxSelectAll").attr("checked")?this._updateSelectionCheckboxes(!0):this._updateSelectionCheckboxes(!1)},onClickSelectAll:function(){this.selectAllRows=!0,this.$(".checkboxDataRow").attr("checked",!0),this.checkedDataIds=[],this.checkedDataIds=_.pluck(this.dataTable._("tr",{filter:"applied"}),p.ID),this.$(".checkboxDataRow").removeClass("checked"),this.$(".checkboxDataRow:checked").addClass("checked"),this.updateActionView()},onClickClearSelection:function(){this.selectAllRows=!1,this.$(".checkboxSelectAll").attr("checked",!1),this.$(".checkboxDataRow").attr("checked",!1),this.checkedDataIds=[],this.updateActionView(),this.onDataChange()},onClickSettings:function(){this.$(".btnSettings").dropdown("toggle")},onExport:function(e){var t=$(e.currentTarget);t.hasClass("csv")?U.exportTableCSV(this.modelToJSON(),this.getColumnsToExport()):t.hasClass("json")&&U.exportTableJSON(this.modelToJSON(),this.getColumnsToExport())},onPopoverCellMouseEnter:function(e){if(this.hoverEnabled){var t=e.currentTarget,i=$(t).find("[data-toggle=popover]");if(i&&i.length>0){$(i).popover("destroy");var n=this.dataTable.fnGetPosition(t);if(n){var s=this.dataTable.fnGetData(t),a=this.dataTable.fnGetData(n[0]),r=this.getCurrentColumns()[n[2]];if(a&&r){var o=this.getHoverTemplate(r,s);if(o){var l=F({tipText:this.getHoverTooltip(o,a,r,s)});i.popover({title:this.getHoverTitle(r),content:l,placement:this.getHoverPlacement(r),trigger:"manual",html:!0,container:this.getPopoverContainer()}),i.popover("show")}}}}}},onPopoverCellMouseLeave:function(e){this.hoverEnabled&&$(e.currentTarget).find("[data-toggle=popover]").popover("destroy")},goToPreviousPage:function(){this.dataTable.fnPageChange("previous"),this.clusterManager.isClusterFFEnabled(M.FFLAGS.SUPPORT_PAGINATION)||c.refreshAlertsOnTable(),this._updateCurrentPageSelectAllCheckbox()},goToNextPage:function(){this.dataTable.fnPageChange("next"),this.clusterManager.isClusterFFEnabled(M.FFLAGS.SUPPORT_PAGINATION)||c.refreshAlertsOnTable(),this._updateCurrentPageSelectAllCheckbox()},goToFirstPage:function(){this.dataTable.fnPageChange("first"),this.clusterManager.isClusterFFEnabled(M.FFLAGS.SUPPORT_PAGINATION)||c.refreshAlertsOnTable()},goToLastPage:function(){this.dataTable.fnPageChange("last"),this.clusterManager.isClusterFFEnabled(M.FFLAGS.SUPPORT_PAGINATION)||c.refreshAlertsOnTable()},getTotalFilteredCount:function(){return this.dataTable.fnSettings().fnRecordsDisplay()},changePaginatorVisibility:function(e){var t=[".n-page-info",".n-page-nav-container"];_.each(t,function(t){e?this.$(t).removeClass("hide"):this.$(t).addClass("hide")},this)},renderTemplateInfo:function(e,t,i){this.$(".n-page-info").html(e(t))},updatePaginator:function(e){if(this.changePaginatorVisibility(this.dataTableSettings.bPaginate),this.dataTableSettings.bPaginate){var t,n=this.getPagingInfo(e),s=this.getEntityTypeName(),a=n.iPage,r=n.iTotalPages,o=n.iStart,l=n.iEnd,c=n.iFilteredTotal,u=n.iTotal;this.totalFilteredRows=c,t=c>this.defaultMinRows?i.PAGE_INFO_PAGES:0===c?i.PAGE_INFO_NONE:i.PAGE_INFO_PAGE;var d={start:o,end:l,total:c,entity:s,entityType:this.entityType,AppUtil:b};if(this.renderTemplateInfo(t,d,c),c<u){var h=" (filtered from "+u+")";this.$(".n-page-info").append(h)}this.$(".checkboxSelectAll").attr("checked",!1),this.$(".btnPrevious").removeClass("n-disabled"),(r<=1||1===a)&&this.$(".btnPrevious").addClass("n-disabled"),this.$(".btnNext").removeClass("n-disabled"),(r<=1||a===r)&&this.$(".btnNext").addClass("n-disabled")}},getPagingInfo:function(e){return e=e||this.dataTable.fnSettings(),{iStart:e._iDisplayStart+1,iEnd:e.fnDisplayEnd(),iLength:e._iDisplayLength,iTotal:e.fnRecordsTotal(),iFilteredTotal:e.fnRecordsDisplay(),iPage:(-1===e._iDisplayLength?0:Math.ceil(e._iDisplayStart/e._iDisplayLength))+1,iTotalPages:-1===e._iDisplayLength?0:Math.ceil(e.fnRecordsDisplay()/e._iDisplayLength)}},getEntityTypeName:function(){return M.ENTITY_NAMES[this.entityType]},getEntityIdAttribute:function(){return p.ID},getActionTarget:function(){return this.entityType},_getDefaultColumnsWrapper:function(e,t){var i=this.getDefaultColumns(e,t);return h.isMulticlusterNavMode()&&e!==M.ENTITY_CLUSTER&&e!==M.ENTITY_MULTICLUSTER_HEALTH&&e!==M.CP_ENTITY_STORAGE_USAGE&&e!==M.CP_ENTITY_CPU_USAGE&&e!==M.CP_ENTITY_MEMORY_USAGE&&e!==M.CP_CLUSTER_HOST_CPU_OVERVIEW&&e!==M.CP_CLUSTER_HOST_MEMORY_OVERVIEW&&e!==M.CP_CLUSTER_CONTAINER_STORAGE_OVERVIEW&&(i=n.prependClusterNameColumn(e,i)),i},getDefaultColumns:function(e,t,i){return n.getDataColumns(e,t,i)},getCurrentColumns:function(){return this.dataTable.fnSettings().aoColumns},getColumnsToExport:function(){return this.getCurrentColumns().filter(function(e){return!1!==e.exportable})},updateColumns:function(){},getDefaultSort:function(e){switch(e){case M.ENTITY_ALERT:case M.ENTITY_EVENT:case M.CP_ENTITY_CPU_USAGE:case M.ENTITY_ICAP_SERVERS:return[];case M.ENTITY_PROTECTION_DOMAIN:case M.ENTITY_ASYNC_PD:case M.ENTITY_METRO_AVAILABILITY_PD:return[[1,"asc"]];case M.CP_ENTITY_MEMORY_USAGE:case M.CP_ENTITY_STORAGE_USAGE:case M.CP_CLUSTER_CONTAINER_STORAGE_OVERVIEW:case M.CP_CLUSTER_HOST_MEMORY_OVERVIEW:case M.CP_CLUSTER_HOST_CPU_OVERVIEW:return[[1,"desc"]];default:return[[0,"asc"]]}},processLocalFilter:function(e){return e},getFilter:function(){var e=this.processLocalFilter(this.subViewHelper.get(this.SUBVIEW_FILTER).getFilter()),t=this.getExtraFilter();return t&&e?_.extend(_.clone(e),t):t||(e||void 0)},setFilterURL:function(e){e&&e.length&&this.model&&this.model.addFilterURL(e)},setModelURL:function(e){e&&e.length&&this.model&&this.model.setURL(e)},setActionViewOptions:function(e){this.getActionTarget()===M.ENTITY_ALERT&&this.subViewHelper.get(this.SUBVIEW_ACTION).setAlertActionViewOptions(e)},getExtraFilter:function(){},updateActionView:function(){this.subViewHelper.get(this.SUBVIEW_ACTION).setIds(this.checkedDataIds,this.totalFilteredRows,this.defaultMinRows,!this.selectAllRows)},_updateSelectionCheckboxes:function(e,t){if(e){this.$(".checkboxSelectAll").attr("checked",!0);var i=this;_.each(this.$(".baseDataTable tr"),function(e){if($(e).attr("actiontargetid")){var t=$(e).find(".checkboxDataRow");t.length&&(t.attr("checked",!0),i.checkedDataIds.push($(e).attr("actiontargetid")))}}),this.checkedDataIds=_.uniq(this.checkedDataIds)}else{this.$(".checkboxSelectAll").attr("checked",!1);var n=[];_.each(this.$(".baseDataTable tr"),function(e){$(e).attr("actiontargetid")&&(n.push($(e).attr("actiontargetid")),$(e).find(".checkboxDataRow").attr("checked",!1))}),this.checkedDataIds=_.difference(this.checkedDataIds,n)}this.$(".checkboxDataRow").removeClass("checked"),this.$(".checkboxDataRow:checked").addClass("checked"),t||(this.selectAllRows=!1),this.updateActionView()},getInfoTooltip:function(){return this.model.getRetrievalResultMessage()},_updateRetrievalResultTooltip:function(){this.getInfoTooltip()?(this.$(".n-help-display-tooltip").nutanixMoreInfo({title:this.getInfoTooltip(),placement:"bottom"}),this.$(".n-help-display").show()):this.$(".n-help-display").hide()},enablePopoverOnHover:function(){this.hoverEnabled=!0,this.addExtraEvents(this.hoverMouseEvents)},pausePopoverOnHover:function(e){this.hoverEnabled=!e},getHoverTemplate:function(e,t){return e.tmplHover},getHoverTooltip:function(e,t,i,n){return e({rowData:t,mData:i.mData,cellData:n})},getHoverPlacement:function(e){return"top"},getHoverTitle:function(e){var t=e.sTitle;return t.length<=0?"Details":t},getPopoverContainer:function(){return $("body")},renderHoverCell:function(e,t,n){var s=t?'data-id="'+t+'"':"";return i.HOVER_TABLE_CELL({value:e,dataIdAttr:s,customClassName:n||""})},getTablePopoverTemplate:function(){return F},removeCurrentRowHandler:function(){this.selectedDataId=null,this.pageOptionsObject&&(delete this.pageOptionsObject[M.NAV_ACTION_TARGET_ID],l.updateRouteOption(this.pageOptionsObject))},getDisableCheckboxTooltip:function(){return this.entityType===M.ENTITY_ALERT?V.ACTION_DISABLED_PRISM_ELEMENT_ALERTS:null},onActionSuccess:function(e){e===M.ACTION_RESOLVE||e===M.ACTION_RESOLVE_ALL?(this._updateSelectionCheckboxes(!1),this.removeCurrentRowHandler()):e===M.ACTION_DELETE&&(this.checkedDataIds=[],this.subViewHelper.get(this.SUBVIEW_ACTION).setIds([]),this.refreshData())},onActionError:function(e){},onActionPending:function(e){},onActionInvocation:function(e){this.totalViewablePages&&(e!==M.ACTION_RESOLVE&&e!==M.ACTION_RESOLVE_ALL&&e!==M.ACTION_ACKNOWLEDGE&&e!==M.ACTION_ACKNOWLEDGE_ALL||(this.checkedDataIds=[]))},onFilterChange:function(){this.refreshData()},fnAddRows:function(e,t,i){var n,s,a,r=e.find("tbody tr"),o=i-r.length,l=r.last(),c=l.children("td");a=i%2?"odd":"even",c.each(function(e){$(this).hasClass("sorting_1")&&(s=e)});var u,d;for(u=0;u<o;u++){for(n="",d=0;d<t;d++)n+=d===s?'<td class="sorting_1">&nbsp;</td>':"<td>&nbsp;</td>";l.after('<tr class="'+a+' row_blank">'+n+"</tr>"),a="even"===a?"odd":"even"}},standingRedraw:function(e){if(!1===e.oFeatures.bServerSide){var t=e._iDisplayStart;e.oApi._fnReDraw(e),e._iDisplayStart=t,e.oApi._fnCalculateEnd(e)}e.oApi._fnDraw(e),0===this.$(".baseDataTable  tbody  tr").length&&this.goToFirstPage()},destroy:function(){b.debug("BaseTableView : destroy:  | viewid     : "+this.cid),this._removePopovers(),this.dataTable.fnDestroy(),this.dataTable=null,this.$(".n-error-details").tooltip("destroy"),this.$(".n-help-display-tooltip").nutanixMoreInfo("destroy"),this._destroySubviews(),t.prototype.destroy.apply(this,arguments),this.model=null},getOptions:function(){var e,t=this.getFilter();if(t&&(e=e||{},_.extend(e,t)),e)return{data:e,traditional:!0}},isEventOrAlertTabOnVGPage:function(){var e=l.getCurrentPageRoute(),t=e[M.NAV_PAGE_ID],i=e[M.NAV_SUBPAGE_ID],n=b.parseQueryToObject(e[M.NAV_OPTIONS])||{},s=n[M.NAV_ACTION_TARGET],a=n[M.NAV_ACTION_TARGET_ID],r=t===M.PAGE_STORAGE&&i===M.SUBPAGE_TABLE&&s===M.ENTITY_ACROPOLIS_VOLUME_GROUP,o=this.entityType===M.ENTITY_ALERT||this.entityType===M.ENTITY_EVENT;return r&&o&&a},onStartServices:function(){this.delegateEvents(),this.isEventOrAlertTabOnVGPage()||(this.delegateModelEvents(),this.sharedModel?this.model.triggerUpdate():this.model.startPolling(this.getOptions()),this.subViewHelper.iterate("startServices"))},cancelCurrentModelFetch:function(){this.model&&this.model.stopFetch()},onStopServices:function(){this._removePopovers(),this.undelegateEvents(),this.undelegateModelEvents(),this.sharedModel||this.model.stopPolling(),this.subViewHelper.iterate("stopServices")},_removePopovers:function(){this.$('[alert-popover="true"]').popover("destroy"),this.$('[data-toggle="popover"]').popover("destroy"),c.destroyAllPopOvers(this.$el)}},s.getDataTableColResizeMixin()))}),define("models/EntityMetadataModel",["models/BaseModel","data/DataURLConstants"],function(e,t){"use strict";var i=_.template(t.ENTITY_METADATA_GET);return e.extend({urlRoot:t.ENTITY_METADATA,name:"EntityMetadataModel",entityType:null,entityId:null,initialize:function(t){if(e.prototype.initialize.apply(this,arguments),!t||!t.entityType||!t.entityId)throw new Error("Must provide options.entityType and options.entityId");this.entityType=t.entityType,this.entityId=t.entityId},getURL:function(){return i({urlRoot:this.urlRoot,entityType:this.entityType,entityId:this.entityId})}})}),define("views/basecomponents/datatables/DataTableSearchAndSelect",[],function(){"use strict";var e=function(){this.CONFIG_PROP={FILTER_ON_SINGLE_PAGE:"filterOnSinglePage"},this.STEPS={FIRST_LOAD:"first-load",CHECK_LINE_AND_SET_FILTER:"check-line-and-set-filter",CHECK_LINE_AND_SHOW_ERROR:"check-line-and-show-error"},this._view=void 0,this._elementId=void 0,this._elementName=void 0,this._lastErrorElementId=void 0,this._nextStep=void 0,this.config={},this.config[this.CONFIG_PROP.FILTER_ON_SINGLE_PAGE]=!1},t=e.prototype;return t.setView=function(e){this._view=e},t.getView=function(){return this._view},t.getViewModel=function(){return this.getView().model},t.setNextStep=function(e){this._nextStep=e},t.getNextStep=function(){return this._nextStep},t.clearNextStep=function(){this.setNextStep(void 0)},t.isStarted=function(){return _.isNumber(this._elementId)||_.isString(this._elementId)&&""!==this._elementId},t.start=function(e,t){if(!this.isStarted()&&this._lastErrorElementId!==e){if(this._elementId=e,this._elementName=t,!this.isStarted())return void this.stop();this.getView().getTableElementsCount()>0?this.onFirstStep(e):this.setNextStep(this.STEPS.FIRST_LOAD)}},t.stop=function(){this.clearNextStep(),this._elementId=void 0,this._elementName=void 0},t.showNoEntityErrorMessage=function(e){this.getView().showNoEntityErrorMessage(e),this._lastErrorElementId=e},t.onFirstStep=function(e){return this.checkSelection(e)?void this.stop():this.getView().isFilter()?(this.setNextStep(this.STEPS.CHECK_LINE_AND_SET_FILTER),void this.getView().cancelFilterAndRefreshData()):void this.checkExistanceAndSetFilter(e)},t.checkSelection=function(e){return!!this.getView().selectOnCurrentPage(e)},t.makeNextStep=function(){if(this.getNextStep()){var e=this._elementId;switch(this.getNextStep()){case this.STEPS.FIRST_LOAD:this.onFirstDataLoad(e);break;case this.STEPS.CHECK_LINE_AND_SET_FILTER:this.checkExistanceAndSetFilter(e);break;case this.STEPS.CHECK_LINE_AND_SHOW_ERROR:this.checkExistanceAndShowError(e)}}},t.isOnlyOnePageInTable=function(){return 1===this.getView().getPagingInfo().iTotalPages},t.checkExistanceAndSetFilter=function(e){this.checkSelection(e)?this.stop():!this.config[this.CONFIG_PROP.FILTER_ON_SINGLE_PAGE]&&this.isOnlyOnePageInTable()?(this.showNoEntityErrorMessage(e),this.stop()):(this.setNextStep(this.STEPS.CHECK_LINE_AND_SHOW_ERROR),this.setFilter(e))},t.checkExistanceAndShowError=function(e){this.checkSelection(e)||(this.showNoEntityErrorMessage(e),this.getView().cancelFilterAndRefreshData()),this.stop()},t.onFirstDataLoad=function(e){this.getView().getTableElementsCount()>0?this.onFirstStep(e):(this.showNoEntityErrorMessage(e),this.stop())},t.setFilter=function(e){this.getViewModel().setFilterCriteria(null),this.getView().isIdSearch=!0,this.getView().setFilterText(e),this.getView().refreshData(),this._elementName&&this.getView().setFilterTextDisplayOnly(this._elementName)},e}),define("views/basecomponents/datatables/BasePaginateTableView",["views/basecomponents/datatables/BaseTableView","models/EntityMetadataModel","managers/NotificationManager","managers/NavigationManager","managers/AlertSummaryManager","utils/AppConstants","utils/DataExportUtil","utils/AppUtil","events/AppEvents","data/DataProperties","views/basecomponents/datatables/DataTableSearchAndSelect"],function(e,t,i,n,s,a,r,o,l,c,u){"use strict";return e.extend({preFetchPageCount:10,currentFetchPage:1,currentPage:1,totalViewablePages:0,sortClicked:!1,currentSortKey:void 0,currentFilter:void 0,isIdSearch:!1,idSearch:{},initialize:function(t){e.prototype.initialize.apply(this,arguments),this.idSearch=new u,this.idSearch.setView(this),this.addExtraEvents({"click  .baseDataTable thead tr th.sorting_asc":"onSortClicked","click  .baseDataTable thead tr th.sorting_desc":"onSortClicked","click  .baseDataTable thead tr th.sorting":"onSortClicked","sort   .baseDataTable":"onSort"}),this.currentSortKey=this.getDataTableSortKey(this.dataTableSettings)},getPagingInfo:function(){var e=this.model.getMetaData(),t={iPage:0,iTotalPages:0,iStart:0,iEnd:0,iFilteredTotal:0,iTotal:0};return e?(t.iTotal=e[c.META_GRAND_TOTAL],0===t.iTotal?this.resetToFirstPage():this.currentPage=Math.min(this.currentPage,Math.ceil(t.iTotal/this.defaultMinRows)),t.iStart=(this.currentPage-1)*this.defaultMinRows+1,t.iPage=this.currentPage,t.iEnd=t.iStart+this.defaultMinRows-1,t.iFilteredTotal=e[c.META_TOTAL_ENTITIES],t.iEnd=Math.min(t.iEnd,t.iFilteredTotal),t.iTotalPages=Math.ceil((t.iFilteredTotal<t.iTotal?t.iFilteredTotal:t.iTotal)/this.defaultMinRows),this.totalViewablePages=t.iTotalPages,t):t},updateSelection:function(e){if(this.pageOptionsObject=e,!e||!e.actionTargetId||!e.actionTarget)return void(this.clusterManager.isMulticlusterNavMode()&&this.handleRowSelection(null,!1));var i=e.actionTargetId;if(i===a.ACTION_SUMMARY)return this.isSummaryView()||n.showDetailsSummary(e),void this.removeRowSelection();if(this.isDataRowSelection())return this.isUpdateSelectionCalled=!1,void this.selectRow(i);if(this.isTargetIdOnPage(i))return this.selectRow(i),void(this.isUpdateSelectionCalled=!1);var s=e.actionTarget;if(s!==a.ENTITY_EVENT&&s!==a.ENTITY_ALERT&&s!==a.ENTITY_SWITCH&&s!==a.ENTITY_FILE_SERVER&&s!==a.ENTITY_SHARE){if(s===a.ENTITY_ACROPOLIS_VOLUME_GROUP)return void this.handleRowSelection(i,!0);var r=this;new t({entityType:e.actionTarget,entityId:e.actionTargetId}).fetch({success:function(t){r.idSearch.start(i,e.actionTargetName)},error:function(e){r.showNoEntityErrorMessage(i),r.handleRowSelection(null,!1),r.pageOptionsObject=null}})}},setFilterText:function(e){this.currentFilter=e,this.$(".tableFilter").val(e),this.updateTableFilterIconState(e)},setFilterTextDisplayOnly:function(e){this.$(".tableFilter").val(e),this.updateTableFilterIconState(e)},clearFilterText:function(){this.setFilterText("")},isFilter:function(){return _.isString(this.currentFilter)&&""!==this.currentFilter},cancelFilterAndRefreshData:function(){this.dataTable.fnClearTable(),this.model.setFilterCriteria(null),this.clearFilterText(),this.resetToFirstPage(),this.refreshData()},selectOnCurrentPage:function(e){return!!this.isTargetIdOnPage(e)&&(this.selectRow(e),!0)},getTableElementsCount:function(){return parseInt(this.dataTable.fnGetData().length,10)},goToNextPage:function(){0!==this.totalViewablePages&&this.currentPage!==this.totalViewablePages&&(this.currentPage++,this.isFetchNeeded()?this.refreshData():this.onDataChange())},goToPreviousPage:function(){this.currentPage<=1||(this.currentPage--,this.isFetchNeeded()?this.refreshData():this.onDataChange())},onDataChange:function(){this.currentPage>1&&_.isEmpty(this.modelToJSON())&&this.resetToFirstPage();var t=e.prototype.onDataChange.apply(this,arguments);return this.idSearch.makeNextStep(),this.refreshToCorrectSelection(!0),t},refreshData:function(e){if(this.isEventOrAlertTabOnVGPage())return void this.$(".n-loading-wrapper").hide();this.model.stopFetch(),this.$(".n-loading-wrapper").show(),e=e||{},e=_.extend(e,this.getOptions()),this.model.fetch(_.extend(e,{force:!0}))},getExtraFilter:function(){var e={count:this.defaultMinRows*this.preFetchPageCount,page:this.currentFetchPage,sortCriteria:this.currentSortKey,searchString:this.currentFilter,searchAttributeList:this.getSearchAttributeList()};return this.isIdSearch&&(e.searchAttributeList="id"),e},modelToJSON:function(){var e=(this.currentPage-1)%this.preFetchPageCount;e*=this.defaultMinRows;var t=Math.min(e+this.defaultMinRows,this.model.length),i=this.model.models.slice(e,t);return _.map(i,function(e){return e.toJSON({includeAttribute:!0,includeCustomAttributes:!0})})},onExport:function(e){var t=_.clone(this.model),n=this.getOptions();n.data.page=1,n.data.count=1e3;var s=this.getCurrentColumns(),l=this.model.getMetaData(),u=l[c.META_GRAND_TOTAL]>1e3
;$.nutanixConfirm({msg:u?"Exporting the table data.<br> Note: this operation is limited to the first 1000 rows.":"Exporting the table data.<br> ",yesText:"Yes",hideNo:!0,hideYes:!0,suppressScale:!0,context:this});var d=null;o.getBrowser()===a.BROWSER_AGENT.SAFARI&&(d=r.openExportWindow()),t.fetch({data:n.data,success:function(t){var i=t.toJSON({includeAttribute:!0,includeCustomAttributes:!0}),n=$(e.currentTarget);n.hasClass("csv")?r.exportTableCSV(i,s,{},d):n.hasClass("json")&&r.exportTableJSON(i,s,d),$("#nutanixConfirmModal .btnYes").click()},error:function(){i.showClientNotification(a.NOTIFY_ERROR,"Exporting encountered an error while downloading the data"),$("#nutanixConfirmModal .btnYes").click()}})},onTableFilter:_.debounce(function(e){this.currentFilter=$(e.currentTarget).val(),""===this.currentFilter&&(delete this.currentFilter,this.eventBus&&this.eventBus.trigger(l.TABLE_FILTER_RESET)),this.resetToFirstPage(),n.clearQueryStringParams(),this.removeRowSelection(),this.pageOptionsObject=null,this.isIdSearch=!1,this.refreshData()},500),onFilterChange:function(){this.resetToFirstPage(),this.refreshData(),this.checkedDataIds=[],this._updateSelectionCheckboxes(!1),this.updateActionView()},onActionSuccess:function(t){t===a.ACTION_RESOLVE?(this._updateSelectionCheckboxes(!1),this.removeCurrentRowHandler(),s.fetchOnDemand()):e.prototype.onActionSuccess.apply(this,arguments)},onSortClicked:function(e){this.sortClicked=!0},onSort:function(e,t){var i=this.getDataTableSortKey(t);i&&this.sortClicked&&(this.sortClicked=!1,this.currentSortKey=i,this.resetToFirstPage(),this.refreshData())},getDataTableSortKey:function(e){if(0!==e.aaSorting.length){var t=e.aaSorting[0][1],i=e.aoColumns[e.aaSorting[0][0]].sortKey;return"desc"===t?"-"+i:i}},getSearchAttributeList:function(){if(this.currentFilter){var e=this.dataTable.fnSettings().aoColumns,t=_.filter(e,function(e){return e.searchId});return t=_.map(t,function(e){return e.searchId}),t.length>0&&t.indexOf(a.SPOTLIGHT_FN_ID)<0&&t.push(a.SPOTLIGHT_FN_ID),t.length>0&&this.clusterManager.isMulticlusterNavMode()&&t.push(c.CL_NAME),t}},resetToFirstPage:function(){this.currentFetchPage=1,this.currentPage=1},isTargetIdOnPage:function(e){return 0!==this.getTableRowByTargetId(e).length},isDataRowSelection:function(){return this.pageOptionsObject[a.NAV_ACTION_SOURCE]===a.ACTION_SOURCE.SELECTION},isFetchNeeded:function(){var e=Math.floor((this.currentPage-1)/this.preFetchPageCount)+1;return e!==this.currentFetchPage&&(this.currentFetchPage=e,!0)},processLocalFilter:function(t){if(this.entityType===a.ENTITY_ALERT&&t[c.ALERT_RESOLVED]){var i=t[c.ALERT_RESOLVED];return i===a.ALERT_RESOLVED.MANUAL?(t[c.ALERT_RESOLVED]=!0,t[c.ALERT_AUTO_RESOLVED]=!1):i===a.ALERT_RESOLVED.AUTO&&(t[c.ALERT_RESOLVED]=!0,t[c.ALERT_AUTO_RESOLVED]=!0),t}return e.prototype.processLocalFilter.apply(this,arguments)}})}),define("views/details/tabs/components/TabDetailsPaginateTableView",["views/basecomponents/datatables/BasePaginateTableView","managers/ActionManager","managers/NavigationManager","utils/AppConstants","utils/AppUtil"],function(e,t,i,n,s){"use strict";return e.extend({isSelectionEnabled:!1,extraEvents:{"click     .btnItemAction":"onItemActionClick","click     a.pageLink":"onPageLinkClick"},initialize:function(t){e.prototype.initialize.apply(this,arguments),this.addExtraEvents(this.extraEvents),this.defaultMinRows=10,this.entityType===n.ENTITY_ALERT&&this.clusterManager.isMulticlusterNavMode()&&(this.isSelectionEnabled=!0)},_getDefaultColumnsWrapper:function(t,i){var a=s.getHashParameters();return a&&a.actionTarget===n.PAGE_CLUSTER?this.getDefaultColumns(t,i):e.prototype._getDefaultColumnsWrapper.apply(this,arguments)},onPageLinkClick:function(e){i.navigateToPageByPageLink(e.currentTarget)},onItemActionClick:function(e){this.entityType===n.ENTITY_ALERT&&t.executeActionElement(e.currentTarget)},onStopServices:function(){$(".tooltip").tooltip("destroy"),e.prototype.onStopServices.apply(this,arguments)}})}),define("events/TooltipEventMixin",["utils/ManagerMixin","utils/AppConstants","managers/ActionManager","utils/I18nMixin"],function(e,t,i,n){"use strict";var s={body:"body",tooltipElem:"tooltipElem",view:"view"},a={ACTION_ENTER_OVERRIDE_MODE:"enterOverrideMode"};return{tooltipMouseEvents:{mouseleave:"onContainerMouseLeave","click .n-tooltip-action":"onTooltipAction"},getTooltipEvents:function(){var t={};return t[e.getTooltipManager().TOOLTIP_MOUSE_EVENTS.MOUSE_ENTER]="onTooltipWrapperMouseEnter",t[e.getTooltipManager().TOOLTIP_MOUSE_EVENTS.MOUSE_LEAVE]="onTooltipWrapprMouseLeave",_.extend(t,this.tooltipMouseEvents)},setTooltipDataSource:function(e){var t=this;this.dataSource=e,this.dataSource.on("reset",function(){t.destroyTooltips()})},destroyTooltips:function(){var t=this.$(e.getTooltipManager().TOOLTIP_SELECTOR);t.attr("tooltipShown","false"),t.tooltip("destroy")},onTooltipAction:function(e){var s=this;e.stopPropagation(),$(e.currentTarget).attr(t.NAV_ACTION)===a.ACTION_ENTER_OVERRIDE_MODE?$.nutanixConfirm({title:n.i18nStatic("TooltipEventMixin","confirmOverrideTitle"),msg:n.i18nsStatic("TooltipEventMixin","confirmOverrideMsg",{bold_open:"<strong>",bold_close:"</strong>"}),yesText:n.i18nStatic("Common","override"),yes:function(){i.executeActionElement(e.currentTarget,{changeUrl:!1}),s.destroyTooltips()}}):(i.executeActionElement(e.currentTarget,{changeUrl:!1}),this.destroyTooltips())},onContainerMouseLeave:function(e){this.destroyTooltips()},onTooltipWrapperMouseEnter:function(t){t.stopPropagation();var i=t.currentTarget,n=$(i).find(e.getTooltipManager().TOOLTIP_SELECTOR);if(n&&n.length>0&&"true"!==n.attr("tooltipShown")){this.destroyTooltips();var s=this._getTooltipOptions(n);s&&(n.attr("tooltipShown","true"),n.tooltip(s),n.tooltip("show"))}},onTooltipWrapprMouseLeave:function(t){t.stopPropagation();var i=$(t.currentTarget).find(e.getTooltipManager().TOOLTIP_SELECTOR),n=i.attr("actionable");n&&Boolean(n)||this.destroyTooltips()},_getTooltipOptions:function(t){var i=t.attr("data-id"),n=t.attr("data-attribute"),a=this.dataSource.findModelById(i);if(a){var r=e.getTooltipManager(),o=t.attr("placement"),l=t.attr("indicator"),c=t.attr("template"),u=t.attr("container")||s.body,d=this._getTooltipContainer(u,t);return{title:r.getTooltipText(a,n,l,c),container:d,placement:o||"right",trigger:"manual",html:!0}}return null},_getTooltipContainer:function(e,t){var i;return e=s[e],(i={},_defineProperty(i,s.body,s.body),_defineProperty(i,s.tooltipElem,t),_defineProperty(i,s.view,this.$el),i)[e]||s.body}}}),define("utils/renderers/EntityCustomIconsMixin",["utils/ManagerMixin"],function(e){"use strict";var t=_.template('<div class="custom-icon <%= icon %>"></div>');return{getCustomIconsPlaceholder:function(i,n){var s=e.getEntityUICustomizationManager();if(s){var a=s.getCustomIconClassNames(i,n);if(a)return _.map(a,function(e){return t({icon:e})}).join(" ")}return""},renderCustomIconsForEntities:function(t,i,n){var s=this,a=e.getEntityUICustomizationManager();if(a){var r=a.getCustomIconClassNames(i);r&&_.each(r,function(e){if(t.$(".entityTooltipTarget ."+e).length){var r=a.getHelperQueryOptionsByIcon(i,e);s._loadAndRenderIcons(t,i,n,e,r)}})}},_loadAndRenderIcons:function(t,i,n,s,a){var r=this,o=e.getEntityCacheManager();o&&a&&a.entityTypes&&_.size(a.entityTypes)&&o.loadEntities(a.entityTypes,a.attributes,a.filterExpressions).done(function(e){r._processHelperData(t,i,n,s,e)})},_processHelperData:function(t,i,n,s,a){var r=e.getEntityUICustomizationManager().findEntitiesByIcon(i,n,s,a);this._renderIconsByEntities(t,s,i,r,a)},_renderIconsByEntities:function(t,i,n,s){var a=e.getEntityUICustomizationManager().getCustomIcon(n,i);_.each(s,function(e){var n='.entityTooltipTarget[data-id="'+e.getId()+'"] .custom-icon',s=t.$(n);s.attr("title",t.i18n(i.tooltipKey)),s.html(a.icon)})}}}),define("views/pages/ebrowser/viz/EBTableView",["views/basecomponents/datatables/BaseTableView","data/DataProperties","views/basecomponents/datatables/DataTableTemplates","events/TooltipEventMixin","managers/NavigationManager","utils/EntityUtil","utils/DataRendererUtil","utils/AppUtil","utils/AppConstants","utils/renderers/EntityCustomIconsMixin"],function(e,t,i,n,s,a,r,o,l,c){"use strict";var u=_.template('<<%= showLink ? "a" : "span" %> class="entityTooltipTarget" data-id="<%= entityId %>"><div class="css-icon state-icon -hidden"></div><span class="<%= showLink ? "entityLink link" : "entity-text" %>" title="<%= entityName %>" data-id="<%= entityId %>"><%= linkDisplayValue %><%= systemEntityTag %></span><div class="pull-right icons-wrapper"><div class="task-icon"></div><div class="label-icon labelTooltipTarget"></div><div class="health-icon"></div><%= customIcon %> </div></<%= showLink ? "a" : "span" %>>');return e.extend(_.extend({},n,c,{dataTableSortBy:null,visualizationAttributes:null,sortByAttributes:null,extraEvents:{'click th:not(".select-all")':"onTableHeaderClick","click .pageLink":"onEntityDetailsClick","mousedown  .baseDataTable tbody tr td:first-child":"onDataRowMouseDown"},SELECT_ALL_CHECKBOX_CHANGE_EVENT:"SelectAllCheckboxEvent",COLOR_CLASS:"color-class",COLOR_BY_TIP:"color-by-tip",anchorRowEntityId:null,initialize:function(t){if(t=t||{},this.visualizationAttributes=t.visualizationAttributes,this.sortByAttributes=t.sortByAttributes||[],this.disableCheckBox=t.disableCheckBox||!1,this.selectionsModel=t.selectionsModel,t.onDrawCallback&&!_.isFunction(t.onDrawCallback))throw new Error("options.onDrawCallback is not a function");e.prototype.initialize.apply(this,arguments),this.addExtraEvents(this.extraEvents),this.addExtraEvents(this.getTooltipEvents()),this.$el.hasClass("n-base-data-table")||this.$el.addClass("n-base-data-table"),this.onEntityDetails=t.onEntityDetails,this.anchorRowEntityId=null,this.parentDrawCallback=t.onDrawCallback,this.setQaDataTestListPrefix(this.entityType)},initializeTableModel:function(e){this.model=a.createCollection(this.entityType,null),this.defaultMinRows=e.defaultMinRows||10,this.setTooltipDataSource(this.model)},initializeDataTableSettings:function(t){var i=e.prototype.initializeDataTableSettings.apply(this,arguments);return this.dataTableSettings.aaSorting=[],i},destroy:function(){this.destroyTooltips(),e.prototype.destroy.apply(this,arguments)},onSelectAllCheckboxChangeEvent:function(e){this.$el.on(this.SELECT_ALL_CHECKBOX_CHANGE_EVENT,e)},triggerSelectAllCheckboxChangeEvent:function(e){this.$el.trigger(this.SELECT_ALL_CHECKBOX_CHANGE_EVENT,[e])},onSelectedIdsChange:function(t){this.options.isSelectAllEntitiesEnabled&&this.options.isSelectAllEntitiesEnabled()&&this.selectionsModel?(this.checkedDataIds=t,this.selectionsModel.setSelectedEntityIds(this.entityType,this.checkedDataIds)):e.prototype.onSelectedIdsChange.apply(this,arguments)},onChangeSelectAll:function(t){if(!this.selectionsModel)return void e.prototype.onChangeSelectAll.apply(this,arguments);var i=$(t.currentTarget).is(":checked"),n=[];_.each(this.$(".checkboxDataRow"),function(e){var t=$(e);n.push(t.val()),i?t.attr("checked","checked"):t.removeAttr("checked")}),i?(this.selectionsModel.appendSelectedEntityIds(this.entityType,n),this.checkedDataIds=n):(this.selectionsModel.removeSelections(this.entityType,n),this.checkedDataIds=[]),this.triggerSelectAllCheckboxChangeEvent(i)},onTableHeaderClick:function(e){var t=$(e.currentTarget),i=t.text(),n=this.getCurrentColumns(),s=_.find(n,function(e){return o.stripHTMLfromStr(e.sTitle)===i});if(this.isSortByAttributeEnabled(s.ntnxAttr)){var a=l.SORT_DESCENDING;if(t.hasClass("sorting_"+l.SORT_DESC)&&(a=l.SORT_ASCENDING),t.parent().children().removeClass("sorting_"+l.SORT_DESC+"sorting_"+l.SORT_ASC),s){var r=[s.ntnxAttr,a];this.dataTableSortBy=r,this.options.sortChangeCB(r)}e.stopPropagation()}},setSelectedEntityIds:function(e){this.checkedDataIds=e},_isRowChecked:function(e){var i=String(e[t.ID]);return _.contains(this.checkedDataIds,i)},onStartServices:function(){this.delegateEvents(),this.delegateModelEvents(),this.model&&this.model.length&&this.onDataChange()},onStopServices:function(){this.destroyTooltips(),this.undelegateEvents(),this.undelegateModelEvents()},onDrawCallback:function(e){var t=this.dataTableSortBy||this.options.sortBy;if(t){var i=-1;_.each(e.aoColumns,function(e,n){e.ntnxAttr===t[0]&&(i=n)},this);var n,s=this.$("th"),a=$(s[i]);t[1]===l.SORT_DESCENDING?n=l.SORT_DESC:t[1]===l.SORT_ASCENDING&&(n=l.SORT_ASC),a.removeClass("sorting").addClass("sorting_"+n)}this._updateSelectAllCheckbox(),_.each(this.$("tr"),function(e){var t=$(e),i=t.attr(this.COLOR_CLASS),n=t.attr(this.COLOR_BY_TIP),s=t.find(".state-icon");i&&s.removeClass("-hidden").addClass(i).attr("title",n)},this),this.parentDrawCallback&&this.parentDrawCallback()},_dataTableRowCallback:function(t,i,n){var s=e.prototype._dataTableRowCallback.apply(this,arguments);return i.colorClass&&$(t).attr(this.COLOR_CLASS,i.colorClass).attr(this.COLOR_BY_TIP,i.colorTip),this.isQaMode()&&$(t).attr(l.DATA_TEST_ID,this.getQaDataTestListPrefixedId(i.attributes.id||i.attributes.entity_id)),s},_createdCellCallback:function(e,t,i,n,s){var a=t;if($.isArray(t))a=t.join(", ");else if(o.containsHTML(t))return;a&&$(e).wrapInner('<span title="'+a+'"/>')},fnAddRows:function(e,t,i){},updateNavigation:function(e){},renderSelectAllCheckbox:function(e){!this.disableCheckBox&&this.model.length?this.$(".n-select-all").show():this.$(".n-select-all").hide()},onDataRowMouseDown:function(e){if(o.isIEBrowser()&&e.shiftKey){e.preventDefault(),this.onselectstart=function(){return!1};var t=this;setTimeout(function(){t.onselectstart=null},0)}},onClickDataRow:function(t){var i=$(t.target);if(!this.selectionsModel)return void(i.hasClass("entityLink")?this.onEntityDetails(i.attr("data-id")):e.prototype.onClickDataRow.apply(this,arguments));var n=this.$(".checkboxSelectAll").is(":checked"),s=$(t.currentTarget).attr("actiontargetid");if(t.shiftKey)i.is("svg.svg-input")||i.is("polyline")?(this._extendSelection(s),this._updateSelectAllCheckbox()):(t.stopPropagation(),t.preventDefault());else if(i.hasClass("checkboxDataRow"))this.selectionsModel.toggleEntitySelection(this.entityType,s),this._updateSelectAllCheckbox(),this._setAnchorEntityId(s);else if(i.hasClass("entityLink")){var a=i.attr("data-id");this.onEntityDetails(a)}var r=this.$(".checkboxSelectAll").is(":checked");r!==n&&this.triggerSelectAllCheckboxChangeEvent(r)},updateDataSource:function(e){this.model.reset(e),this._setAnchorEntityId(null)},updateActionView:function(){this.selectionsModel||e.prototype.updateActionView.apply(this,arguments)},refreshData:function(){this.model.trigger("reset")},modelToJSON:function(){return this.model.models},_getDefaultColumnsWrapper:function(e,t){return this.getDefaultColumns(e,t)},getDefaultColumns:function(e,n){var s=this,r=[];if(!this.disableCheckBox){var o=this.selectionsModel?i.CHECKBOX_SELECT_ALL(this.vtOptions()):"";r.push({sTitle:o,mData:t.ID,ntnxAttr:t.ID,exportable:!1,sWidth:"15px",sClass:"center select-all",bSortable:!1,sType:"html",mRender:function(e,t,i){return t===l.TABLE_COL_TYPE_EXPORT?"":s.renderColumnCheckbox(e,t,i)}})}var c=this.visualizationAttributes[t.DISPLAY_ATTRIBUTES],u=c.length,d=this.visualizationAttributes[t.PRIMARY_ATTRIBUTE];d&&(u+=1);var h=Math.floor(100/u),p=this.visualizationAttributes[t.CUSTOM_RENDERS];return _.each(c,function(t){var i=this.getAttributeRenderer(t),n=a.isIntAttribute(e,t)?"right":"",o=(t===d?2*h:h)+"%";p&&p[t]&&p[t].columnWidth&&(o=p[t].columnWidth);var c=i.getAttributeDisplayName(this.entityType),u=i.getAttributeDisplayTooltip(this.entityType);r.push({sTitle:c+u,sType:"string",mData:function(e,n){var s=e?e.getValue(t):null;return n===l.TABLE_COL_TYPE_EXPORT?i.getAttributeExportValue(e,s,t):s||""},fnCreatedCell:s._createdCellCallback,ntnxAttr:t,sWidth:o,sClass:n,mRender:function(e,n,a){return t===d?s.renderPrimaryColumnCell(e,n,a,i):s.renderColumnCell(e,n,a,i)}})},this),_.each(r,function(e){e.bSortable=!1,this.isSortByAttributeEnabled(e.ntnxAttr)||(e.sClass=e.sClass+" eb_sort_disabled")},this),r},isSortByAttributeEnabled:function(e){return _.contains(this.sortByAttributes,e)},getAttributeRenderer:function(e){var i=this.visualizationAttributes[t.CUSTOM_RENDERS],n={name:e};return i&&i[e]&&_.extend(n,i[e]),r.getRenderer(n)},renderColumnCheckbox:function(e,t,n){var s=this._isRowChecked(n);return i.CHECKBOX_ROW(this.vtOptions({value:e,checked:s}))},renderColumnCell:function(e,t,i,n){return t===l.TABLE_COL_TYPE_EXPORT?e:n.getAttributeDisplayValue(i,!0,e)},renderPrimaryColumnCell:function(e,t,i,n){var s=n.getAttributeDisplayValue(i,!0,e),a=!n.isNoneFormatter()&&n.hasDetailsPage(this.entityType),r=n.getSystemEntityTag(i)||"";switch(t){case l.TABLE_COL_TYPE_DISPLAY:return u({showLink:a,entityId:i.getValue(i.idAttribute),entityName:i.getName()||"",linkDisplayValue:s,linkClass:"",customIcon:this.getCustomIconsPlaceholder(this.entityType,i),systemEntityTag:r});case l.TABLE_COL_TYPE_EXPORT:return e;default:return _.escape(s)}},_updateSelectAllCheckbox:function(){if(this.selectionsModel){var e=this.selectionsModel.getSelectedEntityIds(this.entityType),i=this.$(".checkboxSelectAll"),n=!1;this.model.length?(e.length?i.addClass("partial-check"):i.removeClass("partial-check"),n=!this.model.some(function(i){return e.indexOf(i[t.ID])<0})):i.removeClass("partial-check"),i.attr("checked",n)}},isSelectAllCheckboxChecked:function(){return this.$(".checkboxSelectAll").is(":checked")},onEntityDetailsClick:function(e){var t=$(e.currentTarget);if(this.clusterManager.isMulticlusterUI()){var i=t.attr(l.NAV_ACTION_TARGET),n=t.attr(l.NAV_ACTION_TARGET_ID),a=s.createNavigationContext(i,{});s.navigateToFullScreenDetailsPane(i,n,a)}else s.navigateToPageByPageLink(t)},_extendSelection:function(e){if(this.anchorRowEntityId&&this.anchorRowEntityId!==e){for(var t=[],i=!1,n=0;n<this.model.models.length;n++){var s=this.model.models[n].getId();if(s!==this.anchorRowEntityId&&s!==e)i&&t.push(s);else{if(t.push(s),i)break;i=!0}}this.selectionsModel.areAllSelected(this.entityType,t)?this.selectionsModel.removeSelections(this.entityType,t):this.selectionsModel.appendSelectedEntityIds(this.entityType,t);var a=this.selectionsModel.getSelectedEntityIds(this.entityType);_.each(this.$(".checkboxDataRow"),function(e){var t=$(e);t.attr("checked",_.contains(a,t.val()))}),this.$(".checkboxDataRow").removeClass("checked"),this.$(".checkboxDataRow:checked").addClass("checked")}},_setAnchorEntityId:function(e){this.anchorRowEntityId=e,this.$("tr.anchor-row").removeClass("anchor-row"),e&&this.$('tr[actiontargetId="'+e+'"]').addClass("anchor-row")}}))}),define("models/ebrowser/EBPerspectiveModel",["models/BaseModel","data/DataProperties","utils/AppConstants"],function(e,t,i){"use strict";var n={ENTITY_ATTRIBUTES:"entityAttributes",ID_ATTRIBUTE:"idAttribute",PRIMARY_ATTRIBUTE:"primaryAttribute",DEFAULT_SORTING_ATTRIBUTE:"defaultSortingAttribute",DISPLAY_ATTRIBUTES:"displayAttributes",GROUPBY_ATTRIBUTES:"groupByAttributes",FILTERBY_ATTRIBUTES:"filterByAttributes",HELPER_ATTRIBUTES:"helperAttributes",VIRTUAL_ATTRIBUTES:"virtualAttributes",SUMMARIES:"summaries",SUMMARY_AGGREGATES:"aggregates",SUMMARY_FORMATTER:"formatter",SUMMARY_TITLE:"title",COLORBY_ATTRIBUTES:"colorByAttributes",DEFAULT_COLORBY_ATTRIBUTE:"defaultColorByAttribute",VISUALIZATIONS:"visualizations",CUSTOM_RENDERS:"customRenders",ENTITY_TYPE:"entityType",ATTRIBUTE_INFO_KEYS:["idAttribute","primaryAttribute","displayAttributes","groupByAttributes","filterByAttributes","helperAttributes","virtualAttributes","summaries","colorByAttributes","defaultColorByAttribute"],QUERY_INFO_KEYS:["primaryAttribute","displayAttributes","helperAttributes","defaultColorByAttribute"],COMMON_ATTR_KEYS:["idAttribute","primaryAttribute","groupByAttributes","filterByAttributes","colorByAttributes","defaultColorByAttribute","helperAttributes","summaries","defaultSortingAttribute"],CUSTOM_RENDER_KEYS:["formatter","columnWidth"]};return e.extend({name:"EBPerspectiveModel",DP:n,getDisplayName:function(){var e=this.get(t.NAME);return this.i18n("perspectives."+e,e)},getQueryAttributes:function(){var e=[],t=function(t){t&&(_.isObject(t)?_.each(t,function(t){_.isArray(t)?_.each(t,function(t){e.push(t[0])}):e.push(t)}):e.push(t))},s=this.getPerspectiveAttributes();_.each(n.QUERY_INFO_KEYS,function(e){t(s[e]),_.each(this.get(n.VISUALIZATIONS),function(i){var s=i[n.QUERY_INFO_KEYS];s&&t(s[e])})},this);var a=this.getPerspectiveAttributes()[n.VIRTUAL_ATTRIBUTES]||[];return e=_.filter(e,function(e){return!_.contains(a,e)&&0!==e.indexOf(i.ENTITY_CATEGORY_PREFIX)}),_.uniq(e)},getPrimaryAttribute:function(){return this.getPerspectiveAttributes()[n.PRIMARY_ATTRIBUTE]},getDefaultSortingAttribute:function(){var e=this.getPerspectiveAttributes();return e[n.DEFAULT_SORTING_ATTRIBUTE]||e[n.PRIMARY_ATTRIBUTE]},getIdAttribute:function(){return(this.getPerspectiveAttributes()||{})[n.ID_ATTRIBUTE]},getGroupByAttributes:function(){var e=this.getPerspectiveAttributes()[n.GROUPBY_ATTRIBUTES];return e=this._filterAttributes(e)},getColorByAttributes:function(){var e=this.getPerspectiveAttributes()[n.COLORBY_ATTRIBUTES];return e=this._filterAttributes(e)},getDefaultColorByAttribute:function(){return this.getPerspectiveAttributes()[n.DEFAULT_COLORBY_ATTRIBUTE]},getFilterByAttributes:function(){var e=this.getPerspectiveAttributes()[n.FILTERBY_ATTRIBUTES];return e=this._filterAttributes(e)},getDisplayAttributes:function(){var e=this.getPerspectiveAttributes()[n.DISPLAY_ATTRIBUTES]||[];return e=this._filterAttributes(e)},getPerspectiveAttributes:function(){return this.get(n.ENTITY_ATTRIBUTES)||{}},getVisualization:function(e){return _.find(this.get(n.VISUALIZATIONS),function(i){return i[t.NAME]===e})},getVisualizationAttributes:function(e){var t=this.getVisualization(e),i={},s=this.getPerspectiveAttributes(),a=t&&t[n.ENTITY_ATTRIBUTES];return _.each(n.ATTRIBUTE_INFO_KEYS,function(e){i[e]=t&&a[e]?a[e]:s[e]}),i[n.CUSTOM_RENDERS]=s[n.CUSTOM_RENDERS],i},getGroupSummaryAttributes:function(e){var t=[],i=this.getPerspectiveAttributes()[n.SUMMARIES]||{},s=i[e];return _.each(s,function(e){e[n.SUMMARY_AGGREGATES]&&e[n.SUMMARY_AGGREGATES].length&&_.map(e[n.SUMMARY_AGGREGATES],function(e){t.push({attribute:e[0],operation:e[1]})})}),t},_filterAttributes:function(e){return e}},{DP:n})}),define("models/ebrowser/EBPerspectivesCollection",["models/BaseCollection","managers/EntityManager","models/ebrowser/EBPerspectiveModel","utils/AppUtil"],function(e,t,i,n){"use strict";return e.extend({name:"EBPerspectivesCollection",entityType:null,model:i,COMMON_PERSPECTIVE:"_common_",initialize:function(e,t){this.entityType=t.entityType,this.initializeBaseCollection(e,t)},fetch:function(e){var i=this;return t.fetchPerspectivesConfiguration().done(function(t){try{var s=i._createPerspectives(t.getPerspectives(i.entityType));i.reset(s,{silent:!0}),e&&e.success&&e.success(i,s,e)}catch(s){n.log("Error parsing perspectives json. "+s),e&&e.error&&e.error(i,t,e)}})},getPerspectives:function(){return this.filter(function(e){return e.getName()!==this.COMMON_PERSPECTIVE},this)},getCommonPerspective:function(){return this.find(function(e){return e.getName()===this.COMMON_PERSPECTIVE},this)},copyCommonAttributes:function(e){var t=_.find(this.models,function(e){return e.getName()===this.COMMON_PERSPECTIVE},this),n=e.get(e.DP.ENTITY_ATTRIBUTES)||{},s=t.get(e.DP.ENTITY_ATTRIBUTES);_.each(i.DP.COMMON_ATTR_KEYS,function(e){n[e]&&s[e]?_.isArray(n[e])?n[e]=_.uniq(n[e].concat(s[e])):_.isObject(n[e])&&(n[e]=_.extend(s[e],n[e])):n[e]=s[e]}),n[i.DP.CUSTOM_RENDERS]=s[i.DP.CUSTOM_RENDERS],e.set(e.DP.ENTITY_ATTRIBUTES,n),e.set(e.DP.VISUALIZATIONS,t.get(e.DP.VISUALIZATIONS)),e.setPopulated()},_createPerspectives:function(e){var t=null;return _.each(e,function(e,n){0===n&&e.name===this.COMMON_PERSPECTIVE?t=e:null!==t&&this._copyCommonPerspectiveAttributes(e,t),e[i.DP.ENTITY_TYPE]=this.entityType},this),e},_copyCommonPerspectiveAttributes:function(e,t){var n=i.DP.COMMON_ATTR_KEYS;_.each(n,function(i){e.entityAttributes[i]=t.entityAttributes[i]});var s=i.DP.CUSTOM_RENDER_KEYS;return _.each(e.entityAttributes.displayAttributes,function(i){t.entityAttributes.customRenders&&t.entityAttributes.customRenders[i]&&_.each(s,function(n){e.entityAttributes.customRenders=e.entityAttributes.customRenders||{},e.entityAttributes.customRenders[i]=e.entityAttributes.customRenders[i]||{};var s=t.entityAttributes.customRenders[i][n];s&&(e.entityAttributes.customRenders[i][n]=s)})}),!e[i.DP.VISUALIZATIONS]&&t[i.DP.VISUALIZATIONS]&&(e[i.DP.VISUALIZATIONS]=t[i.DP.VISUALIZATIONS]),e}})}),define("models/CallbackPollingModel",["models/BaseModel","utils/AppConstants","utils/AppUtil"],function(e,t,i){"use strict";return e.extend({name:"CallbackPollingModel",queryPoller:null,_queryPollCheckFrequency:t.DEFAULT_POLLING_INTERVAL,_pollDataCallback:null,initialize:function(e){if(e=e||{},!e.pollDataCallback)throw new Error("Callback for polling data not provided");this._pollDataCallback=e.pollDataCallback,e.queryPollCheckFrequency&&(this._queryPollCheckFrequency=e.queryPollCheckFrequency)},startPolling:function(){var e=this;if(i.isLocalStorageProperty(t.LOCAL_STORAGE.NO_POLLING))return void i.log("CallbackPollingModel. Polling disabled.");this.queryPoller=setInterval(function(){e._log("Polling for new data"),e._pollDataCallback()},this._queryPollCheckFrequency)},stopPolling:function(){this._log("Stop polling"),this.queryPoller&&(clearInterval(this.queryPoller),this.queryPoller=null)},_log:function(e){i.debug("CallbackPollingModel: ",e)}})}),define("views/details/tabs/EBEntityTableView",["views/basecomponents/BaseSubView","views/pages/ebrowser/viz/EBTableView","models/ebrowser/EBPerspectivesCollection","models/ebrowser/EBQueryModel","models/CallbackPollingModel","components/Components","data/DataProperties","managers/NavigationManager","utils/AppConstants","utils/SubViewHelper","utils/SubModelHelper","utils/FilterUtil","utils/EntityUtil","utils/AppUtil"],function(e,t,i,n,s,a,r,o,l,c,u,d,h,p){"use strict";var T={TABLE_VIEW:"tableView"},E=n.DP,S=n.extend({defaultUnGroupedMembersLimit:100,initialize:function(e,t){n.prototype.initialize.apply(this,arguments),t=t||{},this.defaultUnGroupedMembersLimit=t.prefetchQueryLimit||this.defaultUnGroupedMembersLimit,this.defaultPageSize=t.defaultPageSize||this.DEFAULT_PAGE_SIZE},getDefaultMemberLimit:function(e){return this.defaultUnGroupedMembersLimit},_getPageSizeForGroup:function(e){return this.defaultPageSize}});return e.extend({name:"EBEntityTableView",className:"entity-table-view",perspectivesCollection:null,prefetchQueryLimit:100,template:_.template('<div class="entity-table-container">\n        <div class="header">\n          <div class="header-left">\n            <% if (showSearchHeader) { %>\n              <input class="search-input" type="text"\n                placeholder="<%= i18n("searchPlaceHolder") %>">\n            <% } %>\n          </div>\n          <div class="header-right">\n            <% if (showExport) { %>\n              <div\n                class="export csv"\n                title="<%= i18n("Export") %>"\n                <%= getQaDataTestId(\'export\') %>\n              >\n                <%= SVG.SVGIcon("Export") %>\n              </div>\n              <div class="export-separator"></div>\n            <% } %>\n            <div class="paginator"></div>\n            <div class="loader">\n              <div class="donut-loader-blue"></div>\n            </div>\n          </div>\n        </div>\n        <div class="table-wrapper"></div>\n      </div>'),events:{"click  li:not(.disabled) > a.pagerNext":"onNextPage","click  li:not(.disabled) > a.pagerPrevious":"onPreviousPage","keyup  .search-input":"onSearch","click  .export":"onExport"},eventBus:null,enablePolling:!1,subModelHelper:null,pageOffset:null,initialize:function(e){e=e||{},this.eventBus=_.extend({},Backbone.Events),this.entityType=e.entityType,this.disableCheckBox=e.disableCheckBox||!1,this.displayAttributes=e.displayAttributes||!1,this.$el=e.el||this.$el,this.defaultMinRows=e.defaultMinRows,this.disableSearchHeader=e.disableSearchHeader||!1,this.enableEntityDetails=e.enableEntityDetails||!1,this.perspectiveName=e.perspectiveName||l.DEFAULT_PERSPECTIVE,this.ebTableStyle=e.ebTableStyle||!1,this.showExport=e.showExport||!1;var t=e.enableDefaultTableFilter;if(this.enableDefaultTableFilter=!!_.isUndefined(t)||t,_.bindAll(this,"_onPageData"),this.subViewHelper=new c,e.prefetchQueryLimit=e.prefetchQueryLimit||this.prefetchQueryLimit,this.queryModel=new S(null,{prefetchQueryLimit:e.prefetchQueryLimit,defaultPageSize:e.defaultPageSize}),this.queryModel.set(this.queryModel.DP.FILTER_EXPR,e.defaultFilter||{}),this.queryModel.set(this.queryModel.DP.GROUP_COUNT,this.queryModel.DEFAULT_GROUPS_LIMIT),this.queryModel.set(this.queryModel.DP.MEMBERS_LIMIT_PER_GRP,this.queryModel.DEFAULT_MEMBERS_LIMIT),e[this.queryModel.DP.ENTITY_IDS]&&this.queryModel.set(this.queryModel.DP.ENTITY_IDS,e[this.queryModel.DP.ENTITY_IDS]),this.perspectivesCollection=new i(null,{entityType:this.entityType}),this.subModelHelper=new u,e.enablePolling){this.enablePolling=!0;var n=this,a=new s({pollDataCallback:function(){n._performQuery()}});this.subModelHelper.register("CallbackPollingModel",a)}},destroy:function(){p.debug("EBEntityTableView : destroy: "," | viewid     : "+this.cid),this.subViewHelper&&this.subViewHelper.removeAll(),this.perspectivesCollection=null,this.enablePolling&&this.subModelHelper.get("CallbackPollingModel").stopPolling(),this.subModelHelper.destroy(),this.subModelHelper=null,e.prototype.destroy.apply(this,arguments)},render:function(){var e=this;return this.$el.html(this.template(this.vtOptions({showSearchHeader:!this.disableSearchHeader,showExport:this.showExport}))),this.perspectivesCollectionFetched?this._renderTable():this.fetchPerspectivesCollection().done(function(){return e._renderTable()}),this},appendFilterCriteria:function(e){var t=this.queryModel.get(this.queryModel.DP.FILTER_EXPR);t=_.extend(t,e),this.queryModel.set(this.queryModel.DP.FILTER_EXPR,t)},fetchPerspectivesCollection:function(){var e=this;return this.perspectivesCollection.fetch({success:function(){var t=e.perspectivesCollection.find(function(t){return t.get(r.NAME)===e.perspectiveName}),i=e.queryModel;if(!t)throw new Error("Cannot find "+e.perspectiveName+" for the entity "+e.entityType);e.perspective=t,i.set(i.DP.GROUP_MEMBER_ATTRIBUTES,i.convertGroupMemberAttributesList(e.perspective.getQueryAttributes())),e.perspectivesCollectionFetched=!0},error:function(){p.debug("EBEntityTableView : perspectivesCollection fetch failed.")}})},initializeTable:function(){var e=this;if(!this.subViewHelper.get(T.TABLE_VIEW)){var i=this.perspective,n=i.getVisualizationAttributes("table");this.displayAttributes&&(n.displayAttributes=this.displayAttributes);var s={entityType:this.entityType,el:this.$(".table-wrapper"),disableCheckBox:this.disableCheckBox,ebTableStyle:this.ebTableStyle,defaultMinRows:this.defaultMinRows,enableDefaultTableFilter:this.enableDefaultTableFilter,eventBus:this.eventBus};s.visualizationAttributes=n,this.enableEntityDetails&&(s.onEntityDetails=function(t){var i=o.createNavigationContext(e.entityType,{});o.navigateToFullScreenDetailsPane(e.entityType,t,i)});var a=new t(s);this.subViewHelper.register(T.TABLE_VIEW,a)}},loadData:function(){var e=this;this.perspectivesCollectionFetched?this._performQuery():this.fetchPerspectivesCollection().done(function(){return e._performQuery()})},refreshCurrentPage:function(){this.queryModel.refreshCurrentPage(this.groupModel,this._onPageData)},registerEvent:function(e,t){this.eventBus&&this.eventBus.on(e,t)},unregisterEvent:function(e,t){this.eventBus&&this.eventBus.off(e,t)},_renderTable:function(){this._renderPaginator(),this.initializeTable(),this.subViewHelper.get(T.TABLE_VIEW).render()},_performQuery:function(){var e=this,t=this.queryModel,i={};i[t.DP.ENTITY_TYPE]=this.entityType,i[t.DP.GROUP_BY_ATTR]=l.GROUP_BY_NONE,i[t.DP.GROUP_MEMBER_COUNT]=t.getDefaultMemberLimit(null),i[t.DP.GROUP_MEMBER_OFFSET]=0,i[t.DP.GROUP_OFFSET]=0
;var n=this._getDefaultSortInfo(this.entityType,this.perspective);return n&&n.length&&(i[t.DP.GROUP_MEMBER_SORT_ATTRIBUTE]=n[0],i[t.DP.GROUP_MEMBER_SORT_ORDER]=n[1]),t.set(i),this.showLoader(),this.pageOffset=0,this.enablePolling&&this.groupModel&&(this.pageOffset=this.groupModel.get(this.groupModel.DP.PAGE_OFFSET)),t.performQuery({success:function(){e.groupModel=t.get(E.GROUP_RESULTS).at(0),e.pageOffset&&e.groupModel.set(e.groupModel.DP.PAGE_OFFSET,e.pageOffset),e.hideLoader(),e._onPageData()},error:function(){p.debug("EBEntityTableView : Query Failed."),e.hideLoader()}})},_renderPaginator:function(){var e=this.queryModel.getPaginationInfo(this.groupModel);e&&!this.groupModel&&(e.start=-1),this.$(".paginator").html(a.pager(e))},_getDefaultSortInfo:function(e,t){var i=t.getDefaultSortingAttribute();return[i,h.isStringAttribute(e,i)?l.SORT_ASCENDING:l.SORT_DESCENDING]},showLoader:function(){this.$el.find(".loader").show()},hideLoader:function(){this.$el.find(".loader").hide()},onNextPage:function(e){this.queryModel.loadNextPage(this.groupModel,this._onPageData)},onPreviousPage:function(e){this.queryModel.loadPreviousPage(this.groupModel,this._onPageData)},_onPageData:function(){this._renderPaginator();var e=this.subViewHelper.get(T.TABLE_VIEW);if(e){if(this.groupModel){var t=this.queryModel.getCurrentPage(this.groupModel);e.updateDataSource(t)}else e.updateDataSource([]);e.onDataChange()}},onSearch:function(e){if(e.keyCode===$.ui.keyCode.ENTER){var t=$(e.currentTarget).val().trim(),i=this.perspective.getPrimaryAttribute(),n=this.queryModel.get(this.queryModel.DP.FILTER_EXPR);t.length?d.addFilterCondition(n,i,d.createFilterCondition(i,i,l.FILTER_OPERATORS.CONTAINS,t)):delete n[i],this._performQuery()}},onExport:function(e){this.subViewHelper.get(T.TABLE_VIEW).onExport(e)},onStartServices:function(){var e=this.subViewHelper.get(T.TABLE_VIEW);e&&e.startServices(),this.loadData(),this.enablePolling&&this.subModelHelper.get("CallbackPollingModel").startPolling()},onStopServices:function(){var e=this.subViewHelper.get(T.TABLE_VIEW);e&&e.stopServices(),this.enablePolling&&this.subModelHelper.get("CallbackPollingModel").stopPolling()}})}),define("views/details/tabs/TableTabContentDetailsView",["views/basecomponents/details/tabs/BaseTabContentDetailsView","managers/NavigationManager","views/details/tabs/components/TabDetailsPaginateTableView","views/details/tabs/EBEntityTableView","data/DataURLConstants","data/DataProperties","managers/ClusterManager","utils/AppConstants","utils/AppUtil","utils/AlertUtil","utils/FilterUtil"],function(e,t,i,n,s,a,r,o,l,c,u){"use strict";return e.extend({extraClassName:"n-table-tab-content-details",tableView:null,pageId:null,events:{"click     a.pageLink":"onPageLinkClick"},initializeProperties:function(e){this.pageId=e.pageId;var t=this.getTableOptions(e.tabId);this.isUsingEBTableView()?this.isEmptyQuery()?this.tableView=null:(this.tableView=new n(t),this.setDefaultFilters(this.tableEntityType)):(this.tableView=new i(t),e.pageId&&this.tableView.setFilterURL(s.getFilterUrlByPageId(e.pageId)))},render:function(){return _.isNull(this.tableView)||this.$el.append(this.tableView.render().el),this},destroy:function(){l.debug("TableTabContentDetailsView : destroy: "," | viewid     : "+this.cid),this.tableView&&this.tableView.destroy(),e.prototype.destroy.apply(this,arguments)},postSetModelId:function(e){if(this.tableView&&this.tableView.model&&l.isValidId(e)){var t,i,n;t=Object.getPrototypeOf(this.tableView.model).url,i=s.getEntityTypeURL(this.entityType),this.isUsingEBTableView()&&i===s.CLUSTER&&(i=s.CLUSTERS),n=this.pageId===o.PAGE_FILE_SERVER?t+_.template(s.FS_ALERT_EVENT)({etype:this.entityType,eid:e}):i+"/"+e+"/"+t,this.tableView.setModelURL(n),this.tableView.refreshData()}else this.tableView&&this.tableView.queryModel&&l.isValidId(e)&&this.setEntityIdFilter(e)},onStartServices:function(){this.tableView&&this.tableView.startServices(),this.delegateEvents()},onStopServices:function(){this.tableView&&this.tableView.stopServices(),this.undelegateEvents()},onPageLinkClick:function(e){t.navigateToPageByPageLink(e.currentTarget)},getTableOptions:function(e){var t=!0,i=!1,n=o.DEFAULT_PERSPECTIVE;switch(e){case o.TAB_DETAILS.EVENTS:this.tableEntityType=o.ENTITY_EVENT,t=!1,i=!0;break;case o.TAB_DETAILS.PLAYBOOK_RESULTS:this.tableEntityType=o.ENTITY_PLAYBOOK_RESULT,t=!1,i=!0,n=o.COMMON_PERSPECTIVE}if(!this.tableEntityType)throw new Error("Entity type for the tab table is invalid.");return this.isUsingEBTableView()?{entityType:this.tableEntityType,disableSearchHeader:!0,disableCheckBox:!0,showExport:!0,ebTableStyle:!0,defaultPageSize:20,defaultMinRows:20,perspectiveName:n,enableDefaultTableFilter:t,enableEntityDetails:i}:{entityType:this.tableEntityType,pageId:this.pageId,enableDefaultTableFilter:t}},setEntityIdFilter:function(e){if(!_.isNull(this.tableView)){var t={};switch(this.tableEntityType){case o.ENTITY_EVENT:t=c.setEntityFilter(t,this.entityType,e,this.tableEntityType),this.tableView.appendFilterCriteria(t);break;case o.ENTITY_PLAYBOOK_RESULT:t=u.addFilterCondition(t,a.PLAYBOOK_UUID,u.createFilterCondition(this.tableEntityType,a.PLAYBOOK_UUID,o.FILTER_OPERATORS.EQUALS,e)),this.tableView.appendFilterCriteria(t)}}},setDefaultFilters:function(){_.isNull(this.tableView)},isEmptyQuery:function(){return!1},isUsingEBTableView:function(){return r.isMulticlusterNavMode()}})}),define("views/details/tabs/AlertTableTabContentDetailsView",["views/details/tabs/TableTabContentDetailsView","data/DataProperties","data/DataURLConstants","events/AppEvents","utils/AppConstants","utils/AppUtil","utils/AlertUtil"],function(e,t,i,n,s,a,r){"use strict";return e.extend({events:{"mouseover a.n-alert-doc-link":"onAlertDocLinkMouseOver","mouseout  a.n-alert-doc-link":"onAlertDocLinkMouseOut"},initialize:function(){e.prototype.initialize.apply(this,arguments),_.bindAll(this,"onEntityEvent")},render:function(){return e.prototype.render.apply(this,arguments),this.isUsingEBTableView()||this.tableView.entityType!==s.ENTITY_ALERT||this.tableView.setActionViewOptions({entityType:i.getFilterUrlByPageId(this.pageId)}),this},postSetModelId:function(t){this.tableView&&this.tableView.model&&a.isValidId(t)&&this.tableView.entityType===s.ENTITY_ALERT&&this.tableView.setActionViewOptions({entityType:this.entityType,entityId:t}),e.prototype.postSetModelId.apply(this,arguments)},onStartServices:function(){e.prototype.onStartServices.apply(this,arguments),n.onAppEvent(n.ENTITIES_UPDATED,this.onEntityEvent)},onStopServices:function(){e.prototype.onStopServices.apply(this,arguments),n.offAppEvent(n.ENTITIES_UPDATED,this.onEntityEvent)},onEntityEvent:function(e,t){this.isUsingEBTableView()&&this.tableView&&t.entityType===s.ENTITY_ALERT&&this.tableView.refreshCurrentPage()},onAlertDocLinkMouseOver:function(e){var i=$(e.currentTarget),n=t.ALERT_CAUSES;i.hasClass(t.ALERT_RESOLUTIONS)&&(n=t.ALERT_RESOLUTIONS);var s=i.attr("data-id"),a=i.attr("data-severity"),o=i.attr("data-uuid"),l=r.createTooltip(s,n,a,o);null!==l&&(i.tooltip({title:l,placement:"top",trigger:"manual",html:!0}),i.tooltip("show"))},onAlertDocLinkMouseOut:function(e){$(e.currentTarget).tooltip("destroy")},getTableOptions:function(t){this.tableEntityType=s.ENTITY_ALERT;var i=e.prototype.getTableOptions.apply(this,arguments);return i.entityType=this.tableEntityType,i.enableDefaultTableFilter=!1,this.isUsingEBTableView()&&(i.disableCheckBox=!1,i.enableEntityDetails=!0),i},setEntityIdFilter:function(e){var t={};t=r.setEntityFilter(t,this.entityType,e),this.tableView.appendFilterCriteria(t)},setDefaultFilters:function(){var e={};e=r.setAlertResolvedFilter(e,!1),this.tableView.appendFilterCriteria(e)}})}),define("views/details/tabs/GpuVmsTableTabContentDetailsView",["views/details/tabs/TableTabContentDetailsView","data/DataProperties","utils/AppConstants","utils/CommonTemplates"],function(e,t,i,n){"use strict";return e.extend({name:"GpuVmsTableTabContentDetailsView",initOptions:null,initializeProperties:function(t){this.initOptions=t,e.prototype.initializeProperties.apply(this,arguments)},render:function(t){if(!this.isLoading()||t&&t.forceNotLoading){if(!this.isEmptyQuery())return e.prototype.render.apply(this,arguments);this.$el.append(this.i18n("no_vms_allocated"))}else this.$el.append(n.LOADING_MSG(this.vtOptions({msg:this.i18n("loading")})));return this},onStartServices:function(){e.prototype.onStartServices.apply(this,arguments),this.currentModel&&this.currentModel.on("change",this.onReloadAfterModelHasFetched,this)},onStopServices:function(){e.prototype.onStopServices.apply(this,arguments),this.currentModel&&this.currentModel.off("change",this.onReloadAfterModelHasFetched,this)},onReloadAfterModelHasFetched:function(){this.onStopServices(),this.initializeProperties(this.initOptions),this.$el.empty(),this.onStartServices(),this.render({forceNotLoading:!0})},isEmptyQuery:function(){if(this.currentModel){var e=this.currentModel.getVmsAllocated();return _.isUndefined(e)}return!0},getTableOptions:function(n){this.tableEntityType=i.ENTITY_VM;var s=e.prototype.getTableOptions.apply(this,arguments);if(_.extend(s,{enableDefaultTableFilter:!0}),this.isUsingEBTableView()&&(_.extend(s,{enableEntityDetails:!0}),this.currentModel)){var a=this.currentModel.getVmsAllocated();this.isEmptyQuery()||(s[t.EB.ENTITY_IDS]=a,s.perspectiveName=t.EB.VM_GPU_PERSPECTIVE)}return s},isLoading:function(){return this.currentModel&&this.currentModel.getState()!==i.STATE_SUCCESS}})}),define("models/capacityplanning/CPSharedModel",["models/query/BaseQueryModel"],function(e){"use strict";var t={SELECTED_METRIC:"selectedMetric",SELECTED_METRIC_RUNWAY_VAL:"selectedMetricRunwayVal",CURRENT_MAX_CHART_YVAL:"currentMaxChartYVal",STORAGE_START_TIME:"storageStartTime",CURRENT_MAX_CHART_YVAL_REASON:"currentMaxChartYValReason",NO_PREDICTION_REASON:"noPredictionReason"};return e.extend({name:"CPSharedModel",DP:t})}),define("models/capacityplanning/CPAlertQueryModel",["utils/AppConstants","utils/AlertUtil","data/DataProperties","models/query/BaseQueryModel"],function(e,t,i,n){"use strict";return n.extend({name:"CPAlertQueryModel",initialize:function(e,t){n.prototype.initialize.apply(this,arguments),this.initializeQueryAttributes(e)},initializeQueryAttributes:function(e){if(!e||!e.currentClusterUUID)throw new Error("Specify attributes and currentClusterUUID in attributes");this.setAttributesForQuery(e)},setQueryOptions:function(e){},setDefaultGroupByTimeInterval:function(){},setStartTime:function(e){var i=this.get(this.DP.FILTER_EXPR)||{};i=t.setTimeRangeFilter(i,e),this.set(this.DP.FILTER_EXPR,i)},setAttributesForQuery:function(n){this.set(this.DP.ENTITY_TYPE,e.ENTITY_ALERT),this.set(this.DP.GROUP_MEMBER_SORT_ORDER,e.SORT_DESCENDING),this.set(this.DP.GROUPING_ATTR,i.CP.CATEGORY),this.setGroupMemberAttributesList([i.ALERT_TITLE_V3,i.ALERT_DEFAULT_MSG,i.ALERT_SEVERITY,i.ALERT_PARAM_NAMES,i.ALERT_PARAM_VALUES,i.ALERT_IMPACT_TYPE,i.EB.CLUSTER_UUID,i.ALERT_SOURCE_ENTITY_ID]);var s={};s=t.setTimeRangeFilter(s,Date.now()-90*e.MILLIS_PER_DAY),s=t.setAlertImpactTypeFilter(s,e.ALERT_IMPACT_TYPES.Capacity[0]),s=t.setAlertResolvedFilter(s,"false"),s=t.setClusterFilter(s,n.currentClusterUUID),this.set(this.DP.FILTER_EXPR,s)}})}),define("models/capacityplanning/CPEventQueryModel",["utils/AppConstants","utils/AlertUtil","data/DataProperties","models/query/BaseQueryModel"],function(e,t,i,n){"use strict";return n.extend({name:"CPEventQueryModel",initialize:function(e,t){n.prototype.initialize.apply(this,arguments),this.initializeQueryAttributes(e)},initializeQueryAttributes:function(e){if(!e||!e.currentClusterUUID)throw new Error("Specify attributes and currentClusterUUID in attributes");this.setAttributesForQuery(e)},setQueryOptions:function(e){},setDefaultGroupByTimeInterval:function(){},setStartTime:function(e){var i=this.get(this.DP.FILTER_EXPR)||{};i=t.setTimeRangeFilter(i,e),this.set(this.DP.FILTER_EXPR,i)},setAttributesForQuery:function(n){this.set(this.DP.ENTITY_TYPE,e.ENTITY_ALERT),this.set(this.DP.GROUP_MEMBER_SORT_ORDER,e.SORT_DESCENDING),this.setGroupMemberAttributesList([i.ALERT_TITLE_V3,i.ALERT_DEFAULT_MSG,i.ALERT_SEVERITY,i.ALERT_PARAM_NAMES,i.ALERT_PARAM_VALUES,i.EB.CLUSTER_UUID,i.ALERT_SOURCE_ENTITY_ID]);var s={};s=t.setTimeRangeFilter(s,Date.now()-90*e.MILLIS_PER_DAY),s=t.setAlertSeverityFilter(s,i.CP.ALERT.AUDIT),s=t.setClusterFilter(s,n.currentClusterUUID),this.set(this.DP.FILTER_EXPR,s)}})}),define("models/capacityplanning/CPWhatIfWrapperModel",["models/BaseModel","data/DataURLConstants","managers/NotificationManager","utils/AppConstants","utils/AppUtil"],function(e,t,i,n,s){"use strict";return e.extend({name:"CPWhatIfWrapperModel",urlRoot:t.CAPACITY_WHAT_IF,notificationId:null,showLatencyNotification:function(e,t){this.notificationId=i.showLatencyMessage("Creating estimate")},showSuccessNotification:function(e,t,n){i.hideLatencyMessage(this.notificationId)},showErrorNotification:function(e,t,a){var r=s.processAjaxError(a.responseText);i.hideLatencyMessage(this.notificationId),i.showClientNotification(n.NOTIFY_ERROR,r)}})}),define("text!templates/basecomponents/details/CapacityPlanning/CPRunwayInDaysTemplate.html",[],function(){return'<div class="control-group">\n  <div class="clusterRunway">\n    <label class="control-label">\n      <a class="hide cluster-runway-back">\n        <%= SVG.SVGIcon(\'caret-left\', \'-inline -micro\') %>\n        <%= i18n(\'back\') %>\n      </a>\n      <%= i18ns(\'cluster_runway\', data.clusterName)  %>\n    </label>\n    <span class="controls">\n      <%= data.clusterVal %>\n    </span>\n  </div>\n  <ul class="nav">\n    <li class="each-param storageOption"\n      data-max-y-val="<%= data.sMaxVal %>"\n      data-first-click="true"\n      action="showEntityChart"\n      actionTargetId="storage"\n      actionSelectedEntityId="<%= data.storageId %>"\n      actionEntityType="<%= data.storageEntityType %>">\n      <div class="alert-icon hidden"></div>\n      <div class="control-label">\n        <%= storageRunwayText %>\n      </div>\n      <div class="controls">\n        <span class="runwayValHolder">\n          <%= data.sVal %>\n        </span>\n        <span class="icon"></span>\n        <span class="plus"></span>\n      </div>\n    </li>\n    <li class="each-param cpuOption"\n      data-max-y-val="<%= data.cMaxVal %>"\n      data-first-click="true"\n      action="showEntityChart"\n      actionTargetId="cpu"\n      actionEntityType="<%= data.cpuEntityType %>"\n      actionSelectedEntityId="<%= data.cpuId %>">\n      <span class="alert-icon hidden"></span>\n      <label class="control-label">\n        <%= cpuRunwayText %>\n      </label>\n      <span class="controls">\n        <span class="runwayValHolder">\n          <%= data.cpuVal %>\n        </span>\n        <span class="icon"></span>\n        <span class="plus"></span>\n      </span>\n    </li>\n    <li class="each-param memoryOption"\n      data-max-y-val="<%= data.mMaxVal %>"\n      data-first-click="true"\n      action="showEntityChart"\n      actionTargetId="memory"\n      actionEntityType="<%= data.memoryEntityType %>"\n      actionSelectedEntityId="<%= data.memoryId %>">\n      <span class="alert-icon hidden"></span>\n      <label class="control-label">\n        <%= memoryRunwayText %>\n      </label>\n      <span class="controls">\n        <span class="runwayValHolder">\n          <%= data.mVal %>\n        </span>\n        <span class="icon"></span>\n        <span class="plus"></span>\n      </span>\n    </li>\n  </ul>\n</div>\n'}),define("views/details/tabs/CPRunwaySubview",["views/basecomponents/BaseSubView","models/capacityplanning/CPQueryModel","utils/AppUtil","utils/AppConstants","utils/SVG","data/DataProperties","text!templates/basecomponents/details/CapacityPlanning/CPRunwayInDaysTemplate.html"],function(e,t,i,n,s,a,r){"use strict";var o=_.template(r);_.template('<span class="metric"> <% if (noOfDays === 1) { %>day<% } else { %>days<% } %></span>');return e.extend({name:"CPRunwaySubview",currentClusterUUID:null,whatKindOfAlert:null,alertBecauseOfContainer:null,alertBecauseOfCPUNode:null,alertBecauseOfMemNode:null,runwayInfoQueryModel:null,cpAlertModel:null,readyFlag:null,modelEvents:{"reset cpAlertModel":"onAlertsChange","error cpAlertModel":"onAlertsChange"},events:{"click .each-param":"onClickLinkAction","click .cluster-runway-back":"onClickBack"},initialize:function(t){if(!t||!t.parentView||!t.runwayInfoQueryModel)throw new Error("Specify options & the following properties in options : parentView, runwayInfoQueryModel");t.clusterId&&(this.currentClusterUUID=t.clusterId),this.parentView=t.parentView,this.cpAlertModel=t.cpAlertModel,this.shortTitle=t.shortTitle||!1,this.runwayInfoQueryModel=t.runwayInfoQueryModel,this.sharedModel=t.sharedModel,_.bindAll(this,"showModelError"),this.delegateModelEvents(),e.prototype.initialize.apply(this,arguments)},destroy:function(){this.undelegateModelEvents(),this.destroyTooltips(),e.prototype.destroy.apply(this,arguments)},render:function(){this.$el.html('<div class="summary-in-days"></div>')},hideView:function(t){e.prototype.hideView.apply(this,arguments)},showView:function(){e.prototype.showView.apply(this,arguments)},setModelId:function(e){this.currentClusterUUID=e},renderRunwayDetails:function(){var e={},t=this;e.sMaxVal=0,e.cMaxVal=0,e.mMaxVal=0;var i,r,o,l,c,u,d,h=this.runwayInfoQueryModel.getQueryResultAttributes(),p=this.cpQueryModel.getQueryResultAttributes();if(p&&p[0])var T=p[0][a.CP_MEMORY_IN_GB];_.each(h,function(h){e={},e.sMaxVal=0,e.cMaxVal=0,e.mMaxVal=0,e.storageEntityType=n.ENTITY_CLUSTER,e.cpuEntityType=n.ENTITY_CLUSTER,e.memoryEntityType=n.ENTITY_CLUSTER,e.storageId=h.id,e.cpuId=h.id,e.memoryId=h.id,r=n.STATS_NOT_APPLICABLE,o=n.STATS_NOT_APPLICABLE,l=n.STATS_NOT_APPLICABLE,d=n.STATS_NOT_APPLICABLE;var p=this.runwayInfoQueryModel.parseRunwayInfo(h,a.CLUSTER_STORAGE_RUNWAY_INFO);p&&((p[a.CP.RUNWAY]||_.isNumber(p[a.CP.RUNWAY]))&&(this._isNanVal(p[a.CP.RUNWAY])||(r=p[a.CP.RUNWAY])),p[a.CP.ENTITY_TYPE]&&(e.storageEntityType=p[a.CP.ENTITY_TYPE]),p[a.CP.ENTITY_ID]&&(e.storageId=p[a.CP.ENTITY_ID]));var E=this.runwayInfoQueryModel.parseRunwayInfo(h,a.CLUSTER_CPU_RUNWAY_INFO);E&&((E[a.CP.RUNWAY]||_.isNumber(E[a.CP.RUNWAY]))&&(this._isNanVal(E[a.CP.RUNWAY])||(o=E[a.CP.RUNWAY])),E[a.CP.ENTITY_TYPE]&&(e.cpuEntityType=E[a.CP.ENTITY_TYPE]),E[a.CP.ENTITY_ID]&&(e.cpuId=E[a.CP.ENTITY_ID]));var S=this.runwayInfoQueryModel.parseRunwayInfo(h,a.CLUSTER_MEMORY_RUNWAY_INFO);S&&((S[a.CP.RUNWAY]||_.isNumber(S[a.CP.RUNWAY]))&&(this._isNanVal(S[a.CP.RUNWAY])||(l=S[a.CP.RUNWAY])),S[a.CP.ENTITY_TYPE]&&(e.memoryEntityType=S[a.CP.ENTITY_TYPE]),S[a.CP.ENTITY_ID]&&(e.memoryId=S[a.CP.ENTITY_ID])),e.sVal=t._appendUnits(r),e.mVal=t._appendUnits(l),e.cpuVal=t._appendUnits(o),this.currentSelectedEntitySVal=e.sVal,this.currentSelectedEntityCVal=e.cpuVal,this.currentSelectedEntityMVal=e.mVal;var g=this.runwayInfoQueryModel.parseRunwayInfo(h,a.CLUSTER_RUNWAY_INFO);if(g&&(g[a.CP.RUNWAY]||_.isNumber(g[a.CP.RUNWAY]))?this._isNanVal(g[a.CP.RUNWAY])||(d=g[a.CP.RUNWAY]):h[a.CLUSTER_RUNWAY]&&_.isNumber(parseInt(h[a.CLUSTER_RUNWAY][0],10))?this._isNanVal(h[a.CLUSTER_RUNWAY][0])||(d=parseInt(h[a.CLUSTER_RUNWAY][0],10)):d=n.STATS_NOT_APPLICABLE,e.clusterVal=t._appendUnits(d),c=a.STORAGE_RUNWAY,h[a.CP_STORAGE_IN_TB]&&(u=h[a.CP_STORAGE_IN_TB][0]),h[a.CP_STORAGE_START_TIME]&&(i=parseInt(h[a.CP_STORAGE_START_TIME][0],0)),this.setParentProperties(c,u,i),e.cMaxVal=h[a.CP_CPU_IN_GHZ]?parseFloat(h[a.CP_CPU_IN_GHZ][0]):0,e.mMaxVal=T?parseFloat(T):0,e.sMaxVal=h[a.CP_STORAGE_IN_TB]?parseFloat(h[a.CP_STORAGE_IN_TB][0]):0,e.clusterName=this.clusterManager.getClusterCollection().findModelByUuid(this.currentClusterUUID).get(a.NAME),this.renderRunwayTemplate(e),this.createRunwayReasonTooltip(h),this.$(".each-param > .controls > .icon").append(s.SVGIcon("y")),this.readyFlag=h[a.CP_READY_FLAG_INSIGHTS]?parseInt(h[a.CP_READY_FLAG_INSIGHTS][0],10):0,this.readyFlag&&!isNaN(this.readyFlag)){var A=(this.runwayInfoQueryModel.DP,[a.STORAGE_RUNWAY_INFO,a.CPU_RUNWAY_INFO,a.MEMORY_RUNWAY_INFO]),m=[a.CPU_MAX_RUNWAY,a.STORAGE_MAX_RUNWAY,a.MEMORY_MAX_RUNWAY],f={};f=_.extend(f,this.getRunwayValues(A,h)),f=_.extend(f,this.getMaxRunwayValues(m,h)),this.parentView.setClusterRunwayVals(f)}this.$("."+this.sharedModel.get(this.sharedModel.DP.SELECTED_METRIC)+"Option").trigger("click")},this),h.length||(e={},e.sMaxVal=0,e.cMaxVal=0,e.mMaxVal=0,e.sVal=n.STATS_NOT_APPLICABLE,e.mVal=n.STATS_NOT_APPLICABLE,e.cpuVal=n.STATS_NOT_APPLICABLE,e.id=n.STATS_NOT_APPLICABLE,e.storageId=n.STATS_NOT_APPLICABLE,e.storageEntityType=n.STATS_NOT_APPLICABLE,e.cpuEntityType=n.STATS_NOT_APPLICABLE,e.cpuId=n.STATS_NOT_APPLICABLE,e.memoryEntityType=n.STATS_NOT_APPLICABLE,e.memoryId=n.STATS_NOT_APPLICABLE,e.clusterName=this.clusterManager.getClusterCollection().findModelByUuid(this.currentClusterUUID).get(a.NAME),e.clusterVal=n.STATS_NOT_APPLICABLE,this.renderRunwayTemplate(e),this.parentView.trigger("cpDataNotReady",{isNotReady:!0}),$(".right-section").hide())},getRunwayValues:function(e,t){var s={accuracy:{}};return _.each(e,function(e){var a=this.runwayInfoQueryModel.parseRunwayInfo(t,e);a?(s[e]=i.processRunwayNumber(a.runway),s.accuracy[e]=a.accurate_len):s[e]=n.STATS_NOT_APPLICABLE},this),s},getMaxRunwayValues:function(e,t){var i={};return _.each(e,function(e){t[e]&&t[e].length?i[e]=t[e][0]:i[e]=n.STATS_NOT_APPLICABLE},this),i},renderRunwayTemplate:function(e){var t=this.shortTitle?"_short":"";this.$(".summary-in-days").html(o(this.vtOptions({data:e,storageRunwayText:this.i18n("storage_runway"+t),cpuRunwayText:this.i18n("cpu_runway"+t),memoryRunwayText:this.i18n("memory_runway"+t)})))},setParentProperties:function(e,t,i){this.sharedModel.set(this.sharedModel.DP.SELECTED_METRIC,e),this.sharedModel.set(this.sharedModel.DP.CURRENT_MAX_CHART_YVAL,t),this.sharedModel.set(this.sharedModel.DP.STORAGE_START_TIME,i)},createRunwayReasonTooltip:function(e){this.destroyTooltips();var t=this;this.$(".each-param").tooltip({title:function(){return t.toolTipContent.call(t,this,e)},placement:"top",trigger:"hover",animation:!1,html:!0,delay:{show:500,hide:100},container:$("body")})},toolTipContent:function(e,t){var i;return(i=$(e).attr("actionTargetId")===a.STORAGE_RUNWAY?this.runwayInfoQueryModel.parseRunwayInfo(t,a.CLUSTER_STORAGE_RUNWAY_INFO):$(e).attr("actionTargetId")===a.CPU_RUNWAY?this.runwayInfoQueryModel.parseRunwayInfo(t,a.CLUSTER_CPU_RUNWAY_INFO):this.runwayInfoQueryModel.parseRunwayInfo(t,a.CLUSTER_MEMORY_RUNWAY_INFO))&&i.reason||""},destroyTooltips:function(){this.$(".each-param").tooltip("destroy")},onClickLinkAction:function(e){var t,i="showEntityChart"===$(e.currentTarget).attr("action"),n=$(e.currentTarget).attr("actionTargetId");if(this.$(".each-param").removeClass("selectedRunwayMetric selected"),$(e.currentTarget).addClass("selectedRunwayMetric selected"),i)t=this.parentView.getClusterRunwayVals(n);else switch(n){case a.STORAGE_RUNWAY:t=this.currentSelectedEntitySVal;break;case a.CPU_RUNWAY:t=this.currentSelectedEntityCVal;break;case a.MEMORY_RUNWAY:t=this.currentSelectedEntityMVal}this.sharedModel.set(this.sharedModel.DP.SELECTED_METRIC_RUNWAY_VAL,t),this.sharedModel.set(this.sharedModel.DP.CURRENT_MAX_CHART_YVAL,parseFloat($(e.currentTarget).attr("data-max-y-val"))),this.parentView.refreshSubView($(e.currentTarget).attr("actionTargetId"))},onAlertsChange:function(e){var s=this;this.whatKindOfAlert=!1,e&&_.each(e.models,function(e,t){s.whatKindOfAlert=!1;var i=e.get(a.ALERT_IMPACT_TYPE);_.contains(i,a.CP.ALERT.STORAGE_CAPACITY)?s.whatKindOfAlert=a.STORAGE_RUNWAY:_.contains(i,a.CP.ALERT.CPU_CAPACITY)?s.whatKindOfAlert=a.CPU_RUNWAY:_.contains(i,a.CP.ALERT.MEMORY_CAPACITY)&&(s.whatKindOfAlert=a.MEMORY_RUNWAY)});var r=[this.currentClusterUUID],o=this,l=[];this.runwayInfoQueryModel.set(a.CP.ENTITY_IDS,r),l.push(this.runwayInfoQueryModel.save(null));var c={entity_type:n.ENTITY_CLUSTER,group_member_attributes:[a.CP_MEMORY_IN_GB],entity_ids:[this.currentClusterUUID]};this.cpQueryModel=new t(c),l.push(this.cpQueryModel.save(null)),$.when.apply($,l).done(function(){o.renderRunwayDetails()}).fail(function(){i.log("Error in fetching runway info"),o.renderRunwayDetails()})},onClickBack:function(e){window.history.back()},_appendUnits:function(e,t){return t?e!==n.STATS_NOT_APPLICABLE?"1"===e?e+'<span class="days"> day</span>':e+'<span class="days"> days</span>':e:e!==n.STATS_NOT_APPLICABLE?"1"===e?e+" day":e+"  days":e},_isNanVal:function(e){return!(!_.isString(e)||"nan"!==e.toLowerCase())}})}),define("text!templates/basecomponents/details/CapacityPlanning/CPChartView.html",[],function(){return'<div class="chart-content chart-size-s"></div>\n'}),define("views/details/tabs/CPChartView",["d3","nvd3","d3tip","components/Components","views/basecomponents/charts/BaseChartView","views/basecomponents/datatables/DataTableTemplates","views/basecomponents/charts/ChartTemplates","models/capacityplanning/CPStatsModel","utils/AppConstants","utils/AppUtil","utils/AntiscrollUtil","utils/AlertUtil","utils/CommonTemplates","utils/D3Util","utils/StatsUtil","utils/StyleDescriptor","data/DataProperties","managers/NavigationManager","text!templates/basecomponents/details/CapacityPlanning/CPChartView.html"],function(e,t,i,n,s,a,r,o,l,c,u,d,h,p,T,E,S,g,A){"use strict";var m=_.template('<% _.each(details, function(opt) { %><div class="alertTooltip alert-tooltip <%= opt.classname %>" data-alert-id="<%= opt.id %>"><% if (opt.severity) { %><div class="severity -<%= opt.severity %>"><div class="indicator"></div><%= opt.severity %></div><% } %><div class="<%= opt.classname %> message"><%= opt.message %></div><div class="timeStamp time-stamp"> <%= opt.timeStamp %> </div><% if (opt.severity) { %><%= Components.icon("y", "-down-arrow") %><% } %></div><% }) %>'),f='<div class="prediction"><div class = "no-prediction-avail">Why can\'t I see the prediction?<a class="n-button-help btn -default">i</a></div></div>',I=_.template('<p><%= i18n("no_prediction_title") %></p><p class="reason"><%= reason %></p>'),C={top:15,left:40},v={SHOW_CURRENT_DATE:"CURRENTDATELINE",SHOW_RUNWAY_DATE:"RUNWAYDATELINE",SHOW_ALERT:"ALERTLINE",SHOW_EVENT:"EVENTLINE",SHOW_RUNWAY_REMAINING:"RUNWAYREMAINLINE",SHOW_RUNWAY_LEFT:"RUNWAYLEFT",SHOW_EFFECTIVE_CAPACITY:"NODEFAILURE"},R={CLUSTER:"cluster",CONTAINER:"Container",NODE:"node"},N=l.CP_METRIC_UNIQUE_ID_MAP,P={INDIVIDUAL:"Individual",OVERVIEW:"Overview",OTHERS:"Others",FUTURE:"Future",USAGE:"usage",BYTES:"bytes",PREDICT:"predict"},O={PREDICTION:"prediction",CAPACITY:"capacity"},y={THOUSAND:1e3,RUNWAY_DAYS:90},D=[S.CP_STORAGE_SYSTEM_USAGE,S.CP_STORAGE_LIVE_USAGE,S.CP_RESERVED_USAGE,S.CP_SSHOT_RECLAIM_BYTES,S.CP_STORAGE_NO_RESERVATION,S.CP_STORAGE_USAGE,S.CP_LIVE_USAGE,S.CP_SNAPSHOT_USAGE,S.CP_RESERVED_FREE_USAGE,S.CP_SYSTEM_USAGE],M=[S.CP_SYSTEM_PREDICT_USAGE,S.CP_LIVE_PREDICT_USAGE,S.CP_RESERVED_PREDICT_USAGE,S.CP_SSHOT_RECLAIM_PREDICT_BYTES,S.CP_STORAGE_PREDICT_USAGE,S.CP_LIVE_STORAGE_USAGE_PREDICT,S.CP_SNAPSHOT_STORAGE_USAGE_PREDICT,S.CP_RESERVED_FREE_STORAGE_USAGE_PREDICT],b={storage:"is_storage",cpu:"is_cpu",memory:"is_memory"};return s.extend({template:_.template(A),tickDiffInMilliseconds:null,ticks_map:null,currentRunwayLeft:null,chartMaxYVal:null,CHART_MARGINS:C,selectedParam:null,parentView:null,cpAlertModel:null,cpEventModel:null,typeOfChart:null,skipRunwayCheck:!1,whatKindOfAlert:null,severityOfAlert:null,specialRightMarginVal:null,name:"CPChartView",initialize:function(e){var t=this;if(s.prototype.initialize.apply(this,arguments),!e||!e.parentView)throw new Error("Specify options & the following properties in options : parentView");this.parentView=e.parentView,this.cpAlertModel=e.cpAlertModel,this.cpEventModel=e.cpEventModel,this.sharedModel=e.sharedModel,this.tickDiffInMilliseconds=0,this.ticks_map={},this.parentView.on("cpDataErrorOccurred",function(e){t.noDataAvailableView(e)}),this.parentView.on("cpDataNotReady",function(e){t.noDataAvailableView(e)}),this.parentView.on("cpDataLoading",function(){t.clearOldChartAddLoader()}),_.bindAll(this,"onResize"),this.severityOfAlert={storage:[],cpu:[],memory:[]}},fetchOnDemand:function(){this._fetchAlertsAndEvents(),this.parentView.trigger("cpDataLoading")},setModelId:function(e){this.currentClusterUUID=e},render:function(){this.$el.html(this.template)},onStartServices:function(){$(window).on("resize",this.onResize)},onStopServices:function(){$(window).off("resize",this.onResize)},destroy:function(){c.debug("CPChartView : destroy: "," | viewid     : "+this.cid),this.clearTooltips(),this.parentView.off("cpDataErrorOccurred"),this.parentView.off("cpDataLoading"),$(window).off("resize",this.onResize),$(document).off("click",this.onDocumentClick),s.prototype.destroy.apply(this,arguments)},onResize:_.debounce(function(){this.currentChartData&&this.renderChart(this.currentChartData)},200),getParsedCurrentRunwayLeft:function(){if(!this.currentRunwayLeft)return null;var e=this.currentRunwayLeft.match(/^\d+/);return null===e||isNaN(e[0])?null:Number(e[0])},updateSomeChartProperties:function(e,t,i,n){this.currentRunwayLeft=e,this.chartMaxYVal=t,this.selectedParam=i,this.chartMaxReason=n,this.specialRightMarginVal=0},updateAnalysisContext:function(e,t){var i=this;this.currentChartData=null;var n=[],s=[],a=Date.now();this.currentSelectedEntityType=e.selectedEntityType,this.typeOfChart=e.chartType,this.currentSelectedEntityId=null,e&&e.selectedMetric&&null===this.getParsedCurrentRunwayLeft()&&delete e.selectedMetric.future,e.selectedEntityIds.others.length>1?this.subEntitiesLen=e.selectedEntityIds.others.length:1===e.selectedEntityIds.others.length&&this.typeOfChart===P.INDIVIDUAL&&(this.currentSelectedEntityId=e.selectedEntityIds.others[0]),_.each(e.selectedMetric,function(i,r){var c,u,d;this.isSingleEntityChart=!1;_.each(e.selectedEntityIds,function(h,p){if(h.length){r===P.FUTURE.toLowerCase()?(c=a+1*l.MILLIS_PER_DAY,(u=this.getTimeRangeMax(t))||(c=a,u=a)):(c=this.getTimeRangeMin(t),u=a);var _=e.selectedEntityType.toLowerCase();if(e.chartType===P.INDIVIDUAL){var T=S.AGGREGATORS.AVERAGE;d=new o,d.setTimeInterval(c,u,l.SAMPLING_INTERVAL_IN_SECS_FOR_A_DAY),d.setGroupsStats(h,_,i,R.CLUSTER,null,T),this.isSingleEntityChart=!0,s.push(d),n.push(d.performQuery())}else p===P.OTHERS.toLowerCase()?(d=new o,d.setTimeInterval(c,u,l.SAMPLING_INTERVAL_IN_SECS_FOR_A_DAY),d.setGroupsStats(h,_,i,R.CLUSTER,null,S.AGGREGATORS.SUM),s.push(d),n.push(d.performQuery())):h.forEach(function(e){d=new o,d.setTimeInterval(c,u,l.SAMPLING_INTERVAL_IN_SECS_FOR_A_DAY),d.setGroupsStats([e],_,i,R.CLUSTER,null,S.AGGREGATORS.SUM),s.push(d),n.push(d.performQuery())})}},this)},this),$.when.apply($,n).done(function(){var e=i.getChartData(s);i.renderChart(e)}).fail(function(){c.log("Error in loading capacity chart data"),i.parentView.trigger("cpDataErrorOccurred",{isError:!0})})},clearOldChartAddLoader:function(){this.$(".chart-content").empty(),this.$(".chart-content").append(a.LOADING)},getChartData:function(e){var t,i=[],n=[],s=[],a={};this.longestHistoricDataLengthSubEntities=0;for(var r=0;r<e.length;r++){var o=e[r].getQueryResults();i.push(o)}for(r=0;r<i.length;r++)for(var c=i[r].models,u=0;u<c.length;u++)for(var d in c[u].attributes)this.getCurrentSelectedParam()!==S.STORAGE_RUNWAY?d!==S.ID&&d.indexOf(P.USAGE)>-1&&d!==S.NAME&&(this.isSingleEntityChart?t=N[d]:(c[u].get(S.ID)?(t=this.parentView.getSubEntityName(c[u].get(S.ID)))&&t!==l.STATS_NOT_AVAILABLE||(t=c[u].get(S.ID)):t=P.OTHERS+"( "+this.subEntitiesLen+" Hosts )",d.indexOf(P.PREDICT)>-1?s=e[r].processStats(c[u].get(d),!1):(this.longestHistoricDataLengthSubEntities=Math.max(this.longestHistoricDataLengthSubEntities,c[u].get(d).length),s=e[r].processStats(c[u].get(d),!0)),c[u].set(d,s)),a={values:c[u].get(d),key:t,objectId:d,data:c[u].get(d),title:t,metricMatchID:N[d],auxEntityId:c[u].get(S.ID)||P.OTHERS},
n.push(a)):(_.contains(D,d)||_.contains(M,d))&&(this.isSingleEntityChart?t=N[d]:c[u].get(S.ID)?(t=this.parentView.getSubEntityName(c[u].get(S.ID)))&&t!==l.STATS_NOT_AVAILABLE||(t=c[u].get(S.ID)):t=P.OTHERS+"( "+this.subEntitiesLen+" Storage Containers )",$.inArray(d,D)>-1?(this.longestHistoricDataLengthSubEntities=Math.max(this.longestHistoricDataLengthSubEntities,c[u].get(d).length),s=e[r].processStats(c[u].get(d),!0)):$.inArray(d,M)>-1&&(s=e[r].processStats(c[u].get(d),!1)),c[u].set(d,s),a={values:c[u].get(d),key:t,objectId:d,data:c[u].get(d),title:t,metricMatchID:N[d],auxEntityId:c[u].get(S.ID)||P.OTHERS},n.push(a));if(this.concatenatePastAndFuture(n))return this.currentChartData=null,void this.handleDataMissing();if(this.isSingleEntityChart&&this.getCurrentSelectedParam()===S.STORAGE_RUNWAY&&(this.currentSelectedEntityType===R.CLUSTER||this.currentSelectedEntityType===R.CONTAINER)){var h;h=this.currentSelectedEntityType===R.CLUSTER?[S.CP_LIVE_USAGE,S.CP_RESERVED_FREE_USAGE,S.CP_SNAPSHOT_USAGE,S.CP_SYSTEM_USAGE]:[S.CP_STORAGE_LIVE_USAGE,S.CP_RESERVED_USAGE,S.CP_SSHOT_RECLAIM_BYTES,S.CP_STORAGE_SYSTEM_USAGE];var p=[];_.each(h,function(e){p.push(_.find(n,function(t){return t.objectId===e}))}),n=p}return this.pickColors(n),{ret:n}},pickColors:function(e){if(1===e.length){var t=E.getChartColor(e[0].objectId);e[0].color=t[0],e[0].strokeColor=t[1]}else _.each(e,function(e,t){var i=t%E.CP.CHART_FILL_COLORS.length;e.color=E.CP.CHART_FILL_COLORS[i],e.strokeColor=E.CP.CHART_STROKE_COLORS[i]})},concatenatePastAndFuture:function(e){for(var t,i=0;i<e.length;i++){t=!1;for(var n=i+1;n<e.length;n++)if(e[i].auxEntityId===e[n].auxEntityId&&e[i].metricMatchID===e[n].metricMatchID){t=!0;break}if(t){if(!e[i].data)return!0;(-1===e[i].objectId.indexOf("predict")||_.contains(D,e[i].objectId))&&this.longestHistoricDataLengthSubEntities&&(e[i].data=e[i].data.slice(0,this.longestHistoricDataLengthSubEntities),e[i].values=e[i].values.slice(0,this.longestHistoricDataLengthSubEntities));var s=e[i].data.reverse().concat(e[n].data.reverse());e[i].data=s,e[i].values=s,e.splice(n,1)}}},handleDataMissing:function(){c.log("Data not available"),this.parentView.trigger("cpDataErrorOccurred",{isError:!1})},disableAreaClick:function(e){e.stacked.dispatch.on("areaClick",null),e.stacked.dispatch.on("areaClick.toggle",null),e.stacked.scatter.dispatch.on("elementClick",null),e.stacked.scatter.dispatch.on("elementClick.area",null)},renderChart:function(i){var n=this;if(i){this.currentChartData=i,this.eventRendered=!1,this.alertRendered=!1,this._svg&&(this.clearTooltips(),this._svg.remove(),this._svg=null,this.graph=null);var s=this.$(".chart-content")[0];$(s).empty(),this._svg=e.select(s).append("svg");var a=i;a.ret.length&&(this.graph=t.addGraph(function(){var e=t.models.stackedAreaChart().useInteractiveGuideline(!0).transitionDuration(0).showControls(!1).showLegend(!1).showYAxis(!0).showXAxis(!0).margin(n.CHART_MARGINS);return e.xAxis.showMaxMin(!1).tickPadding(10,0).tickFormat(n.getXAxisTickFormatter()).tickSubdivide(!0),e.yAxis.showMaxMin(!1).tickFormat(n.getYAxisTickFormatter()).orient("right"),n.getMaxDisplay()&&e.yDomain([0,n.getMaxDisplay()]),n.chart=e,n.longestHistoricDataLengthSubEntities=0,n.validateChartData(a)?(n.lastXAxisPointToBePlotted=a.ret[0].data[a.ret[0].data.length-1][0],e.x(n.getXAxisDataPicker()),e.y(n.getYAxisDataPicker()),n._svg.datum(a.ret.reverse()).call(e),n.disableAreaClick(e),n.addAdditonalInfoToChart(a),setTimeout(function(){n.orientYAxisLabels()},500),e):void n.handleDataMissing()}))}},validateChartData:function(e){return!!(e&&e.ret[0]&&e.ret[0].data&&e.ret[0].data.length)},addAdditonalInfoToChart:function(e){var t=this.chart,i=this;if(e&&t){i.$(".nv-stackedAreaChart rect").attr("height")&&(this.yValForOtherSVG=parseInt(this.$(".nv-stackedAreaChart rect").attr("height"),10)),this.isFuturePredictionAvailable()?this.specialRightMarginVal=0:this.specialRightMarginVal=15;var n=[];n.push([0,0]),n.push([this.lastXAxisPointToBePlotted,0]),this.renderOtherSVGShapeOnChart(n,E.CP.COLORS_MAP.BLACK,v.SHOW_EFFECTIVE_CAPACITY);var s=[],a=(new Date).getTime();s.push([a,0]),s.push([a,this.cumulativeYValue]),this.renderOtherSVGShapeOnChart(s,E.CP.COLORS_MAP.BLACK,v.SHOW_CURRENT_DATE);var r=this.getParsedCurrentRunwayLeft();if(this.eligibleForShowingEffectiveRunway()){var o=a+r*l.MILLIS_PER_DAY,c={date:[],offset:10,text:this.i18n("effective_runway")};c.date.push([o,0]),c.date.push([o,this.cumulativeYValue]),this.renderOtherSVGShapeOnChart(c,E.CP.COLORS_MAP.BLACK,v.SHOW_RUNWAY_DATE)}this.xValForGradient=i.chart.xScale()(s[0][0]),this.renderOtherSVGShapeOnChart(s,E.CP.COLORS_MAP.BLACK,v.SHOW_RUNWAY_REMAINING),this.showWhyNoPredictionLink(),_.each(e.ret,function(e,t){var n=e.metricMatchID.replace(/ /g,""),s="url(#temperature-gradient"+n+"-"+t+")";i.$("path.nv-area-"+t).css({fill:s}),i.addGradients(n+"-"+t,e.color)}),this.hideSomeXAxisTicks(),this.onAlertsChange(),this.onEventsChange(),this.renderAlertEventLineOnChart()}},eligibleForShowingEffectiveRunway:function(){var e=this.getParsedCurrentRunwayLeft();return(this.typeOfChart===P.INDIVIDUAL&&this.currentSelectedEntityType===R.CLUSTER||this.typeOfChart===P.OVERVIEW)&&!_.isNull(e)&&e<365&&0!==e},isMaxRunwayAvailable:function(e){return e&&e[this.getCurrentSelectedParam()]&&!isNaN(e[this.getCurrentSelectedParam()])&&e[this.getCurrentSelectedParam()]<365&&0!==e[this.getCurrentSelectedParam()]},getXAxisDataPicker:function(){return function(e){return e?e[0]:null}},getYAxisDataPicker:function(){return function(e){return e?e[1]:null}},getXAxisTickFormatter:function(){return function(e){var t=new Date(e);return $(this).attr("date",t),t.getMonth()+1+"/"+t.getDate()+"/"+t.getFullYear().toString().substr(2,2)}},getYAxisTickFormatter:function(){var e=this;return function(t){return e.convertStatsToHigherUnits(t,!1,2,!0)}},clearTooltips:function(){t.tooltip.cleanup(),e.select(".d3-tip").remove()},addGradients:function(e,t){this._svg.append("linearGradient").attr("id","temperature-gradient"+e).attr("gradientUnits","userSpaceOnUse").attr("x1",0).attr("y1","0").attr("x2",this.xValForGradient+2).attr("y2","0").selectAll("stop").data([{offset:"0.99",color:t,opacity:"0.9"},{offset:"1",color:t,opacity:"0.3"}]).enter().append("stop").attr("offset",function(e){return e.offset}).attr("stop-color",function(e){return e.color}).attr("stop-opacity",function(e){return e.opacity})},renderOtherSVGShapeOnChart:function(e,t,i,n,s){switch(t||(t=E.CP.COLORS_MAP.BLACK),i){case v.SHOW_ALERT:this.renderAlertSVG(e,t,s,n,10);break;case v.SHOW_CURRENT_DATE:this.renderTodayLineSVG(e);break;case v.SHOW_RUNWAY_DATE:this.renderRunwayLineSVG(e);break;case v.SHOW_RUNWAY_REMAINING:this.renderRemainingRunway(e);break;case v.SHOW_EFFECTIVE_CAPACITY:this.renderEffectiveCapacityLineSVG(e);break;case v.SHOW_EVENT:this.renderEventSVG(e,t,s,n,10)}},renderAlertSVG:function(t,i,s,a,r){var o=this,c=h.ANTISCROLL_WRAP({content:m({details:a,Components:n})}),d=this.createD3Tip(c),T=p.renderSVGLine(this._svg,o.chart.xScale()(t[0][0])+this.CHART_MARGINS.left-this.specialRightMarginVal,o.chart.xScale()(t[0][0])+this.CHART_MARGINS.left-this.specialRightMarginVal,o.yValForOtherSVG+this.CHART_MARGINS.top,this.CHART_MARGINS.top+25,s),A=this._svg.append("g").attr("class","icon");p.renderSVGCircle(A,this.chart.xScale()(t[0][0])+this.CHART_MARGINS.left-this.specialRightMarginVal,this.CHART_MARGINS.top+25,r),T&&T.attr("class","line-opacity");var f=_.some(a,function(e){return e[S.CP.ALERT.SEVERITY]===S.ALERT_SEVERITIES.CRITICAL}),I=f?E.CP.COLORS_MAP.RED:E.CP.COLORS_MAP.YELLOW;p.renderSVGBell(A,"10",this.chart.xScale()(t[0][0])+this.CHART_MARGINS.left-this.specialRightMarginVal-r/2,this.CHART_MARGINS.top-r/2+25,I),d&&A.call(d).on("click",function(){$(".cp-custom-tip").filter(function(){return"1"===$(this).css("opacity")}).length?e.selectAll(".d3-tip").style("opacity",0).style("pointer-events","none"):(d.show(),u.applyAntiScroll($(".cp-custom-tip .antiscroll-wrap"),null,null,{classnames:"-extra-light -spaced -thin"}),e.event.stopPropagation()),$("body").one("click",o.onDocumentClick),$(".alertTooltip").on("click",function(e){g.navigateToFullScreenDetailsPane(l.ENTITY_ALERT,$(e.currentTarget).attr("data-alert-id"),null,l.FULLPAGE_ALERT_DETAILS)})})},renderEventSVG:function(t,i,s,a,r){var o=this,l=h.ANTISCROLL_WRAP({content:m({details:a,Components:n})}),c=this.createD3Tip(l);p.renderSVGLine(this._svg,o.chart.xScale()(t[0][0])+this.CHART_MARGINS.left-this.specialRightMarginVal,o.chart.xScale()(t[0][0])+this.CHART_MARGINS.left-this.specialRightMarginVal,o.yValForOtherSVG+this.CHART_MARGINS.top,this.CHART_MARGINS.top+50,s);var d=this._svg.append("g").attr("class","icon");p.renderSVGCircle(d,this.chart.xScale()(t[0][0])+this.CHART_MARGINS.left-this.specialRightMarginVal,this.CHART_MARGINS.top+60,r),p.renderSVGBell(d,"10",this.chart.xScale()(t[0][0])+this.CHART_MARGINS.left-this.specialRightMarginVal-r/2,this.CHART_MARGINS.top-r/2+60,E.CP.COLORS_MAP.GRAY),c&&d.call(c).on("click",function(){$(".cp-custom-tip").filter(function(){return"1"===$(this).css("opacity")}).length?e.selectAll(".d3-tip").style("opacity",0).style("pointer-events","none"):(c.show(),u.applyAntiScroll($(".cp-custom-tip .antiscroll-wrap"),null,null,{classnames:"-extra-light -spaced -thin"}),e.event.stopPropagation()),$("body").one("click",o.onDocumentClick)})},renderTodayLineSVG:function(e){var t=E.FS.COLORS_MAP.BLUE,i=E.CP.COLORS_MAP.BLUE;p.renderSVGLine(this._svg,this.chart.xScale()(e[0][0])+this.CHART_MARGINS.left-this.specialRightMarginVal,this.chart.xScale()(e[0][0])+this.CHART_MARGINS.left-this.specialRightMarginVal,this.yValForOtherSVG+this.CHART_MARGINS.top,2*this.CHART_MARGINS.top-20,t),this._svg.append("rect").attr("fill",i).attr("x",this.chart.xScale()(e[0][0])+this.CHART_MARGINS.left-25-2*this.specialRightMarginVal).attr("y",this.CHART_MARGINS.top-10).attr("width","50").attr("height","20").attr("rx","3").attr("ry","3");var n=E.CP.COLORS_MAP.WHITE;this._svg.append("text").attr("x",this.chart.xScale()(e[0][0])+this.CHART_MARGINS.left-2*this.specialRightMarginVal).attr("y",this.CHART_MARGINS.top+3).attr("text-anchor","middle").style({"font-size":"10px",fill:n,"font-weight":"600"}).text(this.i18n("today"))},renderEffectiveCapacityLineSVG:function(e){var t=E.CP.COLORS_MAP.RED,i=this.parentView.getEffectiveCapacity();if(this.$el.parent().find(".eff-cap").removeClass("hide"),!i)return c.log("CPChartView#renderEffectiveCapacityLineSVG: Skip drawing since effective capacity has not been set."),void this.$el.parent().find(".eff-cap").addClass("hide");var n=i.val,s=i.reason,a=this.convertStatsToHigherUnits(n,!1,2,!1),r=p.renderSVGLine(this._svg,e[0][0]+this.CHART_MARGINS.left,this.chart.xScale()(e[1][0])+this.CHART_MARGINS.left,this.chart.yScale()(n)+this.CHART_MARGINS.top,this.chart.yScale()(n)+this.CHART_MARGINS.top,t);r&&r.attr({class:"effective-line"});var o=(this.CHART_MARGINS.left,this.chart.yScale()(n),this.CHART_MARGINS.top,"("+a+")");this.$el.parent().find(".eff-cap-text").text(o),s&&this.createCapacityTooltip(s,"eff")},renderRunwayLineSVG:function(e){var t=E.FS.COLORS_MAP.RED;E.CP.COLORS_MAP.RED;if(e&&e.date&&e.text){var i=e.date,n=(e.text,e.offset,this.chart.xScale()(i[0][0])+this.CHART_MARGINS.left-this.specialRightMarginVal);p.renderSVGLine(this._svg,n,n,this.yValForOtherSVG+this.CHART_MARGINS.top,2*this.CHART_MARGINS.top,t).attr({class:"runway-line"}),p.renderSVGExclamation(this._svg,20,this.chart.xScale()(i[0][0])+this.CHART_MARGINS.left-10-2*this.specialRightMarginVal,this.CHART_MARGINS.top,"-critical")}},createCustomSVGText:function(e,t,i,n){var s=E.CP.COLORS_MAP.GRAY_4;e>=0&&t>=0?this._svg.append("text").attr("x",e).attr("y",t).attr("text-anchor","middle").attr("class",(n||"")+" custom-text").style({"font-size":"10px","text-transform":"uppercase",fill:s,"font-weight":"500"}).text(i):c.log("Invalid x,y coordinates")},createD3Tip:function(e,t,n){return t=t||"",n=n||[-20,-10],i().attr("class","d3-tip cp-custom-tip "+t).offset(n).direction("sw").html(function(t){return e})},isFuturePredictionAvailable:function(){return this.futurePredictionAvailable},renderSVGToShowMaxRunwayDays:function(e,t){var i=(E.CP.COLORS_MAP.GRAY_2,e[0][0]),n=this.chart.xScale()(e[0][0])+Math.abs((this.chart.xScale()(e[0][0])-this.chart.xScale()(i))/2)+this.CHART_MARGINS.left;this.createCustomSVGText(n,this.yValForOtherSVG+2*this.CHART_MARGINS.top+1,t)},renderRemainingRunway:function(e){if(this.isFuturePredictionAvailable()&&!(this.getParsedCurrentRunwayLeft()<=15)&&e&&e[0][0]){var t=this.getParsedCurrentRunwayLeft(),i=e[0][0]+t*l.MILLIS_PER_DAY;this.renderSVGToShowRemainingDays(e[0][0],i,this.getCurrentRunwayLeft());var n=this.parentView.getMaxRunway(),s=n&&n[this.getCurrentSelectedParam()];if(s&&t<s&&t<365){var a=e[0][0]+s*l.MILLIS_PER_DAY,r=this.i18ns("max_runway_days",s-t);this.renderSVGToShowRemainingDays(i,a,r)}}},renderSVGToShowRemainingDays:function(e,t,i){var n=E.CP.COLORS_MAP.GRAY_2,s=this.chart.xScale()(e)+Math.abs((this.chart.xScale()(e)-this.chart.xScale()(t))/2)+this.CHART_MARGINS.left;this.createCustomSVGText(s,this.yValForOtherSVG+2*this.CHART_MARGINS.top+1,i),p.renderSVGLine(this._svg,this.chart.xScale()(e)+this.CHART_MARGINS.left+10,s-30,this.yValForOtherSVG+2*this.CHART_MARGINS.top-2,this.yValForOtherSVG+2*this.CHART_MARGINS.top-2,n),p.renderSVGLine(this._svg,s+30,this.chart.xScale()(t)+this.CHART_MARGINS.left-10,this.yValForOtherSVG+2*this.CHART_MARGINS.top,this.yValForOtherSVG+2*this.CHART_MARGINS.top,n)},showWhyNoPredictionLink:function(){var e=this.typeOfChart===P.INDIVIDUAL&&this.currentSelectedEntityType!==R.CLUSTER,t=this.sharedModel.get(this.sharedModel.DP.NO_PREDICTION_REASON);if(this.currentRunwayLeft){var i=this.currentRunwayLeft.split(" ")[0];e&&t&&(i===l.STATS_NOT_AVAILABLE||i===l.STATS_NOT_APPLICABLE)?($(".no-prediction-avail").is(":visible")||$(".visual-info").append(f),this.createNoPredictionTooltip(t)):$(".no-prediction-avail").remove()}else $(".no-prediction-avail").is(":visible")||$(".visual-info").append(f)},createNoPredictionTooltip:function(e){var t=this;this.destroyTooltips(O.PREDICTION),this.$(".no-prediction-avail").tooltip({title:function(){return I(t.vtOptions({reason:e}))},delay:{show:200,hide:100},placement:"top",trigger:"hover",animation:!1,html:!0})},destroyTooltips:function(e){e===O.PREDICTION?this.$(".no-prediction-avail").tooltip("destroy"):this.$el.parent().find(".eff-cap").tooltip("destroy")},createCapacityTooltip:function(e,t){this.destroyTooltips(O.CAPACITY),this.$el.parent().find("."+t+"-cap").tooltip({title:function(){return e},delay:{show:200,hide:100},placement:"top",trigger:"hover",animation:!1,html:!0,container:$("body")})},getChartOptions:function(e){},hideSomeXAxisTicks:function(){this.ticks_map={},_.each(this.$(".nv-x .nv-axis .tick"),function(e){var t=this.$(this.$(e)).find("text").attr("date");this.ticks_map[t]=[];var i=new Date(t);new Date<i&&this.$(this.$(e)).find("text").css("display","none")},this),this.tickDiffInMilliseconds=new Date(Object.keys(this.ticks_map)[1]).getTime()-new Date(Object.keys(this.ticks_map)[0]).getTime()},orientYAxisLabels:function(){var e,t;if(this.$el.parent().find(".max-cap").removeClass("hide"),_.each(this.$(".nv-y .nv-axis .tick"),function(t,i){var n=$($(t)).find("line").attr("x2"),s=$($(t)).find("text").attr("dy");s.match("-")||$($(t)).find("text").attr("dy","-"+s),$($(t)).find("line").attr("x2",Math.abs(parseFloat(n))),$($(t)).find("line").attr("y2",0),e=t},this),t=this.convertStatsToHigherUnits(this.getMaxDisplay(),!1,2),e&&this.getMaxDisplay()&&parseInt($(e).find("text").text(),10)!==this.getMaxDisplay()){var i=e.cloneNode(!0);$(i).attr("transform","translate(0,0)"),$($(i).find("line")).attr({class:"max-cap-line"}),$($(i).find("text")).html(t+" (max)"),this.chartMaxReason&&this.createCapacityTooltip(this.chartMaxReason,"max"),this.$(".nv-y .nv-axis").append(i),c.areElementsOverlapping(e,i)&&$(e).hide()}else this.$el.parent().find(".max-cap").addClass("hide")},convertStatsToHigherUnits:function(e,t,i,n){var s,a,r;return 0!==i&&(i=i||2),this.getCurrentSelectedParam()===S.STORAGE_RUNWAY?(r=T.processCapacityStorageStatsCaption(e,i),_.isObject(r)&&_.isNumber(r.value)&&_.isString(r.unit)&&""!==r.unit||(r={value:0,unit:"bytes"}),s=r.value,a=r.unit):this.getCurrentSelectedParam()===S.CPU_RUNWAY?(s=T.processCapacityCPUStats(e,t,i),a="GHz"):(s=T.processCapacityMemoryStats(e,t,i),a="GiB"),n&&(s=Math.floor(parseInt(s))),s+=" "+a},getMaxDisplay:function(){return this.chartMaxYVal},getCurrentSelectedParam:function(){return this.selectedParam},getCurrentRunwayLeft:function(){return this.currentRunwayLeft},_fetchAlertsAndEvents:function(){var e=[],t=this;this.cpAlertModel.getQueryModel().setStartTime(this.getTimeRangeMin()),e.push(this.cpAlertModel.fetch()),e.push(this.cpEventModel.fetch()),$.when.apply($,e).done(function(){t.onEventsChange(),t.onAlertsChange(),t.renderAlertEventLineOnChart()}).fail(function(){c.log("Error in fetching alerts and events")})},getTimeRangeMin:function(){var e=Date.now(),t=this.parentView.getRunwayAccuracy(),i=this.getCurrentSelectedParam();if(t&&t[i]){var n=parseInt(t[i],10);if(n>0)return e-n*l.MILLIS_PER_DAY}return e-y.RUNWAY_DAYS*l.MILLIS_PER_DAY},getTimeRangeMax:function(e){var t;if(this.futurePredictionAvailable=!0,e)t=e*l.MILLIS_PER_DAY;else{var i=this.parentView.getMaxRunway(),n=this.typeOfChart===P.INDIVIDUAL&&this.currentSelectedEntityType===R.CLUSTER||this.typeOfChart===P.OVERVIEW;if(i&&n&&i[this.getCurrentSelectedParam()]&&i[this.getCurrentSelectedParam()]!==l.STATS_NOT_APPLICABLE){var s=i[this.getCurrentSelectedParam()];t=parseInt(s,10)*l.MILLIS_PER_DAY}else{if(!this.currentRunwayLeft||this.currentRunwayLeft===l.STATS_NOT_AVAILABLE||this.currentRunwayLeft===l.STATS_NOT_APPLICABLE)return this.futurePredictionAvailable=!1,!1;t=parseInt(this.currentRunwayLeft.split(" ")[0],10)*l.MILLIS_PER_DAY}}return!isNaN(t)&&0!==t&&Date.now()+t+3*l.MILLIS_PER_DAY},onAlertsChange:function(){var e=this;this.alertsToBeRendered=[],this.chart&&!this.alertRendered&&(this.whatKindOfAlert=!1,this.severityOfAlert={storage:[],cpu:[],memory:[]},this.cpAlertModel&&(_.each(this.cpAlertModel.models,function(t){if(e.checkTypeOfAlert(t),e.whatKindOfAlert===e.getCurrentSelectedParam()){var i=t.get(S.ALERT_SOURCE_ENTITY_ID),n=t.get(S.EB.CLUSTER_UUID);e.currentSelectedEntityId&&e.currentSelectedEntityId!==n?i===e.currentSelectedEntityId&&e.alertsToBeRendered.push(t):i===n&&e.alertsToBeRendered.push(t)}}),this.renderAlertIcon()))},checkTypeOfAlert:function(e){this.whatKindOfAlert=!1;var t=e.get(S.ALERT_IMPACT_TYPE);_.contains(t,S.CP.ALERT.STORAGE_CAPACITY)?this.whatKindOfAlert=S.STORAGE_RUNWAY:_.contains(t,S.CP.ALERT.CPU_CAPACITY)?this.whatKindOfAlert=S.CPU_RUNWAY:_.contains(t,S.CP.ALERT.MEMORY_CAPACITY)&&(this.whatKindOfAlert=S.MEMORY_RUNWAY),this.whatKindOfAlert&&this.severityOfAlert[this.whatKindOfAlert].push(e.get(S.CP.ALERT.SEVERITY))},renderAlertIcon:function(){var t=[S.STORAGE_RUNWAY,S.CPU_RUNWAY,S.MEMORY_RUNWAY],i=this;_.each(t,function(t){if(i.severityOfAlert[t].length){var n=_.some(i.severityOfAlert[t],function(e){return e===S.ALERT_SEVERITIES.CRITICAL}),s="."+t+"Option",a=$(s+" .alert-icon")[0];$(a).empty(),this._svgForIcon=e.select(a).append("svg");var r=this._svgForIcon.append("g").attr("style","cursor: pointer");this._svgForIcon.attr("class","svg-alert-icon"),p.renderSVGCircle(r,10,15,9,E.CP.COLORS_MAP.WHITE,E.CP.COLORS_MAP.GRAY);var o=n?E.CP.COLORS_MAP.RED:E.CP.COLORS_MAP.YELLOW;p.renderSVGBell(r,"10",5,10,o)}},this)},renderAlertEventLineOnChart:function(){var e,t,i,n=this,s=!0,a=E.CP.COLORS_MAP.GRAY_5,r=!1,o=Date.now();_.each(this.alertsToBeRendered,function(t){e=null,s=!0;var i=new Date(t.get(S.EB.CREATED_TIMESTAMP_USECS)/l.MICROS_PER_MILLI);_.each(n.ticks_map,function(t,n){i<new Date(n)&&s&&(s=!1),s&&(e=n)}),e&&n.ticks_map[e].push(t)}),_.each(this.eventsToBeRendered,function(t){e=null,s=!0;var i=new Date(t.get(S.EB.CREATED_TIMESTAMP_USECS)/l.MICROS_PER_MILLI);_.each(this.ticks_map,function(t,n){i<new Date(n)&&s&&(s=!1),s&&(e=n)},this),e&&this.ticks_map[e].push(t)},this),_.each(this.ticks_map,function(e,n){var s=[],c=0;_.each(e,function(e){e.get(S.ALERT_SEVERITY)===S.ALERT_SEVERITIES.AUDIT&&(s.push(e),c++)}),e.length=e.length-c;var u=e[0];if(e.length>1){var h=new Date(n).getTime()+this.tickDiffInMilliseconds/2;t=Math.min(h,o),a=E.CP.COLORS_MAP.RED}else 1===e.length&&(t=u.get(S.EB.CREATED_TIMESTAMP_USECS)/l.MICROS_PER_MILLI);if(u){var p=[];this.alertRendered=!0,p.push([t,this.yValForOtherSVG]),p.push([t,0]);var T={values:p,key:u.get(),color:E.CP.COLORS_MAP.RED,objectId:u.get(S.ALERT_ID),data:p,title:"Capacity Alert"},g=E.CP.COLORS_MAP.RED,A=[];_.each(e,function(e){var t=new Date(e.get(S.EB.CREATED_TIMESTAMP_USECS)/l.MICROS_PER_MILLI),i={severity:e.get(S.ALERT_SEVERITY),message:d.getAlertDisplayName(e,!0),timeStamp:t.toString(),id:e.id,classname:"alertMsg"};A.push(i)}),r=!0,this.renderOtherSVGShapeOnChart(T.values,g,v.SHOW_ALERT,A,a)}if(s.length){var m=[],f=s[0];if(s.length>1){var I=new Date(n).getTime()+this.tickDiffInMilliseconds/2;i=Math.min(I,o),a=E.CP.COLORS_MAP.GRAY}else 1===s.length&&(i=f.get(S.EB.CREATED_TIMESTAMP_USECS)/l.MICROS_PER_MILLI);this.eventRendered=!0,m.push([i,this.yValForOtherSVG]),m.push([i,0]);var C={values:m,key:f.get(S.ALERT_ID_FILTER),color:E.CP.COLORS_MAP.RED,objectId:f.get(S.ALERT_ID),data:m,title:"Capacity Event"},R=E.CP.COLORS_MAP.GRAY,N=[];_.each(s,function(e){var t=new Date(e.get(S.EB.CREATED_TIMESTAMP_USECS)/l.MICROS_PER_MILLI),i={severity:"",message:d.getAlertDisplayName(e,!0),timeStamp:t.toString(),id:e.id,classname:"eventMsg event-message"};N.push(i)}),this.renderOtherSVGShapeOnChart(C.values,R,v.SHOW_EVENT,N,a,r)}},this)},noDataAvailableView:function(e){this._svg&&this._svg.remove(),this._svg=null,this.$(".chart-content").empty();var t=this.$(".chart-content")[0];e.isError?$(t).append(r.ERROR_IN_DATA_RETRIEVAL_HTML(this.vtOptions())):e.isNotReady?$(t).append(r.NOT_READY_HTML(this.vtOptions())):$(t).append(r.NO_DATA_HTML(this.vtOptions())),this.$el.parent().find(".max-cap, .eff-cap").addClass("hide")},onEventsChange:function(){var e=this;this.eventsToBeRendered=[];var t,i;this.chart&&!this.eventRendered&&(this.whatKindOfAlert=!1,this.severityOfAlert={storage:[],cpu:[],memory:[]},this.cpEventModel&&_.each(this.cpEventModel.models,function(n){var s=!1;e.typeOfChart===P.OVERVIEW?n.get(S.EB.CLUSTER_UUID)===e.currentClusterUUID&&(s=!0):n.get(S.ALERT_SOURCE_ENTITY_ID)===e.currentSelectedEntityId&&(s=!0),s&&(t=$(".selectedRunwayMetric").attr(l.NAV_ACTION_TARGET_ID),"true"===(i=e.getEventContextValue(n,b[t]))&&e.eventsToBeRendered.push(n))}))},onDocumentClick:function(){e.selectAll(".d3-tip").style("opacity",0).style("pointer-events","none")},getEventContextValue:function(e,t){var i;return-1!==(i=$.inArray(t,e.get(S.ALERT_PARAM_NAMES)))&&e.get(S.ALERT_PARAM_VALUES)[i]}})}),define("views/details/tabs/CPTableView",["views/basecomponents/datatables/BaseTableView","data/DataProperties","models/query/QueryResultCollection","models/capacityplanning/CPQueryModel","utils/AppConstants","utils/StatsUtil","utils/AppUtil"],function(e,t,i,n,s,a,r){"use strict";var o={NODE_NAME:"node_name",CONTAINER_NAME:"container_name"},l={"capacity.live_usage_bytes":"#1ABCEC","storage.live_usage_bytes":"#1ABCEC","storage.reserved_free_bytes":"#DD7379","capacity.reserved_free_bytes":"#DD7379","capacity.system_usage_bytes":"#00A187","storage.snapshot_reclaimable_bytes":"#FFCE68","capacity.snapshot_reclaimable_bytes":"#FFCE68"},c=i.extend({toJSON:function(){var e=i.prototype.toJSON.apply(this,arguments);if(0===e.length)return e;var n=e[0],a=[t.CP_STORAGE_SYSTEM_USAGE,t.CP_STORAGE_LIVE_USAGE,t.CP_RESERVED_USAGE,t.CP_SSHOT_RECLAIM_BYTES,t.CP_LIVE_USAGE,t.CP_SNAPSHOT_USAGE,t.CP_RESERVED_FREE_USAGE,t.CP_SYSTEM_USAGE],r=[];return _.each(n,function(e,i){if(_.contains(a,i)){var o="";i===t.CP_STORAGE_SYSTEM_USAGE||i===t.CP_SYSTEM_USAGE?o=n[t.CP_SYSTEM_GAIN]:i===t.CP_SSHOT_RECLAIM_BYTES||i===t.CP_SNAPSHOT_USAGE?o=n[t.CP_SNAPSHOT_GAIN]:i!==t.CP_LIVE_USAGE&&i!==t.CP_STORAGE_LIVE_USAGE||(o=n[t.CP_LIVE_GAIN]),r.push({name:s.CP_METRIC_UNIQUE_ID_MAP[i],key:i,usage:e,gain:o})}}),r}});return e.extend({name:"CPTableView",isSelectionEnabled:!1,initialize:function(t){this.parentView=t.parentView,this.currentModelId=t.clusterId,this.attrObj=t.attrObj,e.prototype.initialize.apply(this,arguments)},initializeTableModel:function(e){switch(this.dataTableSettings.bPaginate=!1,this.entityType){case s.CP_ENTITY_STORAGE_USAGE:this.model=new c,this.model.setQueryModel(new n(this.attrObj)),this.defaultMinRows=5;break;case s.CP_ENTITY_MEMORY_USAGE:case s.CP_ENTITY_CPU_USAGE:this.model=new i,this.model.setQueryModel(new n(this.attrObj)),this.defaultMinRows=5;break;case s.CP_CLUSTER_CONTAINER_STORAGE_OVERVIEW:case s.CP_CLUSTER_HOST_MEMORY_OVERVIEW:case s.CP_CLUSTER_HOST_CPU_OVERVIEW:this.model=e.model,this.defaultMinRows=5;break;default:throw"The model on CPTableView has not been initialized.  Entity: "+this.entityType}},onStartServices:function(){this.delegateEvents(),this.delegateModelEvents()},onStopServices:function(){this.undelegateEvents(),this.undelegateModelEvents()},getDefaultSort:function(t){return t===s.CP_ENTITY_STORAGE_USAGE?[[3,"asc"]]:e.prototype.getDefaultSort.apply(this,arguments)},getDefaultColumns:function(e,i){var n,o=this,c=function(e,t,i){return r.processRunwayNumber(e)};return e===s.CP_ENTITY_STORAGE_USAGE?n=[{sTitle:this.i18n("name"),mData:"name",sClass:"n-name",sWidth:"40%",mRender:function(e,t,i){var n=l[i.key];return n?'<span class="color-indicator"\n                    style="background-color: '+n+'"></span> '+e:e}},{sTitle:this.i18n("description"),mData:"name",sClass:"n-name",sWidth:"40%",mRender:function(e,t,i){return o.i18n(i.key)||i.key}},{sTitle:this.i18n("current_storage_usage"),mData:function(e,t,i){return e.usage!==s.STATS_NOT_AVAILABLE?parseFloat(e.usage):e.usage},sClass:"n-num",sWidth:"30%",mRender:function(e,t,i){return o.getSystemUsageValue(e,t,i)}},{sTitle:this.i18n("name"),mData:"name",sClass:"hidden",sWidth:"0%",mRender:function(e,t,i){return e}}]:e===s.CP_ENTITY_CPU_USAGE?n=[{sTitle:this.i18n("vm_name"),mData:"vm_name",sClass:"n-name",sWidth:"30%"},{sTitle:this.i18n("cpu_usage"),mData:function(e,i,n){return e[t.STATS_HYP_CPU_USAGE]!==s.STATS_NOT_AVAILABLE?parseFloat(e[t.STATS_HYP_CPU_USAGE]):e[t.STATS_HYP_CPU_USAGE]},sClass:"n-num",sWidth:"40%",mRender:function(e,t,i){return t===s.TABLE_COL_TYPE_DISPLAY||t===s.TABLE_COL_TYPE_EXPORT?a.convertPercentValueWithDecimals(a.ppmFormat(e)):e}},{sTitle:this.i18n("num_vcpu"),mData:"num_vcpus",sClass:"n-num",sWidth:"30%"}]:e===s.CP_ENTITY_MEMORY_USAGE?n=[{sTitle:this.i18n("vm_name"),mData:"vm_name",sClass:"n-name",sWidth:"50%"},{sTitle:this.i18n("memory_usage"),mData:function(e,i,n){return e[t.CP_MEMORY_USAGE_BYTES]!==s.STATS_NOT_AVAILABLE?parseFloat(e[t.CP_MEMORY_USAGE_BYTES]):e[t.CP_MEMORY_USAGE_BYTES]},sClass:"n-num",sWidth:"25%",mRender:function(e,t,i){return t===s.TABLE_COL_TYPE_DISPLAY||t===s.TABLE_COL_TYPE_EXPORT?a.convertToUnitValueWithDecimals(a.processCapacityMemoryStats(e,!1,2,!0)):e}},{sTitle:this.i18n("memory_usage_percent"),mData:t.STATS_MEMORY_USAGE,sClass:"n-num",sWidth:"25%",mRender:function(e,t,i){return t===s.TABLE_COL_TYPE_DISPLAY||t===s.TABLE_COL_TYPE_EXPORT?a.convertPercentValueWithDecimals(a.ppmFormat(e)):e}}]:e===s.CP_CLUSTER_HOST_MEMORY_OVERVIEW?n=[{sTitle:this.i18n("host_name"),mData:"node_name",sClass:"n-host-name",sWidth:"20%",mRender:function(e,i,n){return e!==s.STATS_NOT_AVAILABLE?e:n[t.ID]}},{sTitle:this.i18n("current_memory_usage"),mData:function(e,i,n){return e[t.CP_MEMORY_USAGE]!==s.STATS_NOT_AVAILABLE?parseFloat(e[t.CP_MEMORY_USAGE]):e[t.CP_MEMORY_USAGE]},sClass:"n-num",sWidth:"30%",mRender:function(e,t,i){return t===s.TABLE_COL_TYPE_DISPLAY||t===s.TABLE_COL_TYPE_EXPORT?a.convertToUnitValueWithDecimals(a.processCapacityMemoryStats(e,!1,2,!0)):e}},{sTitle:this.i18n("current_memory_capacity"),mData:function(e,i,n){return e[t.HOST_MEMORY_SIZE_BYTES]!==s.STATS_NOT_AVAILABLE?parseFloat(e[t.HOST_MEMORY_SIZE_BYTES]):e[t.HOST_MEMORY_SIZE_BYTES]},sClass:"n-num",sWidth:"20%",mRender:function(e,t,i){return t===s.TABLE_COL_TYPE_DISPLAY||t===s.TABLE_COL_TYPE_EXPORT?a.convertToUnitValueWithDecimals(a.processCapacityMemoryStats(e,!1,2,!0)):e}},{sTitle:this.i18n("runway"),mData:function(e,i,n){return e[t.MEMORY_RUNWAY_IN_DAYS]},sClass:"n-num",sWidth:"10%",mRender:c}]:e===s.CP_CLUSTER_HOST_CPU_OVERVIEW?n=[{sTitle:this.i18n("host_name"),mData:"node_name",sClass:"n-host-name",sWidth:"20%",mRender:function(e,i,n){return e!==s.STATS_NOT_AVAILABLE?e:n[t.ID]}},{sTitle:this.i18n("current_cpu_usage"),mData:function(e,i,n){return e[t.CP_CPU_USAGE]!==s.STATS_NOT_AVAILABLE?parseFloat(e[t.CP_CPU_USAGE]):e[t.CP_CPU_USAGE]},sClass:"n-num",sWidth:"30%",mRender:function(e,t,i){return t===s.TABLE_COL_TYPE_DISPLAY||t===s.TABLE_COL_TYPE_EXPORT?a.convertToUnitValueWithDecimals(a.processCapacityCPUStats(e,!1,2,!0)):e}},{sTitle:this.i18n("current_cpu_capacity"),mData:function(e,i,n){return e[t.CP_CPU_IN_GHZ]!==s.STATS_NOT_AVAILABLE?parseFloat(e[t.CP_CPU_IN_GHZ]):e[t.CP_CPU_IN_GHZ]},sClass:"n-num",sWidth:"20%",mRender:function(e,t,i){return t===s.TABLE_COL_TYPE_DISPLAY||t===s.TABLE_COL_TYPE_EXPORT?a.convertToUnitValueWithDecimals(a.processCapacityCPUStats(e,!1,2,!0)):e}},{sTitle:this.i18n("runway"),mData:function(e,i,n){return e[t.CPU_RUNWAY_IN_DAYS]},sType:"numeric",sClass:"n-num",sWidth:"10%",mRender:c}]:e===s.CP_CLUSTER_CONTAINER_STORAGE_OVERVIEW&&(n=[{sTitle:this.i18n("storage_container_name"),mData:"container_name",sClass:"n-container-name",sWidth:"20%",mRender:function(e,i,n){return e!==s.STATS_NOT_AVAILABLE?e:n[t.ID]}},{sTitle:this.i18n("current_usage"),mData:function(e,i,n){return e[t.CP_STORAGE_USAGE]!==s.STATS_NOT_AVAILABLE?parseFloat(e[t.CP_STORAGE_USAGE]):e[t.CP_STORAGE_USAGE]},sClass:"n-num",sWidth:"20%",mRender:function(e,t,i){return o.getSystemUsageValue(e,t,i)}},{sTitle:this.i18n("capacity"),mData:function(e,t,i){return e["storage.capacity_bytes"]!==s.STATS_NOT_AVAILABLE?parseFloat(e["storage.capacity_bytes"]):e["storage.capacity_bytes"]},sClass:"n-num",sWidth:"20%",mRender:function(e,t,i){return t===s.TABLE_COL_TYPE_DISPLAY||t===s.TABLE_COL_TYPE_EXPORT?a.convertToUnitValueWithDecimals(a.processCapacityStorageStats(e,!1,2,!0)):e}},{sTitle:this.i18n("runway"),mData:function(e,i,n){return e[t.STORAGE_RUNWAY_IN_DAYS]},sClass:"n-num",sWidth:"20%",mRender:c}]),n},getSystemUsageValue:function(e,i){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(i===s.TABLE_COL_TYPE_DISPLAY||i===s.TABLE_COL_TYPE_EXPORT){var r=a.storageFormat(e,!0,null,!1);return n.key===t.CP_SYSTEM_USAGE||n.key===t.CP_STORAGE_SYSTEM_USAGE?'<span class="system-usage-tooltip">'+r+"</span>":r}return e},getEntityTypeName:function(){return s.ENTITY_NAMES[this.entityType]||"item"},render:function(){return e.prototype.render.apply(this,arguments),this.model.queryModel&&this.model.queryModel.getState()===s.STATE_SUCCESS&&this.onDataChange(),this.entityType!==s.CP_CLUSTER_CONTAINER_STORAGE_OVERVIEW&&this.entityType!==s.CP_CLUSTER_HOST_CPU_OVERVIEW&&this.entityType!==s.CP_CLUSTER_HOST_MEMORY_OVERVIEW&&(this.$el.addClass("not-clickable"),this.$el.addClass("notClickable")),this},onDrawCallback:function(){var e=this.model&&this.model.models&&this.model.models[0];if(e&&(this.entityType===s.CP_CLUSTER_CONTAINER_STORAGE_OVERVIEW||this.entityType===s.CP_ENTITY_STORAGE_USAGE)){var i=void 0,n=void 0,r=void 0,o=void 0;(this.attrObj&&this.attrObj.entity_type)===s.ENTITY_CLUSTER?(i=e.get(t.CP_GARBAGE_BYTES),n=e.get(t.CP_EC_BYTES),r=e.get(t.CP_DEDUP_BYTES),o=e.get(t.CP_OTHER_USAGE_BYTES)):(i=e.get(t.CP_STORAGE_GARBAGE_BYTES),n=e.get(t.CP_STORAGE_EC_BYTES),r=e.get(t.CP_STORAGE_DEDUP_BYTES),o=e.get(t.CP_OTHER_USAGE_BYTES)),i=a.storageFormat(i,!0,null,!1),n=a.storageFormat(n,!0,null,!1),r=a.storageFormat(r,!0,null,!1),o=a.storageFormat(o,!0,null,!1),this.$(".system-usage-tooltip").tooltip({title:function(){
return'\n              <div class="n-storage-breakdown">\n                <div class="n-storage-info-title">\n                  System usage breakup\n                </div>\n                <div class="n-row">\n                  <div class="n-row-label">Garbage</div>\n                  <div class="n-row-value">'+i+'</div>\n                </div>\n                <div class="n-row">\n                  <div class="n-row-label">EC</div>\n                  <div class="n-row-value">'+n+'</div>\n                </div>\n                <div class="n-row">\n                  <div class="n-row-label">Used by dedupe</div>\n                  <div class="n-row-value">'+r+'</div>\n                </div>\n                <div class="n-row">\n                  <div class="n-row-label">Other</div>\n                  <div class="n-row-value">'+o+"</div>\n                </div>\n              </div>\n            "},placement:"left",trigger:"hover",animation:!1,html:!0})}},_dataTableRowCallback:function(e,i,n){return i[o.NODE_NAME]&&$(e).attr(s.NAV_ACTION_TARGET_NAME,i[o.NODE_NAME]),i[o.CONTAINER_NAME]&&$(e).attr(s.NAV_ACTION_TARGET_NAME,i[o.CONTAINER_NAME]),i[t.ID]&&$(e).attr(s.NAV_ACTION_TARGET_ID,i[t.ID]),e},onClickDataRow:function(e){$(e.currentTarget).children("td:first").hasClass("n-container-name")&&this.parentView.switchViewOnContainerSelection(null,$(e.currentTarget).attr(s.NAV_ACTION_TARGET_NAME),$(e.currentTarget).attr(s.NAV_ACTION_TARGET_ID)),$(e.currentTarget).children("td:first").hasClass("n-host-name")&&this.parentView.switchViewOnHostSelection(null,$(e.currentTarget).attr(s.NAV_ACTION_TARGET_NAME),$(e.currentTarget).attr(s.NAV_ACTION_TARGET_ID))},destroy:function(){this.$(".system-usage-tooltip").tooltip("destroy"),e.prototype.destroy.apply(this,arguments)}})}),define("text!templates/basecomponents/details/CapacityPlanning/CPDrillDownSubView.html",[],function(){return'<div class="capacity-drilldown-options">\n  <div class="tab_set_view n-clearfix">\n    <div class="left-section">\n      <div class="tab-section">\n        <div data-metric="storage" class="btn-group">\n          <button class="dd_option btn btn-small btn-default"\n              actionTargetId = "storage"\n              actionHistoricMetric =\n                "capacity.live_usage_bytes,\n                capacity.snapshot_reclaimable_bytes,\n                capacity.reserved_free_bytes,\n                capacity.system_usage_bytes"\n              actionPredictionMetric =\n                "capacity.live_predict_bytes,\n                capacity.snapshot_predict_bytes,\n                capacity.reserved_free_predict_bytes,\n                capacity.system_predict_bytes"\n              actionContainerHistoricMetric =\n                "capacity.system_usage_bytes,\n                storage.live_usage_bytes,\n                storage.reserved_free_bytes,\n                storage.snapshot_reclaimable_bytes"\n              actionContainerPredictionMetric =\n                "capacity.system_predict_bytes,\n                capacity.live_predict_bytes,\n                capacity.reserved_free_predict_bytes,\n                capacity.snapshot_predict_bytes"\n              actionEntityType = "cluster"\n              actionParentEntityId = "" data-drilldown-option = "Data"\n              actionSelectedEntityId = ""\n              actionSelectedEntityNames = ""\n              actionTypeOfChart = "Individual"> <%= i18n(\'by_usage\') %>\n          </button>\n          <button class="dd_option btn btn-small btn-default"\n              data-drilldown-option="Container"\n              actionHistoricMetric="storage.usage_bytes"\n              actionPredictionMetric="capacity.storage_predict_bytes"\n              actionTargetId="disk"\n              actionEntityType="container" actionParentEntityId=""\n              actionSelectedEntityId=""\n              actionTopSelectedEntityId=""\n              actionSelectedEntityNames=""\n              actionTypeOfChart="Overview"><%= i18n(\'by_storage_container\') %>\n          </button>\n        </div>\n        <div data-metric="cpu" class="btn-group">\n          <button class="dd_option btn btn-small"\n              actionTargetId = "cpu"\n              actionHistoricMetric ="capacity.cpu_usage_hz"\n              actionPredictionMetric = "capacity.cpu_usage_predict_hz"\n              actionEntityType = "cluster"\n              actionParentEntityId = "" data-drilldown-option = "Data"\n              actionSelectedEntityId = ""\n              actionSelectedEntityNames=""\n              actionTypeOfChart="Individual"> <%= i18n(\'overall\') %>\n          </button>\n          <button class="dd_option btn btn-small btn-default"\n              data-drilldown-option = "Node"\n              actionHistoricMetric = "capacity.cpu_usage_hz"\n              actionPredictionMetric = "capacity.cpu_usage_predict_hz"\n              actionEntityType = "host" actionParentEntityId = ""\n              actionSelectedEntityId=""\n              actionTopSelectedEntityId=""\n              actionTopSelectedEntityNames =""\n              actionSelectedEntityNames=""\n              actionTypeOfChart="Overview"> <%= i18n(\'by_host\') %>\n          </button>\n        </div>\n        <div data-metric="memory" class="btn-group">\n          <button class="dd_option btn btn-small"\n              actionTargetId = "memory"\n              actionHistoricMetric ="capacity.memory_usage_bytes"\n              actionPredictionMetric = "capacity.memory_usage_predict_bytes"\n              actionEntityType = "cluster"\n              actionParentEntityId = "" data-drilldown-option = "Data"\n              actionSelectedEntityId = ""\n              actionSelectedEntityNames=""\n              actionTypeOfChart="Individual"> <%= i18n(\'overall\') %>\n          </button>\n          <button class="dd_option btn btn-small btn-default"\n              data-drilldown-option = "Node"\n              actionHistoricMetric = "capacity.memory_usage_bytes"\n              actionPredictionMetric = "capacity.memory_usage_predict_bytes"\n              actionEntityType = "host" actionParentEntityId = ""\n              actionSelectedEntityId=""\n              actionTopSelectedEntityId=""\n              actionTopSelectedEntityNames =""\n              actionSelectedEntityNames=""\n              actionTypeOfChart="Overview"> <%= i18n(\'by_host\') %>\n          </button>\n        </div>\n      </div>\n      <div class="selectbox-list">\n        <div data-select-metric="storage">\n           \x3c!-- @view --\x3e\n        </div>\n        <div data-select-metric="cpu">\n          \x3c!-- @view --\x3e\n        </div>\n        <div data-select-metric="memory">\n          \x3c!-- @view --\x3e\n        </div>\n      </div>\n    </div>\n    \x3c!-- TODO : Refactor all the action attributes such that the values are\n        maintained in the JS file--\x3e\n    <div class="right-actions">\n      <div class="legend">\n        <span class="eff-cap-line legend-lines"></span>\n        <div class="eff-cap">\n          <%= i18n(\'effective_capacity\') %> <span class="eff-cap-text"></span>\n        </div>\n      </div>\n    </div>\n  </div>\n  <div class="tableTitle table-title"></div>\n  <div class="tabular-view"></div>\n</div>'}),define("views/details/tabs/CPDrillDownSubView",["views/basecomponents/BaseSubView","views/details/tabs/CPTableView","utils/AppUtil","utils/AppConstants","utils/FilterUtil","models/query/QueryResultCollection","models/capacityplanning/CPQueryModel","data/DataProperties","managers/I18nManager","text!templates/basecomponents/details/CapacityPlanning/CPDrillDownSubView.html"],function(e,t,i,n,s,a,r,o,l,c){"use strict";var u=_.template('<select class="<%= entitySelectBox %>">  <option selected=selected value="overview">   All Storage Containers</option>   <% _.each(options, function(opt) { %>     <option value="<%=opt.get("id")%>"        data-additional="<%=opt.get("id")%>">      <%= (opt.get("container_name") !== "-") ?        opt.get("container_name") : opt.get("id")%>       - Runway : <%=AppUtil.processRunwayNumber(opt.get(runway))%>      </option>   <% }) %></select>'),d=_.template('<select class="<%= entitySelectBox %>">  <option selected="selected" value="overview">   All Hosts</option>   <% _.each(options, function(opt) { %>     <option value="<%=opt.get("id")%>"        data-additional="<%=opt.get("id")%>">      <%= (opt.get("node_name") !== "-") ?        opt.get("node_name") : opt.get("id")%>       - Runway : <%=AppUtil.processRunwayNumber(opt.get(runway))%>      </option>   <% }) %></select>'),h="CPDrillDownSubView",p={STORAGE_CLUSTER_BY_USAGE:l.t(h,"storage_cluster_usage_title"),STORAGE_CLUSTER_BY_CONTAINER:l.t(h,"storage_cluster_cotainer_title"),STORAGE_CONTAINER:l.t(h,"storage_container_title"),CPU_CLUSTER_BY_USAGE:l.t(h,"cpu_cluster_usage_title"),CPU_CLUSTER_BY_HOST:l.t(h,"cpu_cluster_host_title"),CPU_HOST:l.t(h,"cpu_host_title"),MEMORY_CLUSTER_BY_USAGE:l.t(h,"memory_cluster_usage_title"),MEMORY_CLUSTER_BY_HOST:l.t(h,"memory_cluster_host_title"),MEMORY_HOST:l.t(h,"memory_host_title")},T={DATA:"Data",HOST:"Node",CONTAINER:"Container"},E={ID:"id",VM:"vm",VM_NAME:"vm_name",CONTAINER_NAME:"container_name",ENTITY_ID:"entity_id",NODE_NAME:"node_name",MEMORY_RUNWAY:"capacity.memory_runway",MEMORY_USAGE_BYTES:"capacity.memory_usage_bytes",MEMORY_SIZE_BYTES:"memory_size_bytes",MEMORY_USGE:"memory_usage_bytes",HYP_MEM_USAGE_PPM:"hypervisor_memory_usage_ppm",DISK_RUNWAY:"capacity.storage_runway",STORAGE_USAGE_BYTES:"storage.usage_bytes",CONTAINER_CAPACITY:"storage.capacity_bytes",CPU_RUNWAY:"capacity.cpu_runway",CPU_USAGE_HZ:"capacity.cpu_usage_hz",CPU_CAPACITY_HZ:"capacity.cpu_capacity_hz",STORAGE_ONLY_NODE:"capacity.storage_only_node",HYP_CPU_USAGE_PPM:"hypervisor_cpu_usage_ppm",NUM_V_CPU_USAGE:"num_vcpus",CAP_V_CPU_USAGE:"capacity.vcpu_usage",STORAGE_UNRESERVED:"capacity.storage_without_reservation_bytes",EFFECTIVE_CAPACITY_REASON:"capacity.storage_effective_capacity_info",EFFECTIVE_CAPACITY_BYTES:"capacity.storage_effective_capacity_bytes"};return e.extend({name:h,subViewTemplate:_.template(c),modelEvents:{"reset  hostCollectionForCPU":"renderHostSelectBoxForEntity","error  hostCollectionForCPU":"onCollectionError","reset  hostCollectionForMemory":"renderHostSelectBoxForEntity","error  hostCollectionForMemory":"onCollectionError","reset  containerCollectionForCP":"renderContainerSelectBoxForEntity","error  containerCollectionForCP":"onCollectionError"},events:{"click  .dd_option":"onClickLinkAction","change .hostSelectBox":"switchViewOnHostSelection","change .containerSelectBox":"switchViewOnContainerSelection"},selectedTab:{storage:null,cpu:null,memory:null},selectedEntityType:{storage:null,cpu:null,memory:null},tabSetForSelectedRunway:null,currentDrillDownForSelectedRunway:null,hostCollectionForCPU:null,hostCollectionForMemory:null,containerCollectionForCP:null,currentSelectedEntityId:null,currentClusterUUID:null,initialize:function(t){var i=this;e.prototype.initialize.apply(this,arguments),this.parentView=t.parentView,_.bindAll(this,"showModelError"),this.hostCollectionForCPU=new a,this.hostCollectionForMemory=new a,this.containerCollectionForCP=new a,this.sharedModel=t.sharedModel,this.parentView.on("cpDataNotReady",function(e){i.noDataAvailableView(e)})},render:function(){this.$el.html(this.subViewTemplate(this.vtOptions())),this.selectedEntityType={storage:n.ENTITY_CLUSTER,cpu:n.ENTITY_CLUSTER,memory:n.ENTITY_CLUSTER},this.selectedTab={storage:T.DATA,cpu:T.DATA,memory:T.DATA}},destroy:function(){i.debug("CPDrillDownSubView : destroy: "," | viewid     : "+this.cid),e.prototype.destroy.apply(this,arguments)},refreshView:function(e,t){if(e!==this.selectedRunwayOption||t){this.showRelatedSelectedMetricOptions(e);var i="."+this.selectedRunwayOption+"Option";if("false"!==$(i).attr("data-first-click")){var s=$(i).attr("actionEntityType");s!==n.ENTITY_CLUSTER&&(this.specialScenarioHandling=!0,this.specialEntityType=s,this.specialEntityId=$(i).attr("actionSelectedEntityId")),$(i).attr("data-first-click",!1)}this.handleTabChange(this.selectedTab[this.selectedRunwayOption]),this.selectDeSelectTab(),t||this.$(".selectedBtnOpt").addClass("selected-btn-opt")}},onStartServices:function(){this.tableView&&this.tableView.startServices(),this.delegateEvents(),this.delegateModelEvents()},onStopServices:function(){this.tableView&&this.tableView.stopServices(),this.undelegateEvents(),this.undelegateModelEvents()},setModelId:function(e){this.$(".cluster_name").html(this.clusterManager.getClusterCollection().findModelByUuid(e).get(o.NAME)),this.currentSelectedEntityId=e,this.currentClusterUUID=e;var t=this.$("[data-metric = storage]");t.find("[data-drilldown-option = "+T.DATA+"]").attr("actionSelectedEntityId",this.currentClusterUUID),t.find("[data-drilldown-option = "+T.DATA+"]").attr("actionEntityType",this.selectedEntityType[this.selectedRunwayOption])},selectDeSelectTab:function(){this.$(".selectedBtnOpt").removeClass("selectedBtnOpt"),this.$('[data-metric = "'+this.selectedRunwayOption+'"]').find('[data-drilldown-option = "'+this.selectedTab[this.selectedRunwayOption]+'"]').addClass("selectedBtnOpt")},setViewOption:function(e,t){switch(this.selectedTab[this.selectedRunwayOption]=e,this.selectedTab[this.selectedRunwayOption]){case T.HOST:this.selectedTab[this.selectedRunwayOption]=T.HOST;break;case T.CONTAINER:this.selectedTab[this.selectedRunwayOption]=T.CONTAINER;break;case T.DATA:this.selectedTab[this.selectedRunwayOption]=T.DATA}this.selectDeSelectTab()},onClickLinkAction:function(e){var t=$(e.currentTarget).attr("data-drilldown-option");$(e.currentTarget).attr("actionEntityType");this.setTabActive($(e.currentTarget)),this.selectedTab[this.selectedRunwayOption]=t,this.currentSelectedEntityId=this.currentClusterUUID,this.selectedEntityType[this.selectedRunwayOption]=n.ENTITY_CLUSTER,this.setValForActionAttribute(),this.setCustomValsForEntityOverViewCharts(),this.refreshView(this.selectedRunwayOption,!0),this.clearSubEntitySelectBox()},setTabActive:function(e){this.$(".selected-btn-opt").removeClass("selected-btn-opt"),e.addClass("selected-btn-opt")},handleTabChange:function(e,t){var i={};this.setViewOption(e,t),this.currentSelectedEntityId=this.$("[data-metric = "+this.selectedRunwayOption+"]").find("[data-drilldown-option = "+this.selectedTab[this.selectedRunwayOption]+"]").attr("actionselectedentityid");var s=this.$("[data-metric = "+this.selectedRunwayOption+"]").find("[data-drilldown-option = "+this.selectedTab[this.selectedRunwayOption]+"]").attr("actionEntityType"),a=this.currentSelectedEntityId?this.currentSelectedEntityId:this.currentClusterUUID;switch(e){case T.HOST:case T.CONTAINER:this.setQueryOptions(),this.setQueryOptionsForEffectiveCapacity(n.ENTITY_CLUSTER,this.currentClusterUUID);break;case T.DATA:if(this.specialScenarioHandling)return void this.specialFirstTimeRendering();this.setQueryOptionsForEffectiveCapacity(s,a);this.$("[data-metric = "+this.selectedRunwayOption+"]").find("[data-drilldown-option = "+T.DATA+"]").attr("actionSelectedEntityId",a),i=this.createAttributeObjForTableView(s,a);var r,l;this.selectedRunwayOption===o.STORAGE_RUNWAY?(r=n.CP_ENTITY_STORAGE_USAGE,l=s===n.ENTITY_CLUSTER?p.STORAGE_CLUSTER_BY_USAGE:p.STORAGE_CONTAINER):this.selectedRunwayOption===o.CPU_RUNWAY?(r=n.CP_ENTITY_CPU_USAGE,l=s===n.ENTITY_CLUSTER?p.CPU_CLUSTER_BY_USAGE:p.CPU_HOST):(r=n.CP_ENTITY_MEMORY_USAGE,l=s===n.ENTITY_CLUSTER?p.MEMORY_CLUSTER_BY_USAGE:p.MEMORY_HOST),this.renderTableView(r,i,null),this.renderTableTitle(l),this.clearSubEntitySelectBox(),this.currentSelectedEntityId!==this.currentClusterUUID&&(this.selectedRunwayOption===o.CPU_RUNWAY?this.hostCollectionForCPU&&this.hostCollectionForCPU.models.length&&this.setCustomValsForSelectedEntityChart(this.hostCollectionForCPU,this.currentSelectedEntityId):this.selectedRunwayOption===o.MEMORY_RUNWAY?this.hostCollectionForMemory&&this.hostCollectionForMemory.models.length&&this.setCustomValsForSelectedEntityChart(this.hostCollectionForMemory,this.currentSelectedEntityId):this.selectedRunwayOption===o.STORAGE_RUNWAY&&this.containerCollectionForCP&&this.containerCollectionForCP.models.length&&this.setCustomValsForSelectedEntityChart(this.containerCollectionForCP,this.currentSelectedEntityId)),this.parentView.updateChart()}this.parentView.trigger("cpDataLoading")},clearSubEntitySelectBox:function(){this.selectedEntityType[this.selectedRunwayOption]===n.ENTITY_CLUSTER&&(this.currentDrillDownForSelectedRunway.find(".hostSelectBox").parent().remove(),this.currentDrillDownForSelectedRunway.find(".containerSelectBox").parent().remove(),i.addSVGClass(this.$(".capacity-drilldown-options .-right-caret"),"hide"))},createAttributeObjForTableView:function(e,t){var i={},a={group_member_sort_order:n.SORT_ASCENDING,group_member_count:10,group_member_offset:0};if(this.selectedRunwayOption===o.STORAGE_RUNWAY)e===n.ENTITY_CLUSTER?_.extend(a,{entity_type:n.ENTITY_CLUSTER,entity_ids:[t],group_member_attributes:[o.CP_LIVE_USAGE,o.CP_SNAPSHOT_USAGE,o.CP_RESERVED_FREE_USAGE,o.CP_SYSTEM_USAGE,o.CP_EC_BYTES,o.CP_DEDUP_BYTES,o.CP_GARBAGE_BYTES,o.CP_OTHER_USAGE_BYTES,o.CP_LIVE_GAIN,o.CP_SYSTEM_GAIN,o.CP_SNAPSHOT_GAIN]}):_.extend(a,{entity_type:n.ENTITY_CONTAINER,entity_ids:[t],group_member_attributes:[o.CP_STORAGE_SYSTEM_USAGE,o.CP_STORAGE_LIVE_USAGE,o.CP_RESERVED_USAGE,o.CP_SSHOT_RECLAIM_BYTES,o.CP_STORAGE_EC_BYTES,o.CP_STORAGE_DEDUP_BYTES,o.CP_STORAGE_GARBAGE_BYTES,o.CP_OTHER_USAGE_BYTES,o.CP_SYSTEM_GAIN,o.CP_LIVE_GAIN,o.CP_SNAPSHOT_GAIN]});else{var r=s.addFilterCondition(i,e.toLowerCase(),s.createFilterCondition(e.toLowerCase(),e.toLowerCase(),n.FILTER_OPERATORS.EQUALS,t));s.addFilterCondition(i,o.EB.VM.POWER_STATE,s.createFilterCondition(n.ENTITY_VM,o.EB.VM.POWER_STATE,n.FILTER_OPERATORS.EQUALS,n.VM_POWER_STATE.ON)),s.addFilterCondition(i,o.EB.VM.IS_CVM,s.createFilterCondition(n.ENTITY_VM,o.EB.IS_CVM,n.FILTER_OPERATORS.EQUALS,n.FILTER_NOT_INCLUDE_CVM)),this.selectedRunwayOption===o.CPU_RUNWAY?(r=s.addFilterCondition(r,E.CAP_V_CPU_USAGE,s.createFilterCondition(n.ENTITY_VM,E.CAP_V_CPU_USAGE,n.FILTER_OPERATORS.GREATER_THAN,0)),_.extend(a,{entity_type:n.ENTITY_VM,filter_expression:r,group_member_sort_attribute:E.CAP_V_CPU_USAGE,group_member_attributes:[E.VM_NAME,E.HYP_CPU_USAGE_PPM,E.NUM_V_CPU_USAGE,E.CAP_V_CPU_USAGE],group_member_sort_order:n.SORT_DESCENDING})):(r=s.addFilterCondition(r,E.MEMORY_USGE,s.createFilterCondition(n.ENTITY_VM,E.MEMORY_USGE,n.FILTER_OPERATORS.GREATER_THAN,0)),_.extend(a,{entity_type:n.ENTITY_VM,filter_expression:r,group_member_sort_attribute:E.MEMORY_USGE,group_member_attributes:[E.VM_NAME,E.MEMORY_USGE,o.STATS_MEMORY_USAGE],group_member_sort_order:n.SORT_DESCENDING}))}return a},setQueryOptions:function(){var e,t,i=[],a=Date.now();n.MILLIS_PER_DAY;this.selectedRunwayOption===o.MEMORY_RUNWAY?(e=n.ENTITY_HOST,i=[E.NODE_NAME,E.MEMORY_RUNWAY,E.MEMORY_USAGE_BYTES,E.MEMORY_SIZE_BYTES,E.STORAGE_ONLY_NODE,o.MEMORY_RUNWAY_INFO],t=E.MEMORY_USAGE_BYTES):this.selectedRunwayOption===o.CPU_RUNWAY?(e=n.ENTITY_HOST,i=[E.NODE_NAME,E.CPU_RUNWAY,E.CPU_USAGE_HZ,E.CPU_CAPACITY_HZ,E.STORAGE_ONLY_NODE,o.CPU_RUNWAY_INFO],t=E.CPU_USAGE_HZ):(e=n.ENTITY_CONTAINER,i=[E.CONTAINER_NAME,E.DISK_RUNWAY,E.STORAGE_USAGE_BYTES,E.CONTAINER_CAPACITY,E.EFFECTIVE_CAPACITY_BYTES,E.EFFECTIVE_CAPACITY_REASON,o.CP_STORAGE_ACTUAL_CAPACITY,o.STORAGE_RUNWAY_INFO],t=E.STORAGE_USAGE_BYTES);var l={},c=s.addFilterCondition(l,n.ENTITY_CLUSTER,s.createFilterCondition(n.ENTITY_CLUSTER,n.ENTITY_CLUSTER,n.FILTER_OPERATORS.EQUALS,this.currentClusterUUID)),u={entity_type:e,group_member_attributes:i,group_member_sort_attribute:t,filter_expression:c,group_member_sort_order:n.SORT_DESCENDING};switch(this.selectedRunwayOption){case o.CPU_RUNWAY:this.hostCollectionForCPU.setQueryModel(new r(u)),this.hostCollectionForCPU.fetch();break;case o.MEMORY_RUNWAY:this.hostCollectionForMemory.setQueryModel(new r(u)),this.hostCollectionForMemory.fetch();break;case o.STORAGE_RUNWAY:this.containerCollectionForCP.setQueryModel(new r(u)),this.containerCollectionForCP.fetch()}},removeStorageOnlyHosts:function(e){var t;t=_.filter(e.models,function(e){if("1"===e.get(E.STORAGE_ONLY_NODE))return!0}),_.each(t,function(t){e.remove(t)})},renderHostSelectBoxForEntity:function(e,t){var s=[],a=[],r=[],l=[];if(e.models.length){this.removeStorageOnlyHosts(e);var c=d({eType:this.selectedTab[this.selectedRunwayOption],options:e.models,entitySelectBox:"hostSelectBox",clusterID:this.currentClusterUUID,AppUtil:i,runway:this.selectedRunwayOption===o.CPU_RUNWAY?E.CPU_RUNWAY:E.MEMORY_RUNWAY});if(this.currentDrillDownForSelectedRunway.empty(),this.currentDrillDownForSelectedRunway.append(c),!this.specialScenarioHandling){this.selectedRunwayOption===o.MEMORY_RUNWAY?E.MEMORY_RUNWAY:E.CPU_RUNWAY,_.each(e.models,function(e,t){t<3?(r.push(e.getId()),l.push(e.get(E.NODE_NAME)[0])):(s.push(e.getId()),a.push(e.get(E.NODE_NAME)[0]))},this)}}else i.log("No"+this.selectedTab[this.selectedRunwayOption]+"available for the "+this.selectedEntityType[this.selectedRunwayOption]);this.specialScenarioHandling||(this.tabSetForSelectedRunway.find("[data-drilldown-option = "+T.HOST+"]").attr("actionSelectedEntityId",s).attr("actionSelectedEntityNames",a).attr("actionTopSelectedEntityId",r).attr("actionTopSelectedEntityNames",l),this.selectedRunwayOption===o.CPU_RUNWAY?(this.renderTableView(n.CP_CLUSTER_HOST_CPU_OVERVIEW,null,this.hostCollectionForCPU,!0),this.renderTableTitle(p.CPU_CLUSTER_BY_HOST)):(this.renderTableView(n.CP_CLUSTER_HOST_MEMORY_OVERVIEW,null,this.hostCollectionForMemory,!0),this.renderTableTitle(p.MEMORY_CLUSTER_BY_HOST)),this.parentView.updateChart()),this.specialScenarioHandling&&this.specialEntityType===T.HOST.toLowerCase()&&(this.specialScenarioHandling=!1,this.switchViewOnHostSelection(null,!0,this.specialEntityId,!0)),i.removeSVGClass(this.$(".capacity-drilldown-options .-right-caret"),"hide"),this.applyNutanixInput()},renderContainerSelectBoxForEntity:function(e,t){var s=[],a=[],r=[],o=[];if(e.models.length){var l=u({eType:this.selectedTab[this.selectedRunwayOption],options:e.models,entitySelectBox:"containerSelectBox",clusterID:this.currentClusterUUID,AppUtil:i,runway:E.DISK_RUNWAY});this.currentDrillDownForSelectedRunway.empty(),this.currentDrillDownForSelectedRunway.append(l),this.specialScenarioHandling||_.each(e.models,function(e,t){t<3?(r.push(e.getId()),o.push(e.get(E.CONTAINER_NAME)[0])):(s.push(e.getId()),a.push(e.get(E.CONTAINER_NAME)[0]))},this)}else i.log("No"+this.selectedTab[this.selectedRunwayOption]+"available for the "+this.selectedEntityType[this.selectedRunwayOption]);this.specialScenarioHandling||(this.tabSetForSelectedRunway.find("[data-drilldown-option = "+T.CONTAINER+"]").attr("actionSelectedEntityId",s).attr("actionSelectedEntityNames",a).attr("actionTopSelectedEntityId",r).attr("actionTopSelectedEntityNames",o),this.renderTableView(n.CP_CLUSTER_CONTAINER_STORAGE_OVERVIEW,null,this.containerCollectionForCP,!0),this.renderTableTitle(p.STORAGE_CLUSTER_BY_CONTAINER),this.parentView.updateChart()),this.specialScenarioHandling&&this.specialEntityType===T.CONTAINER.toLowerCase()&&(this.specialScenarioHandling=!1,this.switchViewOnContainerSelection(null,!0,this.specialEntityId,!0)),i.removeSVGClass(this.$(".capacity-drilldown-options .-right-caret"),"hide"),this.applyNutanixInput()},getSubEntityName:function(e){var t,i;switch(this.selectedRunwayOption){case o.MEMORY_RUNWAY:t=this.hostCollectionForMemory.findModelById(e),i=E.NODE_NAME;break;case o.CPU_RUNWAY:t=this.hostCollectionForCPU.findModelById(e),i=E.NODE_NAME;break;case o.STORAGE_RUNWAY:t=this.containerCollectionForCP.findModelById(e),i=E.CONTAINER_NAME}return t?t.get(i):null},onCollectionError:function(){i.log("Error in retrieving the collection"),this.parentView.trigger("cpDataErrorOccurred",{isError:!0}),this.$(".tabular-view").empty()},switchViewOnHostSelection:function(e,t,i,s){this.selectedEntityType[this.selectedRunwayOption]=T.HOST;var a=this.currentDrillDownForSelectedRunway.find(".hostSelectBox option:selected",'select[name="options"]');if(this.currentSelectedEntityId=i||a.val(),this.setTabActive(this.tabSetForSelectedRunway.find("[data-drilldown-option = "+T.HOST+"]")),t)this.entitySelectBoxViewManipulation("hostSelectBox",i),this.selectedRunwayOption===o.CPU_RUNWAY?this.setCustomValsForSelectedEntityChart(this.hostCollectionForCPU,i):this.setCustomValsForSelectedEntityChart(this.hostCollectionForMemory,i);else{if("overview"===a.val())return this.selectedTab[this.selectedRunwayOption]=T.HOST,this.currentSelectedEntityId=this.currentClusterUUID,this.selectedEntityType[this.selectedRunwayOption]=n.ENTITY_CLUSTER,this.setValForActionAttribute(),this.setCustomValsForEntityOverViewCharts(),void this.refreshView(this.selectedRunwayOption,!0);this.selectedRunwayOption===o.CPU_RUNWAY?this.setCustomValsForSelectedEntityChart(this.hostCollectionForCPU,a.val()):this.setCustomValsForSelectedEntityChart(this.hostCollectionForMemory,a.val())}this.setValForActionAttribute(),this.handleTabChange(T.DATA)},switchViewOnContainerSelection:function(e,t,i,s){this.selectedEntityType[this.selectedRunwayOption]=T.CONTAINER;var a=this.currentDrillDownForSelectedRunway.find(".containerSelectBox option:selected",'select[name="options"]');if(this.setTabActive(this.tabSetForSelectedRunway.find("[data-drilldown-option = "+T.CONTAINER+"]")),this.currentSelectedEntityId=i||a.val(),t)this.entitySelectBoxViewManipulation("containerSelectBox",i),this.setCustomValsForSelectedEntityChart(this.containerCollectionForCP,i);else{if("overview"===a.val())return this.selectedTab[this.selectedRunwayOption]=T.CONTAINER,this.currentSelectedEntityId=this.currentClusterUUID,this.selectedEntityType[this.selectedRunwayOption]=n.ENTITY_CLUSTER,this.setValForActionAttribute(),this.setCustomValsForEntityOverViewCharts(),void this.refreshView(this.selectedRunwayOption,!0);this.setCustomValsForSelectedEntityChart(this.containerCollectionForCP,a.val())}this.setValForActionAttribute(),this.handleTabChange(T.DATA)},renderTableView:function(e,i,s,a){this.tableView=new t({entityType:e,pageId:n.PAGE_MC_DASHBOARD,enableDefaultTableFilter:!0,parentView:this,clusterId:this.currentClusterUUID,attrObj:i,model:s}),this.$(".tabular-view").empty(),this.$(".tabular-view").append(this.tableView.render().el),a||(this.tableView.refreshData(),this.tableView.onStartServices())},renderTableTitle:function(e){this.$(".tableTitle").text(e)},setValForActionAttribute:function(){this.tabSetForSelectedRunway.find("[data-drilldown-option = "+T.DATA+"]").attr("actionSelectedEntityId",this.currentSelectedEntityId),this.tabSetForSelectedRunway.find("[data-drilldown-option = "+T.DATA+"]").attr("actionEntityType",this.selectedEntityType[this.selectedRunwayOption])},setCustomValsForEntityOverViewCharts:function(){var e="."+this.selectedRunwayOption+"Option",t=this.parentView.getClusterRunwayVals(this.selectedRunwayOption);this.sharedModel.set(this.sharedModel.DP.SELECTED_METRIC_RUNWAY_VAL,t),this.sharedModel.set(this.sharedModel.DP.CURRENT_MAX_CHART_YVAL,i.parseToFloat($(e).attr("data-max-y-val"),0)),this.parentView.cpChartView&&this.parentView.cpChartView.updateSomeChartProperties(t,i.parseToFloat($(e).attr("data-max-y-val"),0),this.selectedRunwayOption)},setCustomValsForSelectedEntityChart:function(e,t){var n,s,a;this.selectedRunwayOption===o.STORAGE_RUNWAY?(n=this.selectedEntityType[this.selectedRunwayOption]===T.CONTAINER?o.CP_STORAGE_ACTUAL_CAPACITY:o.CP_STORAGE_IN_TB,s=E.DISK_RUNWAY,a=o.STORAGE_RUNWAY_INFO):this.selectedRunwayOption===o.CPU_RUNWAY?(n=E.CPU_CAPACITY_HZ,s=E.CPU_RUNWAY,a=o.CPU_RUNWAY_INFO):(n=E.MEMORY_SIZE_BYTES,s=E.MEMORY_RUNWAY,a=o.MEMORY_RUNWAY_INFO),_.each(e.models,function(e){if(e.getId()===t){this.sharedModel.set(this.sharedModel.DP.CURRENT_MAX_CHART_YVAL,i.parseToFloat(e.get(n),0)),this.sharedModel.set(this.sharedModel.DP.CURRENT_MAX_CHART_YVAL_REASON,e.get(void 0)),this.sharedModel.set(this.sharedModel.DP.SELECTED_METRIC_RUNWAY_VAL,i.processRunwayNumber(e.get(s)));var r="";try{r=JSON.parse(e.get(a)).reason}catch(e){i.log("CPDrillDownSubView: cannot parse reason: "+e)}this.sharedModel.set(this.sharedModel.DP.NO_PREDICTION_REASON,r),this.parentView.cpChartView&&this.parentView.cpChartView.updateSomeChartProperties(i.processRunwayNumber(e.get(s)),i.parseToFloat(e.get(n),0),this.selectedRunwayOption,e.get(void 0))}},this),i.removeSVGClass(this.$(".capacity-drilldown-options .-right-caret"),"hide")},showRelatedSelectedMetricOptions:function(e){switch(e){case o.CPU_RUNWAY:this.$("[data-metric = cpu]").show(),this.$("[data-metric = storage]").hide(),this.$("[data-metric = memory]").hide(),this.$("[data-select-metric = storage]").hide(),this.$("[data-select-metric = memory]").hide(),this.$("[data-select-metric = cpu]").show(),this.selectedRunwayOption=o.CPU_RUNWAY;break;case o.MEMORY_RUNWAY:this.$("[data-metric = memory]").show(),this.$("[data-metric = storage]").hide(),this.$("[data-metric = cpu]").hide(),this.$("[data-select-metric = storage]").hide(),this.$("[data-select-metric = memory]").show(),this.$("[data-select-metric = cpu]").hide(),this.selectedRunwayOption=o.MEMORY_RUNWAY;break;case o.STORAGE_RUNWAY:this.$("[data-metric = storage]").show(),this.$("[data-metric = memory]").hide(),this.$("[data-metric = cpu]").hide(),this.$("[data-select-metric = storage]").show(),this.$("[data-select-metric = memory]").hide(),this.$("[data-select-metric = cpu]").hide(),this.selectedRunwayOption=o.STORAGE_RUNWAY}this.tabSetForSelectedRunway=this.$("[data-metric = "+this.selectedRunwayOption+"]"),this.currentDrillDownForSelectedRunway=this.$("[data-select-metric = "+this.selectedRunwayOption+"]")},setQueryOptionsForEffectiveCapacity:function(e,t){var s,a,l,c=this;if(this.selectedRunwayOption===o.STORAGE_RUNWAY)s=o.CP_STORAGE_EFFECTIVE_CAPACITY,a=o.CP_STORAGE_EFFECTIVE_CAPACITY_REASON;else if(this.selectedRunwayOption===o.CPU_RUNWAY){if(this.selectedEntityType[this.selectedRunwayOption]===T.HOST)return void this.parentView.setEffectiveCapacity(null);s=o.CP_CPU_EFFECTIVE_CAPACITY,a=o.CP_CPU_EFFECTIVE_CAPACITY_REASON}else{if(this.selectedEntityType[this.selectedRunwayOption]===T.HOST)return void this.parentView.setEffectiveCapacity(null);s=o.CP_MEMORY_EFFECTIVE_CAPACITY,a=o.CP_MEMORY_EFFECTIVE_CAPACITY_REASON}l=[s,a];var u={entity_type:e.toLowerCase(),group_member_attributes:l,entity_ids:[t]};this.effectiveCapacityModel=new r(u),this.effectiveCapacityModel.setTimeInterval(Date.now()-7*n.MILLIS_PER_DAY,Date.now(),n.SAMPLING_INTERVAL_IN_SECS_FOR_A_DAY),this.effectiveCapacityModel.save(null,{success:function(e,t){var r=c.effectiveCapacityModel.getQueryResultAttributes();if(r[0]){var o=i.parseToFloat(r[0][s],0),l="";try{l=JSON.parse(r[0][a]).reason}catch(e){i.log("CPDrillDownSubView: cannot parse effective capacity: "+e)}o!==n.STATS_NO_VALUE?c.parentView.setEffectiveCapacity(o,l):c.parentView.setEffectiveCapacity(null)}},error:function(e,t){i.log("Error retrieving effective storage capacity.")}})},entitySelectBoxViewManipulation:function(e,t){var i=this.currentDrillDownForSelectedRunway.find("."+e).find(":selected");$(i).removeAttr("selected"),this.currentDrillDownForSelectedRunway.find("."+e).find('option[data-additional="'+t+'"]').attr("selected",!0),this.currentDrillDownForSelectedRunway.find("."+e).trigger("update")},specialFirstTimeRendering:function(){this.setQueryOptions(),this.showRelatedSelectedMetricOptions(this.selectedRunwayOption),this.selectedTab[this.selectedRunwayOption]=this.specialEntityType,this.selectedEntityType[this.selectedRunwayOption]=this.specialEntityType,this.currentSelectedEntityId=this.specialEntityId,this.tabSetForSelectedRunway.find('[data-drilldown-option = "'+this.specialEntityType+'" ]').hide(),this.tabSetForSelectedRunway.find('[data-drilldown-option = "'+T.DATA+'"]').attr("actionEntityType",this.specialEntityType)},noDataAvailableView:function(e){e.isNotReady&&this.$(".tab_set_view").hide()}})}),
define("text!templates/basecomponents/details/CapacityPlanning/CPRecommendationSubView.html",[],function(){return'<div class="capacity-recommendation">\n  <div class="title"><%= i18n(\'optimize_resource\') %></div>\n  <div class="desc"><%= i18n(\'optimize_desc\') %></div>\n  <div class="content">\n    <button class="btn btnShowRecommendation">\n    <%= i18n(\'view_recommendations\') %>\n    </button>\n  </div>\n</div>'}),define("views/details/tabs/CPRecommendationSubView",["views/basecomponents/BaseSubView","utils/AppConstants","managers/PopupManager","text!templates/basecomponents/details/CapacityPlanning/CPRecommendationSubView.html"],function(e,t,i,n){"use strict";return e.extend({name:"CPRecommendationSubView",subViewTemplate:_.template(n),events:{"click  .btnShowRecommendation":"displayPopUp"},render:function(){this.$el.html(this.subViewTemplate(this.vtOptions()))},setModelId:function(e){this.clusterId=e},displayPopUp:function(e){i.handleAction({action:t.ACTION_SHOW_CP_RECOMMENDATION,actionTarget:t.ENTITY_CLUSTER,actionTargetId:this.clusterId})}})}),define("text!templates/basecomponents/pagepopups/BasePagePopupView.html",[],function(){return'<div class="modal-header">\n  <button type="button" class="close" data-dismiss="modal">\n    <i data-icon="K" aria-hidden="true"></i>\n  </button>\n  <h4 class="n-title"><%= title || \'no-title\' %></h4>\n</div>\n<div class="n-modal-wrapper">\n  <div class="n-modal-body">\n    <div class="n-modal-content-wrapper">\n      <div class="n-modal-alert-header">\n        \x3c!-- @view: alert goes here... --\x3e\n      </div>\n      <div class="n-modal-content">\n      \x3c!-- @subview goes here.. --\x3e\n      </div>\n    </div>\n  </div>\n</div>'}),define("views/basecomponents/popups/BasePagePopupView",["views/basecomponents/popups/BasePopupView","utils/SubViewHelper","utils/AppConstants","text!templates/basecomponents/pagepopups/BasePagePopupView.html"],function(e,t,i,n){"use strict";var s=_.template(n);return e.extend({DEFAULT_POPUP_PROP:{title:"Title",subViewContainerEl:".n-modal-content"},el:"#pagePopup",subViewHelper:null,currentSubViewId:null,popupProp:null,initialize:function(){e.prototype.initialize.apply(this,arguments),$(this.el).addClass("n-page-popup"),this.subViewHelper=new t,this.popupProp=this.initializeProperties()},initializeProperties:function(){return $.extend(this.DEFAULT_POPUP_PROP)},render:function(){this.$el.html(s(this.popupProp))},hide:function(){e.prototype.hide.apply(this,arguments),this.subViewHelper.destroy()},selectSubView:function(e){var t,i;t=this.subViewHelper.get(this.currentSubViewId),t&&t.hideView(),i=e.subViewId,t=this.subViewHelper.get(i),this.currentSubViewId=i;var n=e.options||{};if(t)t.setViewOption(n);else{$('<div id="'+i+'" ></div>').appendTo(this.popupProp.subViewContainerEl),t=this.createSubView(i),this.subViewHelper.register(this.currentSubViewId,t),t.setParentView(this),t.setViewOption(n),t.render()}this._showSubView(t)},_showSubView:function(e){e&&(e.refreshView(),e.showView())},createSubView:function(e){},isModelInitialized:function(){return!1},showSuccess:function(e){this.showHeaderSuccess(e)},showError:function(e){this.showHeaderError(e)},showInfo:function(e){this.showHeaderInfo(e)},onViewTransition:function(e){var t=this.subViewHelper.get(this.currentSubViewId);if(t){var i=_.bind(function(){this.selectSubView(e)},this);t.saveViewData(i)}},onClickLinkAction:function(e){var t=$(e.currentTarget);if(t.hasClass("btnBack")&&this.clearHeader(),t.attr(i.NAV_ACTION)===i.ACTION_SHOW_SUBVIEW){var n={};t.attr("dataEntryId")&&(n.dataEntryId=t.attr("dataEntryId")),this.onViewTransition({subViewId:t.attr(i.NAV_ACTION_TARGET_ID),options:n})}}})}),define("models/capacityplanning/CPScenarioModel",["models/BaseModel","utils/AppUtil","utils/AppConstants","data/DataProperties","data/DataURLConstants"],function(e,t,i,n,s){"use strict";var a={UUID:"uuid",ID:"id",WORKLOAD:"workloadList",ENABLED:"enabled",DISREGARD:"toRemove",TYPE:"workloadType",DATE:"date",VENDOR_TYPE:"vendorList",WARNING_LIST:"warningList",WARNING_MSG:"message",WORKLOAD_ID:"id",HDD:"hddGb",SSD:"ssdGb",CPU:"cpuGhz",MEMORY:"ramGb",CPU_LIST:"cpuGhzList",MEMORY_LIST:"ramGbList",HDD_LIST:"hddGbList",SSD_LIST:"ssdGbList",NAME:"name",RESOURCE_UUID:"resource_uuid",CLUSTER_ID:"clusterUuid",NEW_CLUSTER:"isNewCluster",NODE_TYPES:{EXISTING:"Existing",SYSTEM_RECOMMENDED:"Recommended",USER_ADDED:"UserAdded"},WORKLOAD_TYPES:{APP:"app",VM:"vm",ADJUSTED:"adjusted",EXISTING_VM:"existingvm",NEW_VM_PROFILE:"new-vm-profile",VDI:"vdi",XENAPP:"xen",VM_CATEGORY:"vm_category"},PARAMS_LIST_TYPES:{CATEGORY:"category",VALUE:"value",NUM_VMS_EXISTING:"num_vms_existing",NUM_VMS_CONSIDERED:"num_vms_considered"},PARAMS_LIST:"genericPropertyList",MODEL_CONFIG:"modelConfig",DATA_STORE_CONFIG:"dataStoreConfig",WORKLOAD_SOURCE:"workloadSource",TARGET_RUNWAY_DAYS:"targetRunwayDays",RUNWAY:"minRunwayDays",RUNWAY_GAIN:"runway",CPU_RUNWAY:"cpuRunwayDays",STORAGE_RUNWAY:"storageRunwayDays",MEMORY_RUNWAY:"memoryRunwayDays",RESOURCE_REQUIREMENT:"resourceRequirement",RECOMMENDED_DATE:"recommendedOnlineTimestampSecs",NUMBER_OF_NODES:"numOfNodes",NODE_TYPE:"nodeSource",CLUSTER_SPEC:"clusterSpec",RESOURCE_SPEC:"resourceSpec",NODE_SPEC_LIST:"nodeSpecList",MODEL:"model",SCHEDULE_TIME:"scheduleTimestampSecs",APP_WORKLOAD:"app_workload",ADJUSTED_WORKLOAD:"adjusted_workload",VM_WORKLOAD:"vm_workload",RESOURCE_TIME_SERIES:"resourceTimeSeriesList",START_TIME:"startTimeSec",END_TIME:"endTimeSec",TIME_INTERVAL:"samplingIntervalSec",USAGE_SERIES:"usageTimeSeries",EFFECTIVE_CP_SERIES:"effectiveCapacityTimeSeries",CP_SERIES:"capacityTimeSeries",DATASTORE_CONFIG_ENABLED:"dataStoreConfigEnabled",REPLICATION_FACTOR:"rf",OVERALL_SAVING_PCT:"overall_saving_pct",PDF_TEMP_FILE_NAME:"PDF_47f2a_SCENARIO_TEMP"},r={TOTAL:"total",EFFECTIVE:"effective"},o={RUNWAY:"runway",RECOMMENDATION:"recommendation"},l={RECOMMENDATION:"recommendation",WORKLOAD:"workload"};return e.extend({name:"CPScenarioModel",DP:a,DATA_TYPES:l,CAPACITY_TYPES:r,idAttribute:a.UUID,urlRoot:s.CP_SCENARIO,initialize:function(t){t=t||{},e.prototype.initialize.apply(this,arguments),this.type=t.type,this.set(a.WORKLOAD,[]),this.set(a.NEW_CLUSTER,!1)},parseOptions:function(e,t,i){return i=i||{},i.url=this.getDataSourceURL()+(this.getURL(e,i)||t.url()),i},getURL:function(e,t){return this.type===o.RUNWAY?s.CP_SCENARIO_RUNWAY:this.type===o.RECOMMENDATION?s.CP_SCENARIO_RECOMMENDATION:void 0},parseAndSetData:function(e){this.set(e);var s=t.parseJSON(this.get(n.WORKLOAD_LIST))||[];this.set(a.WORKLOAD,s);var r=t.parseJSON(this.get(n.EXPECTED_RUNWAY))||{};this.set(a.RUNWAY_GAIN,r);var o=t.parseJSON(this.get(n.CLUSTER_SPEC))||{};this.set(a.CLUSTER_SPEC,o),this.set(a.CLUSTER_SPEC,o),this.set(a.CLUSTER_ID,this.get(n.FILTER_CLUSTER_UUID)),this.set(a.TARGET_RUNWAY_DAYS,parseInt(this.get(n.TARGET_RUNWAY_DAYS),10)),this.get(n.VENDOR_LIST)!==i.STATS_NOT_AVAILABLE&&this.set(a.VENDOR_TYPE,[this.get(n.VENDOR_LIST)]);var l=[n.WORKLOAD_LIST,n.EXPECTED_RUNWAY,n.FILTER_CLUSTER_UUID,n.TARGET_RUNWAY_DAYS,n.VENDOR_LIST,n.CLUSTER_SPEC];_.each(l,function(e){this.unset(e)},this),this.set(a.UUID,this.get(a.ID))},findWorkloadWithId:function(e){return _.find(this.get(a.WORKLOAD),function(t){return t[a.WORKLOAD_ID]===e})},findNodeWithId:function(e){return _.find(this.getModelList(),function(t){return t[a.ID]===e})},removeWorkload:function(e){var t=_.reject(this.get(a.WORKLOAD),function(t){return t[a.WORKLOAD_ID]===e});this.set(a.WORKLOAD,t)},removeRecommendation:function(e){var t=_.reject(this.getModelList(),function(t){return t[a.ID]===e});this.setModelList(t)},getModelList:function(){var e=this.get(a.CLUSTER_SPEC);if(e&&e[a.NODE_SPEC_LIST])return e[a.NODE_SPEC_LIST]},setModelList:function(e){var t=this.get(a.CLUSTER_SPEC);t||(this.set(a.CLUSTER_SPEC,{}),t=this.get(a.CLUSTER_SPEC)),t[a.NODE_SPEC_LIST]=e},getDataConfig:function(){var e,t=this.get(a.CLUSTER_SPEC);return t&&t[a.DATA_STORE_CONFIG]&&(e={},_.each(t[a.DATA_STORE_CONFIG],function(t){e[t.key]=t.value})),e},setDataConfig:function(e){var t=this.get(a.CLUSTER_SPEC);if(t||(this.set(a.CLUSTER_SPEC,{}),t=this.get(a.CLUSTER_SPEC)),!e)return void(t[a.DATA_STORE_CONFIG]=null);t[a.DATA_STORE_CONFIG]=[],_.each(_.keys(e),function(i){var n=e[i];i!==a.OVERALL_SAVING_PCT||isNaN(n)||(n=parseFloat(n).toFixed(2)),t[a.DATA_STORE_CONFIG].push({key:i,value:n,valueType:"float"})})},getRecommendedModelList:function(){var e=this.getModelList();if(e)return _.filter(e,function(e){return e[a.NODE_TYPE]===a.NODE_TYPES.SYSTEM_RECOMMENDED})},getWorkloadType:function(e){if(e)return e[a.TYPE]},getRunwayChartData:function(e){var t,i=[];if(e&&this.get(a.CLUSTER_SPEC)&&this.get(a.CLUSTER_SPEC)[a.RESOURCE_TIME_SERIES]){var n=this.getMetricTimeSeries(e);if(n){t=0;for(var s=n[a.START_TIME];s<=n[a.END_TIME];s+=n[a.TIME_INTERVAL])_.isUndefined(n[a.USAGE_SERIES][t])||i.push([1e3*s,n[a.USAGE_SERIES][t]]),t++;return i}}},getMetricTimeSeries:function(e){if(e&&this.get(a.CLUSTER_SPEC))return _.find(this.get(a.CLUSTER_SPEC)[a.RESOURCE_TIME_SERIES],function(t){return t[a.NAME]===e})},getTimeSeriesValueAt:function(e,t,i){for(var n=0,s=e[a.START_TIME];s<=e[a.END_TIME];s+=e[a.TIME_INTERVAL]){if(s>=t)return e[i][n];n++}},getCapacityData:function(e,t){var i,n=[];t=t||r.EFFECTIVE;var s=t===r.EFFECTIVE?a.EFFECTIVE_CP_SERIES:a.CP_SERIES,o=this.getMetricTimeSeries(e);if(o){for(var l=0,c=o[a.START_TIME];c<=o[a.END_TIME];c+=o[a.TIME_INTERVAL])i!==o[s][l]&&n.push([1e3*c,o[s][l]]),i=o[s][l],l++;return n}},getWorkloadDateAndMetric:function(e,t,i,n){var s,r,o=[];n=n||this,i===l.WORKLOAD?(s=this.get(a.WORKLOAD),r=a.SCHEDULE_TIME):(s=this.getModelList(),r=a.RECOMMENDED_DATE);var c=n.getMetricTimeSeries(e);if(c&&s)return _.each(s,function(e){if(!1!==e[a.ENABLED]){var i=1e3*e[r];o.push([i,this.getTimeSeriesValueAt(c,e[r],t),e])}},this),o},getWorkloadParams:function(e){return e&&e[a.PARAMS_LIST]?e[a.PARAMS_LIST]:[]},setWorkloadParams:function(e,t){e&&(e[a.PARAMS_LIST]=t)},getWorkloadParamValue:function(e,t){if(e&&e[a.PARAMS_LIST]){var i=_.find(e[a.PARAMS_LIST],function(e){return e.key===t});if(i)return i.value}}},{DP:a,TYPE:o})}),define("models/capacityplanning/CPScenarioQueryModel",["models/capacityplanning/CPQueryModel","models/capacityplanning/CPScenarioModel","data/DataProperties","utils/AppConstants","utils/AppUtil"],function(e,t,i,n,s){"use strict";return e.extend({name:"CPScenarioQueryModel",initialize:function(){e.prototype.initialize.apply(this,arguments),this.set(this.DP.ENTITY_TYPE,i.CP_SCENARIO),this.set(this.DP.GROUP_MEMBER_SORT_ATTRIBUTE,i.UPDATED_TIME),this.set(this.DP.GROUP_MEMBER_SORT_ORDER,n.SORT_DESCENDING),this.setGroupMemberAttributesList([i.WORKLOAD_LIST,i.CLUSTER_SPEC,i.EXPECTED_RUNWAY,i.NAME,i.TARGET_RUNWAY_DAYS,i.VENDOR_LIST,i.UPDATED_TIME,i.FILTER_CLUSTER_UUID])},getScenarioList:function(){var e=this.getQueryResultAttributes(),i=[];return e&&e.length&&_.each(e,function(e){var n=new t;n.parseAndSetData(e),n.get(t.DP.NAME)&&n.get(t.DP.UUID)&&0!==n.get(t.DP.NAME).indexOf(t.DP.PDF_TEMP_FILE_NAME)?i.push(n):s.logDebug("Skipping invalid scenario.")}),this.scenarios=i,i},findScenarioWithId:function(e){return _.find(this.scenarios,function(i){return i.get(t.DP.ID)===e})}})}),define("views/details/tabs/CPPlanningChartView",["views/details/tabs/CPChartView","data/DataProperties","utils/StyleDescriptor","utils/TimeUtil","utils/D3Util"],function(e,t,i,n,s){"use strict";var a={top:0,left:0},r=_.template('<div class="tooltip-content"><span> <%= name %> on <%= date %> </span></div>');return e.extend({name:"CPPlanningChartView",CHART_MARGINS:a,skipRunwayCheck:!0,initialize:function(t){if(e.prototype.initialize.apply(this,arguments),!(t&&t.scenarioRunwayModel&&t.recommendationModel))throw new Error("missing options scenarioRunwayModel or recommendationModel");this.scenarioRunwayModel=t.scenarioRunwayModel,this.recommendationModel=t.recommendationModel},updateChartContext:function(e){this.selectedParam=e||this.selectedParam||t.STORAGE_RUNWAY;var i=this.getChartData();if(i){var n=_.max(i.ret[0].data,function(e){return this.getXAxisDataPicker()(e)},this);this.chartMaxXVal=this.getXAxisDataPicker()(n)||0,n=_.max(i.ret[0].data,function(e){return this.getYAxisDataPicker()(e)},this);var s=this.getYAxisDataPicker()(n)||0;i=this.scenarioRunwayModel.getCapacityData(this.selectedParam,this.scenarioRunwayModel.CAPACITY_TYPES.TOTAL);var a=_.max(i,function(e){return e[1]},this);a&&s<a[1]&&(s=a[1]),this.chartMaxYVal=s}},renderCapacityLine:function(e){var t=this.scenarioRunwayModel.getCapacityData(this.selectedParam,e),n=e===this.scenarioRunwayModel.CAPACITY_TYPES.EFFECTIVE?"eff-capacity-line":"total-capacity-line";if(t&&t.length){var r=t[0];_.each(t,function(e,t){if(0!==t){var o=s.renderSVGLine(this._svg,this.chart.xScale()(r[0])+a.left,this.chart.xScale()(e[0])+a.left,this.chart.yScale()(r[1]),this.chart.yScale()(r[1]),i.CP.COLORS_MAP.GRAY_1);o.attr("class",n),o=s.renderSVGLine(this._svg,this.chart.xScale()(e[0])+a.left,this.chart.xScale()(e[0])+a.left,this.chart.yScale()(r[1]),this.chart.yScale()(e[1]),i.CP.COLORS_MAP.GRAY_1),o.attr("class",n),r=e}},this);s.renderSVGLine(this._svg,this.chart.xScale()(r[0])+a.left,this.chart.xScale()(this.chartMaxXVal)+a.left,this.chart.yScale()(r[1]),this.chart.yScale()(r[1]),i.CP.COLORS_MAP.GRAY_1).attr("class",n)}},orientYAxisLabels:function(){},renderWorkloadAndRecommendationLine:function(){var e=this.scenarioRunwayModel.getWorkloadDateAndMetric(this.selectedParam,this.scenarioRunwayModel.DP.USAGE_SERIES,this.scenarioRunwayModel.DATA_TYPES.WORKLOAD),t=this.scenarioRunwayModel.DP;_.each(e,function(e){this.renderWorkloadLine(e,i.CP.COLORS_MAP.GRAY_1,i.CP.COLORS_MAP.RED,r({name:e[2][t.TYPE],date:n.formatShortDate(1e3*e[2][t.SCHEDULE_TIME])}))},this),e=this.recommendationModel.getWorkloadDateAndMetric(this.selectedParam,this.scenarioRunwayModel.DP.EFFECTIVE_CP_SERIES,this.scenarioRunwayModel.DATA_TYPES.RECOMMENDATION,this.scenarioRunwayModel),_.each(e,function(e){this.renderWorkloadLine(e,i.CP.COLORS_MAP.GRAY_1,i.CP.COLORS_MAP.BLUE,r({name:e[2][t.MODEL],date:n.formatShortDate(1e3*e[2][t.RECOMMENDED_DATE])}))},this)},renderLegends:function(){var e=d3.select(".schedule-chart .chart-content").append("svg").attr("class","legend");this.renderWorkloadIcon(e,20,3,i.CP.COLORS_MAP.RED),s.renderSVGText(e,this.i18n("workload"),55,6),this.renderWorkloadIcon(e,100,3,i.CP.COLORS_MAP.BLUE),s.renderSVGText(e,this.i18n("recommendation"),140,6)},renderWorkloadIcon:function(e,t,i,n,a){var r,o;r=e.append("g").attr("class","icon"),s.renderSVGCircle(r,t,i,5,n,n),a&&(o=this.createD3Tip(a,"just-in-time-tooltip",[0,-15])),o&&r&&(r.call(o).on("click",function(){d3.selectAll(".d3-tip").style("opacity",0).style("pointer-events","none"),o.show(),d3.event.stopPropagation()}),$("body").on("click",this.onDocumentClick))},renderWorkloadLine:function(e,t,i,n){var r=this.chart.xScale()(e[0]);r<0||(s.renderSVGLine(this._svg,r+a.left,this.chart.xScale()(e[0])+a.left,this.yValForOtherSVG+a.top,this.chart.yScale()(e[1])+a.top,t),this.renderWorkloadIcon(this._svg,this.chart.xScale()(e[0])+a.left,this.yValForOtherSVG+a.top,i,n))},addAdditonalInfoToChart:function(e){var t=this.chart,i=this;e&&t&&(i.$(".nv-stackedAreaChart rect").attr("height")&&(this.yValForOtherSVG=parseInt(this.$(".nv-stackedAreaChart rect").attr("height"),10)),this.renderCapacityLine(this.scenarioRunwayModel.CAPACITY_TYPES.EFFECTIVE),this.renderCapacityLine(this.scenarioRunwayModel.CAPACITY_TYPES.TOTAL),this.renderWorkloadAndRecommendationLine(),this.renderLegends(),this.registerCustomTooltip())},registerCustomTooltip:function(){var e=this;this.chart.interactiveLayer.tooltip.contentGenerator(function(i){var n=e.getYAxisTickFormatter()(i.series[0].value);return e.getCurrentSelectedParam()===t.STORAGE_RUNWAY&&(n+=" ("+e.i18n("physical")+")"),'<div class="whatif-custom-tip">\n                    <span>'+i.value+"<br>"+n+"</span>\n                  </div>"})},validateChartData:function(e){if(!(e&&e.ret[0]&&e.ret[0].data&&e.ret[0].data.length))return!1;var t=!0,i=this.getYAxisDataPicker();return _.some(e.ret[0].data,function(e){var n=0!==i(e);return n&&(t=!1),n}),!t},getChartData:function(){var e=this.scenarioRunwayModel.getRunwayChartData(this.selectedParam);if(e){var t={ret:[{data:e,objectId:this.selectedParam,values:e,title:this.selectedParam}]};return this.pickColors(t.ret),t}}})}),define("text!templates/basecomponents/details/CapacityPlanning/CPRunwayEstimateSubView.html",[],function(){return'\n<label>\n  <div>\n    <span>\n      <%= i18n(\'total_runway\') %>\n      <span class="runway-days">\n        <%= runway.minRunwayDays %> <%= i18n(\'days\') %>\n      </span>\n    </span>\n    <div class="runway-loader-wrapper hide">\n      <div class="donut-loader-blue"></div>\n    </div>\n  </div>\n</label>\n<div class="runway">\n  <svg class="runway-chart" id="total-runway-chart"></svg>\n</div>\n<div class="runway">\n  <label>\n    <%= i18n(\'cpu_runway\') %>\n    <span><%= runway.cpuRunwayDays %>  <%= i18n(\'days\') %></span>\n  </label>\n  <svg class="runway-chart" id="cpu-runway-chart"></svg>\n</div>\n<div class="runway">\n  <label>\n    <%= i18n(\'memory_runway\') %>\n    <span><%= runway.memoryRunwayDays %>  <%= i18n(\'days\') %></span>\n  </label>\n  <svg class="runway-chart" id="memory-runway-chart"></svg>\n</div>\n<div class="runway">\n  <label>\n    <%= i18n(\'storage_runway\') %>\n    <span><%= runway.storageRunwayDays %> <%= i18n(\'days\') %></span>\n  </label>\n  <svg class="runway-chart" id="storage-runway-chart"></svg>\n</div>\n<div class="time-scale">\n  <% _.each(intervals, function(interval) { %>\n    <div class="interval">\n      <%= interval %>\n    </div>\n  <% }); %>\n  <div class="interval-unit"><%= i18n(\'months\') %></div>\n</div>\n'}),define("views/details/tabs/CPRunwayEstimateSubview",["views/basecomponents/BaseSubView","d3tip","utils/D3Util","utils/StyleDescriptor","text!templates/basecomponents/details/CapacityPlanning/CPRunwayEstimateSubView.html"],function(e,t,i,n,s){"use strict";var a;return e.extend({name:"CPRunwayEstimateSubview",modelEvents:{"change scenarioRunway":"render"},subViewTemplate:_.template(s),initialize:function(t){e.prototype.initialize.apply(this,arguments),this.parentView=t.parentView,a=[];for(var i=0;i<=12;i++)a.push(i);this.scenarioRunway=t.scenarioRunwayModel,this.delegateModelEvents()},renderRunwayChart:function(e,t,s,a){var r=d3.select("#"+t);a=a||8,r.selectAll("*").remove();var o,l=this.parentView.getTotalRunway();o=e<l?n.CP.COLORS_MAP.RED:n.CP.COLORS_MAP.BLUE;var c=this.getRunwayAsPercentage(e),u=this.getRunwayAsPercentage(l);i.renderSVGLine(r,"0%","100%","50%","50%",n.CP.COLORS_MAP.GRAY_6,a);i.renderSVGLine(r,"0%",c,"50%","50%",o,a);s&&(i.renderSVGLine(r,u,u,"-5","100%",n.CP.COLORS_MAP.GRAY_1,2),i.renderSVGText(r,this.i18ns("target",l/30),u,"-10",n.CP.COLORS_MAP.GRAY_1))},createD3Tip:function(e){return t().attr("class","d3-tip cp-custom-tip").offset([-20,-10]).direction("sw").html(function(t){return e})},clearTooltips:function(){d3.select(".d3-tip").remove()},getRunwayAsPercentage:function(e){return e/365*100+"%"},renderChart:function(e){var t=this.scenarioRunway.DP;e||(e={}),e[t.RUNWAY]=parseInt(e[t.RUNWAY]||0,10),e[t.CPU_RUNWAY]=parseInt(e[t.CPU_RUNWAY]||0,10),e[t.STORAGE_RUNWAY]=parseInt(e[t.STORAGE_RUNWAY]||0,10),e[t.MEMORY_RUNWAY]=parseInt(e[t.MEMORY_RUNWAY]||0,10),this.$el.html(this.subViewTemplate(this.vtOptions({runway:e,intervals:a}))),this.renderRunwayChart(e[t.RUNWAY],"total-runway-chart",!0),this.renderRunwayChart(e[t.CPU_RUNWAY],"cpu-runway-chart",!1,4),this.renderRunwayChart(e[t.STORAGE_RUNWAY],"storage-runway-chart",!1,4),this.renderRunwayChart(e[t.MEMORY_RUNWAY],"memory-runway-chart",!1,4)},render:function(){var e=this.scenarioRunway.get(this.scenarioRunway.DP.RUNWAY_GAIN);e&&this.renderChart(e)},destroy:function(){this.clearTooltips(),e.prototype.destroy.apply(this,arguments)}})}),define("models/capacityplanning/HardwareCompatibilityModel",["models/BaseModel","data/DataURLConstants"],function(e,t){"use strict";var i={HDD:"hddGb",SSD:"ssdGb",CPU:"cpuGhz",MEMORY:"ramGb",CPU_LIST:"cpuGhzList",MEMORY_LIST:"ramGbList",HDD_LIST:"hddGbList",SSD_LIST:"ssdGbList",MODEL_CONFIG:"modelConfig",RESOURCE_SPEC:"resourceSpec",NODE_SPEC_LIST:"nodeSpecList",MODEL:"model",VENDOR_LIST:"vendorList",MODEL_LIST:"modelNameToSpecMap",ENTITIES:"entities"};return e.extend({name:"HardwareCompatibilityModel",DP:i,idAttribute:i.UUID,urlRoot:t.HARDWARE_COMPATIBLE_MODELS,parseOptions:function(e,t,i){return i=i||{},i.url=this.getDataSourceURL()+(this.getURL(e,i)||t.url()),i}},{DP:i})}),define("views/basecomponents/popups/BasePopupSubView",["views/basecomponents/BaseSubView","utils/ModalMixin"],function(e,t){"use strict";return e.extend(_.extend({},t,{}))}),define("text!templates/basecomponents/details/CapacityPlanning/CPNodeConfiguration.html",[],function(){return'<section data-ntnx-section>\n  <label data-ntnx-label for="cpNodeCpuSelect">\n    <%= i18n(\'cpu\') %>\n  </label>\n  <select id="cpNodeCpuSelect" model-attribute="resourceSpec.cpuGhz">\n    <% _.each(cpuGhzList, function(cpu) { %>\n    <option value="<%= cpu.value %>">\n      <%= cpu.partCode %>\n    </option>\n    <% }); %>\n  </select>\n</section>\n\n<section data-ntnx-section>\n  <label data-ntnx-label for="cpNodeMemorySelect">\n    <%= i18n(\'memory\') %>\n  </label>\n  <select id="cpNodeMemorySelect" model-attribute="resourceSpec.ramGb">\n    <% _.each(ramGbList, function(memory) { %>\n    <option value="<%= memory.value %>">\n      <%= memory.partCode %>\n    </option>\n    <% }); %>\n  </select>\n</section>\n\n<section data-ntnx-section>\n  <label data-ntnx-label for="cpNodeHddSelect">\n    <%= i18n(\'hdd\') %>\n  </label>\n  <select id="cpNodeHddSelect" model-attribute="resourceSpec.hddGb">\n    <% _.each(hddGbList, function(hdd) { %>\n    <option value="<%= hdd.value %>">\n      <%= hdd.partCode %>\n    </option>\n    <% }); %>\n  </select>\n</section>\n\n<section data-ntnx-section>\n  <label data-ntnx-label for="cpNodeSsdSelect">\n    <%= i18n(\'ssd\') %>\n  </label>\n  <select id="cpNodeSsdSelect" model-attribute="resourceSpec.ssdGb">\n    <% _.each(ssdGbList, function(sdd) { %>\n    <option value="<%= sdd.value %>">\n      <%= sdd.partCode %>\n    </option>\n    <% }); %>\n  </select>\n</section>'}),define("text!templates/basecomponents/details/CapacityPlanning/CPNode.html",[],function(){return'<section data-ntnx-section>\n  <label data-ntnx-label for="cpNodeModelSelect">\n    <%= i18n(\'model\') %>\n  </label>\n  <select id="cpNodeModelSelect" class="model-list" model-attribute="model">\n    <% _.each(models, function(model) { %>\n    <option value="<%= model %>">\n      <%= model %>\n    </option>\n    <% }); %>\n  </select>\n</section>\n\n<div class="configuration"></div>\n\n<section data-ntnx-section>\n  <label data-ntnx-label for="cpNodeNumOfNodesInput" class="control-label">\n    <%= i18n(\'number_of_nodes\') %>\n  </label>\n  <input id="cpNodeNumOfNodesInput" model-attribute="numOfNodes" class="form-control"\n    value="2"/>\n</section>\n\n<section data-ntnx-section>\n  <label data-ntnx-label for="cpNodeOnDateInput">\n    <%= i18n(\'on\') %>\n  </label>\n  <div class="input-append date">\n    <input id="cpNodeOnDateInput" model-attribute="startDate"\n      class="start-date form-control" placeholder="<%= i18n(\'date\') %>">\n  </div>\n</section>'}),define("views/details/tabs/CPNodePopupView",["datepicker","models/capacityplanning/CPScenarioModel","views/basecomponents/popups/BasePopupSubView","utils/TimeUtil","text!templates/basecomponents/details/CapacityPlanning/CPNodeConfiguration.html","text!templates/basecomponents/details/CapacityPlanning/CPNode.html"],function(e,t,i,n,s,a){"use strict";var r=_.template(a),o=_.template(s),l={EXISTING:"0d",NEW:"0d"};return i.extend({name:"CPNodePopupView",subViewTemplate:r,events:{"change .model-list":"onModelChange"},initialize:function(e){i.prototype.initialize.apply(this,arguments),this.parentView=e.parentView},render:function(e){e=e||{};var i,s,a=e.model,r=t.DP;if(this.models=e.models,!a&&this.models&&this.models.length?(a={},a[r.MODEL]=this.models[0][r.MODEL],a[r.MODEL_CONFIG]=this.models[0][r.MODEL_CONFIG],this.editMode=!1,s=l.NEW):(this.editMode=!0,this.model=a,s=l.EXISTING),this.$el.html(this.subViewTemplate(this.vtOptions({model:a,models:_.uniq(_.pluck(this.models,r.MODEL))}))),a){if(this.$(".model-list").val(a[r.MODEL]),this.renderConfiguration(a[r.MODEL]),this.$(".start-date").datepicker(_.extend(n.getDatePickerOptions(),{startDate:s})),this.editMode)this.$(".model-list").trigger("disable"),this.setFormWithData(a),i=1e3*a[r.RECOMMENDED_DATE];else{var o=new Date;o.setDate(o.getDate()+60),i=o.getTime()}this.$(".start-date").datepicker("update",n.formatShortDate(i))}},renderConfiguration:function(e){var i=_.find(this.models,function(i){return i[t.DP.MODEL]===e});this.$(".configuration").html(o(this.vtOptions(i))),this.applyNutanixInput()},getDataForSave:function(){var e=t.DP,i=this.getDataModel();return i[e.RECOMMENDED_DATE]=new Date(i.startDate).getTime()/1e3,i[e.MODEL_CONFIG]=_.find(this.models,function(t){return t[e.MODEL]===i[e.MODEL]}),i[e.NODE_TYPE]=e.NODE_TYPES.USER_ADDED,this.editMode&&$.extend(this.model,i),i},onModelChange:function(){var e=this.$(".model-list").val();this.renderConfiguration(e)},destroy:function(){i.prototype.destroy.apply(this,arguments)}})}),define("views/popups/capacityplanning/CPWhatIfPopupViewMixin",["managers/I18nManager","utils/StatsUtil"],function(e,t){"use strict";return{getCpuDisplay:function(i){var n=isNaN(i)?0:Math.abs(i),s=e.t("Common","ghz");return t.round(n,2)+" "+s},getMemoryDisplay:function(e){var i=isNaN(e)?0:Math.abs(e);return t.storageFormat(t.convertToBytes(i),!0)},getStorageDisplay:function(e,i){var n=isNaN(e)?0:e,s=isNaN(i)?0:i,a=Math.abs(parseFloat(n)+parseFloat(s));return t.storageFormat(t.convertToBytes(a),!0)}}}),define("text!templates/popups/capacityplanning/CPExistingNodesContentView.html",[],function(){return"<section data-ntnx-section>\n  <h5 data-ntnx-title>\n    <%= i18n('table_description') %>\n  </h5>\n</section>\n\n<div class=\"existing-nodes-table existingNodesTable\"></div>\n\n<section data-ntnx-section>\n  <table class=\"table no-border horizontal-table\">\n    <tbody>\n    <tr>\n      <th><%= i18n('total_existing') %></th>\n      <td><%= totalExisting.displayCpu %></td>\n      <td><%= totalExisting.displayMemory %></td>\n      <td><%= totalExisting.displayStorage %></td>\n    </tr>\n    <tr>\n      <th><%= i18n('total_disregarded') %></th>\n      <td><%= totalDisregard.displayCpu %></td>\n      <td><%= totalDisregard.displayMemory %></td>\n      <td><%= totalDisregard.displayStorage %></td>\n    </tr>\n    <tr class=\"total-border\">\n      <th><%= i18n('total_effective') %></th>\n      <td><%= totalEffective.displayCpu %></td>\n      <td><%= totalEffective.displayMemory %></td>\n      <td><%= totalEffective.displayStorage %></td>\n    </tr>\n    </tbody>\n  </table>\n</section>"}),define("views/popups/capacityplanning/CPExistingNodesPopupView",["views/basecomponents/popups/BasePopupSubView","views/basecomponents/tableinput/TableInputView","views/popups/capacityplanning/CPWhatIfPopupViewMixin","models/capacityplanning/CPScenarioModel","utils/AppConstants","utils/TimeUtil","components/Components","text!templates/popups/capacityplanning/CPExistingNodesContentView.html"],function(e,t,i,n,s,a,r,o){"use strict";var l=_.template(o),c=_.template('\n      <tr data-id="<%= dataId %>"\n        class="n-table-row <%= data.existing ? "existing":""%>">\n        <% _.each(columns, function(column) { %>\n        <td class="data-cell">\n           <%= column.renderer(data) %>\n        </td>\n        <% }); %>\n      '+t.EDIT_COLUMN_TEMPLATE+"\n      </tr>\n    "),u=_.template('\n      <div class="n-date-time-picker">\n        <div class="input-append date">\n          <input model-attribute="disregardDate"\n            class="disregard-date form-control"\n            placeholder="<%= i18n(\'date\') %>">\n        </div>\n      </div>\n    ');return e.extend(_.extend({},i,{name:"CPExistingNodesPopupView",events:{"change .existingNodesTable .n-checkbox":"onChangeRowSelection","change .disregard-date":"onChangeDate"},initialize:function(t){t=t||{},e.prototype.initialize.apply(this,arguments),this.parentView=t.parentView,this.existingNodes=t.models},destroy:function(){this.$(".disregard-date").datepicker("destroy"),e.prototype.destroy.apply(this,arguments)},render:function(){var e=this,t=n.DP,i=this.getResourceData();this.$el.html(l(this.vtOptions({DP:t,totalExisting:i.totalExisting,totalDisregard:i.totalDisregard,totalEffective:i.totalEffective}))),this.$(".existingNodesTable").html(this.renderTableInput().el);var s=new Date;s.setDate(s.getDate()+60);var r=s.getTime(),o=a.formatShortDate(r);this.$(".disregard-date").datepicker(_.extend(a.getDatePickerOptions(),{startDate:"0d"})),_.each(this.$(".disregard-date"),function(i){var n=$(i).closest("tr").attr("data-id");_.some(e.existingNodes,function(e){if(e[t.ID]===n&&e[t.RECOMMENDED_DATE]){var s=1e3*e[t.RECOMMENDED_DATE];return $(i).datepicker("update",a.formatShortDate(s)),!0}})||$(i).datepicker("update",o)})},renderTableInput:function(){return new t({idAttribute:"id",entityType:s.ENTITY_SCENARIO,disableInlineEdit:!0,tmplDataRow:c,ebTableStyle:!0,data:this.existingNodes,noDataText:this.i18n("no_resource"),isActionEnabled:!1,isNewActionEnabled:!1,columns:this.getTableColumns()}).render()},getTableColumns:function(){var e=this,t=n.DP;return[{columnName:"&nbsp;",renderer:function(e){return r.checkbox({jsClasses:"rowSelection",checked:!0===e.enabled})}},{columnName:this.i18n("model"),renderer:function(e){return e[t.MODEL]}},{columnName:this.i18n("disregard_date"),renderer:function(t){return u(e.vtOptions({}))}},{columnName:this.i18n("cpu"),renderer:function(i){var n=i[t.RESOURCE_SPEC],s=n[t.CPU];return e.getCpuDisplay(s)}},{columnName:this.i18n("memory"),renderer:function(i){var n=i[t.RESOURCE_SPEC],s=n[t.MEMORY];return e.getMemoryDisplay(s)}},{columnName:this.i18n("storage"),renderer:function(i){var n=i[t.RESOURCE_SPEC],s=n[t.HDD],a=n[t.SSD];return e.getStorageDisplay(s,a)}}]},getDataForSave:function(){var e=n.DP,t=[],i=this.existingNodes,s=this.$(".rowSelection:checked");return _.each(i,function(i){var n=_.some(s,function(n){var s=$(n).closest("tr").attr("data-id");if(i[e.ID]===s){var r=$(n).closest("tr").find(".disregard-date");return i.startDate=r.val(),i[e.RECOMMENDED_DATE]=a.getTimeStamp(i.startDate)/1e3,i[e.NODE_TYPE]=e.NODE_TYPES.USER_ADDED,i[e.DISREGARD]=!0,t.push(i),!0}});i[e.ENABLED]=n}),t},getResourceData:function(){var e,t=n.DP,i=(e={},_defineProperty(e,t.CPU,0),_defineProperty(e,t.MEMORY,0),_defineProperty(e,t.HDD,0),_defineProperty(e,t.SSD,0),e),s=_.clone(i),a=_.clone(i);return _.each(this.existingNodes,function(e){var n=e[t.RESOURCE_SPEC];i[t.CPU]+=n[t.CPU],i[t.MEMORY]+=n[t.MEMORY],i[t.HDD]+=n[t.HDD],i[t.SSD]+=n[t.SSD],e[t.ENABLED]&&(s[t.CPU]+=n[t.CPU],s[t.MEMORY]+=n[t.MEMORY],s[t.HDD]+=n[t.HDD],s[t.SSD]+=n[t.SSD])}),a[t.CPU]=i[t.CPU]-s[t.CPU],a[t.MEMORY]=i[t.MEMORY]-s[t.MEMORY],a[t.HDD]=i[t.HDD]-s[t.HDD],a[t.SSD]=i[t.SSD]-s[t.SSD],this._generateDisplayProps(i),this._generateDisplayProps(s),this._generateDisplayProps(a),{totalExisting:i,totalDisregard:s,totalEffective:a}},_generateDisplayProps:function(e){var t=n.DP;e.displayCpu=this.getCpuDisplay(e[t.CPU]),e.displayMemory=this.getMemoryDisplay(e[t.MEMORY]),e.displayStorage=this.getStorageDisplay(e[t.HDD],e[t.SSD])},onChangeRowSelection:function(e){var t=n.DP,i=$(e.currentTarget).closest("tr").attr("data-id");_.some(this.existingNodes,function(n){if(n[t.ID]===i)return n[t.ENABLED]=$(e.currentTarget).is(":checked"),!0}),this.render()},onChangeDate:function(e){var t=n.DP,i=$(e.currentTarget).closest("tr").attr("data-id");_.some(this.existingNodes,function(n){if(n[t.ID]===i)return n.startDate=$(e.currentTarget).val(),n[t.RECOMMENDED_DATE]=a.getTimeStamp(n.startDate)/1e3,!0})}}))}),
define("text!templates/popups/capacityplanning/CPAdjustNodesContentView.html",[],function(){return"<div data-ntnx-content-inner>\n  <section class=\"resourceTypeSection\" data-ntnx-section>\n    <h5 data-ntnx-title><%= i18n('resource_type') %></h5>\n  </section>\n  <section data-ntnx-section>\n    <div class=\"resource-type-inputs\">\n      <%= Components.radio({\n        id: 'newNodesRadio',\n        name: 'resourceType',\n        classes: '',\n        labelText: i18n('new_nodes'),\n        checked: true\n      })\n      %>\n      <%= Components.radio({\n        id: 'disregardNodesRadio',\n        name: 'resourceType',\n        labelText: i18n('disregard_nodes'),\n        classes: ''\n      })\n      %>\n    </div>\n  </section>\n  <div class=\"newNodesSection\"></div>\n  <div class=\"disregardNodesSection\"></div>\n</div>\n"}),define("views/details/tabs/CPAdjustNodesPopupView",["models/capacityplanning/CPScenarioModel","models/capacityplanning/HardwareCompatibilityModel","views/basecomponents/popups/BasePopupView","views/details/tabs/CPNodePopupView","views/popups/capacityplanning/CPExistingNodesPopupView","utils/ViewUtil","utils/SubViewHelper","text!templates/popups/capacityplanning/CPAdjustNodesContentView.html"],function(e,t,i,n,s,a,r,o){"use strict";var l=_.template(o),c={CP_NEW_NODE:"cpNewNodeView",CP_EXISTING_NODE:"cpExistingNodeView"};return i.extend({name:"CPAdjustNodesPopupView",events:{"click .modal-header .close":"hide","click .btnCancel":"hide","click .btnSave":"onSave",'click input:radio[name="resourceType"]':"showAdjustmentSection"},initialize:function(e){e=e||{},i.prototype.initialize.apply(this,arguments),this.subViewHelper=new r,this.parentView=e.parentView,this.recommendationModel=e.recommendationModel,this.hcModel=new t},render:function(e){e=e||{},this.editModel=e.model,this.modelList=e.modelList,this.existingNodes=e.existingNodes,this.$el.html(this.defaultTemplate({title:this.i18n("title"),bodyContent:l(this.vtOptions({})),footerButtons:this.defaultFooter([{text:this.i18n("cancel"),extraClasses:"btnCancel"},{isPrimary:!0,text:this.i18n("save"),extraClasses:"btnSave",extraAttr:[{key:"data-loading-text",value:this.i18n("saving")}]}])})),e.clusterId||this.$el.find("#disregardNodesRadio").prop("disabled",!0),this.showAdjustmentSection()},showAdjustmentSection:function(){var t=e.DP,i=this.$el.find("#newNodesRadio"),n=this.$el.find("#disregardNodesRadio"),s=this.$el.find(".newNodesSection"),a=this.$el.find(".disregardNodesSection");this.editModel&&(this.$(".resourceTypeSection").hide(),_.isUndefined(this.editModel[t.DISREGARD])||_.isNull(this.editModel[t.DISREGARD])?i.prop("checked",!0):n.prop("checked",!0)),i.is(":checked")?(this.showNewNodes(),a.hide()):n.is(":checked")&&(s.hide(),this.showDisregardNodes())},showDisregardNodes:function(){var t=this,i=e.DP,n=this.subViewHelper.get(c.CP_EXISTING_NODE);if(!n){var a=[];_.each(this.existingNodes,function(e){var n=t.recommendationModel.getModelList()||[],s=_.find(n,function(t){if(t[i.ID]===e[i.ID])return!0});s?a.push(_.clone(s)):a.push(_.clone(e))}),n=new s({el:this.$(".disregardNodesSection"),parentView:this,models:a}),this.subViewHelper.register(c.CP_EXISTING_NODE,n),n.render()}n.$el.show()},showNewNodes:function(){var i=this,s={},r=e.DP,o=t.DP;s[o.VENDOR_LIST]=this.parentView.getVendorList(),s[o.MODEL_LIST]={},_.each(this.modelList,function(e){s[o.MODEL_LIST][e[r.MODEL]]=[e[r.RESOURCE_SPEC]]});var l=this.subViewHelper.get(c.CP_NEW_NODE);l?l.$el.show():(this.hcModel.clear(),this.hcModel.set(s),a.addInLineDonutLoader(this.$(".newNodesSection")),this.hcModel.save(null,{success:function(e,t){l=new n({el:i.$(".newNodesSection"),parentView:i}),i.subViewHelper.register(c.CP_NEW_NODE,l),l.render({model:i.editModel,models:e.get(e.DP.ENTITIES)})},error:function(){i.showHeaderError(i.i18n("api_error"))}}))},onSave:function(){var e=this.$el.find("#newNodesRadio"),t=this.$el.find("#disregardNodesRadio");if(e.is(":checked")){var i=this.subViewHelper.get(c.CP_NEW_NODE);this.parentView.saveNode(i.getDataForSave(),this.editModel)}else if(t.is(":checked")){var n=this.subViewHelper.get(c.CP_EXISTING_NODE);this.parentView.disregardNodes(n.getDataForSave())}this.hide()},hide:function(e,t){this.$el.hide(),this.$el.nutanixPopup({show:!1,removePopup:t||!1,overlayPopup:!0}),this.subViewHelper.destroy()},show:function(e){this.$el.nutanixPopup({show:!0,overlayPopup:!0}),this.createHelpIcon({actionTarget:"cp_adjust_node"}),this.render(e)},destroy:function(){this.hide(null,!0),i.prototype.destroy.apply(this,arguments)}})}),define("text!templates/basecomponents/details/CapacityPlanning/CPRecommendedModelSubview.html",[],function(){return'<div>\n  <div class="recommendation-title clearfix">\n    <div class="pull-left bold">\n      <%= i18n(\'resource\') %>\n    </div>\n    <div class="pull-left resource-sort-by resourceSortBy">\n      <%= Components.select({\n        options: [\n          { name: i18n(\'sort_by_date_asc\'), value: SORT_BY.DATE_ASC },\n          { name: i18n(\'sort_by_date_desc\'), value: SORT_BY.DATE_DESC }\n        ],\n        dataTestAttribute: \'resourceSortBy\'\n      }) %>\n    </div>\n    <div class="pull-right add-resource-wrapper">\n      <a class="new-node">\n        <%= i18n(\'adjust_node\') %>\n      </a>\n      <button class="recommendation-btn btn btnUpdate">\n        <%= i18n(\'recommend\') %>\n      </button>\n      <div class="reco-loader-wrapper">\n        <div class="donut-loader-blue"></div>\n      </div>\n    </div>\n  </div>\n  <div class="existing-models">\n    <div class="table-wrapper">\n    </div>\n  </div>\n  <div class="required-resources">\n    <div class="table-wrapper">\n    </div>\n  </div>\n</div>\n'}),define("views/details/tabs/CPRecommendedModelSubview",["views/basecomponents/BaseSubView","views/basecomponents/tableinput/TableInputView","views/details/tabs/CPAdjustNodesPopupView","views/popups/capacityplanning/CPWhatIfPopupViewMixin","models/capacityplanning/CPQueryModel","models/capacityplanning/CPScenarioModel","managers/ClusterManager","utils/AppConstants","utils/FilterUtil","utils/TimeUtil","data/DataProperties","utils/AppUtil","utils/StatsUtil","text!templates/basecomponents/details/CapacityPlanning/CPRecommendedModelSubview.html"],function(e,t,i,n,s,a,r,o,l,c,u,d,h,p){"use strict";var T={DATE_ASC:"dateAsc",DATE_DESC:"dateDesc"},E=_.template('<tr data-id="<%= dataId %>"class="n-table-row <%= data.existing ? "existing":""%>"><% _.each(columns, function(column) { %><td class="data-cell"><% if (column.type) { %><%= Components.checkbox({ jsClasses: "input-data",checked: data.enabled !== false , disabled: !!data.existing }) %><% } else {%><%= column.renderer(data) %><% }%></td><% }); %>'+t.EDIT_COLUMN_TEMPLATE+"</tr>"),S=_.template('<div class="recommended-detail"><div> <%= i18n("existing_hardware") %></div><div><a class="existing-models-details"><%= i18n("see_details") %></a></div><div class="hide existing-models-details-content"><% _.each(models, function(model) { %><div><%= model["numOfNodes"]%> of <%= model["model"] %></div><% });%></div></div>'),g=_.template('\n      <div class="recommended-detail">\n        <div class="model-detail"><%= model %></div>\n        <div>\n          <% if (isDisregard) { %>\n            <span class="adjustment-label disregard-label"\n            ><%= i18n(\'disregard_label\') %></span>\n          <% } else if (isRecommended) { %>\n            <span class="adjustment-label new-label"\n            ><%= i18n(\'recommended_label\') %></span>\n          <% } else { %>\n            <span class="adjustment-label new-label"\n            ><%= i18n(\'new_label\') %></span>\n          <% } %>\n          <span class="deployment-date">\n            <%= date %>\n          </span>\n        </div>\n      </div>\n    ');return e.extend(_.extend({},n,{name:"CPRecommendedModelSubview",subViewTemplate:_.template(p),events:{"click .action-links .edit":"openModelPopUp","click .new-node":"openModelPopUp","click .action-links .delete":"deleteNode","change .component-table-input .n-checkbox":"onRecoCheckboxClicked","change .resourceSortBy":"onChangeResourceSortBy"},modelEvents:{"change recommendation":"onChangeData"},initialize:function(n){e.prototype.initialize.apply(this,arguments),this.parentView=n.parentView,this.recommendation=n.recommendationModel,this.clusterId=n.clusterId,this.scenarioQueryModel=n.scenarioQueryModel,this.existingNodes=[],this.cpAdjustNodesView=new i({el:d.createPopupContainer("popupCPAdjustNodes"),parentView:this,recommendationModel:this.recommendation}),this.delegateModelEvents(),this.resourceTableInputView=new t({idAttribute:a.DP.ID,entityType:o.ENTITY_SCENARIO,disableInlineEdit:!0,tmplDataRow:E,ebTableStyle:!0,dataItems:this.recommendation.models,noDataText:this.i18ns("no_resource"),columns:this.getResourceTableColumns()}),this.fetchExistingNodes(),$("body").on("click",_.bind(this.onDocumentClick,this))},render:function(){this.$el.html(this.subViewTemplate(this.vtOptions({SORT_BY:T}))),this.renderModels()},openModelPopUp:function(e){var t,i=[];if(this.recommendation.getModelList()&&Array.prototype.push.apply(i,this.recommendation.getModelList()),this.existingModels&&this.existingModels.length&&Array.prototype.push.apply(i,this.existingModels),!$(e.target).hasClass("new-node")){var n=$(e.currentTarget).closest("tr").data("id");t=this.recommendation.findNodeWithId(n)}var s=r.getClusterModelByClusterUuid(this.clusterId);i&&(!this.clusterId||s&&!s.isOneOrTwoNodeCluster())&&this.cpAdjustNodesView.show({model:t,modelList:i,clusterId:this.clusterId,existingNodes:this.existingNodes})},getVendorList:function(){return this.parentView.getVendorList()},saveNode:function(e,t){this.recommendation.getModelList()||this.recommendation.setModelList([]),t||this.recommendation.getModelList().push(e),this.renderModels(),this.parentView.fetchScenarioRunway()},disregardNodes:function(e){var t=this.recommendation.DP,i=this.recommendation.getModelList()||[];_.each(this.existingNodes,function(n){var s=_.find(e,function(e){return e[t.ID]===n[t.ID]});if(s){for(var a=!1,r=0;r<i.length;r++)if(i[r][t.ID]===s[t.ID]){i[r]=s,a=!0;break}a||i.push(s)}else{var o=_.find(i,function(e){return e[t.ID]===n[t.ID]});o&&(o[t.ENABLED]=!1)}}),this.recommendation.setModelList(i),this.renderModels(),this.parentView.fetchScenarioRunway()},onChangeData:function(){this.renderModels()},onDocumentClick:function(){this.$(".tooltip").hide(),this.$(".tooltip").remove()},deleteNode:function(e){var t=$(e.currentTarget).closest("tr").data("id");this.recommendation.removeRecommendation(t),this.parentView.fetchScenarioRunway()},getResourceTableColumns:function(){var e=this.recommendation.DP;return[{columnName:"&nbsp;",renderer:function(e){},type:"checkbox"},{columnName:this.i18n("model_date"),renderer:this.getDetailColumnRenderer()},{columnName:this.i18n("num_of_nodes"),renderer:this.parentView.getPropRenderer(e.NUMBER_OF_NODES)},{columnName:this.i18n("cpu"),renderer:this.getCPURenderer()},{columnName:this.i18n("memory"),renderer:this.getMemoryRenderer()},{columnName:this.i18n("storage"),renderer:this.getStorageRenderer()}]},getCPURenderer:function(){var e=this;return function(t){var i=e.recommendation.DP,n=e._getResource(t,i.CPU);return e.getCpuDisplay(n)}},getMemoryRenderer:function(){var e=this;return function(t){var i=e.recommendation.DP,n=e._getResource(t,i.MEMORY);return e.getMemoryDisplay(n)}},getStorageRenderer:function(){var e=this;return function(t){var i=e.recommendation.DP,n=e._getResource(t,i.HDD),s=e._getResource(t,i.SSD);return e.getStorageDisplay(n,s)}},getDetailColumnRenderer:function(){var e=this,t=this.recommendation.DP;return function(i){if(i.existing)return S(e.vtOptions({models:e.existingModels}));var n=i[t.RECOMMENDED_DATE],s=i[t.DISREGARD],a=i[t.NODE_TYPE]===t.NODE_TYPES.SYSTEM_RECOMMENDED;return g(e.vtOptions({isDisregard:s,isRecommended:a,date:c.formatShortDate(1e3*n),model:i[t.MODEL]}))}},renderModels:function(){var e=(this.recommendation.DP,[]);this.existingModelsData&&(e=[this.existingModelsData]);var t=this.recommendation.getModelList();Array.prototype.push.apply(e,t),this.addIDToRecommendation(),this._sortModels(e),this.resourceTableInputView.dataItems=e,this.tableInitialized?this.resourceTableInputView.renderTable():(this.$(".required-resources .table-wrapper").html(this.resourceTableInputView.render().el),this.tableInitialized=!0),t&&t.length?this.$(".resourceSortBy").removeClass("hidden"):this.$(".resourceSortBy").addClass("hidden"),this.$(".existing-models-details").tooltip({title:this.$(".existing-models-details-content").html(),placement:"right",trigger:"hover",html:"false"})},convertQueryToNodeSpec:function(e){var t=a.DP,i=[];return _.each(e,function(e){var n={};n[t.ID]=e[u.ID],n[t.MODEL]=e[u.HOST_MODEL_NAME],n[t.NUMBER_OF_NODES]=1;var s={};"1"===e[u.CP_STORAGE_ONLY_NODE]?(s[t.CPU]=0,s[t.MEMORY]=0):(s[t.CPU]=isNaN(e[u.CP_CPU_IN_GHZ])?0:parseFloat(h.processCapacityCPUStats(e[u.CP_CPU_IN_GHZ],!1,2)),s[t.MEMORY]=isNaN(e[u.HOST_MEMORY_SIZE_BYTES])?0:h.convertBytesToGiB(e[u.HOST_MEMORY_SIZE_BYTES])),s[t.HDD]=isNaN(e[u.CP_DISK_SIZE])?0:h.convertBytesToGiB(e[u.CP_DISK_SIZE]),s[t.SSD]=0,n[t.RESOURCE_SPEC]=s,i.push(n)}),i},renderExistingModelsTable:function(e){var t=0,i=0,n=0,s=0,r=a.DP;if(e&&e.length){var o=_.uniq(e,!1,function(e){return e[r.MODEL]}),l=_.groupBy(e,function(e){return e[r.MODEL]});this.existingModels=[],_.each(o,function(e){t+=l[e[r.MODEL]].length;var i=_.extend({},e);i[r.NUMBER_OF_NODES]=l[e[r.MODEL]].length,this.existingModels.push(i)},this),_.each(e,function(e){var t=e[r.RESOURCE_SPEC];i+=t[r.MEMORY],n+=t[r.CPU],s+=t[r.HDD]+t[r.SSD]}),this.existingModelsData={},this.existingModelsData.existing=1,this.existingModelsData[r.RESOURCE_SPEC]={};var c=this.existingModelsData[r.RESOURCE_SPEC];c[r.CPU]=n,c[r.MEMORY]=i,c[r.HDD]=s,this.existingModelsData[r.NUMBER_OF_NODES]=t,this.renderModels()}},onClusterChange:function(e){this.clusterId=e,this.clusterId?this.fetchExistingNodes():(this.existingModelsData=null,this.existingModels=[],this.renderModels()),this.recommendation.clear(),this.checkForOneOrTwoNodeCluster()},checkForOneOrTwoNodeCluster:function(){var e=r.getClusterModelByClusterUuid(this.clusterId);e&&e.isOneOrTwoNodeCluster()&&(this.$(".add-resource-wrapper").tooltip({title:this.i18n("disable_addnode_msg"),placement:"right",trigger:"hover"}),this.$(".recommendation-btn").prop("disabled",!0)),this.$(".add-resource-wrapper").tooltip("destroy"),this.$(".recommendation-btn").prop("disabled",!1)},onScenarioChange:function(e){var t=this.scenarioQueryModel.findScenarioWithId(e);if(this.recommendation.clear(),t){var i=t.DP,n=t.get(i.CLUSTER_SPEC);n&&this.recommendation.set(i.CLUSTER_SPEC,n)}this.renderModels()},onRecoCheckboxClicked:function(e){var t=$(e.currentTarget).closest("tr").data("id");this.recommendation.findNodeWithId(t)[this.recommendation.DP.ENABLED]=$(e.target).is(":checked"),this.parentView.fetchScenarioRunway()},onChangeResourceSortBy:function(){this.renderModels()},addIDToRecommendation:function(){var e=this.recommendation.DP,t=this.recommendation.getModelList();_.each(t,function(t){t[e.ID]||(t[e.ID]=d.randomId())})},destroy:function(){this.$(".existing-models-details").tooltip("destroy"),this.$(".add-resource-wrapper").tooltip("destroy"),$("body").off("click",this.onDocumentClick),this.cpAdjustNodesView.destroy(),e.prototype.destroy.apply(this)},fetchExistingNodes:function(){var e=this,t={};if(this.clusterId){t=l.addFilterCondition(t,o.ENTITY_CLUSTER,l.createFilterCondition(o.ENTITY_CLUSTER,o.ENTITY_CLUSTER,o.FILTER_OPERATORS.EQUALS,this.clusterId));var i=new s({entity_type:o.ENTITY_NODE,group_member_attributes:[u.HOST_MODEL_NAME,u.HOST_MEMORY_SIZE_BYTES,u.CP_CPU_IN_GHZ,u.CP_DISK_SIZE,u.CP_STORAGE_ONLY_NODE,u.NEW_SSD_CAPACITY_BYTES,u.NEW_HDD_CAPACITY_BYTES,u.CPU_CONFIG_LIST,u.MEMORY_CONFIG_LIST,u.HDD_CONFIG_LIST,u.SSD_CONFIG_LIST],filter_expression:t});i.save(null,{success:function(){e.existingNodes=e.convertQueryToNodeSpec(i.getQueryResultAttributes()),e.renderExistingModelsTable(e.existingNodes)},error:function(t,i){e.showHeaderError(i.responseText)}})}},_getResource:function(e,t){var i=this.recommendation.DP,n=e[i.NUMBER_OF_NODES]||1;return e[i.RESOURCE_SPEC]&&e[i.RESOURCE_SPEC][t]?e.existing?e[i.RESOURCE_SPEC][t]:e[i.RESOURCE_SPEC][t]*n:0},_sortModels:function(e){var t=this,i=this.recommendation.DP;e.sort(function(e,n){var s=t.$(".resourceSortBy select").val();return s===T.DATE_DESC?n[i.RECOMMENDED_DATE]-e[i.RECOMMENDED_DATE]:s===T.DATE_ASC?e[i.RECOMMENDED_DATE]-n[i.RECOMMENDED_DATE]:0})}}))}),define("text!templates/basecomponents/details/CapacityPlanning/CPDataStoreConfig.html",[],function(){return'<div class="modal-header">\n  <button type="button" class="close"\n      data-dismiss="modal">\n    <i data-icon="K" aria-hidden="true"></i>\n  </button>\n  <h4 class="n-title">\n    <%= i18n(\'edit_dataconfig\') %>\n  </h4>\n</div>\n<div class="n-modal-wrapper">\n  <form class="form-horizontal" action="javascript:void(0)">\n    <div class="n-modal-body disabled">\n      <div class="n-modal-content-wrapper">\n        <div class="n-modal-alert-header">\n          \x3c!-- @view: alert goes here... --\x3e\n        </div>\n        <div class="store-config-controls">\n          <div class="control-group <%= newCluster ? \'show\' : \'hide\' %>">\n            <label class="control-label">\n              <%= i18n(\'replication_factor\') %>\n            </label>\n            <select class="model-list form-control" model-attribute="rf">\n              <% _.each(factor_list, function(factor) { %>\n              <option value="<%= factor %>">\n                <%= factor %>\n              </option>\n              <% }); %>\n            </select>\n          </div>\n          <div class="control-group">\n            <label class="control-label">\n              <%= i18n(\'cpu_reservation\') %>\n              <span data-toggle="tooltip" class="n-tooltip-circle"\n                title="<%= i18n(\'cpu_reservation_helper\') %>">?</span>\n            </label>\n            <input model-attribute="cpu_reservation_pct" model-validate="range"\n              class="form-control" model-validate-args="0,100"\n              model-attribute-name="<%= i18n(\'cpu_reservation\') %>"/>\n          </div>\n          <div class="control-group">\n            <label class="control-label">\n              <%= i18n(\'memory_reservation\') %>\n              <span data-toggle="tooltip" class="n-tooltip-circle"\n                title="<%= i18n(\'memory_reservation_helper\') %>">?</span>\n            </label>\n            <input model-attribute="ram_reservation_pct" model-validate="range"\n              class="form-control" model-validate-args="0,100"\n              model-attribute-name="<%= i18n(\'memory_reservation\') %>"/>\n          </div>\n          <div class="control-group">\n            <label class="control-label">\n              <%= i18n(\'storage_reservation\') %>\n              <span data-toggle="tooltip" class="n-tooltip-circle"\n                title="<%= i18n(\'storage_reservation_helper\') %>">?</span>\n            </label>\n            <input model-attribute="storage_reservation_pct" model-validate="range"\n              class="form-control" model-validate-args="0,100"\n              model-attribute-name="<%= i18n(\'storage_reservation\') %>"/>\n          </div>\n          <div class="control-group">\n            <label class="control-label">\n              <%= i18n(\'cpu_over_commit\') %>\n              <span data-toggle="tooltip" class="n-tooltip-circle"\n                title="<%= i18n(\'cpu_over_commit_helper\') %>">?</span>\n            </label>\n            <input model-attribute="cpu_overcommit_ratio" model-validate="range"\n              class="form-control" model-validate-args="1,100"\n              model-attribute-name="<%= i18n(\'cpu_over_commit\') %>"/>\n          </div>\n           <div class="control-group">\n            <label class="control-label">\n              <%= i18n(\'memory_over_commit\') %>\n              <span data-toggle="tooltip" class="n-tooltip-circle"\n                title="<%= i18n(\'memory_over_commit_helper\') %>">?</span>\n            </label>\n            <input model-attribute="ram_overcommit_ratio" model-validate="range"\n              class="form-control" model-validate-args="1,100"\n              model-attribute-name="<%= i18n(\'memory_over_commit\') %>"/>\n          </div>\n        </div>\n      </div>\n    </div>\n    <div class="n-modal-footer">\n      <a class="btnCancel btn">\n        <%= i18n(\'cancel\') %>\n      </a>\n      <button class="btnSaveConfig btn btn-primary n-btn-form">\n        <%= i18n(\'save_config\') %>\n      </button>\n    </div>\n  </form>\n</div>\n'}),define("views/details/tabs/CPDataConfigSubview",["views/basecomponents/popups/BasePopupView","utils/ValidationUtil","text!templates/basecomponents/details/CapacityPlanning/CPDataStoreConfig.html"],function(e,t,i){"use strict";var n=[2,3],s={CPU_RESERVATION:"cpu_reservation_pct",MEMORY_RESERVATION:"ram_reservation_pct",STORAGE_RESERVATION:"storage_reservation_pct",CPU_OVERCOMMIT:"cpu_overcommit_ratio",MEMORY_OVERCOMMIT:"ram_overcommit_ratio"};return e.extend({name:"CPDataConfigSubview",subViewTemplate:_.template(i),events:{"click  .btnSaveConfig":"saveDataConfig","click  .btnCancel":"hide","click  .modal-header .close":"hide"},initialize:function(t){if(e.prototype.initialize.apply(this,arguments),t=t||{},this.clusterId=t.clusterId,!t.saveCallback)throw new Error("Specify options.saveCallback to initialize.");this.saveCallback=t.saveCallback},render:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.config=e,this.$el.html(this.subViewTemplate(this.vtOptions({factor_list:n,newCluster:!this.clusterId}))),e[s.CPU_RESERVATION]=e[s.CPU_RESERVATION]||0,e[s.MEMORY_RESERVATION]=e[s.MEMORY_RESERVATION]||0,e[s.STORAGE_RESERVATION]=e[s.STORAGE_RESERVATION]||0,e[s.MEMORY_OVERCOMMIT]=e[s.MEMORY_OVERCOMMIT]||1,e[s.CPU_OVERCOMMIT]=e[s.CPU_OVERCOMMIT]||1,this.setFormWithData(e),this.$(".n-tooltip-circle").tooltip("destroy"),this.$(".n-tooltip-circle").tooltip({placement:"right",trigger:"hover",html:!1}),this.applyNutanixInput()},saveDataConfig:function(){var e=this.getDataModel(this.$(".store-config-controls"));e=_.extend(this.config,e);var i=t.validateFormValues(this.$el);if(i.length){var n=t.defaultErrorHandler(this.$el,i);return void this.showHeaderError(n)}this.hide(),this.saveCallback(e)},hide:function(e,t){this.$el.nutanixPopup({show:!1,removePopup:t||!1,overlayPopup:!0})},show:function(e){this.$el.nutanixPopup({show:!0,overlayPopup:!0}),this.render(e)},destroy:function(){this.$(".n-tooltip-circle").tooltip("destroy"),this.hide(null,!0),e.prototype.destroy.apply(this,arguments)}})}),define("models/capacityplanning/CPVMProfilesModel",["models/BaseModel","data/DataProperties","data/DataURLConstants"],function(e,t,i){"use strict";var n={NAME:"name",ID:"UUID",HDD:"hddGb",SDD:"ssdGb",VCPU:"vCpuCount",MEMORY:"ramGb",RESOURCE_SPEC:"resourceSpec"};return e.extend({name:"CPVMProfilesModel",DP:n,idAttribute:t.UUID,urlRoot:i.CP_VM_PROFILES,setData:function(e){var t={};e&&(t[n.NAME]=e[n.NAME],t[n.RESOURCE_SPEC]={},t[n.RESOURCE_SPEC][n.VCPU]=parseFloat(e[n.VCPU]),t[n.RESOURCE_SPEC][n.MEMORY]=parseFloat(e[n.MEMORY]),t[n.RESOURCE_SPEC][n.HDD]=parseFloat(e[n.HDD]),this.clear(),this.set(t))}},{DP:n})}),define("utils/CommonFilters",["utils/FilterUtil","utils/AppConstants","data/DataProperties"],function(e,t,i){"use strict";return{userVms:function(n){return n=n||{},e.addFilterCondition(n,i.EB.VM.IS_CVM,e.createFilterCondition(t.ENTITY_VM,i.EB.VM.IS_CVM,t.FILTER_OPERATORS.EQUALS,t.FILTER_NOT_INCLUDE_CVM))}}}),define("text!templates/basecomponents/details/CapacityPlanning/CPAddWorkload.html",[],function(){return'<section data-ntnx-section>\n  <label data-ntnx-label>\n    <%= i18n(\'workload.workload_text\') %>\n  </label>\n  <select class="workload-dropdown">\n    <% _.each(_.keys(workload_types), function(type) { %>\n    <option value="<%= type %>">\n      <%= i18n(\'workload.\' + type, type) %>\n    </option>\n    <% }); %>\n  </select>\n</section>\n\n<div class="workload-body"></div>\n'}),define("views/details/tabs/CPWorkloadSubview",["datepicker","views/basecomponents/popups/BasePopupSubView","views/details/tabs/EBEntityTableView","models/capacityplanning/CPScenarioModel","models/capacityplanning/CPVMProfilesModel","models/capacityplanning/CPQueryModel","models/vm/VMModel","managers/AccessManager","utils/TimeUtil","utils/FilterUtil","utils/CommonFilters","utils/StatsUtil","utils/SubViewHelper","utils/ValidationUtil","utils/AppConstants","data/DataProperties","text!templates/basecomponents/details/CapacityPlanning/CPAddWorkload.html"],function(e,t,i,n,s,a,r,o,l,c,u,d,h,p,T,E,S){"use strict";var g=new n,A={sql:{name:"sqlserver",template:"DataBaseWorkload.html",paramType:{sqlProfileType:"string",transactionType:"string",numDB:"int64",businessCritical:"bool"}},vm:{name:"vm",template:"VmWorkload.html",paramType:{resource_uuid:"string",num_vms:"int64"}},vdi:{name:"vdi",template:"VDIWorkload.html",paramType:{vdiVendor:"string",userType:"string",numUsers:"int64",numOfServers:"int64",provisioningType:"string"}},splunk:{name:"splunk",template:"SplunkWorkload.html",paramType:{dailyAverageIndexingRate:"int64",hotRetentionDays:"int64",coldRetentionDays:"int64",searchUsers:"int64"}},xen:{name:"xenapp",template:"XenAppWorkload.html",paramType:{vendor:"string",operatingSystem:"string",rdshProvisioningType:"string",userProfileData:"int64",systemData:"int64",pvsWriteCacheSize:"int64",mcsDiffSize:"int64",numUsers:"int64"}},adjusted:{name:"change_in_workload",template:"ChangeInWorkload.html",paramType:{percentage:"int64"}}},m={HDD:"hdd_gb",MEMORY:"ram_gb",SSD:"ssd_gb",VCPU:"vcpu"},f={XENAPP:"XenApp",MRDSH:"Microsoft RDSH",VIEW:"View",XENDESKTOP:"XenDesktop"},I={PVS:"PVS",MCS:"MCS",VM_CLONE:"VM Clone",LINKED_CLONE:"Linked Clones",FULL_CLONE:"Full Clones",V2V_P2V:"V2V/P2V",MACHINE_SERVICES:"Machine Creation Services",PROV_SERVICES:"Provisioning Services"},C={XENAPP:"rdshProvisioningType",VDI:"provisioningType"},v={CHANGE_TYPE:"changeType",PERCENTAGE:"percentage"},R={INCREASE:"+",DECREASE:"-"},N={EXISTING:"0d",NEW:"+2d"},P={SUBVIEW_EXISTING_VM:"existingVMTableView",SUBVIEW_VM_PROFILE:"vmProfileTableView"};return t.extend({name:"CPWorkloadSubview",subViewTemplate:_.template(S),events:{"change .workload-dropdown":"onSelectWorkload","click  .vm-type":"changeVMType","click  .baseDataTable td":"onSelectVM","click .btnDeleteProfile":"deleteProfile","click input[type=radio][name=vendor]":"onVendorSelect","click input[type=radio][name=vdiVendor]":"onVendorSelect"},initialize:function(e){t.prototype.initialize.apply(this,arguments),this.parentView=e.parentView,this.subViewHelper=new h,this.vmProfileModel=new s},render:function(e){this.workload=e||{},this.selectedVM=null,this.$el.html(this.subViewTemplate(this.vtOptions({workload_types:A})));var t=this.parentView.getWorkloadType(e);t&&this.$(".workload-dropdown").val(t),this.showWorkloadView(this.$(".workload-dropdown").val(),this.workload)},saveWorkLoad:function(){var e=n.DP,t=this.getDataModel(this.$(".workload-body")),i=this.$(".workload-dropdown").val();if(this.vmType===e.WORKLOAD_TYPES.EXISTING_VM&&this.selectedVM)return void this.fetchVMAndExportToVMProfile(this.selectedVM);i===e.WORKLOAD_TYPES.VM&&this.selectedVM&&t&&(t.params=t.params||{},t.params[n.DP.RESOURCE_UUID]=this.selectedVM);var s=i===e.WORKLOAD_TYPES.VM?this.$el.find(".common-controls"):this.$el,a=p.validateFormValues(s);if(a.length){var r=p.defaultErrorHandler(this.$el,a);return void this.showHeaderError(r)}if(this.vmType===e.WORKLOAD_TYPES.NEW_VM_PROFILE)return void this.saveVMProfile(this.selectedVM);var o=this.constructWorkload(i,this.workload,t,t.startdate);this.parentView.updateWorkload(o),this.parentView.disableSaveBtn(),this.parentView.showHeaderLoading()},hideDeleteProfile:function(){this.$el.find(".btnDeleteProfile").hide()},showDeleteProfile:function(){this.$el.find(".btnDeleteProfile").show()},onVendorSelect:function(e){var t=$(e.target).val();this.handleVendorChange(t)},handleVendorChange:function(e,t){var i,n,s=this.getVendorConfiguration(e);i=s.optionsToDisplay||[],n=s.inputName||"",this.$('input[type=radio][name="'+n+'"]').each(function(){$(this).closest(".radioControlGroup").hide()}),_.each(i,function(e){this.$('input[type=radio][value="'+e+'"]').closest(".radioControlGroup").show()},this);var a=t&&t[n]||i[0];this.$('input[type=radio][value="'+a+'"]').attr("checked","checked")},getVendorConfiguration:function(e){var t,i=[];switch(e){case f.XENAPP:i.push(I.PVS,I.MCS),t=C.XENAPP;break;case f.MRDSH:i.push(I.VM_CLONE),t=C.XENAPP;break;case f.VIEW:i.push(I.LINKED_CLONE,I.FULL_CLONE,I.V2V_P2V),t=C.VDI;break;case f.XENDESKTOP:i.push(I.FULL_CLONE,I.V2V_P2V,I.MACHINE_SERVICES,I.PROV_SERVICES),t=C.VDI}return{optionsToDisplay:i,inputName:t}},saveVMProfile:function(){var e=this,t=(s.DP,this.getDataModel(this.$(".workload-body"))),i=p.validateFormValues(this.$el.find(".new-vm-profile"));if(i.length){var a=p.defaultErrorHandler(this.$el.find(".new-vm-profile"),i);return void this.showHeaderError(a)}this.vmProfileModel.setData(t),this.vmProfileModel.enableNotifications=!0,this.showHeaderLoading(),this.vmProfileModel.save(null,{success:function(t,i){e.clearBaseHeader(),e.vmType=n.DP.WORKLOAD_TYPES.VM,e.selectedVM=t.get(E.UUID),e.saveWorkLoad()},error:function(t,i){e.showHeaderError(i.responseText)}})},renderVmDetail:function(e){this.$(".vm-profile-detail .name").html(e[E.NAME]),this.$(".vm-profile-detail .vcpu").html(e[m.VCPU]),this.$(".vm-profile-detail .memory").html(e[m.MEMORY]),this.$(".vm-profile-detail .hdd").html(e[m.HDD]),this.$(".vm-profile-detail").show()},fetchVMAndExportToVMProfile:function(e){var t=this,i=new r;i.setId(e),this.showHeaderLoading(),i.fetch({success:function(e){t.convertAndSaveProfile(e)},error:function(e,i){t.showHeaderError(i.responseText)}})},convertAndSaveProfile:function(e){var t=this;this.vmProfileModel.setData(this.convertVMModelToVMProfile(e)),this.vmProfileModel.enableNotifications=!1,this.vmProfileModel.save(null,{success:function(e,i){t.vmType=n.DP.WORKLOAD_TYPES.VM,t.selectedVM=e.get(E.UUID),t.saveWorkLoad()},error:function(e,i){t.showHeaderError(i.responseText)}})},convertVMModelToVMProfile:function(e){var t=s.DP,i={},n=o.isClusterViewerOnly()?"RESOURCE_47f2a_VM_TEMP_VIEW_ONLY":"INTERNAL_VM_PROFILE_TEMP_47f2a_";return i[t.NAME]=n+e.get(E.VM_NAME)+Date.now(),i[t.MEMORY]=d.convertBytesToUnit(e.getMemoryCapacity(),d.UOM_GIB),i[t.HDD]=d.convertBytesToUnit(e.get(E.VM_DISK_CAPACITY),d.UOM_GIB),i[t.VCPU]=e.getNumVCpus(),i},constructWorkload:function(e,t,i,n){var s=g.DP,a=this;if(!e||!i)return{};i.params=i.params||{},t&&t[s.ID]||(t={}),n=l.getTimeStamp(n),t[s.SCHEDULE_TIME]=n/1e3,t[s.TYPE]=e,t[s.ENABLED]=!0,g.setWorkloadParams(t,[]);var r=g.getWorkloadParams(t);switch(e){case s.WORKLOAD_TYPES.ADJUSTED:i.params[v.CHANGE_TYPE]===R.DECREASE&&(i.params[v.PERCENTAGE]*=-1),delete i.params[v.CHANGE_TYPE]}return _.each(_.keys(i.params),function(t){r.push({key:t,value:i.params[t],valueType:a.getParamType(e,t)})}),t},getParamType:function(e,t){return A[e].paramType[t]},getWorkloadData:function(e,t){var i=g.DP,n={};if(!e||!t)return{};var s=g.getWorkloadParams(t);switch(_.each(s,function(e){n[e.key]=e.value}),e){case i.WORKLOAD_TYPES.ADJUSTED:n[v.PERCENTAGE]<0&&(n[v.CHANGE_TYPE]=R.DECREASE,n[v.PERCENTAGE]*=-1)}return{params:n}},showWorkloadView:function(e,t){var i=this;t=t||{},A[e]&&require(["text!extras/capacityplanning/templates/workloads/"+A[e].template],function(n){i.renderWorkloadTemplate(n,t,e)})},deleteProfile:function(e){var t=this,i=new s;i.id=this.selectedVM,i.destroy({success:function(e){t.subViewHelper.get(P.SUBVIEW_VM_PROFILE)._performQuery()},error:function(e,i){t.showHeaderError(i.responseText)}})},onSelectWorkload:function(e){this.showWorkloadView(e.target.value)},renderWorkloadTemplate:function(e,t,i){var s,a,r,o
;if(this.$(".n-tooltip-circle").tooltip("destroy"),this.$(".workload-body").html(_.template(e,this.vtOptions(t))),t&&_.keys(t).length&&i)a=this.getWorkloadData(i,t),this.setFormWithData(a,this.$(".workload-body")),r=1e3*t[n.DP.SCHEDULE_TIME],r<Date.now()&&(r=Date.now()),o=N.EXISTING;else{s=!0;var c=new Date;c.setDate(c.getDate()+60),r=c.getTime(),o=N.NEW}this.$(".start-date").datepicker(_.extend(l.getDatePickerOptions(),{startDate:o})),this.$(".start-date").datepicker("update",l.formatShortDate(r)),this.$(".n-tooltip-circle").tooltip({placement:"right",trigger:"hover",html:"false"}),this.handleCustomWorkloadActions(i,s,a),this.applyNutanixInput(),s||this.$(".workload-dropdown").trigger("disable")},handleCustomWorkloadActions:function(e,t,i){var s=n.DP;switch(e){case s.WORKLOAD_TYPES.VM:if(this.$(".existing-vms").hide(),t){this.initializeDataTables(),this.selectedVM=null,this.showDeleteProfile(),this.vmType=s.WORKLOAD_TYPES.VM;var a=this.subViewHelper.get(P.SUBVIEW_EXISTING_VM),r=this.subViewHelper.get(P.SUBVIEW_VM_PROFILE);a.render(),a.onStartServices(),r.render(),r.onStartServices()}else this.$(".vm-profiles").hide(),this.$(".tabs").hide(),this.selectedVM=i.params[n.DP.RESOURCE_UUID],this.fetchVMProfile(i.params[n.DP.RESOURCE_UUID]);break;case s.WORKLOAD_TYPES.VDI:i&&i.params&&this.handleVendorChange(i.params.vdiVendor,i.params);break;case s.WORKLOAD_TYPES.XENAPP:i&&i.params&&this.handleVendorChange(i.params.vendor,i.params)}},initializeDataTables:function(){var e=E.EB.VM,t={};c.addFilterCondition(t,"hidden",c.createFilterCondition("hidden","hidden",T.FILTER_OPERATORS.NOT_EQUALS,1));var n=new i({entityType:T.ENTITY_VM,disableCheckBox:!0,displayAttributes:[e.VM_NAME,e.HYPERVISOR_TYPE,e.NUM_VCPUS,e.MEMORY_BYTES],defaultFilter:u.userVms(),el:this.$(".existing-vms .table-wrapper")});this.subViewHelper.register(P.SUBVIEW_EXISTING_VM,n);var s=new i({entityType:T.ENTITY_CAP_PLANNING_RESOURCE,disableCheckBox:!0,defaultFilter:t,el:this.$(".vm-profiles .table-wrapper")});this.subViewHelper.register(P.SUBVIEW_VM_PROFILE,s)},fetchVMProfile:function(e){var t=this,i=new a({entity_type:T.ENTITY_CAP_PLANNING_RESOURCE,entity_ids:[e],group_member_attributes:[E.NAME,m.HDD,m.VCPU,m.MEMORY]});i.save(null,{success:function(){var e=i.getQueryResultAttributes();e&&e[0]&&t.renderVmDetail(e[0]),t.clearBaseHeader()},error:function(e,i){t.showHeaderError(i.responseText)}})},onSelectVM:function(e){this.activeRow&&this.activeRow.removeClass("active"),this.activeRow=$(e.target).closest("tr"),this.activeRow.addClass("active");var t=this.activeRow.attr("actiontargetid");this.selectedVM=t,this.vmType===n.DP.WORKLOAD_TYPES.VM&&this.$(".btnDeleteProfile").prop("disabled",!1)},onClusterChange:function(e){},changeVMType:function(e){var t=n.DP;this.hideDeleteProfile(),"profiles"===e.target.value?(this.showDeleteProfile(),this.$(".vm-profiles").show(),this.$(".existing-vms").hide(),this.$(".new-vm-profile").hide(),this.vmType=t.WORKLOAD_TYPES.VM):"existing"===e.target.value?(this.$(".vm-profiles").hide(),this.$(".existing-vms").show(),this.$(".new-vm-profile").hide(),this.vmType=t.WORKLOAD_TYPES.EXISTING_VM):"new-profile"===e.target.value&&(this.$(".existing-vms").hide(),this.$(".vm-profiles").hide(),this.$(".new-vm-profile").show(),this.vmType=t.WORKLOAD_TYPES.NEW_VM_PROFILE)},destroy:function(){this.subViewHelper&&this.subViewHelper.removeAll(),this.$(".n-tooltip-circle").tooltip("destroy"),t.prototype.destroy.apply(this,arguments)}})}),define("views/utils/CategorySelector",["views/basecomponents/BaseView","managers/NotificationManager","models/categories/CategoriesQueryModel","utils/AppConstants"],function(e,t,i,n){"use strict";var s=_.template('<div class="category-selector"><input class="input-category" type="text" placeholder="<%= i18n("categorySearch") %>" <%= getQaDataTestId("input") %> ><div id="catLoader" class="donut-loader-blue category-loader"></div></div>');return e.extend({name:"CategorySelector",model:null,onChangeCB:null,currentCategories:null,inModal:null,queryXhr:null,events:{},initialize:function(t){e.prototype.initialize.apply(this,arguments),t=t||{},this.onChangeCB=t.onChangeCB,this.inModal=t.inModal,this.selectedCategory=t.selectedCategory,this.hideQuarantineCategory=t.hideQuarantineCategory||!1,this.filterCategoriesCB=t.filterCategoriesCB,this.clearAfter=t.clearAfter||!1,this.queryOnInput=!0,t.model?this.model=t.model:this.model=new i({isSearchMode:this.queryOnInput}),this.queryOnInput||this.model.on(n.EVENT_STATE_MONITOR_STATE_CHANGED,this.render,this)},render:function(){if(this.$(".input-category").autocomplete("destroy"),this.model.getState()===n.STATE_INIT||this.model.getState()===n.STATE_PENDING)return void this.$el.html('<div class="donut-loader-blue"></div>');if(this.model.getState()===n.STATE_ERROR)return void this.$el.html(this.i18n("errorLoadingCategories"));this.$el.html(s(this.vtOptions())),this.updateCurrentCategories();var e=this.getDataSource(),t=this.clearAfter,i=this.inModal,a=this.$(".input-category"),r=this,o=this.$el?this.$el.find(".category-selector"):".category-selector",l=this.queryOnInput?_.debounce(this.querySource.bind(this),250):e;a.autocomplete({appendTo:i?$("body"):o,source:l,select:function(e,i){r.onSelectionChange(e,i),t&&(this.value="")},open:function(){i&&$("ul.ui-autocomplete").addClass("modal-autocomplete")}}).val(this.selectedCategory),this.applyNutanixInput({types:["select"]})},querySource:function(e,i){var s=this;this.$("#catLoader").show(),this.model.setSearchFilter(e.term),this.queryXhr&&this.queryXhr.readyState<0&&this.queryXhr.readyState<4&&this.queryXhr.abort(),this.queryXhr=this.model.performQuery().done(function(){s.$("#catLoader").hide(),s.updateCurrentCategories();var e=s.getDataSource();i(e)}).fail(function(){s.$("#catLoader").hide(),t.showClientNotification(n.NOTIFY_ERROR,s.i18n("errorLoadingCategories"))})},destroy:function(){this.$(".input-category").autocomplete("destroy"),this.model.off(n.EVENT_STATE_MONITOR_STATE_CHANGED,this.render,this),e.prototype.destroy.apply(this,arguments)},setSelectedCategory:function(e){this.selectedCategory=e,this.$(".input-category").val(e)},getSelectedCategory:function(){return this.$(".input-category").val().trim()},updateCurrentCategories:function(){var e=this.model.getCategories(this.hideQuarantineCategory);this.currentCategories=this.filterCategoriesCB?this.filterCategoriesCB(e):e},getDataSource:function(){return _.map(this.currentCategories,function(e){return{label:e.replace(":",": "),value:e}})},getCategoryId:function(e){return this.model.getCategoriesByIds()[e]},isValidCategory:function(e){return e.indexOf(n.ENTITY_CATEGORY_SEPARATOR)>0&&this.model.hasCategory(e)},clear:function(){return this.selectedCategory="",this.$(".input-category").val("")},onSelectionChange:function(e,t){if(this.onChangeCB){var i=t.item?t.item.value:"";_.contains(this.currentCategories,i)?this.onChangeCB(i,this.model):this.onChangeCB(null,this.model)}}})}),define("text!templates/popups/capacityplanning/CPExistingWorkloadContentView.html",[],function(){return'<section data-ntnx-section>\n  <label data-ntnx-label>\n    <%= i18n(\'disregard_category_label\') %>\n  </label>\n  <div class="filter-categories"></div>\n</section>\n<section data-ntnx-section>\n  <label data-ntnx-label>\n    <%= i18n(\'disregard_date_label\') %>\n  </label>\n  <div class="input-append date">\n    <input model-attribute="disregardDate"\n      class="disregard-date form-control" placeholder="<%= i18n(\'date\') %>">\n  </div>\n</section>\n<section class="workloadPreviewSection" data-ntnx-section>\n</section>\n'}),define("views/popups/capacityplanning/CPExistingWorkloadPopupView",["views/basecomponents/popups/BasePopupSubView","views/utils/CategorySelector","views/popups/capacityplanning/CPWhatIfPopupViewMixin","models/capacityplanning/CPScenarioModel","utils/ViewUtil","utils/TimeUtil","utils/AppConstants","text!templates/popups/capacityplanning/CPExistingWorkloadContentView.html"],function(e,t,i,n,s,a,r,o){"use strict";var l=_.template(o),c=_.template("\n      <div class=\"disregard-category-info\">\n        <% if (hasOverlapVms) { %>\n          <div class=\"category-vm-overlap\">\n            <%= i18n('category_vm_overlap_note') %>\n          </div>\n        <% } %>\n          <div>\n            <label data-ntnx-inline-label>\n              <%= i18n('total_number_vms_label') %>\n            </label>\n            <span><%= totalVms %></span>\n          </div>\n        <% if (hasOverlapVms) { %>\n          <div>\n            <label data-ntnx-inline-label>\n              <%= i18n('unique_number_vms_label') %>\n            </label>\n            <span><%= totalConsideredVms %></span>\n          </div>\n        <% } %>\n        <div>\n          <label data-ntnx-inline-label>\n            <%= i18n('disregard_workload_label') %>\n          </label>\n          <span><%= disregardResources %></span>\n        </div>\n      </div>\n    ");return e.extend(_.extend({},i,{name:"CPExistingWorkloadPopupView",events:{},initialize:function(t){t=t||{},e.prototype.initialize.apply(this,arguments),this.parentView=t.parentView,this.scenarioRunwayModel=t.scenarioRunwayModel},destroy:function(){this.$(".disregard-date").datepicker("destroy"),e.prototype.destroy.apply(this,arguments)},render:function(e){var i=this;e=e||{};var s=n.DP,r=e.model;this.$el.html(l(this.vtOptions({}))),this.categorySelector=new t({el:this.$(".filter-categories"),inModal:!0,onChangeCB:function(e){i.categorySelector.setSelectedCategory(e),i.previewDisregard()}}),this.categorySelector.render();var o=void 0;if(r){if(this.workload=r,this.workload[s.PARAMS_LIST]&&this.workload[s.PARAMS_LIST].length){var c=this.getCategoryFromModel(r);this.categorySelector.setSelectedCategory(c)}o=1e3*r[s.SCHEDULE_TIME],o<Date.now()&&(o=Date.now())}else{var u=new Date;u.setDate(u.getDate()+60),o=u.getTime()}var d=a.formatShortDate(o);this.$(".disregard-date").datepicker(_.extend(a.getDatePickerOptions(),{startDate:"0d"})),this.$(".disregard-date").datepicker("update",d)},disregardWorkload:function(){var e=n.DP,t=!0;this.workload&&this.workload[e.ID]||(this.workload={},t=!1);var i=this.categorySelector.getSelectedCategory(),s=this.categorySelector.$el.find("input");s.removeClass("form-control-error");var a=!0;if(t){i===this.getCategoryFromModel(this.workload)&&(a=!1)}if(a&&!this.categorySelector.isValidCategory(i))return s.addClass("form-control-error"),void this.showHeaderError(this.i18n("invalid_category"));this._updateWorkloadObj(this.workload),this.parentView.updateWorkload(this.workload),this.parentView.disableSaveBtn(),this.parentView.showHeaderLoading()},previewDisregard:function(){var e=this,t=n.DP,i=this.categorySelector.getSelectedCategory();if(this.categorySelector.isValidCategory(i)){var a=new n({type:n.TYPE.RUNWAY}),r=this.parentView.getScenarioPayload();a.set(r);var o={};this._updateWorkloadObj(o);var l=a.get(t.WORKLOAD)||[];l.push(o),a.set(t.WORKLOAD,l,{silent:!0}),s.addInLineDonutLoader(this.$(".workloadPreviewSection")),a.save(null,{silent:!0,success:function(i,n){var s=i.get(t.WORKLOAD);if(s&&s.length){var r=s[s.length-1],o=a.getWorkloadParamValue(r,t.PARAMS_LIST_TYPES.NUM_VMS_EXISTING),l=a.getWorkloadParamValue(r,t.PARAMS_LIST_TYPES.NUM_VMS_CONSIDERED),u=o!==l,d=r[t.RESOURCE_REQUIREMENT],h=d[t.CPU],p=d[t.MEMORY],_=d[t.HDD],T=d[t.SSD],E=[];E.push(e.getCpuDisplay(h)),E.push(e.getMemoryDisplay(p)),E.push(e.getStorageDisplay(_,T));var S=E.join(", ");e.$(".workloadPreviewSection").html(c(e.vtOptions({hasOverlapVms:u,totalVms:o,totalConsideredVms:l,disregardResources:S})))}},error:function(t,i){e.$(".workloadPreviewSection").html(e.i18n("preview_error"))}})}},getCategoryFromModel:function(e){var t=n.DP,i=this.scenarioRunwayModel.getWorkloadParamValue(e,t.PARAMS_LIST_TYPES.CATEGORY),s=this.scenarioRunwayModel.getWorkloadParamValue(e,t.PARAMS_LIST_TYPES.VALUE);return i+r.ENTITY_CATEGORY_SEPARATOR+s},_updateWorkloadObj:function(e){var t=n.DP,i=this.$(".disregard-date").val(),s=this.categorySelector.getSelectedCategory(),o=s.split(r.ENTITY_CATEGORY_SEPARATOR);e[t.SCHEDULE_TIME]=a.getTimeStamp(i)/1e3,e[t.TYPE]=t.WORKLOAD_TYPES.VM_CATEGORY,e[t.ENABLED]=!0,e[t.DISREGARD]=!0,e[t.PARAMS_LIST]=[],e[t.PARAMS_LIST].push({key:"category",value:o[0],valueType:"string"}),e[t.PARAMS_LIST].push({key:"value",value:o[1],valueType:"string"})}}))}),define("text!templates/popups/capacityplanning/CPAdjustWorkloadContentView.html",[],function(){return"<div data-ntnx-content-inner>\n  <section id=\"workloadTypeSection\" data-ntnx-section>\n    <h5 data-ntnx-title><%= i18n('resource_type') %></h5>\n  </section>\n  <section data-ntnx-section>\n    <div class=\"workload-type-inputs\">\n      <%= Components.radio({\n        id: 'newWorkloadRadio',\n        name: 'workloadType',\n        classes: '',\n        labelText: i18n('new_workload'),\n        checked: true\n      })\n      %>\n      <%= Components.radio({\n        id: 'disregardWorkloadRadio',\n        name: 'workloadType',\n        labelText: i18n('disregard_workload'),\n        classes: ''\n      })\n      %>\n    </div>\n  </section>\n  <div class=\"newWorkloadSection\"></div>\n  <div class=\"disregardWorkloadSection\"></div>\n</div>\n"}),define("views/details/tabs/CPAdjustWorkloadPopupView",["models/capacityplanning/CPScenarioModel","views/basecomponents/popups/BasePopupView","views/details/tabs/CPWorkloadSubview","views/popups/capacityplanning/CPExistingWorkloadPopupView","utils/SubViewHelper","text!templates/popups/capacityplanning/CPAdjustWorkloadContentView.html"],function(e,t,i,n,s,a){"use strict";var r=_.template(a),o={CP_NEW_WORKLOAD:"cpNewWorkloadView",CP_EXISTING_WORKLOAD:"cpExistingWorkloadView"};return t.extend({name:"CPAdjustWorkloadPopupView",events:{"click .modal-header .close":"hide","click .btnCancel":"hide","click .btnSave":"onSave",'click input:radio[name="workloadType"]':"showAdjustmentSection"},initialize:function(e){e=e||{},t.prototype.initialize.apply(this,arguments),this.subViewHelper=new s,this.parentView=e.parentView,this.scenarioRunwayModel=e.scenarioRunwayModel},render:function(e){if(e=e||{},this.clusterId=e.clusterId,this.$el.html(this.defaultTemplate({title:this.i18n("title"),bodyContent:r(this.vtOptions({})),footerButtons:this.defaultFooter([{text:this.i18n("cancel"),extraClasses:"btnCancel"},{isPrimary:!0,text:this.i18n("save"),extraClasses:"btnSave",extraAttr:[{key:"data-loading-text",value:this.i18n("saving")}]}])})),this.showAdjustmentSection(e),!this.clusterId){this.$el.find("#disregardWorkloadRadio").prop("disabled",!0)}},showAdjustmentSection:function(t){var i=e.DP,n=this.$el.find("#newWorkloadRadio"),s=this.$el.find("#disregardWorkloadRadio"),a=this.$el.find(".newWorkloadSection"),r=this.$el.find(".disregardWorkloadSection");if(t&&t.model){var o=t.model;this.$("#workloadTypeSection").hide(),_.isUndefined(o[i.DISREGARD])||_.isNull(o[i.DISREGARD])?n.prop("checked",!0):s.prop("checked",!0)}n.is(":checked")?(this.showNewWorkload(t),r.hide()):s.is(":checked")&&(a.hide(),this.showDisregardWorkload(t))},showDisregardWorkload:function(e){var t=this.subViewHelper.get(o.CP_EXISTING_WORKLOAD);t||(t=new n({el:this.$(".disregardWorkloadSection"),parentView:this,scenarioRunwayModel:this.scenarioRunwayModel}),this.subViewHelper.register(o.CP_EXISTING_WORKLOAD,t),t.render(e)),t.$el.show()},showNewWorkload:function(e){var t=e.model,n=this.subViewHelper.get(o.CP_NEW_WORKLOAD);n||(n=new i({el:this.$(".newWorkloadSection"),parentView:this,clusterId:this.clusterId}),this.subViewHelper.register(o.CP_NEW_WORKLOAD,n),n.render(t)),n.$el.show()},disableSaveBtn:function(){this.$el.find(".btnSave").prop("disabled","disabled")},enableSaveBtn:function(){this.$el.find(".btnSave").prop("disabled",!1)},getWorkloadType:function(e){return this.scenarioRunwayModel.getWorkloadType(e)},getScenarioPayload:function(){return this.parentView.getScenarioPayload()},updateWorkload:function(e){this.parentView.updateWorkload(e)},onSave:function(){var e=this.$el.find("#newWorkloadRadio"),t=this.$el.find("#disregardWorkloadRadio");e.is(":checked")?this.subViewHelper.get(o.CP_NEW_WORKLOAD).saveWorkLoad():t.is(":checked")&&this.subViewHelper.get(o.CP_EXISTING_WORKLOAD).disregardWorkload()},hide:function(e,t){this.$el.hide(),this.$el.nutanixPopup({show:!1,removePopup:t||!1,overlayPopup:!0}),this.subViewHelper.destroy()},show:function(e){this.$el.nutanixPopup({show:!0,overlayPopup:!0}),this.render(e)},destroy:function(){this.hide(null,!0),t.prototype.destroy.apply(this,arguments)}})}),define("text!templates/basecomponents/details/CapacityPlanning/ScenarioTemplate.html",[],function(){return'<form class="form-horizontal" action="javascript:void(0);">\n  <div class="data-store-config">\n    <div class="clearfix">\n      <div class="col checkbox-col">\n        <%= Components.checkbox({ jsClasses: "input-data", checked: dataConfigEnabled }) %>\n      </div>\n      <div class="col">\n        <div><%= i18n(\'data_config\') %></div>\n      </div>\n      <div class="col edit">\n        <i data-icon="F" aria-hidden="true" class="btnDataConfigEdit"></i>\n      </div>\n    </div>\n  </div>\n  <div class="control-group">\n    <label class="control-label bold">\n      <%= i18n(\'workload_label\') %>\n      <div class="workload-links">\n        <a class="add-workload">\n          <%= i18n(\'adjust_workload\') %>\n        </a>\n      </div>\n    </label>\n  </div>\n  <div class="workloadSortBy">\n    <%= Components.select({\n      options: [\n        { name: i18n(\'sort_by_date_asc\'), value: SORT_BY.DATE_ASC },\n        { name: i18n(\'sort_by_date_desc\'), value: SORT_BY.DATE_DESC }\n      ],\n      dataTestAttribute: \'workloadSortBy\'\n    }) %>\n  </div>\n  <div class="control-group">\n    <div class="workload-list">\n    </div>\n  </div>\n</form>\n'}),define("text!templates/basecomponents/details/CapacityPlanning/CPWorkloadSummary.html",[],function(){return'<div class="type"><%= type %></div>\n<div class="workload-summary-info">\n  <% if (consideredVms) { %>\n    <%= consideredVms %>\n  <% } %>\n  <% if (hasVmOverlap) { %>\n    <span class="has-overlap-vms">\n      <%= Components.icon(\'information-tooltip\', \'-inline\') %>\n    </span>\n  <% } %>\n</div>\n<div class="workload-summary-info">\n  <span><%= cpu %></span>\n  <span><%= memory %></span>\n  <span><%= storage %></span>\n</div>\n<% if (!existing) { %>\n<div class="workload-summary-info">\n  <% if (isDisregard) { %>\n    <span class="adjustment-label disregard-label"\n    ><%= i18n(\'disregard_label\') %></span>\n  <% } else { %>\n    <span class="adjustment-label new-label"\n    ><%= i18n(\'new_label\') %></span>\n  <% } %>\n  <span class="date"><%= date %></span>\n</div>\n<% } %>'}),define("views/details/tabs/CPScenarioSubview",["views/basecomponents/BaseSubView","views/basecomponents/tableinput/TableInputView","views/details/tabs/CPDataConfigSubview","views/details/tabs/CPAdjustWorkloadPopupView","views/popups/capacityplanning/CPWhatIfPopupViewMixin","models/capacityplanning/CPScenarioModel","models/capacityplanning/CPQueryModel","components/Components","utils/AppUtil","utils/SubViewHelper","utils/TimeUtil","utils/StatsUtil","data/DataProperties","utils/AppConstants","text!templates/basecomponents/details/CapacityPlanning/ScenarioTemplate.html","text!templates/basecomponents/details/CapacityPlanning/CPWorkloadSummary.html"],function(e,t,i,n,s,a,r,o,l,c,u,d,h,p,T,E){"use strict";var S={DATE_ASC:"dateAsc",DATE_DESC:"dateDesc"},g={SUBVIEW_CP_DATACONFIG_VIEW:"cpDataConfigSubview"},A=_.template('<tr data-id="<%= dataId %>" class="n-table-row <%= data.workloadType %>"><td class="data-cell"><%= columns[0].renderer(data) %></td><td class="data-cell"><%= columns[1].renderer(data) %></td>'+t.EDIT_COLUMN_TEMPLATE+"</tr>"),m=_.template(E);return e.extend(_.extend({},s,{name:"CPScenarioSubview",scenarioCollection:null,subViewTemplate:_.template(T),events:{"click .action-links .edit":"editWorkLoad","click .action-links .delete":"deleteWorkLoad","click .add-workload":"addWorkLoad","click .btnDataConfigEdit":"editDataConfig","change .workload-list .n-checkbox":"onWorkloadCheckboxClicked","change .data-store-config .n-checkbox":"onDataStoreConfigClicked","change .workloadSortBy":"onChangeWorkloadSortBy"},initialize:function(s){e.prototype.initialize.apply(this,arguments),this.parentView=s.parentView,this.scenarioId=s.scenarioId,this.clusterId=s.clusterId,this.newScenario=s.newScenario,this.scenarioRunwayModel=s.scenarioRunwayModel,this.scenarioQueryModel=s.scenarioQueryModel,this.scenarioModel=s.scenarioModel,this.scenarioModel.set(this.scenarioModel.DP.WORKLOAD,[]),this.originalScenarioModel=new a,this.subViewHelper=new c;var r=new i({el:l.createPopupContainer("popupCPDataConfigView"),clusterId:this.clusterId,saveCallback:_.bind(this.saveDataConfig,this)});this.subViewHelper.register(g.SUBVIEW_CP_DATACONFIG_VIEW,r),this.cpAdjustWorkloadView=new n({el:l.createPopupContainer("popupCPAdjustWorkload"),parentView:this,scenarioRunwayModel:this.scenarioRunwayModel}),this.workloadTableInputView=new t({idAttribute:this.scenarioModel.DP.ID,entityType:p.ENTITY_SCENARIO,disableInlineEdit:!0,tmplDataRow:A,noDataText:this.i18ns("no_workload"),columns:this.getWorkloadTableColumns()}),this.fetchExistingWorkload()},render:function(){this.fetchScenario(this.scenarioId,!1,this.clusterId)},fetchScenario:function(e,t,i){var n=this,s=n.scenarioModel.DP;this.scenarioQueryModel.save(null,{success:function(){var r=n.scenarioQueryModel.getScenarioList();if(r&&r.length){var o;if(e?o=n.findScenarioWithId(e,r):i&&(o=n.findScenarioWithClusterId(i,r)),t)return void n.parentView.updateScenarios(r,o);o||(o=n.newScenario?new a:r[0]),n.originalScenarioModel.set(o.attributes),n.scenarioModel.set(o.attributes),n.addIDToWorkloads(),n.clusterId?(n.scenarioModel.set(s.CLUSTER_ID,n.clusterId),n.scenarioModel.set(s.NEW_CLUSTER,!1)):n.scenarioModel.set(s.NEW_CLUSTER,!0),n.parentView.updateScenarios(r,o)}else n.clusterId||n.scenarioModel.set(s.NEW_CLUSTER,!0),n.parentView.updateScenarios([]);n.renderScenario()},error:function(e,t){n.showHeaderError(t.responseText)}})},addIDToWorkloads:function(){var e=this.scenarioModel.DP,t=this.scenarioModel.get(e.WORKLOAD);_.each(t,function(t){t[e.ID]=l.randomId()})},editWorkLoad:function(e){var t=$(e.currentTarget).closest("tr").data("id"),i=this.scenarioModel.findWorkloadWithId(t);this.parentView.showAdjustWorkLoadView(i)},saveDataConfig:function(e){this.scenarioModel.setDataConfig(e),this.renderDataConfig(),this.parentView.fetchScenarioRunway()},editDataConfig:function(){var e=this.scenarioModel.getDataConfig(),t=this.subViewHelper.get(g.SUBVIEW_CP_DATACONFIG_VIEW);t.clusterId=this.clusterId,t.show(e)},renderDataConfig:function(){var e=this.scenarioModel.getDataConfig(),t=this.scenarioModel.DP;e&&(this.$(".replicationFactor").html(e[t.REPLICATION_FACTOR]),this.$(".overallSavingPercentage").html(e[t.OVERALL_SAVING_PCT]))},onWorkloadCheckboxClicked:function(e){var t=$(e.currentTarget).closest("tr").data("id");this.scenarioModel.findWorkloadWithId(t)[this.scenarioModel.DP.ENABLED]=$(e.target).is(":checked"),this.parentView.fetchScenarioRunway()},onDataStoreConfigClicked:function(e){this.scenarioModel.set(this.scenarioModel.DP.DATASTORE_CONFIG_ENABLED,$(e.target).is(":checked")),this.parentView.fetchScenarioRunway()},updateWorkload:function(e){var t=this;if(!e[this.scenarioModel.DP.WORKLOAD_ID]){e[this.scenarioModel.DP.WORKLOAD_ID]=l.randomId(),e[this.scenarioModel.DP.ENABLED]=!0;var i=this.scenarioModel.get(this.scenarioModel.DP.WORKLOAD);i&&i.push(e)}this.parentView.setPopupClosable(!1),this.parentView.fetchScenarioRunway({hideLoader:!0,error:function(i,n){var s=t.parentView.getWorkLoadView();s.showHeaderError(n.responseText),s.enableSaveBtn(),t.scenarioModel.removeWorkload(e[t.scenarioModel.DP.WORKLOAD_ID])}})},addWorkLoad:function(){this.parentView.runwayFetchInProgress||this.cpAdjustWorkloadView.show({clusterId:this.clusterId})},deleteWorkLoad:function(e){var t=$(e.currentTarget).closest("tr").data("id");this.scenarioModel.removeWorkload(t),this.parentView.fetchScenarioRunway()},renderScenario:function(){this.$el.html(this.subViewTemplate(this.vtOptions({dataConfigEnabled:this.scenarioModel.get(this.scenarioModel.DP.DATASTORE_CONFIG_ENABLED),SORT_BY:S}))),this.tableInitialized=!1,this.scenarioModel.set(this.scenarioModel.DP.DATASTORE_CONFIG_ENABLED,!1),this.parentView.fetchScenarioRunway({fetchDataStoreConfig:!0})},renderWorkList:function(){var e=[];this.existingWorload&&e.push(this.existingWorload);var t=this.scenarioModel.get(this.scenarioModel.DP.WORKLOAD);Array.prototype.push.apply(e,t),this._sortModels(e),this.addIDToWorkloads(),this.workloadTableInputView.dataItems=e,this.tableInitialized?this.workloadTableInputView.renderTable():(this.$(".workload-list").html(this.workloadTableInputView.render().el),this.tableInitialized=!0),t&&t.length?this.$(".workloadSortBy").removeClass("hidden"):this.$(".workloadSortBy").addClass("hidden"),this.$(".has-overlap-vms").tooltip({title:this.i18n("has_overlap_vms"),placement:"right",trigger:"hover",html:!1})},findScenarioWithId:function(e,t){var i=this;return _.find(t,function(t){return t[i.scenarioModel.DP.ID]===e})},findScenarioWithClusterId:function(e,t){return _.find(t,function(t){return t.get(t.DP.CLUSTER_ID)===e})},saveScenario:function(e){var t=this,i=a.DP;e&&this.scenarioModel.set(i.NAME,e),_.each(this.scenarioModel.get(i.WORKLOAD),function(e){delete e.id}),this.scenarioModel.save(null,{success:function(e,i){if(t.parentView.closePopupAfterSave)return void t.parentView.hide(null,!0);t.parentView.setPopupClosable(!0),t.originalScenarioModel.set(t.scenarioModel.attributes),t.parentView.showHeaderSuccess("Saved successfully"),t.fetchScenario(e.id,!0)},error:function(e,i){t.parentView.showHeaderError(i.responseText)}})},isScenarioChanged:function(){var e=a.DP;return!!this.originalScenarioModel&&(this.originalScenarioModel.get(e.CLUSTER_ID)!==this.scenarioModel.get(e.CLUSTER_ID)||this.originalScenarioModel.get(e.TARGET_RUNWAY_DAYS)!==this.scenarioModel.get(e.TARGET_RUNWAY_DAYS))},onClusterChange:function(e){this.clusterId=e,this.clusterId?(this.scenarioModel.set(this.scenarioModel.DP.CLUSTER_ID,this.clusterId),this.scenarioModel.set(this.scenarioModel.DP.NEW_CLUSTER,!1),this.fetchExistingWorkload()):(this.scenarioModel.unset(this.scenarioModel.DP.CLUSTER_ID),this.scenarioModel.set(this.scenarioModel.DP.NEW_CLUSTER,!0),this.existingWorload=null),this.parentView.fetchScenarioRunway()},onScenarioChange:function(e){if(e!==this.scenarioModel.getId()){var t=this.scenarioQueryModel.findScenarioWithId(e);t||(t=new a,this.scenarioModel.clear()),this.scenarioModel.set(t.attributes),this.scenarioModel.set(this.scenarioModel.DP.CLUSTER_ID,this.clusterId),this.clusterId||this.scenarioModel.set(a.DP.NEW_CLUSTER,!0),this.renderScenario()}},getWorkloadTableColumns:function(){var e=this,t=this.scenarioModel.DP;return[{columnName:this.i18n("enable"),renderer:function(e){return o.checkbox({jsClasses:"input-data",checked:e.enabled||0===e[t.WORKLOAD_SOURCE],disabled:0===e[t.WORKLOAD_SOURCE]})}},{columnName:this.i18n("date"),renderer:function(i){var n=void 0,s=!1,a=e.parentView.getWorkloadType(i);if(a===t.WORKLOAD_TYPES.VM_CATEGORY){var r=e.scenarioModel.getWorkloadParamValue(i,t.PARAMS_LIST_TYPES.CATEGORY),o=e.scenarioModel.getWorkloadParamValue(i,t.PARAMS_LIST_TYPES.VALUE);a=r+p.ENTITY_CATEGORY_SEPARATOR+o;var l=e.scenarioModel.getWorkloadParamValue(i,t.PARAMS_LIST_TYPES.NUM_VMS_EXISTING),c=e.scenarioModel.getWorkloadParamValue(i,t.PARAMS_LIST_TYPES.NUM_VMS_CONSIDERED);l?l===c?n=e.i18ns("consider_all_vms",l):(s=!0,n=e.i18ns("consider_some_vms",c,l)):n=e.i18ns("num_vms",0)}else a=e.i18n(a)||a;var d=i[t.RESOURCE_REQUIREMENT][t.CPU],h=i[t.RESOURCE_REQUIREMENT][t.MEMORY],_=i[t.RESOURCE_REQUIREMENT][t.HDD],T=i[t.RESOURCE_REQUIREMENT][t.SSD];return m(e.vtOptions({date:u.formatShortDate(1e3*i[t.SCHEDULE_TIME])||"",consideredVms:n,hasVmOverlap:s,type:a,isDisregard:i[t.DISREGARD],existing:0===i[t.WORKLOAD_SOURCE],cpu:e.getCpuDisplay(d),memory:e.getMemoryDisplay(h),storage:e.getStorageDisplay(_,T)}))}}]},getScenarioPayload:function(){return this.parentView.getScenarioPayload()},convertExistingWorkload:function(e){if(e&&e.length){e=e[0];var t={},i=this.scenarioModel.DP;return t[i.RESOURCE_REQUIREMENT]={},t[i.TYPE]="existing",t[i.RESOURCE_REQUIREMENT][i.CPU]=isNaN(e[h.CP_CPU_USAGE])?"0":d.processCapacityCPUStats(e[h.CP_CPU_USAGE],!1,2),t[i.RESOURCE_REQUIREMENT][i.MEMORY]=isNaN(e[h.CP_MEMORY_USAGE])?"0":d.convertBytesToGiB(e[h.CP_MEMORY_USAGE]),t[i.RESOURCE_REQUIREMENT][i.HDD]=isNaN(e[h.CP_STORAGE_NO_RESERVATION])?"0":d.convertBytesToGiB(e[h.CP_STORAGE_NO_RESERVATION],!0),t[i.WORKLOAD_SOURCE]=0,t}},fetchExistingWorkload:function(){var e=this;if(this.clusterId){var t=new r({entity_type:p.ENTITY_CLUSTER,entity_ids:[this.clusterId],group_member_attributes:[h.CP_STORAGE_NO_RESERVATION,h.CP_CPU_USAGE,h.CP_MEMORY_USAGE]});t.save(null,{success:function(){e.existingWorload=e.convertExistingWorkload(t.getQueryResultAttributes()),e.renderWorkList()},error:function(t,i){e.showHeaderError(i.responseText)}})}},destroy:function(){this.subViewHelper&&this.subViewHelper.destroy(),this.subViewHelper=null,this.$(".has-overlap-vms").tooltip("destroy"),this.cpAdjustWorkloadView.destroy(),e.prototype.destroy.apply(this,arguments)},onChangeWorkloadSortBy:function(){this.tableInitialized=!1,this.renderWorkList()},_sortModels:function(e){var t=this,i=a.DP;e.sort(function(e,n){var s=t.$(".workloadSortBy select").val();return s===S.DATE_DESC?n[i.SCHEDULE_TIME]-e[i.SCHEDULE_TIME]:s===S.DATE_ASC?e[i.SCHEDULE_TIME]-n[i.SCHEDULE_TIME]:0})}}))}),define("text!templates/basecomponents/details/CapacityPlanning/CPSaveScenario.html",[],function(){return'<div data-ntnx-content-inner>\n  <section data-ntnx-section>\n    <label data-ntnx-label>\n      <%= i18n(\'name_scenario\') %>\n    </label>\n    <input type="text" placeholder="<%= i18n(\'name\') %>"\n      value="<%- name %>" class="scenario-name" />\n  </section>\n</div>'}),define("views/details/tabs/CPSaveScenarioSubview",["views/basecomponents/popups/BasePopupView","text!templates/basecomponents/details/CapacityPlanning/CPSaveScenario.html"],function(e,t){"use strict";return e.extend({name:"CPSaveScenarioSubview",subViewTemplate:_.template(t),events:{"click  .btnSaveScenario":"saveScenario","click  .btnCancel":"hide","click  .modal-header .close":"hide"},initialize:function(t){e.prototype.initialize.apply(this,arguments),this.recommendationModel=t.recommendationModel,this.parentView=t.parentView},registerAppEvents:function(){},render:function(e){e=e||"",this.$el.html(this.defaultTemplate({title:this.i18n("save_scenario"),bodyContent:this.subViewTemplate(this.vtOptions({name:e})),footerButtons:this.defaultFooter([{text:this.i18n("cancel"),extraClasses:"btnCancel"},{isPrimary:!0,text:this.i18n("save_scenario"),extraClasses:"btnSaveScenario",extraAttr:[{key:"data-loading-text",value:this.i18n("saving")}]}])}));var t=this.recommendationModel.DP,i=this.recommendationModel.get(t.CLUSTER_SPEC);if(i&&i[t.NODE_SPEC_LIST]){this.parentView.hasRecommendedNodes(i[t.NODE_SPEC_LIST])&&this.showHeaderWarning(this.i18n("recommended_nodes_warning"))}},saveScenario:function(){var e=this.$(".scenario-name").val();e&&(this.parentView.saveScenario(e),this.hide())},hide:function(e,t){this.$el.hide(),this.$el.nutanixPopup({show:!1,removePopup:t||!1,overlayPopup:!0})},show:function(e){this.$el.nutanixPopup({show:!0,overlayPopup:!0}),this.render(e)},onClusterChange:function(e){},destroy:function(){this.hide(null,!0),e.prototype.destroy.apply(this,arguments)}})}),define("text!templates/basecomponents/details/CapacityPlanning/CPWhatIfAnalysisDetailEstimate.html",[],function(){
return'<div class="modal-header">\n  <button type="button" class="close"\n      data-dismiss="modal">\n    <i data-icon="K" aria-hidden="true"></i>\n  </button>\n  <div class="scenario-dropdown-wrapper">\n  </div>\n  <button class="btn saveScenario">\n    <%= i18n(\'save_scenario\') %>\n  </button>\n  <button class="btnGeneratePDF btn n-btn-form">\n    <%= i18n(\'generate_pdf\') %>\n  </button>\n</div>\n\n<div class="n-modal-wrapper">\n  <div class="n-modal-body disabled">\n    <div class="n-modal-content-wrapper">\n      <div class="n-modal-alert-header">\n        \x3c!-- @view: alert goes here... --\x3e\n      </div>\n      <div class="runway-view">\n        <div class="runway-view-inner">\n\n          <div class="left-wrapper">\n            <div class="control-group">\n              <label><%= i18n(\'cluster\') %></label>\n              <select class="cluster-dropdown">\n                <option value=""><%= i18n(\'new_cluster\') %></option>\n                <% _.each(clusterCollection.models, function(cluster) { %>\n                <option value="<%= cluster.get(\'clusterUuid\') %>">\n                  <%= cluster.get(\'name\') %>\n                </option>\n                <% }); %>\n              </select>\n            </div>\n            <div class="control-group">\n              <label><%= i18n(\'target_runway\') %></label>\n              <select class="target-runway-dropdown">\n                <% _.each(targetRunwayDates, function(date) { %>\n                <option value="<%= date %>">\n                  <%= date %> <%= i18n(\'date_type\') %>\n                </option>\n                <% }); %>\n              </select>\n            </div>\n            <div class="control-group vendor-type hide">\n              <label><%= i18n(\'vendor_type\') %></label>\n              <select class="vendor-type-dropdown">\n                <% _.each(vendors, function(vendor) { %>\n                <option value="<%= vendor %>">\n                  <%= vendor %>\n                </option>\n                <% }); %>\n              </select>\n            </div>\n            <div class="loader-wrapper">\n              <div class="donut-loader-blue"></div>\n            </div>\n            <div class="scenario-wrapper"></div>\n          </div>\n\n          <div class="right-wrapper">\n            <div class="loader-wrapper">\n              <div class="donut-loader-blue"></div>\n            </div>\n            <div class="right-wrapper-inner">\n\n              <ul class="n-nav-tab">\n                <li class="tab active" for="line-chart">\n                  <span class="grid-icon css-icon icon">\n                    <span class="bar one"></span>\n                    <span class="bar two"></span>\n                    <span class="bar three"></span>\n                  </span>\n                </li>\n                <li class="tab" for="schedule-chart">\n                  <span class="tile-icon css-icon icon">\n                    <div class="tilerow one">\n                      <span class="tilecell one"></span>\n                      <span class="tilecell two"></span>\n                    </div>\n                    <div class="tilerow two">\n                      <span class="tilecell one"></span>\n                      <span class="tilecell two"></span>\n                    </div>\n                  </span>\n                </li>\n              </ul>\n              <div class="line-chart tab-content active">\n              </div>\n              <div class="schedule-chart tab-content">\n                <div class="runway-info"></div>\n                <div class="visual-info"></div>\n              </div>\n              <div class="recommendation-models"></div>\n            </div>\n          </div>\n\n        </div>\n      </div>\n      <div class="workload-wrapper">\n      </div>\n    </div>\n  </div>\n</div>\n'}),define("views/popups/capacityplanning/CPWhatIfAnalysisPopupView",["views/basecomponents/popups/BasePagePopupView","data/DataURLConstants","managers/ClusterManager","managers/IdleManager","managers/HelpManager","managers/AccessManager","models/capacityplanning/CPSharedModel","models/query/RunwayInfoQueryModel","models/capacityplanning/CPScenarioQueryModel","models/capacityplanning/CPScenarioModel","views/details/tabs/CPRunwaySubview","views/details/tabs/CPPlanningChartView","views/details/tabs/CPRunwayEstimateSubview","views/details/tabs/CPRecommendedModelSubview","views/details/tabs/CPScenarioSubview","views/details/tabs/CPSaveScenarioSubview","utils/AppConstants","utils/AppUtil","utils/SubViewHelper","utils/SubModelHelper","components/Components","text!templates/basecomponents/details/CapacityPlanning/CPWhatIfAnalysisDetailEstimate.html","events/AppEvents"],function(e,t,i,n,s,a,r,o,l,c,u,d,h,p,T,E,S,g,A,m,f,I,C){"use strict";var v={SUBVIEW_CP_RUNWAY_ESTIMATE_VIEW:"cpRunwayEstimateView",SUBVIEW_CP_RUNWAY_CHART_VIEW:"cpRunwayChartView",SUBVIEW_CP_RUNWAY_SUMMARY_VIEW:"cpRunwaySummaryView",SUBVIEW_CP_SCENARIO_VIEW:"cpScenarioSubview",SUBVIEW_CP_SAVE_SCENARIO_VIEW:"cpSaveScenarioSubview",SUBVIEW_CP_RECOMMEND_MODEL_VIEW:"cpRecommndedModelSubview"},R={GLOBAL:"global",RECO:"reco",RUNWAY:"runway"};return e.extend({name:"CPWhatIfAnalysisPopupView",el:"#popupWhatIf",popupClosable:!0,popupViewTemplate:_.template(I),events:{"click  .modal-header .close":"hide","click  .n-modal-footer .btnBack":"hideWorkLoadView","click  .n-modal-footer .btnCancel":"hide","change .target-runway-dropdown":"fetchScenarioRunway","change .vendor-type-dropdown":"onVendorTypeChange","change .cluster-dropdown":"onClusterChange","click  .recommendation-btn":"fetchRecommendation","click  .saveScenario":"openSaveScenarioPopup","click  .tab":"switchTab","click  .btnGeneratePDF":"openPDFLink","click  .scenario-dropdown .scenario-item":"onScenarioChange"},modelEvents:{"sync scenarioRunway":"onRunwayChange","sync recommendationModel":"onRecommendationChange"},initialize:function(t){t=t||{},e.prototype.initialize.apply(this,arguments),this.clusterId=t.clusterId,this.scenarioId=t.scenarioId,this.newScenario=t.newScenario,this.whatIfModel=t.whatIfModel,this.onCloseCallback=t.onCloseCallback,this.clusterCollection=i.getClusterCollection(),this.subViewHelper=new A,this.subModelHelper=new m,this._initializeSubModels(),this.clusterId||this.clusterCollection.at(0)||this.subModelHelper.get("cpScenarioModel").set(c.DP.NEW_CLUSTER,!0),this.scenarioRunway=this.subModelHelper.get("scenarioRunwayModel"),this.recommendationModel=this.subModelHelper.get("recommendationModel"),this.registerWindowBeforeunloadEvent()},render:function(){this.$el.append(this.popupViewTemplate(this.vtOptions({clusterCollection:this.clusterCollection,vendors:S.HARDWARE_VENDORS,targetRunwayDates:this.getTargetRunwayDates()}))),this.$(".cluster-dropdown").val(this.clusterId),this.$(".target-runway-dropdown").val(6),this.clusterId||this.showVendorType(),this._initializeSubViews(),this.subViewHelper.renderAll(),this.activeTabEl=this.$(".tab.active"),this.activeContentEl=this.$(".line-chart");var e=this.subViewHelper.get(v.SUBVIEW_CP_RUNWAY_SUMMARY_VIEW);e.renderRunwayTemplate(this.getRunwaySummaryData()),e.$(".storageOption").click();var t=this.subModelHelper.get("cpScenarioModel");return t.set(t.DP.TARGET_RUNWAY_DAYS,6),t.set(t.DP.CLUSTER_ID,this.clusterId),this.applyNutanixInput(),a.isClusterViewerOnly()&&this.$(".saveScenario").prop("disabled",!0),this},getHelpUrl:function(){return s.getHelpUrlForDetails(S.ENTITY_SCENARIO)},registerAppEvents:function(){_.bindAll(this,"onAppEventHandler"),C.onAppEvent(C.ROUTE_CHANGE,this.onAppEventHandler)},onAppEventHandler:function(){!1===n.isLoggingOut?this.hide(!1,!1):this.unregisterWindowBeforeunloadEvent()},registerWindowBeforeunloadEvent:function(){var e=this;$(window).on("beforeunload.CPWhatIfAnalysisPopupView",function(t){var i=e.subViewHelper.get(v.SUBVIEW_CP_SCENARIO_VIEW);if(i&&(!e.popupClosable||i.isScenarioChanged())){var n=e.i18n("unsaved_changes");return t.originalEvent.returnValue=n,n}})},unregisterWindowBeforeunloadEvent:function(){$(window).off("beforeunload.CPWhatIfAnalysisPopupView")},getRunwaySummaryData:function(){var e=this.subModelHelper.get("recommendationModel"),t=e.DP;return{sVal:e.get(t.STORAGE_RUNWAY),mVal:e.get(t.MEMORY_RUNWAY),cpuVal:e.get(t.CPU_RUNWAY),clusterVal:e.get(t.RUNWAY)}},getClusterRunwayVals:function(e){return this.clusterRunwayVals},refreshSubView:function(e,t){var i=this.subViewHelper.get(v.SUBVIEW_CP_RUNWAY_CHART_VIEW);switch(t){case v.SUBVIEW_CP_RUNWAY_CHART_VIEW:i.updateChartContext(e),i.renderChart(i.getChartData())}e&&(i.updateChartContext(e),i.renderChart(i.getChartData()))},destroy:function(){this.subViewHelper&&this.subViewHelper.removeAll(),this.subModelHelper&&this.subModelHelper.removeAll(),C.offAppEvent(C.ROUTE_CHANGE,this.onAppEventHandler),this.unregisterWindowBeforeunloadEvent(),e.prototype.destroy.apply(this,arguments)},_initializeSubModels:function(){var e={clusterId:this.clusterId},t=new o,i=new c({type:c.TYPE.RUNWAY}),n=new c({type:c.TYPE.RECOMMENDATION}),s=new l(e),a=new r,u=new c;this.subModelHelper.register("runwayInfoQueryModel",t),this.subModelHelper.register("scenarioRunwayModel",i),this.subModelHelper.register("recommendationModel",n),this.subModelHelper.register("scenarioQueryModel",s),this.subModelHelper.register("cpSharedModel",a),this.subModelHelper.register("cpScenarioModel",u)},_initializeSubViews:function(){if(!this.subViewInitialized){var e=new h({el:this.$(".line-chart"),parentView:this,scenarioRunwayModel:this.subModelHelper.get("scenarioRunwayModel")});this.subViewHelper.register(v.SUBVIEW_CP_RUNWAY_ESTIMATE_VIEW,e);var t=new u({el:this.$(".runway-info"),parentView:this,clusterId:this.clusterId,shortTitle:!0,sharedModel:this.subModelHelper.get("cpSharedModel"),runwayInfoQueryModel:this.subModelHelper.get("runwayInfoQueryModel")});this.subViewHelper.register(v.SUBVIEW_CP_RUNWAY_SUMMARY_VIEW,t);var i=new d({el:this.$(".visual-info"),parentView:this,cpEventModel:this.cpEventModel,scenarioRunwayModel:this.subModelHelper.get("scenarioRunwayModel"),recommendationModel:this.subModelHelper.get("recommendationModel")});this.subViewHelper.register(v.SUBVIEW_CP_RUNWAY_CHART_VIEW,i);var n=new T({el:this.$(".scenario-wrapper"),parentView:this,scenarioId:this.scenarioId,clusterId:this.clusterId,newScenario:this.newScenario,scenarioRunwayModel:this.subModelHelper.get("scenarioRunwayModel"),scenarioModel:this.subModelHelper.get("cpScenarioModel"),scenarioQueryModel:this.subModelHelper.get("scenarioQueryModel")});this.subViewHelper.register(v.SUBVIEW_CP_SCENARIO_VIEW,n);var s=new E({el:g.createPopupContainer("popupSaveScenarioView"),recommendationModel:this.subModelHelper.get("recommendationModel"),parentView:this});this.subViewHelper.register(v.SUBVIEW_CP_SAVE_SCENARIO_VIEW,s);var a=new p({el:this.$(".recommendation-models"),parentView:this,clusterId:this.clusterId,scenarioRunwayModel:this.subModelHelper.get("scenarioRunwayModel"),recommendationModel:this.subModelHelper.get("recommendationModel"),scenarioQueryModel:this.subModelHelper.get("scenarioQueryModel")});this.subViewHelper.register(v.SUBVIEW_CP_RECOMMEND_MODEL_VIEW,a),this.subViewInitialized=!0}},getTargetRunwayDates:function(){var e,t=[];for(e=1;e<=12;e++)t.push(e);return t},showLoader:function(e){switch(e){case R.GLOBAL:this.$el.addClass("loading");break;case R.RECO:this.$el.find(".reco-loader-wrapper").removeClass("hide");break;default:this.$el.find(".runway-loader-wrapper").removeClass("hide")}},hideLoader:function(){this.$el.removeClass("loading"),this.$el.find(".runway-loader-wrapper").addClass("hide"),this.$el.find(".reco-loader-wrapper").addClass("hide")},fetchScenarioRunway:function(e){var t=this,i=this.subModelHelper.get("scenarioRunwayModel");i.clear(),i.set(this.getScenarioPayload(e)),e=e||{},e.hideLoader||this.showLoader(),this.runwayFetchInProgress=!0,i.save(null,{error:function(i,n){t.runwayFetchInProgress=!1,e&&e.error?e.error(i,n):t.showHeaderError(n.responseText),t.hideLoader()}})},getScenarioPayload:function(e){var t=this.subModelHelper.get("cpScenarioModel"),i=this.subModelHelper.get("recommendationModel"),n=t.DP;e=e||{},t.set(n.TARGET_RUNWAY_DAYS,this.getTotalRunway()),t.get(n.NEW_CLUSTER)?t.set(n.VENDOR_TYPE,[this.$(".vendor-type-dropdown").val()]):t.unset(n.VENDOR_TYPE);var s=new c;return s.set(JSON.parse(JSON.stringify(t.attributes))),i.get(n.CLUSTER_SPEC)&&s.set(n.CLUSTER_SPEC,i.get(n.CLUSTER_SPEC)),!s.get(n.DATASTORE_CONFIG_ENABLED)||e.fetchDataStoreConfig?s.setDataConfig():s.setDataConfig(t.getDataConfig()),s.unset(n.UUID),s.toJSON()},fetchRecommendation:function(){var e=this,t=this.subModelHelper.get("recommendationModel");if(!this.recommendationFetchInProgress){this.recommendationFetchInProgress=!0,t.set(this.getScenarioPayload());var i=t.DP,n=t.get(i.CLUSTER_SPEC);n&&n[i.NODE_SPEC_LIST]&&(n[i.NODE_SPEC_LIST]=this.filterRecommendedNodes(n[i.NODE_SPEC_LIST])),t.set(i.CLUSTER_SPEC,n),this.showLoader(R.RECO),t.save(null,{error:function(t,i){e.recommendationFetchInProgress=!1,e.showHeaderError(i.responseText),e.hideLoader()}})}},getTotalRunway:function(){return 30*this.$(".target-runway-dropdown").val()},showAdjustWorkLoadView:function(e){this.runwayFetchInProgress||this.getWorkLoadView().show({model:e})},hideWorkLoadView:function(){this.getWorkLoadView().hide()},getWorkLoadView:function(){return this.subViewHelper.get(v.SUBVIEW_CP_SCENARIO_VIEW).cpAdjustWorkloadView},updateScenarios:function(e,t){var i=[],n=c.DP;i.push({attributes:'data-value=""',class:"scenario-item",name:this.i18n("new_scenario")}),_.each(e,function(e){i.push({attributes:'data-value="'+e.get(n.ID)+'"',class:"scenario-item",name:e.get(n.NAME)})});var s=t&&t.get(n.NAME)?t.get(n.NAME):this.i18n("new_scenario");if(this.$(".scenario-dropdown-wrapper").html(f.dropdown({id:"scenario-dropdown",classes:"scenario-dropdown",variants:"dropdown-menu-right -compact",text:s,options:i})),t&&t.get(n.ID)?this.scenarioId=t.get(n.ID):delete this.scenarioId,t){if(this.clusterId!==t.get(n.CLUSTER_ID)&&(this.$(".cluster-dropdown").val(t.get(n.CLUSTER_ID)),this.isScenarioUpdate=!0,this.$(".cluster-dropdown").trigger("change")),t.get(n.TARGET_RUNWAY_DAYS)){var a=parseInt(t.get(n.TARGET_RUNWAY_DAYS),10);this.$(".target-runway-dropdown").val(a/30),this.$(".target-runway-dropdown").trigger("change")}t.get(n.VENDOR_TYPE)&&(this.$(".vendor-type-dropdown").val(t.get(n.VENDOR_TYPE)[0]),this.$(".vendor-type-dropdown").trigger("change"))}this.subViewHelper.iterate("onScenarioChange",this.scenarioId)},onClusterChange:function(e){var t=this,i=this.clusterId||null,n=$(e.target),s=n.val()||null;if(i!==s){s?this.hideVendorType():this.showVendorType();var a=c.DP,r=this.subModelHelper.get("cpScenarioModel"),o=r.get(a.WORKLOAD),l=_.some(o,function(e){return!0===e[a.DISREGARD]}),u=this.subModelHelper.get("recommendationModel"),d=u.get(a.CLUSTER_SPEC),h=!1;if(d){var p=d[a.NODE_SPEC_LIST];h=_.some(p,function(e){return!0===e[a.DISREGARD]})}this.isScenarioUpdate||!l&&!h?this.doClusterChange(s):$.nutanixConfirm({msg:this.i18n("cluster_change_disregard_confirm"),yes:function(){var e=_.filter(o,function(e){return!0!==e[a.DISREGARD]});r.set(a.WORKLOAD,e),t.doClusterChange(s)},no:function(){n.val(i).change()},yesText:this.i18n("continue"),noText:this.i18n("cancel"),context:this}),this.isScenarioUpdate=!1}},doClusterChange:function(e){this.clusterId=e,this.clearRecommendationFromModels(),this.subViewHelper.iterate("onClusterChange",this.clusterId)},clearRecommendationFromModels:function(){var e,t=c.DP,i=this.subModelHelper.get("scenarioRunwayModel"),n=this.subModelHelper.get("recommendationModel");i.get(t.CLUSTER_SPEC)&&(e=i.get(t.CLUSTER_SPEC),delete e[t.NODE_SPEC_LIST]),n.get(t.CLUSTER_SPEC)&&(e=n.get(t.CLUSTER_SPEC),delete e[t.NODE_SPEC_LIST])},showVendorType:function(){this.$(".vendor-type").show()},hideVendorType:function(){this.$(".vendor-type").hide()},onScenarioChange:function(e){this.clearRecommendationFromModels(),this.showLoader(R.GLOBAL);var t=this.subModelHelper.get("scenarioQueryModel"),i=t.findScenarioWithId($(e.currentTarget).attr("data-value")),n=t.getScenarioList();this.updateScenarios(n,i)},onVendorTypeChange:function(){this.subModelHelper.get("recommendationModel").clear(),this.fetchScenarioRunway()},getVendorList:function(){var e=this.subModelHelper.get("cpScenarioModel");if(e.get(e.DP.NEW_CLUSTER))return[this.$(".vendor-type-dropdown").val()]},onRunwayChange:function(){var e=this,t=this.subModelHelper.get("scenarioRunwayModel"),i=this.subModelHelper.get("cpScenarioModel"),n=this.subViewHelper.get(v.SUBVIEW_CP_SCENARIO_VIEW),s=t.DP;this.runwayFetchInProgress=!1,this.hideLoader(),t.get(s.WORKLOAD)&&n.scenarioModel.set(s.WORKLOAD,t.get(s.WORKLOAD)),n.renderWorkList(),t.getDataConfig()&&!i.getDataConfig()&&(i.setDataConfig(t.getDataConfig()),n.renderDataConfig());var a=t.get(s.RUNWAY_GAIN);i.set(s.RUNWAY_GAIN,a),this.updateRecommendation(a),this.refreshSubView(null,v.SUBVIEW_CP_RUNWAY_CHART_VIEW),this.hideWorkLoadView();var r=t.get(s.WARNING_LIST);_.each(r,function(t){var i=t[s.WARNING_MSG];i&&e.showHeaderWarning(i)})},updateRecommendation:function(e){if(e){var t=i.getClusterModelByClusterUuid(this.clusterId);!(e[c.DP.RUNWAY]<this.getTotalRunway())||t&&t.isOneOrTwoNodeCluster()?this.$(".recommendation-btn").prop("disabled",!0):this.$(".recommendation-btn").prop("disabled",!1)}},setPopupClosable:function(e){this.popupClosable=e},onRecommendationChange:function(){var e=this.subModelHelper.get("scenarioRunwayModel"),t=this.subModelHelper.get("recommendationModel"),i=t.DP;this.recommendationFetchInProgress=!1,this.hideLoader(),t.get(i.CLUSTER_SPEC)&&e.set(i.CLUSTER_SPEC,t.get(i.CLUSTER_SPEC)),this.updateRecommendation(t.get(i.RUNWAY_GAIN)),this.subViewHelper.get(v.SUBVIEW_CP_RUNWAY_ESTIMATE_VIEW).renderChart(t.get(i.RUNWAY_GAIN)),this.setPopupClosable(!1),this.refreshSubView(null,v.SUBVIEW_CP_RUNWAY_CHART_VIEW)},switchTab:function(e){var t=$(e.currentTarget);this.activeTabEl.removeClass("active"),this.activeContentEl.removeClass("active"),this.activeTabEl=t,this.activeTabEl.addClass("active"),this.activeContentEl=this.$("."+this.activeTabEl.attr("for")),this.activeContentEl.addClass("active"),this.refreshSubView(null,v.SUBVIEW_CP_RUNWAY_CHART_VIEW)},getPropRenderer:function(e){return function(t){return t[e]||""}},openSaveScenarioPopup:function(){var e=this.subModelHelper.get("cpScenarioModel");this.subViewHelper.get(v.SUBVIEW_CP_SAVE_SCENARIO_VIEW).show(e.get(e.DP.NAME))},saveScenario:function(e){var t=c.DP,i=this.subViewHelper.get(v.SUBVIEW_CP_SCENARIO_VIEW),n=this.subModelHelper.get("cpScenarioModel"),s=this.subModelHelper.get("recommendationModel"),a=s.get(t.CLUSTER_SPEC);n.set(t.CLUSTER_SPEC,a),i.saveScenario(e)},filterRecommendedNodes:function(e){var t=c.DP,i=[];return e&&e.length&&(i=e.filter(function(e){return e[t.NODE_TYPE]!==t.NODE_TYPES.SYSTEM_RECOMMENDED})),i},hasRecommendedNodes:function(e){var t=c.DP,i=!1;return e&&e.length&&(i=_.some(e,function(e){return e[t.NODE_TYPE]===t.NODE_TYPES.SYSTEM_RECOMMENDED})),i},showConfirmDialog:function(){$.nutanixConfirm({msg:this.i18n("confirm_save_msg"),yes:function(){this.closePopupAfterSave=!0,this.openSaveScenarioPopup()},no:function(){this.hide(null,!0)},yesText:this.i18n("yes"),noText:this.i18n("no"),context:this})},hide:function(t,i){var n=this.subViewHelper.get(v.SUBVIEW_CP_SCENARIO_VIEW);i||this.popupClosable&&!n.isScenarioChanged()?(this.onCloseCallback&&this.onCloseCallback(),e.prototype.hide.apply(this)):this.showConfirmDialog()},openPDFLink:function(){var e=new c,i=this;e.set(this.getScenarioPayload()),e.set(e.DP.NAME,e.DP.PDF_TEMP_FILE_NAME+"_"+Date.now()),e.save(null,{success:function(n,s){window.open(e.getDataSourceURL()+_.template(t.CP_SCENARIO_REPORT)({id:s[c.DP.UUID],locale:i.getLocale()}))},error:function(e,t){i.showHeaderError("Error generating PDF")}})},getWorkloadType:function(e){return this.subModelHelper.get("scenarioRunwayModel").getWorkloadType(e)}})}),define("text!templates/basecomponents/details/CapacityPlanning/CPWhatIfAnalysisSubView.html",[],function(){return'<div class="capacity-what-if-analysis">\n  <div class="title">\n    <%= i18n(\'plan_capacity_title\') %>\n  </div>\n  <div class="content">\n    <div class="desc">\n      <span><%= i18n(\'plan_capacity_desc\') %></span>\n    </div>\n    <button class="btn btnEstimate" value="Estimate">\n      <%= i18n(\'get_started\') %>\n    </button>\n    <div class="hide info-msg desc">\n      <%= i18n(\'no_data\') %>\n    </div>\n  </div>\n</div>'}),define("views/details/tabs/CPWhatIfAnalysisSubView",["views/basecomponents/BaseSubView","views/popups/capacityplanning/CPWhatIfAnalysisPopupView","models/capacityplanning/CPWhatIfWrapperModel","utils/AppUtil","data/DataProperties","text!templates/basecomponents/details/CapacityPlanning/CPWhatIfAnalysisSubView.html"],function(e,t,i,n,s,a){"use strict";return e.extend({events:{"click .btnEstimate":"onClickEstimate"},modelEvents:{"sync  runwayInfoQueryModel":"renderRunwayDetails"},subViewTemplate:_.template(a),name:"CPWhatIfAnalysisSubview",popupView:null,runwayInfoQueryModel:null,initialize:function(t){if(!t||!t.runwayInfoQueryModel)throw new Error("Specify options & the following properties in options : runwayInfoQueryModel");this.runwayInfoQueryModel=t.runwayInfoQueryModel,e.prototype.initialize.apply(this,arguments),this.delegateModelEvents(),_.bindAll(this,"showModelError")},render:function(){this.$el.html(this.subViewTemplate(this.vtOptions())),this.applyNutanixInput({types:["select"]})},setModelId:function(e){this.currentClusterId=e},renderRunwayDetails:function(e){var t=this.runwayInfoQueryModel.getQueryResultAttributes();!t||!t[0]||t[0][s.CP_READY_FLAG_INSIGHTS]&&"1"===t[0][s.CP_READY_FLAG_INSIGHTS][0]||(this.$(".btnEstimate").prop("disabled",!0),this.$(".info-msg").show())},onClickEstimate:function(){var e=this;this.whatIfModel=new i;var s=new t({el:n.createPopupContainer("popupWhatIf"),clusterId:e.currentClusterId});s.show(),s.startServices()}})}),define("text!templates/basecomponents/details/CapacityPlanning/CPTabDetailsView.html",[],function(){return'<div class="tab-wrapper">\n  <div class="left-bar">\n    <div class="runway-info"></div>\n    <div class="recommendations-info"></div>\n    <div class="whatif-info"></div>\n  </div>\n  <div class="content-wrapper">\n    <div class="drilldown-info"></div>\n    <div class="visual-info"></div>\n  </div>\n</div>'}),define("views/details/tabs/CPTabContentDetailsView",["views/basecomponents/details/tabs/BaseTabContentDetailsView","data/DataProperties","models/query/RunwayInfoQueryModel","models/query/QueryResultCollection","models/capacityplanning/CPQueryModel","models/capacityplanning/CPSharedModel","models/capacityplanning/CPAlertQueryModel","models/capacityplanning/CPEventQueryModel","models/capacityplanning/CPWhatIfWrapperModel","views/details/tabs/CPRunwaySubview","views/details/tabs/CPChartView","views/details/tabs/CPDrillDownSubView","views/details/tabs/CPRecommendationSubView","views/details/tabs/CPWhatIfAnalysisSubView","utils/AppConstants","utils/AppUtil","utils/AlertUtil","utils/SubViewHelper","text!templates/basecomponents/details/CapacityPlanning/CPTabDetailsView.html"],function(e,t,i,n,s,a,r,o,l,c,u,d,h,p,T,E,S,g,A){"use strict";return e.extend({extraClassName:"n-capacity-tab-content-details multi-col",tabViewTemplate:_.template(A),initialize:function(){e.prototype.initialize.apply(this,arguments),this.subViewHelper=new g,this.analysisContext={selectedEntityType:"cluster",selectedEntityIds:[],selectedEntityNames:[],selectedMetric:null,parentEntityId:null,chartType:null},this.runwayInfoQueryModel=new i,this.cpModel=new s,this.cpAlertModel=new n,this.cpEventModel=new n,this.sharedModel=new a},render:function(){this.$el.append(this.tabViewTemplate()),this._initializeSubViews(),this.subViewHelper.renderAll();var e=S.getXfitFeatureInfo();if(e.featureDisabled||e.licenseDisabled){var t=e.featureDisabled?"common.prismProFeatureDisabled":"common.xfitFeatureDisabled";this.$(".content-wrapper").html(this.i18nStatic("ViewFilters",t)),this.$(".tab-wrapper").addClass("feature-disabled")}return this},hide:function(){e.prototype.hide.apply(this,arguments),$(".page-left").show(),$(".tabBody").removeClass("capacityTabSelected")},show:function(){e.prototype.show.apply(this,arguments),$(".page-left").hide(),$(".tabBody").addClass("capacityTabSelected")},destroy:function(){E.debug("CPTabContentDetailsView : destroy: "," | viewid     : "+this.cid),this.cpEventModel=null,this.cpAlertModel=null,this.runwayInfoQueryModel=null,this.cpModel=null,this.subViewHelper&&this.subViewHelper.removeAll(),this.hide(),e.prototype.destroy.apply(this,arguments)},_initializeSubViews:function(){var e=new c({el:this.$(".runway-info"),parentView:this,cpAlertModel:this.cpAlertModel,sharedModel:this.sharedModel,runwayInfoQueryModel:this.runwayInfoQueryModel,cpModel:this.cpModel});this.subViewHelper.register("cpRunwaySummaryView",e);var t=new u({el:this.$(".visual-info"),parentView:this,sharedModel:this.sharedModel,cpAlertModel:this.cpAlertModel,cpEventModel:this.cpEventModel});this.subViewHelper.register("cpChartView",t),this.cpChartView=this.subViewHelper.get("cpChartView");var i=new d({el:this.$(".drilldown-info"),parentView:this,sharedModel:this.sharedModel,cpModel:this.cpModel});this.subViewHelper.register("cpDrillDownOptionView",i);var n=new h({el:this.$(".recommendations-info")});this.subViewHelper.register("cpRecommendationView",n);var s=new p({el:this.$(".whatif-info"),whatIfWrapperModel:new l,runwayInfoQueryModel:this.runwayInfoQueryModel});this.subViewHelper.register("cpWhatIfView",s)},updateChart:function(e){var t=this.subViewHelper.get("cpChartView");this.updateContextObjectFromDOM(),t&&t.updateAnalysisContext(this.analysisContext)},updateContextObjectFromDOM:function(){var e=this.$(".selectedBtnOpt"),t=(e.attr(T.NAV_ACTION),[]),i=[];e.attr("actionTopSelectedEntityId")&&(t=e.attr("actionTopSelectedEntityId").split(","),i=e.attr("actionTopSelectedEntityNames").split(","));var n={};e.attr("actionEntityType")&&e.attr("actionEntityType").toLowerCase()===T.ENTITY_CONTAINER&&"Individual"===e.attr("actionTypeOfChart")?n.selectedMetric={past:$.map(e.attr("actionContainerHistoricMetric").split(","),$.trim),future:$.map(e.attr("actionContainerPredictionMetric").split(","),$.trim)}:e.attr("actionHistoricMetric")&&e.attr("actionPredictionMetric")&&(n.selectedMetric={past:$.map(e.attr("actionHistoricMetric").split(","),$.trim),future:$.map(e.attr("actionPredictionMetric").split(","),$.trim)}),n.selectedEntityType=e.attr("actionEntityType");var s=e.attr("actionSelectedEntityId");n.selectedEntityIds={top:t,others:s?s.split(","):[]};var a=e.attr("actionSelectedEntityNames");n.selectedEntityNames={top:i,others:a?a.split(","):[]},n.parentEntityId=e.attr("actionParentEntityId"),n.chartType=e.attr("actionTypeOfChart"),this.analysisContext=_.extend(this.analysisContext,n)},setClusterRunwayVals:function(e){this.clusterStorageRunway=e[t.STORAGE_RUNWAY_INFO],this.clusterCPURunway=e[t.CPU_RUNWAY_INFO],this.clusterMemRunway=e[t.MEMORY_RUNWAY_INFO],this.maxRunway={storage:e[t.STORAGE_MAX_RUNWAY],cpu:e[t.CPU_MAX_RUNWAY],memory:e[t.MEMORY_MAX_RUNWAY]},this.runwayAccuracy={storage:e.accuracy[t.STORAGE_RUNWAY_INFO],cpu:e.accuracy[t.CPU_RUNWAY_INFO],memory:e.accuracy[t.MEMORY_RUNWAY_INFO]}},getMaxRunway:function(){return this.maxRunway},getRunwayAccuracy:function(){return this.runwayAccuracy},getClusterRunwayVals:function(e){switch(e){case t.STORAGE_RUNWAY:return this.clusterStorageRunway;case t.CPU_RUNWAY:return this.clusterCPURunway;case t.MEMORY_RUNWAY:return this.clusterMemRunway}},setEffectiveCapacity:function(e,t){this.effectiveCapacityInfo=e?{val:e,reason:t||""}:null},getEffectiveCapacity:function(){return this.effectiveCapacityInfo},getSubEntityName:function(e){return this.subViewHelper.get("cpDrillDownOptionView").getSubEntityName(e)},refreshSubView:function(e){var i;i=this.subViewHelper.get("cpDrillDownOptionView"),this.cpChartView.updateSomeChartProperties(this.sharedModel.get(this.sharedModel.DP.SELECTED_METRIC_RUNWAY_VAL),this.sharedModel.get(this.sharedModel.DP.CURRENT_MAX_CHART_YVAL),e,this.sharedModel.get(this.sharedModel.DP.CURRENT_MAX_CHART_YVAL_REASON));var n=this.subViewHelper.get("cpRunwaySummaryView");if(!n.readyFlag||isNaN(n.readyFlag))return void this.trigger("cpDataNotReady",{isNotReady:!0});switch(e){case t.CPU_RUNWAY:case t.MEMORY_RUNWAY:case t.STORAGE_RUNWAY:i.refreshView(e)}},postSetModelId:function(e){var t=this.clusterManager.getClusterCollection();if(t.findModelById(e)){var i=E.getClusterUuid(e);e=i||e}if(this.currentClusterModelId=e,this.cpAlertModel.setQueryModel(new r({currentClusterUUID:e})),this.cpEventModel.setQueryModel(new o({currentClusterUUID:e})),!t.findModelByUuid(e))return E.log(e+" not found in the cluster collection. Cluster collection state : "+t.getState()),void this.trigger("cpDataErrorOccurred",{isError:!0});E.isValidId(e)&&(this.subViewHelper.iterate("setModelId",e),this.subViewHelper.iterate("fetchOnDemand"))},onStartServices:function(){this.subViewHelper.iterate("startServices")},onStopServices:function(){this.subViewHelper.iterate("stopServices")}})}),define("views/basecomponents/charts/BaseNVD3Chart",["d3","nvd3","d3tip","views/basecomponents/BaseView","views/basecomponents/charts/BaseChartMixin","utils/StatsUtil","utils/TimeUtil","views/basecomponents/charts/ChartTemplates"],function(e,t,i,n,s,a,r,o){"use strict";var l={top:30,left:0},c=_.template('<div class="chart-content n-chart"></div>'),u={LINE_CHART:"lineChart",STACKED_CHART:"stackedChart",BAR_CHART:"barChart",MULTI_BAR_CHART:"multiBarChart",HORIZONTAL_BAR_CHART:"horizontalBarChart"};return n.extend(_.extend({},s,{chart:null,template:c,chartMargins:l,parentView:null,chartType:u.LINE_CHART,showControls:!1,showLegend:!1,showYAxis:!1,showXAxis:!0,yAxisOrientation:"left",chartData:null,chartClass:null,name:"BaseNVD3Chart",className:"d3-chart",postRenderCallback:null,emptyChartMessage:"",initialize:function(e){e=e||{},this.showXAxis=_.isBoolean(e.showXAxis)?e.showXAxis:this.showXAxis,this.showYAxis=_.isBoolean(e.showYAxis)?e.showYAxis:this.showYAxis,this.showLegend=_.isBoolean(e.showLegend)?e.showLegend:this.showLegend,this.showControls=_.isBoolean(e.showControls)?e.showControls:this.showControls,this.chartMargins=e.chartMargins||this.chartMargins,this.parentView=e.parentView,this.chartType=e.chartType||this.chartType,this.postRenderCallback=e.postRenderCallback,this.initializeStatsProperties(e),n.prototype.initialize.apply(this,arguments),_.bindAll(this,"onResize","xAxisTickFormatter","yAxisTickFormatter"),$(window).on("resize",_.debounce(this.onResize,200))},render:function(){return this.$el.html(this.template),this},destroy:function(){this.clearTooltips(),$(window).off("resize",this.onResize),$(document).off("click",this.onDocumentClick),this.chartType===u.STACKED_CHART&&(this.chart.stacked.dispatch.off("areaClick",null),this.chart.stacked.dispatch.off("areaClick.toggle",null),this.chart.stacked.scatter.dispatch.off("elementClick",null),this.chart.stacked.scatter.dispatch.off("elementClick.area",null)),n.prototype.destroy.apply(this,arguments)},disableAreaClick:function(e){this.chartType===u.STACKED_CHART&&(e.stacked.dispatch.on("areaClick",null),e.stacked.dispatch.on("areaClick.toggle",null),e.stacked.scatter.dispatch.on("elementClick",null),e.stacked.scatter.dispatch.on("elementClick.area",null))},renderChart:function(i){var n=this;if(i){this.chartData=i,this._svg&&(this.clearTooltips(),this._svg.remove(),this._svg=null,this.graph=null);var s=this.getChartContainer()[0];$(s).empty(),this._svg=e.select(s).append("svg");var a=i;this.validateChartData(a)?(this.updateChartOptions(i),this.graph=t.addGraph(function(){var e=n.createChartObject();e.xAxis.showMaxMin(!1).tickPadding(10,0).tickFormat(n.xAxisTickFormatter).tickSubdivide(!0),_.isFunction(e.defined)&&e.defined(function(e){return null!==e[1]&&!isNaN(e[1])}),
e.yAxis.showMaxMin(!1).tickFormat(n.yAxisTickFormatter).orient(n.yAxisOrientation),n.setChartDomain(e),n.chart=e,e.x(n.getXAxisDataPicker()),e.y(n.getYAxisDataPicker()),n._svg.datum(a).call(e),n.disableAreaClick(e);var t=n.$(n.chartClass+" rect").attr("height");return t&&(n.yValForOtherSVG=parseInt(t,10)),n.addAdditonalInfoToChart(a),n.postRenderCallback&&n.postRenderCallback(n),e})):this.showNoData()}},updateChartOptions:function(e){this.chartDataMaxY=0,this.chartDataMinY=Number.MAX_VALUE,this.chartDataMaxX=0,this.chartDataMinX=Number.MAX_VALUE;var t=this.getYAxisDataPicker(),i=this.getXAxisDataPicker(),n=void 0,s=void 0;_.each(e,function(e){_.each(e.values,function(e){n=t(e),s=i(e),n>this.chartDataMaxY&&(this.chartDataMaxY=n),n<this.chartDataMinY&&(this.chartDataMinY=n),s>this.chartDataMaxX&&(this.chartDataMaxX=s),s<this.chartDataMinX&&(this.chartDataMinX=s)},this)},this)},getChartContainer:function(){return this.$(".chart-content")},createChartObject:function(){var i;switch(this.chartType){case u.LINE_CHART:i=t.models.lineChart().showYAxis(this.showYAxis).useInteractiveGuideline(!0).showXAxis(this.showXAxis).showLegend(this.showLegend).margin(this.chartMargins).xScale(e.time.scale()),this.chartClass=".nv-lineChart";break;case u.STACKED_CHART:i=t.models.stackedAreaChart().useInteractiveGuideline(!0).transitionDuration(0).showControls(this.showControls).showLegend(this.showLegend).showYAxis(this.showYAxis).showXAxis(this.showXAxis).margin(this.chartMargins),this.chartClass=".nv-stackedAreaChart";break;case u.BAR_CHART:i=t.models.discreteBarChart().showYAxis(this.showYAxis).showXAxis(this.showXAxis).margin(this.chartMargins),this.chartClass=".nv-discreteBarWithAxes";break;case u.MULTI_BAR_CHART:i=t.models.multiBarChart().transitionDuration(0).showYAxis(this.showYAxis).showXAxis(this.showXAxis).margin(this.chartMargins).showLegend(this.showLegend).showControls(this.showControls).margin(this.chartMargins).stacked(this.stacked).reduceXTicks(this.reduceXTicks).groupSpacing(this.groupSpacing||.1),this.chartClass=".nv-multiBarChart",this.color&&i.color(this.color),this.showLegend&&i.legend.margin({top:this.chartMargins.top,bottom:this.chartMargins.top});break;case u.HORIZONTAL_BAR_CHART:i=t.models.multiBarHorizontalChart().showYAxis(this.showYAxis).showXAxis(this.showXAxis).showLegend(this.showLegend).showValues(!0).margin(this.chartMargins),this.chartClass=".nv-multibarHorizontal",i.valueFormat(e.format(",.0f"))}return i},setChartDomain:function(e){var t=this.getMax();_.isUndefined(t)||(t?e.yDomain([1,t]):(e.yDomain([0,1]),e.showYAxis(!1)))},addAdditonalInfoToChart:function(e){},getXAxisDataPicker:function(){return function(e){return e?e[0]:null}},getYAxisDataPicker:function(){return function(e){return e?e[1]:null}},xAxisTickFormatter:function(e){return $(this).attr("date",new Date(e)),r.formatShortDate(e)},yAxisTickFormatter:function(e){return this.convertStatsToHigherUnits(e,!1,2,!0)},convertStatsToHigherUnits:function(e,t){var i=0;switch(0!==t&&(t=t||2),this.metricType){case a.UOM_B:i=a.storageFormat(e,!0,!0,!0,t);break;case a.UOM_PPM:i=a.ppmFormat(e,!0)}return i},clearTooltips:function(){t.tooltip.cleanup(),e.select(".d3-tip").remove()},createD3Tip:function(e,t,n){return t=t||"",n=n||[-20,-10],i().attr("class","d3-tip cp-custom-tip "+t).offset(n).direction("sw").html(function(t){return e})},setStartTime:function(e){this.startTime=e},setEndTime:function(e){this.endTime=e},validateChartData:function(e){},showLoader:function(){this.$el.find(".chart-content").prepend('<div class="loader">\n          <div class="donut-loader"></div>')},hideLoader:function(){this.$el.find(".loader").remove()},setEmptyChartMessage:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";this.emptyChartMessage=e},showNoData:function(e){this._svg&&this._svg.remove(),this._svg=null;var t=this.getChartContainer();t.empty();var i=t[0];e&&e.isError?$(i).append(o.ERROR_IN_DATA_RETRIEVAL_HTML(this.vtOptions())):e&&e.isNotReady?$(i).append(o.NOT_READY_HTML(this.vtOptions())):$(i).append(o.NO_DATA_HTML(this.vtOptions({message:this.emptyChartMessage})))},onResize:function(){this.renderChart(this.chartData)},onDocumentClick:function(){e.selectAll(".d3-tip").style("opacity",0).style("pointer-events","none")}}),{CHART_TYPE:u})}),define("views/charts/EntityStatsChartView",["d3","nvd3","d3tip","models/capacityplanning/CPStatsModel","managers/NotificationManager","managers/NavigationManager","views/basecomponents/charts/BaseNVD3Chart","data/DataProperties","utils/StyleDescriptor","utils/AlertUtil","utils/AntiscrollUtil","utils/D3Util","utils/ConversionUtil","utils/CommonTemplates","utils/StatsUtil","utils/TimeUtil","utils/AppUtil","utils/AppConstants"],function(e,t,i,n,s,a,r,o,l,c,u,d,h,p,T,E,S,g){"use strict";var A={low:"none",high:"none",current:"#63bee2",qosThrottled:"#63bee2"},m=_.template("<div class='metric-threshold-tooltip'>\n        <div><%= metric %>: <%= current %></div>\n        <% if (high && low) { %>\n          <div><%= i18n('baseline_range') %> <%= low %> - <%= high %></div>\n        <% } %>\n        <div class=\"timestamp\"><%= time %></div>\n      </div>"),f=_.template('<div class="timestamp"><%= time %></div>'),I=_.template('<a class="tooltipEntityDetails details-link"\n        data-id="<%= entityId %>"\n        data-entity-type="<%= entityType %>"> <%= i18n(\'details\') %></a>');return r.extend({name:"EntityStatsChartView",metricAttrs:{},activeMetric:null,entityType:null,entityId:null,showYAxis:!0,samplingInterval:null,showBand:!1,startTime:0,endTime:0,checkLength:!0,yAxisOnChart:!1,fetchInProgress:!1,groupAlerts:!1,initializeStatsProperties:function(e){if(r.prototype.initializeStatsProperties.apply(this,arguments),!e.entityType||!e.activeMetric)throw new Error("entityType, activeMetric, and entityId are mandatory options");this.showBand=!_.isBoolean(e.disableBand)||!e.disableBand,e.metrics||(e.metrics=this.createMetricAttributes(e.activeMetric));var t=T.getStatsCurrentTime(),i=t-20*g.MILLIS_PER_DAY;this.entityType=e.entityType,this.metricAttrs=e.metrics||"",this.activeMetric=e.activeMetric,this.colors=e.colors||{},this.unit=e.unit||T.getMetricUnits(this.activeMetric)||T.UOM_PPM,this.chartType=r.CHART_TYPE.LINE_CHART,this.showPrediction=!!_.isBoolean(e.showPrediction)&&e.showPrediction,this.checkLength=_.isBoolean(e.checkLength)?e.checkLength:this.checkLength,this.yAxisOnChart=_.isBoolean(e.yAxisOnChart)?e.yAxisOnChart:this.yAxisOnChart,this.groupAlerts=_.isBoolean(e.groupAlerts)?e.groupAlerts:this.groupAlerts,this.samplingInterval=e.samplingInterval||S.samplingIntervalByDays(0),this.samplingOperation=e.samplingOperation||o.AGGREGATORS.AVERAGE,this.startTime=e.startTime||i,this.endTime=e.endTime||t,this.predictionEndTime=e.predictionEndTime||t,this.setEntityId(e.entityId),this.title=e.title||T.getMetricLabel(this.activeMetric,this.entityType)},setMetrics:function(e){this.metricAttrs=e},setAppropriateMax:function(){r.prototype.setAppropriateMax.apply(this,arguments);this.getMetricTypeUnit()===g.UNITS.IOPS&&this.chartDataMaxY<100&&(this.chartDataMaxY=100)},createMetricAttributes:function(e){var t=_defineProperty({},e,{current:e});return this.showBand&&(t=c.constructAttributeObject(t,!1)),t},setSamplingInterval:function(e){this.samplingInterval=e},addAdditonalInfoToChart:function(e){var t=this.chart;e&&t&&(this.addChartOverrides(),this.showBand&&this.renderBand(e),this.renderAlertAnomalyLineOnChart())},xAxisTickFormatter:function(e){return this.showBand?e:this.formatTimestamp(e)},formatTimestamp:function(e){var t=g.MILLIS_PER_DAY+g.MILLIS_PER_MINUTE,i=(g.MILLIS_PER_WEEK,g.MILLIS_PER_HOUR,this.getTimeRangeMax()-this.getTimeRangeMin());return i<=t?E.formatShortTime(e):E.formatDateOnly(e)},yAxisTickFormatter:function(e){return h.convertUnitValueToDisplay(e,this.unit)+" "+h.getUnitLabel(this.unit)},renderBand:function(t){var i=this,n=[],s=void 0,a=void 0,r=this.getYAxisDataPicker(),o=this.getXAxisDataPicker();if(_.each(t,function(e){"low"===e.key?s=e&&e.values:"high"===e.key&&(a=e&&e.values)}),s&&a){this.bandMax=0,this.bandMin=_.first(s)&&r(_.first(s)),_.each(s,function(e,t){if(e&&a&&a[t]){var s=r(e),l=r(a[t]);n.push({x:o(e),y0:s,y1:l}),i.bandMin=Math.max(i.bandMin,s),i.bandMax=Math.max(i.bandMax,l)}});var c=this.chart.xScale(),u=this.chart.yScale(),d=e.svg.area().x(function(e){return c(e.x)}).y0(function(e){return u(e.y0)}).y1(function(e){return u(e.y1)});this._svg.select(this.chartClass).insert("path",":first-child").datum(n).attr("class","area").attr("d",d).style("fill",l.CP.COLORS_MAP.BLUE_2)}},findAttributeType:function(e,t){return _.find(_.keys(this.metricAttrs[e]),function(i){return this.metricAttrs[e][i]===t},this)},getBandMax:function(){return h.convertUnitValueToDisplay(this.bandMax,this.unit)},getBandMin:function(){return h.convertUnitValueToDisplay(this.bandMin,this.unit)},renderMarkerLine:function(e,t){if(e){var i=t||l.CP.COLORS_MAP.RED;d.renderSVGLine(this._svg,this.chart.xScale()(this.chartDataMinX)+this.chartMargins.left,this.chart.xScale()(this.chartDataMaxX)+this.chartMargins.left,this.chart.yScale()(e)+this.chartMargins.top,this.chart.yScale()(e)+this.chartMargins.top,i)}},renderMarkerLineWithDesc:function(e,t,i,n){this.renderMarkerLine(e,t),this._svg.append("text").attr("x",this.chart.xScale()(Date.now())+this.chartMargins.left).attr("y",this.chart.yScale()(e)+(this.chartMargins.top-3)).attr("text-anchor","end").style({"font-size":"10px",fill:n,"font-weight":"600"}).text(i)},validateChartData:function(e){var t=!0,i=0,n="";return!(!e||!e.length)&&(_.each(e,function(e){if(!e.values)return void(t=!1);n+=e.key+" of length "+e.values.length,i+=e.values.length}),this.checkLength&&t&&i!==e.length*e[0].values.length?(S.log("data sets have different length "+n),!1):!!i&&t)},getChartData:function(){var e=[],t=this;this.fetchInProgress||(this.showLoader(),_.each(this.metricAttrs[this.activeMetric],function(t,i){-1===i.indexOf("_future")&&e.push(t)}),this.fetchData({statsArray:e,startTime:this.startTime,endTime:this.endTime,success:function(e){t.showPrediction?t.fetchPredictionData(e):(t.hideLoader(),t.renderChart(e))}}))},fetchPredictionData:function(e){var t=[],i=this;_.each(this.metricAttrs[this.activeMetric],function(e,i){-1!==i.indexOf("_future")&&t.push(e)}),this.fetchData({statsArray:t,startTime:this.endTime,endTime:this.predictionEndTime,success:function(t){i.hideLoader(),i.renderChart(i.mergeCurrentAndFutureData(e,t))}})},mergeCurrentAndFutureData:function(e,t){return _.each(e,function(e){var i=e.key,n=_.find(t,function(e){return-1!==e.key.indexOf(i)});n&&("current"===i&&_.map(n.values,function(e){e[1]=null}),e.values=e.values.concat(n.values))}),e},fetchData:function(e){var t=this,i=new n;this.model=i,e=e||{},this.fetchInProgress=!0;var a=this.entityType;a===g.ENTITY_NODE&&(a=g.ENTITY_HOST),i.setTimeInterval(e.startTime,e.endTime,this.samplingInterval),i.setGroupsStats([this.entityId],a,null,a,e.statsArray,this.samplingOperation),i.performQuery({success:function(){var n=i.getQueryResults(),s=[];_.each(n.models,function(n){for(var a in n.attributes){var r=n.get(a);if(a!==o.ID&&r&&"_created_timestamp_usecs_"!==a){var l=t.findAttributeType(t.activeMetric,a);r=r.reverse(),"current"===l&&(r=i.fillMissingDataPoints(r,{startTime:e.startTime,endTime:e.endTime,samplingInterval:t.samplingInterval})),"qosThrottled"!==l||_.isEmpty(r)||(r=[[e.startTime,parseInt(r[0],10)],[e.endTime,parseInt(r[0],10)]]),s.push({values:r,key:l,color:t.colors[l]||A[l]})}}}),e.success(s),t.fetchInProgress=!1},error:function(){t.showNoData(),t.fetchInProgress=!1,s.showClientNotification(g.NOTIFY_ERROR,t.i18n("error.data_fetch"))}})},renderAlertAnomalyLineOnChart:function(){var e=this;if(this.chart){var t=this._groupAlertAnomalyByTime();_.each(t,function(t,i){var n=Object.keys(t).length>1;_.each(t,function(t,s){e.renderAlertSVG(t,s,Number(i),n&&s===g.ENTITY_EVENT)})})}},findChunkStartForTime:function(e,t){for(var i=0;i<t.length;i++)if(t[i]>e)return t[i]},updateChartOptions:function(e){r.prototype.updateChartOptions.apply(this,arguments),this.setAppropriateMax()},addChartOverrides:function(){var e=this;if(this._svg.selectAll(".nv-y.nv-axis text").attr("transform","translate(5,0)").style("text-anchor","start"),this._svg.selectAll(".nv-x.nv-axis text").text(function(t){return e.formatTimestamp(t)}),this.showBand){var t=this.chart.yAxis.tickFormat(),i=this.title,n=this.chart.interactiveLayer.tooltip;n.gravity("custom"),n.contentGenerator(function(n){var s={time:E.formatFullDateTime(n.value),metric:i,qosThrottled:null,current:null,high:null,low:null};return _.each(n.series,function(e){(e.value||0===e.value)&&(s[e.key]=T.formatDecimalDigits(t(e.value),3))}),s.current||0===s.current||(s.current=g.STATS_NOT_AVAILABLE),m(e.vtOptions(s))})}},_groupAlertAnomalyByTime:function(){for(var e=this,t={},i=[],n=Math.floor((this.endTime-this.startTime)/50),s=this.startTime;s<=this.endTime;s+=n)i.push(s);var a=function(n,s){var a=n&&(n[o.CP.ALERT.TRIGGER_TIME_STAMP]||n[o.ALERT_TRIGGER_TIME]||c.getAlertCreatedTime(n));if(a){a=Math.floor(a/1e3),e.groupAlerts&&(a=e.findChunkStartForTime(a,i));var r=t[a];r||(r={});var l=r[s];l||(l=[]),l.push(n),r[s]=l,t[a]=r}};return _.each(this.alertModel,function(e){a(e,g.ENTITY_ALERT)}),_.each(this.anomalyModel,function(e){a(e,g.ENTITY_EVENT)}),t},renderTodayLineSVG:function(){var e=l.FS.COLORS_MAP.BLUE,t=l.CP.COLORS_MAP.BLUE,i=Date.now();d.renderSVGLine(this._svg,this.chart.xScale()(i)+this.chartMargins.left,this.chart.xScale()(i)+this.chartMargins.left,this.chart.yScale()(0)+this.chartMargins.top,2*this.chartMargins.top-20,e),this._svg.append("rect").attr("fill",t).attr("x",this.chart.xScale()(i)+(this.chartMargins.left-25)).attr("y",0).attr("width",50).attr("height",20).attr("rx","3").attr("ry","3");var n=l.CP.COLORS_MAP.WHITE;this._svg.append("text").attr("x",this.chart.xScale()(i)+this.chartMargins.left).attr("y",13).attr("text-anchor","middle").style({"font-size":"10px",fill:n,"font-weight":"600"}).text(this.i18nStatic("TimeUtil","dates.today"))},renderAlertSVG:function(e,t,i,n){if(e&&e.length&&this.chart){var s=new Date(i).getTime(),a=t===g.ENTITY_ALERT,r=l.CP.COLORS_MAP.GRAY,c=this.yValForOtherSVG+this.chartMargins.top,u=8;this.showPrediction&&(c-=20,u+=20);var h=this.chart.xScale()(s)+this.chartMargins.left,p=u-4;if(n){c+=24,u+=24,p+=24}var T=this._svg,E=void 0,S=l.CP.COLORS_MAP.YELLOW;_.each(e,function(e){E=e.isDetailsPage||E,e.severity!==o.ALERT_SEVERITY_CRITICAL&&e.severity!==o.ALERT_SEVERITIES.CRITICAL||(S=l.CP.COLORS_MAP.RED)});var A=d.renderSVGLine(T,h,h,c,u,E?S:r);A&&A.attr("shape-rendering","crispEdges").attr("class","line-opacity");var m=T.append("g").attr("class","icon");d.renderSVGCircle(m,h,u,8,l.CP.COLORS_MAP.WHITE,r),a?d.renderSVGBell(m,10,h-4-1,p,S):d.renderSVGAnomaly(m,"8",h-4,p,"svg-icon -warning"),this._createAlertTooltip(e,t,i,m)}},_createAlertTooltip:function(t,i,n,s){var a=this,r="";_.each(t,function(e){var t=g.ENTITY_ALERT===i;r+=c.getAlertDisplayName(e,t),e.isDetailsPage||(r+=I(a.vtOptions({entityId:e[o.CP.ENTITY_ID],entityType:i})));var n=e&&(e[o.CP.ALERT.TRIGGER_TIME_STAMP]||e[o.ALERT_TRIGGER_TIME]||c.getAlertCreatedTime(e));r+=f({time:n&&E.formatFullDateTime(parseInt(n/g.MICROS_PER_MILLI,10))}),r+="<br>"}),t.length>1&&(r=p.ANTISCROLL_WRAP({content:r}));var l=this.createD3Tip(r,"alert-chart-tooltip");if(l&&s&&s.length&&s[0]&&s[0][0]){var d=Date.now();s.call(l).on("click."+d,function(){e.selectAll(".d3-tip").style("opacity",0).style("pointer-events","none"),l.show(),t.length>1&&u.applyAntiScroll($(".alert-chart-tooltip .antiscroll-wrap"),null,null,{classnames:"-extra-light -spaced -thin"}),$(".tooltipEntityDetails").on("click",a._onDetailsLink),$("body").one("click",a.onDocumentClick),e.event.stopPropagation()})}},_onDetailsLink:function(e){var t=$(e.currentTarget),i=t.attr("data-entity-type"),n=t.attr("data-id"),s=a.createNavigationContext(i,{});a.navigateToFullScreenDetailsPane(i,n,s)},getMetricTypeUnit:function(){return this.unit},getMetricId:function(){return this.activeMetric},setPrediction:function(e){this.showPrediction=e,this.getChartData()},setActiveMetric:function(e){this.activeMetric=e,this.unit=T.getMetricUnits(e)||T.UOM_PPM,this.getChartData()},setAlertModel:function(e){this.alertModel=e},getAlertModel:function(){return this.alertModel},setAnomalyModel:function(e){this.anomalyModel=e},setStartTime:function(e){this.startTime=e},setEndTime:function(e){this.endTime=e},setPredictionEndTime:function(e){this.predictionEndTime=e},setEntityId:function(e){this.entityId=e}})}),define("views/charts/ThresholdChartMixin",["data/DataProperties","utils/D3Util"],function(e,t){"use strict";return{thresholdValues:null,getThresholdValues:function(e){return this.thresholdValues},setThresholdValues:function(e,t){var i=this;_.each(e,function(e,t){i.thresholdValues[t]=e}),t&&t.silent||this.renderChart(this.chartData)},setThresholdValue:function(e,t,i,n){var s=this.thresholdValues[e]||{},a=s[i];a&&a.value===t||(s[i]={value:t},this.thresholdValues[e]=s,n&&n.silent||this.renderChart(this.chartData))},setAnomalyThresholdValue:function(t,i){var n=e.ALERT_POLICY.CONDITION_TYPE.ANOMALY;this.thresholdValues[n]=t,i&&i.silent||this.renderChart(this.chartData)},resetThresholdValue:function(e){delete this.thresholdValues[e],this.renderChart(this.chartData)},resetThresholdValues:function(){this.thresholdValues={},this.renderChart(this.chartData)},getMaxYIncludingThreshold:function(e,t){return _.each(e,function(e){_.isObject(e)&&_.each(e,function(e){e&&e.value&&(t=Math.max(parseFloat(e.value),t))})}),t},createStaticThresholds:function(t,i,n,s){var a=this.thresholdValues[e.ALERT_POLICY.SEVERITY_LEVEL.CRITICAL];this._drawStaticThreshold(t,i,n,s,a,"#ffe4e0","#ef8e98");var r=this.thresholdValues[e.ALERT_POLICY.SEVERITY_LEVEL.WARNING];this._drawStaticThreshold(t,i,n,s,r,"#fffef0","#f9d265")},_drawStaticThreshold:function(e,t,i,n,s,a,r){if(s){var o=void 0,l=void 0;s.upper&&(o=parseInt(s.upper.value,10)),s.lower&&(l=parseInt(s.lower.value,10)),(o||0===o)&&(this.drawMarkerLine(e,t,o,r),this.drawThreshold(e,t,o,n,a,!0)),(l||0===l)&&(this.drawMarkerLine(e,t,l,r),this.drawThreshold(e,t,i,l,a,!0))}},createAnomalyThresholds:function(t,i,n,s){if(this.showBand){var a=e.ALERT_POLICY.CONDITION_TYPE,r=this.thresholdValues[a.ANOMALY];if(r){var o="#fffef0",l="#f9d265";r!==e.ALERT_POLICY.SEVERITY_LEVEL.WARNING&&(o="#ffe4e0",l="#ef8e98");var c=this.thresholdValues[a.SAFETY_ZONE];if(c){var u=void 0,d=void 0;c.upper&&(u=parseInt(c.upper.value,10)),c.lower&&(d=parseInt(c.lower.value,10)),u||0===u||(u=s),d||0===d||(d=n),this.drawMarkerLine(t,i,u,l),this.drawMarkerLine(t,i,d,l),this.drawThreshold(t,i,d,u,"#ffffff")}this.drawThreshold(t,i,n,s,o)}}},drawMarkerLine:function(e,i,n,s){if(this.chart){var a=this.chart.xScale(),r=this.chart.yScale(),o=this._svg.select(this.chartClass),l=a(e),c=a(i),u=r(n);t.renderSVGLine(o,l,c,u,u,s,"1",":first-child").attr("shape-rendering","crispEdges")}},drawThreshold:function(e,i,n,s,a,r){if(this.chart){var o=this.chart.xScale(),l=this.chart.yScale(),c=this._svg.select(this.chartClass),u=o(e),d=l(s),h=Math.abs(l(s)-l(n)),p=Math.abs(o(i)-o(e)),_=r?".7":"1";t.renderSVGRect(c,u,d,p,h,a,a,":first-child",_)}},isSameEntityAndMetric:function(e,t,i){return this.entityType===e&&this.entityId===t&&this.activeMetric===i}}}),define("views/charts/MetricThresholdChartView",["views/charts/EntityStatsChartView","views/charts/ThresholdChartMixin","utils/StyleDescriptor","utils/StatsUtil"],function(e,t,i,n){"use strict";var s={top:15,bottom:18,right:0,left:0};return e.extend(_.extend({},t,{name:"MetricThresholdChartView",checkLength:!1,chartDataProvided:!1,initializeStatsProperties:function(t){e.prototype.initializeStatsProperties.apply(this,arguments),this.options=t,this.chartMargins=s,this.showLegend=!1,this.thresholdValues={},this.metricColor=i.getChartColor(this.activeMetric),this.title=t.title||n.getMetricLabel(this.activeMetric,this.entityType)},getMaxDisplayLabel:function(){return n.formatStatsChartYAxis(this.getMetricId(),this.getMaxDisplay(),!0)},isMetricSupportedByAnalysisPage:function(){return!1},updateChartData:function(e){this.model=e;var t=this.model&&this.model.getStats(this.getMetricId());t||this.chartDataProvided?(this.chartData=this._formatLineChartDataD3(t),this.hideLoader(),this.renderChart(this.chartData)):(this.showPrediction=!1,this.getChartData())},validateChartData:function(t){var i=e.prototype.validateChartData.apply(this,arguments);if(i){var n=_.find(t,function(e){return"current"===e.key});if(!n||!n.values||!n.values.length)return!1}return i},updateChartOptions:function(t){e.prototype.updateChartOptions.apply(this,arguments),this.chartDataMaxY=this.getMaxYIncludingThreshold(this.thresholdValues,this.chartDataMaxY),this.setAppropriateMax()},_formatLineChartDataD3:function(e){var t={key:"current",color:this.metricColor[0],values:[]};return _.each(e,function(e){t.values.push({0:e[0],1:e[1]})},this),[t]},addAdditonalInfoToChart:function(){this.addChartOverrides(),this.createStaticThresholds(this.chartDataMinX,this.chartDataMaxX,0,this.getMax()),e.prototype.addAdditonalInfoToChart.apply(this,arguments),this.createAnomalyThresholds(this.chartDataMinX,this.chartDataMaxX,0,this.getMax()),this.showPrediction&&this.renderTodayLineSVG()}}))}),define("models/capacityplanning/EntityAlertQueryModel",["utils/AppConstants","utils/AlertUtil","data/DataProperties","models/query/BaseQueryModel"],function(e,t,i,n){"use strict";return n.extend({name:"EntityAlertQueryModel",initialize:function(t,s){if(s=s||{},n.prototype.initialize.apply(this,arguments),!t||!t.entityType||!t.entityId)throw new Error("Specify entityType and entityId in attributes");this.entityType=t.entityType,this.indicatorEntityType=t.indicatorEntityType,this.entityId=t.entityId,this.ignoreTimeRange=!!_.isBoolean(s.ignoreTimeRange)&&s.ignoreTimeRange,this.countOnly=t.countOnly,this.startTime=s.startTime||Date.now()-1*e.MILLIS_PER_DAY,this.endTime=s.endTime,this.attributeList=s.attributeList||[i.ALERT_TITLE_V3,i.ALERT_DEFAULT_MSG,i.ALERT_SEVERITY,i.ALERT_PARAM_NAMES,i.ALERT_PARAM_VALUES,i.ALERT_METRIC_NAME,i.ALERT_TRIGGER_TIME],this.setAttributesForQuery()},getAlertCount:function(){return this.get(this.DP.FILTERED_ENTITY_COUNT)},getAlertCountByType:function(e){var t=this,i=this.get(this.DP.GROUP_RESULTS),n=0;return i&&_.some(i,function(i){if(i[t.DP.GROUP_BY_COLUMN_VALUE]===e)return n=i[t.DP.TOTAL_ENTITY_COUNT],!0}),n},setDefaultGroupByTimeInterval:function(){},setAttributesForQuery:function(){this.set(this.DP.ENTITY_TYPE,e.ENTITY_ALERT),this.set(this.DP.GROUP_MEMBER_SORT_ORDER,e.SORT_DESCENDING),this.set(this.DP.GROUPING_ATTR,i.CP.ALERT.SEVERITY),this.countOnly||this.setGroupMemberAttributesList(this.attributeList);var n={};n=t.setEntityFilter(n,this.entityType,this.entityId),this.indicatorEntityType&&(this.indicatorEntityType===e.ENTITY_HOST&&(this.indicatorEntityType=e.ENTITY_NODE),n=t.setIndicatorEntityTypeFilter(n,this.indicatorEntityType)),this.ignoreTimeRange||t.setTimeRangeFilter(n,this.startTime,this.endTime),n=t.setAlertResolvedFilter(n,!1),this.countOnly&&this.set(this.DP.GROUP_MEMBER_COUNT,1),this.set(this.DP.FILTER_EXPR,n)}})}),define("models/alert/UDAPolicyModel",["models/BaseModel","data/DataProperties","data/DataURLConstants","data/DataManager","utils/AppConstants","utils/AppUtil","utils/StatsUtil"],function(e,t,i,n,s,a,r){"use strict";var o,l={ID:"id",TITLE:"title",DESCRIPTION:"description",ENABLED:"enabled",FILTER:"filter",IMPACT_TYPES:"impact_types",TRIGGER_CONDITIONS:"trigger_conditions",POLICIES_TO_OVERRIDE:"policies_to_override",AUTO_RESOLVE:"auto_resolve",ERROR_ON_CONFLICT:"error_on_conflict",TRIGGER_WAIT_PERIOD:"trigger_wait_period_in_secs",MODIFIED_TIME_STAMP_IN_USECS:"last_updated_timestamp_in_usecs",RELATED_POLICIES:"related_policies"},c={impactTypes:"impact_types",triggerConditions:"trigger_conditions",autoResolve:"auto_resolve",triggerWaitPeriod:"trigger_wait_period_in_secs",lastUpdatedTimestampInUsecs:"last_updated_timestamp_in_usecs"},u={ENTITY_TYPE:"entity_type",ENTITY_SCOPE:"entity_scope",ENTITY_ID:"entity_id",ENTITY_NAME:"entity_name",ENTITY_IDS:"entity_ids",POLICY_IDS:"policy_ids",ENTITY_NAMES:"entity_names",CONDITION_SEVERITY:"severity_level",CONDITION_SEVERITY_V1:"severityLevel",CONDITION_TYPE:"condition_type",CONDITION_TYPE_V1:"conditionType",CONDITION:"condition",THRESHOLD:"threshold",METRIC:"metric",ALL_ENTITY_SCOPE:"all_entity",SINGLE_ENTITY_SCOPE:"single_entity",CLUSTER_SCOPE:"cluster",CATEGORY_SCOPE:"abac_category",EXCLUSION_ENTITY_TYPE:"exclusion_entity_type",EXCEPTION_COUNT:"exception_count",EXISTING_ENTITY_IDS:"existing_entity_ids",GROUP_ENTITY_TYPE:"group_entity_type",GROUP_ENTITY_ID:"group_entity_id",UPDATED_TIMESTAMP:"updated_timestamp",SCOPE_VALUE:"scope_value"},d=(o={},_defineProperty(o,u.SINGLE_ENTITY_SCOPE,1),_defineProperty(o,u.CATEGORY_SCOPE,2),_defineProperty(o,u.CLUSTER_SCOPE,3),_defineProperty(o,u.ALL_ENTITY_SCOPE,4),o),h={UPPER:"upper",LOWER:"lower"},p={EQUALS:"==",NOT_EQUALS:"!=",GREATER_THAN:"=gt=",LESS_THAN:"=lt=",GREATER_THAN_OR_EQUAL:"=ge=",LESS_THAN_OR_EQUAL:"=le="},T={"==":"=","!=":"!=","=gt=":">","=lt=":"<","=ge=":">=","=le=":"<="},E=["entity_type","exclusion_entity_type","group_entity_type"];return e.extend({name:"UDAPolicyModel",DP:l,HELPER_DP:u,idAttribute:l.ID,nameAttribute:l.TITLE,urlRoot:i.USER_DEFINED_ALERT_POLICY,entityType:s.ENTITY_USER_DEFINED_ALERT_POLICY,filterExpressions:null,entityExpressions:null,metric:null,filteredEntityId:null,default:{auto_resolve:!1,error_on_conflict:!0},editAttributes:null,initialize:function(t,i){this.entityExpressions={},e.prototype.initialize.apply(this,arguments),this.editAttributes={},this.parseAttributes(t)},parse:function(t,i){var n=e.prototype.parse.apply(this,arguments);return this.parseAttributes(n)},getDataSourceURL:function(){return n.getV2DataSourceURL()},toJSON:function(t){var i=e.prototype.toJSON.apply(this,arguments);if(!t||!t.includeCustomAttributes)return i;var n=this.getAndStoreEntityId();i[u.METRIC]=this.getMetricFromCondition(),i[u.ENTITY_ID]=n,i[u.ENTITY_TYPE]=this.getAndStoreEntityType(),i[u.ENTITY_SCOPE]=this.getAndStoreEntityScope(),i[u.SCOPE_VALUE]=this.getScopeExecutionOrderValue(i[u.ENTITY_SCOPE]);var s=this.get(l.RELATED_POLICIES);return i[u.EXCEPTION_COUNT]=s?s.length:0,i[u.UPDATED_TIMESTAMP]=a.formatDateTime(r.toMilliseconds(this.get(l.MODIFIED_TIME_STAMP_IN_USECS))),i},showLatencyNotification:function(e,t){},hideLatencyNotification:function(e,t){},showSuccessNotification:function(e,t,i){},triggerAppViewRefresh:function(){return null},parseAttributes:function(e){return e&&(e&&e[l.TRIGGER_CONDITIONS]?this.parseThresholdFIQLConditions(e[l.TRIGGER_CONDITIONS]):this.filterExpressions={},e&&e[l.FILTER]?this.parseEntityIdFIQLFromFilter(e[l.FILTER]):this.entityExpressions={}),e},getScopeEntityType:function(){return this.isAllScope()||this.isSingleEntityScope()?this.getAndStoreEntityType():this.getAndStoreEntityScope()},getScopeExecutionOrderValue:function(e){return e=e||this.getAndStoreEntityScope(),d[e]},getAndStoreEntityType:function(){var e=this.editAttributes[u.ENTITY_TYPE];return this.isNew()||e?e:(e=this._getEntityTypeFromFilter(),this.setEditAttribute(u.ENTITY_TYPE,e),e)},_getEntityTypeFromFilter:function(){var e=this.get(l.FILTER),t=e?e.split(";"):[],i=_.find(t,function(e){return 0===e.indexOf(u.ENTITY_TYPE)});if(i){return i.split(p.EQUALS)[1]}},parseEntityIdFIQLFromFilter:function(e){var t=this;this.entityExpressions={};var i=new RegExp(u.GROUP_ENTITY_ID,"g");e=e.replace(i,u.ENTITY_ID),_.each(E,function(t){i=new RegExp(t,"g"),e=e.replace(i,u.ENTITY_TYPE)}),e=e.replace(/\(|\)|,|;/g,"");var n=e.split(""+u.ENTITY_TYPE+p.EQUALS);_.each(n,function(e){return t._evaluateAndSetExpressions(e)})},_evaluateAndSetExpressions:function(e){var t=this;if(e){var i=e.split(u.ENTITY_ID);i.length>1&&function(){for(var e=i[0],n=1;n<i.length;n++)!function(n){var s=i[n];_.some(p,function(i){if(s.indexOf(i)<0)return!1;var n=s.split(i);if(n.length>1){var a=n[1];return t.entityExpressions[a]={entityType:e,operator:i,id:a},!0}})}(n)}()}},setSelectedEntity:function(e,t,i){this.setEditAttribute(u.ENTITY_ID,e),this.setEditAttribute(u.ENTITY_NAME,t),this.entityExpressions[e]={isFound:!0,operator:p.EQUALS,entityType:i,name:t,id:e}},getAndStoreEntityScope:function(){var e=this.editAttributes[u.ENTITY_SCOPE];return this.isNew()||e?e:(e=this._getEntityScopeFromFilter(),this.setEditAttribute(u.ENTITY_SCOPE,e),e)},_getEntityScopeFromFilter:function(){var e=this.getIncludedEntitiesFromFilter();if(_.isEmpty(e))return u.ALL_ENTITY_SCOPE;var t=_.first(e),i=t.entityType;return this.getAndStoreEntityType()===i?u.SINGLE_ENTITY_SCOPE:i},getAndStoreEntityId:function(){var e=this.editAttributes[u.ENTITY_ID];if(this.isNew()||e)return e;var t=this.getIncludedEntitiesFromFilter(),i=t&&_.first(t);return e=i&&i.id,this.setEditAttribute(u.ENTITY_ID,e),e},getIncludedEntitiesFromFilter:function(){var e=[];return _.each(this.entityExpressions,function(t){t.operator===p.EQUALS&&e.push(t)}),e},getAllEntitiesFromFilterGroupedByType:function(){var e={};return _.each(this.entityExpressions,function(t){var i=t.entityType;e[i]||(e[i]=[]),e[i].push(t.id)}),e},getExcludedEntityIdsFromFilter:function(){var e=[];return _.each(this.entityExpressions,function(t){t.operator===p.NOT_EQUALS&&e.push(t)}),e},parseThresholdFIQLConditions:function(e){var i,n=this,s={};_.each(e,function(e){var a=void 0,r=e[u.CONDITION_TYPE]||e[u.CONDITION_TYPE_V1]||t.ALERT_POLICY.CONDITION_TYPE.STATIC_THRESHOLD,o=e[u.CONDITION_SEVERITY]||e[u.CONDITION_SEVERITY_V1];if(r!==t.ALERT_POLICY.CONDITION_TYPE.ANOMALY){a=n.simpleFIQLtoConditionExpress(e[u.CONDITION]),i=a.attribute;var l=n.getConditionRangeByOperator(a.operator),c=r;r===t.ALERT_POLICY.CONDITION_TYPE.STATIC_THRESHOLD?c=o:a.severity=o,s[c]=s[c]||{},s[c][l]=a}else if(s[r]=o,!i){var d=e[u.CONDITION].split(/\.(.+)/);d.length>=2&&(i=d[1])}}),this.editAttributes&&!this.editAttributes[u.METRIC]&&(this.editAttributes[u.METRIC]=i),this.filterExpressions=s},getMetricFromCondition:function(){return this.editAttributes[u.METRIC]},getMetricConditionByType:function(e){return e===t.ALERT_POLICY.CONDITION_TYPE.STATIC_THRESHOLD?{CRITICAL:_.clone(this.filterExpressions.CRITICAL),WARNING:_.clone(this.filterExpressions.WARNING)}:_.clone(this.filterExpressions[e])},getFilterExpressions:function(){return _.clone(this.filterExpressions)},getConditionRangeByOperator:function(e){return e===p.LESS_THAN||e===p.LESS_THAN_OR_EQUAL?h.LOWER:h.UPPER},setEditAttribute:function(e,t){this.editAttributes[e]=t},getEditAttributes:function(){return this.editAttributes},setEntityDetails:function(e,i,n){var s=this;_.each(e.models,function(e){var a=e.get(t.EB.ENTITY_ID),r=s.entityExpressions[a]||{};r.id=a,r.entityType=i,n&&(r.name=e.get(n)),r.isFound=!0,s.entityExpressions[a]=r})},isExistingEntity:function(e){return!!e&&(this.entityExpressions[e]&&this.entityExpressions[e].isFound)},findEntityNameById:function(e){var t=this.entityExpressions[e];return t&&t.name},findEntityTypeById:function(e){var t=this.entityExpressions[e];return t&&t.entityType},simpleFIQLtoConditionExpress:function(e){var t={};return _.some(p,function(i){if(e.indexOf(i)>0){var n=e.split(i);if(2===n.length){var s=n[0],r=s.split("."),o=null;return r.length>=2&&(o=r[0],s=s.substring(o.length+1)),t={operator:i,entityType:o,attribute:s,value:n[1]},!0}a.log("Unsupported FIQL expression: "+e)}}),t},getOperatorLabel:function(e){return T[e]||e},formatMetricExpressions:function(){var e=[],i=t.ALERT_POLICY.CONDITION_TYPE;this.getMetricConditionByType(i.ANOMALY)&&e.push(this.i18n("behavioralAnomaly"));var n=this.getMetricConditionByType(i.STATIC_THRESHOLD);return n&&(n[t.ALERT_POLICY.SEVERITY_LEVEL.CRITICAL]||n[t.ALERT_POLICY.SEVERITY_LEVEL.WARNING])&&e.push(this.i18n("staticThreshold")),e.join(", ")},findEntityExpressionById:function(e){return this.entityExpressions[e]},isAllScope:function(){return this.getAndStoreEntityScope()===u.ALL_ENTITY_SCOPE},isSingleEntityScope:function(){
return this.getAndStoreEntityScope()===u.SINGLE_ENTITY_SCOPE},isCategoryScope:function(){return this.getAndStoreEntityScope()===u.CATEGORY_SCOPE}},{DP:l,HELPER_DP:u,MAP:c})}),define("models/alert/UDAPolicyCollection",["models/alert/UDAPolicyModel","models/BaseCollection","data/DataURLConstants","data/DataManager"],function(e,t,i,n){"use strict";return t.extend({model:e,url:i.USER_DEFINED_ALERT_POLICY,name:"UDAPolicyCollection",getDataSourceURL:function(){return n.getV2DataSourceURL()},comparator:function(e){var t=e.get(e.DP.MODIFIED_TIME_STAMP_IN_USECS);return-1*(t||0)}})}),define("text!templates/basecomponents/details/EntityChartTemplate.html",[],function(){return'<div class="<%= chartId %> n-chart n-chart-outline">\n    <% if (!hideTitle) { %>\n      <div class="title-wrapper n-chart-header">\n        <%= i18n(attr) %>\n        <div class="chartAlertSettings"><%= alertSettings %></div>\n      </div>\n    <% } %>\n  <div class="chart-wrapper n-chart-body d3-chart"></div>\n</div>\n'}),define("text!templates/basecomponents/details/EntityTabPerformanceView.html",[],function(){return'<div class="tab-wrapper">\n  <div class="left-side side">\n    <ul class="n-nav-tab">\n      <% _.each(tabs, function(tab) { %>\n        <% if(tab.type === \'group\') {%>\n          <li class="tab-item seperator"></li>\n        <% } %>\n        <li class="tab-item <%= tab.type === \'group\' ? \'group-name\' : \'metric\' %>\n          <%= tab.name %>"\n          data-metric="<%= tab.name %>" <%= getQaDataTestId(tab.name) %>\n        >\n          <div class="name">\n            <%= i18n(tab.name + \'_TITLE\', i18n(tab.name, tab.name)) %>\n          </div>\n          <div class="icons">\n            <span class="anomaly-indicator hidden">\n              <%= Components.icon(\'Anomaly\', \'-warning -mini\') %>\n            </span>\n            <span class="alert-indicator hidden">\n              <%= Components.icon(\'bell\', \'-critical -mini\') %>\n            </span>\n            <span class="constrained-indicator hidden">\n              <%= Components.icon(\'Constrained\', \'-critical -mini\') %>\n            </span>\n          </div>\n        </li>\n      <% }); %>\n    </ul>\n  </div>\n  <div class="right-side side">\n    <div class="top-wrapper">\n      <div class="title-wrapper">\n        <div class="chart-group-name"></div>\n        <div class="title-separator hidden"></div>\n        <div class="summary-wrapper">\n          <span class="efficiency-indicator"></span>\n        </div>\n      </div>\n      <ul class="top-right-menu">\n        <li class="prediction">\n          <%=\n            Components.checkbox({\n              checked: false,\n              jsClasses: \'prediction\',\n              name: \'prediction\',\n              labelText: i18n("prediction")\n            })\n          %>\n        </li>\n        <li>\n          <%= Components.dropdown({\n            text      : this.i18n(\'last_week\'),\n            variants  : \'-compact\',\n            rightAlign: true,\n            options: [\n              {\n                name: i18n("last_24_hours"),\n                class : \'metric-range\',\n                attributes : \'data-value="1"\'\n              },\n              {\n                name: i18n("last_week"),\n                class : \'metric-range\',\n                attributes : \'data-value="7"\',\n                selected: true\n              },\n              {\n                name: i18n("last_21_days"),\n                class : \'metric-range\',\n                attributes : \'data-value="21"\'\n              }\n            ],\n            classes: \'range-dropdown\'\n          }) %>\n        </li>\n        <li class="globalAlertSettings">\n        </li>\n      </ul>\n    </div>\n    <div class="chart-view n-chart-group">\n    </div>\n  </div>\n</div>\n'}),define("views/details/tabs/EntityTabPerformanceDetailsView",["views/basecomponents/details/tabs/BaseTabContentDetailsView","views/charts/MetricThresholdChartView","models/capacityplanning/EntityAlertQueryModel","models/capacityplanning/EntityEventQueryModel","models/capacityplanning/CPQueryModel","models/alert/UDAPolicyCollection","managers/NotificationManager","managers/NavigationManager","managers/EntityManager","data/DataProperties","data/DataURLConstants","components/Components","utils/AppUtil","utils/AlertUtil","utils/AppConstants","utils/CommonTemplates","utils/SubViewHelper","text!templates/basecomponents/details/EntityChartTemplate.html","text!templates/basecomponents/details/EntityTabPerformanceView.html"],function(e,t,i,n,s,a,r,o,l,c,u,d,h,p,T,E,S,g,A){"use strict";var m={CHART_VIEW:"chartView"},f={ALERT:"alert",EVENT:"event",EFFICIENCY:"efficiency"},I="EntityTabPerformanceDetailsView",C=_.template(g),v=_.template("<%= Components.icon('Constrained', '-critical -small') %>\n      <span><%= status %></span><span class=\"indicator-info-icon\"></span>"),R=_.template('<div class="loading-spinner"></div>'),N=[T.HYPERVISOR_TYPE.ESXI,T.HYPERVISOR_TYPE.AHV,T.HYPERVISOR_TYPE.XEN,T.HYPERVISOR_TYPE.HYPERV],P={};return e.extend({name:I,metrics:null,activeMetric:null,entityType:null,metricsAttr:null,activeTab:null,showPrediction:!1,tabs:null,extraClassName:"n-vm-tab-performance-details multi-col",tabViewTemplate:_.template(A),events:{"click .tab-item":"switchTab","click .range-dropdown .metric-range":"onTimeRangeChange","click .prediction":"onPredictionClick","click .create-alerts":"onCreateAlertsClick","click .alert_settings .alert-item":"onAlertSettingClick"},initialize:function(){var t;if(!this.metrics||!this.metricsAttr||!this.entityType)throw new Error("entityType, metrics, and metricsAttr should be defined");this.udaModel=new a;var i=h.getHashParameters(),n=i&&i.contextId?i.contextId:"";if(n){var s=o.getNavigationContext(n);if(s&&s.options&&s.options[T.NAV_TARGET_PARAMS]){var r=this.findTabForMetric(s.options[T.NAV_TARGET_PARAMS]);r&&(this.activeTab=r)}}e.prototype.initialize.apply(this,arguments);var c=(new Date).getTime();this.startTime=c-7*T.MILLIS_PER_DAY,this.samplingInterval=this.getSamplingInterval(7),this.subViewHelper=new S;var d=p.getXfitFeatureInfo();this.disableProFeature=d.disabled,this.metricsCollection=l.createGenericEntityCollection("metric",null,u.ALERT_METRICS),this.dataCache=(t={},_defineProperty(t,f.ALERT,{}),_defineProperty(t,f.EVENT,{}),_defineProperty(t,f.EFFICIENCY,{}),t),this.constructAttributeObject()},constructAttributeObject:function(){this.disableProFeature||_.each(this.metricsAttr,function(e){if(e&&e.current){var t=e.current;e.high="capacity."+t+".upper_buff",e.low="capacity."+t+".lower_buff",e.low_future="capacity."+t+".lower_buff",e.high_future="capacity."+t+".upper_buff",e.current_future="capacity."+t+".average_buff"}})},render:function(){return this.entityId?(this.renderTemplate(),this):this},getHypervisorAttribute:function(){switch(this.entityType){case T.ENTITY_VM:case T.ENTITY_HOST:return c.EB.VM.HYPERVISOR_TYPE;case T.ENTITY_CLUSTER:return c.EB.CLUSTER.HYPERVISOR_TYPES}},loadData:function(){var e=this,t=[],i=this.getHypervisorAttribute();return this.hypQueryModel=new s({entity_type:this.entityType,group_member_attributes:[i],entity_ids:[this.entityId]}),t.push(this.metricsCollection.fetch().done(function(){var t=p.findMetricsByEntityType(e.metricsCollection,e.entityType);_.each(t,function(e){var t=e.applicableHypervisors,i=_.every(N,function(e){return-1!==t.indexOf(e)});P[e.name]={isCommon:i}})})),t.push(this.hypQueryModel.save()),$.whenAll.apply($,t)},isMetricApplicableToHypervisor:function(e){var t=p.findMetricByName(this.metricsCollection,this.entityType,e);if(!t||!t.applicableHypervisors)return!1;if(!this.hypervisorType||this.hypervisorType===T.STATS_NOT_AVAILABLE||this.hypervisorType===T.HYPERVISOR_TYPE.NULL){var i=P[t.name];return i&&i.isCommon}return-1!==t.applicableHypervisors.indexOf(this.hypervisorType)},clearAlertThreshold:function(e){var t=this.subViewHelper.get(m.CHART_VIEW+"chart-"+e);t&&t.resetThresholdValues()},showAlertThreshold:function(e,t){var i=this.subViewHelper.get(m.CHART_VIEW+"chart-"+t);if(i){var n=this.findPolicyByMetric(e);n&&i.setThresholdValues(n.filterExpressions)}},renderTemplate:function(){var e=this,t=_.filter(this.tabs,function(t,i){if("group"===t.type)return!0;if(!e.metrics[t.name]||!e.metrics[t.name].ATTRS)return!1;var n=e.metrics[t.name].ATTRS[0];return n&&e.isMetricApplicableToHypervisor(e.metricsAttr[n].current)});this.$el.append(this.tabViewTemplate(this.vtOptions({tabs:t}))),this.$(".tab-item."+this.activeTab).addClass("active"),this.activeTabEl=this.$(".tab-item.active"),this.activeMetric=this.activeTabEl.data("metric"),this.viewRendered=!0,this._initializeSubViews()},switchTab:function(e){var t=$(e.currentTarget);t.hasClass("group-name")||t.hasClass("seperator")||(this.activeTabEl.removeClass("active"),this.activeTabEl=t,this.activeTabEl.addClass("active"),this.activeMetric=this.activeTabEl.data("metric"),this._initializeSubViews())},onPredictionClick:function(e){$(e.target).is(":checked")?(this.subViewHelper.iterate("setPrediction",!0),this.showPrediction=!0):(this.subViewHelper.iterate("setPrediction",!1),this.showPrediction=!1)},getSamplingInterval:function(e){switch(e=Number(e)){case 1:case 7:return 5*T.SECONDS_PER_MINUTE;default:return T.SECONDS_PER_HOUR}},onTimeRangeChange:function(e){var t=parseInt($(e.currentTarget).attr("data-value"),10),i=(new Date).getTime();this.startTime=i-t*T.MILLIS_PER_DAY,this.samplingInterval=this.getSamplingInterval(t),this.subViewHelper.iterate("setStartTime",this.startTime),this.subViewHelper.iterate("setSamplingInterval",this.samplingInterval),this.subViewHelper.iterate("getChartData"),this._fetchAlertsAndAnomaly()},onCreateAlertsClick:function(e){var t=$(e.currentTarget),i=this.metricsAttr[this.activeMetric],n=t.attr("data-metric")||i&&i.current;n&&p.showUDAPolicyPopup(this.entityType,this.currentModelId,n)},onAlertSettingClick:function(e){var t=$(e.currentTarget),i=this.metricsAttr[this.activeMetric],n=t.attr("data-metric")||i&&i.current;n&&(t.hasClass("alert-policy")?p.showUDAPolicyPopup(this.entityType,this.currentModelId,n):t.hasClass("show-alert-threshold")?(t.parent().parent().addClass("showing-threshold"),this.showAlertThreshold(n,t.attr("data-attr"))):t.hasClass("clear-alert-threshold")&&(t.parent().parent().removeClass("showing-threshold"),this.clearAlertThreshold(t.attr("data-attr"))))},_fetchAlertsPolicy:function(e,t){return this.udaModel.fetch({data:{entity_type:e,entity_ids:t},error:function(e){h.debug("fetchAlertsPolicy: Error in fetching alert policies.")}})},findPolicyByMetric:function(e){return _.find(this.udaModel.models,function(t){return t.getMetricFromCondition()===e})},postSetModelId:function(e){var t=this;this.entityId=e,this.alertModel=new i({indicatorEntityType:this.entityType,entityType:this.entityType,entityId:e}),this.eventModel=new n({entityType:this.entityType,entityId:e,anomalyOnly:!0,indicatorEntityType:this.entityType}),this.$el.append(R()),this.$(".loading-spinner").append(E.THREE_DOTS_LOADER({content:""})),this.loadData().done(function(){t.$(".loading-spinner").remove();var i=t.getHypervisorAttribute(),n=t.hypQueryModel.getQueryResultAttributes();n&&n.length&&(t.hypervisorType=n[0][i]),t.hypervisorType&&t.metricsCollection.models&&t.metricsCollection.models.length||h.log("Error in fetching metrics collection or hypervisorType"),t.render(),t._fetchAlertsAndAnomaly(),t._fetchAlertsPolicy(t.entityType,e).done(function(){var e=t.isSingleChartView();_.each(t.metrics[t.activeMetric].ATTRS,function(i){var n=t.metricsAttr[i].current,s=t.findPolicyByMetric(n);if(s){var a=t.createAlertSettingsControl(s&&s.getId(),n,i);e?t.updateGlobalAlertSettings(a):$(".chart-"+i+" .chartAlertSettings").html(a)}})}),t.fetchEfficiencyInfo(e)})},updateGlobalAlertSettings:function(e){this.$(".globalAlertSettings").html(e),this.$(".globalAlertSettings").show()},getMetricEfficiencyMsg:function(e){return e=e.replace(".","_"),this.dataCache[f.EFFICIENCY][e]||""},setMetricEfficiencyMessages:function(){var e=this;if(this.efficiencyModel){var t=_.first(this.efficiencyModel.getQueryResultAttributes());if(t&&t[c.VM_EFFICIENCY.EFFICIENCY_DETAIL]){try{t=JSON.parse(t[c.VM_EFFICIENCY.EFFICIENCY_DETAIL])}catch(e){return void h.log("Error parsing vm efficiency details")}var i=this.dataCache[f.EFFICIENCY];_.each(t,function(t,n){var s=e.i18nStatic("VMEfficiencyVantagePointView",n);n!==c.VM_EFFICIENCY.DEAD_VM&&_.each(t,function(e){var t={};_.each(e,function(e,n){t[n]||(t[n]=!0,i[n]?(i[n].msg.push(s+", "+e),i[n].status.push(s)):i[n]={msg:[s+", "+e],status:[s]})})})})}}},isSingleChartView:function(){var e=this.metrics[this.activeMetric];return e&&e.ATTRS&&1===e.ATTRS.length},isMetricHaveAlerts:function(e){return this.dataCache[f.ALERT][e]||!1},groupByMetricName:function(e,t){var i=this,n=e.getQueryResultAttributes();this.dataCache[t]={},_.each(n,function(e){i.dataCache[t][e[c.ALERT_METRIC_NAME]]=!0})},isMetricHaveAnomaly:function(e){return this.dataCache[f.EVENT][e]||!1},updateStatusIcons:function(e){var t=this;_.each(this.tabs,function(i){"group"!==i.type&&t.metrics[i.name]&&t.metrics[i.name].ATTRS&&_.each(t.metrics[i.name].ATTRS,function(n){var s='li[data-metric="'+i.name+'"]',a=t.metricsAttr[n].current;if(e)return void(t.getMetricEfficiencyMsg(a)&&t.$el.find(s+" .constrained-indicator").removeClass("hidden"));t.isMetricHaveAlerts(a)&&t.$el.find(s+" .alert-indicator").removeClass("hidden"),!t.disableProFeature&&t.isMetricHaveAnomaly(a)&&t.$el.find(s+" .anomaly-indicator").removeClass("hidden")})})},destroy:function(){h.debug("EntityTabPerformanceDetailsView.js : destroy: "," | viewid     : "+this.cid),this.$(".indicator-info-icon").nutanixMoreInfo("destroy"),this.subViewHelper&&this.subViewHelper.removeAll(),this.hide(),e.prototype.destroy.apply(this,arguments)},_initializeSubViews:function(){var e=this,i=(new Date).getTime();if(this.currentModelId){if(this.subViewHelper.removeAll(),this.$(".chart-view").html(""),this.$(".globalAlertSettings").hide(),!this.metrics[this.activeMetric])return void h.log(this.name+": "+this.activeMetric+" active metric\n            is empty.");var n=this.isSingleChartView(),s=this.i18n(this.activeMetric+"_TITLE",this.i18n(this.activeMetric));_.each(this.metrics[this.activeMetric].ATTRS,function(a){var r="chart-"+a,o=e.metricsAttr[a].current,l=e.findPolicyByMetric(o),c=e.createAlertSettingsControl(l&&l.getId(),o,a);e.$(".chart-view").append(C(e.vtOptions({chartId:r,attr:a,alertSettings:c,hideTitle:n}))),n?(e.updateGlobalAlertSettings(c),s=e.i18n(a)):e.$(".globalAlertSettings").hide();var u=i+7*T.MILLIS_PER_DAY,d=p.findMetricByName(e.metricsCollection,e.entityType,o);e.subViewHelper.iterate("setPredictionEndTime",u);var h=new t({el:e.$(".chart-view").find("."+r+" .chart-wrapper"),parentView:e,entityType:e.entityType,metrics:e.metricsAttr,entityId:e.currentModelId,startTime:e.startTime,activeMetric:a,title:e.i18n(a),unit:d&&d.unit,disableBand:e.disableProFeature,showPrediction:e.showPrediction,samplingInterval:e.samplingInterval,samplingOperation:d&&d.downSamplingOperator&&d.downSamplingOperator.toUpperCase(),predictionEndTime:u});h.setAlertModel(p.findMetricRelatedModels(e.alertModel,o)),h.setAnomalyModel(p.findMetricRelatedModels(e.eventModel,o)),h.render(),h.getChartData(),e.subViewHelper.register(m.CHART_VIEW+r,h)}),this.updateChartGroupTitle(s)}},updateChartGroupTitle:function(e){this.updateEfficiencyInfo(),this.$(".chart-group-name").html(e)},fetchEfficiencyInfo:function(e){var t=this;this.entityType===T.ENTITY_VM&&(this.disableProFeature||(this.efficiencyModel=new s({entity_type:T.ENTITY_VM,group_member_attributes:[c.VM_EFFICIENCY.EFFICIENCY_DETAIL,c.VM_EFFICIENCY.EFFICIENCY_STATUS],entity_ids:[this.entityId]}),this.efficiencyModel.save(null,{success:function(){t.setMetricEfficiencyMessages(),t.updateStatusIcons(!0),t.updateEfficiencyInfo()},error:function(){h.log("Error in fetching Efficiency details")}})))},updateEfficiencyInfo:function(){if(this.$(".efficiency-indicator").html(""),this.$(".title-separator").addClass("hidden"),this.efficiencyModel&&this.metricsAttr[this.activeMetric]){var e=this.metricsAttr[this.activeMetric].current,t=this.getMetricEfficiencyMsg(e);t&&t.msg&&t.status&&(this.$(".title-separator").removeClass("hidden"),this.$(".efficiency-indicator").html(v(this.vtOptions({status:t.status.join(", ")}))),this.$(".indicator-info-icon").nutanixMoreInfo({icon:"information-tooltip",placement:"right",title:t.msg.join(" "),container:"body"}))}},findTabForMetric:function(e){var t=this,i=null;return _.find(this.tabs,function(n){var s=t.metrics[n.name];if(s)return _.find(s.ATTRS,function(s){if(t.metricsAttr[s].current===e)return i=n.name,!0})}),i},renderAlertAndAnomalyOnCharts:function(){var e=this;this.viewRendered&&_.each(this.subViewHelper.getIds(),function(t){var i=e.subViewHelper.get(t),n=e.metricsAttr[i.activeMetric].current;i.setAlertModel(p.findMetricRelatedModels(e.alertModel,n)),i.setAnomalyModel(p.findMetricRelatedModels(e.eventModel,n)),i.renderAlertAnomalyLineOnChart()})},_fetchAlertsAndAnomaly:function(){var e=this,t=[];this.alertModel.startTime=this.startTime,this.eventModel.startTime=this.startTime,this.alertModel.setAttributesForQuery(),this.eventModel.setAttributesForQuery(),t.push(this.alertModel.save()),t.push(this.eventModel.save()),$.whenAll.apply($,t).done(function(){e.groupByMetricName(e.alertModel,f.ALERT),e.groupByMetricName(e.eventModel,f.EVENT),e.updateStatusIcons(),e.renderAlertAndAnomalyOnCharts()}).fail(function(){r.showClientNotification(T.NOTIFY_ERROR(e.i18nStatic(I,"error.data_fetch")))})},createAlertSettingsControl:function(e,t,i){var n=p.findMetricByName(this.metricsCollection,this.entityType,t);if(n&&n.deprecated)return"";if(e){var s='data-metric="'+t+'"\n            data-policy="'+e+'"\n            data-attr="'+i+'"',a=d.dropdown({text:this.i18n("alert_settings"),variants:"-compact",rightAlign:!0,options:[{name:this.i18n("alert_policy"),class:"alert-item alert-policy",attributes:s,value:"1"},{name:this.i18n("show_alert_threshold"),class:"alert-item show-alert-threshold",attributes:s,value:"2"},{name:this.i18n("clear_alert_threshold"),class:"alert-item clear-alert-threshold",attributes:s,value:"3"}],classes:"alert_settings"}),r=$(a);return r.find(".text").removeClass("text").addClass("title"),_.first(r).outerHTML}return'<a class="create-alerts" data-metric"'+t+'">\n          '+this.i18n("create_alert_policy")+"\n        </a>"}})}),define("views/details/tabs/VMTabPerformanceDetailsView",["views/details/tabs/EntityTabPerformanceDetailsView","utils/AppConstants"],function(e,t){"use strict";var i={CPU_USAGE:{NAME:"CPU_USAGE",ATTRS:["CPU_USAGE"]},CPU_READY_TIME:{NAME:"CPU_READY_TIME",ATTRS:["CPU_READY_TIME"]},MEMORY_SWAP:{NAME:"MEMORY_SWAP",ATTRS:["MEMORY_SWAP_IN","MEMORY_SWAP_OUT"]},MEMORY_USAGE:{NAME:"MEMORY_USAGE",ATTRS:["MEMORY_USAGE"]},NUM_IOPS:{NAME:"NUM_IOPS",ATTRS:["NUM_IOPS","NUM_IOPS_WRITE","NUM_IOPS_READ"]},IO_LATENCY:{NAME:"IO_LATENCY",ATTRS:["IO_LATENCY","IO_LATENCY_WRITE","IO_LATENCY_READ"]},IO_BANDWIDTH:{NAME:"IO_BANDWIDTH",ATTRS:["IO_BANDWIDTH","IO_BANDWIDTH_WRITE","IO_BANDWIDTH_READ"]},WSS:{NAME:"WSS",ATTRS:["WSS","WSS_WRITE","WSS_READ"]},STORAGE_USAGE:{NAME:"STORAGE_USAGE",ATTRS:["LIVE_USAGE","SNAPSHOT_USAGE","SHARED_USAGE"]},PACKET_DROPPED:{NAME:"PACKET_DROPPED",ATTRS:["PACKET_TRANSMITTED_DROPPED","PACKET_RECEIVED_DROPPED"]},NETWORK_BYTES:{NAME:"NETWORK_BYTES",ATTRS:["NETWORK_TRANSMITTED_BYTES","NETWORK_RECEIVED_BYTES"]}},n=[{name:"CPU",type:"group"},{name:"CPU_USAGE"},{name:"CPU_READY_TIME"},{name:"MEMORY",type:"group"},{name:"MEMORY_USAGE"},{name:"MEMORY_SWAP"},{name:"STORAGE",type:"group"},{name:"IO_BANDWIDTH"},{name:"IO_LATENCY"},{name:"NUM_IOPS"},{name:"STORAGE_USAGE"},{name:"WSS"},{name:"NETWORK",type:"group"},{name:"PACKET_DROPPED"},{name:"NETWORK_BYTES"}],s={MEMORY_USAGE:{current:"memory_usage_ppm"},CPU_USAGE:{current:"hypervisor_cpu_usage_ppm"},CPU_READY_TIME:{current:"hypervisor.cpu_ready_time_ppm"},NUM_IOPS:{current:"controller_num_iops",qosThrottled:"throttled_iops"},NUM_IOPS_READ:{current:"controller_num_read_iops"},NUM_IOPS_WRITE:{current:"controller_num_write_iops"},IO_LATENCY_READ:{current:"controller_avg_read_io_latency_usecs"},IO_LATENCY_WRITE:{current:"controller_avg_write_io_latency_usecs"},IO_LATENCY:{current:"controller_avg_io_latency_usecs"},IO_BANDWIDTH:{current:"controller_io_bandwidth_kBps"},IO_BANDWIDTH_WRITE:{current:"controller_write_io_bandwidth_kBps"},IO_BANDWIDTH_READ:{current:"controller_read_io_bandwidth_kBps"},MEMORY_SWAP:{current:"hypervisor_swap_in_rate_kBps"},MEMORY_SWAP_IN:{current:"hypervisor_swap_in_rate_kBps"},MEMORY_SWAP_OUT:{current:"hypervisor_swap_out_rate_kBps"},PACKET_DROPPED:{current:"hypervisor_num_transmit_packets_dropped"},PACKET_TRANSMITTED_DROPPED:{current:"hypervisor_num_transmit_packets_dropped"},PACKET_RECEIVED_DROPPED:{current:"hypervisor_num_receive_packets_dropped"},STORAGE_USAGE:{current:"controller_user_bytes"},LIVE_USAGE:{current:"controller_user_bytes"},SNAPSHOT_USAGE:{current:"controller.snapshot_usage_bytes"},SHARED_USAGE:{current:"controller.shared_usage_bytes"},WSS:{current:"controller.wss_3600s_union_MB"},WSS_READ:{current:"controller.wss_3600s_read_MB"},WSS_WRITE:{current:"controller.wss_3600s_write_MB"},NETWORK_BYTES:{current:"hypervisor_num_transmitted_bytes"},NETWORK_RECEIVED_BYTES:{current:"hypervisor_num_received_bytes"},NETWORK_TRANSMITTED_BYTES:{current:"hypervisor_num_transmitted_bytes"}};return e.extend({metrics:i,activeMetric:i.CPU_USAGE.NAME,entityType:t.ENTITY_VM,metricsAttr:s,activeTab:i.CPU_USAGE.NAME,tabs:n})}),define("views/details/tabs/ClusterTabPerformanceDetailsView",["views/details/tabs/EntityTabPerformanceDetailsView","utils/AppConstants"],function(e,t){"use strict";var i={CPU_USAGE:{NAME:"CPU_USAGE",ATTRS:["CPU_USAGE"]},CPU_WAIT_TIME:{NAME:"CPU_WAIT_TIME",ATTRS:["CPU_WAIT_TIME"]},MEMORY_SWAP:{NAME:"MEMORY_SWAP",ATTRS:["MEMORY_SWAP_IN","MEMORY_SWAP_OUT"]},MEMORY_USAGE:{NAME:"MEMORY_USAGE",ATTRS:["MEMORY_USAGE"]},NUM_IOPS:{NAME:"NUM_IOPS",ATTRS:["NUM_IOPS","NUM_IOPS_WRITE","NUM_IOPS_READ"]},IO_LATENCY:{NAME:"IO_LATENCY",ATTRS:["IO_LATENCY","IO_LATENCY_WRITE","IO_LATENCY_READ"]},IO_BANDWIDTH:{NAME:"IO_BANDWIDTH",ATTRS:["IO_BANDWIDTH","IO_BANDWIDTH_WRITE","IO_BANDWIDTH_READ"]}},n=[{name:"CPU",type:"group"},{name:"CPU_USAGE"},{name:"CPU_WAIT_TIME"},{name:"MEMORY",type:"group"},{name:"MEMORY_USAGE"},{name:"STORAGE",type:"group"},{name:"IO_BANDWIDTH"},{name:"IO_LATENCY"},{name:"NUM_IOPS"},{name:"SNAPSHOT_USAGE"}],s={MEMORY_USAGE:{current:"hypervisor_memory_usage_ppm"},CPU_USAGE:{current:"hypervisor_cpu_usage_ppm"},CPU_WAIT_TIME:{current:"hypervisor.cpu_ready_time_ppm"},NUM_IOPS:{current:"controller_num_iops"},NUM_IOPS_READ:{current:"controller_num_read_iops"},NUM_IOPS_WRITE:{current:"controller_num_write_iops"},IO_LATENCY_READ:{current:"controller_avg_read_io_latency_usecs"},IO_LATENCY_WRITE:{current:"controller_avg_write_io_latency_usecs"},IO_LATENCY:{current:"controller_avg_io_latency_usecs"},IO_BANDWIDTH:{current:"controller_io_bandwidth_kBps"},IO_BANDWIDTH_WRITE:{current:"controller_write_io_bandwidth_kBps"},IO_BANDWIDTH_READ:{current:"controller_read_io_bandwidth_kBps"},MEMORY_SWAP:{current:"hypervisor_swap_in_rate_kBps"},MEMORY_SWAP_IN:{current:"hypervisor_swap_in_rate_kBps"},MEMORY_SWAP_OUT:{current:"hypervisor_swap_out_rate_kBps"}};return e.extend({metrics:i,activeMetric:i.CPU_USAGE.NAME,entityType:t.ENTITY_CLUSTER,metricsAttr:s,activeTab:i.CPU_USAGE.NAME,tabs:n})}),define("views/details/tabs/HostTabPerformanceDetailsView",["views/details/tabs/EntityTabPerformanceDetailsView","utils/AppConstants"],function(e,t){"use strict";var i={CPU_USAGE:{NAME:"CPU_USAGE",ATTRS:["CPU_USAGE"]},CPU_WAIT_TIME:{NAME:"CPU_WAIT_TIME",ATTRS:["CPU_WAIT_TIME"]},MEMORY_SWAP:{NAME:"MEMORY_SWAP",ATTRS:["MEMORY_SWAP_IN","MEMORY_SWAP_OUT"]},MEMORY_USAGE:{NAME:"MEMORY_USAGE",ATTRS:["MEMORY_USAGE"]},NUM_IOPS:{NAME:"NUM_IOPS",ATTRS:["NUM_IOPS","NUM_IOPS_WRITE","NUM_IOPS_READ"]},IO_LATENCY:{NAME:"IO_LATENCY",ATTRS:["IO_LATENCY","IO_LATENCY_WRITE","IO_LATENCY_READ"]},IO_BANDWIDTH:{NAME:"IO_BANDWIDTH",ATTRS:["IO_BANDWIDTH","IO_BANDWIDTH_WRITE","IO_BANDWIDTH_READ"]},PACKET_DROPPED:{NAME:"PACKET_DROPPED",ATTRS:["PACKET_TRANSMITTED_DROPPED","PACKET_RECEIVED_DROPPED"]}},n=[{name:"CPU",type:"group"},{name:"CPU_USAGE"},{name:"CPU_WAIT_TIME"},{name:"MEMORY",type:"group"},{name:"MEMORY_USAGE"},{name:"MEMORY_SWAP"},{name:"STORAGE",type:"group"},{name:"IO_BANDWIDTH"},{name:"IO_LATENCY"},{name:"NUM_IOPS"},{name:"SNAPSHOT_USAGE"},{name:"NETWORK",type:"group"},{name:"PACKET_DROPPED"}],s={MEMORY_USAGE:{current:"hypervisor_memory_usage_ppm"},CPU_USAGE:{current:"hypervisor_cpu_usage_ppm"},CPU_WAIT_TIME:{current:"hypervisor.cpu_ready_time_ppm"},NUM_IOPS:{current:"controller_num_iops"},NUM_IOPS_READ:{current:"controller_num_read_iops"},NUM_IOPS_WRITE:{current:"controller_num_write_iops"},IO_LATENCY_READ:{current:"controller_avg_read_io_latency_usecs"},IO_LATENCY_WRITE:{current:"controller_avg_write_io_latency_usecs"},IO_LATENCY:{current:"controller_avg_io_latency_usecs"},IO_BANDWIDTH:{current:"controller_io_bandwidth_kBps"},IO_BANDWIDTH_WRITE:{current:"controller_write_io_bandwidth_kBps"},IO_BANDWIDTH_READ:{current:"controller_read_io_bandwidth_kBps"},MEMORY_SWAP:{current:"hypervisor_swap_in_rate_kBps"},MEMORY_SWAP_IN:{current:"hypervisor_swap_in_rate_kBps"},MEMORY_SWAP_OUT:{current:"hypervisor_swap_out_rate_kBps"},PACKET_DROPPED:{current:"hypervisor_num_transmit_packets_dropped"},PACKET_TRANSMITTED_DROPPED:{current:"hypervisor_num_transmit_packets_dropped"},PACKET_RECEIVED_DROPPED:{current:"hypervisor_num_receive_packets_dropped"}};return e.extend({metrics:i,activeMetric:i.CPU_USAGE.NAME,entityType:t.ENTITY_HOST,metricsAttr:s,activeTab:i.CPU_USAGE.NAME,tabs:n})}),define("views/details/tabs/HealthTabContentDetailsView",["views/basecomponents/details/tabs/BaseTabContentDetailsView","utils/AppUtil"],function(e,t){"use strict";return e.extend({extraClassName:"n-health-tab-content-details",initializeProperties:function(e){},render:function(){return this.$el.append("Under Construction"),this},destroy:function(){t.debug("HealthTabContentDetailsView : destroy: "," | viewid     : "+this.cid),e.prototype.destroy.apply(this,arguments)},onStartServices:function(){},onStopServices:function(){}})}),define("views/basecomponents/charts/BaseGroupChartView",["views/basecomponents/BaseView","models/stats/UpdatedTimeStatsModel","utils/AppConstants","utils/AppUtil","utils/StatsUtil","utils/SubViewHelper"],function(e,t,i,n,s,a){"use strict";return e.extend({className:"n-chart-group",metrics:null,intervalTimeInMilliSec:i.DEFAULT_STATS_INTERVAL,statsModel:null,subViewHelper:null,modelEvents:{"change:stats  statsModel":"updateStatsCharts","error         statsModel":"showErrorState"},initialize:function(e){this.initializeStatsProperties(e),this.statsModel=new t,this.statsModel.setTimeInterval(s.getStatsStartTime()),this.statsModel.setStatsFor(e.entityId,e.entityType,this.metrics,e.entityParentId,e.entityParentType),this.statsModel.setSamplingIntervalSecs(s.getSamplingIntervalSecs(this.metrics)),this.statsModel.setIntervalTime(this.intervalTimeInMilliSec),this.subViewHelper=new a},onStartServices:function(){this.delegateModelEvents(),this.statsModel&&(this.statsModel.setTimeInterval(s.getStatsStartTime(),s.getStatsCurrentTime(),s.getSamplingIntervalSecs(this.metrics)),this.statsModel.startPolling({alwaysTriggerChange:!0,alwaysTriggerPending:!0})),this.subViewHelper.iterate("startServices")},onStopServices:function(){this.undelegateModelEvents(),this.statsModel&&this.statsModel.stopPolling(),this.subViewHelper.iterate("stopServices")},fetchOnDemand:function(e,t,i,n){this.statsModel&&(e=e||this.statsModel.get("entityId"),t=t||this.statsModel.get("entityType"),i=i||this.statsModel.get("entityParentId"),n=n||this.statsModel.get("entityParentType"),this.statsModel.setStatsFor(e,t,this.metrics,i,n),this.statsModel.setTimeInterval(s.getStatsStartTime(),s.getStatsCurrentTime(),s.getSamplingIntervalSecs(this.metrics)),this.showLoadingState(),this.statsModel.fetch({alwaysTriggerChange:!0,alwaysTriggerPending:!0}))},getEntityType:function(){return this.statsModel.get("entityType")},getEntityId:function(){return this.statsModel.get("entityId")},initializeStatsProperties:function(e){},updateStatsCharts:function(){},showLoadingState:function(){},showResource:function(){},showErrorState:function(e,t,s){this.statsModel.getState()!==i.STATE_CANCELED&&(n.log("BaseGroupChartView | Error rendering charts:   "+n.processAjaxError(t.responseText)),this.showNoData())},showNoData:function(){},updateAttributesForCharts:function(e){this.subViewHelper.iterate("updateAttributesForCharts",e)}})}),define("views/basecomponents/charts/simple/TimelineChartView",["flotr2","views/basecomponents/charts/BaseChartView","views/basecomponents/charts/ChartTemplates","views/basecomponents/actionmenu/ActionMenuView","utils/AppConstants","utils/StatsUtil","utils/TimeUtil","utils/StyleDescriptor","utils/CommonTemplates","managers/NavigationManager"],function(e,t,i,n,s,a,r,o,l,c){"use strict";var u=[s.ENTITY_PHYSICAL_NIC,s.ENTITY_VIRTUAL_NICS,s.ENTITY_SWITCH_PORTS,s.ENTITY_HOST_NICS,s.ENTITY_FILE_SERVER];return t.extend({title:null,entityName:null,mainColor:null,entityType:null,entityParentType:null,name:"TimelineChartView",dataField:null,actionMenuView:null,initializeStatsProperties:function(e){this.title=a.getMetricLabel(e.metricType,e.entityType),this.entityName=e.entityName,this.mainColor=o.getChartColor(e.metricType),this.entityType=e.entityType,this.entityParentType=e.entityParentType,this.entityParentId=e.entityParentId,void 0===e.showActionMenu?this.showActionMenu=!0:this.showActionMenu=e.showActionMenu,_.bindAll(this,"xAxisTickFormatter")},setTitle:function(e){this.title=e},render:function(){return this.$el.html(i.SIMPLE_TIMELINE(this.vtOptions({title:this.title,chartHeight:this.chartHeight}))),this.showOutline()&&this.$el.addClass("n-chart-outline"),this.isMetricSupportedByAnalysisPage()&&this.showActionMenu&&this.createActionMenu(),this},updateChartData:function(e){this.isValidForChartUpdate(e)&&(this.model=e||this.model,this.graphData=this.model.getStats(this.getMetricId()),this.updateChartOptions(),this.renderChart())},getChartData:function(){return[{data:this.processData(),lines:{fill:this.hasFill(),lineWidth:1,fillColor:{colors:this.mainColor},fillOpacity:.15}}]},showOutline:function(){return!0},renderChart:function(){var t=this.getChartContainer();if(this.graphData&&this.graphData.length){if(this.showChart(),t&&!t.clientWidth)return;this.graph=e.draw(t,this.getChartData(),{colors:this.mainColor,shadowSize:0,fontColor:"#999999",xaxis:{mode:"time",labelsAngle:45,min:this.getTimeRangeMin(),max:this.getTimeRangeMax(),tickFormatter:this.xAxisTickFormatter,metricType:this.options.metricType},yaxis:{max:this.getYMax(),min:this.getYMin(),ticks:this.getTicks(),tickFormatter:this.yAxisTickFormatter,tickDecimals:0,noTicks:2,metricType:this.options.metricType},grid:{color:"#999999",tickColor:"#f1f1f1",outlineWidth:.5,horizontalLines:!1,verticalLines:!0,minorHorizontalLines:!1,minorVerticalLines:!0,outline:"ws"},mouse:{track:!0,trackAll:!0,relative:!0,position:"ew",margin:6,lineColor:"#333333",trackFormatter:this.toolTipTrackFormatter,metricType:this.options.metricType,mouseTrackOverride:this.mouseTrackOverride,preProcessTooltipData:this.preProcessTooltipData},plotOffsetOveride:function(e){e.left=0}})}else this.showNoData();this.showMaxYaxisValue(),this.showLastestValue()},isMetricSupportedByAnalysisPage:function(){return!_.contains(u,this.entityType)},formatDataValue:function(e){return(this.getMetricTypeUnit()===s.UNITS.BYTES||a.isStorageStats(this.options.metricType))&&(e=a.processStorageStats(e,!0)),a.statsFormat(this.options.metricType,e)},showLastestValue:function(){var e="";if(this.model&&this.model.getStats(this.getMetricId())&&this.model.getStats(this.getMetricId()).length){var t=this.model.getStatsLatestValue(this.getMetricId())
;e=this.formatDataValue(t)}this.$(".lblmaxValue").html(this.getMaxDisplayLabel()),this.$(".lblValue").html(e)},showResourceLabel:function(e){this.$(".lblResource").html(e)},xAxisTickFormatter:function(e){return this.getTimeRangeMax()-this.getTimeRangeMin()>s.MILLIS_PER_DAY?r.formatDateOnly(e):r.formatShortTime(e)},yAxisTickFormatter:function(e){return e},getYMax:function(){return this.getMax()},getYMin:function(){return this.getMetricTypeUnit()===s.UNITS.BYTES||a.isStorageStats(this.options.metricType)?0:this.getMin()},createActionMenu:function(){this.actionMenuView=new n({parentEl:this.$el,actionList:[s.ACTION_MENU.CHART_REDIRECT]}),this.actionMenuView.registerActionCallback(s.ACTION_MENU.CHART_REDIRECT,this.actionMenuCallbackRedirect,this)},actionMenuCallbackRedirect:function(){if(this.model){var e=this.entityName?this.entityName+": "+this.title:this.title,t=this.model.getDrilldownRoute(this.getMetricId()),i=l.CHART_DRILL_DOWN(_.extend(t,{tr:s.STATS_LAST_HOURS,title:encodeURIComponent(e),entityParentType:this.entityParentType,entityParentId:this.entityParentId}));c.navigateToPage(s.PAGE_ANALYSIS,s.SUBPAGE_TIMELINE,i)}},destroy:function(){this.actionMenuView&&this.actionMenuView.destroy(),t.prototype.destroy.apply(this,arguments)},updateAttributesForCharts:function(e){this.entityName=e.entityName}})}),define("views/basecomponents/charts/groups/MetricGroupChartView",["data/DataProperties","views/basecomponents/charts/BaseGroupChartView","views/basecomponents/charts/simple/TimelineChartView","utils/AppConstants","utils/StatsUtil","utils/HypervisorUtil","models/hardware/HostCollection","models/hardware/HostModel","models/vm/VMModel"],function(e,t,i,n,s,a,r,o,l){"use strict";return t.extend({entityType:null,entityName:null,entityParentType:null,entityParentId:null,initializeStatsProperties:function(e){this.entityType=e.entityType,this.entityName=e.entityName,this.metrics=e.metrics,this.entityParentType=e.entityParentType,this.entityParentId=e.entityParentId},render:function(){var e;return _.each(this.metrics,function(t){e=new i({metricType:t,entityType:this.entityType,entityName:this.entityName,entityParentType:this.entityParentType,entityParentId:this.entityParentId}),this.$el.append(e.render().el),this.subViewHelper.register(t,e)},this),this},updateStatsCharts:function(){this.subViewHelper.iterate("updateChartData",this.statsModel)},showLoadingState:function(){this.subViewHelper.iterate("showLoading")},showNoData:function(){this.subViewHelper.iterate("showNoData")},showRelevantCharts:function(e){var t=this;this.subViewHelper.getIds().forEach(function(i){var n=t.subViewHelper.get(i);if(e&&_.isFunction(e.isDisplayableMetric)&&!e.isDisplayableMetric(i))return void n.$el.hide();n.$el.show()})},showResource:function(t,i){var c=!1;this.getEntityType()===n.ENTITY_CLUSTER&&a.getClusterHypervisors(i).length>1&&(c=!0);var u={};_.each(this.subViewHelper.getIds(),function(i){if(s.isStatWithResourceLabelForCPU(i)||s.isStatWithResourceLabelForMemory(i))if(this.getEntityType()===n.ENTITY_CLUSTER&&t instanceof r){var a;a=c?this.filterModelsByHypervisorOnMetric(i,t):t,s.isStatWithResourceLabelForCPU(i)&&(u[i]=s.aggregate(a,e.CPU_CAPACITY,!0,e.CPU_CORES)),s.isStatWithResourceLabelForMemory(i)&&(u[i]=s.aggregate(a,e.MEM_CAPACITY))}else this.getEntityType()===n.ENTITY_HOST&&t instanceof o?(s.isStatWithResourceLabelForCPU(i)&&(u[i]=s.statsFormat(e.CPU_CAPACITY,t.getValue(e.CPU_CAPACITY),!0)),s.isStatWithResourceLabelForMemory(i)&&(u[i]=s.storageFormat(t.getValue(e.MEM_CAPACITY)))):this.getEntityType()===n.ENTITY_VM&&t instanceof l&&s.isStatWithResourceLabelForMemory(i)&&(u[i]=s.storageFormat(t.getMemoryCapacity()))},this),_.each(u,function(e,t){var i=this.subViewHelper.get(t);i&&i.showResourceLabel("of "+e)},this)},filterModelsByHypervisorOnMetric:function(t,i){var s;return-1!==t.indexOf("esx")?s=n.HYPERVISOR_TYPE.ESXI:-1!==t.indexOf("kvm")?s=n.HYPERVISOR_TYPE.KVM:-1!==t.indexOf("hyperv")&&(s=n.HYPERVISOR_TYPE.HYPERV),s?i.filter(function(t){return t.get(e.HYPERVISOR_TYPE)===s}):i}})}),define("views/details/tabs/MetricTabContentDetailsView",["views/basecomponents/details/tabs/BaseTabContentDetailsView","data/DataProperties","managers/ClusterManager","views/basecomponents/charts/groups/MetricGroupChartView","utils/AppConstants","utils/AppUtil","utils/StatsUtil","utils/SubViewHelper"],function(e,t,i,n,s,a,r,o){"use strict";return e.extend({extraClassName:"n-metric-tab-content-details",subViewHelper:null,metricsDefault:null,initializeProperties:function(e){if(i.isMulticlusterNavMode())this.metricsDefault=[];else{var t=i.getCurrentClusterModel();this.updateMetrics(t)}this.subViewHelper=new o},updateMetrics:function(e){var n=this.options?this.options.tabId:s.TAB_DETAILS.METRICS;switch(this.entityType){case s.ENTITY_VM:this.metricsDefault=[t.STATS_HYP_CPU_USAGE,t.STATS_MEMORY_USAGE,t.STATS_CONTROLLER_NUM_IOPS,t.STATS_CONTROLLER_BANDWIDTH,t.STATS_CONTROLLER_AVG_IO_LATENCY];try{i.doesClusterHaveCpuReadyStats(e)&&this.metricsDefault.push(t.STATS_HYP_CPU_READY_TIME)}catch(e){a.log("MetricTabContentDetailsView: updateMetrics: "+e.toString())}this.gpusInUse&&(this.metricsDefault.push(t.STATS_GPU_USAGE),this.metricsDefault.push(t.STATS_FRAMEBUFFER_USAGE)),this.metricsDefault.push(t.STATS_CTRLR_READ_SRC_SSD_BYTES_PER_SEC);break;case s.ENTITY_CONTAINER:case s.ENTITY_VDISK:case s.ENTITY_ACROPOLIS_VOLUME_GROUP:this.metricsDefault=[t.STATS_CONTROLLER_NUM_IOPS,t.STATS_CONTROLLER_BANDWIDTH,t.STATS_CONTROLLER_AVG_IO_LATENCY];break;case s.ENTITY_FILE_SERVER:n===s.TAB_DETAILS.FS_USERS?this.metricsDefault=[t.STATS_FS_CONNECTED_USERS]:this.metricsDefault=[t.STATS_CONTROLLER_NUM_IOPS,t.STATS_CONTROLLER_BANDWIDTH,t.STATS_CONTROLLER_AVG_IO_LATENCY];break;case s.ENTITY_SHARE:n===s.TAB_DETAILS.FS_USERS&&(this.metricsDefault=[t.STATS_SHARE_CONNECTED_USERS]);break;case s.ENTITY_HOST:this.metricsDefault=[t.STATS_HYP_CPU_USAGE,t.STATS_HYP_MEMORY_USAGE,t.STATS_NUM_IOPS,t.STATS_BANDWIDTH,t.STATS_AVG_IO_LATENCY];break;case s.ENTITY_DISK:case s.ENTITY_STORAGE_POOL:this.metricsDefault=[t.STATS_NUM_IOPS,t.STATS_BANDWIDTH,t.STATS_AVG_IO_LATENCY];break;case s.ENTITY_GPU:this.metricsDefault=[t.STATS_GPU_USAGE,t.STATS_FRAMEBUFFER_USAGE];break;case s.ENTITY_PROTECTION_DOMAIN:case s.ENTITY_REMOTE_SITE:this.metricsDefault=[t.STATS_REP_BW_TRANSFERRED,t.STATS_REP_BW_RECEIVED];break;case s.ENTITY_SERVICE:this.metricsDefault=[t.STATS_HYP_CPU_USAGE,t.STATS_CONTROLLER_NUM_IOPS,t.STATS_CONTROLLER_BANDWIDTH,t.STATS_CONTROLLER_AVG_IO_LATENCY];break;case s.ENTITY_CLUSTER:this.pageId===s.PAGE_VMS?this.metricsDefault=[t.STATS_HYP_CPU_USAGE,t.STATS_HYP_MEMORY_USAGE,t.STATS_CONTROLLER_NUM_IOPS,t.STATS_CONTROLLER_BANDWIDTH,t.STATS_CONTROLLER_AVG_IO_LATENCY]:this.pageId===s.PAGE_HARDWARE?this.metricsDefault=[t.STATS_HYP_CPU_USAGE,t.STATS_HYP_MEMORY_USAGE,t.STATS_NUM_IOPS,t.STATS_BANDWIDTH,t.STATS_AVG_IO_LATENCY]:this.pageId===s.PAGE_STORAGE?this.metricsDefault=[t.STATS_CONTROLLER_NUM_IOPS,t.STATS_CONTROLLER_BANDWIDTH,t.STATS_CONTROLLER_AVG_IO_LATENCY]:this.pageId===s.PAGE_DR?this.metricsDefault=[t.STATS_REP_BW_TRANSFERRED,t.STATS_REP_BW_RECEIVED]:this.pageId===s.PAGE_MC_DASHBOARD&&(this.metricsDefault=[t.STATS_HYP_CPU_USAGE,t.STATS_HYP_MEMORY_USAGE,t.STATS_CONTROLLER_NUM_IOPS,t.STATS_CONTROLLER_BANDWIDTH,t.STATS_CONTROLLER_AVG_IO_LATENCY])}},render:function(){if(this.metricsDefault){this.subViewHelper.removeAll();for(var e=this.getMetricGroups(this.metricsDefault),t=0;t<e.length;t++){var i=new n({entityId:this.currentModelId,entityType:this.entityType,entityName:this.entityName,metrics:e[t]});this.subViewHelper.register("metricGroupChartView"+t,i),this.$el.append(i.render().el)}this.updateChartVisibility(this.currentModel)}else this.$el.append("No Metrics Specified");return this},getMetricGroups:function(e,t){var i=e.slice(0);if(t=t||5,this.entityType===s.ENTITY_CLUSTER){for(var n=0;n<i.length;n++)if(r.isMetricSplittableForMixedHypervisor(i[n],this.clusterUuid)){var a=r.splitMetricByHypervisorTypes(i[n],this.clusterUuid);for(var o in a)_.isArray(i[n])?i[n].push(a[o]):i[n]=a[o]}i=_.flatten(i)}for(var l=[],c=0,u=1,d=0;d<i.length;d++)u++>t&&(u=1,c++),l[c]=l[c]||[],l[c].push(i[d]);return l},destroy:function(){a.debug("MetricTabContentDetailsView : destroy: "," | viewid     : "+this.cid),this.subViewHelper&&this.subViewHelper.iterate("destroy"),e.prototype.destroy.apply(this,arguments)},setModel:function(e){this.currentModel=e,e&&e.getState()!==s.STATE_SUCCESS?(e.off("change",this._setModel,this),e.on("change",this._setModel,this)):e&&this._setModel(e),this.updateChartVisibility(e),this.updateAttributesForCharts(e)},_setModel:function(e){if(e.off("change",this._setModel,this),e){if(this.clusterUuid=e.getClusterUuid(),this.clusterManager.isMulticlusterNavMode()){var i=this.clusterManager.getClusterModelByClusterUuid(this.clusterUuid);if(!i)throw new Error("Can't find the clusterModel associated with clusterUuid: "+this.clusterUuid);this.reInitializeCharts(i)}this.gpusInUse=e.get(t.VM_GPUS_IN_USE),this.gpusInUse&&this.reInitializeCharts(e)}},postSetModelId:function(e,t){this.subViewHelper&&a.isValidId(e)&&this.subViewHelper.iterate("fetchOnDemand",e)},reInitializeCharts:function(e){this.subViewHelper.iterate("stopServices"),this.subViewHelper.iterate("destroy"),this.updateMetrics(e),this.render(),this.subViewHelper.iterate("delegateModelEvents"),this.subViewHelper.iterate("startServices")},showResource:function(e){this.subViewHelper.iterate("showResource",e,this.currentModelId)},updateChartVisibility:function(e){e&&this.subViewHelper.iterate("showRelevantCharts",e)},updateAttributesForCharts:function(e){e&&(this.entityName=e.get(e.nameAttribute),this.subViewHelper.iterate("updateAttributesForCharts",{entityName:this.entityName}))},onStartServices:function(){this.subViewHelper&&this.subViewHelper.iterate("startServices")},onStopServices:function(){this.subViewHelper&&this.subViewHelper.iterate("stopServices")}})}),define("views/basecomponents/datatables/DetailsTableTabView",["views/basecomponents/datatables/DetailsTableView","utils/AppConstants","utils/VisualizationUtil"],function(e,t,i){"use strict";return e.extend({currentTab:null,tabNames:null,defaultTab:null,tabDetailsClassName:"n-tabbed-metrics",tabClassName:"n-details-tabs",initialize:function(t){e.prototype.initialize.apply(this,arguments),this.tabNames={}},renderTabsView:function(){i.renderTabDetailsView(this.$("."+this.tabDetailsClassName),this.tabNames,this.entityType,t.PAGE_VMS,this.tabClassName||"n-details-table-tabs"),this.selectTab(this.defaultTab),this.$("."+this.tabDetailsClassName).hide()},getTabView:function(e){},refreshTabDetails:function(e){},selectTab:function(e){if(e!==this.currentTab){var t=this.subViewHelper.get(this.currentTab);t&&(t.$el.hide(),t.stopServices()),this.currentTab=e,this.selectTabHeader(this.currentTab),t=this.subViewHelper.get(e),t?this.refreshTabDetails():(this.createTab(e),this.refreshTabDetails())}},createTab:function(e){var t=this.getTabView(e);this.$("."+this.tabDetailsClassName).find(".n-tab-details-body:first").append(t.render().el),this.subViewHelper.register(e,t)},selectTabHeader:function(e){var t=this.$("."+this.tabDetailsClassName).find(".n-tab-details-button");return _.each(t,function(t){$(t).attr("data-target")===e?$(t).addClass("active"):$(t).removeClass("active")},this),!1},onClickTab:function(e){var t=e.currentTarget.getAttribute("data-target");return this.selectTab(t),!1}})}),define("models/virtualdisk/VirtualDiskModel",["models/PollingModel","data/DataURLConstants","data/DataProperties","utils/AppConstants","utils/StatsUtil"],function(e,t,i,n,s){"use strict";return e.extend({idAttribute:i.VIRTUAL_DISK_ID,urlRoot:t.VIRTUAL_DISK,entityType:n.ENTITY_VIRTUAL_DISK,name:"VirtualDiskModel",defaults:{id:null,virtualDiskId:null,nutanixNFSFilePath:null,attachedVMId:null,attachedVMName:null,diskCapacityInBytes:0,clusterUuid:null,diskAddress:null,virtualDiskTierParams:null},toJSON:function(t){var n=e.prototype.toJSON.apply(this,arguments);return t&&t.includeCustomAttributes&&(n[i.STATS_CUSTOM_NUM_IOPS]=this.getValue(i.STATS_CUSTOM_NUM_IOPS),n[i.STATS_CUSTOM_BANDWIDTH]=this.getValue(i.STATS_CUSTOM_BANDWIDTH),n[i.STATS_CUSTOM_NUM_READ_IOPS]=this.getValue(i.STATS_CUSTOM_NUM_READ_IOPS),n[i.STATS_CUSTOM_READ_BANDWIDTH]=this.getValue(i.STATS_CUSTOM_READ_BANDWIDTH),n[i.STATS_CUSTOM_AVG_READ_IO_LATENCY]=this.getValue(i.STATS_CUSTOM_AVG_READ_IO_LATENCY),n[i.STATS_CUSTOM_NUM_WRITE_IOPS]=this.getValue(i.STATS_CUSTOM_NUM_WRITE_IOPS),n[i.STATS_CUSTOM_WRITE_BANDWIDTH]=this.getValue(i.STATS_CUSTOM_WRITE_BANDWIDTH),n[i.STATS_CUSTOM_AVG_WRITE_IO_LATENCY]=this.getValue(i.STATS_CUSTOM_AVG_WRITE_IO_LATENCY)),!n[i.ID]&&this.getId()&&(n[i.ID]=this.getId()),n},getClusterModel:function(){var e=this.getClusterUuid();return this.clusterManager.getClusterModelByClusterUuid(e)},getValue:function(t){switch(t){case i.STATS_CUSTOM_NUM_IOPS:return this.getStatValue(n.METRIC_IOPS);case i.STATS_CUSTOM_BANDWIDTH:return this.getStatValue(n.METRIC_BANDWIDTH);case i.STATS_CUSTOM_NUM_READ_IOPS:return this.getStatValue(n.METRIC_READ_IOPS);case i.STATS_CUSTOM_READ_BANDWIDTH:return this.getStatValue(n.METRIC_READ_BANDWIDTH);case i.STATS_CUSTOM_AVG_READ_IO_LATENCY:return this.getStatValue(n.METRIC_READ_LATENCY);case i.STATS_CUSTOM_NUM_WRITE_IOPS:return this.getStatValue(n.METRIC_WRITE_IOPS);case i.STATS_CUSTOM_WRITE_BANDWIDTH:return this.getStatValue(n.METRIC_WRITE_BANDWIDTH);case i.STATS_CUSTOM_AVG_WRITE_IO_LATENCY:return this.getStatValue(n.METRIC_WRITE_LATENCY);default:return e.prototype.getValue.apply(this,arguments)}},getStatValue:function(e){var t=this.get(i.STATS),a=require("managers/NavigationManager"),r=a.getCurrentPageRoute(),o=r[n.NAV_PAGE_ID],l=o===n.PAGE_STORAGE;return t[s.getStatsProperty(e,n.ENTITY_VIRTUAL_DISK,!0,this.getClusterUuid(),l)]},getVMId:function(){return this.get(i.VIRTUAL_DISK_VM_ID)},getNutanixFilePath:function(){return this.get(i.VIRTUAL_DISK_NFS_FILE_PATH)?this.get(i.VIRTUAL_DISK_NFS_FILE_PATH):null},getDiskCapacity:function(){return this.get(i.VIRTUAL_DISK_CAPACITY)?this.get(i.VIRTUAL_DISK_CAPACITY):0},getDisplayName:function(e){return e?this.get(i.VIRTUAL_DISK_ADDRESS):this.get(i.VIRTUAL_DISK_NFS_FILE_PATH)}})}),define("models/virtualdisk/VirtualDiskCollection",["models/PollingCollection","models/virtualdisk/VirtualDiskModel","data/DataURLConstants"],function(e,t,i){"use strict";return e.extend({model:t,url:i.VIRTUAL_DISK,attachedVMId:null,attachedVGId:null,name:"VirtualDisk",setVmId:function(e){this.attachedVMId=e,this.url=i.VM+"/"+this.attachedVMId+"/"+i.VIRTUAL_DISK},getVmId:function(){return this.attachedVMId},setVgId:function(e){this.attachedVGId=e,this.url=i.VIRTUAL_DISK},getVgId:function(){return this.attachedVGId}})}),define("text!templates/pages/vms/details/VirtualDiskTabDetailsEntityView.html",[],function(){return'<div class="n-virtual-disk-metrics">\n  \x3c!-- @view: Tab details view goes here... --\x3e\n</div>\n'}),define("views/basecomponents/datatables/virtualdisk/VirtualDiskTableView",["views/basecomponents/datatables/DetailsTableTabView","views/basecomponents/datatables/DataTableColumnProvider","data/DataProperties","models/virtualdisk/VirtualDiskCollection","utils/AppConstants","utils/StatsUtil","utils/FilterUtil","managers/ClusterManager","managers/NavigationManager","views/basecomponents/charts/groups/MetricGroupChartView","text!templates/pages/vms/details/VirtualDiskTabDetailsEntityView.html"],function(e,t,i,n,s,a,r,o,l,c,u){"use strict";return e.extend({name:"VirtualDiskTableView",className:"n-virtualdisk-table",columns:null,virtualDiskCollection:null,virtualDiskModel:null,tabId:null,defaultTab:s.TAB_DETAILS.TOTAL,tabDetailsClassName:"n-virtual-disk-metrics",tabClassName:"n-virtual-disk-tabs",detailsTemplate:_.template(u),modelEvents:{"reset  virtualDiskCollection":"renderVirtualDiskTable"},attachRowTargetId:!0,events:{"click .n-virtualdisk-table .detailsTable tbody > tr":"onClickOverRow","click .n-virtualdisk-table .n-tab-details-button":"onClickTab"},initialize:function(t){e.prototype.initialize.apply(this,arguments),this.tabId=t.tabId,this.virtualDiskCollection=new n,this.virtualDiskCollection.setProjection([s.PROJECTION.STATS]),this.columns=this.getDefaultColumns(),this.delegateModelEvents(),this.tabNames[s.TAB_DETAILS.TOTAL]=this.i18n("total"),this.tabNames[s.TAB_DETAILS.READ]=this.i18n("read"),this.tabNames[s.TAB_DETAILS.WRITE]=this.i18n("write")},render:function(){return e.prototype.render.apply(this,arguments),this.$el.append(this.detailsTemplate),o.isMulticlusterNavMode()||this.renderMetricsView(),this},renderMetricsView:function(){this.tabId!==s.TAB_DETAILS.VIRTUAL_DISKS_PERF&&this.renderTabsView()},setModelId:function(e){this.isOnStoragePage()?(this.virtualDiskCollection.setVgId(e),this.virtualDiskCollection.setFilterCriteria(r.filterConditionToFIQL(i.VIRTUAL_DISK_VG_ID_FILTER,{op:s.FILTER_OPERATORS.EQUALS,value1:e}))):(this.virtualDiskCollection.setVmId(e),this.virtualDiskCollection.setFilterCriteria(null)),this.refreshData(),this.$("."+this.tabDetailsClassName).hide()},setModel:function(e){this.currentModel=e},onStartServices:function(){e.prototype.onStartServices.apply(this),this.selectTabHeader(this.currentTab),this.delegateModelEvents(),this.virtualDiskCollection&&!this.virtualDiskCollection.isPolling()&&this.virtualDiskCollection.startPolling()},onStopServices:function(){this.undelegateModelEvents(),this.virtualDiskCollection&&this.virtualDiskCollection.stopPolling(),this.subViewHelper.iterate("stopServices")},refreshData:function(){(this.virtualDiskCollection.attachedVMId||this.virtualDiskCollection.attachedVGId)&&this.virtualDiskCollection.fetch()},onClickOverRow:function(e){if(this.tabId!==s.TAB_DETAILS.VIRTUAL_DISKS_PERF){var t=this.$el.find(".dataTables_scrollBody");if(!t.hasClass("shrunk")){var i=t.height()/2,n=t.find(".detailsTable").height(),a=Math.min(i,n);t.addClass("shrunk").css("height",a)}this.$("."+this.tabDetailsClassName).show();var r=e.currentTarget;this.virtualDiskModel=this.dataTable.fnGetData(r),this.dataTable&&r&&(this.dataTable.$("tr.row_selected").removeClass("row_selected"),$(r).addClass("row_selected")),o.isMulticlusterNavMode()||this.refreshTabDetails()}},isOnStoragePage:function(){return l.getCurrentPageRoute()[s.NAV_PAGE_ID]===s.PAGE_STORAGE},getTabView:function(e){var t;return e===s.TAB_DETAILS.READ?t=new c({entityType:s.ENTITY_VIRTUAL_DISK,metrics:[a.getStatsProperty(s.METRIC_READ_IOPS,s.ENTITY_VIRTUAL_DISK),a.getStatsProperty(s.METRIC_READ_BANDWIDTH,s.ENTITY_VIRTUAL_DISK),a.getStatsProperty(s.METRIC_READ_LATENCY,s.ENTITY_VIRTUAL_DISK)]}):e===s.TAB_DETAILS.WRITE?t=new c({entityType:s.ENTITY_VIRTUAL_DISK,metrics:[a.getStatsProperty(s.METRIC_WRITE_IOPS,s.ENTITY_VIRTUAL_DISK),a.getStatsProperty(s.METRIC_WRITE_BANDWIDTH,s.ENTITY_VIRTUAL_DISK),a.getStatsProperty(s.METRIC_WRITE_LATENCY,s.ENTITY_VIRTUAL_DISK)]}):e===s.TAB_DETAILS.TOTAL&&(t=new c({entityType:s.ENTITY_VIRTUAL_DISK,metrics:[a.getStatsProperty(s.METRIC_IOPS,s.ENTITY_VIRTUAL_DISK),a.getStatsProperty(s.METRIC_BANDWIDTH,s.ENTITY_VIRTUAL_DISK),a.getStatsProperty(s.METRIC_LATENCY,s.ENTITY_VIRTUAL_DISK)]})),t},refreshTabDetails:function(){if(this.virtualDiskModel){var e=this.subViewHelper.get(this.currentTab);e.fetchOnDemand(this.virtualDiskModel[i.UUID]),e.$el.show(),e.startServices()}},renderVirtualDiskTable:function(){var e=this.virtualDiskCollection.toJSON({includeCustomAttributes:!0,includeStandardAttributes:!0});this.updateDataSource(e),this.virtualDiskModel&&this.selectRow(this.virtualDiskModel[i.ID])},getDefaultColumns:function(){var e=this,n=[{sTitle:e.i18n("virtual_disk"),mData:i.VIRTUAL_DISK_ID,sClass:"n-id",mRender:function(t,i,n){return e.renderVirtualDiskIdentifier(n)}},{sTitle:e.i18n("total_capacity"),mData:i.VIRTUAL_DISK_CAPACITY,sClass:"n-total-capacity",mRender:function(e,i,n){return t.renderStorageBinaryStats(e,i,n)}},{sTitle:e.i18n("physical_usage"),mData:i.STATS+"."+i.STATS_CONTROLLER_USER_BYTES,sClass:"n-usage",mRender:t.renderStorageBinaryStats},{sTitle:e.i18n("read_iops"),mData:i.STATS_CUSTOM_NUM_READ_IOPS,sClass:"n-iops",bSearchable:!1,mRender:function(t,i,n){return e.renderVirtualDiskStatsValue(s.METRIC_READ_IOPS,t,i,n,!1)}},{sTitle:e.i18n("read_bw"),mData:i.STATS_CUSTOM_READ_BANDWIDTH,sClass:"n-bandwidth",bSearchable:!1,mRender:function(t,i,n){return e.renderVirtualDiskStatsValue(s.METRIC_READ_BANDWIDTH,t,i,n,!0)}},{sTitle:e.i18n("read_latency"),mData:i.STATS_CUSTOM_AVG_READ_IO_LATENCY,bSearchable:!1,sClass:"n-latency",mRender:function(t,i,n){return e.renderVirtualDiskStatsValue(s.METRIC_READ_LATENCY,t,i,n,!0)}},{sTitle:e.i18n("write_iops"),mData:i.STATS_CUSTOM_NUM_WRITE_IOPS,sClass:"n-iops",bSearchable:!1,mRender:function(t,i,n){return e.renderVirtualDiskStatsValue(s.METRIC_WRITE_IOPS,t,i,n,!1)}},{sTitle:e.i18n("write_bw"),mData:i.STATS_CUSTOM_WRITE_BANDWIDTH,sClass:"n-bandwidth",bSearchable:!1,mRender:function(t,i,n){return e.renderVirtualDiskStatsValue(s.METRIC_WRITE_BANDWIDTH,t,i,n)}},{sTitle:e.i18n("write_latency"),mData:i.STATS_CUSTOM_AVG_WRITE_IO_LATENCY,sClass:"n-latency",bSearchable:!1,mRender:function(t,i,n){return e.renderVirtualDiskStatsValue(s.METRIC_WRITE_LATENCY,t,i,n)}}];this.isOnStoragePage()||n.push({sTitle:e.i18n("flash_mode"),mData:function(t,n,s){return t[i.FLASH_MODE_ENABLED]?e.i18n("enabled"):e.i18n("disabled")},sClass:"n-flash-mode",bSearchable:!0});var a=[{sTitle:e.i18n("virtual_disk"),mData:i.VIRTUAL_DISK_ID,sClass:"n-id",mRender:function(t,i,n){return e.renderVirtualDiskIdentifier(n)}},{sTitle:e.i18n("total_iops"),mData:i.STATS,sClass:"n-iops",bSearchable:!1,mRender:function(t,n,s){return e.renderVirtualDiskStatsValue(i.STATS_CTRLR_FRONTEND_OPS_PER_SEC,t[i.STATS_CTRLR_FRONTEND_OPS_PER_SEC],n,s,!1)}},{sTitle:e.i18n("random_io"),mData:i.STATS,sClass:"n-usage",bSearchable:!1,mRender:function(t,n,s){return e.renderVirtualDiskStatsValue(i.STATS_CTRLR_RANDOM_OPS_PPM,t[i.STATS_CTRLR_RANDOM_OPS_PPM],n,s,!0)}},{sTitle:e.i18n("read_source_cache"),mData:i.STATS,sClass:"n-bandwidth",bSearchable:!1,mRender:function(t,n,s){return e.renderReadSourceStats(i.STATS_CTRLR_READ_SRC_CACHE_BYTES_PER_SEC,t[i.STATS_CTRLR_READ_SRC_CACHE_BYTES_PER_SEC],n,s,!0)}},{sTitle:e.i18n("read_source_ssd"),mData:i.STATS,sClass:"n-bandwidth",bSearchable:!1,mRender:function(t,n,s){return e.renderReadSourceStats(i.STATS_CTRLR_READ_SRC_SSD_BYTES_PER_SEC,t[i.STATS_CTRLR_READ_SRC_SSD_BYTES_PER_SEC],n,s,!0)}},{sTitle:e.i18n("read_source_hdd"),mData:i.STATS,sClass:"n-bandwidth",bSearchable:!1,mRender:function(t,n,s){return e.renderReadSourceStats(i.STATS_CTRLR_READ_SRC_HDD_BYTES_PER_SEC,t[i.STATS_CTRLR_READ_SRC_HDD_BYTES_PER_SEC],n,s,!0)}},{sTitle:e.i18n("read_working_set_size"),mData:i.STATS,sClass:"n-usage",bSearchable:!1,mRender:function(t,n,s){var a=t[i.STATS_CTRLR_WSS_120SECS_READ_MB];return e.renderWSSSize(a)}},{sTitle:e.i18n("write_working_set_size"),mData:i.STATS,sClass:"n-usage",bSearchable:!1,mRender:function(t,n,s){var a=t[i.STATS_CTRLR_WSS_120SECS_WRITE_MB];return e.renderWSSSize(a)}},{sTitle:e.i18n("union_working_set_size"),mData:i.STATS,sClass:"n-usage",bSearchable:!1,mRender:function(t,n,s){var a=t[i.STATS_CTRLR_WSS_120SECS_UNION_MB];return e.renderWSSSize(a)}}];return this.tabId===s.TAB_DETAILS.VIRTUAL_DISKS_PERF?a:n},renderVirtualDiskIdentifier:function(e){return e[i.VIRTUAL_DISK_ADDRESS]||e[i.VIRTUAL_DISK_NFS_FILE_PATH]},renderReadSourceStats:function(e,t,i,n,r){return a.isValidStats(t)?this.renderVirtualDiskStatsValue(e,t/a.STORAGE_BINARY_UOM.KiB,i,n,r):s.STATS_NOT_AVAILABLE},renderVirtualDiskStatsValue:function(e,t,i,n,r){return i===s.TABLE_COL_TYPE_DISPLAY||i===s.TABLE_COL_TYPE_EXPORT?a.statsFormat(e,t,r):t},renderWSSSize:function(e){return a.isValidStats(e)?a.storageFormat(a.convertToBytes(e,a.UOM_MB,!0)):s.STATS_NOT_AVAILABLE}})}),define("views/details/tabs/VirtualDiskTabContentDetailsView",["views/basecomponents/details/tabs/BaseTabContentDetailsView","views/basecomponents/datatables/virtualdisk/VirtualDiskTableView","utils/AppConstants","utils/AppUtil"],function(e,t,i,n){"use strict";return e.extend({tableView:null,entityType:i.ENTITY_VIRTUAL_DISK,initializeProperties:function(e){this.tableView=new t({entityType:i.ENTITY_VIRTUAL_DISK,pageId:e.pageId,tabId:e.tabId})},render:function(){return this.$el.append(this.tableView.render().el),this},postSetModelId:function(t){e.prototype.postSetModelId.apply(this,arguments),this.tableView&&this.tableView.setModelId(t)},destroy:function(){n.debug("VirtualDiskTabContentDetailsView : destroy: "," | viewid     : "+this.cid),this.tableView&&this.tableView.destroy(),e.prototype.destroy.apply(this,arguments)},setModel:function(e){this.tableView&&_.isFunction(this.tableView.setModel)&&this.tableView.setModel(e)},onStartServices:function(){this.tableView&&this.tableView.startServices(),this.delegateEvents()},onStopServices:function(){this.tableView&&this.tableView.stopServices(),this.undelegateEvents()}})}),define("views/details/tabs/VirtualDiskTabContentWrapperView",["views/basecomponents/details/tabs/BaseTabContentDetailsView","utils/VisualizationUtil","utils/AppConstants"],function(e,t,i){"use strict";return e.extend({name:"VirtualDiskTabContentWrapperView",render:function(){var e={};return e[i.TAB_DETAILS.VIRTUAL_DISKS]=this.i18n("default"),e[i.TAB_DETAILS.VIRTUAL_DISKS_PERF]=this.i18n("additional_stats"),this.tabDetailsView=t.renderTabDetailsView(this.$el,e,i.ENTITY_VIRTUAL_DISK,null,"subtab"),this},setModelId:function(e){this.tabDetailsView.setModelId(e)},setModel:function(e){this.tabDetailsView.setModel(e)},onStartServices:function(){this.tabDetailsView.hasTabSelected()||this.tabDetailsView.selectFirstTab()}})}),define("models/switch/VirtualNicModel",["models/PollingModel","data/DataURLConstants","data/DataProperties","utils/AppConstants","utils/StatsUtil"],function(e,t,i,n,s){"use strict";return e.extend({idAttribute:i.VIRTUAL_NIC_ID,urlRoot:t.VIRTUAL_NIC,entityType:n.ENTITY_VIRTUAL_NIC,name:"VirtualNicModel",defaults:{id:null,name:null,adapterType:null,vlanId:null,macAddress:null,ipv4Addresses:[],ipv6Addresses:[],mtuInBytes:null,hostNicIds:[]},toJSON:function(t){var n=e.prototype.toJSON.apply(this,arguments);return t&&t.includeCustomAttributes&&(n[i.STATS_NETWORK_TOTAL_RECEIVED_PACKETS]=this.getValue(i.STATS_NETWORK_TOTAL_RECEIVED_PACKETS),n[i.STATS_NETWORK_TOTAL_TRANSMITTED_PACKETS]=this.getValue(i.STATS_NETWORK_TOTAL_TRANSMITTED_PACKETS),n[i.STATS_NETWORK_DROPPED_RECEIVED_PACKETS]=this.getValue(i.STATS_NETWORK_DROPPED_RECEIVED_PACKETS),n[i.STATS_NETWORK_DROPPED_TRANSMITTED_PACKETS]=this.getValue(i.STATS_NETWORK_DROPPED_TRANSMITTED_PACKETS),n[i.STATS_NETWORK_ERROR_RECEIVED_PACKETS]=this.getValue(i.STATS_NETWORK_ERROR_RECEIVED_PACKETS),n[i.STATS_NETWORK_ERROR_RECEIVED_PACKETS]=this.getValue(i.STATS_NETWORK_ERROR_TRANSMITTED_PACKETS)),n},getValue:function(t){switch(t){case i.STATS_NETWORK_TOTAL_RECEIVED_PACKETS:return this.getStatValue(n.METRIC_TOTAL_RECEIVED_PACKETS);case i.STATS_NETWORK_TOTAL_TRANSMITTED_PACKETS:return this.getStatValue(n.METRIC_TOTAL_TRANSMITTED_PACKETS);case i.STATS_NETWORK_DROPPED_RECEIVED_PACKETS:return this.getStatValue(n.METRIC_DROPPED_RECEIVED_PACKETS);case i.STATS_NETWORK_DROPPED_TRANSMITTED_PACKETS:return this.getStatValue(n.METRIC_DROPPED_TRANSMITTED_PACKETS);case i.STATS_NETWORK_ERROR_RECEIVED_PACKETS:return this.getStatValue(n.METRIC_ERROR_RECEIVED_PACKETS);case i.STATS_NETWORK_ERROR_TRANSMITTED_PACKETS:return this.getStatValue(n.METRIC_ERROR_TRANSMITTED_PACKETS);default:return e.prototype.getValue.apply(this,arguments)}},getStatValue:function(e){var t=this.get(i.STATS),a=t[s.getStatsProperty(e,n.ENTITY_VIRTUAL_NIC,!1)];return void 0===a?0:a}})}),define("models/switch/VirtualNicCollection",["models/PollingCollection","models/switch/VirtualNicModel","data/DataURLConstants"],function(e,t,i){"use strict";return e.extend({model:t,url:i.VIRTUAL_NIC,attachedVMId:null,name:"VirtualNicCollection",setVmId:function(e){this.attachedVMId=e,this.url=i.VM+"/"+this.attachedVMId+"/"+i.VIRTUAL_NIC}})}),define("models/switch/PhysicalNicModel",["models/PollingModel","data/DataURLConstants","data/DataProperties","utils/AppConstants","utils/StatsUtil"],function(e,t,i,n,s){"use strict";return e.extend({idAttribute:i.PHYSICAL_NIC_ID,urlRoot:t.PHYSICAL_NIC,entityType:n.ENTITY_PHYSICAL_NIC,name:"PhysicalNicModel",defaults:{id:null,name:null,macAddress:null,ipv4Addresses:[],ipv6Addresses:[],linkSpeedInKbps:null,mtuInBytes:null,discoveryProtocol:null,switchDeviceId:null,switchPortId:null,switchVendorInfo:null,switchVlanId:null,switchManagementIp:null,attachedSwitchInterfaceIds:[]},toJSON:function(t){var n=e.prototype.toJSON.apply(this,arguments);return t&&t.includeCustomAttributes&&(n[i.STATS_NETWORK_TOTAL_RECEIVED_PACKETS]=this.getValue(i.STATS_NETWORK_TOTAL_RECEIVED_PACKETS),n[i.STATS_NETWORK_TOTAL_TRANSMITTED_PACKETS]=this.getValue(i.STATS_NETWORK_TOTAL_TRANSMITTED_PACKETS),n[i.STATS_NETWORK_DROPPED_RECEIVED_PACKETS]=this.getValue(i.STATS_NETWORK_DROPPED_RECEIVED_PACKETS),n[i.STATS_NETWORK_DROPPED_TRANSMITTED_PACKETS]=this.getValue(i.STATS_NETWORK_DROPPED_TRANSMITTED_PACKETS),n[i.STATS_NETWORK_ERROR_RECEIVED_PACKETS]=this.getValue(i.STATS_NETWORK_ERROR_RECEIVED_PACKETS),n[i.STATS_NETWORK_ERROR_TRANSMITTED_PACKETS]=this.getValue(i.STATS_NETWORK_ERROR_TRANSMITTED_PACKETS)),n},getValue:function(t){switch(t){case i.STATS_NETWORK_TOTAL_RECEIVED_PACKETS:return this.getStatValue(n.METRIC_TOTAL_RECEIVED_PACKETS);case i.STATS_NETWORK_TOTAL_TRANSMITTED_PACKETS:return this.getStatValue(n.METRIC_TOTAL_TRANSMITTED_PACKETS);case i.STATS_NETWORK_DROPPED_RECEIVED_PACKETS:return this.getStatValue(n.METRIC_DROPPED_RECEIVED_PACKETS);case i.STATS_NETWORK_DROPPED_TRANSMITTED_PACKETS:return this.getStatValue(n.METRIC_DROPPED_TRANSMITTED_PACKETS);case i.STATS_NETWORK_ERROR_RECEIVED_PACKETS:return this.getStatValue(n.METRIC_ERROR_RECEIVED_PACKETS);case i.STATS_NETWORK_ERROR_TRANSMITTED_PACKETS:return this.getStatValue(n.METRIC_ERROR_TRANSMITTED_PACKETS);default:return e.prototype.getValue.apply(this,arguments)}},getStatValue:function(e){var t=this.get(i.STATS),a=t[s.getStatsProperty(e,n.ENTITY_VIRTUAL_NIC,!1)];return void 0===a?0:a}})});define("models/switch/PhysicalNicCollection",["models/PollingCollection","models/switch/PhysicalNicModel","data/DataURLConstants"],function(e,t,i){"use strict";return e.extend({model:t,url:i.PHYSICAL_NIC,attachedHostId:null,name:"PhysicalNicCollection",setHostId:function(e){this.attachedHostId=e,this.url=i.HOST+"/"+this.attachedHostId+"/"+i.PHYSICAL_NIC}})}),define("models/network/AcropolisNicCollection",["models/PollingCollection","models/network/AcropolisNicModel","data/DataManager","managers/acropolis/AcropolisNetworkManager","data/DataURLConstants","utils/AppConstants"],function(e,t,i,n,s,a){"use strict";var r=_.template(s.MGMT_VM_NICS);return e.extend({model:t,url:s.MGMT_VM,attachedVMId:null,name:"AcropolisNicCollection",fetch:function(t){return t=t||{},t.data={includeAddressAssignments:!0},e.prototype.fetch.apply(this,[t])},getDataSourceURL:function(){return i.getNutanixApiDataSourceURL()},setVmId:function(e){this.attachedVMId=e,this.url=r({entityId:this.attachedVMId})},toJSON:function(e){var i=[];switch(this.actionMode){case a.ACTION_CLONE:i[t.DP.OVERRIDE_CONFIG]=!0;case a.ACTION_CREATE:i[t.DP.NICS]=[],this.each(function(e){e.actionMode=this.actionMode;var n=e.toJSON();i[t.DP.NICS]=i[t.DP.NICS].concat(n[t.DP.SPEC_LIST])},this);break;default:var s=n.getNetworkCollection();this.each(function(n,a){var r=n.toJSON(e),o=s.findModelById(n.get(t.DP.NETWORK_UUID));o&&(r.network=o.toJSON(e)),r.index=a,i.push(r)},this)}return i}})}),define("text!templates/pages/vms/details/VirtualNicTabDetailsEntityView.html",[],function(){return'<div class="n-virtual-nic-metrics">\n  \x3c!-- @view: Tab details view goes here... --\x3e\n</div>\n'}),
define("views/basecomponents/datatables/switch/VirtualNicTableView",["views/basecomponents/BaseView","views/basecomponents/datatables/DetailsTableView","views/basecomponents/datatables/DataTableColumnProvider","data/DataProperties","models/switch/VirtualNicCollection","models/switch/PhysicalNicCollection","models/vm/VMCollection","models/network/AcropolisNicCollection","utils/AppConstants","utils/VisualizationUtil","utils/StatsUtil","utils/HypervisorUtil","utils/AppUtil","managers/ClusterManager","views/basecomponents/charts/groups/MetricGroupChartView","text!templates/pages/vms/details/VirtualNicTabDetailsEntityView.html"],function(e,t,i,n,s,a,r,o,l,c,u,d,h,p,T,E){"use strict";var S={get:function(e){this.templates||(this.templates={});var t=this.templates[e];return t||(t=_.template(e),this.templates[e]=t),t}},g={};g[l.TAB_DETAILS.VIRTUAL_NIC_STATS]="Virtual NICs Stats",g[l.TAB_DETAILS.PHYSICAL_NIC_STATS]="Host NICs Stats",g[l.TAB_DETAILS.PHYSICAL_SWITCH_INTERFACE_STATS]="Physical Switch Interface Stats";var A=e.extend({render:function(){return this.$el.html('<div class="n-borderless-message">Displaying '+this.options.tabName+" is currently not supported with Hyper-V clusters.</div>"),e.prototype.render.apply(this,arguments)}});return t.extend({className:"n-virtual-nic-table",virtualNicCollection:null,physicalNicCollection:null,vmCollection:null,acropolisNicCollection:null,nicConnectionMap:null,virtualNicModel:null,currentTab:l.TAB_DETAILS.VIRTUAL_NIC_STATS,modelEvents:{"reset  virtualNicCollection":"renderVirtualNicTable","reset  vmCollection        ":"fetchPhysicalNics","reset acropolisNicCollection":"updateNicConnectionMap"},attachRowTargetId:!0,events:{"click .n-virtual-nic-metrics .detailsTable tbody > tr":"ignoreClick","click .n-virtual-nic-table .detailsTable tbody > tr":"onClickOverRow","click .n-virtual-nic-table .n-tab-details-button":"onClickMetricTab"},initialize:function(e){t.prototype.initialize.apply(this,arguments),this.tabContents={},this.nicConnectionMap={},this.columns=null,this.initializeCollections(),this.initializeColumnsForTable(),this.delegateModelEvents()},initializeCollections:function(){this.virtualNicCollection=new s,this.virtualNicCollection.setProjection([l.PROJECTION.STATS]),this.physicalNicCollection=new a,this.physicalNicCollection.setProjection([l.PROJECTION.STATS]),this.vmCollection=new r,this.vmCollection.setProjection([l.PROJECTION.STATS])},initializeColumnsForTable:function(){var e=this;this.columns=[{sTitle:"Port Name",mData:n.VIRTUAL_NIC_NAME,sClass:"n-name",mRender:function(t,i,n){return e.formatPortName(t,i,n)}},{sTitle:"Adapter Type",mData:n.VIRTUAL_NIC_ADAPTER_TYPE,sClass:"n-adaptor-type"},{sTitle:"MAC Address",mData:n.VIRTUAL_NIC_MAC_ADDRESS,sClass:"n-mac-address"},{sTitle:"IPv4 Addresses",mData:n.VIRTUAL_NIC_IPV4_ADDRESSES,sClass:"n-ipv4-address",mRender:function(e,t,i){return e?e.join(", "):"&nbsp;"}},{sTitle:"IPv6 Addresses",mData:n.VIRTUAL_NIC_IPV6_ADDRESSES,sClass:"n-ipv6-address",mRender:function(e,t,i){return e?e.join(", "):"&nbsp;"}}],d.hasHyperVOnly()||(this.columns=this.columns.concat([{sTitle:"Rx Pkts",mData:function(e,t,i){return e[n.STATS_NETWORK_TOTAL_RECEIVED_PACKETS]},sClass:"n-total-packets-received",mRender:function(t,i,n){return e.formatStatsValue(l.METRIC_TOTAL_RECEIVED_PACKETS,t,i,n,!1)}},{sTitle:"Tx Pkts",mData:function(e,t,i){return e[n.STATS_NETWORK_TOTAL_TRANSMITTED_PACKETS]},sClass:"n-total-packets-transmitted",mRender:function(t,i,n){return e.formatStatsValue(l.METRIC_TOTAL_TRANSMITTED_PACKETS,t,i,n,!1)}},{sTitle:"Dropped Rx Pkts",mData:function(e,t,i){return e[n.STATS_NETWORK_DROPPED_RECEIVED_PACKETS]},sClass:"n-dropped-packets-received",mRender:function(t,i,n){return e.formatStatsValue(l.METRIC_DROPPED_RECEIVED_PACKETS,t,i,n,!1)}},{sTitle:"Dropped Tx Pkts",mData:function(e,t,i){return e[n.STATS_NETWORK_DROPPED_TRANSMITTED_PACKETS]},sClass:"n-dropped-packets-transmitted",mRender:function(t,i,n){return e.formatStatsValue(l.METRIC_DROPPED_TRANSMITTED_PACKETS,t,i,n,!1)}}])),this.physicalNicStatsTable=new t({scrollHeight:"290px",minimumRows:4,columns:[{sTitle:"Host Nic",mData:n.PHYSICAL_NIC_NAME,sWidth:"20%"},{sTitle:"Speed (in Kbps)",mData:n.PHYSICAL_NIC_LINK_SPEED,sWidth:"10%"},{sTitle:"MAC Address",mData:n.PHYSICAL_NIC_MAC_ADDRESS,sWidth:"10%"},{sTitle:"Rx Pkts",mData:function(e,t,i){return e[n.STATS_NETWORK_TOTAL_RECEIVED_PACKETS]},sWidth:"10%",mRender:function(t,i,n){return e.formatStatsValue(l.METRIC_TOTAL_RECEIVED_PACKETS,t,i,n,!1)}},{sTitle:"Tx Pkts",mData:function(e,t,i){return e[n.STATS_NETWORK_TOTAL_TRANSMITTED_PACKETS]},sWidth:"10%",mRender:function(t,i,n){return e.formatStatsValue(l.METRIC_TOTAL_TRANSMITTED_PACKETS,t,i,n,!1)}},{sTitle:"Dropped Rx Pkts",mData:function(e,t,i){return e[n.STATS_NETWORK_DROPPED_RECEIVED_PACKETS]},sWidth:"10%",sClass:"n-dropped-packets-received",mRender:function(t,i,n){return e.formatStatsValue(l.METRIC_DROPPED_RECEIVED_PACKETS,t,i,n,!1)}},{sTitle:"Dropped Tx Pkts",mData:function(e,t,i){return e[n.STATS_NETWORK_DROPPED_TRANSMITTED_PACKETS]},sWidth:"10%",sClass:"n-dropped-packets-transmitted",mRender:function(t,i,n){return e.formatStatsValue(l.METRIC_DROPPED_TRANSMITTED_PACKETS,t,i,n,!1)}},{sTitle:"Rx Pkt Errors",mData:function(e,t,i){return e[n.STATS_NETWORK_ERROR_RECEIVED_PACKETS]},sWidth:"10%",sClass:"n-rx-error",mRender:function(t,i,n){return e.formatStatsValue(l.METRIC_ERROR_RECEIVED_PACKETS,t,i,n,!1)}},{sTitle:"Tx Pkt Errors",mData:function(e,t,i){return e[n.STATS_NETWORK_ERROR_TRANSMITTED_PACKETS]},sWidth:"10%",sClass:"n-tx-rate",mRender:function(t,i,n){return e.formatStatsValue(l.METRIC_ERROR_TRANSMITTED_PACKETS,t,i,n,!1)}}]}),this.physicalSwitchInterfaceStatsTable=new t({scrollHeight:"290px",minimumRows:4,columns:i.getDataColumns(l.ENTITY_PHYSICAL_SWITCH_INTERFACE)})},updateNicConnectionMap:function(){this.acropolisNicCollection.each(function(e){var t=e.get(n.VIRTUAL_NIC_MAC_ADDRESS),i=e.get(n.VIRTUAL_NIC_IS_CONNECTED);_.isBoolean(i)&&(this.nicConnectionMap[t]=i)},this)},updateConnectionState:function(){this.virtualNicCollection.each(function(e){var t=e.get(n.VIRTUAL_NIC_MAC_ADDRESS);this.nicConnectionMap&&this.nicConnectionMap[t]&&e.set(n.VIRTUAL_NIC_IS_CONNECTED,this.nicConnectionMap[t])},this)},render:function(){t.prototype.render.apply(this,arguments);var e=S.get(E);return this.$el.append(e),this},renderMetricsView:function(){c.renderTabDetailsView(this.$(".n-virtual-nic-metrics"),g,this.entityType,l.PAGE_VMS,"n-virtual-nic-tabs"),this.renderVirtualNicTab(),this.renderPhysicalNicTab(),this.renderPhysicalSwitchTab(),this.$(".n-virtual-nic-metrics").hide()},renderVirtualNicTab:function(){d.hasHyperVOnly(this.getCurrentClusterUUID())?this.subViewHelper.register(l.TAB_DETAILS.VIRTUAL_NIC_STATS,new A({tabName:g[l.TAB_DETAILS.VIRTUAL_NIC_STATS]})):this.subViewHelper.register(l.TAB_DETAILS.VIRTUAL_NIC_STATS,new T({entityType:l.ENTITY_VIRTUAL_NIC,entityParentType:l.ENTITY_VM,entityParentId:this.virtualNicCollection.attachedVMId,metrics:[u.getStatsProperty(n.STATS_NETWORK_RECEIVED_RATE,l.ENTITY_VIRTUAL_NIC),u.getStatsProperty(n.STATS_NETWORK_TRANSMITTED_RATE,l.ENTITY_VIRTUAL_NIC),u.getStatsProperty(n.STATS_NETWORK_DROPPED_RECEIVED_PACKETS,l.ENTITY_VIRTUAL_NIC),u.getStatsProperty(n.STATS_NETWORK_DROPPED_TRANSMITTED_PACKETS,l.ENTITY_VIRTUAL_NIC),u.getStatsProperty(n.STATS_NETWORK_ERROR_RECEIVED_PACKETS,l.ENTITY_VIRTUAL_NIC)]})),this.tabContents[l.TAB_DETAILS.VIRTUAL_NIC_STATS]=this.subViewHelper.get(l.TAB_DETAILS.VIRTUAL_NIC_STATS).render().el},renderPhysicalNicTab:function(){this.subViewHelper.register(l.TAB_DETAILS.PHYSICAL_NIC_STATS,this.physicalNicStatsTable),this.tabContents[l.TAB_DETAILS.PHYSICAL_NIC_STATS]=this.subViewHelper.get(l.TAB_DETAILS.PHYSICAL_NIC_STATS).render().el},renderPhysicalSwitchTab:function(){d.hasHyperVOnly(this.getCurrentClusterUUID())?this.subViewHelper.register(l.TAB_DETAILS.PHYSICAL_SWITCH_INTERFACE_STATS,new A({tabName:g[l.TAB_DETAILS.PHYSICAL_SWITCH_INTERFACE_STATS]})):this.subViewHelper.register(l.TAB_DETAILS.PHYSICAL_SWITCH_INTERFACE_STATS,this.physicalSwitchInterfaceStatsTable),this.tabContents[l.TAB_DETAILS.PHYSICAL_SWITCH_INTERFACE_STATS]=this.subViewHelper.get(l.TAB_DETAILS.PHYSICAL_SWITCH_INTERFACE_STATS).render().el},getCurrentClusterUUID:function(){return this.virtualNicCollection&&this.virtualNicCollection.attachedVMId?h.getClusterUuid(this.virtualNicCollection.attachedVMId):null},setModelId:function(e){if(this.virtualNicCollection.setVmId(e),d.isAcropolisEnabled()&&!p.isMulticlusterNavMode()){var t=this.getCurrentClusterUUID();if(t){p.getClusterModelByClusterUuid(t).isNicDisconnectSupported()&&(this.acropolisNicCollection=new o,this.acropolisNicCollection.setVmId(e))}}this.refreshData(),p.isMulticlusterNavMode()||this.renderMetricsView(),this.$(".n-virtual-nic-metrics").hide()},onStartServices:function(){t.prototype.onStartServices.apply(this,arguments),this.selectMetricTab(this.currentTab),this.delegateModelEvents(),this.virtualNicCollection&&!this.virtualNicCollection.isPolling()&&this.virtualNicCollection.startPolling(),this.acropolisNicCollection&&!this.acropolisNicCollection.isPolling()&&this.acropolisNicCollection.startPolling()},onStopServices:function(){t.prototype.onStopServices.apply(this,arguments),this.undelegateModelEvents(),this.virtualNicCollection&&this.virtualNicCollection.stopPolling(),this.acropolisNicCollection&&this.acropolisNicCollection.stopPolling(),this.subViewHelper.iterate("stopServices")},refreshData:function(){if(this.vmCollection.fetch(),this.virtualNicCollection&&this.virtualNicCollection.attachedVMId)if(this.acropolisNicCollection&&this.acropolisNicCollection.attachedVMId){var e=this;this.acropolisNicCollection.fetch({force:!0}).done(function(){e.virtualNicCollection.attachedVMId&&e.virtualNicCollection.fetch({force:!0})})}else this.virtualNicCollection.fetch({force:!0});this.physicalNicCollection.attachedHostId&&this.physicalNicCollection.fetch()},onClickOverRow:function(e){var t=e.currentTarget;this.virtualNicModel=this.dataTable.fnGetData(t),this.dataTable&&t&&this.virtualNicModel&&(this.$(".n-virtual-nic-metrics").show(),this.dataTable.$("tr.row_selected").removeClass("row_selected"),$(t).addClass("row_selected"),p.isMulticlusterNavMode()||this.refreshCharts())},onClickMetricTab:function(e){var t=e.currentTarget.getAttribute("data-target");return t&&(this.subViewHelper.get(this.currentTab).stopServices(),this.currentTab=t),this.refreshCharts(),!1},ignoreClick:function(e){e.stopImmediatePropagation()},selectMetricTab:function(e){var t=this.$(".n-virtual-nic-metrics .n-tab-details-button");return _.each(t,function(t){$(t).attr("data-target")===e?$(t).addClass("active"):$(t).removeClass("active")},this),!1},refreshCharts:function(){var e=this.subViewHelper.get(this.currentTab);if(!(e instanceof A))switch(this.currentTab){case l.TAB_DETAILS.VIRTUAL_NIC_STATS:e.fetchOnDemand(this.virtualNicModel[n.VIRTUAL_NIC_ID],l.ENTITY_VIRTUAL_NIC,this.virtualNicCollection.attachedVMId,l.ENTITY_VM);break;case l.TAB_DETAILS.PHYSICAL_NIC_STATS:var t=this.extractStats(this.virtualNicModel[n.VIRTUAL_NIC_HOST_NICS]);this.subViewHelper.get(this.currentTab).updateDataSource(t);break;case l.TAB_DETAILS.PHYSICAL_SWITCH_INTERFACE_STATS:var i=this.extractSwitchInterfaces(this.virtualNicModel[n.VIRTUAL_NIC_HOST_NICS]);this.subViewHelper.get(this.currentTab).updateDataSource(i)}this.$(".n-virtual-nic-metrics .n-tab-details-body").html(this.tabContents[this.currentTab]),this.selectMetricTab(this.currentTab),e.startServices()},renderVirtualNicTable:function(){this.updateConnectionState(),this.updateDataSource(this.virtualNicCollection.toJSON({includeCustomAttributes:!0})),this.virtualNicModel&&this.selectRow(this.virtualNicModel[n.ID])},formatStatsValue:function(e,t,i,n,s){return i===l.TABLE_COL_TYPE_DISPLAY||i===l.TABLE_COL_TYPE_EXPORT?u.statsFormat(e,t,s):t},formatPortName:function(e,t,i){var s=i[n.VIRTUAL_NIC_IS_CONNECTED];return _.isBoolean(s)?s?'<a title="'+this.i18nStatic("VmNicFormView","connected")+'"\n              class="n-vm-state-icon n-on"></a> '+e:'<a title="'+this.i18nStatic("VmNicFormView","dis_connected")+'" class="n-vm-state-icon n-suspended"></a>'+e:e},fetchPhysicalNics:function(){var e=this.virtualNicCollection.attachedVMId;this.vmModel=this.vmCollection.get(e),this.physicalNicCollection.setHostId(this.vmModel.get(n.VM_HOST_ID)),this.physicalNicCollection.fetch()},extractStats:function(e){for(var t=_.clone(e),i=0;i<e.length;i++){var s=e[i][n.VIRTUAL_NIC_STATS];for(var a in s)e[i][a]=s[a]}return t},extractSwitchInterfaces:function(e){for(var t={},i=0;i<e.length;i++){var s=e[i][n.VIRTUAL_NIC_SWITCH_INTERFACES];for(var a in s)a in t||(t[a]=this.extractStats(s[a]))}var r=[];for(var o in t)for(var l=0;l<t[o].length;l++)r.push(t[o][l]);return r}})}),define("views/details/tabs/VirtualNicTabContentDetailsView",["views/basecomponents/details/tabs/BaseTabContentDetailsView","views/basecomponents/datatables/switch/VirtualNicTableView","utils/AppConstants","utils/AppUtil"],function(e,t,i,n){"use strict";return e.extend({tableView:null,entityType:i.ENTITY_VIRTUAL_NIC,initializeProperties:function(e){this.tableView=new t({entityType:i.ENTITY_VIRTUAL_NIC,pageId:e.pageId})},render:function(){return this.$el.append(this.tableView.render().el),this},postSetModelId:function(t){e.prototype.postSetModelId.apply(this,arguments),this.tableView&&this.tableView.setModelId(t)},destroy:function(){n.debug("VirtualNicTabContentDetailsView : destroy: "," | viewid     : "+this.cid),this.tableView&&this.tableView.destroy(),e.prototype.destroy.apply(this,arguments)},onStartServices:function(){this.tableView&&this.tableView.startServices(),this.delegateEvents()},onStopServices:function(){this.tableView&&this.tableView.stopServices(),this.undelegateEvents()}})}),define("views/basecomponents/charts/simple/TierWiseChartView",["flotr2","views/basecomponents/charts/BaseChartView","views/basecomponents/charts/ChartTemplates","models/cluster/ClusterModel","models/storage/StoragePoolModel","models/storage/ContainerModel","models/hardware/HostModel","data/DataProperties","utils/AppConstants","utils/AppUtil","utils/StatsUtil"],function(e,t,i,n,s,a,r,o,l,c,u){"use strict";return t.extend({name:"TierWiseChartView",initialize:function(e){t.prototype.initialize.apply(this,arguments)},initializeStatsProperties:function(e){switch(this.title="Tier-Wise Usage",this.entityType){case l.ENTITY_CLUSTER:this.clusterManager.isMulticlusterNavMode()?(this.model=new n,this.model.setProjection([l.PROJECTION.BASIC_INFO])):this.model=this.clusterManager.getCurrentClusterModel(),this.model.alwaysTriggerChange=!0,this.model.on("change",this.renderIfMultipleTiers,this);break;case l.ENTITY_STORAGE_POOL:this.model=new s,this.model.on("change",this.renderIfMultipleTiers,this);break;case l.ENTITY_CONTAINER:this.model=new a,this.clusterManager.isMulticlusterNavMode()&&this.model.setProjection([l.PROJECTION.BASIC_INFO]),this.model.on("change",this.renderIfMultipleTiers,this);break;case l.ENTITY_HOST:this.model=new r,this.clusterManager.isMulticlusterNavMode()&&this.model.setProjection([l.PROJECTION.BASIC_INFO]),this.model.on("change",this.renderIfMultipleTiers,this)}this.model&&(this.model.on("error",this.showNoData,this),this.model.on("pending",this.showLoading,this))},render:function(){return this.$el.html(i.TIERWISE({title:this.title})),this},getDataAndRender:function(e){this.model&&(e&&(this.entityId=e,this.model.id=this.entityId),this.model.fetch({alwaysTriggerPending:!0,alwaysTriggerChange:!0}))},renderIfMultipleTiers:function(){if(this.model.getState()===l.STATE_SUCCESS)switch(this.entityType){case l.ENTITY_CLUSTER:case l.ENTITY_STORAGE_POOL:case l.ENTITY_HOST:var e=this.getNumberOfTier(this.model);e>1?this.renderChart():1===e?this.showSingleTier(this.model):this.showNoData();break;case l.ENTITY_CONTAINER:var t=new s({id:this.model.get(o.STORAGE_POOL_ID)}),i=this;t.fetch().done(function(){var e=i.getNumberOfTier(t);e?i.renderChart():1===e?i.showSingleTier(t):i.showNoData()}).fail(function(){i.renderChart()})}},showSingleTier:function(e){var t,i=e.getPerTierStats();for(var n in i){(i[n][o.TIER_CAPACITY_BYTES]||0)>0&&(t=n)}var s=l.ENTITY_NAMES[this.entityType].toLowerCase();this.getDOM(".singleTierMessage").html(this.i18ns("msgSingleTier",s,t)),this.getDOM(".loading").hide(),this.getDOM(".noDataBody").hide(),this.getDOM(".chartBody").hide(),this.getDOM(".chartValue").hide(),this.getDOM(".singleTierBody").show()},showNoData:function(){t.prototype.showNoData.apply(this,arguments),this.getDOM(".singleTierBody").hide()},showChart:function(){t.prototype.showChart.apply(this,arguments),this.getDOM(".singleTierBody").hide()},showLoading:function(){t.prototype.showLoading.apply(this,arguments),this.getDOM(".singleTierBody").hide()},getNumberOfTier:function(e){var t=e.getPerTierStats(),i=0;for(var n in t){(t[n][o.TIER_CAPACITY_BYTES]||0)>0&&(i+=1)}return i},renderChart:function(){var t=this.getTierUsageData();if(!t)return void this.showNoData();this.showChart();var i=this.getChartContainer();i&&!i.clientWidth||(this.graph=e.draw(i,t,{colors:["#fdc000","#f37028","#0066dd","#d81d23"],shadowSize:0,grid:{color:"#999",verticalLines:!1,horizontalLines:!1,outlineWidth:0},xaxis:{showLabels:!1},yaxis:{showLabels:!1},pie:{show:!0},mouse:{track:!0,relative:!0,trackFormatter:this.toolTipTrackFormatter},legend:{position:"sw",backgroundColor:"#dedede",color:"#333"}}))},getTierUsageData:function(){var e,t;if(e=t=null,e=this.model.getPerTierStats()){t=[];var i=0;for(var n in e){var s=e[n][o.TIER_USED_BYTES]||0;e[n][o.TIER_CAPACITY_BYTES];t.push({data:[[n,s]],label:n}),i+=s}if(i<=0)return null}return t},toolTipTrackFormatter:function(e){return e.x+" <br /> "+u.storageFormat(e.y)},destroy:function(){c.debug("TierWiseChartView : destroy: "," | viewid     : "+this.cid),this.model.off(),t.prototype.destroy.apply(this,arguments)}})}),define("views/basecomponents/charts/groups/UsageGroupChartView",["data/DataProperties","views/basecomponents/charts/BaseGroupChartView","views/basecomponents/charts/simple/TimelineChartView","views/basecomponents/charts/simple/TierWiseChartView","utils/AppConstants"],function(e,t,i,n,s){"use strict";return t.extend({summaryUsageChart:null,tierUsageChart:null,initializeStatsProperties:function(t){t.entityType&&(this.entityType=t.entityType),t.entityId&&(this.entityId=t.entityId),this.isClusterFFEnabled(s.FFLAGS.ARITHMOS_USAGE_STATS)?this.entityType===s.ENTITY_CONTAINER?this.metrics=[e.NEW_CONTAINER_OWN_USAGE_LOGICAL]:this.metrics=[e.NEW_STATS_TRANSFORMED_USAGE]:this.metrics=[e.STATS_TRANSFORMED_USAGE]},render:function(){return this.summaryUsageChart=new i({metricType:s.METRIC_USAGE_SUMMARY,entityType:this.entityType}),this.$el.append(this.summaryUsageChart.render().el),this.entityType!==s.ENTITY_DISK&&(this.tierUsageChart=new n({metricType:s.METRIC_USAGE_TIER,entityType:this.entityType,entityId:this.entityId}),this.$el.append(this.tierUsageChart.render().el),this.subViewHelper.register("tierUsageChart",this.tierUsageChart)),this.subViewHelper.register("summaryUsageChart",this.summaryUsageChart),this},updateStatsCharts:function(){this.summaryUsageChart&&this.summaryUsageChart.updateChartData(this.statsModel)},showLoadingState:function(){this.summaryUsageChart&&this.summaryUsageChart.showLoading()},onStartServices:function(){t.prototype.onStartServices.apply(this,arguments),this.tierUsageChart&&this.tierUsageChart.getDataAndRender(this.entityId)},fetchOnDemand:function(e){t.prototype.fetchOnDemand.apply(this,arguments),this.tierUsageChart&&this.tierUsageChart.getDataAndRender(e)},showNoData:function(){this.summaryUsageChart&&this.summaryUsageChart.showNoData(),this.tierUsageChart&&this.tierUsageChart.showNoData()}})}),define("views/details/tabs/UsageTabContentDetailsView",["views/basecomponents/details/tabs/BaseTabContentDetailsView","views/basecomponents/charts/groups/UsageGroupChartView","utils/AppUtil"],function(e,t,i){"use strict";return e.extend({extraClassName:"n-usage-tab-content-details",grpChartUsageView:null,metricsDefault:null,initializeProperties:function(e){},render:function(){return this.grpChartUsageView=new t({entityType:this.entityType}),this.$el.append(this.grpChartUsageView.render().el),this},destroy:function(){i.debug("UsageTabContentDetailsView : destroy: "," | viewid     : "+this.cid),e.prototype.destroy.apply(this,arguments)},postSetModelId:function(e){this.grpChartUsageView&&i.isValidId(e)&&this.grpChartUsageView.fetchOnDemand(e)},onStartServices:function(){this.grpChartUsageView&&this.grpChartUsageView.startServices()},onStopServices:function(){this.grpChartUsageView&&this.grpChartUsageView.stopServices()}})}),define("views/details/tabs/ReplicationDiagramTabContentDetailsView",["views/basecomponents/details/tabs/BaseTabContentDetailsView","utils/AppUtil"],function(e,t){"use strict";return e.extend({extraClassName:"n-replication-diagram-tab-content-details",initializeProperties:function(e){},render:function(){return this.$el.append("Under Construction"),this},destroy:function(){t.debug("ReplicationDiagramTabContentDetailsView : destroy: "," | viewid     : "+this.cid),e.prototype.destroy.apply(this,arguments)},onStartServices:function(){},onStopServices:function(){}})}),define("text!templates/pages/dr/details/PopoverSnapshotDetails.html",[],function(){return'<div class="n-row-hover">\n  <% if (model.snapshot) { %>\n    <div class="n-item">\n      <div class="n-label">State:</div>\n      <%= (model.snapshot.state || "").toLowerCase() %>\n    </div>\n    <div class="n-item">\n      <div class="n-label">VM(s):</div>\n      <br/>\n      <% var allVMs  = model.snapshot.vms   || []; %>\n      <% var someVMs = _.first(allVMs, 3) || []; %>\n      <% _.each(someVMs, function(vm, idx) { %>\n        <%= (idx > 0 ? "<br/>" : "") + _.escape(vm.vmName) %>\n      <% }); %>\n\n      <% if (allVMs.length > someVMs.length) { %>\n      <%=  "<br/>" + (allVMs.length - someVMs.length) + " more..." %>\n      <% } %>\n    </div>\n    <div class="n-item">\n      <div class="n-label">NFS File(s):</div>\n      <br/>\n      <% var allFiles  = model.snapshot.nfsFiles || []; %>\n      <% var someFiles = _.first(allFiles, 3)  || []; %>\n      <% _.each(someFiles, function(file, idx) { %>\n        <%= (idx > 0 ? "<br/>" : "") + file.nfsFilePath %>\n      <% }); %>\n\n      <% if (allFiles.length > someFiles.length) { %>\n      <%= "<br/>" + (allFiles.length - someFiles.length) + " more..." %>\n      <% } %>\n    </div>\n  <% } %>\n</div>'}),define("views/details/tabs/components/TabReplicationClusterTablesView",["views/basecomponents/BaseView","views/basecomponents/datatables/DetailsTableView","data/DataProperties","text!templates/pages/dr/details/PopoverSnapshotDetails.html","models/dataprotection/ReplicationCollection","models/dataprotection/PendingReplicationCollection","utils/AppConstants","utils/AppUtil","utils/StatsUtil","utils/TimeUtil","utils/SubViewHelper"],function(e,t,i,n,s,a,r,o,l,c,u){"use strict";var d=_.template('<div class="summaryTableReplicationOngoingTitle n-table-header">            Total Ongoing            (<span class="summaryTableReplicationOngoingCount"></span>)          </div>          <div class="summaryTableReplicationOngoing">          </div>          <div style="height: 10px"></div>          <div class="summaryTableReplicationPendingTitle n-table-header">            Total Pending            (<span class="summaryTableReplicationPendingCount"></span>)          </div>          <div class="summaryTableReplicationPending">          </div>'),h=_.template(n);return e.extend({className:"n-replication-tables-container",modelEvents:{"reset  pendingReplications":"renderPendingReplications","reset  ongoingReplications":"renderOngoingReplications"},subViewHelper:null,pendingReplications:null,ongoingReplications:null,currentModelId:null,initialize:function(e){this.subViewHelper=new u,this.pendingReplications=new a,this.ongoingReplications=new s},render:function(){this.$el.html(d);var e=new t({el:this.$(".summaryTableReplicationOngoing"),scrollHeight:"90px",minimumRows:4,columns:[{sTitle:"Direction",mData:i.REP_SENDER,sWidth:"10%",mRender:function(e,t,i){return e?"Outgoing":"Incoming"}},{sTitle:"Protection Domain",mData:i.REP_PD_NAME,sWidth:"15%",mRender:function(e,t,i){return t===r.TABLE_COL_TYPE_DISPLAY?_.escape(e):e}},{sTitle:"Remote Site",mData:i.REP_REMOTE_SITE_NAME,sWidth:"15%"},{sTitle:"Snapshot",mData:i.REP_SNAPSHOT_ID,sWidth:"15%"},{sTitle:"Start Time",mData:i.REP_START_TIME,sWidth:"15%",mRender:function(e,t,i){return c.formatShortDateTime(e>0?e/1e3:0)}},{sTitle:"Data Completed",mData:i.REP_COMPLETE_BYTES,sWidth:"10%",sClass:"right",mRender:function(e,t,i){return t===r.TABLE_COL_TYPE_DISPLAY||t===r.TABLE_COL_TYPE_EXPORT?l.storageFormat(e):e}}]}),n=new t({el:this.$(".summaryTableReplicationPending"),scrollHeight:"90px",minimumRows:4,titleHover:"Snapshot Details",tmplHover:h,columns:[{sTitle:"Protection Domain",mData:i.REP_PD_NAME,sWidth:"25%",mRender:function(e,t,i){return t===r.TABLE_COL_TYPE_DISPLAY?_.escape(e):e}},{sTitle:"Remote Site",mData:i.REP_REMOTE_SITE_NAME,sWidth:"25%"},{sTitle:"Snapshot",mData:i.SNAP+"."+i.SNAP_ID,sWidth:"25%",sHover:!0},{sTitle:"Create Time",mData:i.SNAP+"."+i.SNAP_CREATE_TIME,sWidth:"25%",mRender:function(e,t,i){return c.formatShortDateTime(e>0?e/1e3:0)}}]});return this.$(".summaryTableReplicationOngoingTitle").after(e.render().el),this.$(".summaryTableReplicationPendingTitle").after(n.render().el),this.subViewHelper.register("summaryTableReplicationPending",n),this.subViewHelper.register("summaryTableReplicationOngoing",e),this},getDataAndRender:function(){this.pendingReplications.fetch(),this.ongoingReplications.fetch()},renderOngoingReplications:function(e){this.subViewHelper.get("summaryTableReplicationOngoing").updateDataSource(e.toJSON({includeAttribute:!0})),this.$(".summaryTableReplicationOngoingCount").text(e.length)},renderPendingReplications:function(e){this.subViewHelper.get("summaryTableReplicationPending").updateDataSource(e.toJSON({includeAttribute:!0})),this.$(".summaryTableReplicationPendingCount").text(e.length)},setModelId:function(e){},destroy:function(){o.debug("TabReplicationClusterTablesView : destroy: "," | viewid     : "+this.cid),this.subViewHelper&&(this.subViewHelper.removeAll(),this.subViewHelper=null),e.prototype.destroy.apply(this,arguments)},onStartServices:function(){this.delegateModelEvents(),this.ongoingReplications&&this.ongoingReplications.startPolling(),this.pendingReplications&&this.pendingReplications.startPolling(),this.subViewHelper.iterate("startServices")},onStopServices:function(){this.undelegateModelEvents(),this.ongoingReplications&&this.ongoingReplications.stopPolling(),this.pendingReplications&&this.pendingReplications.stopPolling(),this.subViewHelper.iterate("stopServices")}})}),define("views/details/tabs/components/TabReplicationProtectionDomainTablesView",["views/basecomponents/BaseView","views/basecomponents/datatables/DetailsTableView","data/DataProperties","text!templates/pages/dr/details/PopoverSnapshotDetails.html","models/dataprotection/ProtectionDomainModel","models/dataprotection/ReplicationCollection","models/dataprotection/PendingReplicationCollection","utils/AppConstants","utils/AppUtil","utils/StatsUtil","utils/TimeUtil","utils/SubViewHelper"],function(e,t,i,n,s,a,r,o,l,c,u,d){"use strict";var h=_.template('<div class="summaryTableReplicationOngoingTitle n-table-header">            Total Ongoing            (<span class="summaryTableReplicationOngoingCount"></span>)          </div>          <div class="summaryTableReplicationOngoing">          </div>          <div style="height: 10px"></div>          <div class="summaryTableReplicationPendingTitle n-table-header">            Total Pending            (<span class="summaryTableReplicationPendingCount"></span>)          </div>          <div class="summaryTableReplicationPending">          </div>          <div style="height: 10px"></div>          <div class="summaryTableLastSuccessReplicationTitle n-table-header">           Last Successful            (<span class="summaryTableLastSuccessReplicationCount"></span>)          </div>          <div class="summaryTableLastSuccessReplication">          </div>'),p=_.template(n);return e.extend({className:"n-replication-tables-container",modelEvents:{"reset  pendingReplications":"renderPendingReplications","reset  ongoingReplications":"renderOngoingReplications","change model":"renderSuccessReplications"},subViewHelper:null,pendingReplications:null,ongoingReplications:null,model:null,currentModelId:null,initialize:function(e){this.subViewHelper=new d,this.pendingReplications=new r,this.ongoingReplications=new a,this.model=new s},render:function(){this.$el.html(h);var e=new t({el:this.$(".summaryTableReplicationOngoing"),scrollHeight:"90px",minimumRows:4,columns:[{sTitle:"Direction",mData:i.REP_SENDER,sWidth:"10%",mRender:function(e,t,i){return e?"Outgoing":"Incoming"}},{sTitle:"Protection Domain",mData:i.REP_PD_NAME,sWidth:"15%",mRender:function(e,t,i){return t===o.TABLE_COL_TYPE_DISPLAY?_.escape(e):e}},{sTitle:"Remote Site",mData:i.REP_REMOTE_SITE_NAME,sWidth:"15%"},{sTitle:"Snapshot",mData:i.REP_SNAPSHOT_ID,sWidth:"15%"},{sTitle:"Start Time",mData:i.REP_START_TIME,sWidth:"15%",mRender:function(e,t,i){return u.formatShortDateTime(e>0?e/1e3:0)}},{sTitle:"Data Completed",mData:i.REP_COMPLETE_BYTES,sWidth:"10%",sClass:"right",mRender:function(e,t,i){return t===o.TABLE_COL_TYPE_DISPLAY||t===o.TABLE_COL_TYPE_EXPORT?c.storageFormat(e):e}}]}),n=new t({el:this.$(".summaryTableReplicationPending"),scrollHeight:"90px",minimumRows:4,titleHover:"Snapshot Details",tmplHover:p,columns:[{sTitle:"Protection Domain",mData:i.REP_PD_NAME,sWidth:"25%",mRender:function(e,t,i){return t===o.TABLE_COL_TYPE_DISPLAY?_.escape(e):e}},{sTitle:"Remote Site",mData:i.REP_REMOTE_SITE_NAME,sWidth:"25%"},{sTitle:"Snapshot",mData:i.SNAP+"."+i.SNAP_ID,sWidth:"25%",sHover:!0},{sTitle:"Create Time",mData:i.SNAP+"."+i.SNAP_CREATE_TIME,sWidth:"25%",mRender:function(e,t,i){return u.formatShortDateTime(e>0?e/1e3:0)}}]}),s=new t({el:this.$(".summaryTableLastSuccessReplication"),scrollHeight:"68px",minimumRows:3,columns:[{sTitle:"Direction",mData:i.REP_LAST_REPLICATION_SNAPSHOT_ID,sWidth:"10%",mRender:function(e,t,i){return null!==e&&-1!==e.indexOf(":")?"Incoming":"Outgoing"}},{sTitle:"Remote Site",mData:i.REP_REMOTE_SITE_NAME,sWidth:"40%"},{sTitle:"Snapshot ID",mData:i.REP_LAST_REPLICATION_SNAPSHOT_ID,sWidth:"20%"},{sTitle:"Start Time",mData:i.REP_LAST_REPLICATION_START_TIME,sWidth:"15%",mRender:function(e,t,i){return u.formatShortDateTime(e>0?e/1e3:0)}},{sTitle:"End Time",mData:i.REP_LAST_REPLICATION_END_TIME,sWidth:"15%",mRender:function(e,t,i){return u.formatShortDateTime(e>0?e/1e3:0)}}]});return this.$(".summaryTableReplicationOngoingTitle").after(e.render().el),this.$(".summaryTableReplicationPendingTitle").after(n.render().el),this.$(".summaryTableLastSuccessReplicationTitle").after(s.render().el),this.subViewHelper.register("summaryTableReplicationPending",n),this.subViewHelper.register("summaryTableReplicationOngoing",e),this.subViewHelper.register("summaryTableLastSuccessReplication",s),this},getOptions:function(){return{data:{protectionDomainNames:this.currentModelId}}},getDataAndRender:function(){this.pendingReplications.fetch(this.getOptions()),this.ongoingReplications.fetch(this.getOptions()),this.model.fetch()},renderOngoingReplications:function(e){this.subViewHelper.get("summaryTableReplicationOngoing").updateDataSource(e.toJSON({includeAttribute:!0})),this.$(".summaryTableReplicationOngoingCount").text(e.length)},renderPendingReplications:function(e){this.subViewHelper.get("summaryTableReplicationPending").updateDataSource(e.toJSON({includeAttribute:!0})),this.$(".summaryTableReplicationPendingCount").text(e.length)},renderSuccessReplications:function(e){var t=e.getLastSuccessfulReplicationLinks();this.subViewHelper.get("summaryTableLastSuccessReplication").updateDataSource(t),
this.$(".summaryTableLastSuccessReplicationCount").text(t.length)},setModelId:function(e){this.currentModelId=e,this.model.set(this.model.idAttribute,e,{silent:!0}),this.getDataAndRender()},destroy:function(){l.debug("TabReplicationProtectionDomainTablesView : destroy: "," | viewid     : "+this.cid),this.subViewHelper&&(this.subViewHelper.removeAll(),this.subViewHelper=null),e.prototype.destroy.apply(this,arguments)},onStartServices:function(){this.delegateModelEvents(),this.ongoingReplications&&!this.ongoingReplications.isPolling()&&this.ongoingReplications.startPolling(this.getOptions()),this.pendingReplications&&!this.pendingReplications.isPolling()&&this.pendingReplications.startPolling(this.getOptions()),this.model&&!this.model.isPolling()&&this.model.startPolling({alwaysTriggerChange:!0}),this.subViewHelper.iterate("startServices")},onStopServices:function(){this.undelegateModelEvents(),this.ongoingReplications&&this.ongoingReplications.stopPolling(),this.pendingReplications&&this.pendingReplications.stopPolling(),this.model&&this.model.stopPolling(),this.subViewHelper.iterate("stopServices")}})}),define("views/details/tabs/components/TabReplicationRemoteSiteTablesView",["views/basecomponents/BaseView","views/basecomponents/datatables/DetailsTableView","data/DataProperties","text!templates/pages/dr/details/PopoverSnapshotDetails.html","models/dataprotection/RemoteSiteModel","models/dataprotection/ReplicationCollection","models/dataprotection/PendingReplicationCollection","utils/AppConstants","utils/AppUtil","utils/StatsUtil","utils/TimeUtil","utils/SubViewHelper"],function(e,t,i,n,s,a,r,o,l,c,u,d){"use strict";var h=_.template(n);return e.extend({className:"n-replication-tables-container",modelEvents:{"reset  pendingReplications":"renderPendingReplications","reset  ongoingReplications":"renderOngoingReplications","change model":"renderSuccessReplications"},subViewHelper:null,pendingReplications:null,ongoingReplications:null,model:null,currentModelId:null,initialize:function(e){this.subViewHelper=new d,this.pendingReplications=new r,this.ongoingReplications=new a,this.model=new s},render:function(){this.$el.html('<div class="summaryTableReplicationOngoingTitle n-table-header">            Total Ongoing            (<span class="summaryTableReplicationOngoingCount"></span>)          </div>          <div class="summaryTableReplicationOngoing">          </div>          <div style="height: 10px"></div>          <div class="summaryTableReplicationPendingTitle n-table-header">            Total Pending            (<span class="summaryTableReplicationPendingCount"></span>)          </div>          <div class="summaryTableReplicationPending">          </div>          <div style="height: 10px"></div>          <div class="summaryTableLastSuccessReplicationTitle n-table-header">           Last Successful            (<span class="summaryTableLastSuccessReplicationCount"></span>)          </div>          <div class="summaryTableLastSuccessReplication">          </div>');var e=new t({el:this.$(".summaryTableReplicationOngoing"),scrollHeight:"90px",minimumRows:4,columns:[{sTitle:"Direction",mData:i.REP_SENDER,sWidth:"10%",mRender:function(e,t,i){return e?"Outgoing":"Incoming"}},{sTitle:"Protection Domain",mData:i.REP_PD_NAME,sWidth:"15%",mRender:function(e,t,i){return t===o.TABLE_COL_TYPE_DISPLAY?_.escape(e):e}},{sTitle:"Remote Site",mData:i.REP_REMOTE_SITE_NAME,sWidth:"15%"},{sTitle:"Snapshot",mData:i.REP_SNAPSHOT_ID,sWidth:"15%"},{sTitle:"Start Time",mData:i.REP_START_TIME,sWidth:"15%",mRender:function(e,t,i){return u.formatShortDateTime(e>0?e/1e3:0)}},{sTitle:"Data Completed",mData:i.REP_COMPLETE_BYTES,sWidth:"15%",sClass:"right",mRender:function(e,t,i){return t===o.TABLE_COL_TYPE_DISPLAY||t===o.TABLE_COL_TYPE_EXPORT?c.storageFormat(e):e}}]}),n=new t({el:this.$(".summaryTableReplicationPending"),scrollHeight:"90px",minimumRows:4,titleHover:"Snapshot Details",tmplHover:h,columns:[{sTitle:"Protection Domain",mData:i.REP_PD_NAME,sWidth:"25%"},{sTitle:"Remote Site",mData:i.REP_REMOTE_SITE_NAME,sWidth:"25%"},{sTitle:"Snapshot",mData:i.SNAP+"."+i.SNAP_ID,sWidth:"25%",sHover:!0},{sTitle:"Create Time",mData:i.SNAP+"."+i.SNAP_CREATE_TIME,sWidth:"25%",mRender:function(e,t,i){return u.formatShortDateTime(e>0?e/1e3:0)}}]}),s=new t({el:this.$(".summaryTableLastSuccessReplication"),scrollHeight:"68px",minimumRows:3,columns:[{sTitle:"Direction",mData:i.REP_LAST_REPLICATION_SNAPSHOT_ID,sWidth:"10%",mRender:function(e,t,i){return null!==e&&-1!==e.indexOf(":")?"Incoming":"Outgoing"}},{sTitle:"Protection Domain",mData:i.REP_PD_NAME,sWidth:"50%",mRender:function(e,t,i){return t===o.TABLE_COL_TYPE_DISPLAY?_.escape(e):e}},{sTitle:"Start Time",mData:i.REP_LAST_REPLICATION_START_TIME,sWidth:"20%",mRender:function(e,t,i){return u.formatShortDateTime(e>0?e/1e3:0)}},{sTitle:"End Time",mData:i.REP_LAST_REPLICATION_END_TIME,sWidth:"20%",mRender:function(e,t,i){return u.formatShortDateTime(e>0?e/1e3:0)}}]});return this.$(".summaryTableReplicationOngoingTitle").after(e.render().el),this.$(".summaryTableReplicationPendingTitle").after(n.render().el),this.$(".summaryTableLastSuccessReplicationTitle").after(s.render().el),this.subViewHelper.register("summaryTableReplicationPending",n),this.subViewHelper.register("summaryTableReplicationOngoing",e),this.subViewHelper.register("summaryTableLastSuccessReplication",s),this},getOptions:function(){return{data:{remoteSiteNames:this.currentModelId}}},getDataAndRender:function(){this.pendingReplications.fetch(this.getOptions()),this.ongoingReplications.fetch(this.getOptions()),this.model.fetch()},renderOngoingReplications:function(e){this.subViewHelper.get("summaryTableReplicationOngoing").updateDataSource(e.toJSON({includeAttribute:!0})),this.$(".summaryTableReplicationOngoingCount").text(e.length)},renderPendingReplications:function(e){this.subViewHelper.get("summaryTableReplicationPending").updateDataSource(e.toJSON({includeAttribute:!0})),this.$(".summaryTableReplicationPendingCount").text(e.length)},renderSuccessReplications:function(e){var t=e.getLastSuccessfulReplicationLinks();this.subViewHelper.get("summaryTableLastSuccessReplication").updateDataSource(t),this.$(".summaryTableLastSuccessReplicationCount").text(t.length)},setModelId:function(e){this.currentModelId=e,this.model.set(this.model.idAttribute,e,{silent:!0}),this.getDataAndRender()},destroy:function(){l.debug("TabReplicationRemoteSiteTablesView : destroy: "," | viewid     : "+this.cid),this.subViewHelper&&(this.subViewHelper.removeAll(),this.subViewHelper=null),e.prototype.destroy.apply(this,arguments)},onStartServices:function(){this.delegateModelEvents(),this.ongoingReplications&&!this.ongoingReplications.isPolling()&&this.ongoingReplications.startPolling(this.getOptions()),this.pendingReplications&&!this.pendingReplications.isPolling()&&this.pendingReplications.startPolling(this.getOptions()),this.model&&!this.model.isPolling()&&this.model.startPolling({alwaysTriggerChange:!0}),this.subViewHelper.iterate("startServices")},onStopServices:function(){this.undelegateModelEvents(),this.ongoingReplications&&this.ongoingReplications.stopPolling(),this.pendingReplications&&this.pendingReplications.stopPolling(),this.model&&this.model.stopPolling(),this.subViewHelper.iterate("stopServices")}})}),define("views/details/tabs/ReplicationTableTabContentDetailsView",["views/basecomponents/details/tabs/BaseTabContentDetailsView","views/details/tabs/components/TabReplicationClusterTablesView","views/details/tabs/components/TabReplicationProtectionDomainTablesView","views/details/tabs/components/TabReplicationRemoteSiteTablesView","utils/AppConstants","utils/AppUtil"],function(e,t,i,n,s,a){"use strict";return e.extend({extraClassName:"n-replication-table-tab-content-details",render:function(){return this.entityType===s.ENTITY_CLUSTER?this.replicationTablesView=new t:this.entityType===s.ENTITY_PROTECTION_DOMAIN?this.replicationTablesView=new i:this.entityType===s.ENTITY_REMOTE_SITE&&(this.replicationTablesView=new n),this.$el.html(this.replicationTablesView.render().el),this},destroy:function(){a.debug("ReplicationTableTabContentDetailsView : destroy: "," | viewid     : "+this.cid),this.replicationTablesView&&this.replicationTablesView.destroy(),e.prototype.destroy.apply(this,arguments)},setModelId:function(t){e.prototype.setModelId.apply(this,arguments),this.replicationTablesView.setModelId(t)},onStartServices:function(){this.replicationTablesView&&this.replicationTablesView.startServices()},onStopServices:function(){this.replicationTablesView&&this.replicationTablesView.stopServices()}})}),define("views/details/tabs/components/TabDetailsTableView",["views/basecomponents/datatables/BaseTableView","views/basecomponents/datatables/DataTableColumnProvider","data/DataProperties","managers/ClusterManager","managers/ActionManager","utils/AppConstants","utils/AlertUtil","utils/TimeUtil"],function(e,t,i,n,s,a,r,o){"use strict";return e.extend({isSelectionEnabled:!1,extraEvents:{"click     .btnItemAction":"onItemActionClick"},initialize:function(t){e.prototype.initialize.apply(this,arguments),this.addExtraEvents(this.extraEvents),this.defaultMinRows=10},getDefaultColumns:function(e,s){var l,c=t;return e===a.ENTITY_ALERT?(l=[{sTitle:"Severity",mData:i.ALERT_SEVERITY,sWidth:"67px",mRender:function(e,t,i){return t===a.TABLE_COL_TYPE_DISPLAY||t===a.TABLE_COL_TYPE_EXPORT?r.formatSeverity(e):e}},{sTitle:"Issue",mData:i.ALERT_MESSAGE,sWidth:"50%",mRender:function(e,t,i){return r.formatIssue(e,i)}},{sTitle:"Timestamp",mData:i.ALERT_CREATED_TIMESTAMP,sWidth:"21%",mRender:function(e,t,i){return t===a.TABLE_COL_TYPE_DISPLAY||t===a.TABLE_COL_TYPE_EXPORT?o.formatDateTime(e>0?e/1e3:0):e}},{sTitle:"Documentation",mData:i.ALERT_CREATED_TIMESTAMP,sWidth:"25%",sClass:"n-entity-type-col",mRender:function(e,i,n){return t.renderAlertCauseAndResolution(e,i,n)}}],n.isMulticlusterNavMode()||(l=t.appendColumn(l,{sTitle:"Entities",mData:i.ALERT_ENTITY_TYPES,sWidth:"15%",sClass:"n-entity-type-col",mRender:function(e,t,i){return t===a.TABLE_COL_TYPE_DISPLAY||t===a.TABLE_COL_TYPE_EXPORT?c._entityRenderCB(e,t,i):(e||[]).join(", ")}},10,!1,3),l=t.prependCheckboxColumn(l,{sTitle:"",mData:i.ALERT_ID,sWidth:"15px",sClass:"center",bSortable:!1,exportTitle:"Alert ID",mRender:function(e,t,i){return t===a.TABLE_COL_TYPE_DISPLAY?c.createDataRowCheckbox(e):e}}),this.canModifyByEntityType(a.ENTITY_ALERT)&&(l=t.appendColumn(l,{mData:i.ALERT_METADATA_ID,sWidth:"25px",sClass:"right",bSortable:!1,mRender:function(e,t,i){return r.formatEditAlertPolicy(e,i)}},1,!1,"last")))):l=t.getDataColumns(e,s),l},onItemActionClick:function(e){if(this.entityType===a.ENTITY_ALERT)s.executeActionElement(e.currentTarget);else if(this.entityType===a.ENTITY_SNAPSHOT){var t=$(e.currentTarget).attr(a.NAV_ACTION_TARGET),i=$(e.currentTarget).attr(a.NAV_ACTION);t===a.ENTITY_FILE_SERVER&&i===a.ACTION_CLONE&&s.executeActionElement(e.currentTarget)}}})}),define("models/dataprotection/SnapshotActionModel",["models/BaseModel","data/DataManager","data/DataProperties","data/DataURLConstants","utils/AppConstants"],function(e,t,i,n,s){"use strict";return e.extend({defaults:{snapshotIds:[]},urlRoot:n.SNAPSHOT,name:"SnapshotActionModel",snapshotCollection:null,entityType:s.ENTITY_SNAPSHOT,setSnapshotCollection:function(e){this.snapshotCollection=e},deleteItemsByIds:function(e){var t=this,n=function(){t.showSuccessNotification(t,s.ACTION_DELETE),t.trigger("sync",this)},a=function(e){t.showErrorNotification(t,s.ACTION_DELETE,e),t.trigger("error",this)};if(this.actionMode=s.ACTION_DELETE,this.triggerPendingEvent(),this.snapshotCollection.getSnapshotType()===s.SNAPSHOT_TYPE.LOCAL)if(this.snapshotCollection.getCollectionFilterIdType()===s.ENTITY_PROTECTION_DOMAIN&&null!==this.snapshotCollection.getCollectionFilterId()){var r=e.map(function(e){return t.snapshotCollection.findModelById(e).get(i.SNAP_ID)});this._deleteLocalSnapshots(this.snapshotCollection.getCollectionFilterId(),r,n,a)}else this._deleteLocalSnapshotsForPD(this._groupSnapshotIdsByPD(e),n,a);else this._deleteRemoteSnapshotsForPD(this._groupSnapshotIdsByPDAndRemoteSite(e),n,a)},_deleteRemoteSnapshotsForPD:function(e,t,n){if(e.length<=0)return void t();var s=this;this._deleteRemoteSnapshots(e[0][i.SNAP_LOCATED_RS_NAME],e[0].drSnapshotIdsMap,function(){e.shift(),s._deleteRemoteSnapshotsForPD(e,t,n)},n)},_deleteLocalSnapshotsForPD:function(e,t,n){if(e.length<=0)return void t();var s=this;this._deleteLocalSnapshots(e[0][i.SNAP_PD_NAME],e[0][i.REMOVE_DR_SNAP_IDS],function(){e.shift(),s._deleteLocalSnapshotsForPD(e,t,n)},n)},_groupSnapshotIdsByPDAndRemoteSite:function(e){var t=this,n=[];return _.each(e,function(e,s){var a=t.snapshotCollection.findModelById(e),r=a.get(i.SNAP_PD_NAME),o=a.get(i.SNAP_LOCATED_RS_NAME),l=a.get(i.SNAP_ID),c=_.find(n,function(e){return e[i.SNAP_LOCATED_RS_NAME]===o});c?c[i.REMOVE_DR_SNAP_ID_MAP][r]?c[i.REMOVE_DR_SNAP_ID_MAP][r].push(l):c[i.REMOVE_DR_SNAP_ID_MAP][r]=[l]:(c={},c[i.SNAP_LOCATED_RS_NAME]=o,c[i.REMOVE_DR_SNAP_ID_MAP]={},c[i.REMOVE_DR_SNAP_ID_MAP][r]=[l],n.push(c))}),n},_groupSnapshotIdsByPD:function(e){var t=this,n=[];return _.each(e,function(e,s){var a=t.snapshotCollection.findModelById(e);if(a){var r=a.get(i.SNAP_PD_NAME),o=a.get(i.SNAP_ID),l=_.find(n,function(e){return e[i.SNAP_PD_NAME]===r});l?l[i.REMOVE_DR_SNAP_IDS].push(o):(l={},l[i.SNAP_PD_NAME]=r,l[i.REMOVE_DR_SNAP_IDS]=[o],n.push(l))}}),n},_deleteRemoteSnapshots:function(e,i,s,a){var r=t.getFormattedURL(_.template(n.DELETE_REMOTE_SNAPSHOT,{remoteSite:e}));$.ajax({type:"POST",url:r,contentType:"application/json; charset=UTF-8",data:JSON.stringify({drSnapshotIdsMap:i}),statusCode:this.getStatusCode(),success:function(e,t,i){s&&s(e)},error:function(e,t,i){a&&a(e)}})},_deleteLocalSnapshots:function(e,i,s,a){var r=t.getFormattedURL(_.template(n.DELETE_LOCAL_SNAPSHOT,{pdName:e}));$.ajax({type:"POST",url:r,contentType:"application/json; charset=UTF-8",data:JSON.stringify(i),statusCode:this.getStatusCode(),success:function(e,t,i){s&&s(e)},error:function(e,t,i){a&&a(e)}})}})}),define("views/details/tabs/components/TabSnapshotTableView",["components/Components","views/details/tabs/components/TabDetailsTableView","views/basecomponents/datatables/DataTableColumnProvider","models/BaseCollection","models/dataprotection/SnapshotModel","models/dataprotection/SnapshotActionModel","models/dataprotection/ProtectionDomainModel","data/DataProperties","data/DataURLConstants","managers/ActionManager","managers/NotificationManager","data/DataManager","utils/VisualizationUtil","utils/AppUtil","utils/AppConstants","utils/TimeUtil"],function(e,t,i,n,s,a,r,o,l,c,u,d,h,p,T,E){"use strict";var S={EXPIRED:"Expired",RETAIN_FOREVER:"Retain Forever",AVAILABLE:"Available",SCHEDULED:"Scheduled"},g=n.extend({model:s,name:"PopoverSnapshotCollection",url:l.SNAPSHOT,setFilterURL:function(e,t){var i=o.SNAP_ID+"=="+t.get(o.SNAP_ID);e===T.SNAPSHOT_TYPE.LOCAL?this.url=_.template(l.LOCAL_SNAPSHOT,{pdName:t.get(o.SNAP_PD_NAME)}):(this.url=_.template(l.REMOTE_SNAPSHOT,{remoteSite:t.get(o.SNAP_LOCATED_RS_NAME)}),i+=";"+o.SNAP_PD_NAME+"=="+t.get(o.SNAP_PD_NAME)),this.setFilterCriteria(i)}}),A=_.template('<%= title %> <span class="nutanixMoreInfo"data-tooltip-title="<%- tooltipContent %>"data-tooltip-classes="-nudge-up"></span>'),m=_.template('<a class="btnItemAction" action="show" actionTarget="nonrecovarable_vms" actionTargetId="<%= snapShotType  + " " + snapshotId %>"actionTargetName="<%= protectionDomainName %>"><span class="action-label">Details</span></a>'),f=_.template('<span>\n        <%= id %>\n      </span>\n      <% if (hasMissingSnapshots) { %>\n        &nbsp;\n        <span class="missing-snapshots-info">\n          '+e.icon("exclamation_badge","-inline")+"\n        </span>\n      <% } %>");return t.extend({name:"TabSnapshotTableView",popoverSnapshotModel:null,popoverToggleElement:null,entityActions:[],initialize:function(e){t.prototype.initialize.apply(this,arguments),this.addExtraEvents({"click .btnItemAction":"onClickLinkAction","mouseover .missing-snapshots-info":"onToolTipMouseOver","mouseleave .missing-snapshots-info":"onToolTipMouseLeave"})},initializeTableModel:function(e){t.prototype.initializeTableModel.apply(this,arguments),this.model.setCollectionFilterIdType(e.modelIdType),this.model.setSnapshotType(e.snapshotType),this.model.enableFullDetails(),this.entityActions=[T.ACTION_SHOW,T.ACTION_DELETE,T.ACTION_RETRIEVE,T.ACTION_RESTORE,T.ACTION_CLONE]},render:function(){var e=t.prototype.render.apply(this,arguments);return this.$(".nutanixMoreInfo").nutanixMoreInfo({parseDataAttrs:!0}),e},onToolTipMouseOver:function(e){var t=$(e.currentTarget),i=_.template("\n          <p>"+this.i18n("missing_snapshot_info")+"</p>\n        ");t.tooltip({title:i,placement:"top",trigger:"manual",html:!0}),t.tooltip("show")},onToolTipMouseLeave:function(e){$(e.currentTarget).tooltip("destroy")},setTabTableOptions:function(e){e&&e.entityActions&&(this.entityActions=e.entityActions)},destroy:function(){this.$(".missing-snapshots-info").tooltip("destroy"),this.$(".nutanixMoreInfo").nutanixMoreInfo("destroy"),t.prototype.destroy.apply(this,arguments)},getActionViewOptions:function(){if(this.canModifyByEntityType(T.ENTITY_SNAPSHOT)){var e=new a;return e.setSnapshotCollection(this.model),{model:e}}return t.prototype.getActionViewOptions.apply(this,arguments)},onActionError:function(e){e===T.ACTION_DELETE&&this.refreshData()},getDefaultSort:function(e){return[[2,T.SORT_DESC]]},onDataLoading:function(){this.dataTable.fnClearTable(),this.$(".n-error").hide(),this.$(".n-loading").show()},getDefaultColumns:function(e,t){var n=this.model.getCollectionFilterIdType(),s=this,a=[],r=this.canModifyByEntityType(T.ENTITY_SNAPSHOT);a.push({sTitle:"ID",mData:o.SNAP_ID,sWidth:n!==T.ENTITY_PROTECTION_DOMAIN?"20%":"32%",mRender:function(e,t,i){return f(s.vtOptions({id:i[o.SNAP_ID],hasMissingSnapshots:i.missingEntities&&i.missingEntities.length}))}}),a.push({sTitle:"Create Time",mData:o.SNAP_CREATE_TIME,sWidth:"20%",mRender:function(e,t,n){return i.renderDateTimeValue(e,t,n)}});var l=this.model.getSnapshotType(),c=l===T.SNAPSHOT_TYPE.LOCAL;return n===T.ENTITY_REMOTE_SITE?a.push({sTitle:"Protection Domain",mData:o.SNAP_PD_NAME,sWidth:"20%"}):(n!==T.ENTITY_PROTECTION_DOMAIN&&a.push({sTitle:"Protection Domain",mData:o.SNAP_PD_NAME,sWidth:"15%"}),c?a.push({sTitle:A(s.vtOptions({title:"Reclaimable Space",tooltipContent:"Total space to be recovered after this snapshot is deleted"})),mData:o.SNAP_EXCLUSIVE_USAGE_IN_BYTES,sWidth:"10%",mRender:function(e,t,n){return e===T.STATS_IN_PROCESS?t===T.TABLE_COL_TYPE_DISPLAY||t===T.TABLE_COL_TYPE_EXPORT?T.PROCESSING_STATS_DATA:e:0===e?0:i.renderStorageStats(e,t,n)}}):a.push({sTitle:"Location",mData:o.SNAP_LOCATED_RS_NAME,sWidth:"10%"})),a.push({sTitle:"Expiry Time",mData:o.SNAP_EXPIRE_TIME,sWidth:"15%",mRender:function(e,t,n){return t===T.TABLE_COL_TYPE_DISPLAY||t===T.TABLE_COL_TYPE_EXPORT?e?i.renderDateTimeValue(e,t,n):S[n[o.SNAP_STATE]]||"":e}}),a.push({sTitle:this.i18n("column_app_consistency"),mData:"vms",sWidth:"11%",mRender:function(e,t,i){return p.get(e,"0.appConsistentSnapshots")?s.i18n("app_consistency_true"):s.i18n("app_consistency_false")}}),a.push({sTitle:"Actions",mData:o.ID,sWidth:r?"20%":"21%",bSearchable:!1,mRender:function(e,t,i){return s._renderSnapshotActions(o.SNAP,e,i)}}),r?i.prependCheckboxColumn(a,{sTitle:"",mData:o.ID,sWidth:"15px",sClass:"center",bSortable:!1,bSearchable:!1,mRender:function(e,t,n){return n[o.SNAP_STATE]!==T.SNAPSHOT_STATE.EXPIRED?i.createDataRowCheckbox(e):null}}):a},setModelId:function(e){this.model.setCollectionFilterId(e),this.refreshData()},processLocalFilter:function(e){return!1===e.expired?(this.model.setIncludeExpired(!1),delete e.expired):this.model.setIncludeExpired(!0),e},onClickLinkAction:function(e){var t=$(e.currentTarget),i={action:t.attr(T.NAV_ACTION),actionTarget:t.attr(T.NAV_ACTION_TARGET),actionTargetId:t.attr(T.NAV_ACTION_TARGET_ID),actionTargetName:t.attr(T.NAV_ACTION_TARGET_NAME)};i.action!==T.ACTION_SHOW&&this.showActionDeniedMessage(T.ENTITY_SNAPSHOT,i.action,T.USER_PRIVILEGE.MODIFY)||(i.action===T.ACTION_RESTORE?this.performRestoreCloneActionClicked(i):i.action===T.ACTION_SHOW?this.showVmsPopup(e):this.performActionClicked(i))},performActionClicked:function(e){var t=this.model.findModelById(e.actionTargetId);if(e.action===T.ACTION_RESTORE)e.actionTargetId=t.get(o.SNAP_ID),c.executeAction(e);else if(e.action===T.ACTION_CLONE)c.executeAction(e);else{var i,n=this,s=E.formatDateTime(t.get(o.SNAP_CREATE_TIME)/1e3);if(e.action===T.ACTION_DELETE){var a=t.isRemoteSnapshot()?T.ENTITY_NAMES[T.ENTITY_REMOTE_SITE]:T.ENTITY_NAMES[T.ENTITY_PROTECTION_DOMAIN];i=_.template("Delete snapshot '<%= id %>' created on '<%= createTime %>' from <%= entityType %> '<%= entityName %>'?",{id:t.get(o.SNAP_ID),createTime:s,entityName:t.isRemoteSnapshot()?t.get(o.SNAP_LOCATED_RS_NAME):t.get(o.SNAP_PD_NAME),entityType:a}),$.nutanixConfirm({msg:i,yes:function(){n._deleteSnapshot(t)},yesText:"Yes",noText:"No"})}else e.action===T.ACTION_RETRIEVE&&(i=_.template("Retrieve snapshot '<%= id %>' created on '<%= createTime %>' from '<%= location %>'?",{id:t.get(o.SNAP_ID),createTime:s,location:t.get(o.SNAP_LOCATED_RS_NAME)}),$.nutanixConfirm({msg:i,yes:function(){n._retrieveSnapshot(t)},yesText:"Yes",noText:"No"}))}},showVmsPopup:function(e){e.preventDefault(),c.executeActionElement(e.currentTarget)},performRestoreCloneActionClicked:function(e){p.showLoader();var t=this,i=new r,n=this.model.get({id:e.actionTargetId});i.set(i.idAttribute,e.actionTargetName,{silent:!0}),i.fetch({success:function(i,s,a){var r=i.get(o.PD_ANNOTATIONS);i.isFileServerPD()?t.filterSnapshotData(n,e,r):(p.hideLoader(),t.performActionClicked(e))},error:function(e,t){p.hideLoader(),u.showClientNotification(T.NOTIFY_ERROR,p.processAjaxError(t.responseText))}})},filterSnapshotData:function(e,t,i){var n=this,s=[],a=e.get(o.SNAP_PD_NAME),r=e.get(o.SNAP_UUID),c=d.getFormattedURL(l.LOCAL_SNAPSHOT_FILTER);s.push(r);var h={pdName:a,snapshotUuids:s};$.ajax({type:"POST",url:c,contentType:"application/json; charset=UTF-8",data:JSON.stringify(h),success:function(s,a,l){var c=_.find(s,function(e){return e[o.SNAP_UUID]===r});e.set(o.VERSION,c[o.VERSION_FS]),c?n.performSnapshotRestoreCloneAction(e,t,i):(p.hideLoader(),u.showClientNotification(T.NOTIFY_ERROR,n.i18ns("clone_message",h.pdName)))},error:function(e,t,i){p.hideLoader(),u.showClientNotification(T.NOTIFY_ERROR,p.processAjaxError(e.responseText))}})},performSnapshotRestoreCloneAction:function(e,t,i){var n=this,s=new g;s.setFilterURL(T.SNAPSHOT_TYPE.LOCAL,e),s.fetch({success:function(s,a,r){var l=a.entities[0].vms;p.hideLoader(),l&&l.length>0?(t.actionTarget=T.ENTITY_FILE_SERVER,t.action=T.ACTION_CLONE,t.actionTargetName=e.get(o.SNAP_UUID)+","+l.length+","+i[0].split("=")[1],t.actionVersion=e.get(o.VERSION),n.performActionClicked(t)):u.showClientNotification(T.NOTIFY_ERROR,n.i18n("invalid_snapshot"))},error:function(e,t){p.hideLoader(),u.showClientNotification(T.NOTIFY_ERROR,p.processAjaxError(t.responseText))}})},_deleteSnapshot:function(e){var t=this;e.deleteSnapshot(function(){t.refreshData()})},_retrieveSnapshot:function(e){var t=this;e.retrieveSnapshot(function(){t.refreshData()})},_renderSnapshotActions:function(e,t,i){var n=this.model.getSnapshotType(),s=m({snapShotType:n,snapshotId:i[o.SNAP_ID],protectionDomainName:i[o.SNAP_PD_NAME]});if(this.canModifyByEntityType(T.ENTITY_SNAPSHOT)){var a=i[o.SNAP_PD_NAME],r=null===i[o.SNAP_LOCATED_RS_NAME],l={},c=r?T.ACTION_RESTORE:T.ACTION_RETRIEVE;if(this.canModifyByEntityType(T.ENTITY_SNAPSHOT)){_.contains(this.entityActions,c)&&(l[c]=r?h.RESTORE:h.RETRIEVE),_.contains(this.entityActions,T.ACTION_DELETE)&&i[o.SNAP_STATE]!==T.SNAPSHOT_STATE.EXPIRED&&(l[T.ACTION_DELETE]=h.DELETE)}return _.size(l)>0?s+h.ACTION_SEPARATOR+h.renderItemActions(e,t,a,l):""}return s}})}),define("views/details/tabs/SnapshotTableTabContentDetailsView",["views/basecomponents/details/tabs/BaseTabContentDetailsView","views/details/tabs/components/TabSnapshotTableView","utils/AppConstants","utils/AppUtil"],function(e,t,i,n){"use strict";return e.extend({extraClassName:"n-snapshot-tab-content-details",tableView:null,initializeProperties:function(e){var n=e.tabId===i.TAB_DETAILS.LOCAL_SNAPSHOT_TABLE?i.SNAPSHOT_TYPE.LOCAL:i.SNAPSHOT_TYPE.REMOTE;this.tableView=new t({entityType:i.ENTITY_SNAPSHOT,modelIdType:e.entityType,pageId:e.pageId,snapshotType:n})},render:function(){return this.$el.append(this.tableView.render().el),this},postSetModelId:function(t){e.prototype.postSetModelId.apply(this,arguments),this.tableView&&this.tableView.setModelId(t)},destroy:function(){n.debug("SnapshotTableTabContentDetailsView : destroy: "," | viewid     : "+this.cid),e.prototype.destroy.apply(this,arguments),this.tableView&&this.tableView.destroy()},setTabOptions:function(e){this.tableView.setTabTableOptions(e)},onStartServices:function(){this.tableView&&this.tableView.startServices(),this.delegateEvents()},onStopServices:function(){this.tableView&&this.tableView.stopServices(),this.undelegateEvents()}})}),define("views/details/tabs/components/TabVMProtectionDomainTableView",["views/details/tabs/components/TabDetailsTableView","models/dataprotection/ProtectionDomainModel","data/DataProperties","utils/AppConstants","utils/VisualizationUtil"],function(e,t,i,n,s){"use strict";return e.extend({modelEvents:{"change    model":"onDataChange","error     model":"onDataError","pending   model":"onDataLoading"},initialize:function(t){e.prototype.initialize.apply(this,arguments),this.addExtraEvents({"click .btnItemAction":"onClickLinkAction"})},initializeTableModel:function(e){this.model=new t},modelToJSON:function(){return this.model.getProtectedEntities()},getDefaultColumns:function(e,t){var a=this;return[{sTitle:"Name",mData:i.NAME,sWidth:"25%",mRender:function(e,t,i){return t===n.TABLE_COL_TYPE_DISPLAY?_.escape(e):e}},{sTitle:"Type",mData:"type",sWidth:"20%"},{sTitle:"Consistency Group",mData:i.VM_CONSISTENCY_GROUP,sWidth:"25%",mRender:function(e,t,n){var a=n[i.VM_CONSISTENCY_GROUP];return n[i.APP_CONSISTENT_SNAPSHOTS]?s.renderAppConsistentSnapshotCG(a):a}},{sTitle:"Power State On Recovery",mData:"vmPowerStateOnRecovery",sWidth:"20%",mRender:function(e,t,i){return(e||"").replace(/\_/g," ").toLowerCase()}},{sTitle:"",mData:i.ID,sWidth:"10%",sClass:"right",mRender:function(e,t,r){var o=r[i.NAME],l={};return a.model.isFileServerPD()||(l[n.ACTION_UNPROTECT]=s.UNPROTECT),s.renderItemActions(n.ENTITY_VM,e,o,l)}}]},getInfoTooltip:function(){return null},setModelId:function(e){this.model.set(this.model.idAttribute,e,{silent:!0}),this.refreshData()},onClickLinkAction:function(e){var t=$(e.currentTarget),s={action:t.attr(n.NAV_ACTION),actionTarget:t.attr(n.NAV_ACTION_TARGET),actionTargetId:t.attr(n.NAV_ACTION_TARGET_ID),actionTargetName:t.attr(n.NAV_ACTION_TARGET_NAME)};if(s.action===n.ACTION_UNPROTECT){if(this.showActionDeniedMessage(n.ENTITY_PROTECTION_DOMAIN,s.action,n.USER_PRIVILEGE.MODIFY))return;$.nutanixConfirm({msg:"Unprotect entities '"+_.escape(s.actionTargetName)+"' from protection domain '"+this.model.get(i.PD_NAME)+"'?",yes:function(){this._unprotectEntity(s.actionTargetId)},yesText:"Yes",noText:"No",context:this})}},_unprotectEntity:function(e){var t=this;this.model.unprotect([e],function(){t.model.showClientNotification(n.NOTIFY_INFO,"Unprotect entities initiated successfully."),t._showInProgressLoading(),setTimeout(function(){t.refreshData()},1e3)},function(e){t.model.showClientNotification(n.NOTIFY_ERROR,e)})},_showInProgressLoading:function(){this.dataTable.fnClearTable(),this.$(".n-loading").show()}})}),define("views/details/tabs/VMTableTabContentDetailsView",["views/basecomponents/details/tabs/BaseTabContentDetailsView","views/details/tabs/components/TabVMProtectionDomainTableView","utils/AppConstants","utils/AppUtil"],function(e,t,i,n){"use strict";return e.extend({extraClassName:"n-vm-tab-content-details",tableView:null,initializeProperties:function(e){this.tableView=new t({entityType:i.ENTITY_GENERIC,pageId:e.pageId})},render:function(){return this.$el.append(this.tableView.render().el),this},destroy:function(){n.debug("VMTableTabContentDetailsView : destroy: "," | viewid     : "+this.cid),this.tableView&&this.tableView.destroy(),e.prototype.destroy.apply(this,arguments)},postSetModelId:function(t){e.prototype.postSetModelId.apply(this,arguments),this.tableView&&this.tableView.setModelId(t)},onStartServices:function(){this.tableView&&this.tableView.startServices(),this.delegateEvents()},onStopServices:function(){this.tableView&&this.tableView.stopServices(),this.undelegateEvents()}})}),define("views/details/tabs/components/TabPDScheduleTableView",["views/details/tabs/components/TabDetailsTableView","views/basecomponents/datatables/DataTableColumnProvider","models/dataprotection/PDScheduleCollection","data/DataProperties","managers/ActionManager","utils/AppUtil","utils/AppConstants","utils/TimeUtil","text!templates/pages/dr/details/PopoverRetentionPolicyDetails.html"],function(e,t,i,n,s,a,r,o,l){"use strict";var c=_.template(l);return e.extend({metroPD:null,fetchedPdName:null,initialize:function(t){e.prototype.initialize.apply(this,arguments),this.addExtraEvents({"click .btnItemAction":"onClickLinkAction"}),this.enablePopoverOnHover()},initializeTableModel:function(e){this.model=new i},getDefaultColumns:function(e,i){var s=this,l=this.canModifyByEntityType(r.ENTITY_PROTECTION_DOMAIN),u=[{sTitle:"Type",mData:n.NAME,sWidth:"10%",mRender:function(e,t,i){return a.toUpperCaseFirstChar(e)}},{sTitle:"Repeat On",mData:n.SCHEDULE_VALUES,sWidth:"20%",mRender:function(e,t,i){return s._renderScheduleDisplayValues(e,i)}},{sTitle:"Start Date",mData:n.SCHEDULE_USER_START_TIME,sWidth:"10%",mRender:function(e,t,i){return o.formatDateTime(e>0?e/1e3:0)}},{sTitle:"End Date",mData:n.SCHEDULE_END_TIME,sWidth:"10%",mRender:function(e,t,i){return o.formatDateTime(e>0?e/1e3:0)}},{sTitle:"Retention Policy",mData:n.SCHEDULE_RETENTION_POLICY,sWidth:l?"40%":"50%",tmplHover:c,mRender:function(e,i,s){return t.renderRetentionPolicy(e,s[n.ID],null,s[n.PD_ROLL_UP_SCHEDULE_UUID])}}];return l&&u.push({sTitle:"",mData:n.ID,sWidth:"10%",sClass:"right",mRender:function(e,t,i){return t===r.TABLE_COL_TYPE_DISPLAY?s._renderScheduleActions(e,i):""}}),u},setModelId:function(e){this.model.setPDName(e),this.metroPD&&(this.metroPD.getState()===r.STATE_SUCCESS?this.fetchedPdName=this.metroPD.get(this.metroPD.idAttribute):this.fetchedPdName=null),this.refreshData()},setTabTableOptions:function(e){e&&e.metroPD&&(this.metroPD=e.metroPD)},onPDChange:function(e){this.fetchedPdName=e.get(e.idAttribute),e.get(e.idAttribute)===this.model.pdName&&this.onDataChange()},onStartServices:function(){e.prototype.onStartServices.apply(this,arguments),this.metroPD&&this.metroPD.on("change",this.onPDChange,this)},onStopServices:function(){e.prototype.onStopServices.apply(this,arguments),this.metroPD&&this.metroPD.off("change",this.onPDChange,this)},onClickLinkAction:function(e){var t=$(e.currentTarget),i={action:t.attr(r.NAV_ACTION),actionTarget:t.attr(r.NAV_ACTION_TARGET),actionTargetId:t.attr(r.NAV_ACTION_TARGET_ID),actionTargetName:t.attr(r.NAV_ACTION_TARGET_NAME)};if(!this.showActionDeniedMessage(r.ENTITY_PROTECTION_DOMAIN,i.action,r.USER_PRIVILEGE.MODIFY)){var n=this;if(i.action===r.ACTION_UPDATE)i.actionSuccessCallback=function(){n.refreshData()},s.executeAction(i);else if(i.action===r.ACTION_DELETE){var a=this.model.findModelById(i.actionTargetId);a?$.nutanixConfirm({msg:"Delete this schedule?",yes:function(){n._deleteAction(a)},yesText:"Yes",noText:"No"}):this.showHeaderTextError("Error deleting schedule, schedule is no longer exist.")}}},getHoverTooltip:function(t,i,s,a){if(s.mData===n.SCHEDULE_RETENTION_POLICY){return t({cellData:_.map(a.remoteMaxSnapshots,function(e,t){return{remoteSite:t,snapshots:e}})})}return e.prototype.getHoverTooltip.apply(this,arguments)},_deleteAction:function(e){var t=this;e.deleteSchedule(function(e){
e&&t.refreshData()},function(e){t.showHeaderTextError("Error delete schedule. "+e)})},_renderScheduleDisplayValues:function(e,t){var i=t[n.ID];return this.model.findModelById(i).getDisplayScheduleValues()},_renderScheduleActions:function(e,i){var s=i[n.PD_SCHEDULE_NAME],a=!0;return this.metroPD&&(a=this.fetchedPdName===this.model.pdName&&this.metroPD.isScheduleEditable()),t.renderScheduleActions(e,s,a)}})}),define("views/details/tabs/ScheduleTableTabContentDetailsView",["views/basecomponents/details/tabs/BaseTabContentDetailsView","data/DataProperties","views/details/tabs/components/TabPDScheduleTableView","utils/AppConstants","utils/AppUtil"],function(e,t,i,n,s){"use strict";var a=_.template('<div><%= hybridSchedulesCount %> hybrid schedule<%= (hybridSchedulesCount === 1) ? " is" : "s are" %> not listed below.</div>');return e.extend({extraClassName:"n-schedule-tab-content-details",tableView:null,initializeProperties:function(e){this.tableView=new i({entityType:n.ENTITY_SCHEDULE,pageId:e.pageId})},render:function(){return this.model&&this.model.get(t.PD_HYBRID_SCHEDULES_COUNT)&&this.$el.append(a({hybridSchedulesCount:this.model.get(t.PD_HYBRID_SCHEDULES_COUNT)})),this.$el.append(this.tableView.render().el),this},destroy:function(){s.debug("VMTabContentDetailsView : destroy: "," | viewid     : "+this.cid),this.tableView&&this.tableView.destroy(),e.prototype.destroy.apply(this,arguments)},postSetModelId:function(t){e.prototype.postSetModelId.apply(this,arguments),this.tableView&&this.tableView.setModelId(t)},setTabOptions:function(e){this.tableView.setTabTableOptions(e)},onStartServices:function(){this.tableView&&this.tableView.startServices(),this.delegateEvents()},onStopServices:function(){this.tableView&&this.tableView.stopServices(),this.undelegateEvents()}})}),define("models/vm/AcropolisSnapshotCollection",["models/PollingCollection","models/vm/AcropolisSnapshotModel","data/DataManager","data/DataURLConstants"],function(e,t,i,n){"use strict";return e.extend({model:t,url:n.MGMT_VM,name:"AcropolisSnapshotCollection",fetch:function(t){return t=t||{},t.data={includeSnapshots:!0},e.prototype.fetch.apply(this,[t])},parse:function(i,n){return i=e.prototype.parse.apply(this,arguments),i[t.DP.LINKED_LIST]},getDataSourceURL:function(){return i.getNutanixApiDataSourceURL()}})}),define("views/basecomponents/datatables/acropolis/AcropolisNicTableView",["views/basecomponents/datatables/BaseTableView","models/network/AcropolisNicCollection","models/network/AcropolisNetworkModel","data/DataProperties","events/AppEvents"],function(e,t,i,n,s){"use strict";return e.extend({clusterUuid:null,initializeTableModel:function(e){this.model=new t,this.defaultMinRows=10,this.clusterUuid=e.clusterUuid},initializeDataTableSettings:function(){e.prototype.initializeDataTableSettings.apply(this,arguments),_.extend(this.dataTableSettings,{aoColumns:this.getDefaultColumns(this.entityType,this.pageId,this.clusterUuid)})},onClickDataRow:function(){},setProxyClusterUuid:function(e){this.model.setProxyClusterUuid(e)},onDataChange:function(){var e=this.modelToJSON(),t=e.map(function(e){return e.networkUuid});this._fetchNetworkEntities(t)},_fetchNetworkEntities:function(e){var t=this,n=[],s=[];e.forEach(function(e){var a=new i;a.setProxyClusterUuid(t.clusterUuid),a.set(a.idAttribute,e),n.push(new Promise(function(e,t){a.fetch({success:function(){s.push(a.get(a.DP.VLAN_ID)),e()}})}))}),Promise.all(n).then(function(){t.onFetchVlanIdsComplete(s)})},onFetchVlanIdsComplete:function(e){this.$(".n-loading-wrapper").hide(),this.$(".n-error").hide(),this._removePopovers(),this.dataTable.fnClearTable();var t=this.modelToJSON();if(t.length&&t.forEach(function(t,n){t.network=t.network||{},t.network[i.DP.VLAN_ID]=e[n]}),this.model&&t.length){var a=_.pluck(t,n.ID);this.onSelectedIdsChange(a),this.dataTable.fnAddData(t,!1),this.standingRedraw(this.dataTable.fnSettings())}this.eventBus&&this.eventBus.trigger(s.TABLE_RENDER_COMPLETE)}})}),define("models/task/AcropolisTaskCollection",["models/PollingCollection","models/task/AcropolisTaskModel","data/DataManager","data/DataURLConstants"],function(e,t,i,n){"use strict";return e.extend({DEFAULT_TASK_LIMIT:200,model:t,url:n.MGMT_TASKS,name:"AcropolisTaskCollection",parseOptions:function(t,i,n){return n=e.prototype.parseOptions.apply(this,arguments),"read"===t&&_.extend(n.data,{includeCompleted:!0,includeEntityNames:!0,count:this.DEFAULT_TASK_LIMIT}),n},getDataSourceURL:function(){return i.getNutanixApiDataSourceURL()}})}),define("views/basecomponents/datatables/acropolis/AcropolisTaskTableView",["views/basecomponents/datatables/BaseTableView","models/task/AcropolisTaskCollection","data/DataProperties","utils/AppConstants"],function(e,t,i,n){"use strict";return e.extend({SNAPSHOT_CREATE:"SnapshotCreate",SNAPSHOT_DELETE:"SnapshotDelete",VM_CREATE:"VmCreate",FORCE_DISPLAY_EXCEPTIONS:["VmSetPowerState","VmForcePowerOff","HostRestartAllVms"],initializeTableModel:function(){this.model=new t,this.defaultMinRows=10},initializeDataTableSettings:function(){e.prototype.initializeDataTableSettings.apply(this,arguments),_.extend(this.dataTableSettings,{aoColumns:this.getDefaultColumns(this.entityType,this.pageId)})},modelToJSON:function(){var e=this,s=this.model.map(function(e){return e.get(i.UUID)}),a=this.model.filter(function(t){var i=t.get(t.DP.OPERATION_TYPE),a=_.contains(e.FORCE_DISPLAY_EXCEPTIONS,i),r=t.get(t.DP.PARENT_TASK_UUID),o=r&&_.contains(s,r),l=t.getEntityTypes();return!!(_.isEmpty(l)||_.contains(l,n.ENTITY_VM)||a)&&(!o||a)});return new t(a).toJSON({includeAttribute:!0,includeCustomAttributes:!0})},onDataChange:function(){e.prototype.onDataChange.apply(this,arguments),this.$(".n-task-message-widget").popover("destroy").popover({trigger:"hover",html:!0,animation:!1,delay:0,container:$("body")})},destroy:function(){this.$(".n-task-message-widget").popover("destroy")},getDefaultSort:function(){return[[4,"desc"]]},onClickDataRow:function(){},setProxyClusterUuid:function(e){this.model.setProxyClusterUuid(e)}})}),define("views/basecomponents/datatables/acropolis/AcropolisSnapshotTableView",["views/basecomponents/datatables/BaseTableView","utils/AppConstants","managers/ClusterManager"],function(e,t,i){"use strict";var n=_.template('\n      <span class="semi-bold"><%= title %></span>\n    ');return e.extend({name:"AcropolisSnapshotTableView",tableTitle:"peSnapshots",initialize:function(t,i){this.model=i,e.prototype.initialize.apply(this,arguments)},renderSubviews:function(){e.prototype.renderSubviews.apply(this,arguments),this.$el.prepend(n({title:this.i18n(this.tableTitle)}))},viewFilters:function(){return[{targets:{selectors:[".snapshotActions"]},conditions:{logic:t.VIEW_FILTER.LOGICS.EVERY,groups:[{type:"isFanoutSupported",data:[!1],reason:this.i18n("actionUnavailableMsg"),operator:t.FILTER_OPERATORS.EQUALS},{type:"isMulticluster",data:[!0],reason:this.i18n("actionUnavailableMsg"),operator:t.FILTER_OPERATORS.EQUALS}]}}]},initializeTableModel:function(e){this.defaultMinRows=10},initializeDataTableSettings:function(){e.prototype.initializeDataTableSettings.apply(this,arguments),_.extend(this.dataTableSettings,{aoColumns:this.getDefaultColumns(this.entityType,this.pageId)})},getDefaultSort:function(){return[[0,"desc"]]},onClickDataRow:function(){},onDrawCallback:function(){this.renderViewFilter()},getViewFeatures:function(){var e=i.getClusterModelByClusterUuid(this.model.clusterUuid);return{isFanoutSupported:!!e&&e.isEntityActionSupportFanout(null,t.ENTITY_ACROPOLIS_SNAPSHOT),isMulticluster:i.isMulticlusterUI()}},setProxyClusterUuid:function(e){this.model.setProxyClusterUuid(e)}})}),define("views/details/tabs/AcropolisTabContentDetailsView",["views/basecomponents/details/tabs/BaseTabContentDetailsView","models/vm/AcropolisSnapshotCollection","views/basecomponents/datatables/acropolis/AcropolisNicTableView","views/basecomponents/datatables/acropolis/AcropolisTaskTableView","views/basecomponents/datatables/acropolis/AcropolisSnapshotTableView","managers/ClusterManager","data/DataProperties","utils/AppConstants","utils/AppUtil"],function(e,t,i,n,s,a,r,o,l){"use strict";return e.extend({MESSAGE_NON_ACROPOLIS_TAB:"This tab only applies to Acropolis managed VMs.",entityTypeTable:null,extraClassName:"n-table-tab-content-details",tableView:null,initializeProperties:function(e){if(e=e||{},!this.entityTypeTable||!e.pageId)throw new Error("AcropolisTabContentDetailsView: initializeProperties: entityTypeTable and pageId are required.");var a={entityType:this.entityTypeTable,pageId:e.pageId,clusterUuid:this._getClusterId()};switch(this.entityTypeTable){case o.ENTITY_ACROPOLIS_NIC:this.tableView=new i(a);break;case o.ENTITY_ACROPOLIS_TASK:this.tableView=new n(a);break;case o.ENTITY_ACROPOLIS_SNAPSHOT:this.snapshotCollection=new t,this.tableView=new s(a,this.snapshotCollection);break;default:throw this.entityTypeTable+" isn't supported yet"}_.bindAll(this,"refreshView")},setModel:function(e){this.model=e},postSetModelId:function(e){if(this.tableView&&this.tableView.model&&l.isValidId(e)){this.tableView.hideClientMessage();var t,i;t=Object.getPrototypeOf(this.tableView.model).url,i=this.getDetailsTableURL(e),this.tableView.setModelURL(t+i)}},refreshView:function(){this.tableView.cancelCurrentModelFetch(),(this.model&&this.model.get(this.model.nameAttribute)||this.isSummaryView())&&(this.model&&!1===this.model.get(r.VM_ACROPOLIS_VM)?(this.tableView.showClientMessage(this.MESSAGE_NON_ACROPOLIS_TAB),this.tableView.stopServices(),this.tableView.clearTable()):this.tableView&&(this.tableView.hideClientMessage(),this.tableView.refreshData(),this.tableView.startServices()))},_startTableViewService:function(e){this.tableView.setProxyClusterUuid(e),this.tableView.startServices()},destroy:function(){l.debug("AcropolisTabContentDetailsView : destroy: "," | viewid     : "+this.cid),this.tableView&&this.tableView.destroy(),e.prototype.destroy.apply(this,arguments)},_getClusterId:function(){if(this.model)return"DetailsEntityModel"===this.model.name?this.model.get(r.EB.CLUSTER_UUID):this.model.get(r.CLUSTER_ID)},onStartServices:function(){this.tableView&&((this.entityTypeTable===o.ENTITY_ACROPOLIS_SNAPSHOT||this.entityTypeTable===o.ENTITY_ACROPOLIS_NIC)&&this.model&&this.model.entityType===o.ENTITY_VM&&a.isMulticlusterNavMode()?this.model.getState()!==o.STATE_SUCCESS?this.model.on("change",function(){this._startTableViewService(this._getClusterId())}.bind(this)):this._startTableViewService(this._getClusterId()):this._startTableViewService()),this.delegateEvents()},onStopServices:function(){this.tableView&&this.tableView.stopServices(),this.model&&this.model.off("change"),this.undelegateEvents()}})}),define("views/details/tabs/AcropolisTasksTabContentDetailsView",["views/details/tabs/AcropolisTabContentDetailsView","data/DataURLConstants","utils/AppConstants"],function(e,t,i){"use strict";return e.extend({entityTypeTable:i.ENTITY_ACROPOLIS_TASK,render:function(){return this.$el.append(this.tableView.render().el),this},getDetailsTableURL:function(e){return _.template(t.getEntityTypeURL(this.tableView.entityType),{entityUuids:e})}})}),define("views/details/tabs/AcropolisNICsTabContentDetailsView",["views/details/tabs/AcropolisTabContentDetailsView","models/network/AcropolisNicModel","data/DataURLConstants","data/DataProperties","managers/NotificationManager","utils/AppConstants","utils/AppUtil","utils/EntityUtil"],function(e,t,i,n,s,a,r,o){"use strict";return e.extend({entityTypeTable:a.ENTITY_ACROPOLIS_NIC,initializeProperties:function(t){e.prototype.initializeProperties.apply(this,arguments),_.bindAll(this,"onButtonClick"),this.tableView.$el.on("click",".nic-action",this.onButtonClick)},render:function(){return this.$el.append(this.tableView.render().el),this.$el.closest(".n-tab-details-content").addClass("n-nic-details"),this},deleteNic:function(e){$.nutanixConfirm({msg:"Are you sure you want to delete the selected NIC?",yes:function(){var i=this;if(this.tableView.model.find(function(t){return t.get(n.VIRTUAL_NIC_MAC_ADDRESS)===e})){var l=new t;l.isFanout=!0,l.actionMode=a.ACTION_DELETE,l.useUhura=!0,l.set(t.DP.MAC_ADDRESS,e),l.vmId=this.model.get(n.UUID)||this.model.get(n.ID),l.setProxyClusterUuid(this.model.getClusterUuid()),o.createFanoutCollection(a.ENTITY_NIC,a.ACTION_DELETE,l).performFanout({success:function(e,t){l.onTaskSucceeded=function(){i.refreshView()},l.pollErgonTask(t[n.TASK_UUID])},error:function(e,t){s.showClientNotification(a.NOTIFY_ERROR,r.processAjaxError(t.responseText||t))}})}},yesText:"Yes",noText:"Cancel",context:this})},editNic:function(e){},destroy:function(){r.debug("AcropolisNICsTabContentDetailsView : destroy: "," | viewid     : "+this.cid),this.tableView&&this.tableView.$el.off("click",".nic-action",this.onButtonClick),e.prototype.destroy.apply(this,arguments)},getDetailsTableURL:function(e){return _.template(i.getEntityTypeURL(this.tableView.entityType),{entityId:e})},onButtonClick:function(e){var t=$(e.currentTarget).attr("action"),i=$(e.currentTarget).closest("span").attr("action-target");switch(t){case"edit":this.editNic(i);break;case"delete":this.deleteNic(i)}}})}),define("views/details/tabs/AcropolisSnapshotsTabContentDetailsView",["components/Components","views/details/tabs/AcropolisTabContentDetailsView","models/vm/AcropolisSnapshotModel","models/vm/AcropolisVMModel","managers/ActionManager","managers/acropolis/AcropolisNetworkManager","data/DataURLConstants","data/DataProperties","utils/AppConstants","utils/AppUtil","utils/EntityUtil"],function(e,t,i,n,s,a,r,o,l,c,u){"use strict";return t.extend({entityTypeTable:l.ENTITY_ACROPOLIS_SNAPSHOT,name:"AcropolisSnapshotsTabContentDetailsView",initializeProperties:function(e){t.prototype.initializeProperties.apply(this,arguments),_.bindAll(this,"onButtonClick"),this.tableView.$el.on("click",".snapshot-action",this.onButtonClick)},render:function(){return this.$el.append(this.tableView.render().el),this.$el.closest(".n-tab-details-content").addClass("n-snapshot-details"),this},destroy:function(){c.debug("AcropolisSnapshotsTabContentDetailsView : destroy: "," | viewid     : "+this.cid),this.tableView&&this.tableView.$el.off("click",".snapshot-action",this.onButtonClick),t.prototype.destroy.apply(this,arguments)},deleteSnapshot:function(e){$.nutanixConfirm({msg:this.i18n("deleteSnapshotMsg"),yes:function(){var t=new i;if(t.vmName=this.model.get(this.model.nameAttribute),t.actionMode=l.ACTION_DELETE,this.model.isFanoutSupported()){t.idAttribute=o.UUID,t.setId(c.getEntityIdWithoutClusterId(e));var n=u.createFanoutCollection(l.ENTITY_ACROPOLIS_SNAPSHOT,t.actionMode,t);t.setProxyClusterUuid(this.model.getClusterUuid()),n.performFanout()}else t.set(t.DP.UUID,e),t.destroy()},yesText:this.i18n("yes"),noText:this.i18n("cancel"),context:this})},cloneSnapshot:function(e){var t={};t[l.NAV_ACTION]=l.ACTION_CLONE,t[l.NAV_ACTION_TARGET]=l.ENTITY_ACROPOLIS_SNAPSHOT,t[l.NAV_ACTION_TARGET_ID]=e,this.model.isFanoutSupported()&&(t[l.NAV_ACTION_PARENT_ENTITY_TYPE]=l.ENTITY_CLUSTER,t[l.NAV_ACTION_PARENT_ID]=this.model.getClusterUuid()),s.executeAction(t)},isSnapshotNetworkDeleted:function(e){var t=this.snapshotCollection.findModelById(e),i=t.get(t.DP.SNAPSHOT_INFO),n=i&&c.get(i,t.DP.CREATE_SPEC+"."+t.DP.VM_NICS);if(!_.isArray(n))return!1;var s=n.map(function(e){return e.networkUuid}),r=a.getNetworkCollection();return _.any(s,function(e){return!r.findModelByUuid(e)})},restoreSnapshot:function(t){var i=this.i18n("restoreSnapshotMsg"),s=this.isSnapshotNetworkDeleted(t);if(s){i=e.icon("exclamation_badge")+" "+this.i18n("deleted_network_restore_warning")+"\n            <br/><br/>"+i}$.nutanixConfirm({msg:"",extHTML:i,yes:function(){var e=new n;if(e.vmId=this.model.get(this.model.idAttribute),e.vmName=this.model.get(this.model.nameAttribute),e.set(e.DP.SNAPSHOT_UUID,t),s&&e.set(e.DP.VM_RESTORE_NETWORK_CONFIG,!1),e.actionMode=l.ACTION_RESTORE,this.model.isFanoutSupported()){var i=u.createFanoutCollection(l.ENTITY_VM,e.actionMode,e);e.setProxyClusterUuid(this.model.getClusterUuid()),e.setId(c.getEntityIdWithoutClusterId(this.model.getId())),i.performFanout()}else e.save()},yesText:this.i18n("yes"),noText:this.i18n("cancel"),context:this})},showDetails:function(e){var t={};t[l.NAV_ACTION]=l.ACTION_SHOW,t[l.NAV_ACTION_TARGET]=l.ENTITY_ACROPOLIS_SNAPSHOT,t[l.NAV_ACTION_TARGET_ID]=e,this.model.isFanoutSupported()&&(t[l.NAV_ACTION_PARENT_ENTITY_TYPE]=l.ENTITY_CLUSTER,t[l.NAV_ACTION_PARENT_ID]=this.model.getClusterUuid()),s.executeAction(t)},getDetailsTableURL:function(e){return _.template(r.getEntityTypeURL(this.tableView.entityType),{vmId:e})},onButtonClick:function(e){var t=$(e.currentTarget).attr("action"),i=$(e.currentTarget).closest("span").attr("action-target");switch(t){case"details":this.showDetails(i);break;case"clone":this.cloneSnapshot(i);break;case"delete":this.deleteSnapshot(i);break;case"restore":this.restoreSnapshot(i)}}})}),define("text!templates/pages/vms/details/ConsoleSelector.html",[],function(){return'<select class="form-control console-selector">\n  <% _.each(consoles, function(console) { %>\n    <option value="<%= console.index %>">\n      <%= console.name %>\n    </option>\n  <% }); %>\n</select>\n'}),define("views/details/tabs/VNCConsoleTabContentDetailsView",["views/basecomponents/details/tabs/BaseTabContentDetailsView","views/basecomponents/iframe/IFrameView","data/DataProperties","data/DataURLConstants","utils/AppConstants","models/vm/AcropolisVMModel","managers/ClusterManager","managers/AccessManager","managers/AppManager","utils/AppUtil","utils/SubViewHelper","text!templates/pages/vms/details/ConsoleSelector.html"],function(e,t,i,n,s,a,r,o,l,c,u,d){"use strict";d=_.template(d);var h=_.template('<div class="powered-off-state-message"><%= text %></div>'),p={VNC:"VNC",VNC_INDEX:-1,COM:"COM",VM_NAME:"vnName",SERIAL_CLASS:"serial-console-iframe",ATTR_SERIAL_PORTS:"serial_ports",CONSOLE_SELECTOR:"select.console-selector",POWER_STATE:i.EB.VM.POWER_STATE,POWER_STATE_OFF:s.VM_POWER_STATE.OFF};return e.extend({MAX_LIVE_IFRAME:4,STATE_CONSOLE:{FAILED:"failed",FATAL:"fatal",NORMAL:"normal",DISCONNECTED:"disconnected",LOADED:"loaded"},PREFIX_IFRAME:"iFrameConsole-",name:"VNCConsoleTabContentDetailsView",extraClassName:"n-vnc-console-tab-content-details",subViewHelper:null,metricsDefault:null,lastAccessedMap:null,events:{"mouseenter .iFrameView":"onMouseEnterOnIFrame","change .console-selector":"onSelectorChange"},initializeProperties:function(e){this.lastAccessedMap={},this.subViewHelper=new u,this.acropolisModel=new a,_.bindAll(this,"onPowerStateChange"),this.currentModel.on("change:"+p.POWER_STATE,this.onPowerStateChange)},destroy:function(){this.subViewHelper.iterate("destroy"),this.subViewHelper=null,e.prototype.destroy.apply(this,arguments)},setModel:function(e){var t=this;this.model=e;var i=e.getId();this.serialPorts=null,this.acropolisModel.clear(),this.acropolisModel.set(this.acropolisModel.idAttribute,i,{silent:!0}),this.acropolisModel.includeVMDiskSizes=!0,this.acropolisModel.includeAddressAssignments=!0,this.acropolisModel.fetch({error:function(){t.changeConsoleView()}}).done(function(){t.serialPorts=t.acropolisModel.get(p.ATTR_SERIAL_PORTS),t.changeConsoleView()})},updateConsolesVisibility:function(){this.currentModel.get(p.POWER_STATE)===p.POWER_STATE_OFF?this.showPoweredOffStateMessage():this.hidePoweredOffStateMessage()},hidePoweredOffStateMessage:function(){var e=this.subViewHelper.get(this.currentModelId);e&&e.$el.removeClass("hidden"),this.$(".powered-off-state-message").remove()},showPoweredOffStateMessage:function(){this.hidePoweredOffStateMessage(),this.$(".iFrameView").addClass("hidden"),this.$el.prepend(h({text:this.i18n("powered_off_vm_message_text")}))},changeConsoleView:function(e){var i=this.currentModelId;e=Number(e||p.VNC_INDEX),this.$(".iFrameView").hide();var n=this.subViewHelper.get(i);if(!n){var s;s=r.getCurrentClusterModel();var a=!!s&&s.isAmfOverEsxBasicSupported(),o=this.createPrismletURL(a,i,e);n=new t({iFrameId:this.getIFrameId(),url:o,width:"100%",height:"680px"}),this.$el.append(n.render().el),this.subViewHelper.register(i,n)}var l=this.getConsoles();if(l&&l.length>1){if(this.$(p.CONSOLE_SELECTOR).length<=0){var c=d({consoles:l});this.$el.append(c)}this.isSerialConsole(e)?this.$el.addClass(p.SERIAL_CLASS):this.$el.removeClass(p.SERIAL_CLASS)}else this.$(p.CONSOLE_SELECTOR).remove();this.processActiveIFrameConsole(),this.updateConsolesVisibility()},getConsoles:function(){var e=[{name:p.VNC,index:p.VNC_INDEX}];return _.each(this.serialPorts,function(t){e.push({name:p.COM+(t.index+1),index:t.index})}),e},onSelectorChange:function(e){this.subViewHelper.remove(this.currentModelId),this.changeConsoleView(this.$(e.target).val())},isSerialConsole:function(e){return e!==p.VNC_INDEX},createPrismletURL:function(e,t,a){if(c.useReactVnc())return n.RVNC_URL({vmId:this.model.get(i.UUID),env:l.getVncEnvironment(),mode:s.VNC_MODE.ATTACHED});if(this.isSerialConsole(a)){var r=this.model.get(i.UUID);return n.SERIAL_CONSOLE_URL({vmId:r,vmName:this.model.get(p.VM_NAME)||r,portIndex:a})}return n.VNC_URL({uuid:c.getEntityIdWithoutClusterId(this.model.get(i.UUID)),vmName:this.model.get(i.VM_NAME),attached:!0,useUhura:e,useV3:!0,noV1Access:!o.hasAccessV1()})},processActiveIFrameConsole:function(){var e=this.subViewHelper.get(this.currentModelId);e&&(e.$el.show(),this.focusOnActiveIFrameWindow(),this.refreshActiveIFrameWindow(),this.updateLastAccessedMap())},refreshActiveIFrameWindow:function(){e.prototype.refreshView.apply(this,arguments);var t=this.getActiveIFrameWindow();if(t&&t.onscriptsload&&t.getConsoleState){var i=t.getConsoleState();i!==this.STATE_CONSOLE.NORMAL&&t.onscriptsload(),c.debug("VNCConsoleTabContentDetailsView : console state :"+i)}},getIFrameId:function(){return this.currentModelId.replace(/(\.|\#|\:)/g,"")},getActiveIFrameWindow:function(){var e=this.getIFrameId(),t=this.$("#"+e);return t&&t.length?t[0].contentWindow:null},focusOnActiveIFrameWindow:function(){var e=this.getActiveIFrameWindow();this.$el.is(":visible")&&e&&setTimeout(function(){e.focus()},1500),this.lastAccessedMap[this.currentModelId]=(new Date).getTime()},updateLastAccessedMap:function(){var e,t=0,i=(new Date).getTime();if(_.each(this.lastAccessedMap,function(n,s){n<i&&(i=n,e=s),t++}),e&&t>this.MAX_LIVE_IFRAME){var n=this.subViewHelper.get(e);n&&(this.subViewHelper.remove(e),n&&n.$el&&n.$el.remove(),delete this.lastAccessedMap[e])}},onMouseEnterOnIFrame:function(){var e=this.getActiveIFrameWindow();this.$el.is(":visible")&&e&&e.focus()},onPowerStateChange:function(){this.updateConsolesVisibility()},onStartServices:function(){this.delegateEvents();var e=this.subViewHelper.get(this.currentModelId);e&&(e.startServices(),this.processActiveIFrameConsole())},onStopServices:function(){this.undelegateEvents(),this.subViewHelper&&this.subViewHelper.iterate("stopServices")}})}),define("text!templates/pages/hardware/details/HostNicTabDetailsEntityView.html",[],function(){return'<div class="n-host-nic-metrics">\n  \x3c!-- @view: Tab details view goes here... --\x3e\n</div>\n'}),define("views/basecomponents/datatables/host/HostNicTableView",["views/basecomponents/datatables/DetailsTableTabView","data/DataProperties","models/switch/PhysicalNicCollection","models/hardware/HostCollection","utils/AppConstants","utils/StatsUtil","managers/ClusterManager","views/basecomponents/charts/groups/MetricGroupChartView","text!templates/pages/hardware/details/HostNicTabDetailsEntityView.html"],function(e,t,i,n,s,a,r,o,l){"use strict";return e.extend({className:"n-host-nic-table",physicalNicCollection:null,physicalNicModel:null,hostCollection:null,defaultTab:s.TAB_DETAILS.METRICS,tabDetailsClassName:"n-host-nic-metrics",tabClassName:"n-host-nic-tabs",columns:null,detailsTemplate:_.template(l),modelEvents:{"reset  physicalNicCollection":"renderHostNicTable"},attachRowTargetId:!0,events:{"click .n-host-nic-table .detailsTable tbody > tr":"onClickOverRow","click .n-host-nic-table .n-tab-details-button":"onClickTab"},initialize:function(a){e.prototype.initialize.apply(this,arguments),this.hostCollection=new n,this.hostCollection.setProjection([s.PROJECTION.STATS]),this.physicalNicCollection=new i,this.physicalNicCollection.setProjection([s.PROJECTION.STATS]);var r=this;this.columns=[{sTitle:"Host Nic",mData:t.PHYSICAL_NIC_NAME,sWidth:"20%"},{sTitle:"Speed (in Kbps)",mData:t.PHYSICAL_NIC_LINK_SPEED,sWidth:"10%"},{sTitle:"MAC Address",mData:t.PHYSICAL_NIC_MAC_ADDRESS,sWidth:"10%"},{sTitle:"Rx Pkts",mData:function(e,i,n){return e[t.STATS_NETWORK_TOTAL_RECEIVED_PACKETS]},sWidth:"10%",mRender:function(e,t,i){return r.formatStatsValue(s.METRIC_TOTAL_RECEIVED_PACKETS,e,t,i,!1)}},{sTitle:"Tx Pkts",mData:function(e,i,n){return e[t.STATS_NETWORK_TOTAL_TRANSMITTED_PACKETS]},sWidth:"10%",mRender:function(e,t,i){return r.formatStatsValue(s.METRIC_TOTAL_TRANSMITTED_PACKETS,e,t,i,!1)}},{sTitle:"Dropped Rx Pkts",mData:function(e,i,n){return e[t.STATS_NETWORK_DROPPED_RECEIVED_PACKETS]},sWidth:"10%",sClass:"n-dropped-packets-received",mRender:function(e,t,i){return r.formatStatsValue(s.METRIC_DROPPED_RECEIVED_PACKETS,e,t,i,!1)}},{sTitle:"Dropped Tx Pkts",mData:function(e,i,n){return e[t.STATS_NETWORK_DROPPED_TRANSMITTED_PACKETS]},sWidth:"10%",sClass:"n-dropped-packets-transmitted",mRender:function(e,t,i){return r.formatStatsValue(s.METRIC_DROPPED_TRANSMITTED_PACKETS,e,t,i,!1)}},{sTitle:"Rx Pkt Errors",mData:function(e,i,n){return e[t.STATS_NETWORK_ERROR_RECEIVED_PACKETS]},sWidth:"10%",sClass:"n-rx-error",mRender:function(e,t,i){return r.formatStatsValue(s.METRIC_ERROR_RECEIVED_PACKETS,e,t,i,!1)}},{sTitle:"Tx Pkt Errors",mData:function(e,i,n){return e[t.STATS_NETWORK_ERROR_TRANSMITTED_PACKETS]},sWidth:"10%",sClass:"n-tx-error",mRender:function(e,t,i){return r.formatStatsValue(s.METRIC_ERROR_TRANSMITTED_PACKETS,e,t,i,!1)}}],this.tabNames[s.TAB_DETAILS.METRICS]=s.TAB_DETAILS_NAMES.METRICS},render:function(){return e.prototype.render.apply(this,arguments),this.$el.append(this.detailsTemplate),r.isMulticlusterNavMode()||this.renderTabsView(),this},setModelId:function(e){this.physicalNicCollection.setHostId(e),this.refreshData(),this.$("."+this.tabDetailsClassName).hide()},onStartServices:function(){e.prototype.onStartServices.apply(this,arguments),this.selectTabHeader(this.currentTab),this.delegateModelEvents(),this.physicalNicCollection&&!this.physicalNicCollection.isPolling()&&this.physicalNicCollection.startPolling()},onStopServices:function(){e.prototype.onStopServices.apply(this,arguments),this.undelegateModelEvents(),this.physicalNicCollection&&this.physicalNicCollection.stopPolling(),this.subViewHelper.iterate("stopServices")},refreshData:function(){this.hostCollection.fetch(),this.physicalNicCollection.attachedHostId&&this.physicalNicCollection.fetch()},onClickOverRow:function(e){this.$("."+this.tabDetailsClassName).show();var t=e.currentTarget;this.physicalNicModel=this.dataTable.fnGetData(t),this.dataTable&&t&&(this.dataTable.$("tr.row_selected").removeClass("row_selected"),$(t).addClass("row_selected")),r.isMulticlusterNavMode()||this.refreshTabDetails()},refreshTabDetails:function(){var e=this.hostCollection.get(this.physicalNicCollection.attachedHostId);if(e){var i=this.subViewHelper.get(this.currentTab);i.fetchOnDemand(this.physicalNicModel[t.PHYSICAL_NIC_ID],s.ENTITY_PHYSICAL_NIC,e.get(t.SERVICE_VM_ID),s.ENTITY_HOST),i.$el.show(),i.startServices()}},getTabView:function(e){var i;return e===s.TAB_DETAILS.METRICS&&(i=new o({entityType:s.ENTITY_PHYSICAL_NIC,entityParentType:s.ENTITY_HOST,metrics:[t.STATS_NETWORK_RECEIVED_RATE,t.STATS_NETWORK_TRANSMITTED_RATE,t.STATS_NETWORK_DROPPED_RECEIVED_PACKETS,t.STATS_NETWORK_DROPPED_TRANSMITTED_PACKETS,t.STATS_NETWORK_ERROR_RECEIVED_PACKETS]})),i},renderHostNicTable:function(){this.updateDataSource(this.physicalNicCollection.toJSON({includeCustomAttributes:!0}))},formatStatsValue:function(e,t,i,n,r){return i===s.TABLE_COL_TYPE_DISPLAY||i===s.TABLE_COL_TYPE_EXPORT?a.statsFormat(e,t,r):t}})}),define("views/details/tabs/HostNicTabContentDetailsView",["views/basecomponents/details/tabs/BaseTabContentDetailsView","views/basecomponents/datatables/host/HostNicTableView","utils/AppConstants","utils/AppUtil"],function(e,t,i,n){"use strict";return e.extend({tableView:null,entityType:i.ENTITY_PHYSICAL_NIC,initializeProperties:function(e){this.tableView=new t({entityType:i.ENTITY_PHYSICAL_NIC,pageId:e.pageId})},render:function(){return this.$el.append(this.tableView.render().el),this},postSetModelId:function(t){e.prototype.postSetModelId.apply(this,arguments),this.tableView&&this.tableView.setModelId(t)},destroy:function(){n.debug("HostNicTabContentDetailsView : destroy: "," | viewid     : "+this.cid),this.tableView&&this.tableView.destroy(),e.prototype.destroy.apply(this,arguments)},onStartServices:function(){this.tableView&&this.tableView.startServices(),this.delegateEvents()},onStopServices:function(){this.tableView&&this.tableView.stopServices(),this.undelegateEvents()}})}),define("models/switch/PhysicalSwitchInterfaceModel",["models/PollingModel","data/DataURLConstants","data/DataProperties","utils/AppConstants"],function(e,t,i,n){"use strict";return e.extend({idAttribute:i.PHYSICAL_SWITCH_INTERFACE_ID,urlRoot:t.SWITCH_INTERFACE,entityType:n.ENTITY_PHYSICAL_SWITCH_INTERFACE,name:"PhysicalSwitchInterfaceModel",defaults:{id:null,portNum:null,name:null,description:null,type:null,index:0,mtuInBytes:0,speedInKbps:0,macAddress:null,lastChangeTime:null,attachedHostId:null,switchId:null,attachedHostNicIds:[],switchManagementAddress:null},toJSON:function(t){var n=e.prototype.toJSON.apply(this,arguments);if(t&&t.includeCustomAttributes){var s=this.get(i.STATS);n[i.STATS_NETWORK_ADMIN_STATUS]=s[i.STATS_NETWORK_ADMIN_STATUS],n[i.STATS_NETWORK_RECEIVED_BYTES]=s[i.STATS_NETWORK_RECEIVED_BYTES],n[i.STATS_NETWORK_OPERATION_STATUS]=s[i.STATS_NETWORK_OPERATION_STATUS],n[i.STATS_NETWORK_TRANSMITTED_BYTES]=s[i.STATS_NETWORK_TRANSMITTED_BYTES],n[i.STATS_NETWORK_UNICAST_RECEIVED_PACKETS]=s[i.STATS_NETWORK_UNICAST_RECEIVED_PACKETS],n[i.STATS_NETWORK_DISCARD_RECEIVED_PACKETS]=s[i.STATS_NETWORK_DISCARD_RECEIVED_PACKETS],n[i.STATS_NETWORK_ERROR_RECEIVED_PACKETS]=s[i.STATS_NETWORK_ERROR_RECEIVED_PACKETS],n[i.STATS_NETWORK_ERROR_TRANSMITTED_PACKETS]=s[i.STATS_NETWORK_ERROR_TRANSMITTED_PACKETS],n[i.STATS_NETWORK_UNICAST_TRANSMITTED_PACKETS]=s[i.STATS_NETWORK_UNICAST_TRANSMITTED_PACKETS],n[i.STATS_NETWORK_DISCARD_TRANSMITTED_PACKETS]=s[i.STATS_NETWORK_DISCARD_TRANSMITTED_PACKETS],n[i.STATS_NETWORK_UNSUPORTED_PROTOCOL_RECEIVED_PACKETS]=s[i.STATS_NETWORK_UNSUPORTED_PROTOCOL_RECEIVED_PACKETS]}return n}})}),define("models/switch/PhysicalSwitchInterfaceCollection",["models/PollingCollection","models/switch/PhysicalSwitchInterfaceModel","data/DataURLConstants"],function(e,t,i){"use strict";return e.extend({model:t,url:i.SWITCH_INTERFACE,attachedSwitchId:null,name:"PhysicalSwitchInterfaceCollection",setSwitchId:function(e){this.attachedSwitchId=e,this.url=i.SWITCH+"/"+this.attachedSwitchId+"/"+i.SWITCH_INTERFACE}})}),define("text!templates/pages/hardware/details/PhysicalSwitchInterfaceTabDetailsEntityView.html",[],function(){return'<div class="n-switch-interface-metrics">\n  \x3c!-- @view: Tab details view goes here... --\x3e\n</div>\n'}),define("views/basecomponents/datatables/switch/PhysicalSwitchInterfaceTableView",["views/basecomponents/datatables/DetailsTableTabView","views/basecomponents/datatables/DataTableColumnProvider","data/DataProperties","models/switch/PhysicalSwitchInterfaceCollection","models/hardware/SwitchCollection","utils/AppConstants","utils/StatsUtil","managers/ClusterManager","views/basecomponents/charts/groups/MetricGroupChartView","text!templates/pages/hardware/details/PhysicalSwitchInterfaceTabDetailsEntityView.html"],function(e,t,i,n,s,a,r,o,l,c){"use strict";return e.extend({className:"n-switch-interface-table",physicalSwitchInterfaceCollection:null,physicalSwitchInterfaceModel:null,switchCollection:null,tabContents:{},defaultTab:a.TAB_DETAILS.METRICS,
tabDetailsClassName:"n-switch-interface-metrics",tabClassName:"n-switch-interface-tabs",columns:null,detailsTemplate:_.template(c),modelEvents:{"reset  physicalSwitchInterfaceCollection":"renderPhysicalSwitchInterfaceTable"},attachRowTargetId:!0,events:{"click .n-switch-interface-table .detailsTable tbody > tr":"onClickOverRow","click .n-switch-interface-table .n-tab-details-button":"onClickTab"},initialize:function(i){e.prototype.initialize.apply(this,arguments),this.switchCollection=new s,this.switchCollection.setProjection([a.PROJECTION.STATS]),this.physicalSwitchInterfaceCollection=new n,this.physicalSwitchInterfaceCollection.setProjection([a.PROJECTION.STATS]),this.columns=t.getDataColumns(a.ENTITY_PHYSICAL_SWITCH_INTERFACE),this.tabNames[a.TAB_DETAILS.METRICS]=a.TAB_DETAILS_NAMES.METRICS},render:function(){return e.prototype.render.apply(this,arguments),this.$el.append(this.detailsTemplate),o.isMulticlusterNavMode()||this.renderTabsView(),this},setModelId:function(e){this.physicalSwitchInterfaceCollection.setSwitchId(e),this.refreshData(),this.$("."+this.tabDetailsClassName).hide()},onStartServices:function(){e.prototype.onStartServices.apply(this,arguments),this.selectTabHeader(this.currentTab),this.delegateModelEvents(),this.physicalSwitchInterfaceCollection&&!this.physicalSwitchInterfaceCollection.isPolling()&&this.physicalSwitchInterfaceCollection.startPolling()},onStopServices:function(){e.prototype.onStopServices.apply(this,arguments),this.undelegateModelEvents(),this.physicalSwitchInterfaceCollection&&this.physicalSwitchInterfaceCollection.stopPolling(),this.subViewHelper.iterate("stopServices")},refreshData:function(){this.switchCollection.fetch(),this.physicalSwitchInterfaceCollection.attachedSwitchId&&this.physicalSwitchInterfaceCollection.fetch()},onClickOverRow:function(e){this.$("."+this.tabDetailsClassName).show();var t=e.currentTarget;this.physicalSwitchInterfaceModel=this.dataTable.fnGetData(t),this.dataTable&&t&&(this.dataTable.$("tr.row_selected").removeClass("row_selected"),$(t).addClass("row_selected")),o.isMulticlusterNavMode()||this.refreshTabDetails()},refreshTabDetails:function(){var e=this.switchCollection.get(this.physicalSwitchInterfaceCollection.attachedSwitchId);if(e){var t=this.subViewHelper.get(this.currentTab);t.fetchOnDemand(this.physicalSwitchInterfaceModel[i.PHYSICAL_SWITCH_INTERFACE_ID],a.ENTITY_PHYSICAL_SWITCH_INTERFACE,e.get(i.SWITCH_ID),a.ENTITY_SWITCH),t.$el.show(),t.startServices()}},getTabView:function(e){var t;return e===a.TAB_DETAILS.METRICS&&(t=new l({entityType:a.ENTITY_PHYSICAL_SWITCH_INTERFACE,entityParentType:a.ENTITY_SWITCH,metrics:[i.STATS_NETWORK_UNICAST_RECEIVED_PACKETS,i.STATS_NETWORK_UNICAST_TRANSMITTED_PACKETS,i.STATS_NETWORK_DISCARD_TRANSMITTED_PACKETS,i.STATS_NETWORK_DISCARD_RECEIVED_PACKETS,i.STATS_NETWORK_ERROR_RECEIVED_PACKETS]})),t},renderPhysicalSwitchInterfaceTable:function(){this.updateDataSource(this.physicalSwitchInterfaceCollection.toJSON({includeCustomAttributes:!0}))},formatStatsValue:function(e,t,i,n,s){return i===a.TABLE_COL_TYPE_DISPLAY||i===a.TABLE_COL_TYPE_EXPORT?r.statsFormat(e,t,s):t}})}),define("views/details/tabs/PhysicalSwitchInterfaceTabContentDetailsView",["views/basecomponents/details/tabs/BaseTabContentDetailsView","views/basecomponents/datatables/switch/PhysicalSwitchInterfaceTableView","utils/AppConstants","utils/AppUtil"],function(e,t,i,n){"use strict";return e.extend({tableView:null,entityType:i.ENTITY_PHYSICAL_SWITCH_INTERFACE,initializeProperties:function(e){this.tableView=new t({entityType:i.ENTITY_PHYSICAL_SWITCH_INTERFACE,pageId:e.pageId})},render:function(){return this.$el.append(this.tableView.render().el),this},postSetModelId:function(t){e.prototype.postSetModelId.apply(this,arguments),this.tableView&&this.tableView.setModelId(t)},destroy:function(){n.debug("PhysicalSwitchInterfaceTabContentDetailsView : destroy:  | viewid     : "+this.cid),this.tableView&&this.tableView.destroy(),e.prototype.destroy.apply(this,arguments)},onStartServices:function(){this.tableView&&this.tableView.startServices(),this.delegateEvents()},onStopServices:function(){this.tableView&&this.tableView.stopServices(),this.undelegateEvents()}})}),define("views/details/tabs/SummaryTabContentDetailsView",["views/basecomponents/details/tabs/BaseTabContentDetailsView","views/details/tabs/MetricTabContentDetailsView","utils/SubViewHelper","managers/EntityManager"],function(e,t,i,n){"use strict";return e.extend({extraClassName:"n-summary-tab-content-details -summary multi-col",subViewHelper:null,initialize:function(t){e.prototype.initialize.apply(this,arguments),this.subViewHelper=new i,_.bindAll(this,"_initSummaryViewContent")},render:function(){return this.isViewRendered||(this.$el.html('<section class="page-left detailsSummary"></section>'),this.$el.append('<section class="page-right"></section>'),n.loadEntitySummaryViewContents(this.entityType,this._initSummaryViewContent)),this},createRightPaneView:function(e){var i=new t({el:e,pageId:this.pageId,entityType:this.entityType});return i.setModelId(this.model.getId()),i.setModel(this.model),i},_initSummaryViewContent:function(e){var t=new e({el:this.$(".page-left"),model:this.model});this.subViewHelper.register("leftPane",t);var i=this.createRightPaneView(this.$(".page-right"));this.subViewHelper.register("rightPane",i),this.isViewRendered=!0,this.onStartServices()},destroy:function(){e.prototype.destroy.apply(this,arguments),this.subViewHelper&&(this.subViewHelper.destroy(),this.subViewHelper=null)},onStartServices:function(){this.isViewRendered&&(this.delegateEvents(),this.subViewHelper&&this.subViewHelper.iterate("startServices"))},onStopServices:function(){this.undelegateEvents(),this.subViewHelper&&this.subViewHelper.iterate("stopServices")}})}),define("models/alert/AlertCauseResolutionModel",["models/BaseModel","data/DataURLConstants","utils/AppConstants"],function(e,t,i){"use strict";var n={IS_ALERT:"hasGlobalDetails",CAUSE:"cause",DETAILS:"details",ADDITIONAL_LINKS:"additionalLinks",CHART_QUERIES:"chartQueries",ACTIONS:"actions",TROUBLESHOOTING_STEPS:"troubleshootingSteps",CHART_MODELS:"chartModels"};return e.extend({urlRoot:t.ALERT_CAUSE_RESOLUTIONS,name:"AlertCauseResolutionModel",entityType:i.ENTITY_ALERT_CAUSE_RESOLUTION,DP:n,defaults:{cause:null,details:null,additionalLinks:[],chartQueries:[],actions:null,troubleshootingSteps:null,chartModels:[]},idParserFunc:function(){return this.cid},isAlert:function(){return this.get(n.IS_ALERT)}},{DP:n})}),define("models/alert/AlertCauseResolutionCollection",["models/BaseCollection","models/alert/AlertCauseResolutionModel","data/DataURLConstants"],function(e,t,i){"use strict";return e.extend({model:t,url:i.ALERT_CAUSE_RESOLUTIONS,name:"AlertCauseResolutionCollection",initialize:function(t,i){this.url=_.template(this.url)({id:i.alertTypeUuid,alertUuid:i.alertUuid||""}),e.prototype.initialize.apply(this,arguments)}})}),define("text!templates/pages/alerts/details/AlertCauseChartView.html",[],function(){return'<div class="n-chart-header">\n  <div class="n-chart-title">\n  </div>\n  <div class="n-chart-value legends">\n</div>\n<div class="chartBody chart-body">\n  <span class="loading">Loading...</span>\n</div>\n<div class="noDataBody no-data-body hide">\n  <div class="n-chart-no-data">\n    No data available\n  </div>\n</div>\n<div class="chartFooter chart-footer"></div>\n'}),define("views/pages/alerts/details/AlertMetricChartView",["flotr2","views/basecomponents/charts/simple/TimelineChartView","text!templates/pages/alerts/details/AlertCauseChartView.html","utils/AppConstants","utils/AppUtil","utils/AlertUtil","utils/StyleDescriptor","utils/StatsUtil","utils/TimeUtil","components/Components"],function(e,t,i,n,s,a,r,o,l,c){"use strict";var u=_.template('<span class="legend-box"><span class="metric-box" style="background: #<%=colorHex%>;"></span><span class="chart-data-value"><%= name %></span></span>'),d=_.template('<div class="alert-mark <%= severity %>"><span class="glyphicon glyphicon-bell">'+c.icon("D","alert-bell")+"</span></div>"),h=_.template('<div class="n-alert-severity -<%= severity %>"><%= formattedseverity %></div><div class="message"><%= message %></div><% if (criteria) { %><div class="criteria"><%= criteria %></div><% } %><% if (actualValue) { %><div class="value"><%= actualValue %></div><% } %><div class="timestamp"><%= timestamp %>'),p=r.getAllChartColors();return t.extend({name:"AlertMetricChartView",modelEvents:{"change model":"updateChartData","error model":"showNoData"},idColorMapping:null,initializeStatsProperties:function(e){this.mainColor=r.getChartColor(e.metricType),this.title=e.title,_.bindAll(this,"xAxisTickFormatter","yAxisTickFormatter"),this.render()},render:function(){return this.$el.html(i),this.$(".n-chart-title").html(this.title||"&nbsp;"),this.isMetricSupportedByAnalysisPage()&&this.createActionMenu(),this},onStartServices:function(){t.prototype.onStartServices.apply(this,arguments),this.delegateModelEvents(),this.startModelFetch()},onStopServices:function(){t.prototype.onStopServices.apply(this,arguments),this.undelegateModelEvents(),this.$(".glyphicon-bell").tooltip("destroy"),$(".alert-chart-tooltip").remove(),this.stopModelFetch()},startModelFetch:function(){this.model.startPolling({alwaysTriggerChange:!0})},stopModelFetch:function(){this.model&&this.model.stopPolling()},renderChart:function(){var t=this.getChartContainer(),i=this.getChartData();if(this.hasChartData(i)){if(this.showChart(),t&&!t.clientWidth)return;this.graph=e.draw(t,i,this.getChartOptions()),this.renderLegend(i),this.renderAlert()}else this.showNoData()},getChartOptions:function(){var e=this.getYAxisRange();return{colors:this.mainColor,shadowSize:0,fontColor:"#999999",xaxis:{mode:"time",timeMode:"local",labelsAngle:45,min:this.getTimeRangeMin(),max:this.getTimeRangeMax(),tickFormatter:this.xAxisTickFormatter,metricType:this.options.metricType},yaxis:{max:e.max,min:e.min,tickFormatter:this.yAxisTickFormatter,tickDecimals:0,noTicks:3,metricType:this.options.metricType},grid:{color:"#"+r.APP_COLORS.Gray[1],tickColor:"#"+r.APP_COLORS.Gray[3],verticalLines:!1,horizontalLines:!0,minorHorizontalLines:!1,minorVerticalLines:!1,outlineWidth:.5,outline:"s"},mouse:{track:!0,trackAll:!0,relative:!0,position:"ew",margin:6,lineColor:"#333333",trackFormatter:this.toolTipTrackFormatter,metricType:this.options.metricType,mouseTrackOverride:this.mouseTrackOverride},plotOffsetOveride:function(e){e.left=0}}},hasChartData:function(){return this.graphData&&this.graphData.length},getChartData:function(){var e=this.options.alertSummaryModel,t=e.DP,i=this.options.metricDetails,s=[{data:this.processData(),color:this.mainColor[0],lines:{show:!0,fill:!1,lineWidth:1},legend:e.get(t.AFFECTED_ENTITIES)[0].entity_name}];if(i){var a=[[this.getTimeRangeMin(),i.threshold],[this.getTimeRangeMax(),i.threshold]],o=r.getAlertThresholdColor(n.ALERT_HEALTH[n.ALERT_SUMMARY_SEVERITY_MAPPING[i.severity]]);s.unshift({data:a,lines:{lineWidth:1,fill:!1,color:"#"+o}})}return s},renderLegend:function(e){var t=!0,i=_.map(e,function(e,i){if(e.legend){t=!1;var n=e.color||p[i%p.length];return u({colorHex:n.replace("#",""),name:s.truncateMiddle(e.legend,20)})}}).join("");t||this.$(".legends").html(i)},renderVerticalLine:function(e,t,i){var n=o.toMilliseconds(e),s=this.getTimeRangeMin(),a=this.getTimeRangeMax(),r=this.getChartContainer().clientWidth,l=this.getChartContainer().clientHeight,c=$(d(this.vtOptions({severity:t}))),u=r/(a-s)*(n-s),h=l-22;c.css("left",u+"px").css("height",h+"px"),this.$(".chartBody").append(c),$(".alert-chart-tooltip").remove(),c.find(".glyphicon-bell").tooltip("destroy").tooltip({title:i,placement:u>r/2?"left":"right",trigger:"hover",container:"body",template:'<div class="tooltip alert-chart-tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',html:!0})},isMetricSupportedByAnalysisPage:function(){return!1},renderAlert:function(){var e=this.options.alertSummaryModel,t=this.options.metricDetails;if(t){var i,s,r=(e.DP,this.i18n("alert_created_msg"));i=t.metricValue,s=t.threshold,i&&(i=this.i18n("alert_actual_value_label")+this.yAxisTickFormatter(i)),s&&(s=this.i18n("alert_criteria_label")+this.title+t.comparator+this.yAxisTickFormatter(s)),this.renderVerticalLine(t.timestamp,t.severity,h({message:r,criteria:s,actualValue:i,timestamp:l.formatFullDateTime(o.toMilliseconds(t.timestamp)),severity:n.ALERT_SEVERITY_NAMES[t.severity],formattedseverity:a.formatSeverity(t.severity)}))}},yAxisTickFormatter:function(e){return o.isStorageStats(this.options.metricType)?o.processStorageStats(e,!0,!1):o.statsFormat(this.options.metricType,e)},getYAxisRange:function(){var e,t,i=1;return _.each(this.getChartData(),function(i){_.each(i.data,function(i){void 0===e&&(e=i[1]),void 0===t&&(t=i[1]),i[1]>e?e=i[1]:i[1]<t&&(t=i[1])})}),e>1&&e>t&&(i=Math.ceil(.3*(e-t))),e+=i,t=t>10?t-i:0,{max:e,min:t}}})}),define("views/pages/alerts/details/AlertCauseChartView",["views/pages/alerts/details/AlertMetricChartView","managers/EntityManager","data/DataProperties","utils/AppConstants","utils/StyleDescriptor","utils/AppUtil","utils/StatsUtil","utils/EntityUtil"],function(e,t,i,n,s,a,r,o){"use strict";var l=s.getAllChartColors();return e.extend({className:"n-alert-cause-chart",modelEvents:{"sync model":"updateChartData","error model":"showNoData"},startModelFetch:function(){this.model.performQuery()},stopModelFetch:function(){},updateChartData:function(e){e&&(this.model=e,this.renderChart(),this._shouldFetchNames(e)&&this._fetchNames(e))},renderChart:function(){var t=this.model.stateMonitor.getState();return t===n.STATE_PENDING||t===n.STATE_INIT?void this.showLoading():t===n.STATE_ERROR?void this.showNoData():void e.prototype.renderChart.apply(this,arguments)},showChart:function(){e.prototype.showChart.call(this,arguments),this.$el.show()},showNoData:function(){this.$el.hide()},isMetricSupportedByAnalysisPage:function(){return!1},renderAlert:function(){var e=this.options.alertSummaryModel;this.renderVerticalLine(e.get(e.DP.CREATED_TIMESTAMP),e.get(e.DP.SEVERITY),e.getDescription())},hasChartData:function(e){return e&&e.length&&e!==r.STATS_NOT_AVAILABLE},getChartData:function(){var e,t,n=this,s=this.model.DP,o=!1;try{if(e=this.model.get(s.GROUP_RESULTS)[0],_.isEmpty(e[s.GROUP_SUMMARIES])){this.idColorMapping={};var c;t=e[s.ENTITY_RESULTS].map(function(e,t){var s=e.data[0].values.map(function(e){return[r.toMilliseconds(e.time),parseFloat(e.values[0])]});return s.length&&(o=!0),c=l[t%l.length],n.idColorMapping[e[i.ENTITY_ID_ATTR]]=c,{data:s,color:"#"+c,lines:{show:!0,fill:!1,lineWidth:1}}})}else{var u=e[s.GROUP_SUMMARIES],d=0;t=_.map(u,function(e,t){var i=[];return e.values&&(_.each(e.values,function(e){var t=r.toMilliseconds(e.time),n=parseFloat(e.value);t>0&&r.isValidStats(n)&&i.push([t,n])}),o=!0),{data:i,color:"#"+l[d++%l.length],lines:{show:!0,fill:!1,lineWidth:1},legend:t.split(":")[0]}})}return o?t:r.STATS_NOT_AVAILABLE}catch(e){return a.log("AlertCauseChartView : Fail to parse result: "+e),r.STATS_NOT_AVAILABLE}},_shouldFetchNames:function(e){var t=e.DP,i=e.get(t.GROUP_RESULTS)[0];return!!i&&!!_.isEmpty(i[t.GROUP_SUMMARIES])},_fetchNames:function(e){var n=_.keys(this.idColorMapping),s=this,r=a.getEntityTypeForUI(e.get(e.DP.ENTITY_TYPE)),l=t.getEntitySchema(r),c=l.get(l.DP.NAME_ATTR);o.getEntityAttributes(r,n,[c],{success:function(e){var t=e.get(e.DP.GROUP_RESULTS)[0],n=t[e.DP.ENTITY_RESULTS],a=_.map(n,function(e){return{legend:e.data[0].values[0].value,color:s.idColorMapping[e[i.ENTITY_ID_ATTR]]}});s.renderLegend(a)},error:function(){var e=_.map(n,function(e,t){return{legend:a.toUpperCaseFirstChar(r)+" "+(t+1),color:s.idColorMapping[e]}});s.renderLegend(e)}})}})}),define("models/alert/AlertCauseChartModel",["models/BaseModel","models/query/BaseQueryModel","data/DataURLConstants","data/DataProperties"],function(e,t,i,n){"use strict";var s=t.DP;return e.extend({idAttribute:n.ID,urlRoot:i.ENTITY_BROWSER_QUERY,name:"AlertCauseChartModel",DP:s,toJSON:function(){var t=e.prototype.toJSON.apply(this,arguments);return t[s.QUERY_NAME]="prism:"+this.name,t},showLatencyNotification:function(e,t){},showSuccessNotification:function(e,t,i){},triggerAppViewRefresh:function(){},performQuery:function(e){return this.save(null,e)},getMetricType:function(){return this.get(s.GROUP_ATTRIBUTES)&&this.get(s.GROUP_ATTRIBUTES)[0]?this.get(s.GROUP_ATTRIBUTES)[0].attribute:this.get(s.GROUP_MEMBER_ATTRIBUTES)&&this.get(s.GROUP_MEMBER_ATTRIBUTES)[0]?this.get(s.GROUP_MEMBER_ATTRIBUTES)[0].attribute:""}},{DP:s})}),define("text!templates/pages/alerts/details/AlertCauseResolutionView.html",[],function(){return'<div class="n-causeresolution">\n  \x3c!-- Header --\x3e\n  <div class="n-cr-header">\n    \x3c!-- Right part of the header --\x3e\n    <div class="n-cr-rightheader">\n      \x3c!-- TODO: Fetch from model and use ActionManager --\x3e\n      <div class="n-actionbtn-container">\n        <btn class="btn btnAction primary-btn">Action</btn>\n        <btn class="btn btnAnalyze"><%= i18nStatic(\'AlertCauseResolutionView\', \'analyze_further\') %></btn>\n      </div>\n    </div>\n    \x3c!-- Left part of the header --\x3e\n    <div class="n-cr-leftheader">\n      <div class="n-label n-reco"><%= i18nsStatic(\'AlertCauseResolutionView\', \'possible_cause\', showIndex ? index : \'\') %>\n      </div>\n      <div class="n-label n-cr-title"><%= title %></div>\n    </div>\n  </div>\n  \x3c!-- Body --\x3e\n  <div class="n-cr-body">\n    <div class="n-cause">\n      <div class="n-label"><%= i18nStatic(\'AlertCauseResolutionView\', \'recommendation\') %></div>\n      <div class="n-value"><%= actions %></div>\n    </div>\n    <% if (details) { %>\n      <div class="n-details">\n        <div class="n-label"><%= i18nStatic(\'AlertCauseResolutionView\', \'details\') %></div>\n        <div class="n-value"><%= details %></div>\n      </div>\n    <% } %>\n    <% if (troubleshootingSteps.length) { %>\n    <div class="n-troubleshooting">\n      <div class="n-label"><%= i18nStatic(\'AlertCauseResolutionView\', \'troubleshooting_steps\') %></div>\n      <ul class="n-troubleshooting-list">\n        <% _.each(troubleshootingSteps, function (step) { %>\n          <% if (step.subbullets && _.isArray(step.subbullets)) { %>\n          <li class="n-value"><%= step.text %>\n            <ul class="n-subbullet-list">\n            <% _.each(step.subbullets, function (subbullet) { %>\n              <li class="n-value"><%= subbullet %></li>\n            <% }); %>\n            </ul>\n          </li>\n          <% } else { %>\n          <li class="n-value"><%= step.text %></li>\n          <% } %>\n        <% }); %>\n      </ul>\n    </div>\n    <% } %>\n    <div class="n-helpful-links">\n      <div class="n-label"><%= i18nStatic(\'AlertCauseResolutionView\', \'helpful_links\') %></div>\n\n      \x3c!-- TODO: Fetch from model --\x3e\n      <div class="n-cr-links-container">\n        <div class="n-cr-link-0">\n          <a class="n-cr-links"><%= i18nStatic(\'AlertCauseResolutionView\', \'latency_increasing\') %></a>\n          <span class="n-sep"> | </span>\n          <span class="n-value"><%= i18nStatic(\'AlertCauseResolutionView\', \'kb_article\') %></span>\n        </div>\n\n        <div class="n-cr-link-1">\n          <a class="n-cr-links"><%= i18nStatic(\'AlertCauseResolutionView\', \'io_latency_issue\') %></a>\n          <span class="n-sep"> | </span>\n          <span class="n-value"><%= i18nStatic(\'AlertCauseResolutionView\', \'portal_forum_thread\') %></span>\n        </div>\n      </div>\n    </div>\n  </div>\n  <div class="n-cr-graph-container">\n  </div>\n</div>\n'}),define("views/pages/alerts/details/AlertCauseResolutionView",["views/basecomponents/BaseView","views/pages/alerts/details/AlertCauseChartView","models/alert/AlertCauseChartModel","utils/AlertUtil","utils/AppUtil","utils/SubViewHelper","text!templates/pages/alerts/details/AlertCauseResolutionView.html"],function(e,t,i,n,s,a,r){"use strict";var o=_.template(r),l=_.template('<% for (var key in pairs) { %><% if (pairs[key]) { %><div class="n-cr-key-value-pair"><div class="n-label"><%= key %></div><div class="n-value"><%= pairs[key] %></div></div> <% } %><% } %>'),c={TIME_SERIES:"TIME_SERIES",KEY_VALUE:"KEY_VALUE"};return e.extend({index:null,subViewHelper:null,events:{},initialize:function(e){e=e||{},this.index=e.index||"",this.showIndex=e.showIndex||!1,this.subViewHelper=new a,this.alertSummaryModel=e.alertSummaryModel},render:function(){var e=this.model.DP,t=this.alertSummaryModel.get(this.alertSummaryModel.DP.ALERT_TYPE_UUID),i=this.alertSummaryModel.get(this.alertSummaryModel.DP.CLUSTER_UUID),a=this.alertSummaryModel.get(this.alertSummaryModel.DP.SEVERITY),r=n.formatCause(this.model.get(e.CAUSE),t,a,i),l={index:this.index,showIndex:this.showIndex,title:r,cause:r,actions:this.model.get(e.ACTIONS),details:this.model.get(e.DETAILS),troubleshootingSteps:[]};try{var c=JSON.parse(this.model.get(e.TROUBLESHOOTING_STEPS));l.troubleshootingSteps=c||[]}catch(t){s.log("AlertCauseResolutionView : Fail to parse troubleshootingSteps: "+this.model.get(e.TROUBLESHOOTING_STEPS))}return this.$el.html(o(this.vtOptions(l))),this.$(".no-metadata-tooltip").tooltip({placement:"top",trigger:"hover",html:!1}),this._renderPerspectives(),this.model.isAlert()?this._hidePartsForAlert():this._hidePartsWithNoData(),this},onStartServices:function(){this.subViewHelper.iterate("startServices")},onStopServices:function(){this.subViewHelper.iterate("stopServices")},onResize:function(){this.subViewHelper.iterate("onResize")},destroy:function(){s.debug("AlertCauseResolutionView : destroy: "," | viewid     : "+this.cid),this.$(".no-metadata-tooltip").tooltip("destroy"),this.subViewHelper&&(this.subViewHelper.removeAll(),this.subViewHelper=null),e.prototype.destroy.apply(this,arguments)},_hidePartsWithNoData:function(){var e=this.model.DP,t=this.model.get(e.ADDITIONAL_LINKS),i=[];try{i=JSON.parse(this.model.get(e.TROUBLESHOOTING_STEPS))}catch(t){s.log("AlertCauseResolutionView : Fail to parse troubleshootingSteps: "+this.model.get(e.TROUBLESHOOTING_STEPS))}t||this.$(".n-helpful-links").hide(),i||this.$(".n-troubleshooting").hide(),this.$(".n-cr-leftbody > div").removeClass("n-horzseparator"),this.$(".n-cr-leftbody > div:visible:not(:last)").addClass("n-horzseparator")},_hidePartsForAlert:function(){this.$(".n-causeresolution").addClass("n-charts-only"),this.$(".n-cr-header").hide(),this.$(".n-cr-leftbody > div").hide(),this.$(".n-cr-graph-container").show()},_renderPerspectives:function(){var e=this.model.get(this.model.DP.CHART_QUERIES);if(e){var t=0;_.each(e.entities,function(e){_.each(e.perspectives,function(e){e.format===c.TIME_SERIES?this._renderChartPerspective(e,t++):e.format===c.KEY_VALUE&&this._renderKeyValuePerspective(e,t++)},this)},this)}},_renderChartPerspective:function(e,n){var a;try{a=JSON.parse(e.query)}catch(t){return void s.log("AlertCauseResolutionView : Fail to parse chartQueries: "+e.query)}var r=new i(a),o=$('<div class="n-cr-graphs n-cr-graph-'+n+'"> </div>');this.$(".n-cr-graph-container").append(o);var l=new t({model:r,el:o,title:e.metadata.title,metricType:r.getMetricType(),alertSummaryModel:this.alertSummaryModel});this.registerSubView(r.cid,l),l.startServices()},_renderKeyValuePerspective:function(e){this.$(".n-cr-graph-container").append(l({pairs:e.result}))}})}),define("views/pages/alerts/details/CauseResolutionGroupView",["views/basecomponents/BaseView","models/alert/AlertCauseResolutionCollection","data/DataProperties","views/pages/alerts/details/AlertCauseResolutionView","utils/AppUtil","utils/AppConstants","utils/SubViewHelper"],function(e,t,i,n,s,a,r){"use strict";var o=_.template('<div class="n-cr-container-<%= index %> n-container-padding"></div>');return e.extend({subViewHelper:null,collection:null,modelEvents:{"reset collection":"updateViews"},initialize:function(e){this.subViewHelper=new r,this.initializeModels(e)},initializeModels:function(e){this.alertSummaryModel=e.alertModel;var i=this.alertSummaryModel.DP;this.collection=new t(null,{alertTypeUuid:this.alertSummaryModel.get(i.ALERT_TYPE_UUID),alertUuid:this.alertSummaryModel.get(i.ID)})},render:function(){return this.collection.getState()===a.STATE_INIT?s.addInLineDonutLoader(this.$el):this.$el.html('<div class="n-group-view"></div>'),this},onStartServices:function(){this.delegateModelEvents(),this.collection.fetch()},onStopServices:function(){this.undelegateModelEvents(),this.collection.stopFetch(),this.subViewHelper.iterate("stopServices")},onResize:function(){this.subViewHelper.iterate("onResize")},updateViews:function(){this.render();var e=this.collection.length>1;this.collection.toArray().sort(function(e,t){if(e.isAlert())return-1;if(t.isAlert())return 1;var n=e.get(i.ID),s=t.get(i.ID);return n.localeCompare(s)}).forEach(function(t,i){this._renderIndividualViews(t,i,e)},this),this.subViewHelper.iterate("startServices"),this.options&&_.isFunction(this.options.onViewUpdate)&&this.options.onViewUpdate()},destroy:function(){s.debug("CauseResolutionGroupView : destroy: "," | viewid     : "+this.cid),this.subViewHelper&&(this.subViewHelper.iterate("stopServices"),this.subViewHelper.removeAll(),this.subViewHelper=null),e.prototype.destroy.apply(this,arguments)},_renderIndividualViews:function(e,t,i){var s,a;s=this._createSubviewContainer(t),a=new n({model:e,index:t+1,showIndex:i,el:s,alertSummaryModel:this.alertSummaryModel}),this.registerSubView(e.cid,a),a.render()},_createSubviewContainer:function(e){var t=o({index:e});return this.$(".n-group-view").append(t),this.$(".n-cr-container-"+e)}})}),define("text!templates/timeline/AnalysisChart.html",[],function(){return'<div class="chart-header">\n  <span class="chart-restore">\n    <i class="n-icon" aria-hidden="true" data-icon="x"></i>\n    Back |&nbsp;\n  </span>\n  <span class="chart-title dropdown">\n    <a data-toggle="dropdown" class="dropdown-toggle" href="#">\n      <span class="-title-text"><%- chartTitle %></span>\n      <i aria-hidden="true" data-icon="z"></i>\n    </a>\n    <ul class="dropdown-menu  dropdown-menu-left">\n      <li>\n        <a class="btnEditChart n-nav-link csv">\n          <i data-icon="F" aria-hidden="true"></i>\n          Edit Chart</a>\n      </li>\n      <li>\n        <a class="btnDeleteChart n-nav-link json">\n          <i data-icon="v" aria-hidden="true"></i>\n          Delete Chart</a>\n      </li>\n    </ul>\n  </span>\n  <span class="chart-btn save-transient"\n        title="This is a temporary chart. Click to save it.">\n    <i aria-hidden="true" data-icon="J"> </i>\n    &nbsp; Save Chart\n  </span>\n  <span class="chart-btn remove-transient"\n        title="This is a temporary chart. Click to remove it.">\n    <i aria-hidden="true" data-icon="v"> </i>\n    &nbsp; Remove Chart\n  </span>\n  <span class="chart-options dropdown">\n\n    <a data-toggle="dropdown" class="dropdown-toggle svg-href-ie-fix" href="#">\n      <%= SVG.SVGIcon("Export") %>\n    </a>\n    <ul class="dropdown-menu  dropdown-menu-right">\n      <li>\n        <a class="btnChartAction n-nav-link csv">\n          Export Chart Data (CSV)...</a>\n      </li>\n      <li>\n        <a class="btnChartAction n-nav-link json">\n          Export Chart Data (JSON)...</a>\n      </li>\n      <li>\n        <a class="btnChartAction n-nav-link url">\n          Chart Link...</a>\n      </li>\n    </ul>\n  </span>\n  <span class="chart-data"></span>\n  <span class="chart-size-selector">\n    <a title="Small chart size"\n       class="chart-size chart-size-s" data-size="s">Small</a>\n    &nbsp;&middot;&nbsp;\n    <a title="Medium chart size"\n       class="chart-size chart-size-m" data-size="m">Medium</a>\n    &nbsp;&middot;&nbsp;\n    <a title="Large chart size"\n       class="chart-size chart-size-l" data-size="l">Large</a>\n    &nbsp;&nbsp;\n  </span>\n</div>\n<div class="chart-content <%=sizeClass%>"></div>\n<div class="chart-footer"></div>\n'}),define("views/timeline/AnalysisBaseChartView",["jquery","backbone","flotr2","bootstrap","views/basecomponents/BaseView","utils/AppUtil","text!templates/timeline/AnalysisChart.html"],function(e,t,i,n,s,a,r){"use strict";return s.extend({title:"",graph:null,chartOptions:null,chartData:null,chartDataMaxY:0,chartDataMinY:0,template:_.template(r),onResize:function(){a.debug("AnalysisBaseChartView : onResize: "," | viewid     : ",this.cid),this.renderChart(),this.renderChartHeader()},onTimeRangeChange:function(){a.debug("AnalysisBaseChartView : onTimeRangeChange: "," | viewid     : ",this.cid),this.render()},getChartOptions:function(){a.debug("AnalysisBaseChartView : getChartOptions. Error: ","Subclass did not override")},getChartData:function(){a.debug("AnalysisBaseChartView : getChartData. Error: ","Subclass did not override")},getParentModelValue:function(e){return this.model.getParentModel()?this.model.getParentModel().get(e):(a.log("AnalysisBaseChartView : getParentModelValue. Error: parent model not available"),null)},setTitle:function(e){this.title=e},setModel:function(e){this.model=e},useLogScale:function(){return!1},renderChartHeader:function(){},renderChart:function(){},refreshChart:function(){a.debug("AnalysisBaseChartView : refreshChart: "," | viewid     : "+this.cid);var e=this.getParentModelValue("timeRangeMin"),t=this.getParentModelValue("timeRangeMax");this.chartDataMinY=0,this.chartDataMaxY=0,this.hasAllZeroYValues=!0;for(var i=this._getAllDataPoints(),n=0;n<i.length;n++){var s=i[n];s[0]>=e&&s[0]<=t&&(s[1]>=this.chartDataMaxY&&(this.chartDataMaxY=s[1]),s[1]<=this.chartDataMinY&&(this.chartDataMinY=s[1]),0!==s[1]&&(this.hasAllZeroYValues=!1))}this.model.assignChartColors(),this.chartOptions=this.getChartOptions(),this.renderChart(),this.renderChartHeader()},_getAllDataPoints:function(){for(var e=[],t=this.chartData?this.chartData.length:0,i=0;i<t;i++)for(var n=this.chartData[i],s=n.data?n.data.length:0,a=0;a<s;a++)e.push(n.data[a]);return e},_initHovers:function(){this.$el.hover(function(){e(this).find(".chart-size-selector").css("visibility","visible")},function(){e(this).find(".chart-size-selector").css("visibility","hidden")})},render:function(){a.debug("AnalysisBaseChartView : render: "," | viewid     : "+this.cid);var e=this.model.getChartSize(),t=this.template(this.vtOptions({chartTitle:this.model.getTitle(),sizeClass:"chart-size-"+e,transient:this.model.isTransient()}));this.$el.html(t),this.graph&&(this.graph.destroy(),this.graph=null),this._initHovers(),this.chartData=this.getChartData(),this.refreshChart()},destroy:function(){a.debug("AnalysisBaseChartView : destroy: "," | viewid     : "+this.cid),this.graph&&(this.graph.destroy(),this.graph=null),this.$el.unbind("mouseenter mouseleave"),this.chartData=null,s.prototype.destroy.apply(this,arguments)}})}),define("text!templates/timeline/ChartLinkPopupView.html",[],function(){return'<div id="chartLinkPopupContent">\n  <div class="modal-header">\n    <button type="button" class="close" data-dismiss="modal">\n      <i data-icon="v" aria-hidden="true"></i>\n    </button>\n    <h4 class="n-title">Chart Link</h4>\n  </div>\n\n  <div class="n-modal-wrapper">\n    <div class="n-modal-body">\n      <div class="n-modal-content-wrapper">\n        <div class="n-popup-description">\n          A link for this chart is displayed below. Copy it\n          to your clipboard and use it to import this chart.\n        </div>\n        <textarea id=\'chartURLContainer\'><%= chartURL %></textarea>\n      </div>\n    </div>\n    <div class="n-modal-footer">\n      <a class="btnCancel btn n-btn-form">Close</a>\n    </div>\n  </div>\n</div>\n'}),define("views/timeline/ChartLinkPopupView",["jquery","backbone","views/basecomponents/popups/BasePopupView","text!templates/timeline/ChartLinkPopupView.html"],function(e,t,i,n){"use strict";return i.extend({chartURL:null,events:{"click  .modal-header .close":"hide","click  .btnSave":"onSave","click  .btnCancel":"hide"},initialize:function(e){this.onSuccess=e.onSuccess,this.chartURL=e.chartURL||null},render:function(){
var e=_.template(n,{chartURL:this.chartURL});this.$el.html(e)},show:function(t){i.prototype.show.apply(this,arguments),setTimeout(function(){e("#chartURLContainer").focus().select()},400)},reset:function(){},validateForm:function(){},onSave:function(){var e=this.$("#chartURLContainer").val();this.onSuccess(e),this.hide()},clearForm:function(){}})}),define("views/timeline/AnalysisChartView",["flotr2","views/timeline/AnalysisBaseChartView","views/timeline/ChartLinkPopupView","utils/AppConstants","utils/AppUtil","utils/StatsUtil","utils/DataExportUtil"],function(e,t,i,n,s,a,r){"use strict";return t.extend({OBJECT_PREFIX:"object-",legendTemplate:_.template("<span title='<%= dataSeriesTitle %><br><span style=\"color:#d3d3d3;\">(Click to hide)</span>'   class='legend-box <%=disabledClass%>'    id='<%=objectId%>'><span class='metric-box'       style='background: #<%=colorHex%>;'></span><span class='chart-data-value'><%=value%></span></span>"),legendNoDataTemplate:_.template("<span title='<%= dataSeriesTitle %><br><span style=\"color:#d3d3d3;\">No chart data available.<br>Possible reason: Entity was removed or the metric has been deprecated.</span>'   class='legend-box <%=disabledClass%>'    id='<%=objectId%>'><span class='metric-box'       style='background: #<%=colorHex%>;'></span><span class='chart-data-value'>No Data</span></span>"),legendHiddenTemplate:_.template("<span title='<%= dataSeriesTitle %><br><span style=\"color:#d3d3d3;\">(Click to show)</span>'   class='legend-box <%=disabledClass%>'    id='<%=objectId%>'><span class='metric-box'       style='background: #<%=colorHex%>;'></span><span class='chart-data-value'><%=value%></span></span>"),legendErrorTemplate:_.template("<span class='legend-box <%=disabledClass%>' id='<%=objectId%>'><span class='metric-box'       style='background: #<%=colorHex%>;'></span><span class='chart-data-value'  title='There was an error retrieving statistics for this object'> Error</span></span>"),legendLoadingTemplate:_.template("<span class='legend-box <%=disabledClass%>' id='<%=objectId%>'><span class='metric-box'       style='background: #<%=colorHex%>;'></span><span class='chart-data-value'> <div class='donut-loader-gray'></div> </span></span>"),maximizedSize:0,CHART_HEIGHT:{SMALL:100,MEDIUM:200,LARGE:300},events:{"click .legend-box":"onLegendBoxClick","click .btnChartAction":"onChartAction","click .chart-size":"onChartSizeClick","click .chart-restore":"onChartRestore","click .save-transient":"onEditChart","click .remove-transient":"onDeleteChart","click .btnEditChart":"onEditChart","click .btnDeleteChart":"onDeleteChart"},onEditChart:function(){this._proxyEvent("edit-chart")},onDeleteChart:function(){this._proxyEvent("delete-chart")},_proxyEvent:function(e){$(".timeline-container").trigger(e,{chartId:this.model.getChartId()})},onChartRestore:function(){this.model.getParentModel().restoreMaximizedChart(!1)},onChartSizeClick:function(e){var t=$(e.currentTarget),i=t.attr("data-size");this.model.setChartSize(i),i===this.model.CHART_SIZE_LARGE?this.model.getParentModel().maximizeChart(this.model.getChartId()):this.model.getParentModel().updateChart(this.model.getChartId(),this.model)},onChartAction:function(e){var t=$(e.currentTarget),n=this.model.getSecondaryObjects(),a=r.getWinRef(),o=this.getParentModelValue("timeRangeMin"),l=this.getParentModelValue("timeRangeMax");if(t.hasClass("csv"))r.exportChartCSV(this.chartData,n,a,o,l);else if(t.hasClass("json"))r.exportChartJSON(this.chartData,n,a,o,l);else if(t.hasClass("url")){var c=document.location.protocol+"//"+document.location.host+"/#chart/",u=new i({el:s.createPopupContainer("chartLinkPopupView"),popupTitle:"Chart Link",chartURL:c+this.model.toURL()});u.show()}},onLegendBoxClick:function(e){var t=e.currentTarget.id.substr(this.OBJECT_PREFIX.length),i=this.model.isSecondaryObjectHidden(t);this.model.hideSecondaryObject(t,!i),this.refreshChart()},onChartChange:function(){s.debug("AnalysisChartView : onChartChange: "," | viewid     : ",this.cid),this.render()},onSelectedTimeChange:function(){s.debug("AnalysisChartView : onSelectedTimeChange: "," | viewid     : ",this.cid),this.renderChartHeader()},renderChartHeader:function(){var e=this.getParentModelValue("selectedTime");if(null!==this.chartData){var t=this.model.getSecondaryObjects(),i="";_.each(t,function(t){if(t.enabled){var s=this.model.getChartColor(t.id),r=_.find(this.chartData,function(e){return e.objectId===t.id}),o=this._isDataSetShown(r)?"":"disabled",l=this.model.getStatsState(t.id);if(l===n.STATE_ERROR)i+=this.legendErrorTemplate({objectId:this.OBJECT_PREFIX+t.id,colorHex:s,disabledClass:o});else if(l===n.STATE_PENDING)i+=this.legendLoadingTemplate({objectId:this.OBJECT_PREFIX+t.id,colorHex:s,disabledClass:o});else if(l===n.STATE_SUCCESS&&r.data&&0===r.data.length)i+=this.legendNoDataTemplate({objectId:this.OBJECT_PREFIX+t.id,colorHex:s,disabledClass:"disabled",dataSeriesTitle:r.title});else if(this._isDataSetShown(r)){if(r.data){var c=this._getDataPointAtTime(r.data,e),u=c?c[1]:null,d=c?c[2]:null,h="";h=null===u||""===u?"&nbsp;":a.isValidStats(u)?d:"&nbsp;",i+=this.legendTemplate({objectId:this.OBJECT_PREFIX+t.id,colorHex:s,disabledClass:o,value:h,dataSeriesTitle:r.title})}}else i+=this.legendHiddenTemplate({objectId:this.OBJECT_PREFIX+t.id,colorHex:s,disabledClass:"disabled",value:"Hidden",dataSeriesTitle:r.title})}},this),this.$(".chart-data").html(i);if(this.model.isMaximized())this.$(".chart-restore").hide();else{var s=this.model.getChartSize();this.$(".chart-restore").hide(),this.$(".chart-size-selector").show(),this.$(".chart-size-"+s).addClass("chart-size-selected")}this.$(".legend-box").tooltip({placement:"left",trigger:"hover",html:"true"}),this.model.isTransient()?this.$(".btnSave").show():this.$(".btnSave").hide()}},renderChart:function(){var t=this.getDataToRender();this.setContainerSize();try{var i=this.$(".chart-content")[0];this.graph=e.draw(i,t,this.chartOptions),this.configureChartEvents(i)}catch(e){s.log("AnalysisChartView : Error in renderChart: "+e)}},setContainerSize:function(){var e=this.$(".chart-content");switch(this.model.getChartSize()){case this.model.CHART_SIZE_LARGE:e.height(this.maximizedSize||this.CHART_HEIGHT.LARGE);break;case this.model.CHART_SIZE_MEDIUM:e.height(this.CHART_HEIGHT.MEDIUM);break;default:e.height(this.CHART_HEIGHT.SMALL)}},setContainerMaxSize:function(e){this.maximizedSize=e},getDataToRender:function(){var e=_.filter(this.chartData,function(e){return this._isDataSetShown(e)},this),t=e;return this.useLogScale()&&(t=JSON.parse(JSON.stringify(e)),_.each(t,function(e){var t=_.clone(e.data);_.each(t,function(e){0===e[1]&&(e[1]=1)})})),t},configureChartEvents:function(t){var i=function(e){var t=Math.round(e);$(".selected-time-slider").slider("option","value",t).trigger("updateslider",t)},n=this;e.EventAdapter.observe(t,"flotr:select",function(e){var t=Math.round(e.x1),i=Math.round(e.x2);n.model.getParentModel().zoomTo(t,i)}),e.EventAdapter.observe(t,"flotr:click",function(e){i(e.x)}),e.EventAdapter.observe(t,"flotr:mousemove",function(e,t){e.ctrlKey&&i(t.x)})},getChartOptions:function(){var e=this,t=0,i=0;if(this.hasAllZeroYValues)t=10,i=0;else{var a=1;this.chartDataMaxY>1&&this.chartDataMaxY>this.chartDataMinY&&(a=Math.ceil(Math.log(this.chartDataMaxY-this.chartDataMinY))),t=this.chartDataMaxY+a,i=this.chartDataMinY>10?this.chartDataMinY-a:0}for(var r=[],o=this.getParentModelValue("timeRangeMin"),l=this.getParentModelValue("timeRangeMax"),c=this._getNumberOfTimeSteps(),u=o,d=l-o,h=Math.round(d/c),p=d>=n.MILLIS_PER_DAY,_=0;_<c;_++){if(_>0){var T=p?s.toNearestTenMinutes(u):u;r.push(T)}u+=h}var E=this.model.hasDisparateMetrics(),S=this.model.getChartMetrics();return{plotOffsetOveride:function(e){e.left=0},shadowSize:0,lines:{lineWidth:1},xaxis:{color:"#a8aeb2",min:this.getParentModelValue("timeRangeMin"),max:this.getParentModelValue("timeRangeMax"),ticks:r,tickFormatter:function(){return""},mode:"time",timeUnit:"millisecond"},yaxis:{color:"#a8aeb2",max:t,min:i,showLabels:!0,noTicks:2,scaling:this.useLogScale()?"logarithmic":"linear",tickFormatter:function(n){if(E)return"";if(n<0)return n;if(e.hasAllZeroYValues)return Math.round(n);var s=n;return t-i>20&&(s=Math.round(n)),e._formatAxisNumber(s,S[0].id)}},grid:{color:"#f0f0f0",tickColor:"#f0f0f0",horizontalLines:!0,verticalLines:!0,minorHorizontalLines:!1,minorVerticalLines:!1,outline:""},spreadsheet:{show:!1},selection:{mode:"x",fps:30,color:"#cccccc"}}},getChartData:function(){var e=this.model.getSecondaryObjects(),t=[];return _.each(e,function(e){if(e.enabled){var i=this.model.getChartColor(e.id),n=this.model.getStats(e.id),s={data:n||[],color:"#"+i,objectId:e.id,title:e.title};n||this.model.loadStats(e.id),t.push(s)}},this),t},initialize:function(e){s.debug("AnalysisChartView : initialize: "," | viewid     : ",this.cid),this.setModel(e.model),this.setTitle(this.model.get("title")),this.model.on("stats:loaded",this._loadStatsSuccessCallback,this),this.model.on("stats:error",this._loadStatsErrorCallback,this)},destroy:function(){s.debug("AnalysisChartView : destroy: "," | viewid     : "+this.cid),this.$(".legend-box").tooltip("destroy"),this.model.off("stats:loaded",this._loadStatsSuccessCallback,this),this.model.off("stats:error",this._loadStatsErrorCallback,this),t.prototype.destroy.apply(this,arguments)},_loadStatsSuccessCallback:function(e){s.debug("AnalysisChartView : _loadStatsSuccessCallback: "," | viewid     : ",this.cid," | objectId     : ",e);var t=_.find(this.chartData,function(t){return t.objectId===e});if(t){var i=this.model.getParentModel().getStats(this.model.getPrimaryObject().id,e);t.data=i}this.render()},_loadStatsErrorCallback:function(e){s.debug("AnalysisChartView : _loadStatsErrorCallback: "," | viewid     : ",this.cid," | objectId     : ",e),this.refreshChart()},_getDataPointAtTime:function(e,t){for(var i=1;i<e.length;i++){var n=e[i-1][0],s=e[i][0];if(t>=n&&t<=s)return e[i-1]}return null},_isDataSetShown:function(e){return!this.model.isSecondaryObjectHidden(e.objectId)},_formatAxisNumber:function(e,t){var i=a.statsFormat(t,e,!0);return i?parseInt(i.replace(/,/g,""),10):null},_getNumberOfTimeSteps:function(){return 5}})}),define("text!templates/pages/insights/InsightsChartView.html",[],function(){return'<div class="chart-header">\n  <span class="chart-title">\n    <%= chartTitle %>\n  </span>\n  <span class="chart-data"></span>\n</div>\n<div class="chart-content <%=sizeClass%>"></div>\n<div class="chart-footer"></div>'}),define("views/pages/insights/InsightsChartView",["flotr2","utils/AppConstants","utils/AppUtil","utils/StatsUtil","utils/StyleDescriptor","data/DataProperties","views/timeline/AnalysisChartView","text!templates/pages/insights/InsightsChartView.html"],function(e,t,i,n,s,a,r,o){"use strict";var l=_.template('<span class="legend-box"><span class="metric-box"       style="background: #<%=colorHex%>;"></span><span class="chart-data-value"><%= metric %></span></span>');return r.extend({template:_.template(o),CHART_ERROR:'<span title="Error loading one or more metrics">Error</span>',CHART_LOADING:'<span class="chart-data-value"> <img src="app/assets/images/spinners/loading.gif"    width=16px height=16px /> </span>',getChartData:function(){var e=this.model.getQueries(),t=[];return _.each(e,function(e){if(e.isEnabled()){var i=e.get(a.CHART_COLORS),n=this.model.getStats(e),s={colors:i,queryModel:e};s[a.QUERY_RESULTS_DATA]=[],s[a.QUERY_RESULTS_PROPERTIES]=[],n?(s[a.QUERY_RESULTS_DATA]=n[a.QUERY_RESULTS_DATA],s[a.QUERY_RESULTS_PROPERTIES]=n[a.QUERY_RESULTS_PROPERTIES]):this.model.loadStats(e),t.push(s)}},this),t},renderChartHeader:function(){if(null!==this.chartData){var e=this.model.getQueries(),i=!1,n=!1;_.each(e,function(e){if(e.isEnabled()){var s=this.model.getStatsState(e);s===t.STATE_ERROR?i=!0:s!==t.STATE_INIT&&s!==t.STATE_PENDING||(n=!0)}},this);var s="",a="&nbsp;";i?s=this.CHART_ERROR:n?s=this.CHART_LOADING:a=this._renderLegend(),this.$(".chart-data").html(s),this.$(".chart-footer").html(a),this.showMaxYaxisValue()}},configureChartEvents:function(e){},getDataToRender:function(){var e=_.filter(this.chartData,function(e){return this._isDataSetShown(e)},this),i=[];_.each(e,function(e){var t=e[a.QUERY_RESULTS_DATA],n=e[a.QUERY_RESULTS_PROPERTIES],s=e[a.CHART_COLORS];_.each(t,function(e,t){if(n[t].enabled){var a="#"+s[t];i.push({color:a,data:e,points:{fillColor:a}})}})});var n={points:{show:!1},lines:{lineWidth:1.5,show:!0},mouse:{track:!1},grid:{minorVerticalLines:!0,hoverable:!0}},r=this.getChartOptions(),o=r.xaxis.min,l=r.xaxis.max,c=r.warnThreshold;i.push(_.extend({color:"#"+s.getInsightsThresholdColor(t.INSIGHTS_CHART_WATERMARKS.THRESHOLD_WARN),data:[[o,c],[l,c]]},n));var u=r.maxThreshold;return i.push(_.extend({color:"#"+s.getInsightsThresholdColor(t.INSIGHTS_CHART_WATERMARKS.THRESHOLD_MAX),data:[[o,u],[l,u]]},n)),i},_getAllDataPoints:function(){for(var e=[],t=0;t<this.chartData.length;t++)for(var i=this.chartData[t],n=i[a.QUERY_RESULTS_DATA],s=0;s<n.length;s++)for(var r=n[s],o=0;o<r.length;o++)e.push(r[o]);return e},_getNumberOfTimeSteps:function(){return 3},getChartOptions:function(){var e=r.prototype.getChartOptions.apply(this,arguments);this.model.get(a.CHART_MAX_Y)&&(e.yaxis.max=Math.max(e.yaxis.max,this.model.get(a.CHART_MAX_Y))),this.model.get(a.CHART_MIN_Y)&&(e.yaxis.min=Math.min(e.yaxis.min,this.model.get(a.CHART_MIN_Y))),e.yaxis.ticks=[e.yaxis.min,Math.round((e.yaxis.max-e.yaxis.min)/2)],delete e.selection,e.grid.outline="s";var t=this.model.getChartTimeFormat();return e.xaxis.tickFormatter=function(e){return new Date(e).toString(t)},e.warnThreshold=this.model.get(a.CHART_WARN_THRESHOLD),e.maxThreshold=this.model.get(a.CHART_MAX_THRESHOLD),e},showMaxYaxisValue:function(){var e=this.chartOptions.yaxis.max;if(e){var t=this.$(".flotr-labels");if(t.length){var i=this._formatAxisNumber(Math.round(e),""),n=$("<div></div>").addClass("flotr-grid-label flotr-grid-label-y").css({top:"-6px",color:"#a8aeb2",left:0,position:"absolute","text-align":"right"}).html(i);t.append($(n))}}},_renderLegend:function(){var e="";return _.each(this.chartData,function(t){var n=t.queryModel;if(n.isEnabled()){var s=n.get(a.CHART_COLORS),r=t[a.QUERY_RESULTS_DATA];if(r.length>1){var o=t[a.QUERY_RESULTS_PROPERTIES];_.each(r,function(t,n){var a=o[n].name||o[n].id,r=i.truncateMiddle(a,20);e+=l({colorHex:s[n],metric:r})})}else{var c=n.getMetricDisplayName(),u=i.truncateMiddle(c,20);e+=l({colorHex:s[0],metric:u})}}}),this.model.get(a.CHART_WARN_THRESHOLD)&&(e+=l({colorHex:s.getInsightsThresholdColor(t.INSIGHTS_CHART_WATERMARKS.THRESHOLD_WARN),metric:t.INSIGHTS_CHART_WATERMARKS.THRESHOLD_WARN})),this.model.get(a.CHART_MAX_THRESHOLD)&&(e+=l({colorHex:s.getInsightsThresholdColor(t.INSIGHTS_CHART_WATERMARKS.THRESHOLD_MAX),metric:t.INSIGHTS_CHART_WATERMARKS.THRESHOLD_MAX})),e},_isDataSetShown:function(e){return e.queryModel.isEnabled()},_loadStatsSuccessCallback:function(e){i.debug("InsightsChartView : _loadStatsSuccessCallback: "," | viewid     : ",this.cid," | objectId     : ",e);var t=_.find(this.chartData,function(t){return t.queryModel.get("id")===e});if(t){var n=this.model.getStats(t.queryModel);this.model.assignChartColors(),t[a.QUERY_RESULTS_DATA]=n[a.QUERY_RESULTS_DATA],t[a.QUERY_RESULTS_PROPERTIES]=n[a.QUERY_RESULTS_PROPERTIES],t[a.CHART_COLORS]=t.queryModel.get(a.CHART_COLORS)}this.render()},_formatAxisNumber:function(e,t){return n.rawNumericFormat(e)}})}),define("views/pages/insights/StandaloneInsightsChartView",["views/pages/insights/InsightsChartView"],function(e){"use strict";return e.extend({getParentModelValue:function(e){return this.model.get(e)},onStartServices:function(){this.model.startFetching()},onStopServices:function(){this.model.stopFetching()}})}),define("views/pages/alerts/details/MetricThresholdGroupView",["data/DataProperties","views/pages/alerts/details/CauseResolutionGroupView","views/charts/MetricThresholdChartView","models/capacityplanning/EntityEventQueryModel","components/Components","utils/AppUtil","utils/AlertUtil","utils/AppConstants"],function(e,t,i,n,s,a,r,o){"use strict";var l=_.template('<div class="n-cr-container-<%= index %> n-container-padding\n        n-chart-group">\n        <div class="metric-threshold-chart n-chart">\n          <div class="n-cr-graphs threshold-instance-chart">\n            <div class="title-wrapper">\n              <div class="n-chart-title"></div>\n              <div class="n-alert-settings-link"></div>\n            </div>\n            <div class="n-chart-<%=index%>"></div>\n          </div>\n        </div>\n      </div>'),c={UPPER:"upper",LOWER:"lower"},u=_.template('<a class="n-alert-settings"\n        data-entity-type="<%= entityType %>"\n        data-entity="<%= entityId %>"\n        data-metric="<%= metric %>"><%= i18n(\'alert_settings\') %>\n      </a>'),d=_.template('<div class="n-alert-severity -<%= severity %>">\n        <%= formattedseverity %>\n      </div>\n      <div class="message"><%= message %></div>\n      <% if (actualValue) { %>\n        <div class="value"><%= actualValue %></div>\n      <% } %>\n      <% if (criteria) { %>\n        <div class="criteria"><%= criteria %></div>\n      <% } %>');return t.extend({name:"MetricThresholdGroupView",events:{"click .n-alert-settings":"onAlertSettingClick"},initializeModels:function(e){this.alertModel=e.alertModel,this.entityType=e.entityType},render:function(){var e=this,t=this.alertModel.getMetricDetails();return t&&t.entityId?(this.$el.html('<div class="n-group-view"></div>'),r.getSupportedMetrics().always(function(i){e.metricsCollection=i,e._renderIndividualViews(t,0)})):this.$el.append(this.i18n("no_data")),this},onStartServices:function(){this.subViewHelper.iterate("startServices")},onStopServices:function(){this.subViewHelper.iterate("stopServices")},_renderIndividualViews:function(e,t){var n=this,s=(this.alertModel.DP,e.displayName),a=e.metricName,l=e.entityType,c=Math.floor(e.timestamp/1e3),u=this._createSubviewContainer(t),d=Date.now(),h=d,p=d-o.MILLIS_PER_WEEK,_=void 0;if(this.metricsCollection){var T=r.findMetricByName(this.metricsCollection,l,a);_=T&&T.downSamplingOperator&&T.downSamplingOperator.toUpperCase()}p>c&&(p=c-o.MILLIS_PER_WEEK/2,h=c+o.MILLIS_PER_WEEK/2);var E=r.getXfitFeatureInfo(),S=new i({disableBand:!1,activeMetric:a,unit:e.unit,samplingOperation:_,entityType:l,title:s,showBand:!E.disabled});this.registerSubView(a,S),u.html(S.render().el),S.setEntityId(e.entityId),S.setStartTime(p),S.setEndTime(h),S.setSamplingInterval(5*o.SECONDS_PER_MINUTE),this._setThresholdValue(S,e);var g=this.getOccurrenceMessage(S,e,s);this._chartOccurrenceLine(S,e,g).done(function(){S.updateChartData(),n.$(".n-chart-title").html(s),n.entityType===o.ENTITY_EVENT&&n.renderAlertSettingsLink(a,e.entityId,l)})},renderAlertSettingsLink:function(e,t,i){this.$(".n-alert-settings-link").html(u(this.vtOptions({entityId:t,metric:e,entityType:i})))},getOccurrenceMessage:function(t,i,n){var a=void 0,l=void 0,c=void 0,u=i.threshold,h=s.icon("Anomaly","-warning -mini");if(this.entityType===o.ENTITY_ALERT?(c=this.i18n("alert_created_msg"),i.condition_type===e.ALERT_POLICY.CONDITION_TYPE.ANOMALY&&(c+="<br>"+h+" "+this.i18n("anomaly_tooltip_msg"))):c=h+" "+this.i18n("anomaly_tooltip_msg"),a=i.metricValue,a&&(a=n+": "+t.yAxisTickFormatter(a)),(u||0===u)&&a){var p=i.comparator;if(this.entityType===o.ENTITY_EVENT){var _=Number(i.metricValue)>Number(u),T=r.COMPARATORS;p=_?T.kGreaterThan:T.kLessThan}l=this.i18n("alert_criteria_label")+n+p+t.yAxisTickFormatter(u)}var E=o.ALERT_SEVERITY_NAMES[i.severity]||i.severity;return d({message:c,criteria:l,actualValue:a,severity:E,formattedseverity:r.formatSeverity(E)})},onAlertSettingClick:function(e){var t=$(e.target);r.showUDAPolicyPopup(t.attr("data-entity-type"),t.attr("data-entity"),t.attr("data-metric"))},_setThresholdValue:function(t,i){if(this.entityType===o.ENTITY_ALERT&&i[this.alertModel.DP.CONDITION_TYPE]===e.ALERT_POLICY.CONDITION_TYPE.STATIC_THRESHOLD){var n=i.comparator.trim(),s={silent:!0},a=n===o.FILTER_OPERATOR_SYMBOLS.gt||n===o.FILTER_OPERATOR_SYMBOLS.ge,r=a?c.UPPER:c.LOWER,l=i.severity;l=o.ALERT_SUMMARY_SEVERITY_MAPPING[l]||l&&l.toUpperCase(),t.setThresholdValue(l,parseInt(i.threshold,10),r,s)}},_chartOccurrenceLine:function(t,i,n){var s,a=$.Deferred(),r=(s={},_defineProperty(s,e.CP.ALERT.CREATED_TIME_STAMP,i.timestamp),_defineProperty(s,"isDetailsPage",!0),_defineProperty(s,"severity",i.severity),s);return this.entityType===o.ENTITY_EVENT?(r.alert_title=n,this.setAnomalyModel(r,t)):(r.message=n,t.setAlertModel([r]),a.resolve(),a.promise())},setAnomalyModel:function(e,t){var i=this,s=new n({entityType:t.entityType,indicatorEntityType:t.entityType,entityId:t.entityId,metricName:t.activeMetric,anomalyOnly:!0},{startTime:t.startTime,endTime:t.endTime});return s.save().done(function(){var n=s.getQueryResultAttributes();_.some(n,function(t,s){if(t[i.alertModel.DP.ID]===i.alertModel.get(i.alertModel.DP.ID))return n[s]=e,!0})||n.push(e),t.setAnomalyModel(n)}).fail(function(){a.log("MetricThresholdGroupView: Error fetching all anomalies"),t.setAnomalyModel([e])})},_createSubviewContainer:function(e){var t=l({index:e});return this.$(".n-group-view").append(t),this.$(".n-chart-"+e)}})}),define("text!templates/pages/alerts/details/AlertTabContentDetailsView.html",[],function(){return'<div class="n-alertdetails">\n  <div class="loaderContainer">\n  </div>\n  <div class="n-alertdetails-chart">\n    \x3c!-- @value: value goes here... --\x3e\n  </div>\n  <div class="n-cause-res-container">\n    \x3c!-- @value: value goes here... --\x3e\n  </div>\n</div>'}),define("views/details/tabs/AlertTabContentDetailsView",["views/basecomponents/details/tabs/BaseTabContentDetailsView","views/pages/alerts/details/CauseResolutionGroupView","views/pages/insights/StandaloneInsightsChartView","views/pages/alerts/details/MetricThresholdGroupView","data/DataProperties","utils/AppUtil","utils/AppConstants","utils/AlertUtil","utils/ManagerMixin","utils/SubViewHelper","text!templates/pages/alerts/details/AlertTabContentDetailsView.html","text!templates/pages/alerts/details/AlertCauseResolutionView.html"],function(e,t,i,n,s,a,r,o,l,c,u,d){"use strict";var h=_.template(u),p=_.template(d);return e.extend(_.extend({},l,{subViewHelper:null,model:null,alertHistoryChartModel:null,modelInitialized:!1,entityType:r.ENTITY_ALERT,modelEvents:{"change  model":"updateViews"},initialize:function(){this.subViewHelper=new c,e.prototype.initialize.apply(this,arguments)},setModel:function(e){this.model=e},createChartView:function(e,t){return new i({model:e,el:t})},render:function(){return this.modelInitialized?(this._hideLoader(),this.renderContent()):(this.$el.html(h()),this._addLoader()),this},renderContent:function(){this.model.isUserDefined()?this._renderMetricThresholdGroupView():this.getDataManager().isV3PrimaryDataSource()?this._renderPossibleCauses():(this._renderAlertHistoryChart(),this._renderCauseResolutionGroupView())},onStartServices:function(){this.entityType===r.ENTITY_ALERT&&o.loadAlertTypeMetadata(),this.delegateModelEvents(),this.model.getState()===r.STATE_SUCCESS&&this.updateViews(this.model),this.subViewHelper.iterate("startServices")},onStopServices:function(){this.undelegateModelEvents(),this.subViewHelper.iterate("stopServices")},onResize:function(){this.subViewHelper.iterate("onResize")},updateViews:function(e){var t=this;this.entityType===r.ENTITY_ALERT?o.loadAlertTypeMetadata().always(function(){t._updateViews(e)}):this._updateViews(e)},_updateViews:function(e){this.modelInitialized=!0,this.alertHistoryChartModel=e.getChartModel(),this.render(),this.subViewHelper.iterate("startServices")},destroy:function(){a.debug("AlertTabContentDetailsView : destroy: "," | viewid     : "+this.cid),this.subViewHelper&&(this.subViewHelper.removeAll(),this.subViewHelper=null),this.model&&(this.model=null),this.alertHistoryChartModel&&(this.alertHistoryChartModel=null),e.prototype.destroy.apply(this,arguments)},_addLoader:function(){a.addInLineDonutLoader(this.$(".loaderContainer"))},_hideLoader:function(){this.$(".loaderContainer").remove()},_renderAlertHistoryChart:function(){if(this.alertHistoryChartModel){var e=this.$(".n-alertdetails-chart");e.addClass("chart-outline");var t=this.createChartView(this.alertHistoryChartModel,e);this.registerSubView("alertHistoryView",t),t.render()}},_renderCauseResolutionGroupView:function(){var e=_.bind(this.onResize,this),i=new t({el:this.$(".n-cause-res-container"),onViewUpdate:e,alertModel:this.model});this.registerSubView("causeResolutionGroupView",i),i.render()},_renderMetricThresholdGroupView:function(){var e=new n({el:this.$(".n-cause-res-container"),alertModel:this.model,entityType:this.entityType});this.registerSubView("metricThresholdGroupView",e),e.render()},_renderPossibleCauses:function(){var e=this,t=this.$(".n-cause-res-container").empty(),i=this.model.get(s.ALERT_RCA_METADATA_LIST),n=this.model.get(this.model.DP.POSSIBLE_CAUSES),a=i&&i.length,r=a?i:n,o=r&&r.length>1;_.each(r,function(i,n){var s=$('<div class="n-cr-container-'+n+' n-container-padding"></div>').append(p(e.vtOptions({index:n+1,showIndex:o,title:a?i.cause:i.cause_list.join(" "),cause:a?i.cause:i.cause_list.join(" "),actions:a?i.actions:i.resolution_list.join(" "),details:a?i.details:"",troubleshootingSteps:[]})));t.append(s)}),this.$(".n-helpful-links").hide(),this.$(".n-troubleshooting").hide()}}))}),define("views/details/tabs/AlertSummaryTabContentDetailsView",["views/details/tabs/SummaryTabContentDetailsView","views/details/tabs/AlertTabContentDetailsView"],function(e,t){"use strict";return e.extend({createRightPaneView:function(e){var i=e.addClass("n-alert-right"),n=new t({el:i,pageId:this.pageId,entityType:this.entityType});return n.setModelId(this.model.getId()),n.setModel(this.model),n.render(),n}})}),define("views/details/tabs/EventTabContentDetailsView",["views/details/tabs/AlertTabContentDetailsView","utils/AppConstants"],function(e,t){"use strict";var i=_.template('<div class="n-container-padding">\n        <div class="detailed-info">\n          <div class="n-cr-header">\n            <div class="n-cr-leftheader">\n              <div class="n-label n-reco">Description</div>\n              <div class="n-label n-cr-title"><%= description %></div>\n            </div>\n          </div>\n        </div>\n      </div>');return e.extend({entityType:t.ENTITY_EVENT,renderContent:function(){this.model.get("alert_details")?this._renderMetricThresholdGroupView():this._renderEventDescription()},_renderEventDescription:function(){this.$(".n-cause-res-container").append(i({description:this.model.getValue(this.model.DP.DESCRIPTION)}))}})}),define("views/details/tabs/EventSummaryTabContentDetailsView",["views/details/tabs/SummaryTabContentDetailsView","views/details/tabs/EventTabContentDetailsView"],function(e,t){"use strict";return e.extend({createRightPaneView:function(e){var i=e.addClass("n-alert-right"),n=new t({el:i,pageId:this.pageId,entityType:this.entityType});return n.setModelId(this.model.getId()),n.setModel(this.model),n.render(),n}})}),define("views/basecomponents/datatables/fileserver/FileServerSharesTableView",["views/basecomponents/datatables/BaseTableView","models/fileserver/ShareCollection","models/fileserver/ShareModel","utils/AppConstants","utils/StatsUtil","utils/VisualizationUtil"],function(e,t,i,n,s,a){"use strict";return e.extend({model:null,name:"FileServerSharesTableView",isSelectionEnabled:!1,initialize:function(){e.prototype.initialize.apply(this,arguments),this.model=new t,this.model.setProjection([n.PROJECTION.STATS]),this.defaultMinRows=5},setModelId:function(e){this.model.setFSId(e),this.refreshData()},refreshData:function(){this.model&&this.model.fileServerId&&this.model.fetch()},render:function(){return e.prototype.render.call(this),this.$el.addClass("FileServerSharesTableView"),this},getDefaultColumns:function(){return[{sTitle:this.i18n("name"),mData:i.DP.NAME,mRender:function(e,t,i){return e||""}},{sTitle:this.i18n("total_space"),mData:function(e,t,n){var a=s.getUsageStats(e,i.DP.TOTAL_SPACE_USED),r=s.getUsageStats(e,i.DP.SPACE_USED_BY_SNAPSHOTS),o=a+r;return s.storageFormat(o)}},{sTitle:this.i18n("open_connections"),mData:function(e,t,a){var r=s.getUsageStats(e,i.DP.NUM_CONNECTED_USERS);return r<0?n.STATS_NOT_AVAILABLE:r}},{sTitle:this.i18n("used_space"),mData:function(e,t,n){return s.getUsageStats(e,i.DP.TOTAL_SPACE_USED)},mRender:function(e,t,i){return"display"===t?s.storageFormat(e):e}},{sTitle:this.i18n("space_usage"),mData:function(e,t,n){var r=null,o=null,l=s.getUsageStats(e,i.DP.TOTAL_SPACE_USED),c=s.getUsageStats(e,i.DP.SPACE_USED_BY_SNAPSHOTS),u=l+c,d=100*c/u,h=100-d;return 100===d?r="no-free-space":0===d&&(o="no-used-space"),a.renderMultiUsageBar({percentageList:[{value:d,class:"used-space "+r},{value:h,class:"free-space "+o}]})}},{sTitle:this.i18n("snapshots_space"),mData:function(e,t,n){return s.getUsageStats(e,i.DP.SPACE_USED_BY_SNAPSHOTS)},mRender:function(e,t,i){return"display"===t?s.storageFormat(e):e}},{sTitle:this.i18n("previous_version_enabled"),mData:i.DP.WINDOWS_PREVIOUS_VERSION,mRender:function(e,t,i){return e?"Yes":"No"}}]}})}),define("views/details/tabs/FileServerSharesTabContentDetailsView",["views/basecomponents/details/tabs/BaseTabContentDetailsView","data/DataURLConstants","views/basecomponents/datatables/fileserver/FileServerSharesTableView","utils/AppConstants","utils/AppUtil"],function(e,t,i,n,s){"use strict";return e.extend({tableView:null,initializeProperties:function(e){e=e||{},this.tableView=new i({entityType:n.ENTITY_SHARE,pageId:e.pageId})},render:function(){return this.$el.append(this.tableView.render().el),this},postSetModelId:function(t){e.prototype.postSetModelId.apply(this,arguments),this.tableView&&this.tableView.setModelId(t)},destroy:function(){s.debug("FileServerSharesTabContentDetailsView : destroy: "," | viewid     : "+this.cid),this.tableView&&this.tableView.destroy(),e.prototype.destroy.apply(this,arguments)},getDetailsTableURL:function(e){return _.template(t.getEntityTypeURL(this.tableView.entityType),{entityId:e})},onStartServices:function(){this.tableView&&this.tableView.startServices(),this.delegateEvents()},onStopServices:function(){this.tableView&&this.tableView.stopServices(),this.undelegateEvents()}})}),define("views/basecomponents/charts/simple/EntityBarChartView",["d3","nvd3","views/basecomponents/charts/BaseChartView","views/basecomponents/charts/ChartTemplates","components/Components","utils/AppConstants","utils/StatsUtil","utils/StyleDescriptor","utils/I18nMixin","utils/DataExportUtil","utils/SVG"],function(e,t,i,n,s,a,r,o,l,c,u){"use strict";var d=_.template("<div><div><%= entityName %></div><div><span><%= dataTitle %>&nbsp;</span><span><%= dataValue %></span></div></div>"),h={top:15,left:75,bottom:50,right:30};return i.extend(_.extend({},l,{name:"EntityStackedAreaChartView",events:{"click  .exportOption":"onExport"},initializeStatsProperties:function(e){this.title=r.getMetricLabel(e.metricType,e.entityType);var t=r.getMetricOptions(e.metricType,e.entityType);t&&(this.barDataOptions=t.barDataOptions,this.numBarsInGroup=this.barDataOptions?this.barDataOptions.length:0,this.labelYAxis=t.labelYAxis,this.units=t.units,this.nameAttr=t.nameAttr,this.sortAttr=t.sortAttr),this.barColors=o.getChartColor(e.metricType),this.entityType=e.entityType,this.model=e.model,this.model&&(this.model.on("reset",this.updateChartData,this),this.model.on("error",this.showNoData,this),this.model.on("pending",this.showLoading,this))},render:function(){var e=this.getExportOptions();return this.$el.html(n.ENTITY_MULTIDATA_CHART_WITH_BORDER(this.vtOptions({title:this.title,chartWidthP:"100",loading:this.i18n("loading"),no_data:this.i18n("no_data_available"),exportOptions:e,exportTitle:u.SVGIcon("Export"),Components:s}))),this.$(".download-data").removeClass("dropdown"),this},getDataAndRender:function(e){this.model&&(e&&(this.entityId=e,this.entityType===a.ENTITY_FILE_SERVER?this.model.setFSId(this.entityId):this.model.id=this.entityId),
this.model.fetch({alwaysTriggerPending:!0,alwaysTriggerChange:!0}))},updateChartData:function(){this.isValidForChartUpdate(this.model)&&(this.graphData=this._getGraphDataForModel(),this._formatBarDataD3(this.graphData),this.renderChart())},_getGraphDataForModel:function(){var e=[];if(this.model&&this.model.models&&this.barDataOptions&&this.barDataOptions.length){var t=this.model.models;if(t=_.sortBy(t,function(e){return r.getUsageStats(e,this.sortAttr)},this).reverse(),t=t.splice(0,10),this.units&&""!==this.units&&(this.entityType===a.ENTITY_FILE_SERVER||this.entityType===a.ENTITY_SHARE)){var i,n=[];_.each(t,function(e){_.each(this.barDataOptions,function(t){(i=r.getUsageStats(e,t.attr))>0&&n.push(i)},this)},this),n.length>0&&(this.units=r.determineDataSizeUnit(n))}_.each(t,function(t){var i={};i.name=t.get(this.nameAttr),_.each(this.barDataOptions,function(e){i[e.attr]=r.getUsageStats(t,e.attr),i[e.attr]<0?i[e.attr]=0:i[e.attr]=r.unitsConversion(i[e.attr],this.units)},this),e.push(i)},this)}return e},_formatBarDataD3:function(){this.barData=[],this.exportData=[],this.exportMetric=[],this.maxYValue=0;var e=null;if(this.graphData&&this.graphData.length){for(var t=0;t<this.numBarsInGroup;t++)this.barData.push({key:this.barDataOptions[t].title,values:[]}),this.exportData.push({title:this.barDataOptions[t].title,objectId:this.barDataOptions[t].title,data:[]}),this.exportMetric.push({enabled:!0,title:this.barDataOptions[t].title,id:this.barDataOptions[t].title});_.each(this.graphData,function(t){for(var i=0;i<this.numBarsInGroup;i++)this.barData[i].values.push({x:t.name,y:t[this.barDataOptions[i].attr],tooltip:[t.name,this.barDataOptions[i].desc]}),e=[],e[0]=t[this.barDataOptions[i].attr],e[1]=t[this.barDataOptions[i].attr]+this.units,this.exportData[i].data.push(e),this.maxYValue=Math.max(t[this.barDataOptions[i].attr],this.maxYValue)},this)}},renderChart:function(){var i=this.getChartContainer();if(this._svg&&(this._svg.remove(),this._svg=null,this.graph=null),this._svg=e.select(i).append("svg").attr("class","chart"),this.barData&&this.barData.length){this.showChart();var n=this;this.graph=t.addGraph(function(){var e=t.models.multiBarChart().transitionDuration(0).reduceXTicks(!1).rotateLabels(45).showControls(!1).height(n.options.height).groupSpacing(.25).showLegend(!0).margin(h);return e.yAxis.tickFormat(function(e){return e+" "+n.units}),e.tooltip(n.getTooltip),e.color(n.barColors),e.forceY([0,n.maxYValue?n.maxYValue:1]),e.legend.rectMode(!0),e.legend.margin({top:2,right:20,left:0,bottom:30}),n._svg.datum(n.barData).call(e).selectAll(".nv-series").style("cursor","default").on("click",null).on("dblclick",null),e})}else this.showNoData()},getTooltip:function(e,t,i,n,s){return n&&n.point&&n.point.tooltip&&2===n.point.tooltip.length&&i?d({entityName:n.point.tooltip[0],dataTitle:n.point.tooltip[1],dataValue:i}):""},destroy:function(){this.model.off(),i.prototype.destroy.apply(this,arguments)},onExport:function(e){e.preventDefault();var t=$(e.currentTarget),i=c.getWinRef();t.hasClass("csv")?c.exportBarChartCSV(this.exportData,this.exportMetric,i):t.hasClass("json")&&c.exportBarChartJSON(this.exportData,this.exportMetric,i)}}))}),define("views/basecomponents/charts/simple/EntityStackedAreaChartView",["d3","nvd3","views/basecomponents/charts/BaseChartView","views/basecomponents/charts/ChartTemplates","components/Components","utils/AppUtil","utils/StatsUtil","utils/TimeUtil","utils/AppConstants","utils/StyleDescriptor","utils/I18nMixin","utils/SVG","data/DataProperties"],function(e,t,i,n,s,a,r,o,l,c,u,d,h){"use strict";var p={top:15,left:75,right:30};return i.extend(_.extend({},u,{name:"EntityStackedAreaChartView",showLegend:!0,isFloat:!0,initializeStatsProperties:function(e){this.title=r.getMetricLabel(e.metricType[0],e.entityType);var t=r.getMetricOptions(e.metricType[0],e.entityType);t&&(this.stackDataOptions=t.stackDataOptions,this.numStacksOfData=this.stackDataOptions?this.stackDataOptions.length:0,this.units=t.units),this.showLegend=void 0!==e.showLegend?e.showLegend:this.showLegend,this.isFloat=void 0!==e.isFloat?e.isFloat:this.isFloat,this.model&&(this.model.on("reset",this.updateChartData,this),this.model.on("error",this.showNoData,this),this.model.on("pending",this.showLoading,this))},render:function(){var e,t=null,i=this.getExportOptions();return e=this.options.dropDownOptions?n.ENTITY_MULTIDATA_CHART_WITH_DROPDOWN(this.vtOptions({title:this.title,chartWidthP:"100",options:this.options.dropDownOptions,exportOptions:i,exportTitle:d.SVGIcon("Export"),Components:s,loading:this.i18n("loading"),no_data:this.i18n("no_data_available")})):n.ENTITY_MULTIDATA_CHART_WITH_BORDER(this.vtOptions({title:this.title,chartWidthP:"100",loading:this.i18n("loading"),no_data:this.i18n("no_data_available"),exportOptions:i,exportTitle:d.SVGIcon("Export"),Components:s})),this.$el.html(e),this.$(".download-data").removeClass("dropdown"),this.options.metricType[0]!==h.STATS_VFS_FILES_USED&&this.options.metricType[0]!==h.SHARE_STATS_VFS_FILES_USED||(t=this.i18n("num_files_tooltipText"),this.addToolTipText(t)),_.pluck(this.stackDataOptions,"title"),this},updateChartData:function(e){if(this.isValidForChartUpdate(e)){this.model=e||this.model;var t=this.getMetricId();if(this.graphData=[],_.each(t,function(e,t){this.graphData[t]=this.model.getStats(e)},this),!this._checkDataFormat())return void this.showNoData();this._formatStackedAreaDataD3(),this.renderChart()}},_checkDataFormat:function(){var e=!0,t=0;if(this.graphData&&this.graphData.length){t=this.graphData[0]?this.graphData[0].length:0;for(var i=1;i<this.graphData.length;i++)this.graphData[i]&&this.graphData[i].length===t||(e=!1)}else e=!1;return e?_.each(this.graphData,function(e){var t=0;_.each(e,function(e,i){e[1]<0&&(e[1]=t),t=e[1]})}):a.log("EntityStackedAreaChartView: The number of data points do not match for the metrics."),e},_formatStackedAreaDataD3:function(){this.stackedAreaData=[],this.exportData=[],this.exportMetric=[];for(var e=null,t=0;t<this.numStacksOfData;t++)this.stackedAreaData.push({key:this.stackDataOptions[t].desc,values:[]}),this.exportData.push({title:this.stackDataOptions[t].desc,objectId:this.stackDataOptions[t].desc,data:[]}),this.exportMetric.push({enabled:!0,title:this.stackDataOptions[t].desc,id:this.stackDataOptions[t].desc});if(this.entityType===l.ENTITY_FILE_SERVER||this.entityType===l.ENTITY_SHARE||this.entityType===l.ENTITY_ICAP_SERVERS||this.entityType===l.ICAP_SERVERS){var i=[];_.each(this.graphData,function(e,t){_.each(this.graphData[t],function(e){e[1]>0&&i.push(e[1])},this)},this);var n=this.getMetricId();i.length>0&&(this.units=r.getChartUnits(n[0],i,this.units))}if(this.stackedAreaData&&this.stackedAreaData.length){var s=this.istputStats();_.each(this.graphData,function(t,i){_.each(this.graphData[i],function(t){e=[],e[0]=t[0],e[1]=t[1],this.options.metricType[0]===h.STATS_VFS_FILES_USED||this.options.metricType[0]===h.SHARE_STATS_VFS_FILES_USED?t[1]=r.unitsConversionStatsVfs(t[1],this.units):t[1]=s?r.unitsConversionStatsTput(t[1],this.units):r.unitsConversion(t[1],this.units),e[2]=t[1]+this.units,this.stackedAreaData[i].values.push(t),this.exportData[i].data.push(e)},this)},this)}},istputStats:function(){var e=!1;return this.options.metricType[0]!==h.STATS_PERFORMANCE_FS_OVERALL_TPUT_OVER_TIME&&this.options.metricType[0]!==h.STATS_PERFORMANCE_FS_WRITE_TPUT_OVER_TIME&&this.options.metricType[0]!==h.STATS_PERFORMANCE_SHARE_OVERALL_TPUT_OVER_TIME&&this.options.metricType[0]!==h.STATS_PERFORMANCE_FS_READ_TPUT_OVER_TIME&&this.options.metricType[0]!==h.STATS_PERFORMANCE_SHARE_WRITE_TPUT_OVER_TIME&&this.options.metricType[0]!==h.STATS_PERFORMANCE_SHARE_READ_TPUT_OVER_TIME||(e=!0),e},_isThereDataToRender:function(){var e=this.stackedAreaData&&this.stackedAreaData.length;return _.each(this.stackedAreaData,function(t){e=e&&t.values&&t.values.length}),e},getMaxValue:function(){if(this.stackedAreaData&&this.stackedAreaData.length){for(var e=0,t=0;t<this.graphData[0].length;t++){for(var i=0,n=0;n<this.graphData.length;n++)i+=this.graphData[n][t][1];e=parseFloat(Math.max(i,e).toFixed(2))}return 0===e?100:e}return 100},renderChart:function(){var i=this.getChartContainer();if(this._svg||(this._svg=e.select(i).append("svg").attr("class","chart")),this._isThereDataToRender()){if(this.showChart(),i&&!i.clientWidth)return;var n=this;this.graph=t.addGraph(function(){var i=t.models.stackedAreaChart().useInteractiveGuideline(!0).x(function(e){return e[0]}).y(function(e){return e[1]}).showControls(!1).showLegend(!0).height(n.options.height).clipEdge(!0).transitionDuration(0).margin(p);i.xAxis.showMaxMin(!1).tickFormat(function(e,t){return n.options.statsFor===l.SAMPLING_INTERVAL_IN_LAST_7_DAYS?o.formatDateTime(e).split(",")[0]:o.formatShortTime(e)}),n.isFloat?i.yAxis.tickFormat(function(e){if(null!==e)return parseFloat(e.toFixed(3))+" "+n.units}):i.yAxis.tickFormat(function(t){if(null!==t)return e.format(".0f")(t)+" "+n.units}),i.forceX([n.getTimeRangeMin(),n.getTimeRangeMax()]),i.yDomain([0,n.getMaxValue()]),i.color(c.getChartColor(n.options.metricType[0])),i.legend.rectMode(!0);var s=c.getChartStrokeColor(n.options.metricType[0]);return i.legend.color(s),i.legend.margin({top:2,right:20,left:0,bottom:30}),n._svg.datum(n.stackedAreaData).call(i).selectAll(".nv-series").style("cursor","default").on("click",null).on("dblclick",null),n.showLegend||n._svg.select(".nv-legendWrap").style("display","none"),n.setStrokeColor(),i})}else this.showNoData();this.options.metricType[0]!==h.STATS_VFS_FILES_USED&&this.options.metricType[0]!==h.SHARE_STATS_VFS_FILES_USED||this.$(".nutanixMoreInfo").nutanixMoreInfo({parseDataAttrs:!0,placement:"bottom"})},setStrokeColor:function(){if(this.options.metricType)for(var e=c.getChartStrokeColor(this.options.metricType[0]),t=0;t<this.options.metricType.length;t++)this._svg.select(".nv-stackedAreaChart path.nv-area-"+t).style("stroke",e[t])},getChartContainerDiv:function(){return this.getChartContainer()},addToolTipText:function(e){var t=n.TOOL_TIP_TEMPLATE({tooltipText:e},this);this.$("span.n-chart-metric-title").append(t)}}))}),define("views/basecomponents/charts/simple/EntitySimpleLineChartView",["d3","nvd3","views/basecomponents/charts/BaseChartView","views/basecomponents/charts/ChartTemplates","utils/AppUtil","utils/StatsUtil","utils/TimeUtil","utils/StyleDescriptor","data/DataProperties"],function(e,t,i,n,s,a,r,o,l){"use strict";var c={top:15,left:50};return i.extend({initializeStatsProperties:function(e){this.title=a.getMetricLabel(e.metricType[0],e.entityType),this.lineOptions=a.getMetricOptions(e.metricType[0],e.entityType),this.lineOptions&&(this.lineDataOptions=this.lineOptions.lineDataOptions,this.numLinesOfData=this.lineDataOptions?this.lineDataOptions.length:0,this.units=this.lineOptions.units),this.lineColors=_.map(e.metricType,function(e){return o.getChartColor(e)[0]})},render:function(){return this.$el.html(n.ENTITY_MULTIDATA_CHART({title:this.title,legendWidthP:"0",chartWidthP:"100"})),this},setEntityId:function(e){this.entityId=e},updateChartData:function(e){if(this.isValidForChartUpdate(e)){this.model=e||this.model;var t=this.getMetricId();if(this.graphData=[],_.each(t,function(e,t){this.graphData[t]=this.model.getStats(e)},this),!this._checkDataFormat())return void this.showNoData();this._formatLineChartDataD3(),this.renderChart()}},_checkDataFormat:function(){var e=!0,t=0;if(this.graphData&&this.graphData.length){t=this.graphData[0]?this.graphData[0].length:0;for(var i=1;i<this.graphData.length;i++)this.graphData[i]&&this.graphData[i].length===t||(e=!1)}else e=!1;return e?_.each(this.graphData,function(e){var t=0;_.each(e,function(e,i){e[1]<0&&(e[1]=t),t=e[1]})}):s.log("EntitySimpleLineChartView: The number of data points do not match for the metrics."),e},_formatLineChartDataD3:function(){this.lineChartData=[];for(var e=0;e<this.numLinesOfData;e++)this.lineChartData.push({key:this.lineDataOptions[e].title,color:this.lineColors[e],values:[]});this.lineChartData&&this.lineChartData.length&&_.each(this.graphData,function(e,t){_.each(this.graphData[t],function(e){this.units!==a.UOM_US&&this.units!==a.UOM_MS||this.options.metricType[0]===l.STATS_CONTROLLER_ICAP_TOTAL_LATENCY_OVER_TIME||this.options.metricType[0]===l.STATS_CONTROLLER_ICAP_LATENCY_OVER_TIME||(this.units===a.UOM_US?e[1]=a.round(e[1]/a.USECS_UNIT_RATIOS.usecs,2):this.units===a.UOM_MS&&(e[1]=a.round(e[1]/a.USECS_UNIT_RATIOS.ms,2))),this.lineChartData[t].values.push({x:e[0],y:e[1]})},this)},this)},_isThereDataToRender:function(){var e=this.lineChartData&&this.lineChartData.length;return _.each(this.lineChartData,function(t){e=e&&t.values&&t.values.length}),e},renderChart:function(){var i=this.getChartContainer();if(this._svg||(this._svg=e.select(i).append("svg").attr("class","chart")),this._isThereDataToRender()){this.showChart();var n=this;this.graph=t.addGraph(function(){var e=t.models.lineChart().useInteractiveGuideline(!0).showLegend(!0).showYAxis(!0).showXAxis(!0).transitionDuration(0).margin(c);return e.xAxis.showMaxMin(!1).tickFormat(function(e){return r.formatShortTime(e)}),e.yAxis.tickFormat(function(e){return e+" "+n.units}),n._svg.datum(n.lineChartData).call(e),t.utils.windowResize(e.update),e})}else this.showNoData()}})}),define("views/details/tabs/FSSimpleLineChartView",["d3","nvd3","views/basecomponents/charts/ChartTemplates","views/basecomponents/charts/simple/EntitySimpleLineChartView","components/Components","utils/AppConstants","utils/AppUtil","utils/TimeUtil","utils/I18nMixin","utils/StatsUtil","utils/SVG","utils/StyleDescriptor","data/DataProperties"],function(e,t,i,n,s,a,r,o,l,c,u,d,h){"use strict";var p={top:15,left:75,right:25};return n.extend(_.extend({},l,{name:"FSSimpleLineChartView",initializeStatsProperties:function(e){n.prototype.initializeStatsProperties.call(this,e),this.lineColors=d.getChartColor(e.metricType[0])},render:function(){var e=this.getExportOptions();return this.$el.html(i.ENTITY_MULTIDATA_CHART_WITH_BORDER(this.vtOptions({title:this.title,chartWidthP:"100",loading:this.i18n("loading"),no_data:this.i18n("no_data_available"),exportOptions:e,exportTitle:u.SVGIcon("Export"),Components:s}))),this.$(".download-data").removeClass("dropdown"),this},_checkDataFormat:function(){var e=!0,t=0;if(this.graphData&&this.graphData.length){t=this.graphData[0]?this.graphData[0].length:0;for(var i=1;i<this.graphData.length;i++)this.graphData[i]&&this.graphData[i].length===t||(this.options.entityType===a.ICAP_SERVERS&&this.graphData[i].length>t?(this.graphData[i]=this.graphData[i].slice(0,t),e=!0):e=!1)}else e=!1;return e?_.each(this.graphData,function(e){var t=0;_.each(e,function(e,i){e[1]<0&&(e[1]=t),t=e[1]})}):r.log("FSSimpleLineChartView: The number of data points do not match for the metrics."),e},_formatLineChartDataD3:function(){this.lineChartData=[],this.exportData=[],this.exportMetric=[];for(var e=null,t=0;t<this.numLinesOfData;t++)this.lineChartData.push({key:this.lineDataOptions[t].title,color:this.lineColors[t],values:[]}),this.exportData.push({title:this.lineDataOptions[t].title,objectId:this.lineDataOptions[t].title,data:[]}),this.exportMetric.push({enabled:!0,title:this.lineDataOptions[t].title,id:this.lineDataOptions[t].title});var i=this.isLatencyStats(),n=this.isSizeStats(),s=this.istputStats();if(this.entityType===a.ENTITY_FILE_SERVER||this.entityType===a.ENTITY_SHARE||this.entityType===a.ENTITY_ICAP_SERVERS||this.entityType===a.ICAP_SERVERS){var r=[];_.each(this.graphData,function(e,t){_.each(this.graphData[t],function(e){e[1]>0&&r.push(e[1])},this)},this),r.length>0&&(this.units=c.getChartUnits(this.options.metricType[0],r,this.units))}this.lineChartData&&this.lineChartData.length&&_.each(this.graphData,function(t,a){_.each(t,function(t){e=[],e[0]=t[0],e[1]=t[1],i?this.units===c.UOM_LAT_US?t[1]=c.round(t[1]/c.USECS_UNIT_RATIOS.usecs,2):this.units===c.UOM_LAT_MS?t[1]=c.round(t[1]/c.USECS_UNIT_RATIOS.ms,2):this.units===c.UOM_LAT_SEC&&(t[1]=c.round(t[1]/c.USECS_UNIT_RATIOS.sec,2)):n?t[1]=c.unitsConversion(t[1],this.units):s&&(t[1]=c.unitsConversionStatsTput(t[1],this.units)),e[2]=t[1]+this.units,this.lineChartData[a].values.push({x:t[0],y:t[1]}),this.exportData[a].data.push(e)},this)},this)},renderChart:function(){var i=this.getChartContainer();if(this._svg||(this._svg=e.select(i).append("svg").attr("class","chart")),this._isThereDataToRender()){this.showChart();var n=this;this.graph=t.addGraph(function(){var e=t.models.lineChart().useInteractiveGuideline(!0).showLegend(!0).showYAxis(!0).showXAxis(!0).height(n.options.height).transitionDuration(0).margin(p).rectMode(!0).excludeLegendsFromMarginTop(!1);return e.xAxis.showMaxMin(!1).tickFormat(function(e){return n.options.statsFor===a.SAMPLING_INTERVAL_IN_LAST_7_DAYS?o.formatDateTime(e).split(",")[0]:o.formatShortTime(e)}),e.yAxis.tickFormat(function(e){return e+" "+n.units}),e.forceX([n.getTimeRangeMin(),n.getTimeRangeMax()]),e.legend.margin({top:2,right:20,left:0,bottom:30}),n._svg.datum(n.lineChartData).call(e).selectAll(".nv-series").style("cursor","default").on("click",null).on("dblclick",null),e})}else this.showNoData()},isLatencyStats:function(){switch(this.options.metricType[0]){case h.STATS_PERFORMANCE_FS_OVERALL_LATENCY_OVER_TIME:case h.STATS_PERFORMANCE_SHARE_OVERALL_LATENCY_OVER_TIME:case h.STATS_PERFORMANCE_FS_WRITE_LATENCY_OVER_TIME:case h.STATS_PERFORMANCE_FS_READ_LATENCY_OVER_TIME:case h.STATS_PERFORMANCE_FS_METADATA_LATENCY_OVER_TIME:case h.STATS_PERFORMANCE_SHARE_WRITE_LATENCY_OVER_TIME:case h.STATS_PERFORMANCE_SHARE_READ_LATENCY_OVER_TIME:case h.STATS_PERFORMANCE_SHARE_METADATA_LATENCY_OVER_TIME:return!0;default:return!1}},isSizeStats:function(){switch(this.options.metricType[0]){case h.STATS_CONTROLLER_FS_TOTAL_SIZE_OVER_TIME:case h.STATS_CONTROLLER_FS_SNAPSHOT_SIZE_OVER_TIMED:case h.STATS_CONTROLLER_SHARE_TOTAL_SIZE_OVER_TIME:case h.STATS_CONTROLLER_SHARE_SNAPSHOT_SIZE_OVER_TIME:return!0;default:return!1}},istputStats:function(){switch(this.options.metricType[0]){case h.STATS_PERFORMANCE_FS_WRITE_TPUT_OVER_TIME:case h.STATS_PERFORMANCE_FS_READ_TPUT_OVER_TIME:case h.STATS_PERFORMANCE_SHARE_WRITE_TPUT_OVER_TIME:case h.STATS_PERFORMANCE_SHARE_READ_TPUT_OVER_TIME:return!0;default:return!1}}}))}),define("views/basecomponents/charts/groups/FSUsageGroupChartView",["data/DataProperties","views/basecomponents/charts/BaseGroupChartView","views/basecomponents/charts/simple/EntityBarChartView","views/basecomponents/charts/simple/EntityStackedAreaChartView","views/details/tabs/FSSimpleLineChartView","models/fileserver/ShareCollection","models/stats/UpdatedTimeStatsModel","utils/AppConstants","utils/StatsUtil","utils/AppUtil"],function(e,t,i,n,s,a,r,o,l,c){"use strict";var u={file_server:{stackedChart:[[e.STATS_VFS_FILES_USED],[e.STATS_FS_CONNECTED_USERS]],lineChart:[[e.STATS_CONTROLLER_FS_TOTAL_SIZE_OVER_TIME,e.STATS_CONTROLLER_FS_SNAPSHOT_SIZE_OVER_TIME]],barChart:[[e.STATS_CONTROLLER_SHARE_SIZES]]},file_server_share:{stackedChart:[[e.SHARE_STATS_VFS_FILES_USED],[e.STATS_SHARE_CONNECTED_USERS]],lineChart:[[e.STATS_CONTROLLER_SHARE_TOTAL_SIZE_OVER_TIME,e.STATS_CONTROLLER_SHARE_SNAPSHOT_SIZE_OVER_TIME,e.STATS_CONTROLLER_SHARE_SIZE_OVER_TIME]]},file_server_icap_servers:{lineChart:[[e.STATS_CONTROLLER_ICAP_TOTAL_LATENCY_OVER_TIME]],stackedChart:[[e.STATS_CONTROLLER_ICAP_TOTAL_FILES_SCANNED_OVER_TIME],[e.STATS_CONTROLLER_ICAP_TOTAL_QUEUE_LENGTH_OVER_TIME]]},icap_servers:{lineChart:[[e.STATS_CONTROLLER_ICAP_LATENCY_OVER_TIME]],stackedChart:[[e.STATS_CONTROLLER_ICAP_FILES_SCANNED_OVER_TIME]]},general_stats:{file_server:{lineChart:[[e.STATS_PERFORMANCE_FS_OVERALL_LATENCY_OVER_TIME]],stackedChart:[[e.STATS_PERFORMANCE_FS_OVERALL_TPUT_OVER_TIME],[e.STATS_PERFORMANCE_FS_OVERALL_IOPS_OVER_TIME]]},file_server_share:{lineChart:[[e.STATS_PERFORMANCE_SHARE_OVERALL_LATENCY_OVER_TIME]],stackedChart:[[e.STATS_PERFORMANCE_SHARE_OVERALL_TPUT_OVER_TIME],[e.STATS_PERFORMANCE_SHARE_OVERALL_IOPS_OVER_TIME]]}},io_breakdown:{file_server:{lineChart:[[e.STATS_PERFORMANCE_FS_WRITE_LATENCY_OVER_TIME,e.STATS_PERFORMANCE_FS_READ_LATENCY_OVER_TIME,e.STATS_PERFORMANCE_FS_METADATA_LATENCY_OVER_TIME],[e.STATS_PERFORMANCE_FS_WRITE_TPUT_OVER_TIME,e.STATS_PERFORMANCE_FS_READ_TPUT_OVER_TIME]],stackedChart:[[e.STATS_PERFORMANCE_FS_WRITE_IOPS_OVER_TIME,e.STATS_PERFORMANCE_FS_READ_IOPS_OVER_TIME,e.STATS_PERFORMANCE_FS_METADATA_IOPS_OVER_TIME]]},file_server_share:{lineChart:[[e.STATS_PERFORMANCE_SHARE_WRITE_LATENCY_OVER_TIME,e.STATS_PERFORMANCE_SHARE_READ_LATENCY_OVER_TIME,e.STATS_PERFORMANCE_SHARE_METADATA_LATENCY_OVER_TIME],[e.STATS_PERFORMANCE_SHARE_WRITE_TPUT_OVER_TIME,e.STATS_PERFORMANCE_SHARE_READ_TPUT_OVER_TIME]],stackedChart:[[e.STATS_PERFORMANCE_SHARE_WRITE_IOPS_OVER_TIME,e.STATS_PERFORMANCE_SHARE_READ_IOPS_OVER_TIME,e.STATS_PERFORMANCE_SHARE_METADATA_IOPS_OVER_TIME]]}}},d={file_server_share:{stackedChart:[[e.STATS_SHARE_CONNECTED_USERS]]}},h={file_server:{lineChart:[[e.STATS_CONTROLLER_FS_TOTAL_SIZE_OVER_TIME,e.STATS_CONTROLLER_FS_SNAPSHOT_SIZE_OVER_TIME]],stackedChart:[[e.STATS_FS_CONNECTED_USERS]],barChart:[[e.STATS_CONTROLLER_SHARE_SIZES]]},file_server_share:{lineChart:[[e.STATS_CONTROLLER_SHARE_TOTAL_SIZE_OVER_TIME,e.STATS_CONTROLLER_SHARE_SNAPSHOT_SIZE_OVER_TIME]],stackedChart:[[e.STATS_SHARE_CONNECTED_USERS]]}},p={icap_servers:{lineChart:[[e.STATS_CONTROLLER_ICAP_LATENCY_OVER_TIME,e.STATS_CONTROLLER_ICAP_TOTAL_LATENCY_OVER_TIME]],stackedChart:[[e.STATS_CONTROLLER_ICAP_FILES_SCANNED_OVER_TIME,e.STATS_CONTROLLER_ICAP_TOTAL_FILES_SCANNED_OVER_TIME]]}},T={icap_servers:[[e.STATS_CONTROLLER_ICAP_LATENCY_OVER_TIME,e.STATS_CONTROLLER_ICAP_TOTAL_LATENCY_OVER_TIME],[e.STATS_CONTROLLER_ICAP_FILES_SCANNED_OVER_TIME,e.STATS_CONTROLLER_ICAP_TOTAL_FILES_SCANNED_OVER_TIME],[e.STATS_CONTROLLER_ICAP_THROUGHPUT_OVER_TIME,e.STATS_CONTROLLER_ICAP_TOTAL_THROUGHPUT_OVER_TIME]]},E={file_server_icap_servers:[e.STATS_CONTROLLER_ICAP_TOTAL_FILES_SCANNED_OVER_TIME,e.STATS_CONTROLLER_ICAP_TOTAL_THROUGHPUT_OVER_TIME],icap_servers:[e.STATS_CONTROLLER_ICAP_FILES_SCANNED_OVER_TIME,e.STATS_CONTROLLER_ICAP_THROUGHPUT_OVER_TIME]},S={file_server_share:[e.STATS_SHARE_CONNECTED_USERS,e.SHARE_STATS_VFS_FILES_USED],file_server_icap_servers:[e.STATS_CONTROLLER_ICAP_TOTAL_FILES_SCANNED_OVER_TIME,e.STATS_CONTROLLER_ICAP_TOTAL_THROUGHPUT_OVER_TIME,e.STATS_CONTROLLER_ICAP_TOTAL_QUEUE_LENGTH_OVER_TIME]},g={file_server:[e.STATS_FS_CONNECTED_USERS],file_server_share:[e.STATS_SHARE_CONNECTED_USERS],general_stats:[e.STATS_PERFORMANCE_FS_OVERALL_IOPS_OVER_TIME]};return t.extend({name:"FSUsageGroupChartView",stats:null,intervalTimeInMilliSec:o.AFS_STATS_POLLING_INTERVAL,events:{"click  .btnDropdownAction":"handleChartDropdownActionClick"},initializeStatsProperties:function(e){if(e.entityType&&(this.entityType=e.entityType),e.entityId&&(this.entityId=e.entityId),e.entityParentType&&(this.entityParentType=e.entityParentType),e.entityParentId&&(this.entityParentId=e.entityParentId),e.tab===o.TAB_DETAILS.FS_PERFORMANCE)this.graphMetrics=u[e.subEntityType][this.entityType],this.dropDownMetrics=E[e.subEntityType],this.hideLegendMetrics=S[e.subEntityType],this.isFloatMetrics=g[e.subEntityType];else if(this.graphMetrics=u[this.entityType],this.dropDownMetrics=E[this.entityType],this.hideLegendMetrics=S[this.entityType],this.isFloatMetrics=g[this.entityType],e.tab===o.TAB_DETAILS.USAGE&&e.version)if(this.entityType===o.ENTITY_SHARE&&e.isNestedShare)this.graphMetrics=d[this.entityType];else if(this.entityType===o.ENTITY_SHARE||this.entityType===o.ENTITY_FILE_SERVER){var t=this.checkVersion(e.version);t||(this.graphMetrics=h[this.entityType])}this.metrics=this.getMetrics(this.graphMetrics,this.entityType)},checkVersion:function(e){var t=0;return e&&(t=c.compareVersions(e,o.FILE_SERVER_VERSIONS.SPECTRE)),t>=0},render:function(){var e=null;return e=this.entityType===o.ICAP_SERVERS?p[this.entityType]:this.graphMetrics,_.each(e,function(e,t){this.renderGraph(e,t)},this),this},updateStatsCharts:function(){this.entityType===o.ICAP_SERVERS?this.updateStatsData():(this.subViewHelper.iterate("updateChartData",this.statsModel),this.checkExportGraphData())},updateStatsData:function(){var e=this.entityParentId,t=this,i=o.ENTITY_ICAP_SERVERS,n=this.getMetrics(u[i],i),s=new r;s.setStatsFor(e,i,n,"",""),s.setTimeInterval(l.getStatsStartTime(i),l.getStatsCurrentTime(),l.getSamplingIntervalSecs(n)),s.fetch({alwaysTriggerChange:!0,alwaysTriggerPending:!0,success:function(e){t.appendChartData(e.attributes),t.subViewHelper.iterate("updateChartData",t.statsModel),t.checkExportGraphData()},error:function(){t.subViewHelper.iterate("updateChartData",t.statsModel),t.checkExportGraphData()}})},appendChartData:function(e){var t=T[this.entityType],i=this.statsModel.attributes;_.each(this.metrics,function(n,s){_.each(t,function(t,a){if(t[0]===n){var r=s+1,o=e.metricIds.indexOf(t[1]);-1===i.metricIds.indexOf(t[1])?(i.metricIds.splice(r,0,t[1]),i.stats.splice(r,0,e.stats[o])):i.stats[r]=e.stats[o]}},this)},this)},showLoadingState:function(){this.subViewHelper.iterate("showLoading")},showNoData:function(){this.subViewHelper.iterate("showNoData")},onStartServices:function(){this.delegateModelEvents();var e=this.subViewHelper.get("entityBarChart");e&&e.getDataAndRender(this.entityId),this.statsModel&&(this.options.statsFor?this.statsModel.setTimeInterval(l.getStatsStartTime(this.options.statsFor),l.getStatsCurrentTime(),l.getSamplingIntervalSecs(this.metrics)):this.statsModel.setTimeInterval(l.getStatsStartTime(),l.getStatsCurrentTime(),l.getSamplingIntervalSecs(this.metrics)),this.statsModel.startPolling({alwaysTriggerChange:!0,alwaysTriggerPending:!0})),this.subViewHelper.iterate("startServices")},fetchOnDemand:function(e){var i=this.subViewHelper.get("entityBarChart");t.prototype.fetchOnDemand.apply(this,arguments),i&&i.getDataAndRender(e)},destroy:function(){this.statsModel&&this.statsModel.stopPolling()},setMetrics:function(e){this.graphMetrics=e,this.metrics=this.getMetrics(this.graphMetrics,this.entityType)},getMetrics:function(e,t){var i=[],n=E[t];return _.each(e,function(e,t){"barChart"!==t&&_.each(e,function(e){i=n&&n.indexOf(e[0])>=0?i.concat.apply(i,n):i.concat.apply(i,e)},this)},this),i},renderGraph:function(t,r){var o,l,c=null,u=!0,d=!0,h=this.getActionDropdownData(this.entityType);_.each(t,function(t){this.dropDownMetrics&&this.dropDownMetrics.indexOf(t[0])<0&&(h=null),u=this.checkMetrics(this.hideLegendMetrics,t[0]),d=this.checkMetrics(this.isFloatMetrics,t[0]),"stackedChart"===r?o=new n({metricType:t,entityType:this.entityType,dropDownOptions:h,showLegend:u,isFloat:d,height:150,statsFor:this.options.statsFor}):"lineChart"===r?c=new s({metricType:t,entityType:this.entityType,height:150,statsFor:this.options.statsFor}):"barChart"===r&&(l=new i({metricType:e.STATS_CONTROLLER_SHARE_SIZES,entityType:this.entityType,height:150,model:new a})),o&&(this.$el.append(o.render().el),this.subViewHelper.register(t[0],o)),c&&(this.$el.append(c.render().el),this.subViewHelper.register(t[0],c)),l&&(this.$el.append(l.render().el),this.subViewHelper.register("entityBarChart",l))},this)},getActionDropdownData:function(t){var i,n=null;return t===o.ENTITY_ICAP_SERVERS?i=[{action:e.STATS_CONTROLLER_ICAP_TOTAL_FILES_SCANNED_OVER_TIME,text:this.i18n("all_icap_server.total_files_processed")},{action:e.STATS_CONTROLLER_ICAP_TOTAL_THROUGHPUT_OVER_TIME,text:this.i18n("all_icap_server.average_throughput_in_mib")}]:t===o.ICAP_SERVERS&&(i=[{action:e.STATS_CONTROLLER_ICAP_FILES_SCANNED_OVER_TIME,text:this.i18n("icap_server.files_processed")},{action:e.STATS_CONTROLLER_ICAP_THROUGHPUT_OVER_TIME,text:this.i18n("icap_server.throughput_in_mib")}]),i&&(n=_.map(i,function(e){return{attributes:o.NAV_ACTION+'="'+e.action+'"',name:e.text,class:"btnDropdownAction "+e.action}})),n},handleChartDropdownActionClick:function(e){var t,i,s=$(e.currentTarget),a=s.attr(o.NAV_ACTION),r=null,l=[],c=!0,u=!0,d=T[this.entityType];d?_.each(d,function(e,t){e[0]===a&&(l.push(a),l.push(e[1]))},this):l.push(a);var h=this.getActionDropdownData(this.entityType);c=this.checkMetrics(this.hideLegendMetrics,a),u=this.checkMetrics(this.isFloatMetrics,a),_.each(this.dropDownMetrics,function(e){(t=this.subViewHelper.get(e))&&(i=t.getChartContainerDiv(),r=$(i).closest(".n-chart"),this.subViewHelper.remove("graph"),t=new n({metricType:l,entityType:this.entityType,dropDownOptions:h,showLegend:c,isFloat:u,statsFor:this.options.statsFor}),this.subViewHelper.register(e,t),$(r).replaceWith(t.render().el),this.updateChartsStats(t))},this)},checkMetrics:function(e,t){return!(e&&e.indexOf(t)>=0)},updateChartsStats:function(e){e&&e.updateChartData(this.statsModel)},checkExportGraphData:function(){var e=!1;_.each(this.subViewHelper.subViews,function(t,i){t.exportData&&t.exportData.length&&t.exportData[0].data&&t.exportData[0].data.length&&(e=!0)}),e?$(".tab-export").show():$(".tab-export").hide()}})}),define("views/details/tabs/FSUsageTabContentDetailsView",["views/basecomponents/details/tabs/BaseTabContentDetailsView","views/basecomponents/datatables/DataTableTemplates","components/Components","data/DataProperties","views/basecomponents/charts/groups/FSUsageGroupChartView","managers/NavigationManager","utils/AppConstants","utils/FileServerUtil","utils/AppUtil","utils/SVG","utils/CommonTemplates","utils/DataExportUtil"],function(e,t,i,n,s,a,r,o,l,c,u,d){"use strict";return e.extend({name:"FSUsageTabContentDetailsView",extraClassName:"n-usage-tab-content-details",graphView:null,metricsDefault:null,graphsTemplate:_.template('<div class="usageGraphContainer"></div>'),events:{"click  .tabExportOption":"onTabExport","click  .btnDropdownAction":"handleChartDropdownActionClick"},initializeProperties:function(e){var i=a.getCurrentPageRoute().options,n=l.parseQueryToObject(i);this.entityParentId=n.actionParentId,this.entityParentType=n.actionParentEntityType,this.actionTargetId=n.actionTargetId,this.$el.append(t.BAR_HEADER).append(this.graphsTemplate),this.$(".n-header").prepend(t.HEADER_RIGHT)},render:function(){this.renderSubViews();var e=r.SAMPLING_INTERVAL_IN_LAST_24_HOUR;return this.renderGraph(e,""),this.$(".tab-export").removeClass("dropdown"),this},setModelId:function(e){if(l.isValidId(e)&&this.currentModelId!==e){this.currentModelId=e,this.postSetModelId(e);var t=r.SAMPLING_INTERVAL_IN_LAST_24_HOUR;this.renderGraph(t,"fileserver"),this.$(".action-dropdown button span").html(this.i18n("dropdownOption.last_24_hours")),this.renderSubViews()}},onStartServices:function(){this.graphView&&(this.graphView.stopServices(),this.graphView.startServices())},onStopServices:function(){this.graphView&&this.graphView.stopServices()},destroy:function(){this.graphView&&this.graphView.stopServices()},renderSubViews:function(){var e=this.getActionDropdownData(),t=c.SVGIcon("Export")+" "+this.i18n("download_data"),n=this.getActionDropdownData("export"),s=i.dropdown({classes:"action-dropdown pull-right",text:this.i18n("dropdownOption.last_24_hours"),options:e,rightAlign:!0}),a=i.dropdown({classes:"tab-export btn-group",text:t,options:n,rightAlign:!0});this.$(".n-header-right").addClass("pull-right").html(s).append(a)},renderGraph:function(e,t){this.graphView&&this.graphView.stopServices();var i=null,a=!1;if(this.entityType===r.ENTITY_SHARE?(i=this.model.get(this.model.DP.OBJECT_VERSION),a=this.checkNestedShare(i)):i=this.model.get(this.model.DP.VERSION),this.entityType===r.ENTITY_SHARE?this.graphView=new s({entityType:this.entityType,entityId:this.model[n.ID],entityParentType:this.entityParentType,entityParentId:this.model.get(this.model.DP.FILE_SERVER_UUID),statsFor:e,version:i,tab:r.TAB_DETAILS.USAGE,isNestedShare:a}):this.graphView=new s({entityType:this.entityType,entityId:this.currentModelId?this.currentModelId:this.actionTargetId,statsFor:e,version:i,tab:r.TAB_DETAILS.USAGE}),this.$(".usageGraphContainer").html(this.graphView.render().el),a){var o=u.INFO({msg:this.i18n("nested_share_msg")});this.$(".usageGraphContainer").prepend(o)}t&&this.graphView.startServices()},getActionDropdownData:function(){
var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,i=null;if("export"===t)e=[{action:"csv",text:"Export Chart Data (CSV)..."},{action:"json",text:"Export Chart Data (JSON)..."}],i="tabExportOption ";else{var n=o.compareAFSversion(this.model,r.FILE_SERVER_VERSIONS.THREE_DOT_FIVE)>=0;e=[{action:r.FS_STATS_LAST_HOURS,text:this.i18n("dropdownOption.last_24_hours")},{action:r.SAMPLING_INTERVAL_IN_LAST_6_HOURS,text:this.i18n("dropdownOption.last_6_hours")},{action:r.SAMPLING_INTERVAL_IN_LAST_3_HOURS,text:this.i18n("dropdownOption.last_3_hours")}],n&&e.unshift({action:r.SAMPLING_INTERVAL_IN_LAST_7_DAYS,text:this.i18n("dropdownOption.last_7_days")}),i="btnDropdownAction last_"}return _.map(e,function(e){return{attributes:r.NAV_ACTION+'="'+e.action+'"',name:e.text,class:i+e.action}})},handleChartDropdownActionClick:function(e){var t=$(e.currentTarget),i=t.attr(r.NAV_ACTION);this.renderGraph(i,"dropdown")},onTabExport:function(e){e.preventDefault();var t=$(e.currentTarget),i=d.getWinRef();_.each(this.graphView.subViewHelper.subViews,function(e,n){e.exportData&&e.exportMetric&&(t.hasClass("csv")?"entityBarChart"===n?d.exportBarChartCSV(e.exportData,e.exportMetric,i):d.exportChartCSV(e.exportData,e.exportMetric,i):t.hasClass("json")&&("entityBarChart"===n?d.exportBarChartJSON(e.exportData,e.exportMetric,i):d.exportChartJSON(e.exportData,e.exportMetric,i)))})},checkNestedShare:function(e){var t=this.model.get(this.model.DP.PARENT_SHARE_UUID),i=!1,n=l.compareVersions(e,r.FILE_SERVER_VERSIONS.THREE_DOT_TWO);return t&&n>=0&&(i=!0),i}})}),define("models/fileserver/ShareSnapshotModel",["models/BaseModel","data/DataURLConstants","utils/AppConstants"],function(e,t,i){"use strict";var n={UUID:"uuid",CREATOR:"creator"};return e.extend({DP:n,name:"ShareSnapshotModel",idAttribute:n.UUID,setUuid:function(e){this.fsUuid=e.fsUuid,this.shareId=e.shareId},getURL:function(){if(this.actionMode===i.ACTION_CREATE){var e={fsUuid:this.fsUuid,shareId:this.shareId};return _.template(t.SHARE_SNAPSHOTS_DELETE,e)}}})}),define("models/fileserver/ShareSnapshotCollection",["models/PollingCollection","models/fileserver/ShareSnapshotModel","data/DataURLConstants"],function(e,t,i){"use strict";return e.extend({model:t,url:null,name:"ShareSnapshotCollection",setUuid:function(e){this.url=_.template(i.SHARE_SNAPSHOTS,e)}})}),define("views/basecomponents/datatables/fileserver/FSShareSSRestoreTableView",["views/details/tabs/components/TabDetailsTableView","views/basecomponents/datatables/DataTableColumnProvider","models/BaseModel","models/fileserver/ShareSnapshotCollection","models/fileserver/ShareSnapshotModel","data/DataProperties","utils/AppConstants","utils/FileServerUtil"],function(e,t,i,n,s,a,r,o){"use strict";var l=i.extend({name:"ShareSnapshotActionModel",deleteItemsByIds:function(e){var t=this,i=new s,n=o.getFileServerAndShareUuidsFromPageRoute();if(n){i.setUuid(n),i.isNew(!0),i.actionMode=r.ACTION_CREATE;var a={snapshotUuids:e};i.save(a,{success:function(e,i){t.showSuccessNotification(t,r.ACTION_DELETE),t.trigger("sync",t)},error:function(e,i){t.showErrorNotification(t,r.ACTION_DELETE,i),t.trigger("error",t)}})}}}),c=_.template('<p><%= i18n("tab_title") %></p>'),u=(_.template('<a class="delete_snapshot"dataId="<%- dataId %>" createdTime="<%- createdTime %>"><%= i18n("delete") %></a>'),_.template('<%= title %> <span class="nutanixMoreInfo"data-tooltip-title="<%- tooltipContent %>"data-tooltip-classes="-nudge-up"></span>'));return e.extend({model:null,name:"FSShareSSRestoreTableView",isSelectionEnabled:!1,initialize:function(){e.prototype.initialize.apply(this,arguments),this.entityType=r.ENTITY_SNAPSHOT,this.addExtraEvents({"click .delete_snapshot":"onDeleteSnapshot"})},initializeTableModel:function(e){this.dataTableSettings.bPaginate=!0,this.model=new n,this.model.setProjection([r.PROJECTION.STATS,r.PROJECTION.ALERTS])},onDataChange:function(){var t=[];_.each(this.model.models,function(e){null!==e.get(e.DP.CREATOR)&&e.get(e.DP.CREATOR)!==r.SSR_SNAPSHOT&&t.push(e)},this),t.length&&this.model.remove(t),e.prototype.onDataChange.call(this)},render:function(){return e.prototype.render.apply(this,arguments),this.$(".n-header").prepend(c(this.vtOptions())),this.$(".n-filter-display").hide(),this.$(".nutanixMoreInfo").nutanixMoreInfo({parseDataAttrs:!0}),this},setModelId:function(e){var t=o.getFileServerAndShareUuidsFromPageRoute(e);t&&this.model.setUuid(t),this.refreshData()},refreshData:function(){this.model&&this.model.fetch()},getActionViewOptions:function(){return{model:new l}},destroy:function(){this.$(".nutanixMoreInfo").nutanixMoreInfo("destroy"),e.prototype.destroy.apply(this,arguments)},onDeleteSnapshot:function(e){var t=this,i=$(e.currentTarget),n=i.closest("tr"),s=_.template("Delete snapshot '<%= id %>' created on '<%= createTime %>'?",{id:i.attr("dataId"),createTime:i.attr("createdTime"),entityType:this.entityType});$.nutanixConfirm({msg:s,yes:function(){t._deleteSnapshot(n.attr("actiontargetid"))},yesText:"Yes",noText:"No"})},_deleteSnapshot:function(e){(new l).deleteItemsByIds([e])},getDefaultColumns:function(){var e=this;return[{sTitle:e.i18n("id"),mData:a.SNAP_ID},{sTitle:e.i18n("create_time"),mData:a.SHARE_SNAP_CREATE_TIME,mRender:function(e,i,n){return t.renderDateTimeValue(e,i,n)}},{sTitle:e.i18n("total_space"),mData:a.SHARE_SNAP_TOTAL_SPACE_BYTES,mRender:function(e,i,n){return t.renderStorageStats(e,i,n)}},{sTitle:u(e.vtOptions({title:e.i18n("reclaimable_space"),tooltipContent:e.i18n("reclaimable_space_tootip")})),mData:a.SHARE_SNAP_RECALMABLE_SPACE_BYTES,mRender:function(e,i,n){return t.renderStorageStats(e,i,n)}}]}})}),define("views/details/tabs/FSShareSSRestoreTabContentDetailsView",["views/basecomponents/details/tabs/BaseTabContentDetailsView","views/basecomponents/datatables/fileserver/FSShareSSRestoreTableView","utils/AppConstants","utils/AppUtil"],function(e,t,i,n){"use strict";return e.extend({tableView:null,initializeProperties:function(e){e=e||{},this.tableView=new t({entityType:i.ENTITY_SHARE,pageId:e.pageId})},render:function(){return this.$el.append(this.tableView.render().el),this},postSetModelId:function(t){e.prototype.postSetModelId.apply(this,arguments),this.tableView&&this.tableView.setModelId(t)},destroy:function(){n.debug("FileServerSharesTabContentDetailsView : destroy:"," | viewid     : "+this.cid),this.tableView&&this.tableView.destroy(),e.prototype.destroy.apply(this,arguments)},onStartServices:function(){this.tableView&&this.tableView.startServices(),this.delegateEvents()},onStopServices:function(){this.tableView&&this.tableView.stopServices(),this.undelegateEvents()}})}),define("views/details/tabs/components/TabQuotaTableView",["views/details/tabs/components/TabDetailsTableView","models/fileserver/QuotaPolicyCollection","models/fileserver/QuotaPolicyModel","data/DataProperties","managers/ActionManager","utils/AppUtil","utils/VisualizationUtil","utils/AppConstants"],function(e,t,i,n,s,a,r,o){"use strict";return e.extend({quotaExceptionUuid:null,fetchedQuotaExceptionUuid:null,initialize:function(t){e.prototype.initialize.apply(this,arguments),this.addExtraEvents({"click .btnItemAction":"onClickLinkAction"})},initializeTableModel:function(e){this.model=new t},getDefaultColumns:function(e,t){var s=this,r=this.canModifyByEntityType(o.ENTITY_SHARE_QUOTAS),l=[{sTitle:"User",mData:i.DP.PRINCIPAL_VALUE,sWidth:"20%",mRender:function(e,t,n){return"_default"===n[i.DP.PRINCIPAL_VALUE]?e="All Users":"GROUP"===n[i.DP.PRINCIPAL_TYPE]&&(e='All Users in "'+e+'"'),e}},{sTitle:"Quota",mData:i.DP.QUOTA_SIZE_GIB,sWidth:"10%",mRender:function(e,t,n){return 0===n[i.DP.QUOTA_SIZE_GIB]?'<span class="no-quota-limit"> No quota limit </span>':e+" GiB"}},{sTitle:"Enforcement",mData:i.DP.QUOTA_ENFORCEMENT_TYPE,sWidth:"10%",mRender:function(e,t,n){return 0===n[i.DP.QUOTA_SIZE_GIB]?"":a.toUpperCaseFirstChar(e)}},{sTitle:"Email Recipient",mData:i.DP.NOTIFICATION_RECIPIENTS,sWidth:"10%",mRender:function(e,t,n){return 0===n[i.DP.QUOTA_SIZE_GIB]?"":e=n[i.DP.USER_NOTIFICATION]&&n[i.DP.NOTIFICATION_RECIPIENTS]?"User Email(from AD) "+e:n[i.DP.USER_NOTIFICATION]?"User Email(from AD) ":e}}];return r&&l.push({sTitle:"Action",mData:n.UUID,sWidth:"10%",sClass:"right",mRender:function(e,t,i){return t===o.TABLE_COL_TYPE_DISPLAY?s._renderQuotaExceptionActions(e,i):""}}),l},initializeDataTableSettings:function(){e.prototype.initializeDataTableSettings.apply(this,arguments),_.extend(this.dataTableSettings,{bSort:!1})},setModelId:function(e){this.model.setShareId(e),this.refreshData()},onQuotaExceptionChange:function(e){this.fetchedQuotaExceptionUuid=e.get(e.idAttribute),e.get(e.idAttribute)===this.model.quotaExceptionUuid&&this.onDataChange()},onStartServices:function(){e.prototype.onStartServices.apply(this,arguments),this.quotaExceptionUuid&&this.quotaExceptionUuid.on("change",this.onQuotaExceptionChange,this)},onStopServices:function(){e.prototype.onStopServices.apply(this,arguments),this.quotaExceptionUuid&&this.quotaExceptionUuid.off("change",this.onQuotaExceptionChange,this)},onClickLinkAction:function(e){var t=$(e.currentTarget),i={action:t.attr(o.NAV_ACTION),actionTarget:t.attr(o.NAV_ACTION_TARGET),actionTargetId:t.attr(o.NAV_ACTION_TARGET_ID),actionTargetName:t.attr(o.NAV_ACTION_TARGET_NAME)},n=this;if(i.action===o.ACTION_UPDATE)i.actionSuccessCallback=function(){n.refreshData()},s.executeAction(i);else if(i.action===o.ACTION_DELETE){var a=this.model.findModelById(i.actionTargetId);a.actionMode=o.ACTION_DELETE,a.setShareId(a.get(a.DP.SHARE_UUID)),a?$.nutanixConfirm({msg:"Delete this quota exception?",yes:function(){a.destroy({success:function(e,t){n.refreshData()}})},yesText:"Yes",noText:"No"}):this.showHeaderTextError("Error deleting quota, policy is no longer exist.")}},_renderQuotaExceptionActions:function(e,t){var n=t[i.DP.SHARE_UUID],s=!0;return"_default"===t[i.DP.PRINCIPAL_VALUE]&&(s=!1),this.renderQuotaExceptionActions(e,n,s)},renderQuotaExceptionActions:function(e,t,i){var n={};return n[o.ACTION_UPDATE]=r.UPDATE,i&&(n[o.ACTION_DELETE]=r.DELETE),r.renderItemActions(o.ENTITY_SHARE_QUOTAS,e,t,n)}})}),define("views/details/tabs/FSShareQuotasTabContentDetailsView",["views/basecomponents/details/tabs/BaseTabContentDetailsView","views/details/tabs/components/TabQuotaTableView","utils/AppConstants","utils/AppUtil"],function(e,t,i,n){"use strict";return e.extend({extraClassName:"n-quota-tab-content-details",tableView:null,initializeProperties:function(e){this.tableView=new t({entityType:i.ENTITY_SHARE_QUOTAS,pageId:e.pageId})},render:function(){return this.$el.append(this.tableView.render().el),this},destroy:function(){n.debug("QuotaTabContentDetailsView : destroy: "," | viewid     : "+this.cid),this.tableView&&this.tableView.destroy(),e.prototype.destroy.apply(this,arguments)},postSetModelId:function(t){e.prototype.postSetModelId.apply(this,arguments),this.tableView&&this.tableView.setModelId(t)},onStartServices:function(){this.tableView&&this.tableView.startServices(),this.delegateEvents()},onStopServices:function(){this.tableView&&this.tableView.stopServices(),this.undelegateEvents()}})}),define("models/charts/ChartBucketsModel",["data/DataProperties","models/stats/UpdatedTimeStatsModel","models/BaseModel","utils/StatsUtil","utils/SubModelHelper"],function(e,t,i,n,s){"use strict";var a={DATA_READY:"dataReady",DATA_FAILURE:"dataFailure"};return i.extend({name:"ChartBucketsModel",subModelHelper:null,buckets:null,bucketType:null,DATA_EVENTS:a,DP:{BUCKET_TYPES:"bucketTypes",BUCKETS:"buckets",READ:"read",WRITE:"write",TIMESTAMP:"timeStamp",ENTITY_ID:"entityId",ENTITY_TYPE:"entityType"},initialize:function(e){i.prototype.initialize.apply(this,arguments),this.subModelHelper=new s,this.bucketTypes=e.bucketTypes,this.metricGroups={},_.each(this.bucketTypes,function(i){this.metricGroups[i]=this.getMetricGroups(i);for(var n=0;n<this.metricGroups[i].length;n++){var s=new t;s.setTimeInterval(e.timeStamp,e.timeStamp),s.setStatsFor(e.entityId,e.entityType,this.metricGroups[i][n]),this.subModelHelper.register(i+n,s)}},this)},destroy:function(){this.subModelHelper&&this.subModelHelper.removeAll(),this.subModelHelper=null},updateTimeStamp:function(e){this.subModelHelper&&this.subModelHelper.iterate("setTimeInterval",e,e),this.set({timeStamp:e},{silent:!0})},fetch:function(){var e=this;$.when.apply($,this.subModelHelper.iterate("fetch")).done(function(){e.createBuckets(),e.trigger(a.DATA_READY)}).fail(function(t,i,n){e.trigger(a.DATA_FAILURE)})},createBuckets:function(){this.buckets={},_.each(_.keys(this.metricGroups),function(e){this.buckets[e]={};for(var t=0;t<this.metricGroups[e].length;t++)for(var i=this.subModelHelper.get(e+t),s=this.metricGroups[e][t],a=0;a<s.length;a++){var r=s[a],o=this.isMetricForRead(r,e),l=i.getStats(r),c=n.getBucketNameForMetric(r);l=l&&l.length&&l[0].length?l[0][1]:0,l=!l||l<0?0:l,this.buckets[e][c]||(this.buckets[e][c]={}),o?this.buckets[e][c].read=this.buckets[e][c].read?this.buckets[e][c].read+l:l:this.buckets[e][c].write=this.buckets[e][c].write?this.buckets[e][c].write+l:l}},this),this.generatePercentages()},generatePercentages:function(){this.buckets&&_.each(this.bucketTypes,function(t){var i,n,s,a;t!==e.STATS_CTRLR_RANDOM_READ_OPS||_.isUndefined(this.totalReads)||_.isUndefined(this.totalWrites)||(this.buckets[t].Sequential={read:this.totalReads-this.buckets[t].Random.read,write:this.totalWrites-this.buckets[t].Random.write}),i=_.pluck(this.buckets[t],"read"),n=_.pluck(this.buckets[t],"write"),s=_.reduce(i,function(e,t){return e+t},0),a=_.reduce(n,function(e,t){return e+t},0),t===e.STATS_CONTROLLER_TOTAL_IO_SIZE&&(this.totalReads=s,this.totalWrites=a),_.each(_.keys(this.buckets[t]),function(e){var i=0===s||_.isNaN(s)?0:100*this.buckets[t][e].read/s,n=0===a||_.isNaN(a)?0:100*this.buckets[t][e].write/a;i&&(this.buckets[t][e].read=Math.round(100*i)/100),n&&(this.buckets[t][e].write=Math.round(100*n)/100)},this)},this)},isMetricForRead:function(e,t){var i=n.getMetricsForBucketType(t);return-1!==_.indexOf(i.read,e)},getMetricGroups:function(e,t){var i,s=[],a=t||5;i=n.getMetricsForBucketType(e),_.each(_.keys(i),function(e){s=s.concat(i[e])});for(var r=[],o=0,l=0,c=0;c<s.length;c++)l++>=a&&(l=1,o++),r[o]=r[o]||[],r[o].push(s[c]);return r}})}),define("text!templates/basecomponents/details/charts/ChartBucketsView.html",[],function(){return'<div class="buckets-desc">\n  <span>Performance Distribution at <%= time %></span>\n</div>\n\n<div class="bar-row">\n  <div class="total_io_size_kbytes read bar-sep">\n    <div class="bar-label">Read Sizes (bytes)</div>\n  </div>\n  <div class="total_io_size_kbytes write bar-sep">\n    <div class="bar-label">Write Sizes (bytes)</div>\n  </div>\n</div>\n\n<div class="bar-row">\n  <div class="avg_io_latency_usecs read bar-sep">\n    <div class="bar-label">Read Latency (ms)</div>\n  </div>\n  <div class="avg_io_latency_usecs write bar-sep">\n    <div class="bar-label">Write Latency (ms)</div>\n  </div>\n</div>\n\n<div class="pie-row">\n  <div class="read_source_cache_ssd_bytes read pie-sep">\n    <div class="bucket-label">Read Source</div>\n  </div>\n  <div class="random_read_ops read pie-sep">\n    <div class="bucket-label">Read Random vs. Sequential</div>\n  </div>\n  <div class="random_read_ops write pie-sep">\n    <div class="bucket-label">Write Random vs. Sequential</div>\n  </div>\n</div>'}),define("views/details/tabs/ChartBucketsView",["d3","nvd3","views/basecomponents/BaseSubView","data/DataProperties","models/charts/ChartBucketsModel","utils/TimeUtil","utils/StyleDescriptor","text!templates/basecomponents/details/charts/ChartBucketsView.html"],function(e,t,i,n,s,a,r,o){"use strict";var l=_.template(o),c={Pie:0,Bar:1},u={top:15,right:0,bottom:20,left:0},d={top:0,right:0,bottom:0,left:0};return i.extend({model:null,initialize:function(e){i.prototype.initialize.apply(this,arguments),this.model=new s(e)},onStartServices:function(){this.model.on(this.model.DATA_EVENTS.DATA_READY,this.renderDetails,this)},onStopServices:function(){this.model.off(this.model.DATA_EVENTS.DATA_READY,this.renderDetails,this)},destroy:function(){this.onStopServices(),i.prototype.destroy.apply(this,arguments)},updateTimeStamp:function(e){this.model.updateTimeStamp(e)},render:function(){this.model.fetch()},renderDetails:function(){this.$el.html(l({time:a.formatLongTime(this.model.get(this.model.DP.TIMESTAMP))})),_.each(this.options.bucketTypes,function(t){var i,s,a,o,l=[],u=[];switch(i=t.slice(11,t.length),s=e.select("."+i+".read"),a=e.select("."+i+".write"),t){case n.STATS_CTRLR_READ_SRC_CACHE_SSD_BYTES:l=this._formatDataForChart(this.model.buckets[t],0,c.Pie),o=r.getChartColor(t),s=s.append("svg"),this._renderPieChart(s,l,o);break;case n.STATS_CTRLR_RANDOM_READ_OPS:l=this._formatDataForChart(this.model.buckets[t],0,c.Pie),u=this._formatDataForChart(this.model.buckets[t],1,c.Pie),o=r.getChartColor(t),s=s.append("svg"),a=a.append("svg"),this._renderPieChart(s,l,o.splice(0,2)),this._renderPieChart(a,u,o);break;case n.STATS_CONTROLLER_AVG_IO_LATENCY:case n.STATS_CONTROLLER_TOTAL_IO_SIZE:l=[{values:this._formatDataForChart(this.model.buckets[t],0,c.Bar)}],u=[{values:this._formatDataForChart(this.model.buckets[t],1,c.Bar)}],s=s.insert("svg",":first-child"),a=a.insert("svg",":first-child"),this._renderBarChart(s,l,0),this._renderBarChart(a,u,1)}},this)},_renderBarChart:function(e,i,n){var s=r.getChartColor(this.options.metricType[0]);t.addGraph(function(){var a=t.models.discreteBarChart().x(function(e){return e.label}).y(function(e){return e.value}).staggerLabels(!1).tooltips(!1).showXAxis(!0).showYAxis(!1).showValues(!0).transitionDuration(0).scaleRate(.7).zeroBarHeight(0).margin(u);return a.color([s[n]]),a.valueFormat(function(e){return e+" %"}),e.datum(i).call(a),a})},_renderPieChart:function(e,i,n){i=this._validateNoData(i),t.addGraph(function(){var s=t.models.pieChart().x(function(e){return e.label}).y(function(e){return e.value}).margin(d).color(n).tooltips(!1).showLabels(!1).rightLegendLayout(!0).rectMode(!0).centerLegendAlign(!0).oneLegendPerRow(!0);return s.noData("There is no data to display"),e.datum(i).call(s),s.legend.dispatch.on("legendClick",function(e,t){e.disabled=!0}),s})},_validateNoData:function(e){var t=!0;return _.each(e,function(e){t=t&&0===e.value}),t&&(e=[]),e},_formatDataForChart:function(e,t,i){var n=[];return _.each(_.keys(e),function(s){var a={},r=0===t?e[s].read:e[s].write;a.label=i===c.Bar?s:s+" "+r+"%",a.value=r,n.push(a)}),n}})}),define("views/details/tabs/ChartWithDrillDownView",["d3","nvd3","views/basecomponents/charts/simple/EntitySimpleLineChartView","views/details/tabs/ChartBucketsView","utils/SubViewHelper","utils/TimeUtil","utils/AppUtil","utils/StyleDescriptor","utils/D3Util"],function(e,t,i,n,s,a,r,o,l){"use strict";var c={top:45,right:25,bottom:24,left:25};return i.extend({subViewHelper:null,initializeStatsProperties:function(e){i.prototype.initializeStatsProperties.apply(this,arguments),this.bucketTypes=e.bucketTypes,this.metricType=e.metricType},renderChart:function(){var i=this.getChartContainer();if(this._isThereDataToRender()){this.showChart();var n=this;this.graph=t.addGraph(function(){n._svg||(n._svg=e.select(i).append("svg").attr("class","chart-drilldown"));var s=t.models.lineChart().useInteractiveGuideline(!0).showLegend(!0).showYAxis(!1).showXAxis(!0).showYZeroLine(!0).transitionDuration(0).margin(c).rectMode(!0).adjustLegendY(5).adjustLegendX(24).yZeroLineExtend(!0).tickPadding(10).excludeLegendsFromMarginTop(!0);s.xAxis.showMaxMin(!1).tickFormat(function(e){return a.formatLongTime(e)}),s.yAxis.showMaxMin(!1).tickFormat(function(e){return e+n.units.toLowerCase()}),n._svg.datum(n.lineChartData).call(s),t.utils.windowResize(s.update),n.chart=s;var r=n.$(".nv-lineChart rect").attr("height");n.yValForSVG=r?parseInt(r,10):0;var o=n,l=function(e){o.drillDownTimeStamp=e.pointXValue,o._renderDrillDownLine(e.pointXValue),o.showDrillDown(e.pointXValue)};return n.bucketTypes&&n.bucketTypes.length&&s.interactiveLayer.dispatch.on("elementClick",l),n._renderLatestDrillDown(),s})}else this.showNoData()},_renderLatestDrillDown:function(){var e=this._getLatestTimeStamp();this.drillDownLine||this._renderDrillDownLine(e);var t=this.chart.xScale()(e)+c.left;Number(this.drillDownLine.attr("x1"))===t?(this._renderDrillDownLine(e),this.showDrillDown(e)):this._renderDrillDownLine(this.drillDownTimeStamp)},_getLatestTimeStamp:function(){var e;if(this.graphData&&this.graphData[0]&&this.graphData[0].length){var t=this.graphData[0].length;e=t&&t>0?this.graphData[0][t-1][0]:0}return e},_renderDrillDownLine:function(e){var t,i,n,s,a,u,d,h,p,_,T,E,S,g,A,m,f=r.formatDate(e,"h:ii:ssa");e&&(t=this.chart.xScale()(e)+c.left,i=t,n=this.yValForSVG+c.top,s=c.top,h=2,u=t,d=s-h,T=50,E=24,p=t-T/2,_=n,S=t,g=n+E/2+3,A="text-drilldown",a=o.FS.COLORS_MAP.BLUE,m=o.CP.COLORS_MAP.WHITE,this.drillDownLine?(this.drillDownLine.attr({x1:t,x2:i,y1:n,y2:s}),this.drillDownCircle.attr({cx:u,cy:d,r:h}),this.drillDownRect.attr({x:p,y:_,width:T,height:E}),this.drillDownText.attr({x:S,y:g}),this.drillDownText.text(f)):(this.drillDownLine=l.renderSVGLine(this._svg,t,i,n,s,a),this.drillDownCircle=l.renderSVGCircle(this._svg,u,d,h,a,a),this.drillDownRect=l.renderSVGRect(this._svg,p,_,T,E,a,a),this.drillDownText=l.renderSVGText(this._svg,f,S,g,m,"middle",A)),this.drillDownText.attr("timestamp",e))},setEntityId:function(){i.prototype.setEntityId.apply(this,arguments),this.hideDrillDown(),this._svg&&(this._svg.remove(),this._svg=null,this.drillDownLine=null)},showDrillDown:function(e){this.subViewHelper?this.updateSubView(e):(this.subViewHelper=new s,this.initializeSubView(e)),this.subViewHelper.renderAll()},hideDrillDown:function(){this.subViewHelper&&(this.subViewHelper.iterate("onStopServices"),this.subViewHelper.removeAll(),this.subViewHelper=null)},initializeSubView:function(e){var t=$(this.getChartContainer()),i=$('<div class="buckets-container"></div>');t.append(i);var s=new n({entityType:this.entityType,entityId:this.entityId,el:i,bucketTypes:this.bucketTypes,metricType:this.metricType,timeStamp:Math.floor(e)});this.subViewHelper.register("ChartBucketSubView",s),this.subViewHelper.iterate("onStartServices")},updateSubView:function(e){this.subViewHelper.iterate("updateTimeStamp",Math.floor(e))},destroy:function(){this.subViewHelper.iterate("onStopServices"),this.subViewHelper.removeAll(),this.subViewHelper=null,i.prototype.destroy.apply(this,arguments)}})}),define("views/basecomponents/charts/groups/UsageBreakdownGroupChartView",["data/DataProperties","views/basecomponents/charts/BaseGroupChartView","views/details/tabs/ChartWithDrillDownView","utils/AppConstants"],function(e,t,i,n){"use strict";var s=[e.STATS_CONTROLLER_AVG_READ_IO_LATENCY,e.STATS_CONTROLLER_AVG_WRITE_IO_LATENCY],a=[e.STATS_CONTROLLER_AVG_IO_LATENCY,e.STATS_CONTROLLER_TOTAL_IO_SIZE,e.STATS_CTRLR_READ_SRC_CACHE_SSD_BYTES,e.STATS_CTRLR_RANDOM_READ_OPS];return t.extend({stats:null,intervalTimeInMilliSec:n.IO_LATENCY_STATS_INTERVAL,initializeStatsProperties:function(e){e.entityType&&(this.entityType=e.entityType),e.entityId&&(this.entityId=e.entityId),e.metrics?this.metrics=e.metrics:this.metrics=s,e.bucketTypes?this.bucketTypes=e.bucketTypes:this.bucketTypes=a},render:function(){var e;return this.entityType===n.ENTITY_VM&&(e=new i({metricType:this.metrics,bucketTypes:this.bucketTypes,entityType:this.entityType,entityId:this.entityId}),this.$el.append(e.render().el)),e&&this.subViewHelper.register("chartWithDrillDownView",e),this},updateStatsCharts:function(){var e=this.subViewHelper.get("chartWithDrillDownView");e&&e.updateChartData(this.statsModel)},fetchOnDemand:function(e,i,n,s){t.prototype.fetchOnDemand.apply(this,arguments),e&&(this.entityId=e,this.subViewHelper.iterate("setEntityId",e))},showLoadingState:function(){var e=this.subViewHelper.get("chartWithDrillDownView");e&&e.showLoading()},showNoData:function(){this.subViewHelper.iterate("showNoData")}})}),define("views/details/tabs/UsageBreakdownTabContentDetailsView",["views/basecomponents/details/tabs/BaseTabContentDetailsView","views/basecomponents/charts/groups/UsageBreakdownGroupChartView","utils/AppUtil"],function(e,t,i){"use strict";return e.extend({extraClassName:"n-usage-breakdown-tab-content-details",grpChartUsageBreakdownView:null,metricsDefault:null,initializeProperties:function(e){},render:function(){return this.grpChartUsageBreakdownView=new t({entityType:this.entityType}),this.$el.append(this.grpChartUsageBreakdownView.render().el),this},destroy:function(){i.debug("UsageBreakdownTabContentDetailsView : destroy: "," | viewid     : "+this.cid),e.prototype.destroy.apply(this,arguments)},postSetModelId:function(e){this.grpChartUsageBreakdownView&&i.isValidId(e)&&this.grpChartUsageBreakdownView.fetchOnDemand(e)},onStartServices:function(){this.grpChartUsageBreakdownView&&this.grpChartUsageBreakdownView.startServices()},onStopServices:function(){this.grpChartUsageBreakdownView&&this.grpChartUsageBreakdownView.stopServices()}})}),define("models/intent/IntentPollingModel",["models/PollingModel","managers/IntentManager","managers/NotificationManager","data/DataManager","utils/AppConstants"],function(e,t,i,n,s){"use strict";return e.extend({name:"IntentPollingModel",AGGRESSIVE_POLLING_INTERVAL:5e3,initialize:function(i){this.entityType=i.entityType,this.urlObj=t.getFetchURLObject(this.entityType),this.urlRoot=this.urlObj.url;var n=t.getEntitiesRequest(this.urlObj);this.clear({silent:!0}),this.set(n,{silent:!0}),e.prototype.initialize.apply(this,arguments)},fetch:function(e){return this.save(null,e)},getEntitiesData:function(){return this.get("entities")},showSuccessNotification:function(){},showLatencyNotification:function(){},showErrorNotification:function(e,n,a){var r=t.interpretIntentServerError(a);i.showClientNotification(s.NOTIFY_ERROR,r)},getURL:function(e,t){if(!this.urlRoot)throw new Error("Invalid urlRoot. Seems there is no url path for this entity type.");return 0===this.urlRoot.indexOf("/")?this.urlRoot.substring(1):this.urlRoot},getDataSourceURL:function(){return n.getDataSourceURL(n.API_VERSION.V3)}})}),define("views/intent/IntentListView",["views/basecomponents/BaseView","models/intent/IntentPollingModel","utils/AppConstants"],function(e,t,i){"use strict";return e.extend({name:"IntentListView",className:"app-list",template:"",modelEvents:{"change model":"render","error model":"render"},initialize:function(e){this.entityType=e.entityType,this.model=new t({entityType:this.entityType}),this.model.showError=!0},render:function(){return this.$el.html(this.template),this.model.getState()!==i.STATE_INIT&&(this.hideLoader(),this.refreshList(this.model.getEntitiesData())),this},refreshList:function(e){},hideLoader:function(){this.$(".data-loader").hide()},onStartServices:function(){this.delegateModelEvents(),this.model.startPolling()},onStopServices:function(){this.undelegateModelEvents(),this.model.stopPolling()}})}),define("text!templates/prismlet/PAWidgetView.html",[],function(){return'<img class="app-icon" src="<%= iconData %>">\n<div class="img-footer">\n  <div class="left-panel">\n    <span class="app-name"><%= name %></span>\n  </div>\n  <div class="right-panel">\n    <% if (showAction) { %>\n    <div class="app-actions"></div>\n    <% } %>\n    <div class="poller-container"></div>\n  </div>\n</div>'}),define("views/prismlet/PAWidgetView",["views/basecomponents/BaseView","utils/SVG","utils/AppConstants","utils/AppUtil","components/Components","data/DataProperties","managers/ActionManager","managers/IntentManager","managers/NotificationManager","text!templates/prismlet/PAWidgetView.html"],function(e,t,i,n,s,a,r,o,l,c){"use strict";c=_.template(c);var u={ICON_UUID:"icon_image_uuid"};return e.extend({name:"PAWidgetView",className:"app-widget",events:{"click .action-item":"executeAction"},initialize:function(e){this.dataModel=e.model,this.entityType=e.entityType;var t=this.dataModel[a.INTENT_STATUS]||{},s=t[a.INTENT_RESOURCES];switch(s||(s={},n.log("PAWidgetView :: No resources found.")),this.entityType){case i.ENTITY_EXTENSION:var r=s[a.INTENT_AVAILABLE_EXT_REF];r||(r={},n.log("PAWidgetView :: No details found.")),this.model=r;break;case i.ENTITY_AVAILABLE_EXT:this.model=s}this.uuid=e.uuid},render:function(){var e=o.SWAGGER_PROPERTIES,a=this.model[e.PROP_NAME],r=this.dataModel[e.PROP_STATUS][e.PROP_STATE],d=o.getFormattedURL({action:i.ACTION_FETCH,actionTarget:i.ENTITY_AVAILABLE_EXT_IMAGES,actionTargetId:this.model[u.ICON_UUID]});if(this._addActionAttr(this.model),this.$el.html(c({name:a,iconData:d,showAction:this.entityType===i.ENTITY_EXTENSION})),this.$(".app-actions").html(s.dropdown({classes:"n-actions-dropdown",variants:"-icon-only-trigger",text:t.SVGIcon("C"),options:this._getDropdownOptions(),rightAlign:!0})),!n.isIntentStateComplete(this.entityType,r)){var h=this._getDisplayStatus(r,a);this.$el.addClass("disable-widget"),this.$(".app-name").text(h),this.$(".app-actions").hide(),n.addInLineDonutLoader(this.$(".poller-container")),l.showClientNotification(i.NOTIFY_INFO,h)}return this},executeAction:function(e){var t=o.SWAGGER_PROPERTIES,n=this.model[t.PROP_NAME];e.stopPropagation(),this.$(".n-actions-dropdown .dropdown-toggle").dropdown("toggle");var s=$(e.currentTarget).data("actionId"),a={};switch(s){case i.ACTION_DETAILS:a[i.NAV_ACTION]=i.ACTION_FETCH,a[i.NAV_ACTION_TARGET_NAME]=n;break;case i.ACTION_UPDATE:a[i.NAV_ACTION_TYPE]=i.ACTION_TYPE_BATCH,a[i.NAV_ACTION_ID]=i.ACTION_UPDATE;break;case i.ACTION_DELETE:a[i.NAV_ACTION_TYPE]=i.ACTION_TYPE_BATCH,a[i.NAV_ACTION_ID]=i.ACTION_DELETE}a[i.NAV_ACTION_TARGET]=this.entityType,a[i.NAV_ACTION_TARGET_ID]=this.uuid,r.executeAction(a)},_addActionAttr:function(e){var t=o.SWAGGER_PROPERTIES,n=e[t.PROP_NAME];this.$el.attr(i.NAV_ACTION,i.ACTION_FETCH),this.$el.attr(i.NAV_ACTION_TARGET,this.entityType),this.$el.attr(i.NAV_ACTION_TARGET_ID,this.uuid),this.$el.attr(i.NAV_ACTION_TARGET_NAME,n),this.$el.data("type",this.entityType)},_getDropdownOptions:function(){return[{attributes:'data-action-id="details"',class:"action-item",name:this.i18n("details")},{attributes:'data-action-id="upgrade"',class:"action-item",name:this.i18n("upgrade")},{attributes:'data-action-id="uninstall"',class:"action-item",name:this.i18n("uninstall")}]},_getDisplayStatus:function(e,t){var n=i.INTENT_RESPONSE_STATUS;switch(e){case n.PENDING:return this.i18ns("waiting",t);case n.RUNNING:return this.i18ns("installing",t);case n.DELETE_PENDING:return this.i18ns("deleting",t);default:return""}}})}),define("models/prismlet/PrismletGuestToolAppModel",["models/PollingModel","data/DataURLConstants","utils/AppConstants"],function(e,t,i){"use strict";return e.extend({urlRoot:t.PRISMLET_GUEST_TOOL_APP,entityType:i.ENTITY_PRISMLET_APP,name:"PrismletGuestToolAppModel",appId:null,getURL:function(e,t){return"/"+this.urlRoot+"/"+t.appId+"/"+t.appUrl},getDataSourceURL:function(){return t.PRISMLET_NGT_APP}})}),define("models/prismlet/PrismletAppDataModel",["models/BaseModel","data/DataURLConstants","data/DataProperties","utils/AppConstants"],function(e,t,i,n){"use strict";return e.extend({name:"PrismletAppDataModel",urlRoot:t.APP_SYSTEM_DATA,entityType:n.ENTITY_SYSTEM_DATA,defaults:{type:i.SYSTEM_DATA_TYPE_APPS,key:i.SYSTEM_DATA_TYPE_APPS_DATASTORE,value:null},getURL:function(e){var t=this.urlRoot;return"read"!==e&&"delete"!==e||null!==this.get(i.SYSTEM_DATA_KEY)&&(t+="/"+this.get(i.SYSTEM_DATA_KEY)),t},getDataSourceURL:function(){return"/PrismGateway/services/rest/v1/"}})}),define("managers/APIManager",["models/alert/AlertActionModel","managers/AccessManager","managers/NotificationManager","managers/ModelInstanceManager","models/prismlet/PrismletGuestToolAppModel","models/prismlet/PrismletAppDataModel","utils/AppUtil","utils/AppConstants","data/DataProperties"],function(e,t,i,n,s,a,r,o,l){"use strict";var c={VMS:"VMS",HOSTS:"HOSTS",DISKS:"DISKS",ALERTS:"ALERTS",PDS:"PDS"},u={ACCESS_DENIED_ENTITY_TYPE:_.template("You do not have permission to access this entity type: <%= type %>")},d=0,h={ENTITY_TYPES:c,factoryId:null,guestToolData:null,fetch:function(e){e=e||{}
;var s=e.entityType;if(!t.canViewByEntityType(s))return void i.showClientNotification(o.NOTIFY_ERROR,u.ACCESS_DENIED_ENTITY_TYPE({type:s}));var a;if(a=e.id?n.getModel(this.factoryId,s,e.id):n.getCollection(this.factoryId,s))return a.fetch({success:function(t,i){_.isFunction(e.success)&&e.success(t.toJSON(),i)},error:function(t,i){_.isFunction(e.error)&&e.error(i)}});r.log("APIManager error: The API for the entityType ("+s+") could not be found.")},resolveAlert:function(n){if(!t.canModifyByEntityType(o.ENTITY_ALERT))return void i.showClientNotification(o.NOTIFY_ERROR,u.ACCESS_DENIED_ENTITY_TYPE({type:o.ENTITY_ALERT}));(new e).resolveAlerts([n.id])},fetchAppData:function(e){var t=n.getPrismAppModel(this.factoryId,e.appId);t?t.clear&&t.clear():(t=new s,t.appId=e.appId,n.setPrismAppModel(t)),t.fetch(e)},postAppData:function(e){var t=n.getPrismAppModel(this.factoryId,e.appId);t?t.clear&&t.clear():(t=new s,t.appId=e.appId,n.setPrismAppModel(t)),t.save(e.formData,e)},saveGatewayAppData:function(e){var t=new a,i=this;t.fetch({success:function(){i._actualSaveAppData(t,e,!1)},error:function(){i._actualSaveAppData(t,e,!0)}})},_actualSaveAppData:function(e,t,i){var n=JSON.parse(e.get(l.SYSTEM_DATA_VALUE));n=n||{},n[this.guestToolData.vmId]=t.body,e.isNew(i),e.save({value:JSON.stringify(n)},{success:t.success,error:t.error})}};return{getAPIObject:function(e){var t=_.clone(h);return t.factoryId=d++,t.guestToolData=e.guestToolData,n.registerFactoryInstance(t),t}}}),define("text!templates/prismlet/PrismletView.html",[],function(){return'<header class="n-prismlet-header">\n  <div class="n-prismlet-name headline">\n    \x3c!-- Name goes here... --\x3e\n  </div>\n  <div class="back-to-dashboard dashboardPanel">\n    <svg width="5" height="8" viewBox="0 0 5 8">\n      <path d="M3.977,7.973 C4.234,7.973 4.488,7.875 4.684,7.680 C5.074,7.289 5.074,6.656 4.684,6.266 C4.684,6.266 2.391,3.973 2.391,3.973 C2.391,3.973 4.684,1.680 4.684,1.680 C5.074,1.289 5.074,0.656 4.684,0.266 C4.293,-0.125 3.660,-0.125 3.270,0.266 C3.270,0.266 0.270,3.266 0.270,3.266 C-0.121,3.656 -0.121,4.289 0.270,4.680 C0.270,4.680 3.270,7.680 3.270,7.680 C3.465,7.875 3.723,7.973 3.977,7.973 Z" fill="#fff"/>\n    </svg>\n    Back\n  </div>\n</header>\n<section class="n-prismlet-body">\n  \x3c!-- Body goes here... --\x3e\n</section>'}),define("views/prismlet/PrismletFrameView",["views/basecomponents/BaseView","views/basecomponents/iframe/IFrameView","managers/APIManager","text!templates/prismlet/PrismletView.html"],function(e,t,i,n){"use strict";return e.extend({className:"n-prismlet",iFrameView:null,appId:null,prismletModel:null,isVantagePointMode:!1,guestToolData:null,initialize:function(e){e=e||{},this.guestToolData=e.guestToolData,this.appInfo=e.appInfo,this.isVantagePointMode=e.isVantagePointMode},render:function(){this.$el.html(n),this.$(".n-prismlet-name").html(this.appInfo.name);var e=this.appInfo.url,i="100%";return this.isVantagePointMode&&(e+="/index_vantage_point.html",i="250px"),this.iFrameView=new t({iFrameId:this.appInfo.id,url:e,width:"100%",height:i}),this.$(".n-prismlet-body").html(this.iFrameView.render().el),this},getPrismletContent:function(){var e="#"+this.appInfo.id;if(this.$(e).length)return this.$(e)[0].contentWindow},getPrismNamespace:function(){return{APIFactory:i.getAPIObject({guestToolData:this.guestToolData}),WidgetFactory:null}},destroy:function(){this.getPrismletContent()&&this.getPrismletContent().destroy&&this.getPrismletContent().destroy(),this.iFrameView.destroy(),e.prototype.destroy.apply(this,arguments),this.$el.remove()},resize:function(e,t){},onStartServices:function(){},onStopServices:function(){},show:function(){this.$el.show()},hide:function(){this.$el.hide()}})}),define("text!templates/prismlet/NoExtensionFound.html",[],function(){return'<div class="no-extensions-found">\n  <div class="n-message"><%= noExtensionsFound %></div>\n  <button type="button" class="btn btn-primary go-to-store">\n    <%= goToStore %>\n  </button>\n</div>'}),define("views/prismlet/PAListView",["views/intent/IntentListView","views/prismlet/PAWidgetView","views/prismlet/PrismletFrameView","managers/ActionManager","managers/EntityStateTracker","managers/NotificationManager","data/DataManager","utils/AppUtil","utils/AppConstants","utils/SubViewHelper","events/AppEvents","data/DataURLConstants","data/DataProperties","text!templates/prismlet/NoExtensionFound.html"],function(e,t,i,n,s,a,r,o,l,c,u,d,h,p){"use strict";var T=_.template('<div class="app-wrapper" data-app-id=<%= uuid %>></div>');return p=_.template(p),e.extend({template:'<div class="data-loader"><div class="donut-loader-blue"></div><span class="loader-msg">Loading...</span></div>',name:"PAListView",subViewHelper:null,events:{"click  .app-widget":"onAppClick","click  .go-to-store":"onGoToStore"},initialize:function(t){this.containerEl=t.containerEl,this.eventBus=t.eventBus,_.bindAll(this,"onAppClosing","onEntityStateChanged"),this._listenToEvents(this.eventBus),this.subViewHelper=new c,e.prototype.initialize.apply(this,arguments)},destroy:function(){this._unlistenToEvents(this.eventBus),e.prototype.destroy.apply(this,arguments)},refreshList:function(e){if(e){var t,i=e.length;i>0?(t=$("<div></div>"),this._renderExtensions(e,t)):t=p({noExtensionsFound:this.i18n("no_extensions"),goToStore:this.i18n("go_to_store")}),this.$el.empty(),this.$el.append(t)}},onGoToStore:function(){u.triggerAppEvent(u.SWITCH_TABS,l.TAB_DETAILS.AVAILABLE_EXT)},onAppClick:function(e){if(!($(e.target).parents(".app-actions").length>0)){var t=$(e.currentTarget);switch(t.data("type")){case l.ENTITY_EXTENSION:var i=t.attr(l.NAV_ACTION_TARGET_ID);this.startApp(i);break;case l.ENTITY_AVAILABLE_EXT:n.executeActionElement(t)}}},onAppClosing:function(){this.startServices()},onEntityStateChanged:function(e,t){for(var i=this,n=t.length,r=0;r<n;r++){var c=t[r],u=c[s.DP.ENTITY_TYPE],d=c[s.DP.ENTITY_ID];if(u===o.getEntityTypeEB(l.ENTITY_EXTENSION)&&o.findIntentEntity(this.dataModel,d)){a.showClientNotification(l.NOTIFY_INFO,this.i18n("fetching_list")),i.model.fetch();break}}},startApp:function(e){if(this.stopServices(),this.containerEl.addClass("n-show"),this.containerEl.removeClass("n-no-animation"),this.subViewHelper.get(e))return void this.containerEl.find('.app-wrapper[data-app-id="'+e+'"]').show();var t=T({uuid:e});this.containerEl.append(t);var n=this._getAppInfo(e),s=new i({el:t,appInfo:n,width:"100%",height:"100%"});s.render(),this.subViewHelper.register(e,s)},_renderExtensions:function(e,i){for(var n,s,a=e.length,r=Math.ceil(a/3),o=0,l=r;l>0;l--){for(var c=$('<div class="app-row"></div>'),u=3;u>0&&(s=e[o++]);u--)n=new t({model:s,uuid:s[h.INTENT_METADATA][h.UUID],entityType:this.entityType}),c.append(n.render().$el);i.append(c)}},_listenToEvents:function(e){e.on(u.EXTENSION_CLOSE,this.onAppClosing),u.onAppEvent(u.INTENT_ENTITIES_STATE_CHANGED,this.onEntityStateChanged)},_unlistenToEvents:function(e){e.off(u.EXTENSION_CLOSE,this.onAppClosing),u.offAppEvent(u.INTENT_ENTITIES_STATE_CHANGED,this.onEntityStateChanged)},_getFrameURL:function(e){return r.getDataSourceURL(r.API_VERSION.V3)+d.APP_PROXY+e+"/index.html"},_findModelById:function(e){return _.find(this.model.getEntitiesData(),function(t){return t[h.INTENT_METADATA][h.UUID]===e})},_getAppInfo:function(e){var t=this._findModelById(e);return{url:this._getFrameURL(e),name:t[h.INTENT_STATUS][h.INTENT_RESOURCES][h.NAME],id:e}}})}),define("views/details/tabs/FSAntiVirusTabContentWrapperView",["views/basecomponents/details/tabs/BaseTabContentDetailsView","utils/VisualizationUtil","utils/CommonTemplates","utils/AppConstants"],function(e,t,i,n){"use strict";return e.extend({name:"FSAntiVirusTabContentWrapperView",initializeProperties:function(e){var i,s={};e.entityType===n.ENTITY_FILE_SERVER&&(s[n.TAB_DETAILS.ICAP_SERVERS]=this.i18n("icap_servers")),s[n.TAB_DETAILS.REPORTS]=this.i18n("reports"),s[n.TAB_DETAILS.QUARANTINED_FILES]=this.i18n("quarantined_files"),s[n.TAB_DETAILS.UNQUARANTINED_FILES]=this.i18n("unquarantined_files"),i=e.entityType===n.ENTITY_FILE_SERVER?n.ENTITY_ICAP_SERVERS:e.entityType,this.tabDetailsView=t.renderTabDetailsView(this.$el,s,i,e.pageId,"subtab")},setModelId:function(e){this.tabDetailsView.setModelId(e)},setModel:function(e){this.tabDetailsView.setModel(e)},onStartServices:function(){if(this.tabDetailsView.hasTabSelected()||this.tabDetailsView.selectFirstTab(),this.tabDetailsView.$(".nutanixMoreInfo").nutanixMoreInfo("destroy"),!this.tooltipAdded){this.tabDetailsView.$el.find('span[title="Unquarantined Files"]').append(i.MOREINFO_TOOLTIP_TEMPLATE(this.vtOptions({tooltip:{content:this.i18n("unquarantined_tooltip")}}))),this.tooltipAdded=!0}this.tabDetailsView.$(".nutanixMoreInfo").nutanixMoreInfo({parseDataAttrs:!0,placement:"top"}),this.tabDetailsView.onStartServices(),this.delegateEvents()},onStopServices:function(){this.tabDetailsView.$(".nutanixMoreInfo").nutanixMoreInfo("destroy"),this.tabDetailsView.onStopServices()}})}),define("views/basecomponents/datatables/antivirus/FileServerAntiVirusTableView",["views/details/tabs/components/TabDetailsTableView","views/basecomponents/charts/groups/FSUsageGroupChartView","models/fileserver/ICAPServerCollection","models/fileserver/ICAPServerModel","models/stats/UpdatedTimeStatsModel","data/DataProperties","components/Components","managers/ActionManager","managers/NotificationManager","utils/AppUtil","utils/VisualizationUtil","utils/AppConstants","utils/StatsUtil"],function(e,t,i,n,s,a,r,o,l,c,u,d,h){"use strict";var p=_.template('<div class="connection-status" connection-id="ok"><span class="inactiveLink">'+r.icon("check","-mini -success")+"</span><span><%= ok %></span></div>"),T=_.template('<div class="connection-status retest-connection" connection-id="retest" data-id="<%= fsUuid %>"><a>'+r.icon("x-round","-mini -critical")+"</a><a> <%= retest %></a></div>"),E=_.template('<div class="connection-status not-tested"><%= notTested %></div>');return e.extend({name:"FileServerAntiVirusTableView",selectDefaultRow:null,icapCount:0,className:"n-base-data-table n-icapserver-table",graphsTemplate:_.template('<div class="graph-container"></div>'),initialize:function(t){e.prototype.initialize.apply(this,arguments),this.addExtraEvents({"click .btnItemAction":"onClickLinkAction","click td a.action-label":"onClickLinkAction","click div.retest-connection":"onClickTestConnection","click tbody > tr":"onClickOverRow"})},render:function(){return e.prototype.render.apply(this,arguments),this.$el.append(this.graphsTemplate),this},initializeTableModel:function(e){this.model=new i({filterByUser:!1}),this.setModelId(e.actionTargetId)},onDataChange:function(){this.icapServerCount=this.model&&this.model.models&&this.model.models.length,this.icapServerCount?_.each(this.model.models,function(e){this.updateICAPStats(e)},this):this.renderICAPDataTable()},getDefaultColumns:function(){var e=this;return[{sTitle:e.i18n("ip_address"),sWidth:"20%",sClass:"ip-address",mData:n.DP.IP_ADDRESS,mRender:function(e,t,i){return e}},{sTitle:e.i18n("port"),sClass:"port",mData:n.DP.PORT_NO,mRender:function(e,t,i){return e}},{sTitle:e.i18n("description"),sClass:"description",mData:n.DP.DESCRIPTION,mRender:function(e,t,i){return e}},{sTitle:e.i18n("files_scanned"),sClass:"files-scanned",mData:n.DP.NUM_FILES_SCANNED,mRender:function(e,t,i){return e}},{sTitle:e.i18n("disconnect_count"),sClass:"disconnect-count",mData:n.DP.NUM_DISCONNECT_COUNT,mRender:function(e,t,i){return e||0}},{sTitle:e.i18n("avg_latency"),sClass:"avg-latency",mData:n.DP.AVG_LATENCY,mRender:function(e,t,i){return e}},{sTitle:e.i18n("connection_status"),mData:n.DP.CONNECTION_STATUS,mRender:function(t,i,s){return t?1===t?p(e.vtOptions({ok:e.i18n("ok")})):"default"===t?"":T(e.vtOptions({fsUuid:s[n.DP.FS_UUID],retest:e.i18n("retest")})):E(e.vtOptions({notTested:e.i18n("not_tested")}))}},{sTitle:e.i18n("actions"),mData:n.DP.UUID,sWidth:"20%",sClass:"right",mRender:function(t,i,n){return""===t?"":e._renderIcapAntiVirusActions(t,n)}}]},setModelId:function(e){this.model.setFSId(e),this.options[d.NAV_ACTION_TARGET_ID]=e,this.refreshData()},refreshData:function(){this.model.fetch({error:function(e,t){l.showClientNotification(d.NOTIFY_ERROR,c.processAjaxError(t.responseText))}})},updateICAPStats:function(e){var t=this,i=[a.STATS_CONTROLLER_ICAP_FILES_SCANNED_OVER_TIME,a.STATS_CONTROLLER_ICAP_LATENCY_OVER_TIME,a.STATS_CONNECTION_STATUS_FETCHED],n=this.options[d.NAV_ACTION_TARGET_ID],r=d.ENTITY_ICAP_SERVERS,o=e.get(e.DP.UUID),l=d.ICAP_SERVERS;this.icapCount=0;var c=new s;c.setStatsFor(o,l,i,n,r),c.setTimeInterval(h.getStatsStartTime(),h.getStatsCurrentTime(),h.getSamplingIntervalSecs(i)),c.fetch({alwaysTriggerChange:!0,alwaysTriggerPending:!0,success:function(i,n){_.each(c.attributes.metricIds,function(t,i){var n=0,s=0,r=0;_.each(c.attributes.stats[i],function(e){n=parseFloat(n)+parseFloat(e[1])}),t===a.STATS_CONTROLLER_ICAP_FILES_SCANNED_OVER_TIME?e.set(e.DP.NUM_FILES_SCANNED,n):t===a.STATS_CONTROLLER_ICAP_LATENCY_OVER_TIME?(r=c.attributes.stats[i].length,n&&(s=(n/r).toFixed(2)),e.set(e.DP.AVG_LATENCY,s)):t===a.STATS_CONNECTION_STATUS_FETCHED&&e.set(e.DP.CONNECTION_STATUS,n)},this),t.icapCount++,t.renderICAPDataTable()},error:function(e,i){t.icapCount++,t.renderICAPDataTable()}})},renderICAPDataTable:function(){var t=!1;if(this.icapServerCount&&this.icapCount===this.model.models.length&&(this.appendRowData(),t=!0),e.prototype.onDataChange.call(this),!this.selectDefaultRow&&t){this.$("tbody > tr:first-child").click()}},_renderIcapAntiVirusActions:function(e,t){var i=e,s=!1,a=t[n.DP.FS_UUID];return t[n.DP.ENABLE]&&(s=!0),this.renderIcapAntiVirusActions(a,i,s)},renderIcapAntiVirusActions:function(e,t,i){var n={};return t&&(i?n[d.ACTION_DISABLE]=u.DISABLE:n[d.ACTION_ENABLE]=u.ENABLE,n[d.ACTION_ANTIVIRUS_SETUP]=u.UPDATE,n[d.ACTION_DELETE]=u.DELETE),u.renderItemActions(d.ENTITY_FILE_SERVER,e,t,n)},onClickOverRow:function(e){var t=e.currentTarget,i=this.$("tbody > tr.row_selected");t&&(i.removeClass("row_selected"),$(t).addClass("row_selected")),this.selectDefaultRow=this.dataTable.fnGetData(t),this.selectDefaultRow&&(this.selectDefaultRow[n.DP.FS_UUID]?this.refreshGraphData(this.selectDefaultRow):this.getDefaultGraph())},refreshGraphData:function(e){var i,s,a=$(".graph-container");e&&(s=e[n.DP.FS_UUID],i=e[n.DP.UUID]),this.filesChartUsageView&&this.filesChartUsageView.onStopServices(),this.filesChartUsageView=new t({entityParentId:s,entityParentType:d.ENTITY_ICAP_SERVERS,entityType:d.ICAP_SERVERS,entityId:i}),a.html(this.filesChartUsageView.render().el),this.filesChartUsageView.startServices()},getDefaultGraph:function(){var e=$(".graph-container");this.filesChartUsageView&&this.filesChartUsageView.stopServices(),this.filesChartUsageView=new t({entityType:d.ENTITY_ICAP_SERVERS,entityId:this.options[d.NAV_ACTION_TARGET_ID]}),e.html(this.filesChartUsageView.render().el),this.filesChartUsageView.startServices()},appendRowData:function(){var e=0,t=0,i=0,s=new n;s.set(s.DP.UUID,null),s.set(s.DP.IP_ADDRESS,this.i18n("all_icap_servers")),s.set(s.DP.PORT_NO,null),s.set(s.DP.DESCRIPTION,null),s.set(s.DP.CONNECTION_STATUS,d.STATS_DEFAULT_VAL),s.set(s.DP.ENABLE,null),_.each(this.model.models,function(n,a){n.get(s.DP.AVG_LATENCY)&&(e+=parseFloat(n.get(s.DP.AVG_LATENCY))),n.get(s.DP.NUM_FILES_SCANNED)&&(t+=parseFloat(n.get(s.DP.NUM_FILES_SCANNED))),n.get(s.DP.NUM_DISCONNECT_COUNT)&&(i+=parseFloat(n.get(s.DP.NUM_DISCONNECT_COUNT)))}),e&&this.model.models.length>0&&(e=(e/this.model.models.length).toFixed(2)),s.set(s.DP.AVG_LATENCY,e),s.set(s.DP.NUM_DISCONNECT_COUNT,i),s.set(s.DP.NUM_FILES_SCANNED,t),this.model.models.unshift(s)},onClickLinkAction:function(e){var t=$(e.currentTarget),i=t.attr(d.NAV_ACTION);i===d.ACTION_ANTIVIRUS_SETUP?this.openICAPServerWizard(t,i):i===d.ACTION_DELETE?this.deleteICAPServer(e):this.disableICAPServer(e)},openICAPServerWizard:function(e,t){var i={action:t,actionId:d.ACTION_EDIT,actionTarget:e.attr(d.NAV_ACTION_TARGET),actionTargetId:e.attr(d.NAV_ACTION_TARGET_ID),actionTargetName:this.options.actionTargetName,actionTargetElem:e.attr(d.NAV_ACTION_TARGET_NAME),clickAction:d.ENTITY_ICAP_SERVERS};o.executeAction(i)},deleteICAPServer:function(e){var t=this,i=$(e.currentTarget),n=i.closest("tr"),s=n.find(".ip-address").text().trim(),a="<p>"+this.i18ns("delete_confirm",s)+"</p>";2===this.icapServerCount&&(a+=this.i18n("delete_warning")),$.nutanixConfirm({msg:a,yes:function(){t.confirmedDeleteRow(i,n,s)},context:this})},confirmedDeleteRow:function(e,t,i){var s=this,a=new n;a.set(a.DP.FS_UUID,e.attr(d.NAV_ACTION_TARGET_ID)),a.set(a.DP.UUID,e.attr(d.NAV_ACTION_TARGET_NAME)),a.actionMode=d.ACTION_DELETE,a.set(a.DP.NAME,i),a.destroy({success:function(e,i){t.remove(),s.icapServerCount--},error:function(e,t){l.showClientNotification(d.NOTIFY_ERROR,c.processAjaxError(t.responseText))}})},disableICAPServer:function(e){var t,i=$(e.currentTarget),s=$(e.currentTarget).closest("tr"),a=i.attr(d.NAV_ACTION_TARGET_ID),r=i.attr(d.NAV_ACTION),o=this,u=new n;t=this.getRowData(s),t[u.DP.FS_UUID]=a,r===d.ACTION_ENABLE?t[u.DP.ENABLE]=!0:t[u.DP.ENABLE]=!1,u.set(u.DP.NAME,t[u.DP.IP_ADDRESS]),u.actionMode=d.ACTION_UPDATE,u.save(t,{success:function(e,t){!0===t[u.DP.ENABLE]?i.html(o.i18n("disable")):i.html(o.i18n("enable"))},error:function(e,t){c.log("FileServerAntiVirusTableView: Error :"+t),l.showClientNotification(d.NOTIFY_ERROR,c.processAjaxError(t.responseText))}})},onClickTestConnection:function(e){var t,i,s,a=this,r=$(e.currentTarget),o=r.closest("tr"),u=r.attr("data-id");t=new n,i=this.getRowData(o),i[t.DP.FS_UUID]=u,t.isNew(!0),t.set(t.DP.NAME,i[t.DP.IP_ADDRESS]),t.actionMode=d.ACTION_CONNECTION_TEST,t.save(i,{success:function(e,t){"kOk"===e.get("value").replace(/\s/g,"").split(":")[1]&&(s=p(a.vtOptions({ok:a.i18n("ok")})),o.find(".connection-status").html(s))},error:function(e,t){c.log("FileServerAntiVirusTableView: Error :"+t),l.showClientNotification(d.NOTIFY_ERROR,c.processAjaxError(t.responseText))}})},getRowData:function(e){return{ipAddress:e.find(".ip-address").text().trim(),port:e.find(".port").text().trim(),description:e.find(".description").text().trim(),connectionStatus:e.find(".connection-status").attr("connection-id"),uuid:e.attr(d.NAV_ACTION_TARGET_ID)}},onStopServices:function(){this.filesChartUsageView&&this.filesChartUsageView.stopServices(),this.selectDefaultRow=null,e.prototype.onStopServices.apply(this,arguments)}})}),define("views/details/tabs/components/AntivirusAlertTableView",["views/details/tabs/components/TabDetailsTableView","data/DataURLConstants","utils/TimeUtil","utils/AppConstants"],function(e,t,i,n){"use strict";return e.extend({name:"AntivirusAlertTableView",currentEntityType:n.ENTITY_FILE_SERVER,initialize:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t.entityType===n.ENTITY_SHARE&&(this.currentEntityType=n.ENTITY_SHARE),t.entityType=n.ENTITY_EVENT,e.prototype.initialize.apply(this,arguments),this.defaultMinRows=10},getDefaultColumns:function(e,t){var s=this,a=function(e,t,i){return e},r=[];e!==n.ENTITY_SHARE&&r.push({sTitle:s.i18n("share"),mData:function(e){var t=e.contextTypes.indexOf("file_server_share_name");return-1!==t?e.contextValues[t]:""},sWidth:"10%",mRender:a});var o=[{sTitle:s.i18n("file_path"),mData:function(e){var t=e.contextTypes.indexOf("file_path");return-1!==t?e.contextValues[t]:""},sWidth:"25%",mRender:a},{sTitle:s.i18n("threat_description"),mData:function(e){var t=e.contextTypes.indexOf("threat_desc");return-1!==t?e.contextValues[t]:""},sWidth:"25%",mRender:a},{sTitle:s.i18n("icap_server"),mData:function(e){var t=e.contextTypes.indexOf("scan_server_host");return-1!==t?e.contextValues[t]:""},sWidth:"10%",mRender:a},{sTitle:s.i18n("time"),mData:"createdTimeStampInUsecs",sWidth:"10%",mRender:function(e,t,n){var s=e/1e3;return i.formatDateTime(s)}},{sTitle:s.i18n("action_taken"),mData:function(e){var t=e.contextTypes.indexOf("action");return-1!==t?e.contextValues[t]:""},sWidth:"20%",mRender:a}];return r=r.concat(o)},initializeDataTableSettings:function(){e.prototype.initializeDataTableSettings.apply(this,arguments),_.extend(this.dataTableSettings,{bSort:!1})},setModelId:function(e){this.currentModelId=e,this.postSetModelId(e)},postSetModelId:function(e){var t=void 0;t=this.generateURL(e),this.setModelURL(t),this.refreshData()},generateURL:function(e){var i=void 0,n=void 0;return i=t.EVENT,n=i+_.template(t.FS_ALERT_EVENT)({etype:this.currentEntityType,eid:e}),n+="&typeIds=FileServerIcapFileActionAudit"}})}),define("views/details/tabs/components/AntivirusScannedFileTableView",["views/details/tabs/components/TabDetailsTableView","models/stats/UpdatedTimeStatsModel","utils/StatsUtil","data/DataProperties","utils/AppConstants"],function(e,t,i,n,s){"use strict";var a=t.extend({name:"FileServerStatsModel",parse:function(e){var t=function(e){var t=0;return _.each(e,function(e){e>0&&(t+=e)}),t},i={};return e&&e.statsSpecificResponses&&_.each(e.statsSpecificResponses,function(e){i[e.metric]=t(e.values)}),{entities:[i]}},toJSON:function(){return this.attributes.entities}});return e.extend({name:"AntivirusScannedFileTableView",metrics:null,intervalTimeInMilliSec:s.DEFAULT_STATS_INTERVAL,model:null,modelEvents:{"change:entities  model":"onDataChange"},initialize:function(t){this.metrics=[n.STATS_CONTROLLER_ICAP_TOTAL_FILES_SCANNED_OVER_TIME,n.STATS_CONTROLLER_ICAP_TOTAL_FILES_THREATED_OVER_TIME,n.STATS_CONTROLLER_ICAP_TOTAL_FILES_CLEANED_OVER_TIME,n.STATS_CONTROLLER_ICAP_TOTAL_FILES_QUARANTINED_OVER_TIME],e.prototype.initialize.apply(this,arguments),this.defaultMinRows=1},initializeTableModel:function(e){this.model=new a,this.model.setTimeInterval(i.getStatsStartTime()),this.model.setStatsFor(e.entityId,e.entityType,this.metrics,e.entityParentId,e.entityParentType),this.model.setSamplingIntervalSecs(i.getSamplingIntervalSecs(this.metrics)),e&&e.entityType&&(e.entityType===s.ENTITY_SHARE?this.entityType=s.ENTITY_SHARE:this.entityType=s.ENTITY_FILE_SERVER),this.model.setIntervalTime(this.intervalTimeInMilliSec)},getDefaultColumns:function(e,t){var i=this;return[{sTitle:i.i18n("scan_period"),mData:function(e){return""},sWidth:"20%",mRender:function(e,t,n){return i.i18n("scan_period_time")}},{sTitle:i.i18n("total_files_scanned"),mData:function(e){return e.icap_scanned_file_count||0},sWidth:"20%",mRender:function(e,t,i){return e}},{sTitle:i.i18n("threats_detected"),mData:function(e){return e.icap_threat_count||0},sWidth:"20%",mRender:function(e,t,i){return e}},{sTitle:i.i18n("files_cleaned"),mData:function(e){return e.icap_cleaned_file_count||0},sWidth:"20%",mRender:function(e,t,i){return e}},{sTitle:i.i18n("files_quarantined"),mData:function(e){return e.icap_quarantined_file_count||0},sWidth:"20%",mRender:function(e,t,i){return e}}]},initializeDataTableSettings:function(){e.prototype.initializeDataTableSettings.apply(this,arguments),_.extend(this.dataTableSettings,{bSort:!1})},onStartServices:function(){e.prototype.onStartServices.apply(this,arguments),this.model&&(this.model.setTimeInterval(i.getStatsStartTime(),i.getStatsCurrentTime(),i.getSamplingIntervalSecs(this.metrics)),this.model.startPolling({alwaysTriggerChange:!0,alwaysTriggerPending:!0}))},getInfoTooltip:function(){return null},setModelId:function(e){this.model.setStatsFor(e,this.entityType,this.metrics),this.refreshData()}})}),define("views/details/tabs/FSAntivirusReportView",["views/basecomponents/BaseView","utils/SubViewHelper","utils/AppConstants","views/details/tabs/components/AntivirusAlertTableView","views/details/tabs/components/AntivirusScannedFileTableView"],function(e,t,i,n,s){"use strict";return e.extend({name:"FSAntivirusReportView",extraClassName:"n-reports-tab-content-details",alertTableView:null,scannedFileTableView:null,initialize:function(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.prototype.initialize.apply(this,arguments),this.pageId=i.pageId,this.entityType=i.entityType,this.subViewHelper=new t},render:function(){return this.subViewHelper.get("ScannedFileTable")||this.entityType===i.ENTITY_SHARE||(this.subViewHelper.register("ScannedFileTable",new s({entityType:this.entityType,pageId:this.pageId,filterByUser:!1})),this.$el.append(this.subViewHelper.get("ScannedFileTable").render().el),this.$el.find(".n-header-right").hide()),this.subViewHelper.get("AlertTable")||(this.subViewHelper.register("AlertTable",new n({entityType:this.entityType,pageId:this.pageId,filterByUser:!0})),this.$el.append(this.subViewHelper.get("AlertTable").render().el),this.$(".n-filter-settings.n-filter-display").hide(),this.$(".n-sep").hide(),this.$(".n-page-info").hide()),this},destroy:function(){this.subViewHelper&&this.subViewHelper.destroy()},refreshData:function(){this.subViewHelper&&this.subViewHelper.iterate("refreshData")},setModelId:function(e){this.subViewHelper&&this.subViewHelper.iterate("setModelId",e)},onStartServices:function(){this.subViewHelper&&this.subViewHelper.iterate("startServices"),this.delegateEvents()},onStopServices:function(){this.subViewHelper&&this.subViewHelper.iterate("stopServices"),this.undelegateEvents()}})}),define("models/fileserver/QuarantinedFilesModel",["models/MinervaModel","data/DataURLConstants","managers/NavigationManager","utils/AppConstants","utils/AppUtil"],function(e,t,i,n,s){"use strict";var a={UUID:"uuid",FS_UUID:"fsUuid",SHARE_UUID:"shareUuid",NAME:"name",FILE_PATH:"filePath",THREAT_DESC:"threatDescription",SCAN_TIME:"scanTimestampUsecs",FILE_STATE:"quarantined",INFECTED_FILE_UUIDS:"infectedFileUuids",SHARE_NAME:"shareName",ICAP_SERVER:"icapServer",ICAP_SERVER_UUID:"icapServerUuid"};return e.extend({urlRoot:t.QUARANTINED_FILES,entityType:n.ENTITY_QUARANTINED_FILE,name:"QuarantinedFilesModel",idAttribute:a.UUID,DP:a,defaults:{uuid:null,fsUuid:null,shareUuid:null,filePath:null,threatDescription:null,scanTimestampUsecs:null,quarantined:null,infectedFileUuids:null},setEntityName:function(e){this.entityName=e},setEntityType:function(e){this.entityType=e},getURL:function(){var e,r=i.getCurrentPageRoute().options,o=s.parseQueryToObject(r);return e=this.get(a.FS_UUID)||o.actionParentId,this.actionMode===n.ACTION_DELETE?_.template(t.QUARANTINED_DELETE,{uuid:e}):this.actionMode===n.ACTION_RESCAN?_.template(t.QUARANTINED_RESCAN,{uuid:e}):this.actionMode===n.ACTION_UNQUARANTINE?_.template(t.QUARANTINE_TO_UNQUARANTINE,{uuid:e}):this.actionMode===n.ACTION_QUARANTINE?_.template(t.UNQUARANTINE_TO_QUARANTINE,{uuid:e}):this.actionMode===n.ACTION_RESET?_.template(t.UNQUARANTINED_RESET,{uuid:e}):void 0}},{DP:a})}),define("models/fileserver/QuarantinedFilesCollection",["models/PollingCollection","models/fileserver/QuarantinedFilesModel","data/DataURLConstants","managers/NavigationManager","utils/AppConstants","utils/AppUtil"],function(e,t,i,n,s,a){"use strict";return e.extend({model:t,url:null,setFSId:function(e,t){var r=n.getCurrentPageRoute().options,o=a.parseQueryToObject(r);t===(s.ENTITY_ICAP_SERVERS||s.ENTITY_FILE_SERVER)?this.url=_.template(i.QUARANTINED_FILES,{uuid:e}):t===s.ENTITY_SHARE&&(this.url=_.template(i.QUARANTINED_FILES+"?shareUuid="+o.actionTargetId.split(":")[1],{uuid:o.actionParentId}))}})}),define("views/details/tabs/FSAntiVirusQuarantinedFilesView",["views/basecomponents/datatables/BasePaginateTableView","views/basecomponents/datatables/DataTableTemplates","components/Components","models/fileserver/QuarantinedFilesCollection","models/fileserver/QuarantinedFilesModel","managers/NotificationManager","data/DataProperties","utils/CommonTemplates","utils/AppConstants","utils/AppUtil","utils/TimeUtil"],function(e,t,i,n,s,a,r,o,l,c,u){"use strict";var d=e.extend({model:null,name:"FSAntiVirusQuarantinedFilesView",initialize:function(){e.prototype.initialize.apply(this,arguments),this.addExtraEvents({"click  .btnIcapAction":"handleQuarantinedActionClick"})},initializeTableModel:function(e){this.model=new n},getEntityTypeName:function(){return this.entityType=l.TAB_DETAILS_NAMES.QUARANTINED_FILE,l.TAB_DETAILS_NAMES.QUARANTINED_FILE},render:function(){return e.prototype.render.call(this),this.$(".n-action").before(this.getActionDropdown()),this.$(".action-dropdown").removeClass("dropdown"),this.$(".dropdown-toggle").addClass(l.FORM_ATTR.DISABLED),this.$el.prepend('<div class="header-message"></div>'),this},checkThresholdValue:function(){var e=c.getPluralEntityName(this.entityType);Math.round(100*this.totalFilteredRows/l.MAX_FILES_LIMIT)>=80&&(d.showWarning=!0,d.fileType=e),this.totalFilteredRows>=l.MAX_FILES_LIMIT&&(d.showError=!0,d.fileType=e)},showErrorMessage:function(){var e,t;d.showWarning&&(t=this.i18ns("threshold_warning","%",l.MAX_FILES_LIMIT),e=o.WARNING({msg:t})),d.showError&&(t=this.i18ns("threshold_error",l.MAX_FILES_LIMIT),e=o.ERROR({error:t})),e?this.$(".header-message").html(e):this.$(".header-message").html("")},getActionDropdownData:function(){var e=[{action:l.ACTION_RESCAN,text:this.i18n("rescan")},{action:l.ACTION_UNQUARANTINE,text:this.i18n("unquarantine")},{action:l.ACTION_DELETE,text:this.i18n("delete")}];return _.map(e,function(e){return{attributes:l.NAV_ACTION+'="'+e.action+'"',name:e.text,class:"btnIcapAction "+e.action}})},getActionDropdown:function(){var e=this.getActionDropdownData();return i.dropdown({classes:"btn-group action-dropdown -compact",text:this.i18n("actions"),options:e,rightAlign:!1})},processLocalFilter:function(){return{quarantined:!0}},handleQuarantinedActionClick:function(e){e.preventDefault();var t=$(e.currentTarget),i=this.getSelectedRowIds(),n=new s;this.options.entityType===l.ENTITY_SHARE?(n.set(n.DP.SHARE_UUID,this.options.model.get(this.options.model.DP.UUID)),n.setEntityType(l.ENTITY_SHARE)):n.set(n.DP.FS_UUID,this.options.model.get(this.options.model.DP.UUID)),n.set(n.DP.UUID,this.options.model.get(this.options.model.DP.UUID));var a=t.attr(l.NAV_ACTION),r=this.getSelectedFiles();n.set(n.DP.NAME,r),this.setModelData(n),a===l.ACTION_RESCAN||a===l.ACTION_RESET||a===l.ACTION_QUARANTINE?this.actionSelectedRows(n,i,a):this.confirmAction(n,i,a)},confirmAction:function(e,t,i){$.nutanixConfirm({msg:this.i18n("confirm."+i),yes:function(){this.actionSelectedRows(e,t,i)},yesText:this.i18n(i),noText:this.i18n("cancel"),class:"-compact -red-confirm",context:this})},setModelData:function(e){e.setEntityName(l.ENTITY_QUARANTINED_FILE),e.set(e.DP.FILE_STATE,!0)},getSelectedFiles:function(){var e=[],t=this.$(".n-checkbox");return _.each(t,function(t){if($(t).prop(l.LABEL_STATES.CHECKED)){var i=$(t).closest("tr");e.push($(i).find("td:nth-child(2)").text())}}),e},actionSelectedRows:function(e,t,i){var n=this;e.actionMode=i,e.set(e.DP.INFECTED_FILE_UUIDS,t),e.isNew(!0),e.save(null,{success:function(e,t){c.processSerializedObject(t)},error:function(e,t){var s=n.i18n("error."+i);s+=c.processAjaxError(t.responseText),a.showClientNotification(l.NOTIFY_ERROR,s)}})},setModelId:function(e){var t=this.model.models[0];t&&t.get(t.DP.UUID)!==e&&(d.showWarning=!1,d.showError=!1,d.fileType=""),this.model.setFSId(e,this.options.entityType),this.refreshData()},getSelectedRowIds:function(){if(this.selectAllRows)this.checkedDataIds=_.pluck(this.model.models,r.ID);else{var e=this.$(".n-checkbox").not(".checkboxSelectAll");this.checkedDataIds=[],_.each(e,function(e){$(e).prop(l.LABEL_STATES.CHECKED)&&this.checkedDataIds.push($(e).val())},this),this.checkedDataIds=_.uniq(this.checkedDataIds)}return this.checkedDataIds},onClickDataRow:function(e){this.updateActionView()},createDataRowCheckbox:function(e,i){return t.CHECKBOX_ROW(this.vtOptions({value:e,checked:i}))},onChangeSelectAll:function(){this.$(".checkboxSelectAll").attr(l.LABEL_STATES.CHECKED)?(this.selectAllRows=!0,this._updateSelectionCheckboxes(!0,!0)):(this.selectAllRows=!1,this._updateSelectionCheckboxes(!1,!1),this.checkedDataIds=[])},updateActionView:function(){this.selectAllRows&&this.$(".checkboxSelectAll").attr(l.LABEL_STATES.CHECKED,!0);var e=this.getSelectedRowIds();e.length>0?(this.$(".dropdown-toggle").removeClass(l.FORM_ATTR.DISABLED),this.$(".n-action").css("display","inline-block"),
this.$(".n-entity-count").html(this.i18ns("selected_files",e.length,this.totalFilteredRows))):(this.$(".dropdown-toggle").addClass(l.FORM_ATTR.DISABLED),this.$(".n-action").hide()),this.checkThresholdValue(),this.showErrorMessage()},getDefaultColumns:function(){var e=this,t=[{sTitle:"",mData:s.DP.UUID,sWidth:"10px",sClass:"center",bSortable:!1,mRender:function(t,i,n){return e.createDataRowCheckbox(t)}},{sTitle:e.i18n("file_path"),mData:s.DP.FILE_PATH,mRender:function(e,t,i){return e}},{sTitle:e.i18n("threat_desc"),mData:s.DP.THREAT_DESC,mRender:function(e,t,i){return e}},{sTitle:e.i18n("icap_server"),mData:s.DP.ICAP_SERVER,mRender:function(e,t,i){return e}},{sTitle:e.i18n("scan_time"),mData:s.DP.SCAN_TIME,sortKey:"scan_time",mRender:function(e,t,i){return"display"===t?e?u.formatDateTime(e/1e3):"":e}}];if(this.options.entityType!==l.ENTITY_SHARE){var i={sTitle:e.i18n("share_name"),mData:s.DP.SHARE_NAME,mRender:function(e,t,i){return e}};t.splice(1,0,i)}return t}},{showWarning:!1,showError:!1,fileType:""});return d}),define("views/details/tabs/FSAntiVirusUnQuarantinedFilesView",["views/details/tabs/FSAntiVirusQuarantinedFilesView","utils/AppConstants"],function(e,t){"use strict";return e.extend({getEntityTypeName:function(){return this.entityType=t.TAB_DETAILS_NAMES.UNQUARANTINED_FILE,t.TAB_DETAILS_NAMES.UNQUARANTINED_FILE},getActionDropdownData:function(){var e=[{action:t.ACTION_RESET,text:this.i18n("reset_flag")},{action:t.ACTION_QUARANTINE,text:this.i18n("quarantine")}];return _.map(e,function(e){return{attributes:t.NAV_ACTION+'="'+e.action+'"',name:e.text,class:"btnIcapAction"}})},setModelData:function(e){e.setEntityName(t.ENTITY_UNQUARANTINED_FILE),e.set(e.DP.FILE_STATE,!1)},processLocalFilter:function(){return{quarantined:!1}}})}),define("views/details/tabs/FSAntiVirusTabContentDetailsView",["views/basecomponents/details/tabs/BaseTabContentDetailsView","views/basecomponents/datatables/antivirus/FileServerAntiVirusTableView","views/details/tabs/FSAntivirusReportView","views/details/tabs/FSAntiVirusQuarantinedFilesView","views/details/tabs/FSAntiVirusUnQuarantinedFilesView","managers/ActionManager","data/DataProperties","utils/AppConstants","utils/AppUtil"],function(e,t,i,n,s,a,r,o,l){"use strict";var c=_.template('<a class="pull-right add-icap-server" action="<%= action %>" actiontarget="<%= actionTarget %>" actiontargetid="<%= actionTargetId %>"><i aria-hidden="true" data-icon="H" class="n-prepare-add-icon"></i> <%= add_icap_server %></a>');return e.extend({name:"FSAntiVirusContentDetailsView",extraClassName:"n-fileserver-anitvirus-tab-content-details",tableView:null,events:{"click    .add-icap-server":"addICAPServer"},initializeProperties:function(e){e.tabId===o.TAB_DETAILS.QUARANTINED_FILES?(this.tableView=new n({entityType:e.entityType,pageId:e.pageId,tabId:e.tabId,model:e.model}),this.$el.append(this.tableView.render().el)):e.tabId===o.TAB_DETAILS.UNQUARANTINED_FILES?(this.tableView=new s({entityType:e.entityType,pageId:e.pageId,tabId:e.tabId,model:e.model}),this.$el.append(this.tableView.render().el)):e.tabId===o.TAB_DETAILS.REPORTS?(this.tableView=new i({entityType:e.entityType,pageId:e.pageId,tabId:e.tabId,model:e.model}),this.$el.append(this.tableView.render().el)):(this.tableView=new t({entityType:this.options.entityType,pageId:this.options.pageId,tabId:this.options.tabId,actionTargetId:this.model[r.ID],actionTargetName:this.model.get(this.model.DP.NAME)}),this.$el.append(this.tableView.render().el),this.renderIcapServertab())},postSetModelId:function(t){e.prototype.postSetModelId.apply(this,arguments),this.tableView&&this.tableView.setModelId(t)},destroy:function(){l.debug("FSAntiVirusTabContentDetailsView : destroy: "," | viewid     : "+this.cid),this.tableView&&this.tableView.destroy(),e.prototype.destroy.apply(this,arguments)},setModel:function(e){this.tableView&&_.isFunction(this.tableView.setModel)&&this.tableView.setModel(e)},onStartServices:function(){this.tableView&&this.tableView.startServices(),this.delegateEvents()},onStopServices:function(){this.tableView&&this.tableView.stopServices(),this.undelegateEvents()},addICAPServer:function(e){var t=$(e.currentTarget),i={action:t.attr(o.NAV_ACTION),actionId:o.ACTION_ADD,actionTarget:t.attr(o.NAV_ACTION_TARGET),actionTargetId:this.model.get(this.model.DP.UUID),actionTargetName:this.model.get(this.model.DP.NAME),clickAction:o.ENTITY_ICAP_SERVERS};a.executeAction(i)},renderIcapServertab:function(){var e=this.i18n("icap_server_statistics"),t=this.i18ns("interval_in_min"),i=c({add_icap_server:this.i18n("add_icap_server"),action:o.ACTION_ANTIVIRUS_SETUP,actionTarget:o.ENTITY_FILE_SERVER,actionTargetId:this.model.get(this.model.DP.UUID)});this.$el.find(".n-header-left").html(e+" ("+t+")"),this.$el.find(".n-header-right").html(i)}})}),define("views/details/tabs/FSPerformanceTabContentDetailsView",["views/basecomponents/details/tabs/BaseTabContentDetailsView","views/basecomponents/datatables/DataTableTemplates","components/Components","views/basecomponents/charts/groups/FSUsageGroupChartView","data/DataProperties","managers/NavigationManager","utils/AppConstants","utils/FileServerUtil","utils/AppUtil"],function(e,t,i,n,s,a,r,o,l){"use strict";var c=[r.ENTITY_GENERAL_STATS,r.ENTITY_IO_BREAKDOWN];return e.extend({name:"FSPerformanceTabContentDetailsView",extraClassName:"graph-container-tab",graphView:null,subViewHelper:null,graphsTemplate:_.template('<div class="performance-graph-container"></div>'),events:{"click  .tableGrpHeader  .buttonTab":"onClickTab","click  .btnDropdownAction":"handleChartDropdownActionClick"},initializeProperties:function(e){this.$el.append(t.TABLE_GRP_HEADER).append(t.TABLE_GRP_BODY);var i=a.getCurrentPageRoute().options,n=l.parseQueryToObject(i);this.entityParentId=n.actionParentId,this.entityParentType=n.actionParentEntityType;for(var o=null,u=0;u<c.length;u++)o=t.ENTITY_TAB({domID:e.entityType+this.model[s.ID],entity:c[u],entityName:r.ENTITY_NAMES[c[u]]}),this.$(".tableGrpHeader").append(o);this.$(".tableGrpHeader li:first").addClass("active"),this.$(".tableGrpBody").append(t.BAR_HEADER).append(this.graphsTemplate),this.$(".n-header").prepend(t.HEADER_RIGHT)},render:function(){this.renderSubViews();var e=this.$(".tableGrpHeader li.active a").attr("actiontarget"),t=r.SAMPLING_INTERVAL_IN_LAST_24_HOUR;return this.renderGraph(e,t,""),this},setModelId:function(e){if(l.isValidId(e)&&this.currentModelId!==e){this.currentModelId=e,this.postSetModelId(e);var t=this.$(".tableGrpHeader li.active a").attr("actiontarget"),i=r.SAMPLING_INTERVAL_IN_LAST_24_HOUR;this.renderGraph(t,i,"performance"),this.$(".action-dropdown button span").html(this.i18n("dropdownOption.last_24_hours")),this.renderSubViews()}},onStartServices:function(){this.graphView&&(this.graphView.stopServices(),this.graphView.startServices())},onStopServices:function(){this.graphView&&this.graphView.stopServices()},destroy:function(){this.graphView&&this.graphView.stopServices()},renderSubViews:function(){var e=this.getActionDropdownData(),t=i.dropdown({classes:"action-dropdown",text:this.i18n("dropdownOption.last_24_hours"),options:e,rightAlign:!0});this.$(".n-header-right").addClass("pull-right").html(t)},getActionDropdownData:function(){var e=o.compareAFSversion(this.model,r.FILE_SERVER_VERSIONS.THREE_DOT_FIVE)>=0,t=[{action:r.FS_STATS_LAST_HOURS,text:this.i18n("dropdownOption.last_24_hours")},{action:r.SAMPLING_INTERVAL_IN_LAST_6_HOURS,text:this.i18n("dropdownOption.last_6_hours")},{action:r.SAMPLING_INTERVAL_IN_LAST_3_HOURS,text:this.i18n("dropdownOption.last_3_hours")}];return e&&t.unshift({action:r.SAMPLING_INTERVAL_IN_LAST_7_DAYS,text:this.i18n("dropdownOption.last_7_days")}),_.map(t,function(e){return{attributes:r.NAV_ACTION+'="'+e.action+'"',name:e.text,class:"btnDropdownAction last_"+e.action}})},onClickTab:function(e){var t=$(e.currentTarget),i=t.attr("actiontarget"),n=r.SAMPLING_INTERVAL_IN_LAST_24_HOUR;this.$(".tableGrpHeader li").removeClass("active"),t.closest("li").addClass("active"),this.renderGraph(i,n,"tab")},renderGraph:function(e,t,i){this.graphView&&this.graphView.stopServices(),this.entityType===r.ENTITY_SHARE?this.graphView=new n({entityType:this.options.entityType,entityId:this.model[s.ID],entityParentType:this.entityParentType,entityParentId:this.entityParentId,tab:r.TAB_DETAILS.FS_PERFORMANCE,subEntityType:e,statsFor:t}):this.graphView=new n({entityType:this.options.entityType,entityId:this.model[s.ID],tab:r.TAB_DETAILS.FS_PERFORMANCE,subEntityType:e,statsFor:t}),this.$(".performance-graph-container").html(this.graphView.render().el),i&&this.graphView.startServices()},handleChartDropdownActionClick:function(e){var t=$(e.currentTarget),i=t.attr(r.NAV_ACTION),n=this.$(".tableGrpHeader li.active a").attr("actiontarget");this.renderGraph(n,i,"dropdown")}})}),define("views/details/tabs/ReportTabContentDetailsView",["views/details/tabs/TableTabContentDetailsView","utils/AppConstants","utils/FilterUtil"],function(e,t,i){"use strict";return e.extend({extraClassName:"report-tab-content-details",tableEntityType:t.ENTITY_REPORT_INSTANCE,getTableOptions:function(i){var n=e.prototype.getTableOptions.apply(this,arguments);return _.extend(n,{entityType:t.ENTITY_REPORT_INSTANCE,disableSearchHeader:!0,disableCheckBox:!0,enableDefaultTableFilter:!1,enableEntityDetails:!1,showExport:!1,ebTableStyle:!0,defaultPageSize:20,defaultMinRows:20})},setEntityIdFilter:function(e){var n=this.model.get("report_config"),s=i.addFilterCondition({},"report_config_uuid",i.createFilterCondition(t.ENTITY_REPORT_INSTANCE,"report_config_uuid",t.FILTER_OPERATORS.EQUALS,n));this.tableView.appendFilterCriteria(s)}})}),define("views/basecomponents/pages/fulldetails/FullDetailsClusterSummaryView",["views/basecomponents/pages/fulldetails/FullDetailsEntitySummaryView","utils/AppConstants","data/DataProperties"],function(e,t,i){"use strict";return e.extend({name:"FullDetailsClusterSummaryView",model:null,clusterUuid:null,events:{"click    a.ebLink":"onEBLinkClick"},initialize:function(t){this.model=t.model,this.clusterUuid=null,e.prototype.initialize.apply(this,arguments)},onDataChange:function(e){var n=e.get(i.VM_EFFICIENCY.OVERPROVISIONED_VM);this.clearDisplayItem(),this.clusterUuid=this.model.getClusterUuid(),this.setHeaderItem(this.i18n("clusterName"),e.get(i.NAME),null,{title:e.get(i.NAME)}),this.addDisplayItem(this.i18n("version"),e.get(i.CLUSTER_NOS_VERSION),null,{title:e.get(i.CLUSTER_NOS_FULL_VERSION)}),this.addDisplayItem(this.i18n("hypType"),e.getHypervisorLabel()),this.addDisplayItem(this.i18n("health"),e.getClusterHealthStatus(),"healthStatus"),_.isUndefined(n)||_.isNull(n)?this.addDisplayItem(this.i18n("overprovisioned_vm"),t.DATA_NOT_AVAILABLE):this.addDisplayItem(this.i18n("overprovisioned_vm"),this.ebLinkTemplate({entityType:t.ENTITY_VM,perspective:"Efficiency",filterName:"capacity.vm_efficiency_list",filterValue:"overprovisioned",value:e.get(i.VM_EFFICIENCY.OVERPROVISIONED_VM)})),this.addDisplayItem(this.i18n("numOfHosts"),e.get(i.CLUSTER_HOSTS)),this.addDisplayItem(this.i18n("extSubnet"),e.get(i.CLUSTER_EXTERNAL_SUBNET)),this.addDisplayItem(this.i18n("intSubnet"),e.get(i.CLUSTER_INTERNAL_SUBNET)),e.get(i.CLUSTER_GRID_DRIVER_VERSION)&&this.addDisplayItem(this.i18n("gridDriverVersion"),e.get(i.CLUSTER_GRID_DRIVER_VERSION)),this.refreshView()}})}),define("models/gpu/GpuCollection",["models/BaseCollection","models/gpu/GpuModel","utils/GpuUtil","data/DataURLConstants","data/DataManager"],function(e,t,i,n,s){"use strict";return e.extend({model:t,url:n.CLUSTER_GPU,name:"GpuCollection",getDataSourceURL:function(){return s.getV2DataSourceURL()},parse:function(t,i){var n=e.prototype.parse.apply(this,arguments);return this.parseAndDedup(n)},setSingleHostUrl:function(e){var t=_.template(n.HOST_GPU)({hostUuid:e});this.setURL(t)},setvGpuProfileUrl:function(){this.setURL(n.CLUSTER_GPU_PROFILE)},parseAndDedup:function(e){var n=_.groupBy(e,function(e){return i.getGpuIdentifier(e[t.DP.GPU_CONFIG],t.DP)},this),s=[];return _.each(n,function(e){var i=e[0];i[t.DP.DEVICE_COUNT]=e.length,i[t.DP.IN_USE_COUNT]=_.reduce(e,function(e,i){return e+(i[t.DP.GPU_CONFIG][t.DP.IN_USE]?1:0)},0,this),i[t.DP.VMS_ALLOCATED_PER_PROFILE]=this._getVmsAllocatedPerProfile(e),s.push(i)},this),s},findModelByDeviceId:function(e){var i="string"==typeof e?parseInt(e,10):e;return this.find(function(e){var n=e.get(t.DP.GPU_CONFIG);return i===n[t.DP.DEVICE_ID]},this)},findModelByIdentifier:function(e){return this.find(function(n){var s=n.get(t.DP.GPU_CONFIG);return e===i.getGpuIdentifier(s,t.DP)},this)},getGPUSummary:function(){return _.map(this.models,function(e){return e.getGpuSummaryStr()})},hasVgpu:function(){return!!_.find(this.models,function(e){return e.getGpuType()===t.GPU_TYPE.VIRTUAL})},hasPgpu:function(){return!!_.find(this.models,function(e){return e.getGpuType()!==t.GPU_TYPE.VIRTUAL})},hasAssignable:function(){return _.find(this.models,function(e){return e.isAssignable()})},_getVmsAllocatedPerProfile:function(e){return _.reduce(e,function(e,i){var n=i[t.DP.GPU_CONFIG];if(n){var s=null;switch(n[t.DP.GPU_TYPE]){case t.GPU_TYPE.VIRTUAL:s=n[t.DP.DEVICE_NAME];break;case t.GPU_TYPE.COMPUTE:case t.GPU_TYPE.PASSTHROUGH:s=n[t.DP.GPU_PROFILE]}s&&n[t.DP.VM_UUID]&&n[t.DP.VM_UUID].length&&(e=_.extend(e,_defineProperty({},s,_.union(e[s]||[],n[t.DP.VM_UUID]))))}return e},{},this)},populateVmsAllocated:function(e){var t=this;!this.url!==n.CLUSTER_GPU_PROFILE&&_.each(this.models,function(i){i.has(i.DP.VMS_ALLOCATED)||i.set(i.DP.VMS_ALLOCATED,_.reduce(e.models,function(e,t){var n=t.get(t.DP.VMS_ALLOCATED_PER_PROFILE),s=i.get(i.DP.GPU_CONFIG);return _.union(e,n&&s&&n[s[i.DP.DEVICE_NAME]]||[])},[],t))})}})}),define("views/basecomponents/pages/fulldetails/FullDetailsVMSummaryView",["views/basecomponents/pages/fulldetails/FullDetailsEntitySummaryView","data/DataProperties","models/hardware/HostModel","models/storage/ContainerModel","models/vm/AcropolisVMModel","models/gpu/GpuCollection","models/gpu/GpuModel","utils/AppUtil","utils/StatsUtil","utils/VMUtil","utils/GpuUtil","utils/AppConstants","utils/SVG","utils/CommonTemplates","utils/FilterUtil","managers/ClusterManager","managers/TaskManager","managers/NavigationManager"],function(e,t,i,n,s,a,r,o,l,c,u,d,h,p,T,E,S,g){"use strict";var A=_.template('Task(s) are in progress.  <span><a class="taskPageLink"><%= details %></a></span>');return e.extend({name:"FullDetailsVMSummaryView",model:null,hostModel:null,acropolisVmModel:null,gpuCollection:null,clusterUuid:null,events:{"click    a.pageLink":"onPageLinkClick","click    a.taskPageLink":"onTaskPageLinkClick"},initialize:function(t){this.model=t.model,this.hostModel=null,this.acropolisVmModel=null,this.gpuCollection=null,_.bindAll(this,"onTasksChange"),this.taskInProgress=this.hasRunningTasks(),e.prototype.initialize.apply(this,arguments)},getViewFeatures:function(){return{hasGuestOS:!!this.model.get(t.VM_GUEST_OS),hypervisor:this.model.get(t.HYPERVISOR_TYPE),acropolisVm:this.model.get(t.VM_ACROPOLIS_VM),isCVM:this.model.get(t.VM_CONTROLLER_VM)||!1,powerState:this.model.get(t.VM_POWER_STATE)}},onDataChange:function(e){this.clearDisplayItem(),this.clusterUuid=e.getClusterUuid(),this.setHeaderItem("VM Name",e.escape(t.VM_NAME),"vmName",{title:e.escape(t.VM_NAME)}),this.addDisplayItem("Power Status",c.getPowerState(e.get(t.VM_POWER_STATE)),"vmPowerStatus"),this.addClusterLinkItem(this.clusterUuid);var i,n=this.model.get(t.UUID);if(e.get(t.VM_EFFICIENCY.OVERPROVISIONED_VM)){i=o.createFullPageDetailsLink(e.get(t.VM_EFFICIENCY.OVERPROVISIONED_VM),d.ENTITY_VM,n,d.TAB_DETAILS.PERFORMANCE,d.METRICS.CPU_USAGE)[0].outerHTML}if(this.addDisplayItem("Constrained",i),this.addDisplayItem("VM ID",n,"vmId"),this.addDisplayItem("Host",e.get(t.VM_HOST_NAME),"vmHost",{title:e.get(t.VM_HOST_NAME)}),this.addDisplayItem("Host IP","","vmHostIpAddress"),this.addDisplayItem("Host Hypervisor","","vmHostHypervisor"),this.addDisplayItem("Guest OS",e.get(t.VM_GUEST_OS)||"","vmGuestOS"),this.addDisplayItem("Memory",l.storageFormat(e.getMemoryCapacity())),this.addDisplayItem("Reserved Memory",e.getReservedMemory(),"vmReservedMemory"),this.addDisplayItem("Assigned Memory",e.getAssignedMemory(),"vmAssignedMemory"),this.addDisplayItem("vCPUs",e.getNumVCpus()),this.addDisplayItem("Reserved CPU",e.getReservedCPU(),"vmReservedCPU"),this.addDisplayItem("Disk Capacity",l.storageFormat(e.get(t.VM_DISK_CAPACITY)),"vmDiskCapacity"),this.addDisplayItem("Network Adapters",e.get(t.VM_NETWORK_ADTRS)||0),this.addDisplayItem("IP Addresses",e.get(t.VM_IP_ADDRESSES).join("<br />"),"vmIpAddresses"),e.get(t.VM_CONTROLLER_VM)||this.addDisplayItem("Storage Container","","vmContainer"),this.addDisplayItem("Virtual Disks",e.get(t.VM_NTNX_VDISKS)?e.get(t.VM_NTNX_VDISKS).length:0,"vmVirtualDisk"),this.model.get(t.VM_PD_NAME)){if(E.isMulticlusterNavMode())this.addDisplayItem("Protection Domain",this.model.get(t.VM_PD_NAME),"vmProtectionDomain",{title:e.get(t.VM_PD_NAME)});else{var s=o.createPageLink(this.model.get(t.VM_PD_NAME),d.ENTITY_PROTECTION_DOMAIN,this.model.get(t.VM_PD_NAME));this.addDisplayItem("Protection Domain",s[0].outerHTML,"vmProtectionDomain",{title:e.get(t.VM_PD_NAME)})}this.addDisplayItem("Consistency Group",e.get(t.VM_CONSISTENCY_GROUP_NAME),null,{title:e.get(t.VM_CONSISTENCY_GROUP_NAME)})}this.addDisplayItem("GPU Configuration","","vmGpuConfig"),this.addDisplayItem("Virtual Slice","","vmGpuFraction"),this.addDisplayItem("Framebuffer","","vmGpuFramebuffer"),this.addDisplayItem("GPU Type","","vmGpuType"),this.addDisplayItem("vGPU Guest Driver Version","","vmGpuGuestDriverVersion"),this.refreshView(),this.taskInProgress?(this.$(".task-progress").addClass("-show"),this.$(".task-progress > .description").html(A({details:"Click here for details."}))):this.$(".task-progress").removeClass("-show"),e.get(t.HOST_ID)&&this.renderHost(),!e.isCVM()&&this.model.get(t.VM_CONTAINER_IDS)&&this.renderCtr(),this.renderGpu(),this.renderViewFilter()},renderCtr:function(){var e=this.$(".vmContainer > .value"),i=[];_.each(this.model.get(t.VM_CONTAINER_IDS),function(e){var t=new n({id:e});t.setProjection([d.PROJECTION.BASIC_INFO]),i.push(t.fetch())}),$.when.apply(null,i).done(function(){var n=[];if(i.length>1)_.each(arguments,function(e){var i=e[0]||{},s=o.createPageLink(i[t.NAME],d.ENTITY_CONTAINER,i[t.ID]);n.push(s[0].outerHTML)});else{var s=arguments[0]||{},a=o.createPageLink(s[t.NAME],d.ENTITY_CONTAINER,s[t.ID]);n.push(a[0].outerHTML)}e.html(n.join(", "))}).fail(function(){e.empty()})},renderHost:function(){var e=this.$(".vmHostIpAddress > .value"),n=(this.$(".vmHostHypervisor > .value"),this);this.hostModel?this._renderHostLink(this.hostModel):(this.hostModel=new i,this.hostModel.setId(this.model.get(t.HOST_ID)),this.hostModel.setProjection([d.PROJECTION.BASIC_INFO]),o.addInLineDonutLoader(e),this.hostModel.fetch({success:function(e){n._renderHostLink(e)},error:function(t,i){var n=p.ERROR_DETAILS_INLINE({ntnxTooltip:o.processThrownError(i),svgIcon:h.SVGIcon("Exclamation_Mark")});e.tooltip("destroy"),e.html(n),e.tooltip({title:o.processThrownError(i),placement:"top",trigger:"hover",html:!0,container:$("body")})}}))},renderGpu:function(){this.$(".vmGpuConfig").hide(),this.$(".vmGpuFraction").hide(),this.$(".vmGpuFramebuffer").hide(),this.$(".vmGpuType").hide(),this.$(".vmGpuGuestDriverVersion").hide(),this.model.get(t.VM_ACROPOLIS_VM)&&(this.acropolisVmModel=new s,this.acropolisVmModel.set(this.acropolisVmModel.idAttribute,this.model.get(t.UUID),{silent:!0}),this.acropolisVmModel.setProxyClusterUuid(this.clusterUuid),this.acropolisVmModel.fetch({success:_.bind(this._renderGpuInfo,this)}))},_renderGpuInfo:function(){if(this.assignedVmGpus=this.acropolisVmModel.getAssignedGpus(),this.assignedVmGpus){this.acropolisVmModel.getGpuMode()===r.GPU_MODE.VIRTUAL?this._renderVGpuInfo():this._renderPGpuInfo()}},_renderVGpuInfo:function(){this.gpuCollection?this._renderVGpuConfigInfo():(this.gpuCollection=new a,this.gpuCollection.setProxyClusterUuid(this.clusterUuid),this.gpuCollection.setvGpuProfileUrl(),this.gpuCollection.fetch({success:_.bind(this._renderVGpuConfigInfo,this)}))},_renderPGpuInfo:function(){if(this.gpuCollection)this._renderPGpuConfigInfo();else{this.gpuCollection=new a,this.gpuCollection.setProxyClusterUuid(this.clusterUuid);var e=T.filterConditionToFIQL(r.DP.GPU_TYPE,{op:d.FILTER_OPERATORS.NOT_EQUALS,value1:r.GPU_TYPE_KSTRING.VIRTUAL});this.gpuCollection.setFilterCriteria(e),this.gpuCollection.fetch({success:_.bind(this._renderPGpuConfigInfo,this)})}},_renderVGpuConfigInfo:function(){var e=u.getGpuIdentifier(this.assignedVmGpus[0],r.DP),i=this.gpuCollection.findModelByIdentifier(e),n=i.get(r.DP.GPU_CONFIG),s=n[r.DP.FRACTION],a=l.statsFormat(t.STATS_GPU_FRAMEBUFFER_BYTES,n[r.DP.FRAMEBUFFER],!0),o=this.acropolisVmModel.getGuestDriverVersion();this.$(".vmGpuConfig > .value").html(n[r.DP.DEVICE_NAME]||d.DATA_NOT_AVAILABLE),this.$(".vmGpuFraction > .value").html(u.getFractionDisplayStr(s)||d.DATA_NOT_AVAILABLE),this.$(".vmGpuFramebuffer > .value").html(a||d.DATA_NOT_AVAILABLE),this.$(".vmGpuType > .value").html(this.i18nStatic("VMTabDetailsEntityView",this.acropolisVmModel.getGpuMode().toLowerCase())||d.DATA_NOT_AVAILABLE),this.$(".vmGpuGuestDriverVersion > .value").html(o||d.DATA_NOT_AVAILABLE),this.$(".vmGpuConfig").show(),this.$(".vmGpuFraction").show(),this.$(".vmGpuFramebuffer").show(),this.$(".vmGpuType").show(),this.$(".vmGpuGuestDriverVersion").show(),this.$(".vmGpuFraction").tooltip({title:this.i18nStatic("VMTabDetailsEntityView","fractionTooltip"),placement:"top",html:!0,trigger:"hover",container:"body"})},_renderPGpuConfigInfo:function(){var e=[],t=this.i18nStatic("VMTabDetailsEntityView",this.acropolisVmModel.getGpuMode().toLowerCase());_.each(this.assignedVmGpus,function(t){var i=u.getGpuIdentifier(t,r.DP),n=this.gpuCollection.findModelByIdentifier(i),s=n.getGpuName();e.push(s)},this),e=u.groupGpuList(e),this.$(".vmGpuConfig > .value").html(e.join("<br>")||d.DATA_NOT_AVAILABLE).attr("title",e.join(", ")),this.$(".vmGpuType > .value").html(t),this.$(".vmGpuConfig").show(),this.$(".vmGpuType").show()},_renderHostLink:function(e){var i=this.$(".vmHostIpAddress > .value"),n=this.$(".vmHostHypervisor > .value"),s=this.createPageLink(e.get(t.HYPERVISOR_IP),d.ENTITY_HOST,e.getId());i.html(s),n.html(e.getHypervisorLabel())},onStartServices:function(){e.prototype.onStartServices.apply(this,arguments),S.registerHandlerForChangedTasks(this.onTasksChange)},onStopServices:function(){this.$(".error-icon").tooltip("destroy"),e.prototype.onStopServices.apply(this,arguments),S.unregisterHandlerForChangedTasks(this.onTasksChange)},hasRunningTasks:function(){var e=S.getRunningTaskByEntityId([this.model.get(t.UUID)||this.model.getId()]);return!_.isEmpty(e)},onTasksChange:function(e){this.taskInProgress=this.hasRunningTasks(),this.model.fetch({alwaysTriggerChange:!0})},onTaskPageLinkClick:function(e){g.navigateToPage(d.PAGE_TASKS)},viewFilters:[{targets:{style:d.VIEW_FILTER.STYLE_CLASS.HIDE,selectors:[".vmGuestOS",".vmReservedCPU",".vmReservedMemory",".vmVirtualDisk"]},conditions:{groups:[{type:"isCVM",operator:d.FILTER_OPERATORS.EQUALS,reason:"This information is not available on Acropolis controller VMs",data:[!0]}]}},{targets:{style:d.VIEW_FILTER.STYLE_CLASS.HIDE,selectors:[".vmGuestOS"]},conditions:{groups:[{type:"hypervisor",operator:d.FILTER_OPERATORS.NOT_EQUALS,reason:"Guest OS information is only available on VMs hosted on ESXi.",data:[d.HYPERVISOR_TYPE.ESXI]}]}},{targets:{style:d.VIEW_FILTER.STYLE_CLASS.HIDE,selectors:[".vmAssignedMemory"]},conditions:{groups:[{type:"hypervisor",data:[d.HYPERVISOR_TYPE.HYPERV],operator:d.FILTER_OPERATORS.NOT_EQUALS,reason:"Assigned memory is only available on Hyper-V."}]}},{targets:{style:d.VIEW_FILTER.STYLE_CLASS.HIDE,selectors:[".vmReservedCPU"]},conditions:{groups:[{type:"acropolisVm",data:[!0],operator:d.FILTER_OPERATORS.EQUALS,reason:"This information is not available for VMs hosted on AHV"}]}},{targets:{selectors:[".vmReservedCPU",".vmDiskCapacity"]},conditions:{groups:[{type:"hypervisor",data:[d.HYPERVISOR_TYPE.HYPERV],operator:d.FILTER_OPERATORS.EQUALS,reason:"This information is not available for VMs hosted on Hyper-V."}]}},{targets:{style:d.VIEW_FILTER.STYLE_CLASS.HIDE,selectors:[".vmReservedMemory"]},conditions:{groups:[{type:"acropolisVm",data:[!0],operator:d.FILTER_OPERATORS.EQUALS}]}},{targets:{style:d.VIEW_FILTER.STYLE_CLASS.HIDE,selectors:[".vmId"]},conditions:{groups:[{type:"acropolisVm",data:[!1],operator:d.FILTER_OPERATORS.EQUALS}]}},{targets:{selectors:[".vmHost",".vmHostIpAddress",".vmHostHypervisor",".vmIpAddresses"]},conditions:{groups:[{type:"powerState",data:[d.VM_POWER_STATE.OFF],operator:d.FILTER_OPERATORS.EQUALS,reason:"Information may not be available when VM is powered off"}]}}]})}),define("views/basecomponents/pages/fulldetails/FullDetailsContainerSummaryView",["views/basecomponents/pages/fulldetails/FullDetailsEntitySummaryView","data/DataProperties","models/storage/VStoreCollection","models/storage/DatastoreCollection","utils/AppUtil","utils/StatsUtil","utils/HypervisorUtil","utils/TooltipContent","managers/ClusterManager"],function(e,t,i,n,s,a,r,o,l){"use strict";return e.extend({name:"FullDetailsContainerSummaryView",model:null,vstoreCollection:null,datastoreCollection:null,storagePoolModel:null,clusterUuid:null,initialize:function(t){this.model=t.model,this.vstoreCollection=null,this.datastoreCollection=null,this.storagePoolModel=null,this.addExtraEvents({"mouseover .nx-tooltip > .value":"onStorageStatsMouseOver","mouseout  .nx-tooltip > .value":"onStorageStatsMouseOut"}),e.prototype.initialize.apply(this,arguments)},onDataChange:function(e){this.clearDisplayItem(),this.currentSection=this.addSection(),this.clusterUuid=this.model.getClusterUuid(),this.setHeaderItem(this.i18n("storageContainerName"),e.get(t.NAME),null,{title:e.get(t.NAME)}),this.addClusterLinkItem(this.clusterUuid),r.hasESX(this.clusterUuid)&&!l.isMulticlusterNavMode()&&this.addDisplayItem(this.i18n("protectionDomain"),null,"container-protection-domain"),r.hasESX(this.clusterUuid)&&(this.addDisplayItem(this.i18n("datastore"),"","container-datastore"),this.addDisplayItem(this.i18n("vms"),"","container-vm-count")),this.addDisplayItem(this.i18n("replicationFactor"),this.model.get(t.RF)),this.currentSection=this.addSection(),this.addDisplayItem(this.i18n("freeSpaceLogical"),a.storageFormat(this.model.getTotalAvailableLogical()),"container-free-logical nx-tooltip",{ntnxTooltip:o.STORAGE_STATS.CONTAINER_FREE.ID}),this.addDisplayItem(this.i18n("used"),a.storageFormat(this.model.getUsageByThisContainerOnly()),"nx-tooltip",{ntnxTooltip:o.STORAGE_STATS.CONTAINER_USED.ID}),this.addDisplayItem(this.i18n("maxCapacity"),a.storageFormat(this.model.getMaxCapacityLogical()),"nx-tooltip",{ntnxTooltip:o.STORAGE_STATS.CONTAINER_MAX.ID}),this.addDisplayItem(this.i18n("reserved"),a.storageFormat(this.model.getExcplicitReservedCapacity())),this.addDisplayItem(this.i18n("thickProvisioned"),a.storageFormat(this.model.getImplicitReservationCapacity())),this.currentSection=this.addSection(),this.addDisplayItem(this.i18n("dataReductionRatio"),this.model.getDataReductionRatio(),"nx-tooltip",{ntnxTooltip:o.STORAGE_STATS.DATAREDUCTION_RATIO.ID}),this.addDisplayItem(this.i18n("dataReductionSavings"),a.storageFormat(this.model.getDataReductionSaving())),this.addDisplayItem(this.i18n("effectiveFree"),a.storageFormat(this.model.getEffectiveFree())),this.addDisplayItem(this.i18n("overallEfficiency"),this.model.getOverallEfficiencyRatio(),"nx-tooltip",{ntnxTooltip:o.STORAGE_STATS.OVERALL_EFFICIENCY.ID}),this.currentSection=this.addSection(),this.addDisplayItem(this.i18n("compression"),this.model.get(t.COMPRESSION_ENABLED)?this.i18n("on"):this.i18n("off")),this.model.get(t.COMPRESSION_ENABLED)&&(this.addDisplayItem(this.i18n("compressionDelay"),this.i18ns("compressionDelayMinutes",this.model.get(t.COMPRESSION_DELAY_SECS)/60)),this.addDisplayItem(this.i18n("compressionSpaceSaved"),this.model.getActualSpaceSavedCompressionLabel()),this.addDisplayItem(this.i18n("compressionRatio"),this.model.getEffectiveCompressionRatio())),"off"!==this.model.getPerfDedupLabel()&&this.addDisplayItem(this.i18n("capacityDeduplication"),this.model.getOnDiskDedupLabel()),this.addDisplayItem(this.i18n("cacheDeduplication"),this.model.getPerfDedupLabel()),"off"!==this.model.getOnDiskDedupLabel()&&(this.addDisplayItem(this.i18n("capacityDedupSpaceSaved"),this.model.getActualSpaceSavedOnDiskDedupLabel()),this.addDisplayItem(this.i18n("capacityDedupRatio"),this.model.getEffectiveOnDiskDedupRatio())),this.addDisplayItem(this.i18n("erasureCoding"),this.model.getErasureCodeLabel()),"off"!==this.model.getErasureCodeLabel()&&(this.addDisplayItem(this.i18n("erasureCodingDelay"),this.model.getErasureCodeDelayDisplayValue()),this.addDisplayItem(this.i18n("erasureCodingSpaceSaved"),this.model.getErasureCodeSpaceSaved()),this.addDisplayItem(this.i18n("erasureCodingRatio"),this.model.getErasureCodeRatio())),this.refreshView(),r.hasESX(this.clusterUuid)&&!l.isMulticlusterNavMode()&&this.renderPD(),r.hasESX(this.clusterUuid)&&this.renderDatastore()},renderPD:function(){var e=this,t=this.$(".container-protection-domain > .value");r.hasESX(this.clusterUuid)&&!l.isMulticlusterNavMode()&&(this.vstoreCollection?t.html(this.vstoreCollection.getProtectionDomainForContainer(this.model.getId())):(this.vstoreCollection=new i,s.addInlineSpinner(t),this.vstoreCollection.fetch({success:function(i){t.html(e.vstoreCollection.getProtectionDomainForContainer(e.model.getId()))},error:function(){t.empty()}})))},renderDatastore:function(){var e=this,i=this.$(".container-datastore > .value"),a=this.$(".container-vm-count > .value");s.addInlineSpinner(i),s.addInlineSpinner(a),r.hasESX(this.clusterUuid)&&(this.datastoreCollection?this._renderDS():(this.datastoreCollection=new n,this.clusterManager.isMulticlusterNavMode()&&(this.datastoreCollection[t.CLUSTER_UUID]=e.model.getClusterUuid()),this.datastoreCollection.fetch({success:function(t){e._renderDS()},error:function(){i.empty(),a.empty(),e.datastoreCollection=null}})))},_renderDS:function(){var e=this.$(".container-datastore > .value"),t=this.$(".container-vm-count > .value"),i=this.datastoreCollection.getDatastoreNameByContainer(this.model.getId()),n=this.datastoreCollection.getVMsByContainer(this.model.getId()).length;e.html(i).attr("title",i),t.html(n)},onStorageStatsMouseOver:function(e){var t=$(e.currentTarget),i=t.attr("ntnxTooltip"),n=o.getStorageStatsBreakdown(i,this.model);t.tooltip({title:n,placement:"right",trigger:"manual",html:!0,container:$("body")}),t.tooltip("show")},onStorageStatsMouseOut:function(e){$(e.currentTarget).tooltip("destroy")}})}),define("views/basecomponents/pages/fulldetails/FullDetailsDiskSummaryView",["views/basecomponents/pages/fulldetails/FullDetailsEntitySummaryView","data/DataProperties","models/hardware/HostModel","utils/AppUtil","utils/StatsUtil","utils/AppConstants"],function(e,t,i,n,s,a){"use strict";return e.extend({model:null,clusterUuid:null,storagePoolModel:null,hostModel:null,initialize:function(t){this.model=t.model,this.clusterUuid=null,this.storagePoolModel=null,e.prototype.initialize.apply(this,arguments)},onDataChange:function(e){this.clearDisplayItem(),this.clusterUuid=this.model.getClusterUuid(),this.setHeaderItem("Disk ID",this.model.getDisplayableId(),null,{title:this.model.getId()}),this.addClusterLinkItem(this.clusterUuid),this.addDisplayItem("Serial Number",this.model.nameParserFunc());var i=null;this.model.get(t.DISK_HW_CONFIG)&&(i=this.model.get(t.DISK_HW_CONFIG)[t.DISK_HW_CONFIGS_DISK_MODEL],this.addDisplayItem("Model",i)),this.addDisplayItem("Storage Tier",this.model.get(t.TIER_NAME)),this.addDisplayItem("Used (Physical)",s.storageFormat(this.model.getUsedPhysical())),this.addDisplayItem("Capacity (Physical)",s.storageFormat(this.model.getTotalCapacity())),this.addDisplayItem("Host",null,"diskHost"),this.addDisplayItem("Status",n.toUpperCaseFirstChar(this.model.get(t.DISK_STATUS))),
this.addDisplayItem("Mode",this.model.get(t.ONLINE)?"Online":"Offline"),this.model.get(t.SED)?(this.addDisplayItem("Self Encryption Drive","Present"),this.addDisplayItem("Password Protection Mode",this.model.get(t.PASSWORD_PROTECTION)?"Protected":"Not Protected")):this.addDisplayItem("Self Encryption Drive","Not Present"),this.refreshView(),this.renderHost()},renderHost:function(){var e=this.$(".diskHost > .value"),n=this;this.hostModel?this._renderHostEl():(this.hostModel=new i,this.hostModel.setId(this.model.get(t.SERVICE_VM_ID)),this.hostModel.setProjection([a.PROJECTION.BASIC_INFO]),this.hostModel.fetch({success:function(e){n._renderHostEl()},error:function(t,i){n.hostModel=null,e.empty()}}))},_renderHostEl:function(){var e=this.$(".diskHost > .value"),i=this.createPageLink(this.hostModel.get(t.HYPERVISOR_IP),a.ENTITY_HOST,this.hostModel.getId());e.html(i)}})}),define("views/basecomponents/pages/fulldetails/FullDetailsHostSummaryView",["views/basecomponents/pages/fulldetails/FullDetailsEntitySummaryView","data/DataProperties","models/hardware/DiskCollection","models/gpu/GpuCollection","models/storage/DatastoreCollection","models/gpu/GpuModel","utils/AppUtil","utils/StatsUtil","utils/AlertUtil","utils/FilterUtil","utils/AppConstants","utils/CommonTemplates"],function(e,t,i,n,s,a,r,o,l,c,u,d){"use strict";var h=_.template('<a href="http://<%= ipmiIP %>" target="_blank"><%= ipmiIP %></a>');return e.extend({model:null,name:"FullDetailsHostSummaryView",clusterUuid:null,diskCollection:null,pGpuCollection:null,dsCollection:null,initialize:function(t){this.model=t.model,this.clusterUuid=null,e.prototype.initialize.apply(this,arguments)},onDataChange:function(e){var i=e.isComputeOnly();if(this.clearDisplayItem(),this.clusterUuid=this.model.getClusterUuid(),this.setHeaderItem(this.i18n("host_name"),e.get(t.NAME),null,{title:e.get(t.NAME)}),l.isHostMetadataDetached(this.model.toJSON())&&this.addDisplayItem("critical_alert",d.IMPORTANT_CRITICAL_ALERT+" "+this.model.get(t.METADATA_STORE_STATUS_MSG)),this.addClusterLinkItem(this.clusterUuid),this.addDisplayItem(this.i18n("host_type"),e.getDisplayableHostType()),this.addDisplayItem(this.i18n("hypervisor_ip"),e.get(t.HYPERVISOR_IP)),i||this.addDisplayItem(this.i18n("cvm_ip"),e.get(t.SERVICE_VM_IP)),e.get(t.IPMI_IP)){var n=h({ipmiIP:e.get(t.IPMI_IP)});this.addDisplayItem(this.i18n("ipmi_ip"),n)}this.addDisplayItem(this.i18n("node_serial"),e.get(t.SERIAL)),this._renderHypervRelatedDetails(e),this.addDisplayItem(this.i18n("block_serial"),e.get(t.BLOCK_SERIAL)),this.addDisplayItem(this.i18n("block_model"),e.get(t.BLOCK_MODEL_NAME)||e.get(t.BLOCK_MODEL)),i||this.addDisplayItem(this.i18n("storage_capacity"),o.storageFormat(e.getStorageCapacity())),i||this.addDisplayItem(this.i18n("disks"),"","host-disks"),this.addDisplayItem(this.i18n("gpus"),"","host-gpus"),this.addDisplayItem(this.i18n("memory"),o.storageFormat(e.getValue(t.MEM_CAPACITY))),this.addDisplayItem(this.i18n("cpu_capacity"),o.cpuHertzFormat(e.getValue(t.CPU_CAPACITY))),this.addDisplayItem(this.i18n("num_vms"),e.get(t.NUM_VMS)||u.DATA_NOT_AVAILABLE),i||(this.addDisplayItem(this.i18n("oplog_disk_pct"),e.getValue(t.OPLOG_PERCENT)),this.addDisplayItem(this.i18n("oplog_disk_size"),o.storageFormat(e.get(t.OPLOG_SIZE)))),this.addDisplayItem(this.i18n("monitor_enabled"),e.get(t.MONITORED)?this.i18n("yes"):this.i18n("no")),this.addDisplayItem(this.i18n("hypervisor"),e.escape(t.HYPERVISOR_NAME)),e.isESX()&&this.addDisplayItem(this.i18n("datastores"),"","host-datastores"),this.refreshView(),this.renderDisks(),this.renderGpus(),e.isESX()&&this.renderDS()},renderDisks:function(){var e=this,t=this.$(".host-disks > .value");this.diskCollection?this._renderDiskEl(this.diskCollection):(r.addInlineSpinner(t),this.diskCollection=new i,this.diskCollection.clusterUuid=this.model.getClusterUuid(),this.diskCollection.fetch({success:function(t){e._renderDiskEl(t)},error:function(){t.empty()}}))},renderGpus:function(){var e=this;if(this.pGpuCollection)this._renderGpuEl(this.pGpuCollection);else{this.$(".host-gpus").hide();var i=new n,s=c.filterConditionToFIQL(a.DP.GPU_TYPE,{op:u.FILTER_OPERATORS.NOT_EQUALS,value1:a.GPU_TYPE_KSTRING.VIRTUAL});i.setFilterCriteria(s),i.setSingleHostUrl(this.model.get(t.UUID)),i.setProxyClusterUuid(this.model.getClusterUuid()),i.fetch({success:function(t){e.pGpuCollection=t,e._renderGpuEl(t)}})}},_renderHypervRelatedDetails:function(e){if(e.isHyperv()){var i,n,s,a=e.get(t.DEFAULT_VM_LOCATION),r=e.get(t.DEFAULT_VHD_LOCATION),o=e.get(t.FAILOVER_CLUSTER_FQDN);o&&(s={title:o},o=o.split(".")[0]),a&&(i={title:a}),r&&(n={title:r}),this.addDisplayItem(this.i18n("default_vm_location"),a,"lblDefaultVMLocation",i),this.addDisplayItem(this.i18n("default_vhd_location"),r,"lblDefaultVHDLocation",n),this.addDisplayItem(this.i18n("failover_cluster"),o,"lblFailoverClusterFqdn",s)}},_renderDiskEl:function(e){var i=this.$(".host-disks > .value"),n=e.getDisksFromHost(this.model.getId()),s=_.groupBy(n,t.TIER_NAME),a=_.map(s,function(e,t){return t+":"+e.length}).join(", ");i.html(a)},_renderGpuEl:function(e){var t=e.getGPUSummary().join("<br>");t.length&&(this.$(".host-gpus > .value").html(t),this.$(".host-gpus").show())},renderDS:function(){var e=this,t=this.$(".host-datastores > .value");this.dsCollection?this._renderDatastoreEl(this.dsCollection):(r.addInlineSpinner(t),this.dsCollection=new s,this.dsCollection.clusterUuid=this.model.getClusterUuid(),this.dsCollection.fetch({success:function(t){e._renderDatastoreEl(t)},error:function(){t.empty()}}))},_renderDatastoreEl:function(e){var t=this.$(".host-datastores > .value"),i="";_.each(e.getDatastoreNamesByHost(this.model.getId()),function(e,t){i+=(0===t?"":"<br>")+e}),t.html(i)}})}),define("views/pages/alerts/details/FullDetailsAlertSummaryView",["views/basecomponents/pages/fulldetails/FullDetailsEntitySummaryView","managers/ActionManager","managers/NavigationManager","utils/AppUtil","utils/AppConstants","utils/AlertUtil","utils/DataRendererUtil","utils/TimeUtil"],function(e,t,i,n,s,a,r,o){"use strict";return e.extend({name:"FullDetailsAlertSummaryView",model:null,initialize:function(t){this.model=t.model,e.prototype.initialize.apply(this,arguments),this.addExtraEvents({"click a.attributeDetailsLink":"onAttributeDetailsLinkClick"})},onStartServices:function(){this.model.entityType===s.ENTITY_ALERT&&a.loadAlertTypeMetadata(),e.prototype.onStartServices.apply(this,arguments)},onDataChange:function(e){var t=this;e.entityType===s.ENTITY_ALERT?a.loadAlertTypeMetadata().always(function(){t._renderAlertDetails(e),t.refreshView()}):(this._renderAlertDetails(e),this.refreshView())},destroy:function(){this.model&&this.model.destroy(),e.prototype.destroy.apply(this,arguments)},_renderAlertDetails:function(e){var t=e.DP;this.clearDisplayItem();var i=this.addSection(),l=e.getValue(e.nameAttribute);this.setHeaderItem(this.i18n("header"),l,"n-alert-summary-header",null,null,i),i=this.addSection();var c,u=e.get(t.AFFECTED_ENTITIES);if(u&&u.length){var d=_.map(u,function(e){var i=e[t.ENTITY_TYPE];return i===s.ENTITY_NODE&&(i=s.ENTITY_HOST),i});c=n.renderAffectedEntitiesLink(this.clusterManager,this.getEntityTypeViewPrivileges(d),e,u,t.ENTITY_TYPE,t.ENTITY_NAME,"persisted-link")}this.addDisplayItem(this.i18n("affected_entities"),c,null,null,null,i);var h=a.formatSeverity(e.get(t.SEVERITY));this.addDisplayItem(this.i18n("severity"),h,"n-alert-severity",null,null,i);var p=e.getSeverityChangeTime();if(p&&this.addDisplayItem(this.i18n("severity_change"),o.formatDateTime(p/1e3),null,null,null,i),this.clusterManager.isMulticlusterUI()){var T=e.get(t.CLUSTER_UUID);T&&(this.addClusterLinkItem(T,i),this.addClusterVersionItem(T,i))}var E=o.formatDateTime(e.get(t.CREATED_TIMESTAMP)/1e3);this.addDisplayItem(this.i18n("created_time"),E,null,null,null,i);var S=o.formatDateTime(e.get(t.LAST_OCCURRENCE)/1e3);if(this.addDisplayItem(this.i18n("last_occurred"),S,null,null,null,i),this.addDisplayItem(this.i18n("impact_type"),e.getValue(t.IMPACT_TYPE),null,null,null,i),a.getAlertTypeMetadata(e.getValue(e.DP.ALERT_TYPE_UUID))){var g=r.getRenderer({name:e.DP.ALERT_TYPE_UUID,formatter:r.FORMATTER.ALERT_POLICY_DETAILS}),A=g.getAttributeDisplayValue(e);A===s.UNKNOWN_VALUE&&(A=l),this.addDisplayItem(this.i18n("policy"),A,null,null,null,i)}var m;e.get(t.RESOLVED)?m=e.get(t.AUTO_RESOLVED)?this.i18n("autoResolved"):this.i18n("resolved"):e.get(t.ACKNOWLEDGED)&&(m=this.i18n("acknowledged")),this.addDisplayItem(this.i18n("status"),m||"",null,null,null,i);var f=e.get(t.ACKNOWLEDGED_BY)||(e.get(t.ACKNOWLEDGED)?this.i18n("n_a"):"");if(this.addDisplayItem(this.i18n("acknowledged_by"),f,null,null,null,i),f){var I=o.formatDateTime(e.get(t.ACKNOWLEDGED_TIMESTAMP)/1e3);this.addDisplayItem("&nbsp;",I,null,null,null,i)}var C=e.get(t.RESOLVED_BY)||(e.get(t.RESOLVED)?this.i18n("n_a"):"");if(this.addDisplayItem(this.i18n("resolved_by"),C,null,null,null,i),C){var v=o.formatDateTime(e.get(t.RESOLVED_TIMESTAMP)/1e3);this.addDisplayItem("&nbsp;",v,null,null,null,i)}i=this.addSection(),this.addDisplayItem(this.i18n("description"),e.getValue(t.DESCRIPTION),"n-detail-summary-item",null,null,i)},onAttributeDetailsLinkClick:function(e){t.executeActionElement(e.currentTarget)},onPageLinkClick:function(t){this.clusterManager.isMulticlusterUI()?e.prototype.onPageLinkClick.apply(this,arguments):i.navigateToPageByPageLink($(t.currentTarget))}})}),define("views/pages/alerts/details/FullDetailsEventSummaryView",["views/pages/alerts/details/FullDetailsAlertSummaryView","utils/AppUtil","utils/AppConstants","utils/DataRendererUtil","utils/TimeUtil"],function(e,t,i,n,s){"use strict";return e.extend({name:"FullDetailsEventSummaryView",onDataChange:function(e){var a=e.DP;this.clearDisplayItem();var r=this.addSection(),o=e.getName();this.setHeaderItem(this.i18n("header"),o,"n-alert-summary-header",null,null,r),r=this.addSection();var l,c=e.get(a.AFFECTED_ENTITIES);if(c&&c.length){var u=_.map(c,function(e){var t=e[a.ENTITY_TYPE];return t===i.ENTITY_NODE&&(t=i.ENTITY_HOST),t});l=t.renderAffectedEntitiesLink(this.clusterManager,this.getEntityTypeViewPrivileges(u),e,c,a.ENTITY_TYPE,a.ENTITY_NAME,"persisted-link")}if(this.addDisplayItem(this.i18n("affected_entities"),l,null,null,null,r),this.clusterManager.isMulticlusterUI()){var d=e.get(a.CLUSTER_UUID);d&&(this.addClusterLinkItem(d,r),this.addClusterVersionItem(d,r))}var h=s.formatDateTime(e.get(a.CREATED_TIMESTAMP)/1e3);this.addDisplayItem(this.i18n("created_time"),h,null,null,null,r);var p=n.getRenderer({name:e.DP.CLASSIFICATIONS,formatter:n.FORMATTER.EVENT_CLASSIFICATION}),T=p.getAttributeDisplayValue(e);this.addDisplayItem(this.i18n("classification"),T,null,null,null,r),this.refreshView()}})}),define("views/basecomponents/pages/fulldetails/FullDetailsGpuSummaryView",["views/basecomponents/pages/fulldetails/FullDetailsEntitySummaryView","data/DataProperties","models/hardware/HostModel","models/gpu/GpuCollection","utils/AppUtil","utils/StatsUtil","utils/FilterUtil","utils/GpuUtil","utils/AppConstants"],function(e,t,i,n,s,a,r,o,l){"use strict";return e.extend({name:"FullDetailsGpuSummaryView",model:null,vGpuCollection:null,clusterUuid:null,initialize:function(t){e.prototype.initialize.apply(this,arguments),this.model=t.model,this.hostModel=null,this.clusterUuid=null},onDataChange:function(e){this.clearDisplayItem();var i=e.get(e.DP.GPU_CONFIG),n=a.statsFormat(t.STATS_GPU_FRAMEBUFFER_BYTES,i[e.DP.FRAMEBUFFER],!0);this.clusterUuid=e.getClusterUuid(),this.setHeaderItem(this.i18n("gpuType"),e.getGpuName(),null,{title:e.getGpuName()}),this.addClusterLinkItem(this.clusterUuid),this.addDisplayItem(this.i18n("host"),"","hostName"),this.addDisplayItem(this.i18n("gpuMode"),this.i18n(e.getGpuModeOfPGpu().toLowerCase()),"gpuMode"),e.getGpuModeOfPGpu()===e.GPU_MODE.VIRTUAL&&(this.addDisplayItem(this.i18n("vgpuProfile"),"","gpuProfile gpuForVirtual"),this.addDisplayItem(this.i18n("vgpuAllocation"),"","gpuAllocation gpuForVirtual")),this.addDisplayItem(this.i18n("gpuFramebuffer"),n,"gpuFramebuffer"),this.addDisplayItem(this.i18n("gpuID"),e.getSBDF(),"gpuSBDF"),this.refreshView(),this.renderHost(),e.getGpuModeOfPGpu()===e.GPU_MODE.VIRTUAL&&(s.addInLineDonutLoader(this.$(".gpuForVirtual > .value")),this.renderVGpu(e))},renderHost:function(){if(this.hostModel)this._renderHost(this.hostModel);else{var e=this;this.hostModel=new i,this.hostModel.setId(this.model.get(this.model.DP.HOST_UUID)),this.hostModel.setProjection([l.PROJECTION.BASIC_INFO]),this.hostModel.fetch({success:function(t){e._renderHost(t)}})}},renderVGpu:function(e){if(this.vGpuCollection)this._renderVGpuInfo();else{var t={};r.addFilterCondition(t,e.DP.SBDF,r.createFilterCondition(l.ENTITY_GPU,e.DP.SBDF,l.FILTER_OPERATORS.EQUALS,e.getSBDF())),r.addFilterCondition(t,e.DP.GPU_TYPE,r.createFilterCondition(l.ENTITY_GPU,e.DP.GPU_TYPE,l.FILTER_OPERATORS.EQUALS,e.GPU_TYPE_KSTRING.VIRTUAL));var i={};r.addFilterCondition(i,e.DP.ASSIGNABLE,r.createFilterCondition(l.ENTITY_GPU,e.DP.ASSIGNABLE,l.FILTER_OPERATORS.EQUALS,1)),r.addFilterCondition(i,e.DP.IN_USE,r.createFilterCondition(l.ENTITY_GPU,e.DP.IN_USE,l.FILTER_OPERATORS.EQUALS,1));var s=r.filterExpressionToFIQL(t)+r.FIQL_AND_OPERATOR+"("+r.filterORExpressionToFIQL(i)+")";this.vGpuCollection=new n,this.vGpuCollection.setFilterCriteria(s),this.vGpuCollection.setSingleHostUrl(e.get(e.DP.HOST_UUID)),this.vGpuCollection.fetch({success:_.bind(this._renderVGpuInfo,this)})}},_renderVGpuInfo:function(){var e=this.vGpuCollection.at(0);if(e){var t=e.get(this.model.DP.GPU_CONFIG),i=this.model.get(this.model.DP.GPU_CONFIG),n=t[this.model.DP.DEVICE_NAME],s=t[this.model.DP.FRACTION],a=i[this.model.DP.VM_UUID],r=a?a.length:0,l=o.getVirtualGpuAllocationStr(r,s);this.$(".gpuProfile > .value").html(n),this.$(".gpuAllocation > .value").html(l)}},_renderHost:function(e){var i=e.get(t.NAME),n=s.createFullPageDetailsLink(i,l.ENTITY_HOST,e.get(t.UUID));this.$(".hostName > .value").html(n)}})}),define("managers/TabDetailsViewFactory",["utils/AppConstants"],function(e){"use strict";return{customViewFactory:null,setCustomViewFactory:function(e){this.customViewFactory=e},loadCustomTabDetailsView:function(e,t,i){return!!this.customViewFactory&&this.customViewFactory.loadTabDetailsView(e,t,i)},loadTabDetailsView:function(t,i,n){if(!this.loadCustomTabDetailsView(t,i,n))switch(i){case e.TAB_DETAILS.ALERTS:require(["views/details/tabs/AlertTableTabContentDetailsView"],n);break;case e.TAB_DETAILS.GPU_VMS:require(["views/details/tabs/GpuVmsTableTabContentDetailsView"],n);break;case e.TAB_DETAILS.EVENTS:require(["views/details/tabs/TableTabContentDetailsView"],n);break;case e.TAB_DETAILS.CAPACITY:require(["views/details/tabs/CPTabContentDetailsView"],n);break;case e.TAB_DETAILS.PERFORMANCE:t===e.ENTITY_VM?require(["views/details/tabs/VMTabPerformanceDetailsView"],n):t===e.ENTITY_CLUSTER?require(["views/details/tabs/ClusterTabPerformanceDetailsView"],n):t===e.ENTITY_HOST&&require(["views/details/tabs/HostTabPerformanceDetailsView"],n);break;case e.TAB_DETAILS.HEALTH:require(["views/details/tabs/HealthTabContentDetailsView"],n);break;case e.TAB_DETAILS.METRICS:require(["views/details/tabs/MetricTabContentDetailsView"],n);break;case e.TAB_DETAILS.VIRTUAL_DISKS:case e.TAB_DETAILS.VIRTUAL_DISKS_PERF:require(["views/details/tabs/VirtualDiskTabContentDetailsView"],n);break;case e.TAB_DETAILS.VIRTUAL_DISKS_WRAP:require(["views/details/tabs/VirtualDiskTabContentWrapperView"],n);break;case e.TAB_DETAILS.VIRTUAL_NICS:require(["views/details/tabs/VirtualNicTabContentDetailsView"],n);break;case e.TAB_DETAILS.USAGE:require(["views/details/tabs/UsageTabContentDetailsView"],n);break;case e.TAB_DETAILS.REPLICATION_DIAGRAM:require(["views/details/tabs/ReplicationDiagramTabContentDetailsView"],n);break;case e.TAB_DETAILS.REPLICATION_TABLE:require(["views/details/tabs/ReplicationTableTabContentDetailsView"],n);break;case e.TAB_DETAILS.LOCAL_SNAPSHOT_TABLE:case e.TAB_DETAILS.REMOTE_SNAPSHOT_TABLE:require(["views/details/tabs/SnapshotTableTabContentDetailsView"],n);break;case e.TAB_DETAILS.ENTITY_TABLE:require(["views/details/tabs/VMTableTabContentDetailsView"],n);break;case e.TAB_DETAILS.SCHEDULE_TABLE:require(["views/details/tabs/ScheduleTableTabContentDetailsView"],n);break;case e.TAB_DETAILS.TASKS:require(["views/details/tabs/AcropolisTasksTabContentDetailsView"],n);break;case e.TAB_DETAILS.NICS:require(["views/details/tabs/AcropolisNICsTabContentDetailsView"],n);break;case e.TAB_DETAILS.SNAPSHOTS:require(["views/details/tabs/AcropolisSnapshotsTabContentDetailsView"],n);break;case e.TAB_DETAILS.VNC_CONSOLE:require(["views/details/tabs/VNCConsoleTabContentDetailsView"],n);break;case e.TAB_DETAILS.HOST_NICS:require(["views/details/tabs/HostNicTabContentDetailsView"],n);break;case e.TAB_DETAILS.PHYSICAL_SWITCH_INTERFACE:require(["views/details/tabs/PhysicalSwitchInterfaceTabContentDetailsView"],n);break;case e.TAB_DETAILS.FULLPAGE_ALERT_DETAILS:require(["views/details/tabs/AlertSummaryTabContentDetailsView"],n);break;case e.TAB_DETAILS.FULLPAGE_EVENT_DETAILS:require(["views/details/tabs/EventSummaryTabContentDetailsView"],n);break;case e.TAB_DETAILS.SUMMARY:require(["views/details/tabs/SummaryTabContentDetailsView"],n);break;case e.TAB_DETAILS.FS_SHARES:require(["views/details/tabs/FileServerSharesTabContentDetailsView"],n);break;case e.TAB_DETAILS.FS_USAGE:require(["views/details/tabs/FSUsageTabContentDetailsView"],n);break;case e.TAB_DETAILS.SELF_SERVICE_RESTORE:require(["views/details/tabs/FSShareSSRestoreTabContentDetailsView"],n);break;case e.TAB_DETAILS.FS_QUOTAS:require(["views/details/tabs/FSShareQuotasTabContentDetailsView"],n);break;case e.TAB_DETAILS.USAGE_BREAKDOWN:require(["views/details/tabs/UsageBreakdownTabContentDetailsView"],n);break;case e.TAB_DETAILS.INSTALLED_EXT:case e.TAB_DETAILS.AVAILABLE_EXT:require(["views/prismlet/PAListView"],n);break;case e.TAB_DETAILS.FS_ANTI_VIRUS:require(["views/details/tabs/FSAntiVirusTabContentWrapperView"],n);break;case e.TAB_DETAILS.ICAP_SERVERS:case e.TAB_DETAILS.REPORTS:case e.TAB_DETAILS.QUARANTINED_FILES:case e.TAB_DETAILS.UNQUARANTINED_FILES:require(["views/details/tabs/FSAntiVirusTabContentDetailsView"],n);break;case e.TAB_DETAILS.FS_PERFORMANCE:require(["views/details/tabs/FSPerformanceTabContentDetailsView"],n);break;case e.TAB_DETAILS.PRISM_REPORT:require(["views/details/tabs/ReportTabContentDetailsView"],n)}},loadCustomSummaryView:function(e,t){return!!this.customViewFactory&&this.customViewFactory.loadSummaryViewContents(e,t)},loadSummaryViewContents:function(t,i){if(this.loadCustomSummaryView(t,i))return!0;switch(t){case e.ENTITY_CLUSTER:return require(["views/basecomponents/pages/fulldetails/FullDetailsClusterSummaryView"],i),!0;case e.ENTITY_VM:return require(["views/basecomponents/pages/fulldetails/FullDetailsVMSummaryView"],i),!0;case e.ENTITY_CONTAINER:return require(["views/basecomponents/pages/fulldetails/FullDetailsContainerSummaryView"],i),!0;case e.ENTITY_DISK:return require(["views/basecomponents/pages/fulldetails/FullDetailsDiskSummaryView"],i),!0;case e.ENTITY_HOST:return require(["views/basecomponents/pages/fulldetails/FullDetailsHostSummaryView"],i),!0;case e.ENTITY_ALERT:return require(["views/pages/alerts/details/FullDetailsAlertSummaryView"],i),!0;case e.ENTITY_EVENT:return require(["views/pages/alerts/details/FullDetailsEventSummaryView"],i),!0;case e.ENTITY_GPU:return require(["views/basecomponents/pages/fulldetails/FullDetailsGpuSummaryView"],i),!0;default:return require(["views/basecomponents/pages/fulldetails/FullDetailsGenericEntitySummaryView"],i),!0}}}}),define("views/basecomponents/pages/fulldetails/FullDetailsClusterTabView",["views/basecomponents/pages/fulldetails/FullDetailsGenericEntityTabView","utils/AppConstants","utils/AlertUtil"],function(e,t,i){"use strict";return e.extend({viewFilters:[{targets:{selectors:['[data-target="CAPACITY"]']},conditions:{groups:[{type:"prismProFeatureDisabled",operator:t.FILTER_OPERATORS.EQUALS,reasonCode:"common.prismProFeatureDisabled",reason:"Prism Pro feature has been manually disabled in licensing configuration.",data:[!0]},{type:"xfitFeatureDisabled",operator:t.FILTER_OPERATORS.EQUALS,reasonCode:"common.xfitFeatureDisabled",reason:"All X-FIT features are currently disabled.",data:[!0]}]}}],render:function(){e.prototype.render.apply(this,arguments),this.renderViewFilter()},getViewFeatures:function(){var e=i.getXfitFeatureInfo();return{xfitFeatureDisabled:e.featureDisabled,prismProFeatureDisabled:e.licenseDisabled}}})}),define("views/basecomponents/pages/fulldetails/FullDetailsClusterActionBarView",["views/basecomponents/pages/fulldetails/FullDetailsGenericActionBarView","models/query/QueryResultCollection","data/DataProperties","managers/LicenseManager","utils/AppConstants","utils/AppUtil","managers/ActionManager"],function(e,t,i,n,s,a,r){"use strict";return e.extend({viewFilters:[{targets:{selectors:['.action-btn:[action-id="navigate_to_pe"]']},conditions:{groups:[{type:"isIframeSupported",data:[!1],reason:"This action is only supported on cluster version 4.5.2 or later.",operator:s.FILTER_OPERATORS.EQUALS}]}},{targets:{style:s.VIEW_FILTER.STYLE_CLASS.HIDE,selectors:['.action-btn:[action-id="unregister_cluster"]']},conditions:{groups:[{type:"isClusterAvailable",data:[!0],operator:s.FILTER_OPERATORS.EQUALS}]}},{targets:{selectors:['.action-btn:[action-id="update_cluster"]']},conditions:{groups:[{type:"isPrismProFeaturesEnabled",operator:s.FILTER_OPERATORS.NOT_EQUALS,reasonCode:"common.prismProFeatureDisabled",reason:"Prism Pro feature has been manually disabled in licensing configuration.",data:[!0]},{type:"isClusterUpgradeSupported",data:[!1],operator:s.FILTER_OPERATORS.EQUALS,reasonCode:"common.unsupportedMultiClusterUpgrade",reason:"This action is only supported on reachable AOS 5.1 or later clusters with no pending upgrades."}]}}],getViewFeatures:function(){var e=this.clusterManager.getClusterModelByClusterUuid(this.model.getClusterUuid());return{isIframeSupported:!!e&&e.isFFEnabled(s.FFLAGS.IFRAME),isClusterAvailable:this.clusterManager.isClusterAvailable(this.model.getClusterUuid()),isClusterUpgradeSupported:this.isClusterUpgradeSupported(this.model),isPrismProFeaturesEnabled:n.isPrismProFeaturesEnabled()}},isClusterUpgradeSupported:function(e){return!!(this.clusterManager.isClusterAvailable(e.getClusterUuid())&&a.compareVersions(e.getNosVersion(),s.CLUSTER_CONFIG_API_VERSION,2)>=0)},render:function(){e.prototype.render.apply(this,arguments),this.renderViewFilter()},onClick:function(e){e.stopPropagation();var n,a=this.getButtonOptionsByElement(e.currentTarget),o=a.options.actionId;if(n=o===s.ACTION_ID_NAVIGATE_TO_PE||o===s.ACTION_ID_FANOUT.VM_CREATE||o===s.ACTION_ID_UNREGISTER_CLUSTER||o===s.ACTION_UPDATE_CLUSTER?this.model.getClusterUuid():this.model.getId(),o===s.ACTION_UPDATE_CLUSTER){new t(null,{entity_type:s.ENTITY_CLUSTER,entity_ids:[n],group_member_attributes:[i.EB.CLUSTER.CLUSTER_UPGRAD_STATUS]}).fetch().always(_.bind(this._showUpgradeClusterPopup,this))}else r.onEntityAction(this.entityType,o,[n])},_showUpgradeClusterPopup:function(e){var t=e.at(0),n=t&&t.get(i.EB.CLUSTER.CLUSTER_UPGRAD_STATUS),a=!1;if(n)switch(n){case s.CLUSTER_UPGRADE_STATUS.SUCCEEDED:case s.CLUSTER_UPGRADE_STATUS.FAILED:case s.CLUSTER_UPGRADE_STATUS.CANCELLED:a=!0}else t&&(a=!0);a?r.onEntityAction(s.ENTITY_CLUSTER,s.ACTION_UPDATE_CLUSTER,[t.getId()]):$.nutanixConfirm({msg:this.i18nStatic("ViewFilters","common.unsupportedMultiClusterUpgrade"),yes:function(){this.onCloseBtnClicked()},yesText:this.i18n("ok"),hideNo:!0,context:this})}})}),define("views/basecomponents/pages/fulldetails/FullDetailsVMTabView",["views/basecomponents/pages/fulldetails/FullDetailsGenericEntityTabView","managers/acropolis/AcropolisNetworkManager","utils/AppConstants"],function(e,t,i){"use strict";return e.extend({clusterUuid:null,currentModel:null,reInitializeTab:function(e){this.currentModel.off("change",this.reInitializeTab,this),this.clusterUuid=this.currentModel.getClusterUuid(),t.setProxyClusterUuid(this.clusterUuid),t.fetchOnDemand(),this.currentModel.isKVM()&&(this.showTab(i.TAB_DETAILS.NICS),this.showTab(i.TAB_DETAILS.SNAPSHOTS))},hideVmSpecificTabs:function(){this.hideTab(i.TAB_DETAILS.NICS),this.hideTab(i.TAB_DETAILS.SNAPSHOTS)},onStartServices:function(){this.hideVmSpecificTabs(),this.clusterUuid||this.currentModel.on("change",this.reInitializeTab,this),this.currentModel.on(this.currentModel.EVENT.TASK_STARTED,this.onNewTaskStarted,this),e.prototype.onStartServices.apply(this,arguments)},onStopServices:function(){this.currentModel.off(this.currentModel.EVENT.TASK_STARTED,this.onNewTaskStarted,this),e.prototype.onStopServices.apply(this,arguments)},onNewTaskStarted:function(){this.refreshCurrentTab()}})}),define("views/widgets/VMActionBarView",["views/basecomponents/pages/fulldetails/FullDetailsGenericActionBarView","utils/AppConstants","data/DataProperties","managers/ActionManager","managers/TaskManager","managers/ClusterManager"],function(e,t,i,n,s,a){"use strict";return e.extend({name:"VMActionBarView",viewFilters:[{targets:{selectors:[".btnBar .action-btn"]},conditions:{groups:[{type:"canUserModify",data:[!1],operator:t.FILTER_OPERATORS.EQUALS,reasonCode:"vm.noAdmin",reason:"You must have admin privileges to perform actions. Please contact your system administrator."}]}},{targets:{selectors:[".btnBar .action-btn"]},conditions:{logic:t.VIEW_FILTER.LOGICS.EVERY,groups:[{type:"isCVM",data:[!1],operator:t.FILTER_OPERATORS.EQUALS},{logic:t.VIEW_FILTER.LOGICS.EVERY,type:"hypervisorType",data:[t.HYPERVISOR_TYPE.KVM,t.HYPERVISOR_TYPE.ESXI],operator:t.FILTER_OPERATORS.NOT_IN,reasonCode:"vm.nonAhvOrEsx",reason:"Actions are available only on VMs hosted on the Acropolis hypervisor or "+t.HYPERVISOR_LABEL[t.HYPERVISOR_TYPE.ESXI]+"."}]}},{targets:{selectors:[".btnBar .action-btn.snapshot",".btnBar .action-btn.migrate"]},conditions:{logic:t.VIEW_FILTER.LOGICS.EVERY,groups:[{type:"isCVM",data:[!1],operator:t.FILTER_OPERATORS.EQUALS},{logic:t.VIEW_FILTER.LOGICS.EVERY,type:"hypervisorType",data:[t.HYPERVISOR_TYPE.KVM],operator:t.FILTER_OPERATORS.NOT_IN,reasonCode:"vm.nonAcropolis",reason:"Actions are available only on VMs hosted on the Acropolis hypervisor."}]}},{targets:{selectors:['.action-btn:not(".action-btn.console")']},conditions:{groups:[{type:"isCVM",data:[!0],operator:t.FILTER_OPERATORS.EQUALS,reasonCode:"vm.nonCVM",reason:"This action is not available on Acropolis controller VM"}]}},{targets:{style:t.VIEW_FILTER.STYLE_CLASS.GRAY_OUT,selectors:[".action-btn.console"]},conditions:{logic:t.VIEW_FILTER.LOGICS.EVERY,groups:[{type:"isCVM",data:[!0],operator:t.FILTER_OPERATORS.EQUALS},{logic:t.VIEW_FILTER.LOGICS.EVERY,type:"hypervisorType",data:[t.HYPERVISOR_TYPE.KVM,t.HYPERVISOR_TYPE.ESXI],reasonCode:"vm.noConsoles",reason:"Consoles are available only on VMs hosted on Acropolis hypervisor or "+t.HYPERVISOR_LABEL[t.HYPERVISOR_TYPE.ESXI]+".",operator:t.FILTER_OPERATORS.NOT_IN}]}},{targets:{style:t.VIEW_FILTER.STYLE_CLASS.GRAY_OUT,selectors:['.action-btn:not(".action-btn.console")']},conditions:{logic:t.VIEW_FILTER.LOGICS.EVERY,groups:[{type:"isCVM",data:[!1],operator:t.FILTER_OPERATORS.EQUALS},{type:"isFanoutSupported",data:[!1],reasonCode:"vm.fourSixPlus",reason:"Actions are available only on VMs hosted onAcropolis cluster version 4.6 or later",operator:t.FILTER_OPERATORS.EQUALS}]}},{targets:{style:t.VIEW_FILTER.STYLE_CLASS.GRAY_OUT,selectors:[".action-btn"]},conditions:{logic:t.VIEW_FILTER.LOGICS.EVERY,groups:[{type:"isCVM",data:[!1],operator:t.FILTER_OPERATORS.EQUALS},{logic:t.VIEW_FILTER.LOGICS.EVERY,type:"hypervisorType",data:[t.HYPERVISOR_TYPE.ESXI],operator:t.FILTER_OPERATORS.IN},{type:"hasAmfOverEsxBasicSupport",data:[!1],reasonCode:"vm.preAsterix",reason:"Actions are available only on VMs hosted onAcropolis cluster version 5.0 or later",operator:t.FILTER_OPERATORS.EQUALS}]}},{targets:{style:t.VIEW_FILTER.STYLE_CLASS.GRAY_OUT,selectors:[".btnBar .action-btn.clone",".btnBar .action-btn.pause",".btnBar .action-btn.resume",".btnBar .action-btn.update",".btnBar .action-btn.delete"]},conditions:{logic:t.VIEW_FILTER.LOGICS.EVERY,groups:[{type:"isCVM",data:[!1],operator:t.FILTER_OPERATORS.EQUALS},{logic:t.VIEW_FILTER.LOGICS.EVERY,type:"hypervisorType",data:[t.HYPERVISOR_TYPE.ESXI],operator:t.FILTER_OPERATORS.IN},{type:"isManagementServerRegistered",data:[!1],reasonCode:"vm.noMgmtServerVcenter",reason:"Actions are available only on VMs hosted ona cluster that is registered to a vCenter",operator:t.FILTER_OPERATORS.EQUALS}]}},{targets:{style:t.VIEW_FILTER.STYLE_CLASS.GRAY_OUT,selectors:[".action-btn.console"]},conditions:{groups:[{type:"hasPCConsoleSupport",data:[!1],reasonCode:"vm.fourFivePlus",reason:"Consoles are only available on VMs hosted onAcropolis cluster version 4.5.2 or later",operator:t.FILTER_OPERATORS.EQUALS}]}},{targets:{style:t.VIEW_FILTER.STYLE_CLASS.HIDE,selectors:[".action-btn.power_on"]},conditions:{groups:[{type:"powerState",data:[t.VM_POWER_STATE.ON,t.VM_POWER_STATE.SUSPENDED],reasonCode:"vm.alreadyOnOrSuspended",reason:"VM is already powered on or is suspended.",operator:t.FILTER_OPERATORS.EQUALS}]}},{targets:{style:t.VIEW_FILTER.STYLE_CLASS.HIDE,selectors:[".action-btn.power_off"]},conditions:{groups:[{type:"powerState",data:[t.VM_POWER_STATE.OFF],reasonCode:"vm.alreadyOff",reason:"VM is already powered off",operator:t.FILTER_OPERATORS.EQUALS}]}},{targets:{style:t.VIEW_FILTER.STYLE_CLASS.GRAY_OUT,selectors:[".action-btn.console"]},conditions:{groups:[{type:"powerState",data:[t.VM_POWER_STATE.OFF],reasonCode:"vm.currentlyOff",reason:"VM is currently powered off",operator:t.FILTER_OPERATORS.EQUALS}]}},{targets:{style:t.VIEW_FILTER.STYLE_CLASS.HIDE,selectors:[".action-btn.enable_ngt"]},conditions:{groups:[{type:"NGTState",data:[!0],reasonCode:"vm.alreadyEnabled",reason:"Selected VM is already NGT enabled",operator:t.FILTER_OPERATORS.EQUALS}]}},{targets:{style:t.VIEW_FILTER.STYLE_CLASS.HIDE,selectors:[".action-btn.disable_ngt"]},conditions:{groups:[{type:"NGTState",data:[!1],reasonCode:"vm.alreadyDisabled",reason:"Selected VM is already NGT disabled",operator:t.FILTER_OPERATORS.EQUALS}]}},{targets:{selectors:[".action-btn.resume",".action-btn.suspend",".action-btn.migrate"]},conditions:{groups:[{type:"powerState",data:[t.VM_POWER_STATE.OFF],reasonCode:"vm.currentlyOff",reason:"VM is currently powered off",operator:t.FILTER_OPERATORS.EQUALS}]}},{targets:{selectors:[".action-btn.resume"]},conditions:{groups:[{type:"powerState",data:[t.VM_POWER_STATE.ON],reasonCode:"vm.alreadyOn",reason:"VM is already powered on.",operator:t.FILTER_OPERATORS.EQUALS}]}},{targets:{selectors:[".action-btn.pause"]},conditions:{groups:[{type:"powerState",data:[t.VM_POWER_STATE.OFF,t.VM_POWER_STATE.SUSPENDED],reasonCode:"vm.alreadyOffOrSuspended",reason:"VM is already powered off or is suspended.",operator:t.FILTER_OPERATORS.EQUALS}]}},{targets:{selectors:[".action-btn.affinity"]},conditions:{groups:[{type:"isHostAffinitySupported",data:[!1],reasonCode:"vm.vmAffinityPreAsterix",reason:"Configuring VM-host affinity policies is supported for VMs running on the Acropolis hypervisor and cluster version 5.0 or later.",operator:t.FILTER_OPERATORS.EQUALS}]}},{targets:{selectors:[".action-btn.pause",".action-btn.resume",".action-btn.suspend",".action-btn.migrate"]},conditions:{groups:[{type:"hasGpuAssigned",data:[!0],reasonCode:"vm.noPauseResume",reason:"The selected VM cannot be paused/resumed",operator:t.FILTER_OPERATORS.EQUALS}]}}],EVENTS:{DELETED:"deleted"},initialize:function(t){this.actionModels=n.getActions(t.model.entityType).getModifyEntityActions(),_.bindAll(this,"onTasksChange"),e.prototype.initialize.apply(this,arguments)},getViewFeatures:function(){var e=a.getClusterModelById(this.model.getClusterUuid()),n=null;return this.model.get(i.VM_NGT)&&(n=this.model.get(i.VM_NGT)[i.VM_NGT_ENABLED]),{NGTState:n,powerState:this.model.get(i.VM_POWER_STATE),isCVM:this.model.get(i.VM_CONTROLLER_VM)||!1,isFanoutSupported:this.model.isFanoutSupported(),
canUserModify:this.canModifyByEntityType(t.ENTITY_VM),hasPCConsoleSupport:!!e&&e.hasPCConsoleFeature(),hypervisorType:this.model.getHypervisorType(),hasAmfOverEsxBasicSupport:this.model.hasAmfOverEsxBasicSupport(),isHostAffinitySupported:this.model.isHostAffinitySupported()||!1,isManagementServerRegistered:!!e&&e.isManagementServerRegistered(),hasGpuAssigned:this.model.get(i.POWER_STATE)===t.VM_POWER_STATE.ON&&this.model.get(i.VM_GPUS_IN_USE)}},onClick:function(e){var t=this.getButtonOptionsByElement(e.currentTarget),s=t.options.actionId;n.onEntityAction(this.entityType,s,[this.model.get(i.UUID)],this.model.getClusterUuid())},onTasksChange:function(e){_.find(e,function(e){if(e.get(i.TASK_SUB_TASK_OPERATION)===s.SUBTASK_OPERATIONS.VM.DELETE&&e.isStatusComplete()&&e.containsEntityId(this.model.get(i.UUID)))return this.trigger(this.EVENTS.DELETED),!0},this)},onStartServices:function(){e.prototype.onStartServices.apply(this,arguments),s.registerHandlerForChangedTasks(this.onTasksChange)},onStopServices:function(){e.prototype.onStopServices.apply(this,arguments),s.unregisterHandlerForChangedTasks(this.onTasksChange)}})}),define("models/insights/QueryModel",["models/BaseModel","utils/StyleDescriptor","utils/InsightsUtil","utils/AppConstants","data/DataProperties"],function(e,t,i,n,s){"use strict";return e.extend({name:"QueryModel",idAttribute:s.ID,QUERY_OPTIONS:["queryEntityType","queryName","groupBy","sort","count","sortOrder","sortKey","metricOperator","filterMin","filterMax"],METRIC_OPERATORS:["avg","min","max","sum"],SORT_KEYS:{MAX:"max",MIN:"min"},DEFAULT_TOP_N_COUNT:5,ENTITY_GROUPBYS:{cluster:{title:"Cluster",next:["cvm"]},cvm:{title:"CVM",next:["volume","disk","vdisk"]},volume:{title:"Volume",next:[]},disk:{title:"Disk",next:[]},vdisk:{title:"VDisk",next:[]}},defaults:{id:null,entity:null,metric:null,queryEntityType:null,queryName:null,sort:null,groupBy:null,count:null,sortOrder:null,sortKey:null,metricOperator:null,filterMin:null,filterMax:null,enabled:!0,colors:null},initialize:function(e){e=e||{},e.entity&&(e.entity.uid=i.uniqueEntityIdentifier(e.entity)),e.metric&&(e.metric.uid=e.metric.id),this.set({entity:e.entity||{},metric:e.metric||{},enabled:!0})},isEnabled:function(){return this.get(s.ENABLED)},setEnabled:function(e){this.set(s.ENABLED,e)},getEntityDisplayName:function(){return i.entityDisplayName(this.get(s.QUERY_ENTITY))},getMetricDisplayName:function(){return i.metricDisplayName(this.get(s.QUERY_METRIC))},fullMetricDisplayName:function(){return i.fullMetricDisplayName(this.get(s.QUERY_METRIC))},hasEntityOrMetric:function(e){return this.get(s.QUERY_ENTITY).uid===e||this.get(s.QUERY_METRIC).uid===e},hasEntityAndMetric:function(e,t){return this.get(s.QUERY_ENTITY).uid===e&&this.get(s.QUERY_METRIC).uid===t},assignUniqueColors:function(e,i){for(var n=this.get(s.CHART_COLORS)||[],a=0;a<i;a++){var r=t.getUniqueChartColor(e);n.push(r),e.push(r)}return this.set(s.CHART_COLORS,n),e},getDDOptions:function(){var e=this.get("groupBy")||"cluster",t=this.ENTITY_GROUPBYS[e],i=[];return _.each(t.next,function(e){i.push({groupBy:e,sortOrder:n.SORT_DESC,sortKey:this.SORT_KEYS.MAX,count:this.DEFAULT_TOP_N_COUNT}),i.push({groupBy:e,sortOrder:n.SORT_ASC,sortKey:this.SORT_KEYS.MIN,count:this.DEFAULT_TOP_N_COUNT})},this),_.each(i,function(e){e.title=this.getDDTitle(e.groupBy,e.sortKey,e.count)},this),i},getDDTitle:function(e,t,i){return((t||this.get("sortKey"))===this.SORT_KEYS.MAX?"Top":"Bottom")+" "+(i||this.get("count"))+" "+this.groupByDisplayName(e||this.get("groupBy"))+"s"},groupByDisplayName:function(e){return this.ENTITY_GROUPBYS[e].title}})}),define("models/insights/InsightsChartModel",["models/BaseModel","models/BaseCollection","utils/StyleDescriptor","utils/AppConstants","utils/AppUtil","utils/StatsUtil","models/insights/QueryModel","data/DataProperties"],function(e,t,i,n,s,a,r,o){"use strict";var l=t.extend({model:r,name:"QueryCollection"});return e.extend({name:"InsightsChartModel",CHART_TYPE_METRIC:"Metric",CHART_TYPE_ENTITY:"Entity",CHART_TYPE_INSIGHTS:"Insights",CHART_TYPE_INSIGHTS_TOP_N:"InsightsTopN",CHART_SIZE_SMALL:"s",CHART_SIZE_MEDIUM:"m",CHART_SIZE_LARGE:"l",CHART_LINK_PREFIX:"def=",BASE_CHART_ATTRS:["type","title","enabled","size","maxY","minY","warnThreshold","maxThreshold"],UNTITLED_CHART:"Untitled Chart",defaults:{chartId:null,type:null,queryCollection:null,title:null,enabled:!1,size:null,minY:null,maxY:null,warnThreshold:null,maxThreshold:null,transient:!1,parentModel:null},initialize:function(e){e=e||{},this.set({enabled:!0,type:e.type||this.CHART_TYPE_INSIGHTS,size:e.size||this.CHART_SIZE_SMALL,queryCollection:new l})},destroy:function(){var e=this.getParentModel();e&&(e.off("stats:loaded",this._loadStatsSuccessCallback,this),e.off("stats:error",this._loadStatsErrorCallback,this))},setDDOptions:function(e){this.set(o.CHART_TYPE,e.type);var t=this.getQueryByEntityAndMetric(e.euid,e.muid);t&&(_.each(t.QUERY_OPTIONS,function(i){e[i]&&t.set(i,e[i])}),this.get("queryCollection").reset([t]))},refreshQuery:function(e){this.getParentModel().removeStats(e),this.triggerChartChange()},getChartId:function(){return this.get("chartId")},setChartId:function(e){this.set({chartId:e})},getChartSize:function(){return this.get("size")},setChartSize:function(e){this.set({size:e})},setTransient:function(e){this.set({transient:e})},isTransient:function(){return this.get("transient")},getQueryById:function(e){return this.get("queryCollection").findModelById(e)},getQueryByEntityAndMetric:function(e,t){return _.find(this.getQueries(),function(i){return i.hasEntityAndMetric(e,t)})},toggleQueryEnable:function(e){var t=this.getQueryById(e);t.setEnabled(!t.isEnabled()),this.triggerChartChange()},toggleQueryResultEnable:function(e){var t=this.getQueries()[0],i=this.getStats(t),n=_.find(i[o.QUERY_RESULTS_PROPERTIES],function(t){return t.id==e});n&&(n.enabled=!n.enabled),this.triggerChartChange()},enableAllQueries:function(e){_.each(this.getQueries(),function(t){t.setEnabled(e)})},enableMetric:function(e,t){_.each(this.getQueries(),function(i){i.get(o.QUERY_METRIC).uid===e&&i.setEnabled(t)})},getQueries:function(){return this.get("queryCollection").models},removeQueries:function(e){var t=this.getQueries(),i=[];_.each(e,function(e){_.each(t,function(t){t.hasEntityOrMetric(e)&&i.push(t)})}),i.length&&this.get("queryCollection").remove(i)},addQueries:function(e,t){var i=[],n=this.get("queryCollection").at(0),a={};_.each(n.QUERY_OPTIONS,function(e){var t=n.get(e);t&&(a[e]=t)});var o=function(e,t){var n=_.extend({id:s.randomId("qry-"),entity:e,metric:t},a),o=new r(n);i.push(o)};_.each(this.getChartEntities(),function(e){_.each(t,function(t){o(e,t)},this)},this),_.each(this.getChartMetrics(),function(t){_.each(e,function(e){o(e,t)},this)},this),_.each(e,function(e){_.each(t,function(t){o(e,t)},this)},this),i.length&&this.get("queryCollection").add(i)},getMetricById:function(e){return _.find(this.METRICS,function(t){return t.id===e})},getEntityTypeById:function(e){return _.find(this.ENTITY_TYPES,function(t){return t.id===e})},getChartMetrics:function(){var e=[];return _.each(this.getQueries(),function(t){e.push(t.get(o.QUERY_METRIC))},this),_.uniq(e,!1,function(e){return e.uid})},getChartEntities:function(){var e=[];return _.each(this.getQueries(),function(t){e.push(t.get(o.QUERY_ENTITY))},this),_.uniq(e,!1,function(e){return e.uid})},getParentModel:function(){return this.get("parentModel")},setParentModel:function(e){this.set({parentModel:e}),e.on("stats:loaded",this._loadStatsSuccessCallback,this),e.on("stats:error",this._loadStatsErrorCallback,this)},getTitle:function(){return this.get("title")&&this.get("title").length>0?this.get("title"):this.UNTITLED_CHART},getDefaultTitle:function(){return this.getTitle()},getStats:function(e){return this.getParentModel().getStats(e)},getStatsState:function(e){return this.getParentModel().getStatsState(e)},getChartTimeFormat:function(){return this.getParentModel().getChartTimeFormat()},loadStats:function(e){var t=this.cid;this.getParentModel().loadStats(e,t)},assignChartColors:function(){var e=[];e.push(i.getInsightsThresholdColor(n.INSIGHTS_CHART_WATERMARKS.THRESHOLD_WARN)),e.push(i.getInsightsThresholdColor(n.INSIGHTS_CHART_WATERMARKS.THRESHOLD_MAX)),_.each(this.getQueries(),function(t){var i=t.get(o.CHART_COLORS);i&&i.length&&(e=e.concat(i))}),_.each(this.getQueries(),function(t){var i=t.get(o.CHART_COLORS),n=this.getStats(t),s=n?n[o.QUERY_RESULTS_DATA].length:1,a=i?i.length:0;s>a&&(e=t.assignUniqueColors(e,s-a))},this)},getChartColor:function(e){},setUserChartColor:function(e,t){},toPersistedObject:function(){var e={};_.each(this.BASE_CHART_ATTRS,function(t){var i=this.get(t);void 0!==i&&(e[t]=i)},this);var t=[];return _.each(this.getQueries(),function(e){t.push(e.toJSON())},this),e[o.CHART_QUERIES]=t,e},fromPersistedObject:function(e){if(_.each(this.BASE_CHART_ATTRS,function(t){void 0!==e[t]&&this.set(t,e[t])},this),e[o.CHART_QUERIES]){var t=_.map(e[o.CHART_QUERIES],function(e){return e.id=s.randomId("qry-"),new r(e)});this.set("queryCollection",new l(t)),this.assignChartColors()}},toURL:function(){var e=this.toPersistedObject();return this.CHART_LINK_PREFIX+encodeURIComponent(JSON.stringify(e))},fromURL:function(e){try{var t=e.indexOf(this.CHART_LINK_PREFIX),i=e.substr(t+this.CHART_LINK_PREFIX.length),n=JSON.parse(decodeURIComponent(i));return this.fromPersistedObject(n),!0}catch(t){return s.log("InsightsChartModel : fromURL. Error: Unable to parse chart link: "+e),!1}},hasDisparateMetrics:function(){var e=[];return _.each(this.getQueries(),function(t){if(t.isEnabled()){var i=t.get(o.QUERY_METRIC)[o.ID];e.push(a.getMetricUnits(i))}},this),_.uniq(e).length>1},_loadStatsSuccessCallback:function(e){s.debug("InsightsChartModel _loadStatsSuccessCallback:",e),this._triggerEvent("stats:loaded",e)},_loadStatsErrorCallback:function(e){s.debug("InsightsChartModel _loadStatsErrorCallback:",e),this._triggerEvent("stats:error",e)},_triggerEvent:function(e,t){t[1]===this.cid&&this.trigger(e,t[0])},triggerChartChange:function(){this.getParentModel()._triggerChartChange()}})}),define("models/insights/InsightsStatsModel",["models/stats/StatsModel","utils/StatsUtil","data/DataProperties"],function(e,t,i){"use strict";var n=_.template('insights/stats?entityType=<%= encodeURIComponent(entityType) %>&entityId=<%= encodeURIComponent(entityId) %>&metric=<%= encodeURIComponent(metricId) %>&startTimeInUsecs=<%= startTime ||  "" %>&endTimeInUsecs=<%= endTime || "" %>&intervalInSecs=<%= samplingInterval || "" %>');return e.extend({processStats:function(e){var n=this.queryModel.get(i.QUERY_METRIC).id;return t.processAnalysisStats(n,e)},getStatsURL:function(){var e=this.queryModel.get(i.QUERY_ENTITY),t=this.queryModel.get(i.QUERY_METRIC),s=e.id;"CURRENT_CLUSTER"===s&&(s=null);var a={entityId:s||"",entityType:e.type||"",metricId:t.id||"",startTime:1e3*this.get(i.START_TIME),endTime:1e3*this.get(i.END_TIME),samplingInterval:this.get(i.SAMPLING_INTERVAL_SECS)},r=n(a),o="";return _.each(this.queryModel.QUERY_OPTIONS,function(e){var t=this.queryModel.get(e);null!==t&&(o+="&"+e+"="+encodeURIComponent(t))},this),r+o},parse:function(e){var t=[],n=[];if(e){var s=e.length?e:[e];_.each(s,function(e){var i=[];_.each(e.values,function(e){i.push([e.t,e.v])}),t.push(this.processStats(i)),n.push({id:e.entityId,name:e.entityName,type:e.entityType,enabled:!0})},this)}var a={};return a[i.QUERY_RESULTS_DATA]=t,a[i.QUERY_RESULTS_PROPERTIES]=n,a},getStats:function(){var e={};return e[i.QUERY_RESULTS_DATA]=this.get(i.QUERY_RESULTS_DATA),e[i.QUERY_RESULTS_PROPERTIES]=this.get(i.QUERY_RESULTS_PROPERTIES),e},setQuery:function(e){this.queryModel=e},getQuery:function(){return this.queryModel}})}),define("models/insights/StandaloneInsightsChartModel",["models/insights/InsightsChartModel","models/insights/InsightsStatsModel","utils/AppConstants","utils/StatsUtil","data/DataProperties"],function(e,t,i,n,s){"use strict";return e.extend({name:"StandaloneInsightsChartModel",stats:null,initialize:function(t){e.prototype.initialize.apply(this,arguments),this.stats=[]},getStats:function(e){var t=null,i=this._getStatsModel(e);return i&&(t=i.getStats()),t},getStatsState:function(e){var t=null,i=this._getStatsModel(e);return i&&(t=i.getState()),t},loadStats:function(e){var t=this.createStatsModel(),s=n.getStatsStartTime(),a=n.getStatsCurrentTime();this.set("timeRangeMin",s,{silent:!0}),this.set("timeRangeMax",a,{silent:!0}),t.setTimeInterval(s,a,i.DEFAULT_STATS_INTERVAL),t.setQuery(e),this.stats.push(t),this._requestStats(t)},createStatsModel:function(){return new t},startFetching:function(){_.each(this.stats,function(e){this._requestStats(e)},this)},stopFetching:function(){_.each(this.stats,function(e){e.stopFetch()})},getChartTimeFormat:function(){var e=n.getStatsCurrentTime()-n.getStatsStartTime(),t="MM/dd hh:mm";return e<i.MILLIS_PER_DAY&&(t="hh:mm:ss"),t},_getStatsModel:function(e){var t=e.get(s.ID);return _.find(this.stats,function(e){return e.getQuery().get(s.ID)===t})},_requestStats:function(e){var t=this;e.fetch({success:function(e){t.trigger("stats:loaded",e.getQuery().get(s.ID))},error:function(e){t.trigger("stats:error",e.getQuery().get(s.ID))}})}})}),define("models/alert/SummaryAlertModel",["models/BaseModel","models/insights/StandaloneInsightsChartModel","data/DataManager","data/DataProperties","data/DataURLConstants","utils/AppConstants","utils/AlertUtil","utils/SubModelHelper"],function(e,t,i,n,s,a,r,o){"use strict";var l={ID:"id",NAME:"name",ALERT_TITLE:"alert_title",ALERT_TYPE_UUID:"alert_type_uuid",CLUSTER_UUID:"cluster_uuid",IMPACT_TYPE:"impact_type",IMPACT_TYPES:"impact_types",DESCRIPTION:"description",IMPACT:"impact",SEVERITY:"severity",MESSAGE:"message",RESOLVED:"resolved",ACKNOWLEDGED:"acknowledged",CONTEXT_TYPES:"context_types",CONTEXT_VALUES:"context_values",CLASSIFICATIONS:"classifications",ENTITIES:"entities",STATUS:"status",CURRENT_STATE:"current_state",INSTANCE_COUNT:"instance_count",TIMESTAMP:"updated_time_stamp_in_usecs",CREATED_TIMESTAMP:"created_time_stamp_in_usecs",LAST_OCCURRENCE:"last_occurrence_time_stamp_in_usecs",ACKNOWLEDGED_TIMESTAMP:"acknowledged_time_stamp_in_usecs",RESOLVED_TIMESTAMP:"resolved_time_stamp_in_usecs",ACKNOWLEDGED_BY:"acknowledged_by_username",RESOLVED_BY:"resolved_by_username",AUTO_RESOLVED:"auto_resolved",AFFECTED_ENTITIES:"affected_entities",ENTITY_NAME:"entity_name",ENTITY_UUID:"uuid",ALERT_DETAILS:"alert_details",SEVERITY_TRAILS:"severity_trails",SEVERITY_CHANGE_TIMESTAMP:"severity_change_timestamp_in_usecs",COMPARISON_OPERATOR:"comparison_operator",METRIC_DETAILS:"metric_details",METRIC_NAME:"metric_name",METRIC_DISPLAY_NAME:"metric_display_name",METRIC_VALUE_DETAILS:"metric_value_details",METRIC_THRESHOLD_VALUE:"metric_threshold_value",INDICATOR_TIMESTAMP:"state_change_time_stamp_in_usecs",METRIC_VALUE:"metric_value",ENTITY_TYPE:"entity_type",ENTITY_ID:"entity_id",CONDITION_TYPE:"condition_type",UNIT:"unit",CHART_QUERIES:"chart_queries",POSSIBLE_CAUSES:"possible_causes",USER_DEFINED:"user_defined"};return e.extend({subModelHelper:null,idAttribute:l.ID,nameAttribute:l.NAME,urlRoot:s.ALERT,name:"SummaryAlertModel",entityType:a.ENTITY_ALERT,DP:l,defaults:{name:null,impact_type:null,description:null,impact:null,severity:null,entities:[],status:null,current_state:null,instance_count:0,created_time_stamp_in_usecs:null,last_occurrence_time_stamp_in_usecs:null,acknowledged_by_username:null,resolved_by_username:null,chart_queries:[],user_defined:!1},ALERT_HISTORY_MODEL_ID:"alertHistoryChartModel",initialize:function(){this.subModelHelper=new o,e.prototype.initialize.apply(this,arguments)},getURL:function(){return this.urlRoot+"?alert_ids="+this.get(this.idAttribute)+"&detailed_info=true"},getDataSourceURL:function(){return i.getV2DataSourceURL()},parse:function(t){return t=e.prototype.parse.apply(this,arguments),t=this.selectResponseEntity(t),this.subModelHelper.get(this.ALERT_HISTORY_MODEL_ID)&&this.subModelHelper.remove(this.ALERT_HISTORY_MODEL_ID),t},selectResponseEntity:function(e){return e&&e.entities[0]},_createAndRegisterChartModel:function(){var e=this.get(l.CHART_QUERIES)&&this.get(l.CHART_QUERIES)[0];if(e){var t=this.createChartModel();return t.fromPersistedObject(e),this.subModelHelper.register(this.ALERT_HISTORY_MODEL_ID,t),t}},nameParserFunc:function(){return this.getDisplayName()},getValue:function(t){var i;switch(t){case l.NAME:i=this.getDisplayName();break;case l.DESCRIPTION:i=this.getDescription();break;case l.IMPACT_TYPE:i=this.getAlertImpactTypes();break;default:i=e.prototype.getValue.apply(this,arguments)}return i},getClusterUuid:function(){return this.get(l.CLUSTER_UUID)},createChartModel:function(){return new t},getChartModel:function(){var e=this.subModelHelper.get(this.ALERT_HISTORY_MODEL_ID);return e||this._createAndRegisterChartModel()},getTimeStamp:function(){var e=this.get(l.TIMESTAMP);return e&&e>0?e/a.MICROS_PER_MILLI:0},getAlertInstances:function(){return[]},getDisplayName:function(){var e=this.get(this.DP.ALERT_TITLE)?this.DP.ALERT_TITLE:this.DP.MESSAGE;return this.populateMessageParams(this.get(e))},getDescription:function(){return this.populateMessageParams(this.get(this.DP.MESSAGE))},populateMessageParams:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",i=n.ALERT_CONTEXT_TYPES,s=n.ALERT_CONTEXT_VALUES;return r.formatIssue(t,this,(e={},_defineProperty(e,i,l.CONTEXT_TYPES),_defineProperty(e,s,l.CONTEXT_VALUES),e))},getAlertImpactTypes:function(e){var t=this.get(l.IMPACT_TYPES);return t?(t=_.filter(t,function(e){return a.ALERT_IMPACT_TYPES[e]}),_.map(t,function(e){return a.ALERT_IMPACT_TYPES[e][0]}).join(",")):""},getMetricDetails:function(){var e=this.get(l.ALERT_DETAILS),t=e&&e[this.DP.METRIC_DETAILS];if(t&&_.isArray(t)&&t.length){t=_.last(t);var i=_.first(this.get(l.AFFECTED_ENTITIES)),n=t[l.METRIC_VALUE_DETAILS],s=this.get(l.CREATED_TIMESTAMP),a=this._getMetricDetailsObject(t);if(a.comparator=r.COMPARATORS[t[l.COMPARISON_OPERATOR]],a.timestamp=s,a.entityType=t[l.ENTITY_TYPE],a.entityId=t[l.ENTITY_ID]||i&&i[l.ENTITY_UUID],_.isArray(n)&&_.first(n)){var o=_.first(n);a.metricValue=o[l.METRIC_VALUE],a.threshold=parseFloat(o[l.METRIC_THRESHOLD_VALUE]),o[l.INDICATOR_TIMESTAMP]&&(a.timestamp=o[l.INDICATOR_TIMESTAMP])}var c=e[l.SEVERITY_TRAILS],u=_.find(c,function(e){return e[l.SEVERITY_CHANGE_TIMESTAMP]===s});return u&&(a.severity=u[l.SEVERITY]),a}},_getMetricDetailsObject:function(e){return{severity:this.get(l.SEVERITY),condition_type:e[l.CONDITION_TYPE],displayName:e[l.METRIC_DISPLAY_NAME],metricName:e[l.METRIC_NAME],unit:e[l.UNIT]}},getSeverityChangeTime:function(){var e=this.get(l.ALERT_DETAILS),t=e&&e[l.SEVERITY_TRAILS];if(t&&t.length>1){return _.max(t,function(e){return e[l.SEVERITY_CHANGE_TIMESTAMP]})[l.SEVERITY_CHANGE_TIMESTAMP]}},isUserDefined:function(){return this.get(l.USER_DEFINED)},destroy:function(){this.subModelHelper&&this.subModelHelper.removeAll(),this.subModelHelper=null}},{DP:l})}),define("views/pages/alerts/details/FullDetailsAlertTabView",["views/basecomponents/pages/fulldetails/FullDetailsBaseTabView","utils/AppConstants"],function(e,t){"use strict";return e.extend({name:"FullDetailsAlertTabView",initialize:function(i){i.entityType=i.entityType||t.ENTITY_ALERT,i.pageId=i.pageId||t.PAGE_ALERTS;var n=t.TAB_DETAILS.FULLPAGE_ALERT_DETAILS;i.entityType===t.ENTITY_EVENT&&(n=t.TAB_DETAILS.FULLPAGE_EVENT_DETAILS),i.tabNames=_defineProperty({},n,this.i18n("summary")),e.prototype.initialize.apply(this,arguments)}})}),define("models/alert/SummaryEventModel",["models/alert/SummaryAlertModel","data/DataURLConstants","utils/AppConstants"],function(e,t,i){"use strict";return e.extend({urlRoot:t.EVENT,name:"SummaryEventModel",entityType:i.ENTITY_EVENT,getURL:function(){return this.urlRoot+"?event_ids="+this.get(this.idAttribute)+"&detailed_info=true"}})}),define("managers/FullDetailsViewFactory",["utils/AppConstants"],function(e){"use strict";return{customViewFactory:null,setCustomViewFactory:function(e){this.customViewFactory=e},loadCustomDetailsViewContents:function(e,t){return!!this.customViewFactory&&this.customViewFactory.loadDetailsViewContents(e,t)},loadDetailsViewContents:function(t,i){if(this.loadCustomDetailsViewContents(t,i))return!0;switch(t){case e.ENTITY_CLUSTER:return require(["models/cluster/ClusterModel","views/basecomponents/pages/fulldetails/FullDetailsClusterTabView","views/basecomponents/pages/fulldetails/FullDetailsClusterActionBarView"],i),!0;case e.ENTITY_VM:return require(["models/vm/VMModel","views/basecomponents/pages/fulldetails/FullDetailsVMTabView","views/widgets/VMActionBarView"],i),!0;case e.ENTITY_CONTAINER:return require(["models/storage/ContainerModel","views/basecomponents/pages/fulldetails/FullDetailsGenericEntityTabView"],i),!0;case e.ENTITY_DISK:return require(["models/hardware/DiskModel","views/basecomponents/pages/fulldetails/FullDetailsGenericEntityTabView"],i),!0;case e.ENTITY_HOST:return require(["models/hardware/HostModel","views/basecomponents/pages/fulldetails/FullDetailsGenericEntityTabView"],i),!0;case e.ENTITY_GPU:return require(["models/gpu/GpuModel","views/basecomponents/pages/fulldetails/FullDetailsGenericEntityTabView"],i),!0;case e.ENTITY_ALERT:return require(["models/alert/SummaryAlertModel","views/pages/alerts/details/FullDetailsAlertTabView","views/basecomponents/pages/fulldetails/FullDetailsGenericActionBarView"],i),!0;case e.ENTITY_EVENT:return require(["models/alert/SummaryEventModel","views/pages/alerts/details/FullDetailsAlertTabView","views/basecomponents/pages/fulldetails/FullDetailsGenericActionBarView"],i),!0;default:return!1}}}}),define("models/cluster/MulticlusterConfigModel",["models/intent/IntentDynamicModel","data/DataURLConstants","data/DataProperties","utils/AppUtil","utils/AppConstants"],function(e,t,i,n,s){"use strict";var a={EXECUTION_PLAN:"execution_plan",SPEC_LIST:"spec_list",SEQUENTIAL:"SEQUENTIAL",PARALLEL:"PARALLEL",SOFTWARE_MAP:"software_map",SOFTWARE_TYPE:"software_type",NOS:"NOS",VERSION:"version",NETWORK:"network",CONFIG:"config",MULTICLUSTER_CONFIG:"multicluster_config",UPGRADE_SCHEDULE:"upgrade_schedule",SPEC_JSON:"spec_json"},r={DOWNLOADED:"DOWNLOADED"},o=["timezone","authorized_public_key_list","redundancy_factor","enabled_feature_list"],l=["external_ip","external_data_services_ip","external_subnet","internal_subnet"];return e.extend({urlRoot:t.MULTICLUSTER_CONFIG,entityType:s.ENTITY_CLUSTER,name:"MulticlusterConfigModel",specVersion:null,showError:!0,initializeBaseModel:function(t,i){this.schedule=null,this.plan=null,this.clusters=null,e.prototype.initializeBaseModel.apply(this,arguments)},getURL:function(t,i,n){return this.actionMode&&this.actionMode!==s.ACTION_DOWNLOAD?this.urlRoot+"/"+this.getId()+"/"+this.actionMode:this.getId()?this.urlRoot+"/"+this.getId():e.prototype.getURL.apply(this,arguments)},setActionMode:function(e){this.actionMode=e},setPlan:function(e){this.plan=e},setVersion:function(e){this.version=e},getVersion:function(){return this.version},setClusters:function(e){this.clusters=e},getClusters:function(){return this.clusters},setSchedule:function(e){this.schedule=e},setSpecVersion:function(e){this.specVersion=e},getClusterIntentInput:function(e){var t={};t[this.DP.PROPS.API_VERSION]=e.get(e.DP.PROPS.API_VERSION);var n=e.get(this.DP.PROPS.PROP_METADATA),o={};o[this.DP.PROPS.KIND]=n[e.DP.PROPS.KIND],o[this.DP.PROPS.PROP_UUID]=n[e.DP.PROPS.PROP_UUID],t[this.DP.PROPS.PROP_METADATA]=o;var l=this.constructClusterSpec(e);if(this.actionMode===s.ACTION_DOWNLOAD){l[i.INTENT_RESOURCES][a.CONFIG][a.SOFTWARE_MAP][a.NOS][e.DP.STATUS]=r.DOWNLOADED}return t[i.INTENT_SPEC]=l,t},constructClusterSpec:function(e){var t=e.get(e.DP.STATUS),i=t[e.DP.RESOURCES],n={};n[a.SOFTWARE_MAP]={},n[a.SOFTWARE_MAP][a.NOS]={},n[a.SOFTWARE_MAP][a.NOS][a.SOFTWARE_TYPE]=i[a.CONFIG][a.SOFTWARE_MAP][a.NOS][a.SOFTWARE_TYPE],n[a.SOFTWARE_MAP][a.NOS][a.VERSION]=this.version,_.each(o,function(e){var t=i[a.CONFIG][e];t&&(n[e]=t)});var s={},r=i[a.NETWORK];_.each(l,function(e){var t=r[e];t&&(s[e]=t)});var c={resources:{config:n,network:s}};return t[e.DP.NAME]&&(c[e.DP.NAME]=t[e.DP.NAME]),c},toJSON:function(){var e={};if(!this.action){var t=_.map(this.clusters,function(e){return this.getClusterIntentInput(e)},this),n={};n[a.EXECUTION_PLAN]=this.plan,n[a.SPEC_LIST]=t,this.actionMode!==s.ACTION_DOWNLOAD&&this.schedule&&(n[a.UPGRADE_SCHEDULE]=this.schedule),e[this.DP.PROPS.API_VERSION]="3.0";var r=e[this.DP.PROPS.PROP_METADATA]={};r[this.DP.PROPS.KIND]=a.MULTICLUSTER_CONFIG,e[this.DP.SPEC]={},e[this.DP.SPEC][this.DP.RESOURCES]=n;var o=Number(this.specVersion);isNaN(o)||(r[i.INTENT_SPEC_ATTR.VERSION]=o)}return e},getEntityName:function(e){var t=0,i=[];_.each(this.clusters,function(e){var n=e.get(e.DP.STATUS);n[e.DP.NAME]?i.push(n[e.DP.NAME]):t++});var a=i.join(", ");return t&&a?this.i18ns("clusterNamesWithUnknown",a,t,n.pluralizeEntity(s.ENTITY_CLUSTER,t)):a?this.i18ns("clusterNames",a):t+" "+n.pluralizeEntity(s.ENTITY_CLUSTER,t)},showSuccessNotification:function(e,t,i){var n="showSuccessEntitySave";this.schedule?n="showSuccessEntitySchedule":this.actionMode&&(n="showSuccessEntityAction");var a=void 0;a=this.actionMode?this.i18ns(n,this.i18n(this.actionMode)):this.i18ns(n,this.getEntityName(e)),this.getNotificationManager().showClientNotification(s.NOTIFY_SUCCESS,a),this.getTaskManager().fetchOnDemand()},performAction:function(e,t,i){this.setActionMode(e),t&&!_.isArray(t)&&(t=t.split(",")),t&&(this.setId(_.first(t)),this.isNew(!1),this.save(null,_.extend({type:"POST"},i||{})))}},{DP:a})}),define("models/playbook/PlaybookResultActionModel",["models/BaseModel","data/DataURLConstants","data/DataProperties","events/AppEvents","utils/AppConstants"],function(e,t,i,n,s){"use strict";return e.extend({urlRoot:t.PLAYBOOK_RESULT_ABORT,name:"PlaybookResultActionModel",entityType:s.ENTITY_PLAYBOOK_RESULT,isV3API:!0,showError:!0,parseOptions:function(i,n,a){return a=e.prototype.parseOptions.apply(this,arguments),n.actionMode===s.ACTION_ABORT?a.url=this.getDataSourceURL()+t.PLAYBOOK_RESULT_ABORT:n.actionMode===s.ACTION_RESUME&&(a.url=this.getDataSourceURL()+t.PLAYBOOK_RESULT_RESUME),a},showSuccessNotification:function(t,i,n,s){s&&e.prototype.showSuccessNotification.apply(this,arguments)},_checkTaskStatus:function(e){var t=$.Deferred();return this.getTaskManager().trackTaskStatus(e,{onTaskUpdate:function(e){var i=e.isTaskCompleted();return i?e.isStatusComplete()?(t.resolve(),i):(t.reject(e.getMessage()),i):i}}),t.promise()},performAction:function(e,t,a){var r=this,o=arguments,l=t.split(",");this.set(i.PLAYBOOK_RESULT_LIST,l,{silent:!0}),this.actionMode=e;var c=a.success;return a.success=function(e,t){r._checkTaskStatus(e.get(i.TASK_UUID_V3)).done(function(){r.showSuccessNotification(e,null,t,!0),n.triggerAppEvent(n.ENTITIES_UPDATED,{entityType:s.ENTITY_PLAYBOOK_RESULT,entityIds:l}),_.isFunction(c)&&c.apply(r,o)}).fail(function(t){r.hideLatencyNotification(e,null),r.getNotificationManager().showClientNotification(s.NOTIFY_ERROR,t,{temporary:!0})})},this.save(null,a)}})}),define("managers/CustomModelFactory",["data/DataURLConstants","models/alert/AlertActionModel","models/alert/PCAlertActionModel","models/task/TaskServiceModel","models/cluster/MulticlusterConfigModel","models/playbook/PlaybookResultActionModel","models/query/QueryResultCollection","utils/AppConstants","utils/ManagerMixin"],function(e,t,i,n,s,a,r,o,l){"use strict";return _.extend({},l,{getCustomModel:function(e){switch(e){case o.ENTITY_TASK:return n}},getCustomActionModel:function(e,n){return e!==o.ENTITY_ALERT||n!==o.ACTION_RESOLVE&&n!==o.ACTION_RESOLVE_ALL&&n!==o.ACTION_ACKNOWLEDGE&&n!==o.ACTION_ACKNOWLEDGE_ALL?e===o.ENTITY_PLAYBOOK_RESULT?a:e===o.ENTITY_MULTICLUSTER_CONFIG_SPEC?s:void 0:this.getClusterManager().isMulticlusterNavMode()?i:t},getCustomModelCollectionByURL:function(t){if(t===e.ENTITY_BROWSER_QUERY)return r}})}),define("managers/ExpressionFactory",["utils/FilterUtil","data/DataProperties","utils/AppConstants"],function(e,t,i){"use strict";var n,s={NOT_INCLUDE_CVM:"not_include_cvm",NOT_INCLUDE_AWS:"not_include_aws",NOT_INCLUDE_LOCAL_VMS:"not_include_local_vms",ONLY_INFRA_MARKETPLACE_ITEMS:"only_infra",EXCLUDE_DELETED_QOS_POLICIES:"active_qos",EXCLUDE_DELETED_NGT_POLICIES:"active_ngt",NGT_INSTALLED:"ngt_installed",NGT_SSR:"ngt_ssr",NO_DEFAULT_PROJECT:"no_def_project",NGT_VSS:"ngt_vss",NGT_SSRANDVSS:"ngt_ssrandvss",NGT_NOTINSTALLED:"ngt_notinstalled",ACP_ROLE_UUID:"acp_role_uuid",UUID_IN:"uuid_in",PROP_IN:"prop_in",DEFAULT_PROJECT:"def_project"},a=(n={},_defineProperty(n,s.NOT_INCLUDE_CVM,function(n){return e.addFilterCondition(n,t.EB.VM.IS_CVM,e.createFilterCondition(i.ENTITY_VM,t.EB.VM.IS_CVM,i.FILTER_OPERATORS.EQUALS,i.FILTER_NOT_INCLUDE_CVM))}),_defineProperty(n,s.ACP_ROLE_UUID,function(n,s){return e.addFilterCondition(n,t.EB.ACP.ROLE_UUID,e.createFilterCondition(i.ENTITY_ACP,t.EB.ACP.ROLE_UUID,i.FILTER_OPERATORS.EQUALS,s[0]))}),_defineProperty(n,s.UUID_IN,function(e,i){return a[s.PROP_IN](e,[t.UUID].concat(_toConsumableArray(i)))}),_defineProperty(n,s.PROP_IN,function(t,n){var s=n.shift();return e.addFilterCondition(t,s,e.createFilterCondition(null,s,i.FILTER_OPERATORS.IN,n))}),_defineProperty(n,s.NO_DEFAULT_PROJECT,function(n){return e.addFilterCondition(n,t.EB.PROJECT.IS_DEFAULT,e.createFilterCondition(i.ENTITY_PROJECT,t.EB.PROJECT.IS_DEFAULT,i.FILTER_OPERATORS.EQUALS,!1))}),_defineProperty(n,s.DEFAULT_PROJECT,function(n){return e.addFilterCondition(n,t.EB.PROJECT.IS_DEFAULT,e.createFilterCondition(i.ENTITY_PROJECT,t.EB.PROJECT.IS_DEFAULT,i.FILTER_OPERATORS.EQUALS,!0))}),_defineProperty(n,s.NOT_INCLUDE_LOCAL_VMS,function(n){return e.addFilterCondition(n,t.EB.VM.ZONE_TYPE,e.createFilterCondition(i.ENTITY_VM,t.EB.VM.ZONE_TYPE,i.FILTER_OPERATORS.NOT_EQUALS,i.ZONE_TYPE.LOCAL))}),_defineProperty(n,s.NOT_INCLUDE_AWS,function(n){var s=n||{};return e.addFilterCondition(s,t.EB.VM.PLATFORM_TYPE,e.createFilterCondition(t.EB.VM.PLATFORM_TYPE,i.ENTITY_VM,i.FILTER_OPERATORS.NOT_EQUALS,i.VM_PLATFORM_TYPES.AWS)),e.addFilterCondition(s,t.EB.VM.PLATFORM_TYPE,e.createFilterCondition(t.EB.VM.PLATFORM_TYPE,i.ENTITY_VM,i.FILTER_OPERATORS.EQUALS,i.FILTER_NULL_VALUE)),s}),_defineProperty(n,s.ONLY_INFRA_MARKETPLACE_ITEMS,function(n){return e.addFilterCondition(n,t.EB.MARKETPLACE_ITEM.TYPES,e.createFilterCondition(i.ENTITY_MARKETPLACE_ITEM,t.EB.MARKETPLACE_ITEM.TYPES,i.FILTER_OPERATORS.CONTAINS_EXACT,i.FILTER_ONLY_INFRA_MARKETPLACE_ITEMS))}),_defineProperty(n,s.EXCLUDE_DELETED_QOS_POLICIES,function(n){return e.addFilterCondition(n,t.EB.QOS_POLICY.MARK_FOR_REMOVAL,e.createFilterCondition(i.ENTITY_QOS_POLICY,t.EB.QOS_POLICY.MARK_FOR_REMOVAL,i.FILTER_OPERATORS.NOT_EQUALS,!0))}),_defineProperty(n,s.EXCLUDE_DELETED_NGT_POLICIES,function(n){var s=n||{};return e.addFilterCondition(s,t.EB.NGT.MARK_FOR_REMOVAL,e.createFilterCondition(t.EB.NGT.MARK_FOR_REMOVAL,i.ENTITY_NGT_POLICY,i.FILTER_OPERATORS.EQUALS,!1)),e.addFilterCondition(s,t.EB.NGT.MARK_FOR_REMOVAL,e.createFilterCondition(t.EB.NGT.MARK_FOR_REMOVAL,i.ENTITY_NGT_POLICY,i.FILTER_OPERATORS.EQUALS,i.FILTER_NULL_VALUE)),s}),_defineProperty(n,s.NGT_INSTALLED,function(t){return e.addFilterCondition(t,i.NGT.STATUS.INSTALLEDVERSION,e.createFilterCondition(i.ENTITY_VM,i.NGT.STATUS.INSTALLEDVERSION,i.FILTER_OPERATORS.NOT_EQUALS,i.FILTER_NULL_VALUE))}),_defineProperty(n,s.NGT_SSR,function(t){return e.addFilterCondition(t,i.NGT.APPLICATIONS.ENABLEDAPP,e.createFilterCondition(i.ENTITY_VM,i.NGT.APPLICATIONS.ENABLEDAPP,i.FILTER_OPERATORS.EQUALS,i.NGT.APPLICATIONS.SSR))}),_defineProperty(n,s.NGT_VSS,function(t){return e.addFilterCondition(t,i.NGT.APPLICATIONS.ENABLEDAPP,e.createFilterCondition(i.ENTITY_VM,i.NGT.APPLICATIONS.ENABLEDAPP,i.FILTER_OPERATORS.EQUALS,i.NGT.APPLICATIONS.VSS))}),_defineProperty(n,s.NGT_SSRANDVSS,function(t){var n=t||{};return e.addFilterCondition(n,i.NGT.APPLICATIONS.ENABLEDAPP,e.createFilterCondition(i.ENTITY_VM,i.NGT.APPLICATIONS.ENABLEDAPP,i.FILTER_OPERATORS.CONTAINS_V3,i.NGT.APPLICATIONS.VSS)),
e.addFilterCondition(n,i.NGT.APPLICATIONS.ENABLEDAPP,e.createFilterCondition(i.ENTITY_VM,i.NGT.APPLICATIONS.ENABLEDAPP,i.FILTER_OPERATORS.CONTAINS_V3,i.NGT.APPLICATIONS.SSR)),n}),_defineProperty(n,s.NGT_NOTINSTALLED,function(t){return e.addFilterCondition(t,i.NGT.STATUS.INSTALLEDVERSION,e.createFilterCondition(i.ENTITY_VM,i.NGT.STATUS.INSTALLEDVERSION,i.FILTER_OPERATORS.EQUALS,i.FILTER_NULL_VALUE))}),n),r=_defineProperty({},s.NGT_SSRANDVSS,_defineProperty({},i.NGT.APPLICATIONS.ENABLEDAPP,e.FIQL_AND_OPERATOR));return _.extend({FILTERS:s,FILTER_SEP:"::filter::",ARGS_SEP:"|",getFilterExpression:function(t,i,n){var s=this.getFilterArgsInfo(t),r=void 0;_.isObject(s)&&(t=s.filterName,r=s.args);var o=a[t];if(_.isFunction(o)){var l=o(n,r);return i?e.filterExpressionToFIQL(l,this.getAttributeJoinOperators(t)):l}},removeFilterName:function(e){e=e||"";var t=e.split(this.FILTER_SEP);return t&&t.length>0?t[0]:e},getFilterArgsInfo:function(e){if(_.isString(e)){var t=e.split(this.FILTER_SEP);_.isString(t[1])&&(e=t[1]);var i=e.split(this.ARGS_SEP);if(_.isArray(i))return e=i[0],i.shift(),{filterName:e,args:_.compact(i)}}},getFilterName:function(e){e=e||"";var t=e.split(this.FILTER_SEP);if(t&&2===t.length)return t[1]},getAttributeJoinOperators:function(e){return r[e]||{}},addFilterInfo:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=e;return _.isArray(t.args)&&(i+=this.ARGS_SEP+t.args.join(this.ARGS_SEP)),i},getEntityTypeFilter:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return e+this.FILTER_SEP+this.addFilterInfo(t,i)}},{FILTERS:s,FILTER_EXPRESSIONS:a})}),define("views/basecomponents/form/BaseFormControlView",["views/basecomponents/BaseView","utils/AppConstants","managers/IntentManager"],function(e,t,i){"use strict";return e.extend({_baseClassName:"form-group full",_entityType:null,eventBus:null,errorComponentSelector:null,initialize:function(t){e.prototype.initialize.apply(this,arguments),this.$el.data("ViewClass",this),this.eventBus=t.eventBus,this.actionRoute=t.actionRoute,this.$el.addClass(this._baseClassName),this.className&&this.$el.addClass(this.className),this.enableComponentForError()},render:function(e,t,i){throw new Error("Create subclass for this. Do not use directly.")},validate:function(){return[]},getEntityReferenceDefinition:function(e){var t=e.definition;return t&&t.$ref?i.getEntityDefinition(t.$ref):null},getDataObject:function(){return this.options?this.options.dataObject:null},getDataEntityObject:function(){var e=this.getDataObject();if(e){var t=e.entity;if(t)return i.getIntentModelProperties(t)}return null},setFormControlWithData:function(e){},getAttributeKey:function(){return this.$("[model-attribute]").attr("model-attribute")},getValue:function(){return this.$("[model-attribute]").val()},isValueProcessedInView:function(){var e=require("utils/FormRendererUtil"),t=this.$el.attr(e.DP.TMPL_ATTRS.SET_GET_DATA_VALUE);return t&&"true"===t},isFeatureEnabled:function(e){return require("utils/FormRendererUtil").isFeatureEnabled(this.$el,e)},isEnabled:function(){return this.$el.is(":visible")},isUpdate:function(){return this.options&&this.options.actionRoute&&this.options.actionRoute.action===t.ACTION_UPDATE},enableComponentForError:function(){this.errorComponentSelector&&setTimeout(function(){this.$(this.errorComponentSelector).addClass("error-applicable")}.bind(this),100)},removeError:function(){this.errorComponentSelector&&this.$(this.errorComponentSelector).removeClass("form-control-error")}})}),define("views/intent/components/BasicFormControlView",["views/basecomponents/form/BaseFormControlView"],function(e){"use strict";var t=_.template('<label class="form-control-label">  \n  <span underscorescript="i18n(\'<%= entityType +"."+ basicAttribute %>\', \'<%= attribute %>\')"> \n    <%= i18n(entityType + "." + basicAttribute, attribute) %> \n   </span> \n</label> \n<input class="form-control" type="text" \n   model-attribute="<%= attribute %>" \n   value="<%= value %>">\n');return e.extend({render:function(e,i){var n=t(this.vtOptions({value:i||"",entityType:e.entityType,attribute:e.attribute,basicAttribute:e.basicAttribute}));return this.$el.html(n),this.el}})}),define("utils/FormRendererUtil",["views/intent/components/BasicFormControlView","models/intent/IntentDynamicModel","data/DataProperties"],function(e,t,i){"use strict";var n={TMPL_ATTRS:{META_POPUP_TITLE:"ntnx-ui-meta-popup-title",META_PAGE_POPUP:"ntnx-ui-meta-page-popup",META_HIDE_SAVE:"ntnx-ui-meta-hide-save",META_HIDE_CANCEL:"ntnx-ui-meta-hide-cancel",META_MAIN_CLASS:"ntnx-ui-meta-main-class",META_SAVE_TEXT:"ntnx-ui-meta-save-text",META_PREVENT_DEFAULT_SAVE:"ntnx-ui-meta-prevent-default-save",VIEW_FORM:"ntnx-ui-view-form",VIEW_FORM_CONTROL:"ntnx-ui-view-form-control",VIEW_ATTRIBUTE:i.VIEW_ATTRIBUTE,VIEW_DATA_LIST:"ntnx-ui-data-list",VIEW_DATA_SUBLIST:"ntnx-ui-data-sublist",FETCH_DEFINITION:"ntnx-ui-fetch-defintion",INTENT_MODEL:"ntnx-ui-model",CUSTOM_FETCH_DEFINITION:"ntnx-ui-custom-fetch-definition",SET_GET_DATA_VALUE:"ntnx-ui-set-get-data-value",TRIGGER_EVENT:"ntnx-trigger-event",LISTENER_EVENT:"ntnx-listener-event",PARTIAL_UPDATE:"ntnx-partial-update",META_HIDE_SAVE_ACTION:"ntnx-ui-meta-hide-save-action",HAS_ACCESS:"ntnx-has-access",ENV:"ntnx-env",ACP:"ntnx-acp",ENABLE_FEATURE_LIST:"ntnx-enable-feature-list",DISABLE_AUTO_HEIGHT_UPDATE:"ntnx-disable-auto-height-update"}},s=_.template('<div class="spinner-wrapper">\n      <div class="donut-loader-blue"><div class="loader-head"></div></div>\n      <%= caption %></div>');return{DP:n,customFormFactory:null,setCustomFormFactory:function(e){this.customFormFactory=e},getFormView:function(e,t){var i;return this.customFormFactory&&(i=this.customFormFactory.getFormView(e,t),t&&t.parentViewName&&(i.name=t.parentViewName),i.render()),i},getIntentModel:function(e){var i;return this.customFormFactory&&(i=this.customFormFactory.getIntentModel(e)),i||(i=new t),i},getTemplateAttributes:function(e){var t={};return _.each(this.DP.TMPL_ATTRS,function(i,n){var s=e.attr(i);s&&(s.indexOf(",")>=0&&(s=s.split(",")),t[i]=s)},this),t},isFeatureEnabled:function(e,t){var i=this.getTemplateAttributes(e),n=i[this.DP.TMPL_ATTRS.ENABLE_FEATURE_LIST];return n=_.isArray(n)?n:[n],_.isArray(n)&&_.indexOf(n,t)>=0},isTemplateAttributeFlagOn:function(e,t){var i=this.getTemplateAttributes(e),s=n.TMPL_ATTRS[t];return!!(s&&i[s]&&_.isString(i[s])&&"true"===i[s].toLowerCase())},getFormControlView:function(t,i){var n;return this.customFormFactory&&(n=this.customFormFactory.getFormControlView(t,i)),n||(n=new e(i)),n.name=i.parentViewName,n.render(t),n},disableSaveButton:function(e,t,i){this.disableSaveButtonInContainer(e.closest(t))},disableSaveButtonInContainer:function(e,t){var i=e.find(".btnSave");i.addClass("events-allowed disabled addTooltip"),i.tooltip("destroy"),i.tooltip({title:t,placement:"top",trigger:"hover",html:!0})},enableSaveButton:function(e,t){var i=e.closest(t).find(".btnSave");i.removeClass("events-allowed disabled addTooltip"),i.tooltip("destroy")},showButtons:function(e,t){t&&t.length&&t.addClass("hidden"),e.removeClass("hidden")},disableForm:function(e){this.enableForm(e),e.addClass("form-disabled"),e.find("*").on("click mousemove mouseup keydown keyup",this.onDisabledFormEvent)},showSpinner:function(e,t){e.append(s({caption:t}))},onDisabledFormEvent:function(e){e.preventDefault(),e.stopPropagation()},enableForm:function(e){e.find(".form-disabled").removeClass("form-disabled"),e.removeClass("form-disabled"),e.find("*").off("click mousemove mouseup keydown keyup",this.onDisabledFormEvent)}}}),define("views/basecomponents/form/BaseFormView",["views/basecomponents/BaseView","managers/IntentManager","utils/FormRendererUtil"],function(e,t,i){"use strict";return e.extend({_entityType:null,eventBus:null,templateConfig:null,intentElView:null,initialize:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(e.prototype.initialize.apply(this,arguments),this.eventBus=t.eventBus,this.templateConfig=t.templateConfig,_.isObject(t.intentElView)&&this.registerIntentPopupView(t.intentElView),this.getPopupTitle()){var i=this.getPopupTitle(),n=this.getPopupEl();n&&n.find(".modal-header > .n-title").html(i)}},render:function(e,t,i){throw new Error("Create subclass for this. Do not use directly.")},getIntentMetaAttributes:function(){var e={};return _.each(i.DP.TMPL_ATTRS,function(t,i){var n=this.$el.attr(t);n&&(e[i]=n)},this),e},registerIntentPopupView:function(e){e&&(this.intentElView=e,this.intentElView.registerPopup())},showErrorMessage:function(){this.intentElView&&this.intentElView.showErrorMessage&&this.intentElView.showErrorMessage.apply(this,arguments)},getDataObject:function(){return this.options?this.options.dataObject:null},getDataEntity:function(){var e=this.getDataObject();return e&&e.entity?e.entity:null},getDataEntityList:function(e){var i=[],n=this.getDataObject();if(n){var s=n[e];s&&_.each(s.entities,function(e){i.push(t.getIntentModelProperties(e))})}return i},getIntentModel:function(){return this.options&&this.options.intentModel?this.options.intentModel:null},getFormControlInstance:function(e){return this.$(e).data("ViewClass")},validate:function(){return[]},saveForm:function(){return null},getPopupTitle:function(){return null},getPopupEl:function(){return this.options.popupEl.length?this.options.popupEl:null}})}),define("views/intent/components/custom/form/SectionNavigatorView",["views/basecomponents/BaseView","utils/AppConstants","utils/FormRendererUtil"],function(e,t,i){"use strict";var n=_.template('<div id="sectionNav" class="traffic-light"><div id="navDots" class="nav-dots nav-list"><ul id="listSectionDots" class="lights"><% _.each(sections, function(section, index) { %><% if (section.title) { %><li class="light<% if (index === 0) { %> active<% } %>" data-section="<%=section.id%>" <% if (section.access) { %>ntnx-has-access="<%=section.access%>"<% } %>></li><%  } %><% }); %></ul></div><div id="navSections" class="nav-section nav-list"><ul id="listSectionTitle" class="item-list"><% _.each(sections, function(section, index) { %><% if (section.title) { %><li class="item<% if (index === 0) { %> active<% } %>"data-section="<%=section.id%>" <% if (section.access) { %>ntnx-has-access="<%=section.access%>"<% } %>><%= section.title %></li><%  } %><% }); %></ul></div></div>');return e.extend({className:"section-navigator-container",currentSection:null,scrollerOffset:0,enableScrolling:!0,events:{"click  #navSections li":"onClickFormSectionNav"},render:function(e){return this.scrollerOffset=e[0].el.position().top,this.$el.html(n({sections:e})),this},jumpToSection:function(e){var t=e.attr("data-section");if(this.toggleTrafficLight(t),t&&_.isFunction(this.options.jumpTo)){var i="#"+t;this.options.jumpTo(i,this.$('[data-section="'+t+'"]').index()+1)}},setLongDistanceScrolling:function(e){var t=$(e.find(".form-section")),i=$(e.find(".n-modal-content-wrapper")),n=$(e.find(".n-modal-content")),s=t.first().position().top,a=t.last().position().top,r=i.height(),o=n.outerHeight(),l=this._getContentOffset(i.scrollTop(),s),c=a-s+l,u=r-o,d=c+u,h=this._isScrollAtBottom(i,n);n.css("margin-bottom",d+"px"),h&&i.scrollTop(c)},_getContentOffset:function(e,t){return e+t-this.scrollerOffset},_isScrollAtBottom:function(e,t){return e.height()+e.scrollTop()===t.outerHeight()+parseInt(t.css("margin-bottom"))},toggleTrafficLight:function(e){if(this.$(".nav-list li").removeClass("active"),e){this.$('[data-section="'+e+'"]').addClass("active")}else this.$(".nav-list li:first-child").addClass("active")},showError:function(e){if(e){this.$('[data-section="'+e+'"]').addClass("error")}},removeError:function(e){if(e){this.$('[data-section="'+e+'"]').removeClass("error")}},clearAllErrors:function(){this.$(".nav-list li").removeClass("error")},runErrorHandler:function(e,n){e&&(this.clearAllErrors(),_.each(n,function(n){var s=e.find("["+t.FORM_SELECTORS.DATA_MODEL_ATTR+'="'+n.attr+'"]');if(s&&s.length){var a=s.attr(t.FORM_SELECTORS.FORM_SECTION_ID);this.showError(a)}var r=e.find("["+i.DP.TMPL_ATTRS.VIEW_ATTRIBUTE+'="'+n.attr+'"]');if(r&&r.length){var o=r.attr(t.FORM_SELECTORS.FORM_SECTION_ID);this.showError(o)}},this))},onResize:function(e){this.setLongDistanceScrolling(e)},onScrollWindow:function(e){if(this.enableScrolling){var t="",i=this;e.find(".form-section:not(.-secondary)").each(function(){var e=$(this).attr("id");i._isScrolledIntoView($(this))&&(t=e)}),this.toggleTrafficLight(t)}},_isScrolledIntoView:function(e){return e.position().top<=0+this.scrollerOffset},onClickFormSectionNav:function(e){var t=$(e.currentTarget);this.jumpToSection(t)}})}),define("views/intent/components/custom/form/util/SectionsMixin",["views/intent/components/custom/form/SectionNavigatorView","utils/AppConstants"],function(e,t){"use strict";var i=_.template('<div class="header-section"><% if (isOptional) { %><input type="checkbox" class="checkboxOptional"><% } %><% if (title) { %><h5 data-ntnx-title><%= title %></h5><% } %><% if (description) { %><section data-ntnx-section="type-subtitle"><%= description %></section><% } %></div>');return{initSectionNavigator:function(){_.bindAll(this,"onScrollWindow","onResize","jumpTo");var t=this.getPopupEl(),i=null;t&&(i=t.find(this.scrollWrapperEl))&&i.on("scroll",this.onScrollWindow),$(window).on("resize",this.onResize),this.sectionNavigator=new e({jumpTo:this.jumpTo})},destroySectionNavigator:function(){var e=this.getPopupEl();if(e){e.find(this.scrollWrapperEl).off("scroll",this.onScrollWindow)}$(window).off("resize",this.onResize),this.sectionNavigator.destroy()},onResize:function(){if(this.sectionNavigator){var e=this.getPopupEl();e&&this.sectionNavigator.onResize(e)}},jumpTo:function(e,t){var i=this,n=1===t;this.sectionNavigator.enableScrolling=!1,this.scrollToElement(this.$(e),this.scrollWrapperEl,{offset:this.sectionNavigator.scrollerOffset,scrollToTop:n,callback:function(){setTimeout(function(){i.sectionNavigator.enableScrolling=!0},0)}})},onScrollWindow:function(){this.sectionNavigator.onScrollWindow($(this.el))},areSectionsAvailable:function(e){e=e||this.$el;var t=e.find(".form-section");return t&&t.length>1},setupFormSections:function(e){e=e||this.$el;var t=e.find(".form-section"),n=[];return e.addClass("form-section-container"),_.each(t,function(e){var t={};if(t.el=$(e),t.id=t.el.attr("id"),t.title=t.el.attr("title")||"",t.description=t.el.attr("description")||"",t.isOptional=t.el.attr("ntnx-optional"),t.access=t.el.attr("ntnx-has-access"),(t.title||t.description)&&t.el.prepend(i({isOptional:t.isOptional,title:t.title,description:t.description})),t.title||t.el.addClass("-secondary"),t.title&&t.el.removeAttr("title"),t.isOptional){var s=t.el.attr("ntnx-optional-default-show"),a="true"===s;this.updateSectionVisibility(t.id,a)}n.push(t)},this),n},updateSectionVisibility:function(e,i){var n=this.$('.form-section[id="'+e+'"]'),s=n.find(".checkboxOptional"),a=n.find(".form-group");s.is(":checked")||i?(s.prop("checked",!0),a.show(),a.find("[model-attribute]").removeAttr(t.FORM_SELECTORS.DATA_MODEL_ATTR_NOT)):(s.prop("checked",!1),a.hide(),a.find("[model-attribute]").attr(t.FORM_SELECTORS.DATA_MODEL_ATTR_NOT,!0))}}}),define("views/intent/components/custom/form/PageFormFooterView",["views/basecomponents/BaseView","utils/AppUtil","managers/AccessManager"],function(e,t,i){"use strict";var n=_.template('<button class="<%= classes ? classes : "" %>" data-loading-text="<%= dataLoadingText ? dataLoadingText : "" %>"><%= label ? label : "" %></button>'),s=_.template('<div class="btn-wrapper"><%= content %></div>'),a=_.template('<div class="spinner-wrapper">\n      <div class="donut-loader-blue"><div class="loader-head"></div></div>\n      <%= caption %></div>');return e.extend({name:"PageFormFooterView",className:"n-modal-footer",isRendered:null,options:null,events:{},initialize:function(t){e.prototype.initialize.apply(this,arguments),t&&_.isObject(t)&&(this.options=t,this.setEvents()),this.render()},destroy:function(){this.isRendered&&this.unsetAllOnClickEvents(),e.prototype.destroy.apply(this,arguments),$(this.el).remove()},render:function(){return this.$el.html(this.renderTmpl()),this.setAllOnClickEvents(),this.isRendered=!0,i.hasAccessToSubmitActions()||this.$el.addClass("hidden"),this},renderTmpl:function(){var e=this.options||{},t=e.templateConfig||{},i=t.saveText,a=t.hideCancel,r=t.hideSaveAction,o=[];a||o.push({label:this.i18n("cancel"),classes:"btnCancel btn"}),r||o.push({label:i||this.i18n("save"),classes:"btnSave btn",dataLoadingText:this.i18n("saving")});var l={classes:"full-page",addDivider:!0,buttons:o},c=$.extend(l,e),u="",d="";return c&&c.classes&&this.$el.addClass(c.classes),c&&c.addDivider&&(u+='<div class="content-divider -footer"></div>'),_.each(c.buttons,function(e){d+=n({label:e.label,classes:e.classes,dataLoadingText:e.dataLoadingText})}),u+=s({content:d})},showSpinner:function(e){this.$(".btn-wrapper").addClass("hidden"),this.$(".spinner-wrapper").remove(),this.$(".btn-wrapper").after(a({caption:e}))},hideSpinner:function(){this.$(".spinner-wrapper").remove(),this.$(".btn-wrapper").removeClass("hidden")},setOnClickEvent:function(e,t){this.$(e).on("click",t)},setAllOnClickEvents:function(){_.each(this.events,function(e,t){this.setOnClickEvent(t,e)},this)},unsetOnClickEvent:function(e){this.$(e).off("click")},unsetAllOnClickEvents:function(){_.each(this.events,function(e,t){this.unsetOnClickEvent(t)},this)},setEvents:function(){this.options&&_.isObject(this.options)&&this.options.buttons&&_.isObject(this.options.buttons)&&this.options.buttons.length&&_.map(this.options.buttons,function(e){if(e.onClick&&e.classes){var i=t.convertClassesToSelector(e.classes);this.events[i]=e.onClick}},this)},setButtonCaption:function(e,t){this.$(e).html(t)},enableButton:function(e){this.$(e).removeClass("disabled")},disableButton:function(e){this.$(e).addClass("disabled")},hideButton:function(e){this.$(e).addClass("hidden")},hideAll:function(){this.hideButton("button")},showButton:function(e){this.$(e).removeClass("hidden")},enableSave:function(){this.enableButton(".btnSave")},disableSave:function(){this.disableButton(".btnSave")},enableNext:function(){this.enableButton(".nextButton")},disableNext:function(){this.disableButton(".nextButton")},showSave:function(){this.showButton(".btnSave")},hideSave:function(){this.hideButton(".btnSave")},enableAll:function(){this.enableButton("button")},disableAll:function(){this.disableButton("button")}})}),define("views/intent/components/custom/form/SectionFormView",["views/basecomponents/form/BaseFormView","views/intent/components/custom/form/util/SectionsMixin","views/intent/components/custom/form/PageFormFooterView","utils/FormRendererUtil"],function(e,t,i,n){"use strict";var s=_.template('<div class="n-modal-alert-header -inner"></div>');return e.extend(_.extend({},t,{name:"SectionFormView",currentSection:null,formHeight:0,scrollWrapperEl:".n-modal-content-wrapper",sectionNavigator:null,events:{"click  .checkboxOptional":"onChangeCheckboxOptional","click  *":"onClickForm","remove-error-style":"onRemoveErrorStyle"},initialize:function(t){e.prototype.initialize.apply(this,arguments);var n=this.$el.parents("#popupDynamicPopup.full-page-popup");n&&n.length&&n.find(".n-modal-footer").remove();var s=t.footer||{};s.templateConfig=this.templateConfig||{},this.formFooter=new i(s),this.getPopupEl().find(".n-modal-alert-header").remove(),!this.sectionNavigator&&this.areSectionsAvailable()&&this.initSectionNavigator()},render:function(){this.renderAlertHeader();var e=this.setupFormSections();if(this.sectionNavigator){var t=this.getPopupEl();if(t){var i=t.find(this.scrollWrapperEl);$(this.sectionNavigator.render(e).el).insertBefore(i)}}return this.applyNutanixInput(),this.renderFooter(),this},renderFooter:function(){this.$el.append(this.formFooter.render().el)},renderAlertHeader:function(){this.$el.parents(".intent-dynamic-popup").find(".n-modal-alert-header").length||this.$el.before(s())},postRender:function(){var e=this.getPopupEl();e&&this.sectionNavigator&&this.setLongDistanceScrolling(e)},setLongDistanceScrolling:function(e){n.isTemplateAttributeFlagOn(this.$el,"DISABLE_AUTO_HEIGHT_UPDATE")||this.sectionNavigator.setLongDistanceScrolling(e)},destroy:function(){this.sectionNavigator&&this.destroySectionNavigator(),this.formFooter&&this.formFooter.destroy(),e.prototype.destroy.apply(this,arguments)},enableFormSave:function(){this.formFooter.enableSave()},disableFormSave:function(){this.formFooter.disableSave()},onRemoveErrorStyle:function(e,t){var i=$(t).attr("form-section-id");!this.$(".form-control-error[form-section-id="+i+"]").length&&this.sectionNavigator&&this.sectionNavigator.removeError(i)},onClickForm:function(){if(this.sectionNavigator){var e=this.$el.height();if(this.formHeight!==e){var t=this.options.popupEl;this.formHeight=e,this.setLongDistanceScrolling(t)}}},onChangeCheckboxOptional:function(e){var t=$(e.currentTarget),i=t.closest(".form-section"),n=i.attr("id");this.updateSectionVisibility(n)}}))}),define("views/intent/components/custom/form/WizardFormView",["views/basecomponents/form/BaseFormView","utils/AppConstants","utils/FormRendererUtil","views/intent/components/custom/form/util/SectionsMixin","views/intent/components/custom/form/PageFormFooterView"],function(e,t,i,n,s){"use strict";var a=_.template('<div class="n-modal-alert-header -inner"></div>'),r=_.template('<section data-ntnx-section><ul data-ntnx-steps class="tabList"></ul></section>'),o=_.template("<li><%= tabName %></li>");return e.extend(_.extend({},n,{currentTabIndex:0,currentTabId:null,hasFormPanels:null,isFullPageForm:null,formFooter:null,scrollWrapperEl:".n-modal-content-wrapper",sectionNavigator:null,formSections:null,events:{},initialize:function(i){e.prototype.initialize.apply(this,arguments),this.isFullPageForm=this.getIntentMetaAttributes().META_PAGE_POPUP===t.BOOLEAN_TRUE;var n=this.getPopupEl();n&&(n.find(".n-modal-footer").remove(),n.find(".n-modal-alert-header").remove()),this.hasFormPanels=!1,this.formSections={},this.setupSections()},render:function(e){this.renderAlertHeader();var t=this.$(".wizard-section");this.appendTabTitles(t),this.selectCurrentTab();var i=this.getCurrentWizardSection();if($(t).hide(),i.show(),this.appendWizardFooter(t.length),this.getPopupEl().find(".n-modal-alert-header").length||$(a()).insertAfter(".tabList + .content-divider"),this.hasFormPanels){this.$el.addClass("form-panels");var n=this.$el.parents();n&&n.length&&$(n[0]).addClass("full-width")}return this.renderSectionNavigator(),this.postRender(),this},renderAlertHeader:function(){this.$el.parents(".intent-dynamic-popup").find(".n-modal-alert-header").length||this.$el.before(a())},destroy:function(){this.formFooter&&this.formFooter.destroy(),this.sectionNavigator&&this.destroySectionNavigator(),this.formSections=null,e.prototype.destroy.apply(this,arguments)},renderSectionNavigator:function(){var e=this.getPopupEl(),t=this.formSections[this.currentTabIndex];if(this.sectionNavigator&&t&&e){this.sectionNavigator.delegateEvents();var i=e.find(this.scrollWrapperEl);i&&$(this.sectionNavigator.render(t).el).insertBefore(i),this.sectionNavigator.setLongDistanceScrolling(e)}},setupSections:function(){var e=this.$(".wizard-section"),t=!1;_.each(e,function(e,i){var n=$(e);if(this.areSectionsAvailable(n)){t=!0;var s=this.setupFormSections(n);this.formSections[i]=s}},this),t&&this.initSectionNavigator()},preTabChange:function(){return this._removePreviousSectionNavigator(),!0},postRender:function(){this.eventBus&&this.eventBus.trigger(t.SSP_EVENTS.FILTER_ELEMENTS_BY_ACCESS)},goToNextPage:function(){this.preTabChange()&&(this.currentTabIndex=this.currentTabIndex+1,this.setCurrentTabId(),this.render())},goToPreviousPage:function(){this.preTabChange(),this.currentTabIndex=this.currentTabIndex-1,this.setCurrentTabId(),this.render()},onClickNext:function(){this.goToNextPage()},onClickPrev:function(){this.goToPreviousPage()},enableNextButton:function(){this.formFooter.enableNext()},disableNextButton:function(){this.formFooter.disableNext()},enableSaveButton:function(){this.formFooter.enableSave()},disableSaveButton:function(){this.formFooter.disableSave()},selectCurrentTab:function(){var e=this.$("[data-ntnx-steps] li"),t=e.eq(this.currentTabIndex);e.removeClass("active complete"),t.addClass("active").prevAll().addClass("complete"),this.setCurrentTabId()},setCurrentTabId:function(){var e=this.$(".wizard-section"),t=e[this.currentTabIndex];this.currentTabId=$(t).attr("id")},getCurrentWizardSection:function(){var e=this.$(".wizard-section");return $(e[this.currentTabIndex])},appendTabTitles:function(e){e.length&&!this.$(".tabList li").length&&(0===this.$(".tabList").length&&this.$el.prepend(this.getWizardHeader()),this.$(".tabList").empty(),_.each(e,function(e,t){var i=$(e),n=i.attr("title");if(n){var s=o({tabName:n});this.$(".tabList").append(s)}i.hide(),i.removeAttr("title")},this))},getWizardHeader:function(){return r()},appendWizardFooter:function(e){var t=this.getWizardFooterEl(),i=this.getWizardFooterVariation();if(1===e&&t)return void this.renderNavigationButtons(t,i);var n={};if(this.currentTabIndex>0&&this.currentTabIndex<e-1&&(n={buttons:[{label:this.i18n("back"),classes:"btn prevButton",onClick:this.onClickPrev.bind(this)},{label:this.i18n("next"),classes:"btn btn-primary nextButton",onClick:this.onClickNext.bind(this)}]}),0===this.currentTabIndex&&(n=this.isCancelValid()?{buttons:[{label:this.i18n("cancel"),classes:"btn btnCancel"},{label:this.i18n("next"),classes:"btn btn-primary nextButton",onClick:this.onClickNext.bind(this)}]}:{buttons:[{label:this.i18n("next"),classes:"btn btn-primary nextButton",onClick:this.onClickNext.bind(this)}]}),this.currentTabIndex===e-1&&(n={buttons:[{label:this.i18n("previous"),classes:"btn prevButton",onClick:this.onClickPrev.bind(this)},{label:this.getFormSaveButtonAlternativeText()||this.i18n("save"),classes:"btn btn-primary btnSave",dataLoadingText:this.i18n("saving")}]}),n&&t){var s=_.extend(n,i);this.renderNavigationButtons(t,s)}},getFormSaveButtonAlternativeText:function(){return i.getTemplateAttributes(this.$el)[i.DP.TMPL_ATTRS.META_SAVE_TEXT]||null},getWizardFooterEl:function(){var e=null,t=this.getPopupEl();return this.hasFormPanels?e=this.$el.find(".left-panel"):this.isFullPageForm?e=this.$el:t&&(e=t.find(".n-modal-wrapper")),e},getWizardFooterVariation:function(){var e={};return this.isFullPageForm||(e={classes:"",addDivider:!1}),e},isCancelValid:function(){return!0},addLoader:function(){var e=this.$(".wizard-section"),t=e[this.currentTabIndex];$(t).prepend('<div class="loader"><span class="donut-loader-blue"></span><span class="msg"> Loading...</span></div>')},removeLoader:function(){this.$(".loader").remove()},renderNavigationButtons:function(e,t){this.formFooter&&this.formFooter.destroy(),this.formFooter=new s(t),e.append(this.formFooter.el)},_removePreviousSectionNavigator:function(){this.getPopupEl().find(".section-navigator-container").length&&(this.sectionNavigator.undelegateEvents(),this.getPopupEl().find(".section-navigator-container").remove())}}))}),define("views/intent/components/custom/form/ListFormView",["views/basecomponents/form/BaseFormView","utils/AppUtil","events/AppEvents","utils/AppConstants","managers/IntentManager"],function(e,t,i,n,s){"use strict";var a=_.template('<button class="btnBack btn form-list-btn-back"><i data-icon="x" aria-hidden="true"></i> Back</button>'),r=_.template('<div id="sectionHeader" class="section section-header"><button id="newEntity" class="btnCreate btn"><i data-icon="H" aria-hidden="true"></i> <%= title %></button></div>');return e.extend({MODE:{LIST:"list",FORM:"form"},currentMode:null,sectionHeaderEl:null,sectionListEl:null,sectionFormEl:null,modalFooterEl:null,btnBackEl:null,events:{"click  .linkItem":"onClickLinkItem","click  #newEntity":"onClickNewForm"},initialize:function(){_.bindAll(this,"onSuccessSave","onErrorSave"),i.onAppEvent(i.INTENT_SAVE_SUCCESS,this.onSuccessSave),i.onAppEvent(i.INTENT_SAVE_ERROR,this.onErrorSave),e.prototype.initialize.apply(this,arguments)},render:function(){this.$el.addClass("form-list-container"),this.$el.prepend(r({title:this.$el.attr("ntnx-ui-header-title")})),this.sectionListEl=this.$("#sectionList"),this.sectionFormEl=this.$("#sectionForm"),this.sectionHeaderEl=this.$("#sectionHeader");var e=this.$el.closest(".n-modal-wrapper");return this.modalFooterEl=e.find(".n-modal-footer"),this.modalFooterEl.prepend(a),this.btnBackEl=this.modalFooterEl.find(".btnBack"),this.btnBackEl.off().on("click",this.onClickBack.bind(this)),this.showSection(this.MODE.LIST),this.$("#sectionHeader").show(),this.applyNutanixInput(),this},showSection:function(e){this.$(".section").hide(),this.modalFooterEl.find("button").hide(),e===this.MODE.FORM?(this.sectionFormEl.show(),this.modalFooterEl.find(".btnSave, .btnBack").show()):(this.sectionHeaderEl.show(),this.sectionListEl.show(),this.modalFooterEl.find(".btnCancel").show())},destroy:function(){this.btnBackEl&&this.btnBackEl.off(),i.offAppEvent(i.INTENT_SAVE_SUCCESS,this.onSuccessSave),i.offAppEvent(i.INTENT_SAVE_ERROR,this.onErrorSave),e.prototype.destroy.apply(this,arguments)},renderList:function(e){var t=this.options.template(this.vtOptions({data:e})),i=$("<div/>");i.append(t);var n=i.find("#tableEntity");this.sectionListEl.html(n),this.showSection(this.MODE.LIST)},onClickLinkItem:function(e){var i=$(e.currentTarget),n=i.attr("data-id"),a=this.$el.attr("ntnx-ui-entity-type"),r=this;s.fetchEntity(function(e){t.logObject("IntentManager | entity: ",e),e&&e.entity&&(r.setFormWithData(e.entity,r.sectionFormEl),r.showSection(r.MODE.FORM),r.$("[hide-create]").show())},a,n)},onClickNewForm:function(e){this.showSection(this.MODE.FORM),this.$("input").val(""),this.$("input["+n.FORM_ATTR.DEFAULT_VALUE+"]").each(function(){var e=$(this);e.val(e.attr(n.FORM_ATTR.DEFAULT_VALUE))}),this.$("[hide-create]").hide()},onClickBack:function(e){this.showSection(this.MODE.LIST)},onSuccessSave:function(e,i){var n=this,a=this.$el.attr("ntnx-ui-entity-type");s.fetchEntityList(function(e){t.logObject("IntentManager | entity: ",e),n.renderList(e)},[a])},onErrorSave:function(e,t){}})}),define("text!templates/popups/prismlet/IDPLoginPopupView.html",[],function(){return'<div class="modal-header">\n  <button type="button" class="close" data-dismiss="modal">\n    <i data-icon="K" aria-hidden="true"></i>\n  </button>\n</div>\n\n<div class="n-modal-wrapper">\n  <div class="n-modal-body">\n    <div class="n-modal-alert-header not-empty">\n      \x3c!-- alert goes here --\x3e\n    </div>\n    <div class="n-modal-content-wrapper">\n      <div class="n-modal-content">\n        <div class="n-particle-view-container">\n          <div class="n-particle-view">\n            <div class="n-title"><%= SVG.loadSVG(SVG.NUTANIX_CIRCLE) %></div>\n          </div>\n        </div>\n        <p class="n-login-description">\n          <%= i18n(\'login_desc\') %>\n        </p>\n        <button class="btn -blue idpLogin"><%= i18n(\'login\') %></button>\n      </div>\n    </div>\n  </div>\n</div>\n'}),define("views/popups/prismlet/IDPLoginPopupView",["views/basecomponents/popups/BasePopupView","views/utils/ParticleView","managers/IntentManager","data/DataURLConstants","utils/SubViewHelper","text!templates/popups/prismlet/IDPLoginPopupView.html"],function(e,t,i,n,s,a){"use strict";return a=_.template(a),e.extend({name:"IDPLoginPopupView",events:{"click .modal-header > .close":"hide","click .idpLogin":"handleLoginClick","click .n-create-account":"handleAccountCreateClick"},initialize:function(t){this.onHide=t.onHide,this.onLoginClick=t.onLoginClick,this.subViewHelper=new s,e.prototype.initialize.apply(this,arguments)},render:function(){this.$el.html(a(this.vtOptions({})));var e=new t({el:this.$(".n-particle-view")});return this.subViewHelper.register("particleView",e),e.renderParticles({fgOptions:{density:1e4,particleRadius:2},bgOptions:{density:8e3,particleRadius:1}}),this},hide:function(){this.tabInstance&&this.tabInstance.close(),
this.subViewHelper.get("particleView").destroy(),this.onHide&&this.onHide(),e.prototype.hide.apply(this,arguments)},handleLoginClick:function(e){$(e.currentTarget).prop("disabled",!0),this._openAndPoll(i.getDataURL(n.INTENT_IDP_LOGIN))},handleAccountCreateClick:function(e){e.preventDefault(),this._openAndPoll(n.CREATE_ACCOUNT)},_openAndPoll:function(e){this.tabInstance=window.open(e),this.onLoginClick&&this.onLoginClick()}})}),define("models/prismlet/InstallPollingModel",["models/intent/IntentPollingModel","managers/IntentManager","utils/AppConstants","data/DataProperties"],function(e,t,i,n){"use strict";return e.extend({name:"InstallPollingModel",initialize:function(n){e.prototype.initialize.apply(this,arguments),this.clear({silent:!0}),this.resources=n.resources;var s=t.getURLObject(i.ENTITY_EXTENSION,t.SWAGGER_REST.POST);s.url&&(this.urlRoot=s.url),this._populateBasicSwagger(this.resources)},startPolling:function(){this.setIntervalTime(this.AGGRESSIVE_POLLING_INTERVAL),e.prototype.startPolling.apply(this,arguments)},getStatusCode:function(){return{}},_populateBasicSwagger:function(e){var s={},a={},r=t.SWAGGER_PROPERTIES;s[r.KIND]=i.ENTITY_EXTENSION,s[r.PROP_NAME]=e[r.PROP_NAME];var o={};o[r.PROP_NAME]=e[r.PROP_NAME],o[r.PROP_DESC]=e[r.PROP_DESC],o[r.PROP_RESOURCES]={},o[r.PROP_RESOURCES][n.INTENT_AVAILABLE_EXT_REF]=e,o[r.PROP_RESOURCES][r.PROP_STATE]=i.INTENT_SPEC_STATE.RUNNING,a[r.PROP_SPEC]=o,a[r.API_VERSION]=t.getAPIVersion(),a[r.PROP_METADATA]=s,this.set(a,{silent:!0})}})}),define("views/popups/prismlet/PADetailsPopupView",["views/basecomponents/form/BaseFormView","views/popups/prismlet/IDPLoginPopupView","utils/AppConstants","utils/AppUtil","data/DataProperties","events/AppEvents","models/prismlet/InstallPollingModel","managers/IntentManager","managers/EntityStateTracker"],function(e,t,i,n,s,a,r,o,l){"use strict";var c=_.template('<section class="n-image-section"><div class="left-arrow"><%= Components.icon("x", "-inline") %></div><div class="n-image-list"></div><div class="right-arrow"><%= Components.icon("y", "-inline") %></div></section>'),u=_.template('<section class="n-app-section app-section"><section class="n-app-info-section"><header><span class="app-name"><%= name %></span><span class="app-version"><%= version %></span></header><p class="app-description"><%= description %></p></section></section><section class="n-app-review-section app-section"></section>'),d=_.template('<img class="app-image" src="<%= imgURL %>">'),h=(_.template('<div class="app-review"><header><div class="app-user pull-left"><%= name %></div><div class="app-user-rating pull-right"><%= rating %></div></header><p class="app-user-comment"><%= comment %></p></div>'),{NAME:"name",ICON_UUID:"icon",RATING:"rating",VERSION:"version",REVIEWS:"reviews",DESCRIPTION:"description",AVG_RATING:"average_rating",USER:"user",COMMENT:"comment",SCREENSHOT_UUIDS:"screen_shot_uuids"});return e.extend({parentEl:null,dataModel:null,intentModel:null,tabInstance:null,events:{"click .app-review-icon":"scrollToComments"},initialize:function(t){e.prototype.initialize.apply(this,arguments),this.parentEl=t.popupEl;var i=t.dataObject;this.dataModel=i.entity[s.INTENT_STATUS][s.INTENT_RESOURCES],this.viewId=t.viewOptions.viewId,_.bindAll(this,"moveLeft","moveRight","handleClickInstall","handlePollingSuccess"),this._setIntentModel(this.dataModel),this._setupHandlers()},render:function(){return $(this.parentEl).find(".n-title").text(this.dataModel[h.NAME]),this.updateView(this.dataModel),this},destroy:function(){this.parentEl.find(".left-arrow").off("click",this.moveLeft),this.parentEl.find(".right-arrow").off("click",this.moveRight),this.parentEl.find(".btnSave").off("click",this.handleClickInstall),e.prototype.destroy.apply(this,arguments)},updateView:function(e){this.parentEl.find(".modal-header").append(c(this.vtOptions({}))),this._renderImageSection(e);var t=u(this.vtOptions({name:e[h.NAME],version:e[h.VERSION],description:e[h.DESCRIPTION]}));this.$(".app-details").html(t)},moveLeft:function(e){var t=$(e.currentTarget),i=t.siblings(".n-image-list"),n=i.data("imgIdx");if(_.isNumber(n)&&!(n-1<0)){var s=n-1;this._replaceImage(i,s)}},moveRight:function(e){var t=$(e.currentTarget),i=t.siblings(".n-image-list"),n=i.data("imgIdx"),s=this.dataModel[h.SCREENSHOT_UUIDS].length;if(_.isNumber(n)&&!(n+1>=s)){var a=n+1;this._replaceImage(i,a)}},scrollToComments:function(){this.$(".app-reviews")[0].scrollIntoView()},handleClickInstall:function(){var e=this,t=this.parentEl.find(".btnSave");t.prop("disabled",!0),this.intentModel.fetch({success:function(){t.prop("disabled",!1),e.handleSuccessAppInstall()},error:function(i,n){t.prop("disabled",!1),401===n.status&&(e.parentEl.removeClass("fade in"),e.parentEl.addClass("dim"),e._showIDPLoginPopup())}})},handlePollingSuccess:function(){this.intentModel.stopPolling(),this.handleSuccessAppInstall()},handleSuccessAppInstall:function(){a.triggerAppEvent(a.SWITCH_TABS,i.TAB_DETAILS.INSTALLED_EXT);var e=o.SWAGGER_PROPERTIES,t=this.intentModel.get(e.PROP_METADATA);l.addEntity({entityType:t[e.KIND],entityId:t[e.PROP_UUID]}),this.idpLoginPopup&&(this.idpLoginPopup.hide(),this.idpLoginPopup=null),a.triggerAppEvent(a.INTENT_POPUP_CLOSE,{viewId:this.viewId})},_replaceImage:function(e,t){var i=this._getImgUrl(this.dataModel,t);e.empty(),e.html(d({imgURL:i})),e.data("imgIdx",t)},_renderImageSection:function(e){var t=this.parentEl.find(".n-image-list"),i=this._getImgUrl(e,0);t.html(d({imgURL:i})),t.data("imgIdx",0),this.parentEl.find(".left-arrow").on("click",this.moveLeft),this.parentEl.find(".right-arrow").on("click",this.moveRight)},_getImgUrl:function(e,t){return o.getFormattedURL({action:i.ACTION_FETCH,actionTarget:i.ENTITY_AVAILABLE_EXT_IMAGES,actionTargetId:e[h.SCREENSHOT_UUIDS][t]})},_setIntentModel:function(e){this.intentModel=new r({entityType:i.ENTITY_EXTENSION,resources:e})},_setupHandlers:function(){this.parentEl.find(".btnSave").on("click",this.handleClickInstall)},_showIDPLoginPopup:function(){var e=this;this.idpLoginPopup=new t({el:n.createPopupContainer("popupIDPLogin"),onLoginClick:function(){e.intentModel.on("change",e.handlePollingSuccess),e.intentModel.startPolling()},onHide:function(){e.intentModel.stopPolling(),e.parentEl.removeClass("dim"),e.parentEl.addClass("fade in")}}),this.idpLoginPopup.show()}})}),define("views/popups/prismlet/ManageExtensionsPopupView",["views/basecomponents/form/BaseFormView","managers/IntentManager","managers/ActionManager","managers/EntityStateTracker","utils/AppConstants","utils/AppUtil","events/AppEvents","data/DataProperties"],function(e,t,i,n,s,a,r,o){"use strict";var l=_.template('<tr data-id="<%= entityId %>" class="<%= classes %>"><td><%= entityInfo.name %></td><td><%= entityInfo.version %></td><td><% if (showLoader) { %><div class="donut-loader-blue"></div><% } else { %><div class="n-update-ext n-action" actionTargetId="<%= entityId %>" actionId="<%= AppConstants.ACTION_UPDATE %>"><a><%= i18n("extension.update") %></a></div><div class="n-delete-ext n-action" actionTargetId="<%= entityId %>" actionId="<%= AppConstants.ACTION_DELETE %>"><a><%= i18n("extension.uninstall") %></a></div><% } %></td></tr>');return e.extend({events:{"click .n-action":"onClickAction"},initialize:function(t){e.prototype.initialize.apply(this,arguments),this.parentEl=t.popupEl,this.dataObject=t.dataObject,this.intentModel=t.intentModel,this.eventBus=t.eventBus,this.viewId=t.viewOptions.viewId,this.dataModel=this.dataObject.entity.entities,_.bindAll(this,"onEntityStateChanged","_fetchComplete"),this._listenToEntityEvents()},destroy:function(){r.offAppEvent(r.INTENT_ENTITIES_STATE_CHANGED,this.onEntityStateChanged),e.prototype.destroy.apply(this,arguments)},render:function(){return $(this.parentEl).find(".n-title").html(this.i18n("extension.manage_ext")),$(this.parentEl).find(".btnSave").hide(),this.dataModel.length>0?this._refreshList(this.dataModel):this.$(".ext-list").html("<tr>No extensions installed.</tr>"),this},onEntityStateChanged:function(e,i){for(var o=i.length,l=0;l<o;l++){var c=i[l],u=c[n.DP.ENTITY_TYPE],d=c[n.DP.ENTITY_ID];if(u===a.getEntityTypeEB(s.ENTITY_EXTENSION)&&a.findIntentEntity(this.dataModel,d)){r.triggerAppEvent(r.INTENT_POPUP_NOTIFY,{viewId:this.viewId,msg:this.i18n("extension.fetching_list"),type:s.NOTIFY_INFO}),t.fetchEntityList(this._fetchComplete,[s.ENTITY_EXTENSION]);break}}},onClickAction:function(e){var t=$(e.currentTarget),n=t.attr(s.NAV_ACTION_TARGET_ID),a=t.attr(s.NAV_ACTION_ID),r={};r[s.NAV_ACTION_TARGET]=s.ENTITY_EXTENSION,r[s.NAV_ACTION_TARGET_ID]=n,r[s.NAV_ACTION_TYPE]=s.ACTION_TYPE_BATCH,r[s.NAV_ACTION_ID]=a,i.executeAction(r)},_fetchComplete:function(e){this._refreshList(e[s.ENTITY_EXTENSION].entities)},_listenToEntityEvents:function(){r.onAppEvent(r.INTENT_ENTITIES_STATE_CHANGED,this.onEntityStateChanged)},_refreshList:function(e){r.triggerAppEvent(r.INTENT_POPUP_NOTIFY,{viewId:this.viewId,close:!0});var t="";_.each(e,function(e){var i=e.status.resources,n=e.metadata.uuid,r="",c=!1,u=i[o.INTENT_AVAILABLE_EXT_REF];e.status&&e.status.state&&!a.isIntentStateComplete(s.ENTITY_EXTENSION,e.status.state)&&(c=!0,r="disabled"),t+=l(this.vtOptions({entityInfo:u,entityId:n,classes:r,showLoader:c}))},this),this.$(".ext-list").empty(),this.$(".ext-list").html(t)}})}),define("text!templates/intent/MultiSelectDefaultTableView.html",[],function(){return'\n<% if (dataList.length) { %>\n  <div class="multi-select-default-table-container">\n    <% if (hasScroll) { %>\n      \x3c!-- Table Head if scroll [Start] --\x3e\n      <table class="table table-hover table-subrow multi-select-default-table-head">\n        <thead>\n          <tr>\n            \x3c!-- Add column headers: Similar to the table body below --\x3e\n            <%= colsHeader %>\n          </tr>\n        </thead>\n      </table>\n      \x3c!-- Table Head if scroll [End] --\x3e\n    <% } %>\n    \x3c!-- Add scroll style if scrolling is enabled. --\x3e\n    <div class="multi-select-default-table-body-container\n                <%= hasScroll ? \'has-scroll\': \'\'%>">\n      <table class="table table-hover table-subrow multi-select-default-table-body">\n        <% if (!hasScroll) { %>\n          <thead>\n            <tr>\n              \x3c!-- Add column headers: Similar to the table head above --\x3e\n              <%= colsHeader %>\n            </tr>\n          </thead>\n        <% } %>\n        <tbody>\n          <% _.each(dataList, function(data, rowIndex) { %>\n          <tr class="subrow">\n            <% _.each(columns, function(column, colIndex) { %>\n            <td>\n              \x3c!-- Add checkbox if required. --\x3e\n              <% if (colIndex === 0 && isShowCheckbox) { %>\n                <%= Components.checkbox({\n                  "id": data[identifier],\n                  "disabled": isDisabled,\n                  "jsClasses" : "multiSelectChkBox",\n                  "attributes": "model-attribute=" + modelAttribute,\n                  "value" : data[identifier]} )%>\n              <% } %>\n              <%- data[column] %>\n            </td>\n            <% }); %>\n            \x3c!-- Add Default column if required. --\x3e\n            <%\n              if (isShowDefault) {\n                // Set the model attribute for default if present.\n                var attrs = "";\n                if (defaultModelAttribute) {\n                  attrs = "model-attribute=" + defaultModelAttribute\n                }\n            %>\n            <td class="align-right">\n              <%= Components.checkbox({\n                type: \'favorite\',\n                "id": data[identifier] + tableName,\n                "jsClasses" : "singleSelectChkBox",\n                name : tableName,\n                "attributes": attrs,\n                "value" : data[identifier]} )%>\n            </td>\n            <% }%>\n          </tr>\n          <% }); %>\n        </tbody>\n      </table>\n    </div>\n  </div>\n<% } else { %>\n  <span class="description">\n    <%= i18n(i18nLabel + \'noResults\') %>\n  </span>\n<% } %>\n'}),define("text!templates/intent/MultiSelectDefaultTableColumns.html",[],function(){return"<% _.each(columns, function(column) { %>\n  <th class=\"table-cell <%=column%>\">\n    <%= i18n(i18nLabel + column, column) %>\n  </th>\n<% }); %>\n\x3c!-- Default column header --\x3e\n<% if (isShowDefault) { %>\n  <th class=\"default align-right\">\n    <%= i18n(i18nLabel + 'default', 'Default') %>\n  </th>\n<% }%>"}),define("views/intent/components/custom/formcontrol/MultiSelectDefaultTableView",["views/basecomponents/form/BaseFormControlView","data/DataProperties","events/AppEvents","utils/FormRendererUtil","managers/IntentManager","text!templates/intent/MultiSelectDefaultTableView.html","text!templates/intent/MultiSelectDefaultTableColumns.html"],function(e,t,i,n,s,a,r){"use strict";var o=_.template(a),l=_.template(r),c={NAME:"name",IS_SHOW_CHECKBOX:"checkbox",IS_SHOW_DEFAULT:"default",IS_SELECT_DEFAULT:"selectDefault",COLUMNS:"columns",DATA:"data",I18N_LABEL:"i18n-label",DEFAULT_MODEL_ATTRIBUTE:"default-model-attribute",TOOLTIP_FOR_COLUMN:"tooltip-for-",TOOLTIP_PLACEMENT_FOR_COLUMN:"tooltip-placement-for-"},u={AUTO_DEFAULT_SELECTION:"auto-default-selection"};return e.extend({isShowCheckbox:!0,isShowDefault:!0,isDefaultAutoSelect:!1,isSelectDefault:!1,identifier:t.UUID,columns:null,data:null,i18nLabel:"",tableName:"multiSelectTable",dataList:null,modelAttribute:null,defaultModelAttribute:null,enableScroll:!1,maxElementsShown:10,initialize:function(t){if(e.prototype.initialize.apply(this,arguments),this.$el.attr(c.IS_SHOW_CHECKBOX)&&(this.isShowCheckbox=this.$el.attr(c.IS_SHOW_CHECKBOX)),this.$el.attr(c.IS_SHOW_DEFAULT)){var s=this.$el.attr(c.IS_SHOW_DEFAULT);this.isShowDefault="true"===s.trim().toLowerCase()}if(this.$el.attr(c.IS_SELECT_DEFAULT)){var a=this.$el.attr(c.IS_SELECT_DEFAULT);this.isSelectDefault="true"===a.trim().toLowerCase()}if(this.$el.attr(c.DEFAULT_MODEL_ATTRIBUTE)){var r=this.$el.attr(c.DEFAULT_MODEL_ATTRIBUTE);this.defaultModelAttribute=r}if(this.$el.attr(c.NAME)&&(this.tableName=this.$el.attr(c.NAME)),this.$el.attr(c.I18N_LABEL)&&(this.i18nLabel=this.$el.attr(c.I18N_LABEL)),!this.$el.attr(c.COLUMNS))throw new Error("Columns not specified for multi select table view.");this.columns=this.$el.attr(c.COLUMNS).split(",");var o=this.$el.attr(n.DP.TMPL_ATTRS.VIEW_DATA_LIST);o&&(this.dataList=o);var l=this.$el.attr(n.DP.TMPL_ATTRS.VIEW_ATTRIBUTE);l&&(this.modelAttribute=l),_.bindAll(this,"onRenderMultiSelectTableView"),i.onAppEvent(i.RENDER_MULTISELECT_TABLEVIEW,this.onRenderMultiSelectTableView),this.isFeatureEnabled(u.AUTO_DEFAULT_SELECTION)&&(this.isDefaultAutoSelect=!0)},render:function(e,t,i){var n=this,s=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=this.getDataListToDisplay(t),r=this.vtOptions({columns:this.columns,isShowDefault:this.isShowDefault,isShowCheckbox:this.isShowCheckbox,identifier:this.identifier,isDisabled:s,dataList:a,i18nLabel:this.i18nLabel,tableName:this.tableName,modelAttribute:this.modelAttribute,defaultModelAttribute:this.defaultModelAttribute,hasScroll:this.hasScroll(a.length)}),c=l(r);this.$el.html(o(_.extend(r,{colsHeader:c}))),this.addColumnTooltips(),this.selectEntities(i);var u=this.$(".multiSelectChkBox");this.isShowDefault&&this.isDefaultAutoSelect&&u.click(function(e){e&&e.currentTarget&&e.currentTarget.id&&n.checkDefaultSelection(e.currentTarget.id)})},hasScroll:function(e){return this.enableScroll&&e>this.maxElementsShown},selectEntities:function(e){var t=this.$(".multiSelectChkBox");if(this.isShowCheckbox)if(this.isSelectDefault&&1===t.length)$(t[0]).prop("checked",!0);else if(t.length>0&&e&&e.length>0){var i=$(t).filter(function(t,i){var n=$(i).attr("id");return _.contains(e,n)});$(i).prop("checked",!0)}},checkDefaultSelection:function(e){!0!==this.isRowSelected(e)||this.getDefaultRowId()||this.setDefault(e)},setDefault:function(e){this.$("table tbody td .singleSelectChkBox[value="+e+"]").click()},isRowSelected:function(e){return this.$("table tbody td .multiSelectChkBox[value="+e+"]").prop("checked")},getDefaultRowId:function(){var e=this.$("table tbody td .singleSelectChkBox:checked").first();if(e.length&&e.prop("value"))return e.prop("value")},getColumtTooltipPlacement:function(e){return this.$el.attr(c.TOOLTIP_PLACEMENT_FOR_COLUMN+e)||"bottom"},addColumnTooltips:function(){var e=this;if(this.$el[0]&&this.$el[0].attributes){var t=c.TOOLTIP_FOR_COLUMN;_.each(this.$el[0].attributes,function(i){var n=i.name.replace(t,"");if(i.name.indexOf(t)>=0&&""!==n){var s=e.$(".table > thead th."+n);s.length&&s.nutanixMoreInfo({title:i.value,renderMethod:"append",placement:e.getColumtTooltipPlacement(n)})}})}},destroy:function(){i.offAppEvent(i.RENDER_MULTISELECT_TABLEVIEW,this.onRenderMultiSelectTableView),this.$(".nutanixMoreInfo").nutanixMoreInfo("destroy"),e.prototype.destroy.apply(this,arguments)},selectRow:function(e){this.$("input[type=checkbox][value="+e+"].multiSelectChkBox").attr("checked","checked")},onRenderMultiSelectTableView:function(e,i){var n=i.entityType,a=i.entityId,r=i.selectedEntities||[],o=this.getDataObject(),l=null;if(n&&a){var c=o[n];c&&c[t.RESULT_ENTITIES]&&(c=c[t.RESULT_ENTITIES]);var u;if(c&&(u=_.find(c,function(e){var i=e[s.SWAGGER_PROPERTIES.PROP_METADATA];return i=i||e,i[t.UUID]===a})),u&&this.dataList===t.SSP_NETWORK.NETWORK_DATA_OBJ&&(l=this._getNetworkReferences(u)),n===t.SSP_PROJECT.PROJECT_DATA_OBJ&&this.dataList===t.SSP_NETWORK.NETWORK_DATA_OBJ&&this.isSelectDefault){var d=u[s.SWAGGER_PROPERTIES.PROP_STATUS]||{},h=d[s.SWAGGER_PROPERTIES.PROP_RESOURCES];if(h&&h[t.SSP_NETWORK.DEFAULT_NETWORK]){var p=h[t.SSP_NETWORK.DEFAULT_NETWORK][t.UUID];r.push(p)}}}else l=this.customFilter(i);this.render(null,l,r)},customFilter:function(e){return null},getDataListToDisplay:function(e){var i=[];return e&&!e.length||(i=this.getDataObject()[this.dataList],i&&i[t.RESULT_ENTITIES]&&(i=i[t.RESULT_ENTITIES]),i=_.map(i,function(e){return s.getIntentModelProperties(e)}),e&&(i=_.filter(i,function(i){return-1!==e.indexOf(i[t.UUID])})),this.dataList!==t.SSP_NETWORK.NETWORK_DATA_OBJ&&this.dataList!==t.SSP_NETWORK.VIRTUAL_NETWORK||(i=_.sortBy(i,function(e){return e.name?e.name.toLowerCase():e.name}))),i},_getNetworkReferences:function(e){var i=e[s.SWAGGER_PROPERTIES.PROP_STATUS]||{},n=i[s.SWAGGER_PROPERTIES.PROP_RESOURCES]||{},a=i[t.SSP_NETWORK.SUBNET_REFERENCE_LIST]||n[t.SSP_NETWORK.SUBNET_REFERENCE_LIST]||[];return _.map(a,function(e){return e[t.UUID]})}})}),define("views/intent/components/custom/formcontrol/DropDownFormControlView",["views/basecomponents/form/BaseFormControlView","utils/AppUtil","utils/AppConstants","data/DataProperties","utils/FormRendererUtil","components/Components","managers/IntentManager"],function(e,t,i,n,s,a,r){"use strict";var o={NAME_ATTR:"ntnx-name-attr",VALUE_ATTR:"ntnx-value-attr",SKIP_MODEL:"ntnx-skip-model-attribute",POS_ATTR:"ntnx-ui-anchor-position",DISABLED:"ntnx-disabled"};return e.extend({modelAttr:null,nameAttr:null,valueAttr:null,dataAttr:null,dataSubList:null,anchorPosition:null,skipModelAttribute:!1,isDisabled:!1,initialize:function(t){e.prototype.initialize.apply(this,arguments),this.$el.attr(o.NAME_ATTR)&&(this.nameAttr=this.$el.attr(o.NAME_ATTR)),this.$el.attr(o.VALUE_ATTR)&&(this.valueAttr=this.$el.attr(o.VALUE_ATTR)),this.$el.attr(o.POS_ATTR)&&(this.anchorPosition=this.$el.attr(o.POS_ATTR)),this.$el.attr(o.DISABLED)&&(this.isDisabled="true"===this.$el.attr(o.DISABLED)),this.$el.attr(o.SKIP_MODEL)&&(this.skipModelAttribute="true"===this.$el.attr(o.SKIP_MODEL));var i=this.$el.attr(s.DP.TMPL_ATTRS.VIEW_DATA_LIST);i&&(this.dataAttr=i);var n=this.$el.attr(s.DP.TMPL_ATTRS.VIEW_DATA_SUBLIST);n&&(this.dataSubList=n);var a=this.$el.attr(s.DP.TMPL_ATTRS.VIEW_ATTRIBUTE);a&&(this.modelAttr=a)},getOptions:function(e){var t=this;return _.map(e,function(e){return{name:e[t.nameAttr]||t.getUnnamedEntity(),value:e[t.valueAttr]}})},render:function(e,t){var i=this.getDataListToDisplay(t);i=this.filterResult(i);var n,s=this.isDisabled,r=[];this.skipModelAttribute||(n="model-attribute="+this.modelAttr),i?r=this.getOptions(i):s=!0,this.$el.html(a.select({disabled:s,options:r,attributes:n})),this.$("select").change(function(e){this.trigger("change",e)}.bind(this))},select:function(e){this.$("option[value="+e+"]").attr("selected","selected"),this.$("select").trigger("change")},getUnnamedEntity:function(){return i.INVALID_STRING},getDataListToDisplay:function(e){var i=this.getDataObject()[this.dataAttr];if(i&&i[n.RESULT_ENTITIES]&&(i=i[n.RESULT_ENTITIES]),i=_.map(i,function(e){return r.getIntentModelProperties(e)}),this.dataSubList){var s;s=e?_.find(i,function(t){return t[n.UUID]===e||t[n.NAME]===e}):i.length?i[0]:i,i=t.getObjectPathValue(s,this.dataSubList)}return i},filterResult:function(e){return e}})}),define("views/intent/IntentCustomFormFactory",["views/intent/components/custom/form/SectionFormView","views/intent/components/custom/form/WizardFormView","views/intent/components/custom/form/ListFormView","views/popups/prismlet/PADetailsPopupView","views/popups/prismlet/ManageExtensionsPopupView","views/prismlet/PAListView","views/intent/components/custom/formcontrol/MultiSelectDefaultTableView","views/intent/components/custom/formcontrol/DropDownFormControlView"],function(e,t,i,n,s,a,r,o){"use strict";var l={SECTION:"SectionFormView",WIZARD:"WizardFormView",LIST_FORM:"ListFormView",EXTENSION:"PADetailsPopupView",EXT_LIST:"PAListView",MANAGE_EXT:"ManageExtensionsPopupView"},c={MULTI_SELECT_TABLE:"MultiSelectTableView",DROPDOWN_FORM_CONTROL_VIEW:"DropDownFormControlView"};return{FORMATTER:c,getFormView:function(r,o){switch(r){case l.SECTION:return new e(o);case l.WIZARD:return new t(o);case l.LIST_FORM:return new i(o);case l.EXTENSION:return new n(o);case l.EXT_LIST:return new a(o);case l.MANAGE_EXT:return new s(o)}return null},getIntentModel:function(e){return null},getFormControlView:function(e,t){switch(e.formatter){case c.MULTI_SELECT_TABLE:return new r(t);case c.DROPDOWN_FORM_CONTROL_VIEW:return new o(t)}return null}}}),define("views/AppView",["views/basecomponents/BaseAppView","managers/PopupViewFactory","managers/PopupManager","managers/HealthManager","managers/AlertManager","managers/AlertSummaryManager","managers/TaskManager","managers/ClusterManager","managers/prechecks/PreCheckManager","managers/HelpManager","managers/AccessManager","managers/ReleaseManager","managers/IQSearchManager","managers/ActionWorkflowFactory","managers/ActionManager","managers/acropolis/AcropolisNetworkManager","managers/EntityFactory","managers/EntityManager","managers/DashboardManager","managers/SetupMenuManager","managers/NavigationManager","managers/ReloadManager","managers/NotificationManager","managers/EntityStateTracker","managers/AsyncLoadManager","managers/ExploreManager","managers/LoginManager","managers/ClusterConvertManager","managers/TooltipManager","managers/IntentManager","managers/UITemplateManager","managers/TabDetailsViewFactory","managers/FullDetailsViewFactory","managers/CustomModelFactory","managers/ExpressionFactory","managers/ExpressionManager","views/intent/IntentCustomFormFactory","events/AppEvents","utils/AppConstants","utils/AppUtil","utils/FormRendererUtil","utils/TimeUtil","utils/TooltipContent","text!app/scripts/pages.json"],function(e,t,i,n,s,a,r,o,l,c,u,d,h,p,T,E,S,g,A,m,f,I,C,v,R,N,P,O,y,D,M,b,L,w,U,V,k,x,F,Y,G,B,H,W){"use strict";var K;try{K=JSON.parse(W)}catch(e){Y.log("AppView: Failed to parse page modules config: "+e)}var z=_.template('<div class="<%= classes %>"><%= msg %></div>');return e.extend({name:"AppView",initializeManagers:function(){var e=[s,a,r,i,n,c,u,l,A,h,E,m,I,v,C,R,P,O,y];_.each(e,function(e){e.initialize()});var d={};d[S.VIEWS.TAB_DETAILS]=b,d[S.VIEWS.FULL_PAGE_DETAILS]=L,S.initialize({clusterManager:o,customModelFactory:w,viewsFactories:d}),g.initialize({entityFactory:S}),i.setPopupViewFactory(t),T.setActionWorkflowFactory(p),T.setEntityFactory(S),G.setCustomFormFactory(k),D.setQueryFactory(U),N.initialize(),V.initialize({expressionFactory:U}),o.attachEventHandler("load",this.onClusterDataLoaded,this)},onClusterDataLoaded:function(){this.initializeManagersAfterClusterLoaded(),o.detachEventHandler("load",this.onClusterDataLoaded,this)},initializeManagersAfterClusterLoaded:function(){var e=[d];_.each(e,function(e){e.initialize()})},loadPageView:function(e){var t;switch(e){case F.PAGE_VMS:t="VMsPageView";break;case F.PAGE_STORAGE:t="StoragePageView";break;case F.PAGE_HARDWARE:t="HardwarePageView";break;case F.PAGE_NETWORK:t="NetworkPageView";break;case F.PAGE_DR:t="DRPageView";break;case F.PAGE_ALERTS:t="AlertsPageView";break;case F.PAGE_ALERT_EXPLORER:t="AlertExplorerPageView";break;case F.PAGE_ANALYSIS:t="AnalysisPageView";break;case F.PAGE_PLANNING:t="PlanningPageView";break;case F.PAGE_SECURITY_PLANNING:t="SecurityPlanningPageView";break;case F.PAGE_CLUSTER_HEALTH:t="ClusterHealthPageView";break;case F.PAGE_TASKS:t="TasksPageView";break;case F.PAGE_ENTITY_BROWSER:t="EntityBrowserPageView";break;case F.PAGE_EXPLORE:t="ExplorePageView";break;case F.PAGE_PRISMLETS:t="PrismletPageView";break;case F.PAGE_MC_HEALTH:t="MulticlusterHealthPageView";break;case F.PAGE_MC_PE_IFRAME:t="PrismElementIFramePageView";break;case F.PAGE_APPS:t="AppsIFramePageView";break;case F.PAGE_FILE_SERVER:t="FileServerPageView";break;case F.PAGE_BROKER:t="BrokerPageView";break;case F.PAGE_SETTINGS:t="SettingsPageView";break;case F.PAGE_LCM:t="LCMPageView";break;default:t=o.isMulticlusterNavMode()?"MulticlusterDashboardPageView":"DashboardPageView"}var i=this;return R.whenLoaded(K.moduleName+".js",function(){require([K.modules[t]],i.renderPageView)}),e},fetchConfigurations:function(){return $.when(S.fetchConfigurations())},startAppServices:function(){var e=this;this.fetchConfigurations().always(function(){e.startServices()})},renderPageView:function(t,i){var n=this.fetchConfigurations(),s=_.bind(function(t,i){e.prototype.renderPageView.apply(this,arguments)},this);n.done(function(){s(t,i)}),Y.isIE9OrBelow()&&C.showNotificationBar(z({classes:"n-ie9 -blue dismissOnClose",msg:this.i18n("ieCompatibility")}),F.NOTIFICATION_BAR.IE_COMPATIBILITY,!0),o.isReadOnly()&&C.showNotificationBar(z({classes:"-red",msg:this.i18n("clusterReadOnly")}),F.NOTIFICATION_BAR.CLUSTER_READ_ONLY,!0)},handlePopupAction:function(e){i.handleAction(e)},registerAppEvents:function(){x.onAppEvent(x.LOCALE_CHANGED,_.bind(this.updateLocaleAttributes,this)),r.registerHandlerResetStructure(r.displayUpgradeWarning,r)},updateLocaleAttributes:function(e,t){var i=$("html"),n=_.first(t.locale.split(F.LOCALE_SEPARATOR));t.previousLocale&&i.removeClass("locale-"+t.previousLocale),i.addClass("locale-"+t.locale),i.attr("lang",n),B.setLocale(t.locale),this.initializeTooltipContent()},initializeTooltipContent:function(){try{H.initialize()}catch(e){}},preRender:function(){if(N.initializeViews(),l.isUsingDefaultPassword())f.navigateToRoute(F.ROUTE_LOGOUT_OVERRIDE);else if(l.hasPrechecksPreRender()){var e=this,t=function(){e.render()},i=function(){l.executePreRenderPrechecks({successCallback:t,el:e.$el}),e._checkPrismElementIFrame()};this.stopPreloader(i)}else this.render()},postRender:function(){if(l.executeNonBlockingChecks(),l.hasPrechecksPostRender()){var e=this,t=function(){e.changePageRoute()};l.executePostRenderPrechecks({successCallback:t})}},changePageRoute:function(){l.hasPrechecksPostRender()?l.isValidPostRenderPrechecks()?e.prototype.changePageRoute.apply(this,arguments):Y.log("AppView: Invalid page route change because the prechecks are invalid."):e.prototype.changePageRoute.apply(this,arguments)},onEntityEvent:function(t,i){if(e.prototype.onEntityEvent.apply(this,arguments),!o.isMulticlusterUI()&&t&&i.entityType===F.ENTITY_CLUSTER){var n=i.entity&&i.entity.getName();Y.setPageTitle(n)}},render:function(){var t=this,i=arguments;M.fetchConfiguration().done(function(){e.prototype.render.apply(t,i)})}})}),define("routers/AppRouter",["jquery","backbone","events/AppEvents","utils/AppConstants","utils/AppUtil","managers/ActionManager","managers/ExploreManager"],function(e,t,i,n,s,a,r){"use strict";return t.Router.extend({appView:null,pageRoute:null,actionRoute:null,detailsRoute:null,latestPageRoute:null,latestQueryParamBeforeHash:null,routes:{"execute?*options":"executeAction","page/explore":"showExplorePage","page/explore/:pageId":"showExplorePage","page/explore/:pageId/:subPageId":"showExplorePage","page/explore/:pageId/:subPageId/*extras":"showExplorePage","page/explore/:pageId/:subPageId/?*options":"showExplorePage","":"showPage","page/:pageId":"showPage","page/:pageId/:subPageId":"showPage","page/:pageId/:subPageId/":"showPage","page/:pageId/:subPageId/?*options":"showPage","action/:action/:actionTarget":"showAction","action/:action/:actionTarget/":"showAction","action/:action/:actionTarget/:actionTargetId":"showAction","details?*options":"showFullPageDetails","chart/:options":"showChart",login:"showLogin","login?:options":"showLogin",logout:"showLogout","logout?:options":"showLogout"},initialize:function(t){if(t&&t.appView?this.appView=t.appView:this.appView=this.initializeAppView(),!this.appView)throw e("body").css("background-color","#ffffff").html("Missing Application View."),new Error("Internal Error: Missing Application View");this.registerRouteChangeEvents()},initializeAppView:function(e){},initApp:function(){s.log("AppRouter : Kickoff the application!"),this.appView.renderInit(this.pageRoute,this.actionRoute,this.detailsRoute)},registerRouteChangeEvents:function(){t.history.on("route",function(e){i.triggerAppEvent(i.ROUTE_CHANGE)})},executeAction:function(e){this.extractQueryParamBeforeHash();var t=s.parseQueryToObject(e);a.executeAction(t)},showLogin:function(e){this.extractQueryParamBeforeHash(),e=e||this.latestQueryParamBeforeHash,this.appView.renderLogin(this.pageRoute,e)},showPage:function(e,t,i){this.extractQueryParamBeforeHash(),t&&t.length&&"?"===t.charAt(0)&&(i=t,t=void 0),this.pageRoute={action:n.ACTION_NAVIGATE_PAGE,pageId:e,subPageId:t,options:i},a.executeAction(this.pageRoute),this.rememberLatestPageRoute()},showExplorePage:function(e,t,i){t&&t.length&&"?"===t.charAt(0)&&(i=t,t=void 0),i=s.parseQueryToObject(i),r.showPage(this,e,t,i)},showFullPageDetails:function(e){this.extractQueryParamBeforeHash();var t=s.parseQueryToObject(e);this.detailsRoute=t,a.executeAction(this.detailsRoute)},showAction:function(e,t,i){this.extractQueryParamBeforeHash(),this.actionRoute={action:e,actionTarget:t,actionTargetId:i},a.executeAction(this.actionRoute),this.updateWindowURL()},showChart:function(e){this.extractQueryParamBeforeHash(),this.pageRoute={action:n.ACTION_NAVIGATE_PAGE,pageId:n.PAGE_ANALYSIS,subPageId:n.SUBPAGE_TIMELINE,options:e},a.executeAction(this.pageRoute),this.rememberLatestPageRoute()},showLogout:function(e){this.appView.renderLogout(this.pageRoute,e)},extractQueryParamBeforeHash:function(){var t=window.location.href.split("#"),i=t[0],n=t[1]||"",a=/\?([^\?]*)$/,r=i.replace(a,""),o=(a.exec(i)||[])[1];e.trim(o).length&&window.history.pushState&&(this.latestQueryParamBeforeHash=o,window.history.pushState({},s.getPageTitle(),r+"#"+n))},rememberLatestPageRoute:function(){this.latestPageRoute=t.history.fragment},updateWindowURL:function(e){e=e||this.latestPageRoute||"",window.history.replaceState?window.history.replaceState({},s.getPageTitle(),"#"+e):window.location.href="#"+e}})});var PrismCentral=null;require(["app/scripts/config"],function(){"use strict";require(["app/scripts/common"],function(){require(["backbone","managers/NamespaceManager","managers/I18nManager","broker/managers/BrokerManager","views/AppView","utils/AppUtil","routers/AppRouter","CommonUtils"],function(e,t,i,n,s,a,r,o){t.initialize(),i.initialize({callback:function(){o.initialize({locale:i.getLocale()})}}),a.initialize(),n.initialize(),t.set(t.APP_ROUTER,new r({appView:new s})),e.history.start(),t.get(t.APP_ROUTER).initApp()})})}),define("app/scripts/main",function(){}),define("app/scripts/app",function(){});